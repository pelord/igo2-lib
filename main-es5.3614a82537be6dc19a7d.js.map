{"version":3,"mappings":"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CAtDH,CACPp/I,KACAigJ,KACAC,KACAC,KACA12H,KACAtpB,KACAypB,KAEAmc,GACAG,GACAkC,GACAI,GACAE,GACAE,GACAI,GAEAG,GACAK,GACAI,GACAG,GACAY,GACAM,GACAM,GACAI,GAEAoM,GAEAu0F,GACAE,GACAE,GACAE,GACAK,GACAE,GACAI,GACAE,GACAE,GACAI,GACAK,GACAgO,GACAU,GACAE,GACAE,GACAG,GACAE,GACAgB,GACAK,GAEAE,GAEAI,GAEAl/I,SAISyB,EAAb,YCvGI0kC,kBACF/lC,SAGFJ,OACGogJ,gBAAgBN,IADnB9/I,MAESyB,mBAAO8H,QAAQC,IAAI/H,4BCd5B,OACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,YACA,eACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,sBACA,mBACA,sBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,eACA,kBACA,gBACA,aACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,YACA,eACA,YACA,eACA,YACA,eACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,cACA,iBACA,aACA,gBACA,cACA,iBACA,cACA,mBACA,sBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,oBAIA,cACA,WACA,YAEA,cACA,cACA,8CACA,gCACAtB,EAEA,YAEAC,kBACA,uBAEAA,YACAF,YACAE","names":["Ae","zt","oe","S","e","Hu","getByte","t","o","charCodeAt","this","ALPHA","indexOf","charAt","n","s","a","length","l","String","PADCHAR","getByte64","push","fromCharCode","join","i","Wo","Yu","window","navigator","userAgent","copy","r","St","createTextArea","selectText","copyTextToClipboard","destroyTextArea","document","createElement","value","body","appendChild","removeChild","getOSName","contentEditable","readOnly","createRange","getSelection","contenteditable","readonly","selectNodeContents","removeAllRanges","addRange","setSelectionRange","select","compareVersion","execCommand","P","resolve","replace","split","shift","Array","isArray","Date","arguments","Object","assign","isObject","keys","filter","forEach","mergeDeep","hasOwnProperty","copyDeep","toUpperCase","key","count","c","toLowerCase","reduce","u","y","_loop","removeUndefined","map","removeNull","localeCompare","getOwnPropertyNames","_step","create","Math","random","toString","substring","fo","concat","ae","constructor","De","_status","status$","next","subscribe","watch","status$$","pipe","Fo","handleStatusChange","call","unsubscribe","unwatch","status","Waiting","Pi","register","Ze","ids","counter$","unregister","splice","factory","fac","Wu","intercept","headers","get","clone","handle","activityService","Ea","Rr","forRoot","ngModule","providers","provide","$","useClass","multi","Ja","lib","releaseDate","B","getConfig","config","load","path","injector","Promise","ce","console","log","$r","error","version","Ba","useValue","Ln","Jr","useFactory","Xu","deps","getTranslation","v","H","prefix","http","suffix","Ye","F","ep","A","Ua","translateService","langs","Error","substr","X","tp","missingTranslationHandler","op","ki","defaultOptions","_options","timeOut","hasCloseIcon","showProgressBar","pauseOnHover","clickToClose","maxLength","maxStack","preventDuplicates","selectors","yo","m","qr","L","translate","getBrowserLang","getLanguage","setDefaultLang","language","match","setLanguage","use","reloadLang","Io","ERROR","de","options","configService","showError","caught","message","title","messages$","from","to","parse","handleTemplate","text","notificationService","type","html","icon","theClass","addIcon","id","success","SUCCESS","info","INFO","alert","ALERT","remove","removeAllAreNotError","_step2","template","np","httpError","handleError","handleCaughtError","handleUncaughtError","statusText","url","toDisplay","messageService","instant","Br","Na","Oo","centerKey","zoomKey","projectionKey","contextKey","searchKey","visibleOnLayersKey","visibleOffLayersKey","directionsCoordKey","toolKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","vectorKey","route","queryParams","Zt","Mobile","Vt","Portrait","rt","observe","_o","matches","media$","orientation$","Landscape","Tablet","Desktop","getMedia","getOrientation","isTouchScreen","documentElement","isMobile","isDesktop","ye","SESSION","ro","ADDED","ne","sessionStorage","getItem","LOCAL","localStorage","JSON","set","setItem","stringify","storageChange$","scope","event","MODIFIED","previousValue","currentValue","removeItem","REMOVED","clear","CLEARED","Fn","connection","onLine","checkNetworkState","onlineSubscription","Ft","state","emitEvent","offlineSubscription","stateChangeEventEmitter","emit","ngOnDestroy","currentState","_e","Qu","yt","Default","Ko","Auto","Ei","None","Ur","safeObject","meta","$o","idProperty","titleProperty","iconProperty","dp","Map","$i","store","getKey","qi","index","size","setMany","setAll","update","updateMany","updateManyExclusive","reverse","reverseMany","reverseChanges","updateAll","getAllKeys","Set","some","entries","_o2","change$","getKey$","count$","empty$","_index","all","values$","all$","firstBy","find","firstBy$","manyBy","manyBy$","sort","destroy","values$$","createIndex","lifted","joins","filter$","addFilter","filterIndex","filters$","values","removeFilter","sort$","lift","liftJoinedSource","liftSource","Xo","_o3","processValues","setValues","source$","source","_t2","computeJoinedValue","slice","filterValues","sortValues","every","valueAccessor","direction","nullsFirst","generateIndex","getProperty","createStateManager","view","createDataView","stateView","createStateView","_pristine","entities$","softClear","updateCount","insert","insertMany","delete","deleteMany","addStrategy","strategies","bindStore","activate","removeStrategy","unbindStore","getStrategyOfType","activateStrategyOfType","deactivateStrategyOfType","deactivate","Qa","entity","statesAreTheSame","revision","ref","setChangeDetector","setStore","teardownObservers","innerStateIndex","setupObservers","detectChanges","cdRef","entities$$","onEntitiesChange","state$$","onStateChange","_i2","Eo","active$","active","doDeactivate","doActivate","stores","super","filterStore","unfilterStore","filterAll","unfilterAll","filters","filterClauseFunc","has","selected","Ya","Tt","ngOnInit","watcher","On","selected$$","onSelectFromStore","onSelectionChange","multiSelectValue","emptyValue","selectedChange","selected$","updateMultiToggleWithEntities","multiText$","multiNoneText","multiAllText","Ri","onClick","stopPropagation","fp","scroll","_selected","selection","toggleSelected","selectOnClick","addCls","selectedCls","highlightSelection","highlightedCls","removeCls","ap","el","nativeElement","scrollMode","behavior","block","inline","renderer","addClass","removeClass","za","paginationLabelTranslation$$","languageService","p","max","min","ngOnChanges","unsubscribeAll","count$$","emitPaginator","entitySortChange$$","entitySortChange$","paginator","firstPage","initPaginatorOptions","translateLabels","disabled","paginatorOptions","pageIndex","pageSize","pageSizeOptions","mediaService","showFirstLastButtons","hidePageSize","_intl","firstPageLabel","getRangeLabel","rangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","paginatorChange","Zn","Dn","transform","activityInterceptor","responseType","sp","et","FileReader","readAsDataURL","onloadend","result","complete","pure","ee","Yr","maxCacheCount","Vr","_sanitizer","bypassSecurityTrustHtml","Ji","ue","_paginator","dataSource","columns","visible","name","selectionCheckbox","selectMany","fixedHeader","handleDatasource","unsubscribeStore","selection$$","floor","selectionState$","computeSelectionState","dataSource$$","data","getTrackByFunction","refresh","onSort","getValue","sortNullsFirst","entitySortChange","column","onRowClick","lastRecordCheckedKey","entityClick","onRowSelect","entitySelectChange","added","onToggleRows","onToggleRow","onShiftToggleRow","selectNode","target","stopImmediatePropagation","g","h","All","Some","columnIsSortable","rowIsSelected","isImg","isUrl","pop","getColumnRenderer","getTableClass","getHeaderClass","headerClassFunc","Function","getRowClass","rowClassFunc","getCellClass","cellClassFunc","onButtonClick","so","Dock","oxw","action","ad","disabled$","noDisplay$","args","ngClass","ngClass$$","updateNgClass","Nr","icon$$","updateIcon","checkCondition","checkCondition$$","updateCheckCondition","tooltip","tooltip$$","updateTooltip","availability","availability$$","disabled$$","display","display$$","noDisplay","noDisplay$$","trigger","ngClass$","tooltip$","checkCondition$","icon$","Bi","handler","collapsed","_overlayClass","withTitle","withIcon","horizontal","elRef","scrollActive","clientHeight","scrollHeight","scrollTop","positionConditionLow","onTriggerAction","scrollDown","scrollBy","scrollUp","Pn","x","I","we","k","b","Ue","Wr","imports","Xr","matIconRegistry","getNamedSvgIcon","svg","updateSvg","hidden","updateHidden","updateDisabled","inverseColor","updateColor","inheritColor","querySelector","badge","style","alignItems","justifyContent","innerHTML","color","background","getComputedStyle","getPropertyValue","originalColor","kn","st","vd","handleMouseClick","contains","clickout","bd","ti","_target","_collapsed","collapseTarget","expandTarget","toggle","click","Kr","_title","oi","Cd","es","open","dialog","disableClose","componentInstance","confirmMessage","afterClosed","Ha","J","Va","isDragging","close","Do","preventDefault","Gr","Qr","touchDelayMs","vo","longTouch$$","onContextMenu","touchmove$$","touchend$$","TouchEvent","touches","clientX","clientY","menuPosition","overlayRef","overlay","position","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","positionStrategy","scrollStrategy","scrollStrategies","attach","lp","menuContext","viewContainerRef","$implicit","sub","Po","overlayElement","tt","elementRef","dispose","Wa","ts","Q","wd","setTarget","componentRef","createComponent","componentFactory","updateInputs","inputs","updateSubscribers","subscribers","unobserveAllInputs","instance","propName","unobserveInput","observeInput","setInputValue","onUpdateInputs","getPrototypeOf","getOwnPropertyDescriptor","outputs","subscriptions","inputs$$","os","resolver","resolveComponentFactory","Xa","$n","component","dynamicComponent","dynamicComponentService","renderComponent","is","ns","rs","ss","buttons","children","formData","setData","onSubmit","submitForm","getData","groups","fields","form","updateDataWithFormField","control","setValue","reset","$d","f","as","formBuilder","group","addControl","getValidators","validator","setValidators","field","extendFieldConfig","getValidator","ls","getFieldByType","qd","getFieldComponent","formFieldService","getFieldInputs","fieldInputs","fieldOptions","errors","placeholder","disableSwitch","formControl","required","getFieldSubscribers","fieldSubscribers","cs","Z","re","getFieldColSpan","cols","getFieldNgClass","getErrorMessage","tl","Ni","us","Jn","ps","ds","ji","ko","Vd","ol","jsonURL","getPathToConfigFile","loadConfigTour","getJSON","allToursOptions","getTourOptionData","gs","isAppHaveTour","interactiveTourLoader","isToolHaveTourConfig","disabledTourButton","conditions","_step3","isTourDisplayInMobile","getButtons","classes","getAction","addProgress","setInterval","getCurrentStep","attachTo","element","cancel","clearInterval","getElement","querySelectorAll","classList","add","steps","className","innerText","insertBefore","checkNext","_setupModal","show","executeAction","condition","executeActionPromise","waitFor","maxWait","getShepherdSteps","on","popperOptions","modifiers","offset","beforeShowPromise","previousStep","beforeChange","beforeShow","noBackButton","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","hide","onHide","startTour","shepherdService","defaultStepOptions","cancelIcon","enabled","modal","confirmCancel","addSteps","tourObject","start","ze","setToolbar","toolbar","initStore","activeTool$$","getTool","getTools","setTools","getToolbar","toolbar$","activateTool","activatePreviousTool","activeToolHistory","deactivateTool","_this$activeToolHisto2","clearActiveToolHistory","setActiveTool","activeTool$","Gi","il","toolbox","tools","nl","getClass","styleButton","toolService","getTourToStart","tourToStart","activeToolName","isActiveTool","isToolHaveTour","interactiveTourService","startInteractiveTour","rl","qo","ii","wt","_color","_focused","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","_disabled","beforeDisable","beforeEnable","toggleDisabledClass","disable","enable","getOffsetTop","offsetTop","focused","focusedCls","disabledCls","ao","_navigation","_selection","_selectedItem","focusedItem","_focusedItem","handleKeyboardEvent","navigationEnabled","navigate","enableNavigation","ngAfterViewInit","listItems","init","listItems$$","changes","focusNext","toArray","getFocusedIndex","isScrolledIntoView","offsetHeight","focusPrevious","selectedItem","navigation","disableNavigation","scrollToItem","findSelectedItem","findFocusedItem","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","findIndex","Ro","vt","_withHeader","ct","Bn","shown$","shown","hg","counter$$","spinner","Un","ja","_filterChange","connect","_database","jr","dataChange","_sort","sortChange","getFilteredData","getSortedData","disconnect","_model","filterable","Hr","Qi","Pg","_hasFIlterInput","sl","database","model","displayedColumns","displayed","unshift","actions","changed","getActionColor","isAllSelected","masterToggle","handleClickAction","kg","up","ni","White","se","Jg","Jo","Grey","Primary","toolbar$$","onToolbarChange","onActiveToolChange","actionStore","onAnimationStart","animating$","onAnimationComplete","getToolInputs","animate","onAnimate","animation$","d","parent","unAnimate","animating$$","$g","changeDetection","Bg","Ug","al","onCancel","onComplete","destroyWidget","getEffectiveSubscribers","baseSubscribers","widget","hs","fs","ll","cl","getWorkspaceTitle","onSelectedChange","activateWorkspace","jg","Qg","workspace","widget$","widgetInputs$","widgetSubscribers$","onWidgetCancel","deactivateWidget","onWidgetComplete","Yg","zg","activeWorkspace$","deactivateWorkspace","ul","entityStore","change","activateWidget","Xg","z","Kg","tm","idsActivity","om","_s","production","igo","projections","code","alias","def","extent","auth","intern","allowAnonymous","interactiveTour","tourInMobile","importExport","catalog","sources","queryFormat","queryHtmlTarget","regFilters","tooltipType","searchSources","nominatim","icherche","searchUrl","order","params","limit","coordinatesreverse","showInPointerSummary","icherchereverse","ilayer","nm","configLanguage","rm","default","am","changeLanguage","lm","um","pm","gm","mm","fm","callHttp","callHttpError","_m","bm","added$","xm","ys","Cm","Tm","toggleComponent","wm","Am","description","image","Lm","Im","getTitle","Om","km","choices","formService","valueChanges$$","valueChanges","submitDisabled","valid","form$","fillForm","data$","clearForm","$m","qm","sortable","showName","Hg","handleSelect","Rm","ri","Me","si","Nm","activateSalutationTool","jm","Gm","Ym","widgetService","zm","vs","tokenKey","decode","Vm","isExpired","getTime","exp","Pe","authenticate$","authenticated","logged$","login","username","password","encodePassword","loginCall","loginWithToken","token","typeConnection","infosUser","loginAnonymous","anonymous","post","tokenService","logout","isAuthenticated","getToken","decodeToken","goToRedirectUrl","router","redirectUrl","loginRoute","navigateByUrl","homeRoute","getUserInfo","getProfils","updateUser","patch","isAnonymous","user","isAdmin","locale","Xm","apiKey","clientId","loadSDKGoogle","loadPlatform","warn","handleSignInClick","gapi","auth2","getAuthInstance","signIn","handleSignOutClick","signOut","handleClientLoad","initClient","client","discoveryDocs","then","updateTextButton","isSignedIn","listen","updateSigninStatus","loginGoogle","access_token","authService","appRef","tick","getElementsByTagName","src","onload","parentNode","Km","msalService","Nn","cache","cacheLocation","broadcastService","Ot","inProgress$","ai","_destroying$","checkAccount","loginMicrosoft","loginPopup","getConf","authRequest","setActiveAccount","account","acquireTokenSilent","accessToken","tokenId","idToken","pl","acquireTokenPopup","msalGuardConfig","bs","location","redirectHash","initializeWrapperLibrary","Wt","acquireTokenRedirect","handleRedirectObservable","handleRedirectPromise","loginRedirect","logoutRedirect","logoutPopup","ssoSilent","getLogger","logger","setLogger","eh","_msalSubject","msalSubject$","asObservable","_inProgress","msalInstance","addEventCallback","Wm","verbose","eventType","th","browserAuthOptions","loginMicrosoftb2c","oh","appId","loadSDKFacebook","subscribeEvents","FB","Event","statusChangeCallback","loginFacebook","authResponse","getElementById","rh","_allowAnonymous","loginUser","loading","xs","backgroundDisable","isLogoutRoute","_backgroundDisable","hasAlreadyConnectedDiv","_hasAlreadyConnectedDiv","hasLogoutDiv","_hasLogoutDiv","showAlreadyConnectedDiv","_showAlreadyConnectedDiv","showLogoutDiv","_showLogoutDiv","showLoginDiv","analyzeRoute","getName","onLogin","logoutRoute","home","firstName","sourceId","events","isLoginRoute","Cs","hostname","handleHostsWithCredentials","withCredentials","refreshToken","href","host","trustHosts","Xt","interceptXhr","setRequestHeader","hostsWithCredentials","_step5","RegExp","domainRegFilters","test","refreshInProgress","redirectUri","authority","interactionType","scopes","loginHint","yh","bh","_h","vh","xh","preference","_i3","mergePreference","_i4","Ss","dl","Th","wh","af","extern","gi","_layer","openMetadata","metadataService","pf","layerTitle","layer","abstract","jo","W","Y","handleLoadStart","handleLoadEnd","handleLoadError","un","__watchers__","loaded","params_","LAYERS","Di","Ve","OPACITY","Dt","TITLE","wms","gf","wmts","mf","xyz","hf","feature","ff","wfs","_f","arcgisrest","Ds","imagearcgisrest","tilearcgisrest","osm","tiledebug","Ps","Co","featureTypes","origin","generateId","createOlSource","getLegend","legend","setLegend","Ie","BasicNumericOperator","O","BBOX","moment","Ki","PropertyIsEqualTo","spatial","fieldRestrict","PropertyIsNotEqualTo","PropertyIsLike","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsBetween","During","PropertyIsNull","Intersects","Within","Contains","defineOgcFiltersDefaultOptions","editable","geometryName","advancedOgcFilters","pushButtons","checkboxes","radioButtons","buildFilter","ot","getCode","checkIgoFiltersProperties","srsName","featureNS","featurePrefix","bundleFilter","outputFormat","Uo","writeGetFeature","XMLSerializer","serializeToString","createFilter","operator","logical","logicalArray","D","propertyName","pattern","matchCase","wildCard","singleChar","escapeChar","lowerBoundary","upperBoundary","_","C","wkt_geometry","T","w","parseFilterOptionDate","begin","minDate","M","end","maxDate","E","expression","olFormatWKT","readGeometry","dataProjection","featureProjection","And","Or","Not","defineInterfaceFilterSequence","filterSequence","addInterfaceFilter","computeAllowedOperators","allowedOperatorsType","Spatial","BasicAndSpatial","operators","Basic","Time","filterid","step","sliderOptions","igoSpatialSelector","igoSNRC","geometry","parentLogical","level","addFilterProperties","rebuiltIgoOgcFilterObjectFromSequence","computeIgoSelector","computedSelectors","bundles","includes","selectorType","handleOgcFiltersAppliedValue","ogcFilters","_step6","formatGroupAndFilter","_step7","_step8","verifyMultipleEnableds","_iterator8","_step9","_iterator9","formatProcessedOgcFilter","multiple","isValid","Le","GML2","kt","Nt","IFRAME","Zl","mi","ks","Ol","paramsWFS","$s","Mt","xmlFilter","download","dynamicUrl","urlWfs","maxFeatures","R","sourceFields","Qe","Be","fieldNameGeometry","Ke","he","Fe","OlFormat","formatOptions","gmlFormat","Fs","kh","yl","$h","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","Pl","buildDynamicDownloadUrlFromParamsWFS","wfsService","getSourceFieldsFromWFS","FILTER","setOgcFilters","timeFilterable","timeFilter","setTimeFilter","queryTitle","mapLabel","BLANK","updateParams","igoRefresh","Ih","ratio","ogcFilters$","timeFilter$","scale","projection","contentDependentLegend","VERSION","currentStyle","onUnwatch","Pt","ogcFilterWriter","transferCommonProperties","ogcFilters$$","transferOgcFiltersProperties","timeFilter$$","transferTimeFilterProperties","syncChildLayers","li","layers","linkedLayers","links","properties","VISIBLE","opacity","MINRESOLUTION","minResolution","MAXRESOLUTION","OGCFILTERS","TIMEFILTER","getProperties","linkId","linkedIds","visible$","bidirectionnal","sourceOptions","getSource","viewController","getOlProjection","getParams","jt","TIME","kl","tile","Se","format","getSourceFormatFromOptions","olSourceVector","formatType","zn","pe","Gt","vl","getUrl","abs","round","originalEvent","altKey","Eh","metaKey","ctrlKey","shiftKey","toFixed","isInResolutionsRange$","createOlLayer","zIndex","baseLayer","maxResolution","xt","Number","maxScaleDenom","minScaleDenom","legendOptions","legendCollapsed","getZIndex","setZIndex","setOpacity","updateInResolutionsRange","getMaxResolution","setMaxResolution","getMinResolution","setMinResolution","setVisible","hasBeenVisible$","isInResolutionsRange","showInLayerList","setMap","unobserveResolution","observeResolution","layerSyncWatcher","vf","hasBeenVisible$$","messages","resolution$$","resolution$","getResolution","Te","xf","_assertThisInitialized","browsable","exportable","animation","flash","bind","trackFeature","enableTrackFeature","olLayerVector","customWFSLoader","authInterceptor","customLoader","setLoader","Vi","frameState","getGeometry","time","duration","pi","ColorAsArray","getStyleFunction","getImage","getType","getRadius","setRadius","getStroke","setColor","setWidth","getWidth","getFill","setText","setStyle","drawGeometry","ut","render","stopAnimation","trackFeatureListenerId","centerMapOnFeature","getFeatureById","getView","setCenter","getCoordinates","getId","disableTrackFeature","di","j","Dl","getFeatures","XMLHttpRequest","removeLoadedExtent","onerror","responseText","getFormat","readFeatures","addFeatures","send","Wi","responseXML","DOMParser","parseFromString","response","readProjection","Kn","qh","Rh","Es","strategy","bl","Zf","defineFieldAndValuefromWFS","wfsGetFeature","Gn","getKeys","getGeometryName","built_properties_value","boundedBy","_loop3","getExtent","extentGetWidth","pow","Jh","extentGetTopLeft","resolutions","matrixIds","tileGrid","If","xl","crossOrigin","Bh","items","_i5","cartocss","layer_name","Hn","attributions","overlaps","encodeURIComponent","customParams","olloadingstrategy","legendInfo","parseInt","layerId","_step10","label","renderingRule","Uh","_step11","Nh","_step12","Gh","jh","createWebSocket","_get","ws","WebSocket","onmessage","onMessage","onclose","onClose","onError","onopen","onOpen","readFeature","removeFeature","addFeature","featureClass","Cl","Qh","_converters","esriPMS","Oe","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","_renderers","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","_convertLabelingInfo","labelExpression","symbol","maxScale","minScale","_getResolutionForScale","getText","defaultSymbol","classBreakInfos","classMinValue","minValue","classMaxValue","field1","uniqueValueInfos","generateStyle","drawingInfo","labelingInfo","parseFloat","_transformAngle","angle","q","gt","fill","G","_transformColor","font","weight","family","textBaseline","verticalAlignment","textAlign","horizontalAlignment","offsetX","_convertPointToPixel","xoffset","offsetY","yoffset","rotation","contentType","imageData","ci","outline","_convertOutline","stroke","U","lineDash","width","PI","ve","radius","ui","points","radius2","qe","DATE","ht","CALENDAR","$t","getMap","_i","tr","Dh","Ph","esriJSON","getWMSOptions","getCapabilities","parseWMSOptions","getWMTSOptions","parseWMTSOptions","getCartoOptions","jsonp","mapId","parseCartoOptions","getArcgisOptions","lo","parseArcgisOptions","getImageArcgisOptions","parseTileOrImageArcgisOptions","getTileArcgisOptions","fromObject","request","service","parsers","read","findDataSourceInCapabilities","Capability","Layer","DataURL","Abstract","KeywordList","queryable","getTimeFilter","Style","getStyle","EX_GeographicBoundingBox","mapService","GEOJSON","GEOJSON2","GML3","HTML","Request","GetFeatureInfo","Format","_i6","_layerOptionsFromSource","Title","MaxScaleDenominator","MinScaleDenominator","metadata","OnlineResource","keywordList","stepDate","Contents","Identifier","layer_definition","units","Qn","copyrightText","timeInfo","timeExtent","setTime","toUTCString","range","DATETIME","serviceDescription","displayField","Name","Dimension","stylesAvailable","rn","registerProjection","ml","setExtent","dt","createAsyncDataSource","createOSMDataSource","createFeatureDataSource","createWFSDataSource","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","datasources$","El","Rl","fi","wfsDataSourceService","optionsFromCapabilities","capabilitiesService","optionsService","optionsFromApi","Rs","qs","ql","er","getArcgisRestOptions","Js","Bs","nn","Us","OlFormatGeoJSON","setId","In","startsWith","writeGeometryObject","excludeAttribute","excludeAttributeOffline","idColumn","mapTitle","getRevision","ke","_ke$ap2","Ul","Zoom","zoomToExtent","Move","moveToExtent","getZoom","bindLayer","addLayer","setLayerFeatures","checkLayer","Et","setLayerOlFeatures","setStoreOlFeatures","sn","clearLayer","removeOlFeaturesFromLayer","addOlFeaturesToLayer","qt","watchStore","empty$$","Ut","updateEntitiesInExtent","unwatchStore","unwatchAll","stores$$","states$$","state$","inMapExtent","updateEntitiesInResolution","inMapResolution","setMotion","motion","onFeaturesChange","selectMotion","viewScale","areaRatio","getFeatureId","pristine","onSourceChanges","flatMap","Sl","_overlayStore","createOverlayStore","unselectAll","overlayStore","deactivateSelection","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","removeOverlayLayer","mapClickListener","onMapClick","Xn","getFeaturesAtPixel","pixel","hitTolerance","layerFilter","onSelectFromMap","getInteractions","getArray","_step13","or","addInteraction","olDragSelectInteraction","olDragSelectInteractionEndKey","onDragBoxEnd","removeInteraction","mapBrowserEvent","apply","getFeaturesInExtent","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","createOverlayLayer","ft","removeLayer","uo","At","_ref4","_ref4$opacity","markerColor","_ref4$markerColor","markerOutlineColor","_ref4$markerOutlineCo","imgSize","anchor","overflow","Go","createStyle","parseStyle","vi","getOlCls","getOlKey","Zh","createStyleByAttribute","guessTypeFeature","attribute","baseStyle","getLabel","OlFeature","createClusterStyle","clusterRanges","_step14","minRadius","maxRadius","showRange","dynamicRadius","image_","radiusCalc","matchAll","_ref5","_ref5$strokeWidth","strokeWidth","fillColor","_ref5$fillColor","strokeColor","_ref5$strokeColor","qf","setFeatures","_step15","removeOlFeature","addOlFeatures","addOlFeature","removeFeatures","unwatchLayer","watchLayer","bi","stateHistory","olView","olMap","setOlMap","observerKeys","onMoveEnd","extent$$","extent$","getProjection","getCenter","calculateExtent","getSize","getScale","getUnits","zoomIn","zoomTo","zoomOut","cancelAnimations","zoom","easing","getRotation","resetRotation","hasPreviousState","states","stateIndex","hasNextState","previousState","setStateIndex","nextState","clearStateHistory","setInitialState","sqrt","maxZoomOnExtent","fit","maxZoom","padding","callback","setState","resolution","center","trunc","getOlMap","controls","attribution","layerWatcher","Jf","layers$","olControlAttribution","scaleLine","gl","interactions","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","Mh","Fh","setView","Uf","nr","queryResultsOverlay","searchResultsOverlay","buffer","updateView","constrainResolution","Ah","unsubscribeGeolocate","maxLayerZoomExtent","geolocate","alwaysTracking","updateControls","getControls","removeControl","changeBaseLayer","getBaseLayers","setMinZoom","minZoom","setMaxZoom","getLayerById","getLayerByAlias","getLayerByOlUId","addLayers","doAddLayer","setLayers","removeLayers","handleLinkedLayersDeletion","doRemoveLayer","syncedDelete","removeAllLayers","raiseLayer","getLayerIndex","moveLayer","raiseLayers","_step17","lowerLayer","lowerLayers","_step18","sortLayersByZIndex","geolocation$$","geolocation","getTracking","startGeolocation","geolocation$","getAccuracy","getAccuracyGeometry","geolocationFeature","bufferFeature","He","positionFollower","bufferRadius","getPosition","bufferGeom","olCircle","bufferStroke","bufferFill","showBufferRadius","setZoom","stopGeolocation","setTracking","Lh","trackingOptions","enableHighAccuracy","tracking","onOfflineToggle","offlineButtonToggle$","ge","_view","_controls","activityId","jf","listenToMapPointerMove","unlistenToMapPointerMove","unlistenToMapClick","pointerMoveListener","onPointerEvent","pointerPositionDelay","dragging","lastTimeoutRequest","clearTimeout","coordinate","mapProjection","setTimeout","pointerPositionCoord","df","olLoadingProblem","Hh","setImageLoadFunction","abort","Uint8Array","TextDecoder","Blob","URL","createObjectURL","Vh","wl","setTileLoadFunction","onLoad","Yf","mouseout","subscribeToPointerStore","layers$$","yi","zl","unsubscribeToPointerStore","unlistenToMapSingleClick","store$$","pointerHoverFeatureStore","entitiesToPointerOverlay","addFeatureOverlay","onMapEvent","singleClickMapListener","onMapSingleClickEvent","igoHoverFeatureEnabled","getPixelFromCoordinate","forEachFeatureAtPixel","ol_uid","setLayerStyleFromOptions","igoHoverFeatureDelay","getSameFeatureNeighbour","Yh","hoverFeatureId","hoverSummary","getHoverSummary","styleByAttribute","hoverStyle","styleService","_i7","_Object$entries$_i","getOrientedFlatCoordinates","$e","co","Kt","backgroundFill","backgroundStroke","We","getMinZoom","getMaxZoom","cn","_map","e_","useStaticIcon","_baseLayers","collapseOrExpand","expand","baseLayers","height","be","createLayer","createTileLayer","createVectorLayer","createImageLayer","createVectorTileLayer","createAsyncLayer","dataSourceService","Gf","Qf","clusterBaseStyle","clusterParam","applyMapboxStyle","Yl","mapboxStyle","getMapboxGlStyle","Wh","Xl","Re","_baseLayer","handleBaseLayerChanged","handleMainMapViewChange","basemap","setResolution","setRotation","layerService","handleLinkedBaseLayer","_showIfNoRotation","rotationStyle","Xe","le","catalogService","r_","collectCatalogItems","loadCatalogWMSLayerItems","Ci","s_","loadCatalogWMTSLayerItems","a_","baselayers","loadCatalogBaseLayerItems","l_","loadCatalogArcGISRestItems","Kl","composite","loadCatalogCompositeLayerItems","createInstanceCatalog","c_","Gs","query","queryLayer","getQueryUrl","HTMLGML2","mergeGML","extractData","fl","zh","Tl","getQueryParams","bbox","appendLineString","appendPolygon","coordinates","convexHull","cross","_step19","getAllowedFieldsAndAlias","extractGML3Data","extractGeoJSONData","ESRIJSON","extractEsriJSONData","TEXT","extractTextData","extractHtmlData","extractGML2Data","_step20","createGeometryFromUrlClick","_iterator20","getQueryTitle","sourceTitle","Xi","featureToResult","features","crs","srs","lastIndexOf","Xh","decodeURIComponent","GEOMETRIE","shape","SHAPE","the_geom","geom","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","FEATURE_COUNT","getFeatureInfoUrl","sql","queryPrecision","getLabelMatch","rr","tc","cancelOngoingQueries","queryService","queryEnabled","queryFeatures","doQueryFeatures","waitForAllQueries","queries$$","jn","_ref7","values_","_step21","nom","id_","_icon","Kh","getEnds","getFlatCoordinates","Ms","queryFeaturesHitTolerance","queryFeaturesCondition","u_","forEachFeatureIntersectingExtent","_step22","nt","storageService","getDefaultOptions","settings","setParamFromSetting","available","showInSettings","getHashtagsValid","getSettingsValues","normalize","hashtags","oc","getGoogleMapsCoordLink","encodeURI","getOpenStreetMapLink","Ys","loadCatalogs","Bo","loadCatalogItems","ec","getCatalogBaseLayersOptions","externalProvider","Group","getCatalogCapabilities","Service","flattenWmsCapabilities","groupSeparator","includeRecursiveItems","_step23","getWMTSItems","getArcGISRESTItems","sortDirection","groupImpose","address","_ref8","xe","_ref9","prepareCatalogItemLayer","retrieveLayerInfoFormat","showLegend","setCrossOriginAnonymous","forcedProperties","_step24","layerName","prepareCatalogItemGroup","testLayerRegexes","_step25","findCatalogInfoFormat","ServiceIdentification","_step26","matrixSet","requestEncoding","_step27","zs","catalogAllowLegend","isGroup","isLayer","onLayerAddedChange","addLayerToMap","removeLayerFromMap","onGroupAddedChange","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","sortCatalogItemsByTitle","dn","styles","listStyles","STYLES","updateLegendOnResolutionChange","onViewControllerStateChange","legendItems$","_step28","getLegendGraphic","legendGraphic","toggleLegendItem","transfertToggleLegendItem","computeItemTitle","updateLegend","_step29","onChangeStyle","onLoadImage","renderedLegends","first","imagesHeight","ic","isPreview$$","isPreview$","addedLayerIsPreview","computeTitleTooltip","ABSTRACT","CUSTOM","onMouseEvent","onToggleClick","askForLegend","layerLegendShown$","igoLayer$","mouseInsideAdd","addedChange","haveGroup","inRange$","computeTooltip","J_","evaluateAdded","evaluateDisabled","onToggleCollapsed","layerAddedChange","tryToggleGroup","onLayerPreview","preview$","toggleCollapsed","onTitleClick","B_","rc","_activeLayer","selectionMode","layerTool$","_selectAll","layerCheck","expandLegendIfVisible","firstLoadComponent","toggleLegend","updateQueryBadge","onResolutionChange","tooltipText","network$$","networkService","showLegend$","toggleLegendOnClick","toggleVisibility","toggleLegendOnVisibilityChange","inResolutionRange$","queryBadge","queryBadgeHidden$","toggleLayerTool","check","checkbox","Ne","always","To","ALL_VISIBLE","Si","Raise","Qo","_layers","removeProblemLayerInList","activeLayer$","_keyword","_onlyVisible","_sortedAlpha","orderable","activeLayer","getUpperLayer","isUpperBaselayer","getLowerLayer","isLowerBaselayer","layersChecked","raisableLayers","selectAllCheck","lowerDisabledSelection","lowerableLayers","checkOpacity","layersCheckedOpacity","change$$","zi","Yi","showToolbar$","computeShowToolbar","computeLayers","appliedFilterAndSort","keyword","sortAlpha","onlyVisible","selectAllCheck$$","selectAllCheck$","_step31","_iterator31","layerTool","excludeBaseLayers","activeLayerIsValid","activeLayersAreValid","_step32","zoomLayerExtents","zoomLayersExtents","_step33","changeOpacity","clearKeyword","moveActiveLayer","getLinkedLayers","Lower","ZINDEX","_loop6","raisableLayer","_iterator35","_step35","_loop7","computeElementRef","offsetParent","_loop8","lowerableLayer","_iterator37","_step37","_loop9","filterLayers","sortLayersByTitle","sortLayersByZindex","onKeywordChange","onAppliedFilterAndSortChange","layerFilterAndSortOptions","showToolbar","never","thresholdToFilterAndSort","toggleOpacity","_step39","removable","hideSelectedLayers","layerItemChangeDetection$","isLayerRemovable","isAllLayersRemovable","NULL","MIXED","_step41","ALL_HIDDEN","layersCheck","_step42","_iterator42","toggleSelectionMode","_step43","_step44","_iterator44","selectAll","_step46","getElementsByClassName","_step47","cy","onlyVisible$","sortAlpha$","term$","term$$","onlyVisible$$","term","sortAlpha$$","clearTerm","toggleSortAlpha","toggleOnlyVisible","sr","layersOrResolutionChange$$","setLayersVisibilityStatus","layersVisibility$$","Boolean","layersAreAllVisible","gn","computeShownLayers","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","showAllLegendsValue","toggleShowAllLegends","allLegendsShown","ar","toggleTrackFeature","ac","Yo","pt","it","No","lc","wy","predefinedCatalogs","addedCatalog","defaultAddedCatalogType","typeCapabilities","addedCatalogType$$","updateValueAndValidity","computePredefinedCatalogList","storeViewAll$$","emailAddress","changeUrl","patchValue","predefinedCatalogsList$","addCatalog","dialogRef","Hs","getCatalogs","onCatalogSelect","catalogSelectChange","unsubscribeAddingCatalog","addingCatalog$$","addCatalogDialog","mapName","ServiceType","addedCatalogs","onCatalogRemove","Iy","removeCatalogFromLibrary","catalogRemove","cc","bt","uc","pc","isTimeFilterable","isOgcFilterable","dc","filterByDate","reformatDateTime","filterByYear","getFullYear","getMonth","getUTCDate","getUTCHours","getUTCMinutes","Vs","filterByOgc","setOgcWFSFiltersOptions","interfaceOgcFilters","setOgcWMSFiltersOptions","filtered","me","Predefined","lt","Address","mn","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","routes","baseUrl","getKeyByValue","loadFilterList","urlFilterList","loadThematicsList","loadFilterItem","bufferInput","simplified","loc","loadItemById","loadBufferGeometry","bufferOutput","gc","outputFormatDownload","Py","openDownload","downloadService","lr","zo","unsubscribe$","_source","_feature","selectFeature","ready","urlSanitizer","sanitizer","bypassSecurityTrustResourceUrl","isHtmlDisplay","htmlDisplayEvent","htmlSanitizer","filterFeatureProperties","Route","cr","Point","olDrawingLayer","drawingLayer","createOlInnerOverlayLayer","olGeometryType","geometryType","olDrawingLayerSource","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","setGeometryType","Hi","drawingLayerSource","eo","drawingLayerStyle","freehand$","Vn","maxPoints","freehand","stopClick","interactionStyle","freehandCondition","olDrawInteraction","onDrawStartKey","onDrawStart","onDrawEndKey","onDrawEnd","Al","olModifyInteraction","olSelectInteraction","Ts","Zs","onSelect","unsubscribeKeyDown","onDrawKey","start$","mousePosition","ea","changes$","subscribeKeyDown","modify$","end$","select$","keyDown$$","removeLastPoint","finishDrawing","abortDrawing","ev","noLabel","tv","Lt","Length","K","Meters","ta","Kilometers","Miles","Feet","Je","SquareMeters","fc","SquareKilometers","SquareMiles","SquareFeet","Hectares","Acres","ov","nv","iv","rv","sv","av","lv","cv","decimal","toLocaleString","minimumFractionDigits","maximumFractionDigits","unit","unitAbbr","olGetLength","_c","olGetArea","area","lengths","yc","getCoordinateAt","setCoordinates","Yn","vc","removeOverlay","Ll","stopEvent","setPosition","Olstyle","vv","getFillColor","setFillColor","getStrokeColor","setStrokeColor","getStrokeWidth","getLabelsAreShown","labelsAreShown","toggleLabelsAreShown","setIcon","getIcon","createDrawingLayerStyle","flatCoordinates","OlStyle","cos","bv","getIconsList","getIcons","icons","getPath","Sc","draw","buildForm","drawStyleService","drawIconService","drawControl","createDrawControl","subscriptions$$","hn","yv","onGeometryTypeChange","toggleDrawControl","ir","Gl","many","clearLabelsOfOlGeometry","selectedFeatures$","onColorChange","strokeForm","onToggleDrawControl","deactivateDrawControl","activateDrawControl","openDialog","updateLabelOfOlGeometry","onSelectDraw","drawControlIsDisabled","drawControlIsActive","drawEnd$$","onModifyDraw","drawSelect$$","addFeatureToStore","replaceFeatureInStore","rad","Is","longitude","latitude","deleteDrawings","ra","onToggleLabels","setProperties","_label","onIconChange","openShorcutsDialog","Tc","Ee","Ml","sa","Mv","po","modify","olOverlayLayer","olLinearRingsLayer","createOlLinearRingsLayer","olOverlaySource","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","setOlGeometry","olFeature","layerStyle","hc","addOlLinearRingsLayer","removeOlLinearRingsLayer","clearOlLinearRingsSource","olLinearRingsSource","drawStyle","deactivateModifyInteraction","olModifyInteractionIsActive","onModifyStartKey","onModifyStart","onModifyEndKey","onModifyEnd","onModifyKey","item","subscribeToKeyDown","unsubscribeToKeyDown","hl","olTranslateInteraction","deactivateTranslateInteraction","olTranslateInteractionIsActive","onTranslateStartKey","onTranslateStart","onTranslateEndKey","onTranslateEnd","onTranslateKey","olOuterGeometry","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","drawKeyDown$$","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","drawKeyUp$$","unsubscribeToDrawKeyUp","deactivateDrawInteraction","olDrawInteractionIsActive","removedOlInteractions","getLinearRing","addLinearRingToOlGeometry","updateLinearRingOfOlGeometry","appendLinearRing","ef","getLinearRings","yn","Ac","onNoClick","aa","activeLengthUnit","_n","fn","measure","activeAreaUnit","ur","_activeMeasureType","setActiveMeasureType","activeDrawControl","createDrawLineControl","createDrawPolygonControl","createModifyControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","onMeasureTypeChange","activeMeasureType","onToggleMeasureUnitsAuto","measureUnitsAuto","onToggleDisplayDistance","displayDistance","onDisplayDistance","onToggleDisplayLines","displayLines","onDisplayLines","onToggleDisplayAreas","displayAreas","onDisplayAreas","onLengthUnitChange","table","activeOlGeometry","updateTooltipsOfOlGeometry","onAreaUnitChange","onCalculateClick","perimeter","onDeleteClick","olDrawSource","onModifyClick","modifyControl","activateModifyControl","clearTooltipsOfOlGeometry","onFeatureAddedKey","updateMeasureOfOlGeometry","onFeatureRemovedKey","selectedFeatures$$","hasArea$","drawLineControl","oa","drawPolygonControl","Mc","Area","drawStart$$","drawChanges$$","onDrawChanges","clearTooltipsOfOlSource","clearMeasures","finalizeMeasureOfOlGeometry","ia","measure$","modifyStart$$","modifyEnd$$","modifyChanges$$","onModifyChanges","_measure","na","xc","updateOlTooltip","olGetCenter","showTooltipsOfOlGeometry","shouldShowTooltip","addOverlay","forEachFeature","showTooltipsOfOlSource","_unit","_type","computeTooltipInnerHTML","showTooltips","minSegmentLength","Lc","Fc","createMeasureTooltip","ngControl","toggleControl","_geometryType","deactivateControl","freehandDrawIsActive","_drawControlIsActive","_freehandDrawIsActive","_drawStyle","mc","getGuideStyleFromDrawStyle","defaultDrawStyleRadius","_overlayStyle","_value","addGeoJSONToOverlay","onChange","features_","overlayStyle","addOlOverlayLayer","registerOnChange","registerOnTouched","onTouched","writeValue","controlOptions","updateDrawStyleWithDrawGuide","activeControl","activateControl","olGeometryEnds$$","onOlGeometryEnds","olGeometryChanges$$","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","olGeoJSON","olTooltip","drawGuide","isStyleWithRadius","Zc","la","vn","Yv","dateAdapter","setLocale","YEAR","isNaN","valueOf","startDate","endDate","SLIDER","getStepDefinition","timeInterval","getTimezoneOffset","startYear","initStartYear","endYear","initEndYear","isRange","startListYears","endListYears","listYears","checkFilterValue","yearChange","year","storeCurrentFilterValue","handleDateChange","setupDateOutput","applyTypeChange","handleYearChange","handleListYearChange","handleListYearStartChange","dateToNumber","setSliderThumbLabel","findThumbLabel","mySlider","_elementRef","childNodes","textContent","toggleFilterState","stopFilter","resetFilter","date","playFilter","interval","playIcon","playYear","handleSliderDateChange","handleSliderTooltip","handleSliderYearChange","handleSliderValue","current","getRoundedDate","toDateString","toTimeString","setSeconds","setHours","setMinutes","getDay","getHours","getMinutes","getRangeMinDate","getRangeMaxDate","asMilliseconds","pr","timeFilterService","datasource","filtersCollapsed","toggleFiltersCollapsed","dr","t1","wktToFeature","extentToWkt","roundCoordinateArray","wktPoly","wktLine","wktMultiPoints","roundArray","snrcToWkt","Ce","io","wo","ho","no","Mn","Zi","An","Ii","Vo","Oi","V","Ic","allOgcFilterOperators","ogcFilterOperators$","igoSpatialSelectors","_snrc","currentFilter","allowedOperators","fields$","excludeFromOgcFilters","updateFieldsList","selectedField$","updateValuesList","currentFilterIsSpatial","filteredFields$","_filterFields","changeField","filteredValues$","_filterValues","changeProperty","clearSelectedField","clearProperty","isClearable","detectProperty","checked","refreshFilters","deleteFilter","changeLogical","changeOperator","currentFilterIsSpatial$","changeSpatialSelector","changeCaseSensitive","changeNumericProperty","changeMapExtentGeometry","changeSNRC","snrc","changeSNRCGeometry","wktService","isTemporalOperator","ogcFilterOperator","Oc","bn","hasSelector","ogcFilterService","lastRunOgcFilter","hasActiveSpatialFilter","filtersAreEditable","addFilterToSequence","defaultLogicalParent","isAdvancedOgcFilters","addFilterDisabled","changeOgcFiltersAdvancedOgcFilters","changeOgcFilterType","gr","xn","ca","stepMillisecond","defaultStepMillisecond","stepIsYearDuration","years","months","weeks","days","hours","minutes","stepIsMonthDuration","stepIsWeekDuration","stepIsDayDuration","stepIsHourDuration","stepIsMinuteDuration","go","addStep","toDate","subtractStep","subtract","Dc","_currentFilter","fe","pushButtonsGroup","checkboxesGroup","radioButtonsGroup","selectGroup","enabled$","applyFiltersTimeout","currentSelectGroup","applyFilters","enableds$","getPushButtonsGroups","getCheckboxesGroups","getRadioButtonsGroups","getSelectGroups","currentPushButtonsGroup","currentCheckboxesGroup","currentRadioButtonsGroup","getSelectEnabled","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","enableds","getToolTip","getButtonColor","bundleIsVertical","vertical","emptyRadioButtons","emptySelect","toggleAllSelection","sel","allSelected","deselect","optionClick","_i8","isMoreResults","radioButtonsIndex","checkboxesIndex","displayMoreResults","isLessResults","baseIndex","displayLessResults","ua","spatialType","Polygon","_store","selectedTypeIndex","activeDrawType","onTypeChange","onDrawTypeChange","eventQueryType","selectedQueryType","zoneChange","Fb","_queryType","_zone","zoneWithBuffer","bufferFormControl","formValueChanges$$","bufferValueChanges$$","measureUnit","bufferChange","spatialFilterService","selectedZone","queryType","zoneWithBufferChange","displayFn","onZoneChange","onMeasureUnitChange","measureUnitChange","pa","Thematics","tf","xo","geometryTypes","drawGuide$","drawStyle$","radiusFormControl","PointStyle","olStyle","PolyStyle","overlayStyle$","_thematicLength","_step50","childrens","thematics","_step51","value$","value$$","drawZone","drawZoneEvent","radiusChanges$$","bufferChanges$$","bufferEvent","detach","onItemTypeChange","selectedItemType","itemTypeChange","isPolygon","isPoint","isPredefined","hasChild","treeControl","isExpanded","collapse","selectedThematics","hasChildrenSelected","_step52","thematicChange","childrensToggle","_step53","onToggleChange","_step54","onDrawControlChange","onfreehandControlChange","freehandControl","toggleSearchButton","radiusEvent","toggleSearch","thematicLength","openWorkspace","clearButton","clearButtonEvent","clearDrawZone","clearSearch","clearSearchEvent","disableSearchButton","zone","disabledClearSearch","da","_beginValue","_endValue","sliderInterval","_defaultMax","displayFormat","_defaultDisplayFormat","_defaultSliderModeEnabled","beginValue","parseFilter","handleMin","endValue","handleMax","updateHoursMinutesArray","updateValues","search","endOf","changeTemporalProperty","getDateTime","calendarType","sliderMode","restrictedToStep","ogcFilterTimeService","stepMilliseconds","toISOString","pos","refreshFilter","handleDate","yearSelected","monthSelected","calendarView","dateFilter","diff","te","asYears","asMonths","asWeeks","asDays","asHours","beginHourFormControl","beginMinuteFormControl","endHourFormControl","endMinuteFormControl","handleMinuteIncrement","handleHourIncrement","fullBeginHoursArray","beginHours","fullEndHoursArray","endHours","fullBeginMinutesArray","beginMinutes","fullEndMinutesArray","endMinutes","restrictToStep","_defaultMin","changePropertyByPass","modeChange","_t","lx","sliderDisplayWith","_defaultSliderInterval","calculateStep","handleSliderInput","beginMillisecond","slider","calculatedStep","_increment","_emitInputEvent","startOf","maxMillisecond","mo","N","at","mt","Wn","en","setPrototypeOf","ma","prototype","Pc","mr","ie","Ht","Qt","ha","ogreUrl","aggregateInComment","export","generateFeature","exportAsync","GPX","generateAggregatedFeature","nothingToExport","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","setAttribute","writeFeatures","featureType","UTF8","acceptCharset","enctype","LATIN1","submit","GML","KML","Shapefile","CSVcomma","CSVsemicolon","fa","getStyleList","distance","mimeType","Ti","fr","Ho","_r","_a","Ec","clientSideFileSizeMax","import","importAsync","getFileImporter","$c","allowedMimeTypes","allowedZipMimeTypes","allowedExtensions","importFile","importFileWithOgre","xx","parseFeaturesFromFile","readAsText","FormData","append","parseFeaturesFromGeoJSON","msg","startWith","Cx","Ls","_l","As","writeFeatureObject","yr","styleList","qc","loadConfig","computeProjections","_projectionsLimitations","importForm","inputProj","exportableLayers$","fileSizeMb","exportOptions$$","exportOptions$","computeFormats","formLayer$$","popupChecked","handlePopup","handlePreviousLayerSpecs","formats$","loading$","previousLayerSpecs$","formats$$","encodings$$","encodings$","encoding","exportableLayers$$","controlFormat","selectFirstProj","projections$","translateKey","projectionsConstraints","mtmZone","utmZone","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","projectionsLimitations","getWorkspaceByLayerId","getLayerTitleById","layerHasSelectedFeatures","onlySelected","layersWithSelection","onlySelectedClick","inLayersIdToExportSelectionOnly","exportOptionsChange","importFiles","espgCodeRegex","importService","onFileImportSuccess","onFileImportError","closed","onPopupBlockedError","popupAllowed","handleExportFormSubmit","featureInMapExtent","setGeometry","exportService","onFileExportError","onFileExportSuccess","olPoint","forceNaming","hr","styleListService","hx","_x","fx","vx","bx","extraMessage","loadEncodings","encodingDefaultValue","onlyUrl","onlyVector","vectorAndUrl","customList","allowedFormats","formats","validateListFormat","GeoJSON","modeChanged","selectMode","onImportExportChange","selectedMode","Rc","Bc","Jc","Nx","vr","je","Qx","_auto","toggleAutoUnit","measureType","measure$$","computeBestMeasureUnit","Uc","Nc","Cn","ya","features$","Yx","olFormatGeoJSON","features$$","overlayService","handleFeatures","br","zx","print","paperFormat","orientation","nf","internal","getTitleSize","addTitle","subtitle","getSubTitleSize","addSubTitle","showProjection","showScale","addProjScale","comment","addComment","addMap","_context3","addScale","handleMeasureLayer","legendPosition","addLegendSamePage","addLegend","saveDoc","getOverlayContainer","tn","backgroundColor","addCanvas","getLayersLegendHtml","_step56","_step57","getDataImage","rxMap","getLayersLegendImage","toPromise","top","timeout","useCORS","generateCanvaFileToZip","saveCanvasImageAsFile","setFont","getTextWidth","getStringUnitWidth","scaleFactor","setFontSize","$l","addPage","toDataURL","addImage","getOverlayContainerStopEvent","_i9","allowTaint","defineNbFileToProcess","nbFileToProcess","getImageSizeToFitPdf","rect","once","getViewport","_step58","renderMap","_step59","downloadMapImage","getContext","measureText","ceil","fillStyle","fillRect","fillText","drawImage","getWorldFileInformation","addFileToZip","Os","saveFileProcessing","renderSync","updateSize","save","returnPromise","getHeight","msSaveBlob","msToBlob","toBlob","zipFile","sf","file","getZipFile","generateAsync","jc","Gc","Qc","Yc","zc","Hc","t0","imageFormat","doZipFile","isPrintService","imageFormatField","Jpeg","onlySelf","outputFormatField","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","none","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","handleFormSubmit","toggleImageSaveProp","Vc","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","printService","va","Sn","o0","xa","Wc","directionsSourceService","routeSource","reverseSearch","Kc","getSources","getEnabledSources","enableSourcesByType","Mi","termIsValid","Pr","ka","OM","ju","Gu","DM","kr","toLocaleUpperCase","trim","Mo","So","_j$vs","_j$vs2","_j$vs3","_j$vs4","lonLat","conf","forceNA","PM","iF","getEnabledOnly","searchSourceService","searchType","Tn","Ca","Xc","reverseSearchSources","xr","getStopsCoordinates","stops","stopCoordinates","setStops","getStops","Sa","_activeRoute","activeRoute$","activeRouteDescription","directionsToText","_stopsStore","stopsStore$","_routeFromFeatureDetail","changeRoute","showRouteGeometry","prevent","focusOnStop","browserLanguage","stopsForm","directionsType","directionsMode","stopOrderPriority","directionsFixedStartEnd","array","createStop","initStores","initOlInteraction","subscribeToFormChange","routesQueries$$","stream$","debounce","handleTermChanged","routeFromFeatureDetail","directionsFormService","resetForm","stopsStore","_step60","_step61","_iterator61","handleLocationProposals","chooseProposal","writeStopsToFormService","directionsService","routesResults","activeRoute","changeDetectorRefs","unsubscribeRoutesQueries","unlistenSingleClick","freezeStores","eu","routeStore","selectStop","translateStop","getLength","executeTranslation","selectedRoute","addStop","addStopOverlay","stopProposals","overview","alternatives","getRoutes","stopPoint","searchService","results","directionsText","raiseStop","moveStop","lowerStop","removeStop","getStopOverlayID","deleteStoreFeatureByID","removeAt","formatStep","formatInstruction","maneuver","modifier","bearing_after","exit","translateBearing","translateModifier","instruction","cssClass","formatDistance","formatDuration","showSegment","showRouteSegmentGeometry","zoomRoute","focusKey","copyLinkToClipboard","copyDirectionsToClipboard","search$$","currentStopIndex","setTerm","keyIsValid","invalidKeys","keyup","handleMapClick","clearStop","getFirstCoordinate","getInteriorPoint","getInteriorPoints","geolocateStop","stopText","stopColor","stopOpacity","hi","pathname","Ta","r0","ba","Yt","Cr","formatResult","encodeKey","encodeValue","decodeKey","decodeValue","tu","title$","getAllowedTypes","ecmax","computeRequestParams","page","extractResults","hashtagsLieuxToKeep","computeOptionsParam","computeTerm","_o$extent","encoder","w0","formatter","dataToResult","computeProperties","dataType","titleHtml","highlight","title2","title3","score","wi","nextPage","propertiesBlacklist","GoogleMaps","Rt","Fl","getGoogleMapsNameLink","municipalite","GoogleStreetView","getGoogleStreetViewLink","ou","getSubtitle","computeExtent","iu","nu","coord","igo2CoordFormat","writeGeometry","OpenStreetMap","p_","Sr","_slicedToArray","_l12","ru","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","metadataUrl","urls","_i10","su","B0","searchType$","setSearchType","searchType$$","onSetSearchType","onSearchTypeChange","getSearchTypeTitle","searchTypeChange","wa","K0","now","pointerSummaryEnabled","pointerSummaryStatus","hasPointerReverseSearchSource","hasReverseSearchSourcesForPointerSummary","getSearchSources","computeSourcesCheckAllBehavior","settingsValueCheckedCheckbox","searchSourceChange","computeSettingCheckAllBehavior","allEnabled","searchSourcesAllEnabled","checkUncheckAll","checkUncheckAllSources","settingsValueCheckedRadioButton","onCheckSearchSource","getAvailableValues","getAvailableHashtagsValues","changePointerReverseSearch","changeSearchResultsGeometry","searchResultsGeometryEnabled","searchResultsGeometryStatus","Ma","Aa","stream$$","onSetTerm","handlePlaceholder","onKeyup","onClearButtonClick","clearFeature","onSearchSettingsChange","doSearch","searchSettingsChange","minLength","input","searchTermChange","placeholder$","researches$$","termSplitter","onResearchCompleted","research","au","mC","titleHtmlProperty","onZoomHandler","resultFocus","resultUnfocus","wn","Grouped","cu","_term","pageIterator","_results$","liftResults","settingsChange$$","settingsChange$","computeGroupTitle","onResultSelect","resultSelect","groupResults","sortByOrder","displayOrder","Bt","moreResults","uu","layersSubcriptions","pu","MC","AC","ngAfterContentChecked","unsubscribeReverseSearch","pointerSearchStore","computeSummaryClosestFeature","addPointerOverlay","reverseSearch$$","igoSearchPointerSummaryEnabled","onSearchCoordinate","igoSearchPointerSummaryDelay","onSearch","_loop13","searchPointerSummaryFeatureId","pointerSummary","Tr","S0","M0","O0","$0","IC","du","gu","mu","createWorkspace","srcId","workspaceId","La","createFeatureStore","tableTemplate","createTableTemplate","js","an","Ns","ei","zoomAuto","createFilterInMapExtentOrResolutionStrategy","hu","_u","fu","PC","onLayersChange","layerIsEditable","getOrCreateWorkspace","workspaceStore","wfsWorkspaceService","wmsWorkspaceService","featureWorkspaceService","yu","vu","bu","OC","wr","Mr","$C","directionsUrl","_name","getRouteParams","extractRoutesData","formatRoute","waypoints","geometries","legs","summary","sourceType","weight_name","xu","endsWith","numero","epsg","computeGeometry","NoLot","Cu","place_id","display_name","osm_type","class","lon","lat","boundingbox","computeTermTags","computeTermSettings","Su","storedQueriesOptions","storedquery_id","defaultValue","splitPrefix","outputformat","srsname","resultTitle","multipleFieldsQuery","extractWFSData","getFormatFromOptions","_toConsumableArray","Tu","longField","latField","doc_type","HC","onPointerMove","pointerCoord","VC","KC","eS","oS","iS","rS","sS","cS","geometryTypeField","drawGuideField","drawGuidePlaceholder","uS","dS","gS","hS","circle","media","fS","yS","vS","xS","CS","wS","handleQueryResults","feature$","MS","LS","onCatalogSelectChange","catalogStore","catalogItemStore","FS","Ct","ours","basePath","contextListFile","defaultContextUri","readParamsFromRoute","hasAuthService","contexts$","handleContextsChange","loadContexts","_defaultContextUri","getById","getDetails","getDefault","defaultContextId$","getProfilByUser","setDefault","defaultContextId","hideContext","showContext","importedContext","permission","write","addToolAssociation","toolId","deleteToolAssociation","getPermissions","addPermissionAssociation","profil","typePermission","deletePermissionAssociation","getLocalContexts","getLocalContext","base","loadDefaultContext","uri","addContextToList","setContext","loadContext","context$","getContextByUri","handleContextMessage","keepCurrentView","mapViewFromRoute","loadEditedContext","setEditedContext","editedContext$","getContextFromMap","_step62","layerOptions","global","getContextFromLayers","extraFeatures","contextMessage","_i11","imported","getContextLayers","findContext","toolsChanged$","_i12","Za","Lu","context$$","contextService","handleContextChange","minWidth","Fu","removeLayersOnContextChange","contextLayers","ZS","computeLayerVisibilityFromUrl","Ai","Zu","pT","_context","_default","context","favoriteClick","favorite","edit","manageTools","managePermissions","Ir","contextsInitial","shared","public","_contexts","_selectedContext","_defaultContextId","contexts","filterContextsList","createContext","sortedAlpha","sortContextsList","showFilter","showContextFilter","thresholdToFilter","toggleSort","clearFilter","empty","getPermission","permissions","userSelection","indeterminate","_step63","_iterator63","childs","_step64","filterPermissionsChanged","showHidden","Ia","onEdit","onSave","onFavorite","onManageTools","onManagePermissions","onDelete","confirmDialogService","onClone","onCreate","_step65","showHiddenContexts","onShowContext","onHideContext","contexts$$","defaultContextId$$","selectedContext$$","selectedContext","users","_step66","_step67","Du","Pu","Oa","Li","oo","Fi","setImportExportType","importExportType$","setMode","selectedMode$","setsExportOptions","Jt","toolToActivateFromOptions","tool","importExportState","openSidenav$","Bu","igoStorageService","xw","storageState","storageChange$$","loadActions","buildActions","zoomAuto$","wu","Mu","toolState","maximize$","Cw","ogcFilterWidget","Dr","initWorkspaces","Vg","workspace$","wfsActionsService","rowsInMapExtentCheckCondition$","selectOnlyCheckCondition$","featureActionsService","actionMaximize$$","setWorkspaceIsMaximized","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","rowsInMapExtentCheckCondition$$","selectOnlyCheckCondition$$","workspaceMaximize$","setActiveWorkspaceById","teardownWorkspaces","Pa","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","searchResultsGeometryEnabled$","createCustomFilterTermStrategy","activateCustomFilterTermStrategy","deactivateCustomFilterTermStrategy","enableSearch","searchDisabled$","disableSearch","setSearchTerm","searchTerm$","setSearchSettingsChange","searchSettingsChange$","setSelectedResult","selectedResult$","setSearchResultsGeometryStatus","w2","I2","Nu","z2","osmLayer","searchState","onPointerSummaryStatusChange","onSearchTermChange","searchStore","selectedFeature","onResultFocus","tryAddFeatureToMap","onOpenGoogleMaps","onOpenGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","lonlat","mapBrowser","getBoundingClientRect","scrollY","left","scrollX","onPointerSearch","_loop14","H2","P0","RC","L0","q0","BC","Z0","NC","GC","W2","X2","eM","tM","iM","nM","EC","sM","aM","cM","uM","gM","getOutputType","getOutputQueryType","spatialListStore","getOutputToggleSearch","loadThematics","getOutputClearSearch","tryAddFeaturesToMap","itemType","tryAddPointToMap","tryAddLayerToMap","zoomToFeatureExtent","_step69","_internal","selectedFeature$","mM","CM","workspaceState","selectedWorkspace$","workspacePaginator","SM","MM","AM","LM","redirectTo","pathMatch","FM","useHash","ZM","mobileQuery","matchMedia","_mobileQueryListener","addEventListener","themeClass","detectOldBrowser","removeEventListener","chrome","firefox","IM","addSvgIconSet","bootstrap","Ao","Lo","$a","bootstrapModule"],"sources":["webpack:///$_lazy_route_resources|lazy|groupOptions:%20%7B%7D|namespace%20object","webpack:///dist/core/locale|sync|/^/.*/.json$","webpack:///packages/utils/src/lib/base64.ts","webpack:///packages/utils/src/lib/user-agent.ts","webpack:///packages/utils/src/lib/clipboard.ts","webpack:///packages/utils/src/lib/object-utils.ts","webpack:///packages/utils/src/lib/strenum.ts","webpack:///packages/utils/src/lib/uuid.ts","webpack:///packages/utils/src/lib/watcher.ts","webpack:///packages/core/src/lib/activity/activity.service.ts","webpack:///packages/core/src/lib/activity/activity.interceptor.ts","webpack:///packages/core/src/lib/activity/activity.module.ts","webpack:///packages/core/src/lib/config/version.ts","webpack:///packages/core/src/lib/config/config.service.ts","webpack:///packages/core/src/lib/config/config.provider.ts","webpack:///packages/core/src/lib/config/config.module.ts","webpack:///packages/core/src/lib/language/shared/language.loader.ts","webpack:///packages/core/src/lib/language/shared/language.provider.ts","webpack:///packages/core/src/lib/language/shared/missing-translation.guard.ts","webpack:///packages/core/src/lib/language/language.module.ts","webpack:///packages/core/src/lib/message/message-center/message-center.component.ts","webpack:///packages/core/src/lib/message/message-center/message-center.component.html","webpack:///packages/core/src/lib/message/message.module.ts","webpack:///packages/core/src/lib/language/shared/language.service.ts","webpack:///packages/core/src/lib/message/shared/message.enum.ts","webpack:///packages/core/src/lib/message/shared/message.service.ts","webpack:///packages/core/src/lib/request/error.interceptor.ts","webpack:///packages/core/src/lib/request/error.module.ts","webpack:///packages/core/src/lib/route/route.service.ts","webpack:///packages/core/src/lib/media/media.enum.ts","webpack:///packages/core/src/lib/media/media.service.ts","webpack:///packages/core/src/lib/storage/storage.interface.ts","webpack:///packages/core/src/lib/storage/storage.service.ts","webpack:///packages/core/src/lib/network/network.service.ts","webpack:///packages/common/src/lib/entity/shared/entity.enums.ts","webpack:///packages/common/src/lib/entity/shared/entity.utils.ts","webpack:///packages/common/src/lib/entity/shared/state.ts","webpack:///packages/common/src/lib/entity/shared/view.ts","webpack:///packages/common/src/lib/entity/shared/store.ts","webpack:///packages/common/src/lib/entity/shared/watcher.ts","webpack:///packages/common/src/lib/entity/shared/strategies/strategy.ts","webpack:///packages/common/src/lib/entity/shared/strategies/filter-custom-function.ts","webpack:///packages/common/src/lib/entity/shared/strategies/filter-selection.ts","webpack:///packages/common/src/lib/entity/entity-selector/entity-selector.component.html","webpack:///packages/common/src/lib/entity/entity-selector/entity-selector.component.ts","webpack:///packages/common/src/lib/stop-propagation/stop-propagation.directive.ts","webpack:///packages/common/src/lib/entity/entity-table/entity-table-row.directive.ts","webpack:///packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.ts","webpack:///packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.html","webpack:///packages/common/src/lib/image/secure-image.pipe.ts","webpack:///packages/common/src/lib/custom-html/custom-html.pipe.ts","webpack:///packages/common/src/lib/entity/entity-table/entity-table.component.html","webpack:///packages/common/src/lib/entity/entity-table/entity-table.component.ts","webpack:///packages/common/src/lib/action/shared/action.enums.ts","webpack:///packages/common/src/lib/action/actionbar/actionbar-item.component.html","webpack:///packages/common/src/lib/action/actionbar/actionbar-item.component.ts","webpack:///packages/common/src/lib/action/actionbar/actionbar.component.html","webpack:///packages/common/src/lib/action/actionbar/actionbar.component.ts","webpack:///packages/common/src/lib/action/actionbar/actionbar.module.ts","webpack:///packages/common/src/lib/action/action.module.ts","webpack:///packages/common/src/lib/badge-icon/badge-icon.directive.ts","webpack:///packages/common/src/lib/badge-icon/badge-icon.module.ts","webpack:///packages/common/src/lib/clickout/clickout.directive.ts","webpack:///packages/common/src/lib/clickout/clickout.module.ts","webpack:///packages/common/src/lib/collapsible/collapse.directive.ts","webpack:///packages/common/src/lib/collapsible/collapsible.component.ts","webpack:///packages/common/src/lib/collapsible/collapsible.component.html","webpack:///packages/common/src/lib/collapsible/collapsible.module.ts","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.component.ts","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.component.html","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.service.ts","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.module.ts","webpack:///packages/common/src/lib/context-menu/context-menu.directive.ts","webpack:///packages/common/src/lib/context-menu/context-menu.module.ts","webpack:///packages/common/src/lib/custom-html/custom-html.module.ts","webpack:///packages/common/src/lib/drag-drop/drag-drop.module.ts","webpack:///packages/common/src/lib/dynamic-component/shared/dynamic-component.ts","webpack:///packages/common/src/lib/dynamic-component/shared/dynamic-component.service.ts","webpack:///packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.ts","webpack:///packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.html","webpack:///packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.module.ts","webpack:///packages/common/src/lib/dynamic-component/dynamic-component.module.ts","webpack:///packages/common/src/lib/flexible/flexible.module.ts","webpack:///packages/common/src/lib/form/form/form.component.ts","webpack:///packages/common/src/lib/form/shared/form.utils.ts","webpack:///packages/common/src/lib/form/form/form.component.html","webpack:///packages/common/src/lib/form/form/form.module.ts","webpack:///packages/common/src/lib/form/shared/form.service.ts","webpack:///packages/common/src/lib/form/shared/form-field.service.ts","webpack:///packages/common/src/lib/form/form-field/form-field.component.html","webpack:///packages/common/src/lib/form/form-field/form-field.component.ts","webpack:///packages/common/src/lib/form/form-field/form-field.module.ts","webpack:///packages/common/src/lib/form/form-group/form-group.component.html","webpack:///packages/common/src/lib/form/form-group/form-group.component.ts","webpack:///packages/common/src/lib/form/form-group/form-group.module.ts","webpack:///packages/common/src/lib/form/form.module.ts","webpack:///packages/common/src/lib/entity/entity-selector/entity-selector.module.ts","webpack:///packages/common/src/lib/stop-propagation/stop-propagation.module.ts","webpack:///packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.module.ts","webpack:///packages/common/src/lib/image/image.module.ts","webpack:///packages/common/src/lib/entity/entity-table/entity-table.module.ts","webpack:///packages/common/src/lib/entity/entity.module.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.loader.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.service.ts","webpack:///packages/common/src/lib/tool/shared/toolbox.ts","webpack:///packages/common/src/lib/tool/shared/tool.service.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.component.html","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.component.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.module.ts","webpack:///packages/common/src/lib/keyvalue/keyvalue.pipe.ts","webpack:///packages/common/src/lib/keyvalue/keyvalue.module.ts","webpack:///packages/common/src/lib/list/list-item.directive.ts","webpack:///packages/common/src/lib/list/list.component.ts","webpack:///packages/common/src/lib/list/list.component.html","webpack:///packages/common/src/lib/list/list.module.ts","webpack:///packages/common/src/lib/panel/panel.component.html","webpack:///packages/common/src/lib/panel/panel.component.ts","webpack:///packages/common/src/lib/panel/panel.module.ts","webpack:///packages/common/src/lib/spinner/spinner.component.ts","webpack:///packages/common/src/lib/spinner/spinner.component.html","webpack:///packages/common/src/lib/spinner/spinner-activity.directive.ts","webpack:///packages/common/src/lib/spinner/spinner.module.ts","webpack:///packages/common/src/lib/table/table-datasource.ts","webpack:///packages/common/src/lib/table/table-action-color.enum.ts","webpack:///packages/common/src/lib/table/table.component.html","webpack:///packages/common/src/lib/table/table.component.ts","webpack:///packages/common/src/lib/table/table.module.ts","webpack:///packages/common/src/lib/action/shared/store.ts","webpack:///packages/common/src/lib/tool/shared/toolbox.enums.ts","webpack:///packages/common/src/lib/tool/toolbox/toolbox.animation.ts","webpack:///packages/common/src/lib/tool/toolbox/toolbox.component.html","webpack:///packages/common/src/lib/tool/toolbox/toolbox.component.ts","webpack:///packages/common/src/lib/tool/toolbox/toolbox.module.ts","webpack:///packages/common/src/lib/tool/tool.module.ts","webpack:///packages/common/src/lib/widget/widget-outlet/widget-outlet.component.html","webpack:///packages/common/src/lib/widget/widget-outlet/widget-outlet.component.ts","webpack:///packages/common/src/lib/widget/widget-outlet/widget-outlet.module.ts","webpack:///packages/common/src/lib/widget/shared/widget.service.ts","webpack:///packages/common/src/lib/widget/widget.module.ts","webpack:///packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.ts","webpack:///packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.html","webpack:///packages/common/src/lib/workspace/workspace-selector/workspace-selector.module.ts","webpack:///packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.html","webpack:///packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.ts","webpack:///packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.module.ts","webpack:///packages/common/src/lib/workspace/workspace.module.ts","webpack:///packages/common/src/lib/table/table-database.ts","webpack:///packages/common/src/lib/tool/shared/tool-component.ts","webpack:///packages/common/src/lib/workspace/shared/store.ts","webpack:///packages/common/src/lib/workspace/shared/workspace.ts","webpack:///demo/src/app/core/home/home-routing.module.ts","webpack:///demo/src/app/core/home/home.component.ts","webpack:///demo/src/app/core/home/home.component.html","webpack:///demo/src/app/core/home/home.module.ts","webpack:///demo/src/app/core/activity/activity-routing.module.ts","webpack:///demo/src/app/core/activity/activity.component.ts","webpack:///demo/src/app/core/activity/activity.component.html","webpack:///demo/src/app/core/activity/activity.module.ts","webpack:///demo/src/environments/environment.prod.ts","webpack:///demo/src/app/core/config/config-routing.module.ts","webpack:///demo/src/app/core/config/config.component.ts","webpack:///demo/src/app/core/config/config.component.html","webpack:///demo/src/app/core/config/config.module.ts","webpack:///demo/src/app/core/language/language-routing.module.ts","webpack:///demo/src/app/core/language/language.component.ts","webpack:///demo/src/app/core/language/language.component.html","webpack:///demo/src/app/core/language/language.module.ts","webpack:///demo/src/app/core/media/media-routing.module.ts","webpack:///demo/src/app/core/media/media.component.ts","webpack:///demo/src/app/core/media/media.component.html","webpack:///demo/src/app/core/media/media.module.ts","webpack:///demo/src/app/core/message/message-routing.module.ts","webpack:///demo/src/app/core/message/message.component.ts","webpack:///demo/src/app/core/message/message.component.html","webpack:///demo/src/app/core/message/message.module.ts","webpack:///demo/src/app/core/request/request-routing.module.ts","webpack:///demo/src/app/core/request/request.component.ts","webpack:///demo/src/app/core/request/request.component.html","webpack:///demo/src/app/core/request/request.module.ts","webpack:///demo/src/app/common/action/action.component.html","webpack:///demo/src/app/common/action/action-routing.module.ts","webpack:///demo/src/app/common/action/action.component.ts","webpack:///demo/src/app/common/action/action.module.ts","webpack:///demo/src/app/common/dynamic-component/dynamic-component.component.ts","webpack:///demo/src/app/common/dynamic-component/dynamic-component-routing.module.ts","webpack:///demo/src/app/common/dynamic-component/dynamic-component.component.html","webpack:///demo/src/app/common/dynamic-component/dynamic-component.module.ts","webpack:///demo/src/app/common/entity-table/entity-table-routing.module.ts","webpack:///demo/src/app/common/entity-table/entity-table.component.ts","webpack:///demo/src/app/common/entity-table/entity-table.component.html","webpack:///demo/src/app/common/entity-table/entity-table.module.ts","webpack:///demo/src/app/common/entity-selector/entity-selector.component.html","webpack:///demo/src/app/common/entity-selector/entity-selector-routing.module.ts","webpack:///demo/src/app/common/entity-selector/entity-selector.component.ts","webpack:///demo/src/app/common/entity-selector/entity-selector.module.ts","webpack:///demo/src/app/common/form/form.component.html","webpack:///demo/src/app/common/form/form-routing.module.ts","webpack:///demo/src/app/common/form/form.component.ts","webpack:///demo/src/app/common/form/form.module.ts","webpack:///demo/src/app/common/table/table-routing.module.ts","webpack:///demo/src/app/common/table/table.component.ts","webpack:///demo/src/app/common/table/table.component.html","webpack:///demo/src/app/common/table/table.module.ts","webpack:///demo/src/app/common/tool/tool.component.html","webpack:///demo/src/app/common/tool/tool.component.ts","webpack:///demo/src/app/common/tool/tool-routing.module.ts","webpack:///demo/src/app/common/tool/tool.module.ts","webpack:///demo/src/app/common/widget/widget.component.ts","webpack:///demo/src/app/common/widget/widget-routing.module.ts","webpack:///demo/src/app/common/widget/widget.component.html","webpack:///demo/src/app/common/widget/widget.module.ts","webpack:///packages/auth/src/lib/shared/token.service.ts","webpack:///packages/auth/src/lib/shared/auth.service.ts","webpack:///packages/auth/src/lib/auth-form/auth-google.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-google.component.html","webpack:///packages/auth/src/lib/auth-form/auth-microsoft.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-microsoft.component.html","webpack:///packages/auth/src/lib/shared/auth-msalServiceb2c.service..ts","webpack:///packages/auth/src/lib/shared/auth-msalBroadcastServiceb2c.service.ts","webpack:///packages/auth/src/lib/auth-form/auth-microsoftb2c.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-microsoftb2c.component.html","webpack:///packages/auth/src/lib/auth-form/auth-facebook.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-facebook.component.html","webpack:///packages/auth/src/lib/auth-form/auth-intern.component.html","webpack:///packages/auth/src/lib/auth-form/auth-intern.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-form.component.html","webpack:///packages/auth/src/lib/auth-form/auth-form.component.ts","webpack:///packages/auth/src/lib/shared/auth.interceptor.ts","webpack:///packages/auth/src/lib/shared/auth-microsoft.provider.ts","webpack:///packages/auth/src/lib/shared/storage.service.ts","webpack:///packages/auth/src/lib/auth.module.ts","webpack:///demo/src/app/auth/auth-form/auth-form-routing.module.ts","webpack:///demo/src/app/auth/auth-form/auth-form.component.ts","webpack:///demo/src/app/auth/auth-form/auth-form.component.html","webpack:///demo/src/app/auth/auth-form/auth-form.module.ts","webpack:///packages/geo/src/lib/metadata/shared/metadata.service.ts","webpack:///packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","webpack:///packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","webpack:///packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","webpack:///packages/geo/src/lib/metadata/metadata.module.ts","webpack:///packages/geo/src/lib/feature/shared/feature.enums.ts","webpack:///packages/geo/src/lib/layer/utils/image-watcher.ts","webpack:///packages/geo/src/lib/layer/shared/layers/layer.interface.ts","webpack:///packages/geo/src/lib/utils/id-generator.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/datasource.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter.ts","webpack:///packages/geo/src/lib/query/shared/query.enums.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","webpack:///packages/geo/src/lib/layer/utils/layerSync-watcher.ts","webpack:///packages/geo/src/lib/layer/utils/tile-watcher.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","webpack:///packages/geo/src/lib/layer/utils/vector-watcher.ts","webpack:///packages/geo/src/lib/map/shared/map.utils.ts","webpack:///packages/geo/src/lib/layer/shared/layers/layer.ts","webpack:///packages/geo/src/lib/layer/shared/layers/vector-layer.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","webpack:///packages/geo/src/lib/datasource/utils/tilegrid.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","webpack:///packages/geo/src/lib/datasource/utils/esri-style-generator.ts","webpack:///packages/geo/src/lib/filter/shared/time-filter.enum.ts","webpack:///packages/geo/src/lib/map/shared/map.service.ts","webpack:///packages/geo/src/lib/datasource/shared/capabilities.service.ts","webpack:///packages/geo/src/lib/map/shared/projection.service.ts","webpack:///packages/geo/src/lib/datasource/shared/datasource.service.ts","webpack:///packages/geo/src/lib/feature/shared/feature.utils.ts","webpack:///packages/geo/src/lib/feature/shared/store.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/loading.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/selection.ts","webpack:///packages/geo/src/lib/feature/shared/strategies.utils.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay-marker-style.utils.ts","webpack:///packages/geo/src/lib/layer/shared/style.service.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.utils.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.ts","webpack:///packages/geo/src/lib/map/utils/layer-watcher.ts","webpack:///packages/geo/src/lib/map/shared/map.enums.ts","webpack:///packages/geo/src/lib/map/shared/controllers/view.ts","webpack:///packages/geo/src/lib/map/shared/controllers/controller.ts","webpack:///packages/geo/src/lib/map/shared/map.ts","webpack:///packages/geo/src/lib/map/map-browser/map-browser.component.ts","webpack:///packages/geo/src/lib/map/map-browser/map-browser.component.html","webpack:///packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","webpack:///packages/geo/src/lib/layer/shared/layers/image-layer.ts","webpack:///packages/geo/src/lib/layer/shared/layers/tile-layer.ts","webpack:///packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","webpack:///packages/geo/src/lib/map/shared/hover-feature.directive.ts","webpack:///packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","webpack:///packages/geo/src/lib/map/zoom-button/zoom-button.component.html","webpack:///packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","webpack:///packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","webpack:///packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.html","webpack:///packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.ts","webpack:///packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","webpack:///packages/geo/src/lib/layer/shared/layer.service.ts","webpack:///packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.html","webpack:///packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.ts","webpack:///packages/geo/src/lib/map/rotation-button/rotation-button.component.html","webpack:///packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","webpack:///packages/geo/src/lib/catalog/shared/catalog.enum.ts","webpack:///packages/geo/src/lib/catalog/shared/catalog.abstract.ts","webpack:///packages/geo/src/lib/query/shared/query.service.ts","webpack:///packages/geo/src/lib/query/shared/query.utils.ts","webpack:///packages/geo/src/lib/query/shared/query.directive.ts","webpack:///packages/geo/src/lib/search/shared/sources/source.ts","webpack:///packages/geo/src/lib/query/shared/query-search-source.ts","webpack:///packages/geo/src/lib/utils/googleLinks.ts","webpack:///packages/geo/src/lib/utils/osmLinks.ts","webpack:///packages/geo/src/lib/catalog/shared/catalog.service.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","webpack:///packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","webpack:///packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","webpack:///packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","webpack:///packages/geo/src/lib/layer/layer-item/layer-item.component.html","webpack:///packages/geo/src/lib/layer/layer-item/layer-item.component.ts","webpack:///packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","webpack:///packages/geo/src/lib/layer/layer-list/layer-list.component.html","webpack:///packages/geo/src/lib/layer/layer-list/layer-list.component.ts","webpack:///packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","webpack:///packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","webpack:///packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","webpack:///packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","webpack:///packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","webpack:///packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","webpack:///packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","webpack:///packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","webpack:///packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","webpack:///packages/geo/src/lib/layer/layer.module.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","webpack:///packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","webpack:///packages/geo/src/lib/catalog/catalog.module.ts","webpack:///packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","webpack:///packages/geo/src/lib/filter/shared/time-filter.service.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter.service.ts","webpack:///packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","webpack:///packages/geo/src/lib/filter/shared/spatial-filter.service.ts","webpack:///packages/geo/src/lib/download/shared/download.service.ts","webpack:///packages/geo/src/lib/download/download-button/download-button.component.html","webpack:///packages/geo/src/lib/download/download-button/download-button.component.ts","webpack:///packages/geo/src/lib/download/download.module.ts","webpack:///packages/geo/src/lib/feature/feature-details/feature-details.component.html","webpack:///packages/geo/src/lib/feature/feature-details/feature-details.component.ts","webpack:///packages/geo/src/lib/draw/shared/draw.enum.ts","webpack:///packages/geo/src/lib/geometry/shared/geometry.utils.ts","webpack:///packages/geo/src/lib/geometry/shared/geometry.errors.ts","webpack:///packages/geo/src/lib/geometry/shared/controls/draw.ts","webpack:///packages/geo/src/lib/draw/draw/draw-popup.component.ts","webpack:///packages/geo/src/lib/draw/draw/draw-popup.component.html","webpack:///packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","webpack:///packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","webpack:///packages/geo/src/lib/measure/shared/measure.enum.ts","webpack:///packages/geo/src/lib/measure/shared/measure.utils.ts","webpack:///packages/geo/src/lib/draw/shared/draw.utils.ts","webpack:///packages/geo/src/lib/draw/shared/draw-style.service.ts","webpack:///packages/geo/src/lib/draw/shared/draw-icon.service.ts","webpack:///packages/geo/src/lib/draw/draw/draw.component.html","webpack:///packages/geo/src/lib/draw/draw/draw.component.ts","webpack:///packages/geo/src/lib/draw/draw/draw.module.ts","webpack:///packages/geo/src/lib/feature/feature-details/feature-details.module.ts","webpack:///packages/geo/src/lib/feature/feature-form/feature-form.module.ts","webpack:///packages/geo/src/lib/feature/feature.module.ts","webpack:///packages/geo/src/lib/geometry/shared/controls/modify.ts","webpack:///packages/geo/src/lib/layer/shared/layer.enums.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","webpack:///packages/geo/src/lib/measure/measurer/measurer.component.html","webpack:///packages/geo/src/lib/measure/measurer/measurer.component.ts","webpack:///packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","webpack:///packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","webpack:///packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","webpack:///packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","webpack:///packages/geo/src/lib/geometry/geometry.module.ts","webpack:///packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","webpack:///packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","webpack:///packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","webpack:///packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","webpack:///packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","webpack:///packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","webpack:///packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","webpack:///packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","webpack:///packages/geo/src/lib/wkt/shared/wkt.service.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","webpack:///packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","webpack:///packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","webpack:///packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","webpack:///packages/geo/src/lib/filter/filter.module.ts","webpack:///packages/geo/src/lib/import-export/shared/export.errors.ts","webpack:///packages/geo/src/lib/import-export/shared/export.type.ts","webpack:///packages/geo/src/lib/import-export/shared/export.service.ts","webpack:///packages/utils/src/lib/file.ts","webpack:///packages/geo/src/lib/import-export/shared/import.utils.ts","webpack:///packages/geo/src/lib/import-export/shared/import.errors.ts","webpack:///packages/geo/src/lib/import-export/shared/import.service.ts","webpack:///packages/geo/src/lib/import-export/style-list/style-list.service.ts","webpack:///packages/geo/src/lib/import-export/import-export/import-export.component.html","webpack:///packages/geo/src/lib/import-export/import-export/import-export.component.ts","webpack:///packages/geo/src/lib/map/shared/projection.utils.ts","webpack:///packages/geo/src/lib/import-export/shared/export.utils.ts","webpack:///packages/geo/src/lib/import-export/style-list/style-list.provider.ts","webpack:///packages/geo/src/lib/import-export/style-list/style-list.module.ts","webpack:///packages/geo/src/lib/import-export/import-export.module.ts","webpack:///packages/geo/src/lib/map/map.module.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer-item.component.html","webpack:///packages/geo/src/lib/measure/measurer/measurer-item.component.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer.module.ts","webpack:///packages/geo/src/lib/measure/measure.module.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.enum.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.service.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.directive.ts","webpack:///packages/geo/src/lib/overlay/overlay.module.ts","webpack:///packages/geo/src/lib/print/shared/print.service.ts","webpack:///packages/geo/src/lib/layer/utils/outputLegend.ts","webpack:///packages/geo/src/lib/print/shared/print.type.ts","webpack:///packages/geo/src/lib/print/print-form/print-form.component.html","webpack:///packages/geo/src/lib/print/print-form/print-form.component.ts","webpack:///packages/geo/src/lib/print/print/print.component.ts","webpack:///packages/geo/src/lib/print/print/print.component.html","webpack:///packages/geo/src/lib/print/print.module.ts","webpack:///packages/geo/src/lib/query/shared/query-search-source.providers.ts","webpack:///packages/geo/src/lib/query/query.module.ts","webpack:///packages/geo/src/lib/directions/shared/directions-source.service.ts","webpack:///packages/geo/src/lib/directions/shared/directions.service.ts","webpack:///packages/geo/src/lib/search/shared/search.utils.ts","webpack:///packages/geo/src/lib/search/shared/search-source.service.ts","webpack:///packages/geo/src/lib/search/shared/search.service.ts","webpack:///packages/geo/src/lib/directions/directions-form/directions-form.service.ts","webpack:///packages/geo/src/lib/directions/directions-form/directions-form.component.html","webpack:///packages/geo/src/lib/directions/directions-form/directions-form.component.ts","webpack:///packages/geo/src/lib/directions/directions.module.ts","webpack:///packages/geo/src/lib/search/shared/search-source-service.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/icherche.ts","webpack:///packages/geo/src/lib/search/shared/sources/icherche.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/coordinates.ts","webpack:///packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/ilayer.ts","webpack:///packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","webpack:///packages/geo/src/lib/search/shared/search.enums.ts","webpack:///packages/geo/src/lib/search/search-selector/search-selector.component.html","webpack:///packages/geo/src/lib/search/search-selector/search-selector.component.ts","webpack:///packages/geo/src/lib/search/search-selector/search-selector.module.ts","webpack:///packages/geo/src/lib/search/search-settings/search-settings.component.html","webpack:///packages/geo/src/lib/search/search-settings/search-settings.component.ts","webpack:///packages/geo/src/lib/search/search-settings/search-settings.module.ts","webpack:///packages/geo/src/lib/search/search-bar/search-bar.component.html","webpack:///packages/geo/src/lib/search/search-bar/search-bar.component.ts","webpack:///packages/geo/src/lib/search/search-bar/search-bar.module.ts","webpack:///packages/geo/src/lib/search/search-results/search-results-item.component.html","webpack:///packages/geo/src/lib/search/search-results/search-results-item.component.ts","webpack:///packages/geo/src/lib/search/search-results/search-results.component.html","webpack:///packages/geo/src/lib/search/search-results/search-results.component.ts","webpack:///packages/geo/src/lib/search/search-results/search-results-add-button.component.html","webpack:///packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","webpack:///packages/geo/src/lib/search/search-results/search-results.module.ts","webpack:///packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","webpack:///packages/geo/src/lib/search/search.module.ts","webpack:///packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","webpack:///packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","webpack:///packages/geo/src/lib/workspace/widgets/widgets.ts","webpack:///packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","webpack:///packages/geo/src/lib/workspace/shared/wfs-workspace.ts","webpack:///packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/shared/feature-workspace.ts","webpack:///packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","webpack:///packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","webpack:///packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","webpack:///packages/geo/src/lib/workspace/workspace.module.ts","webpack:///packages/geo/src/lib/directions/shared/directions.enum.ts","webpack:///packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","webpack:///packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","webpack:///packages/geo/src/lib/search/shared/sources/cadastre.ts","webpack:///packages/geo/src/lib/search/shared/sources/cadastre.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/nominatim.ts","webpack:///packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/storedqueries.ts","webpack:///packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","webpack:///packages/geo/src/lib/workspace/shared/workspace.utils.ts","webpack:///demo/src/app/geo/simple-map/simple-map.component.html","webpack:///demo/src/app/geo/simple-map/simple-map-routing.module.ts","webpack:///demo/src/app/geo/simple-map/simple-map.component.ts","webpack:///demo/src/app/geo/simple-map/simple-map.module.ts","webpack:///demo/src/app/geo/layer/layer.component.html","webpack:///demo/src/app/geo/layer/layer-routing.module.ts","webpack:///demo/src/app/geo/layer/layer.component.ts","webpack:///demo/src/app/geo/layer/layer.module.ts","webpack:///demo/src/app/geo/legend/legend-routing.module.ts","webpack:///demo/src/app/geo/legend/legend.component.ts","webpack:///demo/src/app/geo/legend/legend.component.html","webpack:///demo/src/app/geo/legend/legend.module.ts","webpack:///demo/src/app/geo/overlay/overlay-routing.module.ts","webpack:///demo/src/app/geo/overlay/overlay.component.ts","webpack:///demo/src/app/geo/overlay/overlay.component.html","webpack:///demo/src/app/geo/overlay/overlay.module.ts","webpack:///demo/src/app/geo/geometry/geometry.component.html","webpack:///demo/src/app/geo/geometry/geometry-routing.module.ts","webpack:///demo/src/app/geo/geometry/geometry.component.ts","webpack:///demo/src/app/geo/geometry/geometry.module.ts","webpack:///demo/src/app/geo/feature/feature-routing.module.ts","webpack:///demo/src/app/geo/feature/feature.component.ts","webpack:///demo/src/app/geo/feature/feature.component.html","webpack:///demo/src/app/geo/feature/feature.module.ts","webpack:///demo/src/app/geo/hover/hover-routing.module.ts","webpack:///demo/src/app/geo/hover/hover.component.ts","webpack:///demo/src/app/geo/hover/hover.component.html","webpack:///demo/src/app/geo/hover/hover.module.ts","webpack:///demo/src/app/geo/measure/measure-routing.module.ts","webpack:///demo/src/app/geo/measure/measure.component.ts","webpack:///demo/src/app/geo/measure/measure.component.html","webpack:///demo/src/app/geo/measure/measure.module.ts","webpack:///demo/src/app/geo/draw/draw-routing.module.ts","webpack:///demo/src/app/geo/draw/draw.component.ts","webpack:///demo/src/app/geo/draw/draw.component.html","webpack:///demo/src/app/geo/draw/draw.module.ts","webpack:///demo/src/app/geo/query/query.component.html","webpack:///demo/src/app/geo/query/query-routing.module.ts","webpack:///demo/src/app/geo/query/query.component.ts","webpack:///demo/src/app/geo/query/query.module.ts","webpack:///demo/src/app/geo/catalog/catalog-routing.module.ts","webpack:///demo/src/app/geo/catalog/catalog.component.ts","webpack:///demo/src/app/geo/catalog/catalog.component.html","webpack:///demo/src/app/geo/catalog/catalog.module.ts","webpack:///packages/context/src/lib/context-import-export/shared/context-export.errors.ts","webpack:///packages/context/src/lib/context-import-export/shared/context-import.errors.ts","webpack:///packages/context/src/lib/context-manager/shared/context.enum.ts","webpack:///packages/context/src/lib/context-manager/shared/context.service.ts","webpack:///packages/context/src/lib/context-import-export/context-import-export.module.ts","webpack:///packages/context/src/lib/context-manager/shared/map-context.directive.ts","webpack:///packages/context/src/lib/context-manager/shared/layer-context.directive.ts","webpack:///packages/context/src/lib/context-import-export/shared/context-import.utils.ts","webpack:///packages/context/src/lib/context-manager/context-list/context-list.enum.ts","webpack:///packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","webpack:///packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","webpack:///packages/context/src/lib/context-manager/context-item/context-item.component.html","webpack:///packages/context/src/lib/context-manager/context-item/context-item.component.ts","webpack:///packages/context/src/lib/context-manager/context-list/context-list.component.html","webpack:///packages/context/src/lib/context-manager/context-list/context-list.component.ts","webpack:///packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","webpack:///packages/context/src/lib/context-map-button/poi-button/shared/poi.service.ts","webpack:///packages/context/src/lib/context-map-button/context-map-button.module.ts","webpack:///packages/context/src/lib/context-manager/context-manager.module.ts","webpack:///packages/integration/src/lib/import-export/import-export.state.ts","webpack:///packages/integration/src/lib/tool/tool.state.ts","webpack:///packages/integration/src/lib/workspace/shared/workspace.utils.ts","webpack:///packages/integration/src/lib/storage/storage.state.ts","webpack:///packages/integration/src/lib/workspace/shared/feature-actions.service.ts","webpack:///packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","webpack:///packages/integration/src/lib/workspace/workspace.state.ts","webpack:///packages/integration/src/lib/search/search.state.ts","webpack:///packages/integration/src/lib/search/search-bar/search-bar.module.ts","webpack:///packages/integration/src/lib/search/search-results-tool/search-results-tool.module.ts","webpack:///packages/integration/src/lib/search/search.module.ts","webpack:///demo/src/app/geo/search/search.component.html","webpack:///demo/src/app/geo/search/search-routing.module.ts","webpack:///demo/src/app/geo/search/search.component.ts","webpack:///demo/src/app/geo/search/search.module.ts","webpack:///demo/src/app/geo/print/print-routing.module.ts","webpack:///demo/src/app/geo/print/print.component.ts","webpack:///demo/src/app/geo/print/print.component.html","webpack:///demo/src/app/geo/print/print.module.ts","webpack:///demo/src/app/geo/import-export/import-export-routing.module.ts","webpack:///demo/src/app/geo/import-export/import-export.component.ts","webpack:///demo/src/app/geo/import-export/import-export.component.html","webpack:///demo/src/app/geo/import-export/import-export.module.ts","webpack:///demo/src/app/geo/directions/directions-routing.module.ts","webpack:///demo/src/app/geo/directions/directions.component.ts","webpack:///demo/src/app/geo/directions/directions.component.html","webpack:///demo/src/app/geo/directions/directions.module.ts","webpack:///demo/src/app/geo/time-filter/time-filter-routing.module.ts","webpack:///demo/src/app/geo/time-filter/time-filter.component.ts","webpack:///demo/src/app/geo/time-filter/time-filter.component.html","webpack:///demo/src/app/geo/time-filter/time-filter.module.ts","webpack:///demo/src/app/geo/ogc-filter/ogc-filter-routing.module.ts","webpack:///demo/src/app/geo/ogc-filter/ogc-filter.component.ts","webpack:///demo/src/app/geo/ogc-filter/ogc-filter.component.html","webpack:///demo/src/app/geo/ogc-filter/ogc-filter.module.ts","webpack:///demo/src/app/geo/spatial-filter/spatial-filter.component.html","webpack:///demo/src/app/geo/spatial-filter/spatial-filter-routing.module.ts","webpack:///demo/src/app/geo/spatial-filter/spatial-filter.component.ts","webpack:///demo/src/app/geo/spatial-filter/spatial-filter.module.ts","webpack:///demo/src/app/geo/workspace/workspace.component.html","webpack:///demo/src/app/geo/workspace/workspace-routing.module.ts","webpack:///demo/src/app/geo/workspace/workspace.component.ts","webpack:///demo/src/app/geo/workspace/workspace.module.ts","webpack:///demo/src/app/context/context/context.component.html","webpack:///demo/src/app/context/context/context-routing.module.ts","webpack:///demo/src/app/context/context/context.component.ts","webpack:///demo/src/app/context/context/context.module.ts","webpack:///demo/src/app/app-routing.module.ts","webpack:///demo/src/app/app.component.ts","webpack:///demo/src/app/app.component.html","webpack:///demo/src/app/app.module.ts","webpack:///demo/src/main.ts","webpack:///node_modules/moment/locale|sync|/^/.*$"],"sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 98255;\nmodule.exports = webpackEmptyAsyncContext;","var map = {\n\t\"./en.auth.json\": 50257,\n\t\"./en.common.json\": 35488,\n\t\"./en.context.json\": 88952,\n\t\"./en.core.json\": 63154,\n\t\"./en.geo.json\": 10711,\n\t\"./en.integration.json\": 32766,\n\t\"./en.json\": 10503,\n\t\"./fr.auth.json\": 8555,\n\t\"./fr.common.json\": 20551,\n\t\"./fr.context.json\": 68079,\n\t\"./fr.core.json\": 5415,\n\t\"./fr.geo.json\": 27268,\n\t\"./fr.integration.json\": 63031,\n\t\"./fr.json\": 65962\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 36438;","/* tslint:disable */\r\n\r\nconst ALPHA =\r\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\r\n\r\nexport class Base64 {\r\n  private static PADCHAR: string = '=';\r\n  private static ALPHA: string = ALPHA;\r\n\r\n  private static getByte(s: string, i: number): number {\r\n    const x = s.charCodeAt(i);\r\n    return x;\r\n  }\r\n\r\n  private static getByte64(s: string, i: number): number {\r\n    const idx = this.ALPHA.indexOf(s.charAt(i));\r\n    return idx;\r\n  }\r\n\r\n  public static decode(s: string): string {\r\n    let pads = 0,\r\n      i,\r\n      b10,\r\n      imax = s.length,\r\n      x = [];\r\n\r\n    s = String(s);\r\n\r\n    if (imax === 0) {\r\n      return s;\r\n    }\r\n\r\n    if (s.charAt(imax - 1) === this.PADCHAR) {\r\n      pads = 1;\r\n      if (s.charAt(imax - 2) === this.PADCHAR) {\r\n        pads = 2;\r\n      }\r\n      imax -= 4;\r\n    }\r\n\r\n    for (i = 0; i < imax; i += 4) {\r\n      b10 =\r\n        (this.getByte64(s, i) << 18) |\r\n        (this.getByte64(s, i + 1) << 12) |\r\n        (this.getByte64(s, i + 2) << 6) |\r\n        this.getByte64(s, i + 3);\r\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\r\n    }\r\n\r\n    switch (pads) {\r\n      case 1:\r\n        b10 =\r\n          (this.getByte64(s, i) << 18) |\r\n          (this.getByte64(s, i + 1) << 12) |\r\n          (this.getByte64(s, i + 2) << 6);\r\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\r\n        break;\r\n      case 2:\r\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\r\n        x.push(String.fromCharCode(b10 >> 16));\r\n        break;\r\n    }\r\n\r\n    return x.join('');\r\n  }\r\n\r\n  public static encode(s: string): string {\r\n    s = String(s);\r\n\r\n    let i,\r\n      b10,\r\n      x = [],\r\n      imax = s.length - s.length % 3;\r\n\r\n    if (s.length === 0) {\r\n      return s;\r\n    }\r\n\r\n    for (i = 0; i < imax; i += 3) {\r\n      b10 =\r\n        (this.getByte(s, i) << 16) |\r\n        (this.getByte(s, i + 1) << 8) |\r\n        this.getByte(s, i + 2);\r\n      x.push(this.ALPHA.charAt(b10 >> 18));\r\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\r\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\r\n      x.push(this.ALPHA.charAt(b10 & 63));\r\n    }\r\n\r\n    switch (s.length - imax) {\r\n      case 1:\r\n        b10 = this.getByte(s, i) << 16;\r\n        x.push(\r\n          this.ALPHA.charAt(b10 >> 18) +\r\n            this.ALPHA.charAt((b10 >> 12) & 63) +\r\n            this.PADCHAR +\r\n            this.PADCHAR\r\n        );\r\n        break;\r\n      case 2:\r\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\r\n        x.push(\r\n          this.ALPHA.charAt(b10 >> 18) +\r\n            this.ALPHA.charAt((b10 >> 12) & 63) +\r\n            this.ALPHA.charAt((b10 >> 6) & 63) +\r\n            this.PADCHAR\r\n        );\r\n        break;\r\n    }\r\n\r\n    return x.join('');\r\n  }\r\n}\r\n","import * as Bowser from 'bowser';\r\n\r\nexport interface UserAgent extends Bowser.Parser.Parser {\r\n  compareVersion: (version: string) => boolean;\r\n}\r\n\r\nexport const userAgent = Bowser.getParser(\r\n  window.navigator.userAgent\r\n) as UserAgent;\r\n","import { userAgent } from './user-agent';\r\n\r\nexport class Clipboard {\r\n  static copy(element: HTMLTextAreaElement | string): boolean {\r\n    let successful = false;\r\n    if (typeof element === 'string') {\r\n      const textArea = Clipboard.createTextArea(element);\r\n      Clipboard.selectText(textArea);\r\n      successful = Clipboard.copyTextToClipboard();\r\n      Clipboard.destroyTextArea(textArea);\r\n    } else {\r\n      Clipboard.selectText(element);\r\n      successful = Clipboard.copyTextToClipboard();\r\n    }\r\n    return successful;\r\n  }\r\n\r\n  private static createTextArea(text: string): HTMLTextAreaElement {\r\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\r\n    textArea.value = text;\r\n    document.body.appendChild(textArea);\r\n    return textArea;\r\n  }\r\n\r\n  private static destroyTextArea(textArea) {\r\n    document.body.removeChild(textArea);\r\n  }\r\n\r\n  private static selectText(textArea) {\r\n    if (userAgent.getOSName() === 'iOS') {\r\n      const oldContentEditable = textArea.contentEditable;\r\n      const oldReadOnly = textArea.readOnly;\r\n      const range = document.createRange();\r\n      const selection = window.getSelection();\r\n\r\n      textArea.contenteditable = true;\r\n      textArea.readonly = false;\r\n      range.selectNodeContents(textArea);\r\n      selection.removeAllRanges();\r\n      selection.addRange(range);\r\n      textArea.setSelectionRange(0, 999999);\r\n      textArea.contentEditable = oldContentEditable;\r\n      textArea.readOnly = oldReadOnly;\r\n    } else {\r\n      textArea.select();\r\n    }\r\n  }\r\n\r\n  private static copyTextToClipboard(): boolean {\r\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\r\n      return document.execCommand('copy');\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","export class ObjectUtils {\r\n  static resolve(obj: object, key: string): any {\r\n    const keysArray = key\r\n      .replace(/\\[/g, '.')\r\n      .replace(/\\]/g, '')\r\n      .split('.');\r\n    let current = obj;\r\n    while (keysArray.length) {\r\n      if (typeof current !== 'object') {\r\n        return undefined;\r\n      }\r\n      current = current[keysArray.shift()];\r\n    }\r\n\r\n    return current;\r\n  }\r\n\r\n  static isObject(item: object) {\r\n    return (\r\n      item &&\r\n      typeof item === 'object' &&\r\n      !Array.isArray(item) &&\r\n      item !== null &&\r\n      !(item instanceof Date)\r\n    );\r\n  }\r\n\r\n  static mergeDeep(\r\n    target: object,\r\n    source: object,\r\n    ignoreUndefined = false\r\n  ): any {\r\n    const output = Object.assign({}, target);\r\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\r\n      Object.keys(source)\r\n        .filter(key => !ignoreUndefined || source[key] !== undefined)\r\n        .forEach(key => {\r\n          if (ObjectUtils.isObject(source[key])) {\r\n            if (!(key in target)) {\r\n              Object.assign(output, { [key]: source[key] });\r\n            } else {\r\n              output[key] = ObjectUtils.mergeDeep(\r\n                target[key],\r\n                source[key],\r\n                ignoreUndefined\r\n              );\r\n            }\r\n          } else {\r\n            Object.assign(output, { [key]: source[key] });\r\n          }\r\n        });\r\n    }\r\n    return output;\r\n  }\r\n\r\n  static copyDeep(src): any {\r\n    const target = Array.isArray(src) ? [] : {};\r\n    for (const prop in src) {\r\n      if (src.hasOwnProperty(prop)) {\r\n        const value = src[prop];\r\n        if (value && typeof value === 'object') {\r\n          target[prop] = this.copyDeep(value);\r\n        } else {\r\n          target[prop] = value;\r\n        }\r\n      }\r\n    }\r\n    return target;\r\n  }\r\n\r\n  static removeDuplicateCaseInsensitive(obj: object) {\r\n    const summaryCapitalizeObject = {};\r\n    const capitalizeObject = {};\r\n    const upperCaseCount = [];\r\n\r\n    for (const property in obj) {\r\n      if (obj.hasOwnProperty(property)) {\r\n        const upperCaseProperty = property.toUpperCase();\r\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\r\n          summaryCapitalizeObject[upperCaseProperty] = [\r\n            { [property]: obj[property] }\r\n          ];\r\n        } else {\r\n          summaryCapitalizeObject[upperCaseProperty].push({\r\n            [property]: obj[property]\r\n          });\r\n        }\r\n        // counting the number of uppercase lettersMna\r\n        upperCaseCount.push({\r\n          key: property,\r\n          count: property.replace(/[^A-Z]/g, '').length\r\n        });\r\n      }\r\n    }\r\n    for (const capitalizedProperty in summaryCapitalizeObject) {\r\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\r\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\r\n          const capitalizedPropertyObject =\r\n            summaryCapitalizeObject[capitalizedProperty];\r\n          if (capitalizedPropertyObject.length === 1) {\r\n            // for single params (no duplicates)\r\n            const singlePossibility = capitalizedPropertyObject[0];\r\n            capitalizeObject[capitalizedProperty] =\r\n              singlePossibility[Object.keys(singlePossibility)[0]];\r\n          } else if (capitalizedPropertyObject.length > 1) {\r\n            // defining the closest to lowercase property\r\n            const paramClosestToLowercase = upperCaseCount\r\n              .filter(\r\n                f => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\r\n              )\r\n              .reduce((prev, current) => {\r\n                return prev.y < current.y ? prev : current;\r\n              });\r\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\r\n              obj[paramClosestToLowercase.key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    for (const property in obj) {\r\n      if (obj.hasOwnProperty(property)) {\r\n        delete obj[property];\r\n      }\r\n    }\r\n\r\n    for (const property in capitalizeObject) {\r\n      if (capitalizeObject.hasOwnProperty(property)) {\r\n        obj[property] = capitalizeObject[property];\r\n      }\r\n    }\r\n  }\r\n\r\n  static removeUndefined(obj: object): any {\r\n    const output = {};\r\n    if (ObjectUtils.isObject(obj)) {\r\n      Object.keys(obj)\r\n        .filter(key => obj[key] !== undefined)\r\n        .forEach(key => {\r\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\r\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\r\n          } else {\r\n            output[key] = obj[key];\r\n          }\r\n        });\r\n\r\n      return output;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n      return obj.map(o => ObjectUtils.removeUndefined(o));\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  static removeNull(obj: object): any {\r\n    const output = {};\r\n    if (ObjectUtils.isObject(obj)) {\r\n      Object.keys(obj)\r\n        .filter(key => obj[key] !== null)\r\n        .forEach(key => {\r\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\r\n            output[key] = ObjectUtils.removeNull(obj[key]);\r\n          } else {\r\n            output[key] = obj[key];\r\n          }\r\n        });\r\n\r\n      return output;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n      return obj.map(o => ObjectUtils.removeNull(o));\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\r\n    if (direction === 'desc') {\r\n      b = [a, (a = b)][0];\r\n    }\r\n\r\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\r\n    // nullsFirst = true : always first\r\n    // nullsFirst = false : always end\r\n    if (\r\n      a === null ||\r\n      a === '' ||\r\n      a === undefined ||\r\n      b === null ||\r\n      b === '' ||\r\n      b === undefined\r\n    ) {\r\n      const nullScore =\r\n        a === b\r\n          ? 0\r\n          : a === undefined\r\n          ? 3\r\n          : b === undefined\r\n          ? -3\r\n          : a === null\r\n          ? 2\r\n          : b === null\r\n          ? -2\r\n          : a === ''\r\n          ? 1\r\n          : -1;\r\n      if (direction === 'desc') {\r\n        return nullsFirst !== false ? nullScore : nullScore * -1;\r\n      }\r\n      return nullsFirst === true ? nullScore * -1 : nullScore;\r\n    }\r\n\r\n    const ax = [];\r\n    const bx = [];\r\n    a = '' + a;\r\n    b = '' + b;\r\n\r\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\r\n      ax.push([$1 || Infinity, $2 || '']);\r\n    });\r\n\r\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\r\n      bx.push([$1 || Infinity, $2 || '']);\r\n    });\r\n\r\n    while (ax.length && bx.length) {\r\n      const an = ax.shift();\r\n      const bn = bx.shift();\r\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\r\n      if (nn) {\r\n        return nn;\r\n      }\r\n    }\r\n\r\n    return ax.length - bx.length;\r\n  }\r\n\r\n  /**\r\n   * Return true if two object are equivalent.\r\n   * Objects are considered equivalent if they have the same properties and\r\n   * if all of their properties (first-level only) share the same value.\r\n   * @param obj1 First object\r\n   * @param obj2 Second object\r\n   * @returns Whether two objects arer equivalent\r\n   */\r\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\r\n    if (obj1 === obj2) {\r\n      return true;\r\n    }\r\n\r\n    const obj1Props = Object.getOwnPropertyNames(obj1);\r\n    const obj2Props = Object.getOwnPropertyNames(obj2);\r\n    if (obj1Props.length !== obj2Props.length) {\r\n      return false;\r\n    }\r\n\r\n    for (const prop of obj1Props) {\r\n      if (obj1[prop] !== obj2[prop]) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Return a new object with an array of keys removed\r\n   * @param obj Source object\r\n   * @param keys Keys to remove\r\n   * @returns A new object\r\n   */\r\n  static removeKeys(obj: object, keys: string[]): object {\r\n    const newObj = Object.keys(obj)\r\n      .filter(key => keys.indexOf(key) < 0)\r\n      .reduce((_obj, key) => {\r\n        _obj[key] = obj[key];\r\n        return _obj;\r\n      }, {});\r\n\r\n    return newObj;\r\n  }\r\n}\r\n","/** Utility function to create a K:V from a list of strings */\r\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\r\n  return o.reduce((res, key) => {\r\n    res[key] = key;\r\n    return res;\r\n  }, Object.create(null));\r\n}\r\n","export function S4() {\r\n  // tslint:disable-next-line: no-bitwise\r\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n}\r\n\r\nexport function uuid() {\r\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\r\n  return id.toLowerCase();\r\n}\r\n","import { Subject, Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nexport enum SubjectStatus {\r\n  Error = 0,\r\n  Done = 1,\r\n  Working = 2,\r\n  Waiting = 3\r\n}\r\n\r\nexport abstract class Watcher {\r\n  public status$ = new Subject<SubjectStatus>();\r\n  protected status$$: Subscription;\r\n\r\n  get status(): SubjectStatus {\r\n    return this._status;\r\n  }\r\n  set status(value: SubjectStatus) {\r\n    this._status = value;\r\n    this.status$.next(value);\r\n  }\r\n  private _status: SubjectStatus;\r\n\r\n  protected abstract watch();\r\n\r\n  protected abstract unwatch();\r\n\r\n  // tslint:disable-next-line:ban-types\r\n  subscribe(callback: Function, scope?: any) {\r\n    this.watch();\r\n\r\n    this.status$$ = this.status$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((status: SubjectStatus) => {\r\n        this.handleStatusChange(status);\r\n        callback.call(scope, this);\r\n      });\r\n  }\r\n\r\n  unsubscribe() {\r\n    this.unwatch();\r\n    if (this.status$$ !== undefined) {\r\n      this.status$$.unsubscribe();\r\n      this.status$$ = undefined;\r\n    }\r\n    this.status = SubjectStatus.Waiting;\r\n  }\r\n\r\n  protected handleStatusChange(status: SubjectStatus) {}\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ActivityService {\r\n  public counter$ = new BehaviorSubject<number>(0);\r\n\r\n  private ids: string[] = [];\r\n\r\n  constructor() {}\r\n\r\n  register(): string {\r\n    const id = uuid();\r\n    this.ids.push(id);\r\n    this.counter$.next(this.ids.length);\r\n\r\n    return id;\r\n  }\r\n\r\n  unregister(id: string) {\r\n    const index = this.ids.indexOf(id);\r\n    if (index === -1) {\r\n      return;\r\n    }\r\n    this.ids.splice(index, 1);\r\n\r\n    this.counter$.next(this.ids.length);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpEvent,\r\n  HttpHandler,\r\n  HttpInterceptor,\r\n  HttpRequest\r\n} from '@angular/common/http';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { finalize } from 'rxjs/operators';\r\n\r\nimport { ActivityService } from './activity.service';\r\n\r\n@Injectable()\r\nexport class ActivityInterceptor implements HttpInterceptor {\r\n  constructor(private activityService: ActivityService) {}\r\n\r\n  intercept(\r\n    req: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    const activity = req.headers.get('activityInterceptor');\r\n    if (activity) {\r\n      const actReq = req.clone({\r\n        headers: req.headers.delete('activityInterceptor')\r\n      });\r\n      if (activity === 'false') {\r\n        return next.handle(actReq);\r\n      }\r\n    }\r\n\r\n    const id = this.activityService.register();\r\n\r\n    return next.handle(req).pipe(\r\n      finalize(() => {\r\n        this.activityService.unregister(id);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\r\n\r\nimport { ActivityInterceptor } from './activity.interceptor';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoActivityModule {\r\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\r\n    return {\r\n      ngModule: IgoActivityModule,\r\n      providers: [\r\n        {\r\n          provide: HTTP_INTERCEPTORS,\r\n          useClass: ActivityInterceptor,\r\n          multi: true\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n","export interface Version {\r\n  lib: string;\r\n  releaseDate: number;\r\n}\r\n\r\nexport const version: Version = {\r\n  lib: '1.9.0',\r\n  releaseDate: 1632149524409\r\n};\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { ConfigOptions } from './config.interface';\r\nimport { version } from './version';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ConfigService {\r\n  private config: object = {};\r\n\r\n  constructor(private injector: Injector) {}\r\n\r\n  /**\r\n   * Use to get the data found in config file\r\n   */\r\n  public getConfig(key: string): any {\r\n    return ObjectUtils.resolve(this.config, key);\r\n  }\r\n\r\n  /**\r\n   * This method loads \"[path]\" to get all config's variables\r\n   */\r\n  public load(options: ConfigOptions) {\r\n    const baseConfig = options.default || {};\r\n    if (!options.path) {\r\n      this.config = baseConfig;\r\n      return true;\r\n    }\r\n\r\n    const http = this.injector.get(HttpClient);\r\n\r\n    return new Promise((resolve, _reject) => {\r\n      http\r\n        .get(options.path)\r\n        .pipe(\r\n          catchError((error: any): any => {\r\n            console.log(`Configuration file ${options.path} could not be read`);\r\n            resolve(true);\r\n            return throwError(error.error || 'Server error');\r\n          })\r\n        )\r\n        .subscribe((configResponse: object) => {\r\n          this.config = ObjectUtils.mergeDeep(\r\n            ObjectUtils.mergeDeep({ version }, baseConfig),\r\n            configResponse\r\n          );\r\n          resolve(true);\r\n        });\r\n    });\r\n  }\r\n}\r\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\r\n\r\nimport { ConfigService } from './config.service';\r\nimport { ConfigOptions } from './config.interface';\r\n\r\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\r\n\r\nexport function provideConfigOptions(options: ConfigOptions) {\r\n  return {\r\n    provide: CONFIG_OPTIONS,\r\n    useValue: options\r\n  };\r\n}\r\n\r\nexport function configFactory(\r\n  configService: ConfigService,\r\n  options: ConfigOptions\r\n) {\r\n  return () => configService.load(options);\r\n}\r\n\r\nexport function provideConfigLoader() {\r\n  return {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: configFactory,\r\n    multi: true,\r\n    deps: [ConfigService, CONFIG_OPTIONS]\r\n  };\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { provideConfigOptions, provideConfigLoader } from './config.provider';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoConfigModule {\r\n  static forRoot(): ModuleWithProviders<IgoConfigModule> {\r\n    return {\r\n      ngModule: IgoConfigModule,\r\n      providers: [provideConfigOptions({}), provideConfigLoader()]\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { of, combineLatest } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { TranslateLoader } from '@ngx-translate/core';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { ConfigService } from '../../config/config.service';\r\n\r\ndeclare function require(arg: string): any;\r\n\r\nexport class LanguageLoader implements TranslateLoader {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private prefix?: string | string[],\r\n    private suffix: string = '.json',\r\n    private config?: ConfigService\r\n  ) {}\r\n\r\n  public getTranslation(lang: string): any {\r\n    const translation = require(`../locale/${lang}.json`);\r\n    const igoLocale$ = of(translation);\r\n\r\n    if (this.config && !this.prefix) {\r\n      const prefix = this.config.getConfig('language.prefix');\r\n      this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\r\n    }\r\n\r\n    if (!this.prefix || this.prefix.length === 0) {\r\n      return igoLocale$;\r\n    }\r\n\r\n    const appLocale$ = (this.prefix as string[]).map((prefix) =>\r\n      this.http.get(`${prefix}${lang}${this.suffix}`)\r\n    );\r\n\r\n    const locale$ = combineLatest([igoLocale$, ...appLocale$]);\r\n\r\n    return locale$.pipe(\r\n      map((translations) => {\r\n        return translations.reduce(\r\n          (acc, current) => ObjectUtils.mergeDeep(acc, current),\r\n          {}\r\n        );\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { TranslateLoader } from '@ngx-translate/core';\r\n\r\nimport { ConfigService } from '../../config/config.service';\r\nimport { LanguageLoader } from './language.loader';\r\n\r\nexport function defaultLanguageLoader(\r\n  http: HttpClient,\r\n  config?: ConfigService\r\n) {\r\n  return new LanguageLoader(http, undefined, undefined, config);\r\n}\r\n\r\nexport function provideLanguageLoader(loader?) {\r\n  return {\r\n    provide: TranslateLoader,\r\n    useFactory: loader || defaultLanguageLoader,\r\n    deps: [HttpClient]\r\n  };\r\n}\r\n\r\nexport function provideDefaultLanguageLoader(loader?) {\r\n  return {\r\n    provide: TranslateLoader,\r\n    useFactory: loader || defaultLanguageLoader,\r\n    deps: [HttpClient, ConfigService]\r\n  };\r\n}\r\n","import {\r\n  MissingTranslationHandler,\r\n  MissingTranslationHandlerParams\r\n} from '@ngx-translate/core';\r\n\r\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\r\n  handle(params: MissingTranslationHandlerParams) {\r\n    if (!params.translateService.langs.length) {\r\n      const error =\r\n        'Translations are not yet loaded. \\\r\n         Check that the LanguageService is injected.';\r\n      throw new Error(error);\r\n    }\r\n\r\n    if (params.key.substr(0, 4) === 'igo.') {\r\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\r\n    } else {\r\n      return params.key;\r\n    }\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport {\r\n  TranslateModule,\r\n  MissingTranslationHandler\r\n} from '@ngx-translate/core';\r\n\r\nimport { provideDefaultLanguageLoader } from './shared/language.provider';\r\nimport { IgoMissingTranslationHandler } from './shared/missing-translation.guard';\r\n\r\n@NgModule({\r\n  imports: [\r\n    TranslateModule.forRoot({\r\n      missingTranslationHandler: {\r\n        provide: MissingTranslationHandler,\r\n        useClass: IgoMissingTranslationHandler\r\n      }\r\n    })\r\n  ],\r\n  declarations: [],\r\n  exports: [TranslateModule]\r\n})\r\nexport class IgoLanguageModule {\r\n  static forRoot(): ModuleWithProviders<IgoLanguageModule> {\r\n    return {\r\n      ngModule: IgoLanguageModule,\r\n      providers: [provideDefaultLanguageLoader()]\r\n    };\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'igo-message-center',\r\n  templateUrl: './message-center.component.html',\r\n  styleUrls: ['./message-center.component.scss']\r\n})\r\nexport class MessageCenterComponent {\r\n  static defaultOptions = {\r\n    timeOut: 5000,\r\n    hasCloseIcon: false,\r\n    showProgressBar: true,\r\n    pauseOnHover: true,\r\n    clickToClose: true,\r\n    maxLength: 100,\r\n    maxStack: 3,\r\n    preventDuplicates: true\r\n  };\r\n\r\n  @Input()\r\n  get options(): any {\r\n    return Object.assign(\r\n      {},\r\n      MessageCenterComponent.defaultOptions,\r\n      this._options\r\n    );\r\n  }\r\n  set options(value: any) {\r\n    this._options = value;\r\n  }\r\n  private _options: any = {};\r\n\r\n  constructor() {}\r\n}\r\n","<simple-notifications\r\n  class=\"mat-typography\"\r\n  [ngClass]=\"{closeIcon: options.hasCloseIcon}\"\r\n  [options]=\"options\">\r\n</simple-notifications>\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { SimpleNotificationsModule } from '@igo2/angular2-notifications';\r\n\r\nimport { MessageCenterComponent } from './message-center/message-center.component';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, SimpleNotificationsModule.forRoot()],\r\n  declarations: [MessageCenterComponent],\r\n  exports: [MessageCenterComponent]\r\n})\r\nexport class IgoMessageModule {\r\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\r\n    return {\r\n      ngModule: IgoMessageModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LanguageService {\r\n  private language: string = this.translate.getBrowserLang();\r\n\r\n  constructor(public translate: TranslateService) {\r\n    const lang = this.getLanguage();\r\n    this.translate.setDefaultLang(lang);\r\n  }\r\n\r\n  public getLanguage(): string {\r\n    return this.language.match(/en|fr/) ? this.language : 'en';\r\n  }\r\n\r\n  public setLanguage(language: string) {\r\n    this.language = language.match(/en|fr/) ? language : 'en';\r\n    this.translate.use(this.language);\r\n    this.translate.reloadLang(this.language);\r\n  }\r\n}\r\n","export enum MessageType {\r\n  ERROR = 'error',\r\n  ALERT = 'alert',\r\n  INFO = 'info',\r\n  SUCCESS = 'success'\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport {\r\n  Notification,\r\n  NotificationsService,\r\n  NotificationType\r\n} from '@igo2/angular2-notifications';\r\n\r\nimport { ConfigService } from '../../config/config.service';\r\n\r\nimport { Message, MessageOptions } from './message.interface';\r\nimport { MessageType } from './message.enum';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MessageService {\r\n  public messages$ = new BehaviorSubject<Message[]>([]);\r\n  private options: MessageOptions;\r\n\r\n  constructor(\r\n    private notificationService: NotificationsService,\r\n    private configService: ConfigService\r\n  ) {\r\n    this.options = this.configService.getConfig('message') || {};\r\n  }\r\n\r\n  showError(httpError: HttpErrorResponse) {\r\n    httpError.error.caught = true;\r\n    return this.error(httpError.error.message, httpError.error.title);\r\n  }\r\n\r\n  message(message: Message) {\r\n    this.messages$.next(this.messages$.value.concat([message]));\r\n\r\n    message.options = message.options || {} as MessageOptions;\r\n    const currentDate = new Date();\r\n\r\n    message.options.from = message.options.from ? message.options.from : new Date('1 jan 1900');\r\n    message.options.to = message.options.to ? message.options.to : new Date('1 jan 3000');\r\n    if (typeof message.options.from === 'string') {\r\n      message.options.from = new Date(Date.parse(message.options.from.replace(/-/g, ' ')));\r\n    }\r\n    if (typeof message.options.to === 'string') {\r\n      message.options.to = new Date(Date.parse(message.options.to.replace(/-/g, ' ')));\r\n    }\r\n    if (\r\n      currentDate > message.options.from && currentDate < message.options.to) {\r\n\r\n      message = this.handleTemplate(message);\r\n\r\n      let notification: Notification;\r\n      if (message.text) {\r\n        notification = this.notificationService.create(\r\n          message.title,\r\n          message.text,\r\n          (message.type as any) as NotificationType,\r\n          message.options\r\n        );\r\n      } else if (message.html) {\r\n        if (!message.icon) {\r\n          message.options.theClass = message.options.theClass\r\n            ? message.options.theClass + ' noIcon'\r\n            : 'noIcon';\r\n        }\r\n\r\n        notification = this.notificationService.html(\r\n          message.html,\r\n          (message.type as any) as NotificationType,\r\n          message.options\r\n        );\r\n      } else {\r\n        return;\r\n      }\r\n\r\n      if (message.icon !== undefined) {\r\n        this.addIcon(notification, message.icon);\r\n      }\r\n      message.options.id = notification.id;\r\n      return notification;\r\n    }\r\n    return;\r\n  }\r\n\r\n  success(text: string, title?: string, options: any = {}) {\r\n    return this.message({\r\n      text,\r\n      title,\r\n      icon: options.icon || 'check',\r\n      options,\r\n      type: MessageType.SUCCESS\r\n    });\r\n  }\r\n\r\n  error(text: string, title?: string, options: any = {}) {\r\n    return this.message({\r\n      text,\r\n      title,\r\n      icon: options.icon || 'error_outline',\r\n      options,\r\n      type: MessageType.ERROR\r\n    });\r\n  }\r\n\r\n  info(text: string, title?: string, options: any = {}) {\r\n    return this.message({\r\n      text,\r\n      title,\r\n      icon: options.icon || 'info_outline',\r\n      options,\r\n      type: MessageType.INFO\r\n    });\r\n  }\r\n\r\n  alert(text: string, title?: string, options: any = {}) {\r\n    return this.message({\r\n      text,\r\n      title,\r\n      icon: options.icon || 'access_alarm',\r\n      options,\r\n      type: MessageType.ALERT\r\n    });\r\n  }\r\n\r\n  remove(id?: string) {\r\n    this.notificationService.remove(id);\r\n  }\r\n\r\n  removeAllAreNotError() {\r\n    for (const mess of this.messages$.value) {\r\n      if (mess.type !== 'error') {\r\n        this.remove(mess.options.id);\r\n      }\r\n    }\r\n  }\r\n\r\n  private addIcon(notification: Notification, icon: string) {\r\n    // There is no way to add an icon to a notification when reating\r\n    // it so we simply set it on the notification directly.\r\n    // See https://github.com/flauc/angular2-notifications/issues/165\r\n    notification.icon = `\r\n      <mat-icon class=\"material-icons mat-icon mat-list-avatar\" svgIcon=\"${icon}\">\r\n      </mat-icon>`;\r\n  }\r\n\r\n  private handleTemplate(message: Message): Message {\r\n    if (!this.options.template || message.html) {\r\n      return message;\r\n    }\r\n\r\n    let html = this.options.template;\r\n    html = html.replace('${text}', message.text);\r\n    html = html.replace('${title}', message.title);\r\n    html = html.replace('${icon}', message.icon);\r\n\r\n    message.html = html;\r\n    message.text = undefined;\r\n    message.title = undefined;\r\n    message.icon = undefined;\r\n    return message;\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport {\r\n  HttpInterceptor,\r\n  HttpHandler,\r\n  HttpRequest,\r\n  HttpEvent,\r\n  HttpErrorResponse\r\n} from '@angular/common/http';\r\n\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError, finalize } from 'rxjs/operators';\r\n\r\nimport { MessageService } from '../message/shared/message.service';\r\nimport { LanguageService } from '../language/shared/language.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ErrorInterceptor implements HttpInterceptor {\r\n  constructor(\r\n    private messageService: MessageService,\r\n    private injector: Injector\r\n  ) {}\r\n\r\n  intercept(\r\n    req: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    const errorContainer = { httpError: undefined };\r\n    return next.handle(req).pipe(\r\n      catchError(error => this.handleError(error, errorContainer)),\r\n      finalize(() => {\r\n        this.handleCaughtError(errorContainer);\r\n        this.handleUncaughtError(errorContainer);\r\n      })\r\n    );\r\n  }\r\n\r\n  private handleError(\r\n    httpError: HttpErrorResponse,\r\n    errorContainer: { httpError: HttpErrorResponse }\r\n  ) {\r\n    if (httpError instanceof HttpErrorResponse) {\r\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\r\n      errorObj.message = httpError.error.message || httpError.statusText;\r\n      errorObj.caught = false;\r\n\r\n      httpError = new HttpErrorResponse({\r\n        error: errorObj,\r\n        headers: httpError.headers,\r\n        status: httpError.status,\r\n        statusText: httpError.statusText,\r\n        url: httpError.url\r\n      });\r\n    }\r\n\r\n    errorContainer.httpError = httpError;\r\n    return throwError(httpError);\r\n  }\r\n\r\n  private handleCaughtError(errorContainer: { httpError: HttpErrorResponse }) {\r\n    const httpError = errorContainer.httpError;\r\n    if (httpError && httpError.error.toDisplay) {\r\n      httpError.error.caught = true;\r\n      this.messageService.error(httpError.error.message, httpError.error.title);\r\n    }\r\n  }\r\n\r\n  private handleUncaughtError(errorContainer: {\r\n    httpError: HttpErrorResponse;\r\n  }) {\r\n    const httpError = errorContainer.httpError;\r\n    if (httpError && !httpError.error.caught) {\r\n      const translate = this.injector.get(LanguageService).translate;\r\n      const message = translate.instant('igo.core.errors.uncaught.message');\r\n      const title = translate.instant('igo.core.errors.uncaught.title');\r\n      httpError.error.caught = true;\r\n      this.messageService.error(message, title);\r\n    }\r\n  }\r\n}\r\n","import {\r\n  NgModule,\r\n  ModuleWithProviders,\r\n  Optional,\r\n  SkipSelf\r\n} from '@angular/core';\r\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\r\n\r\nimport { ErrorInterceptor } from './error.interceptor';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoErrorModule {\r\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\r\n    return {\r\n      ngModule: IgoErrorModule,\r\n      providers: [\r\n        {\r\n          provide: HTTP_INTERCEPTORS,\r\n          useClass: ErrorInterceptor,\r\n          multi: true\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\r\n    if (parentModule) {\r\n      throw new Error(\r\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { Injectable, Inject, InjectionToken, Optional } from '@angular/core';\r\nimport { ActivatedRoute, Params } from '@angular/router';\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { RouteServiceOptions } from './route.interface';\r\n\r\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\r\n  'routeServiceOptions'\r\n);\r\n\r\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\r\n  return {\r\n    provide: ROUTE_SERVICE_OPTIONS,\r\n    useValue: options\r\n  };\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RouteService {\r\n  public options: RouteServiceOptions;\r\n\r\n  constructor(\r\n    public route: ActivatedRoute,\r\n    @Inject(ROUTE_SERVICE_OPTIONS)\r\n    @Optional()\r\n    options: RouteServiceOptions\r\n  ) {\r\n    const defaultOptions = {\r\n      centerKey: 'center',\r\n      zoomKey: 'zoom',\r\n      projectionKey: 'projection',\r\n      contextKey: 'context',\r\n      searchKey: 'search',\r\n      visibleOnLayersKey: 'visiblelayers',\r\n      visibleOffLayersKey: 'invisiblelayers',\r\n      directionsCoordKey: 'routing',\r\n      toolKey: 'tool',\r\n      wmsUrlKey: 'wmsUrl',\r\n      wmsLayersKey:  'wmsLayers',\r\n      wmtsUrlKey: 'wmtsUrl',\r\n      wmtsLayersKey:  'wmtsLayers',\r\n      arcgisUrlKey: 'arcgisUrl',\r\n      arcgisLayersKey:  'arcgisLayers',\r\n      iarcgisUrlKey: 'iarcgisUrl',\r\n      iarcgisLayersKey:  'iarcgisLayers',\r\n      tarcgisUrlKey: 'tarcgisUrl',\r\n      tarcgisLayersKey:  'tarcgisLayers',\r\n      vectorKey: 'vector'\r\n    };\r\n    this.options = Object.assign({}, defaultOptions, options);\r\n  }\r\n\r\n  get queryParams(): Observable<Params> {\r\n    return this.route.queryParams;\r\n  }\r\n}\r\n","export enum Media {\r\n  Mobile = 'mobile',\r\n  Tablet = 'tablet',\r\n  Desktop = 'desktop'\r\n}\r\n\r\nexport enum MediaOrientation {\r\n  Portrait = 'portrait',\r\n  Landscape = 'landscape'\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Breakpoints, BreakpointObserver } from '@angular/cdk/layout';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Media, MediaOrientation } from './media.enum';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MediaService {\r\n  public media$ = new BehaviorSubject<Media>(undefined);\r\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\r\n\r\n  constructor(breakpointObserver: BreakpointObserver) {\r\n    breakpointObserver\r\n      .observe([Breakpoints.HandsetLandscape])\r\n      .subscribe(res => {\r\n        if (res.matches) {\r\n          this.media$.next(Media.Mobile);\r\n          this.orientation$.next(MediaOrientation.Landscape);\r\n        }\r\n      });\r\n\r\n    breakpointObserver.observe([Breakpoints.HandsetPortrait]).subscribe(res => {\r\n      if (res.matches) {\r\n        this.media$.next(Media.Mobile);\r\n        this.orientation$.next(MediaOrientation.Portrait);\r\n      }\r\n    });\r\n\r\n    breakpointObserver.observe([Breakpoints.TabletLandscape]).subscribe(res => {\r\n      if (res.matches) {\r\n        this.media$.next(Media.Tablet);\r\n        this.orientation$.next(MediaOrientation.Landscape);\r\n      }\r\n    });\r\n\r\n    breakpointObserver.observe([Breakpoints.TabletPortrait]).subscribe(res => {\r\n      if (res.matches) {\r\n        this.media$.next(Media.Tablet);\r\n        this.orientation$.next(MediaOrientation.Portrait);\r\n      }\r\n    });\r\n\r\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe(res => {\r\n      if (res.matches) {\r\n        this.media$.next(Media.Desktop);\r\n        this.orientation$.next(MediaOrientation.Landscape);\r\n      }\r\n    });\r\n\r\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe(res => {\r\n      if (res.matches) {\r\n        this.media$.next(Media.Desktop);\r\n        this.orientation$.next(MediaOrientation.Portrait);\r\n      }\r\n    });\r\n  }\r\n\r\n  getMedia(): Media {\r\n    return this.media$.value;\r\n  }\r\n\r\n  getOrientation(): MediaOrientation {\r\n    return this.orientation$.value;\r\n  }\r\n\r\n  isTouchScreen(): boolean {\r\n    return 'ontouchstart' in document.documentElement ? true : false;\r\n  }\r\n\r\n  isMobile(): boolean {\r\n    const media = this.getMedia();\r\n    return media === 'mobile';\r\n  }\r\n\r\n  isDesktop(): boolean {\r\n    const media = this.getMedia();\r\n    return media === 'desktop';\r\n  }\r\n}\r\n","export enum StorageScope {\r\n  SESSION = 'Session',\r\n  LOCAL = 'Local'\r\n}\r\n\r\nexport interface StorageOptions {\r\n  key: string;\r\n}\r\n\r\nexport interface StorageServiceEvent {\r\n  key?: string;\r\n  scope: StorageScope;\r\n  event: StorageServiceEventEnum;\r\n  previousValue?: any;\r\n  currentValue?: any;\r\n}\r\n\r\nexport enum StorageServiceEventEnum {\r\n  ADDED = 'Added',\r\n  MODIFIED = 'Modified',\r\n  REMOVED = 'Removed',\r\n  CLEARED = 'Cleared'\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '../config/config.service';\r\nimport { StorageScope, StorageOptions, StorageServiceEvent, StorageServiceEventEnum } from './storage.interface';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StorageService {\r\n  protected options: StorageOptions;\r\n\r\n  public storageChange$: BehaviorSubject<StorageServiceEvent> = new BehaviorSubject(undefined);\r\n\r\n  constructor(private config: ConfigService) {\r\n    this.options = this.config.getConfig('storage') || { key: 'igo' };\r\n  }\r\n  /**\r\n   * Use to get the data found in storage file\r\n   */\r\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\r\n    let value: any;\r\n\r\n    if (!scope || scope === StorageScope.SESSION) {\r\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\r\n    }\r\n\r\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\r\n      value = localStorage.getItem(`${this.options.key}.${key}`);\r\n    }\r\n\r\n    if (value) {\r\n      try {\r\n        value = JSON.parse(value);\r\n      } catch {\r\n        value = value;\r\n      }\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  set(\r\n    key: string,\r\n    value: string | object | boolean | number,\r\n    scope: StorageScope = StorageScope.LOCAL\r\n  ) {\r\n    const previousValue = this.get(key, scope);\r\n    if (scope === StorageScope.SESSION) {\r\n      sessionStorage.setItem(\r\n        `${this.options.key}.${key}`,\r\n        JSON.stringify(value)\r\n      );\r\n    } else {\r\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\r\n    }\r\n    const currentValue = this.get(key, scope);\r\n\r\n    if (currentValue !== previousValue) {\r\n      this.storageChange$.next({\r\n        key, scope,\r\n        event: previousValue !== undefined ? StorageServiceEventEnum.MODIFIED : StorageServiceEventEnum.ADDED,\r\n        previousValue,\r\n        currentValue\r\n      });\r\n    }\r\n  }\r\n\r\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\r\n    const previousValue = this.get(key, scope);\r\n    if (scope === StorageScope.SESSION) {\r\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\r\n    } else {\r\n      localStorage.removeItem(`${this.options.key}.${key}`);\r\n    }\r\n    this.storageChange$.next({key, scope, event: StorageServiceEventEnum.REMOVED, previousValue });\r\n  }\r\n\r\n  clear(scope: StorageScope = StorageScope.LOCAL) {\r\n    if (scope === StorageScope.SESSION) {\r\n      sessionStorage.clear();\r\n    } else {\r\n      localStorage.clear();\r\n    }\r\n    this.storageChange$.next({scope, event: StorageServiceEventEnum.CLEARED });\r\n  }\r\n}\r\n","import { Injectable, EventEmitter, OnDestroy, Injector } from '@angular/core';\r\nimport { Observable, Subscription, fromEvent } from 'rxjs';\r\nimport { debounceTime, startWith } from 'rxjs/operators';\r\n\r\nimport { MessageService } from '../message/shared/message.service';\r\nimport { LanguageService } from '../language/shared/language.service';\r\nimport { ConnectionState } from './network.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NetworkService implements OnDestroy {\r\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\r\n  private onlineSubscription: Subscription;\r\n  private offlineSubscription: Subscription;\r\n\r\n  private state: ConnectionState = {\r\n    connection: window.navigator.onLine\r\n  };\r\n\r\n  constructor(\r\n    private messageService: MessageService,\r\n    private injector: Injector\r\n  ) {\r\n      this.checkNetworkState();\r\n  }\r\n\r\n  private checkNetworkState() {\r\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\r\n      const translate = this.injector.get(LanguageService).translate;\r\n      const message = translate.instant('igo.core.network.online.message');\r\n      const title = translate.instant('igo.core.network.online.title');\r\n      this.messageService.info(message, title);\r\n      this.state.connection = true;\r\n      this.emitEvent();\r\n    });\r\n\r\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\r\n      const translate = this.injector.get(LanguageService).translate;\r\n      const message = translate.instant('igo.core.network.offline.message');\r\n      const title = translate.instant('igo.core.network.offline.title');\r\n      this.messageService.info(message, title);\r\n      this.state.connection = false;\r\n      this.emitEvent();\r\n    });\r\n  }\r\n\r\n  private emitEvent() {\r\n    this.stateChangeEventEmitter.emit(this.state);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    try {\r\n      this.offlineSubscription.unsubscribe();\r\n      this.onlineSubscription.unsubscribe();\r\n    } catch (e) {}\r\n  }\r\n\r\n  currentState(reportState = true): Observable<ConnectionState> {\r\n    return reportState\r\n      ? this.stateChangeEventEmitter.pipe(\r\n          debounceTime(300),\r\n          startWith(this.state)\r\n        )\r\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\r\n  }\r\n}\r\n","export enum EntityOperationType {\r\n  Insert = 'Insert',\r\n  Update = 'Update',\r\n  Delete = 'Delete'\r\n}\r\n\r\nexport enum EntityTableColumnRenderer {\r\n  Default = 'Default',\r\n  HTML = 'HTML',\r\n  UnsanitizedHTML = 'UnsanitizedHTML',\r\n  Icon = 'Icon',\r\n  ButtonGroup = 'ButtonGroup'\r\n}\r\n\r\nexport enum EntityTableScrollBehavior {\r\n  Auto = 'auto',\r\n  Instant = 'instant',\r\n  Smooth = 'smooth'\r\n}\r\n\r\nexport enum EntityTableSelectionState {\r\n  None = 'None',\r\n  All = 'All',\r\n  Some = 'Some'\r\n}\r\n","import t from 'typy';\r\n\r\nimport { EntityKey } from './entity.interfaces';\r\n\r\n/**\r\n * Get an entity's named property. Nested properties are supported\r\n * with the dotted notation. (i.e 'author.name')\r\n *\r\n * Note: this method is a 'best attempt' at getting an entity's property.\r\n * It fits the most common cases but you might need to explicitely define\r\n * a property getter when using an EntityStore, for example.\r\n * @param entity Entity\r\n * @param property Property name\r\n * @returns Property value\r\n */\r\nexport function getEntityProperty(entity: object, property: string): any {\r\n  return t(entity, property).safeObject;\r\n}\r\n\r\n/**\r\n * Get an entity's id. An entity's id can be one of:\r\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\r\n *\r\n * Note: See the note in the 'getEntityProperty' documentation.\r\n * @param entity Entity\r\n * @returns Entity id\r\n */\r\nexport function getEntityId(entity: object): EntityKey {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\r\n}\r\n\r\n/**\r\n * Get an entity's title. An entity's title can be one of:\r\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\r\n * @param entity Entity\r\n * @returns Entity title\r\n */\r\nexport function getEntityTitle(entity: object): string {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.title ? meta.title : getEntityProperty(entity, meta.titleProperty || 'title');\r\n}\r\n\r\n/**\r\n * Get an entity's HTML title. An entity's HTML title can be one of:\r\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\r\n * @param entity Entity\r\n * @returns Entity HTML title\r\n */\r\nexport function getEntityTitleHtml(entity: object): string {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.titleHtml ? meta.titleHtml : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\r\n}\r\n\r\n/**\r\n * Get an entity's icon. An entity's icon can be one of:\r\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\r\n * @param entity Entity\r\n * @returns Entity icon\r\n */\r\nexport function getEntityIcon(entity: object): string {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.icon ? meta.icon : getEntityProperty(entity, meta.iconProperty || 'icon');\r\n}\r\n\r\n/**\r\n * Get an entity's revision.\r\n * @param entity Entity\r\n * @returns Entity revision\r\n */\r\nexport function getEntityRevision(entity: object): number {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.revision || 0;\r\n}\r\n","import { ReplaySubject } from 'rxjs';\r\n\r\nimport { EntityKey, EntityState, EntityStateManagerOptions } from './entity.interfaces';\r\nimport { getEntityId } from './entity.utils';\r\nimport { EntityStore } from './store';\r\n\r\n/**\r\n * This class is used to track a store's entities state\r\n */\r\nexport class EntityStateManager<E extends object, S extends EntityState = EntityState> {\r\n\r\n  /**\r\n   * State index\r\n   */\r\n  readonly index = new Map<EntityKey, S>();\r\n\r\n  /**\r\n   * Change emitter\r\n   */\r\n  readonly change$ = new ReplaySubject<void>(1);\r\n\r\n  /**\r\n   * Method to get an entity's id\r\n   */\r\n  readonly getKey: (E) => EntityKey;\r\n\r\n  private store: EntityStore<object> | undefined;\r\n\r\n  constructor(options: EntityStateManagerOptions = {}) {\r\n    this.store = options.store ? options.store : undefined;\r\n    this.getKey = options.getKey\r\n      ? options.getKey\r\n      : (this.store ? this.store.getKey : getEntityId);\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Clear state\r\n   */\r\n  clear() {\r\n    if (this.index.size > 0) {\r\n      this.index.clear();\r\n      this.next();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get an entity's state\r\n   * @param entity Entity\r\n   * @returns State\r\n   */\r\n  get(entity: E): S {\r\n    return (this.index.get(this.getKey(entity)) || {}) as S;\r\n  }\r\n\r\n  /**\r\n   * Set an entity's state\r\n   * @param entity Entity\r\n   * @param state State\r\n   */\r\n  set(entity: E, state: S) {\r\n    this.setMany([entity], state);\r\n  }\r\n\r\n  /**\r\n   * Set many entitie's state\r\n   * @param entitie Entities\r\n   * @param state State\r\n   */\r\n  setMany(entities: E[], state: S) {\r\n    entities.forEach((entity: E) => {\r\n      this.index.set(this.getKey(entity), Object.assign({}, state));\r\n    });\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Set state of all entities that already have a state. This is not\r\n   * the same as setting the state of all the store's entities.\r\n   * @param state State\r\n   */\r\n  setAll(state: S) {\r\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\r\n      this.index.set(key, Object.assign({}, state));\r\n    });\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Update an entity's state\r\n   * @param entity Entity\r\n   * @param changes State changes\r\n   */\r\n  update(entity: E, changes: Partial<S>, exclusive = false) {\r\n    this.updateMany([entity], changes, exclusive);\r\n  }\r\n\r\n  /**\r\n   * Update many entitie's state\r\n   * @param entitie Entities\r\n   * @param changes State changes\r\n   */\r\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\r\n    if (exclusive === true) {\r\n      return this.updateManyExclusive(entities, changes);\r\n    }\r\n\r\n    entities.forEach((entity: E) => {\r\n      const state = Object.assign({}, this.get(entity), changes);\r\n      this.index.set(this.getKey(entity), state);\r\n    });\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Reversee an entity's state\r\n   * @param entity Entity\r\n   * @param keys State keys to reverse\r\n   */\r\n  reverse(entity: E, keys: string[]) {\r\n    this.reverseMany([entity], keys);\r\n  }\r\n\r\n  /**\r\n   * Reverse many entitie's state\r\n   * @param entitie Entities\r\n   * @param keys State keys to reverse\r\n   */\r\n  reverseMany(entities: E[], keys: string[]) {\r\n    entities.forEach((entity: E) => {\r\n      const currentState = this.get(entity);\r\n      const changes = keys.reduce((acc: {[key: string]: boolean}, key: string) => {\r\n        acc[key] = currentState[key] || false;\r\n        return acc;\r\n      }, {}) as Partial<S>;\r\n      const reversedChanges = this.reverseChanges(changes);\r\n      const state = Object.assign({}, currentState, reversedChanges);\r\n      this.index.set(this.getKey(entity), state);\r\n    });\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Update state of all entities that already have a state. This is not\r\n   * the same as updating the state of all the store's entities.\r\n   * @param changes State\r\n   */\r\n  updateAll(changes: Partial<S>) {\r\n    const allKeys = this.getAllKeys();\r\n    Array.from(allKeys).forEach((key: EntityKey) => {\r\n      const state = Object.assign({}, this.index.get(key), changes);\r\n      this.index.set(key, state);\r\n    });\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * When some state changes are flagged as 'exclusive', reverse\r\n   * the state of all other entities. Changes are reversable when\r\n   * they are boolean.\r\n   * @param entitie Entities\r\n   * @param changes State changes\r\n   */\r\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\r\n    const reverseChanges = this.reverseChanges(changes);\r\n\r\n    const keys = entities.map((entity: E) => this.getKey(entity));\r\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\r\n    allKeys.forEach((key: EntityKey) => {\r\n      const state = this.index.get(key) || {} as S;\r\n\r\n      if (keys.indexOf(key) >= 0) {\r\n        this.index.set(key, Object.assign({}, state, changes));\r\n      } else {\r\n        // Update only if the reverse changes would modify\r\n        // a key already present in the current state\r\n        const shouldUpdate = Object.keys(reverseChanges).some((changeKey: string) => {\r\n          return state[changeKey] !== undefined &&\r\n            state[changeKey] !== reverseChanges[changeKey];\r\n        });\r\n        if (shouldUpdate === true) {\r\n          this.index.set(key, Object.assign({}, state, reverseChanges));\r\n        }\r\n      }\r\n    });\r\n\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Compute a 'reversed' version of some state changes.\r\n   * Changes are reversable when they are boolean.\r\n   * @param changes State changes\r\n   * @returns Reversed state changes\r\n   */\r\n  private reverseChanges(changes: Partial<S>): Partial<S> {\r\n    return Object.entries(changes).reduce((reverseChanges: Partial<S>, bunch: [string, any]) => {\r\n      const [changeKey, value] = bunch;\r\n      if (typeof value === typeof true) {\r\n        (reverseChanges as object)[changeKey] = !value;\r\n      }\r\n      return reverseChanges;\r\n    }, {});\r\n  }\r\n\r\n  /**\r\n   * Return all the keys in that state and in the store it's bound to, if any.\r\n   * @returns Set of keys\r\n   */\r\n  private getAllKeys(): Set<EntityKey> {\r\n    const storeKeys = this.store ? Array.from(this.store.index.keys()) : [];\r\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\r\n  }\r\n\r\n  /**\r\n   * Emit 'change' event\r\n   */\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n}\r\n","import { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime, map, skip } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils, uuid } from '@igo2/utils';\r\nimport {\r\n  EntityKey,\r\n  EntityFilterClause,\r\n  EntitySortClause,\r\n  EntityJoinClause\r\n} from './entity.interfaces';\r\n\r\n/**\r\n * An entity view streams entities from an observable source. These entities\r\n * can be filtered or sorted without affecting the source. A view can also\r\n * combine data from multiple sources, joined together.\r\n */\r\nexport class EntityView<E extends object, V extends object = E> {\r\n\r\n  /**\r\n   * Observable stream of values\r\n   */\r\n  readonly values$ = new BehaviorSubject<V[]>([]);\r\n\r\n  /**\r\n   * Subscription to the source (and joined sources) values\r\n   */\r\n  private values$$: Subscription;\r\n\r\n  /**\r\n   * Whether this view has been lifted\r\n   */\r\n  private lifted = false;\r\n\r\n  /**\r\n   * Join clauses\r\n   */\r\n  private joins: EntityJoinClause[] = [];\r\n\r\n  /**\r\n   * Observable of a filter clause\r\n   */\r\n  private filter$ = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Observable of filter clauses\r\n   */\r\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * Filters index\r\n   */\r\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\r\n\r\n  /**\r\n   * Observable of a sort clause\r\n   */\r\n  private sort$ = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Method for indexing\r\n   */\r\n  get getKey(): (V) => EntityKey { return this.getKey$.value; }\r\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Number of entities\r\n   */\r\n  readonly count$ = new BehaviorSubject<number>(0);\r\n  get count(): number { return this.count$.value; }\r\n\r\n  /**\r\n   * Whether the store is empty\r\n   */\r\n  readonly empty$ = new BehaviorSubject<boolean>(true);\r\n  get empty(): boolean { return this.empty$.value; }\r\n\r\n  /**\r\n   * Store index\r\n   */\r\n  get index(): Map<EntityKey, V> { return this._index; }\r\n  private _index: Map<EntityKey, V>;\r\n\r\n  constructor(private source$: BehaviorSubject<E[]>) {}\r\n\r\n  /**\r\n   * Get a value from the view by key\r\n   * @param key Key\r\n   * @returns Value\r\n   */\r\n  get(key: EntityKey): V {\r\n    if (this._index === undefined) {\r\n      throw new Error('This view has no index, therefore, this method is unavailable.');\r\n    }\r\n    return this.index.get(key);\r\n  }\r\n\r\n  /**\r\n   * Get all the values\r\n   * @returns Array of values\r\n   */\r\n  all(): V[] {\r\n    return this.values$.value;\r\n  }\r\n\r\n  /**\r\n   * Observe all the values\r\n   * @returns Observable of values\r\n   */\r\n  all$(): BehaviorSubject<V[]> {\r\n    return this.values$;\r\n  }\r\n\r\n  /**\r\n   * Get the first value that respects a criteria\r\n   * @returns A value\r\n   */\r\n  firstBy(clause: EntityFilterClause<V>): V {\r\n    return this.values$.value.find(clause);\r\n  }\r\n\r\n  /**\r\n   * Observe the first value that respects a criteria\r\n   * @returns Observable of a value\r\n   */\r\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\r\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\r\n  }\r\n\r\n  /**\r\n   * Get all the values that respect a criteria\r\n   * @returns Array of values\r\n   */\r\n  manyBy(clause: EntityFilterClause<V>): V[] {\r\n    return this.values$.value.filter(clause);\r\n  }\r\n\r\n  /**\r\n   * Observe all the values that respect a criteria\r\n   * @returns Observable of values\r\n   */\r\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\r\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\r\n  }\r\n\r\n  /**\r\n   * Clear the filter and sort and unsubscribe from the source\r\n   */\r\n  clear() {\r\n    this.filter(undefined);\r\n    this.sort(undefined);\r\n  }\r\n\r\n  destroy() {\r\n    if (this.values$$ !== undefined) {\r\n      this.values$$.unsubscribe();\r\n    }\r\n    this.clear();\r\n  }\r\n\r\n  /**\r\n   * Create an index\r\n   * @param getKey Method to get a value's id\r\n   * @returns The view\r\n   */\r\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\r\n    this._index = new Map();\r\n    this.getKey$.next(getKey);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Join another source to the stream (chainable)\r\n   * @param clause Join clause\r\n   * @returns The view\r\n   */\r\n  join(clause: EntityJoinClause): EntityView<E, V> {\r\n    if (this.lifted === true) {\r\n      throw new Error('This view has already been lifted, therefore, no join is allowed.');\r\n    }\r\n    this.joins.push(clause);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Filter values (chainable)\r\n   * @param clause Filter clause\r\n   * @returns The view\r\n   */\r\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\r\n    this.filter$.next(clause);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param clause Filter clause\r\n   * @returns The filter id\r\n   */\r\n  addFilter(clause: EntityFilterClause<V>): string {\r\n    const id = uuid();\r\n    this.filterIndex.set(id, clause);\r\n    this.filters$.next(Array.from(this.filterIndex.values()));\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Remove a filter by id\r\n   * @param clause Filter clause\r\n   */\r\n  removeFilter(id: string) {\r\n    this.filterIndex.delete(id);\r\n    this.filters$.next(Array.from(this.filterIndex.values()));\r\n  }\r\n\r\n  /**\r\n   * Sort values (chainable)\r\n   * @param clauseSort clause\r\n   * @returns The view\r\n   */\r\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\r\n    this.sort$.next(clause);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Create the final observable\r\n   * @returns Observable\r\n   */\r\n  lift() {\r\n    this.lifted = true;\r\n    const source$ = this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\r\n    const observables$ = [\r\n      source$,\r\n      this.filters$,\r\n      this.filter$,\r\n      this.sort$,\r\n      this.getKey$\r\n    ];\r\n\r\n    this.values$$ = combineLatest(observables$)\r\n      .pipe(skip(1), debounceTime(5))\r\n      .subscribe((bunch: [V[],  EntityFilterClause[], EntityFilterClause, EntitySortClause, (V) => EntityKey]) => {\r\n        const [_values, filters, filter, sort, getKey] = bunch;\r\n        const values = this.processValues(_values, filters, filter, sort);\r\n        const generateIndex = getKey !== undefined;\r\n        this.setValues(values, generateIndex);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Create the source observable when no joins are defined\r\n   * @returns Observable\r\n   */\r\n  private liftSource(): Observable<V[]> {\r\n    return this.source$ as any as Observable<V[]>;\r\n  }\r\n\r\n  /**\r\n   * Create the source observable when joins are defined\r\n   * @returns Observable\r\n   */\r\n  private liftJoinedSource(): Observable<V[]> {\r\n    const sources$ = [this.source$, combineLatest(\r\n      this.joins.map((join: EntityJoinClause) => join.source)\r\n    )];\r\n\r\n    return combineLatest(sources$)\r\n      .pipe(\r\n        map((bunch: [E[], any[]]) => {\r\n          const [entities, joinData] = bunch;\r\n          return entities.reduce((values: V[], entity: E) => {\r\n            const value = this.computeJoinedValue(entity, joinData);\r\n            if (value !== undefined) {\r\n              values.push(value);\r\n            }\r\n            return values;\r\n          }, []);\r\n        })\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Apply joins to a source's entity and return the final value\r\n   * @returns Final value\r\n   */\r\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\r\n    let value = entity as Partial<V>;\r\n    let joinIndex = 0;\r\n    while (value !== undefined && joinIndex < this.joins.length) {\r\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\r\n      joinIndex += 1;\r\n    }\r\n    return value as V;\r\n  }\r\n\r\n  /**\r\n   * Filter and sort values before streaming them\r\n   * @param values Values\r\n   * @param filters Filter clauses\r\n   * @param filter Filter clause\r\n   * @param sort Sort clause\r\n   * @returns Filtered and sorted values\r\n   */\r\n  private processValues(\r\n    values: V[], filters: EntityFilterClause[],  filter: EntityFilterClause, sort: EntitySortClause\r\n  ): V[] {\r\n    values = values.slice(0);\r\n    values = this.filterValues(values, filters.concat([filter]));\r\n    values = this.sortValues(values, sort);\r\n    return values;\r\n  }\r\n\r\n  /**\r\n   * Filter values\r\n   * @param values Values\r\n   * @param filters Filter clauses\r\n   * @returns Filtered values\r\n   */\r\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\r\n    if (clauses.length === 0) { return values; }\r\n\r\n    return values\r\n      .filter((value: V) => {\r\n        return clauses\r\n          .filter((clause: EntityFilterClause) => clause !== undefined)\r\n          .every((clause: EntityFilterClause) => clause(value));\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Sort values\r\n   * @param values Values\r\n   * @param sort Sort clause\r\n   * @returns Sorted values\r\n   */\r\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\r\n    if (clause === undefined) { return values; }\r\n    return values.sort((v1: V, v2: V) => {\r\n      return ObjectUtils.naturalCompare(\r\n        clause.valueAccessor(v1),\r\n        clause.valueAccessor(v2),\r\n        clause.direction,\r\n        clause.nullsFirst\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set value and optionally generate an index\r\n   * @param values Values\r\n   * @param generateIndex boolean\r\n   */\r\n  private setValues(values: V[], generateIndex: boolean) {\r\n    if (generateIndex === true) {\r\n      this._index = this.generateIndex(values);\r\n    }\r\n\r\n    this.values$.next(values);\r\n\r\n    const count = values.length;\r\n    const empty = count === 0;\r\n    this.count$.next(count);\r\n    this.empty$.next(empty);\r\n  }\r\n\r\n  /**\r\n   * Generate a complete index of all the values\r\n   * @param entities Entities\r\n   * @returns Index\r\n   */\r\n  private generateIndex(values: V[]): Map<EntityKey, V> {\r\n    const entries = values.map((value: V) => [this.getKey(value), value]);\r\n    return new Map(entries as [EntityKey, V][]);\r\n  }\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStateManager } from './state';\r\nimport { EntityView } from './view';\r\nimport { EntityKey, EntityState, EntityRecord, EntityStoreOptions } from './entity.interfaces';\r\nimport { getEntityId, getEntityProperty } from './entity.utils';\r\nimport { EntityStoreStrategy } from './strategies/strategy';\r\n\r\n/**\r\n * An entity store class holds any number of entities\r\n * as well as their state. It can be observed, filtered and sorted and\r\n * provides methods to insert, update or delete entities.\r\n */\r\nexport class EntityStore<E extends object = object, S extends EntityState = EntityState> {\r\n\r\n  /**\r\n   * Observable of the raw entities\r\n   */\r\n  readonly entities$ = new BehaviorSubject<E[]>([]);\r\n\r\n  /**\r\n   * Number of entities\r\n   */\r\n  readonly count$ = new BehaviorSubject<number>(0);\r\n  get count(): number { return this.count$.value; }\r\n\r\n  /**\r\n   * Whether the store is empty\r\n   */\r\n  readonly empty$ = new BehaviorSubject<boolean>(true);\r\n  get empty(): boolean { return this.empty$.value; }\r\n\r\n  /**\r\n   * Entity store state\r\n   */\r\n  readonly state: EntityStateManager<E, S>;\r\n\r\n  /**\r\n   * View of all the entities\r\n   */\r\n  readonly view: EntityView<E>;\r\n\r\n  /**\r\n   * View of all the entities and their state\r\n   */\r\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\r\n\r\n  /**\r\n   * Method to get an entity's id\r\n   */\r\n  readonly getKey: (E) => EntityKey;\r\n\r\n  /**\r\n   * Method to get an entity's named property\r\n   */\r\n  readonly getProperty: (E, prop: string) => any;\r\n\r\n  /**\r\n   * Store index\r\n   */\r\n  get index(): Map<EntityKey, E> { return this._index; }\r\n  private _index: Map<EntityKey, E>;\r\n\r\n  /**\r\n   * Store index\r\n   */\r\n  get pristine(): boolean { return this._pristine; }\r\n  private _pristine: boolean = true;\r\n\r\n  /**\r\n   * Strategies\r\n   */\r\n  private strategies: EntityStoreStrategy[] = [];\r\n\r\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\r\n    this.getKey = options.getKey ? options.getKey : getEntityId;\r\n    this.getProperty = options.getProperty ? options.getProperty : getEntityProperty;\r\n\r\n    this.state = this.createStateManager();\r\n    this.view = this.createDataView();\r\n    this.stateView = this.createStateView();\r\n\r\n    this.view.lift();\r\n    this.stateView.lift();\r\n\r\n    if (entities.length > 0) {\r\n      this.load(entities);\r\n    } else {\r\n      this._index = this.generateIndex(entities);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get an entity from the store by key\r\n   * @param key Key\r\n   * @returns Entity\r\n   */\r\n  get(key: EntityKey): E {\r\n    return this.index.get(key);\r\n  }\r\n\r\n  /**\r\n   * Get all entities in the store\r\n   * @returns Array of entities\r\n   */\r\n  all(): E[] {\r\n    return this.entities$.value;\r\n  }\r\n\r\n  /**\r\n   * Set this store's entities\r\n   * @param entities Entities\r\n   */\r\n  load(entities: E[], pristine: boolean = true) {\r\n    this._index = this.generateIndex(entities);\r\n    this._pristine = pristine;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Clear the store's entities but keep the state and views intact.\r\n   * Views won't return any data but future data will be subject to the\r\n   * current views filter and sort\r\n   */\r\n  softClear() {\r\n    if (this.index && this.index.size > 0) {\r\n      this.index.clear();\r\n      this._pristine = true;\r\n      this.next();\r\n    } else if (this.index) {\r\n      this.updateCount();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the store's entities, state and views\r\n   */\r\n  clear() {\r\n    this.stateView.clear();\r\n    this.view.clear();\r\n    this.state.clear();\r\n    this.softClear();\r\n  }\r\n\r\n  destroy() {\r\n    this.stateView.destroy();\r\n    this.view.destroy();\r\n    this.clear();\r\n  }\r\n\r\n  /**\r\n   * Insert an entity into the store\r\n   * @param entity Entity\r\n   */\r\n  insert(entity: E) {\r\n    this.insertMany([entity]);\r\n  }\r\n\r\n  /**\r\n   * Insert many entities into the store\r\n   * @param entities Entities\r\n   */\r\n  insertMany(entities: E[]) {\r\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\r\n    this._pristine = false;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Update or insert an entity into the store\r\n   * @param entity Entity\r\n   */\r\n  update(entity: E) {\r\n    this.updateMany([entity]);\r\n  }\r\n\r\n  /**\r\n   * Update or insert many entities into the store\r\n   * @param entities Entities\r\n   */\r\n  updateMany(entities: E[]) {\r\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\r\n    this._pristine = false;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Delete an entity from the store\r\n   * @param entity Entity\r\n   */\r\n  delete(entity: E) {\r\n    this.deleteMany([entity]);\r\n  }\r\n\r\n  /**\r\n   * Delete many entities from the store\r\n   * @param entities Entities\r\n   */\r\n  deleteMany(entities: E[]) {\r\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\r\n    this._pristine = false;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Add a strategy to this store\r\n   * @param strategy Entity store strategy\r\n   * @returns Entity store\r\n   */\r\n  addStrategy(strategy: EntityStoreStrategy, activate: boolean = false): EntityStore {\r\n    const existingStrategy = this.strategies.find((_strategy: EntityStoreStrategy) => {\r\n      return strategy.constructor === _strategy.constructor;\r\n    });\r\n    if (existingStrategy !== undefined) {\r\n      throw new Error('A strategy of this type already exists on that EntityStore.');\r\n    }\r\n\r\n    this.strategies.push(strategy);\r\n    strategy.bindStore(this);\r\n\r\n    if (activate === true) {\r\n      strategy.activate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove a strategy from this store\r\n   * @param strategy Entity store strategy\r\n   * @returns Entity store\r\n   */\r\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\r\n    const index = this.strategies.indexOf(strategy);\r\n    if (index >= 0) {\r\n      this.strategies.splice(index, 1);\r\n      strategy.unbindStore(this);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Return strategies of a given type\r\n   * @param type Entity store strategy class\r\n   * @returns Strategies\r\n   */\r\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\r\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\r\n      return strategy instanceof type;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate strategies of a given type\r\n   * @param type Entity store strategy class\r\n   */\r\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\r\n    const strategy = this.getStrategyOfType(type);\r\n    if (strategy !== undefined) {\r\n      strategy.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate strategies of a given type\r\n   * @param type Entity store strategy class\r\n   */\r\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\r\n    const strategy = this.getStrategyOfType(type);\r\n    if (strategy !== undefined) {\r\n      strategy.deactivate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate a complete index of all the entities\r\n   * @param entities Entities\r\n   * @returns Index\r\n   */\r\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\r\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\r\n    return new Map(entries as [EntityKey, E][]);\r\n  }\r\n\r\n  /**\r\n   * Push the index's entities into the entities$ observable\r\n   */\r\n  private next() {\r\n    this.entities$.next(Array.from(this.index.values()));\r\n    this.updateCount();\r\n  }\r\n\r\n  /**\r\n   * Update the store's count and empty\r\n   */\r\n  private updateCount() {\r\n    const count = this.index.size;\r\n    const empty = count === 0;\r\n    this.count$.next(count);\r\n    this.empty$.next(empty);\r\n  }\r\n\r\n  /**\r\n   * Create the entity state manager\r\n   * @returns EntityStateManager\r\n   */\r\n  private createStateManager() {\r\n    return new EntityStateManager<E, S>({store: this});\r\n  }\r\n\r\n  /**\r\n   * Create the data view\r\n   * @returns EntityView<E>\r\n   */\r\n  private createDataView() {\r\n    return new EntityView<E>(this.entities$);\r\n  }\r\n\r\n  /**\r\n   * Create the state view\r\n   * @returns EntityView<EntityRecord<E>>\r\n   */\r\n  private createStateView() {\r\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\r\n      .join({\r\n        source: this.state.change$,\r\n        reduce: (entity: E): EntityRecord<E, S> => {\r\n          const key = this.getKey(entity);\r\n          const state = this.state.get(entity);\r\n          const currentRecord = this.stateView.get(key);\r\n\r\n          if (\r\n            currentRecord !== undefined &&\r\n            currentRecord.entity === entity &&\r\n            this.statesAreTheSame(currentRecord.state, state)\r\n          ) {\r\n            return currentRecord;\r\n          }\r\n\r\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\r\n          const ref = `${key}-${revision}`;\r\n          return {entity, state, revision, ref};\r\n        }\r\n      })\r\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\r\n  }\r\n\r\n  private statesAreTheSame(currentState: S, newState: S): boolean {\r\n    if (currentState === newState) {\r\n      return true;\r\n    }\r\n\r\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\r\n    const newStateIsEmpty = Object.keys(newState).length === 0;\r\n    return currentStateIsEmpty && newStateIsEmpty;\r\n  }\r\n\r\n}\r\n","import { ChangeDetectorRef } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { skip } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { EntityKey } from './entity.interfaces';\r\n\r\nimport { EntityStore } from './store';\r\n\r\n/**\r\n * This class is used to synchronize a component's changes\r\n * detection with an EntityStore changes. For example, it is frequent\r\n * to have a component subscribe to a store's selected entity and, at the same time,\r\n * this component provides a way to select an entity with, let's say, a click.\r\n *\r\n * This class automatically handles those case and triggers the compoent's\r\n * change detection when needed.\r\n *\r\n * Note: If the component observes the store's stateView, a workspace is\r\n * probably not required because the stateView catches any changes to the\r\n * entities and their state.\r\n */\r\nexport class EntityStoreWatcher<E extends object> {\r\n\r\n  /**\r\n   * Component change detector\r\n   */\r\n  private cdRef: ChangeDetectorRef;\r\n\r\n  /**\r\n   * Entity store\r\n   */\r\n  private store: EntityStore<E>;\r\n\r\n  /**\r\n   * Component inner state\r\n   */\r\n  private innerStateIndex = new Map<EntityKey, {[key: string]: any}>();\r\n\r\n  /**\r\n   * Subscription to the store's entities\r\n   */\r\n  private entities$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the store's state\r\n   */\r\n  private state$$: Subscription;\r\n\r\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\r\n    this.setChangeDetector(cdRef);\r\n    this.setStore(store);\r\n  }\r\n\r\n  destroy() {\r\n    this.setChangeDetector(undefined);\r\n    this.setStore(undefined);\r\n  }\r\n\r\n  /**\r\n   * Bind this workspace to a store and start watching for changes\r\n   * @param store Entity store\r\n   */\r\n  setStore(store?: EntityStore<E>) {\r\n    if (store === undefined) {\r\n      this.teardownObservers();\r\n      this.innerStateIndex.clear();\r\n      this.store = undefined;\r\n      return;\r\n    }\r\n\r\n    this.setStore(undefined);\r\n    this.store = store;\r\n    this.setupObservers();\r\n    this.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * Bind this workspace to a component's change detector\r\n   * @param cdRef Change detector\r\n   */\r\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\r\n    this.cdRef = cdRef;\r\n  }\r\n\r\n  /**\r\n   * Set up observers on a store's entities and their state\r\n   * @param store Entity store\r\n   */\r\n  private setupObservers() {\r\n    this.teardownObservers();\r\n\r\n    this.entities$$ = this.store.entities$\r\n      .subscribe((entities: E[]) => this.onEntitiesChange(entities));\r\n\r\n    this.state$$ = this.store.state.change$\r\n      .pipe(skip(1))\r\n      .subscribe(() => this.onStateChange());\r\n  }\r\n\r\n  /**\r\n   * Teardown store observers\r\n   */\r\n  private teardownObservers() {\r\n    if (this.entities$$ !== undefined) {\r\n      this.entities$$.unsubscribe();\r\n    }\r\n    if (this.state$$ !== undefined) {\r\n      this.state$$.unsubscribe();\r\n    }\r\n    this.entities$$ = undefined;\r\n    this.state$$ = undefined;\r\n  }\r\n\r\n  /**\r\n   * When the entities change, always trigger the changes detection\r\n   */\r\n  private onEntitiesChange(entities: E[]) {\r\n    this.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * When the entities state change, trigger the change detection\r\n   * only if the component has not handled these changes yet. For example,\r\n   * the component might have initiated thoses changes itself.\r\n   */\r\n  private onStateChange() {\r\n    let changesDetected = false;\r\n    const storeIndex = this.store.state.index;\r\n    const innerIndex = this.innerStateIndex;\r\n\r\n    if (storeIndex.size !== innerIndex.size) {\r\n      changesDetected = this.detectChanges();\r\n    }\r\n\r\n    const storeKeys = Array.from(storeIndex.keys());\r\n    for (const key of storeKeys) {\r\n      const storeValue = storeIndex.get(key);\r\n      const innerValue = innerIndex.get(key);\r\n      if (changesDetected === false) {\r\n        if (innerValue === undefined) {\r\n          changesDetected = this.detectChanges();\r\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\r\n          changesDetected = this.detectChanges();\r\n        }\r\n      }\r\n\r\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trigger the change detection of the workspace is bound to a change detector\r\n   */\r\n  private detectChanges() {\r\n    if (this.cdRef !== undefined) {\r\n      this.cdRef.detectChanges();\r\n    }\r\n    return true;\r\n  }\r\n\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\r\nimport { EntityStore } from '../store';\r\n\r\n/**\r\n * Entity store strategies. They can do pretty much anything during a store's\r\n * lifetime. For example, they may act as triggers when something happens.\r\n * Sharing a strategy is a good idea when multiple strategies would have\r\n * on cancelling effect on each other.\r\n *\r\n * At creation, strategy is inactive and needs to be manually activated.\r\n */\r\nexport class EntityStoreStrategy {\r\n\r\n  /**\r\n   * Feature store\r\n   * @internal\r\n   */\r\n  protected stores: EntityStore[] = [];\r\n\r\n  /**\r\n   * Whether this strategy is active\r\n   * @internal\r\n   */\r\n  get active(): boolean { return this.active$.value; }\r\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\r\n    this.options = options;\r\n  }\r\n\r\n  /**\r\n   * Activate the strategy. If it's already active, it'll be deactivated\r\n   * and activated again.\r\n   */\r\n  activate() {\r\n    if (this.active === true) {\r\n      this.doDeactivate();\r\n    }\r\n    this.active$.next(true);\r\n    this.doActivate();\r\n  }\r\n\r\n  /**\r\n   * Activate the strategy. If it's already active, it'll be deactivated\r\n   * and activated again.\r\n   */\r\n  deactivate() {\r\n    this.active$.next(false);\r\n    this.doDeactivate();\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: EntityStore) {\r\n    if (this.stores.indexOf(store) < 0) {\r\n      this.stores.push(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from store\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: EntityStore) {\r\n    const index = this.stores.indexOf(store);\r\n    if (index >= 0) {\r\n      this.stores.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Do the stataegy activation\r\n   * @internal\r\n   */\r\n  protected doActivate() {}\r\n\r\n  /**\r\n   * Do the strategy deactivation\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {}\r\n\r\n}\r\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\r\nimport { EntityStore } from '../store';\r\nimport { EntityStoreStrategy } from './strategy';\r\n\r\n/**\r\n * When active, this strategy filters a store's stateView to return\r\n * selected entities only.\r\n */\r\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\r\n\r\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Store / filter ids map\r\n   */\r\n  private filters: Map<EntityStore, string> = new Map();\r\n\r\n  /**\r\n   * Bind this strategy to a store and start filtering it\r\n   * @param store Entity store\r\n   */\r\n  bindStore(store: EntityStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.filterStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop filtering it\r\n   * @param store Entity store\r\n   */\r\n  unbindStore(store: EntityStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unfilterStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start filtering all stores\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.filterAll();\r\n  }\r\n\r\n  /**\r\n   * Stop filtering all stores\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unfilterAll();\r\n  }\r\n\r\n  /**\r\n   * Filter all stores\r\n   */\r\n  private filterAll() {\r\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\r\n  }\r\n\r\n  /**\r\n   * Unfilter all stores\r\n   */\r\n  private unfilterAll() {\r\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\r\n  }\r\n\r\n  /**\r\n   * Filter a store and add it to the filters map\r\n   */\r\n  private filterStore(store: EntityStore) {\r\n    this.filters.set(store, store.stateView.addFilter(this.options.filterClauseFunc));\r\n  }\r\n\r\n  /**\r\n   * Unfilter a store and delete it from the filters map\r\n   */\r\n  private unfilterStore(store: EntityStore) {\r\n    const filterId = this.filters.get(store);\r\n    if (filterId === undefined) {\r\n      return;\r\n    }\r\n\r\n    store.stateView.removeFilter(filterId);\r\n    this.filters.delete(store);\r\n  }\r\n}\r\n","import { EntityRecord } from '../entity.interfaces';\r\nimport { EntityStore } from '../store';\r\nimport { EntityStoreStrategy } from './strategy';\r\n\r\n/**\r\n * When active, this strategy filters a store's stateView to return\r\n * selected entities only.\r\n */\r\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\r\n\r\n  /**\r\n   * Store / filter ids map\r\n   */\r\n  private filters: Map<EntityStore, string> = new Map();\r\n\r\n  /**\r\n   * Bind this strategy to a store and start filtering it\r\n   * @param store Entity store\r\n   */\r\n  bindStore(store: EntityStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.filterStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop filtering it\r\n   * @param store Entity store\r\n   */\r\n  unbindStore(store: EntityStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unfilterStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start filtering all stores\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.filterAll();\r\n  }\r\n\r\n  /**\r\n   * Stop filtering all stores\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unfilterAll();\r\n  }\r\n\r\n  /**\r\n   * Filter all stores\r\n   */\r\n  private filterAll() {\r\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\r\n  }\r\n\r\n  /**\r\n   * Unfilter all stores\r\n   */\r\n  private unfilterAll() {\r\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\r\n  }\r\n\r\n  /**\r\n   * Filter a store and add it to the filters map\r\n   */\r\n  private filterStore(store: EntityStore) {\r\n    if (this.filters.has(store)) {\r\n      return;\r\n    }\r\n\r\n    const filter = (record: EntityRecord<object>) => {\r\n      return record.state.selected === true;\r\n    };\r\n    this.filters.set(store, store.stateView.addFilter(filter));\r\n  }\r\n\r\n  /**\r\n   * Unfilter a store and delete it from the filters map\r\n   */\r\n  private unfilterStore(store: EntityStore) {\r\n    const filterId = this.filters.get(store);\r\n    if (filterId === undefined) {\r\n      return;\r\n    }\r\n\r\n    store.stateView.removeFilter(filterId);\r\n    this.filters.delete(store);\r\n  }\r\n}\r\n","<mat-form-field class=\"igo-entity-selector\">\r\n  <mat-select\r\n    [disabled]=\"disabled\"\r\n    [value]=\"selected$ | async\"\r\n    [multiple]=\"multi\"\r\n    [placeholder]=\"placeholder\"\r\n    (selectionChange)=\"onSelectionChange($event)\">\r\n    <mat-option *ngIf=\"emptyText !== undefined && multi === false\" [value]=\"emptyValue\">{{emptyText}}</mat-option>\r\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{multiText$ | async}}</mat-option>\r\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\r\n      <mat-option [value]=\"record.entity\">\r\n        {{titleAccessor(record.entity)}}\r\n      </mat-option>\r\n    </ng-template>\r\n  </mat-select>\r\n</mat-form-field>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { EntityRecord } from '../shared/entity.interfaces';\r\nimport { EntityStore } from '../shared/store';\r\nimport { EntityStoreWatcher } from '../shared/watcher';\r\nimport { getEntityTitle } from '../shared/entity.utils';\r\n\r\n@Component({\r\n  selector: 'igo-entity-selector',\r\n  templateUrl: './entity-selector.component.html',\r\n  styleUrls: ['./entity-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\r\n\r\n  /**\r\n   * The selected entity\r\n   * @internal\r\n   */\r\n  readonly selected$ = new BehaviorSubject<object>(undefined);\r\n\r\n  /**\r\n   * The current multi select option text\r\n   * @internal\r\n   */\r\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\r\n\r\n  readonly multiSelectValue = {id: 'IGO_MULTI_SELECT'};\r\n\r\n  readonly emptyValue = {id: 'IGO_EMPTY_SELECT'};\r\n\r\n  /**\r\n   * Subscription to the selected entity\r\n   */\r\n  private selected$$: Subscription;\r\n\r\n  /**\r\n   * Store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<object>;\r\n\r\n  /**\r\n   * Entity store\r\n   */\r\n  @Input() store: EntityStore<object>;\r\n\r\n  /**\r\n   * Title accessor\r\n   */\r\n  @Input() titleAccessor: (object) => string = getEntityTitle;\r\n\r\n  /**\r\n   * Text to display when nothing is selected\r\n   */\r\n  @Input() emptyText: string = undefined;\r\n\r\n  /**\r\n   * Wheter selecting many entities is allowed\r\n   */\r\n  @Input() multi: boolean = false;\r\n\r\n  /**\r\n   * Text to display for the select all option\r\n   */\r\n  @Input() multiAllText: string = 'All';\r\n\r\n  /**\r\n   * Text to display for the select none option\r\n   */\r\n  @Input() multiNoneText: string = 'None';\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Wheter the selector is disabled or not\r\n   */\r\n  @Input() disabled: boolean = false;\r\n\r\n  /**\r\n   * Event emitted when the selection changes\r\n   */\r\n  @Output() selectedChange = new EventEmitter<{\r\n    selected: boolean;\r\n    value: object | object[];\r\n  }>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Create a store watcher and subscribe to the selected entity\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n\r\n    this.selected$$ = this.store.stateView\r\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\r\n      .subscribe((records: EntityRecord<object>[]) => {\r\n        const entities = records.map((record: EntityRecord<object>) => record.entity);\r\n        this.onSelectFromStore(entities);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the selected entity and destroy the store watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n    this.selected$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * On selection change, update the store's state and emit an event\r\n   * @internal\r\n   */\r\n  onSelectionChange(event: {value: object | undefined}) {\r\n    const values = event.value instanceof Array ? event.value : [event.value];\r\n\r\n    const multiSelect = values.find((_value: object) => _value === this.multiSelectValue);\r\n    let entities = values.filter((_value: object) => _value !== this.multiSelectValue);\r\n    if (multiSelect !== undefined) {\r\n      if (entities.length === this.store.count) {\r\n        entities = [];\r\n      } else if (entities.length < this.store.count) {\r\n        entities = this.store.all();\r\n      }\r\n    }\r\n\r\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\r\n    if (entities.length === 0) {\r\n      this.store.state.updateAll({selected: false});\r\n    } else {\r\n      this.store.state.updateMany(entities, {selected: true}, true);\r\n    }\r\n\r\n    const value = this.multi ? entities : event.value;\r\n    this.selectedChange.emit({selected: true, value});\r\n  }\r\n\r\n  private onSelectFromStore(entities: object[]) {\r\n    if (this.multi === true) {\r\n      this.selected$.next(entities);\r\n    } else {\r\n      const entity = entities.length > 0 ? entities[0] : undefined;\r\n      this.selected$.next(entity);\r\n    }\r\n\r\n    this.updateMultiToggleWithEntities(entities);\r\n  }\r\n\r\n  private updateMultiToggleWithEntities(entities: object[]) {\r\n    if (entities.length === this.store.count && this.multiText$.value !== this.multiNoneText) {\r\n      this.multiText$.next(this.multiNoneText);\r\n    } else if (entities.length < this.store.count && this.multiText$.value !== this.multiAllText) {\r\n      this.multiText$.next(this.multiAllText);\r\n    }\r\n  }\r\n\r\n}\r\n","import { Directive, HostListener } from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoStopPropagation]'\r\n})\r\nexport class StopPropagationDirective {\r\n  @HostListener('click', ['$event'])\r\n  public onClick(event: any): void {\r\n    event.stopPropagation();\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  ElementRef,\r\n  Renderer2,\r\n  EventEmitter,\r\n  Output,\r\n  HostListener\r\n} from '@angular/core';\r\n\r\nimport scrollIntoView from 'scroll-into-view-if-needed';\r\n\r\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\r\n\r\n/**\r\n * Directive that handles an entity table row click and selection.\r\n */\r\n@Directive({\r\n  selector: '[igoEntityTableRow]'\r\n})\r\nexport class EntityTableRowDirective {\r\n\r\n  /**\r\n   * Class added to a selected row\r\n   */\r\n  static selectedCls = 'igo-entity-table-row-selected';\r\n\r\n  /**\r\n   * Class added to a highlighted row\r\n   */\r\n  static highlightedCls = 'igo-entity-table-row-highlighted';\r\n\r\n  /**\r\n   * Whether a row supports selection\r\n   */\r\n  @Input() selection = false;\r\n\r\n  /**\r\n   * Whether clicking a row should select it (if selection is true)\r\n   */\r\n  @Input() selectOnClick: boolean = true;\r\n\r\n  /**\r\n   * Whether the selected row should be highlighted\r\n   */\r\n  @Input() highlightSelection: boolean = true;\r\n\r\n  /**\r\n   * Whether a row is selected\r\n   */\r\n  @Input()\r\n  set selected(value: boolean) {\r\n    if (this.selection === false) { return; }\r\n    if (value === this._selected) { return; }\r\n\r\n    this.toggleSelected(value);\r\n    this.scroll();\r\n  }\r\n  get selected(): boolean {\r\n    return this._selected;\r\n  }\r\n  private _selected = false;\r\n\r\n  /**\r\n   * Scroll behavior on selection\r\n   */\r\n  @Input()\r\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\r\n\r\n  /**\r\n   * Event emitted when a row is selected\r\n   */\r\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\r\n\r\n  /**\r\n   * When a row is clicked, select it if it's supported\r\n   * @ignore\r\n   */\r\n  @HostListener('click')\r\n  onClick() {\r\n    if (this.selection === false || this.selectOnClick === false) {\r\n      return;\r\n    }\r\n\r\n    this.toggleSelected(true);\r\n    this.select.emit(this);\r\n  }\r\n\r\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\r\n\r\n  /**\r\n   * Select a row and add or remove the selected class from it\r\n   * @param selected Whether the row should be selected\r\n   */\r\n  private toggleSelected(selected: boolean) {\r\n    this._selected = selected;\r\n    if (selected === true) {\r\n      this.addCls(EntityTableRowDirective.selectedCls);\r\n      if (this.highlightSelection === true) {\r\n        this.addCls(EntityTableRowDirective.highlightedCls);\r\n      }\r\n    } else {\r\n      this.removeCls(EntityTableRowDirective.selectedCls);\r\n      this.removeCls(EntityTableRowDirective.highlightedCls);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Scroll to the selected row\r\n   */\r\n  private scroll() {\r\n    if (this._selected === true) {\r\n      scrollIntoView(this.el.nativeElement, {\r\n        scrollMode: 'if-needed',\r\n        behavior: 'smooth',\r\n        block: 'end',\r\n        inline: 'nearest'\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the selected CSS class\r\n   */\r\n  private addCls(cls: string) {\r\n    this.renderer.addClass(this.el.nativeElement, cls);\r\n  }\r\n\r\n  /**\r\n   * Remove the selected CSS class\r\n   */\r\n  private removeCls(cls: string) {\r\n    this.renderer.removeClass(this.el.nativeElement, cls);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnChanges,\r\n  ViewChild,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport {\r\n  EntityStore\r\n} from '../shared';\r\nimport { MatPaginator, PageEvent } from '@angular/material/paginator';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\r\n\r\n@Component({\r\n  selector: 'igo-entity-table-paginator',\r\n  templateUrl: './entity-table-paginator.component.html',\r\n  styleUrls: ['./entity-table-paginator.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\r\n\r\n  public disabled: boolean = false;\r\n  public hidePageSize: boolean = false;\r\n  public pageIndex: number = 0;\r\n  public pageSize: number = 50;\r\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\r\n  public showFirstLastButtons: boolean = true;\r\n  private count$$: Subscription;\r\n  private entitySortChange$$: Subscription;\r\n  private paginationLabelTranslation$$: Subscription[] = [];\r\n\r\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  /**\r\n   * Entity store\r\n   */\r\n  @Input() store: EntityStore<object>;\r\n\r\n  /**\r\n   * Paginator options\r\n   */\r\n  @Input()\r\n  paginatorOptions: EntityTablePaginatorOptions;\r\n\r\n  /**\r\n   * Event emitted when the paginator changes the page size or page index.\r\n   */\r\n  @Output() page: EventEmitter<PageEvent>;\r\n\r\n  public length: number = 0;\r\n\r\n  /**\r\n   * Paginator emitted.\r\n   */\r\n  @Output() paginatorChange: EventEmitter<MatPaginator> = new EventEmitter<MatPaginator>();\r\n\r\n  constructor(private languageService: LanguageService, private mediaService: MediaService) {}\r\n\r\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\r\n\r\n  ngOnChanges() {\r\n    this.unsubscribeAll();\r\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\r\n      this.length = count;\r\n      this.emitPaginator();\r\n    });\r\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\r\n      if (this.paginator) {\r\n        this.paginator.firstPage();\r\n      }\r\n    });\r\n    this.initPaginatorOptions();\r\n    this.translateLabels();\r\n  }\r\n\r\n  initPaginatorOptions() {\r\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\r\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\r\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\r\n    this.pageSizeOptions = this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\r\n    if (this.mediaService.isMobile()) {\r\n      this.showFirstLastButtons = false;\r\n      this.hidePageSize = true;\r\n    } else {\r\n      this.showFirstLastButtons = this.paginatorOptions?.showFirstLastButtons || this.showFirstLastButtons;\r\n      this.hidePageSize = this.paginatorOptions?.hidePageSize || this.hidePageSize;\r\n    }\r\n  }\r\n\r\n  translateLabels() {\r\n\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate.get('igo.common.paginator.firstPageLabel').subscribe((label: string) => {\r\n        this.paginator._intl.firstPageLabel = label;\r\n      }));\r\n\r\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\r\n\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate.get('igo.common.paginator.itemsPerPageLabel').subscribe((label: string) => {\r\n        this.paginator._intl.itemsPerPageLabel = label;\r\n      }));\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate.get('igo.common.paginator.lastPageLabel').subscribe((label: string) => {\r\n        this.paginator._intl.lastPageLabel = label;\r\n      }));\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate.get('igo.common.paginator.nextPageLabel').subscribe((label: string) => {\r\n        this.paginator._intl.nextPageLabel = label;\r\n      }));\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate.get('igo.common.paginator.previousPageLabel').subscribe((label: string) => {\r\n        this.paginator._intl.previousPageLabel = label;\r\n      }));\r\n  }\r\n\r\n  rangeLabel = (page: number, pageSize: number, length: number) => {\r\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate.get('igo.common.paginator.of').subscribe((label: string) => {\r\n        of.next(label);\r\n      }));\r\n    if (length === 0 || pageSize === 0) { return `0 ${of.value} ${length}`; }\r\n    length = Math.max(length, 0);\r\n    const startIndex = page * pageSize;\r\n    const endIndex = startIndex < length ?\r\n        Math.min(startIndex + pageSize, length) :\r\n        startIndex + pageSize;\r\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\r\n  }\r\n\r\n  private unsubscribeAll() {\r\n    this.paginationLabelTranslation$$.map(sub => sub.unsubscribe());\r\n    if (this.count$$) { this.count$$.unsubscribe(); }\r\n    if (this.entitySortChange$$) { this.entitySortChange$$.unsubscribe(); }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.unsubscribeAll();\r\n  }\r\n\r\n  emitPaginator() {\r\n    this.paginatorChange.emit(this.paginator);\r\n  }\r\n}\r\n","<mat-paginator \r\n  [disabled]=\"disabled\"\r\n  [hidePageSize]=\"hidePageSize\"\r\n  [length]=\"length\"\r\n  [pageIndex]=\"pageIndex\"\r\n  [pageSize]=\"pageSize\"\r\n  [pageSizeOptions]=\"pageSizeOptions\"\r\n  [showFirstLastButtons]=\"showFirstLastButtons\"\r\n  (page)=\"emitPaginator()\">\r\n</mat-paginator>\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\n\r\nimport { Cacheable } from 'ts-cacheable';\r\nimport { Observable } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n\r\n@Pipe({\r\n  name: 'secureImage'\r\n})\r\nexport class SecureImagePipe implements PipeTransform {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  transform(url: string): Observable<string> {\r\n    const headers = new HttpHeaders({\r\n      'Content-Type': 'text/plain',\r\n      activityInterceptor: 'false'\r\n    });\r\n\r\n    return this.http\r\n      .get(url, {\r\n        headers,\r\n        responseType: 'blob'\r\n      })\r\n      .pipe(\r\n        switchMap((blob) => {\r\n          return new Observable((observer) => {\r\n            const reader = new FileReader();\r\n            reader.readAsDataURL(blob);\r\n            reader.onloadend = () => {\r\n              observer.next(reader.result);\r\n              observer.complete();\r\n            };\r\n          });\r\n        })\r\n      ) as Observable<string>;\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\r\n\r\n@Pipe({ name: 'sanitizeHtml' })\r\nexport class SanitizeHtmlPipe implements PipeTransform {\r\n  constructor(private _sanitizer: DomSanitizer) {\r\n  }\r\n  transform(v: string): SafeHtml {\r\n    return this._sanitizer.bypassSecurityTrustHtml(v);\r\n  }\r\n}\r\n","<div class=\"table-container\">\r\n  <table\r\n    mat-table\r\n    matSort\r\n    [ngClass]=\"getTableClass()\"\r\n    [dataSource]=\"dataSource\"\r\n    [trackBy]=\"getTrackByFunction()\"\r\n    (matSortChange)=\"onSort($event)\">\r\n\r\n    <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\r\n      <th mat-header-cell *matHeaderCellDef>\r\n        <ng-container *ngIf=\"selectMany\">\r\n          <ng-container *ngIf=\"selectionState$ | async as selectionState\">\r\n            <mat-checkbox (change)=\"onToggleRows($event.checked)\"\r\n                          [checked]=\"selectionState === entityTableSelectionState.All\"\r\n                          [indeterminate]=\"selectionState === entityTableSelectionState.Some\">\r\n            </mat-checkbox>\r\n          </ng-container>\r\n        </ng-container>\r\n      </th>\r\n      <td mat-cell *matCellDef=\"let record\">\r\n        <mat-checkbox (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\"\r\n                      (click)=\"$event.shiftKey ? onShiftToggleRow(!rowIsSelected(record), record, $event) : $event.stopPropagation()\"\r\n                      (change)=\"onToggleRow($event.checked, record)\"\r\n                      [checked]=\"rowIsSelected(record)\">\r\n        </mat-checkbox>\r\n      </td>\r\n    </ng-container>\r\n\r\n    <ng-container [matColumnDef]=\"column.name\" *ngFor=\"let column of template.columns\">\r\n      <ng-container *ngIf=\"columnIsSortable(column)\">\r\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>\r\n          {{column.title}}\r\n        </th>\r\n      </ng-container>\r\n\r\n      <ng-container *ngIf=\"!columnIsSortable(column)\">\r\n        <th mat-header-cell *matHeaderCellDef>\r\n          {{column.title}}\r\n        </th>\r\n      </ng-container>\r\n\r\n      <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\r\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\">\r\n            <ng-container *matCellDef=\"let record\">\r\n              <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlDefault\"\r\n                [ngClass]=\"getCellClass(record, column)\">\r\n                {{getValue(record, column)}}\r\n              </td>\r\n              <ng-template #isAnUrlDefault>\r\n                <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\r\n                  <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\r\n                    <img *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) |async}}\" width=\"50\" heigth=\"auto\">\r\n                    <ng-template #notImg><span>{{ 'igo.common.entity-table.targetHtmlUrl' | translate }} </span></ng-template>\r\n                  </a>\r\n                </td>\r\n              </ng-template>\r\n            </ng-container>\r\n          </ng-container>\r\n          <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\r\n            <ng-container *matCellDef=\"let record\">\r\n              <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlHTML\"\r\n                [ngClass]=\"getCellClass(record, column)\"\r\n                [innerHTML]=\"getValue(record, column)\">\r\n              </td>\r\n              <ng-template #isAnUrlHTML>\r\n                <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\r\n                  <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\r\n                    <img *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) |async}}\" width=\"50\" heigth=\"auto\">\r\n                    <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\r\n                  </a>\r\n                </td>\r\n              </ng-template>\r\n            </ng-container>\r\n          </ng-container>\r\n          <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\">\r\n            <ng-container *matCellDef=\"let record\">\r\n              <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlUnsanitizedHTML\"\r\n                [ngClass]=\"getCellClass(record, column)\"\r\n                [innerHTML]=\"getValue(record, column) | sanitizeHtml\">\r\n              </td>\r\n              <ng-template #isAnUrlUnsanitizedHTML>\r\n                <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\r\n                  <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\r\n                    <img *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) |async}}\" width=\"50\" heigth=\"auto\">\r\n                    <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\r\n                  </a>\r\n                </td>\r\n              </ng-template>\r\n            </ng-container>\r\n          </ng-container>\r\n          <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\r\n            <td mat-cell *matCellDef=\"let record\" class=\"mat-cell-text\"\r\n              [ngClass]=\"getCellClass(record, column)\">\r\n              <mat-icon svgIcon=\"{{getValue(record, column)}}\"></mat-icon>\r\n            </td>\r\n          </ng-container>\r\n          <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\">\r\n            <td mat-cell *matCellDef=\"let record\" class=\"mat-cell-text\"\r\n              [ngClass]=\"getCellClass(record, column)\">\r\n              <span *ngFor=\"let button of getValue(record, column)\">\r\n                <button *ngIf=\"button.style === 'mat-icon-button'\"\r\n                  igoStopPropagation\r\n                  mat-icon-button\r\n                  [color]=\"button.color\"\r\n                  (click)=\"onButtonClick(button.click, record)\">\r\n                  <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\r\n                </button>\r\n                <button *ngIf=\"button.style !== 'mat-icon-button'\"\r\n                  igoStopPropagation\r\n                  mat-mini-fab\r\n                  [color]=\"button.color\"\r\n                  (click)=\"onButtonClick(button.click, record)\">\r\n                  <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\r\n                </button>\r\n              </span>\r\n            </td>\r\n          </ng-container>\r\n      </ng-container>\r\n    </ng-container>\r\n\r\n    <tr\r\n      mat-header-row\r\n      *matHeaderRowDef=\"headers; sticky: fixedHeader;\"\r\n      [ngClass]=\"getHeaderClass()\">\r\n    </tr>\r\n    <tr\r\n      mat-row\r\n      igoEntityTableRow\r\n      *matRowDef=\"let record; columns: headers;\"\r\n      [scrollBehavior]=\"scrollBehavior\"\r\n      [ngClass]=\"getRowClass(record)\"\r\n      [selection]=\"selection\"\r\n      [selected]=\"rowIsSelected(record)\"\r\n      (select)=\"onRowSelect(record)\"\r\n      (click)=\"onRowClick(record)\">\r\n    </tr>\r\n  </table>\r\n  <igo-entity-table-paginator *ngIf=\"withPaginator\"\r\n    [store]=\"store\"\r\n    [paginatorOptions]=\"paginatorOptions\"\r\n    [entitySortChange$]=\"entitySortChange$\"\r\n    (paginatorChange)=\"paginatorChange($event)\">\r\n  </igo-entity-table-paginator>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  OnDestroy,\r\n  OnChanges,\r\n  SimpleChanges\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport {\r\n  EntityKey,\r\n  EntityRecord,\r\n  EntityState,\r\n  EntityStore,\r\n  EntityTableTemplate,\r\n  EntityTableColumn,\r\n  EntityTableColumnRenderer,\r\n  EntityTableSelectionState,\r\n  EntityTableScrollBehavior\r\n} from '../shared';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { MatTableDataSource } from '@angular/material/table';\r\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\r\n\r\n@Component({\r\n  selector: 'igo-entity-table',\r\n  templateUrl: './entity-table.component.html',\r\n  styleUrls: ['./entity-table.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy  {\r\n\r\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Reference to the column renderer types\r\n   * @internal\r\n   */\r\n  entityTableColumnRenderer = EntityTableColumnRenderer;\r\n\r\n  /**\r\n   * Reference to the selection's state\r\n   * @internal\r\n   */\r\n  entityTableSelectionState = EntityTableSelectionState;\r\n\r\n  /**\r\n   * Observable of the selection,s state\r\n   * @internal\r\n   */\r\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Subscription to the store's selection\r\n   */\r\n  private selection$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the dataSource\r\n   */\r\n  private dataSource$$: Subscription;\r\n\r\n  /**\r\n   * The last record checked. Useful for selecting\r\n   * multiple records by holding the shift key and checking\r\n   * checkboxes.\r\n   */\r\n  private lastRecordCheckedKey: EntityKey;\r\n\r\n  /**\r\n   * Entity store\r\n   */\r\n  @Input() store: EntityStore<object>;\r\n\r\n  /**\r\n   * Table paginator\r\n   */\r\n  @Input() set paginator(value: MatPaginator) {\r\n    this._paginator = value;\r\n    this.dataSource.paginator = value;\r\n  }\r\n\r\n  get paginator(): MatPaginator {\r\n    return this._paginator;\r\n  }\r\n  private _paginator: MatPaginator;\r\n\r\n  /**\r\n   * Table template\r\n   */\r\n  @Input() template: EntityTableTemplate;\r\n\r\n  /**\r\n   * Scroll behavior on selection\r\n   */\r\n  @Input()\r\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\r\n\r\n  /**\r\n   * Whether nulls should be first when sorting\r\n   */\r\n  @Input()\r\n  sortNullsFirst: boolean = false;\r\n\r\n  /**\r\n   * Show the table paginator or not. False by default.\r\n   */\r\n  @Input()\r\n  withPaginator: boolean = false;\r\n\r\n  /**\r\n   * Paginator options\r\n   */\r\n  @Input()\r\n  paginatorOptions: EntityTablePaginatorOptions;\r\n\r\n  /**\r\n   * Event emitted when an entity (row) is clicked\r\n   */\r\n  @Output() entityClick = new EventEmitter<object>();\r\n\r\n  /**\r\n   * Event emitted when an entity (row) is selected\r\n   */\r\n  @Output() entitySelectChange = new EventEmitter<{\r\n    added: object[];\r\n  }>();\r\n\r\n  /**\r\n   * Event emitted when the table sort is changed.\r\n   */\r\n  @Output() entitySortChange: EventEmitter<{column: EntityTableColumn, direction: string}> = new EventEmitter(undefined);\r\n\r\n  /**\r\n   * Table headers\r\n   * @internal\r\n   */\r\n  get headers(): string[] {\r\n    let columns = this.template.columns\r\n      .filter((column: EntityTableColumn) => column.visible !== false)\r\n      .map((column: EntityTableColumn) => column.name);\r\n\r\n    if (this.selectionCheckbox === true) {\r\n      columns = ['selectionCheckbox'].concat(columns);\r\n    }\r\n\r\n    return columns;\r\n  }\r\n\r\n  /**\r\n   * Data source consumable by the underlying material table\r\n   * @internal\r\n   */\r\n  dataSource = new MatTableDataSource<object>();\r\n\r\n  /**\r\n   * Whether selection is supported\r\n   * @internal\r\n   */\r\n  get selection(): boolean { return this.template.selection || false; }\r\n\r\n  /**\r\n   * Whether a selection checkbox should be displayed\r\n   * @internal\r\n   */\r\n  get selectionCheckbox(): boolean { return this.template.selectionCheckbox || false; }\r\n\r\n  /**\r\n   * Whether selection many entities should eb supported\r\n   * @internal\r\n   */\r\n  get selectMany(): boolean { return this.template.selectMany || false; }\r\n\r\n  /**\r\n   * Whether selection many entities should eb supported\r\n   * @internal\r\n   */\r\n  get fixedHeader(): boolean { return this.template.fixedHeader === undefined ? true : this.template.fixedHeader; }\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Track the selection state to properly display the selection checkboxes\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.handleDatasource();\r\n    this.dataSource.paginator = this.paginator;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const store = changes.store;\r\n    if (store && store.currentValue !== store.previousValue) {\r\n      this.handleDatasource();\r\n    }\r\n  }\r\n\r\n  private handleDatasource() {\r\n    this.unsubscribeStore();\r\n    this.selection$$ = this.store.stateView\r\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\r\n      .subscribe((records: EntityRecord<object>[]) => {\r\n        const firstSelected = records[0];\r\n        const firstSelectedStateviewPosition = this.store.stateView.all().indexOf(firstSelected);\r\n        const pageMax = this.paginator ? this.paginator.pageSize * (this.paginator.pageIndex + 1) : 0;\r\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\r\n\r\n        if (\r\n          this.paginator &&\r\n          (firstSelectedStateviewPosition < pageMin ||\r\n          firstSelectedStateviewPosition >= pageMax)) {\r\n          const pageToReach = Math.floor(firstSelectedStateviewPosition / this.paginator.pageSize);\r\n          this.dataSource.paginator.pageIndex = pageToReach;\r\n        }\r\n        this.selectionState$.next(this.computeSelectionState(records));\r\n      });\r\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\r\n      this.dataSource.data = all;\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Unbind the store watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unsubscribeStore();\r\n  }\r\n\r\n  private unsubscribeStore() {\r\n    if (this.selection$$) {\r\n      this.selection$$.unsubscribe();\r\n    }\r\n    if (this.dataSource$$) {\r\n      this.dataSource$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trackby function\r\n   * @param record Record\r\n   * @param index Record index\r\n   * @internal\r\n   */\r\n  getTrackByFunction() {\r\n    return (index: number, record: EntityRecord<object, EntityState>) => {\r\n      return record.ref;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Trigger a refresh of thre table. This can be useful when\r\n   * the data source doesn't emit a new value but for some reason\r\n   * the records need an update.\r\n   * @internal\r\n   */\r\n  refresh() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  paginatorChange(event: MatPaginator) {\r\n    this.paginator = event;\r\n  }\r\n\r\n  /**\r\n   * On sort, sort the store\r\n   * @param event Sort event\r\n   * @internal\r\n   */\r\n  onSort(event: {active: string, direction: string}) {\r\n    const direction = event.direction;\r\n    const column = this.template.columns\r\n      .find((c: EntityTableColumn) => c.name === event.active);\r\n\r\n    if (direction === 'asc' || direction === 'desc') {\r\n      this.store.stateView.sort({\r\n        valueAccessor: (record: EntityRecord<object>) => this.getValue(record, column),\r\n        direction,\r\n        nullsFirst: this.sortNullsFirst\r\n      });\r\n      this.entitySortChange.emit({column, direction});\r\n      this.entitySortChange$.next(true);\r\n    } else {\r\n      this.store.stateView.sort(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When an entity is clicked, emit an event\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onRowClick(record: EntityRecord<object>) {\r\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\r\n    this.entityClick.emit(record.entity);\r\n  }\r\n\r\n  /**\r\n   * When an entity is selected, select it in the store and emit an event. Even if\r\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\r\n   * multiple rows should be achieved by using the checkboxes.\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onRowSelect(record: EntityRecord<object>) {\r\n    if (this.selection === false) { return; }\r\n\r\n    const entity = record.entity;\r\n    this.store.state.update(entity, {selected: true}, true);\r\n    this.entitySelectChange.emit({added: [entity]});\r\n  }\r\n\r\n  /**\r\n   * Select or unselect all rows at once. On select, emit an event.\r\n   * @param toggle Select or unselect\r\n   * @internal\r\n   */\r\n  onToggleRows(toggle: boolean) {\r\n    if (this.selection === false) { return; }\r\n\r\n    this.store.state.updateAll({selected: toggle});\r\n    if (toggle === true) {\r\n      const entities = this.store.stateView\r\n        .all()\r\n        .map((record: EntityRecord<object>) => record.entity);\r\n      this.entitySelectChange.emit({added: [entities]});\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When an entity is toggled, select or unselect it in the store. On select,\r\n   * emit an event.\r\n   * @param toggle Select or unselect\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\r\n    if (this.selection === false) { return; }\r\n\r\n    const entity = record.entity;\r\n    const exclusive = toggle === true && !this.selectMany;\r\n    this.store.state.update(entity, {selected: toggle}, exclusive);\r\n    if (toggle === true) {\r\n      this.entitySelectChange.emit({added: [entity]});\r\n    }\r\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\r\n  }\r\n\r\n  /**\r\n   * When an entity is toggled, select or unselect it in the store. On select,\r\n   * emit an event.\r\n   * @param toggle Select or unselect\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onShiftToggleRow(toggle: boolean, record: EntityRecord<object>, event: MouseEvent) {\r\n    if (this.selection === false) { return; }\r\n\r\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\r\n      this.onToggleRow(toggle, record);\r\n      return;\r\n    }\r\n\r\n    // This is a workaround mat checkbox wrong behavior\r\n    // when the shift key is held.\r\n    // See https://github.com/angular/components/issues/6232\r\n    const range = window.document.createRange();\r\n    range.selectNode(event.target as HTMLElement);\r\n    window.getSelection().removeAllRanges();\r\n    window.getSelection().addRange(range);\r\n    event.stopImmediatePropagation();\r\n\r\n    const records = this.store.stateView.all();\r\n    const recordIndex = records.indexOf(record);\r\n    const lastRecordChecked = this.store.stateView.get(this.lastRecordCheckedKey);\r\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\r\n    const indexes = [recordIndex, lastRecordIndex];\r\n    const selectRecords = records.slice(Math.min(...indexes), Math.max(...indexes) + 1);\r\n\r\n    const entities = selectRecords.map((_record: EntityRecord<object>) => _record.entity);\r\n    this.store.state.updateMany(entities, {selected: toggle});\r\n    if (toggle === true) {\r\n      this.entitySelectChange.emit({added: entities});\r\n    }\r\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\r\n  }\r\n\r\n  /**\r\n   * Compute the selection state\r\n   * @returns Whether all, some or no rows are selected\r\n   * @internal\r\n   */\r\n  private computeSelectionState(selectedRecords: EntityRecord<object>[]): EntityTableSelectionState {\r\n    const states = EntityTableSelectionState;\r\n    const selectionCount = selectedRecords.length;\r\n    return selectionCount === 0 ?\r\n      states.None :\r\n      (selectionCount === this.store.stateView.count ? states.All : states.Some);\r\n  }\r\n\r\n  /**\r\n   * Whether a column is sortable\r\n   * @param column Column\r\n   * @returns True if a column is sortable\r\n   * @internal\r\n   */\r\n  columnIsSortable(column: EntityTableColumn): boolean {\r\n    let sortable = column.sort;\r\n    if (sortable === undefined) {\r\n      sortable = this.template.sort === undefined ? false : this.template.sort;\r\n    }\r\n    return sortable;\r\n  }\r\n\r\n  /**\r\n   * Whether a row is should be selected based on the underlying entity state\r\n   * @param record Record\r\n   * @returns True if a row should be selected\r\n   * @internal\r\n   */\r\n  rowIsSelected(record: EntityRecord<object>): boolean {\r\n    const state = record.state;\r\n    return state.selected ? state.selected : false;\r\n  }\r\n\r\n  isImg(value) {\r\n    if (this.isUrl(value)) {\r\n      return (\r\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !== -1\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  isUrl(value) {\r\n    if (typeof value === 'string') {\r\n      return (\r\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Method to access an entity's values\r\n   * @param record Record\r\n   * @param column Column\r\n   * @returns Any value\r\n   * @internal\r\n   */\r\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\r\n    const entity = record.entity;\r\n    if (column.valueAccessor !== undefined) {\r\n      return column.valueAccessor(entity, record);\r\n    }\r\n    if (this.template.valueAccessor !== undefined) {\r\n      return this.template.valueAccessor(entity, column.name, record);\r\n    }\r\n    return this.store.getProperty(entity, column.name);\r\n  }\r\n\r\n  /**\r\n   * Return the type of renderer of a column\r\n   * @param column Column\r\n   * @returns Renderer type\r\n   * @internal\r\n   */\r\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\r\n    if (column.renderer !== undefined) {\r\n      return column.renderer;\r\n    }\r\n    return EntityTableColumnRenderer.Default;\r\n  }\r\n\r\n  /**\r\n   * Return the table ngClass\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getTableClass(): {[key: string]: boolean} {\r\n    return {\r\n      'igo-entity-table-with-selection': this.selection\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Return a header ngClass\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getHeaderClass(): {[key: string]: boolean} {\r\n    const func = this.template.headerClassFunc;\r\n    if (func instanceof Function) {\r\n      return func();\r\n    }\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Return a row ngClass\r\n   * @param record Record\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getRowClass(record: EntityRecord<object>): {[key: string]: boolean} {\r\n    const entity = record.entity;\r\n    const func = this.template.rowClassFunc;\r\n    if (func instanceof Function) {\r\n      return func(entity, record);\r\n    }\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Return a row ngClass\r\n   * @param record Record\r\n   * @param column Column\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getCellClass(record: EntityRecord<object>, column: EntityTableColumn): {[key: string]: boolean} {\r\n    const entity = record.entity;\r\n    const cls = {};\r\n\r\n    const tableFunc = this.template.cellClassFunc;\r\n    if (tableFunc instanceof Function) {\r\n      Object.assign(cls, tableFunc(entity, column, record));\r\n    }\r\n\r\n    const columnFunc = column.cellClassFunc;\r\n    if (columnFunc instanceof Function) {\r\n      Object.assign(cls, columnFunc(entity, record));\r\n    }\r\n\r\n    return cls;\r\n  }\r\n\r\n  /**\r\n   * When a button is clicked\r\n   * @param func Function\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onButtonClick(\r\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\r\n    record: EntityRecord<object>\r\n  ) {\r\n    if (typeof clickFunc === 'function') {\r\n      clickFunc(record.entity, record);\r\n    }\r\n  }\r\n\r\n}\r\n","export enum ActionbarMode {\r\n  Dock = 'dock',\r\n  Overlay = 'overlay',\r\n  Context = 'context'\r\n}\r\n","<mat-list-item *ngIf=\"!action.checkbox\"\r\n  matTooltipClass=\"actionbarItemTooltip\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\r\n  [ngClass]=\"ngClass$ | async\"\r\n  (click)=\"onClick()\">\r\n  <button *ngIf=\"withIcon\"\r\n    mat-list-avatar\r\n    mat-icon-button\r\n    [color]=\"color\"\r\n    [disabled]=\"disabled$ | async\">\r\n    <mat-icon *ngIf=\"withIcon\" svgIcon=\"{{icon$ | async}}\"></mat-icon>\r\n  </button>\r\n  <h4 *ngIf=\"withTitle\" matLine>{{title | translate}}</h4>\r\n</mat-list-item>\r\n\r\n<mat-list-item class=\"item-checkbox\" *ngIf=\"action.checkbox\"\r\n  matTooltipClass=\"actionbarItemTooltip\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\r\n  [ngClass]=\"ngClass$ | async\">\r\n  <mat-checkbox *ngIf=\"withTitle\"\r\n      (change)=\"action.handler()\"\r\n      [checked]=\"checkCondition$ | async\">\r\n      {{title | translate}}\r\n  </mat-checkbox>\r\n</mat-list-item>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\r\n\r\nimport { Action } from '../shared/action.interfaces';\r\n\r\n /**\r\n  * An action button\r\n  */\r\n@Component({\r\n  selector: 'igo-actionbar-item',\r\n  templateUrl: './actionbar-item.component.html',\r\n  styleUrls: ['./actionbar-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\r\n\r\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\r\n\r\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  readonly ngClass$: BehaviorSubject<{[key: string]: boolean}> = new BehaviorSubject({});\r\n\r\n  private ngClass$$: Subscription;\r\n\r\n  private disabled$$: Subscription;\r\n\r\n  private availability$$: Subscription;\r\n\r\n  private icon$$: Subscription;\r\n\r\n  private checkCondition$$: Subscription;\r\n\r\n  private tooltip$$: Subscription;\r\n\r\n  private noDisplay$$: Subscription;\r\n\r\n  private display$$: Subscription;\r\n\r\n  /**\r\n   * Action\r\n   */\r\n  @Input() action: Action;\r\n\r\n  /**\r\n   * Color\r\n   */\r\n  @Input() color = 'default';\r\n\r\n  /**\r\n   * Whether the action title is displayed\r\n   */\r\n  @Input() withTitle = true;\r\n\r\n  /**\r\n   * Whether the action icon is displayed\r\n   */\r\n  @Input() withIcon = true;\r\n\r\n  /**\r\n   * Whether a tooltip should be shown\r\n   */\r\n  @Input() withTooltip = true;\r\n\r\n  /**\r\n   * Whether the action is disabled\r\n   */\r\n  @Input()\r\n  set disabled(value: boolean) { this.disabled$.next(value); }\r\n  get disabled(): boolean { return this.disabled$.value; }\r\n\r\n  /**\r\n   * Whether the action is display or not\r\n   */\r\n  @Input()\r\n  set noDisplay(value: boolean) { this.noDisplay$.next(value); }\r\n  get noDisplay(): boolean { return this.noDisplay$.value; }\r\n\r\n  /**\r\n   * Event emitted when the action button is clicked\r\n   */\r\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string { return this.action.title; }\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    const args = this.action.args || [];\r\n\r\n    if (this.action.ngClass !== undefined) {\r\n      this.ngClass$$ = this.action.ngClass(...args)\r\n        .subscribe((ngClass: {[key: string]: boolean}) => this.updateNgClass(ngClass));\r\n    }\r\n\r\n    if (isObservable(this.action.icon)) {\r\n      this.icon$$ = this.action.icon\r\n        .subscribe((icon: string) => this.updateIcon(icon));\r\n    } else {\r\n      this.updateIcon(this.action.icon);\r\n    }\r\n\r\n    if (isObservable(this.action.checkCondition)) {\r\n      this.checkCondition$$ = this.action.checkCondition\r\n        .subscribe((checkCondition: boolean) => this.updateCheckCondition(checkCondition));\r\n    } else {\r\n      this.updateCheckCondition(this.action.checkCondition);\r\n    }\r\n\r\n    if (isObservable(this.action.tooltip)) {\r\n      this.tooltip$$ = this.action.tooltip\r\n        .subscribe((tooltip: string) => this.updateTooltip(tooltip));\r\n    } else {\r\n      this.updateTooltip(this.action.tooltip);\r\n    }\r\n\r\n    if (this.action.availability !== undefined) {\r\n      this.availability$$ = this.action.availability(...args)\r\n        .subscribe((available: boolean) => this.disabled = !available);\r\n    }\r\n\r\n    this.disabled$$ = this.disabled$\r\n      .subscribe((disabled: boolean) => this.updateNgClass({'igo-actionbar-item-disabled': disabled}));\r\n\r\n    if (this.action.display !== undefined) {\r\n      this.display$$ = this.action.display(...args)\r\n        .subscribe((display: boolean) => this.noDisplay = !display);\r\n    }\r\n\r\n    this.noDisplay$$ = this.noDisplay$\r\n      .subscribe((noDisplay: boolean) => this.updateNgClass({'igo-actionbar-item-no-display': noDisplay}));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    if (this.ngClass$$ !== undefined) {\r\n      this.ngClass$$.unsubscribe();\r\n      this.ngClass$$ = undefined;\r\n    }\r\n\r\n    if (this.availability$$ !== undefined) {\r\n      this.availability$$.unsubscribe();\r\n      this.availability$$ = undefined;\r\n    }\r\n\r\n    if (this.display$$ !== undefined) {\r\n      this.display$$.unsubscribe();\r\n      this.display$$ = undefined;\r\n    }\r\n\r\n    if (this.checkCondition$$ !== undefined) {\r\n      this.checkCondition$$.unsubscribe();\r\n      this.checkCondition$$ = undefined;\r\n    }\r\n\r\n    if (this.icon$$ !== undefined) {\r\n      this.icon$$.unsubscribe();\r\n      this.icon$$ = undefined;\r\n    }\r\n\r\n    if (this.tooltip$$ !== undefined) {\r\n      this.tooltip$$.unsubscribe();\r\n      this.tooltip$$ = undefined;\r\n    }\r\n\r\n    this.disabled$$.unsubscribe();\r\n    this.noDisplay$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * When the action button is clicked, emit the 'trigger' event but don't\r\n   * invoke the action handler. This is handled by the parent component.\r\n   * @internal\r\n   */\r\n  onClick() {\r\n    if (this.disabled === true) {\r\n      return;\r\n    }\r\n    this.trigger.emit(this.action);\r\n  }\r\n\r\n  private updateNgClass(ngClass: {[key: string]: boolean}) {\r\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\r\n  }\r\n\r\n  private updateTooltip(tooltip: string) {\r\n    this.tooltip$.next(tooltip);\r\n  }\r\n\r\n  private updateCheckCondition(checkCondition: boolean) {\r\n    this.checkCondition$.next(checkCondition);\r\n  }\r\n\r\n  private updateIcon(icon: string) {\r\n    this.icon$.next(icon);\r\n  }\r\n}\r\n","<mat-list *ngIf=\"mode === actionbarMode.Dock\">\r\n\r\n    <div *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\r\n      id=\"topChevron\">\r\n      <button\r\n        mat-icon-button\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\r\n        (click)=\"scrollUp()\">\r\n        <mat-icon svgIcon=\"chevron-up\"></mat-icon>\r\n      </button>\r\n    </div>\r\n\r\n    <igo-actionbar-item\r\n      *ngIf=\"withToggleButton\"\r\n      color=\"accent\"\r\n      [withTitle]=\"false\"\r\n      [withIcon]=\"true\"\r\n      [color]=\"color\"\r\n      [disabled]=\"store.view.empty\"\r\n      [action]=\"toggleCollapseAction\"\r\n      (trigger)=\"onTriggerAction(toggleCollapseAction)\">\r\n    </igo-actionbar-item>\r\n\r\n    <ng-template #buttonContent *ngIf=\"!collapsed\" ngFor let-action [ngForOf]=\"store.view.all$() | async\">\r\n      <igo-actionbar-item\r\n        color=\"accent\"\r\n        [withTitle]=\"withTitle\"\r\n        [withIcon]=\"withIcon\"\r\n        [withTooltip]=\"withTooltip\"\r\n        [color]=\"color\"\r\n        [disabled]=\"store.state.get(action).disabled\"\r\n        [action]=\"action\"\r\n        (trigger)=\"onTriggerAction(action)\">\r\n      </igo-actionbar-item>\r\n    </ng-template>\r\n\r\n    <div *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\r\n      id=\"lowChevron\">\r\n      <button\r\n        mat-icon-button\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\r\n        (click)=\"scrollDown()\">\r\n        <mat-icon svgIcon=\"chevron-down\"></mat-icon>\r\n      </button>\r\n    </div>\r\n\r\n</mat-list>\r\n\r\n<div *ngIf=\"mode === actionbarMode.Overlay\">\r\n  <button class=\"buttonOverlay\"\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\r\n    [matMenuTriggerFor]=\"actionbarMenu\"\r\n    [disabled]=\"store.view.empty\"\r\n    [color]=\"iconColor\">\r\n    <mat-icon [svgIcon]=\"icon\"></mat-icon>\r\n  </button>\r\n\r\n  <mat-menu\r\n    #actionbarMenu=\"matMenu\"\r\n    class=\"igo-compact-menu igo-no-min-width-menu\"\r\n    overlapTrigger=\"true\"\r\n    [xPosition]=\"xPosition\"\r\n    [yPosition]=\"yPosition\"\r\n    [class]=\"overlayClass\">\r\n\r\n    <mat-list>\r\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\r\n        <igo-actionbar-item\r\n          color=\"accent\"\r\n          [withTitle]=\"withTitle\"\r\n          [withIcon]=\"withIcon\"\r\n          [color]=\"color\"\r\n          [action]=\"action\"\r\n          (trigger)=\"onTriggerAction(action)\">\r\n        </igo-actionbar-item>\r\n      </ng-template>\r\n    </mat-list>\r\n  </mat-menu>\r\n</div>\r\n<mat-card *ngIf=\"mode === actionbarMode.Context\" class=\"context-menu-card mat-elevation-z4\">\r\n  <mat-list>\r\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\r\n          <igo-actionbar-item\r\n            color=\"accent\"\r\n            [withTitle]=\"withTitle\"\r\n            [withIcon]=\"withIcon\"\r\n            [color]=\"color\"\r\n            [action]=\"action\"\r\n            (trigger)=\"onTriggerAction(action)\">\r\n          </igo-actionbar-item>\r\n        <br/>\r\n      </ng-template>\r\n  </mat-list>\r\n</mat-card>\r\n","import {\r\n  Component,\r\n  Input,\r\n  HostBinding,\r\n  ChangeDetectorRef,\r\n  ChangeDetectionStrategy,\r\n  OnChanges,\r\n  OnDestroy,\r\n  SimpleChanges,\r\n  ElementRef\r\n} from '@angular/core';\r\n\r\nimport { MediaService, Media } from '@igo2/core';\r\nimport { EntityStoreWatcher } from '../../entity';\r\nimport { Action } from '../shared/action.interfaces';\r\nimport { ActionbarMode } from '../shared/action.enums';\r\nimport { ActionStore } from '../shared/store';\r\nimport { Overlay } from '@angular/cdk/overlay';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n/**\r\n * A list of action buttons.\r\n * This component can be displayed in one of two way: 'dock' or 'overlay'\r\n */\r\n@Component({\r\n  selector: 'igo-actionbar',\r\n  templateUrl: './actionbar.component.html',\r\n  styleUrls: ['./actionbar.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ActionbarComponent implements OnDestroy, OnChanges {\r\n\r\n  /**\r\n   * Reference to the ActionbarMode enum for use in the template\r\n   * @internal\r\n   */\r\n  actionbarMode = ActionbarMode;\r\n\r\n  /**\r\n   * Whether the actionbar is collapsed (Dock mode)\r\n   * @internal\r\n   */\r\n  collapsed = false;\r\n\r\n  /**\r\n   * Toggle collapse action (Dock)\r\n   * @internal\r\n   */\r\n  toggleCollapseAction = {\r\n    id: 'actionbar_toggle',\r\n    icon: 'dots-vertical',\r\n    handler: () => {\r\n      this.collapsed = !this.collapsed;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Action store watcher\r\n   * @internal\r\n   */\r\n  private watcher: EntityStoreWatcher<Action>;\r\n\r\n  /**\r\n   * Height Condition for scroll button\r\n   */\r\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\r\n\r\n  /**\r\n   * Position Condition for top scroll button\r\n   */\r\n  positionConditionTop$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\r\n\r\n  /**\r\n   * Position Condition for low scroll button\r\n   */\r\n  positionConditionLow$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\r\n\r\n  /**\r\n   * Action store\r\n   */\r\n  @Input() store: ActionStore;\r\n\r\n  /**\r\n   * Actionbar mode\r\n   */\r\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\r\n\r\n  /**\r\n   * Whether a toggle button should be displayed (Dock mode)\r\n   */\r\n  @Input() withToggleButton = false;\r\n\r\n  /**\r\n   * Whether a the actionbar should display buttons horizontally\r\n   */\r\n  @Input() horizontal = false;\r\n\r\n  /**\r\n   * Color\r\n   */\r\n  @Input() color = 'default';\r\n\r\n  /**\r\n   * Color of the button if action mode === overlay\r\n   */\r\n  @Input() iconColor = 'default';\r\n\r\n  /**\r\n   * Whether action titles are displayed\r\n   */\r\n  @Input() withTitle = true;\r\n\r\n  /**\r\n   * Whether action tooltips are displayed\r\n   */\r\n  @Input() withTooltip = true;\r\n\r\n  /**\r\n   * Whether action titles are displayed (condition for scroll button)\r\n   */\r\n  @Input() scrollActive = true;\r\n\r\n  /**\r\n   * Whether action icons are displayed\r\n   */\r\n  @Input() withIcon = true;\r\n\r\n  /**\r\n   * Which icon want to be shown\r\n   */\r\n  @Input() icon = 'dots-horizontal';\r\n\r\n  /**\r\n   * Overlay X position\r\n   */\r\n  @Input() xPosition = 'before';\r\n\r\n  /**\r\n   * Overlay Y position\r\n   */\r\n  @Input() yPosition = 'above';\r\n\r\n  /**\r\n   * Class to add to the actionbar overlay\r\n   */\r\n  @Input()\r\n  set overlayClass(value: string) {\r\n    this._overlayClass = value;\r\n  }\r\n  get overlayClass(): string {\r\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\r\n  }\r\n  private _overlayClass = '';\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.with-title')\r\n  get withTitleClass() {\r\n    return this.withTitle;\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.with-icon')\r\n  get withIconClass() {\r\n    return this.withIcon;\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.horizontal')\r\n  get horizontalClass() {\r\n    return this.horizontal;\r\n  }\r\n\r\n  get heightCondition(): boolean {\r\n    const el = this.elRef.nativeElement;\r\n    if (this.scrollActive === false) {\r\n      if (el.clientHeight < el.scrollHeight) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get positionConditionTop(): boolean {\r\n    if (this.elRef.nativeElement.scrollTop === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get positionConditionLow(): boolean {\r\n    const el = this.elRef.nativeElement;\r\n    if (el.scrollTop >= (el.scrollHeight - el.clientHeight)) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get isDesktop(): boolean {\r\n    return this.mediaService.getMedia() === Media.Desktop;\r\n  }\r\n\r\n  constructor(\r\n    public overlay: Overlay,\r\n    private elRef: ElementRef,\r\n    private cdRef: ChangeDetectorRef,\r\n    public mediaService: MediaService) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const store = changes.store;\r\n    if (store && store.currentValue !== store.previousValue) {\r\n      if (this.watcher !== undefined) {\r\n        this.watcher.destroy();\r\n      }\r\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n  }\r\n\r\n  /**\r\n   * Invoke the action handler\r\n   * @internal\r\n   */\r\n  onTriggerAction(action: Action) {\r\n    const args = action.args || [];\r\n    action.handler(...args);\r\n  }\r\n\r\n  scrollDown() {\r\n    this.elRef.nativeElement.scrollBy(0, 52);\r\n  }\r\n\r\n  scrollUp() {\r\n    this.elRef.nativeElement.scrollBy(0, -52);\r\n  }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { ActionbarComponent } from './actionbar.component';\r\nimport { ActionbarItemComponent } from './actionbar-item.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoLanguageModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatMenuModule,\r\n    MatListModule,\r\n    MatCardModule,\r\n    MatCheckboxModule\r\n  ],\r\n  exports: [ActionbarComponent],\r\n  declarations: [ActionbarComponent, ActionbarItemComponent]\r\n})\r\nexport class IgoActionbarModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoActionbarModule } from './actionbar/actionbar.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoActionbarModule\r\n  ],\r\n  exports: [\r\n    IgoActionbarModule\r\n  ],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoActionModule {}\r\n","import { Directive, Input, ElementRef, OnInit } from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\n\r\n@Directive({\r\n  selector: '[igoMatBadgeIcon]'\r\n})\r\nexport class IgoBadgeIconDirective implements OnInit {\r\n  @Input()\r\n  set igoMatBadgeIcon(value: string) {\r\n    this.matIconRegistry.getNamedSvgIcon(value).subscribe((svgObj) => {\r\n      this.svg = svgObj;\r\n      this.updateSvg();\r\n    });\r\n  }\r\n  private svg: SVGElement;\r\n\r\n  @Input()\r\n  set matBadgeHidden(value: boolean) {\r\n    this.hidden = value;\r\n    this.updateHidden();\r\n  }\r\n  private hidden = false;\r\n\r\n  @Input()\r\n  set matBadgeDisabled(value: boolean) {\r\n    this.disabled = value;\r\n    this.updateDisabled();\r\n  }\r\n  private disabled = false;\r\n\r\n  @Input()\r\n  set igoMatBadgeInverseColor(value: boolean) {\r\n    this.inverseColor = value;\r\n    this.updateColor();\r\n  }\r\n  private inverseColor = false;\r\n\r\n  @Input()\r\n  set igoMatBadgeInheritColor(value: boolean) {\r\n    this.inheritColor = value;\r\n    this.updateColor();\r\n  }\r\n  private inheritColor = false;\r\n\r\n  get badge() {\r\n    return this.el.nativeElement.querySelector('.mat-badge-content');\r\n  }\r\n\r\n  private originalColor: string;\r\n\r\n  constructor(\r\n    private el: ElementRef,\r\n    private matIconRegistry: MatIconRegistry\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.badge.style.alignItems = 'center';\r\n    this.badge.style.justifyContent = 'center';\r\n\r\n    this.updateHidden();\r\n    this.updateColor();\r\n    this.updateSvg();\r\n  }\r\n\r\n  private updateSvg() {\r\n    if (!this.badge) {\r\n      return;\r\n    }\r\n    this.badge.innerHTML = '';\r\n    if (this.svg) {\r\n      this.badge.appendChild(this.svg);\r\n    }\r\n  }\r\n  private updateColor() {\r\n    if (!this.badge) {\r\n      return;\r\n    }\r\n\r\n    if (this.inheritColor) {\r\n      if (this.inverseColor) {\r\n        this.badge.style.color = 'currentColor';\r\n        this.badge.style.background = 'none';\r\n      } else {\r\n        this.badge.style.color = '';\r\n        this.badge.style.background = 'currentColor';\r\n      }\r\n    } else {\r\n      if (this.inverseColor) {\r\n        this.badge.style.color = window\r\n          .getComputedStyle(this.badge, null)\r\n          .getPropertyValue('background-color');\r\n        this.badge.style.background = 'none';\r\n      } else {\r\n        this.badge.style.color = '';\r\n        this.badge.style.background = '';\r\n      }\r\n    }\r\n    this.originalColor = this.badge.style.color;\r\n    this.updateDisabled();\r\n  }\r\n\r\n  private updateHidden() {\r\n    if (!this.badge) {\r\n      return;\r\n    }\r\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\r\n  }\r\n\r\n  private updateDisabled() {\r\n    if (!this.badge || !this.inverseColor) {\r\n      return;\r\n    }\r\n    if (this.disabled) {\r\n      this.originalColor = this.badge.style.color;\r\n      this.badge.style.color = '#b9b9b9';\r\n    } else {\r\n      this.badge.style.color = this.originalColor;\r\n    }\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { IgoBadgeIconDirective } from './badge-icon.directive';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\n@NgModule({\r\n  imports: [MatBadgeModule, MatIconModule],\r\n  declarations: [IgoBadgeIconDirective],\r\n  exports: [MatBadgeModule, IgoBadgeIconDirective]\r\n})\r\nexport class IgoMatBadgeIconModule {\r\n  static forRoot(): ModuleWithProviders<IgoMatBadgeIconModule> {\r\n    return {\r\n      ngModule: IgoMatBadgeIconModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  ElementRef,\r\n  EventEmitter,\r\n  HostListener,\r\n  Output\r\n} from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoClickout]'\r\n})\r\nexport class ClickoutDirective {\r\n  @Output() clickout = new EventEmitter<MouseEvent>();\r\n\r\n  @HostListener('document:click', ['$event', '$event.target'])\r\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\r\n    if (!target) {\r\n      return;\r\n    }\r\n\r\n    if (!this.el.nativeElement.contains(target)) {\r\n      this.clickout.emit(event);\r\n    }\r\n  }\r\n\r\n  constructor(private el: ElementRef) {}\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { ClickoutDirective } from './clickout.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [ClickoutDirective],\r\n  exports: [ClickoutDirective]\r\n})\r\nexport class IgoClickoutModule {\r\n  static forRoot(): ModuleWithProviders<IgoClickoutModule> {\r\n    return {\r\n      ngModule: IgoClickoutModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  HostListener,\r\n  ElementRef,\r\n  Renderer2\r\n} from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoCollapse]'\r\n})\r\nexport class CollapseDirective {\r\n  @Input()\r\n  get target() {\r\n    return this._target;\r\n  }\r\n  set target(value: Element) {\r\n    this._target = value;\r\n  }\r\n  private _target: Element;\r\n\r\n  @Input()\r\n  get collapsed(): boolean {\r\n    return this._collapsed;\r\n  }\r\n  set collapsed(collapsed: boolean) {\r\n    collapsed ? this.collapseTarget() : this.expandTarget();\r\n    this._collapsed = collapsed;\r\n    this.toggle.emit(collapsed);\r\n  }\r\n  private _collapsed = false;\r\n\r\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\r\n\r\n  @HostListener('click')\r\n  click() {\r\n    this.collapsed = !this.collapsed;\r\n  }\r\n\r\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\r\n\r\n  private collapseTarget() {\r\n    this.renderer.addClass(this.target, 'igo-collapsed');\r\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\r\n  }\r\n\r\n  private expandTarget() {\r\n    this.renderer.removeClass(this.target, 'igo-collapsed');\r\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\r\n  }\r\n}\r\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'igo-collapsible',\r\n  templateUrl: './collapsible.component.html',\r\n  styleUrls: ['./collapsible.component.scss']\r\n})\r\nexport class CollapsibleComponent {\r\n  @Input()\r\n  get title() {\r\n    return this._title;\r\n  }\r\n  set title(value: string) {\r\n    this._title = value;\r\n  }\r\n  private _title = '';\r\n\r\n  @Input()\r\n  get collapsed() {\r\n    return this._collapsed;\r\n  }\r\n  set collapsed(value: boolean) {\r\n    this._collapsed = value;\r\n    this.toggle.emit(value);\r\n  }\r\n  private _collapsed = false;\r\n\r\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\r\n}\r\n","<mat-list-item>\r\n  <mat-icon\r\n    svgIcon=\"chevron-up\" \r\n    class=\"igo-chevron\"\r\n    mat-list-avatar\r\n    igoCollapse\r\n    [target]=\"content\"\r\n    [collapsed]=\"collapsed\"\r\n    (toggle)=\"collapsed = $event\">\r\n  </mat-icon>\r\n  <h4 matLine>{{title}}</h4>\r\n</mat-list-item>\r\n\r\n<div #content>\r\n  <ng-content></ng-content>\r\n</div>\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\n\r\nimport { CollapseDirective } from './collapse.directive';\r\nimport { CollapsibleComponent } from './collapsible.component';\r\n\r\n@NgModule({\r\n  imports: [MatIconModule, MatListModule],\r\n  declarations: [CollapsibleComponent, CollapseDirective],\r\n  exports: [CollapsibleComponent, CollapseDirective]\r\n})\r\nexport class IgoCollapsibleModule {\r\n  static forRoot(): ModuleWithProviders<IgoCollapsibleModule> {\r\n    return {\r\n      ngModule: IgoCollapsibleModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\n\r\n@Component({\r\n  selector: 'igo-confirm-dialog',\r\n  templateUrl: './confirm-dialog.component.html',\r\n  styleUrls: ['./confirm-dialog.component.scss']\r\n})\r\nexport class ConfirmDialogComponent {\r\n  public confirmMessage: string;\r\n\r\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\r\n}\r\n","<h2 mat-dialog-title class=\"mat-typography\">{{'igo.common.confirmDialog.title' |translate}}</h2>\r\n<div mat-dialog-content class=\"mat-typography\">{{confirmMessage}}</div>\r\n<div mat-dialog-actions>\r\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(true)\">{{'igo.common.confirmDialog.confirmBtn' | translate}}</button>\r\n  <button mat-button (click)=\"dialogRef.close(false)\">{{'igo.common.confirmDialog.cancelBtn' |translate}}</button>\r\n</div>\r\n","import { Injectable } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\r\n\r\n@Injectable()\r\nexport class ConfirmDialogService {\r\n  constructor(private dialog: MatDialog) {}\r\n\r\n  public open(message: string): Observable<any> {\r\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\r\n      disableClose: false\r\n    });\r\n    dialogRef.componentInstance.confirmMessage = message;\r\n\r\n    return dialogRef.afterClosed();\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\r\nimport { ConfirmDialogService } from './confirm-dialog.service';\r\n\r\n@NgModule({\r\n  imports: [MatButtonModule, MatDialogModule, IgoLanguageModule],\r\n  declarations: [ConfirmDialogComponent],\r\n  exports: [ConfirmDialogComponent],\r\n  providers: [ConfirmDialogService]\r\n})\r\nexport class IgoConfirmDialogModule {\r\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\r\n    return {\r\n      ngModule: IgoConfirmDialogModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  ElementRef,\r\n  EventEmitter,\r\n  HostListener,\r\n  Input,\r\n  OnDestroy,\r\n  Output,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\nimport type { TemplateRef } from '@angular/core';\r\n\r\nimport { TemplatePortal } from '@angular/cdk/portal';\r\nimport { fromEvent, Observable, of, Subscription } from 'rxjs';\r\nimport { delay, filter, mergeMap, take, takeUntil, tap } from 'rxjs/operators';\r\nimport { Overlay, OverlayRef } from '@angular/cdk/overlay';\r\n\r\n@Directive({\r\n  selector: '[igoContextMenu]'\r\n})\r\nexport class ContextMenuDirective implements OnDestroy {\r\n  private overlayRef: OverlayRef | null;\r\n  private sub: Subscription;\r\n  private longTouch$$: Subscription;\r\n  private touchmove$$: Subscription;\r\n  private touchend$$: Subscription;\r\n  private isDragging: boolean = false;\r\n\r\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\r\n  @Input() touchDelayMs: number = 500;\r\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\r\n\r\n  constructor(\r\n    public overlay: Overlay,\r\n    public viewContainerRef: ViewContainerRef,\r\n    private elementRef: ElementRef\r\n  ) {\r\n\r\n    const touchstart$: Observable<TouchEvent> = fromEvent(elementRef.nativeElement, 'touchstart');\r\n    const touchmove$: Observable<TouchEvent> = fromEvent(elementRef.nativeElement, 'touchmove');\r\n    const touchend$: Observable<TouchEvent> = fromEvent(elementRef.nativeElement, 'touchend');\r\n\r\n    touchmove$.subscribe(() => {\r\n      this.isDragging = true;\r\n      this.close();\r\n    });\r\n    touchend$.subscribe(() => this.isDragging = false);\r\n\r\n    const longTouch$ = touchstart$.pipe(\r\n      tap((event) => {\r\n        event.preventDefault();\r\n        window.document.body.style['-webkit-user-select'] = 'none';\r\n      }),\r\n      mergeMap((e) => {\r\n        return of(e).pipe(\r\n          delay(this.touchDelayMs),\r\n          takeUntil(touchend$),\r\n        );\r\n      }),\r\n    );\r\n    this.longTouch$$ = longTouch$.pipe(\r\n      tap((event) => {\r\n        this.onContextMenu(event);\r\n      }), delay(2000)\r\n    ).subscribe(() => window.document.body.style['-webkit-user-select'] = 'auto');\r\n  }\r\n  ngOnDestroy(): void {\r\n    if (this.longTouch$$) {\r\n      this.longTouch$$.unsubscribe();\r\n    }\r\n    if (this.touchmove$$) {\r\n      this.touchmove$$.unsubscribe();\r\n    }\r\n    if (this.touchend$$) {\r\n      this.touchend$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  @HostListener('contextmenu', ['$event'])\r\n  public onContextMenu(e: MouseEvent | TouchEvent): void {\r\n    if (this.isDragging) {\r\n      return;\r\n    }\r\n\r\n    let x = 0;\r\n    let y = 0;\r\n    if (e instanceof TouchEvent) {\r\n      if (e.touches.length > 1) {\r\n        return; // prevent map rotation conflict\r\n      }\r\n      x = e.touches[0].clientX;\r\n      y = e.touches[0].clientY;\r\n    } else {\r\n      x = e.x;\r\n      y = e.y;\r\n    }\r\n\r\n    this.close();\r\n    e.preventDefault();\r\n    this.menuPosition.emit({ x, y });\r\n    this.overlayRef = null;\r\n    const positionStrategy = this.overlay\r\n      .position()\r\n      .flexibleConnectedTo({ x, y })\r\n      .withPositions([\r\n        {\r\n          originX: 'end',\r\n          originY: 'bottom',\r\n          overlayX: 'start',\r\n          overlayY: 'top'\r\n        }\r\n      ]);\r\n    this.overlayRef = this.overlay.create({\r\n      positionStrategy,\r\n      scrollStrategy: this.overlay.scrollStrategies.close()\r\n    });\r\n    this.overlayRef.attach(\r\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\r\n        $implicit: undefined\r\n      })\r\n    );\r\n\r\n    this.sub = fromEvent<MouseEvent>(document, 'click')\r\n      .pipe(\r\n        filter(event => {\r\n          const clickTarget = event.target as HTMLElement;\r\n          this.close();\r\n          return (\r\n            !!this.overlayRef &&\r\n            !this.overlayRef.overlayElement.contains(clickTarget)\r\n          );\r\n        }),\r\n        take(1)\r\n      )\r\n      .subscribe(() => this.close());\r\n\r\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\r\n      .pipe(\r\n        filter(event => {\r\n          const clickTarget = event.target as HTMLElement;\r\n          if (\r\n            clickTarget &&\r\n            !this.elementRef.nativeElement.contains(clickTarget) &&\r\n            !this.overlayRef.overlayElement.contains(clickTarget)\r\n          ) {\r\n            return true;\r\n          } else {\r\n            event.preventDefault();\r\n          }\r\n        }),\r\n        take(1)\r\n      )\r\n      .subscribe(() => this.close());\r\n  }\r\n\r\n  close() {\r\n    if (this.overlayRef) {\r\n      this.overlayRef.dispose();\r\n      this.overlayRef = null;\r\n    }\r\n    if (this.sub) {\r\n      this.sub.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { ContextMenuDirective } from './context-menu.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [ContextMenuDirective],\r\n  exports: [ContextMenuDirective]\r\n})\r\nexport class IgoContextMenuModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextMenuModule> {\r\n    return {\r\n      ngModule: IgoContextMenuModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { CustomHtmlComponent } from './custom-html.component';\r\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatInputModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [SanitizeHtmlPipe, CustomHtmlComponent],\r\n  declarations: [SanitizeHtmlPipe, CustomHtmlComponent]\r\n})\r\nexport class IgoCustomHtmlModule {\r\n  static forRoot(): ModuleWithProviders<IgoCustomHtmlModule> {\r\n    return {\r\n      ngModule: IgoCustomHtmlModule\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { DragAndDropDirective } from './drag-drop.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [DragAndDropDirective],\r\n  exports: [DragAndDropDirective]\r\n})\r\nexport class IgoDrapDropModule {\r\n  static forRoot(): ModuleWithProviders<IgoDrapDropModule> {\r\n    return {\r\n      ngModule: IgoDrapDropModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import {\r\n  ComponentFactory,\r\n  ComponentRef,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\n\r\nimport { Observable, Subscription } from 'rxjs';\r\n\r\n/**\r\n * This class is used in the DynamicComponentOutlet component. It holds\r\n * a reference to a component factory and can render that component\r\n * in a target element on demand. It's also possible to set inputs\r\n * and to subscribe to outputs.\r\n */\r\nexport class DynamicComponent<C> {\r\n\r\n  /**\r\n   * Component reference\r\n   */\r\n  private componentRef: ComponentRef<C>;\r\n\r\n  /**\r\n   * Subscriptions to the component's outputs. Those need\r\n   * to be unsubscribed when the component is destroyed.\r\n   */\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  /**\r\n   * Component target element\r\n   */\r\n  private target: ViewContainerRef;\r\n\r\n  /**\r\n   * Component inputs\r\n   */\r\n  private inputs: {[key: string]: any} = {};\r\n\r\n  /**\r\n   * Subscriptions to the component's async inputs\r\n   */\r\n  private inputs$$: {[key: string]: Subscription} = {};\r\n\r\n  /**\r\n   * Subscribers to the component's outputs\r\n   */\r\n  private subscribers: {[key: string]: (event: any) => void} = {};\r\n\r\n  constructor(private componentFactory: ComponentFactory<C>) {}\r\n\r\n  /**\r\n   * Render the component to a target element.\r\n   * Set it's inputs and subscribe to it's outputs.\r\n   * @param target Target element\r\n   */\r\n  setTarget(target: ViewContainerRef) {\r\n    this.target = target;\r\n    this.componentRef = target.createComponent(this.componentFactory);\r\n    this.updateInputs(this.inputs);\r\n    this.updateSubscribers(this.subscribers);\r\n  }\r\n\r\n  /**\r\n   * Destroy this component. That means, removing from it's target\r\n   * element and unsubscribing to it's outputs.\r\n   */\r\n  destroy() {\r\n    if (this.target !== undefined) {\r\n      this.target.clear();\r\n    }\r\n    if (this.componentRef !== undefined) {\r\n      this.componentRef.destroy();\r\n      this.componentRef = undefined;\r\n    }\r\n    this.unobserveAllInputs();\r\n    this.unsubscribeAll();\r\n  }\r\n\r\n  /**\r\n   * Update the component inputs. This is an update so any\r\n   * key not defined won't be overwritten.\r\n   */\r\n  updateInputs(inputs: {[key: string]: any}) {\r\n    this.inputs = inputs;\r\n    if (this.componentRef === undefined) {\r\n      return;\r\n    }\r\n\r\n    const instance = this.componentRef.instance;\r\n    const allowedInputs = this.componentFactory.inputs;\r\n    allowedInputs.forEach((value: {propName: string; templateName: string; }) => {\r\n      const key = value.propName;\r\n\r\n      this.unobserveInput(key);\r\n\r\n      const inputValue = inputs[key];\r\n      if (inputs.hasOwnProperty(key)) {\r\n        if (inputValue instanceof Observable) {\r\n          this.observeInput(key, inputValue);\r\n        } else {\r\n          this.setInputValue(instance, key, inputValue);\r\n        }\r\n      }\r\n    });\r\n\r\n    if (typeof (instance as any).onUpdateInputs === 'function') {\r\n      (instance as any).onUpdateInputs();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set an instance's input value\r\n   * @param instance Component instance\r\n   * @param key Input key\r\n   * @param value Input value\r\n   */\r\n  private setInputValue(instance: C, key: string, value: any) {\r\n    const currentValue = instance[key];\r\n    if (value === currentValue) {\r\n      return;\r\n    }\r\n\r\n    const prototype = Object.getPrototypeOf(instance);\r\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\r\n    if (descriptor !== undefined && descriptor.set !== undefined) {\r\n      descriptor.set.call(instance, value);\r\n    } else {\r\n      instance[key] = value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the component subscribers. This is an update so any\r\n   * key not defined won't be overwritten.\r\n   */\r\n  updateSubscribers(subscribers: {[key: string]: (event: any) => void}) {\r\n    this.subscribers = subscribers;\r\n    if (this.componentRef === undefined) {\r\n      return;\r\n    }\r\n\r\n    const instance = this.componentRef.instance;\r\n    const allowedSubscribers = this.componentFactory.outputs;\r\n    allowedSubscribers.forEach((value: {propName: string; templateName: string; }) => {\r\n      const key = value.propName;\r\n      if (subscribers.hasOwnProperty(key)) {\r\n        const emitter = instance[key];\r\n        const subscriber = subscribers[key];\r\n        if (Array.isArray(subscriber)) {\r\n          subscriber.forEach((_subscriber) => {\r\n            this.subscriptions.push(emitter.subscribe(_subscriber));\r\n          });\r\n        } else {\r\n          this.subscriptions.push(emitter.subscribe(subscriber));\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Subscribe to an observable input and update the component's input value\r\n   * accordingly\r\n   * @param key Input key\r\n   * @param observable Observable\r\n   */\r\n  private observeInput(key: string, observable: Observable<any>) {\r\n    this.inputs$$[key] = observable.subscribe((value: any) => {\r\n      const instance = this.componentRef.instance;\r\n      this.setInputValue(instance, key, value);\r\n\r\n      if (typeof (instance as any).onUpdateInputs === 'function') {\r\n        (instance as any).onUpdateInputs();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to an observable input\r\n   * @param key Input key\r\n   */\r\n  private unobserveInput(key: string) {\r\n    if (this.inputs$$[key] !== undefined) {\r\n      this.inputs$$[key].unsubscribe();\r\n      this.inputs$$[key] = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to all outputs.\r\n   */\r\n  private unobserveAllInputs() {\r\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\r\n      if (s !== undefined) {\r\n        s.unsubscribe();\r\n      }\r\n    });\r\n    this.inputs$$ = {};\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to all outputs.\r\n   */\r\n  private unsubscribeAll() {\r\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\r\n    this.subscriptions = [];\r\n  }\r\n\r\n}\r\n","import {\r\n  ComponentFactoryResolver,\r\n  Injectable\r\n} from '@angular/core';\r\n\r\nimport { DynamicComponent } from './dynamic-component';\r\n\r\n/**\r\n * Service to creates DynamicComponent instances from base component classes\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DynamicComponentService {\r\n\r\n  constructor(private resolver: ComponentFactoryResolver) {}\r\n\r\n  /**\r\n   * Creates a DynamicComponent instance from a base component class\r\n   * @param componentCls The component class\r\n   * @returns DynamicComponent instance\r\n   */\r\n  create(componentCls: any): DynamicComponent<any> {\r\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\r\n    return new DynamicComponent<typeof componentCls>(factory);\r\n  }\r\n}\r\n","import {\r\n  Input,\r\n  ChangeDetectorRef,\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  OnChanges,\r\n  OnDestroy,\r\n  SimpleChanges,\r\n  ViewContainerRef,\r\n  ViewChild\r\n} from '@angular/core';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { DynamicComponent } from '../shared/dynamic-component';\r\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\r\n\r\n@Component({\r\n  selector: 'igo-dynamic-outlet',\r\n  templateUrl: 'dynamic-outlet.component.html',\r\n  styleUrls: ['dynamic-outlet.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\r\n  /**\r\n   * The dynamic component base class or the dynamic component itself\r\n   */\r\n  @Input() component: DynamicComponent<any> | any;\r\n\r\n  /**\r\n   * The dynamic component inputs\r\n   */\r\n  @Input() inputs: { [key: string]: any } = {};\r\n\r\n  /**\r\n   * The subscribers to the dynamic component outputs\r\n   */\r\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\r\n\r\n  /**\r\n   * The dynamic component\r\n   */\r\n  private dynamicComponent: DynamicComponent<any>;\r\n\r\n  /**\r\n   * The view element to render the component to\r\n   * @ignore\r\n   */\r\n  @ViewChild('target', { read: ViewContainerRef, static: true })\r\n  private target: ViewContainerRef;\r\n\r\n  constructor(\r\n    private dynamicComponentService: DynamicComponentService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  /**\r\n   * If the dynamic component changes, create it.\r\n   * If the inputs or subscribers change, update the current component's\r\n   * inputs or subscribers.\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const component = changes.component;\r\n    const inputs = changes.inputs;\r\n    const subscribers = changes.subscribers;\r\n    const eq = ObjectUtils.objectsAreEquivalent;\r\n\r\n    if (component && component.currentValue !== component.previousValue) {\r\n      this.createComponent(component.currentValue);\r\n    } else {\r\n      const inputsAreEquivalents =\r\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\r\n      const subscribersAreEquivalents =\r\n        subscribers &&\r\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\r\n\r\n      if (inputsAreEquivalents === false) {\r\n        this.updateInputs();\r\n      }\r\n\r\n      if (subscribersAreEquivalents === false) {\r\n        this.updateSubscribers();\r\n      }\r\n    }\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * Destroy the dynamic component and all it's subscribers\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    if (this.dynamicComponent) {\r\n      this.dynamicComponent.destroy();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a  DynamicComponent out of the component class and render it.\r\n   * @internal\r\n   */\r\n  private createComponent(component: DynamicComponent<any> | any) {\r\n    if (this.dynamicComponent !== undefined) {\r\n      this.dynamicComponent.destroy();\r\n    }\r\n    this.dynamicComponent =\r\n      component instanceof DynamicComponent\r\n        ? component\r\n        : this.dynamicComponentService.create(component);\r\n    this.renderComponent();\r\n  }\r\n\r\n  /**\r\n   * Create and render the dynamic component. Set it's inputs and subscribers\r\n   * @internal\r\n   */\r\n  private renderComponent() {\r\n    this.updateInputs();\r\n    this.updateSubscribers();\r\n    this.dynamicComponent.setTarget(this.target);\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic component inputs. This is an update so any\r\n   * key not defined won't be overwritten.\r\n   * @internal\r\n   */\r\n  private updateInputs() {\r\n    this.dynamicComponent.updateInputs(this.inputs);\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic component subscribers. This is an update so any\r\n   * key not defined won't be overwritten.\r\n   * @internal\r\n   */\r\n  private updateSubscribers() {\r\n    this.dynamicComponent.updateSubscribers(this.subscribers);\r\n  }\r\n}\r\n","<ng-template #target></ng-template>\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { DynamicOutletComponent } from './dynamic-outlet.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n    DynamicOutletComponent\r\n  ],\r\n  declarations: [\r\n    DynamicOutletComponent\r\n  ]\r\n})\r\nexport class IgoDynamicOutletModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoDynamicOutletModule } from './dynamic-outlet/dynamic-outlet.module';\r\nimport { DynamicComponentService } from './shared/dynamic-component.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoDynamicOutletModule\r\n  ],\r\n  exports: [\r\n    IgoDynamicOutletModule\r\n  ],\r\n  providers: [\r\n    DynamicComponentService\r\n  ]\r\n})\r\nexport class IgoDynamicComponentModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { FlexibleComponent } from './flexible.component';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [FlexibleComponent],\r\n  exports: [FlexibleComponent]\r\n})\r\nexport class IgoFlexibleModule {\r\n  static forRoot(): ModuleWithProviders<IgoFlexibleModule> {\r\n    return {\r\n      ngModule: IgoFlexibleModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  ChangeDetectionStrategy,\r\n  ViewChild,\r\n  ElementRef\r\n} from '@angular/core';\r\n\r\nimport t from 'typy';\r\n\r\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\r\nimport { getAllFormFields } from '../shared/form.utils';\r\n\r\n/**\r\n * A configurable form\r\n */\r\n@Component({\r\n  selector: 'igo-form',\r\n  templateUrl: './form.component.html',\r\n  styleUrls: ['./form.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormComponent implements OnChanges {\r\n\r\n  /**\r\n   * Form\r\n   */\r\n  @Input() form: Form;\r\n\r\n  /**\r\n   * Input data\r\n   */\r\n  @Input() formData: { [key: string]: any};\r\n\r\n  /**\r\n   * Form autocomplete\r\n   */\r\n  @Input() autocomplete: string = 'off';\r\n\r\n  /**\r\n   * Event emitted when the form is submitted\r\n   */\r\n  @Output() submitForm = new EventEmitter<{[key: string]: any}>();\r\n\r\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\r\n\r\n  get hasButtons(): boolean {\r\n    return this.buttons.nativeElement.children.length !== 0;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Is the entity or the template change, recreate the form or repopulate it.\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const formData = changes.formData;\r\n    if (formData && formData.currentValue !== formData.previousValue) {\r\n      if (formData.currentValue === undefined) {\r\n        this.clear();\r\n      } else {\r\n        this.setData(formData.currentValue);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transform the form data to a feature and emit an event\r\n   * @param event Form submit event\r\n   * @internal\r\n   */\r\n  onSubmit() {\r\n    this.submitForm.emit(this.getData());\r\n  }\r\n\r\n  getData(): { [key: string]: any} {\r\n    const data = {};\r\n    getAllFormFields(this.form).forEach((field: FormField) => {\r\n      this.updateDataWithFormField(data, field);\r\n    });\r\n    return data;\r\n  }\r\n\r\n  private setData(data: {[key: string]: any}) {\r\n    this.form.fields.forEach((field: FormField) => {\r\n      field.control.setValue(t(data, field.name).safeObject);\r\n    });\r\n\r\n    this.form.groups.forEach((group: FormFieldGroup) => {\r\n      group.fields.forEach((field: FormField) => {\r\n        field.control.setValue(t(data, field.name).safeObject);\r\n      });\r\n    });\r\n  }\r\n\r\n  private updateDataWithFormField(data: { [key: string]: any}, field: FormField) {\r\n    const control = field.control;\r\n    if (!control.disabled) {\r\n      data[field.name] = control.value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear form\r\n   */\r\n  private clear() {\r\n    this.form.control.reset();\r\n  }\r\n\r\n}\r\n","import { AbstractControl } from '@angular/forms';\r\n\r\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\r\n\r\nexport function formControlIsRequired(control: AbstractControl): boolean {\r\n  if (control.validator) {\r\n    const validator = control.validator({} as AbstractControl);\r\n    if (validator && validator.required) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  if ((control as any).controls) {\r\n    const requiredControl = Object.keys((control as any).controls).find((key: string) => {\r\n      return formControlIsRequired((control as any).controls[key]);\r\n    });\r\n    return requiredControl !== undefined;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport function getDefaultErrorMessages(): {[key: string]: string} {\r\n  return {\r\n    required: 'igo.common.form.errors.required'\r\n  };\r\n}\r\n\r\nexport function getControlErrorMessage(control: AbstractControl, messages: {[key: string]: string}): string {\r\n  const errors = control.errors || {};\r\n  const errorKeys = Object.keys(errors);\r\n  const errorMessages = errorKeys\r\n    .map((key: string) => messages[key])\r\n    .filter((message: string) => message !== undefined);\r\n  return errorMessages.length > 0 ? errorMessages[0] : '';\r\n}\r\n\r\nexport function getAllFormFields(form: Form): FormField[] {\r\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\r\n    return acc.concat(group.fields);\r\n  }, [].concat(form.fields));\r\n}\r\n\r\nexport function getFormFieldByName(form: Form, name: string): FormField {\r\n  const fields = getAllFormFields(form);\r\n  return fields.find((field: FormField) => {\r\n    return field.name === name;\r\n  });\r\n}\r\n","\r\n<form\r\n  [autocomplete]=\"autocomplete\"\r\n  [formGroup]=\"form.control\"\r\n  (ngSubmit)=\"onSubmit()\">\r\n  <div class=\"igo-form-body\" [ngClass]=\"{'igo-form-body-with-buttons': hasButtons}\">\r\n    <div class=\"igo-form-content\">\r\n      <ng-content></ng-content>\r\n    </div>\r\n    <div #buttons class=\"igo-form-buttons\">\r\n      <ng-content select=\"[formButtons]\"></ng-content>\r\n    </div>\r\n  </div>\r\n</form>\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { FormComponent } from './form.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  exports: [\r\n    FormComponent,\r\n    FormsModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  declarations: [\r\n    FormComponent\r\n  ]\r\n})\r\nexport class IgoFormFormModule {}\r\n","import { Injectable } from '@angular/core';\r\nimport { FormBuilder, Validators, ValidatorFn } from '@angular/forms';\r\n\r\nimport {\r\n  Form,\r\n  FormField,\r\n  FormFieldConfig,\r\n  FormFieldGroup,\r\n  FormFieldGroupConfig\r\n} from './form.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FormService {\r\n\r\n  constructor(private formBuilder: FormBuilder) {}\r\n\r\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\r\n    const control = this.formBuilder.group({});\r\n    fields.forEach((field: FormField) => {\r\n      control.addControl(field.name, field.control);\r\n    });\r\n    groups.forEach((group: FormFieldGroup) => {\r\n      control.addControl(group.name, group.control);\r\n    });\r\n\r\n    return {fields, groups, control};\r\n  }\r\n\r\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\r\n    const options = config.options || {};\r\n    const control = this.formBuilder.group({});\r\n    fields.forEach((field: FormField) => {\r\n      control.addControl(field.name, field.control);\r\n    });\r\n\r\n    const validators = this.getValidators(options.validator); // convert string to actual validator\r\n    control.setValidators(validators);\r\n\r\n    return Object.assign({}, config, {fields, control}) as FormFieldGroup;\r\n  }\r\n\r\n  field(config: FormFieldConfig): FormField {\r\n    const options = config.options || {};\r\n    const state = {\r\n      value: '',\r\n      disabled: options.disabled\r\n    };\r\n    const control = this.formBuilder.control(state);\r\n\r\n    const validators = this.getValidators(options.validator); // convert string to actual validator\r\n    control.setValidators(validators);\r\n\r\n    return Object.assign({type: 'text'}, config, {control}) as FormField;\r\n  }\r\n\r\n  extendFieldConfig(config: FormFieldConfig, partial: Partial<FormFieldConfig>): FormFieldConfig {\r\n    const options = Object.assign({}, config.options || {}, partial.options || {});\r\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\r\n    const subscribers = Object.assign({}, config.subscribers || {}, partial.subscribers || {});\r\n    return Object.assign({}, config, {options, inputs, subscribers});\r\n  }\r\n\r\n  private getValidators(validatorOption: string | string[] | ValidatorFn): ValidatorFn | ValidatorFn[] {\r\n    if (Array.isArray(validatorOption)) {\r\n      return validatorOption.map((validatorStr) => {\r\n        return this.getValidator(validatorStr);\r\n      });\r\n    }\r\n\r\n    return this.getValidator(validatorOption);\r\n  }\r\n\r\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\r\n    if (typeof validatorStr !== 'string') {\r\n      return validatorStr;\r\n    }\r\n\r\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\r\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\r\n    const match = validatorStr.match(re);\r\n\r\n    if (!match) {\r\n      return Validators[validatorStr];\r\n    }\r\n\r\n    const name = match[1];\r\n    const args = match[2];\r\n    return Validators[name](args);\r\n  }\r\n\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * Service where all available form fields are registered.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FormFieldService {\r\n\r\n  static fields: {[key: string]: any} = {};\r\n\r\n  static register(type: string, component: any) {\r\n    FormFieldService.fields[type] = component;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Return field component by type\r\n   * @param type Field type\r\n   * @returns Field component\r\n   */\r\n  getFieldByType(type: string): any {\r\n    return FormFieldService.fields[type];\r\n  }\r\n\r\n}\r\n","\r\n\r\n<ng-container *ngIf=\"field !== undefined\">\r\n  <igo-dynamic-outlet\r\n    [component]=\"getFieldComponent()\"\r\n    [inputs]=\"getFieldInputs()\"\r\n    [subscribers]=\"getFieldSubscribers()\">\r\n  </igo-dynamic-outlet>\r\n</ng-container>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { FormField, FormFieldInputs, FormFieldOptions } from '../shared/form.interfaces';\r\nimport { FormFieldService } from '../shared/form-field.service';\r\nimport { getDefaultErrorMessages } from '../shared';\r\n\r\n/**\r\n * This component renders the proper form input based on\r\n * the field configuration it receives.\r\n */\r\n@Component({\r\n  selector: 'igo-form-field',\r\n  templateUrl: './form-field.component.html',\r\n  styleUrls: ['./form-field.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormFieldComponent {\r\n\r\n  /**\r\n   * Field configuration\r\n   */\r\n  @Input() field: FormField;\r\n\r\n  /**\r\n   * Field inputs cache\r\n   */\r\n  private fieldInputs: FormFieldInputs = undefined;\r\n\r\n  /**\r\n   * Field subscribers cache\r\n   */\r\n  private fieldSubscribers: {[key: string]: ({field: FormField, control: FormControl}) => void } = undefined;\r\n\r\n  get fieldOptions(): FormFieldOptions {\r\n    return this.field.options || {};\r\n  }\r\n\r\n  constructor(private formFieldService: FormFieldService) {}\r\n\r\n  getFieldComponent(): any {\r\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\r\n  }\r\n\r\n  getFieldInputs(): FormFieldInputs {\r\n    if (this.fieldInputs !== undefined) {\r\n      return this.fieldInputs;\r\n    }\r\n\r\n    const errors = this.fieldOptions.errors || {};\r\n    this.fieldInputs = Object.assign(\r\n      {\r\n        placeholder: this.field.title,\r\n        disableSwitch: this.fieldOptions.disableSwitch || false\r\n      },\r\n      Object.assign({}, this.field.inputs || {}),\r\n      {\r\n        formControl: this.field.control,\r\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\r\n      }\r\n    );\r\n    return this.fieldInputs;\r\n  }\r\n\r\n  getFieldSubscribers(): {[key: string]: ({field: FormField, control: FormControl}) => void } {\r\n    if (this.fieldSubscribers !== undefined) {\r\n      return this.fieldSubscribers;\r\n    }\r\n\r\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\r\n    return this.fieldSubscribers;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoDynamicOutletModule } from '../../dynamic-component/dynamic-outlet/dynamic-outlet.module';\r\n\r\nimport { FormFieldComponent } from './form-field.component';\r\nimport { FormFieldSelectComponent } from './form-field-select.component';\r\nimport { FormFieldTextComponent } from './form-field-text.component';\r\nimport { FormFieldTextareaComponent } from './form-field-textarea.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    IgoLanguageModule,\r\n    IgoDynamicOutletModule\r\n  ],\r\n  exports: [\r\n    FormFieldComponent,\r\n    FormFieldSelectComponent,\r\n    FormFieldTextComponent,\r\n    FormFieldTextareaComponent\r\n  ],\r\n  declarations: [\r\n    FormFieldComponent,\r\n    FormFieldSelectComponent,\r\n    FormFieldTextComponent,\r\n    FormFieldTextareaComponent\r\n  ]\r\n})\r\nexport class IgoFormFieldModule {}\r\n","<div\r\n  *ngIf=\"group && group.fields.length > 0\"\r\n  class=\"igo-form-group-fields\">\r\n  <div\r\n    *ngFor=\"let field of group.fields\"\r\n    class=\"igo-form-field-wrapper\"\r\n    [ngClass]=\"getFieldNgClass(field)\">\r\n    <igo-form-field [field]=\"field\"></igo-form-field>\r\n  </div>\r\n</div>\r\n\r\n<div class=\"igo-form-group-extra-content\">\r\n  <ng-content></ng-content>\r\n</div>\r\n\r\n<mat-error *ngIf=\"formControl.errors\">{{getErrorMessage() | translate}}</mat-error>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\nimport { FormGroup } from '@angular/forms';\r\n\r\nimport { getControlErrorMessage } from '../shared/form.utils';\r\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\r\n\r\n/**\r\n * A configurable form, optionnally bound to an entity\r\n * (for example in case of un update). Submitting that form\r\n * emits an event with the form data but no other operation is performed.\r\n */\r\n@Component({\r\n  selector: 'igo-form-group',\r\n  templateUrl: './form-group.component.html',\r\n  styleUrls: ['./form-group.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormGroupComponent {\r\n\r\n  /**\r\n   * Form field group\r\n   */\r\n  @Input() group: FormFieldGroup;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() errors: {[key: string]: string};\r\n\r\n  /**\r\n   * Form group control\r\n   */\r\n  get formControl(): FormGroup { return this.group.control; }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Return the number of columns a field should occupy.\r\n   * The maximum allowed is 2, even if the field config says more.\r\n   * @param field Field\r\n   * @returns Number of columns\r\n   * @internal\r\n   */\r\n  getFieldColSpan(field: FormField): number {\r\n    let colSpan = 2;\r\n    const options = field.options || {};\r\n    if (options.cols && options.cols > 0) {\r\n      colSpan = Math.min(options.cols, 2);\r\n    }\r\n\r\n    return colSpan;\r\n  }\r\n\r\n  /**\r\n   * Return the number of columns a field should occupy.\r\n   * The maximum allowed is 2, even if the field config says more.\r\n   * @param field Field\r\n   * @returns Number of columns\r\n   * @internal\r\n   */\r\n  getFieldNgClass(field: FormField): {[key: string]: boolean} {\r\n    const colspan = this.getFieldColSpan(field);\r\n    return {[`igo-form-field-colspan-${colspan}`]: true};\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  getErrorMessage(): string {\r\n    const options = this.group.options || {};\r\n    return getControlErrorMessage(this.formControl, options.errors || {});\r\n  }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoFormFieldModule } from '../form-field/form-field.module';\r\nimport { FormGroupComponent } from './form-group.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatFormFieldModule,\r\n    IgoLanguageModule,\r\n    IgoFormFieldModule\r\n  ],\r\n  exports: [\r\n    FormGroupComponent\r\n  ],\r\n  declarations: [\r\n    FormGroupComponent\r\n  ]\r\n})\r\nexport class IgoFormGroupModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoFormFormModule } from './form/form.module';\r\nimport { IgoFormGroupModule } from './form-group/form-group.module';\r\nimport { IgoFormFieldModule } from './form-field/form-field.module';\r\nimport { FormService } from './shared/form.service';\r\nimport { FormFieldService } from './shared/form-field.service';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoFormGroupModule,\r\n    IgoFormFieldModule\r\n  ],\r\n  exports: [\r\n    IgoFormFormModule,\r\n    IgoFormGroupModule,\r\n    IgoFormFieldModule\r\n  ],\r\n  declarations: [],\r\n  providers: [\r\n    FormService,\r\n    FormFieldService\r\n  ]\r\n})\r\nexport class IgoFormModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { MatSelectModule } from '@angular/material/select';\r\n\r\nimport { EntitySelectorComponent } from './entity-selector.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    MatSelectModule\r\n  ],\r\n  exports: [EntitySelectorComponent],\r\n  declarations: [EntitySelectorComponent]\r\n})\r\nexport class IgoEntitySelectorModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { StopDropPropagationDirective } from './stop-drop-propagation.directive';\r\nimport { StopPropagationDirective } from './stop-propagation.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [StopDropPropagationDirective, StopPropagationDirective],\r\n  exports: [StopDropPropagationDirective, StopPropagationDirective]\r\n})\r\nexport class IgoStopPropagationModule {\r\n  static forRoot(): ModuleWithProviders<IgoStopPropagationModule> {\r\n    return {\r\n      ngModule: IgoStopPropagationModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { EntityTablePaginatorComponent } from './entity-table-paginator.component';\r\nimport { MatPaginatorModule } from '@angular/material/paginator';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    MatPaginatorModule,\r\n  ],\r\n  exports: [\r\n    EntityTablePaginatorComponent\r\n  ],\r\n  declarations: [\r\n    EntityTablePaginatorComponent,\r\n  ]\r\n})\r\nexport class IgoEntityTablePaginatorModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { SecureImagePipe } from './secure-image.pipe';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [SecureImagePipe],\r\n  exports: [SecureImagePipe]\r\n})\r\nexport class IgoImageModule {\r\n  static forRoot(): ModuleWithProviders<IgoImageModule> {\r\n    return {\r\n      ngModule: IgoImageModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSortModule } from '@angular/material/sort';\r\nimport { MatTableModule } from '@angular/material/table';\r\n\r\nimport { IgoStopPropagationModule } from '../../stop-propagation/stop-propagation.module';\r\nimport { IgoCustomHtmlModule } from '../../custom-html/custom-html.module';\r\nimport { EntityTableRowDirective } from './entity-table-row.directive';\r\nimport { EntityTableComponent } from './entity-table.component';\r\nimport { MatPaginatorModule } from '@angular/material/paginator';\r\nimport { IgoEntityTablePaginatorModule } from '../entity-table-paginator/entity-table-paginator.module';\r\nimport { IgoImageModule } from '../../image/image.module';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatTableModule,\r\n    MatSortModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatCheckboxModule,\r\n    MatPaginatorModule,\r\n    IgoStopPropagationModule,\r\n    IgoCustomHtmlModule,\r\n    IgoEntityTablePaginatorModule,\r\n    IgoImageModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [\r\n    EntityTableComponent\r\n  ],\r\n  declarations: [\r\n    EntityTableComponent,\r\n    EntityTableRowDirective\r\n  ]\r\n})\r\nexport class IgoEntityTableModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoEntitySelectorModule } from './entity-selector/entity-selector.module';\r\nimport { IgoEntityTableModule } from './entity-table/entity-table.module';\r\nimport { IgoEntityTablePaginatorModule } from './entity-table-paginator/entity-table-paginator.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n    IgoEntitySelectorModule,\r\n    IgoEntityTableModule,\r\n    IgoEntityTablePaginatorModule\r\n  ],\r\n  declarations: []\r\n})\r\nexport class IgoEntityModule {}\r\n","import { catchError } from 'rxjs/operators';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { Injectable } from '@angular/core';\r\nimport { InteractiveTourOptions } from './interactive-tour.interface';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\n@Injectable()\r\nexport class InteractiveTourLoader {\r\n  private jsonURL: string;\r\n  private allToursOptions;\r\n\r\n  constructor(private http: HttpClient, private configService: ConfigService) {\r\n    this.jsonURL = this.getPathToConfigFile();\r\n  }\r\n\r\n   public loadConfigTour() {\r\n      this.getJSON()\r\n        .subscribe(\r\n          (data) => {\r\n            this.allToursOptions = data;\r\n          },\r\n          (err) => {\r\n            throw new Error('Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.');\r\n          }\r\n        );\r\n   }\r\n\r\n  public getPathToConfigFile(): string {\r\n    return (\r\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\r\n      './config/interactiveTour.json'\r\n    );\r\n  }\r\n\r\n  public getJSON(): Observable<any> {\r\n    return this.http.get(this.jsonURL).pipe(\r\n      catchError((e) => {\r\n        e.error.caught = true;\r\n        throw e;\r\n      })\r\n    );\r\n  }\r\n\r\n  public getTourOptionData(toolName): InteractiveTourOptions {\r\n    if (this.allToursOptions === undefined) {\r\n      return undefined;\r\n    }\r\n    let nameInConfigFile = toolName;\r\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\r\n    return this.allToursOptions[nameInConfigFile];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ShepherdService } from 'angular-shepherd';\r\n\r\nimport { ConfigService, MediaService, LanguageService } from '@igo2/core';\r\nimport { InteractiveTourLoader } from './interactive-tour.loader';\r\nimport {\r\n  InteractiveTourOptions,\r\n  InteractiveTourStep,\r\n  InteractiveTourAction\r\n} from './interactive-tour.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class InteractiveTourService {\r\n  private previousStep: InteractiveTourStep;\r\n  private nextIndex = 1;\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    private mediaService: MediaService,\r\n    private languageService: LanguageService,\r\n    private interactiveTourLoader: InteractiveTourLoader,\r\n    private shepherdService: ShepherdService\r\n  ) {\r\n    if (this.isAppHaveTour()) {\r\n      this.interactiveTourLoader.loadConfigTour();\r\n    }\r\n  }\r\n\r\n  public isAppHaveTour() {\r\n    const haveTour = this.configService.getConfig('interactiveTour.activateInteractiveTour');\r\n    if (haveTour === undefined) {\r\n      return true;\r\n    } else {\r\n      return haveTour;\r\n    }\r\n  }\r\n\r\n  public isToolHaveTourConfig(toolName: string): boolean {\r\n    const checkTourActiveOptions = this.interactiveTourLoader.getTourOptionData(\r\n      toolName\r\n    );\r\n    if (checkTourActiveOptions === undefined) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  public disabledTourButton(toolName: string): boolean {\r\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\r\n      toolName\r\n    );\r\n\r\n    if (stepConfig?.conditions) {\r\n      for (const condition of stepConfig?.conditions) {\r\n        if (document.querySelector(condition) === null) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public isMobile(): boolean {\r\n    return this.mediaService.isMobile();\r\n  }\r\n\r\n  public isTourDisplayInMobile(): boolean {\r\n    const showInMobile = this.configService.getConfig(\r\n      'interactiveTour.tourInMobile'\r\n    );\r\n    if (showInMobile === undefined) {\r\n      return true;\r\n    }\r\n    return this.configService.getConfig('interactiveTour.tourInMobile');\r\n  }\r\n\r\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\r\n    if (buttonKind === 'noBackButton') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.nextButton'\r\n          ),\r\n          type: 'next'\r\n        }\r\n      ];\r\n    }\r\n    if (buttonKind === 'first') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-secondary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.exitButton'\r\n          ),\r\n          type: 'cancel'\r\n        },\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.nextButton'\r\n          ),\r\n          type: 'next'\r\n        }\r\n      ];\r\n    }\r\n\r\n    if (buttonKind === 'last') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-secondary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.backButton'\r\n          ),\r\n          type: 'back'\r\n        },\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.exitButton'\r\n          ),\r\n          type: 'cancel'\r\n        }\r\n      ];\r\n    }\r\n\r\n    return [\r\n      {\r\n        classes: 'shepherd-button-secondary',\r\n        text: this.languageService.translate.instant(\r\n          'igo.common.interactiveTour.backButton'\r\n        ),\r\n        type: 'back'\r\n      },\r\n      {\r\n        classes: 'shepherd-button-primary',\r\n        text: this.languageService.translate.instant(\r\n          'igo.common.interactiveTour.nextButton'\r\n        ),\r\n        type: 'next'\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getAction(actionName: string) {\r\n    const action = {\r\n      click: 'click'\r\n    };\r\n    return action[actionName.toLowerCase()];\r\n  }\r\n\r\n  private addProgress() {\r\n    const self = this as any;\r\n    let nbTry = 0;\r\n    const maxTry = 21;\r\n    const checkExist = setInterval(() => {\r\n      if (self.getCurrentStep()) {\r\n        if (self.getCurrentStep().options.attachTo.element && !document.querySelector(self.getCurrentStep().options.attachTo.element)) {\r\n          self.cancel();\r\n          clearInterval(checkExist);\r\n          return;\r\n        } else {\r\n          const currentStepElement = self.getCurrentStep().getElement();\r\n          if (currentStepElement) {\r\n            const shepherdList = currentStepElement.querySelectorAll('.shepherd-content, .shepherd-text');\r\n            shepherdList.forEach(element => {\r\n              element.classList.add('mat-typography');\r\n            });\r\n          }\r\n          const header = currentStepElement\r\n            ? currentStepElement.querySelector('.shepherd-header')\r\n            : undefined;\r\n\r\n          nbTry++;\r\n          if (header || nbTry > maxTry) {\r\n            clearInterval(checkExist);\r\n          }\r\n\r\n          if (header) {\r\n            const stepsArray = self.steps;\r\n            const progress = document.createElement('span');\r\n            progress.className = 'shepherd-progress';\r\n            progress.innerText = `${\r\n              stepsArray.indexOf(self.getCurrentStep()) + 1\r\n            }/${stepsArray.length}`;\r\n            header.insertBefore(\r\n              progress,\r\n              currentStepElement.querySelector('.shepherd-cancel-icon')\r\n            );\r\n          }\r\n        }\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  private checkNext(index, tour, service) {\r\n    if (tour.getCurrentStep()) {\r\n      if (tour.getCurrentStep().options.attachTo.element && document.querySelector(tour.getCurrentStep().options.attachTo.element)) {\r\n        tour.complete();\r\n        return;\r\n      }\r\n\r\n      if (index.index === tour.steps.length - 1) {\r\n        tour.complete();\r\n        return;\r\n      }\r\n\r\n      tour.steps.splice(index.index, 1);\r\n      const nextStep = tour.steps[index.index];\r\n      if (nextStep.options.attachTo.element && !document.querySelector(nextStep.options.attachTo.element)) {\r\n        service.checkNext(index, tour, service);\r\n      } else {\r\n        tour._setupModal();\r\n        tour.show(nextStep.id);\r\n      }\r\n    }\r\n  }\r\n\r\n  private executeAction(\r\n    step: InteractiveTourStep,\r\n    actionConfig: InteractiveTourAction\r\n  ) {\r\n    if (!actionConfig) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      actionConfig.condition &&\r\n      ((actionConfig.condition.charAt(0) === '!' &&\r\n        document.querySelector(actionConfig.condition.slice(1))) ||\r\n        (actionConfig.condition.charAt(0) !== '!' &&\r\n          !document.querySelector(actionConfig.condition)))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const element: HTMLElement = document.querySelector(\r\n      actionConfig.element || step.element\r\n    ) as HTMLElement;\r\n    const action = this.getAction(actionConfig.action);\r\n    if (element && action) {\r\n      element[action]();\r\n    }\r\n  }\r\n\r\n  private executeActionPromise(\r\n    step: InteractiveTourStep,\r\n    actionConfig: InteractiveTourAction\r\n  ) {\r\n    return new Promise<void>((resolve) => {\r\n      this.executeAction(step, actionConfig);\r\n      if (!actionConfig || !actionConfig.waitFor) {\r\n        resolve();\r\n        return;\r\n      }\r\n      let nbTry = 0;\r\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\r\n      const checkExist = setInterval(() => {\r\n        nbTry++;\r\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\r\n          clearInterval(checkExist);\r\n          resolve();\r\n        }\r\n      }, 100);\r\n    });\r\n  }\r\n\r\n  private getShepherdSteps(stepConfig: InteractiveTourOptions) {\r\n    const shepherdSteps = [];\r\n\r\n    let i = 0;\r\n    for (const step of stepConfig.steps) {\r\n      shepherdSteps.push({\r\n        attachTo: {\r\n          element: step.element,\r\n          on: step.position || stepConfig.position\r\n        },\r\n        popperOptions: {\r\n          modifiers: [{ name: 'offset', options: { offset: [0, 15] } }]\r\n        },\r\n        beforeShowPromise: () => {\r\n          return Promise.all([\r\n            this.executeActionPromise(\r\n              this.previousStep,\r\n              this.previousStep ? this.previousStep.beforeChange : undefined\r\n            ),\r\n            this.executeActionPromise(step, step.beforeShow)\r\n          ]);\r\n        },\r\n        buttons: this.getButtons(\r\n          i === 0\r\n            ? 'first'\r\n            : i + 1 === stepConfig.steps.length\r\n            ? 'last'\r\n            : stepConfig.steps[i].noBackButton\r\n            ? 'noBackButton'\r\n            : undefined\r\n        ),\r\n        classes: step.class,\r\n        highlightClass: step.highlightClass,\r\n        scrollTo: step.scrollToElement || stepConfig.scrollToElement || true,\r\n        canClickTarget: step.disableInteraction\r\n          ? !step.disableInteraction\r\n          : undefined,\r\n        title: this.languageService.translate.instant(\r\n          step.title || stepConfig.title\r\n        ),\r\n        text: [this.languageService.translate.instant(step.text)],\r\n        when: {\r\n          show: () => {\r\n            this.executeAction(step, step.onShow);\r\n          },\r\n          hide: () => {\r\n            this.previousStep = step;\r\n            this.executeAction(step, step.onHide);\r\n          }\r\n        }\r\n      });\r\n      i++;\r\n    }\r\n\r\n    return shepherdSteps;\r\n  }\r\n\r\n  public startTour(toolName: string) {\r\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\r\n      toolName\r\n    );\r\n\r\n    this.shepherdService.defaultStepOptions = {\r\n      classes: stepConfig.class,\r\n      highlightClass: stepConfig.highlightClass,\r\n      canClickTarget: stepConfig.disableInteraction\r\n        ? !stepConfig.disableInteraction\r\n        : true,\r\n      cancelIcon: {\r\n        enabled: true\r\n      }\r\n    };\r\n\r\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\r\n\r\n    this.shepherdService.modal = true;\r\n    this.shepherdService.confirmCancel = false;\r\n    this.shepherdService.addSteps(shepherdSteps);\r\n\r\n    this.shepherdService.tourObject.on('show', this.addProgress);\r\n    this.shepherdService.tourObject.on('cancel', (index) =>{\r\n      this.checkNext(index, this.shepherdService.tourObject, this);\r\n    });\r\n\r\n    this.shepherdService.start();\r\n  }\r\n}\r\n","import { EntityRecord, EntityStore } from '../../entity';\r\nimport { Tool, ToolboxOptions } from './tool.interface';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\n/**\r\n * Service where all available tools and their component are registered.\r\n */\r\nexport class Toolbox {\r\n  /**\r\n   * Observable of the active tool\r\n   */\r\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Ordered list of tool names to display in a toolbar\r\n   */\r\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * Observable of the active tool\r\n   */\r\n  private activeTool$$: Subscription;\r\n\r\n  /**\r\n   * Active tool history. Useful for activating the previous tool.\r\n   */\r\n  private activeToolHistory: string[] = [];\r\n\r\n  /**\r\n   * Tool store\r\n   */\r\n  private store = new EntityStore<Tool>([], {\r\n    getKey: (tool: Tool) => tool.name\r\n  });\r\n\r\n  get tools$(): BehaviorSubject<Tool[]> {\r\n    return this.store.entities$;\r\n  }\r\n\r\n  constructor(private options: ToolboxOptions = {}) {\r\n    this.setToolbar(options.toolbar);\r\n    this.initStore();\r\n  }\r\n\r\n  /**\r\n   * Destroy the toolbox\r\n   */\r\n  destroy() {\r\n    this.activeTool$$.unsubscribe();\r\n    this.store.destroy();\r\n  }\r\n\r\n  /**\r\n   * Return a tool\r\n   * @param name Tool name\r\n   * @returns tool Tool\r\n   */\r\n  getTool(name: string): Tool {\r\n    return this.store.get(name);\r\n  }\r\n\r\n  /**\r\n   * Return all tools\r\n   * @returns Array of tools\r\n   */\r\n  getTools(): Tool[] {\r\n    return this.store.all();\r\n  }\r\n\r\n  /**\r\n   * Set tool configurations\r\n   * @param tools Tools\r\n   */\r\n  setTools(tools: Tool[]) {\r\n    this.store.load(tools);\r\n  }\r\n\r\n  /**\r\n   * Get toolbar\r\n   * @returns Toolbar value\r\n   */\r\n  getToolbar(): string[] {\r\n    return this.toolbar$.getValue();\r\n  }\r\n\r\n  /**\r\n   * Set toolbar\r\n   * @param toolbar A list of tool names\r\n   */\r\n  setToolbar(toolbar: string[]) {\r\n    this.toolbar$.next(toolbar || []);\r\n  }\r\n\r\n  /**\r\n   * Activate a tool (and deactivate other tools)\r\n   * @param name Tool name\r\n   * @param options Tool options\r\n   */\r\n  activateTool(name: string, options: { [key: string]: any } = {}) {\r\n    const tool = this.getTool(name);\r\n    if (tool === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.store.state.update(tool, { active: true, options }, true);\r\n  }\r\n\r\n  /**\r\n   * Activate the previous tool, if any\r\n   */\r\n  activatePreviousTool() {\r\n    if (this.activeToolHistory.length <= 1) {\r\n      this.deactivateTool();\r\n      return;\r\n    }\r\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\r\n    this.activateTool(previous);\r\n  }\r\n\r\n  /**\r\n   * Activate the tool below, if any\r\n   */\r\n  /* activateBelowTool() {\r\n    const arrayTools = this.getToolbar();\r\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\r\n    if (arrayTools[index + 1] !== undefined) {\r\n      this.deactivateTool();\r\n      const below = arrayTools[index + 1];\r\n      this.activateTool(below);\r\n    } else {\r\n      this.deactivateTool();\r\n      const below = arrayTools[0];\r\n      this.activateTool(below);\r\n    }\r\n  } */\r\n\r\n  /**\r\n   * Activate the tool above, if any\r\n   */\r\n  /* activateAboveTool() {\r\n    const arrayTools = this.getToolbar();\r\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\r\n    if (arrayTools[index - 1] !== undefined) {\r\n      this.deactivateTool();\r\n      const above = arrayTools[index - 1];\r\n      this.activateTool(above);\r\n    } else {\r\n      this.deactivateTool();\r\n      const above = arrayTools[arrayTools.length - 1];\r\n      this.activateTool(above);\r\n    }\r\n  } */\r\n\r\n  /**\r\n   * Deactivate the active tool\r\n   */\r\n  deactivateTool() {\r\n    this.clearActiveToolHistory();\r\n    this.store.state.updateAll({ active: false });\r\n  }\r\n\r\n  /**\r\n   * Initialize the tool store and start observing the active tool\r\n   */\r\n  private initStore() {\r\n    this.store = new EntityStore<Tool>([], {\r\n      getKey: (entity: Tool) => entity.name\r\n    });\r\n\r\n    this.activeTool$$ = this.store.stateView\r\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\r\n      .subscribe((record: EntityRecord<Tool>) => {\r\n        if (record === undefined) {\r\n          this.setActiveTool(undefined);\r\n          return;\r\n        }\r\n\r\n        const tool = record.entity;\r\n        const options = Object.assign(\r\n          {},\r\n          tool.options || {},\r\n          record.state.options || {}\r\n        );\r\n        this.setActiveTool(Object.assign({}, tool, { options }));\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Set the active tool and update the tool history\r\n   * @param tool Tool\r\n   */\r\n  private setActiveTool(tool: Tool | undefined) {\r\n    this.activeTool$.next(tool);\r\n    if (tool === undefined) {\r\n      this.clearActiveToolHistory();\r\n    } else {\r\n      this.activeToolHistory = this.activeToolHistory\r\n        .filter((name: string) => name !== tool.name)\r\n        .concat([tool.name]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the tool history\r\n   */\r\n  private clearActiveToolHistory() {\r\n    this.activeToolHistory = [];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { Tool } from './tool.interface';\r\nimport { Toolbox } from './toolbox';\r\n\r\n/**\r\n * Service where runtime tool configurations are registered\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ToolService {\r\n  static tools: { [key: string]: Tool } = {};\r\n\r\n  /**\r\n   * Toolbox that holds main tools\r\n   */\r\n  public toolbox: Toolbox = new Toolbox();\r\n\r\n  static register(tool: Tool) {\r\n    ToolService.tools[tool.name] = tool;\r\n  }\r\n\r\n  constructor() {\r\n    this.toolbox.setTools(this.getTools());\r\n  }\r\n\r\n  /**\r\n   * Return a tool\r\n   * @param name Tool name\r\n   * @returns tool Tool\r\n   */\r\n  getTool(name: string): Tool {\r\n    return ToolService.tools[name];\r\n  }\r\n\r\n  /**\r\n   * Return all tools\r\n   * @returns tTols\r\n   */\r\n  getTools(): Tool[] {\r\n    return Object.values(ToolService.tools);\r\n  }\r\n}\r\n","<button *ngIf=\"showTourButton\"\r\n  (click) = \"startInteractiveTour()\"\r\n  [ngClass]=\"getClass()\"\r\n  mat-raised-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [disabled]=disabledTourButton>\r\n  <span class=\"interactive-tour-button-title\">{{'igo.common.interactiveTour.buttonTitle' | translate}} {{(discoverTitleInLocale$ | async) | translate}}</span>\r\n  <mat-icon\r\n    svgIcon=\"presentation-play\"\r\n    [matTooltip]=\"disabledTourButton ?\r\n    ('igo.common.interactiveTour.disaledTooltipTourToolButton' | translate) :\r\n    ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\">\r\n  </mat-icon>\r\n</button>\r\n","import { Component, ViewEncapsulation, Input } from '@angular/core';\r\nimport { InteractiveTourService } from './interactive-tour.service';\r\nimport { ToolService } from '../tool/shared/tool.service';\r\nimport { Observable, of } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-interactive-tour',\r\n  templateUrl: './interactive-tour.component.html',\r\n  styleUrls: ['./interactive-tour.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class InteractiveTourComponent {\r\n  /**\r\n   * Toolbox that holds main tools\r\n   */\r\n  @Input() tourToStart: string = '';\r\n  @Input() styleButton: string;\r\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\r\n\r\n  getClass() {\r\n    return {\r\n      'tour-button-tool-icon': this.styleButton === 'icon',\r\n      'tour-button-tool': this.styleButton === 'raised'\r\n    };\r\n  }\r\n\r\n  get toolbox() {\r\n    return this.toolService.toolbox;\r\n  }\r\n\r\n  getTourToStart() {\r\n    if (this.tourToStart) {\r\n      return this.tourToStart;\r\n    } else {\r\n      return this.activeToolName;\r\n    }\r\n  }\r\n\r\n  get activeToolName() {\r\n    if (this.toolbox) {\r\n      if (this.isActiveTool) {\r\n        return this.toolbox.activeTool$.getValue().name;\r\n      } else {\r\n        return 'global';\r\n      }\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get isActiveTool(): boolean {\r\n    if (this.toolbox) {\r\n      return this.toolbox.activeTool$.getValue() !== undefined;\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get isToolHaveTour(): boolean {\r\n    if (this.activeToolName === 'about' && !this.tourToStart) {\r\n      return false;\r\n    }\r\n    return this.interactiveTourService.isToolHaveTourConfig(\r\n      this.getTourToStart()\r\n    );\r\n  }\r\n\r\n  get showTourButton(): boolean {\r\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\r\n    let haveTour: boolean;\r\n    haveTour = this.isToolHaveTour;\r\n    if (haveTour === false) {\r\n      return false;\r\n    }\r\n\r\n    let inMobileAndShow: boolean;\r\n    if (this.interactiveTourService.isMobile()) {\r\n      inMobileAndShow = this.isTourDisplayInMobile;\r\n      if (inMobileAndShow === false) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get isTourDisplayInMobile(): boolean {\r\n    return this.interactiveTourService.isTourDisplayInMobile();\r\n  }\r\n\r\n  get disabledTourButton(): boolean {\r\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\r\n  }\r\n\r\n  constructor(\r\n    private interactiveTourService: InteractiveTourService,\r\n    private toolService: ToolService\r\n  ) {}\r\n\r\n  startInteractiveTour() {\r\n    const tour = this.getTourToStart();\r\n    if (tour) {\r\n      this.interactiveTourService.startTour(tour);\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { InteractiveTourService } from './interactive-tour.service';\r\nimport { InteractiveTourComponent } from './interactive-tour.component';\r\nimport { InteractiveTourLoader } from './interactive-tour.loader';\r\n\r\n@NgModule({\r\n  declarations: [InteractiveTourComponent],\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule\r\n  ],\r\n  providers: [InteractiveTourService, InteractiveTourLoader],\r\n  exports: [InteractiveTourComponent]\r\n})\r\nexport class IgoInteractiveTourModule {}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\n@Pipe({\r\n  name: 'keyvalue'\r\n})\r\nexport class KeyValuePipe implements PipeTransform {\r\n  transform(value: any, args?: any): any {\r\n    const keyValues = [];\r\n    Object.getOwnPropertyNames(value).forEach((key: string) =>\r\n      keyValues.push({ key, value: value[key] })\r\n    );\r\n\r\n    return keyValues;\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { KeyValuePipe } from './keyvalue.pipe';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [KeyValuePipe],\r\n  exports: [KeyValuePipe]\r\n})\r\nexport class IgoKeyValueModule {\r\n  static forRoot(): ModuleWithProviders<IgoKeyValueModule> {\r\n    return {\r\n      ngModule: IgoKeyValueModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  ElementRef,\r\n  Renderer2,\r\n  HostListener,\r\n  EventEmitter\r\n} from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoListItem]'\r\n})\r\nexport class ListItemDirective {\r\n\r\n  static focusedCls = 'igo-list-item-focused';\r\n  static selectedCls = 'igo-list-item-selected';\r\n  static disabledCls = 'igo-list-item-disabled';\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  @Input()\r\n  get focused() {\r\n    return this._focused;\r\n  }\r\n  set focused(value: boolean) {\r\n    if (value === this._focused) {\r\n      return;\r\n    }\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\r\n\r\n    this._focused = value;\r\n    if (this.selected !== true) {\r\n      this.toggleFocusedClass();\r\n    }\r\n\r\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\r\n  }\r\n  private _focused = false;\r\n\r\n  @Input()\r\n  get selected() {\r\n    return this._selected;\r\n  }\r\n  set selected(value: boolean) {\r\n    if (value === this._selected) {\r\n      return;\r\n    }\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\r\n\r\n    this._selected = value;\r\n    this._focused = value;\r\n    this.toggleSelectedClass();\r\n\r\n    value ? this.select.emit(this) : this.unselect.emit(this);\r\n  }\r\n  private _selected = false;\r\n\r\n  @Input()\r\n  get disabled() {\r\n    return this._disabled;\r\n  }\r\n  set disabled(value: boolean) {\r\n    if (value === this._disabled) {\r\n      return;\r\n    }\r\n\r\n    if (value === true) {\r\n      this.selected = false;\r\n    }\r\n\r\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\r\n\r\n    this._disabled = value;\r\n    this.toggleDisabledClass();\r\n\r\n    value ? this.disable.emit(this) : this.enable.emit(this);\r\n  }\r\n  private _disabled = false;\r\n\r\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\r\n  @Output() focus = new EventEmitter<ListItemDirective>();\r\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\r\n  @Output() select = new EventEmitter<ListItemDirective>();\r\n  @Output() unselect = new EventEmitter<ListItemDirective>();\r\n  @Output() disable = new EventEmitter<ListItemDirective>();\r\n  @Output() enable = new EventEmitter<ListItemDirective>();\r\n\r\n  @HostListener('click')\r\n  onClick() {\r\n    this.selected = true;\r\n  }\r\n\r\n  constructor(public renderer: Renderer2, public el: ElementRef) {}\r\n\r\n  getOffsetTop(): number {\r\n    const padding = 5;\r\n\r\n    return this.el.nativeElement.offsetTop - padding;\r\n  }\r\n\r\n  private toggleFocusedClass() {\r\n    if (this.focused) {\r\n      this.addCls(ListItemDirective.focusedCls);\r\n    } else {\r\n      this.removeCls(ListItemDirective.focusedCls);\r\n    }\r\n  }\r\n\r\n  private toggleSelectedClass() {\r\n    if (this.selected) {\r\n      this.addCls(ListItemDirective.selectedCls);\r\n      this.removeCls(ListItemDirective.focusedCls);\r\n    } else {\r\n      this.removeCls(ListItemDirective.selectedCls);\r\n    }\r\n  }\r\n\r\n  private toggleDisabledClass() {\r\n    if (this.disabled) {\r\n      this.addCls(ListItemDirective.disabledCls);\r\n    } else {\r\n      this.removeCls(ListItemDirective.disabledCls);\r\n    }\r\n  }\r\n\r\n  private addCls(cls: string) {\r\n    this.renderer.addClass(this.el.nativeElement, cls);\r\n  }\r\n\r\n  private removeCls(cls: string) {\r\n    this.renderer.removeClass(this.el.nativeElement, cls);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  AfterViewInit,\r\n  OnInit,\r\n  OnDestroy,\r\n  Input,\r\n  ContentChildren,\r\n  HostListener,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport type { QueryList } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { ListItemDirective } from './list-item.directive';\r\n\r\n@Component({\r\n  selector: 'igo-list',\r\n  templateUrl: './list.component.html',\r\n  styleUrls: ['./list.component.scss']\r\n})\r\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\r\n  @Input()\r\n  get navigation() {\r\n    return this._navigation;\r\n  }\r\n  set navigation(value: boolean) {\r\n    this._navigation = value;\r\n  }\r\n  private _navigation = true;\r\n\r\n  @Input()\r\n  get selection() {\r\n    return this._selection;\r\n  }\r\n  set selection(value: boolean) {\r\n    this._selection = value;\r\n  }\r\n  private _selection = true;\r\n\r\n  get selectedItem() {\r\n    return this._selectedItem;\r\n  }\r\n  set selectedItem(value: ListItemDirective) {\r\n    this.focusedItem = value;\r\n    this._selectedItem = value;\r\n  }\r\n  private _selectedItem: ListItemDirective;\r\n\r\n  get focusedItem() {\r\n    return this._focusedItem;\r\n  }\r\n  set focusedItem(value: ListItemDirective) {\r\n    this._focusedItem = value;\r\n  }\r\n  private _focusedItem: ListItemDirective;\r\n\r\n  private navigationEnabled: boolean;\r\n  private listItems$$: Subscription;\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  @ContentChildren(ListItemDirective, { descendants: true })\r\n  listItems: QueryList<ListItemDirective>;\r\n\r\n  @HostListener('document:keydown', ['$event'])\r\n  @HostListener('document:enter', ['$event'])\r\n  handleKeyboardEvent(event: KeyboardEvent) {\r\n    // It would be nice to be able to unsubscribe to the event\r\n    // completely but until ES7 this won't be possible because\r\n    // document events are not observables\r\n    if (this.navigationEnabled) {\r\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\r\n        event.preventDefault();\r\n        this.navigate(event.key);\r\n      } else if (event.key === 'Enter') {\r\n        this.select(this.focusedItem);\r\n      }\r\n    }\r\n  }\r\n\r\n  constructor(private el: ElementRef) {}\r\n\r\n  ngOnInit() {\r\n    this.enableNavigation();\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    if (this.listItems.length) {\r\n      this.init();\r\n    }\r\n\r\n    this.listItems$$ = this.listItems.changes.subscribe(\r\n      (items: ListItemDirective[]) => this.init()\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.listItems$$.unsubscribe();\r\n  }\r\n\r\n  focus(item?: ListItemDirective) {\r\n    if (!this.selection) {\r\n      return;\r\n    }\r\n\r\n    this.unfocus();\r\n\r\n    // We need to make this check because dynamic\r\n    // lists such as in the search results list may fail\r\n    if (item !== undefined) {\r\n      item.focused = true;\r\n    }\r\n  }\r\n\r\n  unfocus() {\r\n    if (this.focusedItem !== undefined) {\r\n      this.focusedItem.focused = false;\r\n    }\r\n\r\n    this.focusedItem = undefined;\r\n  }\r\n\r\n  focusNext() {\r\n    const items = this.listItems.toArray();\r\n    let item;\r\n    const igoList = this.el.nativeElement;\r\n    let disabled = true;\r\n    let index = this.getFocusedIndex();\r\n    if (index === undefined) {\r\n      index = -1;\r\n    }\r\n\r\n    while (disabled && index < items.length - 1) {\r\n      index += 1;\r\n      item = items[index];\r\n      disabled = item.disabled;\r\n    }\r\n\r\n    if (item !== undefined) {\r\n      this.focus(item);\r\n    }\r\n\r\n    if (!items[index + 1]) {\r\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\r\n      return;\r\n    }\r\n\r\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\r\n      igoList.scrollTop =\r\n        item.el.nativeElement.offsetTop +\r\n        item.el.nativeElement.children[0].offsetHeight -\r\n        igoList.clientHeight;\r\n    }\r\n  }\r\n\r\n  focusPrevious() {\r\n    const items = this.listItems.toArray();\r\n    let item: ListItemDirective;\r\n    const igoList = this.el.nativeElement;\r\n    let disabled = true;\r\n    let index = this.getFocusedIndex();\r\n\r\n    while (disabled && index > 0) {\r\n      index -= 1;\r\n      item = items[index];\r\n      disabled = item.disabled;\r\n    }\r\n\r\n    if (item !== undefined) {\r\n      this.focus(item);\r\n    }\r\n\r\n    if (!items[index - 1]) {\r\n      igoList.scrollTop = 0;\r\n      return;\r\n    }\r\n\r\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\r\n      const padding = 3;\r\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\r\n    }\r\n  }\r\n\r\n  select(item?: ListItemDirective) {\r\n    if (!this.selection) {\r\n      return;\r\n    }\r\n\r\n    this.unselect();\r\n\r\n    if (item !== undefined) {\r\n      item.selected = true;\r\n    }\r\n  }\r\n\r\n  unselect() {\r\n    this.unfocus();\r\n\r\n    if (this.selectedItem !== undefined) {\r\n      this.selectedItem.selected = false;\r\n    }\r\n\r\n    this.selectedItem = undefined;\r\n  }\r\n\r\n  enableNavigation() {\r\n    if (this.navigation) {\r\n      this.navigationEnabled = true;\r\n    }\r\n  }\r\n\r\n  disableNavigation() {\r\n    this.navigationEnabled = false;\r\n  }\r\n\r\n  scrollToItem(item: ListItemDirective) {\r\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\r\n  }\r\n\r\n  isScrolledIntoView(elem) {\r\n    const docViewTop =\r\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\r\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\r\n\r\n    const elemTop = elem.offsetTop;\r\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\r\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\r\n  }\r\n\r\n  private init() {\r\n    this.subscribe();\r\n\r\n    this.selectedItem = this.findSelectedItem();\r\n    this.focusedItem = this.findFocusedItem();\r\n\r\n    this.enableNavigation();\r\n  }\r\n\r\n  private subscribe() {\r\n    this.unsubscribe();\r\n\r\n    this.listItems.toArray().forEach(item => {\r\n      this.subscriptions.push(\r\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemBeforeSelect(item2)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        item.select.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemSelect(item2)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemBeforeFocus(item2)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        item.focus.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemFocus(item2)\r\n        )\r\n      );\r\n    }, this);\r\n  }\r\n\r\n  private unsubscribe() {\r\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\r\n    this.subscriptions = [];\r\n  }\r\n\r\n  private handleItemBeforeFocus(item: ListItemDirective) {\r\n    if (item !== this.focusedItem) {\r\n      this.unfocus();\r\n    }\r\n  }\r\n\r\n  private handleItemFocus(item: ListItemDirective) {\r\n    this.focusedItem = item;\r\n  }\r\n\r\n  private handleItemBeforeSelect(item: ListItemDirective) {\r\n    if (item !== this.focusedItem) {\r\n      this.unselect();\r\n    }\r\n  }\r\n\r\n  private handleItemSelect(item: ListItemDirective) {\r\n    this.selectedItem = item;\r\n  }\r\n\r\n  private findSelectedItem() {\r\n    return this.listItems.toArray().find(item => item.selected);\r\n  }\r\n\r\n  private findFocusedItem() {\r\n    return this.listItems.toArray().find(item => item.focused);\r\n  }\r\n\r\n  private getFocusedIndex() {\r\n    return this.listItems\r\n      .toArray()\r\n      .findIndex(item => item === this.focusedItem);\r\n  }\r\n\r\n  private navigate(key: string) {\r\n    switch (key) {\r\n      case 'ArrowUp':\r\n        this.focusPrevious();\r\n        break;\r\n      case 'ArrowDown':\r\n        this.focusNext();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n}\r\n","<mat-list\r\n  igoClickout\r\n  [ngClass]=\"{'selectable': selection}\"\r\n  (clickout)=\"disableNavigation()\"\r\n  (click)=\"enableNavigation()\">\r\n  <ng-content></ng-content>\r\n</mat-list>\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\n\r\nimport { IgoClickoutModule } from '../clickout/clickout.module';\r\n\r\nimport { ListItemDirective } from './list-item.directive';\r\nimport { ListComponent } from './list.component';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, MatIconModule, MatListModule, IgoClickoutModule],\r\n  declarations: [ListItemDirective, ListComponent],\r\n  exports: [ListItemDirective, ListComponent]\r\n})\r\nexport class IgoListModule {\r\n  static forRoot(): ModuleWithProviders<IgoListModule> {\r\n    return {\r\n      ngModule: IgoListModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","<div *ngIf=\"withHeader\" class=\"igo-panel-header mat-typography\" title=\"\">\r\n  <h3>\r\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\r\n    <div class=\"igo-panel-title\">\r\n      {{ title }}\r\n      <ng-content select=\"[panelHeader]\"></ng-content>\r\n    </div>\r\n    <ng-content select=\"[panelRightButton]\"></ng-content>\r\n  </h3>\r\n</div>\r\n<div class=\"igo-panel-content\" title=\"\">\r\n  <ng-content></ng-content>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  HostBinding\r\n} from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'igo-panel',\r\n  templateUrl: './panel.component.html',\r\n  styleUrls: ['./panel.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class PanelComponent {\r\n  @Input()\r\n  get title() {\r\n    return this._title;\r\n  }\r\n  set title(value: string) {\r\n    this._title = value;\r\n  }\r\n  private _title: string;\r\n\r\n  @Input()\r\n  @HostBinding('class.igo-panel-with-header')\r\n  get withHeader(): boolean {\r\n    return this._withHeader;\r\n  }\r\n  set withHeader(value: boolean) {\r\n    this._withHeader = value;\r\n  }\r\n  private _withHeader = true;\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { PanelComponent } from './panel.component';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [PanelComponent],\r\n  declarations: [PanelComponent]\r\n})\r\nexport class IgoPanelModule {}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-spinner',\r\n  templateUrl: './spinner.component.html',\r\n  styleUrls: ['./spinner.component.scss']\r\n})\r\nexport class SpinnerComponent {\r\n\r\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  @Input()\r\n  set shown(value: boolean) { this.shown$.next(value); }\r\n  get shown(): boolean { return this.shown$.value; }\r\n\r\n  constructor() {}\r\n\r\n  show() {\r\n    this.shown = true;\r\n  }\r\n\r\n  hide() {\r\n    this.shown = false;\r\n  }\r\n}\r\n","<div\r\n  [ngClass]=\"{'igo-spinner-container': true, 'igo-spinner-shown': (shown$ | async)}\">\r\n  <div class=\"igo-spinner-background\"></div>\r\n  <mat-progress-spinner diameter=\"40\" mode=\"indeterminate\"></mat-progress-spinner>\r\n</div>\r\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { ActivityService } from '@igo2/core';\r\nimport { SpinnerComponent } from './spinner.component';\r\n\r\n/**\r\n * A directive to bind a SpinnerComponent to the activity service.\r\n * The activity service tracks any HTTP request and this directive\r\n * will display the spinner it's attached to when the activity counter\r\n * is greater than 0.\r\n */\r\n@Directive({\r\n  selector: '[igoSpinnerActivity]'\r\n})\r\nexport class SpinnerActivityDirective implements OnInit, OnDestroy {\r\n  /**\r\n   * Subscription to the activity service counter\r\n   */\r\n  private counter$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() private spinner: SpinnerComponent,\r\n    private activityService: ActivityService\r\n  ) {}\r\n\r\n  /**\r\n   * Subscribe to the activity service counter and display the spinner\r\n   * when it's is greater than 0.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.counter$$ = this.activityService.counter$\r\n      .pipe(debounceTime(50))\r\n      .subscribe((count: number) => {\r\n        count > 0 ? this.spinner.show() : this.spinner.hide();\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Unsubcribe to the activity service counter.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.counter$$.unsubscribe();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\r\n\r\nimport { SpinnerActivityDirective } from './spinner-activity.directive';\r\nimport { SpinnerComponent } from './spinner.component';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, MatProgressSpinnerModule],\r\n  declarations: [SpinnerActivityDirective, SpinnerComponent],\r\n  exports: [SpinnerActivityDirective, SpinnerComponent]\r\n})\r\nexport class IgoSpinnerModule {}\r\n","import { DataSource } from '@angular/cdk/table';\r\nimport { MatSort } from '@angular/material/sort';\r\n\r\nimport { Observable, BehaviorSubject, merge } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { TableDatabase, TableModel } from './index';\r\n\r\nexport class TableDataSource extends DataSource<any> {\r\n  get filter(): string {\r\n    return this._filterChange.value;\r\n  }\r\n  set filter(filter: string) {\r\n    this._filterChange.next(filter);\r\n  }\r\n  private _filterChange = new BehaviorSubject('');\r\n\r\n  constructor(\r\n    private _database: TableDatabase,\r\n    private _model: TableModel,\r\n    private _sort: MatSort\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  // Connect function called by the table to retrieve one stream containing\r\n  // the data to render.\r\n  connect(): Observable<any[]> {\r\n    if (!this._database) {\r\n      return merge([]);\r\n    }\r\n    const displayDataChanges = [\r\n      this._database.dataChange,\r\n      this._filterChange,\r\n      this._sort.sortChange\r\n    ];\r\n\r\n    return merge(...displayDataChanges).pipe(\r\n      map(() => {\r\n        return this.getFilteredData(this._database.data);\r\n      }),\r\n      map(data => {\r\n        return this.getSortedData(data);\r\n      })\r\n    );\r\n  }\r\n\r\n  disconnect() {}\r\n\r\n  getFilteredData(data): any[] {\r\n    if (!this.filter) {\r\n      return data;\r\n    }\r\n    return data.slice().filter((item: any) => {\r\n      const searchStr: string = this._model.columns\r\n        .filter(c => c.filterable)\r\n        .map(c => ObjectUtils.resolve(item, c.name))\r\n        .join(' ')\r\n        .toLowerCase();\r\n\r\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\r\n    });\r\n  }\r\n\r\n  getSortedData(data): any[] {\r\n    if (!this._sort.active || this._sort.direction === '') {\r\n      return data;\r\n    }\r\n\r\n    return data.sort((a, b) => {\r\n      const propertyA: number | string = ObjectUtils.resolve(\r\n        a,\r\n        this._sort.active\r\n      );\r\n      const propertyB: number | string = ObjectUtils.resolve(\r\n        b,\r\n        this._sort.active\r\n      );\r\n\r\n      return ObjectUtils.naturalCompare(\r\n        propertyB,\r\n        propertyA,\r\n        this._sort.direction\r\n      );\r\n    });\r\n  }\r\n}\r\n","export enum TableActionColor {\r\n  primary,\r\n  accent,\r\n  warn\r\n}\r\n","<div class='table-box'>\r\n  <div class='table-header' *ngIf=\"hasFilterInput\">\r\n    <mat-form-field floatPlaceholder='never'>\r\n      <input matInput #filter [placeholder]=\"'igo.common.table.filter' | translate\">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class='table-container'>\r\n    <table mat-table #table [dataSource]='dataSource' matSort>\r\n\r\n      <!-- Checkbox Column -->\r\n      <ng-container matColumnDef=\"selectionCheckbox\">\r\n        <th mat-header-cell *matHeaderCellDef>\r\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\r\n                        [checked]=\"selection.hasValue() && isAllSelected()\"\r\n                        [indeterminate]=\"selection.hasValue() && !isAllSelected()\">\r\n          </mat-checkbox>\r\n        </th>\r\n        <td mat-cell *matCellDef=\"let row\">\r\n          <mat-checkbox (click)=\"$event.stopPropagation()\"\r\n                        (change)=\"$event ? selection.toggle(row) : null\"\r\n                        [checked]=\"selection.isSelected(row)\">\r\n          </mat-checkbox>\r\n        </td>\r\n      </ng-container>\r\n\r\n      <ng-container [matColumnDef]='column.name' *ngFor='let column of model.columns'>\r\n        <ng-container *ngIf='column.sortable'>\r\n          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{column.title}} </th>\r\n        </ng-container>\r\n\r\n        <ng-container *ngIf='!column.sortable'>\r\n          <th mat-header-cell *matHeaderCellDef> {{column.title}} </th>\r\n        </ng-container>\r\n\r\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\r\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\r\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\">\r\n            {{getValue(row, column.name)}}\r\n          </td>\r\n        </ng-container>\r\n\r\n        <ng-template #cellHTML>\r\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\r\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\"\r\n            [innerHTML]=\"getValue(row, column.name)\">\r\n          </td>\r\n        </ng-template>\r\n      </ng-container>\r\n\r\n      <!-- Action Column -->\r\n      <ng-container matColumnDef='action'>\r\n        <th mat-header-cell *matHeaderCellDef></th>\r\n        <td mat-cell *matCellDef='let row'>\r\n          <button *ngFor='let action of model.actions'\r\n          mat-mini-fab\r\n          [color]='getActionColor(action.color)'\r\n          (click)='handleClickAction($event, action, row)'>\r\n            <mat-icon svgIcon=\"{{action.icon}}\"></mat-icon>\r\n          </button>\r\n        </td>\r\n      </ng-container>\r\n\r\n      <tr mat-header-row *matHeaderRowDef='displayedColumns;'></tr>\r\n      <tr mat-row\r\n        *matRowDef='let row; columns: displayedColumns;'\r\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\r\n        (click)=\"selection.toggle(row)\">\r\n      </tr>\r\n\r\n    </table>\r\n  </div>\r\n\r\n</div>\r\n","import {\r\n  Component,\r\n  ElementRef,\r\n  ViewChild,\r\n  Input,\r\n  Output,\r\n  OnChanges,\r\n  OnInit,\r\n  AfterViewInit,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { MatSort } from '@angular/material/sort';\r\nimport { SelectionModel } from '@angular/cdk/collections';\r\n\r\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\r\nimport { fromEvent } from 'rxjs';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { TableModel } from './table-model.interface';\r\nimport { TableDatabase } from './table-database';\r\nimport { TableDataSource } from './table-datasource';\r\nimport { TableActionColor } from './table-action-color.enum';\r\n\r\n@Component({\r\n  selector: 'igo-table',\r\n  templateUrl: './table.component.html',\r\n  styleUrls: ['./table.component.scss']\r\n})\r\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\r\n  @Input()\r\n  get database(): TableDatabase {\r\n    return this._database;\r\n  }\r\n  set database(value: TableDatabase) {\r\n    this._database = value;\r\n  }\r\n  private _database: TableDatabase;\r\n\r\n  @Input()\r\n  get model(): TableModel {\r\n    return this._model;\r\n  }\r\n  set model(value: TableModel) {\r\n    this._model = value;\r\n  }\r\n  private _model: TableModel;\r\n\r\n  @Input()\r\n  get hasFilterInput(): boolean {\r\n    return this._hasFIlterInput;\r\n  }\r\n  set hasFilterInput(value: boolean) {\r\n    this._hasFIlterInput = value;\r\n  }\r\n  private _hasFIlterInput = true;\r\n\r\n  public displayedColumns;\r\n  public dataSource: TableDataSource | null;\r\n  public selection = new SelectionModel<any>(true, []);\r\n\r\n  @Output()\r\n  select = new EventEmitter<{\r\n    added: any[];\r\n    removed: any[];\r\n    source: SelectionModel<any>;\r\n  }>();\r\n\r\n  @ViewChild('filter') filter: ElementRef;\r\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\r\n\r\n  ngOnInit() {\r\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\r\n\r\n    if (this.model) {\r\n      this.displayedColumns = this.model.columns\r\n        .filter(c => c.displayed !== false)\r\n        .map(c => c.name);\r\n\r\n      if (this.model.selectionCheckbox) {\r\n        this.displayedColumns.unshift('selectionCheckbox');\r\n      }\r\n      if (this.model.actions && this.model.actions.length) {\r\n        this.displayedColumns.push('action');\r\n      }\r\n    }\r\n\r\n    this.selection.changed.subscribe(e => this.select.emit(e));\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    if (this.filter) {\r\n      fromEvent(this.filter.nativeElement, 'keyup')\r\n        .pipe(\r\n          debounceTime(150),\r\n          distinctUntilChanged()\r\n        )\r\n        .subscribe(() => {\r\n          if (!this.dataSource) {\r\n            return;\r\n          }\r\n          this.dataSource.filter = this.filter.nativeElement.value;\r\n        });\r\n    }\r\n  }\r\n\r\n  ngOnChanges(change) {\r\n    if (change.database) {\r\n      this.dataSource = new TableDataSource(\r\n        this.database,\r\n        this.model,\r\n        this.sort\r\n      );\r\n      this.selection.clear();\r\n    }\r\n  }\r\n\r\n  getActionColor(colorId: number): string {\r\n    return TableActionColor[colorId];\r\n  }\r\n\r\n  getValue(row, key) {\r\n    return ObjectUtils.resolve(row, key);\r\n  }\r\n\r\n  /** Whether the number of selected elements matches the total number of rows. */\r\n  isAllSelected() {\r\n    const numSelected = this.selection.selected.length;\r\n    const numRows = this.database.data.length;\r\n    return numSelected === numRows;\r\n  }\r\n\r\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\r\n  masterToggle() {\r\n    this.isAllSelected()\r\n      ? this.selection.clear()\r\n      : this.database.data.forEach(row => this.selection.select(row));\r\n  }\r\n\r\n  handleClickAction(event, action, row) {\r\n    event.stopPropagation();\r\n    action.click(row);\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { CdkTableModule } from '@angular/cdk/table';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSortModule } from '@angular/material/sort';\r\nimport { MatTableModule } from '@angular/material/table';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { TableComponent } from './table.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    CdkTableModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTableModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSortModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule\r\n  ],\r\n  declarations: [TableComponent],\r\n  exports: [TableComponent]\r\n})\r\nexport class IgoTableModule {\r\n  static forRoot(): ModuleWithProviders<IgoTableModule> {\r\n    return {\r\n      ngModule: IgoTableModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { EntityStore } from '../../entity';\r\nimport { Action } from './action.interfaces';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * actions.\r\n */\r\nexport class ActionStore extends EntityStore<Action> {\r\n\r\n}\r\n","export enum ToolboxColor {\r\n  White = 'white',\r\n  Grey = 'grey',\r\n  Primary = 'primary'\r\n}\r\n","import {\r\n  trigger,\r\n  state,\r\n  style,\r\n  transition,\r\n  animate,\r\n  AnimationTriggerMetadata\r\n} from '@angular/animations';\r\n\r\nexport function toolSlideInOut(\r\n  speed = '300ms',\r\n  type = 'ease-in-out'\r\n): AnimationTriggerMetadata {\r\n  return trigger('toolSlideInOut', [\r\n    state(\r\n      'enter',\r\n      style({\r\n        transform: 'translate3d(0, 0, 0)'\r\n      })\r\n    ),\r\n    transition('void => enter', animate(speed + ' ' + type))\r\n  ]);\r\n}\r\n","<igo-actionbar\r\n  *ngIf=\"(toolbar$ | async).length > 0\"\r\n  [store]=\"actionStore\"\r\n  [withIcon]=\"true\"\r\n  [withTitle]=\"toolbarWithTitle$ | async\"\r\n  [withTooltip]=\"!(toolbarWithTitle$ | async)\"\r\n  [scrollActive]=\"toolbarWithTitle$ | async\"\r\n  [horizontal]=\"false\">\r\n</igo-actionbar>\r\n\r\n<div\r\n  *ngIf=\"activeTool$ | async as tool\"\r\n  class=\"igo-tool-container\"\r\n  [ngClass]=\"{'igo-tool-container-with-toolbar': !actionStore.empty, 'igo-tool-container-with-animation': animate}\"\r\n  [@toolSlideInOut]=\"animation$ | async\"\r\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\r\n  (@toolSlideInOut.done)=\"onAnimationComplete()\">\r\n\r\n  <igo-dynamic-outlet\r\n    [component]=\"tool.component\"\r\n    [inputs]=\"getToolInputs(tool)\">\r\n  </igo-dynamic-outlet>\r\n\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  HostBinding,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { Subscription, BehaviorSubject, Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { Action, ActionStore } from '../../action';\r\nimport { Tool } from '../shared/tool.interface';\r\nimport { ToolboxColor } from '../shared/toolbox.enums';\r\nimport { Toolbox } from '../shared/toolbox';\r\nimport { toolSlideInOut } from './toolbox.animation';\r\n\r\n@Component({\r\n  selector: 'igo-toolbox',\r\n  templateUrl: 'toolbox.component.html',\r\n  styleUrls: ['toolbox.component.scss'],\r\n  animations: [toolSlideInOut()],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ToolboxComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Observable of the active tool\r\n   */\r\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Store of actions that toggle tools\r\n   */\r\n  actionStore: ActionStore = new ActionStore([]);\r\n\r\n  /**\r\n   * Observable of he anmation state\r\n   */\r\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\r\n\r\n  /**\r\n   * Observable of the toolbar\r\n   */\r\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * Whether the Toolbar should display actions' titles\r\n   */\r\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\r\n    map((tool: Tool | undefined) => tool === undefined)\r\n  );\r\n\r\n  /**\r\n   * Subscription to the active tool\r\n   */\r\n  private activeTool$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the toolbar\r\n   */\r\n  private toolbar$$: Subscription;\r\n\r\n  /**\r\n   * Observable of the ongoing animation. This is useful when\r\n   * multiple animations are triggered at once i.e. when the user clicks\r\n   * too fast on different actions\r\n   */\r\n  private animating$ = new BehaviorSubject<boolean>(false);\r\n\r\n  /**\r\n   * Subscription to the ongoing animation\r\n   */\r\n  private animating$$: Subscription;\r\n\r\n  /**\r\n   * Toolbox\r\n   */\r\n  @Input() toolbox: Toolbox;\r\n\r\n  /**\r\n   * Whether the toolbox should animate the first tool entering\r\n   */\r\n  @Input() animate: boolean = false;\r\n\r\n  /**\r\n   * Color of Toolbox\r\n   */\r\n  @Input() color: ToolboxColor = ToolboxColor.White;\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.color-grey')\r\n  get classColorGrey() {\r\n    return this.color === ToolboxColor.Grey;\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.color-primary')\r\n  get classColorPrimary() {\r\n    return this.color === ToolboxColor.Primary;\r\n  }\r\n\r\n  /**\r\n   * Initialize the toolbar and subscribe to the active tool\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\r\n      this.onToolbarChange(toolbar)\r\n    );\r\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\r\n      this.onActiveToolChange(tool)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the active tool and destroy the action store\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.toolbar$$.unsubscribe();\r\n    this.activeTool$$.unsubscribe();\r\n    this.actionStore.destroy();\r\n  }\r\n\r\n  /**\r\n   * Track the starting animation\r\n   * @internal\r\n   */\r\n  onAnimationStart() {\r\n    this.animating$.next(true);\r\n  }\r\n\r\n  /**\r\n   * Untrack the completed animation\r\n   * @internal\r\n   */\r\n  onAnimationComplete() {\r\n    this.animating$.next(false);\r\n  }\r\n\r\n  /**\r\n   * Return a tool's inputs\r\n   * @param tool Tool\r\n   * @returns Tool inputs\r\n   * @internal\r\n   */\r\n  getToolInputs(tool: Tool): { [key: string]: any } {\r\n    return tool.options || {};\r\n  }\r\n\r\n  /**\r\n   * Initialize an action store\r\n   * @param toolbar Toolbar\r\n   */\r\n  private onToolbarChange(toolbar: string[]) {\r\n    this.setToolbar(toolbar);\r\n  }\r\n\r\n  /**\r\n   * Activate a tool and trigger an animation or not\r\n   * @param tool Tool to activate\r\n   */\r\n  private onActiveToolChange(tool: Tool) {\r\n    if (!this.animate) {\r\n      this.setActiveTool(tool);\r\n      return;\r\n    }\r\n    this.onAnimate(() => this.setActiveTool(tool));\r\n  }\r\n\r\n  /**\r\n   * Set the active tool\r\n   * @param tool Tool to activate\r\n   */\r\n  private setActiveTool(tool: Tool | undefined) {\r\n    if (tool === undefined) {\r\n      this.actionStore.state.updateAll({ active: false });\r\n    } else {\r\n      const action = this.actionStore.get(tool.name);\r\n      if (action !== undefined) {\r\n        this.actionStore.state.update(action, { active: true }, true);\r\n      }\r\n    }\r\n\r\n    this.activeTool$.next(tool);\r\n    if (this.animate) {\r\n      this.animation$.next('enter');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize the toolbar\r\n   */\r\n  private setToolbar(toolbar: string[]) {\r\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\r\n      const tool = this.toolbox.getTool(toolName);\r\n      if (tool === undefined) {\r\n        return acc;\r\n      }\r\n\r\n      acc.push({\r\n        id: tool.name,\r\n        title: tool.title,\r\n        icon: tool.icon,\r\n        // iconImage: tool.iconImage,\r\n        tooltip: tool.tooltip,\r\n        args: [tool, this.toolbox],\r\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\r\n          _toolbox.activateTool(_tool.name);\r\n        },\r\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\r\n          return this.toolbox.activeTool$.pipe(\r\n            map((activeTool: Tool) => {\r\n              let toolActivated = false;\r\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\r\n                toolActivated = true;\r\n              }\r\n\r\n              let childrenToolActivated = false;\r\n              if (\r\n                activeTool !== undefined &&\r\n                _tool.name === activeTool.parent\r\n              ) {\r\n                childrenToolActivated = true;\r\n              }\r\n\r\n              return {\r\n                'tool-activated': toolActivated,\r\n                'children-tool-activated': childrenToolActivated\r\n              };\r\n            })\r\n          );\r\n        }\r\n      });\r\n      return acc;\r\n    }, []);\r\n    this.actionStore.load(actions);\r\n    this.toolbar$.next(toolbar);\r\n  }\r\n\r\n  /**\r\n   * Observe the ongoing animation and ignore any incoming animation\r\n   * while one is still ongoing.\r\n   * @param callback Callback to execute when the animation completes\r\n   */\r\n  private onAnimate(callback: () => void) {\r\n    this.unAnimate();\r\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\r\n      if (!animation) {\r\n        callback.call(this);\r\n        this.unAnimate();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop observing an animation when it's complete\r\n   */\r\n  private unAnimate() {\r\n    if (this.animating$$) {\r\n      this.animating$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoActionModule } from '../../action/action.module';\r\nimport {\r\n    IgoDynamicComponentModule\r\n} from '../../dynamic-component/dynamic-component.module';\r\n\r\nimport { ToolboxComponent } from './toolbox.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoActionModule,\r\n    IgoDynamicComponentModule\r\n  ],\r\n  exports: [\r\n    ToolboxComponent\r\n  ],\r\n  declarations: [\r\n    ToolboxComponent\r\n  ]\r\n})\r\nexport class IgoToolboxModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { ToolService } from './shared/tool.service';\r\nimport { IgoToolboxModule } from './toolbox/toolbox.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n    IgoToolboxModule\r\n  ],\r\n  declarations: []\r\n})\r\nexport class IgoToolModule {\r\n  static forRoot(): ModuleWithProviders<IgoToolModule> {\r\n    return {\r\n      ngModule: IgoToolModule,\r\n      providers: [\r\n        ToolService\r\n      ]\r\n    };\r\n  }\r\n}\r\n","<igo-dynamic-outlet\r\n  *ngIf=\"widget\"\r\n  [component]=\"widget\"\r\n  [inputs]=\"inputs\"\r\n  [subscribers]=\"getEffectiveSubscribers()\">\r\n</igo-dynamic-outlet>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { DynamicComponent } from '../../dynamic-component';\r\n\r\nimport { WidgetComponent } from '../shared/widget.interfaces';\r\n\r\n/**\r\n * This component dynamically renders a widget. It also subscribes\r\n * to the widget's 'cancel' and 'complete' events and destroys it\r\n * when any of those event is emitted.\r\n */\r\n@Component({\r\n  selector: 'igo-widget-outlet',\r\n  templateUrl: './widget-outlet.component.html',\r\n  styleUrls: ['./widget-outlet.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WidgetOutletComponent implements OnDestroy {\r\n\r\n  /**\r\n   * Widget subscribers to 'cancel' and 'complete'\r\n   * @internal\r\n   */\r\n  private baseSubscribers = {\r\n    cancel: (event: any) => this.onCancel(event),\r\n    complete: (event: any) => this.onComplete(event)\r\n  };\r\n\r\n  /**\r\n   * Widget\r\n   */\r\n  @Input() widget: DynamicComponent<WidgetComponent>;\r\n\r\n  /**\r\n   * Widget inputs\r\n   */\r\n  @Input() inputs: {[key: string]: any};\r\n\r\n  /**\r\n   * Widget subscribers\r\n   */\r\n  @Input() subscribers: {[key: string]: (event: any) => void} = {};\r\n\r\n  /**\r\n   * Event emitted when the widget emits 'complete'\r\n   */\r\n  @Output() complete = new EventEmitter<any>();\r\n\r\n  /**\r\n   * Event emitted when the widget emits 'cancel'\r\n   */\r\n  @Output() cancel = new EventEmitter<any>();\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Destroy the current widget and all it's inner subscriptions\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.destroyWidget();\r\n  }\r\n\r\n  /**\r\n   * Get the effective subscribers. That means a combination of the base\r\n   * subscribers and any subscriber given as input.\r\n   * @returns Combined subscribers\r\n   * @internal\r\n   */\r\n  getEffectiveSubscribers(): {[key: string]: (event: any) => void} {\r\n    const subscribers = Object.assign({}, this.subscribers);\r\n\r\n    // Base subscribers\r\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\r\n      const subscriber = subscribers[key];\r\n      const baseSubscriber = this.baseSubscribers[key];\r\n      if (subscriber !== undefined) {\r\n        subscribers[key] = (event: any) => {\r\n          subscriber(event);\r\n          baseSubscriber(event);\r\n        };\r\n      } else {\r\n        subscribers[key] = baseSubscriber;\r\n      }\r\n    });\r\n\r\n    return subscribers;\r\n  }\r\n\r\n  /**\r\n   * When the widget emits 'cancel', propagate that event and destroy\r\n   * the widget\r\n   */\r\n  private onCancel(event: any) {\r\n    this.cancel.emit(event);\r\n    this.destroyWidget();\r\n  }\r\n\r\n  /**\r\n   * When the widget emits 'complete', propagate that event and destroy\r\n   * the widget\r\n   */\r\n  private onComplete(event: any) {\r\n    this.complete.emit(event);\r\n    this.destroyWidget();\r\n  }\r\n\r\n  /**\r\n   * Destroy the current widget\r\n   */\r\n  private destroyWidget() {\r\n    if (this.widget !== undefined) {\r\n      this.widget.destroy();\r\n    }\r\n    this.widget = undefined;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport {\r\n  IgoDynamicComponentModule\r\n} from '../../dynamic-component/dynamic-component.module';\r\n\r\nimport { WidgetOutletComponent } from './widget-outlet.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoDynamicComponentModule\r\n  ],\r\n  exports: [\r\n    WidgetOutletComponent\r\n  ],\r\n  declarations: [\r\n    WidgetOutletComponent\r\n  ]\r\n})\r\nexport class IgoWidgetOutletModule {}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { DynamicComponentService } from '../../dynamic-component/shared/dynamic-component.service';\r\n\r\nimport { Widget } from './widget';\r\nimport { WidgetComponent } from './widget.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WidgetService {\r\n\r\n  constructor(private dynamicComponentService: DynamicComponentService) {}\r\n\r\n  create(widgetCls: any): Widget {\r\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\r\nimport { WidgetService } from './shared/widget.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoWidgetOutletModule\r\n  ],\r\n  exports: [\r\n    IgoWidgetOutletModule\r\n  ],\r\n  declarations: [],\r\n  providers: [\r\n    WidgetService\r\n  ]\r\n})\r\nexport class IgoWidgetModule {}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { getEntityTitle } from '../../entity';\r\nimport { Workspace } from '../shared/workspace';\r\nimport { WorkspaceStore } from '../shared/store';\r\n\r\n/**\r\n * Drop list that activates the selected workspace emit an event.\r\n */\r\n@Component({\r\n  selector: 'igo-workspace-selector',\r\n  templateUrl: './workspace-selector.component.html',\r\n  styleUrls: ['./workspace-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WorkspaceSelectorComponent {\r\n\r\n  /**\r\n   * Store that holds the available workspaces.\r\n   */\r\n  @Input() store: WorkspaceStore;\r\n\r\n  /**\r\n   * Event emitted when an workspace is selected or unselected\r\n   */\r\n  @Output() selectedChange = new EventEmitter<{\r\n    selected: boolean;\r\n    value: Workspace;\r\n  }>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  getWorkspaceTitle(workspace: Workspace): string {\r\n    return getEntityTitle(workspace);\r\n  }\r\n\r\n  /**\r\n   * When an workspace is manually selected, select it into the\r\n   * store and emit an event.\r\n   * @internal\r\n   * @param event The selection change event\r\n   */\r\n  onSelectedChange(event: {value: Workspace}) {\r\n    const workspace = event.value;\r\n    this.store.activateWorkspace(workspace);\r\n    this.selectedChange.emit({selected: true, value: workspace});\r\n  }\r\n\r\n}\r\n","<igo-entity-selector\r\n  [store]=\"store\"\r\n  [multi]=\"false\"\r\n  [titleAccessor]=\"getWorkspaceTitle\"\r\n  (selectedChange)=\"onSelectedChange($event)\">\r\n</igo-entity-selector>\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoEntitySelectorModule } from '../../entity/entity-selector/entity-selector.module';\r\nimport { WorkspaceSelectorComponent } from './workspace-selector.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoEntitySelectorModule\r\n  ],\r\n  exports: [\r\n    WorkspaceSelectorComponent\r\n  ],\r\n  declarations: [\r\n    WorkspaceSelectorComponent\r\n  ]\r\n})\r\nexport class IgoWorkspaceSelectorModule {}\r\n","<ng-container *ngIf=\"widget$ | async as widget\">\r\n  <igo-widget-outlet\r\n    [widget]=\"widget\"\r\n    [inputs]=\"widgetInputs$ | async\"\r\n    [subscribers]=\"widgetSubscribers$ | async\"\r\n    (cancel)=\"onWidgetCancel(widget)\"\r\n    (complete)=\"onWidgetComplete(widget)\">\r\n  </igo-widget-outlet>\r\n</ng-container>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Widget } from '../../widget';\r\nimport { Workspace } from '../shared/workspace';\r\n\r\n/**\r\n * This component dynamically render an Workspace's active widget.\r\n * It also deactivate that widget whenever the widget's component\r\n * emit the 'cancel' or 'complete' event.\r\n */\r\n@Component({\r\n  selector: 'igo-workspace-widget-outlet',\r\n  templateUrl: './workspace-widget-outlet.component.html',\r\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WorkspaceWidgetOutletComponent {\r\n\r\n  /**\r\n   * Workspace\r\n   */\r\n  @Input() workspace: Workspace;\r\n\r\n  /**\r\n   * Event emitted when a widget is deactivate which happens\r\n   * when the widget's component emits the 'cancel' or 'complete' event.\r\n   */\r\n  @Output() deactivateWidget = new EventEmitter<Widget>();\r\n\r\n  /**\r\n   * Observable of the workspace's active widget\r\n   * @internal\r\n   */\r\n  get widget$(): BehaviorSubject<Widget> { return this.workspace.widget$; }\r\n\r\n  /**\r\n   * Observable of the workspace's widget inputs\r\n   * @internal\r\n   */\r\n  get widgetInputs$(): BehaviorSubject<{[key: string]: any}> {\r\n    return this.workspace.widgetInputs$;\r\n  }\r\n\r\n  /**\r\n   * Observable of the workspace's widget inputs\r\n   * @internal\r\n   */\r\n  get widgetSubscribers$(): BehaviorSubject<{[key: string]: (event: any) => void}> {\r\n    return this.workspace.widgetSubscribers$;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * When a widget's component emit the 'cancel' event,\r\n   * deactivate that widget and emit the 'deactivateWidget' event.\r\n   * @param widget Widget\r\n   * @internal\r\n   */\r\n  onWidgetCancel(widget: Widget) {\r\n    this.workspace.deactivateWidget();\r\n    this.deactivateWidget.emit(widget);\r\n  }\r\n\r\n  /**\r\n   * When a widget's component emit the 'cancel' event,\r\n   * deactivate that widget and emit the 'deactivateWidget' event.\r\n   * @param widget Widget\r\n   * @internal\r\n   */\r\n  onWidgetComplete(widget: Widget) {\r\n    this.workspace.deactivateWidget();\r\n    this.deactivateWidget.emit(widget);\r\n  }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoWidgetOutletModule } from '../../widget/widget-outlet/widget-outlet.module';\r\n\r\nimport { WorkspaceWidgetOutletComponent } from './workspace-widget-outlet.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoWidgetOutletModule\r\n  ],\r\n  exports: [\r\n    WorkspaceWidgetOutletComponent\r\n  ],\r\n  declarations: [\r\n    WorkspaceWidgetOutletComponent\r\n  ]\r\n})\r\nexport class IgoWorkspaceWidgetOutletModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\r\nimport { IgoWorkspaceWidgetOutletModule } from './workspace-widget-outlet/workspace-widget-outlet.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n    IgoWorkspaceSelectorModule,\r\n    IgoWorkspaceWidgetOutletModule\r\n  ],\r\n  declarations: []\r\n})\r\nexport class IgoWorkspaceModule {}\r\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nexport class TableDatabase {\r\n  /** Stream that emits whenever the data has been modified. */\r\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\r\n  get data(): any[] {\r\n    return this.dataChange.value;\r\n  }\r\n\r\n  constructor(data?) {\r\n    if (data) {\r\n      this.dataChange.next(data);\r\n    }\r\n  }\r\n\r\n  set(data) {\r\n    this.dataChange.next(data);\r\n  }\r\n\r\n  add(item) {\r\n    const copiedData = this.data.slice();\r\n    copiedData.push(item);\r\n    this.set(copiedData);\r\n  }\r\n\r\n  remove(item) {\r\n    const copiedData = this.data.slice();\r\n    const index = copiedData.indexOf(item);\r\n    copiedData.splice(index, 1);\r\n    this.set(copiedData);\r\n  }\r\n}\r\n","import { Tool } from './tool.interface';\r\nimport { ToolService } from './tool.service';\r\n\r\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\r\n  return (compType: any) => {\r\n    ToolService.register(Object.assign({}, tool, {\r\n      component: compType\r\n    } as Tool));\r\n  };\r\n}\r\n","import { EntityStore } from '../../entity';\r\nimport { Workspace } from './workspace';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * workspaces.\r\n */\r\nexport class WorkspaceStore extends EntityStore<Workspace> {\r\n\r\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Activate the an workspace workspace and deactivate the one currently active\r\n   * @param workspace Workspace\r\n   */\r\n  activateWorkspace(workspace: Workspace) {\r\n    const active = this.activeWorkspace$.value;\r\n    if (active !== undefined) {\r\n      active.deactivate();\r\n    }\r\n\r\n    this.deactivateWorkspace();\r\n    if (workspace !== undefined) {\r\n      this.state.update(workspace, {active: true, selected: true}, true);\r\n      this.activeWorkspace$.next(workspace);\r\n      workspace.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate the current workspace\r\n   * @param workspace Workspace\r\n   */\r\n  deactivateWorkspace() {\r\n    const active = this.activeWorkspace$.value;\r\n    if (active !== undefined) {\r\n      active.deactivate();\r\n      this.activeWorkspace$.next(undefined);\r\n    }\r\n  }\r\n\r\n}\r\n","import { Subscription, BehaviorSubject, Subject } from 'rxjs';\r\n\r\nimport { ActionStore } from '../../action';\r\nimport { Widget } from '../../widget';\r\nimport { EntityStore } from '../../entity';\r\n\r\nimport { WorkspaceOptions } from './workspace.interfaces';\r\n\r\n/**\r\n * This class is responsible of managing the relations between\r\n * entities and the actions that consume them. It also defines an\r\n * entity table template that may be used by an entity table component.\r\n */\r\nexport class Workspace<E extends object = object> {\r\n\r\n  /**\r\n   * Observable of the selected widget\r\n   */\r\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\r\n\r\n  /**\r\n   * Observable of the selected widget's inputs\r\n   */\r\n  readonly widgetInputs$ = new BehaviorSubject<{[key: string]: any}>({});\r\n\r\n  /**\r\n   * Observable of the selected widget's subscribers\r\n   */\r\n  readonly widgetSubscribers$ = new BehaviorSubject<{[key: string]: (event: any) => void}>({});\r\n\r\n  /**\r\n   * Subscription to the selected entity\r\n   */\r\n  private entities$$: Subscription;\r\n\r\n  /**\r\n   * State change that trigger an update of the actions availability\r\n   */\r\n  private change: Subject<void> = new Subject();\r\n\r\n  /**\r\n   * Subscription to state changes\r\n   */\r\n  private change$: Subscription;\r\n\r\n  /**\r\n   * Workspace id\r\n   */\r\n  get id(): string { return this.options.id; }\r\n\r\n  /**\r\n   * Workspace title\r\n   */\r\n  get title(): string { return this.options.title; }\r\n\r\n  /**\r\n   * Workspace title\r\n   */\r\n  get meta(): {[key: string]: any} { return this.options.meta || {}; }\r\n\r\n  /**\r\n   * Entities store\r\n   */\r\n  get entityStore(): EntityStore<E> { return this.options.entityStore as EntityStore<E>; }\r\n\r\n  /**\r\n   * Actions store (some actions activate a widget)\r\n   */\r\n  get actionStore(): ActionStore { return this.options.actionStore; }\r\n\r\n  /**\r\n   * Selected widget\r\n   */\r\n  get widget(): Widget { return this.widget$.value; }\r\n\r\n  /**\r\n   * Whether a widget is selected\r\n   */\r\n  get hasWidget(): boolean { return this.widget !== undefined; }\r\n\r\n  constructor(protected options: WorkspaceOptions) {}\r\n\r\n  /**\r\n   * Whether this strategy is active\r\n   * @internal\r\n   */\r\n  get active(): boolean { return this.active$.value; }\r\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Activate the workspace. By doing that, the workspace will observe\r\n   * the selected entity (from the store) and update the actions availability.\r\n   * For example, some actions require an entity to be selected.\r\n   */\r\n  activate() {\r\n    if (this.active === true) {\r\n      this.deactivate();\r\n    }\r\n    this.active$.next(true);\r\n\r\n    if (this.entityStore !== undefined) {\r\n      this.entities$$ = this.entityStore.stateView.all$()\r\n        .subscribe(() => this.onStateChange());\r\n    }\r\n\r\n    this.change.next();\r\n  }\r\n\r\n  /**\r\n   * Deactivate the workspace. Unsubcribe to the selected entity.\r\n   */\r\n  deactivate() {\r\n    this.active$.next(false);\r\n    this.deactivateWidget();\r\n\r\n    if (this.entities$$ !== undefined) {\r\n      this.entities$$.unsubscribe();\r\n    }\r\n    if (this.change$ !== undefined) {\r\n      this.change$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a widget. In itself, activating a widget doesn't render it but,\r\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\r\n   * show up.\r\n   * @param widget Widget\r\n   * @param inputs Inputs the widget will receive\r\n   */\r\n  activateWidget(\r\n    widget: Widget,\r\n    inputs: {[key: string]: any} = {},\r\n    subscribers: {[key: string]: (event: any) => void} = {}\r\n  ) {\r\n    this.widget$.next(widget);\r\n    this.widgetInputs$.next(inputs);\r\n    this.widgetSubscribers$.next(subscribers);\r\n    this.change.next();\r\n  }\r\n\r\n  /**\r\n   * Deactivate a widget.\r\n   */\r\n  deactivateWidget() {\r\n    this.widget$.next(undefined);\r\n    this.change.next();\r\n  }\r\n\r\n  /**\r\n   * When the state changes, update the actions availability.\r\n   */\r\n  private onStateChange() {\r\n    this.change.next();\r\n  }\r\n\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppHomeComponent } from './home.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'home',\r\n    component: AppHomeComponent\r\n  }\r\n];\r\n\r\nexport const AppHomeRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\nimport { InteractiveTourService } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-home',\r\n  templateUrl: './home.component.html',\r\n  styleUrls: ['./home.component.scss']\r\n})\r\nexport class AppHomeComponent {\r\n  constructor(private interactiveTourService: InteractiveTourService) {}\r\n\r\n  startTour() {\r\n    this.interactiveTourService.startTour('global');\r\n  }\r\n}\r\n","<div style=\"text-align:center\">\r\n  <h1 id=\"igo-title\">\r\n    Welcome to IGO\r\n  </h1>\r\n  <img  class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\">\r\n</div>\r\n\r\n<p>\r\n  <igo-interactive-tour\r\n    tourToStart = \"global\"\r\n    menuIsOpen = true\r\n    styleButton = \"raised\">\r\n  </igo-interactive-tour>\r\n</p>\r\n\r\n<p>\r\n  IGO2 library contains many components and services that may benefit any web application. <br>\r\n  IGO2 library is open source project using Angular, Angular Material and OpenLayers.\r\n</p>\r\n\r\n<h3>IGO2 library is divided into several elements: </h3>\r\n<ul>\r\n  <li><b>@igo2/utils</b> : Basic utilies without dependency (ex: base64, clipboard, uuid)</li>\r\n  <li><b>@igo2/core</b> : Element affecting the core of the application (ex: config, language, message, media, request)</li>\r\n  <li><b>@igo2/common</b> : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table)</li>\r\n  <li><b>@igo2/auth</b> : Library grouping the authentication and security module</li>\r\n  <li><b>@igo2/geo</b> : Library containing the geomatic components. Depends on Openlayers.</li>\r\n  <li><b>@igo2/context</b> : Library of components uniting @igo2/geo and @igo2/auth</li>\r\n  <li><b>@igo2/integration</b> : Library integrate basic components</li>\r\n</ul>\r\n\r\n<h2>Here are some links to help you start: </h2>\r\n<ul>\r\n  <li>\r\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\">Installation</a></h2>\r\n  </li>\r\n  <li>\r\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\">Angular Documentation</a></h2>\r\n  </li>\r\n</ul>\r\n\r\n*** Modules in <code>@igo2/core</code> must be imported only once\r\n","import { NgModule } from '@angular/core';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { AppHomeComponent } from './home.component';\r\nimport { AppHomeRoutingModule } from './home-routing.module';\r\nimport { IgoInteractiveTourModule } from '@igo2/common';\r\n\r\n@NgModule({\r\n  declarations: [AppHomeComponent],\r\n  imports: [\r\n    AppHomeRoutingModule,\r\n    IgoInteractiveTourModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule\r\n  ],\r\n  exports: [AppHomeComponent]\r\n})\r\nexport class AppHomeModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppActivityComponent } from './activity.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'activity',\r\n    component: AppActivityComponent\r\n  }\r\n];\r\n\r\nexport const AppActivityRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { ActivityService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-activity',\r\n  templateUrl: './activity.component.html',\r\n  styleUrls: ['./activity.component.scss']\r\n})\r\nexport class AppActivityComponent {\r\n  private idsActivity: string[] = [];\r\n\r\n  constructor(private activityService: ActivityService) {}\r\n\r\n  register() {\r\n    this.idsActivity.push(this.activityService.register());\r\n  }\r\n\r\n  unregister() {\r\n    this.activityService.unregister(this.idsActivity.pop());\r\n  }\r\n\r\n  get counter() {\r\n    return this.activityService.counter$.value;\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Core</mat-card-subtitle>\r\n  <mat-card-title>Activity</mat-card-title>\r\n  <mat-card-content>\r\n    <p>Register activities in service. Use to display a loading icon</p>\r\n\r\n    <li>Import <code>IgoActivityModule</code> only if you want register http calls</li>\r\n    <li>Import <code>IgoActivityModule</code> only once</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/activity\"> code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <mat-card-actions>\r\n    <button mat-raised-button (click)=\"register()\">Register</button>\r\n    <button mat-raised-button (click)=\"unregister()\">Unregister</button>\r\n  </mat-card-actions>\r\n  <p>Counter: {{counter}}</p>\r\n\r\n  <igo-spinner igoSpinnerActivity></igo-spinner>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoActivityModule } from '@igo2/core';\r\nimport { IgoSpinnerModule } from '@igo2/common';\r\n\r\nimport { AppActivityComponent } from './activity.component';\r\nimport { AppActivityRoutingModule } from './activity-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppActivityComponent],\r\n  imports: [\r\n    AppActivityRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoActivityModule.forRoot(), // Only if you want register http calls\r\n    IgoSpinnerModule\r\n  ],\r\n  exports: [AppActivityComponent]\r\n})\r\nexport class AppActivityModule {}\r\n","interface Environment {\r\n  production: boolean;\r\n  igo: any;\r\n}\r\n\r\nexport const environment: Environment = {\r\n  production: true,\r\n  igo: {\r\n    projections: [\r\n      {\r\n        code: 'EPSG:32198',\r\n        alias: 'Quebec Lambert',\r\n        def:\r\n          '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\r\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\r\n      }\r\n    ],\r\n    auth: {\r\n      intern: {\r\n        enabled: true\r\n      },\r\n      allowAnonymous: true\r\n    },\r\n    interactiveTour: {\r\n      tourInMobile: true\r\n    },\r\n    importExport: {\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\r\n    },\r\n    language: {\r\n      prefix: './locale/'\r\n    },\r\n    catalog: {\r\n      sources: [\r\n        {\r\n          id: 'Gououvert',\r\n          title: 'Gouvouvert',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi'\r\n        },\r\n        {\r\n          id: 'DefiningInfoFormat',\r\n          title: 'Defining info_format',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          queryFormat: {\r\n            html: '*',\r\n            'application/json': [\r\n              'stations_meteoroutieres',\r\n              'histo_stations_meteoroutieres'\r\n            ]\r\n          },\r\n          queryHtmlTarget: 'iframe',\r\n          count: 30\r\n        },\r\n        {\r\n          id: 'catalogwithregex',\r\n          title: 'Filtered catalog by regex',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          regFilters: ['zpegt']\r\n        },\r\n        {\r\n          id: 'catalogwithtooltipcontrol',\r\n          title: 'Controling tooltip format',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n          tooltipType: 'abstract' // or title\r\n        }\r\n      ]\r\n    },\r\n    searchSources: {\r\n      nominatim: {\r\n        enabled: false\r\n      },\r\n      icherche: {\r\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\r\n        order: 2,\r\n        enabled: true,\r\n        params: {\r\n          limit: '8'\r\n        }\r\n      },\r\n      coordinatesreverse: {\r\n        showInPointerSummary: true\r\n      },\r\n      icherchereverse: {\r\n        showInPointerSummary: true,\r\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\r\n        order: 3,\r\n        enabled: true\r\n      },\r\n      ilayer: {\r\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\r\n        order: 4,\r\n        enabled: true,\r\n        params: {\r\n          limit: '5'\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppConfigComponent } from './config.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'config',\r\n    component: AppConfigComponent\r\n  }\r\n];\r\n\r\nexport const AppConfigRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\nimport { ConfigService, LanguageOptions } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-config',\r\n  templateUrl: './config.component.html',\r\n  styleUrls: ['./config.component.scss']\r\n})\r\nexport class AppConfigComponent {\r\n  public configLanguage: LanguageOptions;\r\n\r\n  constructor(private configService: ConfigService) {\r\n    this.configLanguage = this.configService.getConfig('language');\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Core</mat-card-subtitle>\r\n  <mat-card-title>config</mat-card-title>\r\n  <mat-card-content>\r\n    <p>Load config in your angular application</p>\r\n\r\n    <li>Import <code>IgoConfigModule</code> only once</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/config\"> code of this example</a> <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <p>Config language: {{configLanguage | json }}<p>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\r\n\r\nimport { environment } from '../../../environments/environment';\r\nimport { AppConfigComponent } from './config.component';\r\nimport { AppConfigRoutingModule } from './config-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppConfigComponent],\r\n  imports: [\r\n    AppConfigRoutingModule,\r\n    CommonModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoConfigModule.forRoot()\r\n  ],\r\n  exports: [AppConfigComponent],\r\n  providers: [\r\n    provideConfigOptions({\r\n      default: environment.igo\r\n    })\r\n  ]\r\n})\r\nexport class AppConfigModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppLanguageComponent } from './language.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'language',\r\n    component: AppLanguageComponent\r\n  }\r\n];\r\n\r\nexport const AppLanguageRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-language',\r\n  templateUrl: './language.component.html',\r\n  styleUrls: ['./language.component.scss']\r\n})\r\nexport class AppLanguageComponent {\r\n  public app = {\r\n    title: 'IGO'\r\n  };\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  changeLanguage(language: string) {\r\n    this.languageService.setLanguage(language);\r\n    console.log(this.languageService);\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Core</mat-card-subtitle>\r\n  <mat-card-title>language</mat-card-title>\r\n  <mat-card-content>\r\n    <p>Translate your angular application</p>\r\n\r\n    <li>Import <code>IgoLanguageModule</code> only once</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/language\">code of this example</a><br>\r\n    See language section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a><br>\r\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale\">locale files</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <mat-card-actions>\r\n    <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\r\n    <button mat-raised-button (click)=\"changeLanguage('fr')\">Franais</button>\r\n  </mat-card-actions>\r\n\r\n  <p>{{'welcome' | translate: app}}<p>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { AppLanguageComponent } from './language.component';\r\nimport { AppLanguageRoutingModule } from './language-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppLanguageComponent],\r\n  imports: [\r\n    AppLanguageRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule.forRoot()\r\n  ],\r\n  exports: [AppLanguageComponent]\r\n})\r\nexport class AppLanguageModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppMediaComponent } from './media.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'media',\r\n    component: AppMediaComponent\r\n  }\r\n];\r\n\r\nexport const AppMediaRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { MediaService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-media',\r\n  templateUrl: './media.component.html',\r\n  styleUrls: ['./media.component.scss']\r\n})\r\nexport class AppMediaComponent {\r\n  constructor(private mediaService: MediaService) {}\r\n\r\n  get media() {\r\n    return this.mediaService.getMedia();\r\n  }\r\n\r\n  get orientation() {\r\n    return this.mediaService.getOrientation();\r\n  }\r\n\r\n  get isTouchScreen() {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Core</mat-card-subtitle>\r\n  <mat-card-title>Media</mat-card-title>\r\n  <mat-card-content>\r\n    <p>Detect type of media (mobile, tablet, desktop)</p>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/media\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <p>Current media: {{media}}</p>\r\n  <p>Current orientation: {{orientation}}</p>\r\n  <p>Device mode:  {{isTouchScreen ? 'Touch device' : 'Not a touch device '}}</p>\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { AppMediaComponent } from './media.component';\r\nimport { AppMediaRoutingModule } from './media-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppMediaComponent],\r\n  imports: [AppMediaRoutingModule, MatCardModule],\r\n  exports: [AppMediaComponent]\r\n})\r\nexport class AppMediaModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppMessageComponent } from './message.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'message',\r\n    component: AppMessageComponent\r\n  }\r\n];\r\n\r\nexport const AppMessageRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { MessageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-message',\r\n  templateUrl: './message.component.html',\r\n  styleUrls: ['./message.component.scss']\r\n})\r\nexport class AppMessageComponent {\r\n  constructor(private messageService: MessageService) {}\r\n\r\n  success() {\r\n    this.messageService.success('Congratulations', 'Success');\r\n  }\r\n\r\n  info() {\r\n    this.messageService.info('Welcome to IGO', 'Info');\r\n  }\r\n\r\n  alert() {\r\n    this.messageService.alert('Warning', 'Alert');\r\n  }\r\n  error() {\r\n    this.messageService.error('There is a bug', 'Error');\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Core</mat-card-subtitle>\r\n  <mat-card-title>Message</mat-card-title>\r\n  <mat-card-content>\r\n    <p>Show message to user.</p>\r\n\r\n    <li>Import <code>IgoMessageModule</code> only once</li>\r\n    <li>Dependencies: BrowserAnimationsModule </li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/message\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <mat-card-actions>\r\n    <button mat-raised-button (click)=\"success()\">Success message</button>\r\n    <button mat-raised-button color='primary' (click)=\"info()\">Info message</button>\r\n    <button mat-raised-button color='accent' (click)=\"alert()\">Alert message</button>\r\n    <button mat-raised-button color='warn' (click)=\"error()\">Error message</button>\r\n  </mat-card-actions>\r\n</mat-card>\r\n\r\n<igo-message-center></igo-message-center>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\n\r\nimport { AppMessageComponent } from './message.component';\r\nimport { AppMessageRoutingModule } from './message-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppMessageComponent],\r\n  imports: [\r\n    AppMessageRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoMessageModule.forRoot()\r\n  ],\r\n  exports: [AppMessageComponent]\r\n})\r\nexport class AppMessageModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppRequestComponent } from './request.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'request',\r\n    component: AppRequestComponent\r\n  }\r\n];\r\n\r\nexport const AppRequestRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-request',\r\n  templateUrl: './request.component.html',\r\n  styleUrls: ['./request.component.scss']\r\n})\r\nexport class AppRequestComponent {\r\n  constructor(\r\n    private http: HttpClient,\r\n    public languageService: LanguageService\r\n  ) {}\r\n\r\n  callHttp() {\r\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\r\n    this.http.get(url).subscribe(rep => {\r\n      console.log(rep);\r\n    });\r\n  }\r\n\r\n  callHttpError() {\r\n    const url = '404';\r\n    this.http.get(url).subscribe(rep => {\r\n      console.log(rep);\r\n    });\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Core</mat-card-subtitle>\r\n  <mat-card-title>Request</mat-card-title>\r\n  <mat-card-content>\r\n    <p>Register http calls in console</p>\r\n\r\n    <li>Import <code>IgoLoggingModule</code> only if you want register http calls in console</li>\r\n    <li>Import <code>IgoErrorModule</code> only if you want register errors from http call in console</li>\r\n    <li>Import modules only once</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/request\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <mat-card-actions>\r\n    <button mat-raised-button (click)=\"callHttp()\">Log</button>\r\n    <button mat-raised-button (click)=\"callHttpError()\">Error</button>\r\n  </mat-card-actions>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoErrorModule, IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { AppRequestComponent } from './request.component';\r\nimport { AppRequestRoutingModule } from './request-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppRequestComponent],\r\n  imports: [\r\n    AppRequestRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    HttpClientModule,\r\n    IgoLanguageModule.forRoot(),\r\n    IgoErrorModule.forRoot() // Only if you want register errors from http call in console\r\n    // IgoLoggingModule.forRoot() // Only if you want register http calls in console\r\n  ],\r\n  exports: [AppRequestComponent]\r\n})\r\nexport class AppRequestModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Common</mat-card-subtitle>\r\n  <mat-card-title>Action</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/action\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-actionbar\r\n    [store]=\"store\"\r\n    [withIcon]=\"true\"\r\n    [withTitle]=\"actionbarMode === 'overlay'\"\r\n    [horizontal]=\"true\"\r\n    [mode]=\"actionbarMode\">\r\n  </igo-actionbar>\r\n\r\n</mat-card>\r\n<p></p>\r\n\r\n<mat-card [igoContextMenu]= actionbarMenu>\r\n  <mat-card-subtitle>Common</mat-card-subtitle>\r\n  <mat-card-title>Action context-menu</mat-card-title>\r\n  <div></div>\r\n</mat-card>\r\n\r\n\r\n\r\n<ng-template #actionbarMenu>\r\n  <igo-actionbar\r\n    [store]=\"store\"\r\n    [withIcon]=\"true\"\r\n    [horizontal]=\"true\"\r\n    [mode]=\"'context'\">\r\n  </igo-actionbar>\r\n</ng-template>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppActionComponent } from './action.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'action',\r\n    component: AppActionComponent\r\n  }\r\n];\r\n\r\nexport const AppActionRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport {\r\n  Media,\r\n  MediaOrientation,\r\n  MediaService,\r\n  LanguageService\r\n} from '@igo2/core';\r\nimport { ActionStore, ActionbarMode } from '@igo2/common';\r\nimport { Overlay } from '@angular/cdk/overlay';\r\n\r\n@Component({\r\n  selector: 'app-action',\r\n  templateUrl: './action.component.html',\r\n  styleUrls: ['./action.component.scss']\r\n})\r\nexport class AppActionComponent implements OnInit, OnDestroy {\r\n  public store = new ActionStore([]);\r\n\r\n  private added$ = new BehaviorSubject(false);\r\n\r\n  get actionbarMode(): ActionbarMode {\r\n    const media = this.mediaService.media$.value;\r\n    const orientation = this.mediaService.orientation$.value;\r\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\r\n      return ActionbarMode.Dock;\r\n    }\r\n    return ActionbarMode.Overlay;\r\n  }\r\n\r\n  constructor(\r\n    public overlay: Overlay,\r\n    private mediaService: MediaService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.store.load([\r\n      {\r\n        id: 'add',\r\n        title: 'Add',\r\n        icon: 'plus',\r\n        tooltip: 'Add Tooltip',\r\n        handler: () => {\r\n          alert('Add!');\r\n          this.added$.next(true);\r\n        }\r\n      },\r\n      {\r\n        id: 'edit',\r\n        title: 'Edit',\r\n        icon: 'pencil',\r\n        tooltip: 'Edit Tooltip',\r\n        args: ['1'],\r\n        handler: (item: string) => {\r\n          alert(`Edit item ${item}!`);\r\n        },\r\n        availability: () => this.added$\r\n      },\r\n      {\r\n        id: 'delete',\r\n        title: 'Delete',\r\n        tooltip: 'Delete Tooltip',\r\n        icon: 'delete',\r\n        handler: () => {\r\n          alert('Delete!');\r\n          this.added$.next(false);\r\n        },\r\n        availability: () => this.added$\r\n      }\r\n    ]);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoActionModule, IgoContextMenuModule } from '@igo2/common';\r\n\r\nimport { AppActionComponent } from './action.component';\r\nimport { AppActionRoutingModule } from './action-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppActionComponent],\r\n  imports: [\r\n    AppActionRoutingModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    IgoActionModule,\r\n    IgoContextMenuModule\r\n  ],\r\n  exports: [AppActionComponent]\r\n})\r\nexport class AppActionModule {}\r\n","import { Component, Input, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\r\n\r\nimport { OnUpdateInputs } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-salutation-component',\r\n  template: '<p>Hello, my name is {{name}}.</p>',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSalutationComponent implements OnUpdateInputs {\r\n\r\n  @Input() name: string;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n}\r\n\r\n@Component({\r\n  selector: 'app-explanation-component',\r\n  template: '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppExplanationComponent implements OnUpdateInputs {\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n}\r\n\r\n@Component({\r\n  selector: 'app-dynamic-component',\r\n  templateUrl: './dynamic-component.component.html',\r\n  styleUrls: ['./dynamic-component.component.scss']\r\n})\r\nexport class AppDynamicComponentComponent {\r\n\r\n  component: any = AppSalutationComponent;\r\n\r\n  inputs = {name: 'Bob'};\r\n\r\n  toggleComponent() {\r\n    this.component = this.component === AppSalutationComponent ?\r\n      AppExplanationComponent :\r\n      AppSalutationComponent;\r\n  }\r\n\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppDynamicComponentComponent } from './dynamic-component.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'dynamic-component',\r\n    component: AppDynamicComponentComponent\r\n  }\r\n];\r\n\r\nexport const AppDynamicComponentRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","<mat-card>\r\n  <mat-card-subtitle>Common</mat-card-subtitle>\r\n  <mat-card-title>Dynamic Component</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/dynamic-component\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-dynamic-outlet\r\n    [component]=\"component\"\r\n    [inputs]=\"inputs\">\r\n  </igo-dynamic-outlet>\r\n\r\n  <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">Toggle Component</button>\r\n</mat-card>\r\n\r\n\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoDynamicComponentModule } from '@igo2/common';\r\n\r\nimport {\r\n  AppSalutationComponent,\r\n  AppExplanationComponent,\r\n  AppDynamicComponentComponent\r\n} from './dynamic-component.component';\r\nimport { AppDynamicComponentRoutingModule } from './dynamic-component-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppSalutationComponent,\r\n    AppDynamicComponentComponent,\r\n    AppExplanationComponent\r\n  ],\r\n  imports: [\r\n    AppDynamicComponentRoutingModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    IgoDynamicComponentModule\r\n  ],\r\n  exports: [AppDynamicComponentComponent],\r\n  entryComponents: [\r\n    AppSalutationComponent,\r\n    AppExplanationComponent\r\n  ]\r\n})\r\nexport class AppDynamicComponentModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppEntityTableComponent } from './entity-table.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'entity-table',\r\n    component: AppEntityTableComponent\r\n  }\r\n];\r\n\r\nexport const AppEntityTableRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  EntityStore,\r\n  EntityTableButton,\r\n  getEntityProperty,\r\n  EntityTableColumnRenderer,\r\n  EntityTablePaginatorOptions\r\n} from '@igo2/common';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-entity-table',\r\n  templateUrl: './entity-table.component.html',\r\n  styleUrls: ['./entity-table.component.scss']\r\n})\r\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\r\n  public store = new EntityStore([]);\r\n  public paginator: MatPaginator;\r\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public paginatorOptions: EntityTablePaginatorOptions = {pageSize: 10};\r\n\r\n  public template = {\r\n    selection: true,\r\n    selectionCheckbox: true,\r\n    selectMany: true,\r\n    sort: true,\r\n    valueAccessor: (entity: object, name: string) => {\r\n      return getEntityProperty(entity, name);\r\n    },\r\n    columns: [\r\n      {\r\n        name: 'selected',\r\n        title: 'Selected',\r\n        valueAccessor: (entity: object) => {\r\n          return this.store.state.get(entity).selected\r\n            ? 'radiobox-marked'\r\n            : 'radiobox-blank';\r\n        },\r\n        renderer: EntityTableColumnRenderer.Icon\r\n      },\r\n      {\r\n        name: 'id',\r\n        title: 'ID'\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name'\r\n      },\r\n      {\r\n        name: 'description',\r\n        title: 'Description',\r\n        renderer: EntityTableColumnRenderer.HTML\r\n      },\r\n      {\r\n        name: 'url',\r\n        title: 'Hyperlink'\r\n      },\r\n      {\r\n        name: 'image',\r\n        title: 'Image'\r\n      },\r\n      {\r\n        name: 'action',\r\n        title: '',\r\n        valueAccessor: (entity: object) => {\r\n          return [{\r\n            icon: 'home',\r\n            color: 'warn',\r\n            click: (row) => { console.log(row); }\r\n          }] as EntityTableButton[];\r\n        },\r\n        renderer: EntityTableColumnRenderer.ButtonGroup\r\n      }\r\n    ]\r\n  };\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    const ids = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\r\n\r\n    const entities = ids.map(id => {\r\n      return { id , name: `Name ${id}`, description: `<b>Description ${id}</b>`, url: 'https://igouverte.org', image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'};\r\n    });\r\n    this.store.load(entities);\r\n  }\r\n\r\n  entitySortChange() {\r\n    this.entitySortChange$.next(true);\r\n  }\r\n\r\n  paginatorChange(event: MatPaginator) {\r\n    this.paginator = event;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Common</mat-card-subtitle>\r\n  <mat-card-title>Entity Table</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-table\">code of this example</a>\r\n  </mat-card-content>\r\n  <igo-entity-table\r\n    [store]=\"store\"\r\n    [withPaginator]=\"true\"\r\n    [paginatorOptions]=\"paginatorOptions\"\r\n    [template]=\"template\"\r\n    (entitySortChange)=\"entitySortChange()\">\r\n  </igo-entity-table>\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoEntityTableModule, IgoEntityTablePaginatorModule } from '@igo2/common';\r\n\r\nimport { AppEntityTableComponent } from './entity-table.component';\r\nimport { AppEntityTableRoutingModule } from './entity-table-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppEntityTableComponent],\r\n  imports: [\r\n    AppEntityTableRoutingModule,\r\n    MatCardModule,\r\n    IgoEntityTableModule,\r\n    IgoEntityTablePaginatorModule\r\n  ],\r\n  exports: [AppEntityTableComponent]\r\n})\r\nexport class AppEntityTableModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Common</mat-card-subtitle>\r\n  <mat-card-title>Entity Selector</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-selector\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-entity-selector\r\n    [store]=\"store\"\r\n    [titleAccessor]=\"getTitle\"\r\n    [emptyText]=\"''\"\r\n    [placeholder]=\"'Select an entity'\"\r\n    (selectedChange)=\"onSelectedChange($event)\">\r\n  </igo-entity-selector>\r\n\r\n  <div *ngIf=\"selected$ | async as selected\">\r\n    <p>ID: {{selected.id}}</p>\r\n    <p>Name: {{selected.name}}</p>\r\n    <p>Description: <span [innerHtml]=\"selected.description\"></span></p>\r\n  </div>\r\n</mat-card>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppEntitySelectorComponent } from './entity-selector.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'entity-selector',\r\n    component: AppEntitySelectorComponent\r\n  }\r\n];\r\n\r\nexport const AppEntitySelectorRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { EntityStore } from '@igo2/common';\r\n\r\ninterface DemoEntity {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-entity-selector',\r\n  templateUrl: './entity-selector.component.html',\r\n  styleUrls: ['./entity-selector.component.scss']\r\n})\r\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\r\n\r\n  public store = new EntityStore([]);\r\n\r\n  public selected$ = new BehaviorSubject<DemoEntity>(undefined);\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    this.store.load([\r\n      {id: '2', name: 'Name 2', description: '<b>Description 2</b>'},\r\n      {id: '1', name: 'Name 1', description: '<b>Description 1</b>'},\r\n      {id: '3', name: 'Name 3', description: '<b>Description 3</b>'}\r\n    ]);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  getTitle(entity: DemoEntity): string {\r\n    return entity.name;\r\n  }\r\n\r\n  onSelectedChange(event: {selected: boolean; entity: DemoEntity}) {\r\n    this.selected$.next(event.entity);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoEntitySelectorModule } from '@igo2/common';\r\n\r\nimport { AppEntitySelectorComponent } from './entity-selector.component';\r\nimport { AppEntitySelectorRoutingModule } from './entity-selector-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppEntitySelectorComponent],\r\n  imports: [\r\n    CommonModule,\r\n    AppEntitySelectorRoutingModule,\r\n    MatCardModule,\r\n    IgoEntitySelectorModule\r\n  ],\r\n  exports: [AppEntitySelectorComponent]\r\n})\r\nexport class AppEntitySelectorModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Common</mat-card-subtitle>\r\n  <mat-card-title>Form</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-form\r\n    *ngIf=\"form$ | async as form\"\r\n    [form]=\"form\"\r\n    [formData]=\"data$ | async\"\r\n    (submitForm)=\"onSubmit($event)\">\r\n\r\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\r\n\r\n    <div formButtons>\r\n      <button\r\n        mat-stroked-button\r\n        type=\"button\"\r\n        color=\"primary\"\r\n        (click)=\"fillForm()\">\r\n        Fill Form\r\n      </button>\r\n      <button\r\n        mat-stroked-button\r\n        type=\"button\"\r\n        color=\"primary\"\r\n        (click)=\"clearForm()\">\r\n        Clear Form\r\n      </button>\r\n      <button\r\n        mat-flat-button\r\n        type=\"submit\"\r\n        color=\"primary\"\r\n        [disabled]=\"submitDisabled\">\r\n        Submit\r\n      </button>\r\n    </div>\r\n  </igo-form>\r\n</mat-card>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppFormComponent } from './form.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'form',\r\n    component: AppFormComponent\r\n  }\r\n];\r\n\r\nexport const AppFormRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { Validators } from '@angular/forms';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { Form, FormService } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-form',\r\n  templateUrl: './form.component.html',\r\n  styleUrls: ['./form.component.scss']\r\n})\r\nexport class AppFormComponent implements OnInit, OnDestroy {\r\n\r\n  form$ = new BehaviorSubject<Form>(undefined);\r\n\r\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\r\n\r\n  submitDisabled = true;\r\n\r\n  private valueChanges$$: Subscription;\r\n\r\n  constructor(\r\n    private formService: FormService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    const fieldConfigs = [\r\n      {\r\n        name: 'id',\r\n        title: 'ID',\r\n        options: {\r\n          cols: 1,\r\n          validator: Validators.required\r\n        }\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name',\r\n        options: {\r\n          cols: 1,\r\n          validator: Validators.required\r\n        }\r\n      },\r\n      {\r\n        name: 'status',\r\n        title: 'Status',\r\n        type: 'select',\r\n        options: {\r\n          cols: 2\r\n        },\r\n        inputs: {\r\n          choices: [\r\n            {value: 1, title: 'Single'},\r\n            {value: 2, title: 'Married'}\r\n          ]\r\n        }\r\n      }\r\n    ];\r\n\r\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\r\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\r\n\r\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\r\n      this.submitDisabled = !form.control.valid;\r\n    });\r\n\r\n    this.form$.next(form);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.valueChanges$$.unsubscribe();\r\n  }\r\n\r\n  fillForm() {\r\n    this.data$.next({\r\n      id: 1,\r\n      name: 'Bob',\r\n      status: 2\r\n    });\r\n  }\r\n\r\n  clearForm() {\r\n    this.form$.value.control.reset();\r\n  }\r\n\r\n  onSubmit(data: {[key: string]: any}) {\r\n    alert(JSON.stringify(data));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoFormModule } from '@igo2/common';\r\n\r\nimport { AppFormComponent } from './form.component';\r\nimport { AppFormRoutingModule } from './form-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppFormComponent],\r\n  imports: [\r\n    CommonModule,\r\n    AppFormRoutingModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    IgoFormModule\r\n  ],\r\n  exports: [AppFormComponent]\r\n})\r\nexport class AppFormModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppTableComponent } from './table.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'table',\r\n    component: AppTableComponent\r\n  }\r\n];\r\n\r\nexport const AppTableRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { TableDatabase, TableActionColor } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-table',\r\n  templateUrl: './table.component.html',\r\n  styleUrls: ['./table.component.scss']\r\n})\r\nexport class AppTableComponent implements OnInit {\r\n  public database: TableDatabase;\r\n\r\n  public model = {\r\n    columns: [\r\n      {\r\n        name: 'id',\r\n        title: 'ID',\r\n        sortable: false,\r\n        filterable: true\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name',\r\n        sortable: true,\r\n        filterable: true\r\n      },\r\n      {\r\n        name: 'description',\r\n        title: 'Description',\r\n        sortable: true,\r\n        filterable: true\r\n      }\r\n    ],\r\n    actions: [\r\n      {\r\n        icon: 'file-document',\r\n        color: TableActionColor.primary,\r\n        click: row => this.showName(row.name)\r\n      }\r\n    ],\r\n    selectionCheckbox: true\r\n  };\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    this.database = new TableDatabase([\r\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\r\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\r\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\r\n    ]);\r\n  }\r\n\r\n  showName(name) {\r\n    alert(name);\r\n  }\r\n\r\n  handleSelect(rows) {\r\n    console.log(rows);\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Common</mat-card-subtitle>\r\n  <mat-card-title>Table</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/table\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-table\r\n    [database]=\"database\"\r\n    [model]=\"model\"\r\n    [hasFilterInput]=\"true\"\r\n    (select)=\"handleSelect($event)\">\r\n  </igo-table>\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoTableModule } from '@igo2/common';\r\n\r\nimport { AppTableComponent } from './table.component';\r\nimport { AppTableRoutingModule } from './table-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppTableComponent],\r\n  imports: [\r\n    AppTableRoutingModule,\r\n    MatCardModule,\r\n    IgoTableModule\r\n  ],\r\n  exports: [AppTableComponent]\r\n})\r\nexport class AppTableModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Common</mat-card-subtitle>\r\n  <mat-card-title>Tool</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/tool\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-panel [title]=\"panelTitle\">\r\n    <button\r\n      mat-icon-button\r\n      panelLeftButton\r\n      (click)=\"toolbox.activatePreviousTool()\"\r\n      *ngIf=\"activeTool$ | async\">\r\n      <mat-icon svgIcon=\"arrow-back\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      panelRightButton\r\n      (click)=\"toolbox.deactivateTool()\"\r\n      *ngIf=\"activeTool$ | async\">\r\n      <mat-icon svgIcon=\"menu\"></mat-icon>\r\n    </button>\r\n\r\n    <igo-toolbox [toolbox]=\"toolbox\" [animate]=\"true\"></igo-toolbox>\r\n  </igo-panel>\r\n\r\n  <button\r\n    mat-flat-button\r\n    type=\"button\"\r\n    color=\"primary\"\r\n    (click)=\"activateSalutationTool()\">\r\n    Activate Salutation Tool\r\n  </button>\r\n\r\n</mat-card>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  OnDestroy,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  OnUpdateInputs,\r\n  Tool,\r\n  Toolbox,\r\n  ToolComponent,\r\n  ToolService\r\n} from '@igo2/common';\r\n\r\n@ToolComponent({\r\n  name: 'demo-salutation',\r\n  title: 'Salutation',\r\n  icon: 'account',\r\n  options: {name: 'Jack'}\r\n})\r\n@Component({\r\n  selector: 'app-salutation-tool',\r\n  template: `\r\n    <p>Hello, my name is {{name}}.</p>\r\n  `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSalutationToolComponent implements OnUpdateInputs {\r\n\r\n  @Input() name: string;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n}\r\n\r\n@ToolComponent({\r\n  name: 'demo-about',\r\n  title: 'About',\r\n  icon: 'information'\r\n})\r\n@Component({\r\n  selector: 'app-about-tool',\r\n  template: `\r\n    <p>I'm a tool inside a toolbox.</p>\r\n  `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppAboutToolComponent {}\r\n\r\n@Component({\r\n  selector: 'app-tool',\r\n  templateUrl: './tool.component.html',\r\n  styleUrls: ['./tool.component.scss']\r\n})\r\nexport class AppToolComponent implements OnInit, OnDestroy {\r\n\r\n  toolbox = new Toolbox();\r\n\r\n  get activeTool$(): BehaviorSubject<Tool> {\r\n    return this.toolbox.activeTool$;\r\n  }\r\n\r\n  get panelTitle(): string {\r\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\r\n  }\r\n\r\n  constructor(\r\n    private toolService: ToolService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\r\n    this.toolbox.setTools(this.toolService.getTools());\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.toolbox.destroy();\r\n  }\r\n\r\n  activateSalutationTool() {\r\n    this.toolbox.activateTool('demo-salutation', {name: 'Bob'});\r\n  }\r\n\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppToolComponent } from './tool.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'tool',\r\n    component: AppToolComponent\r\n  }\r\n];\r\n\r\nexport const AppToolRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoPanelModule, IgoToolModule } from '@igo2/common';\r\n\r\nimport {\r\n  AppToolComponent,\r\n  AppSalutationToolComponent,\r\n  AppAboutToolComponent\r\n} from './tool.component';\r\nimport { AppToolRoutingModule } from './tool-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppToolComponent,\r\n    AppSalutationToolComponent,\r\n    AppAboutToolComponent\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    AppToolRoutingModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatCardModule,\r\n    IgoLanguageModule,\r\n    IgoPanelModule,\r\n    IgoToolModule.forRoot()\r\n  ],\r\n  exports: [AppToolComponent],\r\n  entryComponents: [\r\n    AppSalutationToolComponent,\r\n    AppAboutToolComponent\r\n  ]\r\n})\r\nexport class AppToolModule {}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { DynamicComponent, OnUpdateInputs, WidgetComponent, WidgetService } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-salutation-widget',\r\n  template: `\r\n    <p>Hello, my name is {{name}}.</p>\r\n    <button mat-flat-button (click)=\"complete.emit(name)\">Nice to meet you</button>\r\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\r\n  `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSalutationWidgetComponent implements OnUpdateInputs, WidgetComponent {\r\n\r\n  @Input() name: string;\r\n\r\n  @Output() complete = new EventEmitter<string>();\r\n\r\n  @Output() cancel = new EventEmitter<string>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n}\r\n\r\n@Component({\r\n  selector: 'app-widget',\r\n  templateUrl: './widget.component.html',\r\n  styleUrls: ['./widget.component.scss']\r\n})\r\nexport class AppWidgetComponent {\r\n\r\n  widget: DynamicComponent<WidgetComponent> = this.widgetService.create(AppSalutationWidgetComponent);\r\n\r\n  inputs = {name: 'Bob'};\r\n\r\n  constructor(private widgetService: WidgetService) {}\r\n\r\n  onWidgetComplete(name: string) {\r\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\r\n  }\r\n\r\n  onWidgetCancel() {\r\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\r\n  }\r\n\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppWidgetComponent } from './widget.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'widget',\r\n    component: AppWidgetComponent\r\n  }\r\n];\r\n\r\nexport const AppWidgetRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","<mat-card>\r\n  <mat-card-subtitle>Common</mat-card-subtitle>\r\n  <mat-card-title>Widget</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/widget\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-widget-outlet\r\n    [widget]=\"widget\"\r\n    [inputs]=\"inputs\"\r\n    (complete)=\"onWidgetComplete($event)\"\r\n    (cancel)=\"onWidgetCancel()\">\r\n  </igo-widget-outlet>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoWidgetModule } from '@igo2/common';\r\n\r\nimport {\r\n  AppSalutationWidgetComponent,\r\n  AppWidgetComponent\r\n} from './widget.component';\r\nimport { AppWidgetRoutingModule } from './widget-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppSalutationWidgetComponent,\r\n    AppWidgetComponent\r\n  ],\r\n  imports: [\r\n    AppWidgetRoutingModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    IgoWidgetModule\r\n  ],\r\n  exports: [AppWidgetComponent],\r\n  entryComponents: [\r\n    AppSalutationWidgetComponent\r\n  ]\r\n})\r\nexport class AppWidgetModule {}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport jwtDecode from 'jwt-decode';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { AuthOptions } from './auth.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TokenService {\r\n  private options: AuthOptions;\r\n\r\n  constructor(private injector: Injector) {}\r\n\r\n  set(token: string) {\r\n    localStorage.setItem(this.tokenKey, token);\r\n  }\r\n\r\n  remove() {\r\n    localStorage.removeItem(this.tokenKey);\r\n  }\r\n\r\n  get(): string {\r\n    return localStorage.getItem(this.tokenKey);\r\n  }\r\n\r\n  decode() {\r\n    const token = this.get();\r\n    if (!token) {\r\n      return;\r\n    }\r\n    return jwtDecode(token);\r\n  }\r\n\r\n  isExpired() {\r\n    const jwt = this.decode();\r\n    const currentTime = new Date().getTime() / 1000;\r\n    if (jwt && currentTime < jwt.exp) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private get tokenKey() {\r\n    const config = this.injector.get<ConfigService>(ConfigService);\r\n    this.options = config.getConfig('auth') || {};\r\n    return this.options.tokenKey;\r\n  }\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Router } from '@angular/router';\r\n\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\nimport { tap, catchError } from 'rxjs/operators';\r\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\r\n\r\nimport { ConfigService, LanguageService, MessageService } from '@igo2/core';\r\nimport { Base64 } from '@igo2/utils';\r\n\r\nimport { User, IInfosUser } from './auth.interface';\r\nimport { TokenService } from './token.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\r\n  public logged$ = new BehaviorSubject<boolean>(undefined);\r\n  public redirectUrl: string;\r\n  private anonymous = false;\r\n\r\n  get hasAuthService() {\r\n    return this.config.getConfig('auth.url') !== undefined;\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private tokenService: TokenService,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    @Optional() private router: Router\r\n  ) {\r\n    this.authenticate$.next(this.authenticated);\r\n    this.authenticate$.subscribe((authenticated) => {\r\n      this.logged$.next(authenticated);\r\n      globalCacheBusterNotifier.next();\r\n    });\r\n  }\r\n\r\n  login(username: string, password: string): Observable<void> {\r\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n\r\n    const body = {\r\n      username,\r\n      password: this.encodePassword(password)\r\n    };\r\n\r\n    return this.loginCall(body, myHeader);\r\n  }\r\n\r\n  loginWithToken(token: string, type: string, infosUser?: IInfosUser): Observable<void> {\r\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n\r\n    const body = {\r\n      token,\r\n      typeConnection: type,\r\n      infosUser\r\n    };\r\n\r\n    return this.loginCall(body, myHeader);\r\n  }\r\n\r\n  loginAnonymous(): Observable<boolean> {\r\n    this.anonymous = true;\r\n    this.logged$.next(true);\r\n    return of(true);\r\n  }\r\n\r\n  refresh(): Observable<void> {\r\n    const url = this.config.getConfig('auth.url');\r\n    return this.http.post(`${url}/refresh`, {}).pipe(\r\n      tap((data: any) => {\r\n        this.tokenService.set(data.token);\r\n      }),\r\n      catchError((err) => {\r\n        err.error.caught = true;\r\n        throw err;\r\n      })\r\n    );\r\n  }\r\n\r\n  logout(): Observable<boolean> {\r\n    this.anonymous = false;\r\n    this.tokenService.remove();\r\n    this.authenticate$.next(false);\r\n    return of(true);\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return !this.tokenService.isExpired();\r\n  }\r\n\r\n  getToken(): string {\r\n    return this.tokenService.get();\r\n  }\r\n\r\n  decodeToken() {\r\n    if (this.isAuthenticated()) {\r\n      return this.tokenService.decode();\r\n    }\r\n    return false;\r\n  }\r\n\r\n  goToRedirectUrl() {\r\n    if (!this.router) {\r\n      return;\r\n    }\r\n    const redirectUrl = this.redirectUrl || this.router.url;\r\n\r\n    const options = this.config.getConfig('auth') || {};\r\n    if (redirectUrl === options.loginRoute) {\r\n      const homeRoute = options.homeRoute || '/';\r\n      this.router.navigateByUrl(homeRoute);\r\n    } else if (redirectUrl) {\r\n      this.router.navigateByUrl(redirectUrl);\r\n    }\r\n  }\r\n\r\n  getUserInfo(): Observable<User> {\r\n    const url = this.config.getConfig('auth.url') + '/info';\r\n    return this.http.get<User>(url);\r\n  }\r\n\r\n  getProfils(): Observable<{ profils: string[] }> {\r\n    const url = this.config.getConfig('auth.url');\r\n    return this.http.get<{ profils: string[] }>(`${url}/profils`);\r\n  }\r\n\r\n  updateUser(user: User): Observable<User> {\r\n    const url = this.config.getConfig('auth.url');\r\n    return this.http.patch<User>(url, user);\r\n  }\r\n\r\n  private encodePassword(password: string) {\r\n    return Base64.encode(password);\r\n  }\r\n\r\n  // authenticated or anonymous\r\n  get logged(): boolean {\r\n    return this.authenticated || this.isAnonymous;\r\n  }\r\n\r\n  get isAnonymous(): boolean {\r\n    return this.anonymous;\r\n  }\r\n\r\n  get authenticated(): boolean {\r\n    return this.isAuthenticated();\r\n  }\r\n\r\n  get isAdmin(): boolean {\r\n    const token = this.decodeToken();\r\n    if (token && token.user && token.user.isAdmin) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private loginCall(body, headers) {\r\n    const url = this.config.getConfig('auth.url');\r\n    return this.http.post(`${url}/login`, body, { headers }).pipe(\r\n      tap((data: any) => {\r\n        this.tokenService.set(data.token);\r\n        const tokenDecoded = this.decodeToken();\r\n        if (tokenDecoded && tokenDecoded.user) {\r\n          if (tokenDecoded.user.locale) {\r\n            this.languageService.setLanguage(tokenDecoded.user.locale);\r\n          }\r\n          if (tokenDecoded.user.isExpired) {\r\n            this.languageService.translate\r\n              .get('igo.auth.error.Password expired')\r\n              .subscribe((expiredAlert) =>\r\n                this.messageService.alert(expiredAlert)\r\n              );\r\n          }\r\n        }\r\n        this.authenticate$.next(true);\r\n      }),\r\n      catchError((err) => {\r\n        err.error.caught = true;\r\n        throw err;\r\n      })\r\n    );\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  ApplicationRef,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\n\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\nimport { AuthGoogleOptions } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-google',\r\n  templateUrl: './auth-google.component.html',\r\n  styleUrls: ['./auth-google.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthGoogleComponent {\r\n  private options: AuthGoogleOptions;\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private appRef: ApplicationRef\r\n  ) {\r\n    this.options = this.config.getConfig('auth.google') || {};\r\n\r\n    if (this.options.apiKey && this.options.clientId) {\r\n      this.loadSDKGoogle();\r\n      this.loadPlatform();\r\n    } else {\r\n      console.warn('Google authentification needs \"apiKey\" and \"clientId\" options');\r\n    }\r\n  }\r\n\r\n  public handleSignInClick() {\r\n    (window as any).gapi.auth2.getAuthInstance().signIn();\r\n  }\r\n\r\n  public handleSignOutClick() {\r\n    (window as any).gapi.auth2.getAuthInstance().signOut();\r\n  }\r\n\r\n  private handleClientLoad() {\r\n    (window as any).gapi.load('client:auth2', () => this.initClient());\r\n  }\r\n\r\n  private initClient() {\r\n    (window as any).gapi.client\r\n      .init({\r\n        apiKey: this.options.apiKey,\r\n        clientId: this.options.clientId,\r\n        discoveryDocs: [\r\n          'https://people.googleapis.com/$discovery/rest?version=v1'\r\n        ],\r\n        scope: 'profile'\r\n      })\r\n      .then(() => {\r\n        this.handleSignOutClick();\r\n        this.updateTextButton();\r\n        (window as any).gapi.auth2.getAuthInstance().isSignedIn.listen(rep => {\r\n          this.updateSigninStatus(rep);\r\n        });\r\n      });\r\n  }\r\n\r\n  private updateSigninStatus(isSignedIn) {\r\n    this.updateTextButton();\r\n    if (isSignedIn) {\r\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\r\n    }\r\n  }\r\n\r\n  private updateTextButton() {\r\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\r\n    if (btn && this.languageService.getLanguage() !== 'en') {\r\n      if (btn.innerHTML === 'Sign in with Google') {\r\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.login');\r\n      } else if (btn.innerHTML === 'Signed in with Google') {\r\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.logged');\r\n      }\r\n    }\r\n  }\r\n\r\n  private loginGoogle(token) {\r\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\r\n      this.appRef.tick();\r\n      this.login.emit(true);\r\n    });\r\n  }\r\n\r\n  private loadSDKGoogle() {\r\n    const fjs = document.getElementsByTagName('script')[0];\r\n    const js = document.createElement('script');\r\n    js.id = 'google-jssdk';\r\n    js.src = 'https://apis.google.com/js/api.js';\r\n    js.onload = () => {\r\n      this.handleClientLoad();\r\n    };\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n  }\r\n\r\n  private loadPlatform() {\r\n    const fjs = document.getElementsByTagName('script')[0];\r\n    const js = document.createElement('script');\r\n    js.id = 'google-platform';\r\n    js.src = 'https://apis.google.com/js/platform.js';\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n  }\r\n}\r\n","<div class=\"g-signin2 google-login-button\" data-height=\"40\" data-width=\"265\" data-longtitle=\"true\">\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  ApplicationRef,\r\n  Output,\r\n  EventEmitter,\r\n  Inject\r\n} from '@angular/core';\r\nimport { MsalBroadcastService, MsalService, MSAL_GUARD_CONFIG} from '@azure/msal-angular';\r\nimport {\r\n  InteractionStatus,\r\n  AuthenticationResult,\r\n  PublicClientApplication,\r\n  PopupRequest,\r\n  SilentRequest,\r\n  InteractionRequiredAuthError\r\n} from '@azure/msal-browser';\r\nimport { ConfigService } from '@igo2/core';\r\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\nimport { filter, takeUntil } from 'rxjs/operators';\r\nimport { Subject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-auth-microsoft',\r\n  templateUrl: './auth-microsoft.component.html',\r\n  styleUrls: ['./auth-microsoft.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthMicrosoftComponent {\r\n  private options: AuthMicrosoftOptions;\r\n  private readonly _destroying$ = new Subject<void>();\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n  private broadcastService: MsalBroadcastService;\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private appRef: ApplicationRef,\r\n    private msalService: MsalService,\r\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\r\n  ) {\r\n    this.options = this.config.getConfig('auth.microsoft') || {};\r\n\r\n    this.msalService.instance = new PublicClientApplication({\r\n      auth: this.options,\r\n      cache: {\r\n        cacheLocation: 'sessionStorage'\r\n      }\r\n    });\r\n\r\n    this.broadcastService = new MsalBroadcastService(this.msalService.instance, this.msalService);\r\n\r\n    if (this.options.clientId) {\r\n      this.broadcastService.inProgress$\r\n      .pipe(\r\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\r\n        takeUntil(this._destroying$)\r\n      )\r\n      .subscribe(() => {\r\n        this.checkAccount();\r\n      });\r\n\r\n    } else {\r\n      console.warn('Microsoft authentification needs \"clientId\" option');\r\n    }\r\n  }\r\n\r\n  public loginMicrosoft() {\r\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\r\n    .subscribe((response: AuthenticationResult) => {\r\n      this.msalService.instance.setActiveAccount(response.account);\r\n      this.checkAccount();\r\n    });\r\n  }\r\n\r\n  private checkAccount() {\r\n    this.msalService.instance\r\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\r\n      .then((response: AuthenticationResult) => {\r\n        const tokenAccess = response.accessToken;\r\n        const tokenId = response.idToken;\r\n        this.authService.loginWithToken(tokenAccess, 'microsoft', { tokenId } ).subscribe(() => {\r\n          this.appRef.tick();\r\n          this.login.emit(true);\r\n        });\r\n      })\r\n      .catch(async (error) => {\r\n        if (error instanceof InteractionRequiredAuthError) {\r\n          // fallback to interaction when silent call fails\r\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\r\n        }\r\n        console.log(error);\r\n      }).catch(error => {\r\n        console.log('Silent token fails');\r\n      });\r\n  }\r\n\r\n  private getConf(): MSPMsalGuardConfiguration {\r\n    return this.msalGuardConfig.filter(conf => conf.type === 'add')[0];\r\n  }\r\n}\r\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoft()\">\r\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\r\n  {{'igo.auth.microsoft.login' | translate}}\r\n</button>\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { Location } from '@angular/common';\r\nimport {\r\n    IPublicClientApplication,\r\n    EndSessionRequest,\r\n    EndSessionPopupRequest,\r\n    AuthenticationResult,\r\n    RedirectRequest,\r\n    SilentRequest,\r\n    PopupRequest,\r\n    SsoSilentRequest,\r\n    Logger,\r\n    WrapperSKU\r\n} from '@azure/msal-browser';\r\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\r\nimport { Observable, from } from 'rxjs';\r\nimport { IMsalService } from '@azure/msal-angular';\r\n\r\n@Injectable()\r\nexport class MsalServiceb2c implements IMsalService {\r\n    private redirectHash: string;\r\n    private logger: Logger;\r\n    private name = '@azure/msal-angular';\r\n    private version = '2.0.0-beta.2';\r\n    constructor(\r\n        @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\r\n        private location: Location\r\n    ) {\r\n        const hash = this.location.path(true).split('#').pop();\r\n        if (hash) {\r\n            this.redirectHash = `#${hash}`;\r\n        }\r\n        this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\r\n    }\r\n\r\n    acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\r\n        return from(this.instance.acquireTokenPopup(request));\r\n    }\r\n    acquireTokenRedirect(request: RedirectRequest): Observable<void> {\r\n        return from(this.instance.acquireTokenRedirect(request));\r\n    }\r\n    acquireTokenSilent(silentRequest: SilentRequest): Observable<AuthenticationResult> {\r\n        return from(this.instance.acquireTokenSilent(silentRequest));\r\n    }\r\n    handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\r\n        return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\r\n    }\r\n    loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\r\n        return from(this.instance.loginPopup(request));\r\n    }\r\n    loginRedirect(request?: RedirectRequest): Observable<void> {\r\n        return from(this.instance.loginRedirect(request));\r\n    }\r\n    logout(logoutRequest?: EndSessionRequest): Observable<void> {\r\n        return from(this.instance.logout(logoutRequest));\r\n    }\r\n    logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\r\n        return from(this.instance.logoutRedirect(logoutRequest));\r\n    }\r\n    logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\r\n        return from(this.instance.logoutPopup(logoutRequest));\r\n    }\r\n    ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\r\n        return from(this.instance.ssoSilent(request));\r\n    }\r\n    /**\r\n     * Gets logger for msal-angular.\r\n     * If no logger set, returns logger instance created with same options as msal-browser\r\n     */\r\n    getLogger(): Logger {\r\n        if (!this.logger) {\r\n            this.logger = this.instance.getLogger().clone(this.name, this.version);\r\n        }\r\n        return this.logger;\r\n    }\r\n    // Create a logger instance for msal-angular with the same options as msal-browser\r\n    setLogger(logger: Logger): void {\r\n        this.logger = logger.clone(this.name, this.version);\r\n        this.instance.setLogger(logger);\r\n    }\r\n\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\r\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\r\nimport { EventMessage, EventMessageUtils, IPublicClientApplication, InteractionStatus } from '@azure/msal-browser';\r\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\r\n\r\n@Injectable()\r\nexport class MsalBroadcastServiceb2c {\r\n    private _msalSubject: Subject<EventMessage>;\r\n    public msalSubject$: Observable<EventMessage>;\r\n    private _inProgress: BehaviorSubject<InteractionStatus>;\r\n    public inProgress$: Observable<InteractionStatus>;\r\n\r\n    constructor(\r\n        @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\r\n        private authService: MsalServiceb2c\r\n    ) {\r\n        this._msalSubject = new Subject<EventMessage>();\r\n        this.msalSubject$  = this._msalSubject.asObservable();\r\n\r\n        // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\r\n        this._inProgress = new BehaviorSubject<InteractionStatus>(InteractionStatus.Startup);\r\n        this.inProgress$ = this._inProgress.asObservable();\r\n\r\n        this.msalInstance.addEventCallback((message: EventMessage) => {\r\n            this._msalSubject.next(message);\r\n            const status = EventMessageUtils.getInteractionStatusFromEvent(message);\r\n            if (status !== null) {\r\n                this.authService.getLogger().verbose(`BroadcastService - ${message.eventType} results in setting inProgress to ${status}`);\r\n                this._inProgress.next(status);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  ApplicationRef,\r\n  Output,\r\n  EventEmitter,\r\n  Inject\r\n} from '@angular/core';\r\n\r\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\r\nimport {\r\n  InteractionStatus,\r\n  AuthenticationResult,\r\n  PublicClientApplication,\r\n  PopupRequest,\r\n  SilentRequest,\r\n  InteractionRequiredAuthError\r\n} from '@azure/msal-browser';\r\nimport { ConfigService } from '@igo2/core';\r\nimport { AuthMicrosoftb2cOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\nimport { filter, takeUntil } from 'rxjs/operators';\r\nimport { Subject } from 'rxjs';\r\nimport { MsalBroadcastServiceb2c } from '../shared/auth-msalBroadcastServiceb2c.service';\r\nimport { MsalServiceb2c } from '../shared/auth-msalServiceb2c.service.';\r\n\r\n@Component({\r\n  selector: 'igo-auth-microsoftb2c',\r\n  templateUrl: './auth-microsoftb2c.component.html',\r\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthMicrosoftb2cComponent {\r\n  private options: AuthMicrosoftb2cOptions;\r\n  private readonly _destroying$ = new Subject<void>();\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n  private broadcastService: MsalBroadcastServiceb2c;\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private appRef: ApplicationRef,\r\n    private msalService: MsalServiceb2c,\r\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\r\n  ) {\r\n\r\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\r\n\r\n    this.msalService.instance = new PublicClientApplication({\r\n      auth: this.options.browserAuthOptions,\r\n      cache: {\r\n        cacheLocation: 'sessionStorage'\r\n      }\r\n    });\r\n\r\n    this.broadcastService = new MsalBroadcastServiceb2c(this.msalService.instance, this.msalService);\r\n\r\n    if (this.options.browserAuthOptions.clientId) {\r\n      this.broadcastService.inProgress$\r\n      .pipe(\r\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\r\n        takeUntil(this._destroying$)\r\n      )\r\n      .subscribe(() => {\r\n        this.checkAccount();\r\n      });\r\n\r\n    } else {\r\n      console.warn('Microsoft authentification needs \"clientId\" option');\r\n    }\r\n  }\r\n\r\n  public loginMicrosoftb2c() {\r\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\r\n    .subscribe((response: AuthenticationResult) => {\r\n      this.msalService.instance.setActiveAccount(response.account);\r\n      this.checkAccount();\r\n    });\r\n  }\r\n\r\n  private checkAccount() {\r\n    this.msalService.instance\r\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\r\n      .then((response: AuthenticationResult) => {\r\n        const token = response.idToken;\r\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\r\n          this.appRef.tick();\r\n          this.login.emit(true);\r\n        });\r\n      })\r\n      .catch(async (error) => {\r\n        if (error instanceof InteractionRequiredAuthError) {\r\n          // fallback to interaction when silent call fails\r\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\r\n        }\r\n        }).catch(error => {\r\n          console.log('Silent token fails');\r\n        });\r\n  }\r\n\r\n  private getConf(): MSPMsalGuardConfiguration {\r\n    return this.msalGuardConfig.filter(conf => conf.type === 'b2c')[0];\r\n  }\r\n}\r\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoftb2c()\">\r\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\r\n  {{'igo.auth.microsoftb2c.login' | translate}}\r\n</button>\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  ApplicationRef,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { AuthFacebookOptions } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-facebook',\r\n  templateUrl: './auth-facebook.component.html',\r\n  styleUrls: ['./auth-facebook.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthFacebookComponent {\r\n  private options: AuthFacebookOptions;\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private appRef: ApplicationRef\r\n  ) {\r\n    this.options = this.config.getConfig('auth.facebook') || {};\r\n\r\n    if (this.options.appId) {\r\n      this.loadSDKFacebook();\r\n    } else {\r\n      console.warn('Facebook authentification needs \"appId\" option');\r\n    }\r\n  }\r\n\r\n  private subscribeEvents() {\r\n    (window as any).FB.Event.subscribe('auth.statusChange', rep => {\r\n      this.statusChangeCallback(rep);\r\n    });\r\n  }\r\n\r\n  private statusChangeCallback(response) {\r\n    if (response.status === 'connected') {\r\n      const accessToken = response.authResponse.accessToken;\r\n      this.loginFacebook(accessToken);\r\n    }\r\n  }\r\n\r\n  private loginFacebook(token) {\r\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\r\n      this.appRef.tick();\r\n      this.login.emit(true);\r\n    });\r\n  }\r\n\r\n  private loadSDKFacebook() {\r\n    if (document.getElementById('facebook-jssdk')) {\r\n      return;\r\n    }\r\n\r\n    const urlSDK =\r\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\r\n\r\n    const fjs = document.getElementsByTagName('script')[0];\r\n    const js = document.createElement('script');\r\n    js.id = 'facebook-jssdk';\r\n    js.src = `${urlSDK}&appId=${this.options.appId}`;\r\n    js.onload = () => {\r\n      this.subscribeEvents();\r\n    };\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n  }\r\n}\r\n","<div scope=\"public_profile,email\"\r\n     class=\"fb-login-button\" data-max-rows=\"1\" data-size=\"large\"\r\n     data-button-type=\"login_with\" data-show-faces=\"false\"\r\n     data-auto-logout-link=\"false\" data-use-continue-as=\"false\">\r\n</div>\r\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\r\n  <div>\r\n    <mat-form-field class=\"full-width\">\r\n      <input matInput required placeholder=\"{{'igo.auth.user' | translate}}\" formControlName=\"username\">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div>\r\n    <mat-form-field class=\"full-width\">\r\n      <input matInput required type=\"password\" placeholder=\"{{'igo.auth.password' | translate}}\" formControlName=\"password\">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid || loading\">{{'igo.auth.login' | translate}}</button>\r\n  <button *ngIf=\"allowAnonymous\" mat-raised-button class=\"anonymous\" type=\"button\" [disabled]=\"loading\" (click)=\"loginAnonymous()\">\r\n    {{'igo.auth.accessAnonymous' | translate }}\r\n  </button>\r\n  <div *ngIf=\"error\">\r\n    <br/>\r\n    <font size=\"3\" color=\"red\">{{error}}</font>\r\n  </div>\r\n</form>\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  Input,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { Validators, FormGroup, FormBuilder } from '@angular/forms';\r\n\r\nimport { AuthService } from '../shared/auth.service';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-auth-intern',\r\n  templateUrl: './auth-intern.component.html',\r\n  styleUrls: ['./auth-intern.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.Default\r\n})\r\nexport class AuthInternComponent {\r\n  @Input()\r\n  get allowAnonymous(): boolean {\r\n    return this._allowAnonymous;\r\n  }\r\n  set allowAnonymous(value: boolean) {\r\n    this._allowAnonymous = value;\r\n  }\r\n  private _allowAnonymous = true;\r\n\r\n  public error = '';\r\n  public form: FormGroup;\r\n  public loading = false;\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  constructor(\r\n    public auth: AuthService,\r\n    private languageService: LanguageService,\r\n    fb: FormBuilder\r\n  ) {\r\n    this.form = fb.group({\r\n      username: ['', Validators.required],\r\n      password: ['', Validators.required]\r\n    });\r\n  }\r\n\r\n  loginUser(values: any) {\r\n    this.loading = true;\r\n    this.auth.login(values.username, values.password).subscribe(\r\n      () => {\r\n        this.login.emit(true);\r\n        this.loading = false;\r\n      },\r\n      (error: any) => {\r\n        try {\r\n          this.languageService.translate\r\n            .get('igo.auth.error.' + error.error.message)\r\n            .subscribe(errorMsg => (this.error = errorMsg));\r\n        } catch (e) {\r\n          this.error = error.error.message;\r\n        }\r\n        this.loading = false;\r\n      }\r\n    );\r\n    return false;\r\n  }\r\n\r\n  loginAnonymous() {\r\n    this.auth.loginAnonymous().subscribe(() => {\r\n      this.login.emit(true);\r\n    });\r\n  }\r\n}\r\n","<div *ngIf=\"visible\">\r\n  <div *ngIf=\"!auth.logged && backgroundDisable\" class=\"backgroundDisable\"></div>\r\n\r\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\r\n    <h1>{{'igo.auth.connection' | translate}}</h1>\r\n\r\n    <igo-auth-google\r\n      *ngIf=\"options.google && options.google.enabled !== false\"\r\n      (login)=\"onLogin()\">\r\n    </igo-auth-google>\r\n    <igo-auth-microsoft\r\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\r\n      (login)=\"onLogin()\">\r\n    </igo-auth-microsoft>\r\n    <igo-auth-microsoftb2c\r\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\r\n      (login)=\"onLogin()\">\r\n    </igo-auth-microsoftb2c>\r\n    <igo-auth-facebook\r\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\r\n      (login)=\"onLogin()\">\r\n    </igo-auth-facebook>\r\n    <igo-auth-intern\r\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\r\n      [allowAnonymous]=\"options.allowAnonymous\"\r\n      (login)=\"onLogin()\">\r\n    </igo-auth-intern>\r\n  </div>\r\n\r\n  <div *ngIf=\"auth.logged && showAlreadyConnectedDiv\" class=\"login center-block\">\r\n    <p>{{'igo.auth.welcome' |translate: user}}</p>\r\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">{{'igo.auth.signOut' |translate}}</button>\r\n  </div>\r\n\r\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\r\n    <p>{{'igo.auth.deconnection' |translate}}</p>\r\n    <button *ngIf=\"options.homeRoute\" mat-raised-button type=\"button\" (click)=\"home()\">{{'igo.auth.home' |translate}}</button>\r\n  </div>\r\n\r\n</div>\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  Input,\r\n  Optional,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { Router, NavigationStart } from '@angular/router';\r\nimport { filter } from 'rxjs/operators';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { AuthOptions } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-form',\r\n  templateUrl: './auth-form.component.html',\r\n  styleUrls: ['./auth-form.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.Default\r\n})\r\nexport class AuthFormComponent implements OnInit {\r\n  @Input()\r\n  get backgroundDisable(): boolean {\r\n    if (this.isLogoutRoute || this.isLogoutRoute) {\r\n      return false;\r\n    }\r\n    return this._backgroundDisable;\r\n  }\r\n  set backgroundDisable(value: boolean) {\r\n    this._backgroundDisable = value.toString() === 'true';\r\n  }\r\n  private _backgroundDisable = true;\r\n\r\n  @Input()\r\n  get hasAlreadyConnectedDiv(): boolean {\r\n    return this._hasAlreadyConnectedDiv;\r\n  }\r\n  set hasAlreadyConnectedDiv(value: boolean) {\r\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\r\n  }\r\n  private _hasAlreadyConnectedDiv = true;\r\n\r\n  @Input()\r\n  get hasLogoutDiv(): boolean {\r\n    return this._hasLogoutDiv;\r\n  }\r\n  set hasLogoutDiv(value: boolean) {\r\n    this._hasLogoutDiv = value.toString() === 'true';\r\n  }\r\n  private _hasLogoutDiv = true;\r\n\r\n  @Input()\r\n  get showAlreadyConnectedDiv(): boolean {\r\n    if (this.isLogoutRoute) {\r\n      return this.hasAlreadyConnectedDiv;\r\n    }\r\n    return this._showAlreadyConnectedDiv;\r\n  }\r\n  set showAlreadyConnectedDiv(value: boolean) {\r\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\r\n  }\r\n  private _showAlreadyConnectedDiv = false;\r\n\r\n  @Input()\r\n  get showLogoutDiv(): boolean {\r\n    if (this.isLogoutRoute) {\r\n      return this.hasLogoutDiv;\r\n    }\r\n    return this._showLogoutDiv;\r\n  }\r\n  set showLogoutDiv(value: boolean) {\r\n    this._showLogoutDiv = value.toString() === 'true';\r\n  }\r\n  private _showLogoutDiv = false;\r\n\r\n  get showLoginDiv(): boolean {\r\n    if (!this.isLogoutRoute) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  public options: AuthOptions;\r\n  public user;\r\n\r\n  public visible = true;\r\n\r\n  private isLoginRoute: boolean;\r\n  private isLogoutRoute: boolean;\r\n\r\n  constructor(\r\n    public auth: AuthService,\r\n    private config: ConfigService,\r\n    @Optional() private router: Router\r\n  ) {\r\n    this.options = this.config.getConfig('auth') || {};\r\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\r\n  }\r\n\r\n  public ngOnInit() {\r\n    this.analyzeRoute();\r\n    this.getName();\r\n  }\r\n\r\n  public onLogin() {\r\n    this.auth.goToRedirectUrl();\r\n    this.getName();\r\n    this.login.emit(true);\r\n  }\r\n\r\n  public logout() {\r\n    this.auth.logout().subscribe(() => {\r\n      this.user = undefined;\r\n      if (this.router) {\r\n        if (this.options.logoutRoute) {\r\n          this.router.navigate([this.options.logoutRoute]);\r\n        } else if (this.options.homeRoute) {\r\n          this.router.navigate([this.options.homeRoute]);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public home() {\r\n    if (this.router && this.options.homeRoute) {\r\n      this.router.navigate([this.options.homeRoute]);\r\n    }\r\n  }\r\n\r\n  private getName() {\r\n    const tokenDecoded = this.auth.decodeToken();\r\n    if (tokenDecoded) {\r\n      this.user = {\r\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\r\n      };\r\n    }\r\n  }\r\n\r\n  private analyzeRoute() {\r\n    if (!this.router) {\r\n      return;\r\n    }\r\n\r\n    this.router.events\r\n      .pipe(filter((event) => event instanceof NavigationStart))\r\n      .subscribe((changeEvent: any) => {\r\n        if (changeEvent.url) {\r\n          const currentRoute = changeEvent.url;\r\n          const logoutRoute = this.options.logoutRoute;\r\n          const loginRoute = this.options.loginRoute;\r\n\r\n          this.isLogoutRoute = currentRoute === logoutRoute;\r\n          this.isLoginRoute = currentRoute === loginRoute;\r\n\r\n          if (this.isLogoutRoute) {\r\n            this.auth.logout();\r\n          }\r\n        }\r\n      });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport {\r\n  HttpEvent,\r\n  HttpInterceptor,\r\n  HttpHandler,\r\n  HttpRequest\r\n} from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { TokenService } from './token.service';\r\nimport { WithCredentialsOptions } from './auth.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthInterceptor implements HttpInterceptor {\r\n  private refreshInProgress = false;\r\n\r\n  private get trustHosts() {\r\n    const trustHosts = this.config.getConfig('auth.trustHosts') || [];\r\n    trustHosts.push(window.location.hostname);\r\n    return trustHosts;\r\n  }\r\n\r\n  private get hostsWithCredentials(): WithCredentialsOptions[] {\r\n    return this.config.getConfig('auth.hostsWithCredentials') || [];\r\n  }\r\n\r\n  constructor(\r\n    private config: ConfigService,\r\n    private tokenService: TokenService,\r\n    private http: HttpClient\r\n  ) {}\r\n\r\n  intercept(\r\n    originalReq: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\r\n    let req = originalReq.clone();\r\n    if (withCredentials) {\r\n      req = originalReq.clone({\r\n        withCredentials\r\n      });\r\n    }\r\n    this.refreshToken();\r\n    const token = this.tokenService.get();\r\n    const element = document.createElement('a');\r\n    element.href = req.url;\r\n    if (element.host === '') {\r\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\r\n    }\r\n\r\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\r\n      return next.handle(req);\r\n    }\r\n\r\n    const authHeader = `Bearer ${token}`;\r\n    let authReq = req.clone({\r\n      headers: req.headers.set('Authorization', authHeader)\r\n    });\r\n\r\n    const tokenDecoded: any = this.tokenService.decode();\r\n    if (\r\n      authReq.params.get('_i') === 'true' &&\r\n      tokenDecoded &&\r\n      tokenDecoded.user &&\r\n      tokenDecoded.user.sourceId\r\n    ) {\r\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\r\n      authReq = authReq.clone({\r\n        params: authReq.params.set('_i', hashUser)\r\n      });\r\n    } else if (authReq.params.get('_i') === 'true') {\r\n      authReq = authReq.clone({\r\n        params: authReq.params.delete('_i')\r\n      });\r\n    }\r\n\r\n    return next.handle(authReq);\r\n  }\r\n\r\n  interceptXhr(xhr, url: string): boolean {\r\n    const withCredentials = this.handleHostsWithCredentials(url);\r\n    if (withCredentials) {\r\n       xhr.withCredentials = withCredentials;\r\n       return true;\r\n    }\r\n\r\n    this.refreshToken();\r\n    const element = document.createElement('a');\r\n    element.href = url;\r\n\r\n    const token = this.tokenService.get();\r\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\r\n      return false;\r\n    }\r\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\r\n    return true;\r\n  }\r\n\r\n  private handleHostsWithCredentials(reqUrl: string) {\r\n    let withCredentials = false;\r\n    for (const hostWithCredentials of this.hostsWithCredentials) {\r\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\r\n      if (domainRegex.test(reqUrl)) {\r\n        withCredentials = hostWithCredentials.withCredentials !== undefined ? hostWithCredentials.withCredentials : undefined;\r\n        break;\r\n      }\r\n    }\r\n    return withCredentials;\r\n  }\r\n\r\n  refreshToken() {\r\n    const jwt = this.tokenService.decode();\r\n    const currentTime = new Date().getTime() / 1000;\r\n\r\n    if (\r\n      !this.refreshInProgress &&\r\n      jwt &&\r\n      currentTime < jwt.exp &&\r\n      currentTime > jwt.exp - 1800\r\n    ) {\r\n      this.refreshInProgress = true;\r\n\r\n      const url = this.config.getConfig('auth.url');\r\n      return this.http.post(`${url}/refresh`, {}).subscribe(\r\n        (data: any) => {\r\n          this.tokenService.set(data.token);\r\n          this.refreshInProgress = false;\r\n        },\r\n        err => {\r\n          err.error.caught = true;\r\n          return err;\r\n        }\r\n      );\r\n    }\r\n  }\r\n}\r\n","import {\r\n  MSAL_GUARD_CONFIG,\r\n  MSAL_INSTANCE,\r\n  MsalService,\r\n} from '@azure/msal-angular';\r\n\r\nimport {\r\n  PublicClientApplication,\r\n  InteractionType\r\n} from '@azure/msal-browser';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { BrowserAuthOptions } from '@azure/msal-browser';\r\n\r\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from './auth.interface';\r\n\r\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\r\n\r\nexport function MSALConfigFactory(config: ConfigService): PublicClientApplication {\r\n\r\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoft') || {};\r\n\r\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\r\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\r\n\r\n  const myMsalObj = new PublicClientApplication({\r\n    auth: msConf,\r\n    cache: {\r\n      cacheLocation: 'sessionStorage'\r\n    }\r\n  });\r\n\r\n  return myMsalObj;\r\n}\r\n\r\nexport function MSALConfigFactoryb2c(config: ConfigService): PublicClientApplication {\r\n\r\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\r\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\r\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\r\n\r\n  const myMsalObj = new PublicClientApplication({\r\n    auth: msConf,\r\n    cache: {\r\n      cacheLocation: 'sessionStorage'\r\n    }\r\n  });\r\n\r\n  return myMsalObj;\r\n}\r\n\r\nexport function MSALAngularConfigFactory(config: ConfigService): MSPMsalGuardConfiguration {\r\n\r\n  const msConf: AuthMicrosoftOptions = config.getConfig('auth.microsoft') || {};\r\n\r\n  return {\r\n    interactionType: InteractionType.Popup,\r\n    authRequest: {\r\n      scopes: ['user.read'],\r\n      loginHint: 'todo',\r\n    },\r\n    type: 'add'\r\n  };\r\n}\r\n\r\nexport function MSALAngularConfigFactoryb2c(config: ConfigService): MSPMsalGuardConfiguration {\r\n\r\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\r\n\r\n  return {\r\n    interactionType: InteractionType.Popup,\r\n    authRequest: {\r\n      scopes: [msConf.clientId]\r\n    },\r\n    type: 'b2c'\r\n  };\r\n}\r\n\r\nexport function provideAuthMicrosoft(type?: string) {\r\n  if (type === 'b2c') {\r\n    return [\r\n      {\r\n        provide: MSAL_INSTANCE,\r\n        useFactory: MSALConfigFactoryb2c,\r\n        deps: [ConfigService]\r\n      },\r\n      {\r\n        provide: MSAL_GUARD_CONFIG,\r\n        useFactory: MSALAngularConfigFactoryb2c,\r\n        deps: [ConfigService],\r\n        multi: true\r\n      },\r\n      MsalServiceb2c\r\n    ];\r\n  } else {\r\n    return [\r\n      {\r\n        provide: MSAL_INSTANCE,\r\n        useFactory: MSALConfigFactory,\r\n        deps: [ConfigService]\r\n      },\r\n      {\r\n        provide: MSAL_GUARD_CONFIG,\r\n        useFactory: MSALAngularConfigFactory,\r\n        deps: [ConfigService],\r\n        multi: true\r\n      },\r\n      MsalService\r\n    ];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { StorageService, StorageScope, ConfigService } from '@igo2/core';\r\nimport { AuthService } from './auth.service';\r\nimport { TokenService } from './token.service';\r\nimport { AuthStorageOptions } from './storage.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthStorageService extends StorageService {\r\n  protected options: AuthStorageOptions;\r\n\r\n  constructor(\r\n    config: ConfigService,\r\n    private http: HttpClient,\r\n    private authService: AuthService,\r\n    private tokenService: TokenService\r\n  ) {\r\n    super(config);\r\n\r\n    this.authService.authenticate$.subscribe(isAuthenticated => {\r\n      if (isAuthenticated && this.options.url) {\r\n        this.http\r\n          .get(this.options.url)\r\n          .subscribe((userIgo: { preference: object }) => {\r\n            if (userIgo && userIgo.preference) {\r\n              for (const key of Object.keys(userIgo.preference)) {\r\n                const value = userIgo.preference[key];\r\n                super.set(key, value);\r\n              }\r\n            }\r\n          });\r\n      }\r\n    });\r\n  }\r\n\r\n  set(\r\n    key: string,\r\n    value: string | object | boolean | number,\r\n    scope: StorageScope = StorageScope.LOCAL\r\n  ) {\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      const preference = {};\r\n      preference[key] = value;\r\n      this.http.patch(this.options.url, { preference }).subscribe();\r\n    }\r\n    super.set(key, value, scope);\r\n  }\r\n\r\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      const preference = {};\r\n      preference[key] = undefined;\r\n      this.http.patch(this.options.url, { preference }).subscribe();\r\n    }\r\n    super.remove(key, scope);\r\n  }\r\n\r\n  clear(scope: StorageScope = StorageScope.LOCAL) {\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      this.http.patch(this.options.url, { preference: {}}, {\r\n        params: {\r\n          mergePreference: 'false'\r\n        }\r\n      }).subscribe();\r\n    }\r\n\r\n    let token: string;\r\n    if (scope === StorageScope.LOCAL) {\r\n      token = this.tokenService.get();\r\n    }\r\n\r\n    super.clear(scope);\r\n\r\n    if (token) {\r\n      this.tokenService.set(token);\r\n    }\r\n\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      this.http\r\n        .get(this.options.url)\r\n        .subscribe((userIgo: { preference: object }) => {\r\n          if (userIgo && userIgo.preference) {\r\n            for (const key of Object.keys(userIgo.preference)) {\r\n              const value = userIgo.preference[key];\r\n              super.set(key, value);\r\n            }\r\n          }\r\n        });\r\n    }\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MsalModule } from '@azure/msal-angular';\r\n\r\nimport { StorageService, IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { AuthStorageService } from './shared/storage.service';\r\nimport { ProtectedDirective } from './shared/protected.directive';\r\nimport { AuthInterceptor } from './shared/auth.interceptor';\r\nimport { provideAuthMicrosoft } from './shared/auth-microsoft.provider';\r\n\r\nimport { AuthInternComponent } from './auth-form/auth-intern.component';\r\nimport { AuthFormComponent } from './auth-form/auth-form.component';\r\nimport { AuthGoogleComponent } from './auth-form/auth-google.component';\r\nimport { AuthFacebookComponent } from './auth-form/auth-facebook.component';\r\nimport { AuthMicrosoftComponent } from './auth-form/auth-microsoft.component';\r\nimport { AuthMicrosoftb2cComponent } from './auth-form/auth-microsoftb2c.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule,\r\n    MsalModule\r\n  ],\r\n  declarations: [\r\n    AuthFormComponent,\r\n    AuthGoogleComponent,\r\n    AuthInternComponent,\r\n    AuthFacebookComponent,\r\n    AuthMicrosoftComponent,\r\n    AuthMicrosoftb2cComponent,\r\n    ProtectedDirective\r\n  ],\r\n  exports: [AuthFormComponent, ProtectedDirective]\r\n})\r\nexport class IgoAuthModule {\r\n  static forRoot(): ModuleWithProviders<IgoAuthModule> {\r\n    return {\r\n      ngModule: IgoAuthModule,\r\n      providers: [\r\n        {\r\n          provide: HTTP_INTERCEPTORS,\r\n          useClass: AuthInterceptor,\r\n          multi: true\r\n        },\r\n        {\r\n          provide: StorageService,\r\n          useClass: AuthStorageService\r\n        },\r\n        ...provideAuthMicrosoft('add'),\r\n        ...provideAuthMicrosoft('b2c')\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppAuthFormComponent } from './auth-form.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'auth-form',\r\n    component: AppAuthFormComponent\r\n  }\r\n];\r\n\r\nexport const AppAuthFormRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-auth-form',\r\n  templateUrl: './auth-form.component.html',\r\n  styleUrls: ['./auth-form.component.scss']\r\n})\r\nexport class AppAuthFormComponent {\r\n  private idsActivity: string[] = [];\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Auth</mat-card-subtitle>\r\n  <mat-card-title>Authentification</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: ConfigService, LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/auth/auth-form\">code of this example</a><br>\r\n    See auth section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\r\n  </mat-card-content>\r\n</mat-card>\r\n\r\n<igo-auth-form></igo-auth-form>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoAuthModule } from '@igo2/auth';\r\n\r\nimport { AppAuthFormComponent } from './auth-form.component';\r\nimport { AppAuthFormRoutingModule } from './auth-form-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppAuthFormComponent],\r\n  imports: [AppAuthFormRoutingModule, MatCardModule, IgoAuthModule.forRoot()],\r\n  exports: [AppAuthFormComponent]\r\n})\r\nexport class AppAuthFormModule {}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { MetadataOptions } from './metadata.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MetadataService {\r\n  constructor() {}\r\n\r\n  open(metadata: MetadataOptions) {\r\n    if (metadata.extern) {\r\n      window.open(metadata.url, '_blank');\r\n    }\r\n  }\r\n}\r\n","<button\r\n  *ngIf=\"(options && options.metadata && options.metadata.url) || (options && options.metadata && options.metadata.abstract)\"\r\n  mat-icon-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\r\n  [color]=\"color\"\r\n  (click)=\"openMetadata(options.metadata)\">\r\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\r\n</button>\r\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\r\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\r\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\r\n  <h3>{{ data.abstract }}</h3>\r\n</mat-dialog-content>\r\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\r\n  <h3 [innerHTML]=\"data.abstract\"></h3>\r\n</mat-dialog-content>\r\n","import { Component, Input, ChangeDetectionStrategy, Inject, ViewEncapsulation } from '@angular/core';\r\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\nimport {\r\n  MetadataOptions,\r\n  MetadataLayerOptions\r\n} from '../shared/metadata.interface';\r\nimport { MetadataService } from '../shared/metadata.service';\r\n\r\n@Component({\r\n  selector: 'igo-metadata-button',\r\n  templateUrl: './metadata-button.component.html',\r\n  styleUrls: ['./metadata-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MetadataButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor(\r\n    private metadataService: MetadataService,\r\n    private dialog: MatDialog) {}\r\n\r\n  openMetadata(metadata: MetadataOptions) {\r\n    if (metadata.extern) {\r\n      this.metadataService.open(metadata);\r\n    } else if (!metadata.extern && metadata.abstract) {\r\n      this.dialog.open(MetadataAbstractComponent, {\r\n        data: {\r\n          layerTitle: this.layer.title,\r\n          abstract: metadata.abstract,\r\n          type: metadata.type\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  get options(): MetadataLayerOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.options;\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'igo-metadata-abstract',\r\n  templateUrl: './metadata-abstract.component.html',\r\n  styleUrls: ['./metadata-abstract.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class MetadataAbstractComponent {\r\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\r\n}\r\n","import { MatDialogModule } from '@angular/material/dialog';\r\nimport { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { MetadataButtonComponent, MetadataAbstractComponent } from './metadata-button/metadata-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule,\r\n    MatDialogModule\r\n  ],\r\n  exports: [\r\n    MetadataButtonComponent,\r\n    MetadataAbstractComponent],\r\n  declarations: [\r\n    MetadataButtonComponent,\r\n    MetadataAbstractComponent]\r\n})\r\nexport class IgoMetadataModule {\r\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\r\n    return {\r\n      ngModule: IgoMetadataModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","export const FEATURE = 'Feature';\r\n\r\nexport enum FeatureMotion {\r\n  None,\r\n  Move,\r\n  Zoom,\r\n  Default\r\n}\r\n","import olSourceImage from 'ol/source/Image';\r\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { ImageLayer } from '../shared/layers/image-layer';\r\n\r\n\r\nexport class ImageWatcher extends Watcher {\r\n  protected id: string;\r\n  protected loaded = 0;\r\n  protected loading = 0;\r\n\r\n  private source: olSourceImage;\r\n\r\n  private messageService: MessageService;\r\n  private languageService: LanguageService;\r\n\r\n  constructor(layer: ImageLayer, messageService: MessageService, languageService: LanguageService) {\r\n    super();\r\n    this.source = layer.options.source.ol;\r\n    this.id = uuid();\r\n    this.messageService = messageService;\r\n    this.languageService = languageService;\r\n  }\r\n\r\n  protected watch() {\r\n    this.source.on(`imageloadstart`, e => this.handleLoadStart(e));\r\n    this.source.on(`imageloadend`, e => this.handleLoadEnd(e));\r\n    this.source.on(`imageloaderror`, e => this.handleLoadEnd(e));\r\n    this.source.on(`imageloaderror`, e => this.handleLoadError(e));\r\n  }\r\n\r\n  protected unwatch() {\r\n    this.source.un(`imageloadstart`, e => this.handleLoadStart(e));\r\n    this.source.un(`imageloadend`, e => this.handleLoadEnd(e));\r\n    this.source.un(`imageloaderror`, e => this.handleLoadEnd(e));\r\n    this.source.un(`imageloaderror`, e => this.handleLoadError(e));\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    if (!event.image.__watchers__) {\r\n      event.image.__watchers__ = [];\r\n    }\r\n    event.image.__watchers__.push(this.id);\r\n\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event) {\r\n    if (!event.image.__watchers__) {\r\n      return;\r\n    }\r\n\r\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\r\n    if (watcherIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    event.image.__watchers__.splice(watcherIndex, 1);\r\n\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleLoadError(event) {\r\n\r\n    if (!event.image.__watchers__) {\r\n      return;\r\n    }\r\n    const title = this.languageService.translate.instant(\r\n      'igo.geo.dataSource.unavailableTitle'\r\n    );\r\n    const message = this.languageService.translate.instant(\r\n      'igo.geo.dataSource.unavailable', {value: event.target.params_.LAYERS}\r\n    );\r\n\r\n    this.messageService.error(message, title);\r\n    this.loaded = -1;\r\n    this.loading = 0;\r\n    this.status = SubjectStatus.Error;\r\n\r\n  }\r\n}\r\n","import olLayer from 'ol/layer/Layer';\r\nimport olSource from 'ol/source/Source';\r\nimport { Message } from '@igo2/core';\r\n\r\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\r\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\r\nimport { MapExtent, MapViewOptions } from '../../../map/shared/map.interface';\r\n\r\nexport interface LayerOptions {\r\n  source?: DataSource;\r\n  sourceOptions?: AnyDataSourceOptions;\r\n  title?: string;\r\n  id?: string;\r\n  alias?: string;\r\n  baseLayer?: boolean;\r\n  opacity?: number;\r\n  visible?: boolean;\r\n  extent?: MapExtent;\r\n  zIndex?: number;\r\n  messages?: Message[];\r\n  minResolution?: number;\r\n  maxResolution?: number;\r\n  minScaleDenom?: number;\r\n  maxScaleDenom?: number;\r\n  showInLayerList?: boolean;\r\n  removable?: boolean;\r\n  workspace?: GeoWorkspaceOptions;\r\n  legendOptions?: LegendOptions;\r\n  ol?: olLayer<olSource>;\r\n  tooltip?: TooltipContent;\r\n  _internal?: { [key: string]: string };\r\n  active?: boolean;\r\n  check?: boolean;\r\n  linkedLayers?: LayersLink;\r\n}\r\n\r\nexport interface GeoWorkspaceOptions {\r\n  srcId?: string;\r\n  workspaceId?: string;\r\n  minResolution?: number;\r\n  maxResolution?: number;\r\n  enabled?: boolean;\r\n}\r\n\r\nexport interface LayersLink {\r\n  linkId: string;\r\n  links?: LayersLinkProperties[];\r\n}\r\nexport interface LayersLinkProperties {\r\n  bidirectionnal?: boolean;\r\n  linkedIds: string[];\r\n  syncedDelete: boolean;\r\n  properties: LinkedProperties[];\r\n}\r\n\r\nexport enum LinkedProperties {\r\n  OPACITY = 'opacity',\r\n  VISIBLE = 'visible',\r\n  OGCFILTERS = 'ogcFilters',\r\n  MINRESOLUTION = 'minResolution',\r\n  MAXRESOLUTION = 'maxResolution',\r\n  ZINDEX = 'zIndex',\r\n  TIMEFILTER = 'timeFilter'\r\n}\r\n\r\nexport interface GroupLayers {\r\n  title: string;\r\n  layers?: LayerOptions;\r\n  collapsed?: boolean;\r\n}\r\n\r\nexport interface TooltipContent {\r\n  type?: TooltipType;\r\n  text?: string;\r\n}\r\nexport enum TooltipType {\r\n  TITLE = 'title',\r\n  ABSTRACT = 'abstract',\r\n  CUSTOM = 'custom'\r\n}\r\n\r\nexport interface LegendOptions {\r\n  collapsed?: boolean;\r\n  display?: boolean;\r\n  url?: string;\r\n  html?: string;\r\n  stylesAvailable?: ItemStyleOptions[];\r\n}\r\n\r\nexport interface LegendMapViewOptions extends MapViewOptions{\r\n  scale?: number;\r\n  size?: [number, number];\r\n}\r\n\r\nexport interface ItemStyleOptions {\r\n  name: string;\r\n  title?: string;\r\n}\r\n\r\nexport interface OutputLayerLegend {\r\n  title: string;\r\n  url: string;\r\n}\r\n","import { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\r\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\r\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\r\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\r\nimport { WFSDataSourceOptions } from '../datasource';\r\n\r\n/**\r\n * Generate a id from it's datasource options.\r\n * @param options Data source options\r\n * @returns A id\r\n */\r\nexport function generateIdFromSourceOptions(options: DataSourceOptions): string {\r\n  const generators = {\r\n    wms: generateWMSIdFromSourceOptions,\r\n    wmts: generateWMTSIdFromSourceOptions,\r\n    xyz: generateXYZIdFromSourceOptions,\r\n    feature: generateFeatureIdFromSourceOptions,\r\n    wfs: generateWfsIdFromSourceOptions,\r\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\r\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\r\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\r\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\r\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\r\n  };\r\n  const generator = generators[options.type] || generateId;\r\n  return generator(options);\r\n}\r\n\r\n/**\r\n * Generate a id from WMS data source options\r\n * @param options WMS data source options\r\n * @returns A md5 hash of the the url and layers\r\n */\r\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\r\n  const layers = options.params.LAYERS;\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'wms' + url + layers;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from WMTS data source options\r\n * @param options WMTS data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateWMTSIdFromSourceOptions(options: WMTSDataSourceOptions) {\r\n  const layer = options.layer;\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'wmts' + url + layer;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from XYZ data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'xyz' + url;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from feature data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateFeatureIdFromSourceOptions(options: WMTSDataSourceOptions) {\r\n  if (!options.url) { return generateId(options); }\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'feature' + url;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from feature data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\r\n  if (!options.url || !options.params) { return generateId(options); }\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'wfs' + url + options.params.featureTypes;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n/**\r\n * Generate a id from ArcGIS Rest data source options\r\n * @param options ArcGIS Rest data source options\r\n * @returns A md5 hash of the url and layers\r\n */\r\nexport function generateArcgisRestIdFromSourceOptions(options: ArcGISRestDataSourceOptions) {\r\n  const layers = options.layer;\r\n  const url = standardizeUrl(options.url);\r\n  const chain = (options.type || 'arcgis') + url + layers;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a unique id\r\n * @returns A uuid\r\n */\r\nexport function generateId(_options: AnyDataSourceOptions) {\r\n  return uuid();\r\n}\r\n\r\nexport function standardizeUrl(url: string): string {\r\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\r\n  const urlDecomposed = absUrl.split(/[?&]/);\r\n  let urlStandardized = urlDecomposed.shift();\r\n  const paramsToKeep = urlDecomposed.filter(p => p.length !== 0 && p.charAt(0) !== '_');\r\n  if (paramsToKeep.length) {\r\n    urlStandardized += '?' + paramsToKeep.join('&');\r\n  }\r\n  return urlStandardized;\r\n}\r\n","import olSource from 'ol/source/Source';\r\nimport olVectorSource from 'ol/source/Vector';\r\nimport olClusterSource from 'ol/source/Cluster';\r\nimport olVectorTileSource from 'ol/source/VectorTile';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport {\r\n  DataSourceOptions,\r\n  Legend\r\n} from './datasource.interface';\r\n\r\nimport { DataService } from './data.service';\r\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\r\nimport { LegendMapViewOptions, LegendOptions } from '../../../layer/shared/layers/layer.interface';\r\n\r\nexport abstract class DataSource {\r\n\r\n  public id: string;\r\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource ;\r\n  private legend: Legend[];\r\n\r\n  constructor(\r\n    public options: DataSourceOptions = {},\r\n    protected dataService?: DataService\r\n  ) {\r\n    this.options = options;\r\n    this.id = this.options.id ||this.generateId();\r\n    this.ol = this.createOlSource();\r\n  }\r\n\r\n  protected abstract createOlSource(): olSource;\r\n\r\n  protected generateId(): string {\r\n    return generateIdFromSourceOptions(this.options);\r\n  }\r\n\r\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\r\n    return this.legend ? this.legend : [];\r\n  }\r\n\r\n  public setLegend(options: LegendOptions): Legend[] {\r\n    if (options.url) {\r\n      this.legend = [{ url: options.url} ];\r\n    } else if (options.html) {\r\n      this.legend = [{ html: options.html} ];\r\n    } else {\r\n      this.legend = [];\r\n    }\r\n\r\n    return this.legend;\r\n  }\r\n\r\n  protected abstract onUnwatch();\r\n}\r\n","export enum OgcFilterOperatorType {\r\n    BasicNumericOperator = 'basicnumericoperator',\r\n    Basic = 'basic',\r\n    BasicAndSpatial = 'basicandspatial',\r\n    Spatial = 'spatial',\r\n    All = 'all',\r\n    Time = 'time'\r\n}\r\n\r\nexport enum OgcFilterOperator {\r\n    BBOX = 'BBox',\r\n    PropertyIsBetween = 'PropertyIsBetween',\r\n    Contains = 'Contains',\r\n    During = 'During',\r\n    PropertyIsEqualTo = 'PropertyIsEqualTo',\r\n    PropertyIsGreaterThan = 'PropertyIsGreaterThan',\r\n    PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\r\n    Intersects = 'Intersects',\r\n    PropertyIsNull = 'PropertyIsNull',\r\n    PropertyIsLessThan = 'PropertyIsLessThan',\r\n    PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\r\n    PropertyIsLike = 'PropertyIsLike',\r\n    PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\r\n    Within = 'Within',\r\n    And = 'And',\r\n    Or = 'Or',\r\n    Not = 'Not'\r\n}\r\n","import * as olfilter from 'ol/format/filter';\r\nimport olFormatWKT from 'ol/format/WKT';\r\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\r\nimport olGeometry from 'ol/geom/Geometry';\r\n\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { uuid, ObjectUtils } from '@igo2/utils';\r\n\r\nimport {\r\n  OgcFilter,\r\n  IgoOgcFilterObject,\r\n  WFSWriteGetFeatureOptions,\r\n  AnyBaseOgcFilterOptions,\r\n  OgcInterfaceFilterOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFiltersOptions,\r\n  IgoOgcSelector,\r\n  SelectorGroup,\r\n  OgcSelectorBundle\r\n} from './ogc-filter.interface';\r\nimport { OgcFilterOperatorType, OgcFilterOperator } from './ogc-filter.enum';\r\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\r\nimport * as moment_ from 'moment';\r\nconst moment = moment_;\r\n\r\nexport class OgcFilterWriter {\r\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\r\n  public operators = {\r\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.PropertyIsLike as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['string']\r\n    },\r\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsBetween as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\r\n    [OgcFilterOperator.PropertyIsNull as string]: {\r\n      spatial: false,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.Intersects as string]: {\r\n      spatial: true,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\r\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\r\n  };\r\n\r\n  defineOgcFiltersDefaultOptions(\r\n    ogcFiltersOptions: OgcFiltersOptions,\r\n    fieldNameGeometry: string,\r\n    srcType?: string\r\n  ): OgcFiltersOptions {\r\n    let ogcFiltersDefaultValue = true; // default values for wfs.\r\n    if (srcType && srcType === 'wms') {\r\n      ogcFiltersDefaultValue = false;\r\n    }\r\n\r\n    ogcFiltersOptions = ogcFiltersOptions || {};\r\n    ogcFiltersOptions.enabled =\r\n      ogcFiltersOptions.enabled === undefined\r\n        ? ogcFiltersDefaultValue\r\n        : ogcFiltersOptions.enabled;\r\n    ogcFiltersOptions.editable =\r\n      ogcFiltersOptions.editable === undefined\r\n        ? ogcFiltersDefaultValue\r\n        : ogcFiltersOptions.editable;\r\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\r\n\r\n    ogcFiltersOptions.advancedOgcFilters = true;\r\n    if (ogcFiltersOptions.enabled && (ogcFiltersOptions.pushButtons || ogcFiltersOptions.checkboxes\r\n      || ogcFiltersOptions.radioButtons || ogcFiltersOptions.select)) {\r\n      ogcFiltersOptions.advancedOgcFilters = false;\r\n    }\r\n    return ogcFiltersOptions;\r\n  }\r\n\r\n  public buildFilter(\r\n    filters?: IgoOgcFilterObject,\r\n    extent?: [number, number, number, number],\r\n    proj?: olProjection,\r\n    fieldNameGeometry?: string,\r\n    options?: OgcFilterableDataSourceOptions\r\n  ): string {\r\n    let ourBboxFilter;\r\n    let enableBbox: boolean;\r\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\r\n      enableBbox = false;\r\n    } else {\r\n      enableBbox = true;\r\n    }\r\n    if (filters) {\r\n      fieldNameGeometry =\r\n        (filters as any).geometryName !== undefined\r\n          ? (filters as any).geometryName\r\n          : fieldNameGeometry;\r\n    }\r\n    if (extent && filters) {\r\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\r\n    }\r\n    let filterAssembly: OgcFilter;\r\n    if (filters) {\r\n      filters = this.checkIgoFiltersProperties(\r\n        filters,\r\n        fieldNameGeometry,\r\n        proj\r\n      );\r\n      if (extent && enableBbox) {\r\n        filterAssembly = olfilter.and(\r\n          ourBboxFilter,\r\n          this.bundleFilter(filters, options)\r\n        );\r\n      } else {\r\n        filterAssembly = this.bundleFilter(filters, options);\r\n      }\r\n    } else {\r\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\r\n    }\r\n\r\n    const wfsOptions: WriteGetFeatureOptions = {\r\n      srsName: '',\r\n      featureNS: '',\r\n      featurePrefix: '',\r\n      featureTypes: ['featureTypes'],\r\n      filter: filterAssembly,\r\n      outputFormat: '',\r\n      geometryName: fieldNameGeometry\r\n    };\r\n\r\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\r\n    const str = new XMLSerializer().serializeToString(query);\r\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\r\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\r\n\r\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\r\n  }\r\n\r\n  private bundleFilter(\r\n    filterObject: any,\r\n    options?: OgcFilterableDataSourceOptions\r\n  ) {\r\n    if (filterObject instanceof Array) {\r\n      const logicalArray = [];\r\n      filterObject.forEach((element) => {\r\n        logicalArray.push(this.bundleFilter(element, options));\r\n      });\r\n      return logicalArray;\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        return this.createFilter(\r\n          {\r\n            operator: filterObject.logical,\r\n            logicalArray: this.bundleFilter(filterObject.filters, options)\r\n          },\r\n          options\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        return this.createFilter(\r\n          filterObject as AnyBaseOgcFilterOptions,\r\n          options\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private createFilter(\r\n    filterOptions,\r\n    options?: OgcFilterableDataSourceOptions\r\n  ): OgcFilter {\r\n    const operator = filterOptions.operator;\r\n    const logicalArray = filterOptions.logicalArray;\r\n\r\n    const wfsPropertyName = filterOptions.propertyName;\r\n    const wfsPattern = filterOptions.pattern;\r\n    const wfsMatchCase = filterOptions.matchCase\r\n      ? filterOptions.matchCase\r\n      : true;\r\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\r\n    const wfsSingleChar = filterOptions.singleChar\r\n      ? filterOptions.singleChar\r\n      : '.';\r\n    const wfsEscapeChar = filterOptions.escapeChar\r\n      ? filterOptions.escapeChar\r\n      : '!';\r\n\r\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\r\n    const wfsUpperBoundary = filterOptions.upperBoundary;\r\n\r\n    const wfsGeometryName = filterOptions.geometryName;\r\n    const wfsExtent = filterOptions.extent;\r\n    const wfsWktGeometry = filterOptions.wkt_geometry;\r\n    const wfsSrsName = filterOptions.srsName\r\n      ? filterOptions.srsName\r\n      : 'EPSG:3857';\r\n\r\n    const wfsBegin = this.parseFilterOptionDate(\r\n      filterOptions.begin,\r\n      options ? options.minDate : undefined\r\n    );\r\n    const wfsEnd = this.parseFilterOptionDate(\r\n      filterOptions.end,\r\n      options ? options.maxDate : undefined\r\n    );\r\n\r\n    const wfsExpression = filterOptions.expression;\r\n\r\n    let geometry: olGeometry;\r\n    if (wfsWktGeometry) {\r\n      const wkt = new olFormatWKT();\r\n      geometry = wkt.readGeometry(wfsWktGeometry, {\r\n        dataProjection: wfsSrsName,\r\n        featureProjection: wfsSrsName || 'EPSG:3857'\r\n      });\r\n    }\r\n\r\n    switch (operator.toLowerCase()) {\r\n      case OgcFilterOperator.BBOX.toLowerCase():\r\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\r\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\r\n        return olfilter.between(\r\n          wfsPropertyName,\r\n          wfsLowerBoundary,\r\n          wfsUpperBoundary\r\n        );\r\n      case OgcFilterOperator.Contains.toLowerCase():\r\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\r\n      case OgcFilterOperator.During.toLowerCase():\r\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\r\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\r\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\r\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\r\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\r\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.Intersects.toLowerCase():\r\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\r\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\r\n        return olfilter.isNull(wfsPropertyName);\r\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\r\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\r\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\r\n        return olfilter.like(\r\n          wfsPropertyName,\r\n          wfsPattern.replace(/[()_]/gi, wfsSingleChar),\r\n          wfsWildCard,\r\n          wfsSingleChar,\r\n          wfsEscapeChar,\r\n          wfsMatchCase\r\n        );\r\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\r\n        return olfilter.notEqualTo(\r\n          wfsPropertyName,\r\n          wfsExpression,\r\n          wfsMatchCase\r\n        );\r\n      case OgcFilterOperator.Within.toLowerCase():\r\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\r\n      // LOGICAL\r\n      case OgcFilterOperator.And.toLowerCase():\r\n        return olfilter.and.apply(null, logicalArray);\r\n      case OgcFilterOperator.Or.toLowerCase():\r\n        return olfilter.or.apply(null, logicalArray);\r\n      case OgcFilterOperator.Not.toLowerCase():\r\n        return olfilter.not.apply(null, logicalArray);\r\n\r\n      default:\r\n        return undefined;\r\n    }\r\n  }\r\n\r\n  public defineInterfaceFilterSequence(\r\n    filterObject: any,\r\n    geometryName,\r\n    logical = '',\r\n    level = -1\r\n  ): OgcInterfaceFilterOptions[] {\r\n    if (filterObject instanceof Array) {\r\n      filterObject.forEach((element) => {\r\n        this.filterSequence.concat(\r\n          this.defineInterfaceFilterSequence(\r\n            element,\r\n            geometryName,\r\n            logical,\r\n            level\r\n          )\r\n        );\r\n      });\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        level = level + 1;\r\n        this.filterSequence.concat(\r\n          this.defineInterfaceFilterSequence(\r\n            filterObject.filters,\r\n            geometryName,\r\n            filterObject.logical,\r\n            level\r\n          )\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        this.filterSequence.push(\r\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\r\n        );\r\n      }\r\n    }\r\n    return this.filterSequence;\r\n  }\r\n\r\n  public computeAllowedOperators(\r\n    fields?: SourceFieldsOptionsParams[],\r\n    propertyName?: string,\r\n    defaultOperatorsType?: OgcFilterOperatorType\r\n  ) {\r\n    let effectiveOperators: {} = {};\r\n    let allowedOperators;\r\n    let fieldsHasSpatialOperator: boolean;\r\n    let includeContains: boolean;\r\n\r\n    if (fields && propertyName) {\r\n      const srcField = fields.find((field) => field.name === propertyName);\r\n      allowedOperators =\r\n        srcField && srcField.allowedOperatorsType\r\n          ? srcField.allowedOperatorsType\r\n          : defaultOperatorsType;\r\n    }\r\n\r\n    if (fields) {\r\n      fields.map((field) => {\r\n        if (!field.allowedOperatorsType) {\r\n          return;\r\n        }\r\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\r\n        if (\r\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\r\n          allowedOperatorsType ===\r\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\r\n          allowedOperatorsType ===\r\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\r\n        ) {\r\n          fieldsHasSpatialOperator = true;\r\n          if (\r\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\r\n          ) {\r\n            includeContains = true;\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    allowedOperators = allowedOperators\r\n      ? allowedOperators\r\n      : OgcFilterOperatorType.BasicAndSpatial;\r\n\r\n    switch (allowedOperators.toLowerCase()) {\r\n      case OgcFilterOperatorType.All:\r\n        effectiveOperators = this.operators;\r\n        break;\r\n      case OgcFilterOperatorType.Spatial:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\r\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.BasicAndSpatial:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\r\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.Basic:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.Time:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.BasicNumericOperator:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          },\r\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          },\r\n          [OgcFilterOperator.PropertyIsLessThan]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          },\r\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          }\r\n        };\r\n        break;\r\n      default:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\r\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\r\n        };\r\n    }\r\n\r\n    if (fieldsHasSpatialOperator) {\r\n      (effectiveOperators as any).Intersects = {\r\n        spatial: true,\r\n        fieldRestrict: []\r\n      };\r\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\r\n      if (includeContains) {\r\n        (effectiveOperators as any).Contains = {\r\n          spatial: true,\r\n          fieldRestrict: []\r\n        };\r\n      }\r\n    }\r\n\r\n    return effectiveOperators;\r\n  }\r\n\r\n  public addInterfaceFilter(\r\n    igoOgcFilterObject?,\r\n    geometryName?,\r\n    level = 0,\r\n    parentLogical = 'Or'\r\n  ): OgcInterfaceFilterOptions {\r\n    if (!igoOgcFilterObject) {\r\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\r\n    }\r\n    const f = {\r\n      propertyName: '',\r\n      operator: '',\r\n      active: '',\r\n      filterid: uuid(),\r\n      step: '',\r\n      begin: '',\r\n      end: '',\r\n      sliderOptions: {},\r\n      lowerBoundary: '',\r\n      upperBoundary: '',\r\n      expression: '',\r\n      pattern: '',\r\n      wildCard: '*',\r\n      singleChar: '.',\r\n      escapeChar: '!',\r\n      matchCase: true,\r\n      igoSpatialSelector: '',\r\n      igoSNRC: '',\r\n      geometryName: '',\r\n      geometry: '',\r\n      wkt_geometry: '',\r\n      extent: '',\r\n      srsName: '',\r\n      parentLogical: '',\r\n      level: 0\r\n    };\r\n\r\n    return Object.assign(\r\n      f,\r\n      {\r\n        parentLogical,\r\n        level,\r\n        geometryName\r\n      },\r\n      igoOgcFilterObject\r\n    );\r\n  }\r\n\r\n  public checkIgoFiltersProperties(\r\n    filterObject: any,\r\n    fieldNameGeometry,\r\n    proj: olProjection,\r\n    active = false\r\n  ) {\r\n    const filterArray = [];\r\n    if (filterObject instanceof Array) {\r\n      filterObject.forEach((element) => {\r\n        filterArray.push(\r\n          this.checkIgoFiltersProperties(\r\n            element,\r\n            fieldNameGeometry,\r\n            proj,\r\n            active\r\n          )\r\n        );\r\n      });\r\n      return filterArray;\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        return Object.assign(\r\n          {},\r\n          {\r\n            logical: filterObject.logical,\r\n            filters: this.checkIgoFiltersProperties(\r\n              filterObject.filters,\r\n              fieldNameGeometry,\r\n              proj,\r\n              active\r\n            )\r\n          }\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        return this.addFilterProperties(\r\n          filterObject as OgcInterfaceFilterOptions,\r\n          fieldNameGeometry,\r\n          proj,\r\n          active\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private addFilterProperties(\r\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\r\n    fieldNameGeometry,\r\n    proj: olProjection,\r\n    active = false\r\n  ) {\r\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\r\n      ? igoOgcFilterObject.filterid\r\n      : uuid();\r\n    const status = igoOgcFilterObject.hasOwnProperty('active')\r\n      ? igoOgcFilterObject.active\r\n      : active;\r\n\r\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\r\n      ? igoOgcFilterObject.srsName\r\n      : proj\r\n      ? proj.getCode()\r\n      : 'EPSG:3857';\r\n\r\n    return Object.assign(\r\n      {},\r\n      {\r\n        filterid,\r\n        active: status,\r\n        igoSpatialSelector: 'fixedExtent',\r\n        srsName\r\n      },\r\n      igoOgcFilterObject,\r\n      { geometryName: fieldNameGeometry }\r\n    );\r\n  }\r\n\r\n  public rebuiltIgoOgcFilterObjectFromSequence(\r\n    sequence: OgcInterfaceFilterOptions[]\r\n  ): IgoOgcFilterObject {\r\n    if (sequence instanceof Array) {\r\n      if (sequence.length >= 1) {\r\n        let lastParentLogical = sequence[0].parentLogical;\r\n        let nextElement: any;\r\n        let logicalArray = [];\r\n        let lastProcessedFilter;\r\n        sequence.forEach((uiFilter) => {\r\n          const element = Object.assign({}, uiFilter);\r\n          const index = sequence.indexOf(uiFilter);\r\n          if (index >= 0 && index < sequence.length - 1) {\r\n            nextElement = sequence[index + 1];\r\n          } else {\r\n            nextElement = element;\r\n          }\r\n          delete element.active;\r\n          delete element.filterid;\r\n          delete element.parentLogical;\r\n          logicalArray.push(element);\r\n\r\n          if (sequence.length === 1) {\r\n            lastProcessedFilter = element;\r\n          } else if (lastParentLogical !== nextElement.parentLogical) {\r\n            if (logicalArray.length === 1) {\r\n              console.log(\r\n                'You must set at ' +\r\n                  'least two operator in a logical (' +\r\n                  lastParentLogical +\r\n                  ')'\r\n              );\r\n            } else {\r\n              lastProcessedFilter = Object.assign(\r\n                {},\r\n                { logical: lastParentLogical, filters: logicalArray }\r\n              );\r\n              logicalArray = [lastProcessedFilter];\r\n              lastParentLogical = nextElement.parentLogical;\r\n            }\r\n          }\r\n        });\r\n        return lastProcessedFilter;\r\n      } else {\r\n        return undefined;\r\n      }\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\r\n    if (\r\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\r\n    ) {\r\n      return selectors;\r\n    }\r\n    let selector: IgoOgcSelector;\r\n    if (selectors.groups && selectors.bundles) {\r\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\r\n        throw new Error(\r\n          'You must set an id for each of your bundles'\r\n        );\r\n      }\r\n      selector = ObjectUtils.copyDeep(selectors);\r\n      selector.groups.forEach((group) => {\r\n        group.title = group.title ? group.title : group.name;\r\n        group.enabled = group.enabled ? group.enabled : false;\r\n        group.computedSelectors = ObjectUtils.copyDeep(\r\n          selector.bundles.filter((b) => group.ids.includes(b.id))\r\n        );\r\n      });\r\n    } else if (!selectors.groups && selectors.bundles) {\r\n      selector = ObjectUtils.copyDeep(selectors);\r\n      selector.groups = [\r\n        {\r\n          title: 'group1',\r\n          name: 'group1',\r\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\r\n        } as SelectorGroup\r\n      ];\r\n    } else {\r\n      selector = {\r\n        bundles: selectors as any,\r\n        groups: [\r\n          {\r\n            title: 'group1',\r\n            name: 'group1',\r\n            computedSelectors: ObjectUtils.copyDeep(\r\n              selectors\r\n            ) as OgcSelectorBundle[]\r\n          } as SelectorGroup\r\n        ],\r\n        selectorType: selector.selectorType\r\n      };\r\n    }\r\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\r\n      selector.groups[0].enabled = true;\r\n    }\r\n    return selector;\r\n  }\r\n\r\n  public handleOgcFiltersAppliedValue(\r\n    options: OgcFilterableDataSourceOptions,\r\n    fieldNameGeometry: string,\r\n    extent?: [number, number, number, number],\r\n    proj?: olProjection\r\n  ): string {\r\n    const ogcFilters = options.ogcFilters;\r\n    if (!ogcFilters) {\r\n      return;\r\n    }\r\n    const conditions = [];\r\n    let filterQueryStringSelector = '';\r\n    let filterQueryStringAdvancedFilters = '';\r\n    if (ogcFilters.enabled && (ogcFilters.pushButtons || ogcFilters.checkboxes || ogcFilters.radioButtons || ogcFilters.select)) {\r\n      let selectors;\r\n      if (ogcFilters.pushButtons) {\r\n        selectors = ogcFilters.pushButtons;\r\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\r\n        for (const condition of pushConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.checkboxes) {\r\n        selectors = ogcFilters.checkboxes;\r\n        const checkboxConditions = this.formatGroupAndFilter(ogcFilters, selectors);\r\n        for (const condition of checkboxConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.radioButtons) {\r\n        selectors = ogcFilters.radioButtons;\r\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\r\n        const radioConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\r\n        for (const condition of radioConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.select) {\r\n        selectors = ogcFilters.select;\r\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\r\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\r\n        for (const condition of selectConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n\r\n      if (conditions.length >= 1) {\r\n        filterQueryStringSelector = this.buildFilter(\r\n          conditions.length === 1\r\n            ? conditions[0]\r\n            : { logical: 'And', filters: conditions },\r\n          extent,\r\n          proj,\r\n          ogcFilters.geometryName\r\n        );\r\n      }\r\n    }\r\n    if (ogcFilters.enabled && ogcFilters.filters) {\r\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\r\n      const igoFilters = ogcFilters.filters;\r\n      filterQueryStringAdvancedFilters = this.buildFilter(\r\n        igoFilters,\r\n        extent,\r\n        proj,\r\n        ogcFilters.geometryName,\r\n        options\r\n      );\r\n    }\r\n\r\n    let filterQueryString = ogcFilters.advancedOgcFilters\r\n      ? filterQueryStringAdvancedFilters\r\n      : filterQueryStringSelector;\r\n    if (options.type === 'wms') {\r\n      filterQueryString = this.formatProcessedOgcFilter(\r\n        filterQueryString,\r\n        (options as any).params.LAYERS\r\n      );\r\n    }\r\n    if (options.type === 'wfs') {\r\n      filterQueryString = this.formatProcessedOgcFilter(\r\n        filterQueryString,\r\n        (options as any).params.featureTypes\r\n      );\r\n    }\r\n\r\n    return filterQueryString;\r\n  }\r\n\r\n  public verifyMultipleEnableds(selectors) {\r\n    selectors.bundles.forEach(bundle => {\r\n      if (!bundle.multiple) {\r\n        const enableds = bundle.selectors.reduce((list, filter, index) => (filter.enabled) === true ? list.concat(index) : list, []);\r\n        if (enableds.length > 1) {\r\n          enableds.splice(0, 1);\r\n          enableds.forEach(index => {\r\n            bundle.selectors[index].enabled = false;\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return selectors;\r\n  }\r\n\r\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\r\n    selectors = this.computeIgoSelector(\r\n      selectors\r\n    );\r\n    const selectorBundle = selectors.groups.find(\r\n      (g) => g.enabled\r\n    ).computedSelectors;\r\n    const conditions = [];\r\n    selectorBundle.map((bundle) => {\r\n      const bundleCondition = [];\r\n      const selectorsType = bundle.selectors as any;\r\n      if (!selectorsType) {\r\n        return;\r\n      }\r\n      selectorsType\r\n        .filter((ogcselector) => ogcselector.enabled === true)\r\n        .forEach((enabledSelector) => bundleCondition.push(enabledSelector.filters));\r\n      if (bundleCondition.length === 1) {\r\n        conditions.push(bundleCondition[0]);\r\n      } else if (bundleCondition.length > 1) {\r\n        conditions.push({\r\n          logical: bundle.logical,\r\n          filters: bundleCondition\r\n        });\r\n      }\r\n    });\r\n\r\n    if (selectors.selectorType === 'pushButton') {\r\n      ogcFilters.pushButtons = selectors;\r\n    } else if (selectors.selectorType === 'checkbox') {\r\n      ogcFilters.checkboxes = selectors;\r\n    } else if (selectors.selectorType === 'radioButton') {\r\n      ogcFilters.radioButtons = selectors;\r\n    } else if (selectors.selectorType === 'select') {\r\n      ogcFilters.select = selectors;\r\n    }\r\n    return conditions;\r\n  }\r\n\r\n  public formatProcessedOgcFilter(\r\n    processedFilter: string,\r\n    layersOrTypenames: string\r\n  ): string {\r\n    let appliedFilter = '';\r\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\r\n      appliedFilter = processedFilter;\r\n    } else {\r\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\r\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\r\n          'filter=',\r\n          ''\r\n        )})`;\r\n      });\r\n    }\r\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\r\n    const filterValue =\r\n      appliedFilter.length > 0\r\n        ? appliedFilter.replace('filter=', '')\r\n        : undefined;\r\n    return filterValue;\r\n  }\r\n\r\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\r\n    if (!value) {\r\n      return defaultValue;\r\n    } else if (moment(value).isValid()) {\r\n      return value;\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n}\r\n","export enum QueryFormat {\r\n  GML2 = 'gml2',\r\n  GML3 = 'gml3',\r\n  JSON = 'json',\r\n  GEOJSON = 'geojson',\r\n  GEOJSON2 = 'geojson2',\r\n  ESRIJSON = 'esrijson',\r\n  TEXT = 'text',\r\n  HTML = 'html',\r\n  HTMLGML2 = 'htmlgml2'\r\n}\r\n\r\nexport enum QueryFormatMimeType {\r\n  GML2 = 'application/vnd.ogc.gml',\r\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\r\n  JSON = 'application/json',\r\n  GEOJSON = 'application/geojson',\r\n  GEOJSON2 = 'geojson',\r\n  ESRIJSON = 'application/json',\r\n  TEXT = 'text/plain',\r\n  HTML = 'text/html',\r\n  HTMLGML2 = 'text/html'\r\n}\r\n\r\nexport enum QueryHtmlTarget {\r\n  IFRAME = 'iframe',\r\n  BLANK = '_blank'\r\n}\r\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\n\r\nimport * as OlFormat from 'ol/format';\r\nimport olFormatGML2 from 'ol/format/GML2';\r\nimport olFormatGML3 from 'ol/format/GML3';\r\nimport olFormatGML32 from 'ol/format/GML32';\r\nimport olFormatOSMXML from 'ol/format/OSMXML';\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nexport const defaultEpsg = 'EPSG:3857';\r\nexport const defaultMaxFeatures = 5000;\r\nexport const defaultWfsVersion = '2.0.0';\r\nexport const defaultFieldNameGeometry = 'geometry';\r\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\r\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\r\n\r\n\r\n/**\r\n * This method build the WFS URL based on the layer property.\r\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\r\n * @param extent  An extent like array [number, number, number, number]\r\n * @param proj  olProjection\r\n * @param ogcFilters  OgcFiltersOptions\r\n * @returns A string representing the datasource options, based on filter and views\r\n */\r\nexport function  buildUrl(options: WFSDataSourceOptions, extent, proj: olProjection, ogcFilters: OgcFiltersOptions): string {\r\n  const paramsWFS = options.paramsWFS;\r\n  const queryStringValues = formatWFSQueryString(options, undefined, options.paramsWFS.srsName);\r\n  let igoFilters;\r\n  if (ogcFilters && ogcFilters.enabled) {\r\n    igoFilters = ogcFilters.filters;\r\n  }\r\n  const ogcFilterWriter = new OgcFilterWriter();\r\n  const filterOrBox = ogcFilterWriter.buildFilter(igoFilters, extent, proj, ogcFilters.geometryName, options);\r\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(options, ogcFilters.geometryName, extent, proj);\r\n\r\n  let prefix = 'filter';\r\n  if (!filterOrPush) {\r\n    prefix = 'bbox';\r\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\r\n  }\r\n\r\n  paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters ? filterOrBox : `${prefix}=${filterOrPush}`;\r\n  let baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\r\n  const patternFilter = /(filter|bbox)=.*/gi;\r\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter) ? `${baseUrl}&${paramsWFS.xmlFilter}` : baseUrl;\r\n  options.download = Object.assign({}, options.download, { dynamicUrl: baseUrl });\r\n  return baseUrl.replace(/&&/g, '&');\r\n}\r\n\r\n\r\n/**\r\n * This method build/standardize WFS call query params based on the layer property.\r\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\r\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\r\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\r\n * @param properties  String: Used to control the queried fields  (WFS service).\r\n * @returns An array array of {name: '', value: ''} of predefined query params.\r\n */\r\nexport function formatWFSQueryString(\r\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\r\n  count?: number,\r\n  epsg?: string,\r\n  properties?: string,\r\n  startIndex: number = 0,\r\n  forceDefaultOutputFormat: boolean = false\r\n): { name: string; value: string }[] {\r\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\r\n  const url = dataSourceOptions.urlWfs;\r\n  const paramsWFS = dataSourceOptions.paramsWFS;\r\n  const effectiveCount = count || defaultMaxFeatures;\r\n  const effectiveStartIndex = paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\r\n  const epsgCode = epsg || defaultEpsg;\r\n  let outputFormat = paramsWFS.outputFormat\r\n    ? `outputFormat=${paramsWFS.outputFormat}`\r\n    : '';\r\n  let version = paramsWFS.version\r\n    ? `version=${paramsWFS.version}`\r\n    : `version=${defaultWfsVersion}`;\r\n  const paramTypename =\r\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\r\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\r\n  const paramMaxFeatures =\r\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\r\n  let cnt = count\r\n    ? `${paramMaxFeatures}=${effectiveCount}`\r\n    : paramsWFS.maxFeatures\r\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\r\n    : `${paramMaxFeatures}=${effectiveCount}`;\r\n  if (forceDefaultOutputFormat) {\r\n      outputFormat = '';\r\n      version = 'version=1.1.0';\r\n      cnt = cnt.replace('count', 'maxFeatures');\r\n    }\r\n\r\n  const srs = epsg\r\n    ? `srsname=${epsgCode}`\r\n    : paramsWFS.srsName\r\n    ? 'srsname=' + paramsWFS.srsName\r\n    : `srsname=${epsgCode}`;\r\n\r\n  let propertyName = '';\r\n  let valueReference = '';\r\n  if (properties) {\r\n    propertyName = `propertyName=${properties}`;\r\n    valueReference = `valueReference=${properties}`;\r\n  }\r\n  const sourceFields = dataSourceOptions.sourceFields;\r\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\r\n    const fieldsNames = [];\r\n    dataSourceOptions.sourceFields.forEach(sourcefield => {\r\n      fieldsNames.push(sourcefield.name);\r\n    });\r\n    propertyName = `propertyName=${fieldsNames.join(',')},${\r\n      paramsWFS.fieldNameGeometry\r\n    }`;\r\n  }\r\n\r\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\r\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\r\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\r\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\r\n\r\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\r\n  getpropertyvalue += `&${cnt}&${valueReference}`;\r\n\r\n  return [\r\n    { name: 'outputformat', value: outputFormat },\r\n    { name: 'version', value: version },\r\n    { name: 'typename', value: featureTypes },\r\n    { name: 'count', value: cnt },\r\n    { name: 'srsname', value: srs },\r\n    { name: 'propertyname', value: propertyName },\r\n    { name: 'valuereference', value: valueReference },\r\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\r\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\r\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\r\n  ];\r\n}\r\n\r\n/**\r\n * Validate/Modify layer's wfs options based on :\r\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\r\n * https://github.com/openlayers/openlayers/pull/6400\r\n * 2- Set default values for optionals parameters.\r\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\r\n * @returns An array array of {name: '', value: ''} of predefined query params.\r\n */\r\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\r\n  if (srcType && srcType === 'wfs') {\r\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\r\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\r\n  }\r\n\r\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\r\n  wfsDataSourceOptions.urlWfs =\r\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\r\n\r\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\r\n  paramsWFS.fieldNameGeometry =\r\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\r\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\r\n\r\n  let outputFormat;\r\n  if (paramsWFS.outputFormat) {\r\n    outputFormat = paramsWFS.outputFormat;\r\n  }\r\n\r\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\r\n    paramsWFS.version = '1.1.0';\r\n  }\r\n  return Object.assign({}, wfsDataSourceOptions);\r\n}\r\n\r\nexport function getFormatFromOptions(\r\n  options: WFSDataSourceOptions | WMSDataSourceOptions\r\n) {\r\n  const wfsOptions = options as WFSDataSourceOptions;\r\n\r\n  let olFormatCls;\r\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\r\n    ? wfsOptions.paramsWFS.outputFormat\r\n    : undefined;\r\n\r\n  if (!outputFormat) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  }\r\n\r\n  if (OlFormat[outputFormat]) {\r\n    olFormatCls = OlFormat[outputFormat];\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('gml2')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML2 }});\r\n  } else if (outputFormat.toLowerCase().match('gml32')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML32 }});\r\n  } else if (outputFormat.toLowerCase().match('gml3')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML3 }});\r\n  } else if (outputFormat.toLowerCase().match('topojson')) {\r\n    olFormatCls = OlFormat.TopoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('geojson')) {\r\n    olFormatCls = OlFormat.GeoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\r\n    olFormatCls = OlFormat.EsriJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('json')) {\r\n    olFormatCls = OlFormat.GeoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('gpx')) {\r\n    olFormatCls = OlFormat.GPX;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('WKT')) {\r\n    olFormatCls = OlFormat.WKT;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\r\n    olFormatCls = olFormatOSMXML;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('kml')) {\r\n    olFormatCls = OlFormat.KML;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  }\r\n\r\n  return new olFormatCls();\r\n}\r\n","import olSourceImageWMS from 'ol/source/ImageWMS';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\nimport { WFSService } from './wfs.service';\r\n\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\nimport {\r\n  formatWFSQueryString,\r\n  checkWfsParams,\r\n  defaultFieldNameGeometry\r\n} from './wms-wfs.utils';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/layer.interface';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { TimeFilterableDataSourceOptions, TimeFilterOptions } from '../../../filter/shared/time-filter.interface';\r\n\r\nexport class WMSDataSource extends DataSource {\r\n  public ol: olSourceImageWMS;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  set ogcFilters(value: OgcFiltersOptions) {\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\r\n  }\r\n  get ogcFilters(): OgcFiltersOptions {\r\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n  }\r\n\r\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\r\n\r\n  set timeFilter(value: TimeFilterOptions ) {\r\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\r\n  }\r\n  get timeFilter(): TimeFilterOptions {\r\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\r\n  }\r\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> = new BehaviorSubject(undefined);\r\n\r\n  constructor(\r\n    public options: WMSDataSourceOptions,\r\n    protected wfsService: WFSService\r\n  ) {\r\n    super(options);\r\n    const sourceParams: any = options.params;\r\n\r\n    const dpi = sourceParams.DPI || 96;\r\n    sourceParams.DPI = dpi;\r\n    sourceParams.MAP_RESOLUTION = dpi;\r\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\r\n\r\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\r\n      setInterval(() => {\r\n        this.refresh();\r\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\r\n    }\r\n\r\n    let fieldNameGeometry = defaultFieldNameGeometry;\r\n\r\n    // ####   START if paramsWFS\r\n    if (options.paramsWFS) {\r\n      const wfsCheckup = checkWfsParams(options, 'wms');\r\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\r\n\r\n      fieldNameGeometry =\r\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\r\n\r\n      options.download = Object.assign({}, options.download, {\r\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\r\n      });\r\n    } //  ####   END  if paramsWFS\r\n\r\n    if (!options.sourceFields || options.sourceFields.length === 0) {\r\n      options.sourceFields = [];\r\n    } else {\r\n      options.sourceFields.forEach(sourceField => {\r\n        sourceField.alias = sourceField.alias\r\n          ? sourceField.alias\r\n          : sourceField.name;\r\n        // to allow only a list of sourcefield with names\r\n      });\r\n    }\r\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\r\n      .ogcFilters;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (!initOgcFilters) {\r\n      (options as OgcFilterableDataSourceOptions).ogcFilters = ogcFilterWriter.defineOgcFiltersDefaultOptions(\r\n        initOgcFilters,\r\n        fieldNameGeometry,\r\n        'wms'\r\n      );\r\n    } else {\r\n      initOgcFilters.advancedOgcFilters = (initOgcFilters.pushButtons || initOgcFilters.checkboxes\r\n        || initOgcFilters.radioButtons || initOgcFilters.select)\r\n        ? false\r\n        : true;\r\n      if (initOgcFilters.pushButtons){\r\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\r\n      }\r\n      if (initOgcFilters.checkboxes){\r\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\r\n      }\r\n      if (initOgcFilters.radioButtons){\r\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\r\n      }\r\n      if (initOgcFilters.select){\r\n        initOgcFilters.select.selectorType = 'select';\r\n      }\r\n    }\r\n\r\n    if (\r\n      sourceParams.LAYERS.split(',').length > 1 &&\r\n      initOgcFilters &&\r\n      initOgcFilters.enabled\r\n    ) {\r\n      console.log('*******************************');\r\n      console.log(\r\n        'BE CAREFULL, YOUR WMS LAYERS (' +\r\n          sourceParams.LAYERS +\r\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\r\n      );\r\n      console.log('*******************************');\r\n    }\r\n\r\n    if (\r\n      options.paramsWFS &&\r\n      initOgcFilters &&\r\n      initOgcFilters.enabled &&\r\n      initOgcFilters.editable &&\r\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0) {\r\n      this.wfsService.getSourceFieldsFromWFS(options);\r\n    }\r\n\r\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n      options,\r\n      fieldNameGeometry\r\n    );\r\n    sourceParams.FILTER = filterQueryString;\r\n    this.setOgcFilters(initOgcFilters, true);\r\n\r\n    const timeFilterableDataSourceOptions = (options as TimeFilterableDataSourceOptions);\r\n    if (\r\n      timeFilterableDataSourceOptions?.timeFilterable &&\r\n      timeFilterableDataSourceOptions?.timeFilter) {\r\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\r\n    }\r\n  }\r\n\r\n  refresh() {\r\n    this.ol.updateParams({ igoRefresh: Math.random() });\r\n  }\r\n\r\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\r\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\r\n    const downloadUrl = queryStringValues.find(f => f.name === 'getfeature')\r\n      .value;\r\n    return downloadUrl;\r\n  }\r\n\r\n  protected createOlSource(): olSourceImageWMS {\r\n    return new olSourceImageWMS(Object.assign({ratio: 1}, this.options));\r\n  }\r\n\r\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\r\n    this.ogcFilters = ogcFilters;\r\n    if (triggerEvent) {\r\n      this.ogcFilters$.next(this.ogcFilters);\r\n    }\r\n  }\r\n\r\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\r\n    this.timeFilter = timeFilter;\r\n    if (triggerEvent) {\r\n      this.timeFilter$.next(this.timeFilter);\r\n    }\r\n  }\r\n\r\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\r\n    let legend = super.getLegend();\r\n    if (legend.length > 0 && (style === undefined && !view?.scale)) {\r\n      return legend;\r\n    }\r\n\r\n    let contentDependent = false;\r\n    let projParam;\r\n\r\n    if (view?.size && view?.extent && view?.projection && this.options.contentDependentLegend) {\r\n      projParam = this.params.VERSION === '1.3.0' || this.params.VERSION === undefined ? 'CRS' : 'SRS';\r\n      contentDependent = true;\r\n    }\r\n\r\n    const sourceParams = this.params;\r\n\r\n    let layers = [];\r\n    if (sourceParams.LAYERS !== undefined) {\r\n      layers = sourceParams.LAYERS.split(',');\r\n    }\r\n\r\n    const baseUrl = this.options.url.replace(/\\?$/, '');\r\n    const params = [\r\n      'REQUEST=GetLegendGraphic',\r\n      'SERVICE=WMS',\r\n      'FORMAT=image/png',\r\n      'SLD_VERSION=1.1.0',\r\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\r\n    ];\r\n    if (style !== undefined) {\r\n      params.push(`STYLE=${style}`);\r\n    }\r\n    if (view?.scale !== undefined) {\r\n      params.push(`SCALE=${view.scale}`);\r\n    }\r\n    if (contentDependent) {\r\n      params.push(`WIDTH=${view.size[0]}`);\r\n      params.push(`HEIGHT=${view.size[1]}`);\r\n      params.push(`BBOX=${view.extent.join(',')}`);\r\n      params.push(`${projParam}=${view.projection}`);\r\n    }\r\n\r\n    legend = layers.map((layer: string) => {\r\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\r\n      return {\r\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\r\n        title: layers.length > 1 ? layer : undefined,\r\n        currentStyle: style === undefined ? undefined : style as string\r\n      };\r\n    });\r\n\r\n    return legend;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import { Watcher } from '@igo2/utils';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport olLayer from 'ol/layer/Layer';\r\nimport olSource from 'ol/source/Source';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { DataSource } from '../../datasource/shared/datasources/datasource';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { LayersLink, LinkedProperties } from '../shared/layers/layer.interface';\r\nimport { OgcFilterableDataSource, OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport { TimeFilterableDataSource } from '../../filter/shared/time-filter.interface';\r\nimport { Subscription } from 'rxjs';\r\nimport { first } from 'rxjs/operators';\r\n\r\nexport class LayerSyncWatcher extends Watcher {\r\n    private ogcFilters$$: Subscription;\r\n    private timeFilter$$: Subscription;\r\n\r\n    private ol: olLayer<olSource>;\r\n    private layer: Layer;\r\n    private dataSource: DataSource;\r\n    private map: IgoMap;\r\n    private ogcFilterWriter;\r\n\r\n    constructor(layer: Layer, map: IgoMap) {\r\n        super();\r\n        this.ol = layer.ol;\r\n        this.layer = layer;\r\n        this.dataSource = layer.options.source;\r\n        this.map = map;\r\n        this.ogcFilterWriter = new OgcFilterWriter();\r\n    }\r\n\r\n    protected watch() {\r\n\r\n        this.ol.on('propertychange', evt => this.transferCommonProperties(evt));\r\n        if ((this.dataSource as OgcFilterableDataSource).ogcFilters$) {\r\n            this.ogcFilters$$ = (this.dataSource as OgcFilterableDataSource).ogcFilters$\r\n                .subscribe(ogcFilters => this.transferOgcFiltersProperties(ogcFilters));\r\n        }\r\n        if ((this.dataSource as TimeFilterableDataSource).timeFilter$) {\r\n            this.timeFilter$$ = (this.dataSource as TimeFilterableDataSource).timeFilter$\r\n                .subscribe(timeFilter => this.transferTimeFilterProperties(timeFilter));\r\n        }\r\n        this.syncChildLayers();\r\n    }\r\n\r\n    protected unwatch() {\r\n        this.ol.un('propertychange', evt => this.transferCommonProperties(evt));\r\n        if (this.ogcFilters$$) { this.ogcFilters$$.unsubscribe(); }\r\n        if (this.timeFilter$$) { this.timeFilter$$.unsubscribe(); }\r\n    }\r\n\r\n\r\n    private syncChildLayers() {\r\n        // Force the sync the child layers with parent on the first load.\r\n        if (!this.map) {\r\n            return;\r\n        }\r\n        this.map.status$\r\n            .pipe(first())\r\n            .subscribe(() => {\r\n                this.map.layers\r\n                    .filter(layer => layer.options.linkedLayers?.links)\r\n                    .map(layer => {\r\n                        layer.options.linkedLayers.links.map(link => {\r\n                            if (link.properties?.indexOf(LinkedProperties.VISIBLE) !== -1) {\r\n                                layer.ol.set('visible', !(layer.visible), false);\r\n                                layer.ol.set('visible', !(layer.visible), false);\r\n                                layer.visible = layer.visible;\r\n                            }\r\n                            if (link.properties?.indexOf(LinkedProperties.OPACITY) !== -1) {\r\n                                const baseOpacity = layer.ol.get('opacity');\r\n                                layer.ol.set('opacity', 0, false);\r\n                                layer.ol.set('opacity', baseOpacity, false);\r\n                                layer.opacity = layer.opacity;\r\n                            }\r\n                            if (link.properties?.indexOf(LinkedProperties.MINRESOLUTION) !== -1) {\r\n                                const baseMinResolution = layer.ol.get('minResolution');\r\n                                layer.ol.set('minResolution', 0, false);\r\n                                layer.ol.set('minResolution', baseMinResolution, false);\r\n                                layer.minResolution = layer.minResolution;\r\n                            }\r\n                            if (link.properties?.indexOf(LinkedProperties.MAXRESOLUTION) !== -1) {\r\n                                const baseMaxResolution = layer.ol.get('maxResolution');\r\n                                layer.ol.set('maxResolution', 0, false);\r\n                                layer.ol.set('maxResolution', baseMaxResolution, false);\r\n                                layer.minResolution = layer.minResolution;\r\n                            }\r\n                            if (link.properties?.indexOf(LinkedProperties.OGCFILTERS) !== -1) {\r\n                                const ogcFilters$ = (layer.dataSource as OgcFilterableDataSource).ogcFilters$;\r\n                                ogcFilters$.next(ogcFilters$.value);\r\n                            }\r\n                            if (link.properties?.indexOf(LinkedProperties.TIMEFILTER) !== -1) {\r\n                                const timeFilter$ = (layer.dataSource as TimeFilterableDataSource).timeFilter$;\r\n                                timeFilter$.next(timeFilter$.value);\r\n                            }\r\n                        });\r\n                    });\r\n            });\r\n    }\r\n\r\n    private transferCommonProperties(layerChange) {\r\n        const key = layerChange.key;\r\n        const layerChangeProperties = layerChange.target.getProperties();\r\n        const newValue = layerChangeProperties[key];\r\n\r\n        if (['visible', 'opacity', 'minResolution', 'maxResolution'].indexOf(key) === -1) {\r\n            return;\r\n        }\r\n        const linkedLayers = layerChangeProperties.linkedLayers as LayersLink;\r\n        if (!linkedLayers) {\r\n            return;\r\n        }\r\n        const currentLinkedId = linkedLayers.linkId;\r\n        const currentLinks = linkedLayers.links;\r\n        const isParentLayer = currentLinks ? true : false;\r\n\r\n        if (isParentLayer) {\r\n            // search for child layers\r\n            const silent = true;\r\n            currentLinks.map(link => {\r\n                if (!link.properties || link.properties.indexOf(key) === -1) {\r\n                    return;\r\n                }\r\n                link.linkedIds.map(linkedId => {\r\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\r\n                    if (layerToApply) {\r\n                        layerToApply.ol.set(key, newValue, silent);\r\n                        if (key === 'visible') {\r\n                            layerToApply.visible$.next(newValue);\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        } else {\r\n            // search for parent layer\r\n            const silent = false;\r\n            this.map.layers.map(layer => {\r\n                if (layer.options.linkedLayers?.links) {\r\n                    layer.options.linkedLayers.links.map(l => {\r\n                        if (l.properties && l.properties.indexOf(key) !== -1 &&\r\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\r\n                            layer.ol.set(key, newValue, silent);\r\n                            if (key === 'visible') {\r\n                                layer.visible$.next(newValue);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    private transferOgcFiltersProperties(ogcFilters) {\r\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\r\n        if (!linkedLayers) {\r\n            return;\r\n        }\r\n        const currentLinkedId = linkedLayers.linkId;\r\n        const currentLinks = linkedLayers.links;\r\n        const isParentLayer = currentLinks ? true : false;\r\n        if (isParentLayer) {\r\n            // search for child layers\r\n            currentLinks.map(link => {\r\n                if (!link.properties || link.properties.indexOf(LinkedProperties.OGCFILTERS) === -1) {\r\n                    return;\r\n                }\r\n                link.linkedIds.map(linkedId => {\r\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\r\n                    if (layerToApply) {\r\n                        const layerType = layerToApply.ol.getProperties().sourceOptions.type;\r\n                        (layerToApply.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, false);\r\n                        if (layerType === 'wfs') {\r\n                            layerToApply.ol.getSource().refresh();\r\n                        }\r\n                        if (layerType === 'wms') {\r\n                            let appliedOgcFilter;\r\n                            if (this.ol.getProperties().sourceOptions.type === 'wfs') {\r\n                                appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n                                    this.layer.dataSource.options as OgcFilterableDataSourceOptions,\r\n                                    (this.dataSource.options as any).fieldNameGeometry,\r\n                                    undefined,\r\n                                    this.map.viewController.getOlProjection()\r\n                                );\r\n                            } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\r\n                                appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\r\n                            }\r\n                            (layerToApply.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        } else {\r\n            // search for parent layer\r\n            this.map.layers.map(layer => {\r\n                if (layer.options.linkedLayers?.links) {\r\n                    layer.options.linkedLayers.links.map(l => {\r\n                        if (l.properties && l.properties.indexOf(LinkedProperties.OGCFILTERS) !== -1 &&\r\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\r\n                            const layerType = layer.ol.getProperties().sourceOptions.type;\r\n                            if (layerType === 'wfs') {\r\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\r\n                                layer.ol.getSource().refresh();\r\n                            }\r\n                            if (layerType === 'wms') {\r\n                                let appliedOgcFilter;\r\n                                if (this.ol.getProperties().sourceOptions.type === 'wfs') {\r\n                                    appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n                                        layer.dataSource.options as OgcFilterableDataSourceOptions,\r\n                                        (this.dataSource.options as any).fieldNameGeometry,\r\n                                        undefined,\r\n                                        this.map.viewController.getOlProjection()\r\n                                    );\r\n\r\n                                } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\r\n                                    appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\r\n                                }\r\n                                (layer.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\r\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    private transferTimeFilterProperties(timeFilter) {\r\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\r\n        if (!linkedLayers) {\r\n            return;\r\n        }\r\n        const currentLinkedId = linkedLayers.linkId;\r\n        const currentLinks = linkedLayers.links;\r\n        const isParentLayer = currentLinks ? true : false;\r\n        if (isParentLayer) {\r\n            // search for child layers\r\n            currentLinks.map(link => {\r\n                if (!link.properties || link.properties.indexOf(LinkedProperties.TIMEFILTER) === -1) {\r\n                    return;\r\n                }\r\n                link.linkedIds.map(linkedId => {\r\n                    const childLayer = this.map.layers.find(layer =>\r\n                        layer.dataSource instanceof WMSDataSource &&\r\n                        layer.options.linkedLayers?.linkId === linkedId);\r\n                    if (childLayer) {\r\n                        (childLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, false);\r\n                        const appliedTimeFilter = this.ol.get('values_').source.getParams().TIME;\r\n                        (childLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\r\n                    }\r\n                });\r\n            });\r\n        } else {\r\n            // search for parent layer\r\n            this.map.layers\r\n                .filter(layer => layer.dataSource instanceof WMSDataSource)\r\n                .map(parentLayer => {\r\n                    if (parentLayer.options.linkedLayers?.links) {\r\n                        parentLayer.options.linkedLayers.links.map(l => {\r\n                            if (l.properties && l.properties.indexOf(LinkedProperties.TIMEFILTER) !== -1 &&\r\n                                l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\r\n                                const appliedTimeFilter = this.ol.get('values_').source.getParams().TIME;\r\n                                (parentLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\r\n                                (parentLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, true);\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}\r\n","import olSourceTile from 'ol/source/Tile';\r\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\r\n\r\nimport { TileLayer } from '../shared/layers/tile-layer';\r\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\r\n\r\nexport class TileWatcher extends Watcher {\r\n  private id: string;\r\n  private loaded = 0;\r\n  private loading = 0;\r\n\r\n  private source: olSourceTile;\r\n\r\n  constructor(layer: TileLayer | VectorTileLayer) {\r\n    super();\r\n    this.source = layer.options.source.ol;\r\n    this.id = uuid();\r\n  }\r\n\r\n  protected watch() {\r\n    this.source.on(`tileloadstart`, e => this.handleLoadStart(e));\r\n    this.source.on(`tileloadend`, e => this.handleLoadEnd(e));\r\n    this.source.on(`tileloaderror`, e => this.handleLoadEnd(e));\r\n  }\r\n\r\n  protected unwatch() {\r\n    this.source.un(`tileloadstart`, e => this.handleLoadStart(e));\r\n    this.source.un(`tileloadend`, e => this.handleLoadEnd(e));\r\n    this.source.un(`tileloaderror`, e => this.handleLoadEnd(e));\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    // This is to avoid increasing\r\n    // the number of loaded tiles if a tile was loading\r\n    // before subscribing to this watcher\r\n    if (!event.tile.__watchers__) {\r\n      event.tile.__watchers__ = [];\r\n    }\r\n    event.tile.__watchers__.push(this.id);\r\n\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event) {\r\n    if (!event.tile.__watchers__) {\r\n      return;\r\n    }\r\n\r\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\r\n    if (watcherIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    event.tile.__watchers__.splice(watcherIndex, 1);\r\n\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport * as olformat from 'ol/format';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\r\n\r\nexport class FeatureDataSource extends DataSource {\r\n  public options: FeatureDataSourceOptions;\r\n  public ol: olSourceVector<OlGeometry>;\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    const sourceOptions = {\r\n      format: this.getSourceFormatFromOptions(this.options)\r\n    };\r\n\r\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\r\n  }\r\n\r\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\r\n    if (options.format) {\r\n      return options.format;\r\n    }\r\n    let olFormatCls;\r\n    const formatType = options.formatType;\r\n    if (!formatType) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    } else {\r\n      olFormatCls = olformat[formatType];\r\n      if (olFormatCls === undefined) {\r\n        throw new Error('Invalid vector source format ${formatType}.');\r\n      }\r\n    }\r\n\r\n    const formatOptions = options.formatOptions;\r\n    let format;\r\n    if (formatOptions) {\r\n      format = new olFormatCls(formatOptions);\r\n    } else {\r\n      format = new olFormatCls();\r\n    }\r\n\r\n    return format;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n}\r\n","import olSourceCluster from 'ol/source/Cluster';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { FeatureDataSource } from './feature-datasource';\r\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\r\n\r\nexport class ClusterDataSource extends FeatureDataSource {\r\n  public options: ClusterDataSourceOptions;\r\n  public ol: olSourceCluster;\r\n\r\n  protected createOlSource(): olSourceCluster {\r\n    this.options.format = this.getSourceFormatFromOptions(this.options);\r\n    this.options.source = super.createOlSource();\r\n    return new olSourceCluster(this.options);\r\n  }\r\n\r\n  protected generateId() {\r\n    return uuid();\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import { uuid, Watcher, SubjectStatus } from '@igo2/utils';\r\n\r\nimport { VectorLayer } from '../shared/layers/vector-layer';\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\n\r\nexport class VectorWatcher extends Watcher {\r\n  private id: string;\r\n  private loaded = 0;\r\n  private loading = 0;\r\n\r\n  private layer: VectorLayer;\r\n\r\n  constructor(layer: VectorLayer) {\r\n    super();\r\n    this.layer = layer;\r\n    this.id = uuid();\r\n  }\r\n\r\n  protected watch() {\r\n    let olSource = this.layer.options.source.ol;\r\n    if (this.layer.dataSource instanceof ClusterDataSource) {\r\n      olSource = (this.layer.options.source.options as any).source;\r\n     }\r\n\r\n    if (olSource.getUrl()) {\r\n      olSource.on(`featuresloadstart`, e => this.handleLoadStart(e));\r\n      olSource.on(`featuresloadend`, e => this.handleLoadEnd(e));\r\n      olSource.on(`featuresloaderror`, e => this.handleLoadEnd(e));\r\n    }\r\n\r\n  }\r\n\r\n  protected unwatch() {\r\n    let olSource = this.layer.options.source.ol;\r\n    if (this.layer.dataSource instanceof ClusterDataSource) {\r\n      olSource = (this.layer.options.source.options as any).source;\r\n     }\r\n    if (olSource.getUrl()) {\r\n      olSource.un(`featuresloadstart`, e => this.handleLoadStart(e));\r\n      olSource.un(`featuresloadend`, e => this.handleLoadEnd(e));\r\n      olSource.un(`featuresloaderror`, e => this.handleLoadEnd(e));\r\n    }\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event: any) {\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import * as olproj from 'ol/proj';\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { MAC } from 'ol/has';\r\n\r\nimport { MapViewState } from './map.interface';\r\nimport { Projection } from './projection.interfaces';\r\n\r\n/**\r\n * This method extracts a coordinate tuple from a string.\r\n * @param str Any string\r\n * @param mapProjection string Map Projection\r\n * @param opts.forceNA boolean Force North America Zone\r\n * @returns object:\r\n *             lonLat: Coordinate,\r\n *             message: Message of error,\r\n *             radius: radius of the confience of coordinate,\r\n *             conf: confidence of the coordinate}\r\n */\r\nexport function stringToLonLat(\r\n  str: string,\r\n  mapProjection: string,\r\n  opts: { forceNA?: boolean } = {}\r\n): {\r\n  lonLat: [number, number] | undefined;\r\n  message: string;\r\n  radius: number | undefined;\r\n  conf: number | undefined;\r\n} {\r\n  let lonLat: [number, number];\r\n  let coordStr: string;\r\n  let negativeLon: string;\r\n  let degreesLon: string;\r\n  let minutesLon: string;\r\n  let secondsLon: string;\r\n  let directionLon: string;\r\n  let decimalLon: string;\r\n  let negativeLat: string;\r\n  let degreesLat: string;\r\n  let minutesLat: string;\r\n  let secondsLat: string;\r\n  let directionLat: string;\r\n  let decimalLat: string;\r\n  let zone: string;\r\n  let radius: string;\r\n  let conf: string;\r\n  let lon: any;\r\n  let lat: any;\r\n\r\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\r\n  const toProjection = '4326';\r\n  let projectionStr: string;\r\n  const projectionRegex = new RegExp(projectionPattern, 'g');\r\n\r\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\r\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\r\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\r\n\r\n  const dmsCoord =\r\n    '([0-9]{1,2})[:|]?\\\\s*([0-9]{1,2})?[:|\\'||]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"||]?\\\\s*';\r\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\r\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\r\n\r\n  const patternUtm =\r\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\r\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\r\n\r\n  const patternMtm =\r\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\r\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\r\n\r\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\r\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\r\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\r\n\r\n  const dmdCoord =\r\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\r\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\r\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\r\n\r\n  // tslint:disable:max-line-length\r\n  const patternBELL =\r\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\r\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\r\n\r\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\r\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\r\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\r\n\r\n  let isXYCoords = false;\r\n\r\n  str = str.toLocaleUpperCase().trim();\r\n\r\n  // Extract projection\r\n  if (projectionRegex.test(str)) {\r\n    [coordStr, projectionStr] = str.split(';').map(s => s.trim());\r\n  } else {\r\n    coordStr = str;\r\n  }\r\n  if (lonLatRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      lon,\r\n      ,\r\n      decimalLon,\r\n      negativeLat,\r\n      lat,\r\n      ,\r\n      decimalLat\r\n    ] = coordStr.match(lonLatPattern);\r\n\r\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\r\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\r\n  } else if (dmsRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      directionLon,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      directionLat\r\n    ] = coordStr.match(dmsCoordPattern);\r\n\r\n    if (directionLon === 'S' || directionLon === 'N') {\r\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\r\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\r\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\r\n      directionLon = [directionLat, (directionLat = directionLon)][0];\r\n    }\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat(degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat(degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (utmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\r\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\r\n    [lon, lat] = olproj.transform(\r\n      [parseFloat(lon), parseFloat(lat)],\r\n      epsgUtm,\r\n      'EPSG:4326'\r\n    );\r\n  } else if (mtmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\r\n    const epsgMtm =\r\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\r\n    [lon, lat] = olproj.transform(\r\n      [parseFloat(lon), parseFloat(lat)],\r\n      epsgMtm,\r\n      'EPSG:4326'\r\n    );\r\n  } else if (dmdRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      decimalLon,\r\n      negativeLat,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      decimalLat\r\n    ] = coordStr.match(patternDmd);\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (ddRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      degreesLon,\r\n      decimalLon,\r\n      negativeLat,\r\n      degreesLat,\r\n      decimalLat\r\n    ] = coordStr.match(patternDd);\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (bellRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLat,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      ,\r\n      directionLat,\r\n      negativeLon,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      ,\r\n      directionLon,\r\n      radius,\r\n      conf\r\n    ] = coordStr.match(patternBELL);\r\n\r\n    // Set default value for North America\r\n    if (!directionLon) {\r\n      directionLon = 'W';\r\n    }\r\n\r\n    // Check if real minutes or decimals\r\n    if (minutesLon && minutesLon.length > 2) {\r\n      lon = parseFloat(\r\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\r\n      );\r\n    } else {\r\n      lon = convertDMSToDD(\r\n        parseFloat(degreesLon),\r\n        parseFloat(minutesLon),\r\n        parseFloat(secondsLon),\r\n        directionLon\r\n      );\r\n    }\r\n\r\n    if (minutesLat && minutesLat.length > 2) {\r\n      lat = parseFloat(\r\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\r\n      );\r\n    } else {\r\n      lat = convertDMSToDD(\r\n        parseFloat(degreesLat),\r\n        parseFloat(minutesLat),\r\n        parseFloat(secondsLat),\r\n        directionLat\r\n      );\r\n    }\r\n  } else if (mmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\r\n\r\n    if (decimalLon) {\r\n      lon = parseFloat(lon + '.' + decimalLon);\r\n    }\r\n\r\n    if (decimalLat) {\r\n      lat = parseFloat(lat + '.' + decimalLat);\r\n    }\r\n  } else {\r\n    return {\r\n      lonLat: undefined,\r\n      message: '',\r\n      radius: undefined,\r\n      conf: undefined\r\n    };\r\n  }\r\n\r\n  if (opts.forceNA && !isXYCoords) {\r\n    // Set a negative coordinate for North America zone\r\n    if (lon > 0 && lat > 0) {\r\n      if (lon > lat) {\r\n        lon = -lon;\r\n      } else {\r\n        lat = -lat;\r\n      }\r\n    }\r\n\r\n    // Reverse coordinate to respect lonLat convention\r\n    if (lon > lat) {\r\n      lon = [lat, (lat = lon)][0];\r\n    }\r\n  }\r\n\r\n  lonLat = [Number(lon), Number(lat)] as [number, number];\r\n\r\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\r\n  if (\r\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\r\n    (lonLat[0] > 180 || lonLat[0] < -180) ||\r\n    (lonLat[1] > 90 || lonLat[1] < -90)\r\n  ) {\r\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\r\n    const dest = 'EPSG:' + toProjection;\r\n\r\n    try {\r\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\r\n    } catch (e) {\r\n      return {\r\n        lonLat: undefined,\r\n        message: 'Projection ' + source + ' not supported',\r\n        radius: undefined,\r\n        conf: undefined\r\n      };\r\n    }\r\n  }\r\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\r\n    return {\r\n      lonLat,\r\n      message: '',\r\n      radius: radius ? parseInt(radius, 10) : undefined,\r\n      conf: conf ? parseInt(conf, 10) : undefined\r\n    };\r\n  } else {\r\n    return {\r\n      lonLat: undefined,\r\n      message: 'Coordinate out of Longitude/Latitude bounds',\r\n      radius: undefined,\r\n      conf: undefined\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Convert degrees minutes seconds to dd\r\n * @param degrees Degrees\r\n * @param minutes Minutes\r\n * @param seconds Seconds\r\n * @param direction Direction\r\n */\r\nfunction convertDMSToDD(\r\n  degrees: number,\r\n  minutes: number,\r\n  seconds: number,\r\n  direction: string\r\n) {\r\n  minutes = minutes || 0;\r\n  seconds = seconds || 0;\r\n\r\n  const neg = degrees < 0;\r\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\r\n\r\n  if (neg || direction === 'S' || direction === 'W') {\r\n    dd = -dd;\r\n  } // Don't do anything for N or E\r\n  return dd;\r\n}\r\n\r\n/**\r\n * Convert dd to degrees minutes seconds\r\n * @param lonLatDD longitude and latitude in dd\r\n * @param decimal number of decimals for seconds\r\n * @returns longitude and latitude in dms\r\n */\r\nexport function convertDDToDMS(\r\n  lonLatDD: [number, number], decimal: number = 3\r\n): string[] {\r\n  const lonLatDMS = [];\r\n\r\n  lonLatDD.forEach(dd => {\r\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\r\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\r\n    const minutes =  Math.floor(int);\r\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\r\n\r\n    lonLatDMS.push(`${degrees} ${minutes}' ${seconds}\"`);\r\n  });\r\n  return lonLatDMS;\r\n}\r\n\r\n/**\r\n * Return true of two view states are equal.\r\n * @param state1 View state\r\n * @param state2 View state\r\n * @returns True if the view states are equal\r\n */\r\nexport function viewStatesAreEqual(\r\n  state1: MapViewState,\r\n  state2: MapViewState\r\n): boolean {\r\n  if (state1 === undefined || state2 === undefined) {\r\n    return false;\r\n  }\r\n\r\n  const tolerance = 1 / 10000;\r\n  return (\r\n    state1.zoom === state2.zoom &&\r\n    Math.trunc(state1.center[0] / tolerance) ===\r\n      Math.trunc(state2.center[0] / tolerance) &&\r\n    Math.trunc(state1.center[1] / tolerance) ===\r\n      Math.trunc(state2.center[1] / tolerance)\r\n  );\r\n}\r\n\r\n/**\r\n * Format the scale to a human readable text\r\n * @param Scale of the map\r\n * @returns Human readable scale text\r\n */\r\nexport function formatScale(scale) {\r\n  scale = Math.round(scale);\r\n  if (scale < 10000) {\r\n    return scale + '';\r\n  }\r\n\r\n  scale = Math.round(scale / 1000);\r\n  if (scale < 1000) {\r\n    return scale + 'K';\r\n  }\r\n\r\n  scale = Math.round(scale / 1000);\r\n  return scale + 'M';\r\n}\r\n\r\n/**\r\n * Return the resolution from a scale denom\r\n * @param scale Scale denom\r\n * @param dpi DPI\r\n * @returns Resolution\r\n */\r\nexport function getResolutionFromScale(\r\n  scale: number,\r\n  dpi: number = 96\r\n): number {\r\n  const inchesPerMeter = 39.3701;\r\n  return scale / (inchesPerMeter * dpi);\r\n}\r\n\r\n/**\r\n * Return the resolution from a scale denom\r\n * @param Scale denom\r\n * @returns Resolution\r\n */\r\nexport function getScaleFromResolution(\r\n  resolution: number,\r\n  unit: string = 'm',\r\n  dpi: number = 96\r\n): number {\r\n  const inchesPerMeter = 39.3701;\r\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\r\n}\r\n\r\n/**\r\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\r\n * @param event OL MapBrowserPointerEvent\r\n * @returns Whether the CTRL key is pushed\r\n */\r\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\r\n  const originalEvent = event.originalEvent;\r\n  return (\r\n    !originalEvent.altKey &&\r\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\r\n    !originalEvent.shiftKey\r\n  );\r\n}\r\n\r\nexport function roundCoordTo(coord: [number, number], decimal: number = 3) {\r\n  return [coord[0].toFixed(decimal), coord[1].toFixed(decimal)];\r\n}\r\n\r\n/**\r\n * Returns an array of converted coordinates.\r\n * Conversion is done for every configured projections\r\n * and for the current UTM zone and MTM zone.\r\n * @param lonLat [number, number] array of the coordinate to transform.\r\n * @param projections  Projection[] Array of destination projection.\r\n * @returns Returns an array of converted coordinates.\r\n */\r\nexport function lonLatConversion(\r\n  lonLat: [number, number],\r\n  projections: Projection[]\r\n): {\r\n  code: string;\r\n  alias: string;\r\n  coord: [number, number];\r\n  igo2CoordFormat: string;\r\n}[] {\r\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [number, number];\r\n  const convertedLonLat = [\r\n    {\r\n      code: 'EPSG:3857',\r\n      alias: 'Web Mercator',\r\n      coord: rawCoord3857,\r\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\r\n    }\r\n  ];\r\n\r\n  // detect the current utm zone.\r\n  const utmZone = utmZoneFromLonLat(lonLat);\r\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n  const utmName = `UTM-${utmZone}`;\r\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [number, number];\r\n  convertedLonLat.push({\r\n    code: epsgUtm,\r\n    alias: 'UTM',\r\n    coord: rawCoordUtm,\r\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\r\n  });\r\n\r\n  // detect the current mtm zone.\r\n  const mtmZone = mtmZoneFromLonLat(lonLat);\r\n  if (mtmZone) {\r\n    const epsgMtm =\r\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n    const mtmName = `MTM-${mtmZone}`;\r\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [number, number];\r\n    convertedLonLat.push({\r\n      code: epsgMtm,\r\n      alias: 'MTM',\r\n      coord: rawCoordMtm,\r\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\r\n    });\r\n  }\r\n\r\n  projections.forEach(projection => {\r\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [number, number];\r\n    const numericEpsgCode = projection.code.split(':')[1];\r\n    convertedLonLat.push({\r\n      code: projection.code,\r\n      alias: projection.alias || projection.code,\r\n      coord: rawCoord,\r\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\r\n        ', '\r\n      )} ; ${numericEpsgCode}`\r\n    });\r\n  });\r\n\r\n  return convertedLonLat;\r\n}\r\n\r\n/**\r\n * Detect the current utm zone of the lon/lat coordinate.\r\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\r\n * @returns number The UTM zone.\r\n */\r\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\r\n  return Math.ceil((lonLat[0] + 180) / 6);\r\n}\r\n\r\n/**\r\n * Detect the current mtm zone of the lon/lat coordinate.\r\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\r\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\r\n */\r\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\r\n  const long = lonLat[0];\r\n  let mtmZone;\r\n  if (long < -51 && long > -54) {\r\n    mtmZone = 1;\r\n  }\r\n  if (long < -54 && long > -57) {\r\n    mtmZone = 2;\r\n  }\r\n  if (long < -57 && long > -60) {\r\n    mtmZone = 3;\r\n  }\r\n  if (long < -60 && long > -63) {\r\n    mtmZone = 4;\r\n  }\r\n  if (long < -63 && long > -66) {\r\n    mtmZone = 5;\r\n  }\r\n  if (long < -66 && long > -69) {\r\n    mtmZone = 6;\r\n  }\r\n  if (long < -69 && long > -72) {\r\n    mtmZone = 7;\r\n  }\r\n  if (long < -72 && long > -75) {\r\n    mtmZone = 8;\r\n  }\r\n  if (long < -75 && long > -78) {\r\n    mtmZone = 9;\r\n  }\r\n  if (long < -78 && long > -81) {\r\n    mtmZone = 10;\r\n  }\r\n  return mtmZone;\r\n}\r\n","import {\r\n  BehaviorSubject,\r\n  Observable,\r\n  Subject,\r\n  Subscription,\r\n  combineLatest\r\n} from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport olLayer from 'ol/layer/Layer';\r\nimport olSource from 'ol/source/Source';\r\n\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport { DataSource, Legend } from '../../../datasource';\r\nimport { IgoMap } from '../../../map/shared/map';\r\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\r\n\r\nimport { LayerOptions } from './layer.interface';\r\nimport { LayerSyncWatcher } from '../../utils/layerSync-watcher';\r\nimport { Message, MessageService } from '@igo2/core';\r\n\r\nexport abstract class Layer {\r\n  public collapsed: boolean;\r\n  public dataSource: DataSource;\r\n  public legend: Legend[];\r\n  public legendCollapsed: boolean = true;\r\n  public firstLoadComponent: boolean = true;\r\n  public map: IgoMap;\r\n  public ol: olLayer<olSource>;\r\n  public olLoadingProblem: boolean = false;\r\n  public status$: Subject<SubjectStatus>;\r\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\r\n  private hasBeenVisible$$: Subscription;\r\n  private resolution$$: Subscription;\r\n\r\n  get id(): string {\r\n    return this.options.id || this.dataSource.id;\r\n  }\r\n\r\n  get alias(): string {\r\n    return this.options.alias;\r\n  }\r\n\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  set title(title: string) {\r\n    this.options.title = title;\r\n  }\r\n\r\n  get zIndex(): number {\r\n    return this.ol.getZIndex();\r\n  }\r\n\r\n  set zIndex(zIndex: number) {\r\n    this.ol.setZIndex(zIndex);\r\n  }\r\n\r\n  get baseLayer(): boolean {\r\n    return this.options.baseLayer;\r\n  }\r\n\r\n  set baseLayer(baseLayer: boolean) {\r\n    this.options.baseLayer = baseLayer;\r\n  }\r\n\r\n  get opacity(): number {\r\n    return this.ol.get('opacity');\r\n  }\r\n\r\n  set opacity(opacity: number) {\r\n    this.ol.setOpacity(opacity);\r\n  }\r\n\r\n  set isInResolutionsRange(value: boolean) {\r\n    this.isInResolutionsRange$.next(value);\r\n  }\r\n  get isInResolutionsRange(): boolean {\r\n    return this.isInResolutionsRange$.value;\r\n  }\r\n  readonly isInResolutionsRange$: BehaviorSubject<\r\n    boolean\r\n  > = new BehaviorSubject(false);\r\n\r\n  set maxResolution(value: number) {\r\n    this.ol.setMaxResolution(value || Infinity);\r\n    this.updateInResolutionsRange();\r\n  }\r\n  get maxResolution(): number {\r\n    return this.ol.getMaxResolution();\r\n  }\r\n\r\n  set minResolution(value: number) {\r\n    this.ol.setMinResolution(value || 0);\r\n    this.updateInResolutionsRange();\r\n  }\r\n  get minResolution(): number {\r\n    return this.ol.getMinResolution();\r\n  }\r\n\r\n  set visible(value: boolean) {\r\n    this.ol.setVisible(value);\r\n    this.visible$.next(value);\r\n    if (!this.hasBeenVisible$.value && value && this.messageService){\r\n      this.hasBeenVisible$.next(value);\r\n    }\r\n  }\r\n  get visible(): boolean {\r\n    return this.visible$.value;\r\n  }\r\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\r\n\r\n  get displayed(): boolean {\r\n    return this.visible && this.isInResolutionsRange;\r\n  }\r\n  readonly displayed$: Observable<boolean> = combineLatest([\r\n    this.isInResolutionsRange$,\r\n    this.visible$\r\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\r\n\r\n  get showInLayerList(): boolean {\r\n    return this.options.showInLayerList !== false;\r\n  }\r\n\r\n  private layerSyncWatcher: LayerSyncWatcher;\r\n\r\n  constructor(\r\n    public options: LayerOptions,\r\n    protected messageService?: MessageService,\r\n    protected authInterceptor?: AuthInterceptor\r\n  ) {\r\n    this.dataSource = options.source;\r\n\r\n    this.ol = this.createOlLayer();\r\n    if (options.zIndex !== undefined) {\r\n      this.zIndex = options.zIndex;\r\n    }\r\n\r\n    if (options.baseLayer && options.visible === undefined) {\r\n      options.visible = false;\r\n    }\r\n\r\n    this.maxResolution = options.maxResolution || getResolutionFromScale(Number(options.maxScaleDenom));\r\n    this.minResolution = options.minResolution || getResolutionFromScale(Number(options.minScaleDenom));\r\n\r\n    this.visible = options.visible === undefined ? true : options.visible;\r\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\r\n\r\n    if (\r\n      options.legendOptions &&\r\n      (options.legendOptions.url || options.legendOptions.html)\r\n    ) {\r\n      this.legend = this.dataSource.setLegend(options.legendOptions);\r\n    }\r\n\r\n    this.legendCollapsed = options.legendOptions\r\n      ? options.legendOptions.collapsed\r\n        ? options.legendOptions.collapsed\r\n        : true\r\n      : true;\r\n\r\n    this.ol.set('_layer', this, true);\r\n  }\r\n\r\n  protected abstract createOlLayer(): olLayer<olSource>;\r\n\r\n  setMap(igoMap: IgoMap | undefined) {\r\n    this.map = igoMap;\r\n\r\n    this.unobserveResolution();\r\n    if (igoMap !== undefined) {\r\n      this.observeResolution();\r\n      this.layerSyncWatcher = new LayerSyncWatcher(this, this.map);\r\n      this.layerSyncWatcher.subscribe(() => {});\r\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\r\n        if (this.options.messages && this.visible) {\r\n          this.options.messages.map(message => {\r\n            message.title = message.title;\r\n            message.text = message.text;\r\n            this.messageService.message(message as Message);\r\n          });\r\n        }\r\n      });\r\n    } else {\r\n      this.layerSyncWatcher.unsubscribe();\r\n    }\r\n  }\r\n\r\n  private observeResolution() {\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\r\n      this.updateInResolutionsRange()\r\n    );\r\n  }\r\n\r\n  private unobserveResolution() {\r\n    if (this.resolution$$ !== undefined) {\r\n      this.resolution$$.unsubscribe();\r\n      this.resolution$$ = undefined;\r\n    }\r\n  }\r\n\r\n  private updateInResolutionsRange() {\r\n    if (this.map !== undefined) {\r\n      const resolution = this.map.viewController.getResolution();\r\n      const minResolution = this.minResolution;\r\n      const maxResolution = this.maxResolution === undefined ? Infinity : this.maxResolution;\r\n      this.isInResolutionsRange = resolution >= minResolution && resolution <= maxResolution;\r\n    } else {\r\n      this.isInResolutionsRange = false;\r\n    }\r\n  }\r\n}\r\n","import olLayerVector from 'ol/layer/Vector';\r\nimport olSourceVector from 'ol/source/Vector';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { easeOut } from 'ol/easing';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\nimport { getVectorContext } from 'ol/render';\r\nimport FormatType from 'ol/format/FormatType';\r\nimport olFeature from 'ol/Feature';\r\nimport olProjection from 'ol/proj/Projection';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\r\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\r\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\r\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\r\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\r\n\r\nimport { VectorWatcher } from '../../utils';\r\nimport { IgoMap } from '../../../map';\r\nimport { Layer } from './layer';\r\nimport { VectorLayerOptions } from './vector-layer.interface';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { MessageService } from '@igo2/core';\r\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport { buildUrl, defaultMaxFeatures } from '../../../datasource/shared/datasources/wms-wfs.utils';\r\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\r\nexport class VectorLayer extends Layer {\r\n  public dataSource:\r\n    | FeatureDataSource\r\n    | WFSDataSource\r\n    | ArcGISRestDataSource\r\n    | WebSocketDataSource\r\n    | ClusterDataSource;\r\n  public options: VectorLayerOptions;\r\n  public ol: olLayerVector<olSourceVector<OlGeometry>>;\r\n  private watcher: VectorWatcher;\r\n  private trackFeatureListenerId;\r\n\r\n  get browsable(): boolean {\r\n    return this.options.browsable !== false;\r\n  }\r\n\r\n  get exportable(): boolean {\r\n    return this.options.exportable !== false;\r\n  }\r\n\r\n  constructor(\r\n    options: VectorLayerOptions,\r\n    public messageService?: MessageService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(options, messageService, authInterceptor);\r\n    this.watcher = new VectorWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceVector<OlGeometry>\r\n    });\r\n\r\n    if (this.options.animation) {\r\n      this.dataSource.ol.on(\r\n        'addfeature',\r\n        function(e) {\r\n          this.flash(e.feature);\r\n        }.bind(this)\r\n      );\r\n    }\r\n\r\n    if (this.options.trackFeature) {\r\n      this.enableTrackFeature(this.options.trackFeature);\r\n    }\r\n\r\n    const vector = new olLayerVector(olOptions);\r\n    // const vectorSource = (this.dataSource instanceof ClusterDataSource\r\n    //   ? vector.getSource().\r\n    //   : vector.getSource()) as olSourceVector<OlGeometry>;\r\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\r\n    const url = vectorSource.getUrl();\r\n    if (url) {\r\n      let loader;\r\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\r\n      if (wfsOptions?.type === 'wfs' && (wfsOptions.params || wfsOptions.paramsWFS)) {\r\n        loader = (extent, resolution, proj, success, failure) => {\r\n          this.customWFSLoader(\r\n            vectorSource,\r\n            wfsOptions,\r\n            this.authInterceptor,\r\n            extent,\r\n            resolution,\r\n            proj,\r\n            success,\r\n            failure\r\n          );\r\n        };\r\n      } else {\r\n        loader = (extent, resolution, proj, success, failure) => {\r\n          this.customLoader(\r\n            vectorSource,\r\n            url,\r\n            this.authInterceptor,\r\n            extent,\r\n            resolution,\r\n            proj,\r\n            success,\r\n            failure\r\n          );\r\n        };\r\n      }\r\n      if (loader) {\r\n        vectorSource.setLoader(loader);\r\n      }\r\n    }\r\n    return vector;\r\n  }\r\n\r\n  protected flash(feature) {\r\n    const start = new Date().getTime();\r\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\r\n\r\n    function animate(event) {\r\n      const vectorContext = getVectorContext(event);\r\n      const frameState = event.frameState;\r\n      const flashGeom = feature.getGeometry().clone();\r\n      const elapsed = frameState.time - start;\r\n      const elapsedRatio = elapsed / this.options.animation.duration;\r\n      const opacity = easeOut(1 - elapsedRatio);\r\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\r\n      newColor[3] = opacity;\r\n      let style = this.ol\r\n        .getStyleFunction()\r\n        .call(this, feature)\r\n        .find((style2) => {\r\n          return style2.getImage();\r\n        });\r\n      if (!style) {\r\n        style = this.ol.getStyleFunction().call(this, feature)[0];\r\n      }\r\n      const styleClone = style.clone();\r\n\r\n      switch (feature.getGeometry().getType()) {\r\n        case 'Point':\r\n          const radius =\r\n            easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\r\n          styleClone.getImage().setRadius(radius);\r\n          styleClone.getImage().setOpacity(opacity);\r\n          break;\r\n        case 'LineString':\r\n          // TODO\r\n          if (styleClone.getImage()) {\r\n            styleClone.getImage().getStroke().setColor(newColor);\r\n            styleClone\r\n              .getImage()\r\n              .getStroke()\r\n              .setWidth(\r\n                easeOut(elapsedRatio) *\r\n                  (styleClone.getImage().getStroke().getWidth() * 3)\r\n              );\r\n          }\r\n          if (styleClone.getStroke()) {\r\n            styleClone.getStroke().setColor(newColor);\r\n            styleClone\r\n              .getStroke()\r\n              .setWidth(\r\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\r\n              );\r\n          }\r\n          break;\r\n        case 'Polygon':\r\n          // TODO\r\n          if (styleClone.getImage()) {\r\n            styleClone.getImage().getFill().setColor(newColor);\r\n          }\r\n          if (styleClone.getFill()) {\r\n            styleClone.getFill().setColor(newColor);\r\n          }\r\n          break;\r\n      }\r\n\r\n      styleClone.setText('');\r\n      vectorContext.setStyle(styleClone);\r\n      vectorContext.drawGeometry(flashGeom);\r\n\r\n      if (elapsed > this.options.animation.duration) {\r\n        unByKey(listenerKey);\r\n        // remove last geometry\r\n        // there is a little flash before feature disappear, better solution ?\r\n        this.map.ol.render();\r\n        return;\r\n      }\r\n      // tell OpenLayers to continue postcompose animation\r\n      this.map.ol.render();\r\n    }\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n\r\n  public onUnwatch() {\r\n    this.dataSource.onUnwatch();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  public stopAnimation() {\r\n    this.dataSource.ol.un(\r\n      'addfeature',\r\n      function(e) {\r\n        if (this.visible) {\r\n          this.flash(e.feature);\r\n        }\r\n      }.bind(this)\r\n    );\r\n  }\r\n\r\n  public enableTrackFeature(id: string | number) {\r\n    this.trackFeatureListenerId = this.dataSource.ol.on(\r\n      'addfeature',\r\n      this.trackFeature.bind(this, id)\r\n    );\r\n  }\r\n  public centerMapOnFeature(id: string | number) {\r\n    const feat = this.dataSource.ol.getFeatureById(id);\r\n    if (feat) {\r\n      this.map.ol.getView().setCenter(feat.getGeometry().getCoordinates());\r\n    }\r\n  }\r\n\r\n  public trackFeature(id, feat) {\r\n    if (feat.feature.getId() === id && this.visible) {\r\n      this.centerMapOnFeature(id);\r\n    }\r\n  }\r\n\r\n  public disableTrackFeature(id?: string | number) {\r\n    unByKey(this.trackFeatureListenerId);\r\n  }\r\n\r\n  /**\r\n   * Custom loader for a WFS datasource\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param options olOptions from source\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param resolution the current resolution\r\n   * @param proj the projection to retrieve the data\r\n   * @param success success callback\r\n   * @param failure failure callback\r\n   */\r\n  private customWFSLoader(\r\n    vectorSource,\r\n    options,\r\n    interceptor,\r\n    extent,\r\n    resolution,\r\n    proj,\r\n    success,\r\n    failure\r\n  ) {\r\n    {\r\n      const paramsWFS = options.paramsWFS;\r\n      const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\r\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\r\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\r\n      const url = buildUrl(\r\n        options,\r\n        currentExtent,\r\n        wfsProj,\r\n        (options as OgcFilterableDataSourceOptions).ogcFilters);\r\n      let startIndex = 0;\r\n      if (paramsWFS.version === '2.0.0' && paramsWFS.maxFeatures > defaultMaxFeatures) {\r\n        const nbOfFeature = 1000;\r\n        while (startIndex < paramsWFS.maxFeatures) {\r\n          let alteredUrl = url.replace('count=' + paramsWFS.maxFeatures, 'count=' + nbOfFeature);\r\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\r\n          alteredUrl += '&startIndex=' + startIndex;\r\n          alteredUrl.replace(/&&/g, '&');\r\n          this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, alteredUrl, nbOfFeature, success, failure);\r\n          startIndex += nbOfFeature;\r\n        }\r\n      } else {\r\n        this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, url, paramsWFS.maxFeatures, success, failure);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Custom loader to get feature from a WFS datasource\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param dataProjection the projection of the retrieved data\r\n   * @param featureProjection the projection of the created features\r\n   * @param url the url string to retrieve the data\r\n   * @param threshold the threshold to manage \"more features\" (TODO)\r\n   * @param success success callback\r\n   * @param failure failure callback\r\n   */\r\n  private getFeatures(\r\n    vectorSource: olSourceVector<OlGeometry>,\r\n    interceptor,\r\n    extent,\r\n    dataProjection,\r\n    featureProjection,\r\n    url: string,\r\n    threshold: number,\r\n    success, failure) {\r\n\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open('GET', url);\r\n    if (interceptor) {\r\n      interceptor.interceptXhr(xhr, url);\r\n    }\r\n    const onError = () => {\r\n      vectorSource.removeLoadedExtent(extent);\r\n      failure();\r\n    };\r\n    xhr.onerror = onError;\r\n    xhr.onload = () => {\r\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\r\n        const features =\r\n          vectorSource\r\n            .getFormat()\r\n            .readFeatures(xhr.responseText, { dataProjection, featureProjection }) as olFeature<OlGeometry>[];\r\n        // TODO Manage \"More feature\"\r\n        /*if (features.length === 0 || features.length < threshold ) {\r\n          console.log('No more data to download at this resolution');\r\n        }*/\r\n        vectorSource.addFeatures(features);\r\n        success(features);\r\n      } else {\r\n        onError();\r\n      }\r\n    };\r\n    xhr.send();\r\n  }\r\n\r\n  /**\r\n   * Custom loader for vector layer.\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param url the url string or function to retrieve the data\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param resolution the current resolution\r\n   * @param projection the projection to retrieve the data\r\n   */\r\n  private customLoader(\r\n    vectorSource,\r\n    url,\r\n    interceptor,\r\n    extent,\r\n    resolution,\r\n    projection,\r\n    success,\r\n    failure\r\n  ) {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open(\r\n      'GET',\r\n      typeof url === 'function'\r\n        ? url = url(extent, resolution, projection)\r\n        : url\r\n    );\r\n    const format = vectorSource.getFormat();\r\n    if (format.getType() === FormatType.ARRAY_BUFFER) {\r\n      xhr.responseType = 'arraybuffer';\r\n    }\r\n    if (interceptor) {\r\n      interceptor.interceptXhr(xhr, url);\r\n    }\r\n\r\n    const onError = () => {\r\n      vectorSource.removeLoadedExtent(extent);\r\n      failure();\r\n    };\r\n    xhr.onerror = onError;\r\n    xhr.onload = () => {\r\n      // status will be 0 for file:// urls\r\n      if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\r\n        const type = format.getType();\r\n        let source;\r\n        if (type === FormatType.JSON || type === FormatType.TEXT) {\r\n          source = xhr.responseText;\r\n        } else if (type === FormatType.XML) {\r\n          source = xhr.responseXML;\r\n          if (!source) {\r\n            source = new DOMParser().parseFromString(\r\n              xhr.responseText,\r\n              'application/xml'\r\n            );\r\n          }\r\n        } else if (type === FormatType.ARRAY_BUFFER) {\r\n          source = xhr.response;\r\n        }\r\n        if (source) {\r\n          const features = format.readFeatures(source, { extent, featureProjection: projection });\r\n          vectorSource.addFeatures(features, format.readProjection(source));\r\n          success(features);\r\n        } else {\r\n          onError();\r\n        }\r\n      } else {\r\n        onError();\r\n      }\r\n    };\r\n    xhr.send();\r\n  }\r\n}\r\n","import olSourceOSM from 'ol/source/OSM';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\r\n\r\nexport class OSMDataSource extends DataSource {\r\n  public options: OSMDataSourceOptions;\r\n  public ol: olSourceOSM;\r\n\r\n  protected createOlSource(): olSourceOSM {\r\n    if (!this.options.url) {\r\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\r\n    }\r\n    return new olSourceOSM(this.options);\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceXYZ from 'ol/source/XYZ';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\r\n\r\nexport class XYZDataSource extends DataSource {\r\n  public options: XYZDataSourceOptions;\r\n  public ol: olSourceXYZ;\r\n\r\n  protected createOlSource(): olSourceXYZ {\r\n    return new olSourceXYZ(this.options);\r\n  }\r\n\r\n  public onUnwatch() {}\r\n\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\r\nimport olProjection from 'ol/proj/Projection';\r\nimport * as olproj from 'ol/proj';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WFSService } from './wfs.service';\r\n\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\r\nimport {\r\n  defaultFieldNameGeometry,\r\n  checkWfsParams,\r\n  getFormatFromOptions,\r\n  buildUrl\r\n} from './wms-wfs.utils';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\n\r\nexport class WFSDataSource extends DataSource {\r\n  public ol: olSourceVector<OlGeometry>;\r\n\r\n  set ogcFilters(value: OgcFiltersOptions) {\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\r\n  }\r\n  get ogcFilters(): OgcFiltersOptions {\r\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n  }\r\n\r\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\r\n\r\n  constructor(\r\n    public options: WFSDataSourceOptions,\r\n    protected wfsService: WFSService,\r\n    private authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(checkWfsParams(options, 'wfs'));\r\n\r\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n    const fieldNameGeometry = this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\r\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(ogcFilters, fieldNameGeometry);\r\n    if (\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\r\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0\r\n    ) {\r\n      this.wfsService.getSourceFieldsFromWFS(this.options);\r\n    }\r\n\r\n    if (ogcFilters?.pushButtons){\r\n      ogcFilters.pushButtons.selectorType = 'pushButton';\r\n    }\r\n    if (ogcFilters?.checkboxes){\r\n      ogcFilters.checkboxes.selectorType = 'checkbox';\r\n    }\r\n    if (ogcFilters?.radioButtons){\r\n      ogcFilters.radioButtons.selectorType = 'radioButton';\r\n    }\r\n    if (ogcFilters?.select){\r\n      ogcFilters.select.selectorType = 'select';\r\n    }\r\n\r\n    this.setOgcFilters((this.options as OgcFilterableDataSourceOptions).ogcFilters, true);\r\n  }\r\n\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    const vectorSource = new olSourceVector({\r\n      format: getFormatFromOptions(this.options),\r\n      url: (extent, resolution, proj: olProjection) => {\r\n        const paramsWFS = this.options.paramsWFS;\r\n        const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\r\n        const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n        const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\r\n        paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\r\n        return buildUrl(this.options, currentExtent, wfsProj, ogcFilters);\r\n      },\r\n      strategy: OlLoadingStrategy.bbox\r\n    });\r\n    return vectorSource;\r\n  }\r\n\r\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\r\n    this.ogcFilters = ogcFilters;\r\n    if (triggerEvent) {\r\n      this.ogcFilters$.next(this.ogcFilters);\r\n    }\r\n  }\r\n\r\n  public onUnwatch() { }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { combineLatest, Observable, of } from 'rxjs';\r\nimport olFeature from 'ol/Feature';\r\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\nimport { DataService } from './data.service';\r\nimport { formatWFSQueryString,\r\n          gmlRegex,\r\n          defaultEpsg,\r\n          defaultMaxFeatures,\r\n          getFormatFromOptions} from './wms-wfs.utils';\r\nimport { concatMap } from 'rxjs/operators';\r\nimport { WFS } from 'ol/format';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WFSService extends DataService {\r\n  constructor(private http: HttpClient) {\r\n    super();\r\n  }\r\n\r\n  getData() {\r\n    console.log('This is defining a data service.');\r\n    return 'This is defining a data service.';\r\n  }\r\n\r\n  public getSourceFieldsFromWFS(dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions) {\r\n    if (!dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0 ) {\r\n      dataSourceOptions.sourceFields = [];\r\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\r\n        dataSourceOptions.sourceFields = getfeatureSourceField;\r\n      });\r\n\r\n    } else {\r\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\r\n        dataSourceOptions.sourceFields.forEach(sourcefield => {\r\n          if (sourcefield.alias === undefined) {\r\n            sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\r\n          }\r\n          if (sourcefield.values === undefined || sourcefield.values.length === 0) {\r\n            sourcefield.values = getfeatureSourceField.find(sf => sf.name === sourcefield.name).values;\r\n          }\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  private wfsGetFeature(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\r\n    nb: number = defaultMaxFeatures,\r\n    epsgCode: string = defaultEpsg,\r\n    propertyName?: string,\r\n    startIndex: number = 0,\r\n    forceDefaultOutputFormat: boolean = false\r\n  ): Observable<any> {\r\n    const queryStringValues = formatWFSQueryString(dataSourceOptions, nb, epsgCode, propertyName, startIndex, forceDefaultOutputFormat );\r\n    const baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\r\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\r\n    if (forceDefaultOutputFormat || gmlRegex.test(outputFormat) || !outputFormat) {\r\n      return this.http.get(baseUrl, { responseType: 'text' });\r\n    } else {\r\n      return this.http.get(baseUrl);\r\n    }\r\n  }\r\n\r\n  defineFieldAndValuefromWFS(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\r\n  ): Observable<any> {\r\n    return new Observable(d => {\r\n      const sourceFields = [];\r\n      let fieldList;\r\n      let fieldListWoGeom;\r\n      let fieldListWoGeomStr;\r\n      let olFormats;\r\n      let effectiveOlFormats;\r\n\r\n      olFormats = getFormatFromOptions(dataSourceOptions);\r\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions = JSON.parse(\r\n        JSON.stringify(dataSourceOptions)\r\n      );\r\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\r\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\r\n\r\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\r\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields?.filter(f => !f.values).map(f => f.name);\r\n\r\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\r\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true).pipe(\r\n        concatMap(res => String(res).toLowerCase().includes('exception') ? of(false) : of(true)),\r\n        concatMap(allowGml => {\r\n          // If the service return GML (return no exception)\r\n          return this.wfsGetFeature(dataSourceOptions, 1).pipe(\r\n            concatMap(firstFeature => {\r\n              const features = olFormats.readFeatures(firstFeature);\r\n              fieldList = features[0].getKeys();\r\n              if (dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0) {\r\n                sourceFieldsToRetrieveValues = fieldList;\r\n              }\r\n              fieldListWoGeom = fieldList.filter(\r\n                field =>\r\n                  sourceFieldsToRetrieveValues.includes(field) &&\r\n                  field !== features[0].getGeometryName() &&\r\n                  !field.match(/boundedby/gi)\r\n              );\r\n              fieldListWoGeomStr = fieldListWoGeom.join(',');\r\n              const processingArray = [];\r\n              let startIndex = 0;\r\n              // If the service do not allow gml return, dice the call in multiple\r\n              // calls by increment of chunkSize with the original outputFormat\r\n              if (\r\n                !allowGml && dataSourceOptions.paramsWFS.version === '2.0.0' &&\r\n                dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures) {\r\n                const chunkSize = 1000;\r\n                while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\r\n                  processingArray.push(this.wfsGetFeature(\r\n                    dataSourceOptions,\r\n                    chunkSize,\r\n                    dataSourceOptions.paramsWFS.srsName,\r\n                    fieldListWoGeomStr,\r\n                    startIndex\r\n                  ));\r\n                  startIndex += chunkSize;\r\n                }\r\n                effectiveOlFormats = olFormats;\r\n              } else {\r\n                processingArray.push(this.wfsGetFeature(\r\n                  dataSourceOptions,\r\n                  dataSourceOptions.paramsWFS.maxFeatures || defaultMaxFeatures,\r\n                  dataSourceOptions.paramsWFS.srsName,\r\n                  fieldListWoGeomStr,\r\n                  0, true\r\n                ));\r\n              }\r\n              return combineLatest(processingArray);\r\n            })\r\n          );\r\n        })).subscribe((results) => {\r\n          let mfeatures: olFeature<OlGeometry>[] = [];\r\n          results.map((result) => {\r\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\r\n            mfeatures = mfeatures.concat(loopFeatures);\r\n          });\r\n          this.built_properties_value(mfeatures).forEach(element => {\r\n            sourceFields.push(element);\r\n          });\r\n          d.next(sourceFields);\r\n          d.complete();\r\n        });\r\n    });\r\n  }\r\n\r\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\r\n    if (features.length === 0) {\r\n      return [];\r\n    }\r\n    const kv = Object.assign({}, features[0].getProperties());\r\n    delete kv[features[0].getGeometryName()];\r\n    delete kv.boundedBy;\r\n    const sourceFields = [];\r\n    for (const property in kv) {\r\n      if (kv.hasOwnProperty(property)) {\r\n        const fieldType =\r\n          typeof features[0].get(property) === 'object'\r\n            ? undefined\r\n            : typeof features[0].get(property);\r\n        sourceFields.push({\r\n          name: property,\r\n          alias: property,\r\n          type: fieldType,\r\n          values: [kv[property]]\r\n        });\r\n      }\r\n    }\r\n    features.every((element) => {\r\n      const featureProperties = element.getProperties();\r\n      for (const key in featureProperties) {\r\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\r\n          sourceFields.filter(f => f.name === key).forEach(v => {\r\n            if (v.values.indexOf(featureProperties[key]) === -1) {\r\n              v.values.push(featureProperties[key]);\r\n            }\r\n          });\r\n        }\r\n      }\r\n      return true;\r\n    });\r\n    return sourceFields;\r\n  }\r\n}\r\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\r\nimport * as olproj from 'ol/proj';\r\nimport {\r\n  getTopLeft as extentGetTopLeft,\r\n  getWidth as extentGetWidth\r\n} from 'ol/extent.js';\r\n\r\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\r\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\r\n  const projectionExtent = projection.getExtent();\r\n  const size = extentGetWidth(projectionExtent) / 256;\r\n  const resolutions = new Array(20);\r\n  const matrixIds = new Array(20);\r\n  for (let z = 0; z < 20; ++z) {\r\n    resolutions[z] = size / Math.pow(2, z);\r\n    matrixIds[z] = z;\r\n  }\r\n\r\n  return new olTileGridWMTS({\r\n    origin: extentGetTopLeft(projectionExtent),\r\n    resolutions,\r\n    matrixIds\r\n  });\r\n}\r\n","import { Options } from 'ol/source/WMTS';\r\nimport olSourceWMTS from 'ol/source/WMTS';\r\n\r\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\r\nimport { DataSource } from './datasource';\r\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\r\n\r\nexport class WMTSDataSource extends DataSource {\r\n  public options: WMTSDataSourceOptions;\r\n  public ol: olSourceWMTS;\r\n\r\n  constructor(options: WMTSDataSourceOptions) {\r\n    super(options);\r\n  }\r\n\r\n  protected createOlSource(): olSourceWMTS {\r\n    const sourceOptions = Object.assign(\r\n      {\r\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\r\n      },\r\n      this.options\r\n    ) as Options;\r\n\r\n    return new olSourceWMTS(sourceOptions);\r\n  }\r\n\r\n  public onUnwatch() {}\r\n\r\n}\r\n","import olSourceCarto from 'ol/source/CartoDB';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\n\r\nexport class CartoDataSource extends DataSource {\r\n  public ol: olSourceCarto;\r\n  public options: CartoDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): olSourceCarto {\r\n    const crossOrigin = this.options.crossOrigin\r\n      ? this.options.crossOrigin\r\n      : 'anonymous';\r\n    const sourceOptions = Object.assign(\r\n      {\r\n        crossOrigin\r\n      },\r\n      this.options\r\n    );\r\n    return new olSourceCarto(sourceOptions);\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legend = super.getLegend();\r\n    if (legend.length > 0) {\r\n      return legend;\r\n    }\r\n\r\n    let htmlString = '<table>';\r\n    if (this.options.config.layers[0].legend != null) {\r\n      this.options.config.layers[0].legend.items.forEach(f => {\r\n        if (f.visible === true) {\r\n          htmlString +=\r\n            '<tr><td>' +\r\n            '<p><font size=\"5\" color=\"' +\r\n            f.value +\r\n            '\"> &#9679</font></p></td>' +\r\n            '<td>' +\r\n            f.name +\r\n            '</td></tr>';\r\n        }\r\n      });\r\n      htmlString += '</table>';\r\n      return [{ html: htmlString }];\r\n    } else {\r\n      // Try to build the legend from the cartocss options\r\n      const layerOptions = this.options.config.layers[0].options;\r\n      // All available cartocss style options\r\n      const types = [\r\n        'polygon-fill:',\r\n        'marker-fill:',\r\n        'shield-fill:',\r\n        'building-fill:',\r\n        'line-color:'\r\n      ];\r\n      for (const oneType of types) {\r\n        if (layerOptions.cartocss.includes(oneType)) {\r\n          const type = layerOptions.cartocss.split(oneType).pop();\r\n          const color = type.substr(0, type.indexOf(';'));\r\n          if (color.includes('ramp')) {\r\n            const colors = color.split(', (')[1].split(',');\r\n            const data = color.split(', (')[2].split(',');\r\n            for (let j = 0; j < colors.length; j++) {\r\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\r\n              data[j] = data[j].replace(/(\"|\\))/g, '');\r\n              if (data[j].replace(/\\s+/g, '') === '=') {\r\n                data[j] = 'Autres';\r\n              }\r\n              htmlString +=\r\n                '<tr><td>' +\r\n                '<p><font size=\"5\" color=\"' +\r\n                colors[j] +\r\n                '\"> &#9679</font></p></td>' +\r\n                '<td>' +\r\n                data[j] +\r\n                '</td></tr>';\r\n            }\r\n            break;\r\n          } else {\r\n            const title = layerOptions.layer_name\r\n              ? layerOptions.layer_name\r\n              : '';\r\n            htmlString +=\r\n              '<tr><td>' +\r\n              '<p><font size=\"5\" color=\"' +\r\n              color +\r\n              '\"> &#9679</font></p>' +\r\n              '</td><td>' +\r\n              title +\r\n              '</td></tr>';\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      htmlString += '</table>';\r\n      return [{ html: htmlString }];\r\n    }\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\r\nimport * as olloadingstrategy from 'ol/loadingstrategy';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\r\n\r\nexport class ArcGISRestDataSource extends DataSource {\r\n  public ol: olSourceVector<OlGeometry>;\r\n  public options: ArcGISRestDataSourceOptions;\r\n\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    const esrijsonFormat = new olFormatEsriJSON();\r\n    return new olSourceVector({\r\n      attributions: this.options.params.attributions,\r\n      overlaps: false,\r\n      format: esrijsonFormat,\r\n      url: function(extent, resolution, proj) {\r\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\r\n        const geometry = encodeURIComponent(\r\n          '{\"xmin\":' +\r\n            extent[0] +\r\n            ',\"ymin\":' +\r\n            extent[1] +\r\n            ',\"xmax\":' +\r\n            extent[2] +\r\n            ',\"ymax\":' +\r\n            extent[3] +\r\n            ',\"spatialReference\":{\"wkid\":102100}}'\r\n        );\r\n        const params = [\r\n          'f=json',\r\n          `geometry=${geometry}`,\r\n          'geometryType=esriGeometryEnvelope',\r\n          'inSR=102100',\r\n          'spatialRel=esriSpatialRelIntersects',\r\n          'outFields=*',\r\n          'returnGeometry=true',\r\n          'outSR=102100'\r\n        ];\r\n        if (this.options.params.time) {\r\n          const time = `time=${this.options.params.time}`;\r\n          params.push(time);\r\n        }\r\n        if (this.options.params.customParams) {\r\n          this.options.params.customParams.forEach(element => {\r\n            params.push(element);\r\n          });\r\n        }\r\n        return `${baseUrl}?${params.join('&')}`;\r\n      }.bind(this),\r\n      strategy: olloadingstrategy.bbox\r\n    });\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (legendInfo === undefined || legend.length > 0) {\r\n      return legend;\r\n    }\r\n\r\n    const id = parseInt(this.options.layer, 10);\r\n    const lyr = legendInfo.layers.find(layer => layer.layerId === id);\r\n    if (!lyr) {\r\n      return;\r\n    }\r\n    let htmlString = '<table>';\r\n\r\n    for (const lyrLegend of lyr.legend) {\r\n      const modifiedUrl = this.options.url.replace(\r\n        'FeatureServer',\r\n        'MapServer'\r\n      );\r\n      const src = `${modifiedUrl}/${lyr.layerId}/images/${lyrLegend.url}`;\r\n      const label = lyrLegend.label.replace('<Null>', 'Null');\r\n      htmlString +=\r\n        `<tr><td align='left'><img src=\"` +\r\n        src +\r\n        `\" alt ='' /></td><td>` +\r\n        label +\r\n        '</td></tr>';\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\nexport class ImageArcGISRestDataSource extends DataSource {\r\n  public ol: ImageArcGISRest;\r\n  public options: ArcGISRestImageDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): ImageArcGISRest {\r\n    const params = this.options.layer === undefined ? this.options.params : Object.assign(\r\n      {LAYERS: `show:${this.options.layer}`},\r\n      this.options.params\r\n    );\r\n\r\n    if (typeof params.renderingRule === 'object') {\r\n      params.renderingRule = JSON.stringify(params.renderingRule);\r\n    }\r\n\r\n    return new ImageArcGISRest({\r\n      ratio: 1,\r\n      params,\r\n      url: this.options.url\r\n    });\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.options?.legendInfo || this.params?.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\r\n      return legend;\r\n    }\r\n\r\n    const id = parseInt(this.options.layer, 10);\r\n    const lyr = legendInfo.layers.find(layer => layer.layerId === id);\r\n    if (!lyr) {\r\n      return;\r\n    }\r\n    let htmlString = '<table>';\r\n\r\n    for (const lyrLegend of lyr.legend) {\r\n      const src = `${this.options.url}/${lyr.layerId}/images/${\r\n        lyrLegend.url\r\n      }`;\r\n      const label = lyrLegend.label.replace('<Null>', 'Null');\r\n      htmlString +=\r\n        `<tr><td align='left'><img src=\"` +\r\n        src +\r\n        `\" alt ='' /></td><td>` +\r\n        label +\r\n        '</td></tr>';\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\r\nimport { Options } from 'ol/source/TileArcGISRest';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\n\r\nexport class TileArcGISRestDataSource extends DataSource {\r\n  public ol: olSourceTileArcGISRest;\r\n  public options: TileArcGISRestDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): olSourceTileArcGISRest {\r\n    return new olSourceTileArcGISRest(this.options as Options);\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (legendInfo === undefined || legend.length > 0) {\r\n      return legend;\r\n    }\r\n\r\n    const id = parseInt(this.options.layer, 10);\r\n    const lyr = legendInfo.layers.find(layer => layer.layerId === id);\r\n    if (!lyr) {\r\n      return;\r\n    }\r\n    let htmlString = '<table>';\r\n\r\n    for (const lyrLegend of lyr.legend) {\r\n      const src = `${this.options.url}/${lyr.layerId}/images/${\r\n        lyrLegend.url\r\n      }`;\r\n      const label = lyrLegend.label.replace('<Null>', 'Null');\r\n      htmlString +=\r\n        `<tr><td align='left'><img src=\"` +\r\n        src +\r\n        `\" alt ='' /></td><td>` +\r\n        label +\r\n        '</td></tr>';\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import TileDebug from 'ol/source/TileDebug';\r\nimport TileGrid from 'ol/tilegrid/TileGrid';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\r\n\r\nexport class TileDebugDataSource extends DataSource {\r\n  public options: TileDebugDataSourceOptions;\r\n  public ol: TileDebug;\r\n\r\n  protected createOlSource(): TileDebug {\r\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\r\n    if (this.options.tileGrid) {\r\n      delete baseOptions.tileGrid;\r\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\r\n    }\r\n    return new TileDebug(baseOptions);\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olformat from 'ol/format';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { easeOut } from 'ol/easing';\r\nimport { Circle as CircleStyle, Fill, Stroke, Style } from 'ol/style';\r\n\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { uuid } from '@igo2/utils';\r\nimport { FeatureDataSource } from './feature-datasource';\r\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\r\n\r\nexport class WebSocketDataSource extends FeatureDataSource {\r\n  public ws: WebSocket;\r\n  public options: WebSocketDataSourceOptions;\r\n\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    this.createWebSocket();\r\n    this.options.format = this.getSourceFormatFromOptions(this.options);\r\n    return super.createOlSource();\r\n  }\r\n\r\n  private createWebSocket() {\r\n    this.ws = new WebSocket(this.options.url);\r\n    this.ws.onmessage = this.onMessage.bind(this);\r\n\r\n    if (this.options.onclose) {\r\n      this.ws.onclose = this.onClose.bind(this);\r\n    }\r\n\r\n    if (this.options.onerror) {\r\n      this.ws.onerror = this.onError.bind(this);\r\n    }\r\n\r\n    if (this.options.onopen) {\r\n      this.ws.onopen = this.onOpen.bind(this);\r\n    }\r\n  }\r\n\r\n  onMessage(event) {\r\n    const featureAdded = this.options.format.readFeature(event.data) as olFeature<OlGeometry>;\r\n\r\n    switch (this.options.onmessage) {\r\n      case 'update':\r\n        // ol don't add if same ID\r\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\r\n        if (featureToRemove) {\r\n          this.ol.removeFeature(featureToRemove);\r\n        }\r\n        this.ol.addFeature(featureAdded);\r\n        break;\r\n      case 'delete':\r\n        this.ol.clear(true);\r\n        this.ol.addFeature(featureAdded);\r\n        break;\r\n      case 'add':\r\n      default:\r\n        this.ol.addFeature(featureAdded);\r\n    }\r\n  }\r\n\r\n  onClose(event) {\r\n    // thrown message to user\r\n  }\r\n\r\n  onError(event) {\r\n    // thrown message to user\r\n  }\r\n\r\n  onOpen(event) {\r\n    // thrown message to user ?\r\n  }\r\n\r\n  public onUnwatch() {\r\n    this.ws.close();\r\n  }\r\n}\r\n","import { Md5 } from 'ts-md5';\r\nimport feature from 'ol/Feature';\r\nimport olSourceVectorTile from 'ol/source/VectorTile';\r\nimport olFormatMVT from 'ol/format/MVT';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\r\n\r\nexport class MVTDataSource extends DataSource {\r\n  public options: MVTDataSourceOptions;\r\n  public ol: olSourceVectorTile;\r\n\r\n  protected createOlSource(): olSourceVectorTile {\r\n    let mvtFormat;\r\n    if (this.options.featureClass === 'feature') {\r\n      mvtFormat = new olFormatMVT({featureClass: feature});\r\n    } else if (this.options.featureClass === undefined) {\r\n      mvtFormat = new olFormatMVT();\r\n    }\r\n    this.options.format = mvtFormat;\r\n    return new olSourceVectorTile(this.options);\r\n  }\r\n\r\n  protected generateId() {\r\n    if (!this.options.url) {\r\n        return uuid();\r\n    }\r\n    const chain = 'mvt' + this.options.url;\r\n    return Md5.hashStr(chain) as string;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import * as olstyle from 'ol/style';\r\nimport * as olproj from 'ol/proj';\r\n\r\nexport class EsriStyleGenerator {\r\n  public _converters: any;\r\n  public _renderers: any;\r\n\r\n  constructor() {\r\n    this._converters = {};\r\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\r\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\r\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\r\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\r\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\r\n    this._renderers = {};\r\n    this._renderers.uniqueValue = this._renderUniqueValue;\r\n    this._renderers.simple = this._renderSimple;\r\n    this._renderers.classBreaks = this._renderClassBreaks;\r\n  }\r\n  static _convertPointToPixel(point) {\r\n    return point / 0.75;\r\n  }\r\n  static _transformColor(color): [number, number, number, number] {\r\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\r\n    return [color[0], color[1], color[2], color[3] / 255];\r\n  }\r\n\r\n  static _getResolutionForScale(scale, units) {\r\n    const dpi = 96;\r\n    const mpu = olproj.METERS_PER_UNIT[units];\r\n    const inchesPerMeter = 39.3701;\r\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\r\n  }\r\n\r\n  /* convert an Esri Text Symbol */\r\n  static _convertEsriTS(symbol) {\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n    const text = symbol.text !== undefined ? symbol.text : undefined;\r\n    return new olstyle.Style({\r\n      text: new olstyle.Text({\r\n        fill: new olstyle.Fill({\r\n          color: EsriStyleGenerator._transformColor(symbol.color)\r\n        }),\r\n        font:\r\n          symbol.font.style +\r\n          ' ' +\r\n          symbol.font.weight +\r\n          ' ' +\r\n          symbol.font.size +\r\n          ' px ' +\r\n          symbol.font.family,\r\n        textBaseline: symbol.verticalAlignment,\r\n        textAlign: symbol.horizontalAlignment,\r\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\r\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\r\n        rotation,\r\n        text\r\n      })\r\n    });\r\n  }\r\n  /* convert an Esri Picture Marker Symbol */\r\n  static _convertEsriPMS(symbol) {\r\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n\r\n    return new olstyle.Style({\r\n      image: new olstyle.Icon({\r\n        src,\r\n        rotation\r\n      })\r\n    });\r\n  }\r\n  /* convert an Esri Simple Fill Symbol */\r\n  static _convertEsriSFS(symbol) {\r\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\r\n    const fill = new olstyle.Fill({\r\n      color: EsriStyleGenerator._transformColor(symbol.color)\r\n    });\r\n    const stroke = symbol.outline\r\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\r\n      : undefined;\r\n    return new olstyle.Style({\r\n      fill,\r\n      stroke\r\n    });\r\n  }\r\n  static _convertOutline(outline) {\r\n    let lineDash;\r\n    const color = EsriStyleGenerator._transformColor(outline.color);\r\n    if (outline.style === 'esriSLSDash') {\r\n      lineDash = [5];\r\n    } else if (outline.style === 'esriSLSDashDot') {\r\n      lineDash = [5, 5, 1, 2];\r\n    } else if (outline.style === 'esriSLSDashDotDot') {\r\n      lineDash = [5, 5, 1, 2, 1, 2];\r\n    } else if (outline.style === 'esriSLSDot') {\r\n      lineDash = [1, 2];\r\n    } else if (outline.style === 'esriSLSNull') {\r\n      // line not visible, make color fully transparent\r\n      color[3] = 0;\r\n    }\r\n    return new olstyle.Stroke({\r\n      color,\r\n      lineDash,\r\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\r\n    });\r\n  }\r\n  /* convert an Esri Simple Line Symbol */\r\n  static _convertEsriSLS(symbol) {\r\n    return new olstyle.Style({\r\n      stroke: EsriStyleGenerator._convertOutline(symbol)\r\n    });\r\n  }\r\n  static _transformAngle(angle) {\r\n    if (angle === 0 || angle === undefined) {\r\n      return undefined;\r\n    }\r\n    const normalRad = (angle * Math.PI) / 180;\r\n    const ol3Rad = -normalRad + Math.PI / 2;\r\n    if (ol3Rad < 0) {\r\n      return 2 * Math.PI + ol3Rad;\r\n    } else {\r\n      return ol3Rad;\r\n    }\r\n  }\r\n  /* convert an Esri Simple Marker Symbol */\r\n  static _convertEsriSMS(symbol) {\r\n    const fill = new olstyle.Fill({\r\n      color: EsriStyleGenerator._transformColor(symbol.color)\r\n    });\r\n    const stroke = symbol.outline\r\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\r\n      : undefined;\r\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n    if (symbol.style === 'esriSMSCircle') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.Circle({\r\n          radius,\r\n          fill,\r\n          stroke\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSCross') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          radius2: 0,\r\n          angle: 0,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSDiamond') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSSquare') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          angle: Math.PI / 4,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSX') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          radius2: 0,\r\n          angle: Math.PI / 4,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSTriangle') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 3,\r\n          radius,\r\n          angle: 0,\r\n          rotation\r\n        })\r\n      });\r\n    }\r\n  }\r\n\r\n  _convertLabelingInfo(labelingInfo, mapUnits) {\r\n    const styles = [];\r\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\r\n      const labelExpression = labelingInfo[i].labelExpression;\r\n      // only limited support for label expressions\r\n      const field = labelExpression.substr(\r\n        labelExpression.indexOf('[') + 1,\r\n        labelExpression.indexOf(']') - 1\r\n      );\r\n      const symbol = labelingInfo[i].symbol;\r\n      const maxScale = labelingInfo[i].maxScale;\r\n      const minScale = labelingInfo[i].minScale;\r\n      let minResolution = null;\r\n      if (maxScale !== 0) {\r\n        minResolution = EsriStyleGenerator._getResolutionForScale(\r\n          maxScale,\r\n          mapUnits\r\n        );\r\n      }\r\n      let maxResolution = null;\r\n      if (minScale !== 0) {\r\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\r\n          minScale,\r\n          mapUnits\r\n        );\r\n      }\r\n      const style = this._converters[symbol.type].call(this, symbol);\r\n      styles.push(\r\n        (() => {\r\n          return function(feature, resolution) {\r\n            let visible = true;\r\n            if (this.minResolution !== null && this.maxResolution !== null) {\r\n              visible =\r\n                resolution < this.maxResolution &&\r\n                resolution >= this.minResolution;\r\n            } else if (this.minResolution !== null) {\r\n              visible = resolution >= this.minResolution;\r\n            } else if (this.maxResolution !== null) {\r\n              visible = resolution < this.maxResolution;\r\n            }\r\n            if (visible) {\r\n              const value = feature.get(this.field);\r\n              this.style.getText().setText(value);\r\n              return [this.style];\r\n            }\r\n          };\r\n        })().bind({\r\n          minResolution,\r\n          maxResolution,\r\n          field,\r\n          style\r\n        })\r\n      );\r\n    }\r\n    return styles;\r\n  }\r\n\r\n  _renderSimple(renderer) {\r\n    const style = this._converters[renderer.symbol.type].call(\r\n      this,\r\n      renderer.symbol\r\n    );\r\n    return (() => {\r\n      return () => {\r\n        return [style];\r\n      };\r\n    })();\r\n  }\r\n  _renderClassBreaks(renderer) {\r\n    const defaultSymbol = renderer.defaultSymbol;\r\n    const defaultStyle = this._converters[defaultSymbol.type].call(\r\n      this,\r\n      defaultSymbol\r\n    );\r\n    const field = renderer.field;\r\n    const classes = [];\r\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\r\n      const classBreakInfo = renderer.classBreakInfos[i];\r\n      let min;\r\n      if (\r\n        classBreakInfo.classMinValue === null ||\r\n        classBreakInfo.classMinValue === undefined\r\n      ) {\r\n        if (i === 0) {\r\n          min = renderer.minValue;\r\n        } else {\r\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\r\n        }\r\n      } else {\r\n        min = classBreakInfo.classMinValue;\r\n      }\r\n      const max = classBreakInfo.classMaxValue;\r\n      const symbol = classBreakInfo.symbol;\r\n      const style = this._converters[symbol.type].call(this, symbol);\r\n      classes.push({ min, max, style });\r\n    }\r\n    return (() => {\r\n      return (feature) => {\r\n        const value = feature.get(field);\r\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\r\n          let condition;\r\n          if (i === 0) {\r\n            condition = value >= classes[i].min && value <= classes[i].max;\r\n          } else {\r\n            condition = value > classes[i].min && value <= classes[i].max;\r\n          }\r\n          if (condition) {\r\n            return [classes[i].style];\r\n          }\r\n        }\r\n        return [defaultStyle];\r\n      };\r\n    })();\r\n  }\r\n  _renderUniqueValue(renderer) {\r\n    const defaultSymbol = renderer.defaultSymbol;\r\n    let defaultStyle = [];\r\n    if (defaultSymbol) {\r\n      defaultStyle = [\r\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\r\n      ];\r\n    }\r\n    const field = renderer.field1;\r\n    const infos = renderer.uniqueValueInfos;\r\n    const me = this;\r\n    return (() => {\r\n      const hash = {};\r\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\r\n        const info = infos[i];\r\n        const symbol = info.symbol;\r\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\r\n      }\r\n\r\n      return (feature) => {\r\n        const style = hash[feature.get(field)];\r\n        return style ? style : defaultStyle;\r\n      };\r\n    })();\r\n  }\r\n  generateStyle(layerInfo, mapUnits) {\r\n    const drawingInfo = layerInfo.drawingInfo;\r\n    let styleFunctions = [];\r\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\r\n      this,\r\n      drawingInfo.renderer\r\n    );\r\n    if (drawingInfoStyle !== undefined) {\r\n      styleFunctions.push(drawingInfoStyle);\r\n    }\r\n    if (layerInfo.labelingInfo) {\r\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\r\n        layerInfo.labelingInfo,\r\n        mapUnits\r\n      );\r\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\r\n    }\r\n    if (styleFunctions.length === 1) {\r\n      return styleFunctions[0];\r\n    } else {\r\n      return (() => {\r\n        return (feature, resolution) => {\r\n          let styles = [];\r\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\r\n            const result = styleFunctions[i].call(null, feature, resolution);\r\n            if (result) {\r\n              styles = styles.concat(result);\r\n            }\r\n          }\r\n          return styles;\r\n        };\r\n      })();\r\n    }\r\n  }\r\n}\r\n","export enum TimeFilterType {\r\n    DATE = 'date',\r\n    TIME = 'time',\r\n    DATETIME = 'datetime',\r\n    YEAR = 'year',\r\n}\r\n\r\nexport enum TimeFilterStyle {\r\n    CALENDAR = 'calendar',\r\n    SLIDER = 'slider',\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { IgoMap } from './map';\r\n\r\n/**\r\n * MapService\r\n *\r\n * This service tracks the IgoMap instance, if any.\r\n * Currently, only one map instance is supported\r\n * but support for multiple maps may be added in the future.\r\n * This will impact other services such as the OverlayService\r\n * because these maps won't be sharing overlayed features.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapService {\r\n  private map: IgoMap;\r\n\r\n  constructor() {}\r\n\r\n  getMap(): IgoMap {\r\n    return this.map;\r\n  }\r\n\r\n  setMap(map: IgoMap) {\r\n    this.map = map;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpClient,\r\n  HttpParams\r\n} from '@angular/common/http';\r\nimport { Observable, forkJoin, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport { WMSCapabilities, WMTSCapabilities, EsriJSON } from 'ol/format';\r\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\r\nimport olAttribution from 'ol/control/Attribution';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\r\nimport { EsriStyleGenerator } from '../utils/esri-style-generator';\r\nimport {\r\n  QueryFormat,\r\n  QueryFormatMimeType\r\n} from '../../query/shared/query.enums';\r\n\r\nimport {\r\n  WMTSDataSourceOptions,\r\n  WMSDataSourceOptions,\r\n  CartoDataSourceOptions,\r\n  ArcGISRestDataSourceOptions,\r\n  TileArcGISRestDataSourceOptions,\r\n  ArcGISRestImageDataSourceOptions\r\n} from './datasources';\r\nimport {\r\n  LegendOptions,\r\n  ItemStyleOptions\r\n} from '../../layer/shared/layers/layer.interface';\r\nimport {\r\n  TimeFilterType,\r\n  TimeFilterStyle\r\n} from '../../filter/shared/time-filter.enum';\r\nimport * as olproj from 'ol/proj';\r\n\r\nexport enum TypeCapabilities {\r\n  wms = 'wms',\r\n  wmts = 'wmts',\r\n  arcgisrest = 'esriJSON',\r\n  imagearcgisrest = 'esriJSON',\r\n  tilearcgisrest = 'esriJSON'\r\n}\r\n\r\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CapabilitiesService {\r\n  private parsers = {\r\n    wms: new WMSCapabilities(),\r\n    wmts: new WMTSCapabilities(),\r\n    esriJSON: new EsriJSON()\r\n  };\r\n\r\n  constructor(private http: HttpClient, private mapService: MapService) {}\r\n\r\n  getWMSOptions(\r\n    baseOptions: WMSDataSourceOptions\r\n  ): Observable<WMSDataSourceOptions> {\r\n    const url = baseOptions.url;\r\n    const version = (baseOptions.params as any).VERSION;\r\n\r\n    return this.getCapabilities('wms', url, version).pipe(\r\n      map((capabilities: any) => {\r\n        return capabilities\r\n          ? this.parseWMSOptions(baseOptions, capabilities)\r\n          : undefined;\r\n      })\r\n    );\r\n  }\r\n\r\n  getWMTSOptions(\r\n    baseOptions: WMTSDataSourceOptions\r\n  ): Observable<WMTSDataSourceOptions> {\r\n    const url = baseOptions.url;\r\n    const version = baseOptions.version;\r\n\r\n    const options = this.getCapabilities('wmts', url, version).pipe(\r\n      map((capabilities: any) => {\r\n        return capabilities\r\n          ? this.parseWMTSOptions(baseOptions, capabilities)\r\n          : undefined;\r\n      })\r\n    );\r\n    return options;\r\n  }\r\n\r\n  getCartoOptions(\r\n    baseOptions: CartoDataSourceOptions\r\n  ): Observable<CartoDataSourceOptions> {\r\n    const baseUrl =\r\n      'https://' +\r\n      baseOptions.account +\r\n      '.carto.com/api/v2/viz/' +\r\n      baseOptions.mapId +\r\n      '/viz.json';\r\n\r\n    return this.http\r\n      .jsonp(baseUrl, 'callback')\r\n      .pipe(\r\n        map((cartoOptions: any) =>\r\n          this.parseCartoOptions(baseOptions, cartoOptions)\r\n        )\r\n      );\r\n  }\r\n\r\n  getArcgisOptions(\r\n    baseOptions: ArcGISRestDataSourceOptions\r\n  ): Observable<ArcGISRestDataSourceOptions> {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\r\n    const legendUrl = modifiedUrl + '/legend?f=json';\r\n    const serviceCapabilities = this.getCapabilities('arcgisrest', baseOptions.url);\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    const legend = this.http.get(legendUrl).pipe(\r\n      map((res: any) => res),\r\n      catchError((err) => {\r\n        console.log('No legend associated with this Feature Service');\r\n        return of(err);\r\n      })\r\n    );\r\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\r\n      map((res: any) => {\r\n        return this.parseArcgisOptions(baseOptions, res[0], res[1], res[2]);\r\n      })\r\n    );\r\n  }\r\n\r\n  getImageArcgisOptions(\r\n    baseOptions: ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\r\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\r\n    const legendUrl = modifiedUrl + '/legend?f=json';\r\n    const serviceCapabilities = this.getCapabilities('imagearcgisrest', baseOptions.url);\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    const legend = this.http.get(legendUrl).pipe(\r\n      map((res: any) => res),\r\n      catchError((err) => {\r\n        console.log('No legend associated with this Image Service');\r\n        return of(err);\r\n      })\r\n    );\r\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\r\n      map((res: any) => {\r\n        return this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2]);\r\n      })\r\n    );\r\n  }\r\n\r\n  getTileArcgisOptions(\r\n    baseOptions: TileArcGISRestDataSourceOptions\r\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const legendUrl = baseOptions.url + '/legend?f=json';\r\n    const serviceCapabilities = this.getCapabilities('tilearcgisrest', baseOptions.url);\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    const legendInfo = this.http.get(legendUrl).pipe(\r\n      map((res: any) => res),\r\n      catchError((err) => {\r\n        console.log('No legend associated with this Tile Service');\r\n        return of(err);\r\n      })\r\n    );\r\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\r\n      map((res: any) =>\r\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\r\n      )\r\n    );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getCapabilities(\r\n    service: TypeCapabilitiesStrings,\r\n    baseUrl: string,\r\n    version?: string\r\n  ): Observable<any> {\r\n    const params = new HttpParams({\r\n      fromObject: {\r\n        request: 'GetCapabilities',\r\n        service: service.toUpperCase(),\r\n        version: version || '1.3.0',\r\n        _i: 'true'\r\n      }\r\n    });\r\n\r\n    let request;\r\n    if (TypeCapabilities[service] === 'esriJSON') {\r\n      request = this.http.get(baseUrl + '?f=json');\r\n    } else {\r\n      request = this.http.get(baseUrl, {\r\n        params,\r\n        responseType: 'text'\r\n      });\r\n    }\r\n\r\n    return request.pipe(\r\n      map((res) => {\r\n        if (TypeCapabilities[service] === 'esriJSON') {\r\n          return res as object;\r\n        }\r\n        if (\r\n          String(res).toLowerCase().includes('serviceexception') &&\r\n          String(res).toLowerCase().includes('access denied')\r\n        ) {\r\n          throw {\r\n            error: {\r\n              message: 'Service error getCapabilities: Access is denied'\r\n            }\r\n          };\r\n        } else {\r\n          return this.parsers[service].read(res);\r\n        }\r\n      }),\r\n      catchError((e) => {\r\n        if (typeof e.error !== 'undefined') {\r\n          e.error.caught = true;\r\n        }\r\n        throw e;\r\n      })\r\n    );\r\n  }\r\n\r\n  private parseWMSOptions(\r\n    baseOptions: WMSDataSourceOptions,\r\n    capabilities: any\r\n  ): WMSDataSourceOptions {\r\n    const layers = (baseOptions.params as any).LAYERS;\r\n    const layer = this.findDataSourceInCapabilities(\r\n      capabilities.Capability.Layer,\r\n      layers\r\n    );\r\n\r\n    if (!layer) {\r\n      throw {\r\n        error: {\r\n          message: 'Layer not found'\r\n        }\r\n      };\r\n    }\r\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\r\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\r\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\r\n    let queryable = layer.queryable;\r\n    const timeFilter = this.getTimeFilter(layer);\r\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\r\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\r\n    let isExtentInGeographic = true;\r\n    if (layer.EX_GeographicBoundingBox) {\r\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\r\n        if (index < 2 && (coord > 180 || coord < -180)) {\r\n          isExtentInGeographic = false;\r\n        }\r\n        if (index >= 2 && (coord > 90 || coord < -90)) {\r\n          isExtentInGeographic = false;\r\n        }\r\n      });\r\n    } else {\r\n      isExtentInGeographic = false;\r\n    }\r\n\r\n    const extent = isExtentInGeographic ?\r\n        olproj.transformExtent(layer.EX_GeographicBoundingBox, 'EPSG:4326', this.mapService.getMap().projection) :\r\n        undefined;\r\n\r\n    let queryFormat: QueryFormat;\r\n    const queryFormatMimeTypePriority = [\r\n      QueryFormatMimeType.GEOJSON,\r\n      QueryFormatMimeType.GEOJSON2,\r\n      QueryFormatMimeType.GML3,\r\n      QueryFormatMimeType.GML2,\r\n      QueryFormatMimeType.JSON,\r\n      QueryFormatMimeType.HTML\r\n    ];\r\n\r\n    for (const mimeType of queryFormatMimeTypePriority) {\r\n      if (\r\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\r\n          mimeType\r\n        ) !== -1\r\n      ) {\r\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\r\n          (key) => QueryFormatMimeType[key] === mimeType\r\n        );\r\n        queryFormat = QueryFormat[keyEnum];\r\n        break;\r\n      }\r\n    }\r\n    if (!queryFormat) {\r\n      queryable = false;\r\n    }\r\n\r\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\r\n      _layerOptionsFromSource: {\r\n        title: layer.Title,\r\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\r\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\r\n        extent,\r\n        metadata: {\r\n          url: metadata ? metadata.OnlineResource : undefined,\r\n          extern: metadata ? true : undefined,\r\n          abstract,\r\n          keywordList\r\n        },\r\n        legendOptions\r\n      },\r\n      queryable,\r\n      queryFormat,\r\n      timeFilter: timeFilterable ? timeFilter : undefined,\r\n      timeFilterable: timeFilterable ? true : undefined,\r\n      minDate: timeFilterable ? timeFilter.min : undefined,\r\n      maxDate: timeFilterable ? timeFilter.max : undefined,\r\n      stepDate: timeFilterable ? timeFilter.step : undefined\r\n    });\r\n\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseWMTSOptions(\r\n    baseOptions: WMTSDataSourceOptions,\r\n    capabilities: any\r\n  ): WMTSDataSourceOptions {\r\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\r\n    const layer = capabilities.Contents.Layer.find(\r\n      (el) => el.Identifier === baseOptions.layer\r\n    );\r\n\r\n    const options = optionsFromCapabilities(capabilities, baseOptions);\r\n\r\n    const ouputOptions = Object.assign(options, baseOptions);\r\n    const sourceOptions = ObjectUtils.removeUndefined({\r\n      _layerOptionsFromSource: {\r\n        title: layer.Title\r\n      }\r\n    });\r\n\r\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\r\n  }\r\n\r\n  private parseCartoOptions(\r\n    baseOptions: CartoDataSourceOptions,\r\n    cartoOptions: any\r\n  ): CartoDataSourceOptions {\r\n    const layers = [];\r\n    const params = cartoOptions.layers[1].options.layer_definition;\r\n    params.layers.forEach((element) => {\r\n      layers.push({\r\n        type: element.type.toLowerCase(),\r\n        options: element.options,\r\n        legend: element.legend\r\n      });\r\n    });\r\n    const options = ObjectUtils.removeUndefined({\r\n      config: {\r\n        version: params.version,\r\n        layers\r\n      }\r\n    });\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseArcgisOptions(\r\n    baseOptions: ArcGISRestDataSourceOptions,\r\n    arcgisOptions: any,\r\n    serviceCapabilities: any,\r\n    legend?: any\r\n  ): ArcGISRestDataSourceOptions {\r\n    const title = arcgisOptions.name;\r\n    const legendInfo = legend.layers ? legend : undefined;\r\n    const styleGenerator = new EsriStyleGenerator();\r\n    const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\r\n    const style = styleGenerator.generateStyle(arcgisOptions, units);\r\n    const attributions = new olAttribution({\r\n      target: arcgisOptions.copyrightText\r\n    });\r\n    let timeExtent;\r\n    let timeFilter;\r\n    if (arcgisOptions.timeInfo) {\r\n      const time = arcgisOptions.timeInfo.timeExtent;\r\n      timeExtent = time[0] + ',' + time[1];\r\n      const min = new Date();\r\n      min.setTime(time[0]);\r\n      const max = new Date();\r\n      max.setTime(time[1]);\r\n      timeFilter = {\r\n        min: min.toUTCString(),\r\n        max: max.toUTCString(),\r\n        range: true,\r\n        type: TimeFilterType.DATETIME,\r\n        style: TimeFilterStyle.CALENDAR\r\n      };\r\n    }\r\n    const params = Object.assign(\r\n      {},\r\n      {\r\n        legendInfo,\r\n        style,\r\n        timeFilter,\r\n        timeExtent,\r\n        attributions\r\n      }\r\n    );\r\n    const options = ObjectUtils.removeUndefined({\r\n      params,\r\n      _layerOptionsFromSource: {\r\n        title,\r\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\r\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\r\n        metadata: {\r\n          extern: false,\r\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\r\n        },\r\n      },\r\n      sourceFields: arcgisOptions.fields,\r\n      queryTitle: arcgisOptions.displayField\r\n    });\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseTileOrImageArcgisOptions(\r\n    baseOptions: TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions,\r\n    arcgisOptions: any,\r\n    legend: any,\r\n    serviceCapabilities: any\r\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\r\n    const title = arcgisOptions.name;\r\n    const legendInfo = legend.layers ? legend : undefined;\r\n    const attributions = new olAttribution({\r\n      target: arcgisOptions.copyrightText\r\n    });\r\n    let timeExtent;\r\n    let timeFilter;\r\n    if (arcgisOptions.timeInfo) {\r\n      const time = arcgisOptions.timeInfo.timeExtent;\r\n      timeExtent = time[0] + ',' + time[1];\r\n      const min = new Date();\r\n      min.setTime(time[0]);\r\n      const max = new Date();\r\n      max.setTime(time[1]);\r\n      timeFilter = {\r\n        min: min.toUTCString(),\r\n        max: max.toUTCString(),\r\n        range: true,\r\n        type: TimeFilterType.DATETIME,\r\n        style: TimeFilterStyle.CALENDAR\r\n      };\r\n    }\r\n    const params = Object.assign(\r\n      {},\r\n      {\r\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\r\n        time: timeExtent\r\n      }\r\n    );\r\n    const options = ObjectUtils.removeUndefined({\r\n      params,\r\n      _layerOptionsFromSource: {\r\n        title,\r\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\r\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\r\n        metadata: {\r\n          extern: false,\r\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\r\n        },\r\n      },\r\n      legendInfo,\r\n      timeFilter,\r\n      attributions,\r\n      sourceFields: arcgisOptions.fields,\r\n      queryTitle: arcgisOptions.displayField\r\n    });\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private findDataSourceInCapabilities(layerArray, name): any {\r\n    if (Array.isArray(layerArray)) {\r\n      let layer;\r\n      layerArray.find((value) => {\r\n        layer = this.findDataSourceInCapabilities(value, name);\r\n        return layer !== undefined;\r\n      }, this);\r\n\r\n      return layer;\r\n    } else if (layerArray.Layer) {\r\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\r\n    } else {\r\n      if (layerArray.Name && layerArray.Name === name) {\r\n        return layerArray;\r\n      }\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  getTimeFilter(layer) {\r\n    let dimension;\r\n\r\n    if (layer.Dimension) {\r\n      const timeFilter: any = {};\r\n      dimension = layer.Dimension[0];\r\n\r\n      if (dimension.values) {\r\n        const minMaxDim = dimension.values.split('/');\r\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\r\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\r\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\r\n      }\r\n\r\n      if (dimension.default) {\r\n        timeFilter.value = dimension.default;\r\n      }\r\n      return timeFilter;\r\n    }\r\n  }\r\n\r\n  getStyle(Style): LegendOptions {\r\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\r\n      return {\r\n        name: style.Name,\r\n        title: style.Title\r\n      };\r\n    })\r\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\r\n      .filter(\r\n        (item, index, self) =>\r\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\r\n          index\r\n      );\r\n\r\n    const legendOptions: LegendOptions = {\r\n      stylesAvailable: styleOptions\r\n    } as LegendOptions;\r\n\r\n    return legendOptions;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport proj4 from 'proj4';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olproj4 from 'ol/proj/proj4';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Projection } from './projection.interfaces';\r\n\r\n/**\r\n * When injected, this service automatically registers and\r\n * projection defined in the application config. A custom projection\r\n * needs to be registered to be usable by OL.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ProjectionService {\r\n\r\n  constructor(private config: ConfigService) {\r\n    const projections = this.config.getConfig('projections') || [];\r\n    projections.forEach((projection: Projection) => {\r\n      projection.alias = projection.alias ? projection.alias : projection.code;\r\n      this.registerProjection(projection);\r\n    });\r\n\r\n    // register all utm zones\r\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\r\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\r\n      const proj: Projection = { code, def, extent : undefined};\r\n      this.registerProjection(proj);\r\n    }\r\n\r\n    // register all mtm zones\r\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\r\n      const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n      let lon0;\r\n      if (Number(mtmZone) <= 2) {\r\n        lon0 = -50 - Number(mtmZone) * 3;\r\n      } else if (Number(mtmZone) >= 12) {\r\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\r\n      } else {\r\n        lon0 = -49.5 - Number(mtmZone) * 3;\r\n      }\r\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\r\n      const proj: Projection = { code, def, extent : undefined};\r\n      this.registerProjection(proj);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define a proj4 projection and register it in OL\r\n   * @param projection Projection\r\n   */\r\n  registerProjection(projection: Projection) {\r\n    proj4.defs(projection.code, projection.def);\r\n    olproj4.register(proj4);\r\n    if (projection.extent) {\r\n      olproj.get(projection.code).setExtent(projection.extent);\r\n    }\r\n  }\r\n\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\nimport { CapabilitiesService } from './capabilities.service';\r\nimport { OptionsService } from './options/options.service';\r\nimport { WFSService } from './datasources/wfs.service';\r\nimport {\r\n  DataSource,\r\n  OSMDataSource,\r\n  OSMDataSourceOptions,\r\n  FeatureDataSource,\r\n  FeatureDataSourceOptions,\r\n  XYZDataSource,\r\n  XYZDataSourceOptions,\r\n  TileDebugDataSource,\r\n  TileDebugDataSourceOptions,\r\n  WFSDataSource,\r\n  WFSDataSourceOptions,\r\n  WMTSDataSource,\r\n  WMTSDataSourceOptions,\r\n  WMSDataSource,\r\n  WMSDataSourceOptions,\r\n  CartoDataSource,\r\n  CartoDataSourceOptions,\r\n  ArcGISRestDataSource,\r\n  ArcGISRestDataSourceOptions,\r\n  ImageArcGISRestDataSource,\r\n  ArcGISRestImageDataSourceOptions,\r\n  TileArcGISRestDataSource,\r\n  TileArcGISRestDataSourceOptions,\r\n  WebSocketDataSource,\r\n  AnyDataSourceOptions,\r\n  MVTDataSource,\r\n  MVTDataSourceOptions,\r\n  ClusterDataSource,\r\n  ClusterDataSourceOptions\r\n} from './datasources';\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { ProjectionService } from '../../map/shared/projection.service';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DataSourceService {\r\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    @Optional() private optionsService: OptionsService,\r\n    private wfsDataSourceService: WFSService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private projectionService: ProjectionService,\r\n    private authInterceptor?: AuthInterceptor\r\n  ) {}\r\n\r\n  createAsyncDataSource(context: AnyDataSourceOptions, detailedContextUri?: string): Observable<DataSource> {\r\n    if (!context.type) {\r\n      console.error(context);\r\n      throw new Error('Datasource needs a type');\r\n    }\r\n    let dataSource;\r\n    switch (context.type.toLowerCase()) {\r\n      case 'osm':\r\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\r\n        break;\r\n      case 'vector':\r\n        dataSource = this.createFeatureDataSource(\r\n          context as FeatureDataSourceOptions\r\n        );\r\n        break;\r\n      case 'wfs':\r\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\r\n        break;\r\n      case 'wms':\r\n        const wmsContext = context as WMSDataSourceOptions;\r\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\r\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\r\n        break;\r\n      case 'wmts':\r\n        dataSource = this.createWMTSDataSource(\r\n          context as WMTSDataSourceOptions\r\n        );\r\n        break;\r\n      case 'xyz':\r\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\r\n        break;\r\n      case 'tiledebug':\r\n        dataSource = this.createTileDebugDataSource(context as TileDebugDataSource);\r\n        break;\r\n      case 'carto':\r\n        dataSource = this.createCartoDataSource(\r\n          context as CartoDataSourceOptions\r\n        );\r\n        break;\r\n      case 'arcgisrest':\r\n        dataSource = this.createArcGISRestDataSource(\r\n          context as ArcGISRestDataSourceOptions, detailedContextUri\r\n        );\r\n        break;\r\n      case 'imagearcgisrest':\r\n        dataSource = this.createArcGISRestImageDataSource(\r\n          context as ArcGISRestImageDataSourceOptions, detailedContextUri\r\n        );\r\n        break;\r\n      case 'websocket':\r\n        dataSource = this.createWebSocketDataSource(\r\n          context as FeatureDataSourceOptions\r\n        );\r\n        break;\r\n      case 'mvt':\r\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\r\n        break;\r\n      case 'tilearcgisrest':\r\n        dataSource = this.createTileArcGISRestDataSource(\r\n          context as TileArcGISRestDataSourceOptions, detailedContextUri\r\n        );\r\n        break;\r\n      case 'cluster':\r\n        dataSource = this.createClusterDataSource(\r\n          context as ClusterDataSourceOptions\r\n        );\r\n        break;\r\n      default:\r\n        console.error(context);\r\n        throw new Error('Invalid datasource type');\r\n    }\r\n\r\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\r\n\r\n    return dataSource;\r\n  }\r\n\r\n  private createOSMDataSource(\r\n    context: OSMDataSourceOptions\r\n  ): Observable<OSMDataSource> {\r\n    return new Observable(d => d.next(new OSMDataSource(context)));\r\n  }\r\n\r\n  private createFeatureDataSource(\r\n    context: FeatureDataSourceOptions\r\n  ): Observable<FeatureDataSource> {\r\n    return new Observable(d => d.next(new FeatureDataSource(context)));\r\n  }\r\n\r\n  private createWebSocketDataSource(\r\n    context: FeatureDataSourceOptions\r\n  ): Observable<WebSocketDataSource> {\r\n    return new Observable(d => d.next(new WebSocketDataSource(context)));\r\n  }\r\n\r\n  private createWFSDataSource(\r\n    context: WFSDataSourceOptions\r\n  ): Observable<WFSDataSource> {\r\n    return new Observable(d =>\r\n      d.next(new WFSDataSource(context, this.wfsDataSourceService, this.authInterceptor))\r\n    );\r\n  }\r\n\r\n  private createWMSDataSource(context: WMSDataSourceOptions, detailedContextUri?: string): Observable<any> {\r\n    const observables = [];\r\n    if (context.optionsFromCapabilities) {\r\n      observables.push(\r\n        this.capabilitiesService.getWMSOptions(context).pipe(\r\n          catchError(e => {\r\n            const title = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailableTitle'\r\n            );\r\n            const message = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailable',\r\n              { value: context.params.LAYERS }\r\n            );\r\n\r\n            this.messageService.error(message, title);\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n\r\n    if (this.optionsService && context.optionsFromApi === true) {\r\n      observables.push(\r\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\r\n          catchError(e => {\r\n            e.error.toDisplay = true;\r\n            e.error.title = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailableTitle'\r\n            );\r\n            e.error.message = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.optionsApiUnavailable'\r\n            );\r\n            return of({});\r\n          })\r\n        )\r\n      );\r\n    }\r\n\r\n    observables.push(of(context));\r\n\r\n    return forkJoin(observables).pipe(\r\n      map((options: WMSDataSourceOptions[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createWMTSDataSource(\r\n    context: WMTSDataSourceOptions\r\n  ): Observable<WMTSDataSource> {\r\n    if (context.optionsFromCapabilities) {\r\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\r\n        map((options: WMTSDataSourceOptions) => {\r\n          return options ? new WMTSDataSource(options) : undefined;\r\n        }),\r\n        catchError(() => {\r\n          const title = this.languageService.translate.instant(\r\n            'igo.geo.dataSource.unavailableTitle'\r\n          );\r\n          const message = this.languageService.translate.instant(\r\n            'igo.geo.dataSource.unavailable',\r\n            { value: context.layer }\r\n          );\r\n\r\n          this.messageService.error(message, title);\r\n          return of(undefined);\r\n        })\r\n      );\r\n    }\r\n\r\n    return new Observable(d => d.next(new WMTSDataSource(context)));\r\n  }\r\n\r\n  private createXYZDataSource(\r\n    context: XYZDataSourceOptions\r\n  ): Observable<XYZDataSource> {\r\n    return new Observable(d => d.next(new XYZDataSource(context)));\r\n  }\r\n\r\n  private createTileDebugDataSource(\r\n    context: TileDebugDataSourceOptions\r\n  ): Observable<TileDebugDataSource> {\r\n    return new Observable(d => d.next(new TileDebugDataSource(context)));\r\n  }\r\n\r\n  private createCartoDataSource(\r\n    context: CartoDataSourceOptions\r\n  ): Observable<CartoDataSource> {\r\n    if (context.mapId) {\r\n      return this.capabilitiesService\r\n        .getCartoOptions(context)\r\n        .pipe(\r\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\r\n        );\r\n    }\r\n    return new Observable(d => d.next(new CartoDataSource(context)));\r\n  }\r\n\r\n  private createArcGISRestDataSource(\r\n    context: ArcGISRestDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<ArcGISRestDataSource> {\r\n    const observables = [];\r\n    observables.push(this.capabilitiesService.getArcgisOptions(context).pipe(\r\n      catchError(e => {\r\n        const title = this.languageService.translate.instant(\r\n          'igo.geo.dataSource.unavailableTitle'\r\n        );\r\n        const message = this.languageService.translate.instant(\r\n          'igo.geo.dataSource.unavailable',\r\n          { value: context.layer }\r\n        );\r\n\r\n        this.messageService.error(message, title);\r\n        throw e;\r\n      })\r\n    ));\r\n    if (this.optionsService && context.optionsFromApi === true) {\r\n      observables.push(\r\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\r\n          catchError(e => {\r\n            e.error.toDisplay = true;\r\n            e.error.title = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailableTitle'\r\n            );\r\n            e.error.message = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.optionsApiUnavailable'\r\n            );\r\n            return of({});\r\n          })\r\n        )\r\n      );\r\n    }\r\n    observables.push(of(context));\r\n    return forkJoin(observables).pipe(\r\n      map((options: ArcGISRestDataSource[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new ArcGISRestDataSource(optionsMerged);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createArcGISRestImageDataSource(\r\n    context: ArcGISRestImageDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<ArcGISRestImageDataSourceOptions> {\r\n    const observables = [];\r\n\r\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\r\n      catchError(e => {\r\n        const title = this.languageService.translate.instant(\r\n          'igo.geo.dataSource.unavailableTitle'\r\n        );\r\n        const message = this.languageService.translate.instant(\r\n          'igo.geo.dataSource.unavailable',\r\n          { value: context.params.LAYERS }\r\n        );\r\n\r\n        this.messageService.error(message, title);\r\n        throw e;\r\n      })\r\n    ));\r\n    if (this.optionsService && context.optionsFromApi === true) {\r\n      observables.push(\r\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\r\n          catchError(e => {\r\n            e.error.toDisplay = true;\r\n            e.error.title = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailableTitle'\r\n            );\r\n            e.error.message = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.optionsApiUnavailable'\r\n            );\r\n            return of({});\r\n          })\r\n        )\r\n      );\r\n    }\r\n    observables.push(of(context));\r\n    return forkJoin(observables).pipe(\r\n      map((options: ImageArcGISRestDataSource[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new ImageArcGISRestDataSource(optionsMerged);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createTileArcGISRestDataSource(\r\n    context: TileArcGISRestDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<TileArcGISRestDataSource> {\r\n    const observables = [];\r\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\r\n      catchError(e => {\r\n        const title = this.languageService.translate.instant(\r\n          'igo.geo.dataSource.unavailableTitle'\r\n        );\r\n        const message = this.languageService.translate.instant(\r\n          'igo.geo.dataSource.unavailable',\r\n          { value: context.params.LAYERS }\r\n        );\r\n\r\n        this.messageService.error(message, title);\r\n        throw e;\r\n      })\r\n    ));\r\n    if (this.optionsService && context.optionsFromApi === true) {\r\n      observables.push(\r\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\r\n          catchError(e => {\r\n            e.error.toDisplay = true;\r\n            e.error.title = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailableTitle'\r\n            );\r\n            e.error.message = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.optionsApiUnavailable'\r\n            );\r\n            return of({});\r\n          })\r\n        )\r\n      );\r\n    }\r\n    observables.push(of(context));\r\n    return forkJoin(observables).pipe(\r\n      map((options: TileArcGISRestDataSource[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new TileArcGISRestDataSource(optionsMerged);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createMVTDataSource(\r\n    context: MVTDataSourceOptions\r\n  ): Observable<MVTDataSource> {\r\n    return new Observable(d => d.next(new MVTDataSource(context)));\r\n  }\r\n\r\n  private createClusterDataSource(\r\n    context: ClusterDataSourceOptions\r\n  ): Observable<ClusterDataSource> {\r\n    return new Observable(d => d.next(new ClusterDataSource(context)));\r\n  }\r\n}\r\n","import * as olextent from 'ol/extent';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olstyle from 'ol/style';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlGeometryLayout from 'ol/geom/GeometryLayout';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlRenderFeature from 'ol/render/Feature';\r\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport OlLayer from 'ol/layer/Layer';\r\nimport OlSource from 'ol/source/Source';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport {\r\n  EntityKey,\r\n  getEntityId,\r\n  getEntityTitle,\r\n  getEntityRevision,\r\n  getEntityIcon,\r\n  getEntityProperty\r\n} from '@igo2/common';\r\n\r\nimport { IgoMap } from '../../map';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { FEATURE, FeatureMotion } from './feature.enums';\r\nimport { Feature, FeatureGeometry } from './feature.interfaces';\r\nimport { FeatureStore } from './store';\r\n\r\n/**\r\n * Create an Openlayers feature object out of a feature definition.\r\n * The output object has a reference to the feature id.\r\n * @param feature Feature definition\r\n * @param projectionOut Feature object projection\r\n * @returns OpenLayers feature object\r\n */\r\nexport function featureToOl(\r\n  feature: Feature,\r\n  projectionOut: string,\r\n  getId?: (Feature) => EntityKey\r\n): OlFeature<OlGeometry> {\r\n  getId = getId ? getId : getEntityId;\r\n\r\n  const olFormat = new OlFormatGeoJSON();\r\n  const olFeature = olFormat.readFeature(feature, {\r\n    dataProjection: feature.projection,\r\n    featureProjection: projectionOut\r\n  });\r\n\r\n  olFeature.setId(getId(feature));\r\n\r\n  const title = getEntityTitle(feature);\r\n  if (title !== undefined) {\r\n    olFeature.set('_title', title, true);\r\n  }\r\n\r\n  if (feature.extent !== undefined) {\r\n    olFeature.set('_extent', feature.extent, true);\r\n  }\r\n\r\n  if (feature.projection !== undefined) {\r\n    olFeature.set('_projection', feature.projection, true);\r\n  }\r\n\r\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\r\n  if (mapTitle !== undefined) {\r\n    olFeature.set('_mapTitle', mapTitle, true);\r\n  }\r\n\r\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\r\n\r\n  const icon = getEntityIcon(feature);\r\n  if (icon !== undefined) {\r\n    olFeature.set('_icon', icon, true);\r\n  }\r\n\r\n  if (feature.meta && feature.meta.style) {\r\n    olFeature.set('_style', feature.meta.style, true);\r\n  }\r\n\r\n  if (feature.sourceId) {\r\n    olFeature.set('_sourceId', feature.sourceId, true);\r\n  }\r\n\r\n  return olFeature;\r\n}\r\n\r\nexport function renderFeatureFromOl(\r\n  olRenderFeature: OlRenderFeature,\r\n  projectionIn: string,\r\n  olLayer?: OlLayer<OlSource>,\r\n  projectionOut = 'EPSG:4326'\r\n): Feature {\r\n  let geom;\r\n  let title;\r\n  let exclude;\r\n  let excludeOffline;\r\n\r\n  if (olLayer) {\r\n    title = olLayer.get('title');\r\n    if (olLayer.get('sourceOptions')) {\r\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\r\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\r\n    }\r\n  } else {\r\n    title = olRenderFeature.get('_title');\r\n  }\r\n\r\n  const olFormat = new OlFormatGeoJSON();\r\n  const properties = olRenderFeature.getProperties();\r\n  const geometryType = olRenderFeature.getType();\r\n\r\n  if (geometryType === 'Polygon') {\r\n    const ends = olRenderFeature.getEnds() as number[];\r\n    geom = new OlPolygon(\r\n      olRenderFeature.getFlatCoordinates(),\r\n      OlGeometryLayout.XY,\r\n      ends\r\n    );\r\n  } else if (geometryType === 'Point') {\r\n    geom = new OlPoint(olRenderFeature.getFlatCoordinates(), OlGeometryLayout.XY);\r\n  } else if (geometryType === 'LineString') {\r\n    geom = new OlLineString(\r\n      olRenderFeature.getFlatCoordinates(),\r\n      OlGeometryLayout.XY\r\n    );\r\n  }\r\n\r\n  const geometry = olFormat.writeGeometryObject(geom, {\r\n    dataProjection: projectionOut,\r\n    featureProjection: projectionIn\r\n  }) as FeatureGeometry;\r\n\r\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\r\n  const mapTitle = olRenderFeature.get('_mapTitle');\r\n  const extent = olproj.transformExtent(olRenderFeature.getExtent(), projectionIn, projectionOut) as [number, number, number, number];\r\n  return {\r\n    type: FEATURE,\r\n    projection: projectionOut,\r\n    extent,\r\n    meta: {\r\n      id,\r\n      title: title ? title : mapTitle ? mapTitle : id,\r\n      mapTitle,\r\n      excludeAttribute: exclude,\r\n      excludeAttributeOffline: excludeOffline\r\n    },\r\n    properties,\r\n    geometry,\r\n    ol: olRenderFeature\r\n  };\r\n}\r\n/**\r\n * Create a feature object out of an OL feature\r\n * The output object has a reference to the feature id.\r\n * @param olFeature OL Feature\r\n * @param projectionIn OL feature projection\r\n * @param olLayer OL Layer\r\n * @param projectionOut Feature projection\r\n * @returns Feature\r\n */\r\nexport function featureFromOl(\r\n  olFeature: OlFeature<OlGeometry>,\r\n  projectionIn: string,\r\n  olLayer?: OlLayer<OlSource>,\r\n  projectionOut = 'EPSG:4326'\r\n): Feature {\r\n  let title;\r\n  let exclude;\r\n  let excludeOffline;\r\n  let idColumn; // for arcgisrest and tilearcgisrest source\r\n  const olFormat = new OlFormatGeoJSON();\r\n\r\n  const keys = olFeature.getKeys().filter((key: string) => {\r\n    return !key.startsWith('_') && key !== 'geometry';\r\n  });\r\n  const properties = keys.reduce((acc: object, key: string) => {\r\n    acc[key] = olFeature.get(key);\r\n    return acc;\r\n  }, {});\r\n\r\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\r\n    dataProjection: projectionOut,\r\n    featureProjection: projectionIn\r\n  }) as FeatureGeometry;\r\n\r\n  if (olLayer) {\r\n    title = olLayer.get('title');\r\n    const sourceOptions = olLayer.get('sourceOptions');\r\n    if (sourceOptions) {\r\n      exclude = sourceOptions.excludeAttribute;\r\n      excludeOffline = sourceOptions.excludeAttributeOffline;\r\n      idColumn =\r\n        sourceOptions.idColumn ||\r\n        ((sourceOptions.type === 'arcgisrest' || sourceOptions.type === 'tilearcgisrest') ? 'OBJECTID' : undefined );\r\n    }\r\n  } else {\r\n    title = olFeature.get('_title');\r\n  }\r\n  const mapTitle = olFeature.get('_mapTitle');\r\n  const id = olFeature.getId() ? olFeature.getId() : olFeature.get(idColumn) ? olFeature.get(idColumn) : uuid();\r\n\r\n  return {\r\n    type: FEATURE,\r\n    projection: projectionOut,\r\n    extent: olFeature.get('_extent'),\r\n    meta: {\r\n      id,\r\n      title: title ? title : mapTitle ? mapTitle : id,\r\n      mapTitle,\r\n      revision: olFeature.getRevision(),\r\n      style: olFeature.get('_style'),\r\n      excludeAttribute: exclude,\r\n      excludeAttributeOffline: excludeOffline\r\n    },\r\n    properties,\r\n    geometry,\r\n    ol: olFeature\r\n  };\r\n}\r\n\r\n/**\r\n * Compute an OL feature extent in it's map projection\r\n * @param map Map\r\n * @param olFeature OL feature\r\n * @returns Extent in the map projection\r\n */\r\nexport function computeOlFeatureExtent(\r\n  map: IgoMap,\r\n  olFeature: OlFeature<OlGeometry>\r\n): [number, number, number, number] {\r\n  let olExtent = olextent.createEmpty();\r\n\r\n  const olFeatureExtent = olFeature.get('_extent');\r\n  const olFeatureProjection = olFeature.get('_projection');\r\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\r\n    olExtent = olproj.transformExtent(\r\n      olFeatureExtent,\r\n      olFeatureProjection,\r\n      map.projection\r\n    );\r\n  } else {\r\n    const olGeometry = olFeature.getGeometry();\r\n    if (olGeometry !== null) {\r\n      olExtent = olGeometry.getExtent();\r\n    }\r\n  }\r\n\r\n  return olExtent as [number, number, number, number];\r\n}\r\n\r\n/**\r\n * Compute a multiple OL features extent in their map projection\r\n * @param map Map\r\n * @param olFeatures OL features\r\n * @returns Extent in the map projection\r\n */\r\nexport function computeOlFeaturesExtent(\r\n  map: IgoMap,\r\n  olFeatures: OlFeature<OlGeometry>[]\r\n): [number, number, number, number] {\r\n  const extent = olextent.createEmpty();\r\n\r\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n    const featureExtent = computeOlFeatureExtent(map, olFeature);\r\n    olextent.extend(extent, featureExtent);\r\n  });\r\n\r\n  return extent as [number, number, number, number];\r\n}\r\n\r\n/**\r\n * Scale an extent.\r\n * @param extent Extent\r\n * @param Scaling factors for top, right, bottom and left directions, in that order\r\n * @returns Scaled extent\r\n */\r\nexport function scaleExtent(\r\n  extent: [number, number, number, number],\r\n  scale: [number, number, number, number]\r\n): [number, number, number, number] {\r\n  const [width, height] = olextent.getSize(extent);\r\n  return [\r\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\r\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\r\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\r\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\r\n  ];\r\n}\r\n\r\n/**\r\n * Return true if features are out of view.\r\n * If features are too close to the edge, they are considered out of view.\r\n * We define the edge as 5% of the extent size.\r\n * @param map Map\r\n * @param featuresExtent The features's extent\r\n * @returns Return true if features are out of view\r\n */\r\nexport function featuresAreOutOfView(\r\n  map: IgoMap,\r\n  featuresExtent: [number, number, number, number]\r\n) {\r\n  const mapExtent = map.viewController.getExtent();\r\n  const edgeRatio = 0.05;\r\n  const scale = [-1, -1, -1, -1].map(x => x * edgeRatio);\r\n  const viewExtent = scaleExtent(mapExtent, scale as [\r\n    number,\r\n    number,\r\n    number,\r\n    number\r\n  ]);\r\n\r\n  return !olextent.containsExtent(viewExtent, featuresExtent);\r\n}\r\n\r\n/**\r\n * Return true if features are too deep into the view. This results\r\n * in features being too small.\r\n * Features are considered too small if their extent occupies less than\r\n * 1% of the map extent.\r\n * @param map Map\r\n * @param featuresExtent The features's extent\r\n * @param areaRatio The features extent to view extent acceptable ratio\r\n * @returns Return true if features are too deep in the view\r\n */\r\nexport function featuresAreTooDeepInView(\r\n  map: IgoMap,\r\n  featuresExtent: [number, number, number, number],\r\n  areaRatio?: number\r\n) {\r\n  // An area ratio of 0.004 means that the feature extent's width and height\r\n  // should be about 1/16 of the map extent's width and height\r\n  areaRatio = areaRatio ? areaRatio : 0.004;\r\n  const mapExtent = map.viewController.getExtent();\r\n  const mapExtentArea = olextent.getArea(mapExtent);\r\n  const featuresExtentArea = olextent.getArea(featuresExtent);\r\n\r\n  if (featuresExtentArea === 0 && map.viewController.getZoom() > 13) {\r\n    // In case it's a point\r\n    return false;\r\n  }\r\n\r\n  return featuresExtentArea / mapExtentArea < areaRatio;\r\n}\r\n\r\n/**\r\n * Fit view to include the features extent.\r\n * By default, this method will let the features occupy about 50% of the viewport.\r\n * @param map Map\r\n * @param olFeatures OL features\r\n * @param motion To motion to the new map view\r\n * @param scale If this is defined, the original view will be scaled\r\n *  by that factor before any logic is applied.\r\n */\r\nexport function moveToOlFeatures(\r\n  map: IgoMap,\r\n  olFeatures: OlFeature<OlGeometry>[],\r\n  motion: FeatureMotion = FeatureMotion.Default,\r\n  scale?: [number, number, number, number],\r\n  areaRatio?: number\r\n) {\r\n  const featuresExtent = computeOlFeaturesExtent(map, olFeatures);\r\n  let viewExtent = featuresExtent;\r\n  if (scale !== undefined) {\r\n    viewExtent = scaleExtent(viewExtent, scale);\r\n  }\r\n\r\n  if (motion === FeatureMotion.Zoom) {\r\n    map.viewController.zoomToExtent(viewExtent);\r\n  } else if (motion === FeatureMotion.Move) {\r\n    map.viewController.moveToExtent(viewExtent);\r\n  } else if (motion === FeatureMotion.Default) {\r\n    if (\r\n      featuresAreOutOfView(map, featuresExtent) ||\r\n      featuresAreTooDeepInView(map, featuresExtent, areaRatio)\r\n    ) {\r\n      map.viewController.zoomToExtent(viewExtent);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Hide an OL feature\r\n * @param olFeature OL feature\r\n */\r\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\r\n  olFeature.setStyle(new olstyle.Style({}));\r\n}\r\n\r\n/**\r\n * Try to bind a layer to a store if none is bound already.\r\n * The layer will also be added to the store's map.\r\n * If no layer is given to that function, a basic one will be created.\r\n * @param store The store to bind the layer\r\n * @param layer An optional VectorLayer\r\n */\r\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\r\n  if (store.layer !== undefined) {\r\n    if (store.layer.map === undefined) {\r\n      store.map.addLayer(store.layer);\r\n    }\r\n    return;\r\n  }\r\n\r\n  layer = layer\r\n    ? layer\r\n    : new VectorLayer({\r\n        source: new FeatureDataSource()\r\n      });\r\n  store.bindLayer(layer);\r\n  if (store.layer.map === undefined) {\r\n    store.map.addLayer(store.layer);\r\n  }\r\n}\r\n\r\n/**\r\n * Compute a diff between a source array of Ol features and a target array\r\n * @param source Source array of OL features\r\n * @param starget Target array of OL features\r\n * @returns Features to add and remove\r\n */\r\nexport function computeOlFeaturesDiff(\r\n  source: OlFeature<OlGeometry>[],\r\n  target: OlFeature<OlGeometry>[]\r\n): {\r\n  add: OlFeature<OlGeometry>[];\r\n  remove: OlFeature<OlGeometry>[];\r\n} {\r\n  const olFeaturesMap = new Map();\r\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n    olFeaturesMap.set(olFeature.getId(), olFeature);\r\n  });\r\n\r\n  const olFeaturesToRemove = [];\r\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\r\n    if (newOlFeature === undefined) {\r\n      olFeaturesToRemove.push(olFeature);\r\n    } else if (\r\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\r\n    ) {\r\n      olFeaturesToRemove.push(olFeature);\r\n    } else {\r\n      olFeaturesMap.delete(newOlFeature.getId());\r\n    }\r\n  });\r\n\r\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\r\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\r\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\r\n  });\r\n\r\n  return {\r\n    add: olFeaturesToAdd,\r\n    remove: olFeaturesToRemove\r\n  };\r\n}\r\n","import OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport {\r\n  getEntityId,\r\n  EntityKey,\r\n  EntityStore\r\n} from '@igo2/common';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nimport { FeatureMotion } from './feature.enums';\r\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\r\nimport { computeOlFeaturesDiff, featureFromOl, featureToOl, moveToOlFeatures } from './feature.utils';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * features and the map layer to display them on. Synchronization\r\n * between the store and the layer is handled by strategies.\r\n */\r\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\r\n\r\n  /**\r\n   * Vector layer to display the features on\r\n   */\r\n  layer: VectorLayer;\r\n\r\n  /**\r\n   * The map the layer is bound to\r\n   */\r\n  readonly map: IgoMap;\r\n\r\n  /**\r\n   * The layer's data source\r\n   */\r\n  get source(): FeatureDataSource {\r\n    return this.layer ? this.layer.dataSource as FeatureDataSource : undefined;\r\n  }\r\n\r\n  constructor(entities: T[], options: FeatureStoreOptions) {\r\n    super(entities, options);\r\n    this.map = options.map;\r\n  }\r\n\r\n  /**\r\n   * Bind this store to a vector layer\r\n   * @param layer Vector layer\r\n   * @returns Feature store\r\n   */\r\n  bindLayer(layer: VectorLayer): FeatureStore {\r\n    this.layer = layer;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set the layer's features and perform a motion to make them visible. Strategies\r\n   * make extensive use of that method.\r\n   * @param features Features\r\n   * @param motion Optional: The type of motion to perform\r\n   */\r\n  setLayerFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    viewScale?: [number, number, number, number],\r\n    areaRatio?: number,\r\n    getId?: (Feature) => EntityKey\r\n  ) {\r\n    getId = getId ? getId : getEntityId;\r\n    this.checkLayer();\r\n\r\n    const olFeatures = features\r\n      .map((feature: Feature) => featureToOl(feature, this.map.projection, getId));\r\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\r\n  }\r\n\r\n  /**\r\n   * Set the store's features from an array of OL features.\r\n   * @param olFeatures Ol features\r\n   */\r\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\r\n    this.checkLayer();\r\n\r\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      olFeature.set('_featureStore', this, true);\r\n      return featureFromOl(olFeature, this.layer.map.projection);\r\n    });\r\n    this.load(features as T[]);\r\n  }\r\n\r\n  /**\r\n   * Remove all features from the layer\r\n   */\r\n  clearLayer() {\r\n    this.checkLayer();\r\n    this.source.ol.clear();\r\n  }\r\n\r\n  /**\r\n   * Check wether a layer is bound or not and throw an error if not.\r\n   */\r\n  private checkLayer() {\r\n    if (this.layer === undefined) {\r\n      throw new Error('This FeatureStore is not bound to a layer.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the layer's features and perform a motion to make them visible.\r\n   * @param features Openlayers feature objects\r\n   * @param motion Optional: The type of motion to perform\r\n   */\r\n  public setLayerOlFeatures(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    viewScale?: [number, number, number, number],\r\n    areaRatio?: number\r\n  ) {\r\n    const olSource = this.layer.ol.getSource();\r\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\r\n    if (diff.remove.length > 0) {\r\n      this.removeOlFeaturesFromLayer(diff.remove);\r\n    }\r\n\r\n    if (diff.add.length > 0) {\r\n      this.addOlFeaturesToLayer(diff.add);\r\n    }\r\n\r\n    if (diff.add.length > 0) {\r\n      // If features are added, do a motion toward the newly added features\r\n      moveToOlFeatures(this.map, diff.add, motion, viewScale, areaRatio);\r\n    } else if (diff.remove.length > 0) {\r\n      // Else, do a motion toward all the features\r\n      moveToOlFeatures(this.map, olFeatures, motion, viewScale, areaRatio);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add features to the the layer\r\n   * @param features Openlayers feature objects\r\n   */\r\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\r\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n      olFeature.set('_featureStore', this, true);\r\n    });\r\n    this.source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  /**\r\n   * Remove features from the the layer\r\n   * @param features Openlayers feature objects\r\n   */\r\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\r\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n      this.source.ol.removeFeature(olFeature);\r\n    });\r\n  }\r\n\r\n}\r\n","import { unByKey } from 'ol/Observable';\r\nimport * as olextent from 'ol/extent';\r\n\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureStoreInMapExtentStrategyOptions, Feature } from '../feature.interfaces';\r\nimport { Subscription } from 'rxjs';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\n/**\r\n * This strategy maintain the store features updated while the map is moved.\r\n * The features's state inside the map are tagged inMapExtent = true;\r\n */\r\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\r\n\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n  private states$$: Subscription[] = [];\r\n  private empty$$: Subscription;\r\n\r\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n    this.empty$$ = store.empty$\r\n      .pipe(skipWhile((empty) => !empty))\r\n      .subscribe(() => this.updateEntitiesInExtent(store));\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.updateEntitiesInExtent(store);\r\n    this.states$$.push(store.layer.map.viewController.state$.subscribe(() => {\r\n      this.updateEntitiesInExtent(store);\r\n    }));\r\n  }\r\n\r\n  private updateEntitiesInExtent(store) {\r\n    if (store?.layer?.map?.viewController) {\r\n      store.state.updateAll({ inMapExtent: false });\r\n      const mapExtent = store.layer.map.viewController.getExtent();\r\n      const entitiesInMapExtent = store.entities$.value\r\n        .filter((entity: Feature) => olextent.intersects(entity.ol.getGeometry().getExtent(), mapExtent));\r\n      if (entitiesInMapExtent.length > 0) {\r\n        store.state.updateMany(entitiesInMapExtent, { inMapExtent: true }, true);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    this.stores$$.clear();\r\n    this.states$$.map(state => state.unsubscribe());\r\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\r\n  }\r\n}\r\n","import { unByKey } from 'ol/Observable';\r\n\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureStoreInMapResolutionStrategyOptions, Feature } from '../feature.interfaces';\r\nimport { Subscription } from 'rxjs';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\n/**\r\n * This strategy maintain the store features updated while the map is scrolled.\r\n * The features's state inside the map's resolution are tagged inMapResolution = true;\r\n */\r\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\r\n\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n  private resolution$$: Subscription[] = [];\r\n  private empty$$: Subscription;\r\n\r\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n    this.empty$$ = store.empty$\r\n      .subscribe(() => this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution()));\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution());\r\n    this.resolution$$.push(store.layer.map.viewController.resolution$.subscribe((res) => {\r\n      this.updateEntitiesInResolution(store, res);\r\n    }));\r\n  }\r\n\r\n  private updateEntitiesInResolution(store, mapResolution: number) {\r\n    if (mapResolution > store.layer.minResolution && mapResolution < store.layer.maxResolution) {\r\n      store.state.updateAll({ inMapResolution: true });\r\n    } else {\r\n      store.state.updateAll({ inMapResolution: false });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    this.stores$$.clear();\r\n    this.resolution$$.map(state => state.unsubscribe());\r\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\r\n  }\r\n}\r\n","import { Subscription } from 'rxjs';\r\n\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureMotion } from '../feature.enums';\r\nimport { Feature, FeatureStoreLoadingStrategyOptions } from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\n/**\r\n * This strategy loads a store's features into it's layer counterpart.\r\n * The store -> layer binding is a one-way binding. That means any entity\r\n * added to the store will be added to the layer but the opposite is false.\r\n *\r\n * Important: This strategy observes filtered entities, not raw entities. This\r\n * is not configurable yet.\r\n */\r\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\r\n\r\n  /**\r\n   * Subscription to the store's features\r\n   */\r\n  private stores$$ = new Map<FeatureStore, Subscription>();\r\n\r\n  private motion: FeatureMotion;\r\n\r\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\r\n    super(options);\r\n    this.setMotion(options.motion);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define the motion to apply on load\r\n   * @param motion Feature motion\r\n   */\r\n  setMotion(motion: FeatureMotion) {\r\n    this.motion = motion;\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for entities changes in a store.\r\n   * Important: Never observe a store's sorted entities. It makes no sense\r\n   * to display sorted entities (instead of unsorted) on a layer and it\r\n   * would potentially result in a lot of useless computation.\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    const subscription = store.view.all$()\r\n      .subscribe((features: Feature[]) => this.onFeaturesChange(features, store));\r\n    this.stores$$.set(store, subscription);\r\n  }\r\n\r\n  /**\r\n   * Stop watching for entities changes in a store.\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const subscription = this.stores$$.get(store);\r\n    if (subscription !== undefined) {\r\n      subscription.unsubscribe();\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for entities changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, Subscription]) => {\r\n      entries[1].unsubscribe();\r\n    });\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Load features into a layer or clear the layer if the array of features is empty.\r\n   * @param features Store filtered features\r\n   * @param store Feature store\r\n   */\r\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\r\n    if (features.length === 0) {\r\n      store.clearLayer();\r\n    } else {\r\n      store.setLayerFeatures(\r\n        features,\r\n        this.selectMotion(store),\r\n        this.options.viewScale,\r\n        this.options.areaRatio,\r\n        this.options.getFeatureId\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Selects the best motion\r\n   * @param store A FeatureStore to apply the motion\r\n   * @returns The motion selected\r\n   */\r\n  private selectMotion(store: FeatureStore) {\r\n    if (this.motion !== undefined) { return this.motion; }\r\n\r\n    if (store.pristine === true) {\r\n      // If features have just been loaded into the store, move/zoom on them\r\n      return FeatureMotion.Default;\r\n    } else if (store.count > store.view.count) {\r\n      // If features have been filtered, move/zoom on the remaining ones\r\n      return FeatureMotion.Default;\r\n    } else {\r\n      // On insert, update or delete, do nothing\r\n      return FeatureMotion.None;\r\n    }\r\n  }\r\n}\r\n","import { unByKey } from 'ol/Observable';\r\nimport OlEvent from 'ol/events/Event';\r\n\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\r\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\r\n\r\n/**\r\n * This strategy loads a layer's features into it's store counterpart.\r\n * The layer -> store binding is a one-way binding. That means any OL feature\r\n * added to the layer will be added to the store but the opposite is false.\r\n *\r\n * Important: In it's current state, this strategy is to meant to be combined\r\n * with a standard Loading strategy and it would probably cause recursion issues.\r\n */\r\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\r\n\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n\r\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.onSourceChanges(store);\r\n    const olSource = store.layer.ol.getSource();\r\n    olSource.on('change', (event: OlEvent) => {\r\n      this.onSourceChanges(store);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, string]) => {\r\n    });\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Load features from an OL source into a  store or clear the store if the source is empty\r\n   * @param features Store filtered features\r\n   * @param store Feature store\r\n   */\r\n  private onSourceChanges(store: FeatureStore) {\r\n    let olFeatures = store.layer.ol.getSource().getFeatures();\r\n\r\n    if (store.layer.dataSource instanceof ClusterDataSource) {\r\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\r\n        cluster.get('features')\r\n      );\r\n    }\r\n    if (olFeatures.length === 0) {\r\n      store.clear();\r\n    } else {\r\n      store.setStoreOlFeatures(olFeatures);\r\n    }\r\n  }\r\n}\r\n","import OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\r\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\r\nimport { EventsKey, ListenerFunction } from 'ol/events';\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { unByKey, OnReturn } from 'ol/Observable';\r\n\r\nimport { Subscription, combineLatest } from 'rxjs';\r\nimport { map, debounceTime, skip } from 'rxjs/operators';\r\n\r\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureDataSource } from '../../../datasource';\r\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../../map/shared/map';\r\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\r\n\r\nimport {\r\n  Feature,\r\n  FeatureStoreSelectionStrategyOptions\r\n} from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureMotion } from '../feature.enums';\r\n\r\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\r\n  constructor(options) {\r\n    super(options);\r\n  }\r\n}\r\n\r\n/**\r\n * This strategy synchronizes a store and a layer selected entities.\r\n * The store <-> layer binding is a two-way binding.\r\n *\r\n * In many cases, a single strategy bound to multiple stores\r\n * will yield better results that multiple strategies with each their\r\n * own store. In the latter scenario, a click on overlapping features\r\n * would trigger the strategy of each layer and they would cancel\r\n * each other as well as move the map view around needlessly.\r\n */\r\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Listener to the map click event that allows selecting a feature\r\n   * by clicking on the map\r\n   */\r\n  private mapClickListener: OnReturn;\r\n\r\n  private olDragSelectInteraction: OlDragSelectInteraction;\r\n\r\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\r\n\r\n  /**\r\n   * Subscription to all stores selected entities\r\n   */\r\n  private stores$$: Subscription;\r\n\r\n  private motion: FeatureMotion;\r\n\r\n  /**\r\n   * The map the layers belong to\r\n   */\r\n  get map(): IgoMap {\r\n    return this.options.map;\r\n  }\r\n\r\n  /**\r\n   * A feature store that'll contain the selected features. It has it's own\r\n   * layer, shared by all the stores this staretgy is bound to.\r\n   */\r\n  get overlayStore(): FeatureStore {\r\n    return this._overlayStore;\r\n  }\r\n  private _overlayStore: FeatureStore;\r\n\r\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\r\n    super(options);\r\n    this.setMotion(options.motion);\r\n    this._overlayStore = this.createOverlayStore();\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and force this strategy's\r\n   * reactivation to properly setup watchers.\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      // Force reactivation\r\n      this.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and force this strategy's\r\n   * reactivation to properly setup watchers.\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      // Force reactivation\r\n      this.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define the motion to apply on select\r\n   * @param motion Feature motion\r\n   */\r\n  setMotion(motion: FeatureMotion) {\r\n    this.motion = motion;\r\n  }\r\n\r\n  /**\r\n   * Unselect all entities, from all stores\r\n   */\r\n  unselectAll() {\r\n    this.stores.forEach((store: FeatureStore) => {\r\n      store.state.updateAll({ selected: false });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay\r\n   */\r\n  clear() {\r\n    this.overlayStore.source.ol.clear();\r\n    this.overlayStore.clear();\r\n  }\r\n\r\n  /**\r\n   * Deactivate the selection without removing the selection\r\n   * overlay.\r\n   */\r\n  deactivateSelection() {\r\n    this.removeDragBoxInteraction();\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer, setup the map click lsitener and\r\n   * start watching for stores selection\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.addOverlayLayer();\r\n    this.listenToMapClick();\r\n    if (this.options.dragBox === true) {\r\n      this.addDragBoxInteraction();\r\n    }\r\n    this.watchAll();\r\n  }\r\n\r\n  /**\r\n   * Remove the overlay layer, remove the map click lsitener and\r\n   * stop watching for stores selection\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.deactivateSelection();\r\n    this.removeOverlayLayer();\r\n  }\r\n\r\n  /**\r\n   * Create a single observable of all the stores. With a single observable,\r\n   * features can be added all at once to the overlay layer and a single\r\n   * motion can be performed. Multiple observable would have\r\n   * a cancelling effect on each other.\r\n   */\r\n  private watchAll() {\r\n    this.unwatchAll();\r\n\r\n    const stores$ = this.stores.map((store: FeatureStore) => {\r\n      return store.stateView\r\n        .manyBy$((record: EntityRecord<Feature>) => {\r\n          return record.state.selected === true;\r\n        })\r\n        .pipe(\r\n          map((records: EntityRecord<Feature>[]) =>\r\n            records.map((record) => record.entity)\r\n          )\r\n        );\r\n    });\r\n    this.stores$$ = combineLatest(stores$)\r\n      .pipe(\r\n        debounceTime(5),\r\n        skip(1), // Skip intial selection\r\n        map((features: Array<Feature[]>) =>\r\n          features.reduce((a, b) => a.concat(b))\r\n        )\r\n      )\r\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\r\n  }\r\n\r\n  /**\r\n   * Stop watching for selection in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    if (this.stores$$ !== undefined) {\r\n      this.stores$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a 'singleclick' listener to the map that'll allow selecting\r\n   * features by clicking on the map. The selection will be performed\r\n   * only on the layers bound to this strategy.\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: MapBrowserPointerEvent<any>) => {\r\n        this.onMapClick(event);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove the map click listener\r\n   */\r\n  // private unlistenToMapClick() {\r\n  //   if (this.mapClickListener !== undefined) {\r\n  //     this.map.ol.un(\r\n  //       this.mapClickListener.type,\r\n  //       this.mapClickListener.listener\r\n  //     );\r\n  //   }\r\n  // }\r\n\r\n  /**\r\n   * On map click, select feature at pixel\r\n   * @param event OL MapBrowserPointerEvent\r\n   */\r\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\r\n    const exclusive = !ctrlKeyDown(event);\r\n    const reverse = !exclusive;\r\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\r\n      hitTolerance: this.options.hitTolerance || 0,\r\n      layerFilter: olLayer => {\r\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\r\n          return store.layer.ol === olLayer;\r\n        });\r\n        return storeOlLayer !== undefined;\r\n      }\r\n    }) as OlFeature<OlGeometry>[];\r\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\r\n  }\r\n\r\n  /**\r\n   * Add a drag box interaction and, on drag box end, select features\r\n   */\r\n  private addDragBoxInteraction() {\r\n    let olDragSelectInteraction;\r\n    const olInteractions = this.map.ol.getInteractions().getArray();\r\n\r\n    // There can only be one dragbox interaction, so find the current one, if any\r\n    // Don't keep a reference to the current dragbox because we don't want\r\n    // to remove it when this startegy is deactivated\r\n    for (const olInteraction of olInteractions) {\r\n      if (olInteraction instanceof OlDragSelectInteraction) {\r\n        olDragSelectInteraction = olInteraction;\r\n        break;\r\n      }\r\n    }\r\n    // If no drag box interaction is found, create a new one and add it to the map\r\n    if (olDragSelectInteraction === undefined) {\r\n      olDragSelectInteraction = new OlDragSelectInteraction({\r\n        condition: ctrlKeyDown\r\n      });\r\n      this.map.ol.addInteraction(olDragSelectInteraction);\r\n      this.olDragSelectInteraction = olDragSelectInteraction;\r\n    }\r\n\r\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\r\n      'boxend',\r\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove drag box interaction\r\n   */\r\n  private removeDragBoxInteraction() {\r\n    if (this.olDragSelectInteractionEndKey !== undefined) {\r\n      unByKey(this.olDragSelectInteractionEndKey);\r\n    }\r\n    if (this.olDragSelectInteraction !== undefined) {\r\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\r\n    }\r\n    this.olDragSelectInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * On dragbox end, select features in drag box\r\n   * @param event OL MapBrowserPointerEvent\r\n   */\r\n  private onDragBoxEnd(event: OlDragBoxEvent) {\r\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\r\n    const target = event.target as any;\r\n    const extent = target.getGeometry().getExtent();\r\n    const olFeatures = this.stores.reduce(\r\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\r\n        const olSource = store.layer.ol.getSource();\r\n        acc.push(...olSource.getFeaturesInExtent(extent));\r\n        return acc;\r\n      },\r\n      []\r\n    );\r\n    this.onSelectFromMap(olFeatures, exclusive, false);\r\n  }\r\n\r\n  /**\r\n   * When features are selected from the store, add\r\n   * them to this startegy's overlay layer (select on map)\r\n   * @param features Store features\r\n   */\r\n  private onSelectFromStore(features: Feature[]) {\r\n    const motion = this.motion;\r\n    const olOverlayFeatures = this.overlayStore.layer.ol\r\n      .getSource()\r\n      .getFeatures();\r\n    const overlayFeaturesKeys = olOverlayFeatures.map((olFeature: OlFeature<OlGeometry>) =>\r\n      olFeature.getId()\r\n    );\r\n    const featuresKeys = features.map(this.overlayStore.getKey);\r\n\r\n    let doMotion;\r\n    if (features.length === 0) {\r\n      doMotion = false;\r\n    } else {\r\n      doMotion =\r\n        overlayFeaturesKeys.length !== featuresKeys.length ||\r\n        !overlayFeaturesKeys.every(\r\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\r\n        );\r\n    }\r\n\r\n    this.overlayStore.setLayerFeatures(\r\n      features,\r\n      doMotion ? motion : FeatureMotion.None,\r\n      this.options.viewScale,\r\n      this.options.areaRatio,\r\n      this.options.getFeatureId\r\n    );\r\n  }\r\n\r\n  /**\r\n   * When features are selected from the map, also select them\r\n   * in their store.\r\n   * @param olFeatures OL feature objects\r\n   */\r\n  private onSelectFromMap(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    exclusive: boolean,\r\n    reverse: boolean\r\n  ) {\r\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\r\n\r\n    this.stores.forEach((store: FeatureStore) => {\r\n      const features = groupedFeatures.get(store);\r\n      if (features === undefined && exclusive === true) {\r\n        this.unselectAllFeaturesFromStore(store);\r\n      } else if (features === undefined && exclusive === false) {\r\n        // Do nothing\r\n      } else {\r\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Select features in store\r\n   * @param store: Feature store\r\n   * @param features Features\r\n   */\r\n  private selectFeaturesFromStore(\r\n    store: FeatureStore,\r\n    features: Feature[],\r\n    exclusive: boolean,\r\n    reverse: boolean\r\n  ) {\r\n    if (reverse === true) {\r\n      store.state.reverseMany(features, ['selected']);\r\n    } else {\r\n      store.state.updateMany(features, { selected: true }, exclusive);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unselect all features from store\r\n   * @param store: Feature store\r\n   */\r\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\r\n    store.state.updateAll({ selected: false });\r\n  }\r\n\r\n  /**\r\n   * This method returns a store -> features mapping from a list\r\n   * of OL selected features. OL features keep a reference to the store\r\n   * they are from.\r\n   * @param olFeatures: OL feature objects\r\n   * @returns Store -> features mapping\r\n   */\r\n  private groupFeaturesByStore(\r\n    olFeatures: OlFeature<OlGeometry>[]\r\n  ): Map<FeatureStore, Feature[]> {\r\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\r\n    if (olFeatures === null || olFeatures === undefined) {\r\n      return groupedFeatures;\r\n    }\r\n\r\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n      const store = olFeature.get('_featureStore');\r\n      if (store === undefined) {\r\n        return;\r\n      }\r\n\r\n      let features = groupedFeatures.get(store);\r\n      if (features === undefined) {\r\n        features = [];\r\n        groupedFeatures.set(store, features);\r\n      }\r\n\r\n      const feature = store.get(olFeature.getId());\r\n      if (feature !== undefined) {\r\n        features.push(feature);\r\n      }\r\n    });\r\n\r\n    return groupedFeatures;\r\n  }\r\n\r\n  /**\r\n   * Create an overlay store that'll contain the selected features.\r\n   * @returns Overlay store\r\n   */\r\n  private createOverlayStore(): FeatureStore {\r\n    const overlayLayer = this.options.layer\r\n      ? this.options.layer\r\n      : this.createOverlayLayer();\r\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Create an overlay store that'll contain the selected features.\r\n   * @returns Overlay layer\r\n   */\r\n  private createOverlayLayer(): VectorLayer {\r\n    return new VectorLayer({\r\n      zIndex: 300,\r\n      source: new FeatureDataSource(),\r\n      style: undefined,\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the overlay store's layer to the map to display the selected\r\n   * features.\r\n   */\r\n  private addOverlayLayer() {\r\n    if (this.overlayStore.layer.map === undefined) {\r\n      this.map.addLayer(this.overlayStore.layer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the overlay layer from the map\r\n   */\r\n  private removeOverlayLayer() {\r\n    this.overlayStore.source.ol.clear();\r\n    this.map.removeLayer(this.overlayStore.layer);\r\n  }\r\n}\r\n","import { FeatureStore } from './store';\r\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\r\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\r\n\r\n/**\r\n * Try to add a loading strategy to a store and activate it.\r\n * If no strategy is given to that function, a basic one will be created.\r\n * @param store The store to bind the loading strategy\r\n * @param strategy An optional loading strategy\r\n */\r\nexport function tryAddLoadingStrategy(\r\n  store: FeatureStore,\r\n  strategy?: FeatureStoreLoadingStrategy\r\n) {\r\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\r\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\r\n    return;\r\n  }\r\n\r\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\r\n  store.addStrategy(strategy);\r\n  strategy.activate();\r\n}\r\n\r\n/**\r\n * Try to add a selection strategy to a store and activate it.\r\n * If no strategy is given to that function, a basic one will be created.\r\n * @param store The store to bind the selection strategy\r\n * @param [strategy] An optional selection strategy\r\n */\r\nexport function tryAddSelectionStrategy(\r\n  store: FeatureStore,\r\n  strategy?: FeatureStoreSelectionStrategy\r\n) {\r\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\r\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\r\n    return;\r\n  }\r\n  strategy = strategy\r\n    ? strategy\r\n    : new FeatureStoreSelectionStrategy({\r\n        map: store.map\r\n      });\r\n  store.addStrategy(strategy);\r\n  strategy.activate();\r\n}\r\n","import * as olstyle from 'ol/style';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\n\r\n/**\r\n * Create a marker style for points\r\n * @returns Style\r\n */\r\nexport function createOverlayMarkerStyle({\r\n  text,\r\n  opacity = 1,\r\n  markerColor = [0, 161, 222],\r\n  markerOutlineColor = [255, 255, 255]\r\n}: {\r\n  text?: string;\r\n  opacity?: number;\r\n  markerColor?: string | number[];\r\n  markerOutlineColor?: string | number[];\r\n} = {}): olstyle.Style {\r\n  let iconColor;\r\n  let svgIconColor;\r\n  let svgOutlineColor;\r\n  let svg;\r\n\r\n  const isIE = /msie\\s|trident\\/|edge\\//i.test(window.navigator.userAgent); // To fix IE11 svg bug (temporarly)\r\n\r\n  const newColor = ColorAsArray(markerColor).slice(0);\r\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\r\n\r\n  if (newColor.length === 4 && (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\r\n    opacity = newColor[3];\r\n  }\r\n\r\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\r\n  iconColor = markerColor;\r\n\r\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\r\n\r\n  svg =\r\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\r\n    '<path fill=' +\r\n    svgIconColor +\r\n    ' stroke=' +\r\n    svgOutlineColor +\r\n    ' stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>' +\r\n    '</svg>';\r\n\r\n  let src;\r\n  if (isIE) {\r\n    switch (markerColor) {\r\n      case 'blue' || [0, 161, 222] || '#00a1de':\r\n        iconColor = 'blue';\r\n        break;\r\n      case 'red' || '#f64139':\r\n        iconColor = 'red';\r\n        break;\r\n      case 'yellow' || '#ffd700':\r\n        iconColor = 'yellow';\r\n        break;\r\n      case 'green' || '#008000':\r\n        iconColor = 'green';\r\n        break;\r\n      default:\r\n        iconColor = 'blue';\r\n        break;\r\n    }\r\n    src = './assets/igo2/geo/icons/place_' + iconColor + '_36px.svg';\r\n  } else {\r\n    src = svg;\r\n  }\r\n\r\n  return new olstyle.Style({\r\n    image: new olstyle.Icon({\r\n      src: svg,\r\n      opacity,\r\n      imgSize: [36, 36], // for ie\r\n      anchor: [0.5, 0.92]\r\n    }),\r\n    text: new olstyle.Text({\r\n      text,\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport * as olstyle from 'ol/style';\r\nimport OlFeature from 'ol/Feature';\r\nimport { StyleByAttribute } from './vector-style.interface';\r\n\r\nimport { ClusterParam } from './clusterParam';\r\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StyleService {\r\n  public style: olstyle.Style;\r\n\r\n  createStyle(options: { [key: string]: any }) {\r\n    if (!options) {\r\n      return createOverlayMarkerStyle();\r\n    }\r\n    if (typeof options === 'function' || options instanceof olstyle.Style) {\r\n      return options;\r\n    }\r\n    return this.parseStyle('style', options);\r\n  }\r\n\r\n  private parseStyle(key: string, value: any) {\r\n    const styleOptions = {};\r\n    const olCls = this.getOlCls(key);\r\n\r\n    if (olCls && value instanceof Object) {\r\n      Object.keys(value).forEach(_key => {\r\n        const olKey = this.getOlKey(_key);\r\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\r\n      });\r\n      return new olCls(styleOptions);\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  private getOlKey(key: any) {\r\n    let olKey;\r\n    switch (key.toLowerCase()) {\r\n      case 'circle':\r\n      case 'regularshape':\r\n      case 'icon':\r\n        olKey = 'image';\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return olKey || key;\r\n  }\r\n\r\n  private getOlCls(key: any) {\r\n    let olCls = olstyle[key.charAt(0).toUpperCase() + key.slice(1)];\r\n    if (key === 'regularshape') {\r\n      olCls = olstyle.RegularShape;\r\n    }\r\n    if (key === 'backgroundFill') {\r\n      olCls = olstyle.Fill;\r\n    }\r\n    if (key === 'backgroundStroke') {\r\n      olCls = olstyle.Stroke;\r\n    }\r\n\r\n    return olCls;\r\n  }\r\n\r\n  createStyleByAttribute(feature, styleByAttribute: StyleByAttribute) {\r\n\r\n    let style;\r\n    const type = styleByAttribute.type ? styleByAttribute.type : this.guessTypeFeature(feature);\r\n    const attribute = styleByAttribute.attribute;\r\n    const data = styleByAttribute.data;\r\n    const stroke = styleByAttribute.stroke;\r\n    const width = styleByAttribute.width;\r\n    const fill = styleByAttribute.fill;\r\n    const radius = styleByAttribute.radius;\r\n    const icon = styleByAttribute.icon;\r\n    const scale = styleByAttribute.scale;\r\n    const size = data ? data.length : 0;\r\n    const label = styleByAttribute.label;\r\n    const labelStyle = label instanceof olstyle.Style ?\r\n      this.parseStyle('text', styleByAttribute.label) ||\r\n      new olstyle.Text() : undefined;\r\n    const baseStyle = styleByAttribute.baseStyle;\r\n\r\n    if (labelStyle) {\r\n      const options = {\r\n        text: this.getLabel(feature, label)\r\n      };\r\n\r\n      labelStyle instanceof olstyle.Style ? labelStyle.setText(new olstyle.Text(options)) :\r\n      labelStyle.setText(this.getLabel(feature, label));\r\n    }\r\n\r\n    if (type === 'circle') {\r\n      for (let i = 0; i < size; i++) {\r\n        const val =\r\n          typeof feature.get(attribute) !== 'undefined'\r\n            ? feature.get(attribute)\r\n            : '';\r\n        if (val === data[i] || val.toString().match(data[i])) {\r\n          if (icon) {\r\n            style = [\r\n              new olstyle.Style({\r\n                image: new olstyle.Icon({\r\n                  src: icon[i],\r\n                  scale: scale ? scale[i] : 1\r\n                })\r\n              })\r\n            ];\r\n            return style;\r\n          }\r\n          style = [\r\n            new olstyle.Style({\r\n              image: new olstyle.Circle({\r\n                radius: radius ? radius[i] : 4,\r\n                stroke: new olstyle.Stroke({\r\n                  color: stroke ? stroke[i] : 'black',\r\n                  width: width ? width[i] : 1\r\n                }),\r\n                fill: new olstyle.Fill({\r\n                  color: fill ? fill[i] : 'black'\r\n                })\r\n              }),\r\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n      if (!feature.getStyle()) {\r\n        if (baseStyle) {\r\n          style = this.createStyle(baseStyle);\r\n          if (labelStyle) {\r\n            style.setText(labelStyle);\r\n          }\r\n          return style;\r\n        }\r\n        style = [\r\n          new olstyle.Style({\r\n            image: new olstyle.Circle({\r\n              radius: 4,\r\n              stroke: new olstyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: '#bbbbf2'\r\n              })\r\n            })\r\n          })\r\n        ];\r\n        return style;\r\n      }\r\n    } else if (type === 'regular') {\r\n      for (let i = 0; i < size; i++) {\r\n        const val =\r\n          typeof feature.get(attribute) !== 'undefined'\r\n            ? feature.get(attribute)\r\n            : '';\r\n        if (val === data[i] || val.toString().match(data[i])) {\r\n          style = [\r\n            new olstyle.Style({\r\n              stroke: new olstyle.Stroke({\r\n                color: stroke ? stroke[i] : 'black',\r\n                width: width ? width[i] : 1\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\r\n              }),\r\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n      if (feature instanceof OlFeature) {\r\n        if (!feature.getStyle()) {\r\n          if (baseStyle) {\r\n            style = this.createStyle(baseStyle);\r\n            if (labelStyle) {\r\n              style.setText(labelStyle);\r\n            }\r\n            return style;\r\n          }\r\n          style = [\r\n            new olstyle.Style({\r\n              stroke: new olstyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: '#bbbbf2'\r\n              })\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  createClusterStyle(feature, clusterParam: ClusterParam = {}, layerStyle) {\r\n    let style;\r\n    const size = feature.get('features').length;\r\n    if (size !== 1) {\r\n      if (clusterParam.clusterRanges) {\r\n        for (const r of clusterParam.clusterRanges) {\r\n          if (\r\n            (!r.minRadius || r.minRadius <= size) &&\r\n            (!r.maxRadius || r.maxRadius >= size)\r\n          ) {\r\n            style = this.createStyle(r.style) as olstyle.Circle;\r\n\r\n            if (r.showRange) {\r\n              const text = new olstyle.Text({\r\n                text: size.toString(),\r\n                fill: new olstyle.Fill({\r\n                  color: '#fff'\r\n                })\r\n              });\r\n              style.setText(text);\r\n            }\r\n\r\n            if (r.dynamicRadius) {\r\n              let clusterRadius: number;\r\n              const radiusMin = style.getRadius();\r\n              clusterRadius = 5 * Math.log(size);\r\n              if (clusterRadius < radiusMin) {\r\n                clusterRadius = radiusMin;\r\n              }\r\n              style.image_.setRadius(clusterRadius);\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!style) {\r\n        let clusterRadius: number;\r\n        if (clusterParam.radiusCalc) {\r\n          clusterRadius = clusterParam.radiusCalc(size);\r\n        } else {\r\n          const radiusMin = 6;\r\n          clusterRadius = 5 * Math.log(size);\r\n          if (clusterRadius < radiusMin) {\r\n            clusterRadius = radiusMin;\r\n          }\r\n        }\r\n\r\n        style = [\r\n          new olstyle.Style({\r\n            image: new olstyle.Circle({\r\n              radius: clusterRadius,\r\n              stroke: new olstyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: 'rgba(24, 134, 45, 0.5)'\r\n              })\r\n            }),\r\n            text: new olstyle.Text({\r\n              text: size.toString(),\r\n              fill: new olstyle.Fill({\r\n                color: '#fff'\r\n              })\r\n            })\r\n          })\r\n        ];\r\n      }\r\n    } else {\r\n      style = this.createStyle(layerStyle);\r\n    }\r\n    return style;\r\n  }\r\n\r\n  getLabel(feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach(v => {\r\n      label = label.replace(v[0], feature.get(v[1]));\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.get(labelMatch) || labelMatch;\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  private guessTypeFeature(feature) {\r\n    switch (feature.getGeometry().getType()) {\r\n      case 'Point':\r\n      case 'MultiPoint':\r\n      case 'Circle':\r\n        return 'circle';\r\n      default:\r\n        return 'regular';\r\n    }\r\n  }\r\n}\r\n","import * as olstyle from 'ol/style';\r\nimport OlFeature from 'ol/Feature';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { StyleService } from '../../layer/shared/style.service';\r\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\n/**\r\n * Create an overlay layer and it's source\r\n * @returns Overlay layer\r\n */\r\nexport function createOverlayLayer(): VectorLayer {\r\n  const overlayDataSource = new FeatureDataSource();\r\n  return new VectorLayer({\r\n    title: 'Overlay',\r\n    zIndex: 300,\r\n    source: overlayDataSource,\r\n    style: createOverlayLayerStyle()\r\n  });\r\n}\r\n\r\n/**\r\n * Create an overlay style with markers for points and a basic stroke/fill\r\n * combination for lines and polygons\r\n * @returns Style function\r\n */\r\nfunction createOverlayLayerStyle(): (olFeature: OlFeature<OlGeometry>) => olstyle.Style {\r\n  const defaultStyle = createOverlayDefaultStyle();\r\n  const markerStyle = createOverlayMarkerStyle();\r\n\r\n  let style;\r\n\r\n  return (olFeature: OlFeature<OlGeometry>) => {\r\n    if (olFeature.getId() === 'bufferFeature') {\r\n      style = createBufferStyle(\r\n        olFeature.get('bufferStroke'),\r\n        2,\r\n        olFeature.get('bufferFill'),\r\n        olFeature.get('bufferText')\r\n      );\r\n      return style;\r\n    } else {\r\n      const customStyle = olFeature.get('_style');\r\n      if (customStyle) {\r\n        const styleService = new StyleService();\r\n        return styleService.createStyle(customStyle);\r\n      }\r\n      const geometryType = olFeature.getGeometry().getType();\r\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\r\n      style.getText().setText(olFeature.get('_mapTitle'));\r\n      return style;\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Create a basic style for lines and polygons\r\n * @returns Style\r\n */\r\nexport function createOverlayDefaultStyle({\r\n  text,\r\n  strokeWidth = 2,\r\n  fillColor = [0, 161, 222, 0.3],\r\n  strokeColor = [0, 161, 222, 0.9],\r\n}: {\r\n  text?: string;\r\n  strokeWidth?: number;\r\n  fillColor?: string | number[];\r\n  strokeColor?: string | number[];\r\n} = {}): olstyle.Style {\r\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\r\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\r\n\r\n  const stroke = new olstyle.Stroke({\r\n    width: strokeWidth,\r\n    color: strokeWithOpacity\r\n  });\r\n\r\n  const fill = new olstyle.Fill({\r\n    color: fillWithOpacity\r\n  });\r\n\r\n  return new olstyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    }),\r\n    text: new olstyle.Text({\r\n      text,\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n\r\nfunction createBufferStyle(\r\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\r\n  strokeWidth: number = 2,\r\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\r\n  bufferRadius?\r\n): olstyle.Style {\r\n  const stroke = new olstyle.Stroke({\r\n    width: strokeWidth,\r\n    color: strokeRGBA\r\n  });\r\n\r\n  const fill = new olstyle.Fill({\r\n    color: fillRGBA\r\n  });\r\n\r\n  return new olstyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    }),\r\n    text: new olstyle.Text({\r\n      font: '12px Calibri,sans-serif',\r\n      text: bufferRadius,\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n","import OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport {\r\n  Feature,\r\n  FeatureMotion,\r\n  featureToOl,\r\n  moveToOlFeatures\r\n} from '../../feature/shared';\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../map/shared/map';\r\n\r\nimport { createOverlayLayer } from './overlay.utils';\r\n\r\n/**\r\n * This class is simply a shortcut for adding features to a map.\r\n * It does nothing more than a standard layer but it's shipped with\r\n * a defautl style based on the geometry type of the features it contains.\r\n * @todo Enhance that by using a FeatureStore and strategies.\r\n */\r\nexport class Overlay {\r\n  /**\r\n   * The map to add the layer to\r\n   */\r\n  private map: IgoMap;\r\n\r\n  /**\r\n   * Overlay layer\r\n   */\r\n  private layer: VectorLayer;\r\n\r\n  /**\r\n   * Overlay layer's data source\r\n   */\r\n  get dataSource(): FeatureDataSource {\r\n    return this.layer.dataSource as FeatureDataSource;\r\n  }\r\n\r\n  constructor(map?: IgoMap) {\r\n    this.layer = createOverlayLayer();\r\n    this.setMap(map);\r\n  }\r\n\r\n  /**\r\n   * Bind this to a map and add the overlay layer to that map\r\n   * @param map Map\r\n   */\r\n  setMap(map: IgoMap) {\r\n    if (map === undefined) {\r\n      if (this.map !== undefined) {\r\n        this.map.ol.removeLayer(this.layer.ol);\r\n      }\r\n    } else {\r\n      map.ol.addLayer(this.layer.ol);\r\n    }\r\n    this.map = map;\r\n  }\r\n\r\n  /**\r\n   * Set the overlay features and, optionally, move to them\r\n   * @param features Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\r\n   */\r\n  setFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    sourceId?: string\r\n  ) {\r\n    if (sourceId) {\r\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\r\n        if (olFeature.get('_sourceId') === sourceId) {\r\n          this.removeOlFeature(olFeature);\r\n        }\r\n      }\r\n    } else {\r\n      this.clear();\r\n    }\r\n    this.addFeatures(features, motion);\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the  overlay and, optionally, move to it\r\n   * @param feature Feature\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\r\n    this.addFeatures([feature], motion);\r\n  }\r\n\r\n  /**\r\n   * Add features to the  overlay and, optionally, move to them\r\n   * @param features Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    const olFeatures = [];\r\n    features.forEach((feature: Feature) => {\r\n      const olFeature = featureToOl(feature, this.map.projection);\r\n      const olGeometry = olFeature.getGeometry();\r\n      if (olGeometry === null) {\r\n        return;\r\n      }\r\n      olFeatures.push(olFeature);\r\n    });\r\n\r\n    this.addOlFeatures(olFeatures, motion);\r\n  }\r\n\r\n  /**\r\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\r\n   * @param olFeature OpenLayers Feature\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addOlFeature(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    this.addOlFeatures([olFeature], motion);\r\n  }\r\n\r\n  /**\r\n   * Add OpenLayers features to the overlay and, optionally, move to them\r\n   * @param olFeatures OpenLayers Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addOlFeatures(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    this.dataSource.ol.addFeatures(olFeatures);\r\n    moveToOlFeatures(this.map, olFeatures, motion);\r\n  }\r\n\r\n  /**\r\n   * Remove a feature from the overlay\r\n   * @param feature Feature\r\n   */\r\n  removeFeature(feature: Feature) {\r\n    this.removeFeatures([feature]);\r\n  }\r\n\r\n  /**\r\n   * Remove features from the overlay\r\n   * @param features Features\r\n   */\r\n  removeFeatures(features: Feature[]) {\r\n    features.forEach((feature: Feature) => {\r\n      if (feature.meta) {\r\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\r\n          this.removeOlFeature(this.dataSource.ol.getFeatureById(feature.meta.id));\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove an OpenLayers feature from the overlay\r\n   * @param olFeature OpenLayers Feature\r\n   */\r\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\r\n    this.dataSource.ol.removeFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay\r\n   */\r\n  clear() {\r\n    this.dataSource.ol.clear();\r\n  }\r\n}\r\n","import { Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { Watcher, SubjectStatus } from '@igo2/utils';\r\nimport { Layer } from '../../layer/shared/layers';\r\n\r\nexport class LayerWatcher extends Watcher {\r\n  private loaded = 0;\r\n  private loading = 0;\r\n  private layers: Layer[] = [];\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  watch() {}\r\n\r\n  unwatch() {\r\n    this.layers.forEach(layer => this.unwatchLayer(layer), this);\r\n  }\r\n\r\n  watchLayer(layer: Layer) {\r\n    if (layer.status$ === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.layers.push(layer);\r\n\r\n    const layer$$ = layer.status$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe(status => {\r\n        if (status === SubjectStatus.Error) {\r\n          this.loading = 0;\r\n          this.loaded = -1;\r\n        }\r\n        if (status === SubjectStatus.Working) {\r\n          this.loading += 1;\r\n        } else if (status === SubjectStatus.Done) {\r\n          this.loaded += 1;\r\n        }\r\n\r\n        if (this.loaded >= this.loading) {\r\n          this.loading = this.loaded = 0;\r\n          this.status = SubjectStatus.Done;\r\n        } else if (this.loading > 0) {\r\n          this.status = SubjectStatus.Working;\r\n        }\r\n      });\r\n\r\n    this.subscriptions.push(layer$$);\r\n  }\r\n\r\n  unwatchLayer(layer: Layer) {\r\n    layer.status$.next(SubjectStatus.Done);\r\n    const index = this.layers.indexOf(layer);\r\n    if (index >= 0) {\r\n      const status = (layer as any).watcher.status;\r\n      if (\r\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\r\n      ) {\r\n        this.loaded += 1;\r\n      }\r\n      this.subscriptions[index].unsubscribe();\r\n      this.subscriptions.splice(index, 1);\r\n      this.layers.splice(index, 1);\r\n      (layer as any).watcher.unwatch();\r\n    }\r\n  }\r\n}\r\n","export enum MapViewAction {\r\n  Move,\r\n  Zoom\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport OlMapEvent from 'ol/MapEvent';\r\n\r\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport * as oleasing from 'ol/easing';\r\nimport * as olproj from 'ol/proj';\r\nimport OlProjection from 'ol/proj/Projection';\r\nimport OlView from 'ol/View';\r\n\r\nimport { MapViewAction } from '../map.enums';\r\nimport { MapExtent, MapViewState } from '../map.interface';\r\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\r\nimport { MapController } from './controller';\r\nimport { EventsKey } from 'ol/events';\r\n\r\nexport interface MapViewControllerOptions {\r\n  stateHistory: boolean;\r\n}\r\n\r\n/**\r\n * Controller to handle map view interactions\r\n */\r\nexport class MapViewController extends MapController {\r\n  /**\r\n   * Observable of the current resolution\r\n   */\r\n  resolution$ = new BehaviorSubject<number>(undefined);\r\n\r\n  /**\r\n   * Observable of the current state\r\n   */\r\n  state$ = new BehaviorSubject<MapViewState>(undefined);\r\n\r\n  /**\r\n   * View Padding\r\n   */\r\n  padding = [0, 0, 0, 0];\r\n\r\n  /**\r\n   * Max zoom after set extent\r\n   */\r\n  maxZoomOnExtent = 19;\r\n\r\n  /**\r\n   * Max extent possible when zooming\r\n   */\r\n  maxLayerZoomExtent: MapExtent;\r\n\r\n  /**\r\n   * Extent stream\r\n   */\r\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\r\n\r\n  /**\r\n   * Subscription to the movement stream\r\n   */\r\n  private extent$$: Subscription;\r\n\r\n  /**\r\n   * History of states\r\n   */\r\n  private states: MapViewState[] = [];\r\n\r\n  /**\r\n   * Current state index\r\n   */\r\n  private stateIndex: number = 0;\r\n\r\n  /**\r\n   * Whether the view controller should keep the view's state history\r\n   */\r\n  get stateHistory(): boolean {\r\n    return this.options ? this.options.stateHistory === true : false;\r\n  }\r\n\r\n  /**\r\n   * OL View\r\n   */\r\n  get olView(): OlView {\r\n    return this.olMap.getView();\r\n  }\r\n\r\n  constructor(private options?: MapViewControllerOptions) {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    super.setOlMap(olMap);\r\n    this.setupObservers();\r\n  }\r\n\r\n  /**\r\n   * Observe move moveend and subscribe to the extent stream\r\n   */\r\n  setupObservers() {\r\n    if (this.stateHistory === true) {\r\n      this.observerKeys.push(\r\n        this.olMap.on('moveend', (event: OlMapEvent) => this.onMoveEnd(event)) as EventsKey\r\n      );\r\n    }\r\n\r\n    this.extent$$ = this.extent$\r\n      .pipe(debounceTime(25))\r\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\r\n        this.setExtent(value.extent, value.action);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    super.teardownObservers();\r\n    if (this.extent$$ !== undefined) {\r\n      this.extent$$.unsubscribe();\r\n      this.extent$$ = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the view's OL projection\r\n   * @returns OL projection\r\n   */\r\n  getOlProjection(): OlProjection {\r\n    return this.olView.getProjection();\r\n  }\r\n\r\n  /**\r\n   * Get the current map view center\r\n   * @param projection Output projection\r\n   * @returns Center\r\n   */\r\n  getCenter(projection?: string | OlProjection): [number, number] {\r\n    let center = this.olView.getCenter() as [number, number];\r\n    if (projection && center) {\r\n      center = olproj.transform(center, this.getOlProjection(), projection) as [number, number];\r\n    }\r\n    return center;\r\n  }\r\n\r\n  /**\r\n   * Get the current view extent\r\n   * @param projection Output projection\r\n   * @returns Extent\r\n   */\r\n  getExtent(projection?: string | OlProjection): MapExtent {\r\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\r\n    if (projection && extent) {\r\n      extent = olproj.transformExtent(\r\n        extent,\r\n        this.getOlProjection(),\r\n        projection\r\n      );\r\n    }\r\n    return extent as [number, number, number, number];\r\n  }\r\n\r\n  /**\r\n   * Get the current scale\r\n   * @param dpi Dot per inches\r\n   * @returns View scale\r\n   */\r\n  getScale(dpi = 96) {\r\n    return getScaleFromResolution(\r\n      this.getResolution(),\r\n      this.getOlProjection().getUnits(),\r\n      dpi\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the current resolution\r\n   * @returns Projection denominator\r\n   */\r\n  getResolution(): number {\r\n    return this.olView.getResolution();\r\n  }\r\n\r\n  /**\r\n   * Get the current zoom level\r\n   * @returns Zoom level\r\n   */\r\n  getZoom(): number {\r\n    return Math.round(this.olView.getZoom());\r\n  }\r\n\r\n  /**\r\n   * Zoom in\r\n   */\r\n  zoomIn() {\r\n    this.zoomTo(this.olView.getZoom() + 1);\r\n  }\r\n\r\n  /**\r\n   * Zoom out\r\n   */\r\n  zoomOut() {\r\n    this.zoomTo(this.olView.getZoom() - 1);\r\n  }\r\n\r\n  /**\r\n   * Zoom to specific zoom level\r\n   * @param zoom Zoom level\r\n   */\r\n  zoomTo(zoom: number) {\r\n    this.olView.cancelAnimations();\r\n    this.olView.animate({\r\n      zoom,\r\n      duration: 250,\r\n      easing: oleasing.easeOut\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Move to extent after a short delay (100ms) unless\r\n   * a new movement gets registered in the meantime.\r\n   * @param extent Extent to move to\r\n   */\r\n  moveToExtent(extent: [number, number, number, number]) {\r\n    this.extent$.next({ extent, action: MapViewAction.Move });\r\n  }\r\n\r\n  /**\r\n   * Zoom to extent after a short delay (100ms) unless\r\n   * a new movement gets registered in the meantime.\r\n   * @param extent Extent to zoom to\r\n   */\r\n  zoomToExtent(extent: [number, number, number, number]) {\r\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\r\n  }\r\n\r\n  /**\r\n   * Return the current view rotation\r\n   * @returns Rotation angle in degrees\r\n   */\r\n  getRotation(): number {\r\n    return this.olView.getRotation();\r\n  }\r\n\r\n  /**\r\n   * Reset the view rotation to 0\r\n   */\r\n  resetRotation() {\r\n    this.olView.animate({ rotation: 0 });\r\n  }\r\n\r\n  /**\r\n   * Whether the view has a previous state\r\n   * @returns True if the view has a previous state\r\n   */\r\n  hasPreviousState(): boolean {\r\n    return this.states.length > 1 && this.stateIndex > 0;\r\n  }\r\n\r\n  /**\r\n   * Whether the view has a next state\r\n   * @returns True if the view has a next state\r\n   */\r\n  hasNextState(): boolean {\r\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\r\n  }\r\n\r\n  /**\r\n   * Restore the previous view state\r\n   */\r\n  previousState() {\r\n    if (this.hasPreviousState()) {\r\n      this.setStateIndex(this.stateIndex - 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore the next view state\r\n   */\r\n  nextState() {\r\n    if (this.hasNextState()) {\r\n      this.setStateIndex(this.stateIndex + 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the state history\r\n   */\r\n  clearStateHistory() {\r\n    this.states = [];\r\n    this.stateIndex = 0;\r\n  }\r\n\r\n  /**\r\n   * Update the the view to it's intial state\r\n   */\r\n  setInitialState() {\r\n    if (this.states.length > 0) {\r\n      this.setStateIndex(0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move to the extent retrieved from the stream\r\n   * @param extent Extent\r\n   * @param action Either zoom or move\r\n   * @param animation With or without animation to the target extent.\r\n   */\r\n  private setExtent(\r\n    extent: MapExtent,\r\n    action: MapViewAction,\r\n    animation: boolean = true\r\n  ) {\r\n    const olView = this.olView;\r\n    olView.cancelAnimations();\r\n    const duration = animation ? 500 : 0;\r\n    const zoom = olView.getZoom();\r\n\r\n    const fromCenter = olView.getCenter();\r\n    const toCenter = [\r\n      extent[0] + (extent[2] - extent[0]) / 2,\r\n      extent[1] + (extent[3] - extent[1]) / 2\r\n    ];\r\n    const distCenter = Math.sqrt(\r\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\r\n        Math.pow(fromCenter[1] - toCenter[1], 2)\r\n    );\r\n    const fromExtent = olView.calculateExtent();\r\n    const fromSize = Math.sqrt(\r\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\r\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\r\n    );\r\n    const toSize = Math.sqrt(\r\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\r\n    );\r\n    const moySize = (toSize + fromSize) / 2;\r\n    const xSize = distCenter / moySize;\r\n\r\n    const maxZoom =\r\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\r\n        ? zoom\r\n        : this.maxZoomOnExtent;\r\n\r\n    olView.fit(extent, {\r\n      size: this.olMap.getSize(),\r\n      maxZoom,\r\n      padding: this.padding,\r\n      duration: xSize > 4 ? 0 : duration,\r\n      callback: (isFinished: boolean) => {\r\n        if (!isFinished) {\r\n          olView.fit(extent, {\r\n            size: this.olMap.getSize(),\r\n            maxZoom,\r\n            padding: this.padding,\r\n            duration: xSize > 4 ? 0 : duration\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the view state index\r\n   * @param index State index\r\n   */\r\n  private setStateIndex(index: number) {\r\n    this.stateIndex = index;\r\n    this.setState(this.states[index]);\r\n  }\r\n\r\n  /**\r\n   * Set the view state\r\n   * @param state View state\r\n   */\r\n  private setState(state: MapViewState) {\r\n    this.olView.animate({\r\n      resolution: state.resolution,\r\n      center: state.center,\r\n      duration: 0\r\n    });\r\n  }\r\n\r\n  /**\r\n   * On move end, get the view state and record it.\r\n   * @param event Map event\r\n   */\r\n  private onMoveEnd(event: OlMapEvent) {\r\n    const resolution = this.getResolution();\r\n    if (this.resolution$.value !== resolution) {\r\n      this.resolution$.next(resolution);\r\n    }\r\n\r\n    const state = {\r\n      resolution,\r\n      center: this.getCenter(),\r\n      zoom: this.getZoom()\r\n    };\r\n\r\n    if (this.stateHistory === true) {\r\n      const stateIndex = this.stateIndex;\r\n      const stateAtIndex =\r\n        this.states.length === 0 ? undefined : this.states[stateIndex];\r\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\r\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\r\n        this.stateIndex = this.states.length - 1;\r\n      }\r\n    }\r\n\r\n    this.state$.next(state);\r\n  }\r\n}\r\n","import { EventsKey } from 'ol/events';\r\nimport OlMap from 'ol/Map';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\n/**\r\n * Base map controller\r\n */\r\nexport class MapController {\r\n\r\n  /**\r\n   * OL Map\r\n   */\r\n  protected olMap: OlMap;\r\n\r\n  /**\r\n   * Array of observer keys\r\n   */\r\n  protected observerKeys: EventsKey[] = [];\r\n\r\n  /**\r\n   * Return the OL map this controller is bound to\r\n   * @returns OL Map\r\n   */\r\n  getOlMap(): OlMap {\r\n    return this.olMap;\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\r\n      throw new Error('This controller is already bound to a map.');\r\n    }\r\n\r\n    if (olMap === undefined) {\r\n      this.teardownObservers();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\r\n    this.observerKeys = [];\r\n  }\r\n\r\n}\r\n","import olMap from 'ol/Map';\r\nimport olView from 'ol/View';\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olGeolocation from 'ol/Geolocation';\r\nimport olControlAttribution from 'ol/control/Attribution';\r\nimport olControlScaleLine from 'ol/control/ScaleLine';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olproj4 from 'ol/proj/proj4';\r\nimport OlProjection from 'ol/proj/Projection';\r\nimport * as olinteraction from 'ol/interaction';\r\nimport olCircle from 'ol/geom/Circle';\r\n\r\nimport proj4 from 'proj4';\r\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\r\n\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport { Layer } from '../../layer/shared/layers';\r\nimport { Overlay } from '../../overlay/shared/overlay';\r\n\r\nimport { LayerWatcher } from '../utils/layer-watcher';\r\nimport {\r\n  MapViewOptions,\r\n  MapOptions,\r\n  MapAttributionOptions,\r\n  MapScaleLineOptions,\r\n  MapExtent,\r\n  MapControlsOptions\r\n} from './map.interface';\r\nimport { MapViewController } from './controllers/view';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\r\n\r\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\r\n// Move some stuff into controllers.\r\nexport class IgoMap {\r\n  public ol: olMap;\r\n  public offlineButtonToggle$ = new BehaviorSubject<boolean>(false);\r\n  public layers$ = new BehaviorSubject<Layer[]>([]);\r\n  public status$: Subject<SubjectStatus>;\r\n  public alwaysTracking: boolean;\r\n  public positionFollower: boolean = true;\r\n  public geolocation$ = new BehaviorSubject<olGeolocation>(undefined);\r\n  public geolocationFeature: olFeature<OlGeometry>;\r\n  public bufferGeom: olCircle;\r\n  public bufferFeature: olFeature<OlGeometry>;\r\n  public buffer: Overlay;\r\n  public overlay: Overlay;\r\n  public queryResultsOverlay: Overlay;\r\n  public searchResultsOverlay: Overlay;\r\n  public viewController: MapViewController;\r\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\r\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\r\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\r\n\r\n  public bufferDataSource: FeatureDataSource;\r\n\r\n  private layerWatcher: LayerWatcher;\r\n  private geolocation: olGeolocation;\r\n  private geolocation$$: Subscription;\r\n\r\n  private options: MapOptions;\r\n  private defaultOptions: Partial<MapOptions> = {\r\n    controls: { attribution: false }\r\n  };\r\n\r\n  get layers(): Layer[] {\r\n    return this.layers$.value;\r\n  }\r\n\r\n  get projection(): string {\r\n    return this.viewController.getOlProjection().getCode();\r\n  }\r\n\r\n  constructor(options?: MapOptions) {\r\n    this.options = Object.assign({}, this.defaultOptions, options);\r\n    this.layerWatcher = new LayerWatcher();\r\n    this.status$ = this.layerWatcher.status$;\r\n    olproj4.register(proj4);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    const controls = [];\r\n    if (this.options.controls) {\r\n      if (this.options.controls.attribution) {\r\n        const attributionOpt = (this.options.controls.attribution === true\r\n          ? {}\r\n          : this.options.controls.attribution) as MapAttributionOptions;\r\n        controls.push(new olControlAttribution(attributionOpt));\r\n      }\r\n      if (this.options.controls.scaleLine) {\r\n        const scaleLineOpt = (this.options.controls.scaleLine === true\r\n          ? {}\r\n          : this.options.controls.scaleLine) as MapScaleLineOptions;\r\n        controls.push(new olControlScaleLine(scaleLineOpt));\r\n      }\r\n    }\r\n    let interactions = {};\r\n    if (this.options.interactions === false) {\r\n      interactions = {\r\n        altShiftDragRotate: false,\r\n        doubleClickZoom: false,\r\n        keyboard: false,\r\n        mouseWheelZoom: false,\r\n        shiftDragZoom: false,\r\n        dragPan: false,\r\n        pinchRotate: false,\r\n        pinchZoom: false\r\n      };\r\n    }\r\n\r\n    this.ol = new olMap({\r\n      interactions: olinteraction.defaults(interactions),\r\n      controls\r\n    });\r\n\r\n    this.setView(this.options.view || {});\r\n    this.viewController = new MapViewController({\r\n      stateHistory: true\r\n    });\r\n    this.viewController.setOlMap(this.ol);\r\n    this.overlay = new Overlay(this);\r\n    this.queryResultsOverlay = new Overlay(this);\r\n    this.searchResultsOverlay = new Overlay(this);\r\n    this.buffer = new Overlay(this);\r\n  }\r\n\r\n  setTarget(id: string) {\r\n    this.ol.setTarget(id);\r\n    if (id !== undefined) {\r\n      this.layerWatcher.subscribe(() => {}, null);\r\n    } else {\r\n      this.layerWatcher.unsubscribe();\r\n    }\r\n  }\r\n\r\n  updateView(options: MapViewOptions) {\r\n    const currentView = this.ol.getView();\r\n    const viewOptions = Object.assign(\r\n      {\r\n        zoom: currentView.getZoom()\r\n      },\r\n      currentView.getProperties()\r\n    );\r\n\r\n    this.setView(Object.assign(viewOptions, options));\r\n    if (options.maxZoomOnExtent) {\r\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the map view\r\n   * @param options Map view options\r\n   */\r\n  setView(options: MapViewOptions) {\r\n    if (this.viewController !== undefined) {\r\n      this.viewController.clearStateHistory();\r\n    }\r\n\r\n    options = Object.assign({ constrainResolution: true }, options);\r\n    const view = new olView(options);\r\n    this.ol.setView(view);\r\n\r\n    this.unsubscribeGeolocate();\r\n    if (options) {\r\n      if (options.maxLayerZoomExtent) {\r\n        this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\r\n      }\r\n\r\n      if (options.center) {\r\n        const projection = view.getProjection().getCode();\r\n        const center = olproj.fromLonLat(options.center, projection);\r\n        view.setCenter(center);\r\n      }\r\n\r\n      if (options.geolocate) {\r\n        this.geolocate(true);\r\n      }\r\n\r\n      if (options.alwaysTracking) {\r\n        this.alwaysTracking = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateControls(value: MapControlsOptions) {\r\n    if (value === undefined) {\r\n      return;\r\n    }\r\n\r\n    const controls = [];\r\n    if (value.attribution) {\r\n      const attributionOpt = (value.attribution === true\r\n        ? {}\r\n        : value.attribution) as MapAttributionOptions;\r\n      controls.push(new olControlAttribution(attributionOpt));\r\n    }\r\n    if (value.scaleLine) {\r\n      const scaleLineOpt = (value.scaleLine === true\r\n        ? {}\r\n        : value.scaleLine) as MapScaleLineOptions;\r\n      controls.push(new olControlScaleLine(scaleLineOpt));\r\n    }\r\n\r\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\r\n    currentControls.forEach(control => {\r\n      this.ol.removeControl(control);\r\n    });\r\n    controls.forEach(control => {\r\n      this.ol.addControl(control);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Deprecated\r\n   * TODO: Move to ViewController and update every place it's used\r\n   */\r\n  getCenter(projection?: string | OlProjection): [number, number] {\r\n    return this.viewController.getCenter(projection);\r\n  }\r\n\r\n  /**\r\n   * Deprecated\r\n   * TODO: Move to ViewController and update every place it's used\r\n   */\r\n  getExtent(projection?: string | OlProjection): MapExtent {\r\n    return this.viewController.getExtent(projection);\r\n  }\r\n\r\n  // TODO: Move to ViewController and update every place it's used\r\n  getZoom(): number {\r\n    return this.viewController.getZoom();\r\n  }\r\n\r\n  changeBaseLayer(baseLayer: Layer) {\r\n    if (!baseLayer) {\r\n      return;\r\n    }\r\n\r\n    for (const bl of this.getBaseLayers()) {\r\n      bl.visible = false;\r\n    }\r\n\r\n    baseLayer.visible = true;\r\n\r\n    this.viewController.olView.setMinZoom(\r\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\r\n    );\r\n    this.viewController.olView.setMaxZoom(\r\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\r\n    );\r\n  }\r\n\r\n  getBaseLayers(): Layer[] {\r\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\r\n  }\r\n\r\n  getLayerById(id: string): Layer {\r\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\r\n  }\r\n\r\n  getLayerByAlias(alias: string): Layer {\r\n    return this.layers.find(\r\n      (layer: Layer) => layer.alias && layer.alias === alias\r\n    );\r\n  }\r\n\r\n  getLayerByOlUId(olUId: string): Layer {\r\n    return this.layers.find(\r\n      (layer: Layer) => layer.ol.get('ol_uid') && layer.ol.get('ol_uid') === olUId\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Add a single layer\r\n   * @param layer Layer to add\r\n   * @param push DEPRECATED\r\n   */\r\n  addLayer(layer: Layer, push = true) {\r\n    this.addLayers([layer]);\r\n  }\r\n\r\n  /**\r\n   * Add many layers\r\n   * @param layers Layers to add\r\n   * @param push DEPRECATED\r\n   */\r\n  addLayers(layers: Layer[], push = true) {\r\n    let offsetZIndex = 0;\r\n    let offsetBaseLayerZIndex = 0;\r\n    const addedLayers = layers\r\n      .map((layer: Layer) => {\r\n        if (!layer) { return; }\r\n        const offset = layer.zIndex\r\n          ? 0\r\n          : layer.baseLayer\r\n          ? offsetBaseLayerZIndex++\r\n          : offsetZIndex++;\r\n        return this.doAddLayer(layer, offset);\r\n      })\r\n      .filter((layer: Layer | undefined) => layer !== undefined);\r\n    this.setLayers([].concat(this.layers, addedLayers));\r\n  }\r\n\r\n  /**\r\n   * Remove a single layer\r\n   * @param layer Layer to remove\r\n   */\r\n  removeLayer(layer: Layer) {\r\n    this.removeLayers([layer]);\r\n  }\r\n\r\n  /**\r\n   * Remove many layers\r\n   * @param layers Layers to remove\r\n   */\r\n  removeLayers(layers: Layer[]) {\r\n    const newLayers = this.layers$.value.slice(0);\r\n    const layersToRemove = [];\r\n    layers.forEach((layer: Layer) => {\r\n      const index = newLayers.indexOf(layer);\r\n      if (index >= 0) {\r\n        layersToRemove.push(layer);\r\n        newLayers.splice(index, 1);\r\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\r\n        layersToRemove.map(linkedLayer => {\r\n          layersToRemove.push(linkedLayer);\r\n          const linkedIndex = newLayers.indexOf(linkedLayer);\r\n          if (linkedIndex >= 0) {\r\n            newLayers.splice(linkedIndex, 1);\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\r\n    this.setLayers(newLayers);\r\n  }\r\n\r\n  /**\r\n   * Build a list of linked layers to delete\r\n   * @param srcLayer Layer that has triggered the deletion\r\n   * @param layersToRemove list to append the layer to delete into\r\n   */\r\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\r\n    const linkedLayers = srcLayer.options.linkedLayers;\r\n    if (!linkedLayers) {\r\n      return;\r\n    }\r\n    const currentLinkedId = linkedLayers.linkId;\r\n    const currentLinks = linkedLayers.links;\r\n    const isParentLayer = currentLinks ? true : false;\r\n    if (isParentLayer) {\r\n      // search for child layers\r\n      currentLinks.map(link => {\r\n        if (!link.syncedDelete) {\r\n          return;\r\n        }\r\n        link.linkedIds.map(linkedId => {\r\n          const layerToApply = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\r\n          if (layerToApply) {\r\n            layersToRemove.push(layerToApply);\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      // search for parent layer\r\n      this.layers.map(layer => {\r\n        if (layer.options.linkedLayers?.links) {\r\n          layer.options.linkedLayers.links.map(l => {\r\n            if (\r\n              l.syncedDelete && l.bidirectionnal !== false &&\r\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\r\n              layersToRemove.push(layer);\r\n              this.handleLinkedLayersDeletion(layer, layersToRemove);\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all layers\r\n   */\r\n  removeAllLayers() {\r\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\r\n    this.layers$.next([]);\r\n  }\r\n\r\n  raiseLayer(layer: Layer) {\r\n    const index = this.getLayerIndex(layer);\r\n    if (index > 1) {\r\n      this.moveLayer(layer, index, index - 1);\r\n    }\r\n  }\r\n\r\n  raiseLayers(layers: Layer[]) {\r\n    for (const layer of layers) {\r\n      this.raiseLayer(layer);\r\n    }\r\n  }\r\n\r\n  lowerLayer(layer: Layer) {\r\n    const index = this.getLayerIndex(layer);\r\n    if (index < this.layers.length - 1) {\r\n      this.moveLayer(layer, index, index + 1);\r\n    }\r\n  }\r\n\r\n  lowerLayers(layers: Layer[]) {\r\n    const reverseLayers = layers.reverse();\r\n    for (const layer of reverseLayers) {\r\n      this.lowerLayer(layer);\r\n    }\r\n  }\r\n\r\n  moveLayer(layer: Layer, from: number, to: number) {\r\n    const layerTo = this.layers[to];\r\n    const zIndexTo = layerTo.zIndex;\r\n    const zIndexFrom = layer.zIndex;\r\n\r\n    if (layerTo.baseLayer || layer.baseLayer) {\r\n      return;\r\n    }\r\n\r\n    layer.zIndex = zIndexTo;\r\n    layerTo.zIndex = zIndexFrom;\r\n\r\n    this.layers[to] = layer;\r\n    this.layers[from] = layerTo;\r\n    this.layers$.next(this.layers.slice(0));\r\n  }\r\n\r\n  /**\r\n   * Add a layer to the OL map and start watching. If the layer is already\r\n   * added to this map, make it visible but don't add it one again.\r\n   * @param layer Layer\r\n   * @returns The layer added, if any\r\n   */\r\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\r\n    if (layer.baseLayer && layer.visible) {\r\n      this.changeBaseLayer(layer);\r\n    }\r\n\r\n    const existingLayer = this.getLayerById(layer.id);\r\n    if (existingLayer !== undefined) {\r\n      existingLayer.visible = true;\r\n      return;\r\n    }\r\n\r\n    if (!layer.baseLayer && layer.zIndex) {\r\n      layer.zIndex += 10;\r\n    }\r\n\r\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\r\n      const maxZIndex = Math.max(\r\n        layer.baseLayer ? 0 : 10,\r\n        ...this.layers\r\n          .filter(\r\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\r\n          )\r\n          .map((l) => l.zIndex)\r\n      );\r\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\r\n    }\r\n\r\n    if (layer.baseLayer && layer.zIndex > 9) {\r\n      layer.zIndex = 10; // baselayer must have zIndex < 10\r\n    }\r\n\r\n    layer.setMap(this);\r\n    this.layerWatcher.watchLayer(layer);\r\n    this.ol.addLayer(layer.ol);\r\n\r\n    return layer;\r\n  }\r\n\r\n  /**\r\n   * Remove a layer from the OL map and stop watching\r\n   * @param layer Layer\r\n   */\r\n  private doRemoveLayer(layer: Layer) {\r\n    this.layerWatcher.unwatchLayer(layer);\r\n    this.ol.removeLayer(layer.ol);\r\n    layer.setMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Update the layers observable\r\n   * @param layers Layers\r\n   */\r\n  private setLayers(layers: Layer[]) {\r\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\r\n  }\r\n\r\n  /**\r\n   * Sort layers by descending zIndex\r\n   * @param layers Array of layers\r\n   * @returns The original array, sorted by zIndex\r\n   */\r\n  private sortLayersByZIndex(layers: Layer[]) {\r\n    // Sort by descending zIndex\r\n    return layers.sort(\r\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get layer index in the map's inenr array of layers\r\n   * @param layer Layer\r\n   * @returns The layer index\r\n   */\r\n  private getLayerIndex(layer: Layer) {\r\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\r\n  }\r\n\r\n  // TODO: Create a GeolocationController with everything below\r\n  geolocate(track = false) {\r\n    let first = true;\r\n    if (this.geolocation$$) {\r\n      track = this.geolocation.getTracking();\r\n      this.unsubscribeGeolocate();\r\n    }\r\n    this.startGeolocation();\r\n\r\n    this.geolocation$$ = this.geolocation$.subscribe((geolocation) => {\r\n      if (!geolocation) {\r\n        return;\r\n      }\r\n      const accuracy = geolocation.getAccuracy();\r\n      if (accuracy < 10000) {\r\n        const geometry = geolocation.getAccuracyGeometry();\r\n        const extent = geometry.getExtent();\r\n        if (\r\n          this.geolocationFeature &&\r\n          this.overlay.dataSource.ol.getFeatureById(\r\n            this.geolocationFeature.getId()\r\n          )\r\n        ) {\r\n          this.overlay.dataSource.ol.removeFeature(this.geolocationFeature);\r\n        }\r\n\r\n        if (this.bufferFeature) {\r\n          this.buffer.dataSource.ol.removeFeature(this.bufferFeature);\r\n        }\r\n\r\n        this.geolocationFeature = new olFeature({ geometry });\r\n        this.geolocationFeature.setId('geolocationFeature');\r\n        if (this.alwaysTracking) {\r\n          this.overlay.addOlFeature(\r\n            this.geolocationFeature,\r\n            this.positionFollower ? FeatureMotion.Move : FeatureMotion.None\r\n          );\r\n        } else {\r\n          this.overlay.addOlFeature(this.geolocationFeature);\r\n        }\r\n\r\n        if (this.ol.getView().get('options_').buffer) {\r\n          const bufferRadius = this.ol.getView().get('options_').buffer.bufferRadius;\r\n          const coordinates = geolocation.getPosition();\r\n          this.bufferGeom = new olCircle(coordinates, bufferRadius);\r\n          const bufferStroke = this.ol.getView().get('options_').buffer.bufferStroke;\r\n          const bufferFill = this.ol.getView().get('options_').buffer.bufferFill;\r\n\r\n          let bufferText;\r\n          if (this.ol.getView().get('options_').buffer.showBufferRadius) {\r\n            bufferText = bufferRadius.toString() + 'm';\r\n          } else {\r\n            bufferText = '';\r\n          }\r\n\r\n          this.bufferFeature = new olFeature(this.bufferGeom);\r\n          this.bufferFeature.setId('bufferFeature');\r\n          this.bufferFeature.set('bufferStroke', bufferStroke);\r\n          this.bufferFeature.set('bufferFill', bufferFill);\r\n          this.bufferFeature.set('bufferText', bufferText);\r\n          this.buffer.addOlFeature(this.bufferFeature, FeatureMotion.None);\r\n        }\r\n        if (first) {\r\n          this.viewController.zoomToExtent(extent as [number, number, number, number]);\r\n          this.positionFollower = !this.positionFollower;\r\n        }\r\n      } else if (first) {\r\n        const view = this.ol.getView();\r\n        const coordinates = geolocation.getPosition();\r\n        view.setCenter(coordinates);\r\n        view.setZoom(14);\r\n      }\r\n      if (track !== true && this.alwaysTracking !== true) {\r\n        this.unsubscribeGeolocate();\r\n      }\r\n      first = false;\r\n    });\r\n  }\r\n\r\n  unsubscribeGeolocate() {\r\n    this.stopGeolocation();\r\n    if (this.geolocation$$) {\r\n      this.geolocation$$.unsubscribe();\r\n      this.geolocation$$ = undefined;\r\n    }\r\n  }\r\n\r\n  private startGeolocation() {\r\n    if (!this.geolocation) {\r\n      this.geolocation = new olGeolocation({\r\n        trackingOptions: {\r\n          enableHighAccuracy: true\r\n        },\r\n        projection: this.projection,\r\n        tracking: true\r\n      });\r\n\r\n      this.geolocation.on('change', (evt) => {\r\n        this.geolocation$.next(this.geolocation);\r\n      });\r\n    } else {\r\n      this.geolocation.setTracking(true);\r\n    }\r\n  }\r\n\r\n  private stopGeolocation() {\r\n    if (this.geolocation) {\r\n      this.geolocation.setTracking(false);\r\n    }\r\n  }\r\n\r\n  onOfflineToggle(offline: boolean) {\r\n    this.offlineButtonToggle$.next(offline);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  AfterViewInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { SubjectStatus } from '@igo2/utils';\r\nimport { ActivityService } from '@igo2/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\r\n\r\n@Component({\r\n  selector: 'igo-map-browser',\r\n  templateUrl: './map-browser.component.html',\r\n  styleUrls: ['./map-browser.component.scss']\r\n})\r\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\r\n  private activityId: string;\r\n  private status$$: Subscription;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get view(): MapViewOptions {\r\n    return this._view;\r\n  }\r\n  set view(value: MapViewOptions) {\r\n    this._view = value;\r\n    if (this.map !== undefined) {\r\n      this.map.updateView(value);\r\n    }\r\n  }\r\n  private _view: MapViewOptions;\r\n\r\n  get controls(): MapControlsOptions {\r\n    return this._controls;\r\n  }\r\n\r\n  set controls(value: MapControlsOptions) {\r\n    this._controls = value;\r\n    if (this.map !== undefined) {\r\n      this.map.updateControls(value);\r\n    }\r\n  }\r\n  private _controls: MapControlsOptions;\r\n\r\n  public id = `igo-map-target-${new Date().getTime()}`;\r\n\r\n  constructor(private activityService: ActivityService) {}\r\n\r\n  ngOnInit() {\r\n    this.status$$ = this.map.status$.subscribe(status =>\r\n      this.handleStatusChange(status)\r\n    );\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    this.map.setTarget(this.id);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.map.setTarget(undefined);\r\n    this.activityService.unregister(this.activityId);\r\n    this.status$$.unsubscribe();\r\n  }\r\n\r\n  private handleStatusChange(status: SubjectStatus) {\r\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\r\n      this.activityId = this.activityService.register();\r\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\r\n      this.activityService.unregister(this.activityId);\r\n      this.activityId = undefined;\r\n    }\r\n  }\r\n}\r\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\r\n<ng-content></ng-content>\r\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  Self,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\n\r\nimport { transform } from 'ol/proj';\r\nimport { MediaService } from '@igo2/core';\r\nimport { OnReturn } from 'ol/Observable';\r\n/**\r\n * This directive return the pointer coordinate (on click or pointermove)\r\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\r\n * to avoid too many emitted values.\r\n */\r\n@Directive({\r\n  selector: '[igoPointerPosition]'\r\n})\r\nexport class PointerPositionDirective implements OnInit, OnDestroy {\r\n\r\n  private lastTimeoutRequest;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener: OnReturn;\r\n\r\n  /**\r\n   * Listener to the map click event\r\n   */\r\n  private mapClickListener: OnReturn;\r\n\r\n  /**\r\n   * Delay before emitting an event\r\n   */\r\n  @Input() pointerPositionDelay: number = 1000;\r\n\r\n  /**\r\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\r\n   */\r\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private mediaService: MediaService\r\n  ) { }\r\n\r\n  /**\r\n   * Start listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.listenToMapPointerMove();\r\n    this.listenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * Stop listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unlistenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, this.pointerPositionDelay)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On map click\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map clicks\r\n   */\r\n  private unlistenToMapClick() {\r\n    this.mapClickListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\r\n    if (event.dragging || this.mediaService.isTouchScreen()) {return; }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n\r\n    const lonlat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      this.pointerPositionCoord.emit(lonlat);\r\n    }, delay);\r\n  }\r\n}\r\n","import olLayerImage from 'ol/layer/Image';\r\nimport olSourceImage from 'ol/source/Image';\r\n\r\nimport { AuthInterceptor } from '@igo2/auth';\r\n\r\nimport { ImageWatcher } from '../../utils';\r\nimport { IgoMap } from '../../../map';\r\n\r\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\r\n\r\nimport { Layer } from './layer';\r\nimport { ImageLayerOptions } from './image-layer.interface';\r\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\n\r\nexport class ImageLayer extends Layer {\r\n  public dataSource: WMSDataSource | ImageArcGISRestDataSource;\r\n  public options: ImageLayerOptions;\r\n  public ol: olLayerImage<olSourceImage>;\r\n\r\n  private watcher: ImageWatcher;\r\n\r\n  constructor(\r\n    options: ImageLayerOptions,\r\n    public messageService: MessageService,\r\n    private languageService: LanguageService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(options, messageService, authInterceptor);\r\n    this.watcher = new ImageWatcher(this, this.messageService, this.languageService);\r\n    this.status$ = this.watcher.status$;\r\n    this.status$.subscribe(valStatus => {\r\n      if (valStatus === 0) {\r\n        this.olLoadingProblem = true;\r\n      }\r\n    });\r\n  }\r\n\r\n  protected createOlLayer(): olLayerImage<olSourceImage> {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceImage\r\n    });\r\n\r\n    const image = new olLayerImage(olOptions);\r\n    if (this.authInterceptor) {\r\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\r\n        this.customLoader(tile, src, this.authInterceptor, this.messageService, this.languageService);\r\n      });\r\n    }\r\n\r\n    return image;\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n\r\n  private customLoader(tile, src, interceptor, messageService, languageService) {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open('GET', src);\r\n\r\n    const intercepted = interceptor.interceptXhr(xhr, src);\r\n    if (!intercepted) {\r\n      xhr.abort();\r\n      tile.getImage().src = src;\r\n      return;\r\n    }\r\n\r\n    xhr.responseType = 'arraybuffer';\r\n\r\n    xhr.onload = function() {\r\n      const arrayBufferView = new Uint8Array((this as any).response);\r\n      const responseString = new TextDecoder().decode(arrayBufferView);\r\n      if (responseString.includes('ServiceExceptionReport')) {\r\n        messageService.error(languageService.translate.instant(\r\n          'igo.geo.dataSource.optionsApiUnavailable'\r\n        ),\r\n        languageService.translate.instant(\r\n          'igo.geo.dataSource.unavailableTitle'\r\n        ));\r\n      }\r\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\r\n      const urlCreator = window.URL;\r\n      const imageUrl = urlCreator.createObjectURL(blob);\r\n      tile.getImage().src = imageUrl;\r\n    };\r\n    xhr.send();\r\n  }\r\n}\r\n","import olLayerTile from 'ol/layer/Tile';\r\nimport olSourceTile from 'ol/source/Tile';\r\n\r\nimport { TileWatcher } from '../../utils';\r\nimport { IgoMap } from '../../../map';\r\n\r\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\r\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\r\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\r\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\r\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\r\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\r\n\r\nimport { Layer } from './layer';\r\nimport { TileLayerOptions } from './tile-layer.interface';\r\n\r\nimport { MessageService } from '@igo2/core';\r\nexport class TileLayer extends Layer {\r\n  public dataSource:\r\n    | OSMDataSource\r\n    | WMTSDataSource\r\n    | XYZDataSource\r\n    | TileDebugDataSource\r\n    | CartoDataSource\r\n    | TileArcGISRestDataSource;\r\n  public options: TileLayerOptions;\r\n  public ol: olLayerTile<olSourceTile>;\r\n\r\n  private watcher: TileWatcher;\r\n\r\n  constructor(\r\n    options: TileLayerOptions,\r\n    public messageService?: MessageService) {\r\n    super(options, messageService);\r\n\r\n    this.watcher = new TileWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerTile<olSourceTile> {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceTile\r\n    });\r\n\r\n    return new olLayerTile(olOptions);\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n}\r\n","import olLayerVectorTile from 'ol/layer/VectorTile';\r\nimport olSourceVectorTile from 'ol/source/VectorTile';\r\n\r\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\r\n\r\nimport { Layer } from './layer';\r\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\r\nimport { TileWatcher } from '../../utils';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { IgoMap } from '../../../map';\r\nimport { MessageService } from '@igo2/core';\r\nimport VectorTile from 'ol/VectorTile';\r\n\r\nexport class VectorTileLayer extends Layer {\r\n  public dataSource: MVTDataSource;\r\n  public options: VectorTileLayerOptions;\r\n  public ol: olLayerVectorTile;\r\n\r\n  private watcher: TileWatcher;\r\n\r\n  constructor(\r\n    options: VectorTileLayerOptions,\r\n    public messageService?: MessageService,\r\n    public authInterceptor?: AuthInterceptor) {\r\n    super(options, messageService, authInterceptor);\r\n    this.watcher = new TileWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerVectorTile {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceVectorTile\r\n    });\r\n\r\n    const vectorTile = new olLayerVectorTile(olOptions);\r\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\r\n\r\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url) => {\r\n      const loader = this.customLoader(url, tile.getFormat(), this.authInterceptor, tile.onLoad.bind(tile));\r\n      if (loader) {\r\n        tile.setLoader(loader);\r\n      }\r\n    }\r\n    );\r\n\r\n    return vectorTile;\r\n  }\r\n\r\n  /**\r\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\r\n   * @internal\r\n   * @param url the url string or function to retrieve the data\r\n   * @param format the format of the tile\r\n   * @param interceptor the interceptor of the data\r\n   * @param success On success event action to trigger\r\n   * @param failure On failure event action to trigger TODO\r\n   */\r\n  customLoader(url, format, interceptor, success, failure?) {\r\n    return ((extent, resolution, projection) => {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.open('GET', typeof url === 'function' ? url = url(extent, resolution, projection) : url);\r\n      if (interceptor) {\r\n        interceptor.interceptXhr(xhr, url);\r\n      }\r\n\r\n      if (format.getType() === 'arraybuffer') {\r\n        xhr.responseType = 'arraybuffer';\r\n      }\r\n      xhr.onload = (event) => {\r\n        if (!xhr.status || xhr.status >= 200 && xhr.status < 300) {\r\n          const type = format.getType();\r\n          let source;\r\n          if (type === 'json' || type === 'text') {\r\n            source = xhr.responseText;\r\n          }\r\n          else if (type === 'xml') {\r\n            source = xhr.responseXML;\r\n            if (!source) {\r\n              source = new DOMParser().parseFromString(xhr.responseText, 'application/xml');\r\n            }\r\n          }\r\n          else if (type === 'arraybuffer') {\r\n            source = xhr.response;\r\n          }\r\n          if (source) {\r\n            success.call(this, format.readFeatures(source, {\r\n              extent,\r\n              featureProjection: projection\r\n            }), format.readProjection(source));\r\n          }\r\n          else {\r\n            // TODO\r\n            failure.call(this);\r\n          }\r\n        } else {\r\n          // TODO\r\n          failure.call(this);\r\n        }\r\n      };\r\n      xhr.onerror = () => {\r\n        // TODO\r\n        failure.call(this);\r\n      };\r\n      xhr.send();\r\n    });\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n}\r\n","import {\r\n    Directive,\r\n    Input,\r\n    OnDestroy,\r\n    Self,\r\n    OnInit,\r\n    HostListener\r\n  } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport * as olstyle from 'ol/style';\r\nimport * as olgeom from 'ol/geom';\r\nimport * as olLayer from 'ol/layer';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { VectorLayer, Layer } from '../../layer/shared/layers';\r\nimport { take } from 'rxjs/operators';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\r\nimport { MediaService } from '@igo2/core';\r\nimport { StyleService } from '../../layer/shared/style.service';\r\nimport { OnReturn } from 'ol/Observable';\r\n\r\n/**\r\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\r\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\r\n * By default, no search sources. Config in config file must be defined.\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoHoverFeature]'\r\n})\r\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\r\n\r\n  public store: FeatureStore<Feature>;\r\n  private pointerHoverFeatureStore: EntityStore<any> = new EntityStore<any>([]);\r\n  private lastTimeoutRequest;\r\n  private store$$: Subscription;\r\n  private layers$$: Subscription;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener: OnReturn;\r\n\r\n  private singleClickMapListener: OnReturn;\r\n\r\n  private hoverFeatureId: string = 'hoverFeatureId';\r\n  /**\r\n   * The delay where the mouse must be motionless before trigger the reverse search\r\n   */\r\n  @Input() igoHoverFeatureDelay: number = 1000;\r\n\r\n  /**\r\n   * If the user has enabled or not the directive\r\n   */\r\n  @Input() igoHoverFeatureEnabled: boolean = false;\r\n\r\n  @HostListener('mouseout')\r\n  mouseout() {\r\n    clearTimeout(this.lastTimeoutRequest);\r\n    this.clearLayer();\r\n  }\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private mediaService: MediaService,\r\n    private styleService: StyleService,\r\n  ) { }\r\n\r\n  /**\r\n   * Start listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.listenToMapPointerMove();\r\n    this.subscribeToPointerStore();\r\n    this.listenToMapClick();\r\n\r\n    this.map.status$.pipe(take(1)).subscribe(() => {\r\n      this.store = new FeatureStore<Feature>([], {map: this.map});\r\n      this.initStore();\r\n    });\r\n\r\n    // To handle context change without using the contextService.\r\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\r\n      if (this.store && !layers.find(l => l.id === 'hoverFeatureId')) {\r\n        this.initStore();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Initialize the pointer position store\r\n   * @internal\r\n   */\r\n  private initStore(layerSource?: Layer) {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      id : 'hoverFeatureId',\r\n      title: 'hoverFeature',\r\n      zIndex: 900,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      style: hoverFeatureMarker\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n  }\r\n\r\n\r\n  /**\r\n   * Stop listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unsubscribeToPointerStore();\r\n    this.unlistenToMapSingleClick();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to pointermove result store\r\n   * @internal\r\n   */\r\n  subscribeToPointerStore() {\r\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(resultsUnderPointerPosition => {\r\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * convert store entities to a pointer position overlay with label summary on.\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: any[]) {\r\n\r\n    this.addFeatureOverlay(resultsUnderPointerPosition);\r\n\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n   /**\r\n    * On map singleclick\r\n    */\r\n  private listenToMapClick() {\r\n    this.singleClickMapListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to pointer store.\r\n   * @internal\r\n   */\r\n  unsubscribeToPointerStore() {\r\n    this.store$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   * @internal\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    // this.map.ol.un(this.pointerMoveListener.type, this.pointerMoveListener.listener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map singleclick\r\n   * @internal\r\n   */\r\n  private unlistenToMapSingleClick() {\r\n    // this.map.ol.un(this.singleClickMapListener.type, this.singleClickMapListener.listener);\r\n    this.singleClickMapListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Trigger clear layer on singleclick.\r\n   * @param event OL map browser singleclick event\r\n   */\r\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>){\r\n    this.clearLayer();\r\n  }\r\n\r\n  /**\r\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\r\n    if (\r\n      event.dragging || !this.igoHoverFeatureEnabled ||\r\n      this.mediaService.isTouchScreen()) {\r\n      this.clearLayer();\r\n      return;\r\n    }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n\r\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n\r\n      this.map.ol.forEachFeatureAtPixel(pixel, function(f, l) {\r\n        if (f.get('hoverSummary') === undefined) {\r\n          const igoLayer: VectorLayer = this.map.getLayerByOlUId(l.ol_uid);\r\n          this.setLayerStyleFromOptions(igoLayer, f);\r\n          this.pointerHoverFeatureStore.load([{layer: igoLayer, feature: f}]);\r\n        }\r\n        return true;\r\n      }.bind(this));\r\n    }, this.igoHoverFeatureDelay);\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the pointer store\r\n   * @param text string\r\n   */\r\n  private addFeatureOverlay(results) {\r\n\r\n    if (results.length > 0 ) {\r\n\r\n      results = results[0];\r\n      this.clearLayer();\r\n      let geom = this.getGeometry(results.feature) as any;\r\n\r\n      // si vector tile, merge avec les polygones voisins possiblement meme entit\r\n      if (results.layer.ol instanceof olLayer.VectorTile) {\r\n        geom = [geom];\r\n        const neighbourCollection = this.getSameFeatureNeighbour(results.feature, results.layer);\r\n\r\n        neighbourCollection.forEach( (n) => {\r\n          geom.push(n.getGeometry());\r\n        });\r\n      }\r\n\r\n      const feature = new olFeature({\r\n        geometry: geom instanceof Array ? new olgeom.GeometryCollection(geom) : geom,\r\n        meta: {id: this.hoverFeatureId},\r\n        hoverSummary: this.getHoverSummary(results.feature.getProperties())\r\n      });\r\n\r\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\r\n    }\r\n  }\r\n\r\n  private setLayerStyleFromOptions(igoLayer: VectorLayer, feat) {\r\n    if ( igoLayer.options?.styleByAttribute?.hoverStyle) {\r\n      this.store.layer.ol.setStyle(this.styleService.createStyleByAttribute(feat, igoLayer.options.styleByAttribute.hoverStyle));\r\n    } else {\r\n      this.store.layer.ol.setStyle(hoverFeatureMarker);\r\n    }\r\n  }\r\n\r\n  private getHoverSummary(properties): string{\r\n    let summary = '';\r\n    for (const [key, value] of Object.entries(properties)) {\r\n      summary += `${key}: ${value}` + '\\n';\r\n    }\r\n    return summary;\r\n  }\r\n\r\n  private getGeometry(feature): olgeom.Geometry {\r\n    let geom;\r\n    if (!feature.getOrientedFlatCoordinates) {\r\n      geom = feature.getGeometry();\r\n    } else {\r\n\r\n      const coords = feature.getOrientedFlatCoordinates();\r\n      const flatCoords = [];\r\n\r\n      coords.forEach((c, idx) => {\r\n        if (idx % 2 === 0) {\r\n          flatCoords.push([parseFloat(coords[idx]), parseFloat(coords[idx + 1])]);\r\n        }\r\n      });\r\n\r\n      // TODO: test MultiX\r\n      switch (feature.getType()) {\r\n        case 'Point':\r\n          geom = new olgeom.Point(flatCoords);\r\n          break;\r\n        case 'Polygon':\r\n          geom = new olgeom.Polygon([flatCoords]);\r\n          break;\r\n        case 'LineString':\r\n          geom = new olgeom.LineString([flatCoords]);\r\n          break;\r\n      }\r\n    }\r\n\r\n    return geom;\r\n  }\r\n\r\n  private getSameFeatureNeighbour(feature, layer, neighbourCollection: olFeature<olgeom.Geometry>[] = []) {\r\n\r\n    if (neighbourCollection.length === 0) {\r\n      neighbourCollection.push(\r\n        new olFeature({\r\n          geometry: this.getGeometry(feature),\r\n          meta: {id: this.hoverFeatureId}\r\n        })\r\n      );\r\n    }\r\n\r\n    const toDoNeighbour = [];\r\n    const neighbourFeatures = layer.ol.getSource().getFeaturesInExtent(feature.getGeometry().getExtent());\r\n\r\n    neighbourFeatures.forEach(f => {\r\n\r\n      const checkIf = neighbourCollection.find(x => {\r\n        return x === f;\r\n      });\r\n\r\n      if (f.getId() === feature.getId() && !checkIf) {\r\n        toDoNeighbour.push(f);\r\n        neighbourCollection.push(f);\r\n      }\r\n    });\r\n\r\n    return neighbourCollection.map(f => {\r\n      return   new olFeature({\r\n        geometry: this.getGeometry(f),\r\n        meta: {id: this.hoverFeatureId}\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the pointer store features\r\n   */\r\n  private clearLayer() {\r\n    if (this.store) {\r\n      this.store.clearLayer();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Create a default style for the pointer position and it's label summary.\r\n * @param feature OlFeature\r\n * @returns OL style function\r\n */\r\nexport function hoverFeatureMarker(feature: olFeature<olgeom.Geometry>, resolution: number): olstyle.Style[] {\r\n\r\n  const olStyleText = new olstyle.Style({\r\n    text: new olstyle.Text({\r\n      text: feature.get('hoverSummary'),\r\n      textAlign: 'left',\r\n      textBaseline: 'bottom',\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      backgroundFill: new olstyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\r\n      backgroundStroke: new olstyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true,\r\n      offsetX: 10,\r\n      offsetY: -10,\r\n      padding: [2.5, 2.5, 2.5, 2.5]\r\n    })\r\n  });\r\n\r\n  const olStyle = [olStyleText];\r\n  switch (feature.getGeometry().getType()) {\r\n    case 'Point':\r\n      olStyle.push(new olstyle.Style({\r\n        image: new olstyle.Circle({\r\n          radius: 10,\r\n          stroke: new olstyle.Stroke({\r\n            color: 'blue',\r\n            width: 3\r\n          })\r\n        })\r\n      }));\r\n      break;\r\n    default:\r\n      olStyle.push(new olstyle.Style({\r\n        stroke: new olstyle.Stroke({\r\n          color: 'white',\r\n          width: 5\r\n        })\r\n      }));\r\n      olStyle.push(new olstyle.Style({\r\n        stroke: new olstyle.Stroke({\r\n          color: 'blue',\r\n          width: 3\r\n        })\r\n      }));\r\n  }\r\n\r\n  return olStyle;\r\n\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-zoom-button',\r\n  templateUrl: './zoom-button.component.html',\r\n  styleUrls: ['./zoom-button.component.scss']\r\n})\r\nexport class ZoomButtonComponent {\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string;\r\n\r\n  get zoom(): number { return this.map.viewController.getZoom(); }\r\n\r\n  get minZoom(): number { return this.map.viewController.olView.getMinZoom() || 1; }\r\n\r\n  get maxZoom(): number { return this.map.viewController.olView.getMaxZoom(); }\r\n\r\n  constructor() {}\r\n}\r\n","<div class=\"igo-zoom-button-container\">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: {zoom: zoom + 1}\"\r\n    matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    [disabled]=\"zoom >= maxZoom\"\r\n    (click)=\"map.viewController.zoomIn()\">\r\n    <mat-icon svgIcon=\"plus\"></mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: {zoom: zoom - 1}\"\r\n    matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    [disabled]=\"zoom <= minZoom\"\r\n    (click)=\"map.viewController.zoomOut()\">\r\n    <mat-icon svgIcon=\"minus\"></mat-icon>\r\n  </button>\r\n</div>\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-geolocate-button',\r\n  templateUrl: './geolocate-button.component.html',\r\n  styleUrls: ['./geolocate-button.component.scss']\r\n})\r\nexport class GeolocateButtonComponent {\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get color(): string {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color: string;\r\n\r\n  constructor() {}\r\n}\r\n","<div class=\"igo-geolocate-button-container\">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.geo.mapButtons.geolocate' | translate\"\r\n    matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    (click)=\"map.geolocate()\">\r\n    <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\r\n  </button>\r\n</div>\r\n","<div *ngIf=\"baseLayers.length > 0\"\r\n     class=\"igo-baselayers-switcher-container\"\r\n     [ngClass]=\"{'container-expand': expand}\"\r\n     [@baseLayerSwitcherState]=\"expand ? 'expand' : useStaticIcon ? 'collapseIcon' : 'collapseMap'\"\r\n     (@baseLayerSwitcherState.start)=\"showButton=false\"\r\n     (@baseLayerSwitcherState.done)=\"showButton=true\"\r\n     (click)=\"collapseOrExpand()\">\r\n\r\n     <div *ngIf=\"useStaticIcon && !expand && showButton\" class=\"igo-baselayers-switcher-button-container\">\r\n       <button\r\n         mat-icon-button\r\n         [matTooltip]=\"'igo.geo.mapButtons.baselayerSwitcher' | translate\"\r\n         matTooltipPosition=\"right\"\r\n         color=\"primary\">\r\n         <mat-icon svgIcon=\"image-multiple\"></mat-icon>\r\n       </button>\r\n     </div>\r\n\r\n     <igo-mini-basemap class=\"mat-typography\" *ngFor=\"let baseLayer of baseLayers; let i = index\"\r\n       [map]=\"map\"\r\n       [baseLayer]=\"baseLayer\"\r\n       [title]=\"(baseLayers.length > 2 && !expand) ? ('igo.geo.baselayersSwitcher.title' | translate) : baseLayer.title\"\r\n       [display]=\"expand || (i === 0 && !useStaticIcon)\"\r\n       [disabled]=\"!expand && baseLayers.length > 1\">\r\n     </igo-mini-basemap>\r\n\r\n    <div class=\"more-baselayers\">\r\n      <mat-icon class=\"material-icons mat-icon mat-list-avatar\" color=\"primary\" svgIcon=\"menu-down\"></mat-icon>\r\n    </div>\r\n\r\n</div>\r\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MediaService, Media } from '@igo2/core';\r\nimport { Layer } from '../../layer';\r\nimport { IgoMap } from '../shared';\r\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\r\n\r\n@Component({\r\n  selector: 'igo-baselayers-switcher',\r\n  templateUrl: './baselayers-switcher.component.html',\r\n  styleUrls: ['./baselayers-switcher.component.scss'],\r\n  animations: [baseLayersSwitcherSlideInOut()]\r\n})\r\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\r\n  @Input() map: IgoMap;\r\n  @Input() useStaticIcon: boolean;\r\n\r\n  public _baseLayers: Layer[] = [];\r\n  public expand = false;\r\n  public showButton = true;\r\n\r\n  private layers$$: Subscription;\r\n\r\n  constructor(private mediaService: MediaService) {\r\n    const media = this.mediaService.media$.value;\r\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\r\n      this.useStaticIcon = true;\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    this.layers$$ = this.map.layers$.subscribe(arrayLayers => {\r\n      this._baseLayers = arrayLayers.filter(l => l.baseLayer);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  collapseOrExpand() {\r\n    if (this.baseLayers.length > 1 || this.useStaticIcon) {\r\n      this.expand = !this.expand;\r\n    } else {\r\n      this.expand = false;\r\n    }\r\n  }\r\n\r\n  get baseLayers(): Layer[] {\r\n    const mapResolution = this.map.viewController.getResolution();\r\n    const mapZoom = this.map.viewController.getZoom();\r\n\r\n    const bl = this._baseLayers.filter(l => {\r\n      return (\r\n        (!l.options.maxResolution ||\r\n          mapResolution <= l.options.maxResolution) &&\r\n        (!l.options.minResolution || mapResolution >= l.options.minResolution) &&\r\n        (!l.options.source.options.maxZoom || mapZoom <= l.options.source.options.maxZoom) &&\r\n        (!l.options.source.options.minZoom || mapZoom >= l.options.source.options.minZoom)\r\n      );\r\n    });\r\n\r\n    const blHidden = bl.filter(l => !l.visible);\r\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\r\n  }\r\n}\r\n","import {\r\n  trigger,\r\n  state,\r\n  style,\r\n  transition,\r\n  animate,\r\n  AnimationTriggerMetadata\r\n} from '@angular/animations';\r\n\r\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\r\n  return trigger('baseLayerSwitcherState', [\r\n    state(\r\n      'collapseIcon',\r\n      style({\r\n        height: '40px',\r\n        width: '40px',\r\n        overflow: 'hidden'\r\n      })\r\n    ),\r\n    state(\r\n      'collapseMap',\r\n      style({\r\n        height: '85px',\r\n        overflow: 'hidden'\r\n      })\r\n    ),\r\n    state(\r\n      'expand',\r\n      style({\r\n        overflow: 'hidden'\r\n      })\r\n    ),\r\n    transition('collapse => expand', animate('200ms')),\r\n    transition('expand => collapse', animate('200ms'))\r\n  ]);\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport stylefunction from 'ol-mapbox-style/dist/stylefunction';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport {\r\n  OSMDataSource,\r\n  FeatureDataSource,\r\n  XYZDataSource,\r\n  TileDebugDataSource,\r\n  WFSDataSource,\r\n  WMTSDataSource,\r\n  WMSDataSource,\r\n  CartoDataSource,\r\n  ImageArcGISRestDataSource,\r\n  ArcGISRestDataSource,\r\n  TileArcGISRestDataSource,\r\n  WebSocketDataSource,\r\n  MVTDataSource,\r\n  ClusterDataSource\r\n} from '../../datasource';\r\n\r\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\r\n\r\nimport {\r\n  Layer,\r\n  ImageLayer,\r\n  ImageLayerOptions,\r\n  TileLayer,\r\n  TileLayerOptions,\r\n  VectorLayer,\r\n  VectorLayerOptions,\r\n  AnyLayerOptions,\r\n  VectorTileLayer,\r\n  VectorTileLayerOptions\r\n} from './layers';\r\n\r\nimport { StyleService } from './style.service';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private styleService: StyleService,\r\n    private dataSourceService: DataSourceService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService,\r\n    @Optional() private authInterceptor: AuthInterceptor\r\n  ) {}\r\n\r\n  createLayer(layerOptions: AnyLayerOptions): Layer {\r\n    if (!layerOptions.source) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      layerOptions.source.options &&\r\n      layerOptions.source.options._layerOptionsFromSource\r\n    ) {\r\n      layerOptions = ObjectUtils.mergeDeep(\r\n        layerOptions.source.options._layerOptionsFromSource,\r\n        layerOptions || {}\r\n      );\r\n    }\r\n\r\n    let layer;\r\n    switch (layerOptions.source.constructor) {\r\n      case OSMDataSource:\r\n      case WMTSDataSource:\r\n      case XYZDataSource:\r\n      case TileDebugDataSource:\r\n      case CartoDataSource:\r\n      case TileArcGISRestDataSource:\r\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\r\n        break;\r\n      case FeatureDataSource:\r\n      case WFSDataSource:\r\n      case ArcGISRestDataSource:\r\n      case WebSocketDataSource:\r\n      case ClusterDataSource:\r\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\r\n        break;\r\n      case ImageArcGISRestDataSource:\r\n      case WMSDataSource:\r\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\r\n        break;\r\n      case MVTDataSource:\r\n        layer = this.createVectorTileLayer(\r\n          layerOptions as VectorTileLayerOptions\r\n        );\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return layer;\r\n  }\r\n\r\n  createAsyncLayer(layerOptions: AnyLayerOptions, detailedContextUri?: string): Observable<Layer> {\r\n    if (layerOptions.source) {\r\n      return new Observable(d => d.next(this.createLayer(layerOptions)));\r\n    }\r\n\r\n    return this.dataSourceService\r\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\r\n      .pipe(\r\n        map(source => {\r\n          if (source === undefined) {\r\n            return undefined;\r\n          }\r\n          return this.createLayer(Object.assign(layerOptions, { source }));\r\n        })\r\n      );\r\n  }\r\n\r\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\r\n    return new ImageLayer(layerOptions, this.messageService, this.languageService, this.authInterceptor);\r\n  }\r\n\r\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\r\n    return new TileLayer(layerOptions, this.messageService);\r\n  }\r\n\r\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\r\n    let style;\r\n    let olLayer;\r\n    if (layerOptions.style !== undefined) {\r\n      style = this.styleService.createStyle(layerOptions.style);\r\n    }\r\n\r\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\r\n      const source = layerOptions.source as ArcGISRestDataSource;\r\n      style = source.options.params.style;\r\n    } else if (layerOptions.styleByAttribute) {\r\n      const serviceStyle = this.styleService;\r\n      layerOptions.style = feature => {\r\n        return serviceStyle.createStyleByAttribute(\r\n          feature,\r\n          layerOptions.styleByAttribute\r\n        );\r\n      };\r\n      olLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor);\r\n    }\r\n\r\n    if (layerOptions.source instanceof ClusterDataSource) {\r\n      const serviceStyle = this.styleService;\r\n      const baseStyle = layerOptions.clusterBaseStyle;\r\n      layerOptions.style = feature => {\r\n        return serviceStyle.createClusterStyle(\r\n          feature,\r\n          layerOptions.clusterParam,\r\n          baseStyle\r\n        );\r\n      };\r\n      olLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor);\r\n    }\r\n\r\n    const layerOptionsOl = Object.assign({}, layerOptions, {\r\n      style\r\n    });\r\n\r\n    if (!olLayer) {\r\n      olLayer = new VectorLayer(layerOptionsOl, this.messageService, this.authInterceptor);\r\n    }\r\n\r\n    this.applyMapboxStyle(olLayer, layerOptionsOl as any);\r\n\r\n    return olLayer;\r\n  }\r\n\r\n  private createVectorTileLayer(\r\n    layerOptions: VectorTileLayerOptions\r\n  ): VectorTileLayer {\r\n    let style;\r\n    let olLayer;\r\n\r\n    if (layerOptions.style !== undefined) {\r\n      style = this.styleService.createStyle(layerOptions.style);\r\n    }\r\n\r\n    if (layerOptions.styleByAttribute) {\r\n      const serviceStyle = this.styleService;\r\n      layerOptions.style = feature => {\r\n        return serviceStyle.createStyleByAttribute(\r\n          feature,\r\n          layerOptions.styleByAttribute\r\n        );\r\n      };\r\n      olLayer = new VectorTileLayer(layerOptions, this.messageService, this.authInterceptor);\r\n    }\r\n\r\n    const layerOptionsOl = Object.assign({}, layerOptions, {\r\n      style\r\n    });\r\n\r\n    if (!olLayer) {\r\n      olLayer = new VectorTileLayer(layerOptionsOl, this.messageService, this.authInterceptor);\r\n    }\r\n\r\n    this.applyMapboxStyle(olLayer, layerOptionsOl);\r\n    return olLayer;\r\n  }\r\n\r\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\r\n    if (layerOptions.mapboxStyle) {\r\n      this.getMapboxGlStyle(layerOptions.mapboxStyle.url).subscribe(res => {\r\n        stylefunction(layer.ol, res, layerOptions.mapboxStyle.source);\r\n      });\r\n    }\r\n  }\r\n\r\n  public getMapboxGlStyle(url: string) {\r\n    return this.http.get(url).pipe(\r\n      map((res: any) => res),\r\n      catchError(err => {\r\n        console.log('No style was found');\r\n        return of(err);\r\n      })\r\n    );\r\n  }\r\n}\r\n","<div class=\"igo-mini-basemap-container\">\r\n\r\n  <div *ngIf=\"display\" (click)=\"changeBaseLayer(baseLayer)\">\r\n    <igo-map-browser [map]=\"basemap\"></igo-map-browser>\r\n    <div *ngIf='title' class='igo-mini-basemap-title'> {{title}} </div>\r\n  </div>\r\n\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  AfterViewInit,\r\n  OnDestroy,\r\n  ApplicationRef\r\n} from '@angular/core';\r\n\r\nimport { Layer, LayerOptions } from '../../layer/shared';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { IgoMap } from '../shared';\r\n\r\nimport OlMap from 'ol/Map';\r\nimport OlView from 'ol/View';\r\n\r\n@Component({\r\n  selector: 'igo-mini-basemap',\r\n  templateUrl: './mini-basemap.component.html',\r\n  styleUrls: ['./mini-basemap.component.scss']\r\n})\r\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\r\n\r\n  @Input() map: IgoMap;\r\n  @Input() disabled: boolean;\r\n  @Input() display: boolean;\r\n  @Input() title: string;\r\n\r\n  @Input()\r\n  get baseLayer(): Layer {\r\n    return this._baseLayer;\r\n  }\r\n  set baseLayer(value: Layer) {\r\n    this._baseLayer = value;\r\n    this.handleBaseLayerChanged(value);\r\n  }\r\n  private _baseLayer: Layer;\r\n\r\n  public basemap = new IgoMap({\r\n    controls: {},\r\n    interactions: false\r\n  });\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private appRef: ApplicationRef\r\n  ) { }\r\n\r\n  ngAfterViewInit() {\r\n    this.handleMainMapViewChange(this.map.ol.getView());\r\n    this.map.viewController.olView.on('change', change => {\r\n      this.handleMainMapViewChange((change.target as OlView));\r\n    });\r\n    this.map.ol.on('pointerdrag', change => {\r\n      this.handleMainMapViewChange((change.target as OlMap).getView());\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.map.viewController.olView.un('change', change => {\r\n      this.handleMainMapViewChange((change.target as OlView));\r\n    });\r\n    this.map.ol.un('pointerdrag', change => {\r\n      this.handleMainMapViewChange((change.target as OlMap).getView());\r\n    });\r\n  }\r\n\r\n  changeBaseLayer(baseLayer: Layer) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n    this.map.changeBaseLayer(baseLayer);\r\n    this.appRef.tick();\r\n  }\r\n\r\n  private handleMainMapViewChange(mainMapView) {\r\n    const mainMapViewProperties = mainMapView.getProperties();\r\n    this.basemap.viewController.olView.setResolution(mainMapViewProperties.resolution);\r\n    this.basemap.viewController.olView.setRotation(mainMapViewProperties.rotation);\r\n    this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter());\r\n  }\r\n\r\n  private handleBaseLayerChanged(baselayer: Layer) {\r\n    this.basemap.removeAllLayers();\r\n\r\n    const options: any = Object.assign(\r\n      Object.create(baselayer.options),\r\n      baselayer.options,\r\n      {\r\n        visible: true,\r\n        baseLayer: false\r\n      }\r\n    );\r\n\r\n    const layer = this.layerService.createLayer(options);\r\n    this.basemap.addLayer(layer);\r\n    this.handleLinkedBaseLayer(layer);\r\n  }\r\n\r\n  private handleLinkedBaseLayer(baselayer: Layer) {\r\n    const linkedLayers = baselayer.options.linkedLayers;\r\n    if (!linkedLayers) {\r\n      return;\r\n    }\r\n    const currentLinkedId = linkedLayers.linkId;\r\n    const currentLinks = linkedLayers.links;\r\n    const isParentLayer = currentLinks ? true : false;\r\n    if (isParentLayer && currentLinkedId === baselayer.options.linkedLayers.linkId) {\r\n      // search for child layers\r\n      currentLinks.map(link => {\r\n        link.linkedIds.map(linkedId => {\r\n          const layerToApply = this.map.layers.find(l => l.options.linkedLayers?.linkId === linkedId);\r\n          if (layerToApply) {\r\n            const linkedLayerOptions: any = Object.assign(\r\n              Object.create(layerToApply.options),\r\n              layerToApply.options,\r\n              {\r\n                zIndex: 9000,\r\n                visible: true,\r\n                baseLayer: false,\r\n              } as LayerOptions\r\n            );\r\n            this.basemap.addLayer(this.layerService.createLayer(linkedLayerOptions));\r\n          }\r\n        });\r\n      });\r\n    }\r\n  }\r\n}\r\n","<div *ngIf=\"rotated && !showIfNoRotation\" class=\"igo-rotation-button-container\"\r\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\r\n  matTooltipPosition=\"left\">\r\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\r\n    (click)=\"map.viewController.resetRotation()\">\r\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\r\n    </mat-icon>\r\n  </button>\r\n</div>\r\n\r\n<div *ngIf=\"showIfNoRotation\" class=\"igo-rotation-button-container\"\r\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\r\n  matTooltipPosition=\"left\">\r\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\r\n    (click)=\"map.viewController.resetRotation()\">\r\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\r\n    </mat-icon>\r\n  </button>\r\n</div>","import { Component, Input } from '@angular/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-rotation-button',\r\n  templateUrl: './rotation-button.component.html',\r\n  styleUrls: ['./rotation-button.component.scss']\r\n})\r\nexport class RotationButtonComponent {\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get showIfNoRotation(): boolean {\r\n    return this._showIfNoRotation;\r\n  }\r\n  set showIfNoRotation(value: boolean) {\r\n    this._showIfNoRotation = value;\r\n  }\r\n  private _showIfNoRotation: boolean;\r\n\r\n  @Input()\r\n  get color(): string {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color: string;\r\n\r\n  get rotated(): boolean {\r\n    return this.map.viewController.getRotation() !== 0;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  rotationStyle(radians): {} {\r\n    const rotation = 'rotate(' + radians + 'rad)';\r\n    return {\r\n      transform: rotation\r\n    };\r\n  }\r\n}\r\n","export enum CatalogItemType {\r\n  Layer = 'layer',\r\n  Group = 'group'\r\n}\r\n\r\nexport enum TypeCatalog {\r\n  wms, wmts, baselayers, arcgisrest, tilearcgisrest, imagearcgisrest, composite\r\n}\r\n\r\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\r\n","import { Observable } from 'rxjs';\r\n\r\nimport { TooltipType } from '../../layer';\r\nimport { TimeFilterOptions } from '../../filter';\r\nimport { QueryFormat, QueryHtmlTarget  } from '../../query';\r\n\r\nimport { ICatalog, ICompositeCatalog , CatalogItem, CatalogItemGroup } from './catalog.interface';\r\nimport { CatalogService } from './catalog.service';\r\nimport { TypeCatalog, TypeCatalogStrings } from './catalog.enum';\r\n\r\nexport abstract class Catalog implements ICatalog {\r\n\r\n    // ICatalog -----------------------------\r\n    id: string;\r\n    title: string;\r\n    url: string;\r\n    removable?: boolean;\r\n    externalProvider?: boolean;\r\n    abstract?: string;\r\n    forcedProperties?: any[];\r\n    items?: CatalogItem[];\r\n    type?: TypeCatalogStrings;\r\n    version?: string;\r\n    matrixSet?: string;\r\n    requestEncoding?: string;\r\n    regFilters?: string[];\r\n    groupImpose?: CatalogItemGroup;\r\n    groupSeparator?: string;\r\n    timeFilter?: TimeFilterOptions;\r\n    queryFormat?: QueryFormat;\r\n    queryHtmlTarget?: QueryHtmlTarget;\r\n    queryParams?: { [key: string]: string; };\r\n    sourceOptions?: { [key: string]: any; };\r\n    count?: number;\r\n    tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\r\n    sortDirection?: 'asc' | 'desc';\r\n    setCrossOriginAnonymous?: boolean;\r\n    showLegend?: boolean;\r\n    // ICatalog -----------------------------\r\n\r\n    protected catalogService: CatalogService;\r\n\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        Object.assign(this, options);\r\n        this.catalogService = service;\r\n    }\r\n\r\n    public abstract collectCatalogItems(): Observable<CatalogItem[]>;\r\n}\r\n\r\nclass WMSCatalog extends Catalog {\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        super(options, service);\r\n        const sType: string = TypeCatalog[TypeCatalog.wms];\r\n        this.type =  TypeCatalog[sType];\r\n    }\r\n\r\n    public collectCatalogItems(): Observable<CatalogItem[]> {\r\n        return this.catalogService.loadCatalogWMSLayerItems(this);\r\n    }\r\n}\r\n\r\nclass WMTSCatalog extends Catalog {\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        super(options, service);\r\n        const sType: string = TypeCatalog[TypeCatalog.wmts];\r\n        this.type =  TypeCatalog[sType];\r\n    }\r\n\r\n    public collectCatalogItems(): Observable<CatalogItem[]> {\r\n        return this.catalogService.loadCatalogWMTSLayerItems(this);\r\n    }\r\n}\r\n\r\nclass BaselayersCatalog extends Catalog {\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        super(options, service);\r\n        const sType: string = TypeCatalog[TypeCatalog.baselayers];\r\n        this.type =  TypeCatalog[sType];\r\n    }\r\n\r\n    public collectCatalogItems(): Observable<CatalogItemGroup[]> {\r\n        return this.catalogService.loadCatalogBaseLayerItems(this);\r\n    }\r\n}\r\n\r\nclass ArcGISRestCatalog extends Catalog {\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        super(options, service);\r\n        const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\r\n        this.type =  TypeCatalog[sType];\r\n    }\r\n\r\n    public collectCatalogItems() {\r\n        return this.catalogService.loadCatalogArcGISRestItems(this);\r\n    }\r\n}\r\n\r\nclass TileOrImageArcGISRestCatalog extends Catalog {\r\n    constructor(options: Catalog, service: CatalogService, typeCatalog: TypeCatalog) {\r\n        super(options, service);\r\n        this.type =  TypeCatalog[TypeCatalog[typeCatalog]];\r\n    }\r\n\r\n    public collectCatalogItems() {\r\n        return this.catalogService.loadCatalogArcGISRestItems(this);\r\n    }\r\n}\r\n\r\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\r\n    composite: ICatalog[];\r\n\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        super(options, service);\r\n        const sType: string = TypeCatalog[TypeCatalog.composite];\r\n        this.type =  TypeCatalog[sType];\r\n        this.url = null;\r\n    }\r\n\r\n    public collectCatalogItems(): Observable<CatalogItem[]> {\r\n        return this.catalogService.loadCatalogCompositeLayerItems(this);\r\n    }\r\n}\r\n\r\nexport class CatalogFactory {\r\n\r\n    public static createInstanceCatalog(options: Catalog, service: CatalogService): Catalog {\r\n\r\n        let catalog: Catalog;\r\n        if (options.hasOwnProperty('composite')) {\r\n            catalog = new CompositeCatalog(options, service);\r\n        } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\r\n            catalog = new BaselayersCatalog(options, service);\r\n        } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\r\n            catalog = new ArcGISRestCatalog(options, service);\r\n        } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\r\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.tilearcgisrest);\r\n        } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\r\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.imagearcgisrest);\r\n        } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\r\n            catalog = new WMTSCatalog(options, service);\r\n        } else {\r\n            catalog = new WMSCatalog(options, service);\r\n        }\r\n\r\n        return catalog;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, mergeMap } from 'rxjs/operators';\r\n\r\nimport * as striptags_ from 'striptags';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport * as olextent from 'ol/extent';\r\nimport olFormatGML2 from 'ol/format/GML2';\r\nimport olFormatGML3 from 'ol/format/GML3';\r\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\r\nimport olFeature from 'ol/Feature';\r\nimport * as olgeom from 'ol/geom';\r\n\r\nimport { uuid } from '@igo2/utils';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport {\r\n  WMSDataSource,\r\n  CartoDataSource,\r\n  TileArcGISRestDataSource,\r\n  WMSDataSourceOptions,\r\n  ImageArcGISRestDataSource\r\n} from '../../datasource';\r\n\r\nimport {\r\n  QueryFormat,\r\n  QueryFormatMimeType,\r\n  QueryHtmlTarget\r\n} from './query.enums';\r\nimport {\r\n  QueryOptions,\r\n  QueryableDataSource,\r\n  QueryableDataSourceOptions\r\n} from './query.interfaces';\r\nimport { MapExtent } from '../../map/shared/map.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class QueryService {\r\n  public queryEnabled = true;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\r\n    return layers\r\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\r\n      .map((layer: Layer) => this.queryLayer(layer, options));\r\n  }\r\n\r\n  queryLayer(layer: Layer, options: QueryOptions): Observable<Feature[]> {\r\n    const url = this.getQueryUrl(layer.dataSource, options, false, layer.map.viewController.getExtent());\r\n    if (!url) {\r\n      return of([]);\r\n    }\r\n\r\n    if (\r\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\r\n      QueryFormat.HTMLGML2\r\n    ) {\r\n      const urlGml = this.getQueryUrl(layer.dataSource, options, true);\r\n      return this.http.get(urlGml, { responseType: 'text' }).pipe(\r\n        mergeMap(gmlRes => {\r\n          const imposedGeom = this.mergeGML(gmlRes, url);\r\n          return this.http\r\n            .get(url, { responseType: 'text' })\r\n            .pipe(\r\n              map(res =>\r\n                this.extractData(res, layer, options, url, imposedGeom)\r\n              )\r\n            );\r\n        })\r\n      );\r\n    }\r\n\r\n    const request = this.http.get(url, { responseType: 'text' });\r\n    return request.pipe(map(res => this.extractData(res, layer, options, url)));\r\n  }\r\n\r\n  private mergeGML(gmlRes, url) {\r\n    const parser = new olFormatGML2();\r\n    let features = parser.readFeatures(gmlRes);\r\n    // Handle non standard GML output (MapServer)\r\n    if (features.length === 0) {\r\n      const wmsParser = new olformat.WMSGetFeatureInfo();\r\n      features = wmsParser.readFeatures(gmlRes);\r\n    }\r\n    const olmline = new olgeom.MultiLineString([]);\r\n    let pts;\r\n    const ptsArray = [];\r\n    let olmpoly = new olgeom.MultiPolygon([]);\r\n    let firstFeatureType;\r\n    const nbFeatures = features.length;\r\n\r\n    // Check if geometry intersect bbox\r\n    // for geoserver getfeatureinfo response in data projection, not call projection\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const bboxRaw = searchParams.bbox;\r\n    const bbox = bboxRaw.split(',');\r\n    const bboxExtent = olextent.createEmpty();\r\n    olextent.extend(bboxExtent, bbox);\r\n    const outBboxExtent = false;\r\n    features.map(feature => {\r\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\r\n        outBboxExtent = true;\r\n        // TODO: Check to project the geometry?\r\n      }*/\r\n      const featureGeometryCoordinates = feature.getGeometry().getCoordinates();\r\n      const featureGeometryType = feature.getGeometry().getType();\r\n\r\n      if (!firstFeatureType && !outBboxExtent) {\r\n        firstFeatureType = featureGeometryType;\r\n      }\r\n      if (!outBboxExtent) {\r\n        switch (featureGeometryType) {\r\n          case 'Point':\r\n            if (nbFeatures === 1) {\r\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\r\n            } else {\r\n              ptsArray.push(featureGeometryCoordinates);\r\n            }\r\n            break;\r\n          case 'LineString':\r\n            olmline.appendLineString(\r\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\r\n            );\r\n            break;\r\n          case 'Polygon':\r\n            olmpoly.appendPolygon(\r\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\r\n            );\r\n            break;\r\n          case 'MultiPolygon':\r\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\r\n            break;\r\n          default:\r\n            return;\r\n        }\r\n      }\r\n    });\r\n\r\n    let olmpts;\r\n    if (ptsArray.length === 0 && pts) {\r\n      olmpts = {\r\n        type: pts.getType(),\r\n        coordinates: pts.getCoordinates()\r\n      };\r\n    } else {\r\n      olmpts = {\r\n        type: 'Polygon',\r\n        coordinates: [this.convexHull(ptsArray)]\r\n      };\r\n    }\r\n\r\n    switch (firstFeatureType) {\r\n      case 'LineString':\r\n        return {\r\n          type: olmline.getType(),\r\n          coordinates: olmline.getCoordinates()\r\n        };\r\n      case 'Point':\r\n        return olmpts;\r\n      case 'Polygon':\r\n        return {\r\n          type: olmpoly.getType(),\r\n          coordinates: olmpoly.getCoordinates()\r\n        };\r\n      case 'MultiPolygon':\r\n        return {\r\n          type: olmpoly.getType(),\r\n          coordinates: olmpoly.getCoordinates()\r\n        };\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  cross(a, b, o) {\r\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\r\n  }\r\n\r\n  /**\r\n   * @param points An array of [X, Y] coordinates\r\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\r\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\r\n   */\r\n  convexHull(points) {\r\n    points.sort((a, b) => {\r\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\r\n    });\r\n\r\n    const lower = [];\r\n    for (const point of points) {\r\n      while (\r\n        lower.length >= 2 &&\r\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\r\n      ) {\r\n        lower.pop();\r\n      }\r\n      lower.push(point);\r\n    }\r\n\r\n    const upper = [];\r\n    for (let i = points.length - 1; i >= 0; i--) {\r\n      while (\r\n        upper.length >= 2 &&\r\n        this.cross(\r\n          upper[upper.length - 2],\r\n          upper[upper.length - 1],\r\n          points[i]\r\n        ) <= 0\r\n      ) {\r\n        upper.pop();\r\n      }\r\n      upper.push(points[i]);\r\n    }\r\n\r\n    upper.pop();\r\n    lower.pop();\r\n    return lower.concat(upper);\r\n  }\r\n\r\n  private extractData(\r\n    res,\r\n    layer: Layer,\r\n    options: QueryOptions,\r\n    url: string,\r\n    imposedGeometry?\r\n  ): Feature[] {\r\n    const queryDataSource = layer.dataSource as QueryableDataSource;\r\n\r\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\r\n    let features = [];\r\n    switch (queryDataSource.options.queryFormat) {\r\n      case QueryFormat.GML3:\r\n        features = this.extractGML3Data(\r\n          res,\r\n          layer.zIndex,\r\n          allowedFieldsAndAlias\r\n        );\r\n        break;\r\n      case QueryFormat.JSON:\r\n      case QueryFormat.GEOJSON:\r\n      case QueryFormat.GEOJSON2:\r\n        features = this.extractGeoJSONData(res, layer.zIndex, allowedFieldsAndAlias);\r\n        break;\r\n      case QueryFormat.ESRIJSON:\r\n        features = this.extractEsriJSONData(res, layer.zIndex, allowedFieldsAndAlias);\r\n        break;\r\n      case QueryFormat.TEXT:\r\n        features = this.extractTextData(res);\r\n        break;\r\n      case QueryFormat.HTML:\r\n        features = this.extractHtmlData(\r\n          res,\r\n          queryDataSource.queryHtmlTarget,\r\n          url\r\n        );\r\n        break;\r\n      case QueryFormat.HTMLGML2:\r\n        features = this.extractHtmlData(\r\n          res,\r\n          queryDataSource.queryHtmlTarget,\r\n          url,\r\n          imposedGeometry\r\n        );\r\n        break;\r\n      case QueryFormat.GML2:\r\n      default:\r\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\r\n        break;\r\n    }\r\n\r\n    if (features.length > 0 && features[0].geometry == null) {\r\n      const geomToAdd = this.createGeometryFromUrlClick(url);\r\n\r\n      for (const feature of features) {\r\n        feature.geometry = geomToAdd;\r\n      }\r\n    }\r\n\r\n    return features.map((feature: Feature, index: number) => {\r\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\r\n\r\n      let exclude;\r\n      if (layer.options.sourceOptions.type === 'wms') {\r\n        const sourceOptions = layer.options\r\n          .sourceOptions as WMSDataSourceOptions;\r\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\r\n      }\r\n\r\n      let title = this.getQueryTitle(feature, layer);\r\n      if (!title && features.length > 1) {\r\n        title = `${layer.title} (${index + 1})`;\r\n      } else if (!title) {\r\n        title = layer.title;\r\n      }\r\n\r\n      const meta = Object.assign({}, feature.meta || {}, {\r\n        id: uuid(),\r\n        title,\r\n        mapTitle: mapLabel,\r\n        sourceTitle: layer.title,\r\n        order: 1000 - layer.zIndex,\r\n        excludeAttribute: exclude\r\n      });\r\n\r\n      return Object.assign(feature, {\r\n        meta,\r\n        projection:\r\n          queryDataSource.options.type === 'carto'\r\n            ? 'EPSG:4326'\r\n            : options.projection\r\n      });\r\n    });\r\n  }\r\n\r\n  private createGeometryFromUrlClick(url) {\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const bboxRaw = searchParams.bbox;\r\n    const width = parseInt(searchParams.width, 10);\r\n    const height = parseInt(searchParams.height, 10);\r\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\r\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\r\n\r\n    const bbox = bboxRaw.split(',');\r\n    let threshold =\r\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\r\n\r\n    // for context in degree (EPSG:4326,4269...)\r\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\r\n      threshold = 0.045;\r\n    }\r\n    const clickx =\r\n      parseFloat(bbox[0]) +\r\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\r\n        width -\r\n      threshold;\r\n    const clicky =\r\n      parseFloat(bbox[1]) +\r\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\r\n        height -\r\n      threshold;\r\n    const clickx1 = clickx + threshold * 2;\r\n    const clicky1 = clicky + threshold * 2;\r\n\r\n    const wktPoly =\r\n      'POLYGON((' +\r\n      clickx +\r\n      ' ' +\r\n      clicky +\r\n      ', ' +\r\n      clickx +\r\n      ' ' +\r\n      clicky1 +\r\n      ', ' +\r\n      clickx1 +\r\n      ' ' +\r\n      clicky1 +\r\n      ', ' +\r\n      clickx1 +\r\n      ' ' +\r\n      clicky +\r\n      ', ' +\r\n      clickx +\r\n      ' ' +\r\n      clicky +\r\n      '))';\r\n\r\n    const format = new olformat.WKT();\r\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\r\n    const f = tenPercentWidthGeom.getGeometry() as any;\r\n\r\n    const newGeom = {\r\n      type: f.getType(),\r\n      coordinates: f.getCoordinates()\r\n    };\r\n\r\n    return newGeom;\r\n  }\r\n\r\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\r\n    const parser = new olFormatGML2();\r\n    let features = parser.readFeatures(res);\r\n    // Handle non standard GML output (MapServer)\r\n    if (features.length === 0) {\r\n      const wmsParser = new olformat.WMSGetFeatureInfo();\r\n      try {\r\n        features = wmsParser.readFeatures(res);\r\n      } catch (e) {\r\n        console.warn(\r\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\r\n        );\r\n      }\r\n    }\r\n\r\n    return features.map(feature =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\r\n    const parser = new olFormatGML3();\r\n    let features = [];\r\n    try {\r\n      features = parser.readFeatures(res);\r\n    } catch (e) {\r\n      console.warn('query.service: GML3 is not well supported');\r\n    }\r\n    return features.map(feature =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\r\n    let features = [];\r\n    try {\r\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\r\n    } catch (e) {\r\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\r\n    }\r\n    features.map(feature => feature.meta = {\r\n      id: uuid(),\r\n      order: 1000 - zIndex,\r\n      alias: allowedFieldsAndAlias\r\n    });\r\n    return features;\r\n  }\r\n\r\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\r\n    if (res) {\r\n      try {\r\n        if (JSON.parse(res).error) {\r\n          return [];\r\n        }\r\n      } catch (e) {}\r\n    }\r\n    const parser = new olFormatEsriJSON();\r\n    const features = parser.readFeatures(res);\r\n\r\n    return features.map(feature => this.featureToResult(feature, zIndex, allowedFieldsAndAlias));\r\n  }\r\n\r\n  private extractTextData(res) {\r\n    // TODO\r\n    return [];\r\n  }\r\n\r\n  private extractHtmlData(\r\n    res,\r\n    htmlTarget: QueryHtmlTarget,\r\n    url,\r\n    imposedGeometry?\r\n  ) {\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\r\n    const geomToAdd = this.createGeometryFromUrlClick(url);\r\n\r\n    if (\r\n      htmlTarget !== QueryHtmlTarget.BLANK &&\r\n      htmlTarget !== QueryHtmlTarget.IFRAME\r\n    ) {\r\n      htmlTarget = QueryHtmlTarget.IFRAME;\r\n    }\r\n\r\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\r\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\r\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\r\n    const striptags = striptags_;\r\n    const body = striptags(res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, ''));\r\n    if (body === '' || res === '') {\r\n      return [];\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: FEATURE,\r\n        projection,\r\n        properties: { target: htmlTarget, body: res, url },\r\n        geometry: imposedGeometry || geomToAdd\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getQueryParams(url) {\r\n    const queryString = url.split('?');\r\n    if (!queryString[1]) {\r\n      return;\r\n    }\r\n    const pairs = queryString[1].split('&');\r\n\r\n    const result = {};\r\n    pairs.forEach(pair => {\r\n      pair = pair.split('=');\r\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\r\n    });\r\n    return result;\r\n  }\r\n\r\n  public featureToResult(\r\n    featureOL: olFeature<olgeom.Geometry>,\r\n    zIndex: number,\r\n    allowedFieldsAndAlias?\r\n  ): Feature {\r\n    const featureGeometry = featureOL.getGeometry() as any;\r\n    const properties: any = Object.assign({}, featureOL.getProperties());\r\n    delete properties.geometry;\r\n    delete properties.GEOMETRIE;\r\n    delete properties.boundedBy;\r\n    delete properties.shape;\r\n    delete properties.SHAPE;\r\n    delete properties.the_geom;\r\n    delete properties.geom;\r\n\r\n    let geometry;\r\n    if (featureGeometry) {\r\n      geometry = {\r\n        type: featureGeometry.getType(),\r\n        coordinates: featureGeometry.getCoordinates()\r\n      };\r\n    }\r\n\r\n    return {\r\n      type: FEATURE,\r\n      projection: undefined,\r\n      properties,\r\n      geometry,\r\n      meta: {\r\n        id: uuid(),\r\n        order: 1000 - zIndex,\r\n        alias: allowedFieldsAndAlias\r\n      }\r\n    };\r\n  }\r\n\r\n  private getQueryUrl(\r\n    datasource: QueryableDataSource,\r\n    options: QueryOptions,\r\n    forceGML2 = false,\r\n    mapExtent?: MapExtent\r\n  ): string {\r\n    let url;\r\n    switch (datasource.constructor) {\r\n      case WMSDataSource:\r\n        const wmsDatasource = datasource as WMSDataSource;\r\n\r\n        const WMSGetFeatureInfoOptions = {\r\n          INFO_FORMAT:\r\n            wmsDatasource.params.INFO_FORMAT ||\r\n            this.getMimeInfoFormat(datasource.options.queryFormat),\r\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\r\n          FEATURE_COUNT: wmsDatasource.params.FEATURE_COUNT || '5'\r\n        };\r\n\r\n        if (forceGML2) {\r\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\r\n            QueryFormat.GML2\r\n          );\r\n        }\r\n\r\n        url = wmsDatasource.ol.getFeatureInfoUrl(\r\n          options.coordinates,\r\n          options.resolution,\r\n          options.projection,\r\n          WMSGetFeatureInfoOptions\r\n        );\r\n        // const wmsVersion =\r\n        //   wmsDatasource.params.VERSION ||\r\n        //   wmsDatasource.params.version ||\r\n        //   '1.3.0';\r\n        // if (wmsVersion !== '1.3.0') {\r\n        //   url = url.replace('&I=', '&X=');\r\n        //   url = url.replace('&J=', '&Y=');\r\n        // }\r\n        break;\r\n      case CartoDataSource:\r\n        const cartoDatasource = datasource as CartoDataSource;\r\n        const baseUrl =\r\n          'https://' +\r\n          cartoDatasource.options.account +\r\n          '.carto.com/api/v2/sql?';\r\n        const format = 'format=GeoJSON';\r\n        const sql =\r\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\r\n        const clause =\r\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\r\n        const meters = cartoDatasource.options.queryPrecision\r\n          ? cartoDatasource.options.queryPrecision\r\n          : '1000';\r\n        const coordinates =\r\n          options.coordinates[0] +\r\n          ',' +\r\n          options.coordinates[1] +\r\n          '),3857),' +\r\n          meters +\r\n          '))';\r\n\r\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\r\n        break;\r\n      case ImageArcGISRestDataSource:\r\n      case TileArcGISRestDataSource:\r\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\r\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\r\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\r\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\r\n        const clickBuffer = maxDelta * 0.005;\r\n        const threshold = tileArcGISRestDatasource.options.queryPrecision ? tileArcGISRestDatasource.options.queryPrecision : clickBuffer;\r\n        const extent = olextent.buffer(\r\n          olextent.boundingExtent([options.coordinates]),\r\n          threshold\r\n        );\r\n        const serviceUrl =\r\n          tileArcGISRestDatasource.options.url +\r\n          '/' +\r\n          tileArcGISRestDatasource.options.layer +\r\n          '/query/';\r\n        const geometry = encodeURIComponent(\r\n          '{\"xmin\":' +\r\n            extent[0] +\r\n            ',\"ymin\":' +\r\n            extent[1] +\r\n            ',\"xmax\":' +\r\n            extent[2] +\r\n            ',\"ymax\":' +\r\n            extent[3] +\r\n            ',\"spatialReference\":{\"wkid\":102100}}'\r\n        );\r\n        const params = [\r\n          'f=json',\r\n          `geometry=${geometry}`,\r\n          'geometryType=esriGeometryEnvelope',\r\n          'inSR=102100',\r\n          'spatialRel=esriSpatialRelIntersects',\r\n          'outFields=*',\r\n          'returnGeometry=true',\r\n          'outSR=102100'\r\n        ];\r\n        url = `${serviceUrl}?${params.join('&')}`;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return url;\r\n  }\r\n\r\n  private getMimeInfoFormat(queryFormat: string) {\r\n    let mime = 'application/vnd.ogc.gml';\r\n    const keyEnum = Object.keys(QueryFormat).find(\r\n      key => QueryFormat[key] === queryFormat\r\n    );\r\n    if (keyEnum) {\r\n      mime = QueryFormatMimeType[keyEnum];\r\n    }\r\n\r\n    return mime;\r\n  }\r\n\r\n  getAllowedFieldsAndAlias(layer: any) {\r\n    let allowedFieldsAndAlias;\r\n    if (\r\n      layer.options?.source?.options?.sourceFields &&\r\n      layer.options.source.options.sourceFields.length >= 1\r\n    ) {\r\n      allowedFieldsAndAlias = {};\r\n      layer.options.source.options.sourceFields.forEach(sourceField => {\r\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\r\n        allowedFieldsAndAlias[sourceField.name] = alias;\r\n      });\r\n    }\r\n    return allowedFieldsAndAlias;\r\n  }\r\n\r\n  getQueryTitle(feature: Feature, layer: Layer): string {\r\n    let title;\r\n    if (layer.options?.source?.options) {\r\n      const dataSourceOptions = layer.options.source\r\n        .options as QueryableDataSourceOptions;\r\n      if (dataSourceOptions.queryTitle) {\r\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\r\n      }\r\n    }\r\n\r\n    return title;\r\n  }\r\n\r\n  getLabelMatch(feature: Feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach(v => {\r\n      label = label.replace(v[0], feature.properties[v[1]]);\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.properties[labelMatch] || labelMatch;\r\n    }\r\n\r\n    return label;\r\n  }\r\n}\r\n","import OlLayer from 'ol/layer/Layer';\r\nimport OlSource from 'ol/source/Source';\r\n\r\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\r\nimport { QueryableDataSource } from './query.interfaces';\r\n\r\n/**\r\n * Whether a layer is queryable\r\n * @param layer Layer\r\n * @returns True if the layer s squeryable\r\n */\r\nexport function layerIsQueryable(layer: AnyLayer): boolean {\r\n  const dataSource = layer.dataSource as QueryableDataSource;\r\n  return dataSource.options.queryable === true;\r\n}\r\n\r\n/**\r\n * Whether an OL layer is queryable\r\n * @param layer Layer\r\n * @returns True if the ol layer is queryable\r\n */\r\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\r\n  const layer = olLayer.get('_layer');\r\n  return layer === undefined ? false : layerIsQueryable(layer);\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  AfterViewInit,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { Subscription, Observable, of, zip } from 'rxjs';\r\nimport { unByKey, OnReturn } from 'ol/Observable';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport OlRenderFeature from 'ol/render/Feature';\r\nimport OlLayer from 'ol/layer/Layer';\r\nimport OlSource from 'ol/source/Source';\r\nimport olVectorSource from 'ol/source/Vector';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { EventsKey } from 'ol/events';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\r\nimport { featureFromOl } from '../../feature/shared/feature.utils';\r\nimport { QueryService } from './query.service';\r\nimport { layerIsQueryable, olLayerIsQueryable } from './query.utils';\r\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\r\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\n\r\n/**\r\n * This directive makes a map queryable with a click of with a drag box.\r\n * By default, all layers are queryable but this can ben controlled at\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoQuery]'\r\n})\r\nexport class QueryDirective implements AfterViewInit, OnDestroy {\r\n  /**\r\n   * Subscriptions to ongoing queries\r\n   */\r\n  private queries$$: Subscription[] = [];\r\n\r\n  /**\r\n   * Listener to the map click event\r\n   */\r\n  private mapClickListener: OnReturn;\r\n\r\n  /**\r\n   * OL drag box interaction\r\n   */\r\n  private olDragSelectInteraction: OlDragSelectInteraction;\r\n\r\n  /**\r\n   * Ol drag box \"end\" event key\r\n   */\r\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\r\n\r\n  /**\r\n   * Whter to query features or not\r\n   */\r\n  @Input() queryFeatures: boolean = false;\r\n\r\n  /**\r\n   * Feature query hit tolerance\r\n   */\r\n  @Input() queryFeaturesHitTolerance: number = 0;\r\n\r\n  /**\r\n   * Feature query hit tolerance\r\n   */\r\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\r\n\r\n  /**\r\n   * Whether all query should complete before emitting an event\r\n   */\r\n  @Input() waitForAllQueries: boolean = true;\r\n\r\n  /**\r\n   * Event emitted when a query (or all queries) complete\r\n   */\r\n  @Output() query = new EventEmitter<{\r\n    features: Feature[] | Feature[][];\r\n    event: MapBrowserPointerEvent<any>;\r\n  }>();\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return (this.component.map as any) as IgoMap;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private queryService: QueryService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to click and drag box events\r\n   * @internal\r\n   */\r\n  ngAfterViewInit() {\r\n    this.listenToMapClick();\r\n    this.addDragBoxInteraction();\r\n  }\r\n\r\n  /**\r\n   * Stop listening to click and drag box events and cancel ongoind requests\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.cancelOngoingQueries();\r\n    this.unlistenToMapClick();\r\n    this.removeDragBoxInteraction();\r\n  }\r\n\r\n  /**\r\n   * On map click, issue queries\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map clicks\r\n   */\r\n  private unlistenToMapClick() {\r\n    // this.map.ol.un(this.mapClickListener.type, this.mapClickListener.listener);\r\n    this.mapClickListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Issue queries from a map event and emit events with the results\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\r\n    this.cancelOngoingQueries();\r\n    if (!this.queryService.queryEnabled) {\r\n      return;\r\n    }\r\n\r\n    const queries$ = [];\r\n    if (this.queryFeatures) {\r\n      queries$.push(this.doQueryFeatures(event));\r\n    }\r\n\r\n    const resolution = this.map.ol.getView().getResolution();\r\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\r\n    queries$.push(\r\n      ...this.queryService.query(queryLayers, {\r\n        coordinates: event.coordinate as [number, number],\r\n        projection: this.map.projection,\r\n        resolution\r\n      })\r\n    );\r\n\r\n    if (queries$.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (this.waitForAllQueries) {\r\n      this.queries$$.push(\r\n        zip(...queries$).subscribe((results: Feature[][]) => {\r\n          const features = [].concat(...results);\r\n          this.query.emit({ features, event });\r\n        })\r\n      );\r\n    } else {\r\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\r\n        return query$.subscribe((features: Feature[]) => {\r\n          this.query.emit({ features, event });\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Query features already present on the map\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private doQueryFeatures(\r\n    event: MapBrowserPointerEvent<any>\r\n  ): Observable<Feature[]> {\r\n    const clickedFeatures = [];\r\n\r\n    if (event.type === 'singleclick') {\r\n      this.map.ol.forEachFeatureAtPixel(\r\n        event.pixel,\r\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\r\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\r\n          if (featureOL) {\r\n            if (featureOL.get('features')) {\r\n              for (const feature of featureOL.get('features')) {\r\n                const newFeature = featureFromOl(feature, this.map.projection);\r\n                newFeature.meta = {\r\n                  title: feature.values_.nom,\r\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\r\n                  icon: feature.values_._icon,\r\n                  sourceTitle: layerOL.values_.title,\r\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\r\n                };\r\n                clickedFeatures.push(newFeature);\r\n              }\r\n            } else if (featureOL instanceof OlRenderFeature) {\r\n              const newFeature = renderFeatureFromOl(\r\n                featureOL,\r\n                this.map.projection,\r\n                layerOL\r\n              );\r\n              newFeature.meta = {\r\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\r\n                sourceTitle: layerOL.values_.title,\r\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\r\n              };\r\n              clickedFeatures.push(newFeature);\r\n            } else {\r\n              const newFeature = featureFromOl(\r\n                featureOL,\r\n                this.map.projection,\r\n                layerOL\r\n              );\r\n              newFeature.meta = {\r\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\r\n                sourceTitle: layerOL.values_.title,\r\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\r\n              };\r\n              clickedFeatures.push(newFeature);\r\n            }\r\n          }\r\n        },\r\n        {\r\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\r\n          layerFilter: this.queryFeaturesCondition\r\n            ? this.queryFeaturesCondition\r\n            : olLayerIsQueryable\r\n        }\r\n      );\r\n    } else if (event.type === 'boxend') {\r\n      const target = event.target as any;\r\n      const dragExtent = target.getGeometry().getExtent();\r\n      this.map.layers\r\n        .filter(layerIsQueryable)\r\n        .filter(layer => layer instanceof VectorLayer && layer.visible)\r\n        .map(layer => {\r\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\r\n          featuresOL.forEachFeatureIntersectingExtent(dragExtent, (olFeature: any) => {\r\n            const newFeature: Feature = featureFromOl(olFeature, this.map.projection, layer.ol);\r\n            newFeature.meta = {\r\n              id: layer.id + '.' + olFeature.getId(),\r\n              icon: olFeature.values_._icon,\r\n              sourceTitle: layer.title,\r\n              alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n              title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\r\n            };\r\n            clickedFeatures.push(newFeature);\r\n          });\r\n        });\r\n    }\r\n\r\n\r\n    return of(clickedFeatures);\r\n  }\r\n\r\n  /**\r\n   * Cancel ongoing requests, if any\r\n   */\r\n  private cancelOngoingQueries() {\r\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\r\n    this.queries$$ = [];\r\n  }\r\n\r\n  /**\r\n   * Add a drag box interaction and, on drag box end, select features\r\n   */\r\n  private addDragBoxInteraction() {\r\n    let olDragSelectInteractionOnQuery;\r\n    const olInteractions = this.map.ol.getInteractions().getArray();\r\n\r\n    // There can only be one dragbox interaction, so find the current one, if any\r\n    // Don't keep a reference to the current dragbox because we don't want\r\n    // to remove it when this startegy is deactivated\r\n    for (const olInteraction of olInteractions) {\r\n      if (olInteraction instanceof OlDragSelectInteraction) {\r\n        olDragSelectInteractionOnQuery = olInteraction;\r\n        break;\r\n      }\r\n    }\r\n    // If no drag box interaction is found, create a new one and add it to the map\r\n    if (olDragSelectInteractionOnQuery === undefined) {\r\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\r\n        condition: ctrlKeyDown\r\n      });\r\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\r\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\r\n    }\r\n\r\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\r\n      'boxend',\r\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove drag box interaction\r\n   */\r\n  private removeDragBoxInteraction() {\r\n    if (this.olDragSelectInteractionEndKey !== undefined) {\r\n      unByKey(this.olDragSelectInteractionEndKey);\r\n    }\r\n    if (this.olDragSelectInteraction !== undefined) {\r\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\r\n    }\r\n    this.olDragSelectInteraction = undefined;\r\n  }\r\n}\r\n","import { Observable } from 'rxjs';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { StorageService } from '@igo2/core';\r\nimport { SearchResult } from '../search.interfaces';\r\nimport {\r\n  SearchSourceOptions,\r\n  TextSearchOptions,\r\n  ReverseSearchOptions,\r\n  SearchSourceSettings\r\n} from './source.interfaces';\r\n\r\n/**\r\n * Base search source class\r\n */\r\nexport class SearchSource {\r\n  /**\r\n   * Search source ID\r\n   * @internal\r\n   */\r\n  static id = '';\r\n\r\n  /**\r\n   * Search source type\r\n   * @internal\r\n   */\r\n  static type = '';\r\n\r\n  /**\r\n   * Search source options\r\n   * @internal\r\n   */\r\n  protected options: SearchSourceOptions;\r\n\r\n  /**\r\n   * Get search source's id\r\n   * @returns Search source's id\r\n   */\r\n  getId(): string {\r\n    throw new Error('You have to implement the method \"getId\".');\r\n  }\r\n  /**\r\n   * Get search source's type\r\n   * @returns Search source's type\r\n   */\r\n  getType(): string {\r\n    throw new Error('You have to implement the method \"getType\".');\r\n  }\r\n\r\n  /**\r\n   * Get search source's default options\r\n   * @returns Search source default options\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\r\n  }\r\n\r\n  /**\r\n   * Search source's title\r\n   */\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  /**\r\n   * Whether the search source is available\r\n   */\r\n  get available(): boolean {\r\n    return this.options.available !== false;\r\n  }\r\n\r\n  /**\r\n   * Whether the search source is enabled\r\n   */\r\n  set enabled(value: boolean) {\r\n    this.options.enabled = value;\r\n  }\r\n  get enabled(): boolean {\r\n    return this.available && this.options.enabled !== false;\r\n  }\r\n\r\n  get showInPointerSummary(): boolean {\r\n    const showInPointerSummary = this.options.showInPointerSummary;\r\n    return showInPointerSummary ? showInPointerSummary : false;\r\n  }\r\n\r\n  get showInSettings(): boolean {\r\n    const showInSettings = this.options.showInSettings;\r\n    return showInSettings === undefined ? true : showInSettings;\r\n  }\r\n\r\n  /**\r\n   * Search url\r\n   */\r\n  get searchUrl(): string {\r\n    return this.options.searchUrl;\r\n  }\r\n\r\n  /**\r\n   * Search query params\r\n   */\r\n  get params(): { [key: string]: string } {\r\n    return this.options.params === undefined ? {} : this.options.params;\r\n  }\r\n\r\n  /**\r\n   * Search settings\r\n   */\r\n  get settings(): SearchSourceSettings[] {\r\n    return this.options.settings === undefined ? [] : this.options.settings;\r\n  }\r\n\r\n  /**\r\n   * Set params from selected settings\r\n   */\r\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\r\n    switch (setting.type) {\r\n      case 'radiobutton':\r\n        setting.values.forEach(conf => {\r\n          if (conf.enabled) {\r\n            this.options.params = Object.assign(this.options.params || {}, {\r\n              [setting.name]: conf.value\r\n            });\r\n          }\r\n        });\r\n        break;\r\n      case 'checkbox':\r\n        let confValue = '';\r\n        setting.values\r\n          .filter(s => s.available !== false)\r\n          .forEach(conf => {\r\n            if (conf.enabled) {\r\n              confValue += conf.value + ',';\r\n            }\r\n          });\r\n        confValue = confValue.slice(0, -1);\r\n        this.options.params = Object.assign(this.options.params || {}, {\r\n          [setting.name]: confValue\r\n        });\r\n        break;\r\n    }\r\n\r\n    if (saveInStorage && this.storageService) {\r\n      this.storageService.set(\r\n        this.getId() + '.options',\r\n        {params: this.options.params}\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search results display order\r\n   */\r\n  get displayOrder(): number {\r\n    return this.options.order === undefined ? 99 : this.options.order;\r\n  }\r\n\r\n  constructor(options: SearchSourceOptions, private storageService?: StorageService) {\r\n    this.options = options;\r\n    if (this.storageService) {\r\n      const storageOptions = this.storageService.get(\r\n        this.getId() + '.options'\r\n      ) as object;\r\n      if (storageOptions) {\r\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\r\n      }\r\n    }\r\n\r\n    this.options = ObjectUtils.mergeDeep(this.getDefaultOptions(), this.options);\r\n\r\n\r\n    // Set Default Params from Settings\r\n    this.settings.forEach(setting => {\r\n      this.setParamFromSetting(setting, false);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get hashtags valid\r\n   * @param hashtag hashtag from query\r\n   */\r\n  getHashtagsValid(term: string, settingsName: string): string[] {\r\n    const hashtags = term.match(/(#[A-Za-z]+)/g);\r\n    if (!hashtags) {\r\n      return undefined;\r\n    }\r\n\r\n    const searchSourceSetting = this.getSettingsValues(settingsName);\r\n    const hashtagsValid = [];\r\n    hashtags.forEach(hashtag => {\r\n      searchSourceSetting.values.forEach(conf => {\r\n        const hashtagKey = hashtag.substring(1);\r\n        if (typeof conf.value === 'string') {\r\n          const types = conf.value\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n            .split(',');\r\n          const index = types.indexOf(\r\n            hashtagKey\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '')\r\n          );\r\n          if (index !== -1) {\r\n            hashtagsValid.push(types[index]);\r\n          }\r\n        }\r\n        if (conf.hashtags && conf.hashtags.indexOf(hashtagKey) !== -1) {\r\n          hashtagsValid.push(conf.value);\r\n        }\r\n      });\r\n    });\r\n\r\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\r\n  }\r\n\r\n  getSettingsValues(search: string): SearchSourceSettings {\r\n    return this.getDefaultOptions().settings.find(\r\n      (value: SearchSourceSettings) => {\r\n        return value.name === search;\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Search sources that allow searching by text implement this class\r\n */\r\nexport interface TextSearch {\r\n  /**\r\n   * Search by text\r\n   * @param term Text\r\n   * @param options Optional: TextSearchOptions\r\n   * @returns Observable or search results\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult[]>;\r\n}\r\n\r\n/**\r\n * Search sources that allow searching by coordinates implement this class\r\n */\r\nexport interface ReverseSearch {\r\n  /**\r\n   * Search by text\r\n   * @param lonLat Coordinates\r\n   * @param options Optional: ReverseSearchOptions\r\n   * @returns Observable or search results\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult[]>;\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\n\r\nimport { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\r\n/**\r\n * Map search source. For now it has no search capability. All it does\r\n * is act as a placeholder for the map query results' \"search source\".\r\n */\r\n@Injectable()\r\nexport class QuerySearchSource extends SearchSource {\r\n  static id = 'map';\r\n  static type = FEATURE;\r\n\r\n  constructor(@Inject('options') options: SearchSourceOptions) {\r\n    super(options);\r\n  }\r\n\r\n  getId(): string {\r\n    return QuerySearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return QuerySearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Carte'\r\n    };\r\n  }\r\n}\r\n","export class GoogleLinks {\r\n  static getGoogleMapsCoordLink(lon, lat) {\r\n    return 'https://www.google.com/maps?q=' + lat + ',' + lon;\r\n  }\r\n\r\n  static getGoogleStreetViewLink(lon, lat) {\r\n    return 'https://www.google.com/maps?q=&layer=c&cbll=' + lat + ',' + lon;\r\n  }\r\n\r\n  static getGoogleMapsNameLink(name) {\r\n    const encodedName = encodeURI(name);\r\n    return 'https://www.google.com/maps?q=' + encodedName;\r\n  }\r\n}\r\n","export class OsmLinks {\r\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\r\n    // return 'https://www.google.com/maps?q=' + lat + ',' + lon;\r\n    return  `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\r\n  }\r\n\r\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\r\n    return  `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { EMPTY, Observable, of, zip } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\nimport { uuid, ObjectUtils } from '@igo2/utils';\r\nimport { LanguageService, MessageService, ConfigService } from '@igo2/core';\r\nimport {\r\n  CapabilitiesService,\r\n  WMSDataSourceOptions,\r\n  WMSDataSourceOptionsParams,\r\n  WMTSDataSourceOptions,\r\n  ArcGISRestDataSourceOptions,\r\n  TypeCapabilitiesStrings\r\n} from '../../datasource';\r\nimport { LayerOptions, ImageLayerOptions } from '../../layer';\r\nimport { getResolutionFromScale } from '../../map';\r\n\r\nimport {\r\n  CatalogItem,\r\n  CatalogItemLayer,\r\n  CatalogItemGroup\r\n} from './catalog.interface';\r\nimport { Catalog, CatalogFactory, CompositeCatalog } from './catalog.abstract';\r\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\r\nimport { QueryFormat } from '../../query';\r\nimport { generateIdFromSourceOptions, generateId } from '../../utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CatalogService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {}\r\n\r\n  loadCatalogs(): Observable<Catalog[]> {\r\n    const contextConfig = this.config.getConfig('context') || {};\r\n    const catalogConfig = this.config.getConfig('catalog') || {};\r\n    const apiUrl = catalogConfig.url || contextConfig.url;\r\n    const catalogsFromConfig = catalogConfig.sources || [];\r\n\r\n    const observables$ = [];\r\n\r\n    if (apiUrl) {\r\n      // Base layers catalog\r\n      if (catalogConfig.baseLayers) {\r\n        const translate = this.languageService.translate;\r\n        const title = translate.instant('igo.geo.catalog.baseLayers');\r\n        const baseLayersCatalog = [\r\n          {\r\n            id: 'catalog.baselayers',\r\n            title,\r\n            url: `${apiUrl}/baselayers`,\r\n            type: 'baselayers'\r\n          }\r\n        ];\r\n        observables$.push(of(baseLayersCatalog));\r\n      }\r\n\r\n      // Catalogs from API\r\n      const catalogsFromApi$ = this.http\r\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\r\n        .pipe(\r\n          map((catalogs) =>\r\n            catalogs.map((c: any) => Object.assign(c, c.options))\r\n          ),\r\n          catchError((_response: HttpErrorResponse) => EMPTY)\r\n        );\r\n      observables$.push(catalogsFromApi$);\r\n    }\r\n\r\n    // Catalogs from config\r\n    if (catalogsFromConfig.length > 0) {\r\n      observables$.push(\r\n        of(catalogsFromConfig).pipe(\r\n          map((catalogs: Catalog[]) =>\r\n            catalogs.map((c) => {\r\n              if (!c.id) {\r\n                c.id = uuid();\r\n              }\r\n              return c;\r\n            })\r\n          )\r\n        )\r\n      );\r\n    }\r\n\r\n    return zip(...observables$).pipe(\r\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\r\n    ) as Observable<Catalog[]>;\r\n  }\r\n\r\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    let newCatalog: Catalog;\r\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\r\n    return newCatalog.collectCatalogItems();\r\n  }\r\n\r\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\r\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\r\n      map((layersOptions: LayerOptions[]) => {\r\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\r\n          return {\r\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\r\n            title: layerOptions.title,\r\n            type: CatalogItemType.Layer,\r\n            externalProvider: catalog.externalProvider,\r\n            options: layerOptions\r\n          } as CatalogItemLayer;\r\n        });\r\n        return [\r\n          {\r\n            id: 'catalog.group.baselayers',\r\n            type: CatalogItemType.Group,\r\n            externalProvider: catalog.externalProvider,\r\n            title: catalog.title,\r\n            items\r\n          }\r\n        ];\r\n      })\r\n    );\r\n  }\r\n\r\n  private getCatalogBaseLayersOptions(\r\n    catalog: Catalog\r\n  ): Observable<LayerOptions[]> {\r\n    return this.http.get<LayerOptions[]>(catalog.url);\r\n  }\r\n\r\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => {\r\n        const items = [];\r\n        if (capabilities.Service && capabilities.Service.Abstract && capabilities.Service.Abstract.length) {\r\n          catalog.abstract = capabilities.Service.Abstract;\r\n        }\r\n        const finalLayers = [];\r\n        this.flattenWmsCapabilities(capabilities.Capability.Layer, 0, finalLayers, catalog.groupSeparator);\r\n        const capabilitiesCapabilityLayer = Object.assign({}, capabilities.Capability.Layer);\r\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(f => f.Layer.length !== 0);\r\n        this.includeRecursiveItems(\r\n          catalog,\r\n          capabilitiesCapabilityLayer,\r\n          items\r\n        );\r\n        return items;\r\n      })\r\n    );\r\n  }\r\n\r\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\r\n    if (!finalLayers.includes(parent.Title)) {\r\n        const modifiedParent = Object.assign({}, parent);\r\n        modifiedParent.Layer = [];\r\n        finalLayers.push(modifiedParent);\r\n    }\r\n    for (const layer of parent.Layer) {\r\n        const modifiedLayer = Object.assign({}, layer);\r\n        if (level > 0) {\r\n          modifiedLayer.Title = parent.Title + separator + layer.Title;\r\n        }\r\n        if (layer.Layer) {\r\n            this.flattenWmsCapabilities(modifiedLayer, level + 1, finalLayers, separator);\r\n        } else {\r\n            finalLayers.find(ff => ff.Title === parent.Title).Layer.push(layer);\r\n         }\r\n    }\r\n}\r\n\r\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\r\n    );\r\n  }\r\n\r\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => {\r\n        return this.getArcGISRESTItems(catalog, capabilities);\r\n      })\r\n    );\r\n  }\r\n\r\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\r\n\r\n    const catalogsFromInstance = [] as Catalog[];\r\n    compositeCatalog.map((component: Catalog) => {\r\n      component.sortDirection = catalog.sortDirection;  // propagate sortDirection with parent value\r\n      catalogsFromInstance.push(\r\n        CatalogFactory.createInstanceCatalog(component, this)\r\n    );\r\n  }\r\n    );\r\n\r\n    // get CatalogItems for each original Catalog-----------------------------------------------------\r\n    const request1$ = [];\r\n    catalogsFromInstance.map((component: Catalog) =>\r\n      request1$.push(component.collectCatalogItems())\r\n    );\r\n\r\n    // integrate imposed group -----------------------------------------------------\r\n    let request2$ = [];\r\n\r\n    function flatDeepLayer(arr) {\r\n      return arr.reduce(\r\n        (acc, val) =>\r\n          acc.concat(\r\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\r\n          ),\r\n        []\r\n      );\r\n    }\r\n\r\n    if (\r\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\r\n    ) {\r\n      const pushImposeGroup = (item, index) => {\r\n        const c = catalogsFromInstance[index];\r\n        const outGroupImpose = Object.assign({}, c.groupImpose);\r\n        outGroupImpose.address = c.id;\r\n        outGroupImpose.type = CatalogItemType.Group;\r\n        outGroupImpose.externalProvider = c.externalProvider;\r\n        if (outGroupImpose.sortDirection === undefined) {\r\n          outGroupImpose.sortDirection = c.sortDirection;\r\n        }\r\n        outGroupImpose.items = [];\r\n\r\n        const flatLayer = flatDeepLayer(item);\r\n        flatLayer.map(\r\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\r\n        );\r\n        outGroupImpose.items = flatLayer;\r\n\r\n        return outGroupImpose;\r\n      };\r\n\r\n      request2$ = request1$.map((obs, idx) =>\r\n        obs.pipe(\r\n          map((items) =>\r\n            compositeCatalog[idx].groupImpose\r\n              ? pushImposeGroup(items, idx)\r\n              : items\r\n          )\r\n        )\r\n      );\r\n    } else {\r\n      request2$ = request1$;\r\n    }\r\n\r\n    // concat Group -----------------------------------------------------\r\n    const request3$ = zip(...request2$).pipe(\r\n      map(\r\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\r\n      )\r\n    );\r\n\r\n    // merge Group (first level only) -----------------------------------------------------\r\n    const groupByGroupId = (data, keyFn) =>\r\n      data.reduce((acc, group) => {\r\n        const groupId = keyFn(group);\r\n        const ind = acc.find((x) => x.id === groupId);\r\n\r\n        if (!ind) {\r\n          acc[acc.length] = group;\r\n        } else {\r\n          const ix = acc.indexOf(ind);\r\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\r\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\r\n          }\r\n          acc[ix].items.push(...group.items);\r\n        }\r\n        return acc;\r\n      }, []);\r\n\r\n    // merge Layer for each Level (catalog, group(recursive))\r\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\r\n      items.reduce((acc, item, idx, arr) => {\r\n        const layerTitle = keyFn(item);\r\n        const outItem = Object.assign({}, item);\r\n\r\n        if (item.type === CatalogItemType.Layer) {\r\n          // same title, same address => result: only one item is keep\r\n\r\n          // same title, address diff\r\n          const indicesMatchTitle = [];\r\n          const diffAddress = arr.filter((x, i) => {\r\n            let bInd = false;\r\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\r\n              if (i !== idx && x.address !== item.address) {\r\n                bInd = true;\r\n              }\r\n              indicesMatchTitle.push(i);\r\n            }\r\n            return bInd;\r\n          }); // $& i !== idx\r\n\r\n          if (diffAddress.length > 0) {\r\n            const nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\r\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\r\n          }\r\n\r\n          const exist = acc.find(\r\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\r\n          );\r\n          if (!exist) {\r\n            acc[acc.length] = outItem;\r\n          }\r\n        } else if (item.type === CatalogItemType.Group) {\r\n          outItem.items = recursiveGroupByLayerAddress(\r\n            item.items,\r\n            (layer) => layer.title\r\n          );\r\n          acc[acc.length] = outItem;\r\n        }\r\n\r\n        return acc;\r\n      }, []);\r\n\r\n    const request4$ = request3$.pipe(\r\n      map((output) => groupByGroupId(output, (group) => group.id)),\r\n      map((output) => [].concat(...output)),\r\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\r\n    );\r\n\r\n    return request4$;\r\n  }\r\n\r\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\r\n    const sType: string = TypeCatalog[catalog.type as string];\r\n    return this.capabilitiesService\r\n      .getCapabilities(sType as any, catalog.url, catalog.version)\r\n      .pipe(\r\n        catchError((e) => {\r\n          const title = this.languageService.translate.instant(\r\n            'igo.geo.catalog.unavailableTitle'\r\n          );\r\n          const message = this.languageService.translate.instant(\r\n            'igo.geo.catalog.unavailable',\r\n            { value: catalog.title }\r\n          );\r\n\r\n          this.messageService.error(message, title);\r\n          throw e;\r\n        })\r\n      );\r\n  }\r\n\r\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\r\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\r\n      layer.Name,\r\n      layersQueryFormat\r\n    );\r\n\r\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\r\n    const legendOptions =\r\n      catalog.showLegend && layer.Style\r\n        ? this.capabilitiesService.getStyle(layer.Style)\r\n        : undefined;\r\n\r\n    const params = Object.assign({}, catalog.queryParams, {\r\n      LAYERS: layer.Name,\r\n      VERSION: catalog.version\r\n    } as WMSDataSourceOptionsParams);\r\n\r\n    const baseSourceOptions = {\r\n      type: 'wms',\r\n      url: catalog.url,\r\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\r\n      queryFormat: configuredQueryFormat,\r\n      queryHtmlTarget:\r\n        configuredQueryFormat === QueryFormat.HTML ||\r\n        configuredQueryFormat === QueryFormat.HTMLGML2\r\n          ? 'iframe'\r\n          : undefined,\r\n      optionsFromCapabilities: true\r\n    };\r\n\r\n    const sourceOptions = Object.assign(\r\n      {},\r\n      baseSourceOptions,\r\n      catalog.sourceOptions,\r\n      { params }\r\n    ) as WMSDataSourceOptions;\r\n\r\n    let layerTitle;\r\n    if (catalog.forcedProperties) {\r\n      for (const property of catalog.forcedProperties) {\r\n        if (layer.Name === property.layerName && property.title) {\r\n          layerTitle = property.title;\r\n        }\r\n      }\r\n    }\r\n\r\n    let abstract;\r\n    if (layer.Abstract) {\r\n      abstract = layer.Abstract;\r\n    } else if (!layer.Abstract && catalog.abstract) {\r\n      abstract = catalog.abstract;\r\n    }\r\n\r\n    const layerPrepare = {\r\n      id: generateIdFromSourceOptions(sourceOptions),\r\n      type: CatalogItemType.Layer,\r\n      title: layerTitle !== undefined ? layerTitle : layer.Title,\r\n      address: idParent,\r\n      externalProvider: catalog.externalProvider || false,\r\n      options: {\r\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\r\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\r\n        metadata: {\r\n          url: metadata ? metadata.OnlineResource : undefined,\r\n          extern: metadata ? true : undefined,\r\n          abstract,\r\n          type: baseSourceOptions.type\r\n        },\r\n        legendOptions,\r\n        tooltip: { type: catalog.tooltipType },\r\n        sourceOptions\r\n      }\r\n    } as CatalogItem;\r\n\r\n    return ObjectUtils.removeUndefined(layerPrepare);\r\n  }\r\n\r\n  private prepareCatalogItemGroup(\r\n    itemListIn,\r\n    regexes,\r\n    idGroup,\r\n    layersQueryFormat,\r\n    catalog\r\n  ) {\r\n    const groupPrepare = {\r\n      id: idGroup,\r\n      type: CatalogItemType.Group,\r\n      title: itemListIn.Title,\r\n      address: catalog.id,\r\n      externalProvider: catalog.externalProvider || false,\r\n      sortDirection: catalog.sortDirection,  // propagate sortDirection\r\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\r\n        if (layer.Layer !== undefined) {\r\n          // recursive, check next level\r\n          const idGroupItemNextLevel =\r\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\r\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\r\n            layer,\r\n            regexes,\r\n            idGroupItemNextLevel,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n\r\n          items.push(groupItem);\r\n        } else {\r\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\r\n            return items;\r\n          }\r\n\r\n          const layerItem: CatalogItemLayer<ImageLayerOptions> = this.prepareCatalogItemLayer(\r\n            layer,\r\n            idGroup,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n\r\n          items.push(layerItem);\r\n        }\r\n        return items;\r\n      }, [])\r\n    };\r\n    return groupPrepare;\r\n  }\r\n\r\n  private includeRecursiveItems(\r\n    catalog: Catalog,\r\n    itemListIn: any,\r\n    itemsPrepare: CatalogItem[],\r\n    loopLevel: number = 0\r\n  ) {\r\n    // Dig all levels until last level (layer object are not defined on last level)\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n    if (!itemListIn.Layer) {\r\n      return;\r\n    }\r\n\r\n    for (const item of itemListIn.Layer) {\r\n      if (item.Layer !== undefined) {\r\n        // recursive, check next level\r\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\r\n        continue;\r\n      }\r\n\r\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\r\n\r\n      // group(with layers) and layer(without group) level 1\r\n      if (loopLevel !== 0) {\r\n        // TODO: Slice that into multiple methods\r\n        // Define object of group layer\r\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\r\n        const groupItem = this.prepareCatalogItemGroup(\r\n          itemListIn,\r\n          regexes,\r\n          idGroupItem,\r\n          layersQueryFormat,\r\n          catalog\r\n        );\r\n\r\n        if (groupItem.items.length !== 0) {\r\n          itemsPrepare.push(groupItem);\r\n        }\r\n\r\n        // Break the group (don't add a group of layer for each of their layer!)\r\n        break;\r\n      } else {\r\n        // layer without group\r\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\r\n          const layerItem = this.prepareCatalogItemLayer(\r\n            item,\r\n            catalog.id,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n          itemsPrepare.push(layerItem);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private getWMTSItems(\r\n    catalog,\r\n    capabilities: { [key: string]: any }\r\n  ): CatalogItemLayer[] {\r\n    const layers = capabilities.Contents.Layer;\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n\r\n    if (\r\n      capabilities.ServiceIdentification &&\r\n      capabilities.ServiceIdentification.Abstract &&\r\n      capabilities.ServiceIdentification.Abstract.length) {\r\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\r\n    }\r\n\r\n    return layers\r\n      .map((layer: any) => {\r\n        let forcedTitle;\r\n        if (catalog.forcedProperties) {\r\n          for (const property of catalog.forcedProperties) {\r\n            if (layer.Title === property.layerName && property.title) {\r\n              forcedTitle = property.title;\r\n            }\r\n          }\r\n        }\r\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\r\n          return undefined;\r\n        }\r\n        const params = Object.assign({}, catalog.queryParams, {\r\n          version: '1.0.0'\r\n        });\r\n        const baseSourceOptions = {\r\n          type: 'wmts',\r\n          url: catalog.url,\r\n          crossOrigin: catalog.setCrossOriginAnonymous\r\n            ? 'anonymous'\r\n            : undefined,\r\n          layer: layer.Identifier,\r\n          matrixSet: catalog.matrixSet,\r\n          optionsFromCapabilities: true,\r\n          requestEncoding: catalog.requestEncoding || 'KVP',\r\n          style: 'default'\r\n        } as WMTSDataSourceOptions;\r\n        const sourceOptions = Object.assign(\r\n          {},\r\n          baseSourceOptions,\r\n          catalog.sourceOptions,\r\n          { params }\r\n        ) as WMTSDataSourceOptions;\r\n\r\n        return ObjectUtils.removeUndefined({\r\n          id: generateIdFromSourceOptions(sourceOptions),\r\n          type: CatalogItemType.Layer,\r\n          title: forcedTitle !== undefined ? forcedTitle : layer.Title,\r\n          address: catalog.id,\r\n          externalProvider: catalog.externalProvider,\r\n          options: {\r\n            sourceOptions,\r\n            metadata: {\r\n              url: undefined,\r\n              extern: undefined,\r\n              abstract: catalog.abstract,\r\n              type: baseSourceOptions.type\r\n            }\r\n          }\r\n        } as CatalogItem);\r\n      })\r\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\r\n  }\r\n\r\n  private getArcGISRESTItems(\r\n    catalog,\r\n    capabilities\r\n  ): CatalogItemLayer[] {\r\n    const layers = capabilities.layers.filter(layer => !layer.type || layer.type === 'Feature Layer');\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n\r\n    let abstract;\r\n    if (capabilities.serviceDescription && capabilities.serviceDescription.length) {\r\n      const regex = /(<([^>]+)>)/ig;\r\n      abstract = capabilities.serviceDescription.replace(regex, '');\r\n    }\r\n\r\n    return layers\r\n      .map((layer: any) => {\r\n        let forcedTitle;\r\n        if (catalog.forcedProperties) {\r\n          for (const property of catalog.forcedProperties) {\r\n            if (layer.name === property.layerName && property.title) {\r\n              forcedTitle = property.title;\r\n            }\r\n          }\r\n        }\r\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\r\n          return undefined;\r\n        }\r\n        const baseSourceOptions = {\r\n          type: TypeCatalog[catalog.type],\r\n          url: catalog.url,\r\n          crossOrigin: catalog.setCrossOriginAnonymous\r\n            ? 'anonymous'\r\n            : undefined,\r\n          layer: layer.id as string,\r\n          queryable: true,\r\n          queryFormat: 'esrijson',\r\n          matrixSet: catalog.matrixSet,\r\n          optionsFromCapabilities: true,\r\n          style: 'default'\r\n        } as ArcGISRestDataSourceOptions;\r\n        const sourceOptions = Object.assign(\r\n          {},\r\n          baseSourceOptions,\r\n          catalog.sourceOptions\r\n        ) as ArcGISRestDataSourceOptions;\r\n        return ObjectUtils.removeUndefined({\r\n          id: generateIdFromSourceOptions(sourceOptions),\r\n          type: CatalogItemType.Layer,\r\n          title: forcedTitle !== undefined ? forcedTitle : layer.name,\r\n          externalProvider: catalog.externalProvider,\r\n          address: catalog.id,\r\n          options: {\r\n            sourceOptions,\r\n            minResolution: getResolutionFromScale(layer.maxScale),\r\n            maxResolution: getResolutionFromScale(layer.minScale),\r\n            metadata: {\r\n              url: undefined,\r\n              extern: undefined,\r\n              abstract,\r\n              type: baseSourceOptions.type\r\n            },\r\n            title: forcedTitle !== undefined ? forcedTitle : layer.name\r\n          }\r\n        } as CatalogItem);\r\n      })\r\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\r\n  }\r\n\r\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\r\n    if (regexes.length === 0) {\r\n      return true;\r\n    }\r\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\r\n  }\r\n\r\n  private retrieveLayerInfoFormat(\r\n    layerNameFromCatalog: string,\r\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\r\n  ): QueryFormat {\r\n    const currentLayerInfoFormat = layersQueryFormat.find(\r\n      (f) => f.layer === layerNameFromCatalog\r\n    );\r\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\r\n    let queryFormat: QueryFormat;\r\n    if (currentLayerInfoFormat) {\r\n      queryFormat = currentLayerInfoFormat.queryFormat;\r\n    } else if (baseInfoFormat) {\r\n      queryFormat = baseInfoFormat.queryFormat;\r\n    }\r\n    return queryFormat;\r\n  }\r\n\r\n  private findCatalogInfoFormat(\r\n    catalog: Catalog\r\n  ): { layer: string; queryFormat: QueryFormat }[] {\r\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\r\n    if (!catalog.queryFormat) {\r\n      return layersQueryFormat;\r\n    }\r\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\r\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\r\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\r\n          if (\r\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\r\n          ) {\r\n            layersQueryFormat.push({\r\n              layer: layerName,\r\n              queryFormat: configuredInfoFormat as QueryFormat\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        if (\r\n          !layersQueryFormat.find(\r\n            (specific) =>\r\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\r\n          )\r\n        ) {\r\n          layersQueryFormat.push({\r\n            layer: catalog.queryFormat[configuredInfoFormat],\r\n            queryFormat: configuredInfoFormat as QueryFormat\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return layersQueryFormat;\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\r\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\r\n    <ng-container *ngIf=\"isGroup(item)\">\r\n      <igo-catalog-browser-group\r\n        [catalog]=\"catalog\"\r\n        [group]=\"item\"\r\n        [state]=\"store.state\"\r\n        [resolution]=\"resolution$ | async\"\r\n        [catalogAllowLegend]=\"catalogAllowLegend\"\r\n        [collapsed]=\"(store.count === 1) ? false : true\"\r\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\r\n        (addedChange)=\"onGroupAddedChange($event)\"\r\n        (layerAddedChange)=\"onLayerAddedChange($event)\">\r\n      </igo-catalog-browser-group>\r\n    </ng-container>\r\n\r\n    <ng-container *ngIf=\"isLayer(item)\">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]=\"item\"\r\n        [resolution]=\"resolution$ | async\"\r\n        [catalogAllowLegend]=\"catalogAllowLegend\"\r\n        [added]=\"store.state.get(item).added\"\r\n        (addedChange)=\"onLayerAddedChange($event)\">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</igo-list>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { zip, BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { IgoMap } from '../../map';\r\n\r\nimport {\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogItemLayer,\r\n  CatalogItemGroup,\r\n  CatalogItemState,\r\n  CatalogItemType\r\n} from '../shared';\r\n\r\n/**\r\n * Component to browse a catalog's groups and layers and display them on a map.\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser',\r\n  templateUrl: './catalog-browser.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Catalog items store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<CatalogItem>;\r\n\r\n // private resolution$$: Subscription;\r\n\r\n  get resolution$(): BehaviorSubject<number> { return this.map.viewController.resolution$; }\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Store holding the catalog's items\r\n   */\r\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Whether a group can be toggled when it's collapsed\r\n   */\r\n  @Input() toggleCollapsedGroup: boolean = true;\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    const currentItems = this.map.layers.map((layer: Layer) => {\r\n      return {\r\n        id: layer.options.source.id,\r\n        title: layer.title,\r\n        type: CatalogItemType.Layer\r\n      };\r\n    });\r\n    this.store.state.updateMany(currentItems, { added: true }, true);\r\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\r\n      this.store.view.sort({\r\n        direction: this.catalog.sortDirection,\r\n        valueAccessor: (item: CatalogItem) => item.title\r\n      });\r\n    }\r\n\r\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\r\n    this.catalogAllowLegend = catalogShowLegend ? catalogShowLegend : this.catalogAllowLegend;\r\n\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isGroup(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Group;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isLayer(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Layer;\r\n  }\r\n\r\n  /**\r\n   * When a layer is added or removed, add or remove it from the map\r\n   * @internal\r\n   * @param event Layer added event\r\n   */\r\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\r\n    const layer = event.layer;\r\n    this.store.state.update(layer, { added: event.added }, false);\r\n    event.added ? this.addLayerToMap(layer) : this.removeLayerFromMap(layer);\r\n  }\r\n\r\n  /**\r\n   * When a froup is added or removed, add or remove it from the map\r\n   * @internal\r\n   * @param event Group added event\r\n   */\r\n  onGroupAddedChange(event: { added: boolean; group: CatalogItemGroup }) {\r\n    const group = event.group;\r\n    this.store.state.update(group, { added: event.added }, false);\r\n    event.added ? this.addGroupToMap(group) : this.removeGroupFromMap(group);\r\n  }\r\n\r\n  /**\r\n   * Add layer to map\r\n   * @param layer Catalog layer\r\n   */\r\n  private addLayerToMap(layer: CatalogItemLayer) {\r\n    this.addLayersToMap([layer]);\r\n  }\r\n\r\n  /**\r\n   * Remove layer from map\r\n   * @param layer Catalog layer\r\n   */\r\n  private removeLayerFromMap(layer: CatalogItemLayer) {\r\n    this.removeLayersFromMap([layer]);\r\n  }\r\n\r\n  /**\r\n   * Add multiple layers to map\r\n   * @param layers Catalog layers\r\n   */\r\n  private addLayersToMap(layers: CatalogItemLayer[]) {\r\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\r\n      if (layer.options.sourceOptions.optionsFromApi === undefined) {\r\n        layer.options.sourceOptions.optionsFromApi = true;\r\n      }\r\n      return this.layerService.createAsyncLayer(layer.options);\r\n    });\r\n\r\n    zip(...layers$).subscribe((oLayers: Layer[]) => {\r\n      this.store.state.updateMany(layers, { added: true });\r\n      this.map.addLayers(oLayers);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove multiple layers from map\r\n   * @param layers Catalog layers\r\n   */\r\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\r\n    layers.forEach((layer: CatalogItemLayer) => {\r\n      this.store.state.update(layer, { added: false });\r\n      if (layer.options.baseLayer === true) {\r\n        const oLayer = this.map.getLayerById(layer.options.id);\r\n        if (oLayer !== undefined) {\r\n          this.map.removeLayer(oLayer);\r\n        }\r\n      } else {\r\n        const oLayer = this.map.getLayerById(layer.id);\r\n        if (oLayer !== undefined) {\r\n          this.map.removeLayer(oLayer);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sort the layers by title. asc or desc.\r\n   * @internal\r\n   */\r\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\r\n    const returnItem = items.sort((a, b) => {\r\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n\r\n      if (titleA < titleB) {\r\n        return -1;\r\n      }\r\n      if (titleA > titleB) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n    switch (direction) {\r\n      case 'asc':\r\n        return returnItem;\r\n      case 'desc':\r\n        return returnItem.reverse();\r\n      default:\r\n        return items;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add all the layers of a group to map\r\n   * @param group Catalog group\r\n   */\r\n  private addGroupToMap(group: CatalogItemGroup) {\r\n    let layers = group.items.filter((item: CatalogItem) => {\r\n      const added = this.store.state.get(item).added || false;\r\n      return this.isLayer(item) && added === false;\r\n    });\r\n    if (group.sortDirection !== undefined) {\r\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\r\n    }\r\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[]);\r\n  }\r\n\r\n  /**\r\n   * Remove all the layers of a group from map\r\n   * @param group Catalog group\r\n   */\r\n  private removeGroupFromMap(group: CatalogItemGroup) {\r\n    const layers = group.items.filter((item: CatalogItem) => {\r\n      const added = this.store.state.get(item).added || false;\r\n      return this.isLayer(item) && added === true;\r\n    });\r\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\r\n  }\r\n}\r\n","<ng-container *ngIf=\"legendItems$ | async as items\">\r\n  <ng-container *ngIf=\"items.length; else noItems\">\r\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\r\n      <div *ngIf=\"getLegend; else noItems\">\r\n        <mat-list-item *ngIf=\"item.title\">\r\n          <mat-icon\r\n            id=\"legend-toggle\"\r\n            class=\"igo-chevron\"\r\n            mat-list-avatar\r\n            igoCollapse\r\n            [target]=\"legend\"\r\n            [collapsed]=\"(item.collapsed)\"\r\n            (toggle)=\"toggleLegendItem($event, item)\"\r\n            svgIcon=\"chevron-up\">\r\n          </mat-icon>\r\n          <h4 matLine>{{computeItemTitle(item) | async}} </h4>\r\n        </mat-list-item>\r\n        <div #legend class=\"igo-layer-legend\" [ngClass]=\"{'with-title': item.title}\">\r\n          <div *ngIf=\"currentStyle !== undefined\">\r\n              <mat-form-field>\r\n                <mat-select tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n                  [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" [(ngModel)]=\"currentStyle\"\r\n                  (selectionChange)=\"onChangeStyle()\">\r\n                  <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{style.title}}</mat-option>\r\n                </mat-select>\r\n            </mat-form-field>\r\n          </div>\r\n          <div *ngIf=\"!(item.collapsed)\">\r\n            <div *ngIf=\"item.url\">\r\n              <img #renderedLegend id=\"{{item.title}}\" (load)=\"onLoadImage(item.title)\"\r\n                src=\"{{legendGraphic}}\"\r\n                alt=\"{{'igo.geo.layer.legend.loadingLegendText' | translate}}\">\r\n              <small *ngIf=\"imagesHeight[item.title]<16\">\r\n                  {{'igo.geo.layer.legend.noLegendScale' | translate}}\r\n              </small>\r\n            </div>\r\n            <div\r\n              [ngStyle]=\"item.style\"\r\n              [innerHTML]=\"item.html\"\r\n              *ngIf=\"item.html\">\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ng-container>\r\n  </ng-container>\r\n\r\n  <ng-template #noItems>\r\n    <small>\r\n      {{'igo.geo.layer.legend.noLegendText' | translate}}\r\n    </small>\r\n  </ng-template>\r\n\r\n</ng-container>\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Component, Input, OnInit, OnDestroy, ChangeDetectionStrategy, ViewChildren, ElementRef, ChangeDetectorRef } from '@angular/core';\r\nimport type { QueryList } from '@angular/core';\r\n\r\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\r\n\r\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { Layer, ItemStyleOptions } from '../shared/layers';\r\nimport { LegendMapViewOptions } from '../shared/layers/layer.interface';\r\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\r\nimport { catchError, map } from 'rxjs/operators';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { WMSDataSourceOptions } from '../../datasource';\r\nimport { SecureImagePipe } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend',\r\n  templateUrl: './layer-legend.component.html',\r\n  styleUrls: ['./layer-legend.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendComponent implements OnInit, OnDestroy {\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  /**\r\n   * Observable of the legend items\r\n   */\r\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * Subscription to the map's resolution\r\n   */\r\n  private state$$: Subscription;\r\n\r\n  /**\r\n   * The available styles\r\n   */\r\n  public styles;\r\n\r\n  /**\r\n   * The style used to make the legend\r\n   */\r\n  public currentStyle;\r\n\r\n  /**\r\n   * The scale used to make the legend\r\n   */\r\n  private scale: number = undefined;\r\n\r\n  /**\r\n   * The extent used to make the legend\r\n   */\r\n  private view: LegendMapViewOptions  = undefined;\r\n  /**\r\n   * Get list of images display\r\n   */\r\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\r\n\r\n  /**\r\n   * List of size of images displayed\r\n   */\r\n  public imagesHeight: { [srcKey: string]: number } = {};\r\n\r\n  /**\r\n   * Layer\r\n   */\r\n  @Input() layer: Layer;\r\n\r\n  /**\r\n   * if getLegendGraphic is authorized\r\n   */\r\n  public getLegend = true;\r\n\r\n  /**\r\n   * activeLegend\r\n   */\r\n  public legendGraphic: string;\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    private languageService: LanguageService,\r\n    private http: HttpClient,\r\n    private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * On init, subscribe to the map's resolution and update the legend accordingly\r\n   */\r\n  ngOnInit() {\r\n    let lastlLegend = this.layer.legend;\r\n    this.styles = this.listStyles();\r\n    const sourceOptions = this.layer.options.source.options as any;\r\n    if (\r\n      sourceOptions &&\r\n      sourceOptions.params &&\r\n      sourceOptions.params.STYLES) {\r\n      // if a styles is provided into the layers wms params\r\n      this.currentStyle = this.styles.find(style => style.name === sourceOptions.params.STYLES).name;\r\n    } else if (!this.layer.legend) {\r\n      // if no legend is manually provided\r\n      if (this.styles && this.styles.length > 1) {\r\n        this.currentStyle = this.styles[0].name;\r\n      }\r\n    } else if (this.styles && this.styles.length > 1) {\r\n      this.currentStyle = lastlLegend[0].currentStyle;\r\n    }\r\n    if ( typeof this.layer.options.legendOptions !== 'undefined' && this.layer.options.legendOptions.display === false) {\r\n      lastlLegend = [];\r\n    } else {\r\n      lastlLegend = this.layer.dataSource.getLegend(this.currentStyle, this.view);\r\n    }\r\n\r\n    if (this.updateLegendOnResolutionChange === true || (sourceOptions as WMSDataSourceOptions).contentDependentLegend) {\r\n      const state$ = this.layer.map.viewController.state$;\r\n      this.state$$ = state$\r\n      .subscribe(() => this.onViewControllerStateChange());\r\n    } else if (lastlLegend && lastlLegend.length !== 0) {\r\n      this.legendItems$.next(lastlLegend);\r\n      for (const legend of lastlLegend) {\r\n        this.getLegendGraphic(legend);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On destroy, unsubscribe to the map's view state\r\n   */\r\n  ngOnDestroy() {\r\n    if (this.state$$ !== undefined) {\r\n      this.state$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  getLegendGraphic(item: Legend) {\r\n    const secureIMG = new SecureImagePipe(this.http);\r\n    secureIMG.transform(item.url).pipe(\r\n      catchError((err) => {\r\n        if (err.error) {\r\n          err.error.caught = true;\r\n          this.getLegend = false;\r\n          this.cdRef.detectChanges();\r\n          return err;\r\n        }\r\n      })\r\n    ).subscribe((legend: string) => {\r\n      this.legendGraphic = legend;\r\n      this.cdRef.detectChanges();\r\n    });\r\n  }\r\n\r\n  toggleLegendItem(collapsed: boolean, item: Legend) {\r\n    item.collapsed = collapsed;\r\n  }\r\n\r\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\r\n    const outLegends: Legend[] = newLegends;\r\n    const lastLegends = this.layer.legend;\r\n    for (let i = 0; i < lastLegends.length; i++) {\r\n      outLegends[i].collapsed = lastLegends[i].collapsed;\r\n   }\r\n    return outLegends;\r\n  }\r\n\r\n  computeItemTitle(layerLegend): Observable<string> {\r\n    const layerOptions = this.layer.dataSource.options as any;\r\n    if (layerOptions.type !== 'wms') {\r\n      return of(layerLegend.title);\r\n    }\r\n\r\n    const layers = layerOptions.params.LAYERS.split(',');\r\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\r\n    localLayerOptions.params.LAYERS = layers.find(layer => layer === layerLegend.title);\r\n    return this.capabilitiesService\r\n      .getWMSOptions(localLayerOptions)\r\n      .pipe(map(wmsDataSourceOptions => {\r\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\r\n      }));\r\n  }\r\n\r\n  /**\r\n   * On resolution change, compute the effective scale level and update the\r\n   * legend accordingly.\r\n   * @param resolution Map resolution\r\n   */\r\n  private onViewControllerStateChange() {\r\n    this.view = {\r\n      resolution: this.layer.map.viewController.getResolution(),\r\n      extent: this.layer.map.viewController.getExtent(),\r\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\r\n      scale: this.layer.map.viewController.getScale(),\r\n      size: this.layer.map.ol.getSize()\r\n    } as LegendMapViewOptions;\r\n    this.updateLegend();\r\n  }\r\n\r\n  /**\r\n   * Update the legend with scale level and style define\r\n   */\r\n  private updateLegend() {\r\n    let legendItems = this.layer.dataSource.getLegend(this.currentStyle, this.view);\r\n    if (this.layer.legend && this.layer.legend.length > 1) { legendItems = this.transfertToggleLegendItem(legendItems); }\r\n    this.layer.legend = legendItems;\r\n\r\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\r\n      return;\r\n    }\r\n    this.legendItems$.next(legendItems);\r\n    for (const legend of this.legendItems$.value) {\r\n      this.getLegendGraphic(legend);\r\n    }\r\n  }\r\n\r\n  private listStyles() {\r\n    const layerOptions = this.layer.options;\r\n    if (layerOptions && layerOptions.legendOptions) {\r\n      const translate = this.languageService.translate;\r\n      const title = translate.instant('igo.geo.layer.legend.default');\r\n      let stylesAvailable =  [{ name: '', title } as ItemStyleOptions];\r\n      if (layerOptions.legendOptions.stylesAvailable) {\r\n        stylesAvailable = stylesAvailable.concat(layerOptions.legendOptions.stylesAvailable.filter(sA => (\r\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'default' &&\r\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'defaut')));\r\n      }\r\n      stylesAvailable.filter(sa => !sa.title).map((sa) => sa.title = sa.name);\r\n      stylesAvailable.map(s => s.title = s.title.charAt(0).toUpperCase() + s.title.slice(1).replace(/_/g, ' '));\r\n      return stylesAvailable;\r\n    }\r\n    return ;\r\n  }\r\n\r\n  onChangeStyle() {\r\n    this.updateLegend();\r\n    let STYLES = '';\r\n    console.log(this.layer.dataSource.ol);\r\n    // this.layer.dataSource.ol.getParams().LAYERS.split(',').map(layer =>\r\n    //   STYLES += this.currentStyle + ','\r\n    // );\r\n    STYLES = STYLES.slice(0, -1);\r\n    // this.layer.dataSource.ol.updateParams({STYLES});\r\n  }\r\n\r\n  onLoadImage(id: string) {\r\n    let elemRef: HTMLImageElement;\r\n    if (this.renderedLegends.length === 1) {\r\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\r\n    } else {\r\n      elemRef = this.renderedLegends.find(renderedLegend => renderedLegend.nativeElement.id === id).nativeElement as HTMLImageElement;\r\n    }\r\n    this.imagesHeight[id] = elemRef.height;\r\n  }\r\n}\r\n","<mat-list-item>\r\n  <mat-icon *ngIf=\"haveGroup()\" mat-list-avatar svgIcon=\"blank\"></mat-icon>\r\n  <h4 mat-line matTooltipShowDelay=\"500\" [ngClass]=\"(catalogAllowLegend)?'igo-cataloglayer-title':''\" (click)=\"askForLegend($event)\" [matTooltip]=\"computeTitleTooltip()\">{{title}}</h4>\r\n\r\n    <button *ngIf=\"layer.externalProvider\"\r\n      disabled=\"true\"\r\n      mat-icon-button>\r\n    <mat-icon\r\n      class=\"igo-cataloglayer-external-icon\"\r\n      *ngIf=\"layer.externalProvider\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\r\n      color=\"primary\"\r\n      (click)=\"$event.stopPropagation()\"\r\n      svgIcon=\"earth-arrow-right\">\r\n    </mat-icon>\r\n  </button>\r\n  <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\r\n\r\n  <button\r\n    (mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"computeTooltip() | translate\"\r\n    [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\r\n    (click)=\"onToggleClick($event)\">\r\n    <mat-icon\r\n       matBadge\r\n       igoMatBadgeIcon=\"eye-off\"\r\n       igoMatBadgeInverseColor=\"true\"\r\n       [matBadgeHidden]=\"isInResolutionsRange()\"\r\n       matBadgeDisabled=\"true\"\r\n       matBadgeSize=\"small\"\r\n       matBadgePosition=\"after\"\r\n       [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\r\n    </mat-icon>\r\n  </button>\r\n\r\n</mat-list-item>\r\n\r\n<div #legend class=\"igo-cataloglayer-legend-container\">\r\n  <igo-layer-legend\r\n    *ngIf=\"(layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\"\r\n    [layer]=\"igoLayer$ | async\">\r\n  </igo-layer-legend>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\r\n\r\nimport { CatalogItemLayer } from '../shared';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { first } from 'rxjs/operators';\r\nimport { Layer, TooltipType } from '../../layer/shared/layers';\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\n\r\n/**\r\n * Catalog browser layer item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser-layer',\r\n  templateUrl: './catalog-browser-layer.component.html',\r\n  styleUrls: ['./catalog-browser-layer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\r\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private isPreview$$: Subscription;\r\n  private lastTimeoutRequest;\r\n\r\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\r\n\r\n  private mouseInsideAdd: boolean = false;\r\n\r\n  @Input() resolution: number;\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Catalog layer\r\n   */\r\n  @Input() layer: CatalogItemLayer;\r\n\r\n  /**\r\n   * Whether the layer is already added to the map\r\n   */\r\n  @Input() added = false;\r\n\r\n  /**\r\n   * Event emitted when the add/remove button is clicked\r\n   */\r\n  @Output() addedChange = new EventEmitter<{\r\n    added: boolean;\r\n    layer: CatalogItemLayer;\r\n  }>();\r\n\r\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.layer);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.layer) || 'layers';\r\n  }\r\n\r\n  constructor(private layerService: LayerService ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.isInResolutionsRange();\r\n    this.isPreview$$ = this.isPreview$.subscribe(value => this.addedLayerIsPreview.emit(value));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.isPreview$$.unsubscribe();\r\n  }\r\n\r\n  computeTitleTooltip(): string {\r\n      const layerOptions = this.layer.options;\r\n      if (!layerOptions.tooltip) {\r\n        return getEntityTitle(this.layer);\r\n      }\r\n      const layerTooltip = layerOptions.tooltip;\r\n      const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n      switch (layerOptions.tooltip.type) {\r\n        case TooltipType.TITLE:\r\n          return this.layer.title;\r\n        case TooltipType.ABSTRACT:\r\n          if (layerMetadata && layerMetadata.abstract) {\r\n            return layerMetadata.abstract;\r\n          } else {\r\n            return this.layer.title;\r\n          }\r\n        case TooltipType.CUSTOM:\r\n          if (layerTooltip && layerTooltip.text) {\r\n            return layerTooltip.text;\r\n          } else {\r\n            return this.layer.title;\r\n          }\r\n        default:\r\n          return this.layer.title;\r\n      }\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    this.onToggleClick(event);\r\n  }\r\n\r\n  askForLegend(event) {\r\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\r\n    this.layerService.createAsyncLayer(this.layer.options).pipe(first())\r\n    .subscribe(layer => this.igoLayer$.next(layer));\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(event) {\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'click':\r\n        if (!this.isPreview$.value) {\r\n          if (this.added) {\r\n            this.remove();\r\n          } else {\r\n            this.add();\r\n          }\r\n        }\r\n        this.isPreview$.next(false);\r\n        break;\r\n      case 'mouseenter':\r\n        if (!this.isPreview$.value && !this.added) {\r\n          this.lastTimeoutRequest = setTimeout(() => {\r\n            this.add();\r\n            this.isPreview$.next(true);\r\n          }, 500);\r\n        }\r\n        this.mouseInsideAdd = true;\r\n        break;\r\n      case 'mouseleave':\r\n        if (this.isPreview$.value) {\r\n          this.remove();\r\n          this.isPreview$.next(false);\r\n        }\r\n        this.mouseInsideAdd = false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private add() {\r\n    if (!this.added) {\r\n      this.added = true;\r\n      this.addedChange.emit({ added: true, layer: this.layer });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = false\r\n   */\r\n  private remove() {\r\n    if (this.added) {\r\n      this.added = false;\r\n      this.addedChange.emit({ added: false, layer: this.layer });\r\n    }\r\n  }\r\n\r\n  haveGroup(): boolean {\r\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\r\n  }\r\n\r\n  isInResolutionsRange(): boolean {\r\n    const minResolution = this.layer.options.minResolution || 0;\r\n    const maxResolution = this.layer.options.maxResolution || Infinity;\r\n    this.inRange$.next(\r\n      this.resolution >= minResolution && this.resolution <= maxResolution\r\n    );\r\n    return this.inRange$.value;\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    if (this.added) {\r\n      return this.isPreview$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.removeFromMap'\r\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\r\n    } else {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : 'igo.geo.catalog.layer.addToMapOutRange';\r\n    }\r\n  }\r\n}\r\n","<mat-list-item>\r\n  <mat-icon\r\n    mat-list-avatar\r\n    svgIcon=\"chevron-up\"\r\n    igoCollapse\r\n    class=\"igo-chevron\"\r\n    [target]=\"items\"\r\n    [collapsed]=\"collapsed\"\r\n    (toggle)=\"onToggleCollapsed($event)\">\r\n  </mat-icon>\r\n\r\n  <h4 class=\"igo-catalog-group-title\" id=\"catalog-group-title\" mat-line matTooltipShowDelay=\"500\" [matTooltip]=\"title\" (click)=\"onTitleClick()\">{{title}}</h4>\r\n\r\n  <button *ngIf=\"group.externalProvider\"\r\n    disabled=\"true\"\r\n    mat-icon-button>\r\n    <mat-icon\r\n      class=\"igo-cataloggroup-external-icon\"\r\n      *ngIf=\"group.externalProvider\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\r\n      color=\"primary\"\r\n      (click)=\"$event.stopPropagation()\"\r\n      svgIcon=\"earth-arrow-right\">\r\n    </mat-icon>\r\n  </button>\r\n\r\n  <ng-container *ngIf=\"(added$ | async) && !(preview$ | async); else notadded\">\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\r\n      color=\"warn\"\r\n      [disabled]=\"disabled$ | async\"\r\n      (click)=\"onToggleClick()\">\r\n      <mat-icon svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n  </ng-container>\r\n\r\n  <ng-template #notadded>\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\r\n      [disabled]=\"disabled$ | async\"\r\n      (click)=\"onToggleClick()\">\r\n      <mat-icon svgIcon=\"plus\"></mat-icon>\r\n    </button>\r\n  </ng-template>\r\n</mat-list-item>\r\n\r\n<div #items>\r\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\r\n    <ng-container *ngIf=\"isGroup(item)\">\r\n      <!-- todo: add display ans manage CatalogItemGroup -->\r\n    </ng-container>\r\n    <ng-container *ngIf=\"isLayer(item)\">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]=\"item\"\r\n        [resolution]=\"resolution\"\r\n        [catalogAllowLegend]=\"catalogAllowLegend\"\r\n        [added]=\"state.get(item).added\"\r\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\r\n        (addedChange)=\"onLayerAddedChange($event)\">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport type { EntityStateManager } from '@igo2/common';\r\n\r\nimport {\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogItemGroup,\r\n  CatalogItemLayer,\r\n  CatalogItemState,\r\n  CatalogItemType\r\n} from '../shared';\r\n\r\n/**\r\n * Catalog browser group item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser-group',\r\n  templateUrl: './catalog-browser-group.component.html',\r\n  styleUrls: ['./catalog-browser-group.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\r\n\r\n  /**\r\n   * Group's items store\r\n   * @internal\r\n   */\r\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\r\n\r\n  /**\r\n   * Whether all the layers of the group are added\r\n   * @internal\r\n   */\r\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  /**\r\n   * Whether the toggle button is disabled\r\n   * @internal\r\n   */\r\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Catalog group\r\n   */\r\n  @Input() group: CatalogItemGroup;\r\n\r\n  /**\r\n   * Whether the group is collapsed\r\n   */\r\n  @Input() collapsed: boolean = true;\r\n\r\n  @Input() resolution: number;\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Whether the group can be toggled when it's collapsed\r\n   */\r\n  @Input() toggleCollapsed: boolean = true;\r\n\r\n  /**\r\n   * Parent catalog's items store state. Groups share a unique\r\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\r\n   * Sharing a unique state would also allow us to expand this component to allow\r\n   * the selection of a layer while unselecting any layer already selected in another group.\r\n   * This could be useful to display some layer info before adding it, for example.\r\n   */\r\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\r\n\r\n  /**\r\n   * Event emitted when the add/remove button of the group is clicked\r\n   */\r\n  @Output() addedChange = new EventEmitter<{\r\n    added: boolean;\r\n    group: CatalogItemGroup;\r\n  }>();\r\n\r\n  /**\r\n   * Event emitted when the add/remove button of a layer is clicked\r\n   */\r\n  @Output() layerAddedChange = new EventEmitter<{\r\n    added: boolean;\r\n    layer: CatalogItemLayer;\r\n  }>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return this.group.title;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.store.load(this.group.items);\r\n    this.evaluateAdded();\r\n    this.evaluateDisabled(this.collapsed);\r\n    if (this.group.sortDirection !== undefined) {\r\n      this.store.view.sort({\r\n        direction: this.group.sortDirection,\r\n        valueAccessor: (item: CatalogItem) => item.title\r\n        });\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isGroup(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Group;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isLayer(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Layer;\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick() {\r\n    this.added$.value ? this.remove() : this.add();\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleCollapsed(collapsed: boolean) {\r\n    this.evaluateDisabled(collapsed);\r\n  }\r\n\r\n  /**\r\n   * When a layer is added or removed, evaluate if all the layers of the group\r\n   * are now added or removed. If so, consider that the group itself is added\r\n   * or removed.\r\n   * @internal\r\n   * @param event Layer added change event\r\n   */\r\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\r\n    this.layerAddedChange.emit(event);\r\n    this.tryToggleGroup(event);\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private add() {\r\n    this.added$.next(true);\r\n    this.addedChange.emit({\r\n      added: true,\r\n      group: this.group\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private remove() {\r\n    this.added$.next(false);\r\n    this.addedChange.emit({\r\n      added: false,\r\n      group: this.group\r\n    });\r\n  }\r\n\r\n  onLayerPreview(event) {\r\n    this.preview$.next(event);\r\n  }\r\n\r\n  /**\r\n   * If all the layers of the group added or removed, add or remove the group itself.\r\n   * @param event The last layer added change event to occur\r\n   */\r\n  private tryToggleGroup(event: { added: boolean; layer: CatalogItemLayer }) {\r\n    const added = event.added;\r\n    const layer = event.layer;\r\n\r\n    const layersAdded = this.store.view\r\n      .all()\r\n      .filter((item: CatalogItem) => item.id !== layer.id)\r\n      .map((item: CatalogItem) => this.state.get(item).added || false);\r\n\r\n    if (layersAdded.every(value => value === added)) {\r\n      added ? this.add() : this.remove();\r\n    } else if (this.added$.value === true) {\r\n      this.added$.next(false);\r\n    }\r\n  }\r\n\r\n  private evaluateAdded() {\r\n    const added = this.store.all().every((item: CatalogItem) => {\r\n      return (this.state.get(item).added || false) === true;\r\n    });\r\n    this.added$.next(added);\r\n  }\r\n\r\n  private evaluateDisabled(collapsed: boolean) {\r\n    let disabled = false;\r\n    if (this.toggleCollapsed === false) {\r\n      disabled = collapsed;\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n\r\n  onTitleClick() {\r\n    this.collapsed = !this.collapsed;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerListToolService {\r\n  public keyword: string;\r\n  public sortAlpha = false;\r\n  public onlyVisible = false;\r\n  public onlyInRange = false;\r\n  public keywordInitialized = false;\r\n  public sortedAlphaInitialized = false;\r\n  public onlyVisibleInitialized = false;\r\n  public onlyInRangeInitialized = false;\r\n\r\n  constructor() {}\r\n\r\n}\r\n","<mat-list-item class= \"igo-layer-list-item\">\r\n  <mat-checkbox *ngIf=\"selectionMode\"\r\n    class=\"layerCheck\"\r\n    mat-list-icon\r\n    (change)=\"check()\"\r\n    [checked]=\"layerCheck\">\r\n  </mat-checkbox>\r\n  <h4 (click)=\"toggleLegendOnClick()\" matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\r\n\r\n  <button *ngIf=\"!selectionMode\"\r\n    mat-icon-button\r\n    [color]=\"layer.visible ? 'primary' : 'default'\"\r\n    collapsibleButton\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"layer.visible ?\r\n                  ('igo.geo.layer.hideLayer' | translate) :\r\n                  ('igo.geo.layer.showLayer' | translate)\"\r\n    (click)=\"toggleVisibility()\">\r\n    <mat-icon\r\n      matBadge=\"?\"\r\n      matBadgeColor=\"accent\"\r\n      matBadgeSize=\"small\"\r\n      matBadgePosition=\"after\"\r\n      [matBadgeHidden]=\"queryBadgeHidden$ | async\"\r\n      [ngClass]=\"{disabled: !(inResolutionRange$ | async)}\"\r\n      [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\">\r\n    </mat-icon>\r\n  </button>\r\n\r\n  <button *ngIf=\"selectionMode\" class=\"selection-eye\"\r\n  mat-icon-button\r\n  [color]=\"layer.visible ? 'primary' : 'default'\"\r\n  collapsibleButton\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"layer.visible ?\r\n                ('igo.geo.layer.hideLayer' | translate) :\r\n                ('igo.geo.layer.showLayer' | translate)\"\r\n  (click)=\"toggleVisibility()\">\r\n  <mat-icon\r\n    matBadge=\"?\"\r\n    matBadgeColor=\"accent\"\r\n    matBadgeSize=\"small\"\r\n    matBadgePosition=\"after\"\r\n    [matBadgeHidden]=\"queryBadgeHidden$ | async\"\r\n    [ngClass]=\"{disabled: !(inResolutionRange$ | async)}\"\r\n    [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\r\n  </mat-icon>\r\n</button>\r\n\r\n  <button *ngIf=\"!selectionMode\"\r\n    class=\"actions-button\"\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]= \"'igo.geo.layer.moreOptions' | translate\"\r\n    mat-icon-button\r\n    color=\"primary\"\r\n    (click)=\"toggleLayerTool()\">\r\n    <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n\r\n<div #legend class=\"igo-layer-legend-container\">\r\n  <igo-layer-legend\r\n    *ngIf=\"showLegend$ | async\"\r\n    [layer]=\"layer\"\r\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\r\n  </igo-layer-legend>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter,\r\n  Renderer2,\r\n  ElementRef,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { layerIsQueryable } from '../../query/shared/query.utils';\r\nimport { Layer, TooltipType } from '../shared/layers';\r\nimport { NetworkService, ConnectionState } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-layer-item',\r\n  templateUrl: './layer-item.component.html',\r\n  styleUrls: ['./layer-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerItemComponent implements OnInit, OnDestroy {\r\n  public focusedCls = 'igo-layer-item-focused';\r\n\r\n  @Input()\r\n  get activeLayer() {\r\n    return this._activeLayer;\r\n  }\r\n  set activeLayer(value) {\r\n    if (value && this.layer && value.id === this.layer.id && !this.selectionMode) {\r\n      this.layerTool$.next(true);\r\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n    } else {\r\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\r\n    }\r\n  }\r\n  private _activeLayer;\r\n\r\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  tooltipText: string;\r\n\r\n  state: ConnectionState;\r\n\r\n  @Input()\r\n  get selectAll() {\r\n    return this._selectAll;\r\n  }\r\n  set selectAll(value: boolean) {\r\n    this._selectAll = value;\r\n    if (value === true) {\r\n      this.layerCheck = true;\r\n    }\r\n  }\r\n  private _selectAll = false;\r\n\r\n  @Input() layerCheck;\r\n\r\n  private resolution$$: Subscription;\r\n  private network$$: Subscription;\r\n  private layers$$: Subscription;\r\n\r\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\r\n\r\n  @Input()\r\n  get layer() {\r\n    return this._layer;\r\n  }\r\n  set layer(value) {\r\n    this._layer = value;\r\n    this.layers$.next(value);\r\n  }\r\n  private _layer;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendIfVisible: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() orderable: boolean = true;\r\n\r\n  @Input() lowerDisabled: boolean = false;\r\n\r\n  @Input() raiseDisabled: boolean = false;\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Input() selectionMode;\r\n\r\n  @Input() changeDetection;\r\n\r\n  get opacity() {\r\n    return this.layer.opacity * 100;\r\n  }\r\n  set opacity(opacity: number) {\r\n    this.layer.opacity = opacity / 100;\r\n  }\r\n\r\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\r\n  @Output() checkbox = new EventEmitter<{\r\n    layer: Layer;\r\n    check: boolean;\r\n  }>();\r\n\r\n  constructor(\r\n    private networkService: NetworkService,\r\n    private renderer: Renderer2,\r\n    private elRef: ElementRef,\r\n    private cdRef: ChangeDetectorRef) {}\r\n\r\n  ngOnInit() {\r\n    if (\r\n      this.layer.visible &&\r\n      this.expandLegendIfVisible &&\r\n      this.layer.firstLoadComponent === true\r\n    ) {\r\n      this.layer.firstLoadComponent = false;\r\n      this.layer.legendCollapsed = false;\r\n    }\r\n    this.toggleLegend(this.layer.legendCollapsed);\r\n    this.updateQueryBadge();\r\n\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.onResolutionChange();\r\n    });\r\n    this.tooltipText = this.computeTooltip();\r\n\r\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\r\n      this.state = state;\r\n      this.onResolutionChange();\r\n    });\r\n\r\n    this.layers$$ = this.layers$.subscribe(() => {\r\n      if (this.layer && this.layer.options.active) {\r\n        this.layerTool$.next(true);\r\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n      }\r\n    });\r\n\r\n    if (this.changeDetection) {\r\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n    this.network$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    this.toggleLegend(this.showLegend$.value);\r\n  }\r\n\r\n  toggleVisibility() {\r\n    this.layer.visible = !this.layer.visible;\r\n    if (this.toggleLegendOnVisibilityChange) {\r\n      this.toggleLegend(!this.layer.visible);\r\n    }\r\n    this.updateQueryBadge();\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return this.layer.title;\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  private onResolutionChange() {\r\n    const inResolutionRange = this.layer.isInResolutionsRange;\r\n    if (\r\n      inResolutionRange === false &&\r\n      this.updateLegendOnResolutionChange === true\r\n    ) {\r\n      this.toggleLegend(true);\r\n    }\r\n    this.inResolutionRange$.next(inResolutionRange);\r\n  }\r\n\r\n  private updateQueryBadge() {\r\n    const hidden =\r\n      this.queryBadge === false ||\r\n      this.layer.visible === false ||\r\n      !layerIsQueryable(this.layer);\r\n    this.queryBadgeHidden$.next(hidden);\r\n  }\r\n\r\n  toggleLayerTool() {\r\n    this.layerTool$.next(!this.layerTool$.getValue());\r\n    if (this.layerTool$.getValue() === true) {\r\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n    } else {\r\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\r\n    }\r\n    this.action.emit(this.layer);\r\n  }\r\n\r\n  public check() {\r\n    this.layerCheck = !this.layerCheck;\r\n    this.checkbox.emit({layer: this.layer, check: this.layerCheck});\r\n  }\r\n}\r\n","export enum LayerListControlsEnum {\r\n  always = 'always',\r\n  never = 'never',\r\n  default = 'default'\r\n}\r\nexport enum LayerListSelectVisibleEnum {\r\n  ALL_VISIBLE = 'ALL_VISIBLE',\r\n  ALL_HIDDEN = 'ALL_HIDDEN',\r\n  MIXED = 'MIXED',\r\n  NULL = 'NULL'\r\n}\r\n\r\nexport enum LayerListDisplacement {\r\n  Raise = 'raise',\r\n  Lower = 'lower',\r\n}\r\n","<mat-list>\r\n  <igo-layer-list-tool *ngIf=\"showToolbar$ | async\"\r\n    floatLabel=\"auto\"\r\n    [layersAreAllVisible]=\"layersAreAllVisible\"\r\n    [term]=\"layerFilterAndSortOptions.keyword\"\r\n    [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\r\n    [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\r\n    (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\r\n    (selection)=\"toggleSelectionMode($event)\">\r\n  </igo-layer-list-tool>\r\n</mat-list>\r\n\r\n<mat-list-item *ngIf=\"selection\">\r\n  <mat-checkbox\r\n    class=\"select-all-checkbox mat-subheading-2\"\r\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\r\n    (change)=\"selectAll()\"\r\n    [checked]=\"selectAllCheck\"\r\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"> {{selectAllCheck ? ('igo.geo.layer.deselectAll' | translate) : ('igo.geo.layer.selectAll' | translate)}}\r\n  </mat-checkbox>\r\n</mat-list-item>\r\n<mat-divider></mat-divider>\r\n\r\n<igo-list #igoList [ngClass]=\"{'igo-list-tools-multi': selection, 'igo-list-tools-single': (layerTool && !selection), 'igo-list-no-tools': (!layerTool && !selection)}\" [navigation]=\"false\" [selection]=\"false\">\r\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\r\n    <igo-layer-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\r\n      igoListItem\r\n      [layer]=\"layer\"\r\n      [activeLayer]=\"activeLayer\"\r\n      [orderable]=\"orderable && !layer.baseLayer\"\r\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\r\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\r\n      [queryBadge]=\"queryBadge\"\r\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\r\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\r\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\r\n      [selectionMode]=\"selection\"\r\n      [selectAll]=\"selectAllCheck\"\r\n      [layerCheck]=\"layer.options.check\"\r\n      [changeDetection]=\"layerItemChangeDetection$\"\r\n      (action)=\"toggleLayerTool($event)\"\r\n      (checkbox)=\"layersCheck($event)\">\r\n    </igo-layer-item>\r\n  </ng-template>\r\n</igo-list>\r\n\r\n<igo-panel *ngIf=\"!selection && layerTool && activeLayer\" class=\"igo-layer-actions-container\" [title]=\"activeLayer.title\">\r\n  <div class=\"igo-layer-button-group\">\r\n    <button\r\n      *ngIf=\"isLayerRemovable(activeLayer)\"\r\n      class=\"delete-button\"\r\n      mat-icon-button\r\n      color=\"warn\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\r\n      (click)=\"removeLayers()\">\r\n      <mat-icon svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"down-button\"\r\n      mat-icon-button\r\n      color=\"primary\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\r\n      [disabled]=\"lowerDisabled\"\r\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Lower)\">\r\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabled\"\r\n                svgIcon=\"arrow-down\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"up-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\r\n      [disabled]=\"raiseDisabled\"\r\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Raise)\">\r\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabled\"\r\n                svgIcon=\"arrow-up\"></mat-icon>\r\n    </button>\r\n\r\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\r\n    <button\r\n      class=\"opacity-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matMenuTriggerFor]=\"opacityMenu\"\r\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\r\n      <mat-icon [matBadge]=\"badgeOpacity\" matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"opacity\"></mat-icon>\r\n    </button>\r\n\r\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\r\n      <div id=\"opacity-menu\">\r\n        <mat-slider\r\n          id=\"opacity-slider\"\r\n          color=\"primary\"\r\n          thumbLabel\r\n          tickInterval=\"5\"\r\n          step=\"5\"\r\n          [min]=\"0\"\r\n          [max]=\"100\"\r\n          [value]=\"opacity\"\r\n          (input)=\"changeOpacity($event)\"\r\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\r\n          (click) = \"$event.stopPropagation()\"\r\n          matTooltipShowDelay=\"500\"\r\n          tooltip-position=\"below\">\r\n        </mat-slider>\r\n      </div>\r\n    </mat-menu>\r\n\r\n    <button\r\n      *ngIf=\"activeLayerIsValid(activeLayer)\"\r\n      class=\"zoomLayer-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\r\n      (click)=\"zoomLayerExtents(activeLayer)\">\r\n      <mat-icon matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"magnify-scan\"></mat-icon>\r\n    </button>\r\n\r\n    <ng-container igoLayerItemToolbar\r\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\r\n      [ngTemplateOutletContext]=\"{layer: activeLayer}\">\r\n    </ng-container>\r\n\r\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\r\n  </div>\r\n</igo-panel>\r\n\r\n<igo-panel *ngIf=\"selection && layers.length > 0\" class=\"igo-layer-actions-container\" [title]=\"'igo.geo.layer.tools' | translate\">\r\n  <div class=\"actions-buttons-multi\">\r\n    <button\r\n      class=\"delete-button\"\r\n      mat-icon-button\r\n      color=\"warn\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [disabled]=\"layersChecked.length === 0\"\r\n      [matTooltip]=\"isAllLayersRemovable(layersChecked) ? ('igo.geo.layer.removeSelectedLayers' | translate) : 'igo.geo.layer.removeSelectedLayersRestriction' | translate\"\r\n      (click)=\"removeLayers(layersChecked)\">\r\n      <mat-icon [matBadge]=\"'!'\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\r\n                svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"eye-button\"\r\n      mat-icon-button\r\n      color=\"primary\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [disabled]=\"layersChecked.length === 0\"\r\n      [matTooltip]=\"statusSelectedLayersCheck === 'ALL_HIDDEN' ? ('igo.geo.layer.showSelectedLayers' | translate) : ('igo.geo.layer.hideSelectedLayers' | translate)\"\r\n      (click)=\"toggleVisibility(layersChecked)\">\r\n      <mat-icon\t[svgIcon]=\"(statusSelectedLayersCheck === 'ALL_HIDDEN') ? 'eye-off' : 'eye'\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"down-button\"\r\n      mat-icon-button\r\n      color=\"primary\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\r\n      [disabled]=\"lowerDisabledSelection\"\r\n      (click)=\"lowerLayers(layersChecked)\">\r\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabledSelection\"\r\n                svgIcon=\"arrow-down\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"up-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\r\n      [disabled]=\"raiseDisabledSelection\"\r\n      (click)=\"raiseLayers(layersChecked)\">\r\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabledSelection\"\r\n                svgIcon=\"arrow-up\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"opacity-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [disabled]=\"layersChecked.length === 0\"\r\n      [matMenuTriggerFor]=\"opacityMenu\"\r\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\r\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\r\n    </button>\r\n\r\n    <mat-menu #opacityMenu=\"matMenu\"  class=\"mat-menu-opacity-slider\">\r\n      <div id=\"opacity-menu\">\r\n        <mat-slider *ngIf=\"layersChecked.length\"\r\n          id=\"opacity-slider\"\r\n          color=\"primary\"\r\n          thumbLabel\r\n          tickInterval=\"5\"\r\n          step=\"5\"\r\n          [min]=\"0\"\r\n          [max]=\"100\"\r\n          [(ngModel)]=\"checkOpacity\"\r\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\r\n          matTooltipShowDelay=\"500\"\r\n          tooltip-position=\"below\"\r\n          (click) = \"$event.stopPropagation()\">\r\n        </mat-slider>\r\n      </div>\r\n    </mat-menu>\r\n\r\n    <button\r\n      *ngIf=\"layersChecked.length !== 0 && activeLayersAreValid(layersChecked)\"\r\n      class=\"zoomLayer-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\r\n      (click)=\"zoomLayersExtents(layersChecked)\">\r\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\r\n    </button>\r\n  </div>\r\n</igo-panel>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ContentChild,\r\n  OnInit,\r\n  OnDestroy,\r\n  Output,\r\n  EventEmitter,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport type { TemplateRef } from '@angular/core';\r\n\r\nimport { FloatLabelType } from '@angular/material/form-field';\r\nimport { LayerListControlsEnum, LayerListDisplacement } from './layer-list.enum';\r\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\r\nimport {\r\n  BehaviorSubject,\r\n  ReplaySubject,\r\n  Subscription,\r\n  EMPTY,\r\n  timer\r\n} from 'rxjs';\r\nimport { debounce } from 'rxjs/operators';\r\nimport {\r\n  MetadataOptions,\r\n  MetadataLayerOptions\r\n} from '../../metadata/shared/metadata.interface';\r\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { LinkedProperties, LayersLink } from '../shared/layers/layer.interface';\r\nimport { MatSliderChange } from '@angular/material/slider';\r\nimport * as olextent from 'ol/extent';\r\n\r\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\r\n@Component({\r\n  selector: 'igo-layer-list',\r\n  templateUrl: './layer-list.component.html',\r\n  styleUrls: ['./layer-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerListComponent implements OnInit, OnDestroy {\r\n  orderable = true;\r\n  thresholdToFilterAndSort = 5;\r\n\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public layerTool: boolean;\r\n\r\n  public hideSelectedLayers: boolean = true;\r\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\r\n\r\n  layersChecked: Layer[] = [];\r\n  public selection: boolean;\r\n\r\n  private change$$: Subscription;\r\n  private layers$$: Subscription;\r\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\r\n\r\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\r\n  templateLayerToolbar: TemplateRef<any>;\r\n\r\n  @Input() layersAreAllVisible: boolean = true;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  set layers(value: Layer[]) {\r\n    this._layers = this.removeProblemLayerInList(value);\r\n    this.next();\r\n  }\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  private _layers: Layer[];\r\n\r\n  set activeLayer(value: Layer) {\r\n    this._activeLayer = value;\r\n    this.activeLayer$.next(value);\r\n  }\r\n  get activeLayer(): Layer {\r\n    return this._activeLayer;\r\n  }\r\n  private _activeLayer: Layer;\r\n\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\r\n\r\n  @Input() excludeBaseLayers: boolean = false;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\r\n\r\n  get keyword(): string {\r\n    return this._keyword;\r\n  }\r\n  set keyword(value: string) {\r\n    this._keyword = value;\r\n    this.next();\r\n  }\r\n  private _keyword = undefined;\r\n\r\n  get onlyVisible(): boolean {\r\n    return this._onlyVisible;\r\n  }\r\n  set onlyVisible(value: boolean) {\r\n    this._onlyVisible = value;\r\n    this.next();\r\n  }\r\n  private _onlyVisible = false;\r\n\r\n  get sortAlpha(): boolean {\r\n    return this._sortedAlpha;\r\n  }\r\n  set sortAlpha(value: boolean) {\r\n    this._sortedAlpha = value;\r\n    this.next();\r\n  }\r\n  private _sortedAlpha = false;\r\n\r\n  get opacity() {\r\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\r\n  }\r\n  set opacity(opacity: number) {\r\n    this.activeLayer$.getValue().opacity = opacity / 100;\r\n  }\r\n\r\n  get badgeOpacity() {\r\n    if (this.opacity === 100) {\r\n      return;\r\n    }\r\n    return this.opacity;\r\n  }\r\n\r\n  get raiseDisabled(): boolean {\r\n    if (\r\n      !this.orderable ||\r\n      this.activeLayer.baseLayer ||\r\n      this.getUpperLayer().id === this.activeLayer.id ||\r\n      this.isUpperBaselayer(this.activeLayer)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get lowerDisabled(): boolean {\r\n    if (\r\n      !this.orderable ||\r\n      this.activeLayer.baseLayer ||\r\n      this.getLowerLayer().id === this.activeLayer.id ||\r\n      this.isLowerBaselayer(this.activeLayer)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get raiseDisabledSelection(): boolean {\r\n    if (\r\n      this.layersChecked.length === 0 ||\r\n      !this.orderable ||\r\n      !this.raisableLayers(this.layersChecked) ||\r\n      this.selectAllCheck === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get lowerDisabledSelection(): boolean {\r\n    if (\r\n      this.layersChecked.length === 0 ||\r\n      !this.orderable ||\r\n      !this.lowerableLayers(this.layersChecked) ||\r\n      this.selectAllCheck === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get checkOpacity() {\r\n    return this.layersCheckedOpacity() * 100;\r\n  }\r\n  set checkOpacity(opacity: number) {\r\n    for (const layer of this.layersChecked) {\r\n      layer.opacity = opacity / 100;\r\n    }\r\n  }\r\n\r\n  get layerListDisplacement(): typeof LayerListDisplacement {\r\n    return LayerListDisplacement;\r\n  }\r\n\r\n  public toggleOpacity = false;\r\n\r\n  public selectAllCheck: boolean;\r\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\r\n  private selectAllCheck$$: Subscription;\r\n\r\n  constructor(private elRef: ElementRef) { }\r\n\r\n  /**\r\n   * Subscribe to the search term stream and trigger researches\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.change$$ = this.change$\r\n      .pipe(\r\n        debounce(() => {\r\n          return this.layers.length === 0 ? EMPTY : timer(50);\r\n        })\r\n      )\r\n      .subscribe(() => {\r\n        this.showToolbar$.next(this.computeShowToolbar());\r\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\r\n        this.appliedFilterAndSort.emit({\r\n          keyword: this.keyword,\r\n          sortAlpha: this.sortAlpha,\r\n          onlyVisible: this.onlyVisible\r\n        });\r\n      });\r\n\r\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\r\n      this.selectAllCheck = value;\r\n    });\r\n\r\n    this.layers$$ = this.layers$.subscribe(() => {\r\n      if (this.layers) {\r\n        let checks = 0;\r\n        for (const layer of this.layers) {\r\n          layer.status$.subscribe(valStatus => {\r\n            if (valStatus === 0) {\r\n              this.map.removeLayer(layer);\r\n            }\r\n          });\r\n          if (layer.options.active) {\r\n            this.activeLayer = layer;\r\n            this.layerTool = true;\r\n          }\r\n          if (layer.options.check) {\r\n            checks += 1;\r\n          }\r\n        }\r\n        if (this.excludeBaseLayers) {\r\n          this.selectAllCheck =\r\n            checks ===\r\n              this.layers.filter(\r\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\r\n              ).length\r\n              ? true\r\n              : false;\r\n        } else {\r\n          this.selectAllCheck =\r\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\r\n              ? true\r\n              : false;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n    this.selectAllCheck$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  activeLayerIsValid(layer: Layer): boolean {\r\n    let valid = false;\r\n    const layerExtent = layer.options.extent;\r\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\r\n\r\n    if (layerExtent) {\r\n      if (maxLayerZoomExtent) {\r\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\r\n      } else {\r\n        valid = true;\r\n      }\r\n    }\r\n    return valid;\r\n  }\r\n\r\n  activeLayersAreValid(layers: Layer[]): boolean {\r\n    let valid = false;\r\n    const layersExtent = olextent.createEmpty();\r\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\r\n\r\n    for (const layer of layers) {\r\n      const layerExtent = layer.options.extent;\r\n\r\n      if (layerExtent && !layerExtent.includes(Infinity)) {\r\n        olextent.extend(layersExtent, layerExtent);\r\n      }\r\n    }\r\n\r\n    if (!olextent.isEmpty(layersExtent)) {\r\n      if (maxLayerZoomExtent) {\r\n        valid = (olextent.containsExtent(maxLayerZoomExtent, layersExtent));\r\n      } else {\r\n        valid = true;\r\n      }\r\n    }\r\n    return valid;\r\n  }\r\n\r\n  zoomLayerExtents(layer: Layer) {\r\n    this.map.viewController.zoomToExtent(layer.options.extent);\r\n  }\r\n\r\n  zoomLayersExtents(layers: Layer[]) {\r\n    const layersExtent = olextent.createEmpty() as [number, number, number, number];\r\n\r\n    for (const layer of layers) {\r\n      const layerExtent = layer.options.extent;\r\n\r\n      if (layerExtent) {\r\n        olextent.extend(layersExtent, layerExtent);\r\n      }\r\n    }\r\n    this.map.viewController.zoomToExtent(layersExtent);\r\n  }\r\n\r\n  changeOpacity(event: MatSliderChange){\r\n    this.opacity = event.value;\r\n  }\r\n\r\n  clearKeyword() {\r\n    this.keyword = undefined;\r\n  }\r\n\r\n  getLowerLayer() {\r\n    return this.layers\r\n      .filter((l) => !l.baseLayer)\r\n      .reduce(\r\n        (prev, current) => {\r\n          return prev.zIndex < current.zIndex ? prev : current;\r\n        },\r\n        { zIndex: undefined, id: undefined }\r\n      );\r\n  }\r\n\r\n  isLowerBaselayer(layer) {\r\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\r\n    if (\r\n      this.layers &&\r\n      this.layers[index + 1] &&\r\n      this.layers[index + 1].baseLayer === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getUpperLayer() {\r\n    return this.layers\r\n      .filter((l) => !l.baseLayer)\r\n      .reduce(\r\n        (prev, current) => {\r\n          return prev.zIndex > current.zIndex ? prev : current;\r\n        },\r\n        { zIndex: undefined, id: undefined }\r\n      );\r\n  }\r\n\r\n  isUpperBaselayer(layer) {\r\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\r\n    if (\r\n      this.layers &&\r\n      this.layers[index - 1] &&\r\n      this.layers[index - 1].baseLayer === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  moveActiveLayer(activeLayer: Layer, actiontype: LayerListDisplacement) {\r\n    const layersToMove = [activeLayer];\r\n    const sortedLayersToMove = [];\r\n    this.getLinkedLayers(activeLayer, layersToMove);\r\n    this.layers.map(layer => {\r\n      if (layersToMove.indexOf(layer) !== -1) {\r\n        sortedLayersToMove.push(layer);\r\n      }\r\n    });\r\n\r\n    if (actiontype === LayerListDisplacement.Raise) {\r\n      this.raiseLayers(sortedLayersToMove, false);\r\n    } else if (actiontype === LayerListDisplacement.Lower) {\r\n      this.lowerLayers(sortedLayersToMove, false);\r\n    }\r\n  }\r\n\r\n  private getLinkedLayers(activeLayer: Layer, layersList: Layer[]) {\r\n    const linkedLayers = activeLayer.options.linkedLayers as LayersLink;\r\n    if (!linkedLayers) {\r\n      return;\r\n    }\r\n    const currentLinkedId = linkedLayers.linkId;\r\n    const currentLinks = linkedLayers.links;\r\n    const isParentLayer = currentLinks ? true : false;\r\n\r\n    if (isParentLayer) {\r\n      // search for child layers\r\n      currentLinks.map(link => {\r\n        if (!link.properties || link.properties.indexOf(LinkedProperties.ZINDEX) === -1) {\r\n          return;\r\n        }\r\n        link.linkedIds.map(linkedId => {\r\n          const childLayer = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\r\n          if (childLayer) {\r\n            if (!layersList.includes(childLayer)) {\r\n              layersList.push(childLayer);\r\n            }\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      // search for parent layer\r\n      this.layers.map(parentLayer => {\r\n        if (parentLayer.options.linkedLayers?.links) {\r\n          parentLayer.options.linkedLayers.links.map(l => {\r\n            if (\r\n              l.properties?.indexOf(LinkedProperties.ZINDEX) !== -1 &&\r\n              l.bidirectionnal !== false &&\r\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\r\n              layersList.push(parentLayer);\r\n              this.getLinkedLayers(parentLayer, layersList);\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /*\r\n   * For selection mode disabled attribute\r\n   */\r\n  raisableLayers(layers: Layer[]) {\r\n    let response = false;\r\n    let base = 0;\r\n    for (const layer of layers) {\r\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\r\n      const currentLayer = this.layers[mapIndex];\r\n      if (currentLayer.baseLayer) {\r\n        base += 1;\r\n      }\r\n\r\n      const previousLayer = this.layers[mapIndex - 1];\r\n      if (\r\n        previousLayer &&\r\n        previousLayer.baseLayer !== true &&\r\n        !layers.find((lay) => previousLayer.id === lay.id) &&\r\n        currentLayer.baseLayer !== true\r\n      ) {\r\n        response = true;\r\n      }\r\n    }\r\n\r\n    if (\r\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\r\n      base === this.layersChecked.length\r\n    ) {\r\n      response = false;\r\n    }\r\n    return response;\r\n  }\r\n\r\n  /*\r\n   * When multiple layers is selected but some may be allow to move\r\n   */\r\n  raisableLayer(index: number) {\r\n    if (index < 1) {\r\n      return false;\r\n    }\r\n\r\n    if (this.layers[index - 1].options.check) {\r\n      return this.raisableLayer(index - 1);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\r\n    const layersToRaise = [];\r\n    for (const layer of layers) {\r\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\r\n      if (this.raisableLayer(index)) {\r\n        layersToRaise.push(layer);\r\n      }\r\n    }\r\n    this.map.raiseLayers(layersToRaise);\r\n    if (fromUi) {\r\n      setTimeout(() => {\r\n        const elements = this.computeElementRef();\r\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\r\n          elements[0].scrollTop = elements[1].offsetParent.offsetTop;\r\n        }\r\n      }, 100);\r\n    }\r\n  }\r\n  /*\r\n   * For selection mode disabled attribute\r\n   */\r\n  lowerableLayers(layers: Layer[]) {\r\n    let response = false;\r\n    let base = 0;\r\n    for (const layer of layers) {\r\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\r\n      const currentLayer = this.layers[mapIndex];\r\n      if (currentLayer.baseLayer) {\r\n        base += 1;\r\n      }\r\n\r\n      const nextLayer = this.layers[mapIndex + 1];\r\n      if (\r\n        nextLayer &&\r\n        nextLayer.baseLayer !== true &&\r\n        !layers.find((lay) => nextLayer.id === lay.id)\r\n      ) {\r\n        response = true;\r\n      }\r\n    }\r\n\r\n    if (\r\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\r\n      base === this.layersChecked.length\r\n    ) {\r\n      response = false;\r\n    }\r\n    return response;\r\n  }\r\n\r\n  /*\r\n   * When multiple layers is selected but some may be allow to move\r\n   */\r\n  lowerableLayer(index: number) {\r\n    if (\r\n      index >\r\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (this.layers[index + 1].options.check) {\r\n      return this.lowerableLayer(index + 1);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\r\n    const layersToLower = [];\r\n    for (const layer of layers) {\r\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\r\n      if (this.lowerableLayer(index)) {\r\n        layersToLower.push(layer);\r\n      }\r\n    }\r\n    this.map.lowerLayers(layersToLower);\r\n    if (fromUi) {\r\n      setTimeout(() => {\r\n        const elements = this.computeElementRef('lower');\r\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\r\n          elements[0].scrollTop =\r\n            elements[1].offsetParent.offsetTop +\r\n            elements[1].offsetParent.offsetHeight -\r\n            elements[0].clientHeight;\r\n        }\r\n      }, 100);\r\n    }\r\n  }\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n  private computeLayers(layers: Layer[]): Layer[] {\r\n    let layersOut = this.filterLayers(layers);\r\n    if (this.sortAlpha) {\r\n      layersOut = this.sortLayersByTitle(layersOut);\r\n    } else {\r\n      layersOut = this.sortLayersByZindex(layersOut);\r\n    }\r\n    return layersOut;\r\n  }\r\n\r\n  onKeywordChange(term) {\r\n    this.keyword = term;\r\n  }\r\n\r\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\r\n    this.keyword = appliedFilter.keyword;\r\n    this.onlyVisible = appliedFilter.onlyVisible;\r\n    this.sortAlpha = appliedFilter.sortAlpha;\r\n  }\r\n\r\n  private filterLayers(layers: Layer[]): Layer[] {\r\n    if (\r\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\r\n    ) {\r\n      return layers;\r\n    }\r\n    if (!this.keyword && !this.onlyVisible) {\r\n      return layers;\r\n    }\r\n\r\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\r\n\r\n    layers.forEach((layer: Layer) => {\r\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\r\n      const dataSourceOptions = layer.dataSource.options || {};\r\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\r\n      const keywords = metadata.keywordList || [];\r\n      const layerKeywords = keywords.map((kw: string) => {\r\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n      });\r\n\r\n      if (this.keyword && layer.title) {\r\n        const localKeyword = this.keyword\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const layerTitle = layer.title\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const dataSourceType = dataSourceOptions.type || '';\r\n        const keywordRegex = new RegExp(localKeyword, 'gi');\r\n        const keywordInList =\r\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\r\n          undefined;\r\n        if (\r\n          !keywordRegex.test(layerTitle) &&\r\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\r\n          !keywordInList\r\n        ) {\r\n          const index = keepLayerIds.indexOf(layer.id);\r\n          if (index > -1) {\r\n            keepLayerIds.splice(index, 1);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (this.onlyVisible && layer.visible === false) {\r\n        const index = keepLayerIds.indexOf(layer.id);\r\n        if (index > -1) {\r\n          keepLayerIds.splice(index, 1);\r\n        }\r\n      }\r\n    });\r\n\r\n    return layers.filter(\r\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\r\n    );\r\n  }\r\n\r\n  private sortLayersByZindex(layers: Layer[]) {\r\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\r\n  }\r\n\r\n  private sortLayersByTitle(layers: Layer[]) {\r\n    return layers.sort((a, b) => {\r\n      if (this.normalize(a.title) < this.normalize(b.title)) {\r\n        return -1;\r\n      }\r\n      if (this.normalize(a.title) > this.normalize(b.title)) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  private normalize(str: string) {\r\n    return str\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .toLowerCase();\r\n  }\r\n\r\n  private computeShowToolbar(): boolean {\r\n    switch (this.layerFilterAndSortOptions.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        return true;\r\n      case LayerListControlsEnum.never:\r\n        return false;\r\n      default:\r\n        if (\r\n          this.layers.length >= this.thresholdToFilterAndSort ||\r\n          this.keyword ||\r\n          this.onlyVisible\r\n        ) {\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  }\r\n\r\n  toggleLayerTool(layer) {\r\n    this.toggleOpacity = false;\r\n    if (this.layerTool && layer === this.activeLayer) {\r\n      this.layerTool = false;\r\n    } else {\r\n      this.layerTool = true;\r\n    }\r\n\r\n    for (const lay of this.layers) {\r\n      lay.options.active = false;\r\n    }\r\n    layer.options.active = true;\r\n    this.activeLayer = layer;\r\n  }\r\n\r\n  removeLayers(layers?: Layer[]) {\r\n    if (layers && layers.length > 0) {\r\n      this.layersChecked = [];\r\n      for (const layer of layers) {\r\n        if (layer.options.removable !== false) {\r\n          layer.map.removeLayer(layer);\r\n        } else {\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n    } else if (!layers && this.activeLayer.options.removable !== false) {\r\n      this.activeLayer.map.removeLayer(this.activeLayer);\r\n      this.layerTool = false;\r\n    }\r\n  }\r\n\r\n  toggleVisibility(layers?: Layer[]) {\r\n    if (layers && layers.length > 0) {\r\n      for (const layer of layers) {\r\n        layer.visible = this.hideSelectedLayers;\r\n      }\r\n    }\r\n    this.layerItemChangeDetection$.next(true);\r\n  }\r\n\r\n  isLayerRemovable(layer: Layer): boolean {\r\n    return layer.options.removable !== false;\r\n  }\r\n\r\n  isAllLayersRemovable(layers: Layer[]): boolean {\r\n    return layers.every(l => this.isLayerRemovable(l));\r\n  }\r\n\r\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\r\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\r\n      LayerListSelectVisibleEnum.NULL;\r\n    let findTrue: boolean = false;\r\n    let findFalse: boolean = false;\r\n\r\n    if (this.layersChecked.length === 0) {\r\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\r\n    } else {\r\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\r\n      this.hideSelectedLayers = false;\r\n\r\n      for (const layer2 of this.layersChecked) {\r\n        if (layer2.visible === true) {\r\n          findTrue = true;\r\n        }\r\n        if (layer2.visible === false) {\r\n          findFalse = true;\r\n        }\r\n      }\r\n\r\n      if (findTrue === true && findFalse === false) {\r\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\r\n      }\r\n      if (findTrue === false && findFalse === true) {\r\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\r\n        this.hideSelectedLayers = true;\r\n      }\r\n    }\r\n\r\n    return statusSelectedLayers;\r\n  }\r\n\r\n  layersCheck(event: { layer: Layer; check: boolean }) {\r\n    event.layer.options.check = event.check;\r\n    if (event.check === true) {\r\n      const eventMapIndex = this.layers.findIndex(\r\n        (layer) => event.layer.id === layer.id\r\n      );\r\n      for (const layer of this.layersChecked) {\r\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\r\n        if (eventMapIndex < mapIndex) {\r\n          this.layersChecked.splice(\r\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\r\n            0,\r\n            event.layer\r\n          );\r\n\r\n          if (this.excludeBaseLayers) {\r\n            if (\r\n              this.layersChecked.length ===\r\n              this.layers.filter(\r\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\r\n              ).length\r\n            ) {\r\n              this.selectAllCheck = true;\r\n            } else {\r\n              this.selectAllCheck = false;\r\n            }\r\n          } else if (!this.excludeBaseLayers) {\r\n            if (\r\n              this.layersChecked.length ===\r\n              this.layers.filter((lay) => lay.showInLayerList).length\r\n            ) {\r\n              this.selectAllCheck = true;\r\n            } else {\r\n              this.selectAllCheck = false;\r\n            }\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      this.layersChecked.push(event.layer);\r\n    } else {\r\n      const index = this.layersChecked.findIndex(\r\n        (layer) => event.layer.id === layer.id\r\n      );\r\n      this.layersChecked.splice(index, 1);\r\n    }\r\n\r\n    if (this.excludeBaseLayers) {\r\n      if (\r\n        this.layersChecked.length ===\r\n        this.layers.filter(\r\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\r\n        ).length\r\n      ) {\r\n        this.selectAllCheck = true;\r\n      } else {\r\n        this.selectAllCheck = false;\r\n      }\r\n    } else if (!this.excludeBaseLayers) {\r\n      if (\r\n        this.layersChecked.length ===\r\n        this.layers.filter((lay) => lay.showInLayerList).length\r\n      ) {\r\n        this.selectAllCheck = true;\r\n      } else {\r\n        this.selectAllCheck = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  toggleSelectionMode(value: boolean) {\r\n    this.selection = value;\r\n    this.activeLayer = undefined;\r\n    if (value === true) {\r\n      this.layerTool = false;\r\n      for (const layer of this.layers) {\r\n        if (layer.options.check) {\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  layersCheckedOpacity(): any {\r\n    if (this.layersChecked.length > 1) {\r\n      return 1;\r\n    } else {\r\n      const opacity = [];\r\n      for (const layer of this.layersChecked) {\r\n        opacity.push(layer.opacity);\r\n      }\r\n      return opacity;\r\n    }\r\n  }\r\n\r\n  selectAll() {\r\n    if (!this.selectAllCheck) {\r\n      for (const layer of this.layers) {\r\n        if (\r\n          this.excludeBaseLayers &&\r\n          layer.baseLayer !== true &&\r\n          layer.showInLayerList\r\n        ) {\r\n          layer.options.check = true;\r\n          this.layersChecked.push(layer);\r\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\r\n          layer.options.check = true;\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n      this.selectAllCheck$.next(true);\r\n    } else {\r\n      for (const layer of this.layers) {\r\n        layer.options.check = false;\r\n      }\r\n      this.layersChecked = [];\r\n      this.selectAllCheck$.next(false);\r\n    }\r\n  }\r\n\r\n  isScrolledIntoView(elemSource, elem) {\r\n    const docViewTop = elemSource.scrollTop;\r\n    const docViewBottom = docViewTop + elemSource.clientHeight;\r\n\r\n    const elemTop = elem.offsetTop;\r\n    const elemBottom = elemTop + elem.clientHeight;\r\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\r\n  }\r\n\r\n  computeElementRef(type?: string) {\r\n    const checkItems = this.elRef.nativeElement.getElementsByClassName(\r\n      'mat-checkbox-checked'\r\n    );\r\n    const checkItem =\r\n      type === 'lower'\r\n        ? this.elRef.nativeElement.getElementsByClassName(\r\n          'mat-checkbox-checked'\r\n        )[checkItems.length - 1]\r\n        : this.elRef.nativeElement.getElementsByClassName(\r\n          'mat-checkbox-checked'\r\n        )[0];\r\n    const igoList = this.elRef.nativeElement.getElementsByTagName(\r\n      'igo-list'\r\n    )[0];\r\n\r\n    return [igoList, checkItem];\r\n  }\r\n\r\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\r\n    for (const layer of layersList) {\r\n      if (layer.olLoadingProblem === true) {\r\n        this.map.removeLayer(layer);\r\n      }\r\n    }\r\n    return layersList;\r\n  }\r\n}\r\n","  <mat-list-item>\r\n      <mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\r\n        <input\r\n          matInput\r\n          [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\r\n          [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\r\n          matTooltipShowDelay=\"500\"\r\n          type=\"text\" [(ngModel)]=\"term\">\r\n        <button\r\n          mat-button\r\n          *ngIf=\"term\"\r\n          matSuffix\r\n          mat-icon-button\r\n          aria-label=\"Clear\"\r\n          color=\"warn\"\r\n          (click)=\"clearTerm()\">\r\n          <mat-icon svgIcon=\"close\"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n      <div [matTooltip]=\"sortAlpha ?\r\n      ('igo.geo.layer.sortMapOrder' | translate) :\r\n      ('igo.geo.layer.sortAlphabetically' | translate)\" matTooltipShowDelay=\"500\">\r\n        <button class=\"sort-alpha\" [color]=\"sortAlpha ? 'warn' : 'primary'\" mat-icon-button (click)=\"toggleSortAlpha()\">\r\n          <mat-icon [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"></mat-icon>\r\n        </button>\r\n      </div>\r\n\r\n       <div [matTooltip]=\"onlyVisible ?\r\n        ('igo.geo.layer.resetLayersList' | translate) :\r\n        ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\" matTooltipShowDelay=\"500\">\r\n         <button class=\"only-visible\" mat-icon-button [disabled]=\"layersAreAllVisible && !onlyVisible\"\r\n           [color]=\"onlyVisible ? 'warn' : 'primary'\" (click)=\"toggleOnlyVisible()\">\r\n           <mat-icon\r\n             matBadge\r\n             igoMatBadgeIcon=\"eye\"\r\n             igoMatBadgeInverseColor=\"true\"\r\n             igoMatBadgeInheritColor=\"true\"\r\n             [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\">\r\n           </mat-icon>\r\n         </button>\r\n       </div>\r\n\r\n       <div [matTooltip]=\"selectionMode ?\r\n        ('igo.geo.layer.deactivateSelectionMode' | translate) :\r\n        ('igo.geo.layer.activateSelectionMode' | translate)\" matTooltipShowDelay=\"500\">\r\n         <button class=\"selection-mode\" mat-icon-button\r\n           color=\"primary\" (click)=\"toggleSelectionMode()\">\r\n           <mat-icon [svgIcon]=\"selectionMode ? 'checkbox-multiple-marked-outline' : 'checkbox-multiple-blank-outline'\"></mat-icon>\r\n         </button>\r\n       </div>\r\n\r\n</mat-list-item>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  EventEmitter,\r\n  Output,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material/form-field';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\r\n\r\n@Component({\r\n  selector: 'igo-layer-list-tool',\r\n  templateUrl: './layer-list-tool.component.html',\r\n  styleUrls: ['./layer-list-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerListToolComponent implements OnInit, OnDestroy {\r\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n  onlyVisible$$: Subscription;\r\n  sortAlpha$$: Subscription;\r\n  term$$: Subscription;\r\n\r\n  @Input() layersAreAllVisible: boolean = true;\r\n\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input()\r\n  set onlyVisible(value: boolean) {\r\n    this.onlyVisible$.next(value);\r\n  }\r\n  get onlyVisible(): boolean {\r\n    return this.onlyVisible$.value;\r\n  }\r\n\r\n  @Input()\r\n  set sortAlpha(value: boolean) {\r\n    this.sortAlpha$.next(value);\r\n  }\r\n  get sortAlpha(): boolean {\r\n    return this.sortAlpha$.value;\r\n  }\r\n\r\n  @Input()\r\n  set term(value: string) {\r\n    this.term$.next(value);\r\n  }\r\n  get term(): string {\r\n    return this.term$.value;\r\n  }\r\n\r\n  public selectionMode = false;\r\n\r\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\r\n  @Output() selection = new EventEmitter<boolean>();\r\n\r\n  ngOnInit(): void {\r\n    this.term$$ = this.term$.subscribe(keyword => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword,\r\n        onlyVisible: this.onlyVisible,\r\n        sortAlpha: this.sortAlpha\r\n      });\r\n    });\r\n\r\n    this.onlyVisible$$ = this.onlyVisible$.subscribe(onlyVisible => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword: this.term,\r\n        onlyVisible,\r\n        sortAlpha: this.sortAlpha\r\n      });\r\n    });\r\n    this.sortAlpha$$ = this.sortAlpha$.subscribe(sortAlpha => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword: this.term,\r\n        onlyVisible: this.onlyVisible,\r\n        sortAlpha\r\n      });\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.onlyVisible$$.unsubscribe();\r\n    this.sortAlpha$$.unsubscribe();\r\n    this.term$$.unsubscribe();\r\n  }\r\n\r\n  clearTerm() {\r\n    this.term = undefined;\r\n  }\r\n  toggleSortAlpha() {\r\n    this.sortAlpha = !this.sortAlpha;\r\n  }\r\n\r\n  toggleOnlyVisible() {\r\n    this.onlyVisible = !this.onlyVisible;\r\n  }\r\n\r\n  toggleSelectionMode() {\r\n    this.selectionMode = !this.selectionMode;\r\n    this.selection.emit(this.selectionMode);\r\n  }\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\r\nimport { Subscription, combineLatest } from 'rxjs';\r\n\r\nimport { RouteService } from '@igo2/core';\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { LayerListComponent } from './layer-list.component';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { map, debounceTime } from 'rxjs/operators';\r\n\r\n@Directive({\r\n  selector: '[igoLayerListBinding]'\r\n})\r\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\r\n  private component: LayerListComponent;\r\n  private layersOrResolutionChange$$: Subscription;\r\n  layersVisibility$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: LayerListComponent,\r\n    private mapService: MapService,\r\n    @Optional() private route: RouteService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    // this.component.layers = [];\r\n    this.layersOrResolutionChange$$ = combineLatest([\r\n      this.mapService.getMap().layers$,\r\n      this.mapService.getMap().viewController.resolution$]\r\n    ).pipe(\r\n      debounceTime(10)\r\n    ).subscribe((bunch: [Layer[], number]) => {\r\n      const shownLayers = bunch[0].filter((layer: Layer) => {\r\n        return layer.showInLayerList === true;\r\n      });\r\n      this.component.layers = shownLayers;\r\n      this.setLayersVisibilityStatus(shownLayers, this.component.excludeBaseLayers);\r\n    });\r\n  }\r\n\r\n  private setLayersVisibilityStatus(layers: Layer[], excludeBaseLayers: boolean) {\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n    this.layersVisibility$$ = combineLatest(layers\r\n      .filter(layer => layer.baseLayer !== excludeBaseLayers )\r\n      .map((layer: Layer) => layer.visible$))\r\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\r\n      .subscribe((allLayersAreVisible: boolean) =>\r\n        this.component.layersAreAllVisible = allLayersAreVisible);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layersOrResolutionChange$$.unsubscribe();\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n  }\r\n\r\n}\r\n","\r\n<div class=\"layer-legend-list-container\">\r\n  <mat-slide-toggle \r\n  tooltip-position=\"above\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\r\n  [checked]=\"showAllLegendsValue\" class=\"mat-typography\" \r\n  *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\" [labelPosition]=\"'before'\" (change)=\"toggleShowAllLegends($event.checked)\">\r\n    {{'igo.geo.layer.legend.showAll' | translate}}\r\n  </mat-slide-toggle>\r\n  <mat-divider *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"></mat-divider>\r\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\r\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\r\n      <igo-layer-legend-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\r\n          igoListItem [layer]=\"layer\"\r\n          [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\r\n      </igo-layer-legend-item>\r\n    </ng-template>\r\n  </igo-list>\r\n  <p class=\"layers-empty mat-typography\" \r\n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && !(hasVisibleOrInRangeLayers$ | async) && !(hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends\">\r\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate}} \r\n  </p>\r\n  <p class=\"layers-empty mat-typography\" \r\n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && !(hasVisibleOrInRangeLayers$ | async) && (hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends\">\r\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate}} \r\n  </p>\r\n  <p class=\"layers-empty mat-typography\"\r\n    *ngIf=\"(layersInUi$ | async).length && !(hasVisibleOrInRangeLayers$ | async) && !(hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends\">\r\n    {{'igo.geo.layer.legend.noLayersVisible' | translate}} \r\n  </p>\r\n  <p class=\"layers-empty mat-typography\"\r\n    *ngIf=\"(layersInUi$ | async).length && !(hasVisibleOrInRangeLayers$ | async) && (hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends\">\r\n    {{'igo.geo.layer.legend.noLayersVisibleButZoom' | translate}} \r\n  </p>\r\n\r\n</div>","import { Component, Input, ChangeDetectionStrategy, OnInit, OnDestroy, EventEmitter, Output } from '@angular/core';\r\nimport { Layer } from '../shared';\r\nimport { BehaviorSubject, ReplaySubject, Subscription, EMPTY, timer } from 'rxjs';\r\nimport { debounce } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend-list',\r\n  templateUrl: './layer-legend-list.component.html',\r\n  styleUrls: ['./layer-legend-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\r\n  orderable = true;\r\n\r\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  showAllLegend: boolean =  false;\r\n  public change$ = new ReplaySubject<void>(1);\r\n  private change$$: Subscription;\r\n  @Input()\r\n  set layers(value: Layer[]) {\r\n    this._layers = value;\r\n    this.next();\r\n  }\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  private _layers: Layer[];\r\n  @Input() excludeBaseLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() allowShowAllLegends: boolean = false;\r\n\r\n  @Input() showAllLegendsValue: boolean = false;\r\n\r\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\r\n\r\n  constructor() { }\r\n  ngOnInit(): void {\r\n    this.change$$ = this.change$\r\n      .pipe(debounce(() => {\r\n        return this.layers.length === 0 ? EMPTY : timer(50);\r\n      }))\r\n      .subscribe(() => {\r\n        const layers = this.computeShownLayers(this.layers.slice(0));\r\n        this.layers$.next(layers);\r\n        this.hasVisibleOrInRangeLayers$.next(\r\n          this.layers.slice(0)\r\n            .filter(layer => layer.baseLayer !== true)\r\n            .filter(layer => layer.visible$.value && layer.isInResolutionsRange$.value).length > 0\r\n        );\r\n        this.hasVisibleAndNotInRangeLayers$.next(\r\n          this.layers.slice(0)\r\n            .filter(layer => layer.baseLayer !== true)\r\n            .filter(layer => layer.visible$.value && !layer.isInResolutionsRange$.value).length > 0\r\n        );\r\n\r\n        this.layersInUi$.next(\r\n          this.layers.slice(0).filter(layer => layer.showInLayerList !== false && (!this.excludeBaseLayers || !layer.baseLayer))\r\n        );\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n  private computeShownLayers(layers: Layer[]) {\r\n    let shownLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange);\r\n    if (this.showAllLegendsValue) {\r\n      shownLayers = layers;\r\n    }\r\n    return this.sortLayersByZindex(shownLayers);\r\n  }\r\n  private sortLayersByZindex(layers: Layer[]) {\r\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\r\n  }\r\n\r\n  toggleShowAllLegends(toggle: boolean) {\r\n      this.showAllLegendsValue = toggle;\r\n      this.next();\r\n      this.allLegendsShown.emit(toggle);\r\n  }\r\n}\r\n","<button *ngIf=\"options.trackFeature\"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\r\n  [color]=\"color\"\r\n  (click)=\"toggleTrackFeature()\">\r\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\r\n</button>\r\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\r\n\r\nimport { Layer, VectorLayer } from '../shared/layers';\r\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\r\n\r\n@Component({\r\n  selector: 'igo-track-feature-button',\r\n  templateUrl: './track-feature-button.component.html',\r\n  styleUrls: ['./track-feature-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TrackFeatureButtonComponent implements OnInit {\r\n\r\n  @Input() layer: VectorLayer;\r\n\r\n  @Input() trackFeature = false;\r\n\r\n  get options(): VectorLayerOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.options;\r\n  }\r\n\r\n  public color: string = 'primary';\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.color = this.trackFeature ? 'primary' : 'basic';\r\n  }\r\n\r\n  toggleTrackFeature() {\r\n    if (this.trackFeature) {\r\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\r\n      this.color = 'basic';\r\n    } else {\r\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\r\n      this.color = 'primary';\r\n    }\r\n    this.trackFeature = !this.trackFeature;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { Layer, TooltipType } from '../shared/layers';\r\nimport { NetworkService, ConnectionState } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend-item',\r\n  templateUrl: './layer-legend-item.component.html',\r\n  styleUrls: ['./layer-legend-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\r\n\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  tooltipText: string;\r\n\r\n  state: ConnectionState;\r\n\r\n  private resolution$$: Subscription;\r\n  private network$$: Subscription;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  constructor(private networkService: NetworkService) {}\r\n\r\n  ngOnInit() {\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.onResolutionChange();\r\n    });\r\n    this.tooltipText = this.computeTooltip();\r\n\r\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\r\n      this.state = state;\r\n      this.onResolutionChange();\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n    this.network$$.unsubscribe();\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return this.layer.title;\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  private onResolutionChange() {\r\n    const inResolutionRange = this.layer.isInResolutionsRange;\r\n    this.inResolutionRange$.next(inResolutionRange);\r\n  }\r\n}\r\n","<mat-list-item class= \"igo-layer-list-item\">\r\n  <h4 matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\r\n</mat-list-item>\r\n\r\n<div #legend class=\"igo-layer-legend-container\">\r\n  <igo-layer-legend\r\n    [layer]=\"layer\"\r\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\r\n  </igo-layer-legend>\r\n</div>\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatSliderModule } from '@angular/material/slider';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoListModule,\r\n  IgoCollapsibleModule,\r\n  IgoImageModule,\r\n  IgoPanelModule,\r\n  IgoMatBadgeIconModule\r\n} from '@igo2/common';\r\n\r\nimport { LayerService } from './shared/layer.service';\r\nimport { StyleService } from './shared/style.service';\r\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\r\nimport { LayerItemComponent } from './layer-item/layer-item.component';\r\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\r\nimport { LayerListComponent } from './layer-list/layer-list.component';\r\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\r\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\r\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\r\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\r\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\r\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    MatInputModule,\r\n    MatFormFieldModule,\r\n    CommonModule,\r\n    FormsModule,\r\n    MatDividerModule,\r\n    MatMenuModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSlideToggleModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    MatListModule,\r\n    MatSliderModule,\r\n    MatBadgeModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule,\r\n    IgoImageModule,\r\n    IgoPanelModule,\r\n    IgoMatBadgeIconModule\r\n  ],\r\n  exports: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ],\r\n  declarations: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ]\r\n})\r\nexport class IgoLayerModule {\r\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\r\n    return {\r\n      ngModule: IgoLayerModule,\r\n      providers: [LayerService, StyleService, LayerListToolService]\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoMatBadgeIconModule,\r\n  IgoCollapsibleModule,\r\n  IgoListModule\r\n} from '@igo2/common';\r\n\r\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\r\nimport { CatalogBrowserComponent } from './catalog-browser.component';\r\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\r\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\r\nimport { IgoLayerModule } from '../../layer/layer.module';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule,\r\n    IgoMetadataModule,\r\n    IgoLayerModule\r\n  ],\r\n  exports: [\r\n    CatalogBrowserComponent\r\n  ],\r\n  declarations: [\r\n    CatalogBrowserComponent,\r\n    CatalogBrowserGroupComponent,\r\n    CatalogBrowserLayerComponent\r\n  ]\r\n})\r\nexport class IgoCatalogBrowserModule {}\r\n","<h1 mat-dialog-title class=\"mat-typography\">{{'igo.geo.catalog.library.addTitle' | translate}}</h1>\r\n<div mat-dialog-content class=\"mat-typography\">\r\n  <form class=\"igo-form\" [formGroup]=\"form\">\r\n    <div class=\"igo-input-container\">\r\n      <mat-form-field>\r\n        <input type=\"text\" formControlName=\"url\" placeholder=\"URL\" matInput [matAutocomplete]=\"auto\">\r\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)='changeUrl($event.option.value)'>\r\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\r\n            [matTooltip]=\"predefinedCatalog.url\" [value]=\"predefinedCatalog\">\r\n            {{predefinedCatalog.url}}\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n      </mat-form-field>\r\n    </div>\r\n    <div class=\"igo-input-container\">\r\n      <mat-form-field>\r\n        <input\r\n          matInput\r\n          formControlName=\"title\"\r\n          placeholder=\"{{'igo.geo.printForm.title' | translate}}\">\r\n      </mat-form-field>\r\n    </div>\r\n    <div class=\"igo-input-container\">\r\n      <mat-form-field>\r\n        <mat-select\r\n          formControlName=\"type\"\r\n          placeholder=\"Type\">\r\n          <mat-option\r\n            *ngFor=\"let type of typeCapabilities\"\r\n            [value]=\"type\"\r\n            (click)=\"$event.stopPropagation()\">\r\n              <p mat-line>{{type}}</p>\r\n          </mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </form>\r\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\r\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.externalProvider.unavailableWithEmail', { value: addedCatalog.url, email: emailAddress })}}</p>\r\n  </span>\r\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\r\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url })}}</p>\r\n  </span>\r\n</div>\r\n<div mat-dialog-actions style=\"justify-content: center\">\r\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\r\n    <button\r\n      mat-raised-button\r\n      type=\"button\"\r\n      (click)=\"cancel()\">\r\n      {{'igo.geo.catalog.library.cancel' | translate}}\r\n    </button>\r\n    <button\r\n      id=\"addCatalogBtnDialog\"\r\n      mat-raised-button\r\n      type=\"button\"\r\n      color=\"primary\"\r\n      [disabled]=\"!form.valid\"\r\n      (click)=\"addCatalog(form.value)\">\r\n      {{'igo.geo.catalog.library.add' | translate}}\r\n    </button>\r\n  </div>\r\n</div>\r\n","import { LanguageService, ConfigService } from '@igo2/core';\r\nimport { Component, OnInit, OnDestroy, Optional, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { TypeCapabilities } from '../../datasource';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\n\r\n@Component({\r\n  selector: 'igo-add-catalog-dialog',\r\n  templateUrl: './add-catalog-dialog.component.html',\r\n  styleUrls: ['./add-catalog-dialog.component.scss']\r\n})\r\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\r\n  public form: FormGroup;\r\n  private defaultAddedCatalogType = 'wms';\r\n  private addedCatalogType$$: Subscription;\r\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\r\n  typeCapabilities: string[];\r\n  predefinedCatalogs: Catalog[] = [];\r\n  store: EntityStore<Catalog>;\r\n  error = false;\r\n  addedCatalog: Catalog;\r\n  emailAddress: string;\r\n  private storeViewAll$$: Subscription;\r\n\r\n  constructor(\r\n    private formBuilder: FormBuilder,\r\n    public languageService: LanguageService,\r\n    private configService: ConfigService,\r\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\r\n    @Optional()\r\n    @Inject(MAT_DIALOG_DATA)\r\n    public data: { predefinedCatalogs: Catalog[]; store: EntityStore<Catalog>; error: boolean; addedCatalog: Catalog }\r\n  ) {\r\n    this.store = data.store;\r\n    this.predefinedCatalogs = data.predefinedCatalogs;\r\n    this.error = data.error;\r\n    this.addedCatalog = data.addedCatalog;\r\n    this.form = this.formBuilder.group({\r\n      id: ['', []],\r\n      title: ['', []],\r\n      url: ['', [Validators.required]],\r\n      type: [this.defaultAddedCatalogType, [Validators.required]]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.store.state.clear();\r\n    this.typeCapabilities = Object.keys(TypeCapabilities);\r\n\r\n    this.addedCatalogType$$ = this.form\r\n      .get('type')\r\n      .valueChanges.subscribe((value) => {\r\n        if (value === 'wmts') {\r\n          this.form.get('title').setValidators(Validators.required);\r\n        } else {\r\n          this.form.get('title').setValidators([]);\r\n        }\r\n        this.form.get('title').updateValueAndValidity();\r\n      });\r\n\r\n    this.computePredefinedCatalogList();\r\n    this.storeViewAll$$ = this.store.view\r\n      .all$()\r\n      .subscribe(() => this.computePredefinedCatalogList());\r\n\r\n    this.emailAddress = this.configService.getConfig('emailAddress');\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.addedCatalogType$$.unsubscribe();\r\n    this.storeViewAll$$.unsubscribe();\r\n  }\r\n\r\n  changeUrl(catalog: Catalog) {\r\n    this.form.patchValue(catalog);\r\n    this.error = false;\r\n    this.computePredefinedCatalogList();\r\n  }\r\n\r\n  computePredefinedCatalogList() {\r\n    this.predefinedCatalogsList$.next(\r\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\r\n    );\r\n  }\r\n\r\n  addCatalog(addedCatalog: Catalog) {\r\n    this.error = false;\r\n    this.dialogRef.close(addedCatalog);\r\n  }\r\n\r\n  cancel() {\r\n    this.error = false;\r\n    this.dialogRef.close();\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\">\r\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\r\n    <igo-catalog-library-item\r\n      igoListItem\r\n      color=\"accent\"\r\n      [map]=\"map\"\r\n      [catalog]=\"catalog\"\r\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\r\n      (select)=\"onCatalogSelect(catalog)\">\r\n    </igo-catalog-library-item>\r\n  </ng-template>\r\n</igo-list>\r\n\r\n<div *ngIf=\"addCatalogAllowed\" class=btnAddCatalog>\r\n  <button\r\n    mat-raised-button\r\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\r\n    matTooltipPosition=\"above\"\r\n    color=\"primary\"\r\n    (click)=\"addCatalogDialog()\">\r\n    {{'igo.geo.catalog.library.addBtn' | translate}}\r\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\r\n  </button>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { LanguageService, MessageService, StorageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { Observable, Subscription } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\nimport { Md5 } from 'ts-md5';\r\nimport { CapabilitiesService } from '../../datasource';\r\nimport { IgoMap } from '../../map';\r\nimport { standardizeUrl } from '../../utils/id-generator';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\r\n\r\n/**\r\n * Component to browse a list of available catalogs\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-library',\r\n  templateUrl: './catalog-library.component.html',\r\n  styleUrls: ['./catalog-library.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Store holding the catalogs\r\n   */\r\n  @Input() store: EntityStore<Catalog>;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Determine if the form to add a catalog is allowed\r\n   */\r\n  @Input() addCatalogAllowed: boolean = false;\r\n\r\n  /**\r\n   * Determine if the form to add a catalog is allowed\r\n   */\r\n  @Input() predefinedCatalogs: Catalog[] = [];\r\n\r\n  /**\r\n   * Event emitted a catalog is selected or unselected\r\n   */\r\n  @Output() catalogSelectChange = new EventEmitter<{\r\n    selected: boolean;\r\n    catalog: Catalog;\r\n  }>();\r\n\r\n  submitDisabled = true;\r\n  private addingCatalog$$: Subscription;\r\n\r\n  get addedCatalogs(): Catalog[] {\r\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\r\n  }\r\n  set addedCatalogs(catalogs: Catalog[]) {\r\n    this.storageService.set('addedCatalogs', catalogs);\r\n  }\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService,\r\n    private storageService: StorageService,\r\n    private dialog: MatDialog\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.store.state.clear();\r\n\r\n    this.predefinedCatalogs = this.predefinedCatalogs.map(c => {\r\n      c.id = Md5.hashStr(\r\n        (c.type || 'wms') + standardizeUrl(c.url)\r\n      ) as string;\r\n      return c;\r\n    });\r\n  }\r\n\r\n  getCatalogs(): Observable<Catalog[]> {\r\n    return this.store.view.all$();\r\n  }\r\n\r\n  /**\r\n   * When a catalog is selected, update it's state in the store\r\n   * and emit the catalog select change event\r\n   * @internal\r\n   */\r\n  onCatalogSelect(catalog: Catalog) {\r\n    this.store.state.update(\r\n      catalog,\r\n      {\r\n        selected: true,\r\n        focused: true\r\n      },\r\n      true\r\n    );\r\n    this.catalogSelectChange.emit({ selected: true, catalog });\r\n  }\r\n\r\n  private unsubscribeAddingCatalog() {\r\n    if (this.addingCatalog$$) {\r\n      this.addingCatalog$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  addCatalog(addedCatalog: Catalog) {\r\n    if (!addedCatalog) {\r\n      return;\r\n    }\r\n    let id = Md5.hashStr(\r\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\r\n    ) as string;\r\n    const predefinedCatalog = this.predefinedCatalogs.find(\r\n      (c) => c.id === addedCatalog.id\r\n    );\r\n\r\n    if (predefinedCatalog) {\r\n      addedCatalog.version = predefinedCatalog.version;\r\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\r\n      id = predefinedCatalog.id;\r\n    }\r\n\r\n    if (this.store.get(id)) {\r\n      const title = this.languageService.translate.instant(\r\n        'igo.geo.catalog.library.inlist.title'\r\n      );\r\n      const message = this.languageService.translate.instant(\r\n        'igo.geo.catalog.library.inlist.message'\r\n      );\r\n      this.messageService.alert(message, title);\r\n      return;\r\n    }\r\n    this.unsubscribeAddingCatalog();\r\n\r\n    this.addingCatalog$$ = this.capabilitiesService\r\n    .getCapabilities(addedCatalog.type as any, addedCatalog.url, addedCatalog.version)\r\n      .pipe(\r\n        catchError((e) => {\r\n          const title = this.languageService.translate.instant(\r\n            'igo.geo.catalog.unavailableTitle'\r\n          );\r\n          if (e.error) {\r\n            this.addCatalogDialog(true, addedCatalog);\r\n            e.error.caught = true;\r\n            return e;\r\n          }\r\n          const message = this.languageService.translate.instant(\r\n            'igo.geo.catalog.unavailable',\r\n            { value: addedCatalog.url }\r\n          );\r\n          this.messageService.error(message, title);\r\n          throw e;\r\n        })\r\n      )\r\n      .subscribe((capabilies) => {\r\n        let title;\r\n        let version;\r\n        switch (addedCatalog.type) {\r\n          case 'wms':\r\n            title = addedCatalog.title || capabilies.Service.Title;\r\n            version = addedCatalog.version || capabilies.version;\r\n            break;\r\n          case 'arcgisrest':\r\n          case 'imagearcgisrest':\r\n          case 'tilearcgisrest':\r\n            title = addedCatalog.title || capabilies.mapName;\r\n            break;\r\n          case 'wmts':\r\n            title =\r\n              addedCatalog.title ||\r\n              capabilies.ServiceIdentification.ServiceType;\r\n            break;\r\n          default:\r\n            title = addedCatalog.title;\r\n        }\r\n\r\n        const catalogToAdd = ObjectUtils.removeUndefined(\r\n          Object.assign({},\r\n            predefinedCatalog,\r\n            ObjectUtils.removeUndefined({\r\n              id,\r\n              title,\r\n              url: addedCatalog.url,\r\n              type: addedCatalog.type || 'wms',\r\n              externalProvider: addedCatalog.externalProvider || false,\r\n              removable: true,\r\n              version\r\n            })) as Catalog);\r\n        this.store.insert(catalogToAdd);\r\n        const newCatalogs = this.addedCatalogs.slice(0);\r\n        newCatalogs.push(catalogToAdd);\r\n        this.addedCatalogs = newCatalogs;\r\n        this.unsubscribeAddingCatalog();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribeAddingCatalog();\r\n  }\r\n\r\n  onCatalogRemove(catalog) {\r\n    this.store.delete(catalog);\r\n    this.addedCatalogs = this.addedCatalogs\r\n      .slice(0)\r\n      .filter((c) => c.id !== catalog.id);\r\n  }\r\n\r\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\r\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\r\n      width: '700px',\r\n      data: {\r\n        predefinedCatalogs: this.predefinedCatalogs,\r\n        store: this.store,\r\n        error,\r\n        addedCatalog\r\n      }\r\n    });\r\n\r\n    dialogRef.afterClosed().subscribe((catalog) => {\r\n      this.addCatalog(catalog);\r\n    });\r\n  }\r\n}\r\n","<mat-list-item>\r\n  <h4 mat-line>\r\n    {{title}}\r\n  </h4>\r\n  <mat-icon\r\n    class=\"igo-external-provider\"\r\n    *ngIf=\"catalog.externalProvider\"\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\r\n    color=\"primary\"\r\n    (click)=\"$event.stopPropagation()\"\r\n    svgIcon=\"earth-arrow-right\">\r\n  </mat-icon>\r\n\r\n  <button\r\n  *ngIf=\"catalog.removable\"\r\n  mat-icon-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\r\n  color=\"warn\"\r\n  (click)=\"removeCatalogFromLibrary($event)\">\r\n  <mat-icon svgIcon=\"delete\"></mat-icon>\r\n</button>\r\n\r\n<button\r\n  class=\"igo-blank\"\r\n  *ngIf=\"!catalog.removable\"\r\n  disabled=\"true\"\r\n  mat-icon-button>\r\n  <mat-icon svgIcon=\"blank\"></mat-icon>\r\n</button>\r\n</mat-list-item>\r\n","import { Component, Input, ChangeDetectionStrategy, Output, EventEmitter } from '@angular/core';\r\n\r\nimport { getEntityTitle } from '@igo2/common';\r\nimport { IgoMap } from '../../map';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\n\r\n/**\r\n * Catalog library item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-library-item',\r\n  templateUrl: './catalog-library-item.component.html',\r\n  styleUrls: ['./catalog-library-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibaryItemComponent {\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  @Output() catalogRemove = new EventEmitter();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string { return getEntityTitle(this.catalog); }\r\n\r\n  removeCatalogFromLibrary(event) {\r\n    event.stopPropagation();\r\n    this.catalogRemove.emit();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoListModule } from '@igo2/common';\r\n\r\nimport { CatalogLibaryComponent, } from './catalog-library.component';\r\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\r\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\r\n\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatBadgeModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoListModule,\r\n    IgoLanguageModule,\r\n    MatButtonModule,\r\n    MatFormFieldModule,\r\n    ReactiveFormsModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatAutocompleteModule,\r\n    MatDialogModule\r\n  ],\r\n  exports: [\r\n    CatalogLibaryComponent,\r\n    AddCatalogDialogComponent\r\n  ],\r\n  declarations: [\r\n    CatalogLibaryComponent,\r\n    CatalogLibaryItemComponent,\r\n    AddCatalogDialogComponent\r\n  ]\r\n})\r\nexport class IgoCatalogLibraryModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoListModule, IgoCollapsibleModule, IgoMatBadgeIconModule } from '@igo2/common';\r\n\r\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\r\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule\r\n  ],\r\n  exports: [\r\n    IgoCatalogBrowserModule,\r\n    IgoCatalogLibraryModule\r\n  ],\r\n  declarations: []\r\n})\r\nexport class IgoCatalogModule {}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { DataSource } from '../../datasource/shared/datasources/datasource';\r\n\r\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\r\nimport { TimeFilterableDataSource } from './time-filter.interface';\r\n\r\n@Pipe({\r\n  name: 'filterableDataSource'\r\n})\r\nexport class FilterableDataSourcePipe implements PipeTransform {\r\n  transform(value: Layer[], arg: string): Layer[] {\r\n    let layers;\r\n\r\n    if (arg === 'time') {\r\n      layers = value.filter((layer: Layer) => {\r\n        const datasource = layer.dataSource as TimeFilterableDataSource;\r\n        return (\r\n          this.isTimeFilterable(datasource) &&\r\n          datasource.options.timeFilter !== undefined &&\r\n          Object.keys(datasource.options.timeFilter).length\r\n        );\r\n      });\r\n    }\r\n    if (arg === 'ogc') {\r\n      layers = value.filter((layer: Layer) => {\r\n        const datasource = layer.dataSource as OgcFilterableDataSource;\r\n        return this.isOgcFilterable(datasource);\r\n      });\r\n    }\r\n    return layers;\r\n  }\r\n\r\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\r\n    if (dataSource.options.type !== 'wms') {\r\n      return false;\r\n    }\r\n    return dataSource.options.timeFilterable;\r\n  }\r\n\r\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\r\n    let isOgcFilterable = false;\r\n    if (\r\n      dataSource.options.ogcFilters &&\r\n      dataSource.options.ogcFilters.enabled &&\r\n      dataSource.options.ogcFilters.editable\r\n    ) {\r\n      isOgcFilterable = true;\r\n    }\r\n    if (\r\n      dataSource.options.ogcFilters &&\r\n      dataSource.options.ogcFilters.enabled &&\r\n      (\r\n        dataSource.options.ogcFilters.pushButtons ||\r\n        dataSource.options.ogcFilters.checkboxes ||\r\n        dataSource.options.ogcFilters.radioButtons ||\r\n        dataSource.options.ogcFilters.select)) {\r\n        isOgcFilterable = true;\r\n    }\r\n    return isOgcFilterable;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\r\n\r\n@Injectable()\r\nexport class TimeFilterService {\r\n  constructor() {}\r\n\r\n  filterByDate(\r\n    datasource: WMSDataSource | TileArcGISRestDataSource,\r\n    date: Date | [Date, Date]\r\n  ) {\r\n    let time;\r\n    let newdateform;\r\n    let newdateformStart;\r\n    let newdateformEnd;\r\n\r\n    if (Array.isArray(date)) {\r\n      const dates = [];\r\n      if (date[0]) {\r\n        newdateformStart = this.reformatDateTime(date[0]);\r\n        dates.push(date[0]);\r\n      }\r\n      if (date[1]) {\r\n        newdateformEnd = this.reformatDateTime(date[1]);\r\n        dates.push(date[1]);\r\n      }\r\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\r\n        if (datasource instanceof TileArcGISRestDataSource) {\r\n          time = newdateformStart + ',' + newdateformEnd;\r\n        } else {\r\n          time = newdateformStart + '/' + newdateformEnd;\r\n        }\r\n      }\r\n      if (newdateformStart === newdateformEnd) {\r\n        time = newdateformStart;\r\n      }\r\n    } else if (date) {\r\n      newdateform = this.reformatDateTime(date);\r\n      time = newdateform;\r\n    }\r\n\r\n    const params = { TIME: time };\r\n    datasource.ol.updateParams(params);\r\n    if (datasource instanceof WMSDataSource) {\r\n      const wmsDataSource  = datasource as WMSDataSource;\r\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\r\n    }\r\n  }\r\n\r\n  filterByYear(\r\n    datasource: WMSDataSource | TileArcGISRestDataSource,\r\n    year: string | [string, string]\r\n  ) {\r\n    let time;\r\n    let newdateformStart;\r\n    let newdateformEnd;\r\n\r\n    if (Array.isArray(year)) {\r\n      const years = [];\r\n      if (year[0]) {\r\n        newdateformStart = year[0];\r\n        years.push(year[0]);\r\n      }\r\n      if (year[1]) {\r\n        newdateformEnd = year[1];\r\n        years.push(year[1]);\r\n      }\r\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\r\n        if (datasource instanceof TileArcGISRestDataSource) {\r\n          time = newdateformStart + ',' + newdateformEnd;\r\n        } else {\r\n          time = newdateformStart + '/' + newdateformEnd;\r\n        }\r\n      }\r\n      if (newdateformStart === newdateformEnd) {\r\n        time = newdateformStart;\r\n      }\r\n    } else {  // to reset filter.\r\n      time = year;\r\n    }\r\n\r\n    const params = { TIME: time };\r\n    datasource.ol.updateParams(params);\r\n    if (datasource instanceof WMSDataSource) {\r\n      const wmsDataSource  = datasource as WMSDataSource;\r\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\r\n    }\r\n  }\r\n\r\n  private reformatDateTime(value) {\r\n    const year = value.getFullYear();\r\n    let month = value.getMonth() + 1;\r\n    let day = value.getUTCDate();\r\n    let hour = value.getUTCHours();\r\n    let minute = value.getUTCMinutes();\r\n\r\n    if (Number(month) < 10) {\r\n      month = '0' + month;\r\n    }\r\n\r\n    if (Number(day) < 10) {\r\n      day = '0' + day;\r\n    }\r\n\r\n    if (Number(hour) < 10) {\r\n      hour = '0' + hour;\r\n    }\r\n\r\n    if (Number(minute) < 10) {\r\n      minute = '0' + minute;\r\n    }\r\n\r\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { OgcFilterWriter } from './ogc-filter';\r\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\r\n\r\n@Injectable()\r\nexport class OGCFilterService {\r\n  constructor() {}\r\n\r\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\r\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(filterString, wmsDatasource.options.params.LAYERS);\r\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\r\n  }\r\n\r\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\r\n    const options: any = wfsDatasource.options;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\r\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\r\n        options.ogcFilters.filters,\r\n        options.paramsWFS.fieldNameGeometry,\r\n        new olProjection({ code: options.paramsWFS.srsName }),\r\n        true\r\n      );\r\n      if (!options.ogcFilters.interfaceOgcFilters) {\r\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\r\n          options.ogcFilters.filters,\r\n          options.paramsWFS.fieldNameGeometry\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\r\n    const options: any = wmsDatasource.options;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\r\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\r\n        options.ogcFilters.filters,\r\n        options.fieldNameGeometry,\r\n        undefined,\r\n        true\r\n      );\r\n      if (!options.ogcFilters.interfaceOgcFilters) {\r\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\r\n          // With some wms server, this param must be set to make spatials call.\r\n          options.ogcFilters.filters,\r\n          options.fieldNameGeometry\r\n        );\r\n      }\r\n      this.filterByOgc(\r\n        wmsDatasource as WMSDataSource,\r\n        ogcFilterWriter.buildFilter(options.ogcFilters.filters,\r\n        undefined,\r\n        undefined,\r\n        undefined,\r\n        wmsDatasource.options\r\n        )\r\n      );\r\n      options.filtered = true;\r\n    } else {\r\n      options.ogcFilters.filters = undefined;\r\n      options.ogcFilters.interfaceOgcFilters = [];\r\n      options.filtered = false;\r\n    }\r\n  }\r\n}\r\n","export enum SpatialFilterQueryType {\r\n    AdmRegion = 'AdmRegion',\r\n    Mun = 'Mun',\r\n    Arrond = 'Arrond',\r\n    CircFed = 'CircFed',\r\n    CircProv = 'CircProv',\r\n    DirReg = 'DirReg',\r\n    MRC = 'MRC',\r\n    RegTour = 'RegTour'\r\n}\r\n\r\nexport enum SpatialFilterType {\r\n    Predefined = 'Predefined',\r\n    Polygon = 'Polygon',\r\n    Point = 'Point'\r\n}\r\n\r\nexport enum SpatialFilterItemType {\r\n    Address = 'Address',\r\n    Thematics = 'Thematics'\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\nimport { map } from 'rxjs/operators';\r\nimport { Observable } from 'rxjs';\r\nimport { Feature } from '../../feature/shared';\r\nimport {\r\n  SpatialFilterQueryType,\r\n  SpatialFilterItemType,\r\n  SpatialFilterType\r\n} from './spatial-filter.enum';\r\nimport { SpatialFilterThematic } from './spatial-filter.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SpatialFilterService {\r\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\r\n\r\n  /*\r\n   * Type association with URL\r\n   */\r\n  public urlFilterList = {\r\n    AdmRegion: 'regadmin',\r\n    Arrond: 'arrondissements',\r\n    CircFed: 'circ-fed',\r\n    CircProv: 'circ-prov',\r\n    DirReg: 'dir-reg',\r\n    MRC: 'mrc',\r\n    Mun: 'municipalites',\r\n    RegTour: 'tourisme',\r\n    bornes: 'bornes-sumi',\r\n    hydro: 'hydro',\r\n    routes: 'routes'\r\n  };\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    private configService: ConfigService\r\n  ) {\r\n    this.baseUrl =\r\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\r\n  }\r\n\r\n  getKeyByValue(object, value) {\r\n    return Object.keys(object).find(key => object[key] === value);\r\n  }\r\n\r\n  /*\r\n   * Loading data for spatial filter list component (NO GEOMETRY)\r\n   */\r\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\r\n    const urlPath = type as string;\r\n    if (urlPath) {\r\n      return this.http\r\n        .get<{ features: Feature[] }>(\r\n          this.baseUrl + this.urlFilterList[urlPath]\r\n        )\r\n        .pipe(\r\n          map(featureCollection =>\r\n            featureCollection.features.map(f => {\r\n              f.meta = {\r\n                id: f.properties.code\r\n              };\r\n              return f;\r\n            })\r\n          )\r\n        );\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Loading item list (STRING)\r\n   */\r\n  loadThematicsList() {\r\n    const url = 'types';\r\n    const items: SpatialFilterThematic[] = [];\r\n    return this.http.get(this.baseUrl + url).pipe(\r\n      map((types: string[]) => {\r\n        types.forEach(type => {\r\n          if (type.startsWith('lieux')) {\r\n            const item: SpatialFilterThematic = {\r\n              name: undefined,\r\n              source: type\r\n            };\r\n            let substr = type.substring(6, type.length);\r\n            let name = substr;\r\n            if (substr.includes('.')) {\r\n              const index = substr.indexOf('.');\r\n              name = substr.substring(index + 1, substr.length);\r\n              substr = substr.substring(0, index);\r\n            }\r\n            try {\r\n              item.name = this.languageService.translate.instant(\r\n                'igo.geo.terrapi.' + name\r\n              );\r\n            } catch (e) {\r\n              item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\r\n            }\r\n\r\n            try {\r\n              item.group = this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.group.' + substr\r\n              );\r\n            } catch (e) {\r\n              item.group = substr.substring(0, 1).toUpperCase() + substr.substring(1, name.length - 1);\r\n            }\r\n\r\n            items.push(item);\r\n          } else {\r\n            if (this.getKeyByValue(this.urlFilterList, type)) {\r\n              const item: SpatialFilterThematic = {\r\n                name: undefined,\r\n                source: type\r\n              };\r\n              const name = this.getKeyByValue(this.urlFilterList, type);\r\n              try {\r\n                item.name = this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.' + name\r\n                );\r\n              } catch (e) {\r\n                item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\r\n              }\r\n              item.source = type;\r\n\r\n              items.push(item);\r\n            }\r\n          }\r\n        });\r\n        return items;\r\n      })\r\n    );\r\n  }\r\n\r\n  /*\r\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\r\n   */\r\n  loadFilterItem(\r\n    feature,\r\n    itemType: SpatialFilterItemType,\r\n    type?: SpatialFilterQueryType,\r\n    thematic?: SpatialFilterThematic,\r\n    buffer?: number\r\n  ) {\r\n    if (type) {\r\n      // Predefined type\r\n      const urlType = type as string;\r\n      const url = this.baseUrl + this.urlFilterList[urlType];\r\n      let urlItem = '';\r\n      if (itemType === SpatialFilterItemType.Address) {\r\n        urlItem = 'adresses';\r\n        return this.http\r\n          .get<{ features: Feature[] }>(\r\n            url + '/' + feature.properties.code + '/' + urlItem,\r\n            {\r\n              params: {\r\n                geometry: 'true',\r\n                icon: 'true',\r\n                bufferInput: buffer.toString(),\r\n                simplified: '100'\r\n              }\r\n            }\r\n          )\r\n          .pipe(\r\n            map(featureCollection =>\r\n              featureCollection.features.map(f => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: this.languageService.translate.instant(\r\n                    'igo.geo.spatialFilter.Address'\r\n                  ),\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      } else {\r\n        // If thematics search\r\n        urlItem = thematic.source;\r\n        return this.http\r\n          .get<{ features: Feature[] }>(\r\n            url + '/' + feature.properties.code + '/' + urlItem,\r\n            {\r\n              params: {\r\n                geometry: 'true',\r\n                icon: 'true',\r\n                bufferInput: buffer.toString(),\r\n                simplified: '100'\r\n              }\r\n            }\r\n          )\r\n          .pipe(\r\n            map(featureCollection =>\r\n              featureCollection.features.map(f => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: thematic.name,\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      }\r\n    } else {\r\n      // Draw type\r\n      const url = this.baseUrl + 'locate';\r\n      if (itemType === SpatialFilterItemType.Address) {\r\n        const urlItem = '?type=adresses';\r\n        return this.http\r\n          .post<{ features: Feature[] }>(url + urlItem, {\r\n            geometry: 'true',\r\n            icon: 'true',\r\n            loc: JSON.stringify(feature),\r\n            bufferInput: buffer.toString(),\r\n            simplified: '100'\r\n          })\r\n          .pipe(\r\n            map(featureCollection =>\r\n              featureCollection.features.map(f => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: this.languageService.translate.instant(\r\n                    'igo.geo.spatialFilter.Address'\r\n                  ),\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      } else {\r\n        // If thematics search\r\n        const urlItem = '?type=' + thematic.source;\r\n        return this.http\r\n          .post<{ features: Feature[] }>(url + urlItem, {\r\n            geometry: 'true',\r\n            icon: 'true',\r\n            loc: JSON.stringify(feature),\r\n            bufferInput: buffer.toString(),\r\n            simplified: '100'\r\n          })\r\n          .pipe(\r\n            map(featureCollection =>\r\n              featureCollection.features.map(f => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: thematic.name,\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get one territory by id (WITH GEOMETRY)\r\n   */\r\n  loadItemById(\r\n    feature: Feature,\r\n    type: SpatialFilterQueryType\r\n  ): Observable<Feature> {\r\n    const featureType = this.urlFilterList[type];\r\n    const featureCode = '/' + feature.properties.code;\r\n    if (featureType && featureCode) {\r\n      return this.http\r\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\r\n          params: {\r\n            geometry: 'true'\r\n          }\r\n        })\r\n        .pipe(\r\n          map(f => {\r\n            f.meta = {\r\n              id: f.properties.code,\r\n              alias: f.properties.nom,\r\n              title: f.properties.nom\r\n            };\r\n            return f;\r\n          })\r\n        );\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get buffer geometry\r\n   */\r\n  loadBufferGeometry(\r\n    feature: Feature,\r\n    filterType: SpatialFilterType,\r\n    buffer?: number,\r\n    type?: SpatialFilterQueryType,\r\n  ): Observable<Feature> {\r\n    if (filterType === SpatialFilterType.Predefined) {\r\n      const featureType = this.urlFilterList[type];\r\n      const featureCode = '/' + feature.properties.code;\r\n      if (featureType && featureCode) {\r\n        return this.http\r\n          .get<Feature>(this.baseUrl + featureType + featureCode,\r\n            {\r\n              params: {\r\n                geometry: '100',\r\n                bufferOutput: buffer.toString()\r\n              }\r\n            }\r\n          )\r\n          .pipe(\r\n            map(f => {\r\n              f.meta = {\r\n                id: f.properties.code,\r\n                alias: f.properties.nom,\r\n                title: f.properties.nom\r\n              };\r\n              return f;\r\n            })\r\n          );\r\n      }\r\n    } else {\r\n      return this.http\r\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\r\n          buffer,\r\n          loc: JSON.stringify(feature)\r\n        })\r\n        .pipe(\r\n          map(f => {\r\n            return f;\r\n          })\r\n        );\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport olProjection from 'ol/proj/Projection';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\n\r\nimport { Layer } from '../../layer/shared';\r\nimport { OgcFilterWriter, OgcFilterableDataSourceOptions } from '../../filter/shared';\r\n\r\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DownloadService {\r\n\r\n  constructor(\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  open(layer: Layer) {\r\n    const translate = this.languageService.translate;\r\n    const title = translate.instant('igo.geo.download.title');\r\n    this.messageService.success(\r\n      translate.instant('igo.geo.download.start'),\r\n      title\r\n    );\r\n\r\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\r\n    if (Object.keys(DSOptions.download).length > 0) {\r\n      if (\r\n        DSOptions.download.dynamicUrl &&\r\n        DSOptions.download.url === undefined\r\n      ) {\r\n        let wfsOptions;\r\n        let currentProj = new olProjection({ code: layer.map.projection });\r\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\r\n        if (paramsWFS && Object.keys(paramsWFS).length > 0\r\n        ) {\r\n          currentProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : currentProj;\r\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\r\n        } else {\r\n          wfsOptions = (layer.dataSource.options as any).params;\r\n        }\r\n\r\n        const currentExtent = olproj.transformExtent(\r\n          layer.map.viewController.getExtent(),\r\n          new olProjection({ code: layer.map.projection }),\r\n          currentProj\r\n        );\r\n        const outputFormatDownload =\r\n          wfsOptions.outputFormatDownload === undefined\r\n            ? wfsOptions.outputFormat === undefined  ? '' : 'outputformat=' + wfsOptions.outputFormat\r\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\r\n\r\n        const baseurl = DSOptions.download.dynamicUrl\r\n          .replace(/&?outputformat=[^&]*/gi, '')\r\n          .replace(/&?filter=[^&]*/gi, '')\r\n          .replace(/&?bbox=[^&]*/gi, '');\r\n\r\n        const ogcFilters = (layer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n\r\n        let filterQueryString;\r\n        filterQueryString = new OgcFilterWriter()\r\n        .handleOgcFiltersAppliedValue(\r\n          layer.dataSource.options,\r\n          ogcFilters.geometryName,\r\n          currentExtent as [number, number, number, number],\r\n          currentProj);\r\n        if (!filterQueryString) {\r\n          // Prevent getting all the features for empty filter\r\n            filterQueryString = new OgcFilterWriter().buildFilter(\r\n            undefined,\r\n            currentExtent as [number, number, number, number],\r\n            currentProj,\r\n            ogcFilters.geometryName\r\n          );\r\n        } else {\r\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\r\n        }\r\n        window.open(\r\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\r\n          '_blank'\r\n        );\r\n      } else if (DSOptions.download) {\r\n        window.open(DSOptions.download.url, '_blank');\r\n      }\r\n    }\r\n  }\r\n}\r\n","<button\r\n  *ngIf=\"options && options.download && (options.download['dynamicUrl'] || options.download['url']) \"\r\n  mat-icon-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\r\n  [color]=\"color\"\r\n  (click)=\"openDownload(layer)\">\r\n  <mat-icon svgIcon=\"download\"></mat-icon>\r\n</button>\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\r\nimport { DownloadService } from '../shared/download.service';\r\n\r\n@Component({\r\n  selector: 'igo-download-button',\r\n  templateUrl: './download-button.component.html',\r\n  styleUrls: ['./download-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class DownloadButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor(private downloadService: DownloadService) {}\r\n\r\n  openDownload(layer: Layer) {\r\n    this.downloadService.open(layer);\r\n  }\r\n\r\n  get options(): DownloadDataSourceOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.dataSource.options;\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { DownloadButtonComponent } from './download-button/download-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [DownloadButtonComponent],\r\n  declarations: [DownloadButtonComponent]\r\n})\r\nexport class IgoDownloadModule {\r\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\r\n    return {\r\n      ngModule: IgoDownloadModule\r\n    };\r\n  }\r\n}\r\n","<table class=\"igo-striped mat-typography\" *ngIf=\"ready && feature && isObject(feature.properties) && feature.properties.target !== 'iframe'\">\r\n  <tbody>\r\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\r\n\r\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\r\n        <mat-icon mat-list-avatar svgIcon=\"{{icon}}\"></mat-icon>\r\n      </td>\r\n\r\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\r\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\"> {{ 'igo.geo.targetHtmlUrl' | translate }} {{title}}</a>\r\n      </td>\r\n\r\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\r\n        {{property.key }}\r\n      </td>\r\n\r\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value)\" [innerHTML]=\"property.value\">\r\n      </td>\r\n\r\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value)\">\r\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\">\r\n          <img *ngIf=\"isImg(property.value);else notImg\" src=\"{{(property.value | secureImage) |async}}\" width=\"225\" heigth=\"auto\">\r\n          <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\r\n        </a>\r\n      </td>\r\n\r\n      <td *ngIf=\"feature.properties.target === undefined && isObject(property.value)\" [innerHTML]=\"property.value | json\">\r\n      </td>\r\n\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<iframe *ngIf=\"isHtmlDisplay()\" [srcdoc]=\"htmlSanitizer(feature.properties)\" [src]=\"urlSanitizer(feature.properties.url)\"></iframe>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\nimport { userAgent } from '@igo2/utils';\r\nimport { NetworkService, ConnectionState } from '@igo2/core';\r\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\r\nimport type { Toolbox } from '@igo2/common';\r\n\r\nimport { Feature } from '../shared';\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\nimport { IgoMap } from '../../map/shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-feature-details',\r\n  templateUrl: './feature-details.component.html',\r\n  styleUrls: ['./feature-details.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\n\r\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\r\n  private state: ConnectionState;\r\n  private unsubscribe$ = new Subject<void>();\r\n  ready = false;\r\n\r\n  @Input()\r\n  get source(): SearchSource {\r\n    return this._source;\r\n  }\r\n  set source(value: SearchSource) {\r\n    this._source = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() toolbox: Toolbox;\r\n\r\n  @Input()\r\n  get feature(): Feature {\r\n    return this._feature;\r\n  }\r\n  set feature(value: Feature) {\r\n    this._feature = value;\r\n    this.cdRef.detectChanges();\r\n    this.selectFeature.emit();\r\n  }\r\n\r\n  private _feature: Feature;\r\n  private _source: SearchSource;\r\n\r\n  @Output() routeEvent = new EventEmitter<boolean>();\r\n  @Output() selectFeature = new EventEmitter<boolean>();\r\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.feature);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.feature) || 'link';\r\n  }\r\n\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private sanitizer: DomSanitizer,\r\n    private networkService: NetworkService\r\n  ) {\r\n    this.networkService.currentState().pipe(takeUntil(this.unsubscribe$)).subscribe((state: ConnectionState) => {\r\n      this.state = state;\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.ready = true;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribe$.next();\r\n    this.unsubscribe$.complete();\r\n  }\r\n\r\n  urlSanitizer(value): SafeResourceUrl {\r\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\r\n  }\r\n\r\n\r\n  isHtmlDisplay(): boolean {\r\n    if (this.feature && this.isObject(this.feature.properties) && this.feature.properties.target === 'iframe') {\r\n      this.htmlDisplayEvent.emit(true);\r\n      return true;\r\n    } else {\r\n      this.htmlDisplayEvent.emit(false);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  htmlSanitizer(value): SafeResourceUrl {\r\n    if (!value.body || userAgent.getBrowserName() === 'Internet Explorer') {\r\n      return;\r\n    }\r\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\r\n    if (!regexBase.test(value.body)) {\r\n      const url = new URL(value.url, window.location.origin);\r\n      value.body = value.body.replace('<head>', `<head><base href=\"${url.origin}\">`);\r\n    }\r\n\r\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\r\n  }\r\n\r\n  isObject(value) {\r\n    return typeof value === 'object';\r\n  }\r\n\r\n  isUrl(value) {\r\n    if (typeof value === 'string') {\r\n      return (\r\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  isImg(value) {\r\n    if (this.isUrl(value)) {\r\n      return (\r\n        ['jpg', 'png', 'gif'].includes(value.split('.').pop().toLowerCase())\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  filterFeatureProperties(feature) {\r\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\r\n    const properties = {};\r\n    let offlineButtonState;\r\n\r\n    if (this.map) {\r\n      this.map.offlineButtonToggle$.pipe(takeUntil(this.unsubscribe$)).subscribe(state => {\r\n        offlineButtonState = state;\r\n      });\r\n    }\r\n\r\n    if (feature.properties && feature.properties.Route && this.toolbox && !this.toolbox.getTool('directions')) {\r\n      delete feature.properties.Route;\r\n    }\r\n\r\n    if (allowedFieldsAndAlias) {\r\n      Object.keys(allowedFieldsAndAlias).forEach(field => {\r\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\r\n      });\r\n      return properties;\r\n    } else if (offlineButtonState !== undefined) {\r\n      if (!offlineButtonState) {\r\n        if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\r\n          const excludeAttribute = feature.meta.excludeAttribute;\r\n          excludeAttribute.forEach(attribute => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\r\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n          excludeAttributeOffline.forEach(attribute => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        }\r\n      } else {\r\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\r\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n          excludeAttributeOffline.forEach(attribute => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\r\n        const excludeAttribute = feature.meta.excludeAttribute;\r\n        excludeAttribute.forEach(attribute => {\r\n          delete feature.properties[attribute];\r\n        });\r\n      } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\r\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n        excludeAttributeOffline.forEach(attribute => {\r\n          delete feature.properties[attribute];\r\n        });\r\n      }\r\n    }\r\n    return feature.properties;\r\n  }\r\n}\r\n","export enum GeometryType {\r\n    Point = 'Point',\r\n    LineString = 'LineString',\r\n    Polygon = 'Polygon',\r\n    Circle = 'Circle'\r\n}\r\n","import OlCircle from 'ol/geom/Circle';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olstyle from 'ol/style';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlLinearRing from 'ol/geom/LinearRing';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport BasicEvent from 'ol/events/Event';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport lineIntersect from '@turf/line-intersect';\r\nimport { lineString } from '@turf/helpers';\r\n\r\nimport {\r\n  GeometrySliceMultiPolygonError,\r\n  GeometrySliceLineStringError,\r\n  GeometrySliceTooManyIntersectionError\r\n } from './geometry.errors';\r\n\r\n/**\r\n * Create a default style for draw and modify interactions\r\n * @param color Style color (R, G, B)\r\n * @returns OL style\r\n */\r\nexport function createDrawInteractionStyle(color?: [number, number, number]): olstyle.Circle {\r\n  color = color || [0, 153, 255];\r\n  return new olstyle.Circle({\r\n    stroke: new olstyle.Stroke({\r\n      color: color.concat([1]),\r\n      width: 2\r\n    }),\r\n    fill:  new olstyle.Fill({\r\n      color: color.concat([0.2])\r\n    }),\r\n    radius: 8\r\n  });\r\n}\r\n\r\n/**\r\n * Create a default style for drawing a hole\r\n * @returns OL style\r\n */\r\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color:  [0, 153, 255, 1],\r\n      width: 2\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Slice geometry into two parts\r\n * @param olGeometry OL geometry\r\n * @param olSlicer Slicing line\r\n * @returns New OL geometries\r\n */\r\nexport function sliceOlGeometry(\r\n  olGeometry: OlLineString | OlPolygon,\r\n  olSlicer: OlLineString\r\n): Array<OlLineString | OlPolygon> {\r\n  if (olGeometry instanceof OlPolygon) {\r\n    return sliceOlPolygon(olGeometry, olSlicer);\r\n  } else if (olGeometry instanceof OlLineString) {\r\n    return sliceOlLineString(olGeometry, olSlicer);\r\n  }\r\n  return [];\r\n}\r\n\r\n/**\r\n * Slice OL LineString into one or more lines\r\n * @param olLineString OL line string\r\n * @param olSlicer Slicing line\r\n * @returns New OL line strings\r\n */\r\nexport function sliceOlLineString(olLineString: OlLineString, olSlicer: OlLineString): OlLineString[] {\r\n  return [];\r\n}\r\n\r\n/**\r\n * Slice OL Polygon into one or more polygons\r\n * @param olPolygon OL polygon\r\n * @param olSlicer Slicing line\r\n * @returns New OL polygons\r\n */\r\nexport function sliceOlPolygon(olPolygon: OlPolygon, olSlicer: OlLineString): OlPolygon[] {\r\n  if (olPolygon.getLinearRingCount() > 1) {\r\n    throw new GeometrySliceMultiPolygonError();\r\n  }\r\n\r\n  if (olSlicer.getCoordinates().length > 2) {\r\n    throw new GeometrySliceLineStringError();\r\n  }\r\n\r\n  const olGeoJSON = new OlGeoJSON();\r\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\r\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\r\n\r\n  const parts = [[], []];\r\n  let totalIntersectionCount = 0;\r\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\r\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\r\n    const segment = lineString(segmentCoordinates);\r\n    const intersections = lineIntersect(segment, slicer).features;\r\n\r\n    const intersectionCount = intersections.length;\r\n    totalIntersectionCount += intersectionCount;\r\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\r\n      throw new GeometrySliceTooManyIntersectionError();\r\n    }\r\n\r\n    parts[0].push(segmentCoordinates[0]);\r\n    if (intersectionCount === 1) {\r\n      const intersection = intersections[0].geometry.coordinates;\r\n      parts[0].push(intersection);\r\n      parts[1].push(intersection);\r\n      parts.reverse();\r\n    }\r\n  }\r\n\r\n  if (totalIntersectionCount <= 1) {\r\n    return [];\r\n  }\r\n\r\n  parts[0].push(parts[0][0]);\r\n  parts[1].push(parts[1][0]);\r\n\r\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\r\n}\r\n\r\n/**\r\n * Splice geometry into two parts\r\n * @param olGeometry OL geometry\r\n * @param olSlicer Slicing line\r\n * @returns New OL geometries\r\n */\r\nexport function addLinearRingToOlPolygon(olPolygon: OlPolygon, olLinearRing: OlLinearRing ) {\r\n  // TODO: make some validation and support updating an existing linear ring\r\n  olPolygon.appendLinearRing(olLinearRing);\r\n}\r\n\r\nexport function getMousePositionFromOlGeometryEvent(\r\n  olEvent: BasicEvent\r\n) {\r\n  const olGeometry = olEvent.target as OlGeometry;\r\n  if (olGeometry instanceof OlPolygon) {\r\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\r\n  }\r\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\r\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\r\n}\r\n","/* tslint:disable */\r\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\r\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n// for an explanation as to why the prototype is set manually\r\n/* tslint:enable */\r\n\r\nexport class GeometrySliceError extends Error {}\r\n\r\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\r\n  constructor() {\r\n    super('Can\\'t slice a MultiPolygon.');\r\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\r\n  }\r\n}\r\n\r\nexport class GeometrySliceLineStringError extends GeometrySliceError {\r\n  constructor() {\r\n    super('Can\\'t slice with a line that has more than 2 points.');\r\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\r\n  }\r\n}\r\n\r\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\r\n  constructor() {\r\n    super('More than 2 intersections found between the target polygon and the slicing line.');\r\n    Object.setPrototypeOf(this, GeometrySliceTooManyIntersectionError.prototype);\r\n  }\r\n}\r\n","import { EventsKey } from 'ol/events';\r\nimport OlMap from 'ol/Map';\r\nimport OlFeature from 'ol/Feature';\r\nimport * as OlStyle from 'ol/style';\r\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlDraw from 'ol/interaction/Draw';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlModify from 'ol/interaction/Modify';\r\nimport OlSelect from 'ol/interaction/Select';\r\nimport BasicEvent from 'ol/events/Event';\r\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\r\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { doubleClick } from 'ol/events/condition';\r\n\r\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\r\n\r\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\r\n\r\nexport interface DrawControlOptions {\r\n  geometryType: typeof OlGeometryType | string;\r\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\r\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\r\n  drawingLayerStyle?: OlStyle.Style | ((olFeature: OlFeature<OlGeometry>) => OlStyle.Style);\r\n  interactionStyle?: OlStyle.Style | ((olFeature: OlFeature<OlGeometry>) => OlStyle.Style);\r\n  maxPoints?: number;\r\n}\r\n\r\n/**\r\n * Control to draw entities\r\n */\r\nexport class DrawControl {\r\n  /**\r\n   * Draw start observable\r\n   */\r\n  public start$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw end observable\r\n   */\r\n  public end$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw changes observable (while drawing)\r\n   */\r\n  public changes$: Subject<any> = new Subject();\r\n\r\n  /**\r\n   * Draw modify observable (modify drawn features)\r\n   */\r\n  public modify$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw select observable (modify drawn features)\r\n   */\r\n  public select$: Subject<any> =  new Subject();\r\n\r\n  /**\r\n   * Freehand mode observable (defaults to false)\r\n   */\r\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private keyDown$$: Subscription;\r\n\r\n  private olGeometryType: typeof OlGeometryType | undefined | string;\r\n  private olMap: OlMap;\r\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\r\n  private olDrawInteraction: OlDraw;\r\n  private olSelectInteraction: OlSelect;\r\n  private olModifyInteraction: OlModify;\r\n  private onDrawStartKey: EventsKey;\r\n  private onDrawEndKey: EventsKey;\r\n  private onDrawKey: EventsKey;\r\n\r\n  private mousePosition: [number, number];\r\n\r\n  /**\r\n   * Wheter the control is active\r\n   */\r\n  get active(): boolean {\r\n    return this.olMap !== undefined;\r\n  }\r\n\r\n  /**\r\n   * OL overlay source\r\n   * @internal\r\n   */\r\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\r\n    return this.olDrawingLayer.getSource();\r\n  }\r\n\r\n  constructor(private options: DrawControlOptions) {\r\n    this.olDrawingLayer = options.drawingLayer ? options.drawingLayer : this.createOlInnerOverlayLayer();\r\n    this.olGeometryType = this.options.geometryType;\r\n  }\r\n\r\n  /**\r\n   * Add or remove this control to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\r\n    if (!olMap) {\r\n      this.clearOlInnerOverlaySource();\r\n      this.removeOlInnerOverlayLayer();\r\n      this.removeOlInteractions();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n    this.addOlInnerOverlayLayer();\r\n    this.addOlInteractions(activateModifyAndSelect);\r\n  }\r\n\r\n  /**\r\n   * Return the drawing layer source\r\n   */\r\n  getSource(): OlVectorSource<OlGeometry> {\r\n    return this.olDrawingLayerSource;\r\n  }\r\n\r\n  /**\r\n   * Set the current geometry type\r\n   * @param geometryType the geometry type\r\n   */\r\n  setGeometryType(geometryType: typeof OlGeometryType) {\r\n    this.olGeometryType = geometryType;\r\n  }\r\n\r\n  /**\r\n   * Create a drawing source if none is defined in the options\r\n   */\r\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource<OlGeometry>> {\r\n    return new OlVectorLayer({\r\n      source: this.options.drawingLayerSource ? this.options.drawingLayerSource : new OlVectorSource(),\r\n      style: this.options.drawingLayerStyle,\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the drawing layer if it wasn't defined in the options\r\n   */\r\n  private removeOlInnerOverlayLayer() {\r\n    if (!this.options.drawingLayer && this.olMap) {\r\n      this.olMap.removeLayer(this.olDrawingLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the drawing layer if it wasn't defined in the options\r\n   */\r\n  private addOlInnerOverlayLayer() {\r\n    if (!this.options.drawingLayer) {\r\n      this.olMap.addLayer(this.olDrawingLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the drawing layer source if it wasn't defined in the options\r\n   */\r\n  private clearOlInnerOverlaySource() {\r\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\r\n      this.olDrawingLayerSource.clear(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add interactions to the map an set up some listeners\r\n   */\r\n  addOlInteractions(activateModifyAndSelect?: boolean) {\r\n    // Create Draw interaction\r\n    let olDrawInteraction;\r\n    if (!this.freehand$.getValue()) {\r\n      olDrawInteraction = new OlDraw({\r\n        type: this.olGeometryType,\r\n        source: this.getSource(),\r\n        stopClick: true,\r\n        style: this.options.interactionStyle,\r\n        maxPoints: this.options.maxPoints,\r\n        freehand: false,\r\n        freehandCondition: () => false\r\n      });\r\n\r\n    } else {\r\n      if (this.olGeometryType === 'Point') {\r\n        olDrawInteraction = new OlDraw({\r\n          type: 'Circle',\r\n          source: this.getSource(),\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: true\r\n        });\r\n\r\n      } else {\r\n        olDrawInteraction = new OlDraw({\r\n          type: this.olGeometryType,\r\n          source: this.getSource(),\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: true\r\n        });\r\n      }\r\n    }\r\n\r\n    // Add Draw interaction to map and create listeners\r\n    this.olMap.addInteraction(olDrawInteraction);\r\n    this.olDrawInteraction = olDrawInteraction;\r\n\r\n    this.onDrawStartKey = olDrawInteraction.on('drawstart', (event: OlDrawEvent) => this.onDrawStart(event));\r\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) => this.onDrawEnd(event));\r\n\r\n    if (activateModifyAndSelect) {\r\n      // Create a Modify interaction, add it to map and create a listener\r\n      const olModifyInteraction = new OlModify({\r\n        source: this.getSource()\r\n      });\r\n\r\n      this.olMap.addInteraction(olModifyInteraction);\r\n      this.olModifyInteraction = olModifyInteraction;\r\n\r\n      // Create a select interaction and add it to map\r\n      if (!this.olSelectInteraction) {\r\n        const olSelectInteraction = new OlSelect({\r\n          condition: doubleClick,\r\n          style: undefined\r\n        });\r\n        this.olMap.addInteraction(olSelectInteraction);\r\n        this.olSelectInteraction = olSelectInteraction;\r\n\r\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) => this.onSelect(event));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove interactions\r\n   */\r\n  private removeOlInteractions() {\r\n    this.unsubscribeKeyDown();\r\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\r\n\r\n    if (this.olMap) {\r\n      this.olMap.removeInteraction(this.olDrawInteraction);\r\n      this.olMap.removeInteraction(this.olModifyInteraction);\r\n    }\r\n\r\n    this.olDrawInteraction = undefined;\r\n    this.olModifyInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * When drawing starts, clear the overlay and start watching for changes\r\n   * @param event Draw start event\r\n   */\r\n  private onDrawStart(event: OlDrawEvent) {\r\n    const olGeometry = event.feature.getGeometry();\r\n    this.start$.next(olGeometry);\r\n    this.clearOlInnerOverlaySource();\r\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\r\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n      this.changes$.next(olGeometryEvent.target);\r\n    });\r\n    this.subscribeKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When drawing ends, update the drawing (feature) geometry observable and add\r\n   * @param event Draw event (drawend)\r\n   */\r\n  private onDrawEnd(event: OlDrawEvent) {\r\n    this.unsubscribeKeyDown();\r\n    unByKey(this.onDrawKey);\r\n    const olGeometry = event.feature.getGeometry();\r\n    olGeometry.on('change', () => {\r\n      this.modify$.next(olGeometry);\r\n    });\r\n    this.end$.next(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * When a feature is selected, update the selected feature observable\r\n   * @param event Modify event (modifyend)\r\n   */\r\n  private onSelect(event: OlSelectEvent) {\r\n    if (event.selected.length === 1) {\r\n      this.select$.next(event.selected[0]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to key downs used as drawing interaction shorcuts\r\n   */\r\n  private subscribeKeyDown() {\r\n    this.unsubscribeKeyDown();\r\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\r\n      // On Escape or 'c' keydowns, abort the current drawing\r\n      if (event.key === 'Escape') {\r\n        this.olDrawInteraction.abortDrawing();\r\n        return;\r\n      }\r\n\r\n      // On Backspace or 'u' keydowns, remove last vertex of current drawing\r\n      if (event.key === 'Backspace') {\r\n        this.olDrawInteraction.removeLastPoint();\r\n      }\r\n\r\n      // On Enter or 'f' keydowns, finish current drawing\r\n      if (event.key === 'Enter') {\r\n        this.olDrawInteraction.finishDrawing();\r\n      }\r\n\r\n      // On space bar key down, pan to the current mouse position\r\n      if (event.key === ' ') {\r\n        this.olMap.getView().animate({\r\n          center: this.mousePosition,\r\n          duration: 100\r\n        });\r\n        return;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key down\r\n   */\r\n  private unsubscribeKeyDown() {\r\n    if (this.keyDown$$) {\r\n      this.keyDown$$.unsubscribe();\r\n      this.keyDown$$ = undefined;\r\n    }\r\n  }\r\n}\r\n","import { Component, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\n\r\nexport interface DialogData {\r\n  label: string;\r\n}\r\n\r\n@Component({\r\n    selector: 'igo-draw-popup-component',\r\n    templateUrl: './draw-popup.component.html',\r\n    styleUrls: ['./draw-popup.component.scss'],\r\n  })\r\n  export class DrawPopupComponent {\r\n\r\n    constructor(\r\n      public dialogRef: MatDialogRef<DrawPopupComponent>,\r\n      @Inject(MAT_DIALOG_DATA) public data: DialogData) {}\r\n\r\n    noLabel() {\r\n      this.dialogRef.close();\r\n    }\r\n  }\r\n","<div mat-dialog-content>\r\n  <p class=\"mat-typography\">{{'igo.geo.draw.dialogInstruction' | translate}}</p>\r\n  <mat-form-field class=\"example-full-width\">\r\n    <input\r\n      #input\r\n      matInput\r\n      placeholder=\"{{'igo.geo.draw.dialogTitle' | translate}}\">\r\n  </mat-form-field>\r\n</div>\r\n<div mat-dialog-actions>\r\n  <button\r\n    mat-raised-button\r\n    (click)=\"noLabel()\">{{'igo.geo.draw.noLabel' | translate}}\r\n  </button>\r\n  <button\r\n    mat-raised-button\r\n    color=\"primary\"\r\n    [mat-dialog-close]=\"input.value\">OK\r\n  </button>\r\n</div>","import { Component } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'igo-draw-shorcuts',\r\n  templateUrl: './draw-shorcuts.component.html',\r\n  styleUrls: ['./draw-shorcuts.component.scss']\r\n})\r\n\r\nexport class DrawShorcutsComponent {}\r\n","<mat-dialog-content>\r\n  <div>\r\n    <span class=\"shortcut mat-typography\">\r\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon>{{'igo.geo.draw.finish' | translate}}</span>\r\n  </div>\r\n  <div>\r\n    <span class=\"shortcut mat-typography\">\r\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon>{{'igo.geo.draw.undo' | translate}}</span>\r\n  </div>\r\n  <div>\r\n    <span class=\"shortcut mat-typography\">\r\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon>{{'igo.geo.draw.abort' | translate}}</span>\r\n  </div>\r\n  <div>\r\n    <span class=\"shortcut mat-typography\">\r\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon>{{'igo.geo.draw.move' | translate}}</span>\r\n  </div>\r\n</mat-dialog-content>\r\n<mat-dialog-actions class=\"shortcuts-close\">\r\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\r\n</mat-dialog-actions>","\r\nexport const MEASURE_UNIT_AUTO = 'auto';\r\n\r\nexport enum MeasureType {\r\n  Length = 'length',\r\n  Area = 'area'\r\n}\r\n\r\nexport enum MeasureLengthUnit {\r\n  Meters = 'meters',\r\n  Kilometers = 'kilometers',\r\n  Miles = 'miles',\r\n  Feet = 'feet'\r\n}\r\n\r\nexport const MeasureLengthUnitAbbreviation = {\r\n  [MeasureLengthUnit.Meters]: 'm',\r\n  [MeasureLengthUnit.Kilometers]: 'km',\r\n  [MeasureLengthUnit.Miles]: 'mi',\r\n  [MeasureLengthUnit.Feet]: 'ft'\r\n};\r\n\r\nexport enum MeasureAreaUnit {\r\n  SquareMeters = 'squareMeters',\r\n  SquareKilometers = 'squareKilometers',\r\n  SquareMiles = 'squareMiles',\r\n  SquareFeet = 'squareFeet',\r\n  Hectares = 'hectares',\r\n  Acres = 'acres'\r\n}\r\n\r\nexport const MeasureAreaUnitAbbreviation = {\r\n  [MeasureAreaUnit.SquareMeters]: 'm',\r\n  [MeasureAreaUnit.SquareKilometers]: 'km',\r\n  [MeasureAreaUnit.SquareMiles]: 'mi',\r\n  [MeasureAreaUnit.SquareFeet]: 'ft',\r\n  [MeasureAreaUnit.Hectares]: 'ha',\r\n  [MeasureAreaUnit.Acres]: 'ac'\r\n};\r\n","import { LanguageService } from '@igo2/core';\r\nimport * as olstyle from 'ol/style';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport { getCenter as olGetCenter } from 'ol/extent';\r\nimport {\r\n  getLength as olGetLength,\r\n  getArea as olGetArea\r\n} from 'ol/sphere';\r\n\r\nimport { Measure } from './measure.interfaces';\r\nimport {\r\n  MeasureAreaUnit,\r\n  MeasureAreaUnitAbbreviation,\r\n  MeasureLengthUnit,\r\n  MeasureLengthUnitAbbreviation\r\n} from './measure.enum';\r\n\r\n/**\r\n * Convert value from meters to kilometers\r\n * @param value Value in meters\r\n * @returns Value in kilometers\r\n */\r\nexport function metersToKilometers(value: number): number {\r\n  return value * 0.001;\r\n}\r\n\r\n/**\r\n * Convert value from meters to feet\r\n * @param value Value in meters\r\n * @returns Value in feet\r\n */\r\nexport function metersToFeet(value: number): number {\r\n  return value * 3.2808;\r\n}\r\n\r\n/**\r\n * Convert value from meters to miles\r\n * @param value Value in meters\r\n * @returns Value in miles\r\n */\r\nexport function metersToMiles(value: number): number {\r\n  return value * 0.000621;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square kilometers\r\n * @param value Value in square meters\r\n * @returns Value in square kilometers\r\n */\r\nexport function squareMetersToSquareKilometers(value: number): number {\r\n  return value * 0.000001;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square miles\r\n * @param value Value in square meters\r\n * @returns Value in square miles\r\n */\r\nexport function squareMetersToSquareMiles(value: number): number {\r\n  return value * 0.0000003861;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square feet\r\n * @param value Value in square meters\r\n * @returns Value in square feet\r\n */\r\nexport function squareMetersToSquareFeet(value: number): number {\r\n  return value * 10.764;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to hectares\r\n * @param value Value in square meters\r\n * @returns Value in hectares\r\n */\r\nexport function squareMetersToHectares(value: number): number {\r\n  return value * 0.0001;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to acres\r\n * @param value Value in square meters\r\n * @returns Value in acres\r\n */\r\nexport function squareMetersToAcres(value: number): number {\r\n  return value * 0.00024711;\r\n}\r\n\r\n/**\r\n * Convert value from meters to the specified length unit\r\n * @param value Value in meters\r\n * @param unit Length unit\r\n * @returns Value in unit\r\n */\r\nexport function metersToUnit(value: number, unit: MeasureLengthUnit): number | undefined {\r\n  const conversionMapper = new Map([\r\n    [MeasureLengthUnit.Meters, (val: number) => val],\r\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\r\n    [MeasureLengthUnit.Miles, metersToMiles],\r\n    [MeasureLengthUnit.Feet, metersToFeet],\r\n  ]);\r\n  const conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to the specified area unit\r\n * @param value Value in meters\r\n * @param unit Area unit\r\n * @returns Value in unit\r\n */\r\nexport function squareMetersToUnit(value: number, unit: MeasureAreaUnit): number | undefined {\r\n  const conversionMapper = new Map([\r\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\r\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\r\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\r\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\r\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\r\n    [MeasureAreaUnit.Acres, squareMetersToAcres],\r\n  ]);\r\n  const conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n\r\n/**\r\n * This method format a measure to a readable format\r\n * @param measure Measure\r\n * @param options Formatting options\r\n * @returns Formatted measure\r\n */\r\nexport function formatMeasure(\r\n  measure: number,\r\n  options?: {\r\n    decimal?: number;\r\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\r\n    unitAbbr?: boolean;\r\n    locale?: string;\r\n  },\r\n  languageService?: LanguageService) {\r\n  let decimal = options.decimal;\r\n  if (decimal === undefined || decimal < 0) {\r\n    decimal = 1;\r\n  }\r\n\r\n  const parts = [];\r\n  if (options.locale !== undefined) {\r\n    parts.push(measure.toLocaleString(options.locale, {\r\n      minimumFractionDigits: decimal,\r\n      maximumFractionDigits: decimal\r\n    }));\r\n  } else {\r\n    parts.push(measure.toFixed(decimal).toString());\r\n  }\r\n\r\n  if (options.unit !== undefined && options.unitAbbr === true) {\r\n    if (languageService) {\r\n      parts.push(\r\n        MeasureLengthUnitAbbreviation[options.unit] ?\r\n          languageService.translate.instant('igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]) :\r\n          languageService.translate.instant('igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit])\r\n      );\r\n    } else {\r\n      parts.push(\r\n        MeasureLengthUnitAbbreviation[options.unit] || MeasureAreaUnitAbbreviation[options.unit]\r\n      );\r\n    }\r\n  }\r\n\r\n  return parts.filter(p => p !== undefined).join(' ');\r\n}\r\n\r\n/**\r\n * Compute best length measure unit for a given measure in meters\r\n * @param value Value in meters\r\n * @returns Measure unit\r\n */\r\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\r\n  let unit = MeasureLengthUnit.Meters;\r\n  let converted = value;\r\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\r\n  while (converted > 1000 && possibleUnits.length > 0) {\r\n    unit = possibleUnits.pop();\r\n    converted = metersToUnit(value, unit);\r\n  }\r\n  return unit;\r\n}\r\n\r\n/**\r\n * Compute best length measure unit for a given measure in square meters\r\n * @param value Value in meters\r\n * @returns Measure unit\r\n */\r\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\r\n  let unit = MeasureAreaUnit.SquareMeters;\r\n  let converted = value;\r\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\r\n  while (converted > 1000000 && possibleUnits.length > 0) {\r\n    unit = possibleUnits.pop();\r\n    converted = squareMetersToUnit(value, unit);\r\n  }\r\n  return unit;\r\n}\r\n\r\n/**\r\n * Create a default style for a measure interaction\r\n * @returns OL style\r\n */\r\nexport function createMeasureInteractionStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: '#ffcc33',\r\n      lineDash: [10, 10],\r\n      width: 2\r\n    }),\r\n    fill:  new olstyle.Fill({\r\n      color: 'rgba(255, 255, 255, 0.2)'\r\n    }),\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke: new olstyle.Stroke({\r\n        color: '#ffcc33',\r\n      }),\r\n      fill: new olstyle.Fill({\r\n        color: 'rgba(255, 255, 255, 0.2)'\r\n      })\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Create a default style for a measure layer\r\n * @returns OL style\r\n */\r\nexport function createMeasureLayerStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: '#ffcc33',\r\n      width: 2\r\n    }),\r\n    fill:  new olstyle.Fill({\r\n      color: 'rgba(255, 255, 255, 0.2)'\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Compute the length in meters of an OL geometry with a given projection\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Length in meters\r\n */\r\nexport function measureOlGeometryLength(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\r\n  if (olGeometry instanceof OlPoint) {\r\n    return undefined;\r\n  }\r\n  if (olGeometry.getFlatCoordinates().length === 0) {\r\n    return undefined;\r\n  }\r\n  return olGetLength(olGeometry, {projection});\r\n}\r\n\r\n/**\r\n * Compute the area in square meters of an OL geometry with a given projection\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Area in square meters\r\n */\r\nexport function measureOlGeometryArea(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\r\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\r\n    return undefined;\r\n  }\r\n  if (olGeometry.getFlatCoordinates().length === 0) {\r\n    return undefined;\r\n  }\r\n  return olGetArea(olGeometry, {projection});\r\n}\r\n\r\n/**\r\n * Compute the area (square meters), length (meters) and last length (meters)\r\n * of an OL geometry with a given projection.\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Computed measure\r\n */\r\nexport function measureOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): Measure {\r\n  const length = measureOlGeometryLength(olGeometry, projection);\r\n  const area = measureOlGeometryArea(olGeometry, projection);\r\n\r\n  const lengths = [];\r\n  const coordinates = olGeometry.getFlatCoordinates();\r\n  const coordinatesLength = coordinates.length;\r\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\r\n    const olSegment = new OlLineString([\r\n      [coordinates[i], coordinates[i + 1]],\r\n      [coordinates[i + 2], coordinates[i + 3]]\r\n    ]);\r\n\r\n    lengths.push(measureOlGeometryLength(olSegment, projection));\r\n  }\r\n\r\n  return {\r\n    area,\r\n    length,\r\n    lengths\r\n  };\r\n}\r\n\r\n/**\r\n * Update an OL geometry midpoints and return an array of those points\r\n * @param olGeometry OL Geometry\r\n * @returns OL points\r\n */\r\nexport function updateOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\r\n  let olMidpoints;\r\n  if (olGeometry instanceof OlPoint) {\r\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\r\n    olMidpoints = new Array(1);\r\n    olMidpoints[0] = olMidpointPoint;\r\n  } else  {\r\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\r\n    // TODO: handle multi geometries\r\n    const coordinates = olGeometry.getFlatCoordinates();\r\n    const midpointsLength = olMidpoints.length;\r\n    for (let i = 0; i < midpointsLength; i++) {\r\n      const j = i * 2;\r\n      const olSegment = new OlLineString([\r\n        [coordinates[j], coordinates[j + 1]],\r\n        [coordinates[j + 2], coordinates[j + 3]]\r\n      ]);\r\n\r\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\r\n      const olMidpoint = olMidpoints[i];\r\n      if (olMidpoint !== undefined) {\r\n        olMidpoint.setCoordinates(midpointCoordinate);\r\n      } else {\r\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\r\n      }\r\n    }\r\n  }\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Clear an OL geometry midpoints and return an array of those points\r\n * @param olGeometry OL Geometry\r\n */\r\nexport function clearOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle) {\r\n  const olMidpoints = olGeometry.get('_midpoints') || [];\r\n  const midpointsLength = olMidpoints.length;\r\n  for (let i = 0; i < midpointsLength; i++) {\r\n    const olMidpoint = olMidpoints[i];\r\n    if (olMidpoint !== undefined) {\r\n      if (olMidpoint !== undefined) {\r\n        clearOlMidpointTooltip(olMidpoint);\r\n      }\r\n    }\r\n  }\r\n\r\n  olGeometry.set('_midpoints', undefined, true);\r\n\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Return an array of  OL geometry midpoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL points\r\n */\r\nfunction getOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\r\n  let expectedNumber;\r\n  if (olGeometry instanceof OlCircle) {\r\n    expectedNumber = 0;\r\n  } else {\r\n    expectedNumber = Math.max((olGeometry.getFlatCoordinates().length / 2) - 1, 0);\r\n  }\r\n  // TODO: This works but it's quite messy. If time permits,\r\n  // clean this. Maybe a Tooltip class could handle that\r\n  let olMidpoints = olGeometry.get('_midpoints');\r\n\r\n  if (olMidpoints === undefined) {\r\n    if (olGeometry instanceof OlPoint) {\r\n      olMidpoints = new Array(1);\r\n    } else {\r\n      olMidpoints = new Array(expectedNumber);\r\n    }\r\n    olGeometry.set('_midpoints', olMidpoints, true);\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber === 0) {\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber === olMidpoints.length) {\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber > olMidpoints.length) {\r\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\r\n    return olMidpoints;\r\n  }\r\n\r\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\r\n    const olMidpoint = olMidpoints[expectedNumber];\r\n    if (olMidpoint !== undefined) {\r\n      clearOlMidpointTooltip(olMidpoint);\r\n    }\r\n  }\r\n  olMidpoints.splice(expectedNumber);\r\n\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Remove an OL midpoint's tooltip from the map\r\n * @param olMidpoint OL Point\r\n */\r\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\r\n  const olTooltip = olMidpoint.get('_tooltip');\r\n  if (olTooltip !== undefined) {\r\n    const olMap = olTooltip.getMap();\r\n    if (olMap !== undefined) {\r\n      olMap.removeOverlay(olTooltip);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Add an OL overlay at each midpoint and return an array of those overlays\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function updateOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\r\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n  let typeGeom = '';\r\n  if (olGeometry instanceof OlLineString) {\r\n  typeGeom = 'line-';\r\n  } else if (olGeometry instanceof OlPolygon) {\r\n    typeGeom = 'polygone-';\r\n    }\r\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\r\n    let olTooltip = olMidpoint.get('_tooltip');\r\n    if (olTooltip === undefined) {\r\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\r\n    } else {\r\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\r\n    }\r\n    return olTooltip;\r\n  });\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Return an array of OL overlay at midspoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\r\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\r\n  return olMidpoints.map((olMidpoint: OlPoint) => {\r\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\r\n  });\r\n}\r\n\r\n/**\r\n * Update an OL geometry center and return it\r\n * @param olGeometry OL Geometry\r\n * @returns OL point\r\n */\r\nexport function updateOlGeometryCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint {\r\n  let olCenter = olGeometry.get('_center');\r\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\r\n  if (olCenter !== undefined) {\r\n    olCenter.setCoordinates(centerCoordinate);\r\n  } else {\r\n    olCenter = new OlPoint(centerCoordinate);\r\n    olGeometry.set('_center', olCenter);\r\n  }\r\n\r\n  return olCenter;\r\n}\r\n\r\n/**\r\n * Add an OL overlay at the center of a geometry and return that overlay\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlay\r\n */\r\nexport function updateOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\r\n  const olCenter = updateOlGeometryCenter(olGeometry);\r\n  let olTooltip = olCenter.get('_tooltip');\r\n  if (olTooltip === undefined) {\r\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\r\n  } else {\r\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\r\n  }\r\n  return olTooltip;\r\n}\r\n\r\n/**\r\n * Return an array of OL overlay at midspoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\r\n  const olCenter = olGeometry.get('_center');\r\n  return olCenter ? olCenter.get('_tooltip') : undefined;\r\n}\r\n\r\n/**\r\n * Get all the tooltips of an OL geometry\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getTooltipsOfOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\r\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\r\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\r\n  if (olCenterTooltip !== undefined) {\r\n    olTooltips.push(olCenterTooltip);\r\n  }\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Create an OL overlay at a point and bind the overlay to the point\r\n * @param olPoint OL Point\r\n * @returns OL overlay\r\n */\r\nexport function createOlTooltipAtPoint(olPoint: OlPoint, center: boolean = false, srcGeomType: string= ''): OlOverlay {\r\n  const olTooltip = new OlOverlay({\r\n    element: document.createElement('div'),\r\n    offset: [-30, -10],\r\n    className: (center ?\r\n    [ 'igo-map-tooltip',\r\n      'igo-map-tooltip-measure', 'igo-map-tooltip-measure-area'] : ['igo-map-tooltip', 'igo-map-tooltip-measure',\r\n      `igo-map-tooltip-measure-${srcGeomType}segments`]).join(' '),\r\n    stopEvent: false\r\n  });\r\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\r\n  olPoint.set('_tooltip', olTooltip);\r\n\r\n  return olTooltip;\r\n}\r\n","import * as Olstyle from 'ol/style';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport {\r\n  updateOlGeometryMidpoints,\r\n  updateOlGeometryCenter\r\n} from '../../measure/shared/measure.utils';\r\n\r\n\r\n/**\r\n * Create a default style\r\n * @param fillColor the fill color\r\n * @param strokeColor the stroke color\r\n * @param strokeWidth the stroke width\r\n * @param label a label\r\n * @returns OL style\r\n */\r\nexport function createInteractionStyle(fillColor?: string, strokeColor?: string, strokeWidth?: number, label?: string): Olstyle.Style {\r\n  return new Olstyle.Style({\r\n    stroke: new Olstyle.Stroke({\r\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\r\n      width: strokeWidth ? strokeWidth : 1\r\n    }),\r\n    fill: new Olstyle.Fill({\r\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\r\n    }),\r\n    image: new Olstyle.Circle({\r\n      radius: 5,\r\n      stroke: new Olstyle.Stroke({\r\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\r\n        width: strokeWidth ? strokeWidth : 1\r\n      }),\r\n      fill: new Olstyle.Fill({\r\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\r\n      })\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Add an OL overlay at each midpoint and return an array of those overlays\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function updateOlTooltipsDrawAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\r\n  let olMidpoints;\r\n  if (olGeometry instanceof OlPoint) {\r\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\r\n    olMidpoints = new Array(1);\r\n    olMidpoints[0] = olMidpointPoint;\r\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\r\n  } else if (olGeometry instanceof OlCircle) {\r\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\r\n    olMidpoints = new Array(1);\r\n    olMidpoints[0] = olMidpointPoint;\r\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\r\n  } else  {\r\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n  }\r\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\r\n    let olTooltip = olMidpoint.get('_tooltip');\r\n    if (olTooltip === undefined) {\r\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\r\n    } else {\r\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\r\n    }\r\n    return olTooltip;\r\n  });\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Add an OL overlay at the center of a geometry and return that overlay\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlay\r\n */\r\nexport function updateOlTooltipDrawAtCenter(olGeometry: OlLineString | OlPolygon): OlOverlay {\r\n  const olCenter = updateOlGeometryCenter(olGeometry);\r\n  let olTooltip = olCenter.get('_tooltip');\r\n  if (olTooltip === undefined) {\r\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\r\n  } else {\r\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\r\n  }\r\n  return olTooltip;\r\n}\r\n\r\n/**\r\n * Create an OL overlay at a point and bind the overlay to the point\r\n * @param olPoint OL Point\r\n * @returns OL overlay\r\n */\r\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\r\n  const olTooltip = new OlOverlay({\r\n    element: document.createElement('div'),\r\n    offset: [-30, -10],\r\n    className: [\r\n      'igo-map-tooltip',\r\n      'igo-map-tooltip-draw'\r\n    ].join(' '),\r\n    stopEvent: false\r\n  });\r\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\r\n  olPoint.set('_tooltip', olTooltip);\r\n\r\n  return olTooltip;\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport * as OlStyle from 'ol/style';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport { transform } from 'ol/proj';\r\nimport { MapService } from '../../map/shared/map.service';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n  })\r\nexport class DrawStyleService {\r\n\r\n  private fillColor = 'rgba(255,255,255,0.4)';\r\n  private strokeColor = 'rgba(143,7,7,1)';\r\n  private strokeWidth: number = 1;\r\n  private labelsAreShown = true;\r\n  private icon: string;\r\n\r\n  constructor(\r\n    private mapService: MapService\r\n  ) {}\r\n\r\n  getFillColor(): string {\r\n    return this.fillColor;\r\n  }\r\n\r\n  setFillColor(fillColor: string) {\r\n    this.fillColor = fillColor;\r\n  }\r\n\r\n  getStrokeColor(): string {\r\n    return this.strokeColor;\r\n  }\r\n\r\n  setStrokeColor(strokeColor: string) {\r\n    this.strokeColor = strokeColor;\r\n  }\r\n\r\n  getStrokeWidth(): number {\r\n    return this.strokeWidth;\r\n  }\r\n\r\n  getLabelsAreShown() {\r\n    return this.labelsAreShown;\r\n  }\r\n\r\n  toggleLabelsAreShown() {\r\n    this.labelsAreShown = !this.labelsAreShown;\r\n  }\r\n\r\n  setIcon(icon: string) {\r\n    this.icon = icon;\r\n  }\r\n\r\n  getIcon() {\r\n    return this.icon;\r\n  }\r\n\r\n  createDrawingLayerStyle(feature, resolution, labelsAreShown?: boolean, icon?: string): OlStyle.Style {\r\n    let style;\r\n    let labelsAreOffset: boolean = false;\r\n    const proj = this.mapService.getMap().projection;\r\n    const geom = feature.getGeometry();\r\n\r\n    if (geom instanceof OlPoint) {\r\n      labelsAreOffset = !labelsAreOffset;\r\n    }\r\n\r\n    // if feature is a circle\r\n    if (feature.get('rad')) {\r\n      const coordinates = transform(feature.getGeometry().flatCoordinates, proj, 'EPSG:4326');\r\n\r\n      style = new OlStyle.Style({\r\n        text: new OlStyle.Text({\r\n          text: labelsAreShown ? feature.get('draw') : '',\r\n          stroke: new OlStyle.Stroke({\r\n            color: 'white',\r\n            width: 0.75\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'black'\r\n          }),\r\n          font: '20px sans-serif',\r\n          overflow: true\r\n        }),\r\n\r\n        image: new OlStyle.Circle({\r\n          radius: feature.get('rad') / Math.cos((Math.PI / 180) * coordinates[1]) / resolution,\r\n          stroke: new OlStyle.Stroke({\r\n            color: this.strokeColor,\r\n            width: this.strokeWidth\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: this.fillColor\r\n          })\r\n        })\r\n      });\r\n      return style;\r\n\r\n    // if feature is an icon\r\n    } else if (icon) {\r\n      style = new OlStyle.Style({\r\n        text: new OlStyle.Text({\r\n          text: labelsAreShown ? feature.get('draw') : '',\r\n          offsetY: -26,\r\n          stroke: new OlStyle.Stroke({\r\n            color: 'white',\r\n            width: 0.75\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'black'\r\n          }),\r\n          font: '20px sans-serif',\r\n          overflow: true\r\n        }),\r\n\r\n        stroke: new OlStyle.Stroke({\r\n          color: this.strokeColor,\r\n          width: this.strokeWidth\r\n        }),\r\n\r\n        fill:  new OlStyle.Fill({\r\n          color: this.fillColor\r\n        }),\r\n\r\n        image: new OlStyle.Icon({\r\n          src: icon\r\n        })\r\n      });\r\n      return style;\r\n\r\n    // if feature is a point, a linestring or a polygon\r\n    } else {\r\n      style = new OlStyle.Style({\r\n        text: new OlStyle.Text({\r\n          text: labelsAreShown ? feature.get('draw') : '',\r\n          stroke: new OlStyle.Stroke({\r\n            color: 'white',\r\n            width: 0.75\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'black'\r\n          }),\r\n          font: '20px sans-serif',\r\n          overflow: true,\r\n          offsetY: labelsAreOffset ? -15 : 0\r\n        }),\r\n\r\n        stroke: new OlStyle.Stroke({\r\n          color: this.strokeColor,\r\n          width: this.strokeWidth\r\n        }),\r\n\r\n        fill: new OlStyle.Fill({\r\n          color: this.fillColor\r\n        }),\r\n\r\n        image: new OlStyle.Circle({\r\n          radius: 5,\r\n          stroke: new OlStyle.Stroke({\r\n            color: this.strokeColor,\r\n            width: this.strokeWidth\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: this.fillColor\r\n          })\r\n        })\r\n      });\r\n      return style;\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n  })\r\nexport class DrawIconService {\r\n\r\n    protected icons: Array<string>;\r\n\r\n    constructor(\r\n      protected config: ConfigService\r\n    ) {\r\n        this.getIconsList();\r\n    }\r\n\r\n    getIcons() {\r\n        return this.icons;\r\n    }\r\n\r\n    getPath(): any {\r\n      return this.config.getConfig('drawingTool.icons') || [];\r\n    }\r\n\r\n    getIconsList() {\r\n      this.icons = this.getPath();\r\n    }\r\n}\r\n","<div>\r\n  <div class=\"geometry-type-toggle mat-typography\">\r\n    <mat-button-toggle-group\r\n      (change)=\"onGeometryTypeChange($event.value)\">\r\n      <mat-button-toggle [value]=\"geometryType.Point\">\r\n        {{('igo.geo.draw.' + geometryType.Point) | translate}}\r\n      </mat-button-toggle>\r\n\r\n      <mat-button-toggle [value]=\"geometryType.LineString\">\r\n        {{('igo.geo.draw.' + geometryType.LineString) | translate}}\r\n      </mat-button-toggle>\r\n\r\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\r\n        {{('igo.geo.draw.' + geometryType.Polygon) | translate}}\r\n      </mat-button-toggle>\r\n\r\n      <mat-button-toggle [value]=\"geometryType.Circle\">\r\n        {{('igo.geo.draw.' + geometryType.Circle) | translate}}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class=\"draw-options mat-typography\">\r\n    <mat-slide-toggle\r\n      [disabled]=\"drawControlIsDisabled\"\r\n      [checked]=\"drawControlIsActive\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDrawControl($event.checked)\">\r\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]=\"labelsAreShown\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleLabels()\">\r\n      {{'igo.geo.draw.toggleMapTooltips' | translate}}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <form class=\"igo-form\" [formGroup]=\"form\" >\r\n    <div class=\"fill-color-picker mat-typography\">\r\n      <span>\r\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\r\n        {{'igo.geo.draw.fill' | translate}}\r\n      </span>\r\n\r\n      <mat-form-field\r\n        class=\"fill-field\"\r\n        appearance=\"outline\"\r\n        floatLabel=\"always\"\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\r\n        <mat-label>{{fillColor}}</mat-label>\r\n\r\n        <input\r\n          formControlName=\"fill\"\r\n          matInput\r\n          type=\"text\"\r\n          [(colorPicker)]=\"fillColor\"\r\n          [style.background]=\"fillColor\"\r\n          [readonly]=\"true\"\r\n          [colorPicker]=\"fillColor\"\r\n          [cpWidth]=\"('200px')\"\r\n          [cpOutputFormat]=\"'rgba'\"\r\n          [cpPosition]=\"'bottom'\"\r\n          [cpPositionOffset]=\"'-75%'\"\r\n          [cpCancelButton]=\"true\"\r\n          [cpCancelButtonText]=\"'igo.geo.draw.cancelColorPicker' | translate\"\r\n          [cpOKButton]=\"true\"\r\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\">\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class=\"stroke-color-picker mat-typography\">\r\n      <span>\r\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\"></mat-icon>\r\n        {{'igo.geo.draw.stroke' | translate}}\r\n      </span>\r\n\r\n      <mat-form-field\r\n        class=\"stroke-field\"\r\n        appearance=\"outline\"\r\n        floatLabel=\"always\"\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\r\n        <mat-label>{{strokeColor}}</mat-label>\r\n\r\n        <input\r\n          formControlName=\"stroke\"\r\n          matInput\r\n          type=\"text\"\r\n          [(colorPicker)]=\"strokeColor\"\r\n          [style.background]=\"strokeColor\"\r\n          [readonly]=\"true\"\r\n          [colorPicker]=\"strokeColor\"\r\n          [cpWidth]=\"('200px')\"\r\n          [cpPosition]=\"'bottom'\"\r\n          [cpPositionOffset]=\"'-75%'\"\r\n          [cpOutputFormat]=\"'rgba'\"\r\n          [cpCancelButton]=\"true\"\r\n          [cpCancelButtonText]=\"'igo.geo.draw.cancelColorPicker' | translate\"\r\n          [cpOKButton]=\"true\"\r\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\">\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div>\r\n      <mat-form-field *ngIf=\"icons.length >= 1\">\r\n        <mat-label>{{'igo.geo.draw.icon' | translate}}</mat-label>\r\n        <mat-select>\r\n          <mat-select-trigger>\r\n            <div *ngIf=\"icon\" class=\"box\">\r\n              <img src={{icon}}>\r\n            </div>\r\n          </mat-select-trigger>\r\n          <mat-option value=\"\" (click)=\"onIconChange()\">{{'igo.geo.draw.noIcon' | translate}}</mat-option>\r\n          <mat-option\r\n            *ngFor=\"let icon_html of icons\"\r\n            [value]=\"icon_html\"\r\n            (click)=\"onIconChange(icon_html)\">\r\n            <div class=\"box\">\r\n              <img src={{icon_html}}>\r\n            </div>\r\n          </mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </form>\r\n\r\n  <mat-divider></mat-divider>\r\n\r\n  <div>\r\n    <button *ngIf=\"store.count$.getValue() > 0\"\r\n      class=\"deleteBtn\"\r\n      mat-icon-button\r\n      color=\"warn\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\r\n      (click)=\"deleteDrawings()\">\r\n      <mat-icon svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n\r\n    <igo-entity-table\r\n      #table\r\n      class=\"table-compact\"\r\n      [store]=\"store\"\r\n      [template]=\"tableTemplate\">\r\n    </igo-entity-table>\r\n  </div>\r\n\r\n  <button\r\n    mat-icon-button\r\n    color=\"accent\"\r\n    disableRipple=\"true\"\r\n    (click)=\"openShorcutsDialog()\">\r\n    <mat-icon\r\n      class=\"shortcuts-icon\"\r\n      svgIcon=\"keyboard-outline\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\">\r\n    </mat-icon>\r\n  </button>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport {\r\n    FEATURE,\r\n    FeatureStore,\r\n    FeatureStoreSelectionStrategy,\r\n    tryBindStoreLayer,\r\n    tryAddLoadingStrategy,\r\n    tryAddSelectionStrategy,\r\n    FeatureMotion,\r\n    FeatureStoreLoadingStrategy\r\n  } from '../../feature';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { GeometryType } from '../shared/draw.enum';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\r\nimport { FormGroup, FormBuilder } from '@angular/forms';\r\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { DrawControl } from '../../geometry/shared/controls/draw';\r\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\r\n\r\nimport * as OlStyle from 'ol/style';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { getDistance } from 'ol/sphere';\r\nimport { DrawStyleService } from '../shared/draw-style.service';\r\nimport { skip } from 'rxjs/operators';\r\nimport { DrawPopupComponent } from './draw-popup.component';\r\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\r\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\r\nimport { createInteractionStyle } from '../shared/draw.utils';\r\nimport { transform } from 'ol/proj';\r\nimport { DrawIconService } from '../shared/draw-icon.service';\r\n\r\n@Component ({\r\n  selector: 'igo-draw',\r\n  templateUrl: './draw.component.html',\r\n  styleUrls: ['./draw.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\n\r\nexport class DrawComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Table template\r\n   * @internal\r\n   */\r\n  public tableTemplate: EntityTableTemplate = {\r\n    selection: true,\r\n    selectMany: true,\r\n    selectionCheckbox: true,\r\n    sort: true,\r\n    columns: [{\r\n      name: 'Drawing',\r\n      title: this.languageService.translate.instant('igo.geo.draw.labels'),\r\n      valueAccessor: (feature: FeatureWithDraw) => {\r\n        return feature.properties.draw;\r\n      }\r\n    }]\r\n  };\r\n\r\n  public geometryType = GeometryType; // Reference to the GeometryType enum\r\n\r\n  @Output() fillColor: string;\r\n  @Output() strokeColor: string;\r\n  @Output() strokeWidth: number;\r\n\r\n  @Input() map: IgoMap; // Map to draw on\r\n\r\n  @Input() store: FeatureStore<FeatureWithDraw>; // Drawing store\r\n\r\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\r\n\r\n  private olDrawingLayerSource = new OlVectorSource();\r\n  private drawControl: DrawControl;\r\n  private drawEnd$$: Subscription;\r\n  private drawSelect$$: Subscription;\r\n  private olDrawingLayer: VectorLayer;\r\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> = new BehaviorSubject([]);\r\n  public fillForm: string;\r\n  public strokeForm: string;\r\n  public drawControlIsDisabled: boolean = true;\r\n  public drawControlIsActive: boolean = false;\r\n  public labelsAreShown: boolean;\r\n  private subscriptions$$: Subscription[] = [];\r\n\r\n  public position: string = 'bottom';\r\n  public form: FormGroup;\r\n  public icons: Array<string>;\r\n  public icon: string;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private formBuilder: FormBuilder,\r\n    private drawStyleService: DrawStyleService,\r\n    private dialog: MatDialog,\r\n    private drawIconService: DrawIconService\r\n  ) {\r\n    this.buildForm();\r\n    this.fillColor = this.drawStyleService.getFillColor();\r\n    this.strokeColor = this.drawStyleService.getStrokeColor();\r\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\r\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\r\n    this.icons = this.drawIconService.getIcons();\r\n    this.icon = this.drawStyleService.getIcon();\r\n  }\r\n\r\n  // Initialize the store that will contain the entities and create the Draw control\r\n  ngOnInit() {\r\n    this.initStore();\r\n    this.drawControl = this.createDrawControl(this.fillColor, this.strokeColor, this.strokeWidth);\r\n  }\r\n\r\n  /**\r\n   * Remove the drawing layer and the interactions\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.drawControl.setOlMap(undefined);\r\n    this.subscriptions$$.map(s => s.unsubscribe());\r\n  }\r\n\r\n  /**\r\n   * Create a Draw Control\r\n   * @param fillColor the fill color\r\n   * @param strokeColor the stroke color\r\n   * @param strokeWidth the stroke width\r\n   * @returns a Draw Control\r\n   */\r\n  createDrawControl(fillColor?: string, strokeColor?: string, strokeWidth?: number) {\r\n    const drawControl = new DrawControl({\r\n      geometryType: undefined,\r\n      drawingLayerSource: this.olDrawingLayerSource,\r\n      drawingLayerStyle: new OlStyle.Style({}),\r\n      interactionStyle: createInteractionStyle(fillColor, strokeColor, strokeWidth),\r\n    });\r\n\r\n    return drawControl;\r\n  }\r\n\r\n  /**\r\n   * Called when the user selects a new geometry type\r\n   * @param geometryType the geometry type selected by the user\r\n   */\r\n  onGeometryTypeChange(geometryType: typeof OlGeometryType) {\r\n    this.drawControl.setGeometryType(geometryType);\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Store initialization, including drawing layer creation\r\n   */\r\n  private initStore() {\r\n    this.map.removeLayer(this.olDrawingLayer);\r\n\r\n    this.olDrawingLayer = new VectorLayer({\r\n      id: 'igo-draw-layer',\r\n      title: this.languageService.translate.instant('igo.geo.draw.drawing'),\r\n      zIndex: 200,\r\n      source: new FeatureDataSource(),\r\n      style: (feature, resolution) => {\r\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, this.labelsAreShown, this.icon);\r\n      },\r\n      showInLayerList: true,\r\n      exportable: true,\r\n      browsable: false,\r\n      workspace: {\r\n        enabled: false\r\n      },\r\n    });\r\n    tryBindStoreLayer(this.store, this.olDrawingLayer);\r\n\r\n    tryAddLoadingStrategy(this.store, new FeatureStoreLoadingStrategy({\r\n      motion: FeatureMotion.None\r\n    }));\r\n\r\n    tryAddSelectionStrategy(this.store, new FeatureStoreSelectionStrategy({\r\n      map: this.map,\r\n      motion: FeatureMotion.None,\r\n      many: true\r\n    }));\r\n    this.store.layer.visible = true;\r\n    this.store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\r\n      const olGeometry = event.feature.getGeometry();\r\n      this.clearLabelsOfOlGeometry(olGeometry);\r\n    });\r\n\r\n    this.subscriptions$$.push(this.store.stateView.manyBy$((record: EntityRecord<FeatureWithDraw>) => {\r\n      return record.state.selected === true;\r\n    }).pipe(\r\n      skip(1)  // Skip initial emission\r\n    ).subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\r\n      this.selectedFeatures$.next(records.map(record => record.entity));\r\n    }));\r\n\r\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\r\n      cnt >= 1 ? this.store.layer.options.showInLayerList = true : this.store.layer.options.showInLayerList = false;\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Called when the user changes the color in a color picker\r\n   * @param labelsAreShown wheter the labels are shown or not\r\n   * @param isAnIcon wheter the feature is an icon or not\r\n   */\r\n  onColorChange(labelsAreShown: boolean, isAnIcon: boolean) {\r\n    this.fillForm = this.fillColor;\r\n    this.strokeForm = this.strokeColor;\r\n    this.drawStyleService.setFillColor(this.fillColor);\r\n    this.drawStyleService.setStrokeColor(this.strokeColor);\r\n\r\n    if (isAnIcon) {\r\n      this.store.layer.ol.setStyle((feature, resolution) => {\r\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, labelsAreShown, this.icon);\r\n      });\r\n      this.icon = undefined;\r\n\r\n    } else {\r\n      this.store.layer.ol.setStyle((feature, resolution) => {\r\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, labelsAreShown);\r\n      });\r\n    }\r\n    this.createDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Called when the user toggles the Draw control is toggled\r\n   * @internal\r\n   */\r\n  onToggleDrawControl(toggleIsChecked: boolean) {\r\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Activate the correct control\r\n   */\r\n  private toggleDrawControl() {\r\n    this.deactivateDrawControl();\r\n    this.activateDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Open a dialog box to enter label and do something\r\n   * @param olGeometry geometry at draw end or selected geometry\r\n   * @param drawEnd event fired at drawEnd?\r\n   */\r\n  private openDialog(olGeometryFeature, isDrawEnd: boolean) {\r\n    setTimeout(() => {\r\n      // open the dialog box used to enter label\r\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\r\n        disableClose: false\r\n      });\r\n\r\n      // when dialog box is closed, get label and set it to geometry\r\n      dialogRef.afterClosed().subscribe((label: string) => {\r\n        this.updateLabelOfOlGeometry(olGeometryFeature, label);\r\n\r\n        // if event was fired at draw end\r\n        if (isDrawEnd) {\r\n          this.onDrawEnd(olGeometryFeature);\r\n\r\n        // if event was fired at select\r\n        } else {\r\n          this.onSelectDraw(olGeometryFeature, label);\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   */\r\n  private activateDrawControl() {\r\n    this.drawControlIsDisabled = false;\r\n    this.drawControlIsActive = true;\r\n    this.drawEnd$$ = this.drawControl.end$.subscribe((olGeometry: OlGeometry) => {\r\n      this.openDialog(olGeometry, true);\r\n    });\r\n\r\n    this.drawControl.modify$.subscribe((olGeometry: OlGeometry) => {\r\n      this.onModifyDraw(olGeometry);\r\n    });\r\n\r\n    if (!this.drawSelect$$) {\r\n      this.drawSelect$$ = this.drawControl.select$.subscribe((olFeature: OlFeature<OlGeometry>) => {\r\n        this.openDialog(olFeature, false);\r\n      });\r\n    }\r\n\r\n    this.drawControl.setOlMap(this.map.ol, true);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active draw control\r\n   */\r\n  private deactivateDrawControl() {\r\n    if (!this.drawControl) {\r\n      return;\r\n    }\r\n\r\n    if (this.drawEnd$$) {\r\n      this.drawEnd$$.unsubscribe();\r\n    }\r\n\r\n    this.drawControl.setOlMap(undefined);\r\n    this.drawControlIsActive = false;\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\r\n    this.addFeatureToStore(olGeometry, radius);\r\n    this.clearLabelsOfOlGeometry(olGeometry);\r\n    this.store.layer.ol.getSource().refresh();\r\n  }\r\n\r\n  private onModifyDraw(olGeometry) {\r\n    const entities = this.store.all();\r\n\r\n    entities.forEach(entity => {\r\n      const entityId = entity.properties.id;\r\n\r\n      const olGeometryId = olGeometry.ol_uid;\r\n\r\n      if (entityId === olGeometryId) {\r\n        this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\r\n        this.replaceFeatureInStore(entity, olGeometry);\r\n      }\r\n    });\r\n  }\r\n\r\n  private onSelectDraw(olFeature: OlFeature<OlGeometry>, label: string) {\r\n    const entities = this.store.all();\r\n\r\n    const olGeometry = olFeature.getGeometry() as any;\r\n    olGeometry.ol_uid = olFeature.get('id');\r\n\r\n    const olGeometryCoordinates = JSON.stringify(olGeometry.getCoordinates()[0]);\r\n\r\n    entities.forEach(entity => {\r\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\r\n\r\n      if (olGeometryCoordinates === entityCoordinates) {\r\n        const rad: number = entity.properties.rad ? entity.properties.rad : undefined;\r\n\r\n        this.updateLabelOfOlGeometry(olGeometry, label);\r\n        this.replaceFeatureInStore(entity, olGeometry, rad);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add a feature with draw label to the store. The loading stragegy of the store\r\n   * will trigger and add the feature to the map.\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(olGeometry, radius?: number, feature?: FeatureWithDraw) {\r\n    let rad: number;\r\n    let center4326: Array<number>;\r\n    let point4326: Array<number>;\r\n    let lon4326: number;\r\n    let lat4326: number;\r\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\r\n    const projection = this.map.ol.getView().getProjection();\r\n\r\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\r\n      featureProjection: projection,\r\n      dataProjection: projection\r\n    }) as any;\r\n\r\n    if (olGeometry instanceof OlCircle || radius) {\r\n      if (radius) {\r\n        rad = radius;\r\n      } else {\r\n        geometry.type = 'Point';\r\n        geometry.coordinates = olGeometry.getCenter();\r\n        const extent4326 = transform([olGeometry.getFlatCoordinates()[2], olGeometry.getFlatCoordinates()[3]], projection, 'EPSG:4326');\r\n        center4326 = transform([olGeometry.getFlatCoordinates()[0], olGeometry.getFlatCoordinates()[1]], projection, 'EPSG:4326');\r\n        lon4326 = center4326[0];\r\n        lat4326 = center4326[1];\r\n        rad = getDistance(center4326, extent4326);\r\n      }\r\n    }\r\n\r\n    if (olGeometry instanceof OlPoint) {\r\n      point4326 = transform(olGeometry.getFlatCoordinates(), projection, 'EPSG:4326');\r\n      lon4326 = point4326[0];\r\n      lat4326 = point4326[1];\r\n    }\r\n\r\n    this.store.update({\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: projection.getCode(),\r\n      properties: {\r\n        id: featureId,\r\n        draw: olGeometry.get('_label'),\r\n        longitude: lon4326 ? lon4326 : null,\r\n        latitude: lat4326 ? lat4326 : null,\r\n        rad: rad ? rad : null\r\n      },\r\n      meta: {\r\n       id: featureId\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Replace the feature in the store\r\n   * @param entity the entity to replace\r\n   * @param olGeometry the new geometry to insert in the store\r\n   */\r\n  private replaceFeatureInStore(entity, olGeometry: OlGeometry, radius?: number) {\r\n    this.store.delete(entity);\r\n    this.onDrawEnd(olGeometry, radius);\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      fill: [''],\r\n      stroke: ['']\r\n    });\r\n  }\r\n\r\n  deleteDrawings() {\r\n    this.store.deleteMany(this.selectedFeatures$.value);\r\n    this.selectedFeatures$.value.forEach(selectedFeature => {\r\n      this.olDrawingLayerSource.getFeatures().forEach(drawingLayerFeature => {\r\n        const geometry = drawingLayerFeature.getGeometry() as any;\r\n        if (selectedFeature.properties.id === geometry.ol_uid) {\r\n          this.olDrawingLayerSource.removeFeature(drawingLayerFeature);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the tooltips of an OL geometry\r\n   * @param olGeometry OL geometry with tooltips\r\n   */\r\n  private clearLabelsOfOlGeometry(olGeometry) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\r\n      if (olTooltip && olTooltip.getMap()) {\r\n        this.map.ol.removeOverlay(olTooltip);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Called when the user toggles the labels toggle\r\n   */\r\n  onToggleLabels() {\r\n    this.drawStyleService.toggleLabelsAreShown();\r\n    this.labelsAreShown = !this.labelsAreShown;\r\n    this.icon ? this.onColorChange(this.labelsAreShown, true) : this.onColorChange(this.labelsAreShown, false);\r\n    }\r\n\r\n  /**\r\n   * Update the label of a geometry when a label is entered in a dialog box\r\n   * @param olGeometry the geometry\r\n   * @param label the label\r\n   */\r\n  private updateLabelOfOlGeometry(olGeometry: OlGeometry, label: string) {\r\n    olGeometry.setProperties({\r\n      _label: label\r\n    }, true);\r\n  }\r\n\r\n  onIconChange(event?) {\r\n    this.icon = event;\r\n    this.drawStyleService.setIcon(this.icon);\r\n    this.store.layer.ol.setStyle((feature, resolution) => {\r\n      return this.drawStyleService.createDrawingLayerStyle(feature, resolution, true, this.icon);\r\n    });\r\n  }\r\n\r\n  openShorcutsDialog() {\r\n    this.dialog.open(DrawShorcutsComponent);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { ColorPickerModule } from 'ngx-color-picker';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoEntityTableModule } from '@igo2/common';\r\nimport { DrawComponent } from './draw.component';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { DrawPopupComponent } from './draw-popup.component';\r\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatDividerModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatListModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    MatDialogModule,\r\n    IgoLanguageModule,\r\n    IgoEntityTableModule,\r\n    ColorPickerModule\r\n  ],\r\n  declarations: [\r\n    DrawComponent,\r\n    DrawPopupComponent,\r\n    DrawShorcutsComponent\r\n  ],\r\n  exports: [\r\n    DrawComponent\r\n  ]\r\n})\r\nexport class IgoDrawModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoKeyValueModule, IgoImageModule } from '@igo2/common';\r\n\r\nimport { FeatureDetailsComponent } from './feature-details.component';\r\nimport { FeatureDetailsDirective } from './feature-details.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    IgoLanguageModule,\r\n    IgoKeyValueModule,\r\n    IgoImageModule\r\n  ],\r\n  exports: [\r\n    FeatureDetailsComponent,\r\n    FeatureDetailsDirective],\r\n  declarations: [\r\n    FeatureDetailsComponent,\r\n    FeatureDetailsDirective]\r\n})\r\nexport class IgoFeatureDetailsModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoFormModule } from '@igo2/common';\r\n\r\nimport { FeatureFormComponent } from './feature-form.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoFormModule\r\n  ],\r\n  exports: [\r\n    IgoFormModule,\r\n    FeatureFormComponent\r\n  ],\r\n  declarations: [\r\n    FeatureFormComponent\r\n  ]\r\n})\r\nexport class IgoFeatureFormModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\r\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n    IgoFeatureDetailsModule,\r\n    IgoFeatureFormModule\r\n  ],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoFeatureModule {}\r\n","import OlMap from 'ol/Map';\r\nimport OlFeature from 'ol/Feature';\r\nimport * as OlStyle from 'ol/style';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlModify from 'ol/interaction/Modify';\r\nimport OlTranslate from 'ol/interaction/Translate';\r\nimport OlDraw from 'ol/interaction/Draw';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlLinearRing from 'ol/geom/LinearRing';\r\nimport OlInteraction from 'ol/interaction/Interaction';\r\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\r\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport BasicEvent from 'ol/events/Event';\r\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\r\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\r\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport { Subject, Subscription, fromEvent } from 'rxjs';\r\n\r\nimport {\r\n  addLinearRingToOlPolygon,\r\n  createDrawHoleInteractionStyle,\r\n  getMousePositionFromOlGeometryEvent\r\n} from '../geometry.utils';\r\n\r\nexport interface ModifyControlOptions {\r\n  source?: OlVectorSource<any>;\r\n  layer?: OlVectorLayer<any>;\r\n  layerStyle?: OlStyle.Style | ((olfeature: OlFeature<any>) => OlStyle.Style);\r\n  drawStyle?: OlStyle.Style | ((olfeature: OlFeature<any>) => OlStyle.Style) | OlStyle.Circle |\r\n    ((olfeature: OlFeature<OlGeometry>) => OlStyle.Circle);\r\n  modify?: boolean;\r\n  translate?: boolean;\r\n}\r\n\r\n/**\r\n * Control to modify geometries\r\n */\r\nexport class ModifyControl {\r\n  /**\r\n   * Modify start observable\r\n   */\r\n  public start$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Modify end observable\r\n   */\r\n  public end$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Geometry changes observable\r\n   */\r\n  public changes$: Subject<OlGeometry> = new Subject();\r\n\r\n  private olMap: OlMap;\r\n  private olOverlayLayer: OlVectorLayer<any>;\r\n  public olModifyInteraction: OlModify;\r\n  private onModifyStartKey: any;\r\n  private onModifyEndKey: any;\r\n  private onModifyKey: any;\r\n  private olModifyInteractionIsActive: boolean = false;\r\n  private olTranslateInteraction: OlTranslate;\r\n  private onTranslateStartKey: any;\r\n  private onTranslateEndKey: any;\r\n  private onTranslateKey: any;\r\n  private olTranslateInteractionIsActive: boolean = false;\r\n  private olDrawInteraction: OlDraw;\r\n  private onDrawStartKey: any;\r\n  private onDrawEndKey: any;\r\n  private onDrawKey: any;\r\n  private olDrawInteractionIsActive: boolean = false;\r\n\r\n  private mousePosition: [number, number];\r\n\r\n  private keyDown$$: Subscription;\r\n  private drawKeyUp$$: Subscription;\r\n  private drawKeyDown$$: Subscription;\r\n\r\n  private removedOlInteractions: OlInteraction[] = [];\r\n  private olLinearRingsLayer: OlVectorLayer<any>;\r\n\r\n  // This is the geometry to test against when drawing holes\r\n  private olOuterGeometry: OlGeometry;\r\n\r\n  /**\r\n   * Wheter the control is active\r\n   */\r\n  get active(): boolean {\r\n    return this.olMap !== undefined;\r\n  }\r\n\r\n  /**\r\n   * OL overlay source\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource<any> {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  /**\r\n   * OL linear rings source\r\n   * @internal\r\n   */\r\n  get olLinearRingsSource(): OlVectorSource<any> {\r\n    return this.olLinearRingsLayer.getSource();\r\n  }\r\n\r\n  /**\r\n   * Whether a modify control should be available\r\n   */\r\n  private modify: boolean = true;\r\n\r\n  /**\r\n   * Whether a translate control should be available\r\n   */\r\n  private translate: boolean = true;\r\n\r\n  constructor(private options: ModifyControlOptions) {\r\n    if (options.modify !== undefined) {\r\n      this.modify = options.modify;\r\n    }\r\n    if (options.translate !== undefined) {\r\n      this.translate = options.translate;\r\n    }\r\n\r\n    if (options.layer !== undefined) {\r\n      this.olOverlayLayer = options.layer;\r\n    } else {\r\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\r\n    }\r\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\r\n  }\r\n\r\n  /**\r\n   * Add or remove this control to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap === undefined) {\r\n      this.clearOlInnerOverlaySource();\r\n      this.removeOlInnerOverlayLayer();\r\n      this.removeOlModifyInteraction();\r\n      this.removeOlTranslateInteraction();\r\n      this.removeOlDrawInteraction();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n    this.addOlInnerOverlayLayer();\r\n\r\n    // The order in which these interactions\r\n    // are added is important\r\n    if (this.modify === true) {\r\n      this.addOlDrawInteraction();\r\n    }\r\n\r\n    if (this.translate === true) {\r\n      this.addOlTranslateInteraction();\r\n      this.activateTranslateInteraction();\r\n    }\r\n\r\n    if (this.modify === true) {\r\n      this.addOlModifyInteraction();\r\n      this.activateModifyInteraction();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the overlay source\r\n   */\r\n  getSource(): OlVectorSource<any> {\r\n    return this.olOverlaySource;\r\n  }\r\n\r\n  /**\r\n   * Add an OL geometry to the overlay and start modifying it\r\n   * @param olGeometry Ol Geometry\r\n   */\r\n  setOlGeometry(olGeometry: OlGeometry) {\r\n    const olFeature = new OlFeature({ geometry: olGeometry });\r\n    this.olOverlaySource.clear();\r\n    this.olOverlaySource.addFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Create an overlay source if none is defined in the options\r\n   */\r\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\r\n    return new OlVectorLayer({\r\n      source: this.options.source ? this.options.source : new OlVectorSource(),\r\n      style: this.options.layerStyle,\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer if it wasn't defined in the options\r\n   */\r\n  private addOlInnerOverlayLayer() {\r\n    if (this.options.layer === undefined) {\r\n      this.olMap.addLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer if it wasn't defined in the options\r\n   */\r\n  private removeOlInnerOverlayLayer() {\r\n    if (this.options.layer === undefined && this.olMap !== undefined) {\r\n      this.olMap.removeLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay source if it wasn't defined in the options\r\n   */\r\n  private clearOlInnerOverlaySource() {\r\n    if (this.options.layer === undefined && this.options.source === undefined) {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n  }\r\n\r\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\r\n    return new OlVectorLayer({\r\n      source: new OlVectorSource(),\r\n      style: createDrawHoleInteractionStyle(),\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the linear rings layer\r\n   */\r\n  private addOlLinearRingsLayer() {\r\n    this.olMap.addLayer(this.olLinearRingsLayer);\r\n  }\r\n\r\n  /**\r\n   * Clear the linear rings layer\r\n   */\r\n  private removeOlLinearRingsLayer() {\r\n    this.olMap.removeLayer(this.olLinearRingsLayer);\r\n  }\r\n\r\n  /**\r\n   * Clear the linear rings source\r\n   */\r\n  private clearOlLinearRingsSource() {\r\n    this.olLinearRingsSource.clear(true);\r\n  }\r\n\r\n  /**\r\n   * Add a modify interaction to the map an set up some listeners\r\n   */\r\n  private addOlModifyInteraction() {\r\n    const olModifyInteraction = new OlModify({\r\n      source: this.olOverlaySource,\r\n      style: this.options.drawStyle as OlStyle.Style\r\n    });\r\n    this.olModifyInteraction = olModifyInteraction;\r\n  }\r\n\r\n  /**\r\n   * Remove the modify interaction\r\n   */\r\n  private removeOlModifyInteraction() {\r\n    if (this.olModifyInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateModifyInteraction();\r\n    this.olModifyInteraction = undefined;\r\n  }\r\n\r\n  private activateModifyInteraction() {\r\n    if (this.olModifyInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.olModifyInteractionIsActive = true;\r\n    this.onModifyStartKey = this.olModifyInteraction.on(\r\n      'modifystart',\r\n      (event: OlModifyEvent) => this.onModifyStart(event)\r\n    );\r\n    this.onModifyEndKey = this.olModifyInteraction.on(\r\n      'modifyend',\r\n      (event: OlModifyEvent) => this.onModifyEnd(event)\r\n    );\r\n    this.olMap.addInteraction(this.olModifyInteraction);\r\n  }\r\n\r\n  private deactivateModifyInteraction() {\r\n    if (this.olModifyInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.olModifyInteractionIsActive = false;\r\n\r\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olModifyInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When modifying starts, clear the overlay and start watching for changes\r\n   * @param event Modify start event\r\n   */\r\n  private onModifyStart(event: OlModifyEvent) {\r\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\r\n    this.start$.next(olGeometry);\r\n    this.onModifyKey = olGeometry.on(\r\n      'change',\r\n      (olGeometryEvent: BasicEvent) => {\r\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\r\n          olGeometryEvent\r\n        );\r\n        this.changes$.next(olGeometryEvent.target as OlLineString | OlCircle | OlPolygon);\r\n      }\r\n    );\r\n    this.subscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When modifying ends, update the geometry observable and stop watching for changes\r\n   * @param event Modify end event\r\n   */\r\n  private onModifyEnd(event: OlModifyEvent) {\r\n    unByKey(this.onModifyKey);\r\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\r\n    this.unsubscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to space key down to pan the map\r\n   */\r\n  private subscribeToKeyDown() {\r\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        if (event.key === ' ') {\r\n          // On space bar, pan to the current mouse position\r\n          this.olMap.getView().animate({\r\n            center: this.mousePosition,\r\n            duration: 0\r\n          });\r\n          return;\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key down\r\n   */\r\n  private unsubscribeToKeyDown() {\r\n    if (this.keyDown$$ !== undefined) {\r\n      this.keyDown$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a translate interaction to the map an set up some listeners\r\n   */\r\n  private addOlTranslateInteraction() {\r\n    const olTranslateInteraction = new OlTranslate({\r\n      layers: [this.olOverlayLayer]\r\n    });\r\n    this.olTranslateInteraction = olTranslateInteraction;\r\n  }\r\n\r\n  /**\r\n   * Remove the translate interaction\r\n   */\r\n  private removeOlTranslateInteraction() {\r\n    if (this.olTranslateInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateTranslateInteraction();\r\n    this.olTranslateInteraction = undefined;\r\n  }\r\n\r\n  private activateTranslateInteraction() {\r\n    if (this.olTranslateInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.olTranslateInteractionIsActive = true;\r\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\r\n      'translatestart',\r\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\r\n    );\r\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\r\n      'translateend',\r\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\r\n    );\r\n    this.olMap.addInteraction(this.olTranslateInteraction);\r\n  }\r\n\r\n  private deactivateTranslateInteraction() {\r\n    if (this.olTranslateInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.olTranslateInteractionIsActive = false;\r\n    unByKey([\r\n      this.onTranslateStartKey,\r\n      this.onTranslateEndKey,\r\n      this.onTranslateKey\r\n    ]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olTranslateInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When translation starts, clear the overlay and start watching for changes\r\n   * @param event Translate start event\r\n   */\r\n  private onTranslateStart(event: OlTranslateEvent) {\r\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\r\n    this.start$.next(olGeometry);\r\n    this.onTranslateKey = olGeometry.on(\r\n      'change',\r\n      (olGeometryEvent: BasicEvent) => {\r\n        // this.changes$.next(olGeometryEvent.target);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * When translation ends, update the geometry observable and stop watchign for changes\r\n   * @param event Translate end event\r\n   */\r\n  private onTranslateEnd(event: OlTranslateEvent) {\r\n    unByKey(this.onTranslateKey);\r\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\r\n  }\r\n\r\n  /**\r\n   * Add a draw interaction to the map an set up some listeners\r\n   */\r\n  private addOlDrawInteraction() {\r\n    const olDrawInteraction = new OlDraw({\r\n      type: 'Polygon',\r\n      source: this.olLinearRingsSource,\r\n      stopClick: true,\r\n      style: createDrawHoleInteractionStyle(),\r\n      condition: (event: MapBrowserEvent<any>) => {\r\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\r\n        const intersects = olOuterGeometry.intersectsCoordinate(\r\n          event.coordinate\r\n        );\r\n        return intersects;\r\n      }\r\n    });\r\n\r\n    this.olDrawInteraction = olDrawInteraction;\r\n    this.subscribeToDrawKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to CTRL key down to activate the draw control\r\n   */\r\n  private subscribeToDrawKeyDown() {\r\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        if (event.key !== 'Control') {\r\n          return;\r\n        }\r\n\r\n        this.unsubscribeToDrawKeyDown();\r\n\r\n        const olGeometry = this.getOlGeometry();\r\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\r\n          return;\r\n        }\r\n\r\n        this.subscribeToDrawKeyUp();\r\n\r\n        this.deactivateModifyInteraction();\r\n        this.deactivateTranslateInteraction();\r\n        this.activateDrawInteraction();\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Subscribe to CTRL key up to deactivate the draw control\r\n   */\r\n  private subscribeToDrawKeyUp() {\r\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        if (event.key !== 'Control') {\r\n          return;\r\n        }\r\n\r\n        this.unsubscribeToDrawKeyUp();\r\n        this.unsubscribeToKeyDown();\r\n        this.deactivateDrawInteraction();\r\n\r\n        this.activateModifyInteraction();\r\n        if (this.translate === true) {\r\n          this.activateTranslateInteraction();\r\n        }\r\n        this.subscribeToDrawKeyDown();\r\n\r\n        this.olOuterGeometry = undefined;\r\n        this.clearOlLinearRingsSource();\r\n        this.end$.next(this.getOlGeometry());\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to draw key down\r\n   */\r\n  private unsubscribeToDrawKeyDown() {\r\n    if (this.drawKeyDown$$ !== undefined) {\r\n      this.drawKeyDown$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key up\r\n   */\r\n  private unsubscribeToDrawKeyUp() {\r\n    if (this.drawKeyUp$$ !== undefined) {\r\n      this.drawKeyUp$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the draw interaction\r\n   */\r\n  private removeOlDrawInteraction() {\r\n    if (this.olDrawInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.unsubscribeToKeyDown();\r\n    this.unsubscribeToDrawKeyUp();\r\n    this.unsubscribeToDrawKeyDown();\r\n    this.deactivateDrawInteraction();\r\n    this.clearOlLinearRingsSource();\r\n    this.olDrawInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * Activate the draw interaction\r\n   */\r\n  private activateDrawInteraction() {\r\n    if (this.olDrawInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.clearOlLinearRingsSource();\r\n    this.addOlLinearRingsLayer();\r\n\r\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\r\n      if (olInteraction instanceof OlDragBoxInteraction) {\r\n        this.olMap.removeInteraction(olInteraction);\r\n        this.removedOlInteractions.push(olInteraction);\r\n      }\r\n    });\r\n\r\n    this.olDrawInteractionIsActive = true;\r\n    this.onDrawStartKey = this.olDrawInteraction.on(\r\n      'drawstart',\r\n      (event: OlDrawEvent) => this.onDrawStart(event)\r\n    );\r\n    this.onDrawEndKey = this.olDrawInteraction.on(\r\n      'drawend',\r\n      (event: OlDrawEvent) => this.onDrawEnd(event)\r\n    );\r\n    this.olMap.addInteraction(this.olDrawInteraction);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the draw interaction\r\n   */\r\n  private deactivateDrawInteraction() {\r\n    if (this.olDrawInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.removeOlLinearRingsLayer();\r\n\r\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\r\n      this.olMap.addInteraction(olInteraction);\r\n    });\r\n    this.removedOlInteractions = [];\r\n\r\n    this.olDrawInteractionIsActive = false;\r\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olDrawInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\r\n   * @param event Draw start event\r\n   */\r\n  private onDrawStart(event: OlDrawEvent) {\r\n    const olGeometry = event.feature.getGeometry();\r\n    this.olOuterGeometry = this.getOlGeometry().clone();\r\n\r\n    const linearRingCoordinates = olGeometry.getLinearRing().getCoordinates();\r\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\r\n    this.start$.next(this.getOlGeometry());\r\n\r\n    this.onDrawKey = olGeometry.on(\r\n      'change',\r\n      (olGeometryEvent: BasicEvent) => {\r\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\r\n          olGeometryEvent\r\n        );\r\n        const olGeometryTarget = olGeometryEvent.target as OlPolygon;\r\n        const _linearRingCoordinates = olGeometryTarget\r\n          .getLinearRing(0)\r\n          .getCoordinates();\r\n        this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\r\n        this.changes$.next(this.getOlGeometry());\r\n      }\r\n    );\r\n    this.subscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When translation ends, update the geometry observable and stop watchign for changes\r\n   * @param event Draw end event\r\n   */\r\n  private onDrawEnd(event: OlDrawEvent) {\r\n    unByKey(this.onDrawKey);\r\n    this.olOuterGeometry = undefined;\r\n\r\n    const linearRingCoordinates = event.feature\r\n      .getGeometry()\r\n      .getLinearRing()\r\n      .getCoordinates();\r\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\r\n    this.clearOlLinearRingsSource();\r\n    this.end$.next(this.getOlGeometry());\r\n    this.unsubscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Add a linear ring to the geometry being modified\r\n   * @param coordinates Linear ring coordinates\r\n   */\r\n  private addLinearRingToOlGeometry(coordinates: number[]) {\r\n    const olGeometry = this.getOlGeometry() as OlPolygon;\r\n    const olLinearRing = new OlLinearRing(coordinates);\r\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\r\n  }\r\n\r\n  /**\r\n   * Update the last linear ring of the geometry being modified\r\n   * @param coordinates Linear ring coordinates\r\n   */\r\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\r\n    const olGeometry = this.getOlGeometry() as OlPolygon;\r\n    // Remove the last linear ring (the one we are updating)\r\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\r\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\r\n      return olLinearRing.getCoordinates();\r\n    });\r\n    newCoordinates.push(coordinates);\r\n    olGeometry.setCoordinates(newCoordinates);\r\n  }\r\n\r\n  /**\r\n   * Get the geometry being modified\r\n   * @returns OL Geometry\r\n   */\r\n  private getOlGeometry(): OlGeometry {\r\n    const olFeatures = this.olOverlaySource.getFeatures();\r\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\r\n  }\r\n}\r\n","export const LAYER = 'Layer';\r\n","import { Component, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\n\r\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\r\n\r\nimport { MeasureAreaUnit, MeasureLengthUnit} from '../shared/measure.enum';\r\n\r\n@Component({\r\n  selector: 'igo-measurer-dialog',\r\n  templateUrl: 'measurer-dialog.component.html',\r\n  styleUrls: ['./measurer-dialog.component.scss']\r\n})\r\nexport class MeasurerDialogComponent {\r\n\r\n  measureAreaUnit = MeasureAreaUnit;\r\n\r\n  measureLengthUnit = MeasureLengthUnit;\r\n\r\n  constructor(\r\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\r\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\r\n  ) {}\r\n\r\n  onNoClick(): void {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n}\r\n","<div mat-dialog-content>\r\n  <h3>{{'igo.geo.measure.dialog.title' | translate}}</h3>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\r\n        <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\r\n        <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n","<div>\r\n  <div class=\"measure-type-toggle mat-typography\">\r\n    <mat-button-toggle-group\r\n      [value]=\"activeMeasureType\"\r\n      (change)=\"onMeasureTypeChange($event.value)\">\r\n      <mat-button-toggle [value]=\"measureType.Length\">\r\n        {{('igo.geo.measure.' + measureType.Length) | translate}}\r\n      </mat-button-toggle>\r\n      <mat-button-toggle [value]=\"measureType.Area\">\r\n        {{('igo.geo.measure.' + measureType.Area) | translate}}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class=\"measure-options mat-typography\">\r\n    <mat-slide-toggle\r\n      [checked]=\"drawControlIsActive\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDrawControl($event.checked)\">\r\n      {{'igo.geo.measure.toggleActive' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]=\"displayLines\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDisplayLines($event.checked)\">\r\n      {{'igo.geo.measure.toggleDisplayLines' | translate}}\r\n    </mat-slide-toggle> \r\n\r\n    <mat-slide-toggle\r\n      [disabled]=\"!(hasArea$ | async)\"\r\n      [checked]=\"displayDistance\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDisplayDistance($event.checked)\">\r\n      {{'igo.geo.measure.toggleDisplayDistance' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [disabled]=\"!(hasArea$ | async)\"\r\n      [checked]=\"displayAreas\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDisplayAreas($event.checked)\">\r\n      {{'igo.geo.measure.toggleDisplayAreas' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]=\"measureUnitsAuto\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\">\r\n      {{'igo.geo.measure.toggleAutoUnits' | translate}}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <ng-container *ngIf=\"measure$ | async as measure\">\r\n    <igo-measurer-item\r\n      [measureType]=\"measureType.Length\"\r\n      [measureUnit]=\"measureLengthUnit.Meters\"\r\n      [measure]=\"measure.length\"\r\n      [auto]=\"measureUnitsAuto\"\r\n      [placeholder]=\"(activeMeasureType === measureType.Area ? 'igo.geo.measure.perimeter' : 'igo.geo.measure.length') | translate\"\r\n      (measureUnitChange)=\"onLengthUnitChange($event)\">\r\n    </igo-measurer-item>\r\n\r\n    <igo-measurer-item\r\n      [measureType]=\"measureType.Area\"\r\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\r\n      [measure]=\"measure.area\"\r\n      [auto]=\"measureUnitsAuto\"\r\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\r\n      (measureUnitChange)=\"onAreaUnitChange($event)\">\r\n    </igo-measurer-item>\r\n  </ng-container>\r\n\r\n  <div class=\"measure-store-buttons\">\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\r\n      (click)=\"onCalculateClick()\">\r\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\r\n      (click)=\"onDeleteClick()\">\r\n      <mat-icon svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n\r\n    <!--button\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\r\n      (click)=\"onModifyClick()\">\r\n      <mat-icon svgIcon=\"edit\"></mat-icon>\r\n    </button-->\r\n  </div>\r\n\r\n  <igo-entity-table\r\n    #table\r\n    class=\"table-compact\"\r\n    [store]=\"store\"\r\n    [template]=\"tableTemplate\">\r\n  </igo-entity-table>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { BehaviorSubject, from, Subscription } from 'rxjs';\r\nimport { skip } from 'rxjs/operators';\r\n\r\nimport OlStyle from 'ol/style/Style';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport { unByKey, OnReturn } from 'ol/Observable';\r\n\r\nimport { LanguageService, StorageScope, StorageService  } from '@igo2/core';\r\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\r\nimport type { EntityTableComponent } from '@igo2/common';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport {\r\n  FEATURE,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  tryBindStoreLayer,\r\n  tryAddLoadingStrategy,\r\n  tryAddSelectionStrategy\r\n} from '../../feature';\r\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\r\nimport { VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nimport { Measure, MeasurerDialogData, FeatureWithMeasure } from '../shared/measure.interfaces';\r\nimport {\r\n  MeasureType,\r\n  MeasureAreaUnit,\r\n  MeasureLengthUnit,\r\n} from '../shared/measure.enum';\r\nimport {\r\n  measureOlGeometry,\r\n  createMeasureInteractionStyle,\r\n  createMeasureLayerStyle,\r\n  updateOlTooltipsAtMidpoints,\r\n  updateOlTooltipAtCenter,\r\n  getTooltipsOfOlGeometry,\r\n  squareMetersToUnit,\r\n  metersToUnit,\r\n  formatMeasure\r\n} from '../shared/measure.utils';\r\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\r\n\r\n/**\r\n * Tool to measure lengths and areas\r\n */\r\n@Component({\r\n  selector: 'igo-measurer',\r\n  templateUrl: './measurer.component.html',\r\n  styleUrls: ['./measurer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerComponent implements OnInit, OnDestroy {\r\n\r\n  /**\r\n   * Table template\r\n   * @internal\r\n   */\r\n  public tableTemplate: EntityTableTemplate = {\r\n    selection: true,\r\n    selectMany: true,\r\n    selectionCheckbox: true,\r\n    sort: true,\r\n    columns: [\r\n      {\r\n        name: 'length',\r\n        title: this.languageService.translate.instant('igo.geo.measure.lengthHeader'),\r\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\r\n          const unit = this.activeLengthUnit;\r\n          const measure = metersToUnit(localFeature.properties.measure.length, unit);\r\n          return formatMeasure(measure, {\r\n            decimal: 1,\r\n            unit,\r\n            unitAbbr: false,\r\n            locale: 'fr'\r\n          });\r\n        }\r\n      },\r\n      {\r\n        name: 'area',\r\n        title: this.languageService.translate.instant('igo.geo.measure.areaHeader'),\r\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\r\n          const unit = this.activeAreaUnit;\r\n          const measure = squareMetersToUnit(localFeature.properties.measure.area, unit);\r\n          return measure ? formatMeasure(measure, {\r\n            decimal: 1,\r\n            unit,\r\n            unitAbbr: false,\r\n            locale: 'fr'\r\n          }) : '';\r\n        }\r\n      }\r\n    ]\r\n  };\r\n\r\n  private subscriptions$$: Subscription[] = [];\r\n\r\n  /**\r\n   * Reference to the MeasureType enum\r\n   * @internal\r\n   */\r\n  public measureType = MeasureType;\r\n\r\n  /**\r\n   * Reference to the AreaMeasureUnit enum\r\n   * @internal\r\n   */\r\n  public measureAreaUnit = MeasureAreaUnit;\r\n\r\n  /**\r\n   * Reference to the LengthMeasureUnit enum\r\n   * @internal\r\n   */\r\n  public measureLengthUnit = MeasureLengthUnit;\r\n\r\n  /**\r\n   * Whether measure units should be automatically determined\r\n   * @internal\r\n   */\r\n  public measureUnitsAuto: boolean = false;\r\n\r\n  /**\r\n   * Whether display of distances of areas\r\n   * @internal\r\n   */\r\n  public displayDistance: boolean = true;\r\n\r\n  /**\r\n   * Whether display of distances of lines\r\n   * @internal\r\n   */\r\n  public displayLines: boolean = true;\r\n\r\n  /**\r\n   * Whether display of areas\r\n   * @internal\r\n   */\r\n  public displayAreas: boolean = true;\r\n\r\n  /**\r\n   * Observable of area boolean\r\n   * @internal\r\n   */\r\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Observable of area\r\n   * @internal\r\n   */\r\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\r\n\r\n  /**\r\n   * Observable of selected features\r\n   * @internal\r\n   */\r\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * OL draw source\r\n   * @internal\r\n   */\r\n  public showTooltips: boolean = true;\r\n\r\n  /**\r\n   * Draw line control\r\n   */\r\n  private drawLineControl: DrawControl;\r\n\r\n  /**\r\n   * Draw polygon control\r\n   */\r\n  private drawPolygonControl: DrawControl;\r\n\r\n  /**\r\n   * Modify control\r\n   */\r\n  private modifyControl: ModifyControl;\r\n\r\n  /**\r\n   * Active OL geometry\r\n   */\r\n  private activeOlGeometry: OlLineString | OlPolygon;\r\n\r\n  /**\r\n   * Active mlength unit\r\n   */\r\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n\r\n  /**\r\n   * Active area unit\r\n   */\r\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\r\n\r\n  /**\r\n   * Feature added listener key\r\n   */\r\n  private onFeatureAddedKey: OnReturn;\r\n\r\n  /**\r\n   * Feature removed listener key\r\n   */\r\n  private onFeatureRemovedKey: OnReturn;\r\n\r\n  /**\r\n   * Active draw control\r\n   * @internal\r\n   */\r\n  private activeDrawControl: DrawControl;\r\n\r\n  /**\r\n   * Subscription to draw start\r\n   */\r\n  private drawStart$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to draw end\r\n   */\r\n  private drawEnd$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to controls changes\r\n   */\r\n  private drawChanges$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to modify start\r\n   */\r\n  private modifyStart$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to modify end\r\n   */\r\n  private modifyEnd$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to controls changes\r\n   */\r\n  private modifyChanges$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to measures selection\r\n   */\r\n  private selectedFeatures$$: Subscription;\r\n\r\n  /**\r\n   * OL draw source\r\n   */\r\n  private olDrawSource = new OlVectorSource();\r\n\r\n  /**\r\n   * The map to measure on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The measures store\r\n   */\r\n  @Input() store: FeatureStore<FeatureWithMeasure>;\r\n\r\n  /**\r\n   * Measure type\r\n   * @internal\r\n   */\r\n  @Input()\r\n  set activeMeasureType(value: MeasureType) { this.setActiveMeasureType(value); }\r\n  get activeMeasureType(): MeasureType { return this._activeMeasureType; }\r\n  private _activeMeasureType: MeasureType = MeasureType.Length;\r\n\r\n  /**\r\n   * The minimum length a segment must have to display a tooltip.\r\n   * It also applies to area tooltips.\r\n   */\r\n  @Input() minSegmentLength: number = 10;\r\n\r\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\r\n\r\n  /**\r\n   * Wheter one of the draw control is active\r\n   * @internal\r\n   */\r\n  get drawControlIsActive(): boolean {\r\n    return this.activeDrawControl !== undefined;\r\n  }\r\n\r\n  get projection(): string {\r\n    return this.map.ol.getView().getProjection().getCode();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dialog: MatDialog,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  /**\r\n   * Add draw controls and activate one\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.initStore();\r\n    this.createDrawLineControl();\r\n    this.createDrawPolygonControl();\r\n    this.createModifyControl();\r\n    this.toggleDrawControl();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    this.checkDistanceAreaToggle();\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer and any interaction added by this component.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.setActiveMeasureType(undefined);\r\n    this.deactivateModifyControl();\r\n    this.freezeStore();\r\n    this.subscriptions$$.map(s => s.unsubscribe());\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onMeasureTypeChange(measureType: MeasureType) {\r\n    this.activeMeasureType = measureType;\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current draw control\r\n   * @internal\r\n   */\r\n  onToggleDrawControl(toggle: boolean) {\r\n    if (toggle === true) {\r\n      this.toggleDrawControl();\r\n    } else {\r\n      this.deactivateDrawControl();\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Activate or deactivate the current draw control\r\n   * @internal\r\n   */\r\n   onToggleMeasureUnitsAuto(toggle: boolean) {\r\n    this.measureUnitsAuto = toggle;\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of the areas\r\n   * @internal\r\n   */\r\n  onToggleDisplayDistance(toggle: boolean) {\r\n    this.displayDistance = toggle;\r\n    this.onDisplayDistance();\r\n    toggle ? (this.storageService.set('distanceToggle', true, StorageScope.SESSION)) :\r\n     (this.storageService.set('distanceToggle', false, StorageScope.SESSION));\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of the lines\r\n   * @internal\r\n   */\r\n  onToggleDisplayLines(toggle: boolean) {\r\n    this.displayLines = toggle;\r\n    this.onDisplayLines();\r\n    toggle ? (this.storageService.set('linesToggle', true, StorageScope.SESSION)) :\r\n     (this.storageService.set('linesToggle', false, StorageScope.SESSION));\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of areas\r\n   * @internal\r\n   */\r\n  onToggleDisplayAreas(toggle: boolean) {\r\n    this.displayAreas = toggle;\r\n    this.onDisplayAreas();\r\n    toggle ? (this.storageService.set('areasToggle', true, StorageScope.SESSION)) :\r\n     (this.storageService.set('areasToggle', false, StorageScope.SESSION));\r\n  }\r\n\r\n  /**\r\n   * Set display parametres in current values\r\n   * @internal\r\n   */\r\n  checkDistanceAreaToggle(){\r\n    if (this.storageService.get('distanceToggle') === false){\r\n      this.displayDistance = false;\r\n    }\r\n    if (this.storageService.get('linesToggle') === false){\r\n      this.displayLines = false;\r\n    }\r\n    if (this.storageService.get('areasToggle') === false){\r\n      this.displayAreas = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of areas\r\n   * @internal\r\n   */\r\n  onDisplayDistance() {\r\n    if (this.displayDistance) {\r\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-hidden'));\r\n    } else {\r\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\r\n        value.classList.add('igo-map-tooltip-hidden'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of lines\r\n   * @internal\r\n   */\r\n  onDisplayLines() {\r\n    if (this.displayLines) {\r\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-hidden'));\r\n    } else {\r\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\r\n        value.classList.add('igo-map-tooltip-hidden'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of areas\r\n   * @internal\r\n   */\r\n  onDisplayAreas() {\r\n    if (this.displayAreas) {\r\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-hidden'));\r\n    } else {\r\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\r\n        value.classList.add('igo-map-tooltip-hidden'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onLengthUnitChange(unit: MeasureLengthUnit) {\r\n    this.activeLengthUnit = unit;\r\n    this.table.refresh();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onAreaUnitChange(unit: MeasureAreaUnit) {\r\n    this.activeAreaUnit = unit;\r\n    this.table.refresh();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n  }\r\n\r\n  onCalculateClick() {\r\n    const features = this.selectedFeatures$.value;\r\n    const area = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\r\n      return sum + localFeature.properties.measure.area || 0;\r\n    }, 0);\r\n    const length = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\r\n      if (localFeature.geometry.type === 'Polygon') {\r\n        return sum;\r\n      }\r\n      return sum + localFeature.properties.measure.length || 0;\r\n    }, 0);\r\n    const perimeter = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\r\n      if (localFeature.geometry.type === 'LineString') {\r\n        return sum;\r\n      }\r\n      return sum + localFeature.properties.measure.length || 0;\r\n    }, 0);\r\n\r\n    this.openDialog({\r\n      area,\r\n      length,\r\n      perimeter\r\n    });\r\n  }\r\n\r\n  onDeleteClick() {\r\n    this.store.deleteMany(this.selectedFeatures$.value);\r\n    this.selectedFeatures$.value.forEach(selectedFeature => {\r\n      this.olDrawSource.getFeatures().forEach(drawingLayerFeature => {\r\n        const geometry = drawingLayerFeature.getGeometry() as any;\r\n        if (selectedFeature.properties.id === geometry.ol_uid) {\r\n          this.olDrawSource.removeFeature(drawingLayerFeature);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  onModifyClick() {\r\n    if (this.selectedFeatures$.value.length !== 1) { return; }\r\n\r\n    if (this.modifyControl.active === true) {\r\n      this.deactivateModifyControl();\r\n      this.toggleDrawControl();\r\n    } else {\r\n      const localFeature = this.selectedFeatures$.value[0];\r\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\r\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\r\n        return _olFeature.get('id') === localFeature.properties.id;\r\n      });\r\n\r\n      if (olFeature !== undefined) {\r\n        this.deactivateDrawControl();\r\n        this.activateModifyControl();\r\n\r\n        const olGeometry = olFeature.getGeometry();\r\n        this.clearTooltipsOfOlGeometry(olGeometry as (OlLineString | OlPolygon));\r\n        this.modifyControl.setOlGeometry(olGeometry);\r\n      }\r\n    }\r\n  }\r\n\r\n  private openDialog(data: MeasurerDialogData): void {\r\n    this.dialog.open(MeasurerDialogComponent, {data});\r\n  }\r\n\r\n  /**\r\n   * Initialize the measure store and set up some listeners\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      title: this.languageService.translate.instant('igo.geo.measure.layerTitle'),\r\n      id: `igo-measures-${uuid()}`,\r\n      zIndex: 200,\r\n      source: new FeatureDataSource(),\r\n      style: createMeasureLayerStyle(),\r\n      showInLayerList: true,\r\n      exportable: false,\r\n      browsable: false,\r\n      workspace: { enabled: false }\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n    store.layer.visible = true;\r\n    layer.visible$.subscribe(visible => {\r\n      if (visible) {\r\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-measure-by-display'));\r\n      }\r\n      else {\r\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\r\n        value.classList.add('igo-map-tooltip-measure-by-display'));\r\n      }\r\n    });\r\n\r\n    tryAddLoadingStrategy(store);\r\n\r\n    tryAddSelectionStrategy(store, new FeatureStoreSelectionStrategy({\r\n      map: this.map,\r\n      many: true\r\n    }));\r\n\r\n    this.onFeatureAddedKey = store.source.ol.on('addfeature', (event: OlVectorSourceEvent<OlGeometry>) => {\r\n      const localFeature = event.feature;\r\n      const olGeometry = localFeature.getGeometry() as any;\r\n      this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\r\n      this.onDisplayDistance();\r\n    });\r\n\r\n    this.onFeatureRemovedKey = store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\r\n      const olGeometry = event.feature.getGeometry() as any;\r\n      this.clearTooltipsOfOlGeometry(olGeometry);\r\n    });\r\n\r\n    this.selectedFeatures$$ = store.stateView.manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\r\n      return record.state.selected === true;\r\n    }).pipe(\r\n      skip(1)  // Skip initial emission\r\n    )\r\n    .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\r\n      if (this.modifyControl.active === true) {\r\n        this.deactivateModifyControl();\r\n      }\r\n      this.selectedFeatures$.next(records.map(record => record.entity));\r\n    });\r\n\r\n    this.subscriptions$$.push(this.store.entities$.subscribe(objectsExists  => {\r\n    if (objectsExists.find(objectExist => objectExist.geometry.type === 'Polygon')){\r\n        this.hasArea$.next(true);\r\n      }\r\n      else {\r\n        this.hasArea$.next(false);\r\n      }\r\n    }));\r\n\r\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\r\n      cnt >= 1 ?\r\n        this.store.layer.options.showInLayerList = true :\r\n        this.store.layer.options.showInLayerList = false;\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\r\n   * and some listener removed\r\n   * @internal\r\n   */\r\n  private freezeStore() {\r\n    const store = this.store;\r\n    this.selectedFeatures$$.unsubscribe();\r\n    unByKey(this.onFeatureAddedKey);\r\n    unByKey(this.onFeatureRemovedKey);\r\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\r\n  }\r\n\r\n  /**\r\n   * Create a draw line control\r\n   */\r\n  private createDrawLineControl() {\r\n    this.drawLineControl = new DrawControl({\r\n      geometryType: 'LineString',\r\n      drawingLayerSource: this.olDrawSource,\r\n      interactionStyle: createMeasureInteractionStyle(),\r\n      drawingLayerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a draw polygon control\r\n   */\r\n  private createDrawPolygonControl() {\r\n    this.drawPolygonControl = new DrawControl({\r\n      geometryType: 'Polygon',\r\n      drawingLayerSource: this.olDrawSource,\r\n      interactionStyle: createMeasureInteractionStyle(),\r\n      drawingLayerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a draw polygon control\r\n   */\r\n  private createModifyControl() {\r\n    this.modifyControl = new ModifyControl({\r\n      source: this.olDrawSource,\r\n      drawStyle: createMeasureInteractionStyle(),\r\n      layerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate the right control\r\n   */\r\n  private toggleDrawControl() {\r\n    this.deactivateDrawControl();\r\n    // this.deactivateModifyControl();\r\n    if (this.activeMeasureType === MeasureType.Length) {\r\n      this.activateDrawControl(this.drawLineControl);\r\n    } else if (this.activeMeasureType === MeasureType.Area) {\r\n      this.activateDrawControl(this.drawPolygonControl);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param drawControl Draw control\r\n   */\r\n  private activateDrawControl(drawControl: DrawControl) {\r\n    this.activeDrawControl = drawControl;\r\n    this.drawStart$$ = drawControl.start$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry));\r\n    this.drawEnd$$ = drawControl.end$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry));\r\n    this.drawChanges$$ = drawControl.changes$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry));\r\n\r\n    drawControl.setOlMap(this.map.ol, false);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active draw control\r\n   */\r\n  private deactivateDrawControl() {\r\n    if (this.activeDrawControl === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.olDrawSource.clear();\r\n    if (this.drawStart$$ !== undefined ) { this.drawStart$$.unsubscribe(); }\r\n    if (this.drawEnd$$ !== undefined ) { this.drawEnd$$.unsubscribe(); }\r\n    if (this.drawChanges$$ !== undefined ) { this.drawChanges$$.unsubscribe(); }\r\n\r\n    this.clearTooltipsOfOlSource(this.olDrawSource);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n    this.activeDrawControl.setOlMap(undefined);\r\n    this.activeDrawControl = undefined;\r\n    this.activeOlGeometry = undefined;\r\n  }\r\n\r\n  private setActiveMeasureType(measureType: MeasureType) {\r\n    this._activeMeasureType = measureType;\r\n    this.clearMeasures();\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being drawn\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\r\n    this.activeOlGeometry = olGeometry;\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\r\n    this.activeOlGeometry = undefined;\r\n    this.finalizeMeasureOfOlGeometry(olGeometry);\r\n    this.addFeatureToStore(olGeometry);\r\n    this.clearTooltipsOfOlGeometry(olGeometry);\r\n    this.olDrawSource.clear(true);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = measureOlGeometry(olGeometry, this.projection);\r\n    this.updateMeasureOfOlGeometry(olGeometry, Object.assign({}, measure, {\r\n      area: undefined  // We don't want to display an area tooltip while drawing.\r\n    }));\r\n    this.measure$.next(measure);\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param modifyControl Modify control\r\n   */\r\n  private activateModifyControl() {\r\n    const selection = this.store.getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\r\n    selection.deactivate();\r\n    selection.clear();\r\n\r\n    this.modifyStart$$ = this.modifyControl.start$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry));\r\n    this.modifyEnd$$ = this.modifyControl.end$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry));\r\n    this.modifyChanges$$ = this.modifyControl.changes$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry));\r\n    this.modifyControl.setOlMap(this.map.ol);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active modify control\r\n   */\r\n  private deactivateModifyControl() {\r\n    if (this.modifyStart$$ !== undefined ) { this.modifyStart$$.unsubscribe(); }\r\n    if (this.modifyEnd$$ !== undefined ) { this.modifyEnd$$.unsubscribe(); }\r\n    if (this.modifyChanges$$ !== undefined ) { this.modifyChanges$$.unsubscribe(); }\r\n\r\n    if (this.activeOlGeometry !== undefined) {\r\n      if (this.selectedFeatures$.value.length === 1) {\r\n        const localFeature = this.selectedFeatures$.value[0];\r\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\r\n      }\r\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n\r\n    this.olDrawSource.clear();\r\n\r\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\r\n\r\n    this.activeOlGeometry = undefined;\r\n    this.modifyControl.setOlMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being drawn\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\r\n    this.onDrawStart(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\r\n    this.onDrawChanges(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\r\n    this.finalizeMeasureOfOlGeometry(olGeometry);\r\n  }\r\n\r\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = measureOlGeometry(olGeometry, this.projection);\r\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables\r\n   * @param olGeometry Ol linestring or polygon\r\n   * @param measure Measure\r\n   */\r\n  private updateMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon, measure: Measure) {\r\n    olGeometry.setProperties({_measure: measure}, true);\r\n    this.updateTooltipsOfOlGeometry(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Clear the measures observables\r\n   */\r\n  private clearMeasures() {\r\n    this.measure$.next({});\r\n  }\r\n\r\n  /**\r\n   * Add a feature with measures to the store. The loading stragegy of the store\r\n   * will trigger and add the feature to the map.\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\r\n    const featureId = localFeature ? localFeature.properties.id : olGeometry.ol_uid;\r\n    const projection = this.map.ol.getView().getProjection();\r\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\r\n      featureProjection: projection,\r\n      dataProjection: projection\r\n    }) as any;\r\n    this.store.update({\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: projection.getCode(),\r\n      properties: {\r\n        id: featureId,\r\n        measure: olGeometry.get('_measure')\r\n      },\r\n      meta: {\r\n        id: featureId\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update all the tooltips of an OL geometry\r\n   * @param olGeometry OL Geometry\r\n   * @param lengths Lengths of the OL geometry's segments\r\n   * @param measureUnit Display tooltip measure in those units\r\n   */\r\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = olGeometry.get('_measure');\r\n    const lengths = measure.lengths;\r\n    const area = measure.area;\r\n\r\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\r\n    if (lengths.length === olMidpointsTooltips.length) {\r\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\r\n        const length = lengths[i];\r\n        if (length !== undefined) {\r\n          this.updateOlTooltip(\r\n            olMidpointsTooltips[i],\r\n            metersToUnit(length, this.activeLengthUnit),\r\n            this.activeLengthUnit,\r\n            MeasureType.Length\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    if (area !== undefined) {\r\n      this.updateOlTooltip(\r\n        updateOlTooltipAtCenter(olGeometry),\r\n        squareMetersToUnit(area,  this.activeAreaUnit),\r\n        this.activeAreaUnit,\r\n        MeasureType.Area\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of a geoemtry\r\n   */\r\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\r\n      if (this.shouldShowTooltip(olTooltip)) {\r\n        this.map.ol.addOverlay(olTooltip);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the tooltips of an OL geometrys\r\n   * @param olGeometry OL geometry with tooltips\r\n   */\r\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\r\n      if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\r\n        this.map.ol.removeOverlay(olTooltip);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of all the geometries of a source\r\n   */\r\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\r\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\r\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of all the geometries of a source\r\n   */\r\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\r\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\r\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the map tooltips\r\n   * @param olDrawSource OL vector source\r\n   */\r\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\r\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\r\n      const olGeometry = olFeature.getGeometry();\r\n      if (olGeometry !== undefined) {\r\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\r\n   * @param olTooltip OL tooltip\r\n   * @param measure The measure valeu ti display\r\n   * @param measureUnit Display tooltip measure in those units\r\n   */\r\n  private updateOlTooltip(\r\n    olTooltip: OlOverlay,\r\n    measure: number,\r\n    unit: MeasureAreaUnit | MeasureLengthUnit,\r\n    type: MeasureType\r\n  ) {\r\n    olTooltip.setProperties({_measure: measure, _unit: unit, _type: type}, true);\r\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\r\n    if (this.shouldShowTooltip(olTooltip)) {\r\n      this.map.ol.addOverlay(olTooltip);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compute a tooltip's content\r\n   * @param olTooltip OL overlay\r\n   * @returns Inner HTML\r\n   */\r\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\r\n    const properties = olTooltip.getProperties() as any;\r\n    return formatMeasure(properties._measure, {\r\n      decimal: 1,\r\n      unit: properties._unit,\r\n      unitAbbr: true,\r\n      locale: 'fr'\r\n    }, this.languageService);\r\n  }\r\n\r\n  /**\r\n   * Whether a tooltip should be showned based on the length\r\n   * of the segment it is bound to.\r\n   * @param olTooltip OL overlay\r\n   * @returns True if the tooltip should be shown\r\n   */\r\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\r\n    if (this.showTooltips === false) {\r\n      return false;\r\n    }\r\n\r\n    const properties = olTooltip.getProperties() as any;\r\n    const measure = properties._measure;\r\n    if (measure === undefined) {\r\n      return false;\r\n    }\r\n\r\n    if (properties._unit === MeasureType.Length) {\r\n      const minSegmentLength = metersToUnit(this.minSegmentLength, properties._unit) || 0;\r\n      return measure > Math.max(minSegmentLength, 0);\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\r\nimport { metersToUnit, squareMetersToUnit, formatMeasure } from '../shared/measure.utils';\r\n\r\n/**\r\n * This pipe returns a measure converted from meters (or square meters)\r\n * to the specified unit. It also keeps a certain number of decimals.\r\n */\r\n@Pipe({\r\n  name: 'measureFormat'\r\n})\r\nexport class MeasureFormatPipe implements PipeTransform {\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  transform(\r\n    value: number, unit: MeasureAreaUnit | MeasureLengthUnit,\r\n    unitAbbr: boolean = false,\r\n    decimal: number = 1\r\n  ): number {\r\n    let out;\r\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\r\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\r\n    } else if (Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0) {\r\n      out = metersToUnit(value, unit as MeasureLengthUnit);\r\n    }\r\n\r\n    return out ? formatMeasure(out, {\r\n      decimal: 1,\r\n      unit,\r\n      unitAbbr,\r\n      locale: 'fr'\r\n    }) : out;\r\n  }\r\n}\r\n","import { DrawControlOptions } from './../shared/controls/draw';\r\nimport {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  Optional,\r\n  Self,\r\n  ChangeDetectorRef,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport * as OlStyle from 'ol/style';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlGeometry from 'ol/geom/Geometry';\r\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport * as olproj from 'ol/proj';\r\nimport Point from 'ol/geom/Point';\r\n\r\nimport { IgoMap } from '../../map';\r\nimport {\r\n  MeasureLengthUnit,\r\n  updateOlGeometryMidpoints,\r\n  formatMeasure,\r\n  measureOlGeometry\r\n} from '../../measure';\r\nimport { DrawControl, ModifyControl, ModifyControlOptions } from '../shared/controls';\r\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\r\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\n\r\n/**\r\n * This input allows a user to draw a new geometry or to edit\r\n * an existing one on a map. A text input is also displayed in the\r\n * form with some instructions.\r\n * This is still WIP.\r\n */\r\n@Component({\r\n  selector: 'igo-geometry-form-field-input',\r\n  templateUrl: './geometry-form-field-input.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class GeometryFormFieldInputComponent implements OnInit, OnDestroy, ControlValueAccessor {\r\n\r\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\r\n  private olGeoJSON = new OlGeoJSON();\r\n  private ready = false;\r\n\r\n  private drawControl: DrawControl;\r\n  private modifyControl: ModifyControl;\r\n  private defaultDrawStyleRadius: number;\r\n  private olGeometryEnds$$: Subscription;\r\n  private olGeometryChanges$$: Subscription;\r\n  private olTooltip = this.createMeasureTooltip();\r\n\r\n  /**\r\n   * Active control\r\n   * @internal\r\n   */\r\n  public activeControl: DrawControl | ModifyControl;\r\n\r\n  /**\r\n   * The map to draw the geometry on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The geometry type\r\n   */\r\n  @Input()\r\n  set geometryType(value: typeof OlGeometryType) {\r\n    this._geometryType = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateControl();\r\n    this.createDrawControl();\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n    this.toggleControl();\r\n  }\r\n  get geometryType(): typeof OlGeometryType { return this._geometryType; }\r\n  private _geometryType: typeof OlGeometryType;\r\n\r\n  /**\r\n   * The drawGuide around the mouse pointer to help drawing\r\n   */\r\n  @Input() drawGuide: number = null;\r\n\r\n  /**\r\n   * Whether a measure tooltip should be displayed\r\n   */\r\n  @Input() measure: boolean = false;\r\n\r\n  /**\r\n   * Whether draw control should be active or not\r\n   */\r\n  @Input()\r\n  get drawControlIsActive(): boolean { return this._drawControlIsActive; }\r\n  set drawControlIsActive(value: boolean) {\r\n    this._drawControlIsActive = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n    this.deactivateControl();\r\n    if (!this._drawControlIsActive) {\r\n      return;\r\n    } else {\r\n      this.toggleControl();\r\n    }\r\n  }\r\n  private _drawControlIsActive: boolean = true;\r\n\r\n  /**\r\n   * Whether freehand draw control should be active or not\r\n   */\r\n  @Input()\r\n  get freehandDrawIsActive(): boolean { return this._freehandDrawIsActive; }\r\n  set freehandDrawIsActive(value: boolean) {\r\n    this._freehandDrawIsActive = value;\r\n    this.deactivateControl();\r\n\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    if (!this.drawControlIsActive) {\r\n      return;\r\n    }\r\n    this.toggleControl();\r\n  }\r\n  private _freehandDrawIsActive: boolean;\r\n\r\n  /**\r\n   * Control options\r\n   */\r\n  @Input() controlOptions: {[key: string]: any} = {};\r\n\r\n  /**\r\n   * Style for the draw control (applies while the geometry is being drawn)\r\n   */\r\n  @Input()\r\n  set drawStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) {\r\n    if (value === undefined) {\r\n      value = createDrawInteractionStyle();\r\n    }\r\n    this._drawStyle = value;\r\n\r\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value) as OlStyle.Circle;\r\n    if (olGuideStyle !== undefined) {\r\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\r\n    } else {\r\n      this.defaultDrawStyleRadius = null;\r\n    }\r\n\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateControl();\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n    this.toggleControl();\r\n  }\r\n  get drawStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._drawStyle; }\r\n  private _drawStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\r\n\r\n  /**\r\n   * Style for the overlay layer (applies once the geometry is added to the map)\r\n   * If not specified, drawStyle applies\r\n   */\r\n  @Input()\r\n  set overlayStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) { this._overlayStyle = value; }\r\n  get overlayStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._overlayStyle; }\r\n  private _overlayStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\r\n\r\n  /**\r\n   * The geometry value (GeoJSON)\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  @Input()\r\n  set value(value: GeoJSONGeometry) {\r\n    this._value = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    if (value) {\r\n      this.addGeoJSONToOverlay(value);\r\n    } else {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n    this.onChange(value);\r\n    this.toggleControl();\r\n    this.cdRef.detectChanges();\r\n  }\r\n  get value(): GeoJSONGeometry { return this._value; }\r\n  private _value: GeoJSONGeometry;\r\n\r\n  /**\r\n   * The vector source to add the geometry to\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  @Input()\r\n  set radius(value: any) {\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n    if (this.modifyControl.getSource()) {\r\n      this.modifyControl.getSource().refresh();\r\n    }\r\n    if (this.freehandDrawIsActive) {\r\n      let olModify;\r\n      setTimeout(() => {\r\n        olModify = this.modifyControl.olModifyInteraction;\r\n        if (olModify) {\r\n          if (olModify.features_) {\r\n            olModify.features_.clear();\r\n            this.addGeoJSONToOverlay(this.value);\r\n          }\r\n        }\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    @Optional() @Self() public ngControl: NgControl\r\n  ) {\r\n    if (this.ngControl !== undefined) {\r\n      // Setting the value accessor directly (instead of using\r\n      // the providers) to avoid running into a circular import.\r\n      this.ngControl.valueAccessor = this;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create an overlay layer, add the initial geometry to it (if any)\r\n   * and toggle the right interaction.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    if (this.drawStyle === undefined) {\r\n      this.drawStyle = createDrawInteractionStyle();\r\n    }\r\n\r\n    if (this.overlayStyle === undefined) {\r\n      this.overlayStyle = this.drawStyle;\r\n    }\r\n\r\n    this.addOlOverlayLayer();\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    if (this.value) {\r\n      this.addGeoJSONToOverlay(this.value);\r\n    }\r\n    this.toggleControl();\r\n\r\n    this.ready = true;\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer and any interaction added by this component.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    // This is mandatory when the form control is reused after\r\n    // this component has been destroyed. It seems like the control\r\n    // keeps a reference to this component even after it's destroyed\r\n    // and it attempts to set it's value\r\n    this.ready = false;\r\n\r\n    this.deactivateControl();\r\n    this.olOverlaySource.clear();\r\n    this.map.ol.removeLayer(this.olOverlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  // tslint:disable-next-line:ban-types\r\n  registerOnChange(fn: Function) {\r\n    this.onChange = fn;\r\n  }\r\n  private onChange: any = () => {};\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  // tslint:disable-next-line:ban-types\r\n  registerOnTouched(fn: Function) {\r\n    this.onTouched = fn;\r\n  }\r\n  private onTouched: any = () => {};\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  writeValue(value: GeoJSONGeometry) {\r\n    this.value = value;\r\n  }\r\n\r\n  /**\r\n   * Add an overlay layer to the map\r\n   */\r\n  private addOlOverlayLayer() {\r\n    this.olOverlayLayer = new OlVectorLayer({\r\n      source: new OlVectorSource(),\r\n      zIndex: 500,\r\n      style: null\r\n    });\r\n    this.map.ol.addLayer(this.olOverlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Create a draw control and subscribe to it's geometry\r\n   */\r\n  private createDrawControl() {\r\n    const controlOptions = Object.assign({}, this.controlOptions, {\r\n      geometryType: this.geometryType || 'Point',\r\n      drawingLayer: this.olOverlayLayer,\r\n      interactionStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\r\n        const style = this.drawStyle;\r\n        this.updateDrawStyleWithDrawGuide(style, resolution);\r\n        return style;\r\n      }\r\n    }) as DrawControlOptions;\r\n    this.drawControl = new DrawControl(controlOptions);\r\n  }\r\n\r\n  /**\r\n   * Create a modify control and subscribe to it's geometry\r\n   */\r\n  private createModifyControl() {\r\n    const controlOptions = Object.assign({}, this.controlOptions, {\r\n      layer: this.olOverlayLayer,\r\n      drawStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\r\n        const style = this.drawStyle;\r\n        this.updateDrawStyleWithDrawGuide(style, resolution);\r\n        return style;\r\n      }\r\n    }) as ModifyControlOptions;\r\n    this.modifyControl = new ModifyControl(controlOptions);\r\n  }\r\n\r\n  /**\r\n   * Toggle the proper control (draw or modify)\r\n   */\r\n  private toggleControl() {\r\n    let activate;\r\n    if (!this.value && this.geometryType) {\r\n      activate = this.drawControl;\r\n    } else {\r\n      activate = this.modifyControl;\r\n    }\r\n\r\n    // If the control that should be activated\r\n    // is not the same as the current active control,\r\n    // deactivate the current control and activate the new one\r\n    // Otherwise, do nothing and keep the current control active\r\n    if (activate !== this.activeControl) {\r\n      this.deactivateControl();\r\n      this.activateControl(activate);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param control Control\r\n   */\r\n  private activateControl(control: DrawControl | ModifyControl) {\r\n    this.activeControl = control;\r\n    this.olGeometryEnds$$ = control.end$\r\n      .subscribe((olGeometry: OlGeometry) => this.onOlGeometryEnds(olGeometry));\r\n    if (this.measure === true && control === this.drawControl) {\r\n      this.olGeometryChanges$$ = control.changes$\r\n        .subscribe((olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) => this.onOlGeometryChanges(olGeometry));\r\n    }\r\n    control.setOlMap(this.map.ol, false);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active control\r\n   */\r\n  private deactivateControl() {\r\n    this.removeMeasureTooltip();\r\n    if (this.activeControl !== undefined) {\r\n      this.activeControl.setOlMap(undefined);\r\n    }\r\n    if (this.olGeometryEnds$$ !== undefined) {\r\n      this.olGeometryEnds$$.unsubscribe();\r\n    }\r\n    if (this.olGeometryChanges$$ !== undefined) {\r\n      this.olGeometryChanges$$.unsubscribe();\r\n    }\r\n    this.activeControl = undefined;\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\r\n    this.removeMeasureTooltip();\r\n    this.setOlGeometry(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onOlGeometryChanges(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\r\n    if (olGeometry.getType() !== 'Point') {\r\n      this.updateMeasureTooltip(olGeometry);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When drawing ends, convert the output value to GeoJSON and keep it.\r\n   * Restore the double click interaction.\r\n   * @param olGeometry OL geometry\r\n   */\r\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\r\n    let value;\r\n    if (olGeometry === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (olGeometry.getType() === 'Circle') { // Because Circle doesn't exist as a GeoJSON object\r\n      olGeometry = this.circleToPoint(olGeometry);\r\n    }\r\n\r\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\r\n      featureProjection: this.map.projection,\r\n      dataProjection: 'EPSG:4326'\r\n    });\r\n    if (olGeometry.get('radius')) {\r\n      value.radius = olGeometry.get('radius');\r\n      olGeometry.set('radius', value.radius);\r\n    }\r\n    this.writeValue(value);\r\n  }\r\n\r\n  private circleToPoint(olGeometry) {\r\n    const center = olGeometry.getCenter();\r\n    const coordinates = olproj.transform(center, this.map.projection, 'EPSG:4326');\r\n    const radius = Math.round(olGeometry.getRadius() * (Math.cos((Math.PI / 180) * coordinates[1])));\r\n\r\n    // Convert it to a point object\r\n    olGeometry = new Point(center);\r\n    olGeometry.set('radius', radius, true);\r\n    return olGeometry;\r\n  }\r\n\r\n  /**\r\n   * Add a GeoJSON geometry to the overlay\r\n   * @param geometry GeoJSON geometry\r\n   */\r\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\r\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: this.map.projection\r\n    });\r\n    const olFeature = new OlFeature({\r\n      geometry: olGeometry\r\n    });\r\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\r\n    this.olOverlaySource.clear();\r\n    this.olOverlaySource.addFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Create the measure tooltip\r\n   */\r\n  private createMeasureTooltip() {\r\n    return new OlOverlay({\r\n      element: document.createElement('div'),\r\n      offset: [-30, -10],\r\n      className: [\r\n        'igo-map-tooltip',\r\n        'igo-map-tooltip-measure'\r\n      ].join(' '),\r\n      stopEvent: false\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update the measure tooltip of an OL geometry\r\n   * @param olGeometry OL Geometry\r\n   */\r\n  private updateMeasureTooltip(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\r\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\r\n    const lengths = measure.lengths;\r\n    const lastIndex = olGeometry.getType() === 'Polygon' ? lengths.length - 2 : lengths.length - 1;\r\n    const lastLength = lengths[lastIndex];\r\n\r\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n    const olLastMidpoint = olMidpoints[lastIndex];\r\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\r\n      this.removeMeasureTooltip();\r\n      return;\r\n    }\r\n\r\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\r\n\r\n    const innerHtml = formatMeasure(lastLength, {\r\n      decimal: 1,\r\n      unit: MeasureLengthUnit.Meters,\r\n      unitAbbr: true,\r\n      locale: 'fr'\r\n    });\r\n    this.olTooltip.getElement().innerHTML = innerHtml;\r\n    if (this.olTooltip.getMap() === undefined) {\r\n      this.map.ol.addOverlay(this.olTooltip);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the measure tooltip from the map\r\n   */\r\n  private removeMeasureTooltip() {\r\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\r\n      this.map.ol.removeOverlay(this.olTooltip);\r\n      this.olTooltip.setMap(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adjust the draw style with the specified draw guide distance, if possible\r\n   * @param olStyle Draw style to update\r\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\r\n   */\r\n  private updateDrawStyleWithDrawGuide(\r\n    olStyle: OlStyle.Style |\r\n    ((feature, resolution) => OlStyle.Style) |\r\n    OlStyle.Circle,\r\n    resolution: number) {\r\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle) as OlStyle.Circle;\r\n    if (olGuideStyle === undefined) {\r\n      return;\r\n    }\r\n\r\n    const drawGuide = this.drawGuide;\r\n    let radius;\r\n    if (!drawGuide || drawGuide < 0) {\r\n      radius = this.defaultDrawStyleRadius;\r\n    } else {\r\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\r\n    }\r\n    olGuideStyle.setRadius(radius);\r\n  }\r\n\r\n  /**\r\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\r\n   * @param olStyle The style on which to perform the check\r\n   */\r\n  private isStyleWithRadius(olStyle) {\r\n    return typeof olStyle !== 'function' && olStyle.setRadius;\r\n  }\r\n\r\n  /**\r\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\r\n   * @param olStyle The style on which to perform the check\r\n   */\r\n  private getGuideStyleFromDrawStyle(\r\n    olStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle |\r\n    OlStyle.Style[] | ((feature, resolution) => OlStyle.Style)[] | OlStyle.Circle[]\r\n  ) {\r\n    if (Array.isArray(olStyle)) {\r\n      olStyle = olStyle[0];\r\n    }\r\n    if (this.isStyleWithRadius(olStyle)) {\r\n      return olStyle;\r\n    }\r\n    return undefined;\r\n  }\r\n}\r\n","<ng-template></ng-template>","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\r\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [\r\n    GeometryFormFieldComponent,\r\n    GeometryFormFieldInputComponent\r\n  ],\r\n  declarations: [\r\n    GeometryFormFieldComponent,\r\n    GeometryFormFieldInputComponent\r\n  ]\r\n})\r\nexport class IgoGeometryFormFieldModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoGeometryFormFieldModule\r\n  ],\r\n  exports: [\r\n    IgoGeometryFormFieldModule\r\n  ],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoGeometryModule {}\r\n","<button *ngIf=\"header && options.timeFilterable && options.timeFilter\"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\r\n  [color]=\"color\">\r\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"history\"></mat-icon>\r\n</button>\r\n\r\n<div #ogcFilter class=\"igo-layer-actions-container\"\r\n*ngIf=\"header && options.timeFilterable && options.timeFilter\">\r\n  <igo-time-filter-item\r\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\r\n    igoListItem\r\n    [header]=\"false\"\r\n    [layer]=\"layer\">\r\n  </igo-time-filter-item>\r\n</div>\r\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map';\r\nimport { TimeFilterableDataSourceOptions } from '../shared/time-filter.interface';\r\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-button',\r\n  templateUrl: './time-filter-button.component.html',\r\n  styleUrls: ['./time-filter-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TimeFilterButtonComponent implements OnInit {\r\n\r\n  public options: TimeFilterableDataSourceOptions;\r\n\r\n  get badge() {\r\n    const filter = this.options.timeFilter as any;\r\n    if (filter && filter.enabled) {\r\n      return 1;\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    if (value) {\r\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\r\n    }\r\n  }\r\n  private _layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  public timeFilterCollapse = false;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\r\n  }\r\n}\r\n","<div *ngIf=\"style === 'calendar' && type !=='year'\">\r\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\r\n    <mat-form-field>\r\n      <mat-datetimepicker-toggle [for]=\"datetimePicker\" matSuffix></mat-datetimepicker-toggle>\r\n      <mat-datetimepicker #datetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\r\n      <input matInput autocomplete=\"false\"\r\n        placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\"\r\n        [matDatetimepicker]=\"datetimePicker\"\r\n        [(ngModel)]=\"date\"\r\n        [min]=\"min\"\r\n        [max]=\"max\"\r\n        readonly=\"readonly\"\r\n        (dateChange)=\"handleDateChange($event)\">\r\n    </mat-form-field>\r\n\r\n  </div>\r\n\r\n  <div *ngIf=\"isRange\">\r\n    <div class=\"igo-col igo-col-100\">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]=\"minDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #minDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\r\n        <input matInput autocomplete=\"false\"\r\n          placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\"\r\n          [matDatetimepicker]=\"minDatetimePicker\"\r\n          [(ngModel)]=\"startDate\"\r\n          [min]=\"min\"\r\n          [max]=\"getRangeMaxDate()\"\r\n          readonly=\"readonly\"\r\n          (input)=\"startDate\"\r\n          (dateChange)=\"handleDateChange($event)\">\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class=\"igo-col igo-col-100\">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]=\"maxDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #maxDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\r\n        <input matInput autocomplete=\"false\"\r\n          placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\"\r\n          [matDatetimepicker]=\"maxDatetimePicker\"\r\n          [(ngModel)]=\"endDate\"\r\n          [min]=\"getRangeMinDate()\"\r\n          [max]=\"max\"\r\n          readonly=\"readonly\"\r\n          (dateChange)=\"handleDateChange($event)\">\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div *ngIf=\"style === 'calendar' && type ==='year'\">\r\n\r\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\r\n        <mat-form-field>\r\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\" [(ngModel)]=\"year\" (selectionChange)=\"handleYearChange($event)\">\r\n                  <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{year}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n  </div>\r\n\r\n  <div *ngIf=\"isRange\">\r\n    <div class=\"igo-col igo-col-100\">\r\n        <mat-form-field>\r\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\" [(ngModel)]=\"startYear\" (selectionChange)=\"handleYearChange($event)\">\r\n              <mat-option [value]=\"startYear\" *ngFor=\"let startYear of startListYears\">{{startYear}}</mat-option>\r\n            </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class=\"igo-col igo-col-100\">\r\n    <mat-form-field>\r\n        <mat-select placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\" [(ngModel)]=\"endYear\" (selectionChange)=\"handleYearChange($event)\">\r\n              <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{endYear}}</mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n  <br>\r\n  <div *ngIf=\"!isRange && style === 'slider' && type === 'year'\" class=\"igo-col igo-col-100 igo-col-100-m mat-typography\">\r\n    <span>{{startYear}}</span>\r\n    <mat-slider\r\n        id=\"time-slider\"\r\n        tickInterval=\"auto\"\r\n        step=\"{{step}}\"\r\n        [min]=\"startYear\"\r\n        [max]=\"endYear\"\r\n        [value]=\"handleSliderValue()\"\r\n        [color]=\"color\"\r\n        thumbLabel\r\n        (input)=\"handleSliderYearChange($event)\"\r\n        (change)=\"handleSliderYearChange($event)\"\r\n        [disabled]= \"!options.enabled || !layer.visible\">\r\n    </mat-slider>\r\n    <span>{{endYear}}</span>\r\n    <p *ngIf= \"options.enabled\" class=\"date-below\">{{year}}</p>\r\n    <div #actions class=\"igo-layer-actions-container\">\r\n      <mat-slide-toggle (change)=\"toggleFilterState()\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" [color]=\"color\" [checked]=\"options.enabled\"\r\n        [disabled]=\"!layer.visible\">\r\n      </mat-slide-toggle>\r\n      <button [disabled]= \"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"playYear($event)\">\r\n        <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\r\n       </button>\r\n      <button [disabled]=\"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\r\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n<div *ngIf=\"style === 'slider' && type !== 'year'\" class=\"igo-col igo-col-100 igo-col-100-m\">\r\n  <mat-slider\r\n      id=\"time-slider\"\r\n      tickInterval=\"auto\"\r\n      step=\"{{step}}\"\r\n      [min]=\"dateToNumber(min)\"\r\n      [max]=\"dateToNumber(max)\"\r\n      [value]=\"handleSliderValue()\"\r\n      thumbLabel\r\n      (input)=\"handleSliderDateChange($event)\"\r\n      (selectionChange)=\"handleSliderDateChange($event)\">\r\n  </mat-slider>\r\n  <p class=\"date-below\">{{handleSliderTooltip()}}</p>\r\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\r\n   <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\r\n  </button>\r\n</div>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { DateAdapter } from '@angular/material/core';\r\nimport { MatSlider } from '@angular/material/slider';\r\nimport * as moment from 'moment';\r\nimport olSourceImageWMS from 'ol/source/ImageWMS';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\r\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-form',\r\n  templateUrl: './time-filter-form.component.html',\r\n  styleUrls: ['./time-filter-form.component.scss']\r\n})\r\nexport class TimeFilterFormComponent implements OnInit {\r\n  @Input() layer: Layer;\r\n\r\n  @Input() options: TimeFilterOptions;\r\n\r\n  public color = 'primary';\r\n  public date: Date;\r\n  public startDate: Date;\r\n  public endDate: Date;\r\n  public year: any;\r\n  public startYear: any;\r\n  public endYear: any;\r\n  public initStartYear: any;\r\n  public initEndYear: any;\r\n  public listYears: Array<string> = [];\r\n  public startListYears: Array<string> = [];\r\n  public endListYears: Array<string> = [];\r\n\r\n  @Input()\r\n  set currentValue(value: string) {\r\n    if (value) {\r\n      if (this.type !== TimeFilterType.YEAR) {\r\n        const valueArray = value.split('/');\r\n        if (valueArray.length > 0) {\r\n          const startDate = new Date(valueArray[0]);\r\n          const endDate = new Date(valueArray[1]);\r\n          if (!isNaN(startDate.valueOf())) {\r\n            this.startDate = startDate;\r\n          }\r\n          if (!isNaN(endDate.valueOf())) {\r\n            this.endDate = endDate;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public interval: any;\r\n  public playIcon = 'play-circle';\r\n  public resetIcon = 'replay';\r\n\r\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\r\n  @Output()\r\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\r\n  @ViewChild(MatSlider) mySlider;\r\n\r\n  get type(): TimeFilterType {\r\n    return this.options.type === undefined\r\n      ? TimeFilterType.DATE\r\n      : this.options.type;\r\n  }\r\n\r\n  get isRange(): boolean {\r\n    return this.options.range === undefined ||\r\n      this.options.style === TimeFilterStyle.SLIDER\r\n      ? false\r\n      : this.options.range;\r\n  }\r\n\r\n  get style(): TimeFilterStyle {\r\n    return this.options.style === undefined\r\n      ? TimeFilterStyle.SLIDER\r\n      : this.options.style;\r\n  }\r\n\r\n  get step(): number {\r\n    let step = 10800000;\r\n    if (this.options.step === undefined) {\r\n      switch (this.type) {\r\n        case TimeFilterType.DATE:\r\n        case TimeFilterType.DATETIME:\r\n          step = 10800000;\r\n          break;\r\n        case TimeFilterType.TIME:\r\n          step = 3600000;\r\n          break;\r\n        case TimeFilterType.YEAR:\r\n          step = 31536000000;\r\n          break;\r\n        default:\r\n          step = 10800000;\r\n      }\r\n    } else {\r\n      step = this.getStepDefinition(this.options.step);\r\n    }\r\n\r\n    return step;\r\n  }\r\n\r\n  get timeInterval(): number {\r\n    return this.options.timeInterval === undefined\r\n      ? 2000\r\n      : this.options.timeInterval;\r\n  }\r\n\r\n  get min(): Date {\r\n    if (this.options.min) {\r\n      const min = new Date(this.options.min);\r\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get max(): Date {\r\n    if (this.options.max) {\r\n      const max = new Date(this.options.max);\r\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get is(): boolean {\r\n    return this.options.range === undefined ? false : this.options.range;\r\n  }\r\n\r\n  constructor(private dateAdapter: DateAdapter<Date>) {\r\n    this.dateAdapter.setLocale('fr');\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.startDate === undefined) {\r\n      this.startDate = new Date(this.min);\r\n    }\r\n    if (this.endDate === undefined) {\r\n      this.endDate = new Date(this.max);\r\n    }\r\n    if (this.startYear === undefined) {\r\n      this.startYear = new Date(this.startDate).getFullYear();\r\n      this.initStartYear = this.startYear;\r\n    }\r\n    if (this.endYear === undefined) {\r\n      this.endYear = new Date(this.endDate).getFullYear();\r\n      this.initEndYear = this.endYear;\r\n    }\r\n\r\n    if (!this.isRange) {\r\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\r\n        this.listYears.push(i);\r\n      }\r\n    } else {\r\n      for (let i = this.startYear; i < this.endYear; i++) {\r\n        this.startListYears.push(i);\r\n      }\r\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\r\n        this.endListYears.push(i);\r\n      }\r\n    }\r\n    this.options.enabled =\r\n      this.options.enabled === undefined ? true : this.options.enabled;\r\n    this.checkFilterValue();\r\n    if (this.options.enabled) {\r\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\r\n        this.yearChange.emit(this.year);\r\n      }\r\n    } else {\r\n      this.storeCurrentFilterValue();\r\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  storeCurrentFilterValue() {\r\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    if (\r\n      !this.isRange &&\r\n      this.style === TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      this.options.value = this.year.toString();\r\n    }\r\n  }\r\n\r\n  checkFilterValue() {\r\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\r\n    const timeFromWms = olSource.getParams().TIME;\r\n    if (\r\n      !this.isRange &&\r\n      this.style === TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      if (timeFromWms) {\r\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\r\n      } else if (this.options.value) {\r\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\r\n      } else {\r\n        this.year = new Date(this.min).getFullYear() + 1;\r\n      }\r\n    } else if (\r\n      this.isRange &&\r\n      this.style === TimeFilterStyle.CALENDAR &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      if (timeFromWms) {\r\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\r\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\r\n        const newStartListYears: any[] = [];\r\n        const newEndListYears: any[] = [];\r\n        for (let i = this.initStartYear; i < this.endYear; i++) {\r\n          newStartListYears.push(i);\r\n        }\r\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\r\n          newEndListYears.push(i);\r\n        }\r\n        this.startListYears = newStartListYears;\r\n        this.endListYears = newEndListYears;\r\n      }\r\n    }\r\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n  }\r\n\r\n  handleDateChange(event: any) {\r\n    this.setupDateOutput();\r\n    this.applyTypeChange();\r\n\r\n    // Only if is range, use 2 dates to make the range\r\n    if (this.isRange) {\r\n      this.change.emit([this.startDate, this.endDate]);\r\n    } else {\r\n      this.change.emit(this.startDate);\r\n    }\r\n  }\r\n\r\n  handleYearChange(event: any) {\r\n    if (this.isRange) {\r\n      this.endListYears = [];\r\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\r\n        this.endListYears.push(i);\r\n      }\r\n      this.startListYears = [];\r\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\r\n        this.startListYears.push(i);\r\n      }\r\n      this.yearChange.emit([this.startYear, this.endYear]);\r\n    } else {\r\n      this.yearChange.emit(this.year);\r\n    }\r\n  }\r\n\r\n  handleListYearChange(event: any) {\r\n    this.handleYearChange([this.startYear, this.endYear]);\r\n  }\r\n\r\n  handleListYearStartChange(event: any) {\r\n    this.change.emit([this.startDate, this.endDate]);\r\n  }\r\n\r\n  dateToNumber(date: Date): number {\r\n    let newDate;\r\n    if (date) {\r\n      newDate = new Date(date);\r\n    } else {\r\n      newDate = new Date(this.min);\r\n    }\r\n\r\n    return newDate.getTime();\r\n  }\r\n\r\n  setSliderThumbLabel(label: string) {\r\n    const thumbLabel = this.findThumbLabel(\r\n      this.mySlider._elementRef.nativeElement.childNodes\r\n    );\r\n    if (thumbLabel) {\r\n      thumbLabel.textContent = label;\r\n    }\r\n  }\r\n\r\n  findThumbLabel(test: any[]): any {\r\n    let thumbLabel;\r\n\r\n    test.forEach(value => {\r\n      if (value.className === 'mat-slider-thumb-label-text') {\r\n        thumbLabel = value;\r\n      }\r\n\r\n      if (value.children.length > 0 && !thumbLabel) {\r\n        thumbLabel = this.findThumbLabel(value.childNodes);\r\n      }\r\n    }, this);\r\n    return thumbLabel;\r\n  }\r\n\r\n  toggleFilterState() {\r\n    this.options.enabled = !this.options.enabled;\r\n\r\n    if (this.options.enabled) {\r\n      if (\r\n        !this.isRange &&\r\n        TimeFilterStyle.SLIDER &&\r\n        this.type === TimeFilterType.YEAR\r\n      ) {\r\n        this.yearChange.emit(this.year);\r\n      }\r\n    } else {\r\n      this.stopFilter();\r\n      this.storeCurrentFilterValue();\r\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  resetFilter(event: any) {\r\n    this.date = new Date(this.min);\r\n    this.year = this.date.getFullYear();\r\n    if (\r\n      !this.isRange &&\r\n      TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      this.yearChange.emit(this.year);\r\n    } else {\r\n      this.setupDateOutput();\r\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  playFilter(event: any) {\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        that => {\r\n          let newMinDateNumber;\r\n          const maxDateNumber = new Date(that.max);\r\n\r\n          newMinDateNumber =\r\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\r\n          newMinDateNumber += that.mySlider.step;\r\n          that.date = new Date(newMinDateNumber);\r\n\r\n          if (newMinDateNumber > maxDateNumber.getTime()) {\r\n            that.stopFilter();\r\n          }\r\n\r\n          that.handleDateChange({ value: that.date, date: that.date });\r\n        },\r\n        this.timeInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  playYear(event: any) {\r\n    if (\r\n      this.year + this.mySlider.step >\r\n      this.max.getFullYear() + this.mySlider.step\r\n    ) {\r\n      this.stopFilter();\r\n      this.resetFilter(event);\r\n    }\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(() => {\r\n        if (\r\n          (this.year + this.mySlider.step) > this.max.getFullYear()) {\r\n          this.stopFilter();\r\n        } else {\r\n          this.year = this.year + this.mySlider.step;\r\n        }\r\n        this.yearChange.emit(this.year);\r\n\r\n      }, this.timeInterval, this);\r\n    }\r\n  }\r\n\r\n  stopFilter() {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n  }\r\n\r\n  handleSliderDateChange(event: any) {\r\n    this.date = new Date(event.value);\r\n    this.setSliderThumbLabel(this.handleSliderTooltip());\r\n    this.handleDateChange(event);\r\n  }\r\n\r\n  handleSliderYearChange(event: any) {\r\n    this.year = event.value;\r\n    this.yearChange.emit(this.year);\r\n  }\r\n\r\n  handleSliderValue(): number {\r\n    if (this.options.current === true || !this.min) {\r\n      const currentDate = new Date();\r\n      this.date = this.getRoundedDate(currentDate);\r\n    }\r\n    if (this.type === TimeFilterType.YEAR) {\r\n      return this.year;\r\n    } else {\r\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\r\n    }\r\n  }\r\n\r\n  handleSliderTooltip() {\r\n    let label: string;\r\n\r\n    switch (this.type) {\r\n      case TimeFilterType.DATE:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toDateString()\r\n            : this.date.toDateString();\r\n        break;\r\n      case TimeFilterType.TIME:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toTimeString()\r\n            : this.date.toTimeString();\r\n        break;\r\n      // datetime\r\n      default:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toUTCString()\r\n            : this.date.toUTCString();\r\n        break;\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  setupDateOutput() {\r\n    if (this.style === TimeFilterStyle.SLIDER) {\r\n      this.startDate = new Date(this.date);\r\n      this.startDate.setSeconds(-(this.step / 1000));\r\n      this.endDate = new Date(this.startDate);\r\n      this.endDate.setSeconds(this.step / 1000);\r\n    } else if (!this.isRange && !!this.date) {\r\n      this.endDate = new Date(this.date);\r\n      this.startDate = new Date(this.date);\r\n    } else if (this.isRange && (!!this.date || !this.date)) {\r\n      this.startDate =\r\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\r\n      this.endDate =\r\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\r\n    } else if (!this.date) {\r\n      this.startDate =\r\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\r\n      this.endDate =\r\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\r\n    }\r\n  }\r\n\r\n  applyTypeChange() {\r\n    switch (this.type) {\r\n      case TimeFilterType.DATE:\r\n        if (this.startDate !== undefined || this.endDate !== undefined) {\r\n          this.startDate.setHours(0);\r\n          this.startDate.setMinutes(0);\r\n          this.startDate.setSeconds(0);\r\n          this.endDate.setHours(23);\r\n          this.endDate.setMinutes(59);\r\n          this.endDate.setSeconds(59);\r\n        }\r\n        break;\r\n      case TimeFilterType.TIME:\r\n        if (this.style === TimeFilterStyle.CALENDAR) {\r\n          if (this.startDate.getDay() !== this.min.getDay()) {\r\n            const selectedHour = this.startDate.getHours();\r\n            const selectedMinute = this.startDate.getMinutes();\r\n            this.startDate = this.min;\r\n            this.startDate.setHours(selectedHour);\r\n            this.startDate.setMinutes(selectedMinute);\r\n          }\r\n\r\n          if (this.endDate.getDay() !== this.min.getDay()) {\r\n            const selectedHour = this.endDate.getHours();\r\n            const selectedMinute = this.endDate.getMinutes();\r\n            this.endDate = this.min;\r\n            this.endDate.setHours(selectedHour);\r\n            this.endDate.setMinutes(selectedMinute);\r\n          }\r\n        }\r\n\r\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\r\n          this.startDate.setMinutes(0);\r\n          this.startDate.setSeconds(0);\r\n          this.endDate.setMinutes(59);\r\n          this.endDate.setSeconds(59);\r\n        }\r\n        break;\r\n      // datetime\r\n      default:\r\n      // do nothing\r\n    }\r\n  }\r\n\r\n  getRangeMinDate(): Date {\r\n    return this.startDate === undefined ? this.min : this.startDate;\r\n  }\r\n\r\n  getRangeMaxDate(): Date {\r\n    return this.endDate === undefined ? this.max : this.endDate;\r\n  }\r\n\r\n  /**\r\n   * Round date at a certain time, 10 minutes by Default\r\n   * @param date - Date to Round\r\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\r\n   * @return the rounded date\r\n   */\r\n  getRoundedDate(date, atMinute = 10) {\r\n    const coeff = 1000 * 60 * atMinute;\r\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\r\n  }\r\n\r\n  /**\r\n   * Get the step (period) definition from the layer dimension tag\r\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\r\n   * @return the duration in milliseconds\r\n   */\r\n  getStepDefinition(step) {\r\n    return moment.duration(step).asMilliseconds();\r\n  }\r\n}\r\n","<mat-list-item *ngIf=\"header\">\r\n  <mat-icon\r\n    class=\"igo-chevron\"\r\n    mat-list-avatar\r\n    igoCollapse\r\n    [target]=\"filters\"\r\n    [collapsed]=\"filtersCollapsed\"\r\n    (click)=\"toggleFiltersCollapsed()\"\r\n    svgIcon=\"chevron-up\" >\r\n  </mat-icon>\r\n  <h4 (click)=\"toggleLegendOnClick()\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\"  matLine>{{layer.title}}</h4>\r\n  \r\n  <button *ngIf=\"header\"\r\n    mat-icon-button\r\n    [color]=\"layer.visible ? 'primary' : 'default'\"\r\n    collapsibleButton\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"layer.visible ?\r\n                  ('igo.geo.layer.hideLayer' | translate) :\r\n                  ('igo.geo.layer.showLayer' | translate)\"\r\n    (click)=\"layer.visible = !layer.visible\">\r\n    <mat-icon\r\n      [ngClass]=\"{disabled: !(inResolutionRange$ | async)}\"\r\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\r\n    </mat-icon>\r\n  </button>\r\n\r\n</mat-list-item>\r\n\r\n<div #filters class=\"igo-datasource-filters-container\">\r\n  <div #legend class=\"igo-layer-legend-container\">\r\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\r\n    </igo-layer-legend>\r\n  </div>\r\n  <igo-time-filter-form\r\n    [layer]= \"layer\"\r\n    [options]=\"datasource.options.timeFilter\"\r\n    [currentValue]=\"datasource.options.params.TIME\"\r\n    (change)=\"handleDateChange($event)\"\r\n    (yearChange)=\"handleYearChange($event)\">\r\n  </igo-time-filter-form>\r\n</div>\r\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { TimeFilterableDataSource } from '../shared/time-filter.interface';\r\nimport { TimeFilterService } from '../shared/time-filter.service';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-item',\r\n  templateUrl: './time-filter-item.component.html',\r\n  styleUrls: ['./time-filter-item.component.scss']\r\n})\r\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\r\n  public color = 'primary';\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  private resolution$$: Subscription;\r\n\r\n  filtersCollapsed: boolean = false;\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  get datasource(): TimeFilterableDataSource {\r\n    return this.layer.dataSource as TimeFilterableDataSource;\r\n  }\r\n  constructor(private timeFilterService: TimeFilterService) {}\r\n\r\n  ngOnInit(): void {\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.resolution$$.unsubscribe();\r\n  }\r\n\r\n  handleYearChange(year: string | [string, string]) {\r\n    this.timeFilterService.filterByYear(this.datasource, year);\r\n  }\r\n\r\n  handleDateChange(date: Date | [Date, Date]) {\r\n    this.timeFilterService.filterByDate(this.datasource, date);\r\n  }\r\n\r\n  private toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    if (!this.filtersCollapsed) {\r\n      this.toggleLegend(this.showLegend$.value);\r\n    }\r\n  }\r\n\r\n  public setVisible() {\r\n    this.layer.visible = true;\r\n  }\r\n\r\n  toggleFiltersCollapsed() {\r\n    this.filtersCollapsed = !this.filtersCollapsed;\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\r\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'time'\">\r\n    <igo-time-filter-item [header]=\"true\" igoListItem [layer]=\"layer\"></igo-time-filter-item>\r\n  </ng-template>\r\n</igo-list>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-list',\r\n  templateUrl: './time-filter-list.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TimeFilterListComponent {\r\n  @Input()\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  set layers(value: Layer[]) {\r\n    this._layers = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n  private _layers: Layer[] = [];\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport * as olproj from 'ol/proj';\r\nimport olWKT from 'ol/format/WKT';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WktService {\r\n  constructor() {}\r\n\r\n  public wktToFeature(wkt, wktProj, featureProj) {\r\n    return new olWKT().readFeature(wkt, {\r\n      dataProjection: wktProj,\r\n      featureProjection: featureProj\r\n    });\r\n  }\r\n  public extentToWkt(epsgTO, extent, extentProj) {\r\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\r\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\r\n    const wktPoly = `POLYGON((\r\n      ${extent[0]} ${extent[1]},\r\n      ${extent[0]} ${extent[3]},\r\n      ${extent[2]} ${extent[3]},\r\n      ${extent[2]} ${extent[1]},\r\n      ${extent[0]} ${extent[1]}))`;\r\n    const wktLine = `LINESTRING(\r\n      ${extent[0]} ${extent[1]},\r\n      ${extent[0]} ${extent[3]},\r\n      ${extent[2]} ${extent[3]},\r\n      ${extent[2]} ${extent[1]},\r\n      ${extent[0]} ${extent[1]})`;\r\n    const wktMultiPoints = `MULTIPOINT(\r\n        ${extent[0]} ${extent[1]},\r\n        ${extent[0]} ${extent[3]},\r\n        ${extent[2]} ${extent[3]},\r\n        ${extent[2]} ${extent[1]})`;\r\n    return {\r\n      wktPoly,\r\n      wktLine,\r\n      wktMultiPoints\r\n    };\r\n  }\r\n\r\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\r\n    const lproj = olproj.get(projection);\r\n    const units = lproj.getUnits();\r\n    const olUnits = ['ft', 'm', 'us-ft'];\r\n    if (olUnits.indexOf(units) !== -1) {\r\n      coordinateArray = this.roundArray(coordinateArray, decimal);\r\n    }\r\n    return coordinateArray;\r\n  }\r\n\r\n  private roundArray(array, decimal = 0) {\r\n    let x = 0;\r\n    while (x < array.length) {\r\n      array[x] = array[x].toFixed(decimal);\r\n      x++;\r\n    }\r\n    return array;\r\n  }\r\n\r\n  public snrcToWkt(snrc, epsgTO) {\r\n    snrc = snrc.toLowerCase();\r\n    let wktPoly;\r\n    const ew = {\r\n      1: { from: -56, to: -64 },\r\n      2: { from: -64, to: -72 },\r\n      3: { from: -72, to: -80 },\r\n      4: { from: -80, to: -88 },\r\n      5: { from: -88, to: -96 },\r\n      6: { from: -96, to: -104 },\r\n      7: { from: -104, to: -112 },\r\n      8: { from: -112, to: -120 },\r\n      9: { from: -120, to: -128 },\r\n      10: { from: -128, to: -136 }\r\n    };\r\n    const sn = {\r\n      1: { from: 44, to: 48 },\r\n      2: { from: 48, to: 52 },\r\n      3: { from: 52, to: 56 },\r\n      4: { from: 56, to: 60 },\r\n      5: { from: 60, to: 64 },\r\n      6: { from: 64, to: 68 },\r\n      7: { from: 68, to: 72 },\r\n      8: { from: 72, to: 76 },\r\n      9: { from: 76, to: -128 }\r\n    };\r\n    const snrc250kIndex = [\r\n      ['m', 'n', 'o', 'p'],\r\n      ['l', 'k', 'j', 'i'],\r\n      ['e', 'f', 'g', 'h'],\r\n      ['d', 'c', 'b', 'a']\r\n    ];\r\n\r\n    const snrc50kIndex = [\r\n      ['13', '14', '15', '16'],\r\n      ['12', '11', '10', '09'],\r\n      ['05', '06', '07', '08'],\r\n      ['04', '03', '02', '01']\r\n    ];\r\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\r\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\r\n    const checkSNRC1m = /\\d{2,3}/gi;\r\n\r\n    let snrc1m = false;\r\n    let snrc250k = false;\r\n    let snrc50k = false;\r\n\r\n    if (checkSNRC50k.test(snrc)) {\r\n      snrc50k = true;\r\n    } else {\r\n      if (checkSNRC250k.test(snrc)) {\r\n        snrc250k = true;\r\n      } else {\r\n        if (checkSNRC1m.test(snrc)) {\r\n          snrc1m = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (snrc1m) {\r\n      snrc += 'a01';\r\n    } else if (snrc250k) {\r\n      snrc += '01';\r\n    }\r\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\r\n      const regex1m = /(?=[a-p])/gi;\r\n      const ar1m = snrc.split(regex1m);\r\n      const part1m = ar1m[0];\r\n      const part250k = ar1m[1][0];\r\n      const part50k = ar1m[1].split(part250k)[1];\r\n      let separator = 1;\r\n      if (part1m.length === 3) {\r\n        separator = 2;\r\n      }\r\n      const partEW = part1m.substring(0, separator);\r\n      const partSN = part1m.substring(separator);\r\n      const unit1mEW = 8;\r\n      const unit1mSN = 4;\r\n      const unit250kEW = 2;\r\n      const unit250kSN = 1;\r\n      const unit50kEW = 0.5;\r\n      const unit50kSN = 0.25;\r\n      let index250kEW = 0;\r\n      let index250kSN = 0;\r\n      let index50kEW = 0;\r\n      let index50kSN = 0;\r\n      snrc250kIndex.forEach(element => {\r\n        if (element.indexOf(part250k) !== -1) {\r\n          index250kSN = snrc250kIndex.indexOf(element);\r\n          index250kEW = element.indexOf(part250k);\r\n        }\r\n      });\r\n      snrc50kIndex.forEach(element => {\r\n        if (element.indexOf(part50k) !== -1) {\r\n          index50kSN = snrc50kIndex.indexOf(element);\r\n          index50kEW = element.indexOf(part50k);\r\n        }\r\n      });\r\n\r\n      let increment250kEW = 0;\r\n      let increment250kSN = 0;\r\n      let increment50kEW = 0;\r\n      let increment50kSN = 0;\r\n      let unitPerTypeEW = unit1mEW;\r\n      let unitPerTypeSN = unit1mSN;\r\n      if (snrc250k) {\r\n        increment250kEW = index250kEW * unit250kEW;\r\n        increment250kSN = index250kSN * unit250kSN;\r\n        increment50kEW = 0;\r\n        increment50kSN = 0;\r\n        unitPerTypeEW = unit250kEW;\r\n        unitPerTypeSN = unit250kSN;\r\n      } else if (snrc50k) {\r\n        increment250kEW = index250kEW * unit250kEW;\r\n        increment250kSN = index250kSN * unit250kSN;\r\n        increment50kEW = index50kEW * unit50kEW;\r\n        increment50kSN = index50kSN * unit50kSN;\r\n        unitPerTypeEW = unit50kEW;\r\n        unitPerTypeSN = unit50kSN;\r\n      }\r\n\r\n      const coord: {ul?: any, lr?: any, ur?: any, ll?: any} = {\r\n        ul: [\r\n          ew[partEW].to + increment250kEW + increment50kEW,\r\n          sn[partSN].to - increment250kSN - increment50kSN\r\n        ]\r\n      };\r\n\r\n      coord.lr = [\r\n        coord.ul[0] + unitPerTypeEW,\r\n        coord.ul[1] - unitPerTypeSN\r\n      ];\r\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\r\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\r\n\r\n      coord.ul = olproj.transform(\r\n        [coord.ul[0], coord.ul[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.lr = olproj.transform(\r\n        [coord.lr[0], coord.lr[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.ur = olproj.transform(\r\n        [coord.ur[0], coord.ur[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.ll = olproj.transform(\r\n        [coord.ll[0], coord.ll[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n\r\n      // Rounded coordinate to shorten url in get\r\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\r\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\r\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\r\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\r\n\r\n      wktPoly =\r\n        'POLYGON((' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' '),\r\n          coord.ul.join(' ')\r\n        ].join(',') +\r\n        '))';\r\n      const wktLine =\r\n        'LINESTRING(' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' '),\r\n          coord.ul.join(' ')\r\n        ].join(',') +\r\n        ')';\r\n\r\n      const wktMultiPoints =\r\n        'MULTIPOINT(' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' ')\r\n        ].join(',') +\r\n        ')';\r\n      return {\r\n        wktPoly,\r\n        wktLine,\r\n        wktMultiPoints\r\n      };\r\n    }\r\n  }\r\n}\r\n","<mat-checkbox\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\r\n  (click)=\"$event.stopPropagation()\"\r\n  (change)=\"toggleFilterState($event)\"\r\n  [checked]=\"currentFilter.active\">\r\n</mat-checkbox>\r\n\r\n<mat-form-field\r\n  [ngClass]=\"{'logical': activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true, 'logicalHidden': activeFilters.indexOf(currentFilter) === 0 || currentFilter.active!==true}\">\r\n  <mat-select\r\n    [disabled]=\"!currentFilter.active\"\r\n    [value]=\"currentFilter.parentLogical\"\r\n    tooltip-position=\"above\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"currentFilter.parentLogical ? (('igo.geo.operators.tooltip.'+ currentFilter.parentLogical) | translate) : ''\"\r\n    (selectionChange)=\"changeLogical($event.value)\">\r\n      <mat-option\r\n        [value]=ogcFilterOperator.And\r\n        tooltip-position=\"above\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\">\r\n          {{'igo.geo.operators.And' | translate}}\r\n      </mat-option>\r\n      <mat-option\r\n        [value]=ogcFilterOperator.Or\r\n        tooltip-position=\"above\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\">\r\n          {{'igo.geo.operators.Or' | translate}}\r\n      </mat-option>\r\n  </mat-select>\r\n</mat-form-field>\r\n\r\n<mat-form-field\r\n  class=\"field\"\r\n  *ngIf=\"!(currentFilterIsSpatial$ | async) && (fields$ | async) && (fields$| async).length > 0 && (fields$| async)[0].name !== ''\"\r\n  (mouseenter)=\"inputClearable = 'selectField'\"\r\n  (mouseleave)=\"inputClearable = undefined\"\r\n  [floatLabel]=\"floatLabel\">\r\n  <input\r\n  matInput\r\n  [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\r\n  [disabled]=\"!currentFilter.active\"\r\n  [matAutocomplete]=\"autoCompleteField\"\r\n  [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\r\n  tooltip-position=\"above\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ('igo.geo.sourceFields.selectField' | translate)\"\r\n  (input)=\"updateFieldsList($event.target.value)\">\r\n  <mat-autocomplete #autoCompleteField=\"matAutocomplete\"\r\n  (optionSelected)='changeField($event.option.id)'>\r\n    <mat-option\r\n      *ngFor=\"let field of filteredFields$ | async\"\r\n      matTooltipShowDelay=\"500\"\r\n      [value]=\"field.alias\"\r\n      [id]=\"field.name\"\r\n      [matTooltip]=\"field.alias\">\r\n      {{field.alias}}\r\n    </mat-option>\r\n  </mat-autocomplete>\r\n  <button mat-button\r\n    *ngIf=\"currentFilter.propertyName && inputClearable === 'selectField' && currentFilter.active\"\r\n    matSuffix\r\n    mat-icon-button\r\n    aria-label=\"Clear\"\r\n    [disabled]=\"!currentFilter.active\"\r\n    (click)=\"clearSelectedField()\">\r\n        <mat-icon svgIcon=\"close\"></mat-icon>\r\n  </button>\r\n</mat-form-field>\r\n\r\n\r\n<mat-form-field\r\n  [ngClass]=\"{'operator': !(currentFilterIsSpatial$ | async) , 'dualInput': (currentFilterIsSpatial$ | async)}\"\r\n  [floatLabel]=\"floatLabel\">\r\n  <mat-select\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"currentFilter.operator ? (('igo.geo.operators.tooltip.'+ currentFilter.operator) | translate) : ('igo.geo.filter.selectOperator' | translate)\"\r\n    [disabled]=\"!currentFilter.active\"\r\n    [value]=\"currentFilter.operator\"\r\n    (selectionChange)=\"changeOperator($event.value)\">\r\n      <mat-option\r\n        *ngFor=\"let operator of (ogcFilterOperators$ | async) | keyvalue\"\r\n        tooltip-position=\"above\"\r\n        matTooltipShowDelay=\"500\"\r\n        [value]=\"operator.key\"\r\n        [matTooltip]=\"('igo.geo.operators.tooltip.'+ operator.key) | translate\">\r\n          {{('igo.geo.operators.'+ operator.key) | translate}}\r\n      </mat-option>\r\n  </mat-select>\r\n</mat-form-field>\r\n\r\n<mat-form-field\r\nclass=\"spatialSelector\"\r\n*ngIf=\"currentFilterIsSpatial$ | async\">\r\n  <mat-select\r\n    [disabled]=\"!currentFilter.active\"\r\n    [value]=\"currentFilter.igoSpatialSelector\"\r\n    (selectionChange)=\"changeSpatialSelector($event.value)\">\r\n      <mat-option\r\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\r\n        [value]=\"igoSpatialSelector.type\">\r\n          {{('igo.geo.spatialSelector.'+ igoSpatialSelector.type) | translate}}\r\n      </mat-option>\r\n  </mat-select>\r\n</mat-form-field>\r\n\r\n<mat-form-field\r\nclass=\"singleInput\"\r\n*ngIf=\"['expression','pattern'].indexOf(detectProperty()) !== -1\"\r\n(mouseenter)=\"inputClearable = 'selectProperty'\"\r\n(mouseleave)=\"inputClearable = undefined\"\r\n[floatLabel]=\"floatLabel\">\r\n  <input\r\n    matInput\r\n    [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\r\n    [disabled]=\"!currentFilter.active\"\r\n    [matAutocomplete]=\"autoCompleteValues\"\r\n    [value]=\"detectProperty() === 'expression' ? currentFilter.expression : currentFilter.pattern\"\r\n    tooltip-position=\"above\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"detectProperty() === 'expression' ? currentFilter.expression || '' : currentFilter.pattern || ''\"\r\n    (input)=\"updateValuesList($event.target.value)\">\r\n  <mat-autocomplete #autoCompleteValues=\"matAutocomplete\"\r\n    (optionSelected)=\"changeProperty($event.option.value)\">\r\n    <mat-option\r\n      *ngFor=\"let value of filteredValues$ | async\"\r\n      matTooltipShowDelay=\"500\"\r\n      [value]=\"value\"\r\n      [matTooltip]=\"value\">\r\n      {{value}}\r\n    </mat-option>\r\n  </mat-autocomplete>\r\n  <button mat-button\r\n    *ngIf=\"isClearable() && inputClearable === 'selectProperty' && currentFilter.active\"\r\n    matSuffix\r\n    mat-icon-button\r\n    aria-label=\"Clear\"\r\n    [disabled]=\"!currentFilter.active\"\r\n    (click)=\"clearProperty()\">\r\n        <mat-icon svgIcon=\"close\"></mat-icon>\r\n  </button>\r\n</mat-form-field>\r\n\r\n<div class=\"igo-layer-button-group\">\r\n  <button\r\n    mat-icon-button\r\n    collapsibleButton\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\r\n    color=\"warn\"\r\n    (click)=\"deleteFilter()\">\r\n    <mat-icon svgIcon=\"delete\"></mat-icon>\r\n  </button>\r\n</div>\r\n\r\n<mat-form-field\r\nclass=\"snrc\"\r\n*ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'snrc'\"\r\n(mouseenter)=\"inputClearable = 'selectSNRC'\"\r\n(mouseleave)=\"inputClearable = undefined\"\r\n[floatLabel]=\"floatLabel\">\r\n  <input\r\n    matInput\r\n    [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\r\n    [value]=\"currentFilter.igoSNRC\"\r\n    tooltip-position=\"above\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\r\n    (input)=\"changeSNRC($event.target.value)\">\r\n  <button\r\n    mat-button\r\n    *ngIf=\"currentFilter.igoSNRC\"\r\n    matSuffix\r\n    mat-icon-button\r\n    aria-label=\"Clear\"\r\n    [disabled]=\"!currentFilter.active && inputClearable === 'selectSNRC' && currentFilter.active\"\r\n    (click)=\"currentFilter.igoSNRC=''\">\r\n      <mat-icon svgIcon=\"close\"></mat-icon>\r\n  </button>\r\n  </mat-form-field>\r\n\r\n  <ng-container *ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'fixedExtent'\">\r\n    <button\r\n    mat-button\r\n    [disabled]=\"!currentFilter.active\"\r\n    *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\r\n    matSuffix\r\n    mat-icon-button\r\n    [disabled]=\"!currentFilter.active\"\r\n    (click)=\"changeMapExtentGeometry()\"\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\">\r\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\r\n  </button>\r\n</ng-container>\r\n\r\n<br/>\r\n\r\n<mat-form-field\r\nclass=\"dualInput\"\r\n*ngIf=\"!isTemporalOperator() && ['lowerBoundary','begin'].indexOf(detectProperty(1)) !== -1\"\r\n(mouseenter)=\"inputClearable = 'selectProperty1'\"\r\n(mouseleave)=\"inputClearable = undefined\"\r\n[floatLabel]=\"floatLabel\">\r\n    <input\r\n      matInput\r\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\r\n      [disabled]=\"!currentFilter.active\"\r\n      [matAutocomplete]=\"autoDualValueOperator1\"\r\n      type=\"number\"\r\n      [value]=\"detectProperty(1) === 'lowerBoundary' ? currentFilter.lowerBoundary : currentFilter.begin\"\r\n      (input)=\"updateValuesList($event.target.value,1)\">\r\n    <mat-autocomplete #autoDualValueOperator1=\"matAutocomplete\"\r\n      (optionSelected)=\"changeNumericProperty($event.option.value,1)\">\r\n      <mat-option\r\n        *ngFor=\"let value of filteredValues$ | async\"\r\n        matTooltipShowDelay=\"500\"\r\n        [value]=\"value\"\r\n        [matTooltip]=\"value\">\r\n        {{value}}\r\n      </mat-option>\r\n    </mat-autocomplete>\r\n    <button mat-button\r\n      *ngIf=\"isClearable(1) && inputClearable === 'selectProperty1' && currentFilter.active\"\r\n      matSuffix\r\n      mat-icon-button\r\n      aria-label=\"Clear\"\r\n    [disabled]=\"!currentFilter.active\"\r\n      (click)=\"clearProperty(1)\">\r\n          <mat-icon svgIcon=\"close\"></mat-icon>\r\n    </button>\r\n</mat-form-field>\r\n\r\n<mat-form-field\r\n  class=\"dualInput\"\r\n  *ngIf=\"!isTemporalOperator() && ['upperBoundary','end'].indexOf(detectProperty(2)) !== -1\"\r\n  (mouseenter)=\"inputClearable = 'selectProperty2'\"\r\n  (mouseleave)=\"inputClearable = undefined\"\r\n  [floatLabel]=\"floatLabel\">\r\n    <input\r\n      matInput\r\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\r\n      [disabled]=\"!currentFilter.active\"\r\n      [matAutocomplete]=\"autoDualValueOperator2\"\r\n      type=\"number\"\r\n      [value]=\"detectProperty(2) === 'upperBoundary' ? currentFilter.upperBoundary : currentFilter.end\"\r\n      (input)=\"updateValuesList($event.target.value,2)\">\r\n    <mat-autocomplete #autoDualValueOperator2=\"matAutocomplete\"\r\n      (optionSelected)=\"changeNumericProperty($event.option.value,2)\">\r\n      <mat-option\r\n        *ngFor=\"let value of filteredValues$ | async\"\r\n        matTooltipShowDelay=\"500\"\r\n        [value]=\"value\"\r\n        [matTooltip]=\"value\">\r\n        {{value}}\r\n      </mat-option>\r\n    </mat-autocomplete>\r\n    <button mat-button\r\n      *ngIf=\"isClearable(2) && inputClearable === 'selectProperty2' && currentFilter.active\"\r\n      matSuffix\r\n      mat-icon-button\r\n      aria-label=\"Clear\"\r\n      [disabled]=\"!currentFilter.active\"\r\n      (click)=\"clearProperty(2)\">\r\n          <mat-icon svgIcon=\"close\"></mat-icon>\r\n    </button>\r\n</mat-form-field>\r\n\r\n<igo-ogc-filter-time *ngIf=\"isTemporalOperator()\"\r\n  [(datasource)]=\"datasource\"\r\n  [(currentFilter)]=\"currentFilter\"\r\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\">\r\n</igo-ogc-filter-time>\r\n\r\n<!--\r\nTODO C'EST PERTINENT je crois\r\n<mat-form-field class=\"field\" *ngIf=\"!(currentFilterIsSpatial$ | async) && (fields$| async) && (fields$| async).length === 1 &&  (fields$| async)[0].name === ''\">\r\n<input [disabled]=\"!currentFilter.active\" matInput #fieldPerUser (keyup)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\"\r\n  (blur)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\" [(ngModel)]=\"currentFilter.propertyName\">\r\n<button mat-button *ngIf=\"currentFilter.propertyName\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"currentFilter.propertyName=''\">\r\n  <mat-icon svgIcon=\"close\"></mat-icon>\r\n</button>\r\n</mat-form-field>\r\n\r\n\r\n\r\n<mat-checkbox labelPosition='before' (change)=\"changeCaseSensitive($event)\" [(ngModel)]=\"currentFilter.matchCase\">\r\n  {{('igo.geo.operators.caseSensitive') | translate}}\r\n</mat-checkbox>\r\n\r\n</mat-list-item> -->\r\n","import { Component, Input, OnInit } from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material/form-field';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\n\r\nimport {\r\n  OgcFilterableDataSource,\r\n  OgcFiltersOptions\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport { WktService } from '../../wkt/shared/wkt.service';\r\nimport { IgoMap } from '../../map';\r\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-form',\r\n  templateUrl: './ogc-filter-form.component.html',\r\n  styleUrls: ['./ogc-filter-form.component.scss']\r\n})\r\nexport class OgcFilterFormComponent implements OnInit {\r\n  ogcFilterOperator = OgcFilterOperator;\r\n  filteredValues$: Observable<string[]>;\r\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\r\n  public allOgcFilterOperators;\r\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\r\n    undefined\r\n  );\r\n  public igoSpatialSelectors;\r\n  public value = '';\r\n  public inputOperator;\r\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\r\n    undefined\r\n  );\r\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\r\n  public color = 'primary';\r\n  public disabled;\r\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\r\n  public defaultStepMillisecond = 6000;\r\n  public inputClearable: string;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() currentFilter: any;\r\n\r\n  set snrc(value: any) {\r\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\r\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\r\n    const checkSNRC1m = /^\\d{2}$/gi;\r\n    if (\r\n      checkSNRC1m.test(value) ||\r\n      checkSNRC250k.test(value) ||\r\n      checkSNRC50k.test(value)\r\n    ) {\r\n      this._snrc = value;\r\n      this.currentFilter.igoSNRC = value;\r\n    }\r\n  }\r\n\r\n  get snrc(): any {\r\n    return this._snrc;\r\n  }\r\n\r\n  private _snrc = '';\r\n\r\n  @Input() floatLabel: FloatLabelType = 'never';\r\n\r\n  get activeFilters() {\r\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\r\n      (f) => f.active === true\r\n    );\r\n  }\r\n\r\n  get allowedOperators() {\r\n    return new OgcFilterWriter().computeAllowedOperators(\r\n      this.fields$.value,\r\n      this.currentFilter.propertyName,\r\n      this.datasource.options.ogcFilters.allowedOperatorsType\r\n    );\r\n  }\r\n\r\n  constructor(private wktService: WktService) {\r\n    // TODO: Filter permitted operator based on wfscapabilities\r\n    // Need to work on regex on XML capabilities because\r\n    // comaparison operator's name varies between WFS servers...\r\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\r\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\r\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\r\n    this.igoSpatialSelectors = [\r\n      {\r\n        type: 'fixedExtent'\r\n      },\r\n      {\r\n        type: 'snrc'\r\n      }\r\n    ];\r\n    // TODO: selectFeature & drawFeature\r\n  }\r\n\r\n  ngOnInit() {\r\n\r\n    if ( this.datasource.options.sourceFields) {\r\n      const sFields = this.datasource.options.sourceFields.filter(\r\n        (sf) =>\r\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\r\n      );\r\n      sFields.map((sfs) => {\r\n        if (sfs.values) {\r\n          sfs.values.sort();\r\n        }\r\n      });\r\n      this.fields$.next(sFields);\r\n    }\r\n\r\n    this.updateFieldsList();\r\n    this.selectedField$.next(\r\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\r\n    );\r\n    this.updateValuesList();\r\n    this.selectedField$.subscribe((f) => {\r\n      this.ogcFilterOperators$.next(this.allowedOperators);\r\n      if (\r\n        Object.keys(this.allowedOperators).indexOf(\r\n          this.currentFilter.operator\r\n        ) === -1\r\n      ) {\r\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\r\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\r\n      }\r\n      this.updateValuesList();\r\n    });\r\n    this.currentFilterIsSpatial();\r\n  }\r\n\r\n  updateFieldsList(value?: string) {\r\n    this.filteredFields$ =\r\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\r\n    if (this.fields$.value.find((f) => f.name === value)) {\r\n      this.changeField(value);\r\n    }\r\n  }\r\n\r\n  updateValuesList(value?: string, pos?: number) {\r\n    this.filteredValues$ =\r\n      value && value.length > 0\r\n        ? of(this._filterValues(value))\r\n        : this.selectedField$.value\r\n        ? of(this.selectedField$.value.values)\r\n        : of([]);\r\n    if (value && value.length >= 1) {\r\n      this.changeProperty(value, pos);\r\n    }\r\n  }\r\n\r\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\r\n    const keywordRegex = new RegExp(\r\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\r\n      'gi'\r\n    );\r\n    return this.fields$.value.filter((val) =>\r\n      keywordRegex.test(\r\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\r\n      )\r\n    );\r\n  }\r\n\r\n  private _filterValues(value: string): string[] {\r\n    const keywordRegex = new RegExp(\r\n      value\r\n        .toString()\r\n        .normalize('NFD')\r\n        .replace(/[\\u0300-\\u036f]/g, ''),\r\n      'gi'\r\n    );\r\n    return this.selectedField$.value.values.filter((val) =>\r\n      val && keywordRegex.test(\r\n        val\r\n          .toString()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '')\r\n      )\r\n    );\r\n  }\r\n\r\n  clearSelectedField() {\r\n    this.currentFilter.propertyName = '';\r\n    this.selectedField$.next(undefined);\r\n    this.clearProperty();\r\n  }\r\n\r\n  isClearable(pos?: number) {\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      return this.currentFilter[detectedProperty];\r\n    }\r\n  }\r\n  clearProperty(pos?: number) {\r\n    // this.autoCompleteInputValues.closePanel();\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      return (this.currentFilter[detectedProperty] = '');\r\n    }\r\n  }\r\n\r\n  toggleFilterState(event) {\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n      (f) => f.filterid === this.currentFilter.filterid\r\n    ).active = event.checked;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  deleteFilter() {\r\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\r\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\r\n      (f) => f.filterid !== this.currentFilter.filterid\r\n    );\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeLogical(logical: string) {\r\n    this.currentFilter.parentLogical = logical;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeOperator(operator: string) {\r\n    this.currentFilter.operator = operator;\r\n    this.currentFilterIsSpatial();\r\n\r\n    if (\r\n      this.currentFilterIsSpatial$.value &&\r\n      this.currentFilter.wkt_geometry.length === 0\r\n    ) {\r\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\r\n    } else {\r\n      this.refreshFilters();\r\n    }\r\n  }\r\n\r\n  changeField(field: string) {\r\n    this.currentFilter.propertyName = field;\r\n    this.selectedField$.next(\r\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\r\n    );\r\n    this.refreshFilters();\r\n  }\r\n\r\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\r\n  // Due to this issue, the checkbox is hide.\r\n  changeCaseSensitive(matchCase) {\r\n    this.currentFilter.matchCase = matchCase.checked;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        (f) => f.filterid === this.currentFilter.filterid\r\n      )[detectedProperty] = value;\r\n\r\n      if ( refreshFilter ) {\r\n        this.refreshFilters();\r\n      }\r\n    }\r\n  }\r\n\r\n  changeNumericProperty(value, pos: number) {\r\n    this.changeProperty(parseFloat(value), pos);\r\n  }\r\n\r\n  changeSpatialSelector(value: any) {\r\n    this.currentFilter.igoSpatialSelector = value;\r\n\r\n    if (value === 'fixedExtent') {\r\n      this.changeMapExtentGeometry(false);\r\n    }\r\n    this.currentFilterIsSpatial();\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeSNRC(value: any) {\r\n    this.snrc = value;\r\n    this.changeSNRCGeometry();\r\n  }\r\n\r\n  changeSNRCGeometry() {\r\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n      (f) => f.filterid === this.currentFilter.filterid\r\n    );\r\n    if (!interfaceOgcFilter) {\r\n      return;\r\n    }\r\n\r\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\r\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\r\n        this.snrc,\r\n        this.map.projection\r\n      ).wktPoly;\r\n    }\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeMapExtentGeometry(refresh: boolean = true) {\r\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n      (f) => f.filterid === this.currentFilter.filterid\r\n    );\r\n    if (!interfaceOgcFilter) {\r\n      return;\r\n    }\r\n\r\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\r\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\r\n        this.map.projection,\r\n        this.map.viewController.getExtent(),\r\n        this.map.projection\r\n      ).wktPoly;\r\n    }\r\n    if (refresh) {\r\n      this.refreshFilters();\r\n    }\r\n  }\r\n\r\n  detectProperty(pos?: number): string {\r\n    switch (this.currentFilter.operator) {\r\n      case OgcFilterOperator.PropertyIsNotEqualTo:\r\n      case OgcFilterOperator.PropertyIsEqualTo:\r\n      case OgcFilterOperator.PropertyIsGreaterThan:\r\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\r\n      case OgcFilterOperator.PropertyIsLessThan:\r\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\r\n        return 'expression';\r\n      case OgcFilterOperator.PropertyIsLike:\r\n        return 'pattern';\r\n      case OgcFilterOperator.PropertyIsBetween:\r\n        return pos && pos === 1\r\n          ? 'lowerBoundary'\r\n          : pos && pos === 2\r\n          ? 'upperBoundary'\r\n          : undefined;\r\n      case OgcFilterOperator.During:\r\n        return pos && pos === 1\r\n          ? 'begin'\r\n          : pos && pos === 2\r\n          ? 'end'\r\n          : undefined;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  private currentFilterIsSpatial() {\r\n    let isSpatial = false;\r\n    if (this.currentFilter) {\r\n      isSpatial =\r\n        [\r\n          OgcFilterOperator.Contains,\r\n          OgcFilterOperator.Intersects,\r\n          OgcFilterOperator.Within\r\n        ].indexOf(this.currentFilter.operator) !== -1;\r\n    }\r\n    this.currentFilterIsSpatial$.next(isSpatial);\r\n  }\r\n\r\n  isTemporalOperator() {\r\n    return (\r\n      this.currentFilter.operator.toLowerCase() ===\r\n      this.ogcFilterOperator.During.toLowerCase()\r\n    );\r\n  }\r\n}\r\n","<igo-ogc-filter-selection\r\n  *ngIf=\"!advancedOgcFilters\"\r\n  igoListItem\r\n  [refreshFilters]=\"refreshFunc\"\r\n  [datasource]=\"datasource\"\r\n  [map]=\"map\"\r\n  [currentFilter]=\"currentFilter\">\r\n</igo-ogc-filter-selection>\r\n\r\n<ng-template \r\n*ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\r\nngFor let-currentFilter \r\n[ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\">\r\n<igo-ogc-filter-form\r\n  [currentFilter]=\"currentFilter\"\r\n  [refreshFilters]=\"refreshFunc\"\r\n  [datasource]=\"datasource\"\r\n  [map]=\"map\">\r\n</igo-ogc-filter-form>\r\n</ng-template>","import { Component, Input } from '@angular/core';\r\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\r\nimport { IgoMap } from '../../map';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-form',\r\n  templateUrl: './ogc-filterable-form.component.html'\r\n})\r\nexport class OgcFilterableFormComponent {\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  get refreshFunc() {\r\n    return this.refreshFilters;\r\n  }\r\n\r\n  get advancedOgcFilters(): boolean {\r\n    if (this.datasource.options.ogcFilters) {\r\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\r\n    }\r\n    return;\r\n  }\r\n\r\n  get currentFilter(): any {\r\n    return this.datasource.options.ogcFilters.interfaceOgcFilters ?\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters[0] : undefined;\r\n  }\r\n\r\n  public color = 'primary';\r\n\r\n  constructor() {}\r\n}\r\n","<mat-list-item>\r\n\r\n  <mat-icon\r\n    *ngIf=\"header\"\r\n    class=\"igo-chevron\"\r\n    mat-list-avatar\r\n    igoCollapse [target]=\"ogcFilters\"\r\n    [collapsed]=\"filtersCollapsed\"\r\n    (click)=\"toggleFiltersCollapsed()\"\r\n    svgIcon=\"chevron-up\">\r\n  </mat-icon>\r\n  <h4 (click)=\"toggleLegendOnClick()\" *ngIf=\"header\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\" matLine [matTooltip]=\"layer.title\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\r\n    <button *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\" [disabled]=\"addFilterDisabled()\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.filter.addFilter' | translate\" [color]=\"color\" (click)=\"addFilterToSequence()\">\r\n      <mat-icon svgIcon=\"plus\"></mat-icon>\r\n    </button>\r\n    <button *ngIf=\"header\"\r\n      mat-icon-button\r\n      [color]=\"layer.visible ? 'primary' : 'default'\"\r\n      collapsibleButton\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"layer.visible ?\r\n                    ('igo.geo.layer.hideLayer' | translate) :\r\n                    ('igo.geo.layer.showLayer' | translate)\"\r\n      (click)=\"layer.visible = !layer.visible\">\r\n      <mat-icon\r\n        [ngClass]=\"{disabled: !(inResolutionRange$ | async)}\"\r\n        [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\r\n      </mat-icon>\r\n    </button>\r\n</mat-list-item>\r\n\r\n<div #ogcFilters>\r\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\r\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\r\n      </igo-layer-legend>\r\n    </div>\r\n  <igo-ogc-filterable-form [datasource]=\"datasource\" [map]=\"map\" [refreshFilters]=\"refreshFunc\">\r\n  </igo-ogc-filterable-form>\r\n\r\n  <section *ngIf=\"hasSelector && filtersAreEditable\" class=\"mat-typography advancedOgcFilters\">\r\n    <mat-divider></mat-divider>\r\n    <mat-checkbox labelPosition='before' (change)=\"changeOgcFilterType($event)\"\r\n      [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\">\r\n      {{'igo.geo.filter.advancedOgcFilters' | translate}}\r\n    </mat-checkbox>\r\n  </section>\r\n</div>","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\r\n\r\nimport {\r\n  OgcFilterableDataSource,\r\n  OgcFiltersOptions,\r\n  OgcInterfaceFilterOptions\r\n} from '../shared/ogc-filter.interface';\r\nimport { OGCFilterService } from '../shared/ogc-filter.service';\r\nimport { IgoMap } from '../../map';\r\nimport { OgcFilterWriter } from '../shared/ogc-filter';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-item',\r\n  templateUrl: './ogc-filterable-item.component.html',\r\n  styleUrls: ['./ogc-filterable-item.component.scss']\r\n})\r\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\r\n  public color = 'primary';\r\n  private lastRunOgcFilter;\r\n  private defaultLogicalParent = OgcFilterOperator.And;\r\n  public hasActiveSpatialFilter = false;\r\n  public filtersAreEditable = true;\r\n  public filtersCollapsed = true;\r\n  public hasSelector: boolean = false;\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  private resolution$$: Subscription;\r\n  private ogcFilterWriter;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  get refreshFunc() {\r\n    return this.refreshFilters.bind(this);\r\n  }\r\n\r\n  get datasource(): OgcFilterableDataSource {\r\n    return this.layer.dataSource as OgcFilterableDataSource;\r\n  }\r\n\r\n  constructor(private ogcFilterService: OGCFilterService) {\r\n    this.ogcFilterWriter = new OgcFilterWriter();\r\n  }\r\n\r\n  ngOnInit() {\r\n    const ogcFilters = this.datasource.options.ogcFilters;\r\n    if (\r\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\r\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\r\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\r\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0)) {\r\n      if (ogcFilters.advancedOgcFilters === undefined) {\r\n        ogcFilters.advancedOgcFilters = false;\r\n      }\r\n      this.hasSelector = true;\r\n    }\r\n\r\n    switch (this.datasource.options.type) {\r\n      case 'wms':\r\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\r\n        break;\r\n      case 'wfs':\r\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (ogcFilters) {\r\n      if (ogcFilters.interfaceOgcFilters) {\r\n        this.lastRunOgcFilter = JSON.parse(\r\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\r\n        );\r\n        if (\r\n          ogcFilters.interfaceOgcFilters.filter(f => f.wkt_geometry).length >= 1\r\n        ) {\r\n          this.hasActiveSpatialFilter = true;\r\n        }\r\n      }\r\n\r\n      this.filtersAreEditable = ogcFilters.editable\r\n        ? ogcFilters.editable\r\n        : false;\r\n    }\r\n\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.resolution$$.unsubscribe();\r\n  }\r\n\r\n  addFilterToSequence() {\r\n    this.filtersCollapsed = false;\r\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] = this.datasource\r\n      .options.ogcFilters.interfaceOgcFilters;\r\n    const arr = interfaceOgcFilters || [];\r\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\r\n    let firstFieldName = '';\r\n    const includedFields = this.datasource.options.sourceFields.filter(f => !f.excludeFromOgcFilters);\r\n    if (includedFields.length > 0) {\r\n      firstFieldName =\r\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\r\n    }\r\n    let fieldNameGeometry;\r\n    const datasourceOptions = this.datasource\r\n      .options as WFSDataSourceOptionsParams;\r\n    if (datasourceOptions.fieldNameGeometry) {\r\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\r\n    } else if (\r\n      (this.datasource.options as any).paramsWFS &&\r\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\r\n    ) {\r\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\r\n        .fieldNameGeometry;\r\n    }\r\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\r\n      this.datasource.options.sourceFields,\r\n      firstFieldName,\r\n      this.datasource.options.ogcFilters.allowedOperatorsType);\r\n    const firstOperatorName = Object.keys(allowedOperators)[0];\r\n\r\n    arr.push(\r\n      this.ogcFilterWriter.addInterfaceFilter(\r\n        {\r\n          propertyName: firstFieldName,\r\n          operator: firstOperatorName,\r\n          active: true,\r\n          igoSpatialSelector: 'fixedExtent',\r\n          srsName: this.map.projection,\r\n        } as OgcInterfaceFilterOptions,\r\n        fieldNameGeometry,\r\n        lastLevel,\r\n        this.defaultLogicalParent\r\n      )\r\n    );\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\r\n  }\r\n\r\n  refreshFilters(force?: boolean) {\r\n    if (force === true) {\r\n      this.lastRunOgcFilter = undefined;\r\n    }\r\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\r\n    const activeFilters = ogcFilters.interfaceOgcFilters ?\r\n      ogcFilters.interfaceOgcFilters.filter(f => f.active === true) : [];\r\n    if (activeFilters.length === 0) {\r\n      ogcFilters.filters = undefined;\r\n      ogcFilters.filtered = false;\r\n    }\r\n    if (activeFilters.length > 1) {\r\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\r\n    }\r\n    if (\r\n      activeFilters.filter(\r\n        af => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\r\n      ).length === 0\r\n    ) {\r\n      this.hasActiveSpatialFilter = false;\r\n    } else {\r\n      this.hasActiveSpatialFilter = true;\r\n    }\r\n\r\n    if (\r\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\r\n    ) {\r\n      if (this.layer.dataSource.options.type === 'wfs') {\r\n        const ogcDataSource: any = this.layer.dataSource;\r\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\r\n        ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\r\n          activeFilters\r\n        );\r\n        this.layer.dataSource.ol.refresh();\r\n      } else if (\r\n        this.layer.dataSource.options.type === 'wms' &&\r\n        ogcFilters.enabled\r\n      ) {\r\n        let rebuildFilter = '';\r\n        if (activeFilters.length >= 1) {\r\n          const ogcDataSource: any = this.layer.dataSource;\r\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\r\n          ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\r\n            activeFilters\r\n          );\r\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\r\n            ogcLayer.filters,\r\n            undefined,\r\n            undefined,\r\n            (this.layer.dataSource.options as any).fieldNameGeometry,\r\n            ogcDataSource.options\r\n          );\r\n        }\r\n        this.ogcFilterService.filterByOgc(\r\n          this.datasource as WMSDataSource,\r\n          rebuildFilter\r\n        );\r\n        this.datasource.options.ogcFilters.filtered =\r\n          activeFilters.length === 0 ? false : true;\r\n      }\r\n\r\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\r\n    } else {\r\n      // identical filter. Nothing triggered\r\n    }\r\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\r\n  }\r\n\r\n  public setVisible() {\r\n    this.layer.visible = true;\r\n  }\r\n\r\n  public isAdvancedOgcFilters(): boolean {\r\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\r\n  }\r\n\r\n  public addFilterDisabled(): boolean {\r\n    return (\r\n      !this.datasource.options.sourceFields ||\r\n      this.datasource.options.sourceFields.length === 0\r\n    );\r\n  }\r\n\r\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\r\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\r\n  }\r\n\r\n  changeOgcFilterType(isAdvancedOgcFilters) {\r\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\r\n    if (isAdvancedOgcFilters.checked) {\r\n      this.refreshFilters(true);\r\n    }\r\n  }\r\n\r\n  private toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    if (!this.filtersCollapsed) {\r\n      this.toggleLegend(this.showLegend$.value);\r\n    }\r\n  }\r\n\r\n  toggleFiltersCollapsed() {\r\n    this.filtersCollapsed = !this.filtersCollapsed;\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\r\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\r\n    <igo-ogc-filterable-item igoListItem [header]=\"true\" [layer]=\"layer\" \r\n    [map]=\"layer.map\" ></igo-ogc-filterable-item>\r\n  </ng-template>\r\n</igo-list>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-list',\r\n  templateUrl: './ogc-filterable-list.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterableListComponent {\r\n\r\n  @Input() layers: Layer[];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  constructor() {}\r\n}\r\n","<button\r\n  *ngIf=\"header && options.ogcFilters && options.ogcFilters.enabled &&\r\n  (options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.editable)\"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\r\n  [color]=\"color\">\r\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"filter\"></mat-icon>\r\n</button>\r\n\r\n<div #ogcFilter class=\"igo-layer-actions-container\"\r\n*ngIf=\"options.ogcFilters && options.ogcFilters.enabled &&\r\n(options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.editable)\">\r\n  <igo-ogc-filterable-item\r\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\r\n    igoListItem\r\n    [header]=\"false\"\r\n    [map]=\"layer.map\"\r\n    [layer]=\"layer\">\r\n  </igo-ogc-filterable-item>\r\n</div>\r\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map';\r\nimport { OgcFilterableDataSourceOptions, IgoOgcSelector, OgcFiltersOptions } from '../shared/ogc-filter.interface';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-button',\r\n  templateUrl: './ogc-filter-button.component.html',\r\n  styleUrls: ['./ogc-filter-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterButtonComponent implements OnInit {\r\n\r\n  public options: OgcFilterableDataSourceOptions;\r\n\r\n  get badge() {\r\n    const filter = this.options.ogcFilters as any;\r\n    let cnt = 0;\r\n    if (filter && !filter.advancedOgcFilters) {\r\n      if (filter.pushButtons) {\r\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\r\n        const currentPushButtonGroup = pushButtons.groups.find(gr => gr.enabled);\r\n        let cntPushButtons = 0;\r\n        if (currentPushButtonGroup) {\r\n          currentPushButtonGroup.computedSelectors.map(cb => cntPushButtons += (cb.selectors as any).filter(\r\n            button => button.enabled).length);\r\n        }\r\n        cnt += cntPushButtons;\r\n      }\r\n      if (filter.checkboxes) {\r\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\r\n        const currentCheckboxGroup = checkboxes.groups.find(gr => gr.enabled);\r\n        let cntCheckboxes = 0;\r\n        if (currentCheckboxGroup) {\r\n          currentCheckboxGroup.computedSelectors.map(cb => cntCheckboxes += (cb.selectors as any).filter(\r\n            checkbox => checkbox.enabled).length);\r\n        }\r\n        cnt += cntCheckboxes;\r\n      }\r\n      if (filter.radioButtons) {\r\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\r\n        const currentRadioButtonsGroup = radioButtons.groups.find(gr => gr.enabled);\r\n        let cntRadioButtons = 0;\r\n        if (currentRadioButtonsGroup) {\r\n          currentRadioButtonsGroup.computedSelectors.map(cb => cntRadioButtons += (cb.selectors as any).filter(\r\n            radio => radio.enabled).length);\r\n        }\r\n        cnt += cntRadioButtons;\r\n      }\r\n      if (filter.select) {\r\n        const select = filter.select as IgoOgcSelector;\r\n        const currentSelectGroup = select.groups.find(gr => gr.enabled);\r\n        let cntSelect = 0;\r\n        if (currentSelectGroup) {\r\n          currentSelectGroup.computedSelectors.map(cb => cntSelect += (cb.selectors as any).filter(\r\n            multi => multi.enabled).length);\r\n        }\r\n        cnt += cntSelect;\r\n      }\r\n    } else if (filter && filter.filters && !filter.filters.filters) {\r\n      return 1;\r\n    } else if (filter && filter.filters && filter.filters.filters) {\r\n      return filter.filters.filters.length;\r\n    }\r\n    return cnt > 0 ? cnt : undefined;\r\n  }\r\n\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    if (value) {\r\n      this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\r\n    }\r\n  }\r\n  private _layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  @Input() header: boolean;\r\n\r\n  public ogcFilterCollapse = false;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport * as moment_ from 'moment';\r\nconst moment = moment_;\r\n\r\nimport {\r\n    OgcFilterableDataSource\r\n  } from './ogc-filter.interface';\r\n\r\n@Injectable()\r\nexport class OGCFilterTimeService {\r\n\r\n    readonly defaultStepMillisecond = 60000;\r\n\r\n    constructor() {}\r\n\r\n    step(datasource: OgcFilterableDataSource, currentFilter): string {\r\n    return datasource.options.stepDate\r\n      ? datasource.options.stepDate\r\n      : currentFilter.step;\r\n    }\r\n\r\n    stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\r\n        const step = moment.duration(this.step(dataSource, currentFilter)).asMilliseconds();\r\n        return step === 0 ? this.defaultStepMillisecond : step;\r\n    }\r\n\r\n    stepIsYearDuration(step: string) {\r\n        const year = moment.duration(step);\r\n        return (\r\n            year.years() !== 0 &&\r\n            year.months() === 0 &&\r\n            year.weeks() === 0 &&\r\n            year.days() === 0 &&\r\n            year.hours() === 0 &&\r\n            year.minutes() === 0\r\n        );\r\n    }\r\n\r\n    stepIsMonthDuration(step: string) {\r\n        const month = moment.duration(step);\r\n        return (\r\n            month.months() !== 0 &&\r\n            month.weeks() === 0 &&\r\n            month.days() === 0 &&\r\n            month.hours() === 0 &&\r\n            month.minutes() === 0\r\n        );\r\n    }\r\n\r\n    stepIsWeekDuration(step: string) {\r\n        const week = moment.duration(step);\r\n        return (\r\n            week.weeks() !== 0 &&\r\n            week.days() === 7 &&\r\n            week.hours() === 0 &&\r\n            week.minutes() === 0\r\n        );\r\n    }\r\n\r\n    stepIsDayDuration(step: string) {\r\n        const day = moment.duration(step);\r\n        return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\r\n    }\r\n\r\n    stepIsHourDuration(step: string) {\r\n        const hour = moment.duration(step);\r\n        return hour.hours() !== 0 && hour.minutes() === 0;\r\n    }\r\n\r\n    stepIsMinuteDuration(step: string) {\r\n        const minute = moment.duration(step);\r\n        return minute.minutes() !== 0;\r\n    }\r\n\r\n    dateToNumber(date: Date): number {\r\n        let newDate = new Date();\r\n        if (date) {\r\n          newDate = new Date(date);\r\n        }\r\n        return newDate.getTime();\r\n    }\r\n\r\n    public addStep(value, stepMillisecond) {\r\n        return moment(value).add(stepMillisecond, 'milliseconds').toDate();\r\n    }\r\n\r\n    public subtractStep(value, stepMillisecond) {\r\n        return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\r\n    }\r\n}\r\n","<form [formGroup]=\"form\">\r\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\r\n    <div class=\"pushButtonGroups\" *ngIf=\"selector.selectorType === 'pushButton'\">\r\n      <mat-divider></mat-divider>\r\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName=\"pushButtonsGroup\"\r\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n            [(value)]=\"currentPushButtonsGroup\">\r\n            <mat-option *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\r\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <ng-container *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\">\r\n        <h4>{{bundle.title}}</h4>\r\n        <mat-button-toggle-group\r\n          formControlName=\"pushButtons\" class=\"mat-typography\" appearance=\"legacy\" vertical={{bundleIsVertical(bundle)}} multiple=\"true\">\r\n          <mat-button-toggle *ngFor=\"let ogcPushButton of bundle.selectors\"\r\n            [matTooltip]=\"getToolTip(ogcPushButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\" matTooltipClass=\"material-tooltip\"\r\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\r\n            [checked]=\"ogcPushButton.enabled\" (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\r\n            [value]=\"ogcPushButton\">{{ogcPushButton.title}}\r\n          </mat-button-toggle>\r\n        </mat-button-toggle-group>\r\n      </ng-container>\r\n    </div>\r\n\r\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\r\n      <mat-divider></mat-divider>\r\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName=\"checkboxesGroup\"\r\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n            [(value)]=\"currentCheckboxesGroup\">\r\n            <mat-option *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\r\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <ng-container *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\">\r\n        <h4>{{bundle.title}}</h4>\r\n        <div class=\"checkboxes mat-typography\">\r\n          <mat-checkbox *ngFor=\"let ogcCheckbox of bundle.selectors\"\r\n            [matTooltip]=\"getToolTip(ogcCheckbox)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\r\n            [checked]=\"ogcCheckbox.enabled\" (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\r\n            [value]=\"ogcCheckbox\">{{ogcCheckbox.title}}\r\n          </mat-checkbox>\r\n        </div>\r\n        <p *ngIf=\"isLessResults(bundle, 'checkbox') || isMoreResults(bundle, 'checkbox')\">\r\n          <u *ngIf=\"isLessResults(bundle, 'checkbox')\"\r\n            class=\"lessResults mat-typography\"\r\n            (click)=\"displayLessResults('checkbox')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\r\n          </u>\r\n          <u *ngIf=\"isMoreResults(bundle, 'checkbox')\"\r\n            class=\"moreResults mat-typography\"\r\n            (click)=\"displayMoreResults('checkbox')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\r\n          </u>\r\n        </p>\r\n      </ng-container>\r\n    </div>\r\n\r\n    <div class=\"radioButtonGroups\" *ngIf=\"selector.selectorType === 'radioButton'\">\r\n      <mat-divider></mat-divider>\r\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName=\"radioButtonsGroup\"\r\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n            [(value)]=\"currentRadioButtonsGroup\">\r\n            <mat-option *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\r\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <ng-container *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\">\r\n        <h4>{{bundle.title}}</h4>\r\n        <mat-radio-group\r\n          formControlName=\"radioButtons\" class=\"mat-typography\">\r\n          <mat-radio-button *ngIf=\"bundle.unfiltered\"\r\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\r\n            (change)=\"emptyRadioButtons()\">{{ 'igo.geo.filter.resetFilters' | translate }}\r\n          </mat-radio-button>\r\n          <mat-radio-button *ngFor=\"let ogcRadioButton of bundle.selectors\"\r\n            [matTooltip]=\"getToolTip(ogcRadioButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\r\n            [checked]=\"ogcRadioButton.enabled\" (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\r\n            [value]=\"ogcRadioButton\">{{ogcRadioButton.title}}\r\n          </mat-radio-button>\r\n          <p *ngIf=\"isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\">\r\n            <u *ngIf=\"isLessResults(bundle, 'radio')\"\r\n              class=\"lessResults mat-typography\"\r\n              (click)=\"displayLessResults('radio')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\r\n            </u>\r\n            <u *ngIf=\"isMoreResults(bundle, 'radio')\"\r\n              class=\"moreResults mat-typography\"\r\n              (click)=\"displayMoreResults('radio')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\r\n            </u>\r\n          </p>\r\n        </mat-radio-group>\r\n      </ng-container>\r\n    </div>\r\n\r\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\r\n      <mat-divider></mat-divider>\r\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName=\"selectGroup\"\r\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n            [(value)]=\"currentSelectGroup\">\r\n            <mat-option *ngFor=\"let selectorGroup of getSelectGroups()\"\r\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\r\n        <h4>{{bundle.title}}</h4>\r\n        <div class=\"groupsSelector\">\r\n          <mat-button *ngIf=\"bundle.unfiltered && !bundle.multiple\"\r\n            mat-icon-button\r\n            color=\"warn\"\r\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\r\n            (click)=\"emptySelect()\">\r\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\r\n          </mat-button>\r\n          <mat-form-field>\r\n            <div *ngIf=\"bundle.multiple; else notMulti\">\r\n              <mat-select\r\n                #selection [multiple]=\"bundle.multiple\" [placeholder]=\"bundle.title\"\r\n                [formControl]=\"select\" [(ngModel)]=\"enableds\">\r\n                <div class=\"checkboxes mat-typography\">\r\n                  <mat-checkbox *ngIf=\"bundle.multiple\"\r\n                    [(ngModel)]=\"allSelected\" [ngModelOptions]=\"{standalone: true}\"\r\n                    (change)=\"toggleAllSelection()\">Tous\r\n                  </mat-checkbox>\r\n                </div>\r\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\r\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\r\n                  (onSelectionChange)=\"optionClick()\"\r\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\r\n                </mat-option>\r\n              </mat-select>\r\n            </div>\r\n            <ng-template #notMulti>\r\n              <mat-select\r\n                [placeholder]=\"bundle.title\"\r\n                [formControl]=\"select\" [(ngModel)]=\"enabled\">\r\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\r\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\r\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\r\n                </mat-option>\r\n              </mat-select>\r\n            </ng-template>\r\n          </mat-form-field>\r\n        </div>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n</form>\r\n\r\n<div *ngIf=\"isTemporalOperator()\">\r\n  <mat-divider></mat-divider>\r\n  <h4>{{ 'igo.geo.filter.reportingDate' | translate }}</h4>\r\n  <igo-ogc-filter-time\r\n    [(datasource)]=\"datasource\"\r\n    [(currentFilter)]=\"currentFilter\"\r\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\">\r\n  </igo-ogc-filter-time>\r\n</div>","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  ViewChild\r\n} from '@angular/core';\r\n\r\nimport {\r\n  OgcFilterableDataSource,\r\n  IgoOgcFilterObject,\r\n  OgcPushButton,\r\n  OgcSelectorBundle,\r\n  SelectorGroup\r\n\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport { IgoMap } from '../../map';\r\nimport { OGCFilterService } from '../shared/ogc-filter.service';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\r\nimport { MatSelect } from '@angular/material/select';\r\nimport { MatOption } from '@angular/material/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-selection',\r\n  templateUrl: './ogc-filter-selection.component.html',\r\n  styleUrls: ['./ogc-filter-selection.component.scss']\r\n})\r\nexport class OgcFilterSelectionComponent implements OnInit {\r\n\r\n  @ViewChild('selection') sel: MatSelect;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() checkboxesIndex = 5;\r\n  @Input() radioButtonsIndex = 5;\r\n  @Input() baseIndex = 5;\r\n\r\n  @Input()\r\n  get currentFilter(): any {\r\n    return this._currentFilter;\r\n  }\r\n  set currentFilter(value) {\r\n    this._currentFilter = value;\r\n    if (this._currentFilter?.sliderOptions) {\r\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\r\n    }\r\n  }\r\n  private _currentFilter: any;\r\n\r\n  public ogcFilterOperator = OgcFilterOperator;\r\n\r\n  public form: FormGroup;\r\n  private ogcFilterWriter: OgcFilterWriter;\r\n  public color = 'primary';\r\n  public allSelected = false;\r\n  public select = new FormControl();\r\n  public enabled$ = new BehaviorSubject(undefined);\r\n  public enableds$ = new BehaviorSubject([]);\r\n\r\n  public applyFiltersTimeout;\r\n\r\n  get ogcFiltersSelectors() {\r\n    const ogcSelector = [];\r\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.select) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\r\n    }\r\n    ogcSelector.sort((a, b) => {\r\n      if (a.order < b.order) {\r\n        return -1;\r\n      }\r\n      if (a.order > b.order) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n    return ogcSelector;\r\n  }\r\n\r\n  get currentPushButtonsGroup() {\r\n    return this.form.get('pushButtonsGroup').value;\r\n  }\r\n  set currentPushButtonsGroup(value) {\r\n    this.form.patchValue({ pushButtonsGroup: value });\r\n  }\r\n\r\n  get currentCheckboxesGroup() {\r\n    return this.form.get('checkboxesGroup').value;\r\n  }\r\n  set currentCheckboxesGroup(value) {\r\n    this.form.patchValue({ checkboxesGroup: value });\r\n  }\r\n\r\n  get currentRadioButtonsGroup() {\r\n    return this.form.get('radioButtonsGroup').value;\r\n  }\r\n  set currentRadioButtonsGroup(value) {\r\n    this.form.patchValue({ radioButtonsGroup: value });\r\n  }\r\n\r\n  get currentSelectGroup() {\r\n    return this.form.get('selectGroup').value;\r\n  }\r\n  set currentSelectGroup(value) {\r\n    this.form.patchValue({ selectGroup: value });\r\n  }\r\n\r\n  get enabled() {\r\n    return this.enabled$.value;\r\n  }\r\n\r\n  set enabled(value) {\r\n    this.enabled$.next(value);\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\r\n      compSelect.selectors.forEach(selector => {\r\n        value === selector ? selector.enabled = true : selector.enabled = false;\r\n      });\r\n    });\r\n\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  get enableds() {\r\n    return this.enableds$.value;\r\n  }\r\n\r\n  set enableds(value) {\r\n    this.enableds$.next(value);\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\r\n      compSelect.selectors.forEach(selector => {\r\n        value.includes(selector) ? selector.enabled = true : selector.enabled = false;\r\n      });\r\n    });\r\n\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  constructor(\r\n    private ogcFilterService: OGCFilterService,\r\n    private formBuilder: FormBuilder,\r\n  ) {\r\n    this.ogcFilterWriter = new OgcFilterWriter();\r\n    this.buildForm();\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      pushButtons: ['', [Validators.required]],\r\n      radioButtons: ['', [Validators.required]],\r\n      pushButtonsGroup: ['', [Validators.required]],\r\n      checkboxesGroup: ['', [Validators.required]],\r\n      radioButtonsGroup: ['', [Validators.required]],\r\n      selectGroup: ['', [Validators.required]],\r\n    });\r\n  }\r\n\r\n  getPushButtonsGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\r\n      return this.datasource.options.ogcFilters.pushButtons.groups;\r\n    }\r\n  }\r\n\r\n  getCheckboxesGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\r\n      return this.datasource.options.ogcFilters.checkboxes.groups;\r\n    }\r\n  }\r\n\r\n  getRadioButtonsGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\r\n      return this.datasource.options.ogcFilters.radioButtons.groups;\r\n    }\r\n  }\r\n\r\n  getSelectGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.select) {\r\n      return this.datasource.options.ogcFilters.select.groups;\r\n    }\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.datasource.options.ogcFilters) {\r\n      if (this.datasource.options.ogcFilters.pushButtons) {\r\n        this.currentPushButtonsGroup =\r\n          this.datasource.options.ogcFilters.pushButtons.groups.find(group => group.enabled) ||\r\n          this.datasource.options.ogcFilters.pushButtons.groups[0];\r\n      }\r\n      if (this.datasource.options.ogcFilters.checkboxes) {\r\n        this.currentCheckboxesGroup =\r\n          this.datasource.options.ogcFilters.checkboxes.groups.find(group => group.enabled) ||\r\n          this.datasource.options.ogcFilters.checkboxes.groups[0];\r\n      }\r\n      if (this.datasource.options.ogcFilters.radioButtons) {\r\n        this.currentRadioButtonsGroup =\r\n          this.datasource.options.ogcFilters.radioButtons.groups.find(group => group.enabled) ||\r\n          this.datasource.options.ogcFilters.radioButtons.groups[0];\r\n      }\r\n      if (this.datasource.options.ogcFilters.select) {\r\n        this.currentSelectGroup =\r\n          this.datasource.options.ogcFilters.select.groups.find(group => group.enabled) ||\r\n          this.datasource.options.ogcFilters.select.groups[0];\r\n        this.getSelectEnabled();\r\n      }\r\n      this.applyFilters();\r\n    }\r\n\r\n    this.form\r\n    .get('pushButtonsGroup')\r\n    .valueChanges\r\n    .pipe(debounceTime(750))\r\n    .subscribe(() => {\r\n      this.onPushButtonsChangeGroup();\r\n      this.applyFilters();\r\n      });\r\n    this.form\r\n    .get('checkboxesGroup')\r\n    .valueChanges\r\n    .pipe(debounceTime(750))\r\n    .subscribe(() => {\r\n      this.onCheckboxesChangeGroup();\r\n      this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('radioButtonsGroup')\r\n      .valueChanges\r\n      .pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onRadioButtonsChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('selectGroup')\r\n      .valueChanges\r\n      .pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onSelectChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('pushButtons')\r\n      .valueChanges\r\n      .pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('radioButtons')\r\n      .valueChanges\r\n      .pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.applyFilters();\r\n      });\r\n  }\r\n\r\n  private getSelectEnabled() {\r\n    const enableds = [];\r\n    let enabled;\r\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\r\n      if (compSelect.multiple) {\r\n        compSelect.selectors.forEach(selector => {\r\n          if (selector.enabled) {\r\n            enableds.push(selector);\r\n          }\r\n        });\r\n        this.enableds = enableds;\r\n      } else {\r\n        compSelect.selectors.forEach(selector => {\r\n          if (selector.enabled) {\r\n            enabled = selector;\r\n          }\r\n        });\r\n        this.enabled = enabled;\r\n      }\r\n    });\r\n  }\r\n\r\n  getToolTip(selector): string  {\r\n    let toolTip;\r\n    if (selector.tooltip) {\r\n      if (Array.isArray(selector.tooltip)) {\r\n        toolTip = selector.tooltip.join('\\n');\r\n      } else {\r\n        toolTip = selector.tooltip;\r\n      }\r\n    }\r\n    return toolTip || '';\r\n  }\r\n\r\n  // getButtonStyle(pb: OgcPushButton): {} {\r\n\r\n  //   let styles;\r\n  //   if (pb.color) {\r\n  //     styles = {\r\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\r\n  //     };\r\n  //   } else {\r\n  //     styles = {\r\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\r\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\r\n  //     }\r\n  //   }\r\n  //   return styles;\r\n  // }\r\n\r\n  getButtonColor(pushButton: OgcPushButton): {} {\r\n    let styles;\r\n    if (pushButton.color && pushButton.enabled) {\r\n      styles = {\r\n        'background-color': `rgba(${pushButton.color})`\r\n      };\r\n    }\r\n    return styles;\r\n  }\r\n\r\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\r\n    return bundle.vertical ? bundle.vertical : false;\r\n  }\r\n\r\n  private onPushButtonsChangeGroup() {\r\n    this.getPushButtonsGroups().map(group => group.enabled = false);\r\n    this.getPushButtonsGroups().find(group => group === this.currentPushButtonsGroup).enabled = true;\r\n  }\r\n\r\n  private onCheckboxesChangeGroup() {\r\n    this.getCheckboxesGroups().map(group => group.enabled = false);\r\n    this.getCheckboxesGroups().find(group => group === this.currentCheckboxesGroup).enabled = true;\r\n  }\r\n\r\n  private onRadioButtonsChangeGroup() {\r\n    this.getRadioButtonsGroups().map(group => group.enabled = false);\r\n    this.getRadioButtonsGroups().find(group => group === this.currentRadioButtonsGroup).enabled = true;\r\n  }\r\n\r\n  private onSelectChangeGroup() {\r\n    this.getSelectGroups().map(group => group.enabled = false);\r\n    this.getSelectGroups().find(group => group === this.currentSelectGroup).enabled = true;\r\n  }\r\n\r\n  onSelectionChange(currentOgcSelection?, selectorType?) {\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    if (selectorType === 'radioButton') {\r\n      this.emptyRadioButtons();\r\n    }\r\n\r\n    if (currentOgcSelection) {\r\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\r\n    }\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  emptyRadioButtons() {\r\n    this.currentRadioButtonsGroup.computedSelectors.forEach(compSelect => {\r\n      compSelect.selectors.map(selector => selector.enabled = false);\r\n\r\n      this.applyFiltersTimeout = setTimeout(() => {\r\n        this.applyFilters();\r\n      }, 750);\r\n   });\r\n  }\r\n\r\n  emptySelect() {\r\n    this.enabled = [];\r\n  }\r\n\r\n  toggleAllSelection() {\r\n    if (this.allSelected) {\r\n      this.sel.options.forEach((item: MatOption) => item.select());\r\n    } else {\r\n      this.sel.options.forEach((item: MatOption) => item.deselect());\r\n    }\r\n  }\r\n\r\n  optionClick() {\r\n    let newStatus = true;\r\n    this.sel.options.forEach((item: MatOption) => {\r\n      if (!item.selected) {\r\n        newStatus = false;\r\n      }\r\n    });\r\n    this.allSelected = newStatus;\r\n  }\r\n\r\n  private applyFilters() {\r\n    let filterQueryString = '';\r\n    const conditions = [];\r\n    const currentGroups = [this.currentPushButtonsGroup, this.currentCheckboxesGroup,\r\n      this.currentRadioButtonsGroup, this.currentSelectGroup];\r\n    for (const currentGroup of currentGroups) {\r\n      if (currentGroup.computedSelectors) {\r\n        currentGroup.computedSelectors.map(selectorBundle => {\r\n          const bundleCondition = [];\r\n          selectorBundle.selectors\r\n          .filter(ogcSelector => ogcSelector.enabled === true)\r\n          .forEach(enabledSelector => bundleCondition.push(enabledSelector.filters));\r\n          if (bundleCondition.length >= 1 ) {\r\n            if (bundleCondition.length === 1) {\r\n              conditions.push(bundleCondition[0]);\r\n            } else {\r\n              conditions.push({logical: selectorBundle.logical, filters: bundleCondition});\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n    if (this.isTemporalOperator()) {\r\n      conditions.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]);\r\n    }\r\n    if (conditions.length >= 1) {\r\n      filterQueryString = this.ogcFilterWriter\r\n        .buildFilter(conditions.length === 1 ?\r\n          conditions[0] : {logical: 'And', filters: conditions } as IgoOgcFilterObject);\r\n    }\r\n    if (this.datasource.options.type === 'wms') {\r\n      this.ogcFilterService.filterByOgc(this.datasource as WMSDataSource, filterQueryString );\r\n    }\r\n    if (this.datasource.options.type === 'wfs') {\r\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\r\n      this.datasource.ol.refresh();\r\n    }\r\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\r\n  }\r\n\r\n  isMoreResults(bundle, type) {\r\n    let selectorsLength = 0;\r\n    for (const selectors of bundle.selectors) {\r\n      selectorsLength++;\r\n    }\r\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\r\n    return selectorsLength > index;\r\n  }\r\n\r\n  displayMoreResults(type) {\r\n    type === 'radio' ? this.radioButtonsIndex += 5 : this.checkboxesIndex += 5;\r\n    return;\r\n  }\r\n\r\n  isLessResults(bundle, type) {\r\n    let selectorsLength = 0;\r\n    for (const selectors of bundle.selectors) {\r\n      selectorsLength++;\r\n    }\r\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\r\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\r\n  }\r\n\r\n  displayLessResults(type) {\r\n    type === 'radio' ? this.radioButtonsIndex = this.baseIndex : this.checkboxesIndex = this.baseIndex;\r\n    return;\r\n  }\r\n\r\n  isTemporalOperator() {\r\n    return (\r\n      this.currentFilter?.operator?.toLowerCase() ===\r\n      this.ogcFilterOperator.During.toLowerCase()\r\n    );\r\n  }\r\n\r\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        filter => filter.filterid === this.currentFilter.filterid\r\n      )[detectedProperty] = value;\r\n\r\n      if ( refreshFilter ) {\r\n        this.applyFilters();\r\n      }\r\n    }\r\n  }\r\n\r\n  detectProperty(pos?: number): string {\r\n    switch (this.currentFilter.operator) {\r\n      case OgcFilterOperator.PropertyIsNotEqualTo:\r\n      case OgcFilterOperator.PropertyIsEqualTo:\r\n      case OgcFilterOperator.PropertyIsGreaterThan:\r\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\r\n      case OgcFilterOperator.PropertyIsLessThan:\r\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\r\n        return 'expression';\r\n      case OgcFilterOperator.PropertyIsLike:\r\n        return 'pattern';\r\n      case OgcFilterOperator.PropertyIsBetween:\r\n        return pos && pos === 1\r\n          ? 'lowerBoundary'\r\n          : pos && pos === 2\r\n          ? 'upperBoundary'\r\n          : undefined;\r\n      case OgcFilterOperator.During:\r\n        return pos && pos === 1\r\n          ? 'begin'\r\n          : pos && pos === 2\r\n          ? 'end'\r\n          : undefined;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n}\r\n","<mat-tab-group\r\n  [selectedIndex]=\"selectedTypeIndex.value\"\r\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\r\n  (selectedTabChange)=\"onTypeChange($event)\">\r\n\r\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' |translate\">\r\n    <mat-form-field>\r\n      <mat-label>{{'igo.geo.spatialFilter.searchLabel' | translate}}</mat-label>\r\n      <mat-select (selectionChange)=\"onSelectionChange()\" [(value)]=\"selectedQueryType\">\r\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\r\n          {{('igo.geo.terrapi.' + queryType) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n    <igo-spatial-filter-list\r\n      [store]=\"store\"\r\n      [queryType]=\"selectedQueryType\"\r\n      [zone]=\"zone\"\r\n      [layers]=\"layers\"\r\n      (zoneChange)=\"zoneChange.emit($event)\"\r\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\r\n      (bufferChange)=\"bufferChange.emit($event)\"\r\n      (measureUnitChange)=\"measureUnitChange.emit($event)\">\r\n    </igo-spatial-filter-list>\r\n  </mat-tab>\r\n\r\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' |translate\">\r\n    <div class=\"spatial-type-toggle\">\r\n      <mat-button-toggle-group\r\n        [value]=\"activeDrawType\"\r\n        (change)=\"onDrawTypeChange($event.value)\">\r\n        <mat-button-toggle [value]=\"spatialType.Polygon\" [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' |translate\">\r\n            <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\r\n        </mat-button-toggle>\r\n        <mat-button-toggle [value]=\"spatialType.Point\" [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' |translate\">\r\n            <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\r\n        </mat-button-toggle>\r\n      </mat-button-toggle-group>\r\n    </div>\r\n  </mat-tab>\r\n\r\n</mat-tab-group>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\r\nimport { FormControl } from '@angular/forms';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { Feature } from '../../../feature';\r\nimport { MeasureLengthUnit } from '../../../measure';\r\nimport { Layer } from '../../../layer';\r\n\r\n/**\r\n * Spatial Filter Type\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-type',\r\n  templateUrl: './spatial-filter-type.component.html',\r\n  styleUrls: ['./spatial-filter-type.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterTypeComponent implements OnInit {\r\n\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  public queryType: string[] = ['Arrond', 'CircFed', 'CircProv', 'DirReg', 'Mun', 'MRC', 'AdmRegion', 'RegTour'];\r\n  public selectedTypeIndex = new FormControl(0);\r\n\r\n  /**\r\n   * Reference to the SpatialFIlterType enum\r\n   * @internal\r\n   */\r\n  public spatialType = SpatialFilterType;\r\n\r\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\r\n\r\n  @Input() selectedQueryType: SpatialFilterQueryType;\r\n\r\n  @Input() zone: Feature;\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  public type: SpatialFilterType;\r\n\r\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\r\n\r\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\r\n\r\n  @Output() zoneChange = new EventEmitter<Feature>();\r\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\r\n\r\n  @Output() bufferChange = new EventEmitter<number>();\r\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    if (this.selectedTypeIndex.value === 0) {\r\n      this.type = this.spatialType.Predefined;\r\n    }\r\n    if (this.selectedTypeIndex.value === 1) {\r\n      this.type = this.activeDrawType;\r\n    }\r\n    this.eventType.emit(this.type);\r\n  }\r\n\r\n  onTypeChange(event) {\r\n    if (this.selectedTypeIndex.value === 0) {\r\n      this.type = SpatialFilterType.Predefined;\r\n    }\r\n    if (this.selectedTypeIndex.value === 1) {\r\n      this.type = this.activeDrawType;\r\n    }\r\n    this.eventType.emit(this.type);\r\n  }\r\n\r\n  onDrawTypeChange(spatialType: SpatialFilterType) {\r\n    this.activeDrawType = spatialType;\r\n    this.eventType.emit(this.activeDrawType);\r\n  }\r\n\r\n  onSelectionChange() {\r\n    this.eventQueryType.emit(this.selectedQueryType);\r\n    this.zoneChange.emit(undefined);\r\n  }\r\n}\r\n","<form class=\"form-list\">\r\n    <mat-form-field class=\"zone-list\">\r\n        <input #input type=\"text\" placeholder=\"{{'igo.geo.spatialFilter.listLabel' |translate}}\" matInput\r\n        [formControl]=\"formControl\" [matAutocomplete]=\"auto\">\r\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onZoneChange($event.option.value)\"\r\n        [displayWith]=\"displayFn\">\r\n            <mat-option *ngFor=\"let entities of this.store.view.all$() | async\" [value]=\"entities\">\r\n                {{entities.properties.nom}}\r\n            </mat-option>\r\n        </mat-autocomplete>\r\n    </mat-form-field>\r\n<form>\r\n\r\n<div class=\"buffer-div\">\r\n    <form class=\"buffer-form\">\r\n        <mat-form-field class=\"buffer\">\r\n            <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\r\n            [value]=\"0\" [readonly]=\"!zone\">\r\n        </mat-form-field>\r\n    </form>\r\n\r\n    <mat-form-field class=\"unit-field\">\r\n        <mat-select\r\n        [value]=\"measureUnit\"\r\n        (selectionChange)=\"onMeasureUnitChange($event.value)\">\r\n        <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\r\n            {{('igo.geo.measure.' + measureUnit) | translate}}\r\n        </mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n</div>\r\n","import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\r\nimport { SpatialFilterQueryType, SpatialFilterType } from './../../shared/spatial-filter.enum';\r\nimport {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { FormControl } from '@angular/forms';\r\nimport { Feature } from '../../../feature';\r\nimport { MeasureLengthUnit } from '../../../measure/shared';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { Layer } from '../../../layer';\r\n\r\n@Component({\r\n  selector: 'igo-spatial-filter-list',\r\n  templateUrl: './spatial-filter-list.component.html',\r\n  styleUrls: ['./spatial-filter-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\r\n\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  @Input()\r\n  get queryType(): SpatialFilterQueryType {\r\n    return this._queryType;\r\n  }\r\n  set queryType(queryType: SpatialFilterQueryType) {\r\n    this.formControl.setValue('');\r\n    this._queryType = queryType;\r\n  }\r\n  private _queryType: SpatialFilterQueryType;\r\n\r\n  @Input()\r\n  get zone() {\r\n    return this._zone;\r\n  }\r\n  set zone(value) {\r\n    this._zone = value;\r\n    if (!value) {\r\n      this.zoneWithBuffer = undefined;\r\n      this.bufferFormControl.setValue(0);\r\n    }\r\n  }\r\n  private _zone;\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  public zoneWithBuffer;\r\n  public selectedZone: any;\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n\r\n  public formControl = new FormControl();\r\n\r\n  public bufferFormControl = new FormControl();\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\r\n  }\r\n\r\n  @Output() zoneChange = new EventEmitter<Feature>();\r\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\r\n  @Output() bufferChange = new EventEmitter<number>();\r\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\r\n\r\n  formValueChanges$$: Subscription;\r\n  bufferValueChanges$$: Subscription;\r\n\r\n  constructor(\r\n    private spatialFilterService: SpatialFilterService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe((value) => {\r\n      if (value.length) {\r\n        this.store.view.filter((feature) => {\r\n          const filterNormalized = value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n          const featureNameNormalized = feature.properties.nom.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n          return featureNameNormalized.includes(filterNormalized);\r\n        });\r\n      }\r\n    });\r\n\r\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\r\n      .pipe(\r\n        debounceTime(500),\r\n        distinctUntilChanged()\r\n      )\r\n      .subscribe((value) => {\r\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\r\n          this.bufferChange.emit(value);\r\n          this.spatialFilterService.loadBufferGeometry(\r\n            this.selectedZone,\r\n            SpatialFilterType.Predefined,\r\n            value,\r\n            this.queryType\r\n          ).subscribe((featureGeom: Feature) => {\r\n            this.zoneWithBuffer = featureGeom;\r\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n          });\r\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\r\n          this.bufferChange.emit(value);\r\n          this.spatialFilterService.loadBufferGeometry(\r\n            this.selectedZone,\r\n            SpatialFilterType.Predefined,\r\n            value * 1000,\r\n            this.queryType\r\n          ).subscribe((featureGeom: Feature) => {\r\n            this.zoneWithBuffer = featureGeom;\r\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n          });\r\n        } else if (value === 0 && this.layers.length > 0) {\r\n          this.bufferChange.emit(value);\r\n          this.zoneWithBufferChange.emit(this.selectedZone);\r\n        } else if (\r\n            value < 0 ||\r\n            (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\r\n            (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\r\n            this.bufferFormControl.setValue(0);\r\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\r\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\r\n        }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.formValueChanges$$.unsubscribe();\r\n  }\r\n\r\n  displayFn(feature?: Feature): string | undefined {\r\n    return feature ? feature.properties.nom : undefined;\r\n  }\r\n\r\n  onZoneChange(feature) {\r\n    if (feature && this.queryType) {\r\n      this.spatialFilterService.loadItemById(feature, this.queryType)\r\n      .subscribe((featureGeom: Feature) => {\r\n        this.selectedZone = featureGeom;\r\n        this.zoneChange.emit(featureGeom);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\r\n    if (unit === this.measureUnit) {\r\n      return;\r\n    } else {\r\n      this.measureUnit = unit;\r\n      this.measureUnitChange.emit(this.measureUnit);\r\n      this.measureUnit === MeasureLengthUnit.Meters ?\r\n        this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\r\n        this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\r\n    }\r\n  }\r\n}\r\n","<igo-geometry-form-field-input\r\n  [formControl]=\"formControl\"\r\n  [map]=\"map\"\r\n  [geometryType]=\"geometryType\"\r\n  [drawGuide]=\"drawGuide$ | async\"\r\n  [measure]=\"measure\"\r\n  [drawControlIsActive]=\"drawControlIsActive\"\r\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\r\n  [drawStyle]=\"drawStyle$ | async\"\r\n  [overlayStyle]=\"overlayStyle$ | async\"\r\n  [radius]=\"radius\">\r\n</igo-geometry-form-field-input>\r\n\r\n<div class=\"header\">\r\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\r\n      [checked]=\"drawControlIsActive\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onDrawControlChange()\">\r\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\r\n    </mat-slide-toggle>\r\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\r\n      [checked]=\"freehandDrawIsActive\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onfreehandControlChange()\">\r\n      {{'igo.geo.spatialFilter.freehandControl' | translate}}\r\n    </mat-slide-toggle>\r\n</div>\r\n\r\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\r\n  <form class=\"buffer-form\">\r\n    <mat-form-field class=\"buffer\">\r\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\r\n      [value]=\"0\" [readonly]=\"this.formControl.value === null\">\r\n    </mat-form-field>\r\n  </form>\r\n\r\n  <mat-form-field class=\"unit-field\">\r\n    <mat-select\r\n    [value]=\"measureUnit\"\r\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\r\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\r\n        {{('igo.geo.measure.' + measureUnit) | translate}}\r\n    </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n</div>\r\n\r\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\r\n  <form class=\"radius-form\">\r\n    <mat-form-field class=\"radius\">\r\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.radius' | translate}}\" [formControl]=\"radiusFormControl\"\r\n      [value]=\"1000\" (input)=\"getRadius()\" [readonly]=\"this.freehandDrawIsActive && this.formControl.value === null\">\r\n    </mat-form-field>\r\n  </form>\r\n\r\n  <mat-form-field class=\"unit-field\">\r\n    <mat-select\r\n    [value]=\"measureUnit\"\r\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\r\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\r\n        {{('igo.geo.measure.' + measureUnit) | translate}}\r\n    </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n</div>\r\n\r\n<mat-label class=\"title mat-typography\">{{'igo.geo.spatialFilter.search' | translate}} : </mat-label>\r\n<mat-radio-group [value]=\"selectedItemType\">\r\n    <mat-radio-button *ngFor=\"let item of itemType\"\r\n      [value]=\"item\"\r\n      (change)=\"onItemTypeChange($event)\">\r\n      {{'igo.geo.spatialFilter.' + item | translate}}\r\n    </mat-radio-button>\r\n</mat-radio-group>\r\n\r\n<div class=\"thematics\" *ngIf=\"selectedItemType==='Thematics'\">\r\n  <mat-table>\r\n      <!-- Name Column -->\r\n      <ng-container matColumnDef=\"name\">\r\n        <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{'igo.geo.spatialFilter.Thematics' | translate}}</mat-header-cell>\r\n      </ng-container>\r\n\r\n      <!-- Select Column -->\r\n      <ng-container matColumnDef=\"select\">\r\n        <mat-header-cell *matHeaderCellDef class=\"checks-header\">\r\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\r\n                        [checked]=\"isAllSelected()\"\r\n                        [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\">\r\n          </mat-checkbox>\r\n        </mat-header-cell>\r\n    </ng-container>\r\n\r\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\r\n    <mat-row *matRowDef=\"let row; columns: displayedColumns;\"></mat-row>\r\n\r\n  </mat-table>\r\n\r\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\r\n    <!-- This is the tree node template for leaf nodes -->\r\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\r\n      <li class=\"mat-tree-node\">\r\n        <!-- use a disabled button to provide padding for tree leaf -->\r\n        <button mat-icon-button disabled></button>\r\n        {{node.name}}\r\n        <mat-checkbox class=\"tree-check\" (click)=\"$event.stopPropagation()\"\r\n                      (change)=\"$event ? onToggleChange(node) : null\"\r\n                      [checked]=\"selectedThematics.isSelected(node)\">\r\n        </mat-checkbox>\r\n      </li>\r\n    </mat-tree-node>\r\n\r\n    <!-- This is the tree node template for expandable nodes -->\r\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\r\n        <div class=\"mat-tree-node\">\r\n          <button mat-icon-button\r\n            (click)=\"onToggleClick(node)\">\r\n            <mat-icon [svgIcon]=\"treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\"></mat-icon>\r\n          </button>\r\n          {{node.name}}\r\n          <mat-checkbox class=\"tree-check-2\" (change)=\"$event ? childrensToggle(node) : null\"\r\n                        [checked]=\"isAllSelected(node)\"\r\n                        [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\">\r\n          </mat-checkbox>\r\n        </div>\r\n        <ul class=\"tree-ul\" [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\">\r\n          <ng-container matTreeNodeOutlet></ng-container>\r\n        </ul>\r\n    </mat-nested-tree-node>\r\n\r\n  </mat-tree>\r\n</div>\r\n\r\n<div class=\"buttons\">\r\n\r\n  <button *ngIf=\"isPredefined()\" mat-raised-button class=\"clear-search-button\" [disabled]=\"disabledClearSearch()\"\r\n    (click)=\"clearSearch()\">\r\n      {{'igo.geo.spatialFilter.clearSearch' | translate}}\r\n  </button>\r\n\r\n  <button *ngIf=\"isPolygon() || isPoint()\" mat-raised-button class=\"clear-form-button\" [disabled]=\"this.formControl.value === null\"\r\n    (click)=\"clearDrawZone()\">\r\n    {{'igo.geo.spatialFilter.clearForm' | translate}}\r\n  </button>\r\n\r\n  <button mat-raised-button class=\"search-button\" [disabled]=\"disableSearchButton()\" color=\"primary\"\r\n    (click)=\"toggleSearchButton()\">\r\n    {{'igo.geo.spatialFilter.goSearch' | translate}}\r\n  </button>\r\n\r\n  <button mat-raised-button class=\"remove-button\" [disabled]=\"allLayers.length === 0\" (click)=\"clearButton()\">\r\n    {{'igo.geo.spatialFilter.removeLayer' | translate}}\r\n  </button>\r\n\r\n  <button mat-raised-button class=\"export-button\" [disabled]=\"!store.entities$.getValue().length\" (click)=\"export.emit()\">\r\n    {{'igo.geo.spatialFilter.exportLayer' | translate}}\r\n  </button>\r\n\r\n</div>","import OlFeature from 'ol/Feature';\r\nimport {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\r\nimport { SelectionModel } from '@angular/cdk/collections';\r\nimport { IgoMap } from '../../../map';\r\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\r\nimport { Feature } from './../../../feature/shared/feature.interfaces';\r\nimport { FormControl } from '@angular/forms';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\r\nimport * as olStyle from 'ol/style';\r\nimport * as olproj from 'ol/proj';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\r\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\r\nimport { MeasureLengthUnit } from '../../../measure';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { Layer } from '../../../layer/shared';\r\nimport { NestedTreeControl } from '@angular/cdk/tree';\r\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\n/**\r\n * Spatial-Filter-Item (search parameters)\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-item',\r\n  templateUrl: './spatial-filter-item.component.html',\r\n  styleUrls: ['./spatial-filter-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get type(): SpatialFilterType {\r\n    return this._type;\r\n  }\r\n  set type(type: SpatialFilterType) {\r\n    this._type = type;\r\n    const index = this.geometryTypes.findIndex(geom => geom === this.type);\r\n    this.geometryType = this.geometryTypes[index];\r\n    this.formControl.reset();\r\n    this.radius = undefined;\r\n    this.drawGuide$.next(null);\r\n    this.drawStyle$.next(undefined);\r\n\r\n    // Necessary to keep reference to the geometry form field input\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      const geojson: GeoJSONGeometry = {\r\n        type: 'Point',\r\n        coordinates: ''\r\n      };\r\n      this.formControl.setValue(geojson);\r\n    }\r\n\r\n    // Necessary to apply the right style when geometry type is Point\r\n    if (this.type === SpatialFilterType.Point) {\r\n      this.radius = 1000; // Base radius\r\n      this.radiusFormControl.setValue(this.radius);\r\n      this.PointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\r\n        const geom = feature.getGeometry() as OlPoint;\r\n        const coordinates = olproj.transform(geom.getCoordinates(), this.map.projection, 'EPSG:4326');\r\n        return new olStyle.Style ({\r\n          image: new olStyle.Circle ({\r\n            radius: this.radius / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution, // Latitude correction\r\n            stroke: new olStyle.Stroke({\r\n              width: 2,\r\n              color: 'rgba(0, 153, 255)'\r\n            }),\r\n            fill: new olStyle.Fill({\r\n              color: 'rgba(0, 153, 255, 0.2)'\r\n            })\r\n          })\r\n        });\r\n      };\r\n      this.overlayStyle = this.PointStyle;\r\n      this.drawStyle$.next(this.overlayStyle);\r\n    } else {\r\n      // If geometry types is Polygon\r\n      this.radius = undefined;\r\n      this.PolyStyle = () => {\r\n        return new olStyle.Style ({\r\n          stroke: new olStyle.Stroke({\r\n            width: 2,\r\n            color: 'rgba(0, 153, 255)'\r\n          }),\r\n          fill: new olStyle.Fill({\r\n            color: 'rgba(0, 153, 255, 0.2)'\r\n          })\r\n        });\r\n      };\r\n      const color = [0, 153, 255];\r\n      const drawStyle = () => {\r\n        return new olStyle.Style({\r\n          image: new olStyle.Circle ({\r\n            radius: 8,\r\n            stroke: new olStyle.Stroke({\r\n              width: 2,\r\n              color: 'rgba(0, 153, 255)'\r\n            }),\r\n            fill: new olStyle.Fill({\r\n              color: 'rgba(0, 153, 255, 0.2)'\r\n            })\r\n          }),\r\n          stroke: new olStyle.Stroke({\r\n            color: color.concat([1]),\r\n            width: 2\r\n          }),\r\n          fill:  new olStyle.Fill({\r\n            color: color.concat([0.2])\r\n          })\r\n        });\r\n      };\r\n      this.overlayStyle = this.PolyStyle;\r\n      this.drawStyle$.next(drawStyle);\r\n    }\r\n    this.overlayStyle$.next(this.overlayStyle);\r\n  }\r\n  private _type: SpatialFilterType;\r\n\r\n  @Input() queryType: SpatialFilterQueryType;\r\n\r\n  @Input() zone: Feature;\r\n\r\n  @Input() loading;\r\n\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n    this._store.entities$.subscribe(() => { this.cdRef.detectChanges(); });\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\r\n  }\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  @Input() allLayers: Layer[] = [];\r\n\r\n  @Input()\r\n  get thematicLength(): number {\r\n    return this._thematicLength;\r\n  }\r\n  set thematicLength(value: number) {\r\n    this._thematicLength = value;\r\n  }\r\n  private _thematicLength: number;\r\n\r\n  @Output() toggleSearch = new EventEmitter();\r\n\r\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\r\n\r\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\r\n\r\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\r\n\r\n  @Output() bufferEvent = new EventEmitter<number>();\r\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\r\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\r\n\r\n  @Output() radiusEvent = new EventEmitter<number>();\r\n  @Output() freehandControl = new EventEmitter<boolean>();\r\n\r\n  @Output() clearButtonEvent = new EventEmitter();\r\n\r\n  @Output() clearSearchEvent = new EventEmitter();\r\n\r\n  @Output() export = new EventEmitter();\r\n\r\n  @Output() openWorkspace = new EventEmitter();\r\n\r\n  public itemType: SpatialFilterItemType[] = [SpatialFilterItemType.Address, SpatialFilterItemType.Thematics];\r\n  public selectedItemType: SpatialFilterItemType = SpatialFilterItemType.Address;\r\n  public selectedSourceAddress;\r\n\r\n  treeControl: NestedTreeControl<SpatialFilterThematic> = new NestedTreeControl<SpatialFilterThematic>(node => node.children);\r\n\r\n  // For thematics and results tables\r\n  public displayedColumns: string[] = ['name', 'select'];\r\n  public childrens: SpatialFilterThematic[] = [];\r\n  public groups: string[] = [];\r\n  public thematics: SpatialFilterThematic[] = [];\r\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\r\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(true, []);\r\n\r\n  // For geometry form field input\r\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\r\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\r\n  overlayStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\r\n  drawStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\r\n\r\n  private value$$: Subscription;\r\n  private radiusChanges$$: Subscription;\r\n  private bufferChanges$$: Subscription;\r\n\r\n  public formControl = new FormControl();\r\n  public geometryType: typeof OlGeometryType | string;\r\n  public geometryTypeField = false;\r\n  public geometryTypes: string[] = ['Point', 'Polygon'];\r\n  public drawGuideField = false;\r\n  public drawGuide: number = null;\r\n  public drawGuidePlaceholder = '';\r\n  public measure = false;\r\n  public drawControlIsActive = true;\r\n  public freehandDrawIsActive = false;\r\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n  public drawZone;\r\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n\r\n  public radius: number;\r\n  public buffer: number = 0;\r\n  public radiusFormControl = new FormControl();\r\n  public bufferFormControl = new FormControl();\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n  public zoneWithBuffer;\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private spatialFilterService: SpatialFilterService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    this.spatialFilterService.loadThematicsList()\r\n    .subscribe((items: SpatialFilterThematic[]) => {\r\n      for (const item of items) {\r\n        this.childrens.push(item);\r\n        this.childrens.sort((a, b) => {\r\n          return a.name.localeCompare(b.name);\r\n        });\r\n      }\r\n      this.groups.push(this.languageService.translate.instant('igo.geo.terrapi.limites'));\r\n      const limits: SpatialFilterThematic = {\r\n        name: this.groups[0],\r\n        children: []\r\n      };\r\n      this.thematics.push(limits);\r\n      this.childrens.forEach(child => {\r\n        if (child.group && (this.groups.indexOf(child.group) === -1)) {\r\n          this.groups.push(child.group);\r\n          const thematic: SpatialFilterThematic = {\r\n            name: child.group,\r\n            children: []\r\n          };\r\n          this.thematics.push(thematic);\r\n        }\r\n\r\n        if (!child.group) {\r\n          if (\r\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.AdmRegion') ||\r\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\r\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Arrond') ||\r\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircFed') ||\r\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircProv') ||\r\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.DirReg') ||\r\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\r\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.RegTour')) {\r\n              child.group = limits.name;\r\n          } else if (child.name === this.languageService.translate.instant('igo.geo.terrapi.routes')) {\r\n            child.group = this.languageService.translate.instant('igo.geo.spatialFilter.group.transport');\r\n          } else {\r\n            const thematic: SpatialFilterThematic = {\r\n              name: child.name,\r\n              children: [],\r\n              source: child.source\r\n            };\r\n            this.thematics.push(thematic);\r\n          }\r\n        }\r\n        this.thematics.sort((a, b) => {\r\n          return a.name.localeCompare(b.name);\r\n        });\r\n      });\r\n      this.thematics.forEach(thematic => {\r\n        for (const child of this.childrens) {\r\n          if (child.group === thematic.name) {\r\n            thematic.children.push(child);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.dataSource.data = this.thematics;\r\n\r\n    this.drawGuide$.next(null);\r\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\r\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\r\n      if (value) {\r\n        this.value$.next(value);\r\n        this.drawZone = this.formControl.value as Feature;\r\n        if (this.buffer !== 0) {\r\n          this.drawZoneEvent.emit(this.drawZone);\r\n          this.bufferFormControl.setValue(this.buffer);\r\n        }\r\n      } else {\r\n        this.value$.next(undefined);\r\n        this.drawZone = undefined;\r\n      }\r\n    });\r\n\r\n    this.value$.subscribe(() => {\r\n      this.getRadius();\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\r\n      this.getRadius();\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\r\n      .pipe(\r\n        debounceTime(500)\r\n      )\r\n      .subscribe((value) => {\r\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\r\n          this.buffer = value;\r\n          this.bufferEvent.emit(value);\r\n          this.spatialFilterService.loadBufferGeometry(\r\n            this.drawZone,\r\n            SpatialFilterType.Polygon,\r\n            value\r\n          ).subscribe((featureGeom: Feature) => {\r\n            this.zoneWithBuffer = featureGeom;\r\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n          });\r\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\r\n          this.buffer = value;\r\n          this.bufferEvent.emit(value);\r\n          this.spatialFilterService.loadBufferGeometry(\r\n            this.drawZone,\r\n            SpatialFilterType.Polygon,\r\n            value * 1000\r\n          ).subscribe((featureGeom: Feature) => {\r\n            this.zoneWithBuffer = featureGeom;\r\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n          });\r\n        } else if (value === 0) {\r\n          this.buffer = value;\r\n          this.bufferEvent.emit(value);\r\n          this.drawZoneEvent.emit(this.drawZone);\r\n        } else if (\r\n          value < 0 ||\r\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\r\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\r\n            this.bufferFormControl.setValue(0);\r\n            this.buffer = 0;\r\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\r\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\r\n        }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the value stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.value$$.unsubscribe();\r\n    this.radiusChanges$$.unsubscribe();\r\n    this.bufferChanges$$.unsubscribe();\r\n    this.cdRef.detach();\r\n    if (this.radiusChanges$$) {\r\n      this.radiusChanges$$.unsubscribe();\r\n    }\r\n    if (this.value$$) {\r\n      this.value$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  onItemTypeChange(event) {\r\n    this.selectedItemType = event.value;\r\n    this.itemTypeChange.emit(this.selectedItemType);\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\r\n    if (unit === this.measureUnit) {\r\n      return;\r\n    } else {\r\n      this.measureUnit = unit;\r\n      this.measureUnitChange.emit(this.measureUnit);\r\n      if (this.isPolygon()) {\r\n        this.measureUnit === MeasureLengthUnit.Meters ?\r\n          this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\r\n          this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\r\n      } else if (this.isPoint()) {\r\n        this.measureUnit === MeasureLengthUnit.Meters ?\r\n          this.radiusFormControl.setValue(this.radiusFormControl.value * 1000) :\r\n          this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\r\n      }\r\n    }\r\n  }\r\n\r\n  isPredefined() {\r\n    return this.type === SpatialFilterType.Predefined;\r\n  }\r\n\r\n  isPolygon() {\r\n    return this.type === SpatialFilterType.Polygon;\r\n  }\r\n\r\n  isPoint() {\r\n    return this.type === SpatialFilterType.Point;\r\n  }\r\n\r\n  hasChild(_: number, node: SpatialFilterThematic) {\r\n    if (node.children) {\r\n      return node.children.length;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  onToggleClick(node: SpatialFilterThematic) {\r\n    this.treeControl.isExpanded(node) ? this.treeControl.collapse(node) : this.treeControl.expand(node);\r\n  }\r\n\r\n  isAllSelected(node?: SpatialFilterThematic) {\r\n    let numSelected;\r\n    let numNodes = 0;\r\n    if (!node) {\r\n      numSelected = this.selectedThematics.selected.length;\r\n      this.thematics.forEach(thematic => {\r\n        if (this.groups.indexOf(thematic.name) === -1) {\r\n          numNodes++;\r\n        }\r\n      });\r\n      this.childrens.forEach(children => {\r\n        if (!this.thematics.find(thematic => thematic.source === children.source)) {\r\n          numNodes++;\r\n        }\r\n      });\r\n    } else {\r\n      numSelected = node.children.length;\r\n      node.children.forEach(children => {\r\n        if (this.selectedThematics.selected.find(thematic => thematic === children)) {\r\n          numNodes++;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (numNodes >= 1) {\r\n      return numSelected === numNodes;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  hasChildrenSelected(node: SpatialFilterThematic) {\r\n    let bool = false;\r\n    node.children.forEach(child => {\r\n      if (this.selectedThematics.selected.find(thematic => thematic.source === child.source)) {\r\n        bool = true;\r\n      }\r\n    });\r\n    return bool;\r\n  }\r\n\r\n  /**\r\n   * Apply header checkbox\r\n   */\r\n  masterToggle() {\r\n    this.isAllSelected() ?\r\n      this.selectedThematics.clear() :\r\n      this.selectAll();\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n\r\n    if (this.isAllSelected()) {\r\n      this.thematics.forEach(thematic => {\r\n        if (this.hasChild(0, thematic)) {\r\n          this.treeControl.expand(thematic);\r\n        }\r\n      });\r\n    } else {\r\n      this.thematics.forEach(thematic => {\r\n        if (this.hasChild(0, thematic)) {\r\n          this.treeControl.collapse(thematic);\r\n        }\r\n      });\r\n    }\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  selectAll(node?: SpatialFilterThematic) {\r\n    if (!node) {\r\n      this.thematics.forEach(thematic => {\r\n        if (this.groups.indexOf(thematic.name) === -1) {\r\n          this.selectedThematics.select(thematic);\r\n        }\r\n      });\r\n      this.childrens.forEach(children => {\r\n        if (!this.selectedThematics.selected.find(thematic => thematic.source === children.source)) {\r\n          this.selectedThematics.select(children);\r\n        }\r\n      });\r\n    } else {\r\n      if (this.hasChild(0, node)) {\r\n        node.children.forEach(children => this.selectedThematics.select(children));\r\n      }\r\n    }\r\n  }\r\n\r\n  childrensToggle(node: SpatialFilterThematic) {\r\n    this.isAllSelected(node) ?\r\n    node.children.forEach(child => this.selectedThematics.deselect(child)) :\r\n    this.selectAll(node);\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n    this.treeControl.expand(node);\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  /**\r\n   * Apply changes to the thematics selected tree and emit event\r\n   */\r\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\r\n    let selected = false;\r\n    if (this.selectedThematics.selected.find(thematic => thematic.source === nodeSelected.source) !== undefined) {\r\n      selected = true;\r\n    }\r\n\r\n    this.childrens.forEach(children => {\r\n      if (children === nodeSelected && selected === false) {\r\n        this.selectedThematics.select(children);\r\n      }\r\n      if (children === nodeSelected && selected === true) {\r\n        this.selectedThematics.deselect(children);\r\n      }\r\n    });\r\n    this.thematics.forEach(thematic => {\r\n      if (thematic === nodeSelected && selected === false) {\r\n        this.selectedThematics.select(thematic);\r\n      }\r\n      if (thematic === nodeSelected && selected === true) {\r\n        this.selectedThematics.deselect(thematic);\r\n      }\r\n    });\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  onDrawControlChange() {\r\n    this.drawControlIsActive = !this.drawControlIsActive;\r\n  }\r\n\r\n  onfreehandControlChange() {\r\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\r\n    this.freehandControl.emit(this.freehandDrawIsActive);\r\n  }\r\n\r\n  /**\r\n   * Launch search button\r\n   */\r\n  toggleSearchButton() {\r\n    if (!this.isPredefined()) {\r\n      if (this.buffer > 0) {\r\n        this.zoneWithBuffer.meta = {\r\n          id: undefined,\r\n          title: 'Zone'\r\n        };\r\n        this.zoneWithBuffer.properties = {\r\n          nom: 'Zone',\r\n          type: this.type as string\r\n        };\r\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\r\n      } else {\r\n        this.drawZone.meta = {\r\n          id: undefined,\r\n          title: 'Zone'\r\n        };\r\n        this.drawZone.properties = {\r\n          nom: 'Zone',\r\n          type: this.type as string\r\n        };\r\n        this.drawZoneEvent.emit(this.drawZone);\r\n      }\r\n    }\r\n    if (this.isPoint()) {\r\n      this.radiusEvent.emit(this.radius);\r\n    } else if (this.isPolygon()) {\r\n      this.bufferEvent.emit(this.buffer);\r\n    }\r\n    this.toggleSearch.emit();\r\n    this.store.entities$.subscribe((value) => {\r\n      if (value.length && this.layers.length === this.thematicLength + 1) {\r\n        this.openWorkspace.emit();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Launch clear button (clear store and map layers)\r\n   */\r\n  clearButton() {\r\n    this.loading = true;\r\n    if (this.store) {\r\n      this.store.clear();\r\n    }\r\n    if (this.isPoint() || this.isPolygon()) {\r\n      this.drawZone = undefined;\r\n      this.formControl.reset();\r\n    }\r\n    this.bufferFormControl.setValue(0);\r\n    this.buffer = 0;\r\n    this.bufferEvent.emit(0);\r\n    this.clearButtonEvent.emit();\r\n    this.loading = false;\r\n  }\r\n\r\n  clearDrawZone() {\r\n    this.formControl.reset();\r\n    this.bufferFormControl.setValue(0);\r\n    this.buffer = 0;\r\n  }\r\n\r\n  /**\r\n   * Launch clear search (clear field if type is predefined)\r\n   */\r\n  clearSearch() {\r\n    this.selectedThematics.clear();\r\n    this.bufferFormControl.setValue(0);\r\n    this.buffer = 0;\r\n    this.bufferEvent.emit(0);\r\n    this.thematicChange.emit([]);\r\n    this.clearSearchEvent.emit();\r\n  }\r\n\r\n  /**\r\n   * Verify conditions of incomplete fields or busy service\r\n   */\r\n  disableSearchButton(): boolean {\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\r\n        if (this.queryType !== undefined && this.zone !== undefined) {\r\n          return this.loading;\r\n        }\r\n      }\r\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\r\n        if (this.queryType !== undefined && this.zone !== undefined && this.selectedThematics.selected.length > 0) {\r\n          return this.loading;\r\n        }\r\n      }\r\n    }\r\n    if (this.type === SpatialFilterType.Polygon || this.type === SpatialFilterType.Point) {\r\n      if (this.selectedItemType === SpatialFilterItemType.Address && this.formControl.value !== null) {\r\n        return this.loading;\r\n      }\r\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\r\n        if (this.selectedThematics.selected.length > 0 && this.formControl.value !== null) {\r\n          return this.loading;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  disabledClearSearch() {\r\n    let disable = true;\r\n    this.selectedItemType === SpatialFilterItemType.Address ?\r\n      disable = this.queryType === undefined :\r\n      disable = this.queryType === undefined && this.selectedThematics.selected.length === 0;\r\n\r\n    return disable;\r\n  }\r\n\r\n  /**\r\n   * Manage radius value at user change\r\n   */\r\n  getRadius() {\r\n    let formValue;\r\n    if (this.formControl.value !== null) {\r\n      this.measureUnit === MeasureLengthUnit.Meters ?\r\n        formValue = this.formControl.value.radius :\r\n        formValue = this.formControl.value.radius / 1000;\r\n    } else {\r\n      formValue = undefined;\r\n    }\r\n\r\n    if (this.type === SpatialFilterType.Point) {\r\n      if (!this.freehandDrawIsActive) {\r\n        if (\r\n          this.radiusFormControl.value < 0 ||\r\n          (this.measureUnit === MeasureLengthUnit.Meters && this.radiusFormControl.value >= 100000) ||\r\n          (this.measureUnit === MeasureLengthUnit.Kilometers && this.radiusFormControl.value >= 100)) {\r\n          this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\r\n            this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\r\n          this.radius = 1000;\r\n          this.measureUnit === MeasureLengthUnit.Meters ?\r\n            this.radiusFormControl.setValue(this.radius) :\r\n            this.radiusFormControl.setValue(this.radius / 1000);\r\n          this.drawGuide$.next(this.radius);\r\n          return;\r\n        }\r\n      } else {\r\n        if (formValue) {\r\n          if (formValue >= 100000) {\r\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\r\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\r\n            this.formControl.reset();\r\n            return;\r\n          }\r\n          if (formValue !== this.radiusFormControl.value) {\r\n            this.radiusFormControl.setValue(formValue);\r\n            return;\r\n          }\r\n        }\r\n      }\r\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\r\n        this.radius = this.radiusFormControl.value;\r\n        this.drawGuide$.next(this.radius);\r\n      } else {\r\n        this.radius = this.radiusFormControl.value * 1000;\r\n        this.drawGuide$.next(this.radius * 1000);\r\n      }\r\n      this.overlayStyle$.next(this.PointStyle);\r\n      this.drawStyle$.next(this.PointStyle);\r\n    }\r\n  }\r\n}\r\n","<div class=\"datetime-container\">\r\n\r\n  <mat-slide-toggle \r\n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\r\n    [(ngModel)]=\"sliderMode\"\r\n    (change)=\"modeChange($event)\">\r\n    {{'igo.geo.filter.sliderModeTitle' | translate}}\r\n  </mat-slide-toggle>\r\n\r\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\r\n    <igo-ogc-filter-time-slider\r\n      [begin]=\"beginValue\"\r\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\r\n      [currentFilter]=\"currentFilter\" \r\n      [datasource]=\"datasource\"\r\n      (changeProperty)=\"changePropertyByPass($event)\"\r\n    >\r\n    </igo-ogc-filter-time-slider>\r\n    \r\n  </div>\r\n\r\n  <div *ngIf=\"!sliderMode\">\r\n    <div class=\"datetime-input\">\r\n      <mat-form-field class=\"date-input\">\r\n        <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\"></mat-datepicker-toggle>\r\n        <input #begin\r\n          matInput\r\n          [matDatepicker]=\"beginDatepicker\"\r\n          [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\r\n          [attr.disabled]=\"!currentFilter.active\"\r\n          (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\r\n          [matDatepickerFilter]=\"dateFilter.bind(this, 'begin')\"\r\n          [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\r\n          [min]=\"handleDate(datasource.options.minDate)\"\r\n          [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\" >\r\n        <span class=\"filler\"></span>\r\n        <mat-datepicker\r\n          #beginDatepicker\r\n          [startView]=\"calendarView()\"\r\n          [startAt]=\"beginValue\"\r\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\r\n          (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\">\r\n        </mat-datepicker>\r\n      </mat-form-field>\r\n      <div class=\"time-input\">\r\n        <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\">\r\n          <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\r\n          <mat-select\r\n            [formControl]=\"beginHourFormControl\"\r\n            [attr.disabled]=\"!currentFilter.active\"\r\n            (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\r\n            <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{hour}}</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n        <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\r\n          <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\r\n          <mat-select\r\n            [formControl]=\"beginMinuteFormControl\"\r\n            [attr.disabled]=\"!currentFilter.active\"\r\n            (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\r\n            <mat-option *ngFor=\"let minute of beginMinutes\" [value]=\"minute\">{{minute}}</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"datetime-input\" *ngIf=\"!restrictedToStep()\">\r\n      <mat-form-field class=\"date-input\">\r\n        <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\"></mat-datepicker-toggle>\r\n          <input #end\r\n            matInput\r\n            [matDatepicker]=\"endDatepicker\"\r\n            [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\r\n            [attr.disabled]=\"!currentFilter.active\"\r\n            (dateChange)=\"changeTemporalProperty(end.value, 2)\"\r\n            [matDatepickerFilter]=\"dateFilter.bind(this, 'end')\"\r\n            [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\r\n            [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\r\n            [max]=\"handleDate(datasource.options.maxDate)\" >\r\n          <span class=\"filler\"></span>\r\n          <mat-datepicker #endDatepicker\r\n            [startView]=\"calendarView()\"\r\n            [startAt]=\"endValue\"\r\n            (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\r\n            (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\">\r\n        </mat-datepicker>\r\n      </mat-form-field>\r\n      <div class=\"time-input\">\r\n        <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\" >\r\n          <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\r\n          <mat-select\r\n            [formControl]=\"endHourFormControl\"\r\n            [attr.disabled]=\"!currentFilter.active\"\r\n            (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\r\n            <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{hour}}</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n        <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\r\n          <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\r\n          <mat-select\r\n            [formControl]=\"endMinuteFormControl\"\r\n            [attr.disabled]=\"!currentFilter.active\"\r\n            (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\r\n            <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{minute}}</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ViewChild,\r\n  ElementRef,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { FormControl } from '@angular/forms';\r\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\r\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\r\nimport {\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFilterableDataSource\r\n} from '../shared/ogc-filter.interface';\r\n\r\nimport * as moment_ from 'moment';\r\nconst moment = moment_;\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-time',\r\n  templateUrl: './ogc-filter-time.component.html',\r\n  styleUrls: ['./ogc-filter-time.component.scss']\r\n})\r\nexport class OgcFilterTimeComponent implements OnInit {\r\n  @Input() datasource: OgcFilterableDataSource;\r\n  @Input() currentFilter: any;\r\n  @Output() changeProperty: EventEmitter<{\r\n    value: string;\r\n    pos: number;\r\n    refreshFilter: boolean;\r\n  }> = new EventEmitter<any>();\r\n\r\n  beginHours: number[];\r\n  endHours: number[];\r\n  beginMinutes: number[];\r\n  endMinutes: number[];\r\n  beginHourFormControl = new FormControl();\r\n  beginMinuteFormControl = new FormControl();\r\n  endHourFormControl = new FormControl();\r\n  endMinuteFormControl = new FormControl();\r\n  _beginValue: Date;\r\n  _endValue: Date;\r\n  readonly _defaultMin: string = '1900-01-01';\r\n  readonly _defaultMax: string = '2052-01-06';\r\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\r\n  readonly _defaultSliderModeEnabled: boolean = true;\r\n  ogcFilterOperator = OgcFilterOperator;\r\n  public sliderMode = false;\r\n\r\n  readonly defaultStepMillisecond = 60000;\r\n  public options: OgcFilterableDataSourceOptions;\r\n\r\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\r\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\r\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\r\n  @ViewChild('endTime') endTime: HTMLInputElement;\r\n\r\n  get step(): string {\r\n    return this.datasource.options.stepDate\r\n      ? this.datasource.options.stepDate\r\n      : this.currentFilter.step;\r\n  }\r\n\r\n  get stepMilliseconds(): number {\r\n    const step = moment.duration(this.step).asMilliseconds();\r\n    return step === 0 ? this.defaultStepMillisecond : step;\r\n  }\r\n\r\n  set beginValue(begin: Date) {\r\n    this._beginValue = begin;\r\n  }\r\n\r\n  get beginValue(): Date {\r\n    return this._beginValue;\r\n  }\r\n\r\n  set endValue(end: Date) {\r\n    this._endValue = end;\r\n  }\r\n\r\n  get endValue(): Date {\r\n    return this._endValue;\r\n  }\r\n\r\n  get sliderInterval(): number {\r\n    return this.currentFilter.sliderInterval === undefined\r\n      ? 2000\r\n      : this.currentFilter.sliderInterval;\r\n  }\r\n\r\n  get maxDate(): string {\r\n    return this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax;\r\n  }\r\n\r\n  get displayFormat(): string {\r\n    return this.currentFilter.displayFormat ? this.currentFilter.displayFormat : this._defaultDisplayFormat;\r\n  }\r\n\r\n\r\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\r\n\r\n  ngOnInit(){\r\n    if (this.currentFilter.sliderOptions) {\r\n      this.currentFilter.sliderOptions.enabled = this.currentFilter.sliderOptions.enabled !== undefined ?\r\n        this.currentFilter.sliderOptions.enabled : this._defaultSliderModeEnabled;\r\n    }\r\n    this.beginValue = this.parseFilter(this.handleMin());\r\n    this.endValue = this.parseFilter(this.handleMax());\r\n    this.updateHoursMinutesArray();\r\n    // update value for now value\r\n    this.updateValues();\r\n  }\r\n\r\n  parseFilter(filter): Date {\r\n    if (!filter){\r\n      return new Date();\r\n    } else if ( isNaN( new Date(filter).getTime() ) ){\r\n      if (filter.search('now') >= 0 ){\r\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\r\n        if (filter.match(/\\+/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('+') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment().add(intervalInt, interval[0]).toDate();\r\n        }\r\n        if (filter.match(/\\-/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('-') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment().subtract(intervalInt, interval[0]).toDate();\r\n        }\r\n        return new Date();\r\n      }\r\n      if (filter.search('today') >= 0){\r\n        const _now = moment().endOf('day').toDate();\r\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\r\n        if ( filter.match(/\\+/) ) {\r\n          const intervalInt = parseInt( filter.substring(filter.search('+') + 1, interval.index), 10 );\r\n          return moment(_now).add(intervalInt, interval[0]).toDate();\r\n        }\r\n        if ( filter.match(/\\-/) ) {\r\n          const intervalInt = parseInt(filter.substring(filter.search('-') + 1, interval.index), 10);\r\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\r\n        }\r\n        return _now;\r\n      }\r\n      return new Date();\r\n    }\r\n    return filter ? new Date(filter) : new Date();\r\n  }\r\n\r\n  changeTemporalProperty(value, position?, refreshFilter = true) {\r\n    let valueTmp = this.getDateTime(value, position);\r\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\r\n      /* Above month: see yearSelected or monthSelected */\r\n      valueTmp = moment(valueTmp).endOf('day').toDate();\r\n    }\r\n\r\n    if (position === 1) {\r\n      this.beginValue = valueTmp;\r\n      if (this.restrictedToStep()) {\r\n        this.changeTemporalProperty(this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds), 2, refreshFilter);\r\n      }\r\n    } else {\r\n      this.endValue = valueTmp;\r\n    }\r\n    this.updateHoursMinutesArray();\r\n    this.changeProperty.next({ value: valueTmp.toISOString(), pos: position, refreshFilter });\r\n  }\r\n\r\n  handleDate(value): Date {\r\n    if (!value || value === '') {\r\n      return undefined;\r\n    }\r\n    return new Date(value);\r\n  }\r\n\r\n  calendarType() {\r\n    if (this.stepMilliseconds < 86400000) {\r\n      return 'datetime';\r\n    }\r\n    return 'date';\r\n  }\r\n\r\n  yearSelected(year, datePicker?: any, property?: string, refreshFilter = true) {\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\r\n      if (datePicker) {\r\n        datePicker.close();\r\n      }\r\n      if (property === 'end') {\r\n        year = moment(year).endOf('year').toDate();\r\n      } else if (property === 'begin' && this.restrictedToStep()) {\r\n        this.yearSelected(year, undefined, 'end');\r\n      }\r\n      this.changeTemporalProperty(year, property === 'begin' ? 1 : 2, refreshFilter);\r\n    }\r\n  }\r\n\r\n  monthSelected(month, datePicker?: any, property?: string, refreshFilter = true) {\r\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\r\n      if (datePicker) {\r\n        datePicker.close();\r\n      }\r\n      if (property === 'end') {\r\n        month = moment(month).endOf('month').toDate();\r\n      } else if (property === 'begin' && this.restrictedToStep()) {\r\n        this.monthSelected(month, undefined, 'end');\r\n      }\r\n      this.changeTemporalProperty(month, property === 'begin' ? 1 : 2, refreshFilter);\r\n    }\r\n  }\r\n\r\n  calendarView() {\r\n    const test = this.stepMilliseconds;\r\n    const diff = Math.abs(\r\n      this.parseFilter(this.currentFilter.end).getTime() -\r\n        this.parseFilter(this.currentFilter.begin).getTime()\r\n    );\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\r\n      return 'multi-year';\r\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\r\n      return 'year';\r\n    } else if (test < 86400000 && diff < 86400000) {\r\n      return 'clock';\r\n    } else {\r\n      return 'month';\r\n    }\r\n  }\r\n\r\n  dateFilter(type: string, date: string): boolean {\r\n    const dateValue = new Date(date);\r\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\r\n\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\r\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'years', true);\r\n      if ( type === 'end' ) {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const monthDiffPlus1 =  moment(dateValuePlus1).diff(moment(this.handleMin()), 'years', true);\r\n        return (monthDiffPlus1 % moment.duration(this.step).asYears()) === 0;\r\n      } else if ( type === 'begin' ) {\r\n        return (monthDiff % moment.duration(this.step).asYears()) === 0;\r\n      }\r\n    }\r\n    else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\r\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'months', true);\r\n      if ( type === 'end' ) {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const monthDiffPlus1 =  moment(dateValuePlus1).diff(moment(this.handleMin()), 'months', true);\r\n        return (monthDiffPlus1 % moment.duration(this.step).asMonths()) === 0;\r\n      } else if ( type === 'begin' ) {\r\n        return (monthDiff % moment.duration(this.step).asMonths()) === 0;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\r\n      const weekDiff = moment(dateValue).diff(moment(this.handleMin()), 'weeks', true);\r\n      if ( type === 'end' ) {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const weekDiffPlus1 =  moment(dateValuePlus1).diff(moment(this.handleMin()), 'weeks', true);\r\n        return (weekDiffPlus1 % moment.duration(this.step).asWeeks()) === 0;\r\n      } else if ( type === 'begin' ) {\r\n        return (weekDiff % moment.duration(this.step).asWeeks()) === 0;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\r\n      const dayDiff = moment(dateValue).diff(moment(this.handleMin()), 'days', true);\r\n      if ( type === 'end' ) {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const dayDiffPlus1 =  moment(dateValuePlus1).diff(moment(this.handleMin()), 'days', true);\r\n        const _mod = (dayDiffPlus1 % moment.duration(this.step).asDays());\r\n        return  (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0 ; // 1 millisecond = 1.1574074074074076e-8\r\n      } else if ( type === 'begin' ) {\r\n        const _mod = ((dayDiff % moment.duration(this.step).asDays()) + 1);\r\n        return (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1 ; // 1 millisecond = 1.1574074074074076e-8\r\n      }\r\n    } else if ( this.ogcFilterTimeService.stepIsHourDuration(this.step) ) {\r\n      const hourDiff = moment(dateValue).diff(moment(this.handleMin()), 'hours', true);\r\n      return (hourDiff % moment.duration(this.step).asHours()) === 0;\r\n\r\n    } else if ( this.ogcFilterTimeService.stepIsMinuteDuration(this.step) ) {\r\n      return true;\r\n    }\r\n\r\n    return diff % this.stepMilliseconds === 0;\r\n  }\r\n\r\n  getDateTime(date, pos) {\r\n    const valuetmp = new Date(date);\r\n    let valuetmp2;\r\n\r\n    if (!this.sliderMode) {\r\n      switch (pos) {\r\n        case 1:\r\n          valuetmp2 = valuetmp.setHours(\r\n            this.beginHourFormControl.value,\r\n            this.beginMinuteFormControl.value\r\n          );\r\n          break;\r\n        case 2:\r\n          valuetmp2 = valuetmp.setHours(\r\n            this.endHourFormControl.value,\r\n            this.endMinuteFormControl.value\r\n          );\r\n          break;\r\n      }\r\n    }\r\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\r\n  }\r\n\r\n  handleMinuteIncrement() {\r\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\r\n      if (this.stepMilliseconds < 3600000) {\r\n        return this.stepMilliseconds / 1000 === 60 ? 1 : this.stepMilliseconds / 1000;\r\n      } else {\r\n        return (this.stepMilliseconds % 3600000) / 60;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\r\n      return 60;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  handleHourIncrement() {\r\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\r\n      return this.stepMilliseconds / 1000 / 60 / 60;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  fullBeginHoursArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.beginHours = Array.from(\r\n        {\r\n          length:\r\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\r\n        },\r\n        (_, i) => 0 + i * this.handleHourIncrement()\r\n      );\r\n    } else {\r\n      this.beginHours = Array.from(\r\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleHourIncrement()\r\n      );\r\n    }\r\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\r\n  }\r\n\r\n  fullEndHoursArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.endHours = Array.from(\r\n        {\r\n          length:\r\n            (23 - this.beginHourFormControl.value) /\r\n              this.handleHourIncrement() +\r\n            1\r\n        },\r\n        (_, i) =>\r\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\r\n      );\r\n    } else {\r\n      this.endHours = Array.from(\r\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleHourIncrement()\r\n      );\r\n    }\r\n    this.endHourFormControl.setValue(this.endValue.getHours());\r\n  }\r\n\r\n  fullBeginMinutesArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.beginMinutes = Array.from(\r\n        {\r\n          length:\r\n            (this.endMinuteFormControl.value - 0) /\r\n              this.handleMinuteIncrement() +\r\n            1\r\n        },\r\n        (_, i) => 0 + i * this.handleMinuteIncrement()\r\n      );\r\n    } else {\r\n      this.beginMinutes = Array.from(\r\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleMinuteIncrement()\r\n      );\r\n    }\r\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\r\n  }\r\n\r\n  fullEndMinutesArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.endMinutes = Array.from(\r\n        {\r\n          length:\r\n            (59 - this.beginMinuteFormControl.value) /\r\n              this.handleMinuteIncrement() +\r\n            1\r\n        },\r\n        (_, i) =>\r\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\r\n      );\r\n    } else {\r\n      this.endMinutes = Array.from(\r\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleMinuteIncrement()\r\n      );\r\n    }\r\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\r\n  }\r\n\r\n  updateHoursMinutesArray() {\r\n    const beginTmp = new Date(this.beginValue);\r\n    const endTmp = new Date(this.endValue);\r\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\r\n      this.fullBeginHoursArray(true);\r\n      this.fullEndHoursArray(true);\r\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\r\n        this.fullBeginMinutesArray(true);\r\n        this.fullEndMinutesArray(true);\r\n      }\r\n    } else {\r\n      this.fullBeginHoursArray();\r\n      this.fullEndHoursArray();\r\n      this.fullBeginMinutesArray();\r\n      this.fullEndMinutesArray();\r\n    }\r\n  }\r\n\r\n  private updateValues() {\r\n    this.changeTemporalProperty(this.beginValue, 1, false);\r\n    this.changeTemporalProperty(this.endValue, 2, true);\r\n  }\r\n\r\n  public restrictedToStep(): boolean {\r\n    return this.currentFilter.restrictToStep\r\n      ? this.currentFilter.restrictToStep : false;\r\n  }\r\n\r\n  public handleMin() {\r\n    return this.currentFilter.begin ? this.currentFilter.begin :\r\n              (this.datasource.options.minDate ? this.datasource.options.minDate : this._defaultMin);\r\n  }\r\n\r\n  public handleMax() {\r\n    return this.currentFilter.end ? this.currentFilter.end :\r\n              (this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax);\r\n  }\r\n\r\n  changePropertyByPass(event) {\r\n    this.changeProperty.next(event);\r\n  }\r\n\r\n  modeChange(event) {\r\n    if (!event.checked) {\r\n      this.updateValues();\r\n    }\r\n  }\r\n\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ViewChild,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\r\n\r\nimport * as moment_ from 'moment';\r\nimport { MatSlider } from '@angular/material/slider';\r\nconst moment = moment_;\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-time-slider',\r\n  templateUrl: './ogc-filter-time-slider.component.html',\r\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\r\n})\r\nexport class OgcFilterTimeSliderComponent implements OnInit {\r\n  @Input() currentFilter: any;\r\n  @Input() begin: any;\r\n  @Input() max: any;\r\n  @Input() datasource: any;\r\n  @Output() changeProperty: EventEmitter<{\r\n    value: any;\r\n    pos: number;\r\n    refreshFilter: boolean;\r\n  }> = new EventEmitter<any>();\r\n  @ViewChild(MatSlider) slider: MatSlider;\r\n\r\n  interval;\r\n  sliderValue: number = 1;\r\n  calculatedStep: number = 0;\r\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\r\n  readonly _defaultSliderInterval: number = 2000;\r\n  public playIcon = 'play-circle';\r\n  public resetIcon = 'replay';\r\n\r\n  get sliderInterval(): number {\r\n    return this.currentFilter.sliderInterval === undefined\r\n      ? this._defaultSliderInterval\r\n      : this.currentFilter.sliderInterval;\r\n  }\r\n\r\n  get displayFormat(): string {\r\n    if (this.currentFilter.sliderOptions?.displayFormat){\r\n      return this.currentFilter.sliderOptions.displayFormat;\r\n    }\r\n    if (this.currentFilter.displayFormat) {\r\n      return this.currentFilter.displayFormat;\r\n    }\r\n    return this._defaultDisplayFormat;\r\n  }\r\n\r\n  get beginMillisecond(): number {\r\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\r\n  }\r\n\r\n  get maxMillisecond(): number {\r\n    return this.ogcFilterTimeService.dateToNumber(this.max);\r\n  }\r\n\r\n  get stepMillisecond(): number {\r\n    return this.ogcFilterTimeService.stepMillisecond(this.datasource, this.currentFilter);\r\n  }\r\n\r\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\r\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\r\n  }\r\n\r\n  ngOnInit(){\r\n    this.calculateStep();\r\n    this.handleSliderInput({value: 1});\r\n  }\r\n\r\n  sliderDisplayWith(value) {\r\n    let dateTmp = new Date(this.beginMillisecond + ((value - 1) * this.stepMillisecond));\r\n\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\r\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\r\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'year').toDate();\r\n    } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\r\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\r\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'month').toDate();\r\n    }\r\n\r\n    return moment(dateTmp).format(this.displayFormat);\r\n  }\r\n\r\n  playFilter(event: any) {\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        that => {\r\n\r\n          if (this.slider.value < this.calculatedStep) {\r\n            const _increment = '_increment';\r\n            const _emitInputEvent = '_emitInputEvent';\r\n            this.slider[_increment](1);\r\n            this.slider[_emitInputEvent]();\r\n          } else {\r\n            this.stopFilter();\r\n          }\r\n        },\r\n        this.sliderInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  stopFilter() {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n  }\r\n\r\n  resetFilter(event: any) {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n    this.slider.value = 1;\r\n    const _increment = '_increment';\r\n    const _emitInputEvent = '_emitInputEvent';\r\n    this.slider[_emitInputEvent]();\r\n  }\r\n\r\n  handleSliderInput(matSliderChange) {\r\n    if (matSliderChange) {\r\n\r\n      if ( this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\r\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\r\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'year').toDate();\r\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\r\n        this.changeProperty.next({value: moment(dateBeginTmp).toDate().toISOString(),\r\n                                    pos: 1, refreshFilter: false});\r\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\r\n                                    pos: 2, refreshFilter: true});\r\n\r\n      } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\r\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\r\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'month').toDate();\r\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\r\n        this.changeProperty.next({value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\r\n                                    pos: 1, refreshFilter: false});\r\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\r\n                                    pos: 2, refreshFilter: true});\r\n\r\n      } else if ( this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\r\n          this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\r\n          this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\r\n            const dateTmp = new Date(this.beginMillisecond + (this.stepMillisecond * (matSliderChange.value - 1)));\r\n            this.changeProperty.next({value: dateTmp.toISOString(), pos: 1, refreshFilter: false});\r\n            this.changeProperty.next({value: new Date(this.ogcFilterTimeService.addStep(dateTmp.toISOString(),\r\n                                        this.stepMillisecond)).toISOString(),\r\n                                        pos: 2, refreshFilter: true});\r\n      }\r\n    }\r\n  }\r\n\r\n  calculateStep(){\r\n    for (let i = 1; (this.maxMillisecond - (this.beginMillisecond + (i * this.stepMillisecond))) >= -1; i++) {\r\n      this.calculatedStep = i;\r\n    }\r\n  }\r\n\r\n}\r\n","<div class=\"slider-container\">\r\n  <mat-slider\r\n    id=\"time-slider\"\r\n    [step]=\"1\"\r\n    [min]=\"1\"\r\n    [max]=\"calculatedStep\"\r\n    [(ngModel)]=\"sliderValue\"\r\n    [displayWith]=\"sliderDisplayWith\"\r\n    (input)=\"handleSliderInput($event)\"\r\n    thumbLabel\r\n    >\r\n  </mat-slider>\r\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\r\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\r\n  </button>\r\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\r\n    <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\r\n  </button>\r\n  \r\n</div>","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatOptionModule, MatNativeDateModule, MAT_DATE_LOCALE } from '@angular/material/core';\r\nimport { MatDatepickerModule } from '@angular/material/datepicker';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatSliderModule } from '@angular/material/slider';\r\nimport { MatTableModule } from '@angular/material/table';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatTreeModule } from '@angular/material/tree';\r\n\r\nimport {\r\n  MatDatetimepickerModule,\r\n  MatNativeDatetimeModule\r\n} from '@mat-datetimepicker/core';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoListModule,\r\n  IgoKeyValueModule\r\n} from '@igo2/common';\r\nimport { IgoGeometryModule } from './../geometry/geometry.module';\r\n\r\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\r\nimport { IgoLayerModule } from '../layer/layer.module';\r\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\r\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\r\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\r\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\r\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\r\nimport { TimeFilterService } from './shared/time-filter.service';\r\n\r\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\r\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\r\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\r\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\r\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\r\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\r\nimport { OGCFilterService } from './shared/ogc-filter.service';\r\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\r\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\r\n\r\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\r\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\r\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\r\nimport { SpatialFilterService } from './shared/spatial-filter.service';\r\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\r\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatAutocompleteModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTabsModule,\r\n    MatRadioModule,\r\n    MatMenuModule,\r\n    MatTableModule,\r\n    MatTreeModule,\r\n    MatButtonToggleModule,\r\n    MatCheckboxModule,\r\n    MatSliderModule,\r\n    MatSlideToggleModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    MatDatepickerModule,\r\n    MatNativeDateModule,\r\n    MatDatetimepickerModule,\r\n    MatNativeDatetimeModule,\r\n    IgoLanguageModule,\r\n    IgoLayerModule,\r\n    IgoCollapsibleModule,\r\n    IgoListModule,\r\n    IgoKeyValueModule,\r\n    IgoGeometryModule,\r\n    MatBadgeModule\r\n  ],\r\n  exports: [\r\n    FilterableDataSourcePipe,\r\n    TimeFilterButtonComponent,\r\n    TimeFilterFormComponent,\r\n    TimeFilterItemComponent,\r\n    TimeFilterListComponent,\r\n    TimeFilterListBindingDirective,\r\n    OgcFilterFormComponent,\r\n    OgcFilterButtonComponent,\r\n    OgcFilterSelectionComponent,\r\n    OgcFilterableFormComponent,\r\n    OgcFilterableItemComponent,\r\n    OgcFilterableListComponent,\r\n    OgcFilterableListBindingDirective,\r\n    SpatialFilterTypeComponent,\r\n    SpatialFilterListComponent,\r\n    SpatialFilterItemComponent,\r\n    OgcFilterTimeComponent,\r\n    OgcFilterTimeSliderComponent\r\n  ],\r\n  declarations: [\r\n    FilterableDataSourcePipe,\r\n    TimeFilterButtonComponent,\r\n    TimeFilterFormComponent,\r\n    TimeFilterItemComponent,\r\n    TimeFilterListComponent,\r\n    TimeFilterListBindingDirective,\r\n    OgcFilterFormComponent,\r\n    OgcFilterButtonComponent,\r\n    OgcFilterSelectionComponent,\r\n    OgcFilterableFormComponent,\r\n    OgcFilterableItemComponent,\r\n    OgcFilterableListComponent,\r\n    OgcFilterableListBindingDirective,\r\n    SpatialFilterTypeComponent,\r\n    SpatialFilterListComponent,\r\n    SpatialFilterItemComponent,\r\n    OgcFilterTimeComponent,\r\n    OgcFilterTimeSliderComponent\r\n  ],\r\n  providers: [TimeFilterService, OGCFilterService, OGCFilterTimeService, SpatialFilterService]\r\n})\r\nexport class IgoFilterModule {\r\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\r\n    return {\r\n      ngModule: IgoFilterModule,\r\n      providers: [\r\n        {\r\n          provide: MAT_DATE_LOCALE,\r\n          useValue: 'fr-FR'\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n","export class ExportError extends Error {}\r\n\r\nexport class ExportInvalidFileError extends ExportError {\r\n  constructor() {\r\n    super('Invalid file');\r\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ExportNothingToExportError extends ExportError {\r\n  constructor() {\r\n    super('Nothing to export');\r\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\r\n  }\r\n}\r\n","import { strEnum } from '@igo2/utils';\r\n\r\nexport const ExportFormat = strEnum(['URL', 'GeoJSON', 'GML', 'GPX', 'KML', 'Shapefile', 'CSVcomma', 'CSVsemicolon']);\r\nexport type ExportFormat = keyof typeof ExportFormat;\r\n\r\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\r\nexport type EncodingFormat = keyof typeof EncodingFormat;\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { ExportFormat, EncodingFormat } from './export.type';\r\n\r\nimport {\r\n  ExportInvalidFileError,\r\n  ExportNothingToExportError\r\n} from './export.errors';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ExportService {\r\n  static ogreFormats = {\r\n    GML: 'gml',\r\n    GPX: 'gpx',\r\n    KML: 'kml',\r\n    Shapefile: 'ESRI Shapefile',\r\n    CSVcomma: 'CSVcomma',\r\n    CSVsemicolon: 'CSVsemicolon'\r\n  };\r\n\r\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\r\n\r\n  private ogreUrl: string;\r\n  private aggregateInComment: boolean = true;\r\n\r\n  constructor(private config: ConfigService) {\r\n    this.ogreUrl = this.config.getConfig('importExport.url');\r\n    const gpxAggregateInComment = this.config.getConfig(\r\n      'importExport.gpxAggregateInComment'\r\n    );\r\n    if (gpxAggregateInComment !== undefined) {\r\n      this.aggregateInComment = gpxAggregateInComment;\r\n    }\r\n  }\r\n\r\n  export(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: ExportFormat,\r\n    title: string,\r\n    encoding: EncodingFormat,\r\n    projectionIn = 'EPSG:4326',\r\n    projectionOut = 'EPSG:4326'\r\n  ): Observable<void> {\r\n    const exportOlFeatures = this.generateFeature(olFeatures, format);\r\n\r\n    return this.exportAsync(exportOlFeatures, format, title, encoding, projectionIn, projectionOut);\r\n  }\r\n\r\n  private generateFeature(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: ExportFormat\r\n  ): OlFeature<OlGeometry>[] {\r\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\r\n      return this.generateAggregatedFeature(olFeatures);\r\n    }\r\n\r\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      const keys = olFeature\r\n        .getKeys()\r\n        .filter((key: string) => !key.startsWith('_'));\r\n      const properties = keys.reduce(\r\n        (acc: object, key: string) => {\r\n          acc[key] = olFeature.get(key);\r\n          return acc;\r\n        },\r\n        { geometry: olFeature.getGeometry() }\r\n      );\r\n      return new OlFeature(properties);\r\n    });\r\n  }\r\n\r\n  private generateAggregatedFeature(olFeatures: OlFeature<OlGeometry>[]): OlFeature<OlGeometry>[] {\r\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      const keys = olFeature.getKeys().filter((key: string) => !key.startsWith('_'));\r\n      let comment: string = '';\r\n      const properties = keys.reduce((acc: object, key: string) => {\r\n        if (key && key !== 'geometry') {\r\n          key === 'id' && olFeature.get('draw') ? comment += key + ':' + olFeature.get('draw') + '   \\r\\n'\r\n          : comment += key + ':' + olFeature.get(key) + '   \\r\\n';\r\n        }\r\n        acc[key] = olFeature.get(key);\r\n        return acc;\r\n      },\r\n      {\r\n        geometry: olFeature.getGeometry()\r\n      });\r\n      const newFeature = new OlFeature(properties);\r\n      newFeature.set('name', olFeature.getId());\r\n      newFeature.set('cmt', comment);\r\n\r\n      return newFeature;\r\n    });\r\n  }\r\n\r\n  private exportAsync(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: ExportFormat,\r\n    title: string,\r\n    encoding: EncodingFormat,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Observable<void> {\r\n    const doExport = (observer: Observer<void>) => {\r\n      const nothingToExport = this.nothingToExport(olFeatures, format);\r\n      if (nothingToExport) {\r\n        observer.error(new ExportNothingToExportError());\r\n        return;\r\n      }\r\n\r\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n      if (ogreFormats.indexOf(format) >= 0) {\r\n        if (!this.ogreUrl) {\r\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\r\n            this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\r\n          } else {\r\n            observer.error(new ExportInvalidFileError());\r\n          }\r\n          return;\r\n        }\r\n        this.exportWithOgre(olFeatures, observer, format, title, encoding, projectionIn, projectionOut);\r\n      } else {\r\n        this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\r\n      }\r\n    };\r\n\r\n    return new Observable(doExport);\r\n  }\r\n\r\n  protected exportToFile(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    observer: Observer<void>,\r\n    format: ExportFormat,\r\n    title: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const olFormat = new olformat[format]();\r\n    const featuresText = olFormat.writeFeatures(olFeatures, {\r\n      dataProjection: projectionOut,\r\n      featureProjection: projectionIn,\r\n      featureType: 'feature',\r\n      featureNS: 'http://example.com/feature'\r\n    });\r\n\r\n    const fileName = `${title}.${format.toLowerCase()}`;\r\n\r\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\r\n    observer.complete();\r\n  }\r\n\r\n  private exportWithOgre(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    observer: Observer<void>,\r\n    format: string,\r\n    title: string,\r\n    encodingType: EncodingFormat,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const featuresText: string = new olformat.GeoJSON().writeFeatures(\r\n      olFeatures,\r\n      {\r\n        dataProjection: projectionOut,\r\n        featureProjection: projectionIn\r\n      }\r\n    );\r\n\r\n    const url = `${this.ogreUrl}/convertJson`;\r\n    const form = document.createElement('form');\r\n    form.style.display = 'none';\r\n    document.body.appendChild(form);\r\n    form.setAttribute('method', 'post');\r\n    form.setAttribute('target', '_blank');\r\n    form.setAttribute('action', url);\r\n\r\n    if (encodingType === EncodingFormat.UTF8) {\r\n      form.acceptCharset = 'UTF-8';\r\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\r\n    } else if (encodingType === EncodingFormat.LATIN1) {\r\n      const enctype = 'ISO-8859-1';\r\n      const encoding = document.createElement('input');\r\n      encoding.setAttribute('type', 'hidden');\r\n      encoding.setAttribute('name', 'encoding');\r\n      encoding.setAttribute('value', enctype);\r\n      form.appendChild(encoding);\r\n    }\r\n\r\n    if (format === 'CSVsemicolon') {\r\n      const options = document.createElement('input');\r\n      options.setAttribute('type', 'hidden');\r\n      options.setAttribute('name', 'lco');\r\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\r\n      form.appendChild(options);\r\n    }\r\n\r\n    const geojsonField = document.createElement('input');\r\n    geojsonField.setAttribute('type', 'hidden');\r\n    geojsonField.setAttribute('name', 'json');\r\n    geojsonField.setAttribute('value', featuresText);\r\n    form.appendChild(geojsonField);\r\n\r\n    const outputNameField = document.createElement('input');\r\n    let outputName = format === 'Shapefile' ? `${title}.zip` : `${title}.${format.toLowerCase()}`;\r\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\r\n      outputName = `${title}.csv`;\r\n    }\r\n    outputName = outputName.replace(' ', '_');\r\n    outputName = outputName.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n    outputNameField.setAttribute('type', 'hidden');\r\n    outputNameField.setAttribute('name', 'outputName');\r\n    outputNameField.setAttribute('value', outputName);\r\n    form.appendChild(outputNameField);\r\n\r\n    let ogreFormat = ExportService.ogreFormats[format];\r\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\r\n      ogreFormat = 'CSV';\r\n    }\r\n    const outputFormatField = document.createElement('input');\r\n    outputFormatField.setAttribute('type', 'hidden');\r\n    outputFormatField.setAttribute('name', 'format');\r\n    outputFormatField.setAttribute('value', ogreFormat);\r\n    form.appendChild(outputFormatField);\r\n\r\n    form.submit();\r\n    document.body.removeChild(form);\r\n\r\n    observer.complete();\r\n  }\r\n\r\n  private nothingToExport(olFeatures: OlFeature<OlGeometry>[], format: string): boolean {\r\n    if (olFeatures.length === 0) {\r\n      return true;\r\n    }\r\n    if (format === 'GPX') {\r\n      const pointOrLine = olFeatures.find(olFeature => {\r\n        return (\r\n          ['Point', 'LineString', 'MultiLineString'].indexOf(olFeature.getGeometry().getType()) >= 0\r\n        );\r\n      });\r\n      return pointOrLine === undefined;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","/**\r\n * Trigger download of a file\r\n *\r\n * @param content File content\r\n * @param mimeType File mime type\r\n * @param fileName File name\r\n */\r\nexport function downloadContent(content: string, mimeType: string, fileName: string) {\r\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\r\n  downloadFromUri(uri, fileName);\r\n}\r\n\r\n/**\r\n * Trigger download of a file\r\n *\r\n * @param content File content\r\n * @param mimeType File mime type\r\n * @param fileName File name\r\n */\r\nexport function downloadFromUri(uri: string, fileName: string) {\r\n  const element = document.createElement('a');\r\n  element.setAttribute('href', uri);\r\n  element.setAttribute('download', fileName);\r\n  element.style.display = 'none';\r\n  document.body.appendChild(element);\r\n\r\n  element.click();\r\n\r\n  document.body.removeChild(element);\r\n}\r\n","import * as olStyle from 'ol/style';\r\n\r\nimport { MessageService, LanguageService, ConfigService } from '@igo2/core';\r\n\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport {\r\n  featureToOl,\r\n  moveToOlFeatures\r\n} from '../../feature/shared/feature.utils';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport { StyleService } from '../../layer/shared/style.service';\r\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\r\nimport { StyleListService } from '../style-list/style-list.service';\r\nimport { ClusterParam } from '../../layer/shared/clusterParam';\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\r\n\r\nexport function addLayerAndFeaturesToMap(\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  layerTitle: string\r\n): VectorLayer {\r\n  const olFeatures = features.map((feature: Feature) =>\r\n    featureToOl(feature, map.projection)\r\n  );\r\n\r\n  const r = Math.floor(Math.random() * 255);\r\n  const g = Math.floor(Math.random() * 255);\r\n  const b = Math.floor(Math.random() * 255);\r\n  const stroke = new olStyle.Stroke({\r\n    color: [r, g, b, 1],\r\n    width: 2\r\n  });\r\n\r\n  const fill = new olStyle.Fill({\r\n    color: [r, g, b, 0.4]\r\n  });\r\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n    type: 'vector',\r\n    queryable: true\r\n  };\r\n  const source = new FeatureDataSource(sourceOptions);\r\n  source.ol.addFeatures(olFeatures);\r\n  const layer = new VectorLayer({\r\n    title: layerTitle,\r\n    source,\r\n    style: new olStyle.Style({\r\n      stroke,\r\n      fill,\r\n      image: new olStyle.Circle({\r\n        radius: 5,\r\n        stroke,\r\n        fill\r\n      })\r\n    })\r\n  });\r\n  map.addLayer(layer);\r\n  moveToOlFeatures(map, olFeatures);\r\n\r\n  return layer;\r\n}\r\n\r\nexport function addLayerAndFeaturesStyledToMap(\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  layerTitle: string,\r\n  styleListService: StyleListService,\r\n  styleService: StyleService\r\n): VectorLayer {\r\n  const olFeatures = features.map((feature: Feature) =>\r\n    featureToOl(feature, map.projection)\r\n  );\r\n  let style;\r\n  let distance: number;\r\n\r\n  if (\r\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\r\n  ) {\r\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\r\n      layerTitle.toString() + '.styleByAttribute'\r\n    );\r\n\r\n    style = feature => {\r\n      return styleService.createStyleByAttribute(feature, styleByAttribute);\r\n    };\r\n  } else if (\r\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\r\n  ) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(\r\n      layerTitle.toString() + '.clusterParam'\r\n    );\r\n    distance = styleListService.getStyleList(\r\n      layerTitle.toString() + '.distance'\r\n    );\r\n\r\n    const baseStyle = styleService.createStyle(\r\n      styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\r\n    );\r\n\r\n    style = feature => {\r\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\r\n    };\r\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\r\n    style = styleService.createStyle(\r\n      styleListService.getStyleList(layerTitle.toString() + '.style')\r\n    );\r\n  } else if (\r\n    styleListService.getStyleList('default.clusterStyle') &&\r\n    features[0].geometry.type === 'Point'\r\n  ) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(\r\n      'default.clusterParam'\r\n    );\r\n    distance = styleListService.getStyleList('default.distance');\r\n\r\n    const baseStyle = styleService.createStyle(\r\n      styleListService.getStyleList('default.clusterStyle')\r\n    );\r\n\r\n    style = feature => {\r\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\r\n    };\r\n  } else {\r\n    style = styleService.createStyle(\r\n      styleListService.getStyleList('default.style')\r\n    );\r\n  }\r\n\r\n  let source;\r\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\r\n    const sourceOptions: ClusterDataSourceOptions &\r\n      QueryableDataSourceOptions = {\r\n      distance,\r\n      type: 'cluster',\r\n      queryable: true\r\n    };\r\n    source = new ClusterDataSource(sourceOptions);\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n      type: 'vector',\r\n      queryable: true\r\n    };\r\n    source = new FeatureDataSource(sourceOptions);\r\n    source.ol.addFeatures(olFeatures);\r\n  } else if (\r\n    styleListService.getStyleList('default.clusterStyle') &&\r\n    features[0].geometry.type === 'Point'\r\n  ) {\r\n    const sourceOptions: ClusterDataSourceOptions &\r\n      QueryableDataSourceOptions = {\r\n      distance,\r\n      type: 'cluster',\r\n      queryable: true\r\n    };\r\n    source = new ClusterDataSource(sourceOptions);\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n      type: 'vector',\r\n      queryable: true\r\n    };\r\n    source = new FeatureDataSource(sourceOptions);\r\n    source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  const layer = new VectorLayer({\r\n    title: layerTitle,\r\n    source,\r\n    style\r\n  });\r\n  map.addLayer(layer);\r\n  moveToOlFeatures(map, olFeatures);\r\n\r\n  return layer;\r\n}\r\n\r\nexport function handleFileImportSuccess(\r\n  file: File,\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  messageService: MessageService,\r\n  languageService: LanguageService,\r\n  styleListService?: StyleListService,\r\n  styleService?: StyleService\r\n) {\r\n  if (features.length === 0) {\r\n    handleNothingToImportError(file, messageService, languageService);\r\n    return;\r\n  }\r\n\r\n  const layerTitle = computeLayerTitleFromFile(file);\r\n\r\n  if (!styleListService) {\r\n    addLayerAndFeaturesToMap(features, map, layerTitle);\r\n  } else {\r\n    addLayerAndFeaturesStyledToMap(\r\n      features,\r\n      map,\r\n      layerTitle,\r\n      styleListService,\r\n      styleService\r\n    );\r\n  }\r\n\r\n  const translate = languageService.translate;\r\n  const messageTitle = translate.instant('igo.geo.dropGeoFile.success.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.success.text', {\r\n    value: layerTitle\r\n  });\r\n  messageService.success(message, messageTitle);\r\n}\r\n\r\nexport function handleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService,\r\n  sizeMb?: number\r\n) {\r\n  sizeMb = sizeMb ? sizeMb : 30;\r\n  const errMapping = {\r\n    'Invalid file': handleInvalidFileImportError,\r\n    'File is too large': handleSizeFileImportError,\r\n    'Failed to read file': handleUnreadbleFileImportError,\r\n    'Invalid SRS definition': handleSRSImportError,\r\n    'Error 500 with OGRE': handleOgreServerImportError\r\n  };\r\n  errMapping[error.message](\r\n    file,\r\n    error,\r\n    messageService,\r\n    languageService,\r\n    sizeMb\r\n  );\r\n}\r\n\r\nexport function handleInvalidFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.invalid.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.invalid.text', {\r\n    value: file.name,\r\n    mimeType: file.type\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleUnreadbleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.unreadable.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.unreadable.text', {\r\n    value: file.name\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleSizeFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService,\r\n  sizeMb: number\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.tooLarge.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.tooLarge.text', {\r\n    value: file.name,\r\n    size: sizeMb\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleNothingToImportError(\r\n  file: File,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.empty.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.empty.text', {\r\n    value: file.name,\r\n    mimeType: file.type\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleSRSImportError(\r\n  file: File,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.invalidSRS.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.invalidSRS.text', {\r\n    value: file.name,\r\n    mimeType: file.type\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleOgreServerImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const title = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.title');\r\n  const message = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.text');\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function getFileExtension(file: File): string {\r\n  return file.name\r\n    .split('.')\r\n    .pop()\r\n    .toLowerCase();\r\n}\r\n\r\nexport function computeLayerTitleFromFile(file: File): string {\r\n  return file.name.substr(0, file.name.lastIndexOf('.'));\r\n}\r\n","export class ImportError extends Error {}\r\n\r\nexport class ImportInvalidFileError extends ImportError {\r\n  constructor() {\r\n    super('Invalid file');\r\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportUnreadableFileError extends ImportError {\r\n  constructor() {\r\n      super('Failed to read file');\r\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportNothingToImportError extends ImportError {\r\n  constructor() {\r\n      super('Nothing to import');\r\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSizeError extends ImportError {\r\n  constructor() {\r\n      super('File is too large');\r\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSRSError extends ImportError {\r\n  constructor() {\r\n      super('Invalid SRS definition');\r\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportOgreServerError extends ImportError {\r\n  constructor() {\r\n      super('Error 500 with OGRE');\r\n      Object.setPrototypeOf(this, ImportOgreServerError.prototype);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport {\r\n  ImportInvalidFileError,\r\n  ImportUnreadableFileError,\r\n  ImportSizeError,\r\n  ImportSRSError,\r\n  ImportOgreServerError\r\n} from './import.errors';\r\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ImportService {\r\n  static allowedMimeTypes = [\r\n    'application/gml+xml',\r\n    'application/vnd.google-earth.kml+xml',\r\n    'application/gpx+xml',\r\n    'application/json'\r\n  ];\r\n\r\n  static allowedZipMimeTypes = [\r\n    'application/zip',\r\n    'application/x-zip-compressed',\r\n    'application/x-zip'\r\n  ];\r\n\r\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml'];\r\n\r\n  private ogreUrl: string;\r\n  private clientSideFileSizeMax: number;\r\n\r\n  constructor(private http: HttpClient, private config: ConfigService) {\r\n    this.ogreUrl = this.config.getConfig('importExport.url');\r\n    const configFileSizeMb = this.config.getConfig('importExport.clientSideFileSizeMaxMb');\r\n    this.clientSideFileSizeMax = (configFileSizeMb ? configFileSizeMb : 30) *  Math.pow(1024, 2);\r\n  }\r\n\r\n  import(\r\n    file: File,\r\n    projectionIn = 'EPSG:4326',\r\n    projectionOut = 'EPSG:4326'\r\n  ): Observable<Feature[]> {\r\n    return this.importAsync(file, projectionIn, projectionOut);\r\n  }\r\n\r\n  private getFileImporter(\r\n    file: File\r\n  ): (\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) => void {\r\n    const extension = getFileExtension(file);\r\n    const mimeType = file.type;\r\n    const allowedMimeTypes = [\r\n      ...ImportService.allowedMimeTypes,\r\n      ...ImportService.allowedZipMimeTypes\r\n    ];\r\n    const allowedExtensions = ImportService.allowedExtensions;\r\n\r\n    if (\r\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\r\n      allowedExtensions.indexOf(extension) < 0\r\n    ) {\r\n      return undefined;\r\n    } else if (\r\n      mimeType === 'application/json' ||\r\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\r\n    ) {\r\n      return this.importFile;\r\n    } else if (this.ogreUrl !== undefined) {\r\n      return this.importFileWithOgre;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  private importAsync(\r\n    file: File,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Observable<Feature[]> {\r\n    const doImport = (observer: Observer<Feature[]>) => {\r\n      if (file.size >= this.clientSideFileSizeMax) {\r\n        observer.error(new ImportSizeError());\r\n        return;\r\n      }\r\n      const importer = this.getFileImporter(file);\r\n      if (importer === undefined) {\r\n        observer.error(new ImportInvalidFileError());\r\n        return;\r\n      }\r\n\r\n      importer.call(this, file, observer, projectionIn, projectionOut);\r\n    };\r\n\r\n    return new Observable(doImport);\r\n  }\r\n\r\n  private importFile(\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = (event: any) => {\r\n      try {\r\n        const features = this.parseFeaturesFromFile(\r\n          file,\r\n          event.target.result,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n        observer.next(features);\r\n      } catch (e) {\r\n        observer.error(new ImportUnreadableFileError());\r\n      }\r\n\r\n      observer.complete();\r\n    };\r\n\r\n    reader.onerror = evt => {\r\n      observer.error(new ImportUnreadableFileError());\r\n    };\r\n\r\n    reader.readAsText(file, 'UTF-8');\r\n  }\r\n\r\n  private importFileWithOgre(\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const url = `${this.ogreUrl}/convert`;\r\n    const formData = new FormData();\r\n    formData.append('upload', file);\r\n    formData.append('sourceSrs', projectionIn);\r\n    formData.append('targetSrs', projectionOut);\r\n    formData.append('formatOutput', 'GEOJSON');\r\n    formData.append('skipFailures', '');\r\n\r\n    this.http.post(url, formData, { headers: new HttpHeaders() })\r\n    .subscribe(\r\n      (response: { errors?: string[] } | object | null) => {\r\n        if (response === null) {\r\n          observer.error(new ImportUnreadableFileError());\r\n          return;\r\n        }\r\n\r\n        const errors = (response as any).errors || [];\r\n        if (errors.length > 0) {\r\n          observer.error(new ImportUnreadableFileError());\r\n        } else {\r\n          const features = this.parseFeaturesFromGeoJSON(\r\n            file,\r\n            response,\r\n            projectionOut\r\n          );\r\n          observer.next(features);\r\n          observer.complete();\r\n        }\r\n      },\r\n      (error: any) => {\r\n        error.error.caught = true;\r\n        const errMsg = error.error.msg || '';\r\n        if (errMsg === 'No valid files found') {\r\n          observer.error(new ImportInvalidFileError());\r\n        } else if (errMsg && errMsg.startWith('ERROR 1: Failed to process SRS definition')\r\n        ) {\r\n          observer.error(new ImportSRSError());\r\n        } else if (error.status === 500) {\r\n          observer.error(new ImportOgreServerError());\r\n        } else {\r\n          observer.error(new ImportUnreadableFileError());\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  private parseFeaturesFromFile(\r\n    file: File,\r\n    data: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Feature[] {\r\n    const extension = getFileExtension(file);\r\n    const mimeType = file.type;\r\n\r\n    const GeoJSON = new olformat.GeoJSON();\r\n\r\n    let format;\r\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\r\n      format = new olformat.KML();\r\n    } else if (mimeType === 'application/gml+xml') {\r\n      format = new olformat.GML();\r\n    } else if (mimeType === 'application/gpx+xml') {\r\n      format = new olformat.GPX();\r\n    } else {\r\n      switch (extension) {\r\n        case 'kml':\r\n          format = new olformat.KML();\r\n          break;\r\n        case 'gpx':\r\n          format = new olformat.GPX();\r\n          break;\r\n        case 'gml':\r\n          format = new olformat.GML();\r\n          break;\r\n        default:\r\n          format = GeoJSON;\r\n          break;\r\n      }\r\n    }\r\n\r\n    const olFeatures = format.readFeatures(data, {\r\n      dataProjection: projectionIn,\r\n      featureProjection: projectionOut\r\n    });\r\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\r\n        projection: projectionOut,\r\n        meta: {\r\n          id: uuid(),\r\n          title: computeLayerTitleFromFile(file)\r\n        }\r\n      });\r\n    });\r\n\r\n    return features;\r\n  }\r\n\r\n  private parseFeaturesFromGeoJSON(\r\n    file: File,\r\n    data: object,\r\n    projectionOut: string\r\n  ): Feature[] {\r\n    const olFormat = new olformat.GeoJSON();\r\n    const olFeatures = olFormat.readFeatures(data);\r\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\r\n        projection: projectionOut,\r\n        meta: {\r\n          id: uuid(),\r\n          title: computeLayerTitleFromFile(file)\r\n        }\r\n      });\r\n    });\r\n\r\n    return features as Feature[];\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { StyleListOptions } from './style-list.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StyleListService {\r\n  private styleList: object = {};\r\n\r\n  constructor(private injector: Injector) {}\r\n\r\n  /**\r\n   * Use to get the data found in styleList file\r\n   */\r\n  public getStyleList(key: string): any {\r\n    return ObjectUtils.resolve(this.styleList, key);\r\n  }\r\n\r\n  /**\r\n   * This method loads \"[path]\" to get all styleList's variables\r\n   */\r\n  public load(options: StyleListOptions) {\r\n    const baseStyleList = options.default || {};\r\n    if (!options.path) {\r\n      this.styleList = baseStyleList;\r\n      return true;\r\n    }\r\n\r\n    const http = this.injector.get(HttpClient);\r\n\r\n    return new Promise((resolve, _reject) => {\r\n      http\r\n        .get(options.path)\r\n        .pipe(\r\n          catchError((error: any): any => {\r\n            console.log(`StyleList file ${options.path} could not be read`);\r\n            resolve(true);\r\n            return throwError(error.error || 'Server error');\r\n          })\r\n        )\r\n        .subscribe((styleListResponse: object) => {\r\n          this.styleList = ObjectUtils.mergeDeep(baseStyleList, styleListResponse);\r\n          resolve(true);\r\n        });\r\n    });\r\n  }\r\n}\r\n","<div class=\"import-export-toggle mat-typography\">\r\n  <mat-button-toggle-group\r\n        [value]=\"selectedMode\"\r\n        (change)=\"onImportExportChange($event)\">\r\n        <mat-button-toggle [value]=\"'import'\">\r\n          {{'igo.geo.importExportForm.importTabTitle' | translate}}\r\n        </mat-button-toggle>\r\n        <mat-button-toggle [value]=\"'export'\">\r\n          {{'igo.geo.importExportForm.exportTabTitle' | translate}}\r\n        </mat-button-toggle>\r\n  </mat-button-toggle-group>\r\n</div>\r\n\r\n<form class=\"igo-form\" [formGroup]=\"importForm\" *ngIf=\"selectedMode === 'import'\">\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{'igo.geo.importExportForm.importProjPlaceholder' | translate}}</mat-label>\r\n      <mat-select\r\n        [(value)]=\"inputProj\">\r\n        <mat-option\r\n          *ngFor=\"let projection of (projections$ | async)\"\r\n          [value]=\"projection\"\r\n          (click)=\"$event.stopPropagation()\">\r\n          <p mat-line *ngIf=\"projection.translateKey\">{{('igo.geo.importExportForm.projections.' + projection.translateKey) | translate: projection}}</p>\r\n          <p mat-line *ngIf=\"!projection.translateKey\">{{projection.alias}}</p>\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"importForm.invalid ? ('igo.geo.importExportForm.projections.choose' | translate) : ('igo.geo.importExportForm.importButton' | translate)\"\r\n    class=\"igo-form-button-group\">\r\n    <button\r\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\r\n      mat-raised-button\r\n      type=\"button\"\r\n      (click)=\"fileInput.click()\">\r\n        {{'igo.geo.importExportForm.importButton' | translate}}\r\n    </button>\r\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\r\n    <input\r\n      hidden\r\n      #fileInput\r\n      type=\"file\"\r\n      [style.display]=\"'none'\"\r\n      (click)=\"fileInput.value = null\"\r\n      (change)=\"importFiles($event.target.files)\">\r\n  </div>\r\n</form>\r\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\r\n  <h4>{{'igo.geo.importExportForm.importClarifications' | translate}}</h4>\r\n  <ul>\r\n    <li>{{'igo.geo.importExportForm.importSizeMax' | translate: {size: fileSizeMb} }}</li>\r\n    <li>{{'igo.geo.importExportForm.importFormatAuthorized' | translate}}</li>\r\n    <li>{{'igo.geo.importExportForm.importShpZip' | translate}}</li>\r\n  </ul>\r\n</section>\r\n\r\n<section class=\"mat-typography\" *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\">\r\n  <h4>{{'igo.geo.importExportForm.exportNoLayersExportable' | translate}}</h4>\r\n</section>\r\n\r\n<form class=\"igo-form\" [formGroup]=\"form\" *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\">\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{'igo.geo.importExportForm.exportLayerPlaceholder' | translate}}</mat-label>\r\n      <mat-select\r\n        [(value)]=\"layers\" multiple>\r\n        <mat-select-trigger>\r\n          {{layers.length ? getLayerTitleById(layers[0]) : ''}}\r\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\r\n            (+{{layers.length - 1}} {{(layers?.length === 2 ? 'igo.geo.importExportForm.other' : 'igo.geo.importExportForm.others') | translate }})\r\n          </span>\r\n        </mat-select-trigger>\r\n        <mat-option\r\n          *ngFor=\"let layer of (exportableLayers$ | async)\"\r\n          [ngClass]=\"{'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)}\"\r\n          [value]=\"layer.id\"\r\n          (click)=\"$event.stopPropagation()\">\r\n          <p mat-line>{{layer.title}}</p>\r\n          <p mat-line>\r\n            <mat-slide-toggle *ngIf=\"layerHasSelectedFeatures(layer)\"\r\n              [labelPosition]=\"'after'\"\r\n              (click)=\"onlySelectedClick($event,layer.id)\"\r\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\r\n              (change)=\"onlySelected($event,layer.id)\">\r\n              <small>{{'igo.geo.importExportForm.exportSelectedFeature' | translate}}</small>\r\n            </mat-slide-toggle>\r\n          </p>\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{'igo.geo.importExportForm.exportFormatPlaceholder' | translate}}</mat-label>\r\n      <mat-select\r\n        formControlName=\"format\">\r\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\r\n          <mat-option *ngFor=\"let format of (formats$ | async) | keyvalue\" [value]=\"format.key\">\r\n            {{'igo.geo.export.format.' + format.value | translate}}\r\n          </mat-option>\r\n        </ng-container>\r\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\r\n          {{'igo.geo.export.noFormat.title' | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\" *ngIf=\"forceNaming && form.value.format !== 'URL'\">\r\n    <mat-form-field>\r\n        <input matInput formControlName=\"name\" placeholder=\"{{'igo.geo.importExportForm.exportFileNamePlaceholder' | translate}}\">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\" *ngIf=\"form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\">\r\n    <mat-form-field>\r\n      <mat-label>{{'igo.geo.importExportForm.encodingPlaceholder' | translate}}</mat-label>\r\n      <mat-select\r\n        formControlName=\"encoding\">\r\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\r\n          <mat-option *ngFor=\"let encoding of (encodings$ | async) | keyvalue\" [value]=\"encoding.key\">\r\n            {{'igo.geo.export.encoding.' + encoding.value | translate}}\r\n          </mat-option>\r\n        </ng-container>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"export-options mat-typography\" *ngIf=\"form.value.format !== 'URL'\">\r\n    <mat-slide-toggle\r\n        formControlName=\"featureInMapExtent\"\r\n        [labelPosition]=\"'before'\">\r\n          {{'igo.geo.importExportForm.exportFeatureInExtent' | translate}}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <div class=\"igo-form-button-group\">\r\n    <button\r\n      mat-raised-button\r\n      type=\"button\"\r\n      [disabled]=\"!form.valid || (loading$ | async)\"\r\n      (click)=\"handleExportFormSubmit(form.value)\">\r\n      {{form.value.format !== 'URL'  ? ('igo.geo.importExportForm.exportButton' | translate): (form.value.layers.length > 1  ? ('igo.geo.importExportForm.exportButtonLinks' | translate): ('igo.geo.importExportForm.exportButtonLink' | translate))}}\r\n    </button>\r\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\r\n  </div>\r\n\r\n</form>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport {\r\n  MessageService,\r\n  LanguageService,\r\n  ConfigService,\r\n  StorageService\r\n} from '@igo2/core';\r\nimport { strEnum } from '@igo2/utils';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\r\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\r\nimport olPoint from 'ol/geom/Point';\r\nimport { circular } from 'ol/geom/Polygon';\r\n\r\nimport {\r\n  handleFileExportError,\r\n  handleFileExportSuccess\r\n} from '../shared/export.utils';\r\nimport { ExportOptions } from '../shared/export.interface';\r\nimport { ExportFormat, EncodingFormat } from '../shared/export.type';\r\nimport { ExportService } from '../shared/export.service';\r\nimport { ImportService } from '../shared/import.service';\r\nimport {\r\n  handleFileImportSuccess,\r\n  handleFileImportError\r\n} from '../shared/import.utils';\r\nimport { StyleService } from '../../layer/shared/style.service';\r\nimport { StyleListService } from '../style-list/style-list.service';\r\nimport { skipWhile } from 'rxjs/operators';\r\nimport { EntityRecord, Workspace } from '@igo2/common';\r\nimport type { WorkspaceStore } from '@igo2/common';\r\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\r\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\r\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\r\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\r\nimport { DownloadService } from '../../download/shared/download.service';\r\nimport { computeProjectionsConstraints } from '../../map';\r\n\r\nimport olVectorSource from 'ol/source/Vector';\r\nimport olClusterSource from 'ol/source/Cluster';\r\nimport olVectorTileSource from 'ol/source/VectorTile';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\n@Component({\r\n  selector: 'igo-import-export',\r\n  templateUrl: './import-export.component.html',\r\n  styleUrls: ['./import-export.component.scss']\r\n})\r\nexport class ImportExportComponent implements OnDestroy, OnInit {\r\n  public form: FormGroup;\r\n  public importForm: FormGroup;\r\n  public formats$ = new BehaviorSubject(undefined);\r\n  public encodings$ = new BehaviorSubject(undefined);\r\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\r\n    []\r\n  );\r\n  public loading$ = new BehaviorSubject(false);\r\n  public forceNaming = false;\r\n  public controlFormat = 'format';\r\n\r\n  private layers$$: Subscription;\r\n  private exportableLayers$$: Subscription;\r\n  private formats$$: Subscription;\r\n  private encodings$$: Subscription;\r\n  private formLayer$$: Subscription;\r\n  private exportOptions$$: Subscription;\r\n\r\n\r\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\r\n  private clientSideFileSizeMax: number;\r\n  public fileSizeMb: number;\r\n\r\n  public projections$: BehaviorSubject<InputProjections[]> = new BehaviorSubject([]);\r\n  private projectionsConstraints: ProjectionsLimitationsOptions;\r\n\r\n  public popupChecked: boolean = false;\r\n\r\n  private previousLayerSpecs$: BehaviorSubject<\r\n    {\r\n      id: string;\r\n      visible: boolean;\r\n      opacity: number;\r\n      queryable: boolean;\r\n    }[]\r\n  > = new BehaviorSubject(undefined);\r\n\r\n  @Input() selectFirstProj: boolean = false;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\r\n  @Input()\r\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\r\n    this._projectionsLimitations = value;\r\n    this.computeProjections();\r\n  }\r\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\r\n    return this._projectionsLimitations || {};\r\n  }\r\n\r\n  /**\r\n   * Store that holds the available workspaces.\r\n   */\r\n  @Input() store: WorkspaceStore;\r\n\r\n  @Input() selectedMode = 'import';\r\n\r\n  @Output() selectMode = new EventEmitter<string>();\r\n\r\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\r\n\r\n  get layers() {\r\n    return this.form.get('layers').value;\r\n  }\r\n  set layers(value) {\r\n    this.form.patchValue({ layers: value });\r\n  }\r\n\r\n  get inputProj() {\r\n    return this.importForm.get('inputProj').value;\r\n  }\r\n  set inputProj(value) {\r\n    this.importForm.patchValue({ inputProj: value });\r\n  }\r\n\r\n  get popupAllowed(): boolean {\r\n    return this.storageService.get('importExportPopupAllowed') as boolean || false;\r\n  }\r\n\r\n  set popupAllowed(value: boolean) {\r\n    this.storageService.set('importExportPopupAllowed', value);\r\n  }\r\n\r\n  constructor(\r\n    private importService: ImportService,\r\n    private exportService: ExportService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private styleListService: StyleListService,\r\n    private styleService: StyleService,\r\n    private formBuilder: FormBuilder,\r\n    private config: ConfigService,\r\n    private cdRef: ChangeDetectorRef,\r\n    private storageService: StorageService,\r\n    private downloadService: DownloadService\r\n  ) {\r\n    this.loadConfig();\r\n    this.buildForm();\r\n    this.computeProjections();\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\r\n      this.exportableLayers$.next(\r\n        layers.filter((layer: Layer) => {\r\n          return (\r\n            (layer instanceof VectorLayer && layer.exportable === true) ||\r\n            (layer.dataSource.options.download &&\r\n              layer.dataSource.options.download.url)\r\n          );\r\n        }) as AnyLayer[]\r\n      );\r\n    });\r\n    const configFileSizeMb = this.config.getConfig(\r\n      'importExport.clientSideFileSizeMaxMb'\r\n    );\r\n    this.clientSideFileSizeMax =\r\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\r\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\r\n\r\n    this.exportOptions$$ = this.exportOptions$\r\n      .pipe(skipWhile((exportOptions) => !exportOptions))\r\n      .subscribe((exportOptions) => {\r\n        this.form.patchValue(exportOptions, { emitEvent: true });\r\n        if (exportOptions.layers) {\r\n          this.computeFormats(\r\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\r\n          );\r\n        }\r\n      });\r\n    this.formLayer$$ = this.form\r\n      .get('format')\r\n      .valueChanges\r\n      .subscribe((format) => {\r\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n        if (\r\n          !this.popupChecked &&\r\n          this.form.get('layers').value?.length > 1 &&\r\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)) {\r\n          if (!this.handlePopup(true)) {\r\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\r\n          }\r\n        }\r\n      });\r\n\r\n    this.formLayer$$ = this.form\r\n      .get('layers')\r\n      .valueChanges.subscribe((layersId) => {\r\n        this.handlePreviousLayerSpecs();\r\n        const selectedLayers = layersId instanceof Array ? layersId : [layersId];\r\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\r\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\r\n        this.computeFormats(layers);\r\n\r\n        if (\r\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\r\n          -1\r\n        ) {\r\n          this.form.patchValue({ format: undefined });\r\n        }\r\n\r\n        this.loading$.next(true);\r\n        const previousSpecs: {\r\n          id: string;\r\n          visible: boolean;\r\n          opacity: number;\r\n          queryable: boolean;\r\n        }[] = [];\r\n        layers.forEach((layer) => {\r\n          if (\r\n            layer instanceof VectorLayer &&\r\n            layer.dataSource.ol.getFeatures().length === 0\r\n          ) {\r\n            previousSpecs.push({\r\n              id: layer.id,\r\n              visible: layer.visible,\r\n              opacity: layer.opacity,\r\n              queryable: (layer as any).queryable\r\n            });\r\n            layer.opacity = 0;\r\n            layer.visible = true;\r\n          }\r\n        });\r\n\r\n        this.previousLayerSpecs$.next(previousSpecs);\r\n        setTimeout(() => {\r\n          this.loading$.next(false);\r\n        }, 500);\r\n      });\r\n\r\n    this.formats$$ = this.formats$\r\n      .pipe(skipWhile((formats) => !formats))\r\n      .subscribe((formats) => {\r\n        if (Object.keys(formats).length === 1) {\r\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\r\n        }\r\n      });\r\n\r\n    this.encodings$$ = this.encodings$\r\n      .pipe(skipWhile((encodings) => !encodings))\r\n      .subscribe((encodings) => {\r\n        if (Object.keys(encodings).length === 1) {\r\n          this.form.patchValue({ encoding: encodings[Object.keys(encodings)[0]] });\r\n        }\r\n      });\r\n\r\n    this.exportableLayers$$ = this.exportableLayers$\r\n      .pipe(skipWhile((layers) => !layers))\r\n      .subscribe((layers) => {\r\n        if (layers.length === 1) {\r\n          this.form.patchValue({ layers: layers[0].id });\r\n        }\r\n      });\r\n\r\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\r\n      if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\r\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\r\n      } else {\r\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\r\n      }\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    if (this.selectFirstProj) {\r\n      if (this.projections$.value.length === 0) {\r\n        this.importForm.patchValue({ inputProj: { translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4326', zone: '' } });\r\n      } else {\r\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\r\n      }\r\n    } else {\r\n      this.importForm.patchValue({ inputProj: undefined });\r\n    }\r\n  }\r\n\r\n  private computeProjections() {\r\n    this.projectionsConstraints = computeProjectionsConstraints(this.projectionsLimitations);\r\n    const projections: InputProjections[] = [];\r\n\r\n    if (this.projectionsConstraints.nad83) {\r\n      projections.push({ translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4269', zone: '' });\r\n    }\r\n    if (this.projectionsConstraints.wgs84) {\r\n      projections.push({ translateKey: 'wgs84', alias: 'WGS84', code: 'EPSG:4326', zone: '' });\r\n    }\r\n    if (this.projectionsConstraints.webMercator) {\r\n      projections.push({ translateKey: 'webMercator', alias: 'Web Mercator', code: 'EPSG:3857', zone: '' });\r\n    }\r\n\r\n    if (this.projectionsConstraints.mtm) {\r\n      // all mtm zones\r\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\r\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\r\n\r\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\r\n        const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n        projections.push({ translateKey: 'mtm', alias: `MTM ${mtmZone}`, code, zone: `${mtmZone}` });\r\n      }\r\n    }\r\n\r\n    if (this.projectionsConstraints.utm) {\r\n      // all utm zones\r\n      const minZone = this.projectionsConstraints.utmZone.minZone;\r\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\r\n\r\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\r\n        const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n        projections.push({ translateKey: 'utm', alias: `UTM ${utmZone}`, code, zone: `${utmZone}` });\r\n      }\r\n    }\r\n\r\n    let configProjection = [];\r\n    if (this.projectionsConstraints.projFromConfig) {\r\n      configProjection = this.config.getConfig('projections') || [];\r\n    }\r\n\r\n    this.projections$.next(configProjection.concat(projections));\r\n  }\r\n\r\n  private getWorkspaceByLayerId(id: string): Workspace {\r\n    const wksFromLayerId = this.store\r\n      .all()\r\n      .find(workspace => (workspace as WfsWorkspace | FeatureWorkspace).layer.id === id);\r\n    if (wksFromLayerId) {\r\n      return wksFromLayerId;\r\n    }\r\n    return;\r\n  }\r\n\r\n  public getLayerTitleById(id): string {\r\n    return this.map.getLayerById(id).title;\r\n  }\r\n\r\n\r\n  layerHasSelectedFeatures(layer: Layer): boolean {\r\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\r\n    if (wksFromLayer) {\r\n      const recs = wksFromLayer.entityStore.stateView\r\n        .firstBy((record: EntityRecord<Feature>) => {\r\n          return record.state.selected === true;\r\n        });\r\n      return recs ? true : false;\r\n    }\r\n  }\r\n\r\n  public onlySelected(event: MatSlideToggleChange, id: string) {\r\n    let layersWithSelection = this.form.value.layersWithSelection;\r\n    if (event.checked) {\r\n      layersWithSelection.push(id);\r\n    } else {\r\n      layersWithSelection = layersWithSelection.filter(layerId => layerId !== id);\r\n    }\r\n    this.form.patchValue({ layersWithSelection });\r\n  }\r\n\r\n  public onlySelectedClick(event, id: string) {\r\n    if (this.form.value.layers.find(layerId => layerId === id)) {\r\n      event.stopPropagation();\r\n    }\r\n  }\r\n\r\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\r\n    return this.form.value.layersWithSelection.find(layerId => layerId === layer.id) ? true : false;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n    this.exportableLayers$$.unsubscribe();\r\n    this.formats$$.unsubscribe();\r\n    this.encodings$$.unsubscribe();\r\n    this.formLayer$$.unsubscribe();\r\n    if (this.exportOptions$$) {\r\n      this.exportOptions$$.unsubscribe();\r\n    }\r\n    this.exportOptionsChange.emit(this.form.value);\r\n    this.handlePreviousLayerSpecs();\r\n  }\r\n\r\n  private handlePreviousLayerSpecs() {\r\n    const previousSpecs = this.previousLayerSpecs$.value;\r\n    if (previousSpecs && previousSpecs.length) {\r\n      previousSpecs.forEach((specs) => {\r\n        const previousLayer = this.map.getLayerById(specs.id);\r\n        previousLayer.visible = specs.visible;\r\n        previousLayer.opacity = specs.opacity;\r\n        (previousLayer as any).queryable = specs.queryable;\r\n      });\r\n    }\r\n    this.previousLayerSpecs$.next(undefined);\r\n  }\r\n\r\n  importFiles(files: File[]) {\r\n    let inputProj = this.inputProj.code;\r\n    if (this.espgCodeRegex.test(inputProj)) {\r\n      inputProj = `EPSG:${inputProj}`;\r\n    }\r\n\r\n    this.loading$.next(true);\r\n    for (const file of files) {\r\n      this.importService.import(file, inputProj).subscribe(\r\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\r\n        (error: Error) => this.onFileImportError(file, error),\r\n        () => {\r\n          this.loading$.next(false);\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  handlePopup(preCheck: boolean = true): boolean {\r\n    const p1 = window.open('', 'popup', 'width=1, height=1');\r\n    p1.close();\r\n    const p2 = window.open('', 'popup', 'width=1, height=1');\r\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\r\n      this.onPopupBlockedError(preCheck);\r\n      this.popupAllowed = false;\r\n    } else {\r\n      p2.close();\r\n      this.popupAllowed = true;\r\n      this.popupChecked = true;\r\n    }\r\n    return this.popupAllowed;\r\n  }\r\n\r\n  handleExportFormSubmit(data: ExportOptions) {\r\n    this.loading$.next(true);\r\n\r\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n    if (!this.popupChecked && data.layers.length > 1 &&\r\n      (ogreFormats.indexOf(data.format) >= 0 || data.format === ExportFormat.URL) && !this.popupAllowed) {\r\n      this.handlePopup();\r\n    }\r\n\r\n    data.layers.forEach((layer) => {\r\n      const lay = this.map.getLayerById(layer);\r\n      let filename = lay.title;\r\n      if (data.name !== undefined) {\r\n        filename = data.name;\r\n      }\r\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\r\n      if (data.format === ExportFormat.URL && dSOptions.download && (dSOptions.download.url || dSOptions.download.dynamicUrl)) {\r\n        setTimeout(() => {\r\n          // better look an feel\r\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\r\n          url.match(/service=wfs/gi) ? this.downloadService.open(lay) : window.open(url , '_blank');\r\n          this.loading$.next(false);\r\n        }, 500);\r\n        return;\r\n      }\r\n      const wks = this.getWorkspaceByLayerId(layer);\r\n      let olFeatures;\r\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\r\n\r\n        if (data.layersWithSelection.indexOf(layer) !== -1 && data.featureInMapExtent) {\r\n          // Only export selected feature && into map extent\r\n          olFeatures = wks.entityStore.stateView.all()\r\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent && e.state.selected).map(e => (e.entity as Feature).ol);\r\n        } else if (data.layersWithSelection.indexOf(layer) !== -1 && !data.featureInMapExtent) {\r\n          // Only export selected feature &&  (into map extent OR not)\r\n          olFeatures = wks.entityStore.stateView.all()\r\n            .filter((e: EntityRecord<object>) => e.state.selected).map(e => (e.entity as Feature).ol);\r\n        } else if (data.featureInMapExtent) {\r\n          // Only into map extent\r\n          olFeatures = wks.entityStore.stateView.all()\r\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent).map(e => (e.entity as Feature).ol);\r\n        } else {\r\n          // All features\r\n          olFeatures = wks.entityStore.stateView.all().map(e => (e.entity as Feature).ol);\r\n        }\r\n      }\r\n      else {\r\n        const ol = lay.dataSource.ol as olVectorSource<OlGeometry> | olClusterSource ;\r\n        if (data.featureInMapExtent) {\r\n          olFeatures = ol.getFeaturesInExtent(\r\n            lay.map.viewController.getExtent()\r\n          );\r\n        } else {\r\n          olFeatures = ol.getFeatures();\r\n        }\r\n        if (lay.dataSource instanceof ClusterDataSource) {\r\n          olFeatures = olFeatures.flatMap((cluster: any) =>\r\n            cluster.get('features')\r\n          );\r\n        }\r\n      }\r\n\r\n      const translate = this.languageService.translate;\r\n      let geomTypes: { geometryType: string, features: any[] }[] = [];\r\n      if (data.format === ExportFormat.Shapefile || data.format === ExportFormat.GPX) {\r\n        olFeatures.forEach((olFeature) => {\r\n          const featureGeomType = olFeature.getGeometry().getType();\r\n          const currentGeomType = geomTypes.find(geomType => geomType.geometryType === featureGeomType);\r\n          if (currentGeomType) {\r\n            currentGeomType.features.push(olFeature);\r\n          } else {\r\n            geomTypes.push({ geometryType: featureGeomType, features: [olFeature] });\r\n          }\r\n        });\r\n      } else {\r\n        geomTypes = [{ geometryType: '', features: olFeatures }];\r\n      }\r\n\r\n      geomTypes.forEach(geomType => {\r\n        geomType.features.forEach(feature => {\r\n          const radius: number = feature.get('rad');\r\n\r\n          if (radius) {\r\n            const center4326: Array<number> = [feature.get('longitude'), feature.get('latitude')];\r\n            const circle = circular(center4326, radius, 500);\r\n            circle.transform('EPSG:4326', feature.get('_projection'));\r\n            feature.setGeometry(circle);\r\n          }\r\n        });\r\n      });\r\n\r\n      if (data.format === ExportFormat.GPX) {\r\n        const gpxFeatureCnt = geomTypes.length;\r\n        geomTypes = geomTypes.filter(geomType => ['LineString', 'Point'].includes(geomType.geometryType));\r\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\r\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\r\n          const title = translate.instant('igo.geo.export.gpx.error.poly.title');\r\n          const message = translate.instant('igo.geo.export.gpx.error.poly.text');\r\n          this.messageService.error(message, title, { timeOut: 20000 });\r\n        }\r\n      }\r\n\r\n      if (geomTypes.length === 0) {\r\n        this.loading$.next(false);\r\n        const title = translate.instant('igo.geo.export.nothing.title');\r\n        const message = translate.instant('igo.geo.export.nothing.text');\r\n        this.messageService.error(message, title, { timeOut: 20000 });\r\n\r\n      } else {\r\n        geomTypes.map(geomType =>\r\n          this.exportService.export(geomType.features, data.format, filename + geomType.geometryType, data.encoding, this.map.projection)\r\n          .subscribe(\r\n            () => {},\r\n            (error: Error) => this.onFileExportError(error),\r\n            () => {\r\n              this.onFileExportSuccess();\r\n\r\n              geomType.features.forEach(feature => {\r\n                const radius: number = feature.get('rad');\r\n\r\n                if (radius) {\r\n                  const point = new olPoint([feature.get('longitude'), feature.get('latitude')]);\r\n                  point.transform('EPSG:4326', feature.get('_projection'));\r\n                  feature.setGeometry(point);\r\n                }\r\n              });\r\n\r\n              this.loading$.next(false);\r\n            }\r\n        ));\r\n      }\r\n    });\r\n  }\r\n\r\n  private buildForm() {\r\n    this.importForm = this.formBuilder.group({\r\n      inputProj: ['', [Validators.required]]\r\n    });\r\n\r\n    if (this.forceNaming) {\r\n      this.form = this.formBuilder.group({\r\n        format: ['', [Validators.required]],\r\n        layers: [[], [Validators.required]],\r\n        layersWithSelection: [[]],\r\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\r\n        featureInMapExtent: [false, [Validators.required]],\r\n        name: ['', [Validators.required]]\r\n      });\r\n    } else {\r\n      this.form = this.formBuilder.group({\r\n        format: ['', [Validators.required]],\r\n        layers: [[], [Validators.required]],\r\n        layersWithSelection: [[]],\r\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\r\n        featureInMapExtent: [false, [Validators.required]],\r\n      });\r\n    }\r\n  }\r\n\r\n  private onFileImportSuccess(file: File, features: Feature[]) {\r\n    if (!this.config.getConfig('importWithStyle')) {\r\n      handleFileImportSuccess(\r\n        file,\r\n        features,\r\n        this.map,\r\n        this.messageService,\r\n        this.languageService\r\n      );\r\n    } else {\r\n      handleFileImportSuccess(\r\n        file,\r\n        features,\r\n        this.map,\r\n        this.messageService,\r\n        this.languageService,\r\n        this.styleListService,\r\n        this.styleService\r\n      );\r\n    }\r\n  }\r\n\r\n  private onFileImportError(file: File, error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileImportError(\r\n      file,\r\n      error,\r\n      this.messageService,\r\n      this.languageService,\r\n      this.fileSizeMb\r\n    );\r\n  }\r\n\r\n  private onPopupBlockedError(preCheck: boolean = true) {\r\n    this.loading$.next(false);\r\n    const translate = this.languageService.translate;\r\n    const title = translate.instant('igo.geo.export.popupBlocked.title');\r\n    const extraMessage = preCheck ? translate.instant('igo.geo.export.popupBlocked.selectAgain') : translate.instant('igo.geo.export.popupBlocked.retry');\r\n    const message = translate.instant('igo.geo.export.popupBlocked.text', { extraMessage });\r\n    this.messageService.error(message, title, { timeOut: 20000 });\r\n  }\r\n\r\n  private onFileExportError(error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileExportError(error, this.messageService, this.languageService);\r\n  }\r\n\r\n  private loadConfig() {\r\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\r\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\r\n    }\r\n    this.computeFormats();\r\n    this.loadEncodings();\r\n  }\r\n\r\n  public encodingDefaultValue(format: ExportFormat) {\r\n    if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\r\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\r\n      return EncodingFormat.LATIN1;\r\n    } else {\r\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\r\n      return EncodingFormat.UTF8;\r\n    }\r\n  }\r\n\r\n  private loadEncodings() {\r\n    this.encodings$.next(EncodingFormat);\r\n  }\r\n\r\n  private computeFormats(layers?: AnyLayer[]) {\r\n    let appliedformats: string[] = Object.keys(ExportFormat);\r\n    const formatsType = {\r\n      onlyUrl: false,\r\n      onlyVector: false,\r\n      vectorAndUrl: false,\r\n      customList: false\r\n    };\r\n    const customList = [];\r\n    if (layers && layers.length) {\r\n      layers.forEach((layer) => {\r\n        if (!layer) {\r\n          return;\r\n        }\r\n        if (layer.dataSource.options.download?.allowedFormats) {\r\n          formatsType.customList = true;\r\n          customList.push({layer: layer.title, formats: this.validateListFormat(layer.dataSource.options.download.allowedFormats)});\r\n        } else if (\r\n          !(layer instanceof VectorLayer) &&\r\n          layer.dataSource.options.download &&\r\n          layer.dataSource.options.download.url\r\n        ) {\r\n          formatsType.onlyUrl = true;\r\n        } else if (\r\n          layer.dataSource.options.download &&\r\n          (layer.dataSource.options.download.url || layer.dataSource.options.download.dynamicUrl)\r\n        ) {\r\n          formatsType.vectorAndUrl = true;\r\n        } else if (layer instanceof VectorLayer) {\r\n          formatsType.onlyVector = true;\r\n        }\r\n      });\r\n\r\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\r\n        appliedformats = ['URL'];\r\n      } else if (\r\n        formatsType.onlyVector === true &&\r\n        formatsType.onlyUrl === false\r\n      ) {\r\n        this.computeFormats(); // reset\r\n        if (ExportFormat.URL in this.formats$.value) {\r\n          const keys = Object.keys(this.formats$.value).filter(\r\n            (key) => key !== 'URL'\r\n          );\r\n          appliedformats = keys;\r\n        }\r\n      } else if (\r\n        formatsType.vectorAndUrl === true &&\r\n        formatsType.onlyUrl === false &&\r\n        formatsType.onlyVector === false\r\n      ) {\r\n        this.computeFormats(); // reset\r\n        if (!(ExportFormat.URL in this.formats$.value)) {\r\n          const keys = Object.keys(this.formats$.value);\r\n          keys.push('URL');\r\n          appliedformats = keys;\r\n        }\r\n      }\r\n    }\r\n    if (this.config.getConfig('importExport.formats') !== undefined) {\r\n      const validatedListFormat = this.validateListFormat(\r\n        this.config.getConfig('importExport.formats')\r\n      );\r\n      appliedformats = validatedListFormat;\r\n    }\r\n    if (formatsType.customList) {\r\n      let commonFormats;\r\n      const layersWithCustomFormats = [];\r\n      let previousCustomListFormats = customList[0].formats;\r\n      customList.map(list => {\r\n        layersWithCustomFormats.push(list.layer);\r\n        commonFormats = list.formats.filter(value => previousCustomListFormats.includes(value));\r\n        previousCustomListFormats = list.formats;\r\n      });\r\n      const finalFormats = commonFormats.filter(value => appliedformats.includes(value));\r\n      if (finalFormats.length > 0) {\r\n        this.formats$.next(strEnum(finalFormats));\r\n\r\n        if (layers && layers.length) {\r\n          if (layers.length > 1) {\r\n            this.messageService.alert(\r\n              this.languageService.translate.instant('igo.geo.export.customList.text', { value: layersWithCustomFormats.join() }),\r\n              this.languageService.translate.instant('igo.geo.export.customList.title')\r\n            );\r\n          }\r\n        }\r\n      } else {\r\n        this.formats$.next([]);\r\n        this.messageService.alert(\r\n          this.languageService.translate.instant('igo.geo.export.noFormat.text'),\r\n          this.languageService.translate.instant('igo.geo.export.noFormat.title')\r\n        );\r\n      }\r\n      return;\r\n    } else {\r\n      this.formats$.next(strEnum(appliedformats));\r\n    }\r\n  }\r\n\r\n  private validateListFormat(formats: string[]): string[] {\r\n    return formats\r\n      .filter((format) => {\r\n        if (\r\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\r\n        ) {\r\n          return format;\r\n        }\r\n      })\r\n      .map((format) => {\r\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\r\n          format = ExportFormat.CSVcomma;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\r\n          format = ExportFormat.CSVsemicolon;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\r\n          format = ExportFormat.GML;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\r\n          format = ExportFormat.GPX;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\r\n          format = ExportFormat.GeoJSON;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\r\n          format = ExportFormat.KML;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\r\n          format = ExportFormat.Shapefile;\r\n          return format;\r\n        }\r\n\r\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\r\n          format = ExportFormat.URL;\r\n          return format;\r\n        }\r\n      });\r\n  }\r\n\r\n  public modeChanged(mode) {\r\n    this.selectMode.emit(mode);\r\n  }\r\n\r\n  private onFileExportSuccess() {\r\n    handleFileExportSuccess(this.messageService, this.languageService);\r\n  }\r\n\r\n  onImportExportChange(event) {\r\n    this.selectedMode = event.value;\r\n  }\r\n}\r\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\r\n\r\n/**\r\n * Return a number of zone MTM for a longitude for province of Quebec only\r\n * @param lon number\r\n * @returns zone\r\n */\r\nexport function zoneMtm(lon: number): number {\r\n    let lonMin = -54;\r\n    const lonMax = -81;\r\n    if (lon < lonMax || lon > lonMin) {\r\n      return 0;\r\n    }\r\n    else {\r\n      const deltaLon = 3;\r\n      let zone = 2;\r\n      while (Math.abs(lon - lonMin) > deltaLon) {\r\n        lonMin = lonMin - deltaLon;\r\n        zone++;\r\n      }\r\n      return zone;\r\n    }\r\n  }\r\n/**\r\n * Return a number of zone UTM for a longitude\r\n * @param lon number\r\n * @returns zone\r\n */\r\nexport function zoneUtm(lon: number): number {\r\n  let lonMin = -180;\r\n  const lonMax = 180;\r\n  const deltaLon = 6;\r\n  let zone = 1;\r\n  while (Math.abs(lon - lonMin) > deltaLon) {\r\n    lonMin = lonMin + deltaLon;\r\n    zone++;\r\n  }\r\n  return zone;\r\n}\r\n\r\n/**\r\n * Compute the contraints of projections\r\n * @param projectionsLimitations: ProjectionsLimitationsOptions\r\n * @returns projectionsContraints: ProjectionsLimitationsOptions\r\n */\r\nexport function   computeProjectionsConstraints(\r\n    projectionsLimitations: ProjectionsLimitationsOptions):\r\n    ProjectionsLimitationsOptions {\r\n    const mtmZone = projectionsLimitations.mtmZone;\r\n    const utmZone = projectionsLimitations.utmZone;\r\n    const projectionsConstraints = {\r\n        projFromConfig: projectionsLimitations.projFromConfig === false ? false : true,\r\n        nad83: projectionsLimitations.nad83 === false ? false : true,\r\n        wgs84: projectionsLimitations.wgs84 === false ? false : true,\r\n        webMercator: projectionsLimitations.webMercator === false ? false : true,\r\n        utm: projectionsLimitations.utm === false ? false : true,\r\n        mtm: projectionsLimitations.mtm === false ? false : true,\r\n        utmZone: {\r\n        minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\r\n        maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21,\r\n        },\r\n        mtmZone: {\r\n        minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\r\n        maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10,\r\n        }\r\n    };\r\n    return projectionsConstraints;\r\n  }\r\n","import {\r\n  getEntityProperty,\r\n  EntityTableColumn,\r\n  EntityTableColumnRenderer\r\n} from '@igo2/common';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport { ExportNothingToExportError } from './export.errors';\r\n\r\nexport function handleFileExportError(\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  if (error instanceof ExportNothingToExportError) {\r\n    handleNothingToExportError(messageService, languageService);\r\n    return;\r\n  }\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.export.failed.title');\r\n  const message = translate.instant('igo.geo.export.failed.text');\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleFileExportSuccess(\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.export.success.title');\r\n  const message = translate.instant('igo.geo.export.success.text');\r\n  messageService.success(message, title);\r\n}\r\n\r\nexport function handleNothingToExportError(\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.export.nothing.title');\r\n  const message = translate.instant('igo.geo.export.nothing.text');\r\n  messageService.error(message, title);\r\n}\r\n\r\n/**\r\n * Export array to CSV\r\n *\r\n * @param rows Array of arrays to export as CSV\r\n * @param separator Cell separator\r\n */\r\nexport function exportToCSV(rows: any[][], fileName: string, separator: string = ';') {\r\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\r\n  const csvContent = lines.join('\\n');\r\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\r\n}\r\n\r\n/**\r\n * Return an array of values from an array of entities.\r\n *\r\n * @param entities Array of entities\r\n * @param scolumns Columns definition of the output data\r\n */\r\nexport function entitiesToRowData(entities: object[], columns: EntityTableColumn[]) {\r\n  return entities.map((entity: object) => {\r\n    return columns.map((column: EntityTableColumn) => {\r\n      let valueAccessor;\r\n      if (column.renderer === undefined || column.renderer === EntityTableColumnRenderer.Default) {\r\n        valueAccessor = column.valueAccessor;\r\n      }\r\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\r\n      return valueAccessor(entity, column.name);\r\n    });\r\n  });\r\n}\r\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\r\n\r\nimport { StyleListService } from './style-list.service';\r\nimport { StyleListOptions } from './style-list.interface';\r\n\r\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>('styleListOptions');\r\n\r\nexport function provideStyleListOptions(options: StyleListOptions) {\r\n  return {\r\n    provide: STYLELIST_OPTIONS,\r\n    useValue: options\r\n  };\r\n}\r\n\r\nexport function styleListFactory(\r\n  styleListService: StyleListService,\r\n  options: StyleListOptions\r\n) {\r\n  return () => styleListService.load(options);\r\n}\r\n\r\nexport function provideStyleListLoader() {\r\n  return {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: styleListFactory,\r\n    multi: true,\r\n    deps: [StyleListService, STYLELIST_OPTIONS]\r\n  };\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { provideStyleListOptions, provideStyleListLoader } from './style-list.provider';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoStyleListModule {\r\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\r\n    return {\r\n      ngModule: IgoStyleListModule,\r\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoKeyValueModule, IgoDrapDropModule, IgoSpinnerModule } from '@igo2/common';\r\n\r\nimport { ExportButtonComponent } from './export-button/export-button.component';\r\nimport { ImportExportComponent } from './import-export/import-export.component';\r\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\r\nimport { IgoStyleListModule } from './style-list/style-list.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatTabsModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule,\r\n    IgoSpinnerModule,\r\n    IgoKeyValueModule,\r\n    IgoDrapDropModule,\r\n    IgoStyleListModule.forRoot()\r\n  ],\r\n  exports: [ImportExportComponent, DropGeoFileDirective, IgoStyleListModule, ExportButtonComponent],\r\n  declarations: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent]\r\n})\r\nexport class IgoImportExportModule {\r\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\r\n    return {\r\n      ngModule: IgoImportExportModule\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoConfirmDialogModule } from '@igo2/common';\r\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\r\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\r\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\r\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\r\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\r\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\r\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\r\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\r\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\r\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\r\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\r\nimport { MapCenterComponent } from './map-center/map-center.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoLanguageModule,\r\n    IgoConfirmDialogModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule\r\n  ],\r\n  exports: [\r\n    MapBrowserComponent,\r\n    ZoomButtonComponent,\r\n    GeolocateButtonComponent,\r\n    RotationButtonComponent,\r\n    BaseLayersSwitcherComponent,\r\n    MiniBaseMapComponent,\r\n    MapOfflineDirective,\r\n    OfflineButtonComponent,\r\n    PointerPositionDirective,\r\n    HoverFeatureDirective,\r\n    SwipeControlComponent,\r\n    MapCenterComponent\r\n  ],\r\n  declarations: [\r\n    MapBrowserComponent,\r\n    ZoomButtonComponent,\r\n    GeolocateButtonComponent,\r\n    RotationButtonComponent,\r\n    BaseLayersSwitcherComponent,\r\n    MiniBaseMapComponent,\r\n    MapOfflineDirective,\r\n    OfflineButtonComponent,\r\n    PointerPositionDirective,\r\n    HoverFeatureDirective,\r\n    SwipeControlComponent,\r\n    MapCenterComponent\r\n  ]\r\n})\r\nexport class IgoMapModule {}\r\n","<mat-form-field class=\"measure-field\">\r\n  <input\r\n    matInput\r\n    [readonly]=\"true\"\r\n    [placeholder]=\"placeholder\"\r\n    [value]=\"((measure$ | async) || 0) | measureFormat: measureUnit\">\r\n</mat-form-field>\r\n<mat-form-field class=\"unit-field\">\r\n  <mat-select\r\n    [value]=\"measureUnit\"\r\n    [disabled]=\"auto\"\r\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\r\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\r\n      {{('igo.geo.measure.' + measureUnit) | translate}}\r\n    </mat-option>\r\n  </mat-select>\r\n</mat-form-field>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport {\r\n  MeasureType,\r\n  MeasureAreaUnit,\r\n  MeasureLengthUnit\r\n} from '../shared/measure.enum';\r\nimport { computeBestAreaUnit, computeBestLengthUnit } from '../shared/measure.utils';\r\n\r\n/**\r\n * Measurer item\r\n */\r\n@Component({\r\n  selector: 'igo-measurer-item',\r\n  templateUrl: './measurer-item.component.html',\r\n  styleUrls: ['./measurer-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerItemComponent implements OnDestroy {\r\n\r\n  /**\r\n   * Measure observable\r\n   * @internal\r\n   */\r\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Subscription to the measure observable when the auto mode is on\r\n   * @internal\r\n   */\r\n  public measure$$: Subscription;\r\n\r\n  /**\r\n   * Measure type\r\n   */\r\n  @Input() measureType: MeasureType;\r\n\r\n  /**\r\n   * Measure unit\r\n   */\r\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\r\n\r\n  /**\r\n   * Measure\r\n   */\r\n  @Input()\r\n  set measure(value: number) {\r\n    this.measure$.next(value);\r\n  }\r\n  get measure(): number { return this.measure$.value; }\r\n\r\n  /**\r\n   * Whther measure units should be automatically determined\r\n   */\r\n  @Input()\r\n  set auto(value: boolean) { this.toggleAutoUnit(value); }\r\n  get auto(): boolean { return this._auto; }\r\n  private _auto: boolean = false;\r\n\r\n  /**\r\n   * Placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Event emitted when the measure unit changes\r\n   */\r\n  @Output() measureUnitChange = new EventEmitter<MeasureAreaUnit | MeasureLengthUnit>();\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    if (this.measureType === MeasureType.Area) {\r\n      return Object.values(MeasureAreaUnit);\r\n    }\r\n    return Object.values(MeasureLengthUnit);\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Toggle the auto unit off\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.toggleAutoUnit(false);\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\r\n    this.measureUnit = unit;\r\n    this.measureUnitChange.emit(unit);\r\n  }\r\n\r\n  private toggleAutoUnit(toggle: boolean) {\r\n    if (this.measure$$ !== undefined) {\r\n      this.measure$$.unsubscribe();\r\n    }\r\n    if (toggle === true) {\r\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\r\n        this.computeBestMeasureUnit(measure);\r\n      });\r\n    }\r\n    this._auto = toggle;\r\n  }\r\n\r\n  private computeBestMeasureUnit(measure: number) {\r\n    let measureUnit = this.measureUnit;\r\n    if (this.measureType === MeasureType.Area) {\r\n      measureUnit = computeBestAreaUnit(measure);\r\n    } else if (this.measureType === MeasureType.Length) {\r\n      measureUnit = computeBestLengthUnit(measure);\r\n    }\r\n    if (measureUnit !== this.measureUnit) {\r\n      this.onMeasureUnitChange(measureUnit);\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoEntityTableModule } from '@igo2/common';\r\n\r\nimport { MeasureFormatPipe } from './measure-format.pipe';\r\nimport { MeasurerItemComponent } from './measurer-item.component';\r\nimport { MeasurerComponent } from './measurer.component';\r\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule,\r\n    IgoEntityTableModule\r\n  ],\r\n  declarations: [\r\n    MeasureFormatPipe,\r\n    MeasurerItemComponent,\r\n    MeasurerComponent,\r\n    MeasurerDialogComponent\r\n  ],\r\n  exports: [\r\n    MeasureFormatPipe,\r\n    MeasurerComponent\r\n  ]\r\n})\r\nexport class IgoMeasurerModule {}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMeasurerModule } from './measurer/measurer.module';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: [\r\n    IgoMeasurerModule\r\n  ]\r\n})\r\nexport class IgoMeasureModule {}\r\n","export enum OverlayAction {\r\n    None,\r\n    Move,\r\n    Zoom,\r\n    ZoomIfOutMapExtent\r\n  }\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\n\r\nimport { OverlayAction } from './overlay.enum';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class OverlayService {\r\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\r\n    [],\r\n    undefined\r\n  ]);\r\n\r\n  constructor() {}\r\n\r\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\r\n    this.features$.next([features, action]);\r\n  }\r\n\r\n  clear() {\r\n    this.features$.next([[], OverlayAction.None]);\r\n  }\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport * as olextent from 'ol/extent';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\n\r\nimport { OverlayService } from '../shared/overlay.service';\r\nimport { OverlayAction } from '../shared/overlay.enum';\r\n\r\n@Directive({\r\n  selector: '[igoOverlay]'\r\n})\r\nexport class OverlayDirective implements OnInit, OnDestroy {\r\n  private features$$: Subscription;\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private overlayService: OverlayService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.features$$ = this.overlayService.features$.subscribe(res =>\r\n      this.handleFeatures(res[0], res[1])\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.features$$.unsubscribe();\r\n  }\r\n\r\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\n\r\nimport { OverlayDirective } from './shared/overlay.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  exports: [OverlayDirective],\r\n  declarations: [OverlayDirective]\r\n})\r\nexport class IgoOverlayModule {\r\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\r\n    return {\r\n      ngModule: IgoOverlayModule\r\n    };\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { Observable, Subject, forkJoin } from 'rxjs';\r\nimport { map as rxMap } from 'rxjs/operators';\r\n\r\nimport { saveAs } from 'file-saver';\r\nimport jspdf from 'jspdf';\r\nimport html2canvas from 'html2canvas';\r\nimport * as JSZip from 'jszip';\r\n\r\nimport { SubjectStatus } from '@igo2/utils';\r\nimport { SecureImagePipe } from '@igo2/common';\r\nimport { MessageService, ActivityService, LanguageService } from '@igo2/core';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { formatScale } from '../../map/shared/map.utils';\r\nimport { LegendMapViewOptions, OutputLayerLegend } from '../../layer/shared/layers/layer.interface';\r\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\r\n\r\nimport { PrintOptions } from './print.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PrintService {\r\n  zipFile: JSZip;\r\n  nbFileToProcess: number;\r\n  activityId: string;\r\n  constructor(\r\n    private http: HttpClient,\r\n    private messageService: MessageService,\r\n    private activityService: ActivityService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\r\n    const status$ = new Subject();\r\n\r\n    const paperFormat: string = options.paperFormat;\r\n    const resolution = +options.resolution; // Default is 96\r\n    const orientation = options.orientation;\r\n    const legendPostion = options.legendPosition;\r\n\r\n    this.activityId = this.activityService.register();\r\n    const doc = new jspdf({\r\n      orientation,\r\n      format: paperFormat.toLowerCase()\r\n    });\r\n\r\n    const dimensions = [\r\n      doc.internal.pageSize.width,\r\n      doc.internal.pageSize.height\r\n    ];\r\n\r\n    const margins = [10, 10, 10, 10];\r\n    const width = dimensions[0] - margins[3] - margins[1];\r\n    const height = dimensions[1] - margins[0] - margins[2];\r\n    const size = [width, height];\r\n    let titleSizeResults = [0, 0];\r\n\r\n    if (options.title !== undefined) {\r\n      titleSizeResults = this.getTitleSize(options.title, width, height, doc); // return : size(pt) and left margin (mm)\r\n      this.addTitle(doc, options.title, titleSizeResults[0], margins[3] + titleSizeResults[1], titleSizeResults[0] * (25.4 / 72));\r\n    }\r\n    if (options.subtitle !== undefined) {\r\n      let subtitleSizeResult = 0;\r\n      const titleH = titleSizeResults[0];\r\n      subtitleSizeResult = this.getSubTitleSize(options.subtitle, width, height, doc); // return : size(pt) and left margin (mm)\r\n      this.addSubTitle(doc, options.subtitle, titleH * 0.7, margins[3] + subtitleSizeResult, titleH * 1.7 * (25.4 / 72));\r\n      margins[0] = margins[0] + titleSizeResults[0] * 0.7 * (25.4 / 72);\r\n    }\r\n    if (options.showProjection === true || options.showScale === true) {\r\n      this.addProjScale(\r\n        doc,\r\n        map,\r\n        resolution,\r\n        options.showProjection,\r\n        options.showScale\r\n        );\r\n    }\r\n    if (options.comment !== '') {\r\n      this.addComment(doc, options.comment);\r\n    }\r\n\r\n    this.addMap(doc, map, resolution, size, margins).subscribe(\r\n      async (status: SubjectStatus) => {\r\n        if (status === SubjectStatus.Done) {\r\n          await this.addScale(doc, map, margins);\r\n          await this.handleMeasureLayer(doc, map, margins);\r\n          if (options.legendPosition !== 'none') {\r\n            if (['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(options.legendPosition) > -1 ) {\r\n              await this.addLegendSamePage(doc, map, margins, resolution, options.legendPosition);\r\n            } else if (options.legendPosition === 'newpage') {\r\n              await this.addLegend(doc, map, margins, resolution);\r\n            }\r\n          } else {\r\n            await this.saveDoc(doc);\r\n          }\r\n        }\r\n\r\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\r\n          this.activityService.unregister(this.activityId);\r\n          status$.next(SubjectStatus.Done);\r\n        }\r\n      }\r\n    );\r\n\r\n    return status$;\r\n  }\r\n\r\n  /**\r\n   * Add measure overlay on the map on the document when the measure layer is present\r\n   * @param  doc - Pdf document where measure tooltip will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private async handleMeasureLayer(\r\n    doc: jspdf,\r\n    map: IgoMap,\r\n    margins: Array<number>\r\n  ) {\r\n    if (map.layers.find(layer => layer.visible && layer.id.startsWith('igo-measures-'))) {\r\n      let canvasOverlayHTMLMeasures;\r\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\r\n      await html2canvas(mapOverlayMeasuresHTML, {\r\n        scale: 1,\r\n        backgroundColor: null\r\n      }).then(e => {\r\n        canvasOverlayHTMLMeasures = e;\r\n      });\r\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get html code for all layers legend\r\n   * @param  map IgoMap\r\n   * @param  width The width that the legend need to be\r\n   * @return Html code for the legend\r\n   */\r\n  getLayersLegendHtml(\r\n    map: IgoMap,\r\n    width: number,\r\n    resolution: number\r\n  ): Observable<string> {\r\n    return new Observable((observer) => {\r\n      let html = '';\r\n      const legends = getLayersLegends(\r\n        map.layers,\r\n        {\r\n          resolution: map.viewController.getResolution(),\r\n          extent: map.viewController.getExtent(),\r\n          projection: map.viewController.getOlProjection().getCode(),\r\n          scale: map.viewController.getScale(resolution),\r\n          size: map.ol.getSize()\r\n        } as LegendMapViewOptions\r\n      );\r\n      if (legends.length === 0) {\r\n        observer.next(html);\r\n        observer.complete();\r\n        return;\r\n      }\r\n      // Define important style to be sure that all container is convert\r\n      // to image not just visible part\r\n      html += '<style media=\"screen\" type=\"text/css\">';\r\n      html += '.html2canvas-container { width: ' + width + 'mm !important; height: 2000px !important; }';\r\n      html += 'table.tableLegend {table-layout: auto;}';\r\n      html += 'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\r\n      html += '</style>';\r\n      // The font size will also be lowered afterwards (globally along the legend size)\r\n      // this allows having a good relative font size here and to keep ajusting the legend size\r\n      // while keeping good relative font size\r\n      html += '<font size=\"3\" face=\"Times\" >';\r\n      html += '<div class=\"styleLegend\">';\r\n      html += '<table class=\"tableLegend\" >';\r\n\r\n      // For each legend, define an html table cell\r\n      const images$ = legends.map((legend) =>\r\n        this.getDataImage(legend.url).pipe(\r\n          rxMap((dataImage) => {\r\n            let htmlImg = '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\r\n            htmlImg  += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\r\n            return htmlImg;\r\n          })\r\n        )\r\n      );\r\n      forkJoin(images$).subscribe((dataImages) => {\r\n        html = dataImages.reduce((acc, current) => (acc += current), html);\r\n        html += '</table>';\r\n        html += '</div>';\r\n        observer.next(html);\r\n        observer.complete();\r\n      });\r\n    });\r\n  }\r\n\r\n  getDataImage(url: string): Observable<string> {\r\n    const secureIMG = new SecureImagePipe(this.http);\r\n    return secureIMG.transform(url);\r\n  }\r\n\r\n  /**\r\n   * Get all the legend in a single image\r\n   * * @param  format - Image format. default value to \"png\"\r\n   * @return The image of the legend\r\n   */\r\n  async getLayersLegendImage(\r\n    map,\r\n    format: string = 'png',\r\n    doZipFile: boolean,\r\n    resolution: number\r\n  ) {\r\n    const status$ = new Subject();\r\n    // Get html code for the legend\r\n    const width = 200; // milimeters unit, originally define for document pdf\r\n    let html = await this.getLayersLegendHtml(\r\n      map,\r\n      width,\r\n      resolution\r\n    ).toPromise();\r\n    format = format.toLowerCase();\r\n\r\n    // If no legend show No LEGEND in an image\r\n    if (html.length === 0) {\r\n      html = '<font size=\"12\" face=\"Courier New\" >';\r\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n\r\n    await this.timeout(1);\r\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\r\n      console.log(e);\r\n    });\r\n\r\n    if (canvas) {\r\n      let status = SubjectStatus.Done;\r\n      try {\r\n        if (!doZipFile) {\r\n          // Save the canvas as file\r\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\r\n        }\r\n        div.parentNode.removeChild(div); // remove temp div (IE)\r\n      } catch (err) {\r\n        status = SubjectStatus.Error;\r\n      }\r\n      status$.next(status);\r\n    }\r\n\r\n    return status$;\r\n  }\r\n\r\n  getTitleSize(title: string, pageWidth: number, pageHeight: number, doc: jspdf) {\r\n    const pdfResolution = 96;\r\n    const titleSize = Math.round(2 * (pageHeight + 145) * 0.05) / 2;\r\n    doc.setFont('Times', 'bold');\r\n    const width = doc.getTextWidth(title);\r\n\r\n    const titleWidth = doc.getStringUnitWidth(title) * titleSize / doc.internal.scaleFactor;\r\n    const titleTailleMinimale = Math.round( 2 * (pageHeight + 150 ) * 0.037) / 2;\r\n    let titleFontSize = 0;\r\n\r\n    let titleMarginLeft;\r\n    if (titleWidth >= (pageWidth)) {\r\n      titleMarginLeft = 0;\r\n      titleFontSize = Math.round(((pageWidth / title.length) * pdfResolution) / 25.4);\r\n      // If the formula to find the font size gives below the defined minimum size\r\n      if (titleFontSize < titleTailleMinimale) {\r\n        titleFontSize = titleTailleMinimale;\r\n      }\r\n    } else {\r\n      titleMarginLeft = (pageWidth - titleWidth) / 2 ;\r\n      titleFontSize = titleSize;\r\n    }\r\n    return [titleFontSize, titleMarginLeft];\r\n  }\r\n\r\n  getSubTitleSize(subtitle: string, pageWidth: number, pageHeight: number, doc: jspdf) {\r\n    const subtitleSize = 0.7 * Math.round(2 * (pageHeight + 145) * 0.05) / 2; // 70% of the title's font size\r\n\r\n    doc.setFont('Times', 'bold');\r\n\r\n    const subtitleWidth = doc.getStringUnitWidth(subtitle) * subtitleSize / doc.internal.scaleFactor;\r\n\r\n    let subtitleMarginLeft;\r\n    if (subtitleWidth >= (pageWidth)) {\r\n      subtitleMarginLeft = 0;\r\n    } else {\r\n      subtitleMarginLeft = (pageWidth - subtitleWidth) / 2 ;\r\n    }\r\n    return subtitleMarginLeft;\r\n  }\r\n\r\n  private addTitle(doc: jspdf, title: string, titleFontSize: number, titleMarginLeft: number, titleMarginTop: number) {\r\n    doc.setFont('Times', 'bold');\r\n    doc.setFontSize(titleFontSize);\r\n    doc.text(title, titleMarginLeft, titleMarginTop);\r\n  }\r\n\r\n  private addSubTitle(doc: jspdf, subtitle: string, subtitleFontSize: number, subtitleMarginLeft: number, subtitleMarginTop: number) {\r\n    doc.setFont('Times', 'bold');\r\n    doc.setFontSize(subtitleFontSize);\r\n    doc.text(subtitle, subtitleMarginLeft, subtitleMarginTop);\r\n  }\r\n  /**\r\n   * Add comment to the document\r\n   * * @param  doc - pdf document\r\n   * * @param  comment - Comment to add in the document\r\n   * * @param  size - Size of the document\r\n   */\r\n  private addComment(doc: jspdf, comment: string) {\r\n    const commentSize = 16;\r\n    const commentMarginLeft = 20;\r\n    const marginBottom = 5;\r\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\r\n\r\n    doc.setFont('courier');\r\n    doc.setFontSize(commentSize);\r\n    doc.text(comment, commentMarginLeft, heightPixels);\r\n  }\r\n  /**\r\n   * Add projection and/or scale to the document\r\n   * @param  doc - pdf document\r\n   * @param  map - Map of the app\r\n   * @param  dpi - DPI resolution of the document\r\n   * @param  projection - Bool to indicate if projection need to be added\r\n   * @param  scale - Bool to indicate if scale need to be added\r\n   */\r\n  private addProjScale(\r\n    doc: jspdf,\r\n    map: IgoMap,\r\n    dpi: number,\r\n    projection: boolean,\r\n    scale: boolean\r\n  ) {\r\n    const translate = this.languageService.translate;\r\n    const projScaleSize = 16;\r\n    const projScaleMarginLeft = 20;\r\n    const marginBottom = 15;\r\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\r\n\r\n    let textProjScale: string = '';\r\n    if (projection === true) {\r\n      const projText = translate.instant('igo.geo.printForm.projection');\r\n      textProjScale += projText + ': ' + map.projection;\r\n    }\r\n    if (scale === true) {\r\n      if (projection === true) {\r\n        textProjScale += '   ';\r\n      }\r\n      const scaleText = translate.instant('igo.geo.printForm.scale');\r\n      const mapScale = map.viewController.getScale(dpi);\r\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\r\n    }\r\n    doc.setFont('courier');\r\n    doc.setFontSize(projScaleSize);\r\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\r\n  }\r\n\r\n  /**\r\n   * Add the legend to the document\r\n   * @param  doc - Pdf document where legend will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private async addLegend(\r\n    doc: jspdf,\r\n    map: IgoMap,\r\n    margins: Array<number>,\r\n    resolution: number\r\n  ) {\r\n    // Get html code for the legend\r\n    const width = doc.internal.pageSize.width;\r\n    const html = await this.getLayersLegendHtml(\r\n      map,\r\n      width,\r\n      resolution\r\n    ).toPromise();\r\n    // If no legend, save the map directly\r\n    if (html === '') {\r\n      await this.saveDoc(doc);\r\n      return true;\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n\r\n    await this.timeout(1);\r\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\r\n      console.log(e);\r\n    });\r\n\r\n    if (canvas) {\r\n      const pourcentageReduction = 0.85;\r\n      const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution, pourcentageReduction\r\n        * (25.4 * canvas.height) / resolution];\r\n      let imgData;\r\n      doc.addPage();\r\n      imgData = canvas.toDataURL('image/png');\r\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\r\n      div.parentNode.removeChild(div); // remove temp div (IE style)\r\n    }\r\n\r\n    await this.saveDoc(doc);\r\n\r\n  }\r\n\r\n  /**\r\n   * Add the legend to the document\r\n   * @param  doc - Pdf document where legend will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n     private async addLegendSamePage(\r\n      doc: jspdf,\r\n      map: IgoMap,\r\n      margins: Array<number>,\r\n      resolution: number,\r\n      legendPosition: string\r\n    ) {\r\n      // Get html code for the legend\r\n      const width = doc.internal.pageSize.width;\r\n      const html = await this.getLayersLegendHtml(\r\n        map,\r\n        width,\r\n        resolution\r\n      ).toPromise();\r\n      // If no legend, save the map directly\r\n      if (html === '') {\r\n        await this.saveDoc(doc);\r\n        return true;\r\n      }\r\n      // Create div to contain html code for legend\r\n      const div = window.document.createElement('div');\r\n      div.style.position = 'absolute';\r\n      div.style.top = '0';\r\n      // Add html code to convert in the new window\r\n      window.document.body.appendChild(div);\r\n      div.innerHTML = html;\r\n      await this.timeout(1);\r\n      const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\r\n        console.log(e);\r\n      });\r\n      let marginsLegend;\r\n      if (canvas) {\r\n        const pourcentageReduction = 0.85;\r\n        const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution,\r\n           pourcentageReduction * (25.4 * canvas.height) / resolution];\r\n        // Move the legend to the correct position on the page\r\n        if ( legendPosition === 'bottomright') {\r\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1], margins[1],\r\n           margins[2], doc.internal.pageSize.width - margins[1] - imageSize[0]];\r\n        } else if (legendPosition === 'topright') {\r\n          marginsLegend = [margins[0], margins[1], doc.internal.pageSize.height - margins[0] - imageSize[1],\r\n          doc.internal.pageSize.width - margins[1] - imageSize[0] ];\r\n        } else if (legendPosition === 'bottomleft') {\r\n          // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\r\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\r\n          doc.internal.pageSize.width - margins[3] - imageSize[0], margins[2] + 15, margins[3] ];\r\n        } else if (legendPosition === 'topleft') {\r\n          marginsLegend = [margins[0], doc.internal.pageSize.width - margins[3] - imageSize[0],\r\n           doc.internal.pageSize.height - margins[0] - imageSize[1], margins[3] ];\r\n        }\r\n        this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\r\n        div.parentNode.removeChild(div); // remove temp div (IE style)\r\n        await this.saveDoc(doc);\r\n      }\r\n    }\r\n\r\n  /**\r\n   * Add scale and attributions on the map on the document\r\n   * @param  doc - Pdf document where legend will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private async addScale(\r\n    doc: jspdf,\r\n    map: IgoMap,\r\n    margins: Array<number>\r\n    ) {\r\n      const mapSize = map.ol.getSize();\r\n      const extent = map.ol.getView().calculateExtent(mapSize);\r\n      // Get the scale and attribution\r\n      // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\r\n      let canvasOverlayHTML;\r\n      const mapOverlayHTML = map.ol.getOverlayContainerStopEvent();\r\n      // Remove the UI buttons from the nodes\r\n      const OverlayHTMLButtons = mapOverlayHTML.getElementsByTagName('button');\r\n      const OverlayHTMLButtonsarr = Array.from(OverlayHTMLButtons);\r\n      for (const OverlayHTMLButton of OverlayHTMLButtonsarr) {\r\n        OverlayHTMLButton.setAttribute('data-html2canvas-ignore', 'true');\r\n      }\r\n      // Change the styles of hyperlink in the printed version\r\n      // Transform the Overlay into a canvas\r\n      // scale is necessary to make it in google chrome\r\n      // background as null because otherwise it is white and cover the map\r\n      // allowtaint is to allow rendering images in the attributions\r\n      // useCORS: true pour permettre de renderer les images (ne marche pas en local)\r\n      const canvas = await html2canvas(mapOverlayHTML, {\r\n        scale: 1,\r\n        backgroundColor: null,\r\n        allowTaint: true,\r\n        useCORS: true,\r\n      }).then( e => {\r\n        canvasOverlayHTML = e;\r\n      });\r\n      this.addCanvas(doc, canvasOverlayHTML, margins); // this adds scales and attributions\r\n }\r\n\r\n  defineNbFileToProcess(nbFileToProcess) {\r\n    this.nbFileToProcess = nbFileToProcess;\r\n  }\r\n\r\n  private timeout(ms) {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  private addCanvas(\r\n    doc: jspdf,\r\n    canvas: HTMLCanvasElement,\r\n    margins: Array<number>\r\n  ) {\r\n    let image;\r\n    if (canvas) {\r\n      image = canvas.toDataURL('image/png');\r\n    }\r\n\r\n    if (image !== undefined) {\r\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\r\n      doc.addImage(\r\n        image,\r\n        'PNG',\r\n        margins[3],\r\n        margins[0],\r\n        imageSize[0],\r\n        imageSize[1]\r\n      );\r\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\r\n    }\r\n  }\r\n\r\n  // TODO fix printing with image resolution\r\n  private addMap(\r\n    doc: jspdf,\r\n    map: IgoMap,\r\n    resolution: number,\r\n    size: Array<number>,\r\n    margins: Array<number>\r\n  ) {\r\n    const status$ = new Subject();\r\n\r\n    const mapSize = map.ol.getSize();\r\n    const extent = map.ol.getView().calculateExtent(mapSize);\r\n\r\n    const widthPixels = Math.round((size[0] * resolution) / 25.4);\r\n    const heightPixels = Math.round((size[1] * resolution) / 25.4);\r\n\r\n    let timeout;\r\n\r\n    map.ol.once('rendercomplete', (event: any) => {\r\n      const canvases = event.target.getViewport().getElementsByTagName('canvas');\r\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\r\n        clearTimeout(timeout);\r\n\r\n        if (mapStatus !== SubjectStatus.Done) {\r\n          return;\r\n        }\r\n\r\n        mapStatus$$.unsubscribe();\r\n\r\n        let status = SubjectStatus.Done;\r\n        try {\r\n          for (const canvas of canvases) {\r\n            if (canvas.width !== 0) {\r\n              this.addCanvas(doc, canvas, margins);\r\n            }\r\n          }\r\n        } catch (err) {\r\n          status = SubjectStatus.Error;\r\n          this.messageService.error(\r\n            this.languageService.translate.instant(\r\n              'igo.geo.printForm.corsErrorMessageBody'\r\n            ),\r\n            this.languageService.translate.instant(\r\n              'igo.geo.printForm.corsErrorMessageHeader'\r\n            )\r\n          );\r\n        }\r\n        this.renderMap(map, mapSize, extent);\r\n        status$.next(status);\r\n      });\r\n\r\n      // If no loading as started after 200ms, then probably no loading\r\n      // is required.\r\n      timeout = window.setTimeout(() => {\r\n        mapStatus$$.unsubscribe();\r\n\r\n        let status = SubjectStatus.Done;\r\n        try {\r\n          for (const canvas of canvases) {\r\n            if (canvas.width !== 0) {\r\n              this.addCanvas(doc, canvas, margins);\r\n            }\r\n          }\r\n        } catch (err) {\r\n          status = SubjectStatus.Error;\r\n          this.messageService.error(\r\n            this.languageService.translate.instant(\r\n              'igo.geo.printForm.corsErrorMessageBody'\r\n            ),\r\n            this.languageService.translate.instant(\r\n              'igo.geo.printForm.corsErrorMessageHeader'\r\n            )\r\n          );\r\n        }\r\n        this.renderMap(map, mapSize, extent);\r\n        status$.next(status);\r\n      }, 200);\r\n    });\r\n\r\n    this.renderMap(map, [widthPixels, heightPixels], extent);\r\n\r\n    return status$;\r\n  }\r\n\r\n  /**\r\n   * Download an image of the map with addition of informations\r\n   * @param  map - Map of the app\r\n   * @param  format - Image format. default value to \"png\"\r\n   * @param  projection - Indicate if projection need to be add. Default to false\r\n   * @param  scale - Indicate if scale need to be add. Default to false\r\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\r\n   * @param  title - Title to add for the map - Default to blank\r\n   * @param  subtitle - Subtitle to add for the map - Default to blank\r\n   * @param  comment - Comment to add for the map - Default to blank\r\n   * @param  doZipFile - Indicate if we do a zip with the file\r\n   * @return Image file of the map with extension format given as parameter\r\n   */\r\n  downloadMapImage(\r\n    map: IgoMap,\r\n    resolution: number,\r\n    format = 'png',\r\n    projection = false,\r\n    scale = false,\r\n    legend = false,\r\n    title = '',\r\n    subtitle = '',\r\n    comment = '',\r\n    doZipFile = true\r\n  ) {\r\n    const status$ = new Subject();\r\n    // const resolution = map.ol.getView().getResolution();\r\n    this.activityId = this.activityService.register();\r\n    const translate = this.languageService.translate;\r\n    map.ol.once('rendercomplete', (event: any) => {\r\n      format = format.toLowerCase();\r\n      const oldCanvas = event.target\r\n        .getViewport()\r\n        .getElementsByTagName('canvas')[0];\r\n      const newCanvas = document.createElement('canvas');\r\n      const newContext = newCanvas.getContext('2d');\r\n      // Postion in height to set the canvas in new canvas\r\n      let positionHCanvas = 0;\r\n      // Position in width to set the Proj/Scale in new canvas\r\n      let positionWProjScale = 10;\r\n      // Get height/width of map canvas\r\n      const width = oldCanvas.width;\r\n      let height = oldCanvas.height;\r\n      // Set Font to calculate comment width\r\n      newContext.font = '20px Calibri';\r\n      const commentWidth = newContext.measureText(comment).width;\r\n      // Add height for title if defined\r\n      height = title !== '' ? height + 30 : height;\r\n      // Add height for title if defined\r\n      height = subtitle !== '' ? height + 30 : height;\r\n      // Add height for projection or scale (same line) if defined\r\n      height = projection !== false || scale !== false ? height + 30 : height;\r\n      const positionHProjScale = height - 10;\r\n      // Define number of line depending of the comment length\r\n      const commentNbLine = Math.ceil(commentWidth / width);\r\n      // Add height for multiline comment if defined\r\n      height = comment !== '' ? height + commentNbLine * 30 : height;\r\n      let positionHComment = height - commentNbLine * 20 + 5;\r\n      // Set the new canvas with the new calculated size\r\n      newCanvas.width = width;\r\n      newCanvas.height = height;\r\n      // Patch Jpeg default black background to white\r\n      if (format === 'jpeg') {\r\n        newContext.fillStyle = '#ffffff';\r\n        newContext.fillRect(0, 0, width, height);\r\n        newContext.fillStyle = '#000000';\r\n      }\r\n      // If a title need to be added to canvas\r\n      if (title !== '') {\r\n        // Set font for title\r\n        // Adjust according to title length\r\n        newContext.font = '26px Calibri';\r\n        positionHCanvas = 30;\r\n        newContext.textAlign = 'center';\r\n        newContext.fillText(title, width / 2, 20, width * 0.9);\r\n      }\r\n      if (subtitle !== '') {\r\n        // Set font for subtitle\r\n        // Adjust according to title length\r\n        newContext.font = '26px Calibri';\r\n        positionHCanvas = 60;\r\n        newContext.textAlign = 'center';\r\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\r\n      }\r\n      // Set font for next section\r\n      newContext.font = '20px Calibri';\r\n      // If projection need to be added to canvas\r\n      if (projection !== false) {\r\n        const projText = translate.instant('igo.geo.printForm.projection');\r\n        newContext.textAlign = 'start';\r\n        newContext.fillText(\r\n          projText + ': ' + map.projection,\r\n          positionWProjScale,\r\n          positionHProjScale\r\n        );\r\n        positionWProjScale += 200; // Width position change for scale position\r\n      }\r\n\r\n      // If scale need to be added to canvas\r\n      if (scale !== false) {\r\n        const scaleText = translate.instant('igo.geo.printForm.scale');\r\n        const mapScale = map.viewController.getScale(resolution);\r\n        newContext.textAlign = 'start';\r\n        newContext.fillText(\r\n          scaleText + ': ~ 1 / ' + formatScale(mapScale),\r\n          positionWProjScale,\r\n          positionHProjScale\r\n        );\r\n      }\r\n      // If a comment need to be added to canvas\r\n      if (comment !== '') {\r\n        newContext.textAlign = 'center';\r\n        // If only one line, no need to multiline the comment\r\n        if (commentNbLine === 1) {\r\n          newContext.fillText(comment, width / 2, positionHComment);\r\n        } else {\r\n          // Separate the setenses to be approx. the same length\r\n          const nbCommentChar = comment.length;\r\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\r\n          let commentCurrentLine = '';\r\n          let positionFirstCutChar = 0;\r\n          let positionLastBlank;\r\n          // Loop for the number of line calculated\r\n          for (let i = 0; i < commentNbLine; i++) {\r\n            // For all line except last\r\n            if (commentNbLine - 1 > i) {\r\n              // Get comment current line to find the right place tu cut comment\r\n              commentCurrentLine = comment.substr(\r\n                positionFirstCutChar,\r\n                CommentLengthToCut\r\n              );\r\n              // Cut the setence at blank\r\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\r\n              newContext.fillText(\r\n                commentCurrentLine.substr(0, positionLastBlank),\r\n                width / 2,\r\n                positionHComment\r\n              );\r\n              positionFirstCutChar += positionLastBlank;\r\n              // Go to next line for insertion\r\n              positionHComment += 20;\r\n            } else {\r\n              // Don't cut last part\r\n              newContext.fillText(\r\n                comment.substr(positionFirstCutChar),\r\n                width / 2,\r\n                positionHComment\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n      // Add map to new canvas\r\n      newContext.drawImage(oldCanvas, 0, positionHCanvas);\r\n\r\n      let status = SubjectStatus.Done;\r\n      try {\r\n        // Save the canvas as file\r\n        if (!doZipFile) {\r\n          this.saveCanvasImageAsFile(newCanvas, 'map', format);\r\n        } else if (format.toLowerCase() === 'tiff') {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(\r\n            newCanvas,\r\n            'map' + map.projection.replace(':', '_') + '.' + format\r\n          );\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(newCanvas, 'map' + '.' + format);\r\n        }\r\n      } catch (err) {\r\n        status = SubjectStatus.Error;\r\n      }\r\n\r\n      status$.next(status);\r\n\r\n      if (format.toLowerCase() === 'tiff') {\r\n        const tiwContent = this.getWorldFileInformation(map);\r\n        const blob = new Blob([tiwContent], {\r\n          type: 'text/plain;charset=utf-8'\r\n        });\r\n        if (!doZipFile) {\r\n          // saveAs automaticly replace ':' for '_'\r\n          saveAs(blob, 'map' + map.projection + '.tfw');\r\n          this.saveFileProcessing();\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.addFileToZip(\r\n            'map' + map.projection.replace(':', '_') + '.tfw',\r\n            blob\r\n          );\r\n        }\r\n      }\r\n    });\r\n    map.ol.renderSync();\r\n\r\n    return status$;\r\n  }\r\n\r\n  private renderMap(map, size, extent) {\r\n    map.ol.updateSize();\r\n    map.ol.renderSync();\r\n  }\r\n\r\n  /**\r\n   * Save document\r\n   * @param  doc - Document to save\r\n   */\r\n  protected async saveDoc(doc: jspdf) {\r\n    await doc.save('map.pdf', { returnPromise: true });\r\n  }\r\n\r\n  /**\r\n   * Calculate the best Image size to fit in pdf\r\n   * @param doc - Pdf Document\r\n   * @param canvas - Canvas of image\r\n   * @param margins - Page margins\r\n   */\r\n  private getImageSizeToFitPdf(doc, canvas, margins) {\r\n    // Define variable to calculate best size to fit in one page\r\n    const pageHeight =\r\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2]);\r\n    const pageWidth =\r\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\r\n    const canHeight = canvas.height;\r\n    const canWidth = canvas.width;\r\n    const heightRatio = canHeight / pageHeight;\r\n    const widthRatio = canWidth / pageWidth;\r\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\r\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\r\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\r\n\r\n    return [imgWidth, imgHeigh];\r\n  }\r\n\r\n  /**\r\n   * Get a world file information for tiff\r\n   * @param  map - Map of the app\r\n   */\r\n  private getWorldFileInformation(map) {\r\n    const currentResolution = map.viewController.getResolution();\r\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\r\n    return [\r\n      currentResolution,\r\n      0,\r\n      0,\r\n      -currentResolution,\r\n      currentExtent[0] + currentResolution / 0.5,\r\n      currentExtent[3] - currentResolution / 0.5\r\n    ].join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Save canvas image as file\r\n   * @param canvas - Canvas to save\r\n   * @param name - Name of the file\r\n   * @param format - file format\r\n   */\r\n  private saveCanvasImageAsFile(canvas, name, format) {\r\n    const blobFormat = 'image/' + format;\r\n    const that = this;\r\n\r\n    try {\r\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\r\n      // If navigator is Internet Explorer\r\n      if (navigator.msSaveBlob) {\r\n        navigator.msSaveBlob(canvas.msToBlob(), name + '.' + format);\r\n        this.saveFileProcessing();\r\n      } else {\r\n        canvas.toBlob((blob) => {\r\n          // download image\r\n          saveAs(blob, name + '.' + format);\r\n          that.saveFileProcessing();\r\n        }, blobFormat);\r\n      }\r\n    } catch (err) {\r\n      this.messageService.error(\r\n        this.languageService.translate.instant(\r\n          'igo.geo.printForm.corsErrorMessageBody'\r\n        ),\r\n        this.languageService.translate.instant(\r\n          'igo.geo.printForm.corsErrorMessageHeader'\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add file to a zip\r\n   * @param canvas - File to add to the zip\r\n   * @param  name -Name of the fileoverview\r\n   */\r\n  private generateCanvaFileToZip(canvas, name) {\r\n    const blobFormat = 'image/' + 'jpeg';\r\n    const that = this;\r\n    if (\r\n      !this.hasOwnProperty('zipFile') ||\r\n      typeof this.zipFile === 'undefined'\r\n    ) {\r\n      this.zipFile = new JSZip();\r\n    }\r\n\r\n    try {\r\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\r\n      if (navigator.msSaveBlob) {\r\n        this.addFileToZip(name, canvas.msToBlob());\r\n      } else {\r\n        canvas.toBlob((blob) => {\r\n          that.addFileToZip(name, blob);\r\n        }, blobFormat);\r\n      }\r\n    } catch (err) {\r\n      this.messageService.error(\r\n        this.languageService.translate.instant(\r\n          'igo.geo.printForm.corsErrorMessageBody'\r\n        ),\r\n        this.languageService.translate.instant(\r\n          'igo.geo.printForm.corsErrorMessageHeader'\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add file to zip, if all file are zipped, download\r\n   * @param name - Name of the files\r\n   * @param blob - Contain of file\r\n   */\r\n  private addFileToZip(name, blob) {\r\n    // add file to zip\r\n    this.zipFile.file(name, blob);\r\n    this.nbFileToProcess--;\r\n\r\n    // If all files are proccessed\r\n    if (this.nbFileToProcess === 0) {\r\n      // Download zip file\r\n      this.getZipFile();\r\n      // Stop loading\r\n      this.activityService.unregister(this.activityId);\r\n    }\r\n  }\r\n\r\n  private saveFileProcessing() {\r\n    this.nbFileToProcess--;\r\n\r\n    // If all files are proccessed\r\n    if (this.nbFileToProcess === 0) {\r\n      // Stop loading\r\n      this.activityService.unregister(this.activityId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the zipped file\r\n   * @return Retun a zip file\r\n   */\r\n  private getZipFile() {\r\n    const that = this;\r\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\r\n      // 1) generate the zip file\r\n      saveAs(blob, 'map.zip');\r\n      delete that.zipFile;\r\n    });\r\n  }\r\n}\r\n","import { Layer } from '../shared/layers/layer';\r\nimport { LegendMapViewOptions, OutputLayerLegend } from '../shared/layers/layer.interface';\r\n\r\n/**\r\n * Get all the layers legend\r\n * @return Array of legend\r\n */\r\nexport function getLayersLegends(layers: Layer[], view?: LegendMapViewOptions): OutputLayerLegend[] {\r\n  const legends = [];\r\n\r\n  for (const layer of layers) {\r\n    if (layer.visible === false) { continue; }\r\n\r\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\r\n    for (const legendUrl of legendUrls) {\r\n      if (legendUrl.url === undefined) { continue; }\r\n\r\n      // Add legend info to the list\r\n      legends.push({\r\n        title: layer.title,\r\n        url: legendUrl.url\r\n      });\r\n    }\r\n  }\r\n\r\n  return legends;\r\n}\r\n","import { strEnum } from '@igo2/utils';\r\n\r\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\r\n\r\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\r\n\r\nexport const PrintPaperFormat = strEnum([\r\n  'A0',\r\n  'A1',\r\n  'A2',\r\n  'A3',\r\n  'A4',\r\n  'A5',\r\n  'Letter',\r\n  'Legal'\r\n]);\r\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\r\n\r\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\r\nexport type PrintOrientation = keyof typeof PrintOrientation;\r\n\r\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\r\nexport type PrintResolution = keyof typeof PrintResolution;\r\n\r\nexport const PrintSaveImageFormat = strEnum([\r\n  'Bmp',\r\n  'Gif',\r\n  'Jpeg',\r\n  'Png',\r\n  'Tiff'\r\n]);\r\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\r\n\r\nexport const PrintLegendPosition = strEnum([\r\n  'none',\r\n  'topright',\r\n  'topleft',\r\n  'bottomleft',\r\n  'bottomright',\r\n  'newpage'\r\n]);\r\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\r\n","<form class=\"igo-form\" [formGroup]=\"form\">\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName=\"title\"\r\n        placeholder=\"{{'igo.geo.printForm.title' | translate}}\">\r\n    </mat-form-field>\r\n  </div>\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName=\"subtitle\"\r\n        placeholder=\"{{'igo.geo.printForm.subtitle' | translate}}\">\r\n    </mat-form-field>\r\n  </div>\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName=\"comment\"\r\n        placeholder=\"{{'igo.geo.printForm.comment' | translate}}\">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\">\r\n    <div class=\"print-slide-toggle-container mat-typography\">\r\n      <mat-slide-toggle\r\n        class=\"print-option\"\r\n        formControlName=\"showProjection\"\r\n        [labelPosition]=\"'before'\">\r\n        {{'igo.geo.printForm.showProjection' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class=\"print-option\"\r\n        formControlName=\"showScale\"\r\n        [labelPosition]=\"'before'\">\r\n        {{'igo.geo.printForm.showScale' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class=\"print-option\"\r\n        formControlName=\"doZipFile\"\r\n        [labelPosition]=\"'before'\"\r\n        [style.display]=\"isPrintService ? 'none' : ''\">\r\n        {{'igo.geo.printForm.doZipFile' | translate}}\r\n      </mat-slide-toggle>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName=\"legendPosition\"\r\n        placeholder=\"{{'igo.geo.printForm.legendPosition' | translate}}\">\r\n        <mat-option *ngFor=\"let legendPosition of legendPositions | keyvalue \" [value]=\"legendPosition.key\">\r\n            {{'igo.geo.printForm.legendPositions.' + legendPosition.value | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-select (selectionChange)=\"toggleImageSaveProp()\"\r\n        formControlName=\"outputFormat\"\r\n        placeholder=\"{{'igo.geo.printForm.outputFormat' | translate}}\">\r\n        <mat-option *ngFor=\"let outputFormat of outputFormats | keyvalue \" [value]=\"outputFormat.key\">\r\n            {{outputFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName=\"paperFormat\"\r\n        placeholder=\"{{'igo.geo.printForm.paperFormat' | translate}}\">\r\n        <mat-option *ngFor=\"let paperFormat of paperFormats | keyvalue \" [value]=\"paperFormat.key\">\r\n          {{('igo.geo.printForm.paperFormats.' + paperFormat.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'none' : 'block'\">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName=\"imageFormat\"\r\n        placeholder=\"{{'igo.geo.printForm.imageFormat' | translate}}\">\r\n        <mat-option *ngFor=\"let imageFormat of imageFormats | keyvalue \" [value]=\"imageFormat.key\">\r\n          {{imageFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\" style=\"display: none;\">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName=\"resolution\"\r\n        placeholder=\"{{'igo.geo.printForm.resolution' | translate}}\">\r\n        <mat-option *ngFor=\"let resolution of resolutions | keyvalue \" [value]=\"resolution.key\">\r\n          {{resolution.value + ' PPI'}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName=\"orientation\"\r\n        placeholder=\"{{'igo.geo.printForm.orientation' | translate}}\">\r\n        <mat-option *ngFor=\"let orientation of orientations | keyvalue \" [value]=\"orientation.key\">\r\n          {{('igo.geo.printForm.' + orientation.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-form-button-group print-button-top-padding\">\r\n    <button\r\n      mat-raised-button\r\n      type=\"button\"\r\n      [disabled]=\"!form.valid || (disabled$ | async)\"\r\n      (click)=\"handleFormSubmit(form.value, form.valid)\">\r\n      {{'igo.geo.printForm.saveBtn' | translate}}\r\n    </button>\r\n  </div>\r\n\r\n</form>\r\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\r\nimport {\r\n  FormGroup,\r\n  FormBuilder,\r\n  FormControl,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { PrintOptions } from '../shared/print.interface';\r\n\r\nimport {\r\n  PrintOutputFormat,\r\n  PrintPaperFormat,\r\n  PrintOrientation,\r\n  PrintResolution,\r\n  PrintSaveImageFormat,\r\n  PrintLegendPosition\r\n} from '../shared/print.type';\r\n\r\n@Component({\r\n  selector: 'igo-print-form',\r\n  templateUrl: './print-form.component.html',\r\n  styleUrls: ['./print-form.component.scss']\r\n})\r\nexport class PrintFormComponent implements OnInit {\r\n  public form: FormGroup;\r\n  public outputFormats = PrintOutputFormat;\r\n  public paperFormats = PrintPaperFormat;\r\n  public orientations = PrintOrientation;\r\n  public resolutions = PrintResolution;\r\n  public imageFormats = PrintSaveImageFormat;\r\n  public legendPositions = PrintLegendPosition;\r\n  public isPrintService = true;\r\n\r\n  @Input() disabled$: BehaviorSubject<boolean>;\r\n\r\n  @Input()\r\n  get imageFormat(): PrintSaveImageFormat {\r\n    return this.imageFormatField.value;\r\n  }\r\n  set imageFormat(value: PrintSaveImageFormat) {\r\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get outputFormat(): PrintOutputFormat {\r\n    return this.outputFormatField.value;\r\n  }\r\n  set outputFormat(value: PrintOutputFormat) {\r\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get paperFormat(): PrintPaperFormat {\r\n    return this.paperFormatField.value;\r\n  }\r\n  set paperFormat(value: PrintPaperFormat) {\r\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get orientation(): PrintOrientation {\r\n    return this.orientationField.value;\r\n  }\r\n  set orientation(value: PrintOrientation) {\r\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get resolution(): PrintResolution {\r\n    return this.resolutionField.value;\r\n  }\r\n  set resolution(value: PrintResolution) {\r\n    this.resolutionField.setValue(value || PrintResolution['96'], {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get legendPosition(): PrintLegendPosition {\r\n    return this.legendPositionField.value;\r\n  }\r\n  set legendPosition(value: PrintLegendPosition) {\r\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get title(): string {\r\n    return this.titleField.value;\r\n  }\r\n  set title(value: string) {\r\n    this.titleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get subtitle(): string {\r\n    return this.subtitleField.value;\r\n  }\r\n  set subtitle(value: string) {\r\n    this.subtitleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get comment(): string {\r\n    return this.commentField.value;\r\n  }\r\n  set comment(value: string) {\r\n    this.commentField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showProjection(): boolean {\r\n    return this.showProjectionField.value;\r\n  }\r\n  set showProjection(value: boolean) {\r\n    this.showProjectionField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showScale(): boolean {\r\n    return this.showScaleField.value;\r\n  }\r\n  set showScale(value: boolean) {\r\n    this.showScaleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showLegend(): boolean {\r\n    return this.showLegendField.value;\r\n  }\r\n  set showLegend(value: boolean) {\r\n    this.showLegendField.setValue(value, { onlySelf: true });\r\n  }\r\n\r\n  @Input()\r\n  get doZipFile(): boolean {\r\n    return this.doZipFileField.value;\r\n  }\r\n  set doZipFile(value: boolean) {\r\n    this.doZipFileField.setValue(value, { onlySelf: true });\r\n  }\r\n\r\n  get outputFormatField() {\r\n    return (this.form.controls as any).outputFormat as FormControl;\r\n  }\r\n\r\n  get paperFormatField() {\r\n    return (this.form.controls as any).paperFormat as FormControl;\r\n  }\r\n\r\n  get imageFormatField() {\r\n    return (this.form.controls as any).imageFormat as FormControl;\r\n  }\r\n\r\n  get orientationField() {\r\n    return (this.form.controls as any).orientation as FormControl;\r\n  }\r\n\r\n  get resolutionField() {\r\n    return (this.form.controls as any).resolution as FormControl;\r\n  }\r\n\r\n  get commentField() {\r\n    return (this.form.controls as any).comment as FormControl;\r\n  }\r\n\r\n  get showProjectionField() {\r\n    return (this.form.controls as any).showProjection as FormControl;\r\n  }\r\n\r\n  get showScaleField() {\r\n    return (this.form.controls as any).showScale as FormControl;\r\n  }\r\n\r\n  get showLegendField() {\r\n    return (this.form.controls as any).showLegend as FormControl;\r\n  }\r\n\r\n  get doZipFileField() {\r\n    return (this.form.controls as any).doZipFile as FormControl;\r\n  }\r\n\r\n  get titleField() {\r\n    return (this.form.controls as any).title as FormControl;\r\n  }\r\n\r\n  get subtitleField() {\r\n    return (this.form.controls as any).subtitle as FormControl;\r\n  }\r\n\r\n  get legendPositionField() {\r\n    return (this.form.controls as any).legendPosition as FormControl;\r\n  }\r\n\r\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\r\n\r\n  constructor(private formBuilder: FormBuilder) {\r\n    this.form = this.formBuilder.group({\r\n      title: ['', []],\r\n      subtitle: ['', []],\r\n      comment: ['', []],\r\n      outputFormat: ['', [Validators.required]],\r\n      paperFormat: ['', [Validators.required]],\r\n      imageFormat: [ '', [Validators.required]],\r\n      resolution: ['', [Validators.required]],\r\n      orientation: ['', [Validators.required]],\r\n      legendPosition: ['', [Validators.required]],\r\n      showProjection: false,\r\n      showScale: false,\r\n      showLegend: false,\r\n      doZipFile: [{hidden: this.isPrintService }]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.doZipFileField.setValue(false);\r\n  }\r\n\r\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\r\n    data.isPrintService = this.isPrintService;\r\n    if (isValid) {\r\n      this.submit.emit(data);\r\n    }\r\n  }\r\n\r\n  toggleImageSaveProp() {\r\n    if (this.outputFormatField.value === 'Image') {\r\n      this.isPrintService = false;\r\n    } else {\r\n      this.isPrintService = true;\r\n    }\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { PrintOptions } from '../shared/print.interface';\r\n\r\nimport {\r\n  PrintOutputFormat,\r\n  PrintPaperFormat,\r\n  PrintOrientation,\r\n  PrintResolution,\r\n  PrintSaveImageFormat,\r\n  PrintLegendPosition\r\n} from '../shared/print.type';\r\n\r\nimport { PrintService } from '../shared/print.service';\r\n\r\n@Component({\r\n  selector: 'igo-print',\r\n  templateUrl: './print.component.html'\r\n})\r\nexport class PrintComponent {\r\n  public disabled$ = new BehaviorSubject(false);\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get outputFormat(): PrintOutputFormat {\r\n    return this._outputFormat;\r\n  }\r\n  set outputFormat(value: PrintOutputFormat) {\r\n    this._outputFormat = value;\r\n  }\r\n  private _outputFormat: PrintOutputFormat;\r\n\r\n  @Input()\r\n  get paperFormat(): PrintPaperFormat {\r\n    return this._paperFormat;\r\n  }\r\n  set paperFormat(value: PrintPaperFormat) {\r\n    this._paperFormat = value;\r\n  }\r\n  private _paperFormat: PrintPaperFormat;\r\n\r\n  @Input()\r\n  get orientation(): PrintOrientation {\r\n    return this._orientation;\r\n  }\r\n  set orientation(value: PrintOrientation) {\r\n    this._orientation = value;\r\n  }\r\n  private _orientation: PrintOrientation;\r\n\r\n  @Input()\r\n  get imageFormat(): PrintSaveImageFormat {\r\n    return this._imageFormat;\r\n  }\r\n  set imageFormat(value: PrintSaveImageFormat) {\r\n    this._imageFormat = value;\r\n  }\r\n  private _imageFormat: PrintSaveImageFormat;\r\n\r\n  @Input()\r\n  get legendPosition(): PrintLegendPosition {\r\n    return this._legendPosition;\r\n  }\r\n  set legendPosition(value: PrintLegendPosition) {\r\n    this._legendPosition = value;\r\n  }\r\n  private _legendPosition: PrintLegendPosition;\r\n\r\n  @Input()\r\n  get resolution(): PrintResolution {\r\n    return this._resolution;\r\n  }\r\n  set resolution(value: PrintResolution) {\r\n    this._resolution = value;\r\n  }\r\n  private _resolution: PrintResolution;\r\n\r\n  constructor(private printService: PrintService) {}\r\n\r\n  handleFormSubmit(data: PrintOptions) {\r\n\r\n    this.disabled$.next(true);\r\n\r\n    if (data.isPrintService === true) {\r\n      this.printService\r\n        .print(this.map, data)\r\n        .pipe(take(1))\r\n        .subscribe(() => {\r\n          this.disabled$.next(false);\r\n        });\r\n    } else {\r\n      let nbFileToProcess = 1;\r\n\r\n      if (data.showLegend) {\r\n        nbFileToProcess++;\r\n      }\r\n      if (data.imageFormat.toLowerCase() === 'tiff') {\r\n        nbFileToProcess++;\r\n      }\r\n\r\n      this.printService.defineNbFileToProcess(nbFileToProcess);\r\n\r\n      const resolution = +data.resolution;\r\n\r\n      let nbRequests = data.showLegend ? 2 : 1;\r\n      this.printService\r\n        .downloadMapImage(\r\n          this.map,\r\n          resolution,\r\n          data.imageFormat,\r\n          data.showProjection,\r\n          data.showScale,\r\n          data.showLegend,\r\n          data.title,\r\n          data.subtitle,\r\n          data.comment,\r\n          data.doZipFile\r\n        )\r\n        .pipe(take(1))\r\n        .subscribe(() => {\r\n          nbRequests--;\r\n          if (!nbRequests) {\r\n            this.disabled$.next(false);\r\n          }\r\n        });\r\n      if (data.showLegend) {\r\n        this.printService\r\n          .getLayersLegendImage(\r\n            this.map,\r\n            data.imageFormat,\r\n            data.doZipFile,\r\n            +resolution\r\n          )\r\n          .then(() => {\r\n            nbRequests--;\r\n            if (!nbRequests) {\r\n              this.disabled$.next(false);\r\n            }\r\n          });\r\n      }\r\n    }\r\n  }\r\n}\r\n","<igo-print-form\r\n  [outputFormat]=\"outputFormat\"\r\n  [paperFormat]=\"paperFormat\"\r\n  [orientation]=\"orientation\"\r\n  [imageFormat]=\"imageFormat\"\r\n  [resolution]=\"resolution\"\r\n  [legendPosition]=\"legendPosition\"\r\n  [disabled$]=\"disabled$\"\r\n  (submit)=\"handleFormSubmit($event)\">\r\n</igo-print-form>\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoKeyValueModule } from '@igo2/common';\r\n\r\nimport { PrintComponent } from './print/print.component';\r\nimport { PrintFormComponent } from './print-form/print-form.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatInputModule,\r\n    MatFormFieldModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule,\r\n    IgoKeyValueModule\r\n  ],\r\n  exports: [PrintComponent, PrintFormComponent],\r\n  declarations: [PrintComponent, PrintFormComponent]\r\n})\r\nexport class IgoPrintModule {}\r\n","import { ConfigService } from '@igo2/core';\r\n\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\n\r\nimport { QuerySearchSource } from './query-search-source';\r\n\r\n/**\r\n * Map search source factory\r\n * @ignore\r\n */\r\nexport function querySearchSourceFactory(config: ConfigService) {\r\n  return new QuerySearchSource(\r\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the map search source\r\n */\r\nexport function provideQuerySearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: querySearchSourceFactory,\r\n    multi: true,\r\n    deps: [ConfigService]\r\n  };\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { QueryDirective } from './shared/query.directive';\r\nimport { QueryService } from './shared/query.service';\r\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [QueryDirective],\r\n  declarations: [QueryDirective],\r\n  providers: [QueryService]\r\n})\r\nexport class IgoQueryModule {\r\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\r\n    return {\r\n      ngModule: IgoQueryModule,\r\n      providers: [provideQuerySearchSource()]\r\n    };\r\n  }\r\n}\r\n","import { DirectionsSource } from '../directions-sources/directions-source';\r\n\r\nexport class DirectionsSourceService {\r\n  constructor(public sources: DirectionsSource[]) {}\r\n}\r\n\r\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\r\n  return new DirectionsSourceService(sources);\r\n}\r\n\r\nexport function provideDirectionsSourceService() {\r\n  return {\r\n    provide: DirectionsSourceService,\r\n    useFactory: directionsSourceServiceFactory,\r\n    deps: [DirectionsSource]\r\n  };\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { Message } from '@igo2/core';\r\n\r\nimport { Directions, DirectionsOptions } from '../shared/directions.interface';\r\nimport { DirectionsSource } from '../directions-sources/directions-source';\r\nimport { DirectionsSourceService } from './directions-source.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DirectionsService {\r\n  constructor(private directionsSourceService: DirectionsSourceService) {}\r\n\r\n  route(coordinates: [number, number][], directionsOptions: DirectionsOptions = {}): Observable<Directions[]>[] {\r\n    if (coordinates.length === 0) {\r\n      return;\r\n    }\r\n    return this.directionsSourceService.sources\r\n      .filter((source: DirectionsSource) => source.enabled)\r\n      .map((source: DirectionsSource) => this.routeSource(source, coordinates, directionsOptions));\r\n  }\r\n\r\n  routeSource(\r\n    source: DirectionsSource,\r\n    coordinates: [number, number][],\r\n    directionsOptions: DirectionsOptions = {}\r\n  ): Observable<Directions[]> {\r\n    const request = source.route(coordinates, directionsOptions );\r\n    return request;\r\n  }\r\n}\r\n","import { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { SearchSource } from './sources/source';\r\nimport { SearchResult } from './search.interfaces';\r\n\r\n/**\r\n * Function that checks whether a search source implements TextSearch\r\n * @param source Search source\r\n * @returns True if the search source implements TextSearch\r\n */\r\nexport function sourceCanSearch(source: SearchSource): boolean {\r\n  return (source as any).search !== undefined;\r\n}\r\n\r\n/**\r\n * Function that checks whether a search source implements ReverseSearch\r\n * @param source Search source\r\n * @returns True if the search source implements ReverseSearch\r\n */\r\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\r\n  return (source as any).reverseSearch !== undefined;\r\n}\r\n\r\n/**\r\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\r\n * @param source Search source\r\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\r\n */\r\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\r\n  return (source as any).reverseSearch !== undefined && source.showInPointerSummary === true;\r\n}\r\n\r\n/**\r\n * Return a search result out of an Feature. This is used to adapt\r\n * the IGO query module to the new Feature/SearchResult interfaces\r\n * @param feature feature\r\n * @param source Search source\r\n * @returns SearchResult\r\n */\r\nexport function featureToSearchResult(\r\n  feature: Feature,\r\n  source: SearchSource\r\n): SearchResult<Feature> {\r\n  feature.sourceId = source.getId();\r\n  return {\r\n    source,\r\n    data: feature,\r\n    meta: {\r\n      dataType: FEATURE,\r\n      id: feature.meta.id as string,\r\n      title: feature.meta.title,\r\n      icon: feature.meta.icon || 'map-marker'\r\n    }\r\n  };\r\n}\r\n\r\nexport function findDiff(str1: string, str2: string){\r\n  let diff = '';\r\n  str2.split('').forEach((val, i) => {\r\n    if (val !== str1.charAt(i)) {\r\n      diff += val;\r\n    }\r\n  });\r\n  return diff;\r\n}\r\n\r\n\r\n/**\r\n * Return a score calculation based on \"from\" term with the \"to\" term,\r\n * where the perfect match is 100 and a total difference is 0 or under.\r\n * @param from string\r\n * @param to string\r\n * @param caseSensitive boolean\r\n * @returns number\r\n */\r\nexport function computeTermSimilarity(from, to, caseSensitive: boolean = false): number {\r\n  if (!from || !to) {\r\n    return 0;\r\n  }\r\n  const termFrom = caseSensitive ? from : from.toLowerCase();\r\n  const termTo = caseSensitive ? to : to.toLowerCase();\r\n  const fromToDiff = findDiff(termFrom, termTo);\r\n  const toFromDiff = findDiff(termTo, termFrom);\r\n  const totalDiff = fromToDiff + toFromDiff;\r\n\r\n  let delta = 0;\r\n  if (totalDiff.length) {\r\n    delta =  totalDiff.length / termFrom.length * 100;\r\n  }\r\n\r\n  return 100 - Math.floor(delta);\r\n}\r\n","import { SearchSource } from './sources/source';\r\nimport { SearchSourceSettings } from './sources/source.interfaces';\r\n\r\n/**\r\n * Service where all available search sources are registered.\r\n */\r\nexport class SearchSourceService {\r\n\r\n  constructor(private sources: SearchSource[]) {}\r\n\r\n  /**\r\n   * Return available search sources\r\n   * @returns Search sources\r\n   */\r\n  getSources(): SearchSource[] {\r\n    return this.sources;\r\n  }\r\n\r\n  /**\r\n   * Return enabled search sources\r\n   * @returns Search sources\r\n   */\r\n  getEnabledSources(): SearchSource[] {\r\n    return this.getSources().filter(\r\n      (source: SearchSource) => source.enabled === true\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Enable search sources of given type\r\n   * @param type Search type\r\n   * @todo It would be better to track the enabled search sources\r\n   *  without updating their 'enabled' property.\r\n   */\r\n  enableSourcesByType(type: string) {\r\n    this.getSources().forEach((source: SearchSource) => {\r\n      if ((source.constructor as typeof SearchSource).type === type) {\r\n        source.enabled = true;\r\n      } else {\r\n        source.enabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set Param from the selected settings\r\n   * @param source search-source\r\n   * @param setting settings\r\n   */\r\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\r\n    source.setParamFromSetting(setting);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { stringToLonLat } from '../../map';\r\nimport { MapService } from '../../map/shared/map.service';\r\n\r\nimport { SearchSource, TextSearch, ReverseSearch } from './sources/source';\r\nimport {\r\n  TextSearchOptions,\r\n  ReverseSearchOptions\r\n} from './sources/source.interfaces';\r\nimport { SearchSourceService } from './search-source.service';\r\nimport { Research } from './search.interfaces';\r\nimport {\r\n  sourceCanSearch,\r\n  sourceCanReverseSearch,\r\n  sourceCanReverseSearchAsSummary\r\n} from './search.utils';\r\n\r\n/**\r\n * This service perform researches in all the search sources enabled.\r\n * It returns Research objects who's 'request' property needs to be\r\n * subscribed to in order to trigger the research. This services has\r\n * keeps internal state of the researches it performed\r\n * and the results they yielded.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SearchService {\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private mapService: MapService\r\n  ) {}\r\n\r\n  /**\r\n   * Perform a research by text\r\n   * @param term Any text\r\n   * @returns Researches\r\n   */\r\n  search(term: string, options: TextSearchOptions = {}): Research[] {\r\n    if (!this.termIsValid(term)) {\r\n      return [];\r\n    }\r\n\r\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\r\n    const response = stringToLonLat(term, proj, {\r\n      forceNA: options.forceNA\r\n    });\r\n    if (response.lonLat) {\r\n      return this.reverseSearch(response.lonLat, { distance: response.radius, conf: response.conf });\r\n    } else if (response.message) {\r\n      console.log(response.message);\r\n    }\r\n\r\n    options.extent = this.mapService\r\n      .getMap()\r\n      ?.viewController.getExtent('EPSG:4326');\r\n\r\n    let sources;\r\n\r\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\r\n      sources = this.searchSourceService.getEnabledSources();\r\n    } else {\r\n      sources = this.searchSourceService.getSources();\r\n    }\r\n\r\n    if (options.sourceId) {\r\n      sources = sources.filter((source) => source.getId() === options.sourceId);\r\n    } else if (options.searchType) {\r\n      sources = sources.filter(\r\n        (source) => source.getType() === options.searchType\r\n      );\r\n    }\r\n\r\n    sources = sources.filter(sourceCanSearch);\r\n    return this.searchSources(sources, term, options);\r\n  }\r\n\r\n  /**\r\n   * Perform a research by lon/lat\r\n   * @param lonLat Any lon/lat coordinates\r\n   * @returns Researches\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions,\r\n    asPointerSummary: boolean = false\r\n  ) {\r\n    const reverseSourceFonction = asPointerSummary\r\n      ? sourceCanReverseSearchAsSummary\r\n      : sourceCanReverseSearch;\r\n    const sources = this.searchSourceService\r\n      .getEnabledSources()\r\n      .filter(reverseSourceFonction);\r\n    return this.reverseSearchSources(sources, lonLat, options || {});\r\n  }\r\n\r\n  /**\r\n   * Create a text research out of all given search sources\r\n   * @param sources Search sources that implement TextSearch\r\n   * @param term Search term\r\n   * @returns Observable of Researches\r\n   */\r\n  private searchSources(\r\n    sources: SearchSource[],\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): Research[] {\r\n    return sources.map((source: SearchSource) => {\r\n      return {\r\n        request: ((source as any) as TextSearch).search(term, options),\r\n        reverse: false,\r\n        source\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a reverse research out of all given search sources\r\n   * @param sources Search sources that implement ReverseSearch\r\n   * @param lonLat Any lon/lat coordinates\r\n   * @returns Observable of Researches\r\n   */\r\n  private reverseSearchSources(\r\n    sources: SearchSource[],\r\n    lonLat: [number, number],\r\n    options: ReverseSearchOptions\r\n  ): Research[] {\r\n    return sources.map((source: SearchSource) => {\r\n      return {\r\n        request: ((source as any) as ReverseSearch).reverseSearch(\r\n          lonLat,\r\n          options\r\n        ),\r\n        reverse: true,\r\n        source\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validate that a search term is valid\r\n   * @param term Search term\r\n   * @returns True if the search term is valid\r\n   */\r\n  private termIsValid(term: string): boolean {\r\n    return typeof term === 'string' && term !== '';\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Stop } from '../shared/directions.interface';\r\n\r\n@Injectable()\r\nexport class DirectionsFormService {\r\n  private stops: Stop[];\r\n\r\n  constructor() {}\r\n\r\n  getStopsCoordinates(): [number, number][] {\r\n    const stopsCoordinates = [];\r\n    if (this.stops) {\r\n      this.stops.forEach(stop => {\r\n        stopsCoordinates.push(stop.stopCoordinates);\r\n      });\r\n    }\r\n    return stopsCoordinates;\r\n  }\r\n\r\n  setStops(stops: Stop[]) {\r\n    this.stops = stops;\r\n  }\r\n\r\n  getStops() {\r\n    return this.stops;\r\n  }\r\n\r\n}\r\n","<form class=\"igo-form\" [formGroup]=\"stopsForm\">\r\n  <!-- <div class=\"igo-form-button-group\">\r\n\r\n  </div> -->\r\n  <div #inputs formArrayName=\"stops\" *ngFor=\"let stop of stops.controls; let i = index;\">\r\n    <mat-list-item [formGroupName]=\"i\">\r\n\r\n      <div class=\"igo-input-container\">\r\n        <button *ngIf=\"map.geolocationFeature\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.geolocate' | translate\" (click)=\"geolocateStop(i)\">\r\n          <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\r\n        </button>\r\n        <mat-form-field>\r\n          <input matInput formControlName=\"stopPoint\" [matAutocomplete]=\"auto\"\r\n            placeholder=\"{{'igo.geo.directionsForm.'+stop.value.directionsText | translate}}\" (focus)=\"focus(i)\"\r\n            (keyup)=\"keyup(i,$event)\" (keydown.enter)=\"prevent($event)\">\r\n            <button \r\n              mat-button \r\n              *ngIf=\"stop.value && (stop.value.stopPoint.length > 0 || stop.value.stopProposals.length > 0)\"\r\n              matSuffix mat-icon-button color=\"warn\" aria-label=\"Clear\" (click)=\"clearStop(i)\">\r\n              <mat-icon svgIcon=\"close\"></mat-icon>\r\n            </button>\r\n\r\n          <mat-autocomplete #auto=\"matAutocomplete\">\r\n            <mat-optgroup *ngFor=\"let source of stop.value.stopProposals\" [label]=\"source.source.title\" [disabled]=\"source.source.enabled === false\">\r\n              <mat-option *ngFor=\"let result of source.results\" [value]=\"result.meta ? result.meta.title : ''\" \r\n              (onSelectionChange)=\"chooseProposal(result,i)\"\r\n              matTooltipShowDelay=\"500\" [matTooltip]=\"result.meta ? result.meta.title : ''\">\r\n                {{ result.meta ? result.meta.title : '' }}\r\n              </mat-option>\r\n            </mat-optgroup>\r\n          </mat-autocomplete>\r\n        </mat-form-field>\r\n\r\n        <!-- <div class=\"igo-form-button-group\"> -->\r\n\r\n\r\n          <!-- <button *ngIf=\"i !== 0\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.raiseStop' | translate\"\r\n            [color]=\"color\" (click)=\"raiseStop(i)\">\r\n            <mat-icon svgIcon=\"arrow-upward\"></mat-icon>\r\n          </button>\r\n          <button *ngIf=\"i !== stops.length - 1\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.lowerStop' | translate\"\r\n            [color]=\"color\" (click)=\"lowerStop(i)\">\r\n            <mat-icon svgIcon=\"arrow-downward\"></mat-icon>\r\n          </button> -->\r\n\r\n          <button *ngIf=\"i !== 0 && i !== stops.length - 1\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\"\r\n            color=\"warn\" (click)=\"removeStop(i)\">\r\n            <mat-icon svgIcon=\"delete\"></mat-icon>\r\n          </button>\r\n        <!-- </div> -->\r\n      </div>\r\n\r\n    </mat-list-item>\r\n  </div>\r\n  <div class=\"igo-form-button-group\">\r\n    <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\" color=\"primary\" (click)=\"addStop()\">\r\n      <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\" *ngIf=\"routesResults\" color=\"primary\"\r\n      (click)=\"zoomRoute()\">\r\n      <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\" *ngIf=\"routesResults\" color=\"warn\"\r\n      (click)=\"resetForm(true)\">\r\n      <mat-icon svgIcon=\"file-restore\"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf=\"routesResults\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\" color=\"primary\" (click)=\"copyDirectionsToClipboard()\">\r\n      <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf=\"routesResults\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.directionsForm.link' | translate\" color=\"primary\" (click)=\"copyLinkToClipboard()\">\r\n      <mat-icon svgIcon=\"link\"></mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n</form>\r\n\r\n<div class=\"igo-input-container\" *ngIf=\"routesResults\">\r\n  <mat-form-field *ngIf=\"routesResults && routesResults.length > 1\">\r\n    <mat-select placeholder=\"{{'igo.geo.directionsForm.drivingOptions' | translate}}\" (selectionChange)=\"changeRoute()\" [(ngModel)]=\"activeRoute\">\r\n      <mat-option *ngFor=\"let pathDirections of routesResults; let cnt = index;\" [value]=\"pathDirections\">\r\n        Option {{cnt + 1}} : {{formatDistance(pathDirections.distance)}} ({{formatDuration(pathDirections.duration)}})\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n\r\n  <mat-divider *ngIf=\"routesResults && routesResults.length === 0\"></mat-divider>\r\n\r\n  <mat-list>\r\n    <h2 mat-header class=\"igo-route-title mat-typography\">{{activeRoute.title}}</h2>\r\n    <h2 mat-subheader>{{formatDistance(activeRoute.distance)}}, {{formatDuration(activeRoute.duration)}}</h2>\r\n\r\n    <mat-list-item \r\n    class=\"igo-steps\"\r\n    (mouseenter)=\"showSegment(step)\" \r\n    (click)=\"showSegment(step,true)\" \r\n    *ngFor=\"let step of activeRoute.steps; let cnt = index;\"\r\n      igoListItem>\r\n      <mat-icon [ngClass]=\"formatStep(step,cnt).cssClass\" mat-list-icon svgIcon=\"{{formatStep(step,cnt).image}}\"></mat-icon>\r\n\r\n      <h4 mat-line>{{cnt +1}}. {{formatStep(step,cnt).instruction}}</h4>\r\n      <h4 mat-line class=\"right\">{{formatDistance(step.distance)}}</h4>\r\n    </mat-list-item>\r\n\r\n    <mat-divider></mat-divider>\r\n\r\n  </mat-list>\r\n\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit,\r\n  OnDestroy,\r\n  Optional,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { FormGroup, FormBuilder, Validators, FormArray } from '@angular/forms';\r\nimport { Subscription, Subject, BehaviorSubject } from 'rxjs';\r\nimport {\r\n  debounceTime,\r\n  distinctUntilChanged,\r\n  map\r\n} from 'rxjs/operators';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport * as olgeom from 'ol/geom';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olstyle from 'ol/style';\r\nimport * as olcondition from 'ol/events/condition';\r\nimport * as olinteraction from 'ol/interaction';\r\nimport * as olobservable from 'ol/Observable';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { Clipboard } from '@igo2/utils';\r\nimport {\r\n  Message,\r\n  LanguageService,\r\n  MessageService,\r\n  RouteService\r\n} from '@igo2/core';\r\nimport { getEntityTitle } from '@igo2/common';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { SearchService } from '../../search/shared/search.service';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\r\nimport {\r\n  moveToOlFeatures,\r\n  tryBindStoreLayer\r\n} from '../../feature/shared/feature.utils';\r\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\r\n\r\nimport { Directions, DirectionsOptions, Stop } from '../shared/directions.interface';\r\nimport { DirectionsService } from '../shared/directions.service';\r\nimport { DirectionsFormService } from './directions-form.service';\r\n\r\nimport { QueryService } from '../../query/shared/query.service';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport { Feature, FeatureGeometry } from '../../feature/shared/feature.interfaces';\r\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\r\nimport { roundCoordTo } from '../../map/shared/map.utils';\r\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\r\n\r\n@Component({\r\n  selector: 'igo-directions-form',\r\n  templateUrl: './directions-form.component.html',\r\n  styleUrls: ['./directions-form.component.scss']\r\n})\r\nexport class DirectionsFormComponent implements OnInit, OnDestroy {\r\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\r\n\r\n  private subscriptions$$: Subscription[] = [];\r\n\r\n  public stopsForm: FormGroup;\r\n  public projection = 'EPSG:4326';\r\n  public currentStopIndex: number;\r\n  public routesQueries$$: Subscription[] = [];\r\n  private search$$: Subscription;\r\n  private selectStop;\r\n  private translateStop;\r\n  private selectedRoute;\r\n\r\n  private stream$ = new Subject<string>();\r\n\r\n  public routesResults: Directions[] | Message[];\r\n  get activeRoute(): Directions {\r\n    return this._activeRoute;\r\n  }\r\n  set activeRoute(value: Directions) {\r\n    this._activeRoute = value;\r\n    if (value && this.activeRoute$.getValue() && value.id !== this.activeRoute$.getValue().id) {\r\n      this.activeRoute$.next(value);\r\n    }\r\n    this.activeRouteDescription.emit(this.directionsToText());\r\n  }\r\n  private _activeRoute: Directions;\r\n  public activeRoute$: BehaviorSubject<Directions> = new BehaviorSubject(undefined);\r\n  private lastTimeoutRequest;\r\n\r\n  private focusOnStop = false;\r\n  private focusKey = [];\r\n  public initialStopsCoords;\r\n  private browserLanguage;\r\n\r\n  @Input() term: string;\r\n\r\n  @Input() debounce: number = 200;\r\n\r\n  @Input() length: number = 2;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The stops store\r\n   */\r\n  @Input()\r\n  get stopsStore(): FeatureStore {\r\n    return this._stopsStore;\r\n  }\r\n  set stopsStore(value: FeatureStore) {\r\n    this._stopsStore = value;\r\n    this.stopsStore$.next(value);\r\n  }\r\n  private _stopsStore: FeatureStore;\r\n\r\n  stopsStore$: BehaviorSubject<FeatureStore> = new BehaviorSubject<FeatureStore>(undefined);\r\n\r\n  @Input()\r\n  get routeFromFeatureDetail(): boolean {\r\n    return this._routeFromFeatureDetail;\r\n  }\r\n  set routeFromFeatureDetail(value: boolean) {\r\n    this._routeFromFeatureDetail = value;\r\n  }\r\n  private _routeFromFeatureDetail: boolean;\r\n\r\n  /**\r\n   * The route and vertex store\r\n   */\r\n  @Input() routeStore: FeatureStore;\r\n\r\n  @Output() activeRouteDescription = new EventEmitter<string>();\r\n  constructor(\r\n    private formBuilder: FormBuilder,\r\n    private directionsService: DirectionsService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private searchService: SearchService,\r\n    private queryService: QueryService,\r\n    private directionsFormService: DirectionsFormService,\r\n    private changeDetectorRefs: ChangeDetectorRef,\r\n    @Optional() private route: RouteService\r\n  ) {}\r\n\r\n  changeRoute() {\r\n    this.showRouteGeometry(true);\r\n  }\r\n\r\n  prevent(event) {\r\n    event.preventDefault();\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.queryService.queryEnabled = false;\r\n    this.focusOnStop = false;\r\n    this.browserLanguage = this.languageService.getLanguage();\r\n    this.stopsForm = this.formBuilder.group({\r\n      directionsType: 'car',\r\n      directionsMode: 'driving', // loop\r\n      stopOrderPriority: true,\r\n      directionsFixedStartEnd: false,\r\n      stops: this.formBuilder.array([\r\n        this.createStop('start'),\r\n        this.createStop('end')\r\n      ])\r\n    });\r\n\r\n    setTimeout(() => {\r\n      this.initStores();\r\n      this.initOlInteraction();\r\n    }, 1);\r\n\r\n    this.subscribeToFormChange();\r\n    this.routesQueries$$.push(\r\n      this.stream$\r\n        .pipe(\r\n          debounceTime(this.debounce),\r\n          distinctUntilChanged()\r\n        )\r\n        .subscribe((term: string) => this.handleTermChanged(term))\r\n    );\r\n\r\n    this.stopsStore$.subscribe(() => {\r\n      if (this.routeFromFeatureDetail === true) {\r\n        this.directionsFormService.setStops([]);\r\n        setTimeout(() => {\r\n          this.resetForm(false);\r\n          for (const feature of this.stopsStore.all()) {\r\n            if (feature.properties.id && feature.properties.id.toString().startsWith('directionsStop')) {\r\n              this.stopsStore.delete(feature);\r\n            }\r\n          }\r\n\r\n          if (this.stopsStore.all().length === 2) {\r\n            let i = 0;\r\n            const coordinates = [];\r\n\r\n            for (const feature of this.stopsStore.all()) {\r\n              coordinates.push(feature.geometry.coordinates);\r\n              this.handleLocationProposals(feature.geometry.coordinates, i);\r\n              this.chooseProposal(feature, i);\r\n              i++;\r\n            }\r\n            this.writeStopsToFormService(coordinates);\r\n\r\n            const routeResponse = this.directionsService.route(coordinates, {});\r\n            if (routeResponse) {\r\n              routeResponse.map(res =>\r\n                this.routesQueries$$.push(\r\n                  res.subscribe(route => {\r\n                    this.routesResults = route;\r\n                    this.activeRoute = this.routesResults[0] as Directions;\r\n                    this.showRouteGeometry(true);\r\n                    this.changeDetectorRefs.detectChanges();\r\n                  })\r\n                )\r\n              );\r\n            }\r\n\r\n          } else if (this.stopsStore.all().length === 1) {\r\n            this.handleLocationProposals(this.stopsStore.all()[0].geometry.coordinates, 1);\r\n            this.chooseProposal(this.stopsStore.all()[0], 1);\r\n            this.writeStopsToFormService(this.stopsStore.all()[0].geometry.coordinates);\r\n          }\r\n        }, 1);\r\n        this.routeFromFeatureDetail = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.unsubscribeRoutesQueries();\r\n    this.unlistenSingleClick();\r\n    this.queryService.queryEnabled = true;\r\n    this.freezeStores();\r\n    this.writeStopsToFormService();\r\n    this.subscriptions$$.map(s => s.unsubscribe());\r\n  }\r\n\r\n  private initStores() {\r\n    const loadingStrategy = new FeatureStoreLoadingStrategy({\r\n      motion: FeatureMotion.None\r\n    });\r\n\r\n    // STOP STORE\r\n    const stopsStore = this.stopsStore;\r\n    const stopsLayer = new VectorLayer({\r\n      id: 'igo-direction-stops-layer',\r\n      title: this.languageService.translate.instant('igo.geo.directionsForm.stopLayer'),\r\n      zIndex: 911,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: true,\r\n      workspace: {\r\n        enabled: false,\r\n      },\r\n      linkedLayers: {\r\n        linkId: 'igo-direction-stops-layer',\r\n        links: [\r\n          {\r\n            bidirectionnal: false,\r\n            syncedDelete: true,\r\n            linkedIds: ['igo-direction-route-layer'],\r\n            properties: []\r\n          }\r\n        ]\r\n      },\r\n      exportable: true,\r\n      browsable: false,\r\n      style: stopMarker\r\n    });\r\n    tryBindStoreLayer(stopsStore, stopsLayer);\r\n    stopsStore.layer.visible = true;\r\n    tryAddLoadingStrategy(stopsStore, loadingStrategy);\r\n\r\n    // ROUTE AND VERTEX STORE\r\n    const routeStore = this.routeStore;\r\n    const routeLayer = new VectorLayer({\r\n      id: 'igo-direction-route-layer',\r\n      title: this.languageService.translate.instant('igo.geo.directionsForm.routeLayer'),\r\n      zIndex: 910,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: true,\r\n      workspace: {\r\n        enabled: false,\r\n      },\r\n      linkedLayers: {\r\n        linkId: 'igo-direction-route-layer'\r\n      },\r\n      exportable: true,\r\n      browsable: false,\r\n      style: stopMarker\r\n    });\r\n    tryBindStoreLayer(routeStore, routeLayer);\r\n    routeStore.layer.visible = true;\r\n    tryAddLoadingStrategy(routeStore, loadingStrategy);\r\n\r\n    this.subscriptions$$.push(this.stopsStore.count$.subscribe(cnt => {\r\n      cnt >= 1 ?\r\n        this.stopsStore.layer.options.showInLayerList = true :\r\n        this.stopsStore.layer.options.showInLayerList = false;\r\n    }));\r\n\r\n    this.subscriptions$$.push(this.routeStore.count$.subscribe(cnt => {\r\n      cnt >= 1 ?\r\n        this.routeStore.layer.options.showInLayerList = true :\r\n        this.routeStore.layer.options.showInLayerList = false;\r\n    }));\r\n  }\r\n\r\n  private initOlInteraction() {\r\n    let selectedStopFeature;\r\n    this.selectStop = new olinteraction.Select({\r\n      layers: [this.stopsStore.layer.ol],\r\n      condition: olcondition.pointerMove,\r\n      hitTolerance: 7,\r\n      filter: feature => {\r\n        return feature.get('type') === 'stop';\r\n      }\r\n    });\r\n\r\n    this.selectStop.on('select', evt => {\r\n      selectedStopFeature = evt.target.getFeatures()[0];\r\n    });\r\n\r\n    this.translateStop = new olinteraction.Translate({\r\n      layers: [this.stopsStore.layer.ol],\r\n      features: selectedStopFeature\r\n      // TODO In Openlayers >= 6.x, filter is now allowed.\r\n    });\r\n\r\n    this.translateStop.on('translating', evt => {\r\n      const features = evt.features;\r\n      if (features.getLength() === 0) {\r\n        return;\r\n      }\r\n      this.executeTranslation(features, false, 50, true);\r\n    });\r\n\r\n    this.translateStop.on('translateend', evt => {\r\n      const features = evt.features;\r\n      if (features.getLength() === 0) {\r\n        return;\r\n      }\r\n      this.executeTranslation(features, true, 0, false);\r\n    });\r\n\r\n    this.selectedRoute = new olinteraction.Select({\r\n      layers: [this.routeStore.layer.ol],\r\n      condition: olcondition.click,\r\n      hitTolerance: 7,\r\n      filter: feature => {\r\n        return feature.getId() === 'route';\r\n      }\r\n    });\r\n    this.selectedRoute.on('select', evt => {\r\n      if (this.focusOnStop === false) {\r\n        const selectCoordinates = olproj.transform(\r\n          (evt as any).mapBrowserEvent.coordinate,\r\n          this.map.projection,\r\n          this.projection\r\n        );\r\n        this.addStop();\r\n        const pos = this.stops.length - 2;\r\n        this.stops.at(pos).patchValue({ stopCoordinates: selectCoordinates });\r\n        this.handleLocationProposals(selectCoordinates as [number, number], pos);\r\n        this.addStopOverlay(selectCoordinates as [number, number], pos);\r\n        this.selectedRoute.getFeatures().clear();\r\n      }\r\n      this.selectedRoute.getFeatures().clear();\r\n    });\r\n\r\n    this.map.ol.addInteraction(this.selectStop);\r\n    this.map.ol.addInteraction(this.translateStop);\r\n    this.map.ol.addInteraction(this.selectedRoute);\r\n  }\r\n\r\n  private subscribeToFormChange() {\r\n    this.routesQueries$$.push(\r\n      this.stopsForm.valueChanges\r\n        .pipe(debounceTime(this.debounce))\r\n        .subscribe(val => {\r\n          this.writeStopsToFormService();\r\n        })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\r\n   * and some listener removed\r\n   * @internal\r\n   */\r\n  private freezeStores() {\r\n    const stopsStore = this.stopsStore;\r\n    const routeStore = this.routeStore;\r\n\r\n    this.map.ol.removeInteraction(this.selectStop);\r\n    this.map.ol.removeInteraction(this.translateStop);\r\n    this.map.ol.removeInteraction(this.selectedRoute);\r\n    stopsStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n    routeStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n  }\r\n\r\n  private executeTranslation(\r\n    features,\r\n    reverseSearchProposal = false,\r\n    delay: number = 0,\r\n    overview: boolean = false\r\n  ) {\r\n    this.routeStore.clear();\r\n    const firstFeature = features.getArray()[0];\r\n    const translatedID = firstFeature.getId();\r\n    const translatedPos = translatedID.split('_');\r\n    let p;\r\n    switch (translatedPos[1]) {\r\n      case 'start':\r\n        p = 0;\r\n        break;\r\n      case 'end':\r\n        p = this.stops.length - 1;\r\n        break;\r\n      default:\r\n        p = Number(translatedPos[1]);\r\n        break;\r\n    }\r\n    const translationCoordinates = olproj.transform(\r\n      firstFeature.getGeometry().getCoordinates(),\r\n      this.map.projection,\r\n      this.projection\r\n    );\r\n    this.stops\r\n      .at(p)\r\n      .patchValue({\r\n        stopCoordinates: translationCoordinates,\r\n        stopProposals: []\r\n      });\r\n    if (reverseSearchProposal) {\r\n      this.handleLocationProposals(translationCoordinates as [number, number], p);\r\n    }\r\n\r\n    const directionsOptions = {\r\n      steps: true,\r\n      overview: false,\r\n      alternatives: true\r\n    } as DirectionsOptions;\r\n\r\n    if (overview) {\r\n      directionsOptions.overview = true;\r\n      directionsOptions.steps = false;\r\n      directionsOptions.alternatives = false;\r\n    }\r\n\r\n    if (delay > 0) {\r\n      if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n        // cancel timeout when the mouse moves\r\n        clearTimeout(this.lastTimeoutRequest);\r\n      }\r\n      this.lastTimeoutRequest = setTimeout(() => {\r\n        this.getRoutes(undefined, directionsOptions);\r\n      }, delay);\r\n    } else {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n      this.getRoutes(undefined, directionsOptions);\r\n    }\r\n  }\r\n\r\n  handleLocationProposals(coordinates: [number, number], stopIndex: number) {\r\n    const groupedLocations = [];\r\n    const roundedCoordinates = [\r\n      coordinates[0].toFixed(5),\r\n      coordinates[1].toFixed(5)\r\n    ];\r\n    this.stops\r\n      .at(stopIndex)\r\n      .patchValue({ stopPoint: roundedCoordinates.join(',') });\r\n    this.searchService\r\n      .reverseSearch(coordinates, { zoom: this.map.viewController.getZoom() })\r\n      .map(res =>\r\n        this.routesQueries$$.push(\r\n          res.request.pipe(map(f => f)).subscribe(results => {\r\n            results.forEach(result => {\r\n              if (\r\n                groupedLocations.filter(f => f.source === result.source)\r\n                  .length === 0\r\n              ) {\r\n                groupedLocations.push({\r\n                  source: result.source,\r\n                  results: results.map(r => r.data)\r\n                });\r\n              }\r\n            });\r\n            this.stops\r\n              .at(stopIndex)\r\n              .patchValue({ stopProposals: groupedLocations });\r\n            // TODO: Prefer another source?\r\n            if (results[0]) {\r\n              if (results[0].source.getId() === 'icherchereverse') {\r\n                // prefer address type.\r\n                let resultPos = 0;\r\n                for (let i = 0; i < results.length; i++) {\r\n                  const feature: any = results[i].data;\r\n                  if (feature.properties.type === 'adresses') {\r\n                    resultPos = i;\r\n                    break;\r\n                  }\r\n                }\r\n                this.stops.at(stopIndex).patchValue({\r\n                  stopPoint: getEntityTitle(results[resultPos])\r\n                });\r\n                if (results[resultPos].data.geometry.type === 'Point') {\r\n                  this.stops.at(stopIndex).patchValue({\r\n                    stopCoordinates:\r\n                      results[resultPos].data.geometry.coordinates\r\n                  });\r\n                } else {\r\n                  // Not moving the translated point Only to suggest value into the UI.\r\n                }\r\n              } else if (results[0].source.getId() === 'coordinatesreverse') {\r\n                this.stops.at(stopIndex).patchValue({\r\n                  stopPoint: [\r\n                    results[0].data.geometry.coordinates[0].toFixed(5),\r\n                    results[0].data.geometry.coordinates[1].toFixed(5)\r\n                  ].join(',')\r\n                });\r\n                if (results[0].data.geometry.type === 'Point') {\r\n                  this.stops.at(stopIndex).patchValue({\r\n                    stopCoordinates: results[0].data.geometry.coordinates\r\n                  });\r\n                } else {\r\n                  // Not moving the translated point Only to suggest value into the UI.\r\n                }\r\n              }\r\n            } else {\r\n              this.stops\r\n                .at(stopIndex)\r\n                .patchValue({\r\n                  stopPoint: roundedCoordinates.join(','),\r\n                  stopProposals: []\r\n                });\r\n            }\r\n            this.changeDetectorRefs.detectChanges();\r\n          })\r\n        )\r\n      );\r\n  }\r\n\r\n  directionsText(index: number, stopsCounts = this.stops.length): string {\r\n    if (index === 0) {\r\n      return 'start';\r\n    } else if (index === stopsCounts - 1 || stopsCounts === 1) {\r\n      return 'end';\r\n    } else {\r\n      return 'intermediate';\r\n    }\r\n  }\r\n\r\n  raiseStop(index: number) {\r\n    if (index > 0) {\r\n      this.moveStop(index, -1);\r\n    }\r\n  }\r\n\r\n  lowerStop(index: number) {\r\n    if (index < this.stops.length - 1) {\r\n      this.moveStop(index, 1);\r\n    }\r\n  }\r\n\r\n  private moveStop(index, diff) {\r\n    const fromValue = this.stops.at(index);\r\n    this.removeStop(index);\r\n    this.stops.insert(index + diff, fromValue);\r\n    this.stops\r\n      .at(index)\r\n      .patchValue({ directionsText: this.directionsText(index) });\r\n    this.stops\r\n      .at(index + diff)\r\n      .patchValue({ directionsText: this.directionsText(index + diff) });\r\n    if (this.stops.at(index).value.stopCoordinates) {\r\n      this.addStopOverlay(this.stops.at(index).value.stopCoordinates, index);\r\n    }\r\n    if (this.stops.at(index + diff).value.stopCoordinates) {\r\n      this.addStopOverlay(\r\n        this.stops.at(index + diff).value.stopCoordinates,\r\n        index + diff\r\n      );\r\n    }\r\n  }\r\n\r\n  get stops(): FormArray {\r\n    return this.stopsForm.get('stops') as FormArray;\r\n  }\r\n\r\n  public writeStopsToFormService(stopsArray?) {\r\n    if (stopsArray) {\r\n      this.directionsFormService.setStops(stopsArray);\r\n    } else {\r\n      const stops = [];\r\n      this.stops.value.forEach(stop => {\r\n        if (stop.stopCoordinates instanceof Array) {\r\n          stops.push(stop);\r\n        }\r\n      });\r\n      this.directionsFormService.setStops(stops);\r\n    }\r\n  }\r\n\r\n  addStop(): void {\r\n    const insertIndex = this.stops.length - 1;\r\n    this.stops.insert(insertIndex, this.createStop());\r\n  }\r\n\r\n  createStop(directionsPos = 'intermediate'): FormGroup {\r\n    return this.formBuilder.group({\r\n      stopPoint: [''],\r\n      stopProposals: [[]],\r\n      directionsText: directionsPos,\r\n      stopCoordinates: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  removeStop(index: number): void {\r\n    const id = this.getStopOverlayID(index);\r\n    this.deleteStoreFeatureByID(this.stopsStore, id);\r\n    this.stops.removeAt(index);\r\n    let cnt = 0;\r\n    this.stops.value.forEach(stop => {\r\n      this.stops\r\n        .at(cnt)\r\n        .patchValue({ directionsText: this.directionsText(cnt) });\r\n      this.addStopOverlay(this.stops.at(cnt).value.stopCoordinates, cnt);\r\n      cnt++;\r\n    });\r\n  }\r\n\r\n  resetForm(stop: boolean) {\r\n    this.routesResults = undefined;\r\n    const nbStops = this.stops.length;\r\n    for (let i = 0; i < nbStops; i++) {\r\n      this.stops.removeAt(0);\r\n    }\r\n    this.stops.insert(0, this.createStop('start'));\r\n    this.stops.insert(1, this.createStop('end'));\r\n\r\n    if (stop === true) {\r\n      this.stopsStore.clear();\r\n    }\r\n    this.routeStore.clear();\r\n  }\r\n\r\n  formatStep(step, cnt) {\r\n    return this.formatInstruction(\r\n      step.maneuver.type,\r\n      step.maneuver.modifier,\r\n      step.name,\r\n      step.maneuver.bearing_after,\r\n      cnt,\r\n      step.maneuver.exit,\r\n      cnt === this.activeRoute.steps.length - 1\r\n    );\r\n  }\r\n\r\n  formatInstruction(\r\n    type,\r\n    modifier,\r\n    route,\r\n    direction,\r\n    stepPosition,\r\n    exit,\r\n    lastStep = false\r\n  ) {\r\n    let directiveFr;\r\n    let directiveEn;\r\n    let image = 'forward';\r\n    let cssClass = 'rotate-270';\r\n    const translatedDirection = this.translateBearing(direction);\r\n    const translatedModifier = this.translateModifier(modifier);\r\n    const enPrefix = modifier === 'straight' ? '' : 'on the ';\r\n    const frPrefix = modifier === 'straight' ? '' : ' ';\r\n\r\n    let frAggregatedDirection = frPrefix + translatedModifier;\r\n    let enAggregatedDirection = enPrefix + translatedModifier;\r\n\r\n    if (modifier && modifier.search('slight') >= 0) {\r\n      enAggregatedDirection = translatedModifier;\r\n    }\r\n\r\n    if (modifier === 'uturn') {\r\n      image = 'forward';\r\n      cssClass = 'rotate-90';\r\n    } else if (modifier === 'sharp right') {\r\n      image = 'subdirectory-arrow-right';\r\n      cssClass = 'icon-flipped';\r\n    } else if (modifier === 'right') {\r\n      image = 'subdirectory-arrow-right';\r\n      cssClass = 'icon-flipped';\r\n    } else if (modifier === 'slight right') {\r\n      image = 'forward';\r\n      cssClass = 'rotate-290';\r\n    } else if (modifier === 'straight') {\r\n      image = 'forward';\r\n    } else if (modifier === 'slight left') {\r\n      image = 'forward';\r\n      cssClass = 'rotate-250';\r\n    } else if (modifier === 'left') {\r\n      image = 'subdirectory-arrow-left';\r\n      cssClass = 'icon-flipped';\r\n    } else if (modifier === 'sharp left') {\r\n      image = 'subdirectory-arrow-left';\r\n      cssClass = 'icon-flipped';\r\n    }\r\n\r\n    if (type === 'turn') {\r\n      if (modifier === 'straight') {\r\n        directiveFr = 'Continuer sur ' + route;\r\n        directiveEn = 'Continue on ' + route;\r\n      } else if (modifier === 'uturn') {\r\n        directiveFr = 'Faire demi-tour sur ' + route;\r\n        directiveEn = 'Make u-turn on ' + route;\r\n      } else {\r\n        directiveFr = 'Tourner ' + frAggregatedDirection + ' sur ' + route;\r\n        directiveEn = 'Turn ' + translatedModifier + ' onto ' + route;\r\n      }\r\n    } else if (type === 'new name') {\r\n      directiveFr =\r\n        'Continuer en direction ' + translatedDirection + ' sur ' + route;\r\n      directiveEn = 'Head ' + translatedDirection + ' on ' + route;\r\n      image = 'compass';\r\n      cssClass = '';\r\n    } else if (type === 'depart') {\r\n      directiveFr =\r\n        'Aller en direction ' + translatedDirection + ' sur ' + route;\r\n      directiveEn = 'Head ' + translatedDirection + ' on ' + route;\r\n      image = 'compass';\r\n      cssClass = '';\r\n    } else if (type === 'arrive') {\r\n      if (lastStep) {\r\n        let coma = ', ';\r\n        if (!translatedModifier) {\r\n          frAggregatedDirection = '';\r\n          enAggregatedDirection = '';\r\n          coma = '';\r\n        }\r\n        directiveFr = 'Vous tes arriv' + coma + frAggregatedDirection;\r\n        directiveEn =\r\n          'You have reached your destination' + coma + enAggregatedDirection;\r\n      } else {\r\n        directiveFr = 'Vous atteignez le point intermdiare sur ' + route;\r\n        directiveEn = 'You have reached the intermediate stop onto ' + route;\r\n        image = 'map-marker';\r\n        cssClass = '';\r\n      }\r\n    } else if (type === 'merge') {\r\n      directiveFr = 'Continuer sur ' + route;\r\n      directiveEn = 'Continue on ' + route;\r\n      image = 'forward';\r\n      cssClass = 'rotate-270';\r\n    } else if (type === 'on ramp') {\r\n      directiveFr = \"Prendre l'entre d'autoroute \" + frAggregatedDirection;\r\n      directiveEn = 'Take the ramp ' + enAggregatedDirection;\r\n    } else if (type === 'off ramp') {\r\n      directiveFr = \"Prendre la sortie d'autoroute \" + frAggregatedDirection;\r\n      directiveEn = 'Take exit ' + enAggregatedDirection;\r\n    } else if (type === 'fork') {\r\n      if (modifier.search('left') >= 0) {\r\n        directiveFr = 'Garder la gauche sur ' + route;\r\n        directiveEn = 'Merge left onto ' + route;\r\n      } else if (modifier.search('right') >= 0) {\r\n        directiveFr = 'Garder la droite sur ' + route;\r\n        directiveEn = 'Merge right onto ' + route;\r\n      } else {\r\n        directiveFr = 'Continuer sur ' + route;\r\n        directiveEn = 'Continue on ' + route;\r\n      }\r\n    } else if (type === 'end of road') {\r\n      directiveFr =\r\n        ' la fin de la route, tourner ' + translatedModifier + ' sur ' + route;\r\n      directiveEn =\r\n        'At the end of the road, turn ' + translatedModifier + ' onto ' + route;\r\n    } else if (type === 'use lane') {\r\n      directiveFr = 'Prendre la voie de ... ';\r\n      directiveEn = 'Take the lane ...';\r\n    } else if (type === 'continue' && modifier !== 'uturn') {\r\n      directiveFr = 'Continuer sur ' + route;\r\n      directiveEn = 'Continue on ' + route;\r\n      image = 'forward';\r\n      cssClass = 'rotate-270';\r\n    } else if (type === 'roundabout') {\r\n      directiveFr = 'Au rond-point, prendre la ' + exit;\r\n      directiveFr += exit === 1 ? 're' : 'e';\r\n      directiveFr += ' sortie vers ' + route;\r\n      directiveEn = 'At the roundabout, take the ' + exit;\r\n      directiveEn += exit === 1 ? 'st' : 'rd';\r\n      directiveEn += ' exit towards ' + route;\r\n      image = 'chart-donut';\r\n      cssClass = '';\r\n    } else if (type === 'rotary') {\r\n      directiveFr = 'Rond-point rotary....';\r\n      directiveEn = 'Roundabout rotary....';\r\n      image = 'chart-donut';\r\n      cssClass = '';\r\n    } else if (type === 'roundabout turn') {\r\n      directiveFr = 'Rond-point, prendre la ...';\r\n      directiveEn = 'Roundabout, take the ...';\r\n      image = 'chart-donut';\r\n      cssClass = '';\r\n    } else if (type === 'exit roundabout') {\r\n      directiveFr = 'Poursuivre vers ' + route;\r\n      directiveEn = 'Continue to ' + route;\r\n      image = 'forward';\r\n      cssClass = 'rotate-270';\r\n    } else if (type === 'notification') {\r\n      directiveFr = 'notification ....';\r\n      directiveEn = 'notification ....';\r\n    } else if (modifier === 'uturn') {\r\n      directiveFr =\r\n        'Faire demi-tour et continuer en direction ' +\r\n        translatedDirection +\r\n        ' sur ' +\r\n        route;\r\n      directiveEn =\r\n        'Make u-turn and head ' + translatedDirection + ' on ' + route;\r\n    } else {\r\n      directiveFr = '???';\r\n      directiveEn = '???';\r\n    }\r\n\r\n    if (lastStep) {\r\n      image = 'flag-variant';\r\n      cssClass = '';\r\n    }\r\n    if (stepPosition === 0) {\r\n      image = 'compass';\r\n      cssClass = '';\r\n    }\r\n\r\n    let directive;\r\n    if (this.browserLanguage === 'fr') {\r\n      directive = directiveFr;\r\n    } else if (this.browserLanguage === 'en') {\r\n      directive = directiveEn;\r\n    }\r\n\r\n    return { instruction: directive, image, cssClass };\r\n  }\r\n\r\n  translateModifier(modifier) {\r\n    if (modifier === 'uturn') {\r\n      return this.languageService.translate.instant('igo.geo.directions.uturn');\r\n    } else if (modifier === 'sharp right') {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.directions.sharp right'\r\n      );\r\n    } else if (modifier === 'right') {\r\n      return this.languageService.translate.instant('igo.geo.directions.right');\r\n    } else if (modifier === 'slight right') {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.directions.slight right'\r\n      );\r\n    } else if (modifier === 'sharp left') {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.directions.sharp left'\r\n      );\r\n    } else if (modifier === 'left') {\r\n      return this.languageService.translate.instant('igo.geo.directions.left');\r\n    } else if (modifier === 'slight left') {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.directions.slight left'\r\n      );\r\n    } else if (modifier === 'straight') {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.directions.straight'\r\n      );\r\n    } else {\r\n      return modifier;\r\n    }\r\n  }\r\n\r\n  translateBearing(bearing) {\r\n    if (bearing >= 337 || bearing < 23) {\r\n      return this.languageService.translate.instant('igo.geo.cardinalPoints.n');\r\n    } else if (bearing < 67) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.cardinalPoints.ne'\r\n      );\r\n    } else if (bearing < 113) {\r\n      return this.languageService.translate.instant('igo.geo.cardinalPoints.e');\r\n    } else if (bearing < 157) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.cardinalPoints.se'\r\n      );\r\n    } else if (bearing < 203) {\r\n      return this.languageService.translate.instant('igo.geo.cardinalPoints.s');\r\n    } else if (bearing < 247) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.cardinalPoints.sw'\r\n      );\r\n    } else if (bearing < 293) {\r\n      return this.languageService.translate.instant('igo.geo.cardinalPoints.w');\r\n    } else if (bearing < 337) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.cardinalPoints.nw'\r\n      );\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  formatDistance(distance) {\r\n    if (distance === 0) {\r\n      return;\r\n    }\r\n    if (distance >= 100000) {\r\n      return Math.round(distance / 1000) + ' km';\r\n    }\r\n    if (distance >= 10000) {\r\n      return Math.round(distance / 100) / 10 + ' km';\r\n    }\r\n    if (distance >= 100) {\r\n      return Math.round(distance / 100) / 10 + ' km';\r\n    }\r\n    return distance + ' m';\r\n  }\r\n\r\n  formatDuration(duration: number, summary = false) {\r\n    if (duration >= 3600) {\r\n      const hour = Math.floor(duration / 3600);\r\n      const minute = Math.round((duration / 3600 - hour) * 60);\r\n      if (minute === 60) {\r\n        return hour + 1 + ' h';\r\n      }\r\n      return hour + ' h ' + minute + ' min';\r\n    }\r\n\r\n    if (duration >= 60) {\r\n      return Math.round(duration / 60) + ' min';\r\n    }\r\n    return duration + ' s';\r\n  }\r\n\r\n  showSegment(step, zoomToExtent = false) {\r\n    this.showRouteSegmentGeometry(step.geometry.coordinates, zoomToExtent);\r\n  }\r\n\r\n  showRouteSegmentGeometry(coordinates, zoomToExtent = false) {\r\n    const vertexId = 'vertex';\r\n    const geometry4326 = new olgeom.LineString(coordinates);\r\n    const geometryMapProjection = geometry4326.transform(\r\n      'EPSG:4326',\r\n      this.map.projection\r\n    );\r\n    const routeSegmentCoordinates = (geometryMapProjection as any).getCoordinates();\r\n    const lastPoint = routeSegmentCoordinates[0];\r\n\r\n    const geometry = new olgeom.Point(lastPoint);\r\n    const feature = new olFeature({ geometry });\r\n\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.map.projection,\r\n      dataProjection: this.map.projection\r\n    }) as FeatureGeometry;\r\n\r\n    const previousVertex = this.routeStore.get(vertexId);\r\n    const previousVertexRevision = previousVertex\r\n      ? previousVertex.meta.revision\r\n      : 0;\r\n\r\n    const vertexFeature: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.map.projection,\r\n      properties: {\r\n        id: vertexId,\r\n        type: 'vertex'\r\n      },\r\n      meta: {\r\n        id: vertexId,\r\n        revision: previousVertexRevision + 1\r\n      },\r\n      ol: feature\r\n    };\r\n    this.routeStore.update(vertexFeature);\r\n    if (zoomToExtent) {\r\n      this.map.viewController.zoomToExtent(feature.getGeometry().getExtent() as [number, number, number, number]);\r\n    }\r\n  }\r\n\r\n  zoomRoute(extent?) {\r\n    if (extent) {\r\n      this.map.viewController.zoomToExtent(extent);\r\n    } else {\r\n      if (this.routeStore.layer) {\r\n        const routeFeature = this.routeStore.layer.ol\r\n          .getSource()\r\n          .getFeatures()\r\n          .find(f => f.getId() === 'route');\r\n        if (routeFeature) {\r\n          const routeExtent = routeFeature.getGeometry().getExtent();\r\n          this.map.viewController.zoomToExtent(routeExtent as [number, number, number, number]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public showRouteGeometry(moveToExtent = false) {\r\n    const geom = this.activeRoute.geometry.coordinates;\r\n    const geometry4326 = new olgeom.LineString(geom);\r\n    const geometryMapProjection = geometry4326.transform(\r\n      'EPSG:4326',\r\n      this.map.projection\r\n    );\r\n    if (moveToExtent) {\r\n      this.zoomRoute(geometryMapProjection.getExtent());\r\n    }\r\n\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(\r\n      geometryMapProjection,\r\n      {\r\n        featureProjection: this.map.projection,\r\n        dataProjection: this.map.projection\r\n      }\r\n    ) as FeatureGeometry;\r\n\r\n    const previousRoute = this.routeStore.get('route');\r\n    const previousRouteRevision = previousRoute\r\n      ? previousRoute.meta.revision\r\n      : 0;\r\n\r\n    const routeFeature: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.map.projection,\r\n      properties: {\r\n        id: 'route',\r\n        type: 'route'\r\n      },\r\n      meta: {\r\n        id: 'route',\r\n        revision: previousRouteRevision + 1\r\n      },\r\n      ol: new olFeature({ geometry: geometryMapProjection })\r\n    };\r\n    this.routeStore.update(routeFeature);\r\n  }\r\n\r\n  getRoutes(\r\n    moveToExtent: boolean = false,\r\n    directionsOptions: DirectionsOptions = {}\r\n  ) {\r\n    this.deleteStoreFeatureByID(this.routeStore, 'vertex');\r\n    this.writeStopsToFormService();\r\n    const coords = this.directionsFormService.getStopsCoordinates();\r\n    if (coords.length < 2) {\r\n      return;\r\n    }\r\n    const routeResponse = this.directionsService.route(\r\n      coords,\r\n      directionsOptions\r\n    );\r\n    if (routeResponse) {\r\n      routeResponse.map(res =>\r\n        this.routesQueries$$.push(\r\n          res.subscribe(route => {\r\n            this.routesResults = route;\r\n            this.activeRoute = this.routesResults[0] as Directions;\r\n            this.showRouteGeometry(moveToExtent);\r\n            this.changeDetectorRefs.detectChanges();\r\n          })\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  private unlistenSingleClick() {\r\n    if (this.focusKey.length !== 0) {\r\n      this.focusKey.forEach(key => {\r\n        olobservable.unByKey(key);\r\n      });\r\n    }\r\n  }\r\n\r\n  private unsubscribeRoutesQueries() {\r\n    this.routesQueries$$.forEach((sub: Subscription) => sub.unsubscribe());\r\n    this.routesQueries$$ = [];\r\n  }\r\n\r\n  copyLinkToClipboard() {\r\n    const successful = Clipboard.copy(this.getUrl());\r\n    if (successful) {\r\n      const translate = this.languageService.translate;\r\n      const title = translate.instant(\r\n        'igo.geo.directionsForm.dialog.copyTitle'\r\n      );\r\n      const msg = translate.instant(\r\n        'igo.geo.directionsForm.dialog.copyMsgLink'\r\n      );\r\n      this.messageService.success(msg, title);\r\n    }\r\n  }\r\n\r\n  copyDirectionsToClipboard() {\r\n    const directionsBody = this.directionsToText();\r\n    const successful = Clipboard.copy(directionsBody);\r\n    if (successful) {\r\n      const translate = this.languageService.translate;\r\n      const title = translate.instant(\r\n        'igo.geo.directionsForm.dialog.copyTitle'\r\n      );\r\n      const msg = translate.instant('igo.geo.directionsForm.dialog.copyMsg');\r\n      this.messageService.success(msg, title);\r\n    }\r\n  }\r\n\r\n  private directionsToText() {\r\n    const indent = '\\t';\r\n    let activeRouteDirective =\r\n      this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.instructions'\r\n      ) + ':\\n';\r\n    let wayPointList = '';\r\n    const summary =\r\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\r\n      ': \\n' +\r\n      indent +\r\n      this.activeRoute.title +\r\n      '\\n' +\r\n      indent +\r\n      this.formatDistance(this.activeRoute.distance) +\r\n      '\\n' +\r\n      indent +\r\n      this.formatDuration(this.activeRoute.duration) +\r\n      '\\n\\n' +\r\n      this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.stopsList'\r\n      ) +\r\n      ':\\n';\r\n\r\n    const url =\r\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\r\n      ':\\n' +\r\n      indent +\r\n      this.getUrl();\r\n\r\n    let wayPointsCnt = 1;\r\n    this.stops.value.forEach(stop => {\r\n      let coord = '';\r\n      let stopPoint = '';\r\n      if (stop.stopPoint !== stop.stopCoordinates) {\r\n        stopPoint = stop.stopPoint;\r\n        coord =\r\n          ' (' +\r\n          [stop.stopCoordinates[1], stop.stopCoordinates[0]].join(',') +\r\n          ')';\r\n      } else {\r\n        stopPoint = [stop.stopCoordinates[1], stop.stopCoordinates[0]].join(\r\n          ','\r\n        );\r\n      }\r\n\r\n      wayPointList =\r\n        wayPointList +\r\n        indent +\r\n        wayPointsCnt.toLocaleString() +\r\n        '. ' +\r\n        stopPoint +\r\n        coord +\r\n        '\\n';\r\n      wayPointsCnt++;\r\n    });\r\n\r\n    // Directions\r\n    let localCnt = 0;\r\n    this.activeRoute.steps.forEach(step => {\r\n      const instruction = this.formatStep(step, localCnt).instruction;\r\n      const distance =\r\n        this.formatDistance(step.distance) === undefined\r\n          ? ''\r\n          : ' (' + this.formatDistance(step.distance) + ')';\r\n      activeRouteDirective =\r\n        activeRouteDirective +\r\n        indent +\r\n        (localCnt + 1).toLocaleString() +\r\n        '. ' +\r\n        instruction +\r\n        distance +\r\n        '\\n';\r\n      localCnt++;\r\n    });\r\n\r\n    const directionsBody =\r\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\r\n\r\n    return directionsBody;\r\n  }\r\n\r\n  private handleTermChanged(term: string) {\r\n    if (term !== undefined || term.length !== 0) {\r\n      const searchProposals = [];\r\n      if (this.search$$) {\r\n        this.search$$.unsubscribe();\r\n      }\r\n      const researches = this.searchService.search(term, {searchType: 'Feature'});\r\n      researches.map(res =>\r\n        this.search$$ =\r\n        res.request.subscribe(results => {\r\n          results\r\n            .filter(r => r.data.geometry)\r\n            .forEach(element => {\r\n              if (\r\n                searchProposals.filter(r => r.source === element.source)\r\n                  .length === 0\r\n              ) {\r\n                searchProposals.push({\r\n                  source: element.source,\r\n                  meta: element.meta,\r\n                  results: results.map(r => r.data)\r\n                });\r\n              }\r\n            });\r\n          if (this.stops) {\r\n            this.stops\r\n              .at(this.currentStopIndex)\r\n              .patchValue({ stopProposals: searchProposals });\r\n          }\r\n          this.changeDetectorRefs.detectChanges();\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  setTerm(term: string) {\r\n    this.term = term;\r\n    if (\r\n      this.keyIsValid(term) &&\r\n      (term.length >= this.length || term.length === 0)\r\n    ) {\r\n      this.stream$.next(term);\r\n    }\r\n  }\r\n\r\n  private keyIsValid(key: string) {\r\n    return this.invalidKeys.find(value => value === key) === undefined;\r\n  }\r\n\r\n  keyup(i, event: KeyboardEvent) {\r\n    const term = (event.target as HTMLInputElement).value;\r\n    this.setTerm(term);\r\n    this.map.ol.un('singleclick', evt => {\r\n      this.handleMapClick(evt, i);\r\n    });\r\n  }\r\n\r\n  clearStop(stopIndex) {\r\n    // this.deleteDirectionsOverlaybyID(this.getStopOverlayID(stopIndex));\r\n    const id = this.getStopOverlayID(stopIndex);\r\n    this.deleteStoreFeatureByID(this.stopsStore, id);\r\n    this.routeStore.clear();\r\n    const stopsCounts = this.stops.length;\r\n    this.stops.removeAt(stopIndex);\r\n    this.stops.insert(\r\n      stopIndex,\r\n      this.createStop(this.directionsText(stopIndex, stopsCounts))\r\n    );\r\n    this.routesResults = undefined;\r\n    this.getRoutes(false);\r\n  }\r\n\r\n  chooseProposal(proposal, i) {\r\n    if (proposal !== undefined) {\r\n      let geomCoord;\r\n      const geom = (proposal as any).geometry;\r\n      if (geom.type === 'Point') {\r\n        geomCoord = geom.coordinates;\r\n      } else if (geom.type.search('Line') >= 0) {\r\n        const line = new OlGeoJSON().readFeatures(geom);\r\n        geomCoord = line[0].getGeometry().getFirstCoordinate();\r\n        geomCoord = [geomCoord[0], geomCoord[1]];\r\n      } else if (geom.type.search('Polygon') >= 0) {\r\n        const poly = new OlGeoJSON().readFeatures(geom);\r\n        geomCoord = poly[0].getGeometry().getType() === 'Polygon' ?\r\n          geomCoord =  poly[0].getGeometry().getInteriorPoint().getFirstCoordinate() :\r\n          geomCoord =  poly[0].getGeometry().getInteriorPoints().getFirstCoordinate();\r\n        geomCoord = [geomCoord[0], geomCoord[1]];\r\n      }\r\n\r\n      if (geomCoord !== undefined) {\r\n        this.stops.at(i).patchValue({ stopCoordinates: geomCoord });\r\n        this.addStopOverlay(geomCoord, i);\r\n        /*  const proposalExtent = this.directionsStopsOverlayDataSource.ol\r\n          .getFeatureById(this.getStopOverlayID(i))\r\n          .getGeometry()\r\n          .getExtent();*/\r\n\r\n        /* if (!olextent.intersects(proposalExtent, this.map.viewController.getExtent())) {\r\n          this.map.viewController.moveToExtent(proposalExtent);\r\n        }*/\r\n      }\r\n    }\r\n  }\r\n\r\n  focus(i) {\r\n    this.unlistenSingleClick();\r\n    this.currentStopIndex = i;\r\n    this.focusOnStop = true;\r\n    this.focusKey.push(\r\n      this.map.ol.once('singleclick', evt => {\r\n        this.handleMapClick(evt, i);\r\n      })\r\n    );\r\n  }\r\n\r\n  private handleMapClick(event, indexPos?) {\r\n    if (this.currentStopIndex === undefined) {\r\n      this.addStop();\r\n      indexPos = this.stops.length - 2;\r\n      this.stops.at(indexPos).value.stopProposals = [];\r\n    } else {\r\n      indexPos = this.currentStopIndex;\r\n    }\r\n    const clickCoordinates = olproj.transform(\r\n      event.coordinate,\r\n      this.map.projection,\r\n      this.projection\r\n    );\r\n    this.stops\r\n      .at(indexPos)\r\n      .patchValue({ stopProposals: [], stopCoordinates: clickCoordinates });\r\n\r\n    this.handleLocationProposals(clickCoordinates as [number, number], indexPos);\r\n    this.addStopOverlay(clickCoordinates as [number, number], indexPos);\r\n    setTimeout(() => {\r\n      this.focusOnStop = false; // prevent to trigger map click and Select on routes at same time.\r\n    }, 500);\r\n  }\r\n\r\n  geolocateStop(index: number) {\r\n    moveToOlFeatures(\r\n      this.map,\r\n      [this.map.geolocationFeature],\r\n      FeatureMotion.Move\r\n    );\r\n    const geolocateCoordinates = this.map.viewController.getCenter(\r\n      this.projection\r\n    );\r\n    this.stops.at(index).patchValue({ stopCoordinates: geolocateCoordinates });\r\n    this.addStopOverlay(geolocateCoordinates, index);\r\n    this.handleLocationProposals(geolocateCoordinates, index);\r\n  }\r\n\r\n  public addStopOverlay(coordinates: [number, number], index: number) {\r\n    const directionsText = this.directionsText(index);\r\n    let stopColor;\r\n    let stopText;\r\n    if (directionsText === 'start') {\r\n      stopColor = '#008000';\r\n      stopText = this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.start'\r\n      );\r\n    } else if (directionsText === 'end') {\r\n      stopColor = '#f64139';\r\n      stopText = this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.end'\r\n      );\r\n    } else {\r\n      stopColor = '#ffd700';\r\n      stopText =\r\n        this.languageService.translate.instant(\r\n          'igo.geo.directionsForm.intermediate'\r\n        ) +\r\n        ' #' +\r\n        index;\r\n    }\r\n\r\n    const geometry = new olgeom.Point(\r\n      olproj.transform(coordinates, this.projection, this.map.projection)\r\n    );\r\n\r\n    const stopID = this.getStopOverlayID(index);\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.map.projection,\r\n      dataProjection: this.map.projection\r\n    }) as FeatureGeometry;\r\n\r\n    const previousStop = this.stopsStore.get(stopID);\r\n    const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\r\n\r\n    const stopFeature: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.map.projection,\r\n      properties: {\r\n        id: stopID,\r\n        type: 'stop',\r\n        stopText,\r\n        stopColor,\r\n        stopOpacity: 1\r\n      },\r\n      meta: {\r\n        id: stopID,\r\n        revision: previousStopRevision + 1\r\n      },\r\n      ol: new olFeature({ geometry })\r\n    };\r\n    this.stopsStore.update(stopFeature);\r\n    this.getRoutes();\r\n  }\r\n\r\n  public getStopOverlayID(index: number): string {\r\n    let txt;\r\n    if (index === 0) {\r\n      txt = 'start';\r\n    } else if (index === this.stops.length - 1) {\r\n      txt = 'end';\r\n    } else {\r\n      txt = index;\r\n    }\r\n    return 'directionsStop_' + txt;\r\n  }\r\n\r\n  public deleteStoreFeatureByID(store, id) {\r\n    const entity = store.get(id);\r\n    if (entity) {\r\n      store.delete(entity);\r\n    }\r\n  }\r\n\r\n  private getUrl() {\r\n    if (!this.route) {\r\n      return;\r\n    }\r\n\r\n    const directionsKey = this.route.options.directionsCoordKey;\r\n    const stopsCoordinates = [];\r\n    if (\r\n      this.directionsFormService &&\r\n      this.directionsFormService.getStopsCoordinates() &&\r\n      this.directionsFormService.getStopsCoordinates().length !== 0\r\n    ) {\r\n      this.directionsFormService.getStopsCoordinates().forEach(coord => {\r\n        stopsCoordinates.push(roundCoordTo(coord, 6));\r\n      });\r\n    }\r\n    let directionsUrl = '';\r\n    if (stopsCoordinates.length >= 2) {\r\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\r\n    }\r\n\r\n    return `${location.origin}${location.pathname}?tool=directions&sidenav=1&${directionsUrl}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a style for the directions stops and routes\r\n * @param feature OlFeature\r\n * @returns OL style function\r\n */\r\nexport function stopMarker(\r\n  feature: olFeature<OlGeometry>,\r\n  resolution: number\r\n): olstyle.Style | olstyle.Style[] {\r\n  const vertexStyle = [\r\n    new olstyle.Style({\r\n      geometry: feature.getGeometry(),\r\n      image: new olstyle.Circle({\r\n        radius: 7,\r\n        stroke: new olstyle.Stroke({ color: '#FF0000', width: 3 })\r\n      })\r\n    })\r\n  ];\r\n\r\n  const stopStyle = createOverlayMarkerStyle({\r\n    text: feature.get('stopText'),\r\n    opacity: feature.get('stopOpacity'),\r\n    markerColor: feature.get('stopColor'),\r\n    markerOutlineColor: [255, 255, 255]});\r\n\r\n  const routeStyle = [\r\n    new olstyle.Style({\r\n      stroke: new olstyle.Stroke({ color: 'rgba(106, 121, 130, 0.75)', width: 10 })\r\n    }),\r\n    new olstyle.Style({\r\n      stroke: new olstyle.Stroke({ color: 'rgba(79, 169, 221, 0.75)', width: 6 })\r\n    })\r\n  ];\r\n\r\n  if (feature.get('type') === 'stop') {\r\n    return stopStyle;\r\n  }\r\n  if (feature.get('type') === 'vertex') {\r\n    return vertexStyle;\r\n  }\r\n  if (feature.get('type') === 'route') {\r\n    return routeStyle;\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { DirectionsFormComponent } from './directions-form/directions-form.component';\r\nimport { DirectionsFormBindingDirective } from './directions-form/directions-form-binding.directive';\r\nimport { DirectionsFormService } from './directions-form/directions-form.service';\r\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatListModule,\r\n    MatDividerModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    MatAutocompleteModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [DirectionsFormComponent, DirectionsFormBindingDirective],\r\n  declarations: [DirectionsFormComponent, DirectionsFormBindingDirective],\r\n  providers: [DirectionsFormService, provideDirectionsSourceService()]\r\n})\r\nexport class IgoDirectionsModule {\r\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\r\n    return {\r\n      ngModule: IgoDirectionsModule\r\n    };\r\n  }\r\n}\r\n","import { SearchSource } from './sources/source';\r\nimport { SearchSourceService } from './search-source.service';\r\n\r\n/**\r\n * Search source factory\r\n * @ignore\r\n */\r\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\r\n  return new SearchSourceService(sources);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the SearchSource service\r\n */\r\nexport function provideSearchSourceService() {\r\n  return {\r\n    provide: SearchSourceService,\r\n    useFactory: searchSourceServiceFactory,\r\n    deps: [SearchSource]\r\n  };\r\n}\r\n","import { Injectable, Inject, Injector } from '@angular/core';\r\nimport { HttpClient, HttpParams, HttpParameterCodec } from '@angular/common/http';\r\n\r\nimport { Observable, of, BehaviorSubject } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport pointOnFeature from '@turf/point-on-feature';\r\n\r\nimport { FEATURE, Feature } from '../../../feature';\r\nimport { GoogleLinks } from './../../../utils/googleLinks';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\r\nimport {\r\n  SearchSourceOptions,\r\n  TextSearchOptions,\r\n  ReverseSearchOptions\r\n} from './source.interfaces';\r\nimport {\r\n  IChercheData,\r\n  IChercheResponse,\r\n  IChercheReverseData,\r\n  IChercheReverseResponse\r\n} from './icherche.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\n\r\n@Injectable()\r\nexport class IChercheSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\r\n    return result;\r\n  }\r\n}\r\n\r\n// Fix the \"+\" is replaced with space \" \" in a query string\r\n// https://github.com/angular/angular/issues/11058\r\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\r\n  encodeKey(key: string): string {\r\n    return encodeURIComponent(key);\r\n  }\r\n\r\n  encodeValue(value: string): string {\r\n    return encodeURIComponent(value);\r\n  }\r\n\r\n  decodeKey(key: string): string {\r\n    return decodeURIComponent(key);\r\n  }\r\n\r\n  decodeValue(value: string): string {\r\n    return decodeURIComponent(value);\r\n  }\r\n}\r\n\r\n/**\r\n * ICherche search source\r\n */\r\n@Injectable()\r\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'icherche';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  private hashtagsLieuxToKeep = [];\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    @Inject(IChercheSearchResultFormatter)\r\n    private formatter: IChercheSearchResultFormatter,\r\n    injector: Injector\r\n  ) {\r\n    super(options, storageService);\r\n\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe((title) => this.title$.next(title));\r\n\r\n    const authService = injector.get(AuthService);\r\n    if (this.settings.length) {\r\n      if (!authService) {\r\n        this.getAllowedTypes();\r\n      } else {\r\n        authService.authenticate$.subscribe(() => {\r\n          this.getAllowedTypes();\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  getId(): string {\r\n    return IChercheSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return IChercheSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const limit =\r\n      this.options.params && this.options.params.limit\r\n        ? Number(this.options.params.limit)\r\n        : undefined;\r\n    const ecmax =\r\n      this.options.params && this.options.params.ecmax\r\n        ? Number(this.options.params.ecmax)\r\n        : undefined;\r\n\r\n    const types = this.options.params?.type\r\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\r\n        : [\r\n            'adresses',\r\n            'codes-postaux',\r\n            'routes',\r\n            'intersections',\r\n            'municipalites',\r\n            'mrc',\r\n            'regadmin',\r\n            'lieux'\r\n          ];\r\n\r\n    return {\r\n      title: 'igo.geo.search.icherche.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.type.address',\r\n              value: 'adresses',\r\n              enabled: types.indexOf('adresses') !== -1,\r\n              hashtags: ['adresse']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.oldAddress',\r\n              value: 'anciennes-adresses',\r\n              enabled: types.indexOf('anciennes-adresses') !== -1,\r\n              hashtags: ['anciennes-adresses']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.postalCode',\r\n              value: 'codes-postaux',\r\n              enabled: types.indexOf('codes-postaux') !== -1,\r\n              hashtags: ['code-postal']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.road',\r\n              value: 'routes',\r\n              enabled: types.indexOf('routes') !== -1,\r\n              hashtags: ['route']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.intersection',\r\n              value: 'intersections',\r\n              enabled: types.indexOf('intersections') !== -1,\r\n              hashtags: ['intersection', '+']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.city',\r\n              value: 'municipalites',\r\n              enabled: types.indexOf('municipalites') !== -1,\r\n              hashtags: ['municipalit', 'mun']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.oldCity',\r\n              value: 'anciennes-municipalites',\r\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\r\n              hashtags: ['anciennes-municipalites']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.mrc',\r\n              value: 'mrc',\r\n              enabled: types.indexOf('mrc') !== -1,\r\n              hashtags: ['mrc']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.regadmin',\r\n              value: 'regadmin',\r\n              enabled: types.indexOf('regadmin') !== -1,\r\n              hashtags: ['rgion-administrative', 'regadmin']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.entreprise',\r\n              value: 'entreprises',\r\n              enabled: types.indexOf('entreprises') !== -1,\r\n              available: false,\r\n              hashtags: ['entreprise']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.place',\r\n              value: 'lieux',\r\n              enabled: types.indexOf('lieux') !== -1,\r\n              hashtags: ['lieu']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.exit',\r\n              value: 'sorties-autoroute',\r\n              enabled: types.indexOf('sorties-autoroute') !== -1,\r\n              hashtags: ['sortie', 'sorties', 'exit']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.km',\r\n              value: 'bornes-km',\r\n              enabled: types.indexOf('bornes-km') !== -1,\r\n              hashtags: ['borne', 'bornes', 'repre', 'km']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.gcc',\r\n              value: 'bornes-gcc',\r\n              enabled: types.indexOf('bornes-gcc') !== -1,\r\n              hashtags: ['borne', 'bornes', 'repre', 'gcc', 'ccg']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cn',\r\n              value: 'bornes-cn',\r\n              enabled: types.indexOf('bornes-cn') !== -1,\r\n              hashtags: ['borne', 'bornes', 'cn']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.sumi',\r\n              value: 'bornes-sumi',\r\n              enabled: types.indexOf('bornes-sumi') !== -1,\r\n              hashtags: ['borne', 'bornes', 'sumi']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.hq',\r\n              value: 'hq',\r\n              enabled: types.indexOf('hq') !== -1,\r\n              hashtags: ['hq']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cadastre',\r\n              value: 'cadastre',\r\n              enabled: types.indexOf('cadastre') !== -1,\r\n              hashtags: ['cadastre']\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '1',\r\n              value: 1,\r\n              enabled: limit === 1\r\n            },\r\n            {\r\n              title: '5',\r\n              value: 5,\r\n              enabled: limit === 5 || !limit\r\n            },\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: limit === 10\r\n            },\r\n            {\r\n              title: '25',\r\n              value: 25,\r\n              enabled: limit === 25\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: limit === 50\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'ecmax',\r\n          name: 'ecmax',\r\n          values: [\r\n            {\r\n              title: '10 %',\r\n              value: 10,\r\n              enabled: ecmax === 10\r\n            },\r\n            {\r\n              title: '30 %',\r\n              value: 30,\r\n              enabled: ecmax === 30 || !ecmax\r\n            },\r\n            {\r\n              title: '50 %',\r\n              value: 50,\r\n              enabled: ecmax === 50\r\n            },\r\n            {\r\n              title: '75 %',\r\n              value: 75,\r\n              enabled: ecmax === 75\r\n            },\r\n            {\r\n              title: '100 %',\r\n              value: 100,\r\n              enabled: ecmax === 100\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'restrictExtent',\r\n          name: 'loc',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.restrictExtent.map',\r\n              value: 'true',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\r\n              value: 'false',\r\n              enabled: true\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(term, options || {});\r\n    if (!params.get('type').length) {\r\n      return of([]);\r\n    }\r\n    this.options.params.page = params.get('page') || '1';\r\n\r\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\r\n      map((response: IChercheResponse) => this.extractResults(response, term)),\r\n      catchError((err) => {\r\n        err.error.toDisplay = true;\r\n        err.error.title = this.languageService.translate.instant(\r\n          this.getDefaultOptions().title\r\n        );\r\n        throw err;\r\n      })\r\n    );\r\n  }\r\n\r\n  private getAllowedTypes() {\r\n    return this.http\r\n      .get(`${this.searchUrl}/types`)\r\n      .subscribe((types: string[]) => {\r\n        const typeSetting = this.settings.find((s) => s.name === 'type');\r\n        typeSetting.values.forEach((v) => {\r\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\r\n          const typesMatched = types.filter((value) => regex.test(value));\r\n          v.available = typesMatched.length > 0;\r\n          if (v.value === 'lieux') {\r\n            this.hashtagsLieuxToKeep = [\r\n              ...(new Set(\r\n                typesMatched\r\n                  .map((t) => t.split('.'))\r\n                  .reduce((a, b) => a.concat(b))\r\n                  .filter((t) => t !== 'lieux')\r\n              ) as any)\r\n            ];\r\n          }\r\n        });\r\n        this.setParamFromSetting(typeSetting, false);\r\n      });\r\n  }\r\n\r\n  private computeRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    const queryParams: any = Object.assign(\r\n      {\r\n        geometry: true,\r\n        bbox: true,\r\n        icon: true,\r\n        type:\r\n          'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\r\n      },\r\n      this.params,\r\n      this.computeOptionsParam(term, options || {}).params,\r\n      {\r\n        q: this.computeTerm(term),\r\n        page: options.page\r\n      }\r\n    );\r\n\r\n    if (queryParams.loc === 'true') {\r\n      const [xMin, yMin, xMax, yMax] = options.extent;\r\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\r\n    } else if (queryParams.loc === 'false') {\r\n      delete queryParams.loc;\r\n    }\r\n\r\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\r\n      queryParams.type = 'lieux';\r\n    }\r\n\r\n    return new HttpParams({\r\n      fromObject: ObjectUtils.removeUndefined(queryParams),\r\n      encoder: new IgoHttpParameterCodec()\r\n    });\r\n  }\r\n\r\n  private extractResults(response: IChercheResponse, term: string): SearchResult<Feature>[] {\r\n    return response.features.map((data: IChercheData) => {\r\n      return this.formatter.formatResult(this.dataToResult(data, term, response));\r\n    });\r\n  }\r\n\r\n  private dataToResult(\r\n    data: IChercheData,\r\n    term: string,\r\n    response?: IChercheResponse\r\n  ): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, properties.code].join('.');\r\n\r\n    const titleHtml = data.highlight.title || data.properties.nom;\r\n    const subtitleHtml = data.highlight.title2\r\n      ? ' <small> ' + data.highlight.title2 + '</small>'\r\n      : '';\r\n    const subtitleHtml2 = data.highlight.title3\r\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\r\n      : '';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        extent: data.bbox,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties.nom\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.nom,\r\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\r\n        icon: data.icon || 'map-marker',\r\n        score: data.score ||  computeTermSimilarity(term.trim(), data.properties.nom),\r\n        nextPage:\r\n          response.features.length % +this.options.params.limit === 0 &&\r\n          +this.options.params.page < 10\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: IChercheData): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      IChercheSearchSource.propertiesBlacklist\r\n    );\r\n\r\n    if (!data.geometry) {\r\n      return Object.assign({ type: data.index }, properties);\r\n    }\r\n\r\n    const googleLinksProperties: {\r\n      GoogleMaps: string;\r\n      GoogleStreetView?: string;\r\n    } = {\r\n      GoogleMaps: ''\r\n    };\r\n\r\n    let googleMaps;\r\n    if (data.geometry.type === 'Point') {\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        data.geometry.coordinates[0],\r\n        data.geometry.coordinates[1]\r\n      );\r\n    } else {\r\n      const point = pointOnFeature(data.geometry);\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        point.geometry.coordinates[0],\r\n        point.geometry.coordinates[1]\r\n      );\r\n    }\r\n\r\n    let googleMapsNom;\r\n    if (data.index === 'routes') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom + ', ' + data.properties.municipalite\r\n      );\r\n    } else if (data.index === 'municipalites') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom + ', ' + 'ville'\r\n      );\r\n    } else if (data.index === 'mrc') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        'mrc+' + data.properties.nom\r\n      );\r\n    } else if (data.index === 'regadmin') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom + ',+QC'\r\n      );\r\n    } else {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom || data.highlight.title\r\n      );\r\n    }\r\n\r\n    googleLinksProperties.GoogleMaps =\r\n      '<a href=' +\r\n      googleMaps +\r\n      ' target=\"_blank\">' +\r\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\r\n      '</a> <br /> <a href=' +\r\n      googleMapsNom +\r\n      ' target=\"_blank\">' +\r\n      this.languageService.translate.instant('igo.geo.searchByName') +\r\n      '</a>';\r\n\r\n    if (data.geometry.type === 'Point') {\r\n      googleLinksProperties.GoogleStreetView = GoogleLinks.getGoogleStreetViewLink(\r\n        data.geometry.coordinates[0],\r\n        data.geometry.coordinates[1]\r\n      );\r\n    }\r\n\r\n    const routing: {\r\n      Route: string;\r\n    } = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n\r\n    return Object.assign(\r\n      { type: data.index },\r\n      properties,\r\n      googleLinksProperties,\r\n      routing\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove hashtag from query\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTerm(term: string): string {\r\n    // Keep hashtags for \"lieux\"\r\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\r\n    let keep = false;\r\n    keep = hashtags.some((hashtag) => {\r\n      const hashtagKey = hashtag.substring(1);\r\n      return this.hashtagsLieuxToKeep.some(\r\n        (h) =>\r\n          h\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '') ===\r\n          hashtagKey\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n      );\r\n    });\r\n\r\n    if (!keep) {\r\n      term = term.replace(/(#[A-Za-z]+)/g, '');\r\n    }\r\n\r\n    return term.replace(/[^\\w- !\\-\\+\\(\\)\\.\\/,'#]+/g, '');\r\n  }\r\n\r\n  /**\r\n   * Add hashtag to param if valid\r\n   * @param term Query with hashtag\r\n   * @param options TextSearchOptions\r\n   */\r\n  private computeOptionsParam(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): TextSearchOptions {\r\n    const hashtags = super.getHashtagsValid(term, 'type');\r\n    if (hashtags) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        type: hashtags.join(',')\r\n      });\r\n    }\r\n\r\n    return options;\r\n  }\r\n}\r\n\r\n/**\r\n * IChercheReverse search source\r\n */\r\n@Injectable()\r\nexport class IChercheReverseSearchSource extends SearchSource\r\n  implements ReverseSearch {\r\n  static id = 'icherchereverse';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    injector: Injector,\r\n  ) {\r\n    super(options, storageService);\r\n\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe((title) => this.title$.next(title));\r\n\r\n    const authService = injector.get(AuthService);\r\n    if (this.settings.length) {\r\n      if (!authService) {\r\n        this.getAllowedTypes();\r\n      } else {\r\n        authService.authenticate$.subscribe(() => {\r\n          this.getAllowedTypes();\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  getId(): string {\r\n    return IChercheReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return IChercheReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const types =\r\n      this.options.params && this.options.params.type\r\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\r\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\r\n\r\n    return {\r\n      title: 'igo.geo.search.ichercheReverse.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.type.address',\r\n              value: 'adresses',\r\n              enabled: types.indexOf('adresses') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.road',\r\n              value: 'routes',\r\n              enabled: types.indexOf('routes') !== -1,\r\n              available: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.district',\r\n              value: 'arrondissements',\r\n              enabled: types.indexOf('arrondissements') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.city',\r\n              value: 'municipalites',\r\n              enabled: types.indexOf('municipalites') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.mrc',\r\n              value: 'mrc',\r\n              enabled: types.indexOf('mrc') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.regadmin',\r\n              value: 'regadmin',\r\n              enabled: types.indexOf('regadmin') !== -1\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'radius',\r\n          name: 'bufferInput',\r\n          values: [\r\n            {\r\n              title: '100 m',\r\n              value: 100,\r\n              enabled: !this.options.distance || this.options.distance === 100\r\n            },\r\n            {\r\n              title: '500 m',\r\n              value: 500,\r\n              enabled: this.options.distance === 500\r\n            },\r\n            {\r\n              title: '1 km',\r\n              value: 1000,\r\n              enabled: this.options.distance === 1000\r\n            },\r\n            {\r\n              title: '2 km',\r\n              value: 2000,\r\n              enabled: this.options.distance === 2000\r\n            },\r\n            {\r\n              title: '5 km',\r\n              value: 5000,\r\n              enabled: this.options.distance === 5000\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param distance Search raidus around lonLat\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(lonLat, options || {});\r\n    if (!params.get('type').length) {\r\n      return of([]);\r\n    }\r\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\r\n      map((response: IChercheReverseResponse) => {\r\n        return this.extractResults(response);\r\n      })\r\n    );\r\n  }\r\n\r\n  private getAllowedTypes() {\r\n    return this.http\r\n      .get(`${this.searchUrl}/types`)\r\n      .subscribe((types: string[]) => {\r\n        const typeSetting = this.settings.find((s) => s.name === 'type');\r\n        typeSetting.values.forEach((v) => {\r\n          v.available = types.indexOf(v.value as string) > -1;\r\n        });\r\n        this.setParamFromSetting(typeSetting, false);\r\n      });\r\n  }\r\n\r\n  private computeRequestParams(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): HttpParams {\r\n    if (options.distance || this.options.distance) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        bufferInput: options.distance || this.options.distance\r\n      });\r\n    }\r\n\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          loc: lonLat.join(','),\r\n          sort: 'distance',\r\n          geometry: true,\r\n          icon: true\r\n        },\r\n        options.params || {},\r\n        this.params\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: IChercheReverseResponse\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: IChercheReverseData) => {\r\n      return this.dataToResult(data);\r\n    });\r\n  }\r\n\r\n  private getSubtitle(data: IChercheReverseData) {\r\n    if (!this.settings.length) {\r\n      return '';\r\n    }\r\n    let subtitle = '';\r\n    switch (data.properties.type) {\r\n      case 'arrondissements':\r\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\r\n        break;\r\n      default:\r\n        const typeSetting = this.settings.find((s) => s.name === 'type');\r\n        const type = typeSetting.values.find(\r\n          (t) => t.value === data.properties.type\r\n        );\r\n        if (type) {\r\n          subtitle = this.languageService.translate.instant(type.title);\r\n        }\r\n    }\r\n    return subtitle;\r\n  }\r\n\r\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const extent = this.computeExtent(data);\r\n    const id = [this.getId(), properties.type, properties.code].join('.');\r\n\r\n    const titleHtml = data.properties.nom;\r\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties.nom\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.nom,\r\n        titleHtml: titleHtml + subtitleHtml,\r\n        icon: data.icon || 'map-marker'\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      IChercheReverseSearchSource.propertiesBlacklist\r\n    );\r\n\r\n    const routing: {\r\n      Route: string;\r\n    } = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n\r\n    return Object.assign(properties, routing);\r\n  }\r\n\r\n  private computeExtent(\r\n    data: IChercheReverseData\r\n  ): [number, number, number, number] | undefined {\r\n    return data.bbox\r\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\r\n      : undefined;\r\n  }\r\n}\r\n","import { Injector } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport {\r\n  IChercheSearchSource,\r\n  IChercheSearchResultFormatter,\r\n  IChercheReverseSearchSource\r\n} from './icherche';\r\n\r\n/**\r\n * ICherche search result formatter factory\r\n * @ignore\r\n */\r\nexport function defaultIChercheSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new IChercheSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ICherche search result formatter\r\n */\r\nexport function provideDefaultIChercheSearchResultFormatter() {\r\n  return {\r\n    provide: IChercheSearchResultFormatter,\r\n    useFactory: defaultIChercheSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * ICherche search source factory\r\n * @ignore\r\n */\r\nexport function ichercheSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService,\r\n  formatter: IChercheSearchResultFormatter,\r\n  injector: Injector\r\n) {\r\n  return new IChercheSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\r\n    formatter,\r\n    injector\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ICherche search source\r\n */\r\nexport function provideIChercheSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ichercheSearchSourceFactory,\r\n    multi: true,\r\n    deps: [\r\n      HttpClient,\r\n      LanguageService,\r\n      StorageService,\r\n      ConfigService,\r\n      IChercheSearchResultFormatter,\r\n      Injector\r\n    ]\r\n  };\r\n}\r\n\r\n/**\r\n * IChercheReverse search source factory\r\n * @ignore\r\n */\r\nexport function ichercheReverseSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService,\r\n  injector: Injector\r\n) {\r\n  return new IChercheReverseSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\r\n    injector\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the IChercheReverse search source\r\n */\r\nexport function provideIChercheReverseSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ichercheReverseSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\nimport * as olproj from 'ol/proj';\r\nimport { fromCircle } from 'ol/geom/Polygon';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport * as olformat from 'ol/format';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, ReverseSearch } from './source';\r\nimport { SearchSourceOptions, ReverseSearchOptions } from './source.interfaces';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { GoogleLinks } from '../../../utils/googleLinks';\r\nimport { Projection } from '../../../map/shared/projection.interfaces';\r\nimport { lonLatConversion, roundCoordTo, convertDDToDMS } from '../../../map/shared/map.utils';\r\nimport { OsmLinks } from '../../../utils';\r\n\r\n@Injectable()\r\nexport class CoordinatesSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\r\n    return result;\r\n  }\r\n}\r\n/**\r\n * CoordinatesReverse search source\r\n */\r\n@Injectable()\r\nexport class CoordinatesReverseSearchSource extends SearchSource\r\n  implements ReverseSearch {\r\n  static id = 'coordinatesreverse';\r\n  static type = FEATURE;\r\n\r\n  private projections;\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    @Inject('options') options: SearchSourceOptions,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('projections') projections: Projection[],\r\n  ) {\r\n    super(options, storageService);\r\n    this.projections = projections;\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe(title => this.title$.next(title));\r\n  }\r\n\r\n  getId(): string {\r\n    return CoordinatesReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return CoordinatesReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'igo.geo.search.coordinates.name',\r\n      order: 1,\r\n      showInSettings: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return of([this.dataToResult(lonLat, options)]);\r\n  }\r\n\r\n  private dataToResult(data: [number, number], options: ReverseSearchOptions): SearchResult<Feature> {\r\n    const dataDMS = convertDDToDMS(data);\r\n    const convertedCoord = lonLatConversion(data, this.projections);\r\n    const coords = convertedCoord.reduce((obj, item) => (\r\n      obj[item.alias] = item.igo2CoordFormat, obj), {});\r\n\r\n    const roundedCoordString = roundCoordTo(data, 6).join(', ');\r\n    const roundedCoordStringDMS = dataDMS.join(', ');\r\n\r\n    let geometry: FeatureGeometry = {\r\n      type: 'Point',\r\n      coordinates: [data[0], data[1]]\r\n    };\r\n\r\n    const properties = {};\r\n    let subtitleHtml = '';\r\n    if (options.distance) {\r\n      const radiusKey =  this.languageService.translate.instant('igo.geo.search.coordinates.radius');\r\n      properties[radiusKey] = options.distance;\r\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\r\n\r\n      // Create polygon\r\n      const center = olproj.transform([data[0], data[1]], 'EPSG:4326', 'EPSG:3857');\r\n      const circleGeometry = new OlCircle(center, options.distance);\r\n      const polygonGeometry = fromCircle(circleGeometry);\r\n      const writer = new olformat.GeoJSON();\r\n      geometry = JSON.parse(writer.writeGeometry(polygonGeometry.transform('EPSG:3857', 'EPSG:4326')));\r\n    }\r\n\r\n    if (options.conf) {\r\n      const confKey =  this.languageService.translate.instant('igo.geo.search.coordinates.conf');\r\n      properties[confKey] = options.conf;\r\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\r\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\r\n    }\r\n\r\n    const coordKey =  this.languageService.translate.instant('igo.geo.search.coordinates.coord');\r\n    properties[coordKey] = roundedCoordString;\r\n\r\n    const coordKeyDMS = this.languageService.translate.instant('igo.geo.search.coordinates.coordDMS');\r\n    properties[coordKeyDMS] = roundedCoordStringDMS;\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        extent: undefined,\r\n        properties: Object.assign(\r\n          properties,\r\n          coords,\r\n          {\r\n            GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\r\n            GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\r\n              data[0],\r\n              data[1]\r\n            ),\r\n            OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\r\n            Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\r\n          }\r\n        ),\r\n        meta: {\r\n          id: data[0].toString() + ',' + data[1].toString(),\r\n          title: roundedCoordString\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id: data[0].toString() + ',' + data[1].toString(),\r\n        title: roundedCoordString,\r\n        titleHtml: roundedCoordString + subtitleHtml,\r\n        icon: 'map-marker',\r\n        score: 100, // every coord exists\r\n      }\r\n    };\r\n  }\r\n}\r\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport {\r\n  CoordinatesReverseSearchSource,\r\n  CoordinatesSearchResultFormatter\r\n} from './coordinates';\r\nimport { Projection } from '../../../map/shared/projection.interfaces';\r\nimport { ProjectionService } from '../../../map/shared/projection.service';\r\n\r\n/**\r\n * ICherche search result formatter factory\r\n * @ignore\r\n */\r\nexport function defaultCoordinatesSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new CoordinatesSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ICherche search result formatter\r\n */\r\nexport function provideDefaultCoordinatesSearchResultFormatter() {\r\n  return {\r\n    provide: CoordinatesSearchResultFormatter,\r\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * CoordinatesReverse search source factory\r\n * @ignore\r\n */\r\nexport function CoordinatesReverseSearchSourceFactory(\r\n  config: ConfigService,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  _projectionService: ProjectionService\r\n) {\r\n  return new CoordinatesReverseSearchSource(\r\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\r\n    languageService,\r\n    storageService,\r\n    (config.getConfig('projections') as Projection[]) || []\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the IChercheReverse search source\r\n */\r\nexport function provideCoordinatesReverseSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: CoordinatesReverseSearchSourceFactory,\r\n    multi: true,\r\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\r\nimport { LAYER } from '../../../layer';\r\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\r\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch } from './source';\r\nimport { TextSearchOptions } from './source.interfaces';\r\nimport {\r\n  ILayerSearchSourceOptions,\r\n  ILayerData,\r\n  ILayerItemResponse,\r\n  ILayerServiceResponse,\r\n  ILayerDataSource\r\n} from './ilayer.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\n\r\n@Injectable()\r\nexport class ILayerSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(data: ILayerData): ILayerData {\r\n    const allowedKey = [\r\n      'title',\r\n      'abstract',\r\n      'groupTitle',\r\n      'metadataUrl',\r\n      'downloadUrl',\r\n      'urlInfo',\r\n      'name'\r\n    ];\r\n\r\n    const property = Object.entries(data.properties)\r\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\r\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\r\n        const [key, value] = entries;\r\n        let newKey;\r\n        try {\r\n          newKey = this.languageService.translate.instant(\r\n            'igo.geo.search.ilayer.properties.' + key\r\n          );\r\n        } catch (e) {\r\n          newKey = key;\r\n        }\r\n        out[newKey] = value ? value : '';\r\n        return out;\r\n      }, {});\r\n\r\n    const dataR = Object.assign({}, data);\r\n    dataR.properties = property as ILayerDataSource;\r\n\r\n    return dataR;\r\n  }\r\n}\r\n\r\n/**\r\n * ILayer search source\r\n */\r\n@Injectable()\r\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'ilayer';\r\n  static type = LAYER;\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: ILayerSearchSourceOptions,\r\n    @Inject(ILayerSearchResultFormatter)\r\n    private formatter: ILayerSearchResultFormatter\r\n  ) {\r\n    super(options, storageService);\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe(title => this.title$.next(title));\r\n  }\r\n\r\n  getId(): string {\r\n    return ILayerSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return ILayerSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\r\n    const limit =\r\n      this.options.params && this.options.params.limit\r\n        ? Number(this.options.params.limit)\r\n        : undefined;\r\n    const ecmax =\r\n      this.options.params && this.options.params.ecmax\r\n        ? Number(this.options.params.ecmax)\r\n        : undefined;\r\n    return {\r\n      title: 'igo.geo.search.ilayer.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.ilayer.type.layer',\r\n              value: 'layer',\r\n              enabled: true,\r\n              hashtags: ['layer', 'layers', 'couche', 'couches']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.ilayer.type.groupLayer',\r\n              value: 'group',\r\n              enabled: false,\r\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '1',\r\n              value: 1,\r\n              enabled: limit === 1\r\n            },\r\n            {\r\n              title: '5',\r\n              value: 5,\r\n              enabled: limit === 5 || !limit\r\n            },\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: limit === 10\r\n            },\r\n            {\r\n              title: '25',\r\n              value: 25,\r\n              enabled: limit === 25\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: limit === 50\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'ecmax',\r\n          name: 'ecmax',\r\n          values: [\r\n            {\r\n              title: '10 %',\r\n              value: 10,\r\n              enabled: ecmax === 10\r\n            },\r\n            {\r\n              title: '30 %',\r\n              value: 30,\r\n              enabled: ecmax === 30\r\n            },\r\n            {\r\n              title: '50 %',\r\n              value: 50,\r\n              enabled: ecmax === 50 || !ecmax\r\n            },\r\n            {\r\n              title: '75 %',\r\n              value: 75,\r\n              enabled: ecmax === 75\r\n            },\r\n            {\r\n              title: '100 %',\r\n              value: 100,\r\n              enabled: ecmax === 100\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a layer by name or keyword\r\n   * @param term Layer name or keyword\r\n   * @returns Observable of <SearchResult<LayerOptions>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('q') || !params.get('type')) {\r\n      return of([]);\r\n    }\r\n    this.options.params.page = params.get('page') || '1';\r\n\r\n    return this.http\r\n      .get(this.searchUrl, { params })\r\n      .pipe(\r\n        map((response: ILayerServiceResponse) => this.extractResults(response, term))\r\n      );\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: ObjectUtils.removeUndefined(\r\n        Object.assign(\r\n          {\r\n            q: this.computeTerm(term)\r\n          },\r\n          this.params,\r\n          this.computeOptionsParam(term, options || {}).params,\r\n          {\r\n            page: options.page\r\n          }\r\n        )\r\n      )\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove hashtag from query\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTerm(term: string): string {\r\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\w- !\\-\\(\\),'#]+/g, '');\r\n  }\r\n\r\n  /**\r\n   * Add hashtag to param if valid\r\n   * @param term Query with hashtag\r\n   * @param options TextSearchOptions\r\n   */\r\n  private computeOptionsParam(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): TextSearchOptions {\r\n    const hashtags = super.getHashtagsValid(term, 'type');\r\n    if (hashtags) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        type: hashtags.join(',')\r\n      });\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  private extractResults(\r\n    response: ILayerServiceResponse, term: string\r\n  ): SearchResult<ILayerItemResponse>[] {\r\n    return response.items.map((data: ILayerData) =>\r\n    this.dataToResult(data, term, response)\r\n    );\r\n  }\r\n\r\n  private dataToResult(\r\n    data: ILayerData,\r\n    term: string,\r\n    response?: ILayerServiceResponse\r\n  ): SearchResult<ILayerItemResponse> {\r\n    const layerOptions = this.computeLayerOptions(data);\r\n\r\n    const titleHtml = data.highlight.title || data.properties.title;\r\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\r\n    const subtitleHtml = groupTitle\r\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\r\n      : '';\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: LAYER,\r\n        id: [this.getId(), data.properties.id].join('.'),\r\n        title: data.properties.title,\r\n        titleHtml: titleHtml + subtitleHtml,\r\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\r\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.name),\r\n        nextPage:\r\n          response.items.length % +this.options.params.limit === 0 &&\r\n          +this.options.params.page < 10\r\n      },\r\n      data: layerOptions\r\n    };\r\n  }\r\n\r\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\r\n    const url = data.properties.url;\r\n    const queryParams: QueryableDataSourceOptions = this.extractQueryParamsFromSourceUrl(\r\n      url\r\n    );\r\n    return ObjectUtils.removeUndefined({\r\n      sourceOptions: {\r\n        id: data.properties.id,\r\n        type: data.properties.format,\r\n        url,\r\n        queryFormat: queryParams.queryFormat,\r\n        queryHtmlTarget: queryParams.queryHtmlTarget,\r\n        params: data.properties.format === 'wms' ? {LAYERS: data.properties.name} : undefined,\r\n        layer: data.properties.format === 'wms' ? undefined : data.properties.name,\r\n        optionsFromCapabilities: true,\r\n        crossOrigin: 'anonymous'\r\n      },\r\n      title: data.properties.title,\r\n      maxResolution: getResolutionFromScale(\r\n        Number(data.properties.maxScaleDenom)\r\n      ),\r\n      minResolution: getResolutionFromScale(\r\n        Number(data.properties.minScaleDenom)\r\n      ),\r\n      metadata: {\r\n        url: data.properties.metadataUrl,\r\n        extern: data.properties.metadataUrl ? true : undefined,\r\n        abstract: data.properties.abstract || undefined\r\n      },\r\n      properties: this.formatter.formatResult(data).properties\r\n    });\r\n  }\r\n\r\n  private extractQueryParamsFromSourceUrl(\r\n    url: string\r\n  ): { queryFormat: QueryFormat; queryHtmlTarget: QueryHtmlTarget } {\r\n    let queryFormat;\r\n    let queryHtmlTarget;\r\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\r\n    if (formatOpt) {\r\n      for (const key of Object.keys(formatOpt)) {\r\n        const value = formatOpt[key];\r\n        if (value === '*') {\r\n          queryFormat = QueryFormat[key.toUpperCase()];\r\n          break;\r\n        }\r\n\r\n        const urls = ((value as any) as { urls: string[] }).urls;\r\n        if (Array.isArray(urls)) {\r\n          urls.forEach(urlOpt => {\r\n            if (url.indexOf(urlOpt) !== -1) {\r\n              queryFormat = QueryFormat[key.toUpperCase()];\r\n            }\r\n          });\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (\r\n        queryFormat === QueryFormat.HTML ||\r\n        queryFormat === QueryFormat.HTMLGML2\r\n      ) {\r\n        queryHtmlTarget = 'iframe';\r\n      }\r\n    }\r\n\r\n    return {\r\n      queryFormat,\r\n      queryHtmlTarget\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\r\n\r\n/**\r\n * ILayer search result formatter factory\r\n * @ignore\r\n */\r\nexport function ilayerSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new ILayerSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ILayer search result formatter\r\n */\r\nexport function provideILayerSearchResultFormatter() {\r\n  return {\r\n    provide: ILayerSearchResultFormatter,\r\n    useFactory: ilayerSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * ILayer search source factory\r\n * @ignore\r\n */\r\nexport function ilayerSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService,\r\n  formatter: ILayerSearchResultFormatter\r\n) {\r\n  return new ILayerSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\r\n    formatter\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ILayer search source\r\n */\r\nexport function provideILayerSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ilayerSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, ILayerSearchResultFormatter]\r\n  };\r\n}\r\n","import { FEATURE } from '../../feature';\r\nimport { LAYER } from '../../layer';\r\n\r\nexport const SEARCH_TYPES = [FEATURE, LAYER];\r\n","<div class=\"igo-search-selector\">\r\n  <button\r\n    mat-icon-button\r\n    class=\"igo-search-selector-button\"\r\n    color=\"primary\"\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\r\n    [matMenuTriggerFor]=\"searchSelectorMenu\">\r\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\r\n  </button>\r\n\r\n  <mat-menu\r\n    #searchSelectorMenu=\"matMenu\"\r\n    class=\"no-border-radius\"\r\n    xPosition=\"before\"\r\n    yPosition=\"above\">\r\n    <mat-radio-group\r\n      class=\"igo-search-selector-radio-group\"\r\n      [value]=\"searchType$ | async\"\r\n      (change)=\"onSearchTypeChange($event.value)\">\r\n      <mat-radio-button *ngFor=\"let searchType of searchTypes\" [value]=\"searchType\">\r\n        {{getSearchTypeTitle(searchType) | translate}}\r\n      </mat-radio-button>\r\n    </mat-radio-group>\r\n  </mat-menu>\r\n\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { SEARCH_TYPES } from '../shared/search.enums';\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\n\r\n/**\r\n * This component allows a user to select a search type yo enable. In it's\r\n * current version, only one search type can be selected at once (radio). If\r\n * this component were to support more than one search source enabled (checkbox),\r\n * the searchbar component would require a small change to it's\r\n * placeholder getter. The search source service already supports having\r\n * more than one search source enabled.\r\n */\r\n@Component({\r\n  selector: 'igo-search-selector',\r\n  templateUrl: './search-selector.component.html',\r\n  styleUrls: ['./search-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\r\n\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Subscription to the search type\r\n   */\r\n  private searchType$$: Subscription;\r\n\r\n  /**\r\n   * List of available search types\r\n   */\r\n  @Input() searchTypes: string[] = SEARCH_TYPES;\r\n\r\n  /**\r\n   * The search type enabled\r\n   */\r\n  @Input()\r\n  set searchType(value: string) { this.setSearchType(value); }\r\n  get searchType(): string { return this.searchType$.value; }\r\n\r\n  /**\r\n   * Event emitted when the enabled search type changes\r\n   */\r\n  @Output() searchTypeChange = new EventEmitter<string>();\r\n\r\n  constructor(private searchSourceService: SearchSourceService) {}\r\n\r\n  ngOnInit() {\r\n    this.searchType$$ = this.searchType$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.searchType$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Enable the selected search type\r\n   * @param searchType Search type\r\n   * @internal\r\n   */\r\n  onSearchTypeChange(searchType: string) {\r\n    this.setSearchType(searchType);\r\n  }\r\n\r\n  /**\r\n   * Get a search type's title. The title\r\n   * for all availables search typers needs to be defined in the locale\r\n   * files or an error will be thrown.\r\n   * @param searchType Search type\r\n   * @internal\r\n   */\r\n  getSearchTypeTitle(searchType: string) {\r\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\r\n  }\r\n\r\n  /**\r\n   * Emit an event and enable the search sources of the given type.\r\n   * @param searchType Search type\r\n   */\r\n  private setSearchType(searchType: string | undefined) {\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  private onSetSearchType(searchType: string) {\r\n    if (searchType === undefined || searchType === null) {\r\n      return;\r\n    }\r\n\r\n    this.searchSourceService.enableSourcesByType(searchType);\r\n    this.searchTypeChange.emit(searchType);\r\n  }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { SearchSelectorComponent } from './search-selector.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatTabsModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [SearchSelectorComponent],\r\n  declarations: [SearchSelectorComponent]\r\n})\r\nexport class IgoSearchSelectorModule {}\r\n","<div class=\"igo-search-settings\">\r\n\r\n  <button\r\n    mat-icon-button\r\n    class=\"igo-search-settings-button\"\r\n    color=\"primary\"\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\r\n    [matMenuTriggerFor]=\"searchSettingsMenu\">\r\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\r\n  </button>\r\n  <mat-menu\r\n    #searchSettingsMenu=\"matMenu\"\r\n    class=\"no-border-radius\">\r\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length>4\">\r\n      <button mat-raised-button\r\n        (click)=\"checkUncheckAllSources($event)\">{{!searchSourcesAllEnabled  ? ('igo.geo.search.searchSources.unselectAll' | translate): ('igo.geo.search.searchSources.selectAll' | translate)}}</button>\r\n    </div>\r\n      <ng-container *ngFor=\"let source of getSearchSources()\">\r\n        <span class=\"igo-search-settings-search-source\">\r\n          <mat-checkbox\r\n            class=\"igo-search-settings-checkbox\"\r\n            [checked]=\"source.enabled\"\r\n            [value]=\"source\"\r\n            (click)=\"$event.stopPropagation()\"\r\n            (change)=\"onCheckSearchSource($event, source)\">\r\n          </mat-checkbox>\r\n          <button *ngIf=\"source.settings.length>0\"\r\n            [matMenuTriggerFor]=\"sub_menu\"\r\n            mat-menu-item>{{source.title}}\r\n          </button>\r\n          <button\r\n            mat-menu-item\r\n            *ngIf=\"source.settings.length===0\">\r\n            {{source.title}}\r\n          </button>\r\n        </span>\r\n          <mat-menu #sub_menu=\"matMenu\">\r\n            <ng-container *ngFor=\"let setting of source.settings\">\r\n              <button\r\n                  mat-menu-item\r\n                  [matMenuTriggerFor]=\"test_sub_menu\">\r\n                {{'igo.geo.search.searchSources.settings.'+ setting.title | translate}}\r\n              </button>\r\n              <mat-menu #test_sub_menu=\"matMenu\"\r\n                [ngSwitch]=\"setting.type\"\r\n                yPosition=\"above\">\r\n                <span *ngSwitchCase=\"'radiobutton'\">\r\n                  <mat-radio-group\r\n                    class=\"igo-search-settings-radio-group\"\r\n                    [value]=\"setting\">\r\n                    <mat-radio-button *ngFor=\"let settingValue of setting.values\"\r\n                      class=\"mat-typography\"\r\n                      [value]=\"settingValue\"\r\n                      [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\r\n                      [checked]=\"settingValue.enabled\"\r\n                      (click)=\"$event.stopPropagation()\"\r\n                      (change)=\"settingsValueCheckedRadioButton($event, source, setting, settingValue)\">\r\n                      {{settingValue.title | translate}}\r\n                    </mat-radio-button>\r\n                  </mat-radio-group>\r\n                </span>\r\n                <span *ngSwitchCase=\"'checkbox'\">\r\n                  <div class=\"checkAllButton\" *ngIf=\"setting.values.length>3\">\r\n                    <button mat-raised-button\r\n                      (click)=\"checkUncheckAll($event, source, setting)\">{{setting.allEnabled || setting.allEnabled === undefined  ? ('igo.geo.search.searchSources.settings.unselectAll' | translate): ('igo.geo.search.searchSources.settings.selectAll' | translate)}}</button>\r\n                  </div>\r\n                  <mat-checkbox *ngFor=\"let settingValue of getAvailableValues(setting)\"\r\n                    class=\"mat-menu-item\"\r\n                    [style.display]=\"displayBlock\"\r\n                    [checked]=\"settingValue.enabled\"\r\n                    [value]=\"setting\"\r\n                    [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\r\n                    (click)=\"$event.stopPropagation()\"\r\n                    (change)=\"settingsValueCheckedCheckbox($event, source, setting, settingValue)\">\r\n                    {{settingValue.title | translate}}\r\n                  </mat-checkbox>\r\n                </span>\r\n              </mat-menu>\r\n            </ng-container>\r\n          </mat-menu>\r\n      </ng-container>\r\n      <span *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\">\r\n        <mat-divider></mat-divider>\r\n        <span class=\"pointer-summary-slide-toggle-container mat-typography\">\r\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changePointerReverseSearch($event)\" tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.pointerSearchSummary.tooltip' | translate\"\r\n            (click)=\"$event.stopPropagation()\" [checked]=\"pointerSummaryEnabled\" [labelPosition]=\"'after'\">\r\n            {{'igo.geo.search.pointerSearchSummary.title' | translate}}\r\n          </mat-slide-toggle>\r\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changeSearchResultsGeometry($event)\" tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.searchResultsGeometry.tooltip' | translate\"\r\n            (click)=\"$event.stopPropagation()\" [checked]=\"searchResultsGeometryEnabled\" [labelPosition]=\"'after'\">\r\n            {{'igo.geo.search.searchResultsGeometry.title' | translate}}\r\n          </mat-slide-toggle>\r\n        </span>\r\n      </span>\r\n  </mat-menu>\r\n</div>\r\n","import { MatCheckboxChange } from '@angular/material/checkbox';\r\nimport { MatRadioChange } from '@angular/material/radio';\r\n\r\nimport {\r\n  Component,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  HostListener,\r\n  Input\r\n} from '@angular/core';\r\n\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\nimport { SearchSource } from '../shared/sources/source';\r\nimport {\r\n  SearchSourceSettings,\r\n  SettingOptions\r\n} from '../shared/sources/source.interfaces';\r\nimport {\r\n  sourceCanReverseSearchAsSummary,\r\n  sourceCanSearch,\r\n  sourceCanReverseSearch\r\n} from '../shared/search.utils';\r\nimport { MediaService, StorageService } from '@igo2/core';\r\n\r\n/**\r\n * This component allows a user to select a search type yo enable. In it's\r\n * current version, only one search type can be selected at once (radio). If\r\n * this component were to support more than one search source enabled (checkbox),\r\n * the searchbar component would require a small change to it's\r\n * placeholder getter. The search source service already supports having\r\n * more than one search source enabled.\r\n */\r\n@Component({\r\n  selector: 'igo-search-settings',\r\n  templateUrl: './search-settings.component.html',\r\n  styleUrls: ['./search-settings.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchSettingsComponent implements OnInit {\r\n  public hasPointerReverseSearchSource: boolean = false;\r\n  public searchSourcesAllEnabled: boolean = false;\r\n\r\n  public buffer = [];\r\n  public lastKeyTime = Date.now();\r\n\r\n  public displayBlock = 'block';\r\n\r\n  get isTouchScreen(): boolean {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  @Input() pointerSummaryEnabled: boolean = false;\r\n  @Input() searchResultsGeometryEnabled: boolean = false;\r\n\r\n  /**\r\n   * Event emitted when the enabled search source changes\r\n   */\r\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\r\n\r\n  /**\r\n   * Event emitted when the pointer summary is activated\r\n   */\r\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the show geometry summary is changed\r\n   */\r\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\r\n\r\n  @HostListener('document:keydown', ['$event'])\r\n  handleKeyboardEvent(event: KeyboardEvent) {\r\n    if (event.key === 'F2') {\r\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\r\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private mediaService: MediaService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.hasPointerReverseSearchSource = this.hasReverseSearchSourcesForPointerSummary();\r\n  }\r\n\r\n  /**\r\n   * Get all search sources\r\n   * @internal\r\n   */\r\n  getSearchSources(): SearchSource[] {\r\n    const textSearchSources = this.searchSourceService\r\n      .getSources()\r\n      .filter(sourceCanSearch)\r\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\r\n\r\n    const reverseSearchSources = this.searchSourceService\r\n      .getSources()\r\n      .filter(sourceCanReverseSearch)\r\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\r\n    const sources = textSearchSources.concat(reverseSearchSources);\r\n    this.computeSourcesCheckAllBehavior(sources);\r\n    return sources;\r\n  }\r\n\r\n  /**\r\n   * Get all search sources usable for pointer summary\r\n   * @internal\r\n   */\r\n  hasReverseSearchSourcesForPointerSummary(): boolean {\r\n    if (\r\n      this.searchSourceService\r\n        .getEnabledSources()\r\n        .filter(sourceCanReverseSearchAsSummary).length\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Triggered when a setting is checked (checkbox style)\r\n   * @internal\r\n   */\r\n  settingsValueCheckedCheckbox(\r\n    event: MatCheckboxChange,\r\n    source: SearchSource,\r\n    setting: SearchSourceSettings,\r\n    settingValue: SettingOptions\r\n  ) {\r\n    settingValue.enabled = event.checked;\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  /**\r\n   * Defining the action to do for check/uncheck checkboxes (settings)\r\n   * return true if all checkbox must be checked\r\n   * return false if all checkbox must be unchecked\r\n   * @internal\r\n   */\r\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\r\n    if (setting.allEnabled === undefined) {\r\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\r\n        setting.allEnabled = false;\r\n      } else {\r\n        setting.allEnabled = true;\r\n      }\r\n    } else {\r\n      setting.allEnabled = !setting.allEnabled;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Defining the action to do for check/uncheck checkboxes (sources)\r\n   * return true if all checkbox must be checked\r\n   * return false if all checkbox must be unchecked\r\n   * @internal\r\n   */\r\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\r\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\r\n    const disabledSourcesCnt = sources.filter((source) => !source.enabled)\r\n      .length;\r\n    this.searchSourcesAllEnabled =\r\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\r\n  }\r\n\r\n  /**\r\n   * Triggered when the check all / uncheck all type is clicked,\r\n   * @internal\r\n   */\r\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\r\n    event.stopPropagation();\r\n    this.computeSettingCheckAllBehavior(setting);\r\n    setting.values.forEach((settingValue) => {\r\n      settingValue.enabled = setting.allEnabled;\r\n    });\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  /**\r\n   * Triggered when the check all / uncheck all type is clicked,\r\n   * @internal\r\n   */\r\n  checkUncheckAllSources(event) {\r\n    event.stopPropagation();\r\n    this.getSearchSources().map((source) => {\r\n      source.enabled = this.searchSourcesAllEnabled;\r\n      this.searchSourceChange.emit(source);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Triggered when a setting is checked (radiobutton style)\r\n   * @internal\r\n   */\r\n  settingsValueCheckedRadioButton(\r\n    event: MatRadioChange,\r\n    source: SearchSource,\r\n    setting: SearchSourceSettings,\r\n    settingValue: SettingOptions\r\n  ) {\r\n    setting.values.forEach((conf) => {\r\n      if (conf.value !== settingValue.value) {\r\n        conf.enabled = !event.source.checked;\r\n      } else {\r\n        conf.enabled = event.source.checked;\r\n      }\r\n    });\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\r\n    source.enabled = event.checked;\r\n    const storage = (this.storageService.get(source.getId() + '.options') || {}) as SettingOptions;\r\n    storage.enabled = source.enabled;\r\n    this.storageService.set(\r\n      source.getId() + '.options',\r\n      storage\r\n    );\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  getAvailableValues(setting: SearchSourceSettings) {\r\n    return setting.values.filter((s) => s.available !== false);\r\n  }\r\n\r\n  getAvailableHashtagsValues(setting: SettingOptions) {\r\n    if (setting.hashtags) {\r\n      return setting.hashtags.map((h) => '#' + h).join(', ');\r\n    }\r\n    return;\r\n  }\r\n\r\n  stopPropagation(event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  changePointerReverseSearch(event) {\r\n    this.pointerSummaryEnabled = event.checked;\r\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\r\n  }\r\n\r\n  changeSearchResultsGeometry(event) {\r\n    this.searchResultsGeometryEnabled = event.checked;\r\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { SearchSettingsComponent } from './search-settings.component';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  declarations: [SearchSettingsComponent],\r\n  imports: [\r\n    CommonModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatCheckboxModule,\r\n    MatDividerModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [SearchSettingsComponent]\r\n})\r\nexport class IgoSearchSettingsModule { }\r\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{empty: empty$ | async}\">\r\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\r\n    <mat-label *ngIf=\"label\">{{label}}</mat-label>\r\n    <input\r\n      #input\r\n      matInput\r\n      autocomplete=\"off\"\r\n      [ngClass]=\"{'hasSearchIcon': searchIcon}\"\r\n      [disabled]=\"disabled$ | async\"\r\n      [placeholder]=\"placeholder ? placeholder : (placeholder$ | async) ? (placeholder$.value | translate) : undefined\"\r\n      [value]=\"term$ | async\"\r\n      (keyup)=\"onKeyup($event)\"\r\n      (touchend)=\"onKeyup($event)\">\r\n  </mat-form-field>\r\n\r\n  <div class=\"search-bar-buttons\">\r\n    <button\r\n      mat-icon-button\r\n      [color]=\"color\"\r\n      *ngIf=\"searchIcon !== undefined\">\r\n      <mat-icon svgIcon=\"{{searchIcon}}\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      *ngIf=\"!(empty$ | async)\"\r\n      mat-icon-button\r\n      [color]=\"color\"\r\n      (click)=\"onClearButtonClick()\">\r\n      <mat-icon svgIcon=\"close\"></mat-icon>\r\n    </button>\r\n\r\n    <igo-search-selector\r\n      *ngIf=\"searchSelector\"\r\n      [searchTypes]=\"searchTypes\"\r\n      [searchType]=\"searchType$ | async\"\r\n      (searchTypeChange)=\"onSearchTypeChange($event)\">\r\n    </igo-search-selector>\r\n\r\n    <igo-search-settings\r\n      *ngIf=\"searchSettings\"\r\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\r\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\r\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\r\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\r\n      (searchSourceChange)=\"onSearchSettingsChange()\">\r\n    </igo-search-settings>\r\n  </div>\r\n</div>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ViewChild,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport {\r\n  FloatLabelType,\r\n  MatFormFieldAppearance\r\n} from '@angular/material/form-field';\r\nimport { BehaviorSubject, Subscription, EMPTY, timer } from 'rxjs';\r\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { EntityStore } from '@igo2/common';\r\n\r\nimport { SEARCH_TYPES } from '../shared/search.enums';\r\nimport { SearchResult, Research } from '../shared/search.interfaces';\r\nimport { SearchService } from '../shared/search.service';\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\n\r\n/**\r\n * Searchbar that triggers a research in all search sources enabled.\r\n * If the store input is defined, the search results will be loaded\r\n * into that store. An event is always emitted when a research is completed.\r\n */\r\n@Component({\r\n  selector: 'igo-search-bar',\r\n  templateUrl: './search-bar.component.html',\r\n  styleUrls: ['./search-bar.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchBarComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Invalid keys\r\n   */\r\n  static invalidKeys = [\r\n    'Control',\r\n    'Shift',\r\n    'Alt',\r\n    'ArrowDown',\r\n    'ArrowUp',\r\n    'ArrowRight',\r\n    'ArrowLeft'\r\n  ];\r\n\r\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'igo.geo.search.placeholder'\r\n  );\r\n\r\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  /**\r\n   * Subscription to the ssearch bar term\r\n   */\r\n  private term$$: Subscription;\r\n\r\n  /**\r\n   * Search term stream\r\n   */\r\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n  /**\r\n   * Subscription to the search term stream\r\n   */\r\n  private stream$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the search type\r\n   */\r\n  private searchType$$: Subscription;\r\n\r\n  private researches$$: Subscription[];\r\n\r\n  /**\r\n   * List of available search types\r\n   */\r\n  @Input() searchTypes: string[] = SEARCH_TYPES;\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  set searchType(value: string) {\r\n    this.setSearchType(value);\r\n  }\r\n  get searchType(): string {\r\n    return this.searchType$.value;\r\n  }\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Event emitted when the pointer summary is activated by the searchbar setting\r\n   */\r\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the show geometry setting is changed\r\n   */\r\n   @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  set term(value: string) {\r\n    this.setTerm(value);\r\n  }\r\n  get term(): string {\r\n    return this.term$.value;\r\n  }\r\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n  /**\r\n   * Whether this component is disabled\r\n   */\r\n  @Input()\r\n  set disabled(value: boolean) {\r\n    this.disabled$.next(value);\r\n  }\r\n  get disabled(): boolean {\r\n    return this.disabled$.value;\r\n  }\r\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  @Input() pointerSummaryEnabled: boolean = false;\r\n  @Input() searchResultsGeometryEnabled: boolean = false;\r\n  /**\r\n   * Whether a float label should be displayed\r\n   */\r\n  @Input() floatLabel: FloatLabelType = 'never';\r\n\r\n  @Input() appearance: MatFormFieldAppearance = 'legacy';\r\n\r\n  @Input() placeholder: string;\r\n\r\n  @Input() label: string;\r\n\r\n  /**\r\n   * Icons color (search and clear)\r\n   */\r\n  @Input() color = 'primary';\r\n\r\n  @Input() termSplitter: string = '|';\r\n\r\n  /**\r\n   * Debounce time between each keystroke\r\n   */\r\n  @Input() debounce = 200;\r\n\r\n  /**\r\n   * Minimum term length required to trigger a research\r\n   */\r\n  @Input() minLength = 2;\r\n\r\n  /**\r\n   * Search icon\r\n   */\r\n  @Input() searchIcon: string;\r\n\r\n  /**\r\n   * Search Selector\r\n   */\r\n  @Input() searchSelector = false;\r\n\r\n  /**\r\n   * Search Settings\r\n   */\r\n  @Input() searchSettings = false;\r\n\r\n  /**\r\n   * Force coordinates in north america\r\n   */\r\n  @Input() forceNA = false;\r\n\r\n  /**\r\n   * Search results store\r\n   */\r\n  @Input() store: EntityStore<SearchResult>;\r\n\r\n  /**\r\n   * Event emitted when the search term changes\r\n   */\r\n  @Output() searchTermChange = new EventEmitter<string>();\r\n\r\n  /**\r\n   * Event emitted when a research is completed\r\n   */\r\n  @Output() search = new EventEmitter<{\r\n    research: Research;\r\n    results: SearchResult[];\r\n  }>();\r\n\r\n  /**\r\n   * Event emitted when the search type changes\r\n   */\r\n  @Output() searchTypeChange = new EventEmitter<string>();\r\n\r\n  /**\r\n   * Event emitted when the search type changes\r\n   */\r\n  @Output() clearFeature = new EventEmitter();\r\n\r\n  /**\r\n   * Event emitted when the search settings changes\r\n   */\r\n  @Output() searchSettingsChange = new EventEmitter();\r\n\r\n  /**\r\n   * Input element\r\n   * @internal\r\n   */\r\n  @ViewChild('input', { static: true }) input: ElementRef;\r\n\r\n  /**\r\n   * Whether the search bar is empty\r\n   * @internal\r\n   */\r\n  get empty(): boolean {\r\n    return this.term.length === 0;\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private searchService: SearchService,\r\n    private searchSourceService: SearchSourceService\r\n  ) {}\r\n\r\n  /**\r\n   * Subscribe to the search term stream and trigger researches\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.term$$ = this.term$.subscribe((term: string) => {\r\n      this.empty$.next(term === undefined || term.length === 0);\r\n    });\r\n\r\n    this.stream$$ = this.stream$\r\n      .pipe(\r\n        debounce((term: string) => (term === '' ? EMPTY : timer(this.debounce)))\r\n      )\r\n      .subscribe((term: string) => this.onSetTerm(term));\r\n\r\n    this.handlePlaceholder();\r\n\r\n    this.searchType$$ = this.searchType$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the search term stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.term$$.unsubscribe();\r\n    this.stream$$.unsubscribe();\r\n    this.searchType$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * When a user types, validates the key and send it into the\r\n   * stream if it's valid\r\n   * @param event Keyboard event\r\n   * @internal\r\n   */\r\n  onKeyup(event: KeyboardEvent) {\r\n    const key = event.key;\r\n    if (!this.keyIsValid(key)) {\r\n      return;\r\n    }\r\n    const term = (event.target as HTMLInputElement).value;\r\n    this.setTerm(term);\r\n  }\r\n\r\n  /**\r\n   * Clear the stream and the input\r\n   * @internal\r\n   */\r\n  onClearButtonClick() {\r\n    this.clear();\r\n    this.clearFeature.emit();\r\n  }\r\n\r\n  /**\r\n   * Update search type\r\n   * @param searchType Enabled search type\r\n   * @internal\r\n   */\r\n  onSearchTypeChange(searchType: string) {\r\n    this.setSearchType(searchType);\r\n  }\r\n\r\n  /**\r\n   * Update the placeholder with the enabled search type. The placeholder\r\n   * for all availables search typers needs to be defined in the locale\r\n   * files or an error will be thrown.\r\n   * @param searchType Enabled search type\r\n   * @internal\r\n   */\r\n  setSearchType(searchType: string) {\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  onSearchSettingsChange() {\r\n    this.doSearch(this.term);\r\n    this.searchSettingsChange.emit();\r\n    this.handlePlaceholder();\r\n  }\r\n\r\n  /**\r\n   * Send the term into the stream only if this component is not disabled\r\n   * @param term Search term\r\n   */\r\n  setTerm(term: string) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    term = term || '';\r\n\r\n    if (term !== this.term) {\r\n      this.term$.next(term);\r\n    }\r\n\r\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\r\n    if (slug.length >= this.minLength || slug.length === 0) {\r\n      this.stream$.next(term);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the stream and the input\r\n   */\r\n  private clear() {\r\n    this.term$.next('');\r\n    this.stream$.next('');\r\n    this.input.nativeElement.focus();\r\n  }\r\n\r\n  /**\r\n   * Validate if a given key stroke is a valid input\r\n   */\r\n  private keyIsValid(key: string) {\r\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\r\n  }\r\n\r\n  /**\r\n   * When the search term changes, emit an event and trigger a\r\n   * research in every enabled search sources.\r\n   * @param term Search term\r\n   */\r\n  private onSetTerm(term: string | undefined) {\r\n    this.searchTermChange.emit(term);\r\n    this.doSearch(term);\r\n  }\r\n\r\n  private handlePlaceholder() {\r\n    const searchTypes = [\r\n      ...new Set(\r\n        this.searchSourceService\r\n          .getEnabledSources()\r\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\r\n          .map((ss) => ss.getType())\r\n      )\r\n    ];\r\n\r\n    let placeholder = `igo.geo.search.placeholder`;\r\n    if (searchTypes.length === 1) {\r\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\r\n    } else if (searchTypes.length === 0) {\r\n      placeholder = `igo.geo.search.emptyType.placeholder`;\r\n    }\r\n    this.placeholder$.next(placeholder);\r\n  }\r\n\r\n  private onSetSearchType(searchType: string) {\r\n    if (searchType === undefined || searchType === null) {\r\n      return;\r\n    }\r\n\r\n    this.searchTypeChange.emit(searchType);\r\n\r\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\r\n    this.placeholder$.next(placeholder);\r\n\r\n    this.setTerm(this.term);\r\n  }\r\n\r\n  /**\r\n   * Execute the search\r\n   * @param term Search term\r\n   */\r\n  private doSearch(rawTerm: string | undefined) {\r\n    if (this.researches$$) {\r\n      this.researches$$.map((research) => research.unsubscribe());\r\n      this.researches$$ = undefined;\r\n    }\r\n\r\n    let terms;\r\n    if (this.termSplitter && rawTerm.match(new RegExp(this.termSplitter, 'g'))) {\r\n      terms = rawTerm.split(this.termSplitter).filter((t) => t.length >= this.minLength);\r\n      this.store.clear();\r\n    } else {\r\n      terms = [rawTerm];\r\n    }\r\n\r\n    let researches: Research[] = [];\r\n    terms.map((term: string) => {\r\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\r\n      if (slug === '') {\r\n        if (this.store !== undefined) {\r\n          this.store.clear();\r\n        }\r\n        return;\r\n      }\r\n\r\n      researches = researches.concat(this.searchService.search(term, {\r\n        forceNA: this.forceNA\r\n      }));\r\n    });\r\n    this.researches$$ = researches.map((research) => {\r\n      return research.request.subscribe((results: SearchResult[]) => {\r\n        this.onResearchCompleted(research, results);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * When a research  is completed, emit an event and update\r\n   * the store's items.\r\n   * @param research Research\r\n   * @param results Research results\r\n   */\r\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\r\n    this.search.emit({ research, results });\r\n\r\n    if (this.store !== undefined) {\r\n      const newResults = this.store\r\n        .all()\r\n        .filter((result) => result.source !== research.source)\r\n        .concat(results);\r\n      this.store.updateMany(newResults);\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\r\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\r\nimport { SearchBarComponent } from './search-bar.component';\r\nimport { SearchUrlParamDirective } from './search-url-param.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    IgoLanguageModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchSettingsModule\r\n  ],\r\n  exports: [\r\n    SearchBarComponent,\r\n  ],\r\n  declarations: [\r\n    SearchBarComponent,\r\n    SearchUrlParamDirective\r\n  ]\r\n})\r\nexport class IgoSearchBarModule {}\r\n","<mat-list-item>\r\n  <mat-icon *ngIf=\"icon\" mat-list-avatar svgIcon=\"{{showIcons ? icon : 'blank'}}\"></mat-icon>\r\n\r\n  <h4 matLine *ngIf=\"titleHtml\" [innerHtml]=\"titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"tooltipHtml\" matTooltipClass=\"search-result-tooltip\"></h4>\r\n  <h4 matLine *ngIf=\"!titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"title\">{{title}}</h4>\r\n\r\n  <button *ngIf=\"withZoomButton\"\r\n    igoStopPropagation\r\n    mat-icon-button\r\n    (click)=\"onZoomHandler()\">\r\n    <mat-icon svgIcon=\"magnify\"></mat-icon>\r\n  </button>\r\n\r\n  <ng-content\r\n    select=[igoSearchItemToolbar]>\r\n  </ng-content>\r\n\r\n</mat-list-item>\r\n","import { Component, Input, ChangeDetectionStrategy, EventEmitter, Output } from '@angular/core';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\n\r\nimport {\r\n  getEntityTitle,\r\n  getEntityTitleHtml,\r\n  getEntityIcon\r\n} from '@igo2/common';\r\n\r\nimport { SearchResult } from '../shared/search.interfaces';\r\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\r\nimport { IgoMap } from '../../map';\r\n\r\n/**\r\n * Search results list item\r\n */\r\n@Component({\r\n  selector: 'igo-search-results-item',\r\n  templateUrl: './search-results-item.component.html',\r\n  styleUrls: ['./search-results-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsItemComponent {\r\n  /**\r\n   * Search result item\r\n   */\r\n  @Input() result: SearchResult;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Search result title\r\n   * @internal\r\n   */\r\n\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean;\r\n\r\n  /**\r\n   * Whether there should be a zoom button\r\n   */\r\n  @Input() withZoomButton = false;\r\n\r\n  @Output() zoomEvent = new EventEmitter<boolean>();\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get title(): string {\r\n    return getEntityTitle(this.result);\r\n  }\r\n\r\n  /**\r\n   * Search result HTML title\r\n   * @internal\r\n   */\r\n  get titleHtml(): string {\r\n    return getEntityTitleHtml(this.result);\r\n  }\r\n\r\n  /**\r\n   * Search result tooltip\r\n   * @internal\r\n   */\r\n  get tooltipHtml(): string {\r\n    return this.titleHtml\r\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\r\n      .replace(/<\\/?[^>]+(>|$)/g, '');\r\n  }\r\n\r\n  /**\r\n   * Search result icon\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.result);\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  onZoomHandler() {\r\n    const olFeature = this.format.readFeature(this.result.data, {\r\n      dataProjection: this.result.data.projection,\r\n      featureProjection: this.map.projection\r\n    });\r\n    moveToOlFeatures(this.map, [olFeature], FeatureMotion.Default);\r\n  }\r\n}\r\n","<igo-list [navigation]=\"true\">\r\n  <ng-template\r\n    #groupTemplate\r\n    ngFor let-group\r\n    [ngForOf]=\"results$ | async\">\r\n\r\n    <igo-collapsible [class]=\"group.source.getId()\"\r\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\r\n      [title]=\"computeGroupTitle(group)\"\r\n      [collapsed]=\"collapsed[group.source.title]\"\r\n      (toggle)=\"collapsed[group.source.title] = $event\">\r\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\r\n    </igo-collapsible>\r\n\r\n    <ng-template #flatTemplate>\r\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\r\n    </ng-template>\r\n\r\n    <ng-template #storeItemTemplate let-results=\"results\">\r\n      <ng-template ngFor let-result [ngForOf]=\"results\">\r\n        <igo-search-results-item\r\n          igoListItem\r\n          color=\"accent\"\r\n          [map]=\"map\"\r\n          [result]=\"result\"\r\n          [showIcons]=\"showIcons\"\r\n          [withZoomButton]=\"withZoomButton\"\r\n          [focused]=\"store.state.get(result).focused\"\r\n          [selected]=\"store.state.get(result).selected\"\r\n          (focus)=\"resultFocus.emit(result)\"\r\n          (unfocus)=\"resultUnfocus.emit(result)\"\r\n          (select)=\"onResultSelect(result)\"\r\n          (mouseenter)=\"resultFocus.emit(result)\"\r\n          (mouseleave)=\"resultUnfocus.emit(result)\">\r\n\r\n          <ng-container igoSearchItemToolbar\r\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\r\n            [ngTemplateOutletContext]=\"{result: result}\">\r\n          </ng-container>\r\n\r\n        </igo-search-results-item>\r\n      </ng-template>\r\n      <span class=\"moreResults mat-typography\" *ngIf=\"isMoreResults(group)\" (click)=\"displayMoreResults(group)\">\r\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\r\n      </span>\r\n    </ng-template>\r\n\r\n  </ng-template>\r\n\r\n</igo-list>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ContentChild,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport type { TemplateRef } from '@angular/core';\r\n\r\nimport { Observable, EMPTY, timer, BehaviorSubject, Subscription } from 'rxjs';\r\nimport { debounce, map } from 'rxjs/operators';\r\n\r\nimport { EntityState, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreWatcher } from '@igo2/common';\r\n\r\nimport { IgoMap } from '../../map';\r\n\r\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\r\nimport { SearchService } from '../shared/search.service';\r\nimport { SearchResult, Research } from '../shared/search.interfaces';\r\nimport { SearchSource } from '../shared/sources/source';\r\n\r\nexport enum SearchResultMode {\r\n  Grouped = 'grouped',\r\n  Flat = 'flat'\r\n}\r\n\r\n/**\r\n * List of search results with focus and selection capabilities.\r\n * This component is dumb and only emits events.\r\n */\r\n@Component({\r\n  selector: 'igo-search-results',\r\n  templateUrl: './search-results.component.html',\r\n  styleUrls: ['./search-results.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Reference to the SearchResultMode enum\r\n   * @internal\r\n   */\r\n  public searchResultMode = SearchResultMode;\r\n\r\n  /**\r\n   * Search results store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<SearchResult>;\r\n\r\n  private settingsChange$$: Subscription;\r\n\r\n  public pageIterator: {sourceId: string}[] = [];\r\n\r\n  public collapsed: {sourceId: string}[] = [];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Search results store\r\n   */\r\n  @Input() store: EntityStore<SearchResult>;\r\n\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean;\r\n\r\n  /**\r\n   * Search results display mode\r\n   */\r\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\r\n\r\n  /**\r\n   * Whether there should be a zoom button\r\n   */\r\n  @Input() withZoomButton = false;\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  get term(): string {\r\n    return this._term;\r\n  }\r\n  set term(value: string) {\r\n    this._term = value;\r\n    this.pageIterator = [];\r\n  }\r\n  public _term: string;\r\n\r\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  @Input() termSplitter: string = '|';\r\n\r\n  /**\r\n   * Event emitted when a result is focused\r\n   */\r\n  @Output() resultFocus = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a result is unfocused\r\n   */\r\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a result is selected\r\n   */\r\n  @Output() resultSelect = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a research is completed after displaying more results is clicked\r\n   */\r\n  @Output() moreResults = new EventEmitter<{\r\n    research: Research;\r\n    results: SearchResult[];\r\n  }>();\r\n\r\n  /**\r\n   * Events emitted when a result is focus or unfocus by mouse event\r\n   */\r\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\r\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\r\n\r\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {}) templateSearchToolbar: TemplateRef<any>;\r\n\r\n  get results$(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\r\n    if (this._results$ === undefined) {\r\n      this._results$ = this.liftResults();\r\n    }\r\n    return this._results$;\r\n  }\r\n  private _results$: Observable<\r\n    {source: SearchSource; results: SearchResult[]}[]\r\n  >;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef,\r\n              private searchService: SearchService) {}\r\n\r\n  /**\r\n   * Bind the search results store to the watcher\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n\r\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\r\n      this.pageIterator = [];\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unbind the search results store from the watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n    this.settingsChange$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Compute a group title\r\n   * @param group Search results group\r\n   * @returns Group title\r\n   * @internal\r\n   */\r\n  computeGroupTitle(group: {source: SearchSource; results: SearchResult[]}): string {\r\n    const parts = [group.source.title];\r\n    const count = group.results.length;\r\n    if (count > 1) {\r\n      parts.push(`(${count})`);\r\n    }\r\n    return parts.join(' ');\r\n  }\r\n\r\n  /**\r\n   * When a result is selected, update it's state in the store and emit\r\n   * an event. A selected result is also considered focused\r\n   * @param result Search result\r\n   * @internal\r\n   */\r\n  onResultSelect(result: SearchResult) {\r\n    if (this.store.state.get(result)) {\r\n      if (this.store.state.get(result).selected === true) {\r\n        return;\r\n      }\r\n    }\r\n    this.store.state.update(result, {focused: true, selected: true}, true);\r\n    this.resultSelect.emit(result);\r\n  }\r\n\r\n  /**\r\n   * Return an observable of the search results, grouped by search source\r\n   * @returns Observable of grouped search results\r\n   * @internal\r\n   */\r\n   private liftResults(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\r\n    return this.store.stateView.all$().pipe(\r\n      debounce((results: {entity: SearchResult, state: EntityState}[]) => {\r\n        return results.length === 0 ? EMPTY : timer(200);\r\n      }),\r\n      map((results: {entity: SearchResult, state: EntityState}[]) => {\r\n        return this.groupResults(results.map(r => r.entity).sort(this.sortByOrder));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Sort the results by display order.\r\n   * @param r1 First result\r\n   * @param r2 Second result\r\n   */\r\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\r\n    return r1.source.displayOrder - r2.source.displayOrder;\r\n  }\r\n\r\n  /**\r\n   * Group results by search source\r\n   * @param results Search results from all sources\r\n   * @returns Search results grouped by source\r\n   */\r\n  private groupResults(results: SearchResult[]): {source: SearchSource; results: SearchResult[]}[] {\r\n    const grouped = new Map<SearchSource, SearchResult[]>();\r\n    results.forEach((result: SearchResult) => {\r\n      const source = result.source;\r\n      let sourceResults = grouped.get(source);\r\n      if (sourceResults === undefined) {\r\n        sourceResults = [];\r\n        grouped.set(source, sourceResults);\r\n      }\r\n      sourceResults.push(result);\r\n    });\r\n\r\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\r\n      if (this.pageIterator[source.getId()] === undefined) {\r\n        this.pageIterator[source.getId()] = 1;\r\n      }\r\n      return {source, results: grouped.get(source)};\r\n    });\r\n  }\r\n\r\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\r\n    // getStrategyOfType is to avoid display more result based on a filtered state\r\n    const stategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\r\n    const active = stategy?.active || false;\r\n    return !active && group.results &&\r\n      group.results[group.results.length - 1].meta.nextPage === true;\r\n  }\r\n\r\n  displayMoreResults(group: {source: SearchSource; results: SearchResult[]}) {\r\n    const options: TextSearchOptions = {\r\n      sourceId: group.source.getId(),\r\n      page: ++this.pageIterator[group.source.getId()]\r\n    };\r\n\r\n    let terms;\r\n    if (this.termSplitter && this.term.match(new RegExp(this.termSplitter, 'g'))) {\r\n      terms = this.term.split(this.termSplitter);\r\n    } else {\r\n      terms = [this.term];\r\n    }\r\n\r\n    let researches: Research[] = [];\r\n    terms.map((term: string) => {\r\n      researches = researches.concat(this.searchService.search(term, options));\r\n    });\r\n\r\n    researches.map(research => {\r\n      research.request.subscribe((results: SearchResult[]) => {\r\n        const newResults = group.results.concat(results);\r\n        if (!results.length) {\r\n          newResults[newResults.length - 1].meta.nextPage = false;\r\n        }\r\n        this.moreResults.emit({research, results: newResults});\r\n      });\r\n    });\r\n    return;\r\n  }\r\n}\r\n","<button\r\n(mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\r\n*ngIf=\"layer.meta.dataType === 'Layer'\"\r\nmat-icon-button\r\ntooltip-position=\"below\"\r\nmatTooltipShowDelay=\"500\"\r\n[matTooltip]=\"(tooltip$ | async) | translate\"\r\n[color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\r\n(click)=\"onToggleClick($event)\">\r\n<mat-icon\r\n  matBadge\r\n  igoMatBadgeIcon=\"eye-off\"\r\n  igoMatBadgeInverseColor=\"true\"\r\n  [matBadgeHidden]=\"(inRange$ | async)\"\r\n  matBadgeDisabled=\"true\"\r\n  matBadgeSize=\"small\"\r\n  matBadgePosition=\"after\"\r\n  [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\r\n</mat-icon>\r\n</button>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { SearchResult } from '../shared/search.interfaces';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { LAYER } from '../../layer/shared/layer.enums';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-search-add-button',\r\n  templateUrl: './search-results-add-button.component.html',\r\n  styleUrls: ['./search-results-add-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\r\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'igo.geo.catalog.layer.addToMap'\r\n  );\r\n\r\n  private resolution$$: Subscription;\r\n\r\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private layersSubcriptions = [];\r\n\r\n  private lastTimeoutRequest;\r\n\r\n  private mouseInsideAdd: boolean = false;\r\n\r\n  @Input() layer: SearchResult;\r\n\r\n  /**\r\n   * Whether the layer is already added to the map\r\n   */\r\n  @Input() added: boolean;\r\n\r\n  /**\r\n   * The map to add the search result layer to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor(private layerService: LayerService) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    if (this.layer.meta.dataType === 'Layer') {\r\n      this.added =\r\n        this.map.layers.findIndex(\r\n          lay => lay.id === this.layer.data.sourceOptions.id\r\n        ) !== -1;\r\n    }\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(value => {\r\n      this.isInResolutionsRange(value);\r\n      this.tooltip$.next(this.computeTooltip());\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    this.onToggleClick(event);\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(event) {\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n\r\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'click':\r\n        if (!this.isPreview$.value) {\r\n          if (this.added) {\r\n            this.remove();\r\n          } else {\r\n            this.add();\r\n          }\r\n        }\r\n        this.isPreview$.next(false);\r\n        break;\r\n      case 'mouseenter':\r\n        if (!this.isPreview$.value && !this.added) {\r\n          this.lastTimeoutRequest = setTimeout(() => {\r\n            this.add();\r\n            this.isPreview$.next(true);\r\n          }, 500);\r\n        }\r\n        this.mouseInsideAdd = true;\r\n        break;\r\n      case 'mouseleave':\r\n        if (this.isPreview$.value) {\r\n          this.remove();\r\n          this.isPreview$.next(false);\r\n        }\r\n        this.mouseInsideAdd = false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  private add() {\r\n    if (!this.added) {\r\n      this.added = true;\r\n      this.addLayerToMap();\r\n    }\r\n  }\r\n\r\n  private remove() {\r\n    if (this.added) {\r\n      this.added = false;\r\n      this.removeLayerFromMap();\r\n      this.layersSubcriptions.map(s => s.unsubscribe());\r\n      this.layersSubcriptions = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private addLayerToMap() {\r\n    if (this.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.layer.meta.dataType !== LAYER) {\r\n      return undefined;\r\n    }\r\n\r\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\r\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\r\n      layerOptions.sourceOptions.optionsFromApi = true;\r\n    }\r\n    this.layersSubcriptions.push(\r\n      this.layerService\r\n        .createAsyncLayer(layerOptions)\r\n        .subscribe(layer => this.map.addLayer(layer))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = false\r\n   */\r\n  private removeLayerFromMap() {\r\n    if (this.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.layer.meta.dataType !== LAYER) {\r\n      return undefined;\r\n    }\r\n\r\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\r\n    this.map.removeLayer(oLayer);\r\n  }\r\n\r\n  isInResolutionsRange(resolution: number) {\r\n    const minResolution = this.layer.data.minResolution || 0;\r\n    const maxResolution = this.layer.data.maxResolution || Infinity;\r\n    this.inRange$.next(\r\n      resolution >= minResolution && resolution <= maxResolution\r\n    );\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    if (this.added) {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.removeFromMap'\r\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\r\n    } else {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : 'igo.geo.catalog.layer.addToMapOutRange';\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoListModule,\r\n  IgoMatBadgeIconModule,\r\n  IgoStopPropagationModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\r\nimport { SearchResultsComponent } from './search-results.component';\r\nimport { SearchResultsItemComponent } from './search-results-item.component';\r\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatButtonModule,\r\n    IgoCollapsibleModule,\r\n    IgoListModule,\r\n    IgoStopPropagationModule,\r\n    IgoLanguageModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoMetadataModule,\r\n  ],\r\n  exports: [\r\n    SearchResultsComponent,\r\n    SearchResultAddButtonComponent\r\n  ],\r\n  declarations: [\r\n    SearchResultsComponent,\r\n    SearchResultsItemComponent,\r\n    SearchResultAddButtonComponent\r\n  ]\r\n})\r\nexport class IgoSearchResultsModule {}\r\n","import { OnReturn } from 'ol/Observable';\r\nimport { FeatureGeometry } from './../../feature/shared/feature.interfaces';\r\nimport {\r\n  Directive,\r\n  Input,\r\n  OnDestroy,\r\n  Self,\r\n  OnInit,\r\n  HostListener,\r\n  AfterContentChecked\r\n} from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { ListenerFunction } from 'ol/events';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { SearchService } from './search.service';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport { transform } from 'ol/proj';\r\nimport * as olstyle from 'ol/style';\r\nimport * as olgeom from 'ol/geom';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { SearchResult, Research } from './search.interfaces';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { take } from 'rxjs/operators';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\r\nimport { SearchSourceService } from './search-source.service';\r\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\r\nimport { MediaService } from '@igo2/core';\r\n\r\n/**\r\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\r\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\r\n * By default, no search sources. Config in config file must be defined.\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoSearchPointerSummary]'\r\n})\r\nexport class SearchPointerSummaryDirective implements OnInit, OnDestroy, AfterContentChecked {\r\n\r\n  public store: FeatureStore<Feature>;\r\n  private lonLat: [number, number];\r\n  private pointerSearchStore: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\r\n  private lastTimeoutRequest;\r\n  private store$$: Subscription;\r\n  private layers$$: Subscription;\r\n  private reverseSearch$$: Subscription[] = [];\r\n  private hasPointerReverseSearchSource: boolean =  false;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener: OnReturn;\r\n\r\n  private searchPointerSummaryFeatureId: string = 'searchPointerSummaryFeatureId';\r\n  /**\r\n   * The delay where the mouse must be motionless before trigger the reverse search\r\n   */\r\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\r\n\r\n  /**\r\n   * If the user has enabled or not the directive\r\n   */\r\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private searchService: SearchService,\r\n    private searchSourceService: SearchSourceService,\r\n    private mediaService: MediaService\r\n  ) { }\r\n\r\n  /**\r\n   * Start listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.listenToMapPointerMove();\r\n    this.subscribeToPointerStore();\r\n\r\n    this.map.status$.pipe(take(1)).subscribe(() => {\r\n      this.store = new FeatureStore<Feature>([], {map: this.map});\r\n      this.initStore();\r\n    });\r\n\r\n    // To handle context change without using the contextService.\r\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\r\n      if (this.store && !layers.find(l => l.id === 'searchPointerSummaryId')) {\r\n        this.initStore();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Initialize the pointer position store\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      id : 'searchPointerSummaryId',\r\n      title: 'searchPointerSummary',\r\n      zIndex: 900,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      style: pointerPositionSummaryMarker\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n  }\r\n\r\n  ngAfterContentChecked(): void {\r\n      if (!this.searchSourceService.getEnabledSources().filter(sourceCanReverseSearchAsSummary).length) {\r\n        this.hasPointerReverseSearchSource = false;\r\n      } else {\r\n        this.hasPointerReverseSearchSource = true;\r\n      }\r\n    }\r\n\r\n  /**\r\n   * Stop listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unsubscribeToPointerStore();\r\n    this.unsubscribeReverseSearch();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to pointermove result store\r\n   * @internal\r\n   */\r\n  subscribeToPointerStore() {\r\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(resultsUnderPointerPosition => {\r\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Build an object based on the closest feature by type (base on type and distance properties )\r\n   * @param results SearchResult[]\r\n   * @returns OL style function\r\n   */\r\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\r\n    const closestResultByType = {};\r\n\r\n    results.map(result => {\r\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\r\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\r\n          const prevDistance = closestResultByType[result.data.properties.type].distance;\r\n          if (result.data.properties.distance < prevDistance) {\r\n            closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title: result.meta.title };\r\n          }\r\n        } else {\r\n          closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title: result.meta.title };\r\n        }\r\n      }\r\n    });\r\n\r\n    return closestResultByType;\r\n  }\r\n\r\n  /**\r\n   * convert store entities to a pointer position overlay with label summary on.\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: SearchResult[]) {\r\n    const closestResultByType = this.computeSummaryClosestFeature(resultsUnderPointerPosition);\r\n    const summarizedClosestType = Object.keys(closestResultByType);\r\n    const processedSummarizedClosestType = [];\r\n    const summary = [];\r\n    resultsUnderPointerPosition.map(result => {\r\n      const typeIndex = summarizedClosestType.indexOf(result.data.properties.type);\r\n      if (typeIndex !== -1) {\r\n        summary.push(closestResultByType[result.data.properties.type].title);\r\n        summarizedClosestType.splice(typeIndex, 1);\r\n        processedSummarizedClosestType.push(result.data.properties.type);\r\n      } else {\r\n        if (processedSummarizedClosestType.indexOf(result.data.properties.type) === -1) {\r\n          summary.push(result.meta.title);\r\n        }\r\n      }\r\n    });\r\n    if (summary.length) {\r\n      this.addPointerOverlay(summary.join('\\n'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to pointer store.\r\n   * @internal\r\n   */\r\n  unsubscribeToPointerStore() {\r\n    this.store$$.unsubscribe();\r\n  }\r\n  /**\r\n   * Unsubscribe to reverse seatch store.\r\n   * @internal\r\n   */\r\n  unsubscribeReverseSearch() {\r\n    this.reverseSearch$$.map(s => s.unsubscribe());\r\n    this.reverseSearch$$ = [];\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   * @internal\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    // this.map.ol.un(this.pointerMoveListener.type, this.pointerMoveListener.listener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\r\n    if (\r\n      event.dragging || !this.igoSearchPointerSummaryEnabled ||\r\n      !this.hasPointerReverseSearchSource || this.mediaService.isTouchScreen()) {\r\n      this.clearLayer();\r\n      return;\r\n    }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n      this.clearLayer();\r\n      this.unsubscribeReverseSearch();\r\n    }\r\n\r\n    this.lonLat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\r\n\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      this.onSearchCoordinate();\r\n    }, this.igoSearchPointerSummaryDelay);\r\n  }\r\n\r\n  private onSearchCoordinate() {\r\n    this.pointerSearchStore.clear();\r\n    const results = this.searchService.reverseSearch(this.lonLat, { params: { geometry: 'false', icon: 'false' } }, true);\r\n\r\n    for (const i in results) {\r\n      if (results.length > 0) {\r\n        this.reverseSearch$$.push(\r\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\r\n            this.onSearch({ research: results[i], results: _results });\r\n          }));\r\n      }\r\n    }\r\n  }\r\n\r\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\r\n    const results = event.results;\r\n    const newResults = this.pointerSearchStore.all()\r\n      .filter((result: SearchResult) => result.source !== event.research.source)\r\n      .concat(results);\r\n    this.pointerSearchStore.load(newResults);\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the pointer store\r\n   * @param text string\r\n   */\r\n  private addPointerOverlay(text: string) {\r\n    this.clearLayer();\r\n\r\n    const geometry = new olgeom.Point(\r\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\r\n    );\r\n    const feature = new olFeature({ geometry });\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.mapProjection,\r\n      dataProjection: this.mapProjection\r\n    }) as FeatureGeometry;\r\n\r\n    const f: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.mapProjection,\r\n      properties: {\r\n        id: this.searchPointerSummaryFeatureId,\r\n        pointerSummary: text\r\n      },\r\n      meta: {\r\n        id: this.searchPointerSummaryFeatureId\r\n      },\r\n      ol: feature\r\n    };\r\n    this.store.setLayerFeatures([f], FeatureMotion.None);\r\n  }\r\n\r\n/**\r\n * Clear the pointer store features\r\n */\r\nprivate clearLayer() {\r\n  if (this.store) {\r\n    this.store.clearLayer();\r\n  }\r\n}\r\n\r\n}\r\n\r\n/**\r\n * Create a default style for the pointer position and it's label summary.\r\n * @param feature OlFeature\r\n * @returns OL style function\r\n */\r\nexport function pointerPositionSummaryMarker(feature: olFeature<OlGeometry>, resolution: number): olstyle.Style {\r\n  return new olstyle.Style({\r\n    image: new olstyle.Icon({\r\n      src: './assets/igo2/geo/icons/cross_black_18px.svg',\r\n      imgSize: [18, 18], // for ie\r\n    }),\r\n\r\n    text: new olstyle.Text({\r\n      text: feature.get('pointerSummary'),\r\n      textAlign: 'left',\r\n      textBaseline: 'bottom',\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      backgroundFill: new olstyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\r\n      backgroundStroke: new olstyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true,\r\n      offsetX: 10,\r\n      offsetY: -10,\r\n      padding: [2.5, 2.5, 2.5, 2.5]\r\n    })\r\n  });\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { SearchService } from './shared/search.service';\r\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\r\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\r\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\r\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\r\n\r\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\r\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\r\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\r\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\r\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoSearchBarModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchResultsModule,\r\n    IgoSearchSettingsModule\r\n  ],\r\n  exports: [\r\n    IgoSearchBarModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchResultsModule,\r\n    IgoSearchSettingsModule,\r\n    SearchPointerSummaryDirective\r\n  ],\r\n  declarations: [SearchPointerSummaryDirective]\r\n})\r\nexport class IgoSearchModule {\r\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\r\n    return {\r\n      ngModule: IgoSearchModule,\r\n      providers: [\r\n        SearchService,\r\n        provideSearchSourceService(),\r\n        provideDefaultIChercheSearchResultFormatter(),\r\n        provideDefaultCoordinatesSearchResultFormatter(),\r\n        provideILayerSearchResultFormatter()\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\r\n\r\nimport { Layer } from '../../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../../map/shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter',\r\n  templateUrl: './ogc-filter.component.html',\r\n  styleUrls: ['./ogc-filter.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Event emitted on complete\r\n   */\r\n  @Output() complete = new EventEmitter<void>();\r\n\r\n  /**\r\n   * Event emitted on cancel\r\n   */\r\n  @Output() cancel = new EventEmitter<void>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Implemented as part of OnUpdateInputs\r\n   */\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * On close, emit the cancel event\r\n   */\r\n  onClose() {\r\n    this.cancel.emit();\r\n  }\r\n\r\n}\r\n","<igo-ogc-filterable-item\r\n  igoListItem\r\n  [layer]=\"layer\"\r\n  [header]=\"false\" \r\n  [map]=\"map\" >\r\n</igo-ogc-filterable-item>","import { InjectionToken } from '@angular/core';\r\n\r\nimport { Widget, WidgetService } from '@igo2/common';\r\n\r\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\r\n\r\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\r\n\r\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\r\n  return widgetService.create(OgcFilterComponent);\r\n}\r\n\r\nexport function provideOgcFilterWidget() {\r\n  return {\r\n    provide: OgcFilterWidget,\r\n    useFactory: ogcFilterWidgetFactory,\r\n    deps: [WidgetService]\r\n  };\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoFilterModule } from '../../../filter/filter.module';\r\nimport { OgcFilterComponent } from './ogc-filter.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule,\r\n    IgoFilterModule\r\n  ],\r\n  exports: [OgcFilterComponent],\r\n  declarations: [OgcFilterComponent]\r\n})\r\nexport class IgoOgcFilterModule {}\r\n","import {\r\n  Workspace,\r\n  WorkspaceOptions\r\n} from '@igo2/common';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\r\n  layer: VectorLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class WfsWorkspace extends Workspace {\r\n\r\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  get layer(): VectorLayer { return this.options.layer; }\r\n\r\n  get map(): IgoMap { return this.options.map; }\r\n\r\n  constructor(protected options: WfsWorkspaceOptions) {\r\n    super(options);\r\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\r\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\r\n        this.inResolutionRange$.next(true);\r\n      } else {\r\n        this.inResolutionRange$.next(false);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  ActionStore,\r\n  EntityTableTemplate,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityRecord,\r\n  EntityStoreStrategyFuncOptions,\r\n  EntityStoreFilterSelectionStrategy,\r\n  EntityTableColumnRenderer\r\n} from '@igo2/common';\r\n\r\nimport {\r\n  FeatureStore,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  FeatureStoreInMapExtentStrategy,\r\n  Feature,\r\n  FeatureMotion,\r\n  FeatureStoreInMapResolutionStrategy\r\n} from '../../feature';\r\nimport { VectorLayer } from '../../layer';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap } from '../../map';\r\nimport { SourceFieldsOptionsParams, FeatureDataSource } from '../../datasource';\r\n\r\nimport { WfsWorkspace } from './wfs-workspace';\r\nimport { skipWhile, take } from 'rxjs/operators';\r\nimport { StorageService } from '@igo2/core';\r\nimport { getRowsInMapExtent, getSelectedOnly, setRowsInMapExtent, setSelectedOnly } from './workspace.utils';\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WfsWorkspaceService {\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(private storageService: StorageService) {}\r\n\r\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\r\n    if (layer.options.workspace?.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\r\n      {\r\n        enabled: true,\r\n        srcId: layer.id,\r\n        workspaceId: layer.id\r\n      } as GeoWorkspaceOptions);\r\n\r\n    const wks = new WfsWorkspace({\r\n      id: layer.id,\r\n      title: layer.title,\r\n      layer,\r\n      map,\r\n      entityStore: this.createFeatureStore(layer, map),\r\n      actionStore: new ActionStore([]),\r\n      meta: {\r\n        tableTemplate: undefined\r\n      }\r\n    });\r\n    this.createTableTemplate(wks, layer);\r\n    return wks;\r\n\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], {map});\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: undefined,\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n\r\n  private createTableTemplate(workspace: WfsWorkspace,  layer: VectorLayer): EntityTableTemplate {\r\n    const fields = layer.dataSource.options.sourceFields || [];\r\n\r\n    if (fields.length === 0) {\r\n      workspace.entityStore.entities$.pipe(\r\n        skipWhile(val => val.length === 0),\r\n        take(1)\r\n      ).subscribe(entities => {\r\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\r\n        const columnsFromFeatures = ol.getKeys()\r\n        .filter(\r\n          col => !col.startsWith('_') &&\r\n          col !== 'geometry' &&\r\n          col !== ol.getGeometryName() &&\r\n          !col.match(/boundedby/gi))\r\n        .map(key => {\r\n          return {\r\n            name: `properties.${key}`,\r\n            title: key,\r\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n          };\r\n        });\r\n        workspace.meta.tableTemplate = {\r\n          selection: true,\r\n          sort: true,\r\n          columns: columnsFromFeatures\r\n        };\r\n      });\r\n      return;\r\n    }\r\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\r\n      return {\r\n        name: `properties.${field.name}`,\r\n        title: field.alias ? field.alias : field.name,\r\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n      };\r\n    });\r\n    workspace.meta.tableTemplate = {\r\n      selection: true,\r\n      sort: true,\r\n      columns\r\n    };\r\n  }\r\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\r\n    const filterClauseFunc = (record: EntityRecord<object>) => {\r\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\r\n    };\r\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ActionStore, EntityRecord, EntityStoreFilterCustomFuncStrategy, EntityStoreFilterSelectionStrategy, EntityStoreStrategyFuncOptions, EntityTableColumnRenderer, EntityTableTemplate } from '@igo2/common';\r\nimport { StorageService } from '@igo2/core';\r\nimport { skipWhile, take } from 'rxjs/operators';\r\nimport { SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport { Feature, FeatureMotion, FeatureStore, FeatureStoreInMapExtentStrategy, FeatureStoreInMapResolutionStrategy, FeatureStoreLoadingLayerStrategy, FeatureStoreSelectionStrategy } from '../../feature';\r\n\r\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\r\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap } from '../../map';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport { WfsWorkspace } from './wfs-workspace';\r\nimport { getRowsInMapExtent, getSelectedOnly, setRowsInMapExtent, setSelectedOnly } from './workspace.utils';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WmsWorkspaceService {\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(private layerService: LayerService, private storageService: StorageService) { }\r\n\r\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\r\n    if (layer.options.workspace?.enabled !== true) {\r\n      return;\r\n    }\r\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\r\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\r\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\r\n    if (!layer.options.linkedLayers) {\r\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\r\n    }\r\n    const linkProperties = {\r\n      bidirectionnal: true,\r\n      syncedDelete: true,\r\n      linkedIds: [wfsLinkId],\r\n      properties: [\r\n        LinkedProperties.ZINDEX,\r\n        LinkedProperties.VISIBLE]\r\n    } as LayersLinkProperties;\r\n\r\n    if (!layer.options.workspace?.minResolution) {\r\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\r\n    }\r\n    let hasOgcFilters = false;\r\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\r\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\r\n      hasOgcFilters = true;\r\n    }\r\n    if (!layer.options.workspace?.maxResolution) {\r\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\r\n    }\r\n\r\n    let clonedLinks: LayersLinkProperties[] = [];\r\n    if (layer.options.linkedLayers.links) {\r\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\r\n    }\r\n    clonedLinks.push(linkProperties);\r\n\r\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\r\n      layer.options.linkedLayers.links = clonedLinks;\r\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\r\n    let wks;\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        id: wfsLinkId,\r\n        linkedLayers: {\r\n          linkId: wfsLinkId\r\n        },\r\n        workspace: {\r\n          srcId: layer.id,\r\n          workspaceId: undefined,\r\n          enabled: false,\r\n        },\r\n        showInLayerList: false,\r\n        opacity: 0,\r\n        title: layer.title,\r\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\r\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\r\n        sourceOptions: {\r\n          download: dataSource.options.download,\r\n          type: 'wfs',\r\n          url: dataSource.options.urlWfs || dataSource.options.url,\r\n          queryable: true,\r\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\r\n          params: dataSource.options.paramsWFS,\r\n          ogcFilters: Object.assign({}, dataSource.ogcFilters$.value, {enabled: hasOgcFilters}),\r\n          sourceFields: dataSource.options.sourceFields || undefined\r\n        } as WFSoptions\r\n      })\r\n      .subscribe((workspaceLayer: VectorLayer) => {\r\n        map.addLayer(workspaceLayer);\r\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\r\n        workspaceLayer.dataSource.ol.refresh();\r\n\r\n        wks = new WfsWorkspace({\r\n          id: layer.id,\r\n          title: layer.title,\r\n          layer: workspaceLayer,\r\n          map,\r\n          entityStore: this.createFeatureStore(workspaceLayer, map),\r\n          actionStore: new ActionStore([]),\r\n          meta: {\r\n            tableTemplate: undefined\r\n          }\r\n        });\r\n        this.createTableTemplate(wks, workspaceLayer);\r\n\r\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\r\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\r\n          {\r\n            enabled: true,\r\n            srcId: layer.id,\r\n            workspaceId: workspaceLayer.id\r\n          } as GeoWorkspaceOptions);\r\n\r\n        delete dataSource.options.download;\r\n        return wks;\r\n\r\n      });\r\n\r\n    return wks;\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], { map });\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: undefined,\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n\r\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\r\n    const fields = layer.dataSource.options.sourceFields || [];\r\n\r\n    if (fields.length === 0) {\r\n      workspace.entityStore.entities$.pipe(\r\n        skipWhile(val => val.length === 0),\r\n        take(1)\r\n      ).subscribe(entities => {\r\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\r\n        const columnsFromFeatures = ol.getKeys()\r\n          .filter(\r\n            col => !col.startsWith('_') &&\r\n              col !== 'geometry' &&\r\n              col !== ol.getGeometryName() &&\r\n              !col.match(/boundedby/gi))\r\n          .map(key => {\r\n            return {\r\n              name: `properties.${key}`,\r\n              title: key,\r\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n            };\r\n          });\r\n        workspace.meta.tableTemplate = {\r\n          selection: true,\r\n          sort: true,\r\n          columns: columnsFromFeatures\r\n        };\r\n      });\r\n      return;\r\n    }\r\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\r\n      return {\r\n        name: `properties.${field.name}`,\r\n        title: field.alias ? field.alias : field.name,\r\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n      };\r\n    });\r\n    workspace.meta.tableTemplate = {\r\n      selection: true,\r\n      sort: true,\r\n      columns\r\n    };\r\n  }\r\n\r\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\r\n    const filterClauseFunc = (record: EntityRecord<object>) => {\r\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\r\n    };\r\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\r\n  }\r\n}\r\n","import {\r\n  Workspace,\r\n  WorkspaceOptions\r\n} from '@igo2/common';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\r\n  layer: VectorLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class FeatureWorkspace extends Workspace {\r\n\r\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  get layer(): VectorLayer { return this.options.layer; }\r\n\r\n  get map(): IgoMap { return this.options.map; }\r\n\r\n  constructor(protected options: FeatureWorkspaceOptions) {\r\n    super(options);\r\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\r\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\r\n        this.inResolutionRange$.next(true);\r\n      } else {\r\n        this.inResolutionRange$.next(false);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  ActionStore,\r\n  EntityTableTemplate,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityRecord,\r\n  EntityStoreStrategyFuncOptions,\r\n  EntityStoreFilterSelectionStrategy,\r\n  EntityTableColumnRenderer\r\n} from '@igo2/common';\r\n\r\nimport {\r\n  FeatureStore,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  FeatureStoreInMapExtentStrategy,\r\n  Feature,\r\n  FeatureMotion,\r\n  FeatureStoreInMapResolutionStrategy\r\n} from '../../feature';\r\nimport { VectorLayer } from '../../layer';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap } from '../../map';\r\nimport { SourceFieldsOptionsParams, FeatureDataSource } from '../../datasource';\r\n\r\nimport { FeatureWorkspace } from './feature-workspace';\r\nimport { skipWhile, take } from 'rxjs/operators';\r\nimport { StorageService } from '@igo2/core';\r\nimport { getRowsInMapExtent, getSelectedOnly, setRowsInMapExtent, setSelectedOnly } from './workspace.utils';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FeatureWorkspaceService {\r\n\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(private storageService: StorageService) {}\r\n\r\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\r\n    if (layer.options.workspace?.enabled === false) {\r\n      return;\r\n    }\r\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {enabled: true});\r\n\r\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\r\n      {\r\n        enabled: true,\r\n        srcId: layer.id,\r\n        workspaceId: layer.id\r\n      } as GeoWorkspaceOptions);\r\n\r\n\r\n    const wks = new FeatureWorkspace({\r\n      id: layer.id,\r\n      title: layer.title,\r\n      layer,\r\n      map,\r\n      entityStore: this.createFeatureStore(layer, map),\r\n      actionStore: new ActionStore([]),\r\n      meta: {\r\n        tableTemplate: undefined\r\n      }\r\n    });\r\n    this.createTableTemplate(wks, layer);\r\n    return wks;\r\n\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], {map});\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: undefined,\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n\r\n  private createTableTemplate(workspace: FeatureWorkspace,  layer: VectorLayer): EntityTableTemplate {\r\n    const fields = layer.dataSource.options.sourceFields || [];\r\n\r\n    if (fields.length === 0) {\r\n      workspace.entityStore.entities$.pipe(\r\n        skipWhile(val => val.length === 0),\r\n        take(1)\r\n      ).subscribe(entities => {\r\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\r\n        const columnsFromFeatures = ol.getKeys()\r\n        .filter(\r\n          col => !col.startsWith('_') &&\r\n          col !== 'geometry' &&\r\n          col !== ol.getGeometryName() &&\r\n          !col.match(/boundedby/gi))\r\n        .map(key => {\r\n          return {\r\n            name: `properties.${key}`,\r\n            title: key,\r\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n          };\r\n        });\r\n        workspace.meta.tableTemplate = {\r\n          selection: true,\r\n          sort: true,\r\n          columns: columnsFromFeatures\r\n        };\r\n      });\r\n      return;\r\n    }\r\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\r\n      return {\r\n        name: `properties.${field.name}`,\r\n        title: field.alias ? field.alias : field.name,\r\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n      };\r\n    });\r\n    workspace.meta.tableTemplate = {\r\n      selection: true,\r\n      sort: true,\r\n      columns\r\n    };\r\n  }\r\n\r\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\r\n    const filterClauseFunc = (record: EntityRecord<object>) => {\r\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\r\n    };\r\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\r\n  }\r\n}\r\n","import { Directive, Input, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { Workspace, WorkspaceStore, WorkspaceSelectorComponent } from '@igo2/common';\r\n\r\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\nimport { WFSDataSource, WMSDataSource, FeatureDataSource } from '../../datasource';\r\nimport { OgcFilterableDataSourceOptions } from '../../filter';\r\n\r\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\r\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\r\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\r\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\n\r\n@Directive({\r\n  selector: '[igoWorkspaceSelector]'\r\n})\r\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\r\n\r\n  private layers$$: Subscription;\r\n  private entities$$: Subscription[] = [];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  get workspaceStore(): WorkspaceStore {\r\n    return this.component.store;\r\n  }\r\n\r\n  constructor(\r\n    private component: WorkspaceSelectorComponent,\r\n    private wfsWorkspaceService: WfsWorkspaceService,\r\n    private wmsWorkspaceService: WmsWorkspaceService,\r\n    private featureWorkspaceService: FeatureWorkspaceService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.layers$$ = this.map.layers$\r\n      .pipe(debounceTime(50))\r\n      .subscribe((layers: Layer[]) =>\r\n        this.onLayersChange(layers)\r\n      );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n    this.entities$$.map(entities => entities.unsubscribe());\r\n  }\r\n\r\n  private onLayersChange(layers: Layer[]) {\r\n    const editableLayers = layers.filter((layer: Layer) =>\r\n      this.layerIsEditable(layer)\r\n    );\r\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\r\n\r\n    const workspacesToAdd = editableLayers\r\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\r\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\r\n\r\n    const workspacesToRemove = this.workspaceStore.all()\r\n      .filter((workspace: Workspace) => {\r\n        return editableLayersIds.indexOf(workspace.id) < 0;\r\n      });\r\n\r\n    if (workspacesToRemove.length > 0) {\r\n      workspacesToRemove.forEach((workspace: Workspace) => {\r\n        workspace.entityStore.deactivateStrategyOfType(FeatureStoreInMapExtentStrategy);\r\n        workspace.deactivate();\r\n      });\r\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\r\n      this.workspaceStore.deleteMany(workspacesToRemove);\r\n    }\r\n\r\n    if (workspacesToAdd.length > 0) {\r\n      this.workspaceStore.insertMany(workspacesToAdd);\r\n    }\r\n  }\r\n\r\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\r\n    const workspace = this.workspaceStore.get(layer.id);\r\n    if (workspace !== undefined) {\r\n      return;\r\n    }\r\n    if (layer.dataSource instanceof WFSDataSource) {\r\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\r\n      return wfsWks;\r\n    } else if (layer.dataSource instanceof WMSDataSource) {\r\n      if (!layer.dataSource.options.paramsWFS) { return; }\r\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\r\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\r\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable = !inResolutionRange;\r\n        (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = inResolutionRange;\r\n      });\r\n      return wmsWks;\r\n    } else if (layer.dataSource instanceof FeatureDataSource && (layer as VectorLayer).exportable === true) {\r\n      const featureWks = this.featureWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\r\n      return featureWks;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  private layerIsEditable(layer: Layer): boolean {\r\n    const dataSource = layer.dataSource;\r\n    if (dataSource instanceof WFSDataSource) {\r\n      return true;\r\n    }\r\n    if (dataSource instanceof FeatureDataSource) {\r\n      return true;\r\n    }\r\n    if (dataSource instanceof WMSDataSource) {\r\n      const dataSourceOptions = (dataSource.options ||\r\n        {}) as OgcFilterableDataSourceOptions;\r\n      return (dataSourceOptions.ogcFilters?.enabled || dataSource.options.paramsWFS?.featureTypes !== undefined);\r\n    }\r\n\r\n    return false;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n   WorkspaceSelectorDirective\r\n  ],\r\n  declarations: [\r\n    WorkspaceSelectorDirective\r\n  ]\r\n})\r\nexport class IgoWorkspaceSelectorModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n   WorkspaceUpdatorDirective\r\n  ],\r\n  declarations: [\r\n    WorkspaceUpdatorDirective\r\n  ]\r\n})\r\nexport class IgoWorkspaceUpdatorModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { IgoWidgetModule } from '@igo2/common';\r\n\r\nimport { provideOgcFilterWidget } from './widgets/widgets';\r\n\r\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\r\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\r\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoWidgetModule,\r\n    IgoWorkspaceSelectorModule,\r\n    IgoWorkspaceUpdatorModule,\r\n    IgoOgcFilterModule\r\n  ],\r\n  exports: [\r\n    IgoWorkspaceSelectorModule,\r\n    IgoWorkspaceUpdatorModule,\r\n    IgoOgcFilterModule\r\n  ],\r\n  declarations: [],\r\n  providers: [\r\n    provideOgcFilterWidget()\r\n  ]\r\n})\r\nexport class IgoGeoWorkspaceModule {}\r\n","export enum DirectionsFormat {\r\n  GeoJSON,\r\n  JSON\r\n}\r\nexport enum SourceDirectionsType {\r\n  Route = 'Route',\r\n  Trip = 'Trip'\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { uuid } from '@igo2/utils';\r\nimport { ConfigService, Message } from '@igo2/core';\r\n\r\nimport { Directions, DirectionsOptions } from '../shared/directions.interface';\r\nimport { DirectionsFormat, SourceDirectionsType } from '../shared/directions.enum';\r\n\r\nimport { DirectionsSource } from './directions-source';\r\nimport { DirectionsSourceOptions } from './directions-source.interface';\r\n\r\n@Injectable()\r\nexport class OsrmDirectionsSource extends DirectionsSource {\r\n  get enabled(): boolean {\r\n    return this.options.enabled !== false;\r\n  }\r\n  set enabled(value: boolean) {\r\n    this.options.enabled = value;\r\n  }\r\n  static _name = 'OSRM Qubec';\r\n  private directionsUrl =\r\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\r\n  private options: DirectionsSourceOptions;\r\n\r\n  constructor(private http: HttpClient, private config: ConfigService) {\r\n    super();\r\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\r\n    this.directionsUrl = this.options.url || this.directionsUrl;\r\n  }\r\n\r\n  getName(): string {\r\n    return OsrmDirectionsSource._name;\r\n  }\r\n\r\n  route(coordinates: [number, number][], directionsOptions: DirectionsOptions = {}): Observable<Directions[]> {\r\n    const directionsParams = this.getRouteParams(directionsOptions);\r\n    return this.http\r\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\r\n        params: directionsParams\r\n      })\r\n      .pipe(map(res => this.extractRoutesData(res)));\r\n  }\r\n\r\n  private extractRoutesData(response): Directions[] {\r\n    const routeResponse = [];\r\n    response.routes.forEach(route => {\r\n      routeResponse.push(this.formatRoute(route, response.waypoints));\r\n    });\r\n    return routeResponse;\r\n  }\r\n\r\n  private getRouteParams(directionsOptions: DirectionsOptions = {}): HttpParams {\r\n\r\n    directionsOptions.alternatives = directionsOptions.alternatives !== undefined ? directionsOptions.alternatives : true;\r\n    directionsOptions.steps = directionsOptions.steps !== undefined  ? directionsOptions.steps : true;\r\n    directionsOptions.geometries = directionsOptions.geometries !== undefined  ? directionsOptions.geometries : 'geojson';\r\n    directionsOptions.overview = directionsOptions.overview !== undefined  ? directionsOptions.overview : false;\r\n\r\n    return new HttpParams({\r\n      fromObject: {\r\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\r\n        overview: directionsOptions.overview ? 'simplified' : 'full',\r\n        steps: directionsOptions.steps ? 'true' : 'false',\r\n        geometries: directionsOptions.geometries ? directionsOptions.geometries : 'geojson',\r\n      }\r\n    });\r\n  }\r\n\r\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Directions {\r\n    const stepsUI = [];\r\n    roadNetworkRoute.legs.forEach(leg => {\r\n      leg.steps.forEach(step => {\r\n        stepsUI.push(step);\r\n      });\r\n    });\r\n    return {\r\n      id: uuid(),\r\n      title: roadNetworkRoute.legs[0].summary,\r\n      source: OsrmDirectionsSource._name,\r\n      sourceType: SourceDirectionsType.Route,\r\n      order: 1,\r\n      format: DirectionsFormat.GeoJSON,\r\n      icon: 'directions',\r\n      projection: 'EPSG:4326',\r\n      waypoints,\r\n      distance: roadNetworkRoute.distance,\r\n      duration: roadNetworkRoute.duration,\r\n      geometry: roadNetworkRoute.geometry,\r\n      legs: roadNetworkRoute.legs,\r\n      steps: stepsUI,\r\n      weight: roadNetworkRoute.weight,\r\n      weight_name: roadNetworkRoute.weight_name\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { DirectionsSource } from './directions-source';\r\nimport { OsrmDirectionsSource } from './osrm-directions-source';\r\n\r\nexport function osrmDirectionsSourcesFactory(\r\n  http: HttpClient,\r\n  config: ConfigService\r\n) {\r\n  return new OsrmDirectionsSource(http, config);\r\n}\r\n\r\nexport function provideOsrmDirectionsSource() {\r\n  return {\r\n    provide: DirectionsSource,\r\n    useFactory: osrmDirectionsSourcesFactory,\r\n    multi: true,\r\n    deps: [HttpClient, ConfigService]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport olWKT from 'ol/format/WKT';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { computeTermSimilarity } from '../search.utils';\r\n/**\r\n * Cadastre search source\r\n */\r\n@Injectable()\r\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'cadastre';\r\n  static type = FEATURE;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n  }\r\n\r\n  getId(): string {\r\n    return CadastreSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return CadastreSearchSource.type;\r\n  }\r\n\r\n  /*\r\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Cadastre (Qubec)',\r\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a place by name\r\n   * @param term Place name\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\r\n    term = term.startsWith(',') ? term.substr(1) : term;\r\n    term = term.replace(/ /g, '');\r\n\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\r\n      return of([]);\r\n    }\r\n    return this.http\r\n      .get(this.searchUrl, { params, responseType: 'text' })\r\n      .pipe(map((response: string) => this.extractResults(response, term)));\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          numero: term,\r\n          epsg: '4326'\r\n        },\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(response: string, term: string): SearchResult<Feature>[] {\r\n    return response\r\n      .split('<br />')\r\n      .filter((lot: string) => lot.length > 0)\r\n      .map((lot: string) => this.dataToResult(lot, term));\r\n  }\r\n\r\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\r\n    const lot = data.split(';');\r\n    const numero = lot[0];\r\n    const wkt = lot[7];\r\n    const geometry = this.computeGeometry(wkt);\r\n\r\n    const properties = {\r\n      NoLot: numero,\r\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\r\n    };\r\n    const id = [this.getId(), 'cadastre', numero].join('.');\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: numero,\r\n        score: computeTermSimilarity(term.trim(), numero),\r\n        icon: 'map-marker'\r\n      },\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: numero\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeGeometry(wkt: string): FeatureGeometry {\r\n    const feature = new olWKT().readFeature(wkt, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: 'EPSG:4326'\r\n    });\r\n    return {\r\n      type: feature.getGeometry().getType(),\r\n      coordinates: feature.getGeometry().getCoordinates()\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport { CadastreSearchSource } from './cadastre';\r\n\r\n/**\r\n * Cadastre search source factory\r\n * @ignore\r\n */\r\nexport function cadastreSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService\r\n) {\r\n  return new CadastreSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`),\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Cadastre search source\r\n */\r\nexport function provideCadastreSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: cadastreSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\n\r\nimport { StorageService } from '@igo2/core';\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\nimport { NominatimData } from './nominatim.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\n\r\n/**\r\n * Nominatim search source\r\n */\r\n@Injectable()\r\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'nominatim';\r\n  static type = FEATURE;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    storageService: StorageService\r\n  ) {\r\n    super(options, storageService);\r\n  }\r\n\r\n  getId(): string {\r\n    return NominatimSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return NominatimSearchSource.type;\r\n  }\r\n\r\n  /*\r\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Nominatim (OSM)',\r\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'amenity',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.food',\r\n              value:\r\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.health',\r\n              value:\r\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.entertainment',\r\n              value:\r\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\r\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.finance',\r\n              value: 'atm,bank,bureau_de_change',\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: true\r\n            },\r\n            {\r\n              title: '20',\r\n              value: 20,\r\n              enabled: false\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'restrictExtent',\r\n          name: 'countrycodes',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.nominatim.country.canada',\r\n              value: 'CA',\r\n              enabled: true\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.country.all',\r\n              value: null,\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'multiple object',\r\n          name: 'dedupe',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.searchSources.settings.true',\r\n              value: 0,\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.searchSources.settings.false',\r\n              value: 1,\r\n              enabled: true\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a place by name\r\n   * @param term Place name\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('q')) {\r\n      return of([]);\r\n    }\r\n    return this.http\r\n      .get(this.searchUrl, { params })\r\n      .pipe(map((response: NominatimData[]) => this.extractResults(response, term)));\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          q: this.computeTerm(term),\r\n          format: 'json'\r\n        },\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(response: NominatimData[], term: string): SearchResult<Feature>[] {\r\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\r\n  }\r\n\r\n  private dataToResult(data: NominatimData, term: string): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const geometry = this.computeGeometry(data);\r\n    const extent = this.computeExtent(data);\r\n    const id = [this.getId(), 'place', data.place_id].join('.');\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.display_name,\r\n        icon: 'map-marker',\r\n        score: computeTermSimilarity(term.trim(), data.display_name)\r\n      },\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.display_name\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: NominatimData): { [key: string]: any } {\r\n    return {\r\n      display_name: data.display_name,\r\n      place_id: data.place_id,\r\n      osm_type: data.osm_type,\r\n      class: data.class,\r\n      type: data.type\r\n    };\r\n  }\r\n\r\n  private computeGeometry(data: NominatimData): FeatureGeometry {\r\n    return {\r\n      type: 'Point',\r\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\r\n    };\r\n  }\r\n\r\n  private computeExtent(data: NominatimData): [number, number, number, number] {\r\n    return [\r\n      parseFloat(data.boundingbox[2]),\r\n      parseFloat(data.boundingbox[0]),\r\n      parseFloat(data.boundingbox[3]),\r\n      parseFloat(data.boundingbox[1])\r\n    ];\r\n  }\r\n\r\n  private computeTerm(term: string): string {\r\n    return this.computeTermTags(term);\r\n  }\r\n\r\n  /**\r\n   * Add hashtag from query in Nominatim's format (+[])\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTermTags(term: string): string {\r\n    const hashtags = super.getHashtagsValid(term, 'amenity');\r\n    if (!hashtags) {\r\n      return this.computeTermSettings(term);\r\n    }\r\n\r\n    if (!hashtags.length) {\r\n      return null;\r\n    }\r\n\r\n    term = term.replace(/(#[^\\s]*)/g, '');\r\n    hashtags.forEach(tag => {\r\n      term += '+[' + tag + ']';\r\n    });\r\n\r\n    return term;\r\n  }\r\n\r\n  /**\r\n   * Add hashtag from settings in Nominatim's format (+[])\r\n   * @param term Query\r\n   */\r\n  private computeTermSettings(term: string): string {\r\n    this.options.settings.forEach(settings => {\r\n      if (settings.name === 'amenity') {\r\n        settings.values.forEach(conf => {\r\n          if (conf.enabled && typeof conf.value === 'string') {\r\n            const splitted = conf.value.split(',');\r\n            splitted.forEach(value => {\r\n              term += '+[' + value + ']';\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n    return term;\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport { NominatimSearchSource } from './nominatim';\r\n\r\n/**\r\n * Nominatim search source factory\r\n * @ignore\r\n */\r\nexport function nominatimSearchSourceFactory(\r\n  http: HttpClient,\r\n  config: ConfigService,\r\n  storageService: StorageService\r\n) {\r\n  return new NominatimSearchSource(\r\n    http,\r\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\r\n    storageService\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Nominatim search source\r\n */\r\nexport function provideNominatimSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: nominatimSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, ConfigService, StorageService]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { FEATURE, Feature } from '../../../feature';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\r\nimport {\r\n  SearchSourceOptions,\r\n  TextSearchOptions,\r\n  ReverseSearchOptions\r\n} from './source.interfaces';\r\nimport {\r\n  StoredQueriesData,\r\n  StoredQueriesResponse,\r\n  StoredQueriesReverseData,\r\n  StoredQueriesReverseResponse,\r\n  StoredQueriesSearchSourceOptions,\r\n  StoredQueriesFields,\r\n  StoredQueriesReverseSearchSourceOptions\r\n} from './storedqueries.interfaces';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { computeTermSimilarity } from '../search.utils';\r\n\r\n/**\r\n * StoredQueries search source\r\n */\r\n@Injectable()\r\nexport class StoredQueriesSearchSource extends SearchSource\r\n  implements TextSearch {\r\n  static id = 'storedqueries';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [\r\n    'boundedBy',\r\n    'id',\r\n    'coord_x',\r\n    'coord_y'\r\n  ];\r\n  public resultTitle: 'title';\r\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\r\n  public multipleFieldsQuery: boolean;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\r\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\r\n      return;\r\n    }\r\n\r\n    const defaultStoredqueryId = 'rtss';\r\n    const defaultFieldSplitter: StoredQueriesFields[] = [\r\n      { name: 'rtss', defaultValue: '-99' },\r\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\r\n    ];\r\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\r\n    const defaultSrsname = 'EPSG:4326';\r\n    const defaultResultTitle = 'title';\r\n\r\n    if (!this.storedQueriesOptions) {\r\n      console.log(\r\n        ' No configuration for this search source (storedqueries). You will use the default values'\r\n      );\r\n      this.storedQueriesOptions = {\r\n        storedquery_id: defaultStoredqueryId,\r\n        fields: defaultFieldSplitter,\r\n        outputformat: defaultOutputformat,\r\n        srsname: defaultSrsname,\r\n        resultTitle: defaultResultTitle\r\n      };\r\n      this.resultTitle = defaultResultTitle;\r\n      console.log('Default values', this.storedQueriesOptions);\r\n    }\r\n\r\n    if (!this.storedQueriesOptions.storedquery_id) {\r\n      const err =\r\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\r\n      throw new Error(err);\r\n    }\r\n    if (!this.storedQueriesOptions.fields) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\r\n      );\r\n    }\r\n\r\n    this.storedQueriesOptions.outputformat =\r\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\r\n    this.storedQueriesOptions.srsname =\r\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\r\n\r\n    const storedQueryId = this.storedQueriesOptions.storedquery_id.toLowerCase();\r\n    if (\r\n      storedQueryId.includes('getfeaturebyid') &&\r\n      this.storedQueriesOptions.outputformat\r\n        .toLowerCase()\r\n        .includes('getfeaturebyid')\r\n    ) {\r\n      let err =\r\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\r\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\r\n      throw new Error(err);\r\n    }\r\n\r\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\r\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\r\n    }\r\n\r\n    this.multipleFieldsQuery =\r\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\r\n\r\n    this.storedQueriesOptions.fields.forEach((field, index) => {\r\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\r\n        throw new Error(\r\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\r\n        );\r\n      }\r\n      if (!field.defaultValue) {\r\n        throw new Error(\r\n          'Stored Queries :You must set a field default value into your field definition'\r\n        );\r\n      }\r\n    });\r\n\r\n    this.storedQueriesOptions.resultTitle =\r\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\r\n  }\r\n\r\n  getId(): string {\r\n    return StoredQueriesSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return StoredQueriesSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Stored Queries',\r\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\r\n    };\r\n  }\r\n\r\n  // URL CALL EXAMPLES:\r\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\r\n  //  tslint:disable-next-line:max-line-length\r\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\r\n  //  Custom StoredQuery\r\n  //  tslint:disable-next-line:max-line-length\r\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const storedqueriesParams = this.termSplitter(\r\n      term,\r\n      this.storedQueriesOptions.fields\r\n    );\r\n    const params = this.computeRequestParams(\r\n      options || {},\r\n      storedqueriesParams\r\n    );\r\n    if (this.options.params == null) {\r\n      this.options.params = { page : '1'};\r\n    } else {\r\n      this.options.params.page = options.page != null ? String(options.page) : '1';\r\n    }\r\n\r\n    if (\r\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\r\n    ) {\r\n      return this.http\r\n        .get(this.searchUrl, { params, responseType: 'text' })\r\n        .pipe(\r\n          map(response => {\r\n            let resultArray = this.extractResults(this.extractWFSData(response), term);\r\n            resultArray.sort((a, b) =>\r\n              (a.meta.score > b.meta.score) ? 1 :\r\n              (a.meta.score === b.meta.score) ? ((a.meta.titleHtml < b.meta.titleHtml) ? 1 : -1) : -1);\r\n            resultArray.reverse();\r\n            if (resultArray.length > Number(this.options.params.limit)) {\r\n              const idxEnd = Number(this.options.params.limit) * Number(this.options.params.page);\r\n              const resultTotLenght = resultArray.length;\r\n              resultArray = resultArray.slice(0, idxEnd);\r\n              if (idxEnd < resultTotLenght) {\r\n                resultArray[resultArray.length - 1 ].meta.nextPage = true;\r\n              } else {\r\n                resultArray[resultArray.length - 1 ].meta.nextPage = false;\r\n              }\r\n            }\r\n            return resultArray;\r\n          })\r\n        );\r\n    } else {\r\n      return this.http.get(this.searchUrl, { params }).pipe(\r\n        map(response => {\r\n          return this.extractResults(this.extractWFSData(response), term);\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  private getFormatFromOptions() {\r\n    let olFormatCls;\r\n\r\n    const outputFormat = this.storedQueriesOptions.outputformat;\r\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\r\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\r\n\r\n    if (patternGeojson.test(outputFormat)) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    }\r\n    if (patternGml3.test(outputFormat)) {\r\n      olFormatCls = olformat.WFS;\r\n    }\r\n\r\n    return new olFormatCls();\r\n  }\r\n\r\n  private extractWFSData(res) {\r\n    const olFormat = this.getFormatFromOptions();\r\n    const geojson = olformat.GeoJSON;\r\n    const wfsfeatures = olFormat.readFeatures(res);\r\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\r\n    return features;\r\n  }\r\n\r\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\r\n    const splittedTerm = {};\r\n    let remainingTerm = term;\r\n    let cnt = 0;\r\n\r\n    // Used to build the default values\r\n    fields.forEach(field => {\r\n      splittedTerm[field.name] = field.defaultValue;\r\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\r\n      if (splitterRegex.test(remainingTerm)) {\r\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\r\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\r\n      }\r\n    });\r\n    if (cnt === 0) {\r\n      splittedTerm[fields[0].name] = term;\r\n      return splittedTerm;\r\n    }\r\n    remainingTerm = term;\r\n    const localFields = [...fields].reverse();\r\n    localFields.forEach(field => {\r\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\r\n      if (remainingTerm || remainingTerm !== '') {\r\n        const values = remainingTerm.split(splitterRegex);\r\n        remainingTerm = values[0];\r\n        if (values[1]) {\r\n          splittedTerm[field.name] = values[1].trim();\r\n        }\r\n      }\r\n    });\r\n    return splittedTerm;\r\n  }\r\n\r\n  private computeRequestParams(\r\n    options: TextSearchOptions,\r\n    queryParams\r\n  ): HttpParams {\r\n    const wfsversion = this.storedQueriesOptions.storedquery_id\r\n      .toLowerCase()\r\n      .includes('getfeaturebyid')\r\n      ? '2.0.0'\r\n      : '1.1.0';\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          service: 'wfs',\r\n          version: wfsversion,\r\n          request: 'GetFeature',\r\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\r\n          srsname: this.storedQueriesOptions.srsname,\r\n          outputformat: this.storedQueriesOptions.outputformat\r\n        },\r\n        queryParams,\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: StoredQueriesResponse, term: string\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: StoredQueriesData) => {\r\n      return this.dataToResult(data, term);\r\n    });\r\n  }\r\n\r\n  private dataToResult(data: StoredQueriesData, term: string): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.id].join('.');\r\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\r\n      ? this.storedQueriesOptions.resultTitle\r\n      : this.resultTitle;\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        // extent: data.bbox,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties[title]\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.title,\r\n        titleHtml: data.properties[title],\r\n        icon: 'map-marker',\r\n        score: (data.properties.title) ?\r\n        computeTermSimilarity(term.trim(), data.properties.title) :\r\n        computeTermSimilarity(term.trim(), data.properties[title]),\r\n\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\r\n    const properties = Object.assign(\r\n      {},\r\n      ObjectUtils.removeKeys(\r\n        data.properties,\r\n        StoredQueriesSearchSource.propertiesBlacklist\r\n      ),\r\n      { Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>' }\r\n    );\r\n    return properties;\r\n  }\r\n}\r\n\r\n/**\r\n * StoredQueriesReverse search source\r\n */\r\n\r\n// EXAMPLE CALLS\r\n// tslint:disable-next-line:max-line-length\r\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\r\n//\r\n\r\n@Injectable()\r\nexport class StoredQueriesReverseSearchSource extends SearchSource\r\n  implements ReverseSearch {\r\n  static id = 'storedqueriesreverse';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n  public resultTitle: 'title';\r\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\r\n  public multipleFieldsQuery: boolean;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n    this.storedQueriesOptions = options as StoredQueriesReverseSearchSourceOptions;\r\n\r\n    if (!this.storedQueriesOptions || (this.storedQueriesOptions && !this.storedQueriesOptions.available) ) {\r\n      return;\r\n    }\r\n\r\n    if (!this.storedQueriesOptions.storedquery_id) {\r\n      const err =\r\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\r\n      throw new Error(err);\r\n    }\r\n    if (!this.storedQueriesOptions.longField) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\r\n      );\r\n    }\r\n    if (!this.storedQueriesOptions.latField) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\r\n      );\r\n    }\r\n\r\n    this.storedQueriesOptions.outputformat =\r\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\r\n    this.storedQueriesOptions.srsname =\r\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\r\n    this.storedQueriesOptions.resultTitle =\r\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\r\n  }\r\n\r\n  getId(): string {\r\n    return StoredQueriesReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return StoredQueriesReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Stored Queries (reverse)',\r\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param distance Search raidus around lonLat\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(lonLat, options || {});\r\n\r\n    if (\r\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\r\n    ) {\r\n      return this.http\r\n        .get(this.searchUrl, { params, responseType: 'text' })\r\n        .pipe(\r\n          map(response => {\r\n            return this.extractResults(this.extractWFSData(response));\r\n          })\r\n        );\r\n    } else {\r\n      return this.http.get(this.searchUrl, { params }).pipe(\r\n        map(response => {\r\n          return this.extractResults(this.extractWFSData(response));\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  private getFormatFromOptions() {\r\n    let olFormatCls;\r\n\r\n    const outputFormat = this.storedQueriesOptions.outputformat;\r\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\r\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\r\n\r\n    if (patternGeojson.test(outputFormat)) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    }\r\n    if (patternGml3.test(outputFormat)) {\r\n      olFormatCls = olformat.WFS;\r\n    }\r\n\r\n    return new olFormatCls();\r\n  }\r\n\r\n  private extractWFSData(res) {\r\n    const olFormat = this.getFormatFromOptions();\r\n    const geojson = olformat.GeoJSON;\r\n    const wfsfeatures = olFormat.readFeatures(res);\r\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\r\n    return features;\r\n  }\r\n\r\n  private computeRequestParams(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): HttpParams {\r\n    const longLatParams = {};\r\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\r\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\r\n\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          service: 'WFS',\r\n          version: '1.1.0',\r\n          request: 'GetFeature',\r\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\r\n          srsname: this.storedQueriesOptions.srsname,\r\n          outputformat: this.storedQueriesOptions.outputformat\r\n        },\r\n        longLatParams,\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: StoredQueriesReverseResponse\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: StoredQueriesReverseData) => {\r\n      return this.dataToResult(data);\r\n    });\r\n  }\r\n\r\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.id].join('.');\r\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\r\n      ? this.storedQueriesOptions.resultTitle\r\n      : this.resultTitle;\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties[title]\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties[title],\r\n        icon: 'map-marker'\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(\r\n    data: StoredQueriesReverseData\r\n  ): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      StoredQueriesReverseSearchSource.propertiesBlacklist\r\n    );\r\n    const routing = {\r\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\r\n    };\r\n    return Object.assign(properties, { type: data.properties.doc_type }, routing);\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport {\r\n  StoredQueriesSearchSource,\r\n  StoredQueriesReverseSearchSource\r\n} from './storedqueries';\r\n\r\n/**\r\n * StoredQueries search source factory\r\n * @ignore\r\n */\r\nexport function storedqueriesSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService\r\n) {\r\n  return new StoredQueriesSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the StoredQueries search source\r\n */\r\nexport function provideStoredQueriesSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: storedqueriesSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\r\n  };\r\n}\r\n\r\n/**\r\n * StoredQueriesReverse search source factory\r\n * @ignore\r\n */\r\n\r\nexport function storedqueriesReverseSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService\r\n) {\r\n  return new StoredQueriesReverseSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the StoredQueriesReverse search source\r\n */\r\nexport function provideStoredQueriesReverseSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: storedqueriesReverseSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\r\n  };\r\n}\r\n","import { WfsWorkspace } from './wfs-workspace';\r\nimport { FeatureWorkspace } from './feature-workspace';\r\nimport { Observable } from 'rxjs';\r\nimport { EntityStoreFilterCustomFuncStrategy, EntityRecord } from '@igo2/common';\r\nimport { map } from 'rxjs/operators';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { StorageScope } from '@igo2/core';\r\n\r\n\r\nexport function getRowsInMapExtent(layerId, storageService): boolean {\r\n  return storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean || true;\r\n}\r\n\r\nexport function setRowsInMapExtent(value, layerId, storageService) {\r\n  storageService.set(`workspace.rowsInMapExtent.${layerId}`, value, StorageScope.SESSION);\r\n}\r\n\r\nexport function getSelectedOnly(layerId, storageService): boolean {\r\n  return storageService.get(`workspace.selectedOnly.${layerId}`) as boolean || false;\r\n}\r\n\r\nexport function setSelectedOnly(value, layerId, storageService) {\r\n  storageService.set(`workspace.selectedOnly.${layerId}`, value, StorageScope.SESSION);\r\n}\r\n\r\nexport function mapExtentStrategyActiveToolTip(ws: WfsWorkspace | FeatureWorkspace): Observable<string> {\r\n  return ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy).active$.pipe(\r\n    map((active: boolean) => active ? 'igo.geo.workspace.inMapExtent.active.tooltip' : 'igo.geo.workspace.inMapExtent.inactive.tooltip')\r\n  );\r\n}\r\n\r\nexport function noElementSelected(ws: WfsWorkspace | FeatureWorkspace): Observable<boolean> {\r\n  return ws.entityStore.stateView.manyBy$((record: EntityRecord<Feature>) => {\r\n    return record.state.selected === true;\r\n  }).pipe(\r\n    map((entities: EntityRecord<Feature>[]) => entities.length >= 1)\r\n  );\r\n}\r\n\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Simple Map</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/simple-map\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\r\n  igoPointerPosition\r\n  [pointerPositionDelay]=\"pointerCoordDelay\"\r\n  (pointerPositionCoord)=\"onPointerMove($event)\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\r\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\r\n  </igo-map-browser>\r\n\r\n</mat-card>\r\n\r\n<p *ngIf=\"!isTouchScreen\">{{pointerCoord}}</p>","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppSimpleMapComponent } from './simple-map.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'simple-map',\r\n    component: AppSimpleMapComponent\r\n  }\r\n];\r\n\r\nexport const AppSimpleMapRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-simple-map',\r\n  templateUrl: './simple-map.component.html',\r\n  styleUrls: ['./simple-map.component.scss']\r\n})\r\nexport class AppSimpleMapComponent {\r\n  public pointerCoord;\r\n  public pointerCoordDelay: number = 0;\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6,\r\n    rotation: 0.75\r\n  };\r\n\r\n  get media() {\r\n    return this.mediaService.getMedia();\r\n  }\r\n\r\n  get isTouchScreen() {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mediaService: MediaService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  onPointerMove(event) {\r\n    this.pointerCoord = event;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMapModule } from '@igo2/geo';\r\n\r\nimport { AppSimpleMapComponent } from './simple-map.component';\r\nimport { AppSimpleMapRoutingModule } from './simple-map-routing.module';\r\nimport { CommonModule } from '@angular/common';\r\n\r\n@NgModule({\r\n  declarations: [AppSimpleMapComponent],\r\n  imports: [\r\n    CommonModule,\r\n    AppSimpleMapRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoMapModule\r\n  ],\r\n  exports: [AppSimpleMapComponent]\r\n})\r\nexport class AppSimpleMapModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Simple Map</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-panel title=\"Layers\">\r\n    <igo-layer-list\r\n    [map]=\"map\"\r\n    [layers]=\"map.layers\"\r\n    [expandLegendOfVisibleLayers]=\"false\"\r\n    floatLabel=\"never\"\r\n    [queryBadge]=\"true\">\r\n\r\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\r\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\r\n        <igo-download-button [layer]=\"layer\"></igo-download-button>\r\n        <igo-ogc-filter-button [header]=\"true\" [layer]=\"layer\"></igo-ogc-filter-button>\r\n        <igo-time-filter-button [header]=\"true\" [layer]=\"layer\"></igo-time-filter-button>\r\n        <igo-track-feature-button [layer]=\"layer\" [trackFeature]=\"true\"></igo-track-feature-button>\r\n      </ng-template>\r\n\r\n    </igo-layer-list>\r\n  </igo-panel>\r\n\r\n</mat-card>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppLayerComponent } from './layer.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'layer',\r\n    component: AppLayerComponent\r\n  }\r\n];\r\n\r\nexport const AppLayerRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  WMSDataSourceOptions,\r\n  LayerOptions,\r\n  WFSDataSourceOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  MetadataLayerOptions\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-layer',\r\n  templateUrl: './layer.component.html',\r\n  styleUrls: ['./layer.component.scss']\r\n})\r\nexport class AppLayerComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            visible: true,\r\n            baseLayer: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const wfsDatasource: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        filters: {\r\n          operator: 'PropertyIsEqualTo',\r\n          propertyName: 'code_municipalite',\r\n          expression: '10043'\r\n        }\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasource)\r\n      .subscribe(dataSource => {\r\n        const layer: LayerOptions = {\r\n          title: 'WFS ',\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    const wfsDatasourceCustomEPSG: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: 'geojson_utf8',\r\n        srsName: 'EPSG:32198',\r\n        outputFormatDownload: 'shp'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        filters: {\r\n          operator: 'PropertyIsEqualTo',\r\n          propertyName: 'code_municipalite',\r\n          expression: '12072'\r\n        }\r\n      },\r\n      formatOptions: {\r\n        dataProjection: 'EPSG:32198'\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\r\n      .subscribe(dataSource => {\r\n        const layer: LayerOptions = {\r\n          title: 'WFS (Custom EPSG)',\r\n          visible: true,\r\n          source: dataSource,\r\n          removable: false\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'parc_routier',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Rseau routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'lieu habit',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'lieuhabite',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'sh_dis_eco',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'sh_dis_eco',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'nurc:Arc_Sample_Parent',\r\n        visible: false,\r\n        legendOptions: {\r\n          // collapsed: false,\r\n          display: true,\r\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\r\n          stylesAvailable: [\r\n            { name: 'rain', title: 'Pluie' },\r\n            { name: 'raster', title: 'Dfaut' }\r\n          ] //\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Avertissements routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'evenements',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    const datasource: WMSDataSourceOptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      refreshIntervalSec: 15,\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n        VERSION: '1.3.0'\r\n      }\r\n    };\r\n\r\n    interface LayerOptionsWithMetadata\r\n      extends LayerOptions,\r\n        MetadataLayerOptions {}\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasource)\r\n      .subscribe(dataSource => {\r\n        const layer: LayerOptionsWithMetadata = {\r\n          title: 'Embcle',\r\n          source: dataSource,\r\n          metadata: {\r\n            url:\r\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\r\n            extern: true\r\n          }\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport {\r\n  IgoMapModule,\r\n  IgoLayerModule,\r\n  IgoFilterModule,\r\n  IgoMetadataModule,\r\n  IgoDownloadModule\r\n} from '@igo2/geo';\r\n\r\nimport { AppLayerComponent } from './layer.component';\r\nimport { AppLayerRoutingModule } from './layer-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppLayerComponent],\r\n  imports: [\r\n    AppLayerRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoLayerModule,\r\n    IgoFilterModule,\r\n    IgoMetadataModule,\r\n    IgoDownloadModule\r\n  ],\r\n  exports: [AppLayerComponent]\r\n})\r\nexport class AppLayerModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppLegendComponent } from './legend.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'legend',\r\n    component: AppLegendComponent\r\n  }\r\n];\r\n\r\nexport const AppLegendRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  WMSDataSourceOptions,\r\n  LayerOptions,\r\n  WFSDataSourceOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  MetadataLayerOptions\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-legend',\r\n  templateUrl: './legend.component.html',\r\n  styleUrls: ['./legend.component.scss']\r\n})\r\nexport class AppLegendComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            visible: true,\r\n            baseLayer: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const wfsDatasource: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        filters: {\r\n          operator: 'PropertyIsEqualTo',\r\n          propertyName: 'code_municipalite',\r\n          expression: '10043'\r\n        }\r\n      }\r\n    };\r\n\r\n    this.layerService\r\n    .createAsyncLayer({\r\n      title: 'legend with display:false',\r\n      visible: true,\r\n      legendOptions: {\r\n        display: false,\r\n        html: 'test html'\r\n      },\r\n      sourceOptions: {\r\n        type: 'wms',\r\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n        optionsFromCapabilities: true,\r\n        params: {\r\n          LAYERS: 'sh_dis_eco',\r\n          VERSION: '1.3.0'\r\n        }\r\n      }\r\n    })\r\n    .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n    .createAsyncLayer({\r\n      title: 'legend in html',\r\n      visible: true,\r\n      legendOptions: {\r\n        display: true,\r\n        html: '<h2>HTML lgende</h2>'\r\n      },\r\n      sourceOptions: {\r\n        type: 'wms',\r\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n        optionsFromCapabilities: true,\r\n        params: {\r\n          LAYERS: 'sh_sreg_eco',\r\n          VERSION: '1.3.0'\r\n        }\r\n      }\r\n    })\r\n    .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n    .createAsyncLayer({\r\n      title: 'legend with url param',\r\n      visible: true,\r\n      legendOptions: {\r\n        url: 'data:image/jpeg;base64,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'\r\n\r\n      },\r\n      sourceOptions: {\r\n        type: 'wms',\r\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n        optionsFromCapabilities: true,\r\n        params: {\r\n          LAYERS: 'sh_reg_eco',\r\n          VERSION: '1.3.0'\r\n        }\r\n      }\r\n    })\r\n    .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasource)\r\n      .subscribe(dataSource => {\r\n        const layer: LayerOptions = {\r\n          title: 'WFS ',\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'MELS_CS_ANGLO_S',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Rseau routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'lieu habit',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'lieuhabite',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: '2 styles nurc:Arc_Sample_Parent',\r\n        visible: true,\r\n        legendOptions: {\r\n          // collapsed: false,\r\n          display: true,\r\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\r\n          stylesAvailable: [\r\n            { name: 'rain', title: 'Pluie' },\r\n            { name: 'raster', title: 'Dfaut' }\r\n          ] //\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Avertissements routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'evenements',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    const datasource: WMSDataSourceOptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      refreshIntervalSec: 15,\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n        VERSION: '1.3.0'\r\n      }\r\n    };\r\n\r\n    interface LayerOptionsWithMetadata\r\n      extends LayerOptions,\r\n        MetadataLayerOptions {}\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasource)\r\n      .subscribe(dataSource => {\r\n        const layer: LayerOptionsWithMetadata = {\r\n          title: 'Embcle',\r\n          visible: true,\r\n          source: dataSource,\r\n          metadata: {\r\n            url:\r\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\r\n            extern: true\r\n          }\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Simple Map with a legend list</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this\r\n      example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-panel title=\"Legends\">\r\n    <igo-layer-legend-list [layers]=\"map.layers\"\r\n    [excludeBaseLayers]=\"true\"\r\n    [allowShowAllLegends]=\"true\"\r\n    [updateLegendOnResolutionChange]=\"false\"\r\n    [showAllLegendsValue]=\"false\">\r\n  </igo-layer-legend-list>\r\n\r\n  </igo-panel>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport {\r\n  IgoMapModule,\r\n  IgoLayerModule,\r\n  IgoFilterModule,\r\n  IgoMetadataModule,\r\n  IgoDownloadModule\r\n} from '@igo2/geo';\r\n\r\nimport { AppLegendComponent } from './legend.component';\r\nimport { AppLegendRoutingModule } from './legend-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppLegendComponent],\r\n  imports: [\r\n    AppLegendRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoLayerModule,\r\n    IgoFilterModule,\r\n    IgoMetadataModule,\r\n    IgoDownloadModule\r\n  ],\r\n  exports: [AppLegendComponent]\r\n})\r\nexport class AppLegendModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppOverlayComponent } from './overlay.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'overlay',\r\n    component: AppOverlayComponent\r\n  }\r\n];\r\n\r\nexport const AppOverlayRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit, AfterViewInit } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  FEATURE,\r\n  Feature,\r\n  FeatureMotion\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-overlay',\r\n  templateUrl: './overlay.component.html',\r\n  styleUrls: ['./overlay.component.scss']\r\n})\r\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\r\n  public map = new IgoMap({\r\n    overlay: true,\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    const feature1: Feature = {\r\n      type: FEATURE,\r\n      projection: 'EPSG:4326',\r\n      meta: {\r\n        id: 1\r\n      },\r\n      properties: {},\r\n      geometry: {\r\n        type: 'Point',\r\n        coordinates: [-73, 46.6]\r\n      }\r\n    };\r\n\r\n    const feature2: Feature = {\r\n      type: FEATURE,\r\n      projection: 'EPSG:4326',\r\n      meta: {\r\n        id: 2\r\n      },\r\n      properties: {},\r\n      geometry: {\r\n        type: 'LineString',\r\n        coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\r\n      }\r\n    };\r\n\r\n    const feature3: Feature = {\r\n      type: FEATURE,\r\n      projection: 'EPSG:4326',\r\n      meta: {\r\n        id: 3\r\n      },\r\n      properties: {},\r\n      geometry: {\r\n        type: 'Polygon',\r\n        coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\r\n      }\r\n    };\r\n\r\n    this.map.overlay.setFeatures(\r\n      [feature1, feature2, feature3],\r\n      FeatureMotion.None\r\n    );\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Overlay</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/overlay\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMapModule, IgoOverlayModule } from '@igo2/geo';\r\n\r\nimport { AppOverlayComponent } from './overlay.component';\r\nimport { AppOverlayRoutingModule } from './overlay-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppOverlayComponent],\r\n  imports: [\r\n    AppOverlayRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoMapModule,\r\n    IgoOverlayModule\r\n  ],\r\n  exports: [AppOverlayComponent]\r\n})\r\nexport class AppOverlayModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Geometry Form</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-form\r\n    *ngIf=\"form$ | async as form\"\r\n    [form]=\"form\"\r\n    [formData]=\"data$ | async\"\r\n    (submitForm)=\"onSubmit($event)\">\r\n\r\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\r\n\r\n    <div formButtons>\r\n      <button\r\n        mat-stroked-button\r\n        type=\"button\"\r\n        color=\"primary\"\r\n        (click)=\"fillForm()\">\r\n        Fill Form\r\n      </button>\r\n      <button\r\n        mat-stroked-button\r\n        type=\"button\"\r\n        color=\"primary\"\r\n        (click)=\"clearForm()\">\r\n        Clear Form\r\n      </button>\r\n      <button\r\n        mat-flat-button\r\n        type=\"submit\"\r\n        color=\"primary\"\r\n        [disabled]=\"submitDisabled\">\r\n        Submit\r\n      </button>\r\n    </div>\r\n  </igo-form>\r\n</mat-card>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppGeometryComponent } from './geometry.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'geometry',\r\n    component: AppGeometryComponent\r\n  }\r\n];\r\n\r\nexport const AppGeometryRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { Validators } from '@angular/forms';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { Form, FormService } from '@igo2/common';\r\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-geometry',\r\n  templateUrl: './geometry.component.html',\r\n  styleUrls: ['./geometry.component.scss']\r\n})\r\nexport class AppGeometryComponent implements OnInit, OnDestroy {\r\n\r\n  map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  view = {\r\n    center: [-73, 47.2],\r\n    zoom: 15\r\n  };\r\n\r\n  form$ = new BehaviorSubject<Form>(undefined);\r\n\r\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\r\n\r\n  submitDisabled = true;\r\n\r\n  private valueChanges$$: Subscription;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private formService: FormService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    const fieldConfigs = [\r\n      {\r\n        name: 'geometry',\r\n        title: 'Geometry',\r\n        options: {\r\n          validator: Validators.required\r\n        },\r\n        type: 'geometry',\r\n        inputs: {\r\n          map: this.map,\r\n          geometryTypeField: true,\r\n          geometryType: 'Polygon',\r\n          drawGuideField: true,\r\n          drawGuide: 50,\r\n          drawGuidePlaceholder: 'Draw Guide',\r\n          drawStyle: new olstyle.Style({\r\n            stroke: new olstyle.Stroke({\r\n              color: [255, 0, 0, 1],\r\n              width: 2\r\n            }),\r\n            fill:  new olstyle.Fill({\r\n              color: [255, 0, 0, 0.2]\r\n            }),\r\n            image: new olstyle.Circle({\r\n              radius: 8,\r\n              stroke: new olstyle.Stroke({\r\n                color: [255, 0, 0, 1]\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: [255, 0, 0, 0.2]\r\n              })\r\n            })\r\n          })\r\n        }\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name',\r\n        options: {\r\n          validator: Validators.required\r\n        }\r\n      }\r\n    ];\r\n\r\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\r\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\r\n\r\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\r\n      this.submitDisabled = !form.control.valid;\r\n    });\r\n\r\n    this.form$.next(form);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.valueChanges$$.unsubscribe();\r\n  }\r\n\r\n  fillForm() {\r\n    this.data$.next({\r\n      name: 'Place',\r\n      geometry: JSON.stringify({type: 'Polygon', coordinates: [[\r\n        [-106, 42],\r\n        [-107, 31],\r\n        [-81, 32],\r\n        [-82, 42],\r\n        [-106, 42]\r\n      ]]})\r\n    });\r\n  }\r\n\r\n  clearForm() {\r\n    this.form$.value.control.reset();\r\n  }\r\n\r\n  onSubmit(data: {[key: string]: any}) {\r\n    alert(JSON.stringify(data));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoFormModule } from '@igo2/common';\r\nimport { IgoGeometryModule, IgoMapModule } from '@igo2/geo';\r\n\r\nimport { AppGeometryComponent } from './geometry.component';\r\nimport { AppGeometryRoutingModule } from './geometry-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppGeometryComponent],\r\n  imports: [\r\n    CommonModule,\r\n    AppGeometryRoutingModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    IgoFormModule,\r\n    IgoGeometryModule,\r\n    IgoMapModule\r\n  ],\r\n  exports: [AppGeometryComponent]\r\n})\r\nexport class AppGeometryModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppFeatureComponent } from './feature.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'feature',\r\n    component: AppFeatureComponent\r\n  }\r\n];\r\n\r\nexport const AppFeatureRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  VectorLayer,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  FeatureMotion\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-feature',\r\n  templateUrl: './feature.component.html',\r\n  styleUrls: ['./feature.component.scss']\r\n})\r\nexport class AppFeatureComponent implements OnInit, OnDestroy {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  public tableTemplate = {\r\n    selection: true,\r\n    selectMany: true,\r\n    sort: true,\r\n    columns: [\r\n      {\r\n        name: 'properties.id',\r\n        title: 'ID'\r\n      },\r\n      {\r\n        name: 'properties.name',\r\n        title: 'Name'\r\n      },\r\n      {\r\n        name: 'properties.description',\r\n        title: 'Description'\r\n      }\r\n    ]\r\n  };\r\n\r\n  public store = new FeatureStore([], { map: this.map });\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    const loadingStrategy = new FeatureStoreLoadingStrategy({});\r\n    this.store.addStrategy(loadingStrategy);\r\n\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      map: this.map,\r\n      motion: FeatureMotion.Default\r\n    });\r\n    this.store.addStrategy(selectionStrategy);\r\n\r\n    this.store.load([\r\n      {\r\n        meta: { id: 1 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [-72, 47.8]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 1,\r\n          name: 'Name 1',\r\n          description: 'Description 1'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 2 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'LineString',\r\n          coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 2,\r\n          name: 'Name 2',\r\n          description: 'Description 2'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 3 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Polygon',\r\n          coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 3,\r\n          name: 'Name 3',\r\n          description: 'Description 3'\r\n        }\r\n      }\r\n    ]);\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'MVT test',\r\n        visible: true,\r\n        sourceOptions: {\r\n          type: 'mvt',\r\n          url:\r\n            'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\r\n          queryable: true\r\n        },\r\n        mapboxStyle: {\r\n          url: 'assets/mapboxStyleExample-vectortile.json',\r\n          source: 'ahocevar'\r\n        }\r\n      } as any)\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'vector'\r\n      })\r\n      .subscribe(dataSource => {\r\n        const layer = this.layerService.createLayer({\r\n          title: 'Vector Layer',\r\n          source: dataSource,\r\n          animation: {\r\n            duration: 2000\r\n          },\r\n          mapboxStyle: {\r\n            url: 'assets/mapboxStyleExample-feature.json',\r\n            source: 'source_nameX'\r\n          }\r\n        }) as VectorLayer;\r\n        this.map.addLayer(layer);\r\n        this.store.bindLayer(layer);\r\n        loadingStrategy.activate();\r\n        selectionStrategy.activate();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Feature</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geom/feature\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-entity-table\r\n    [store]=\"store\"\r\n    [template]=\"tableTemplate\">\r\n  </igo-entity-table>\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoPanelModule, IgoEntityTableModule } from '@igo2/common';\r\nimport { IgoMapModule, IgoFeatureModule } from '@igo2/geo';\r\n\r\nimport { AppFeatureComponent } from './feature.component';\r\nimport { AppFeatureRoutingModule } from './feature-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppFeatureComponent],\r\n  imports: [\r\n    AppFeatureRoutingModule,\r\n    CommonModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoEntityTableModule,\r\n    IgoMapModule,\r\n    IgoFeatureModule\r\n  ],\r\n  exports: [AppFeatureComponent]\r\n})\r\nexport class AppFeatureModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\nimport { AppHoverComponent } from './hover.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'hover',\r\n    component: AppHoverComponent\r\n  }\r\n];\r\n\r\nexport const AppHoverRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\nimport { IgoMap, DataSourceService, LayerService, WFSDataSourceOptions, VectorLayerOptions, WFSDataSource } from '@igo2/geo';\r\nimport { transform } from 'ol/proj';\r\n\r\n@Component({\r\n  selector: 'app-hover',\r\n  templateUrl: './hover.component.html',\r\n  styleUrls: ['./hover.component.scss']\r\n})\r\nexport class AppHoverComponent {\r\n  public selected;\r\n  public pointerCoord;\r\n  public pointerCoordDelay: number = 0;\r\n  public pointerHoverFeatureDelay: number = 0;\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 8,\r\n    projection: 'EPSG:3857'\r\n  };\r\n\r\n\r\n  get media() {\r\n    return this.mediaService.getMedia();\r\n  }\r\n\r\n  get isTouchScreen() {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mediaService: MediaService\r\n  ) {\r\n\r\n    this.dataSourceService\r\n    .createAsyncDataSource({\r\n      type: 'wmts',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/carto/wmts/1.0.0/wmts',\r\n      layer: 'carte_gouv_qc_public',\r\n      matrixSet: 'EPSG_3857',\r\n      version: '1.3.0'\r\n    })\r\n    .subscribe(dataSource => {\r\n      this.map.addLayer(\r\n        this.layerService.createLayer({\r\n          title: 'Quebec',\r\n          visible: true,\r\n          baseLayer: true,\r\n          source: dataSource\r\n        })\r\n      );\r\n    });\r\n\r\n    interface WFSDataOptions\r\n      extends WFSDataSourceOptions {}\r\n\r\n    const wfsDatasourcePolygon: WFSDataOptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'adn_bassin_n1_public_v',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '3.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasourcePolygon)\r\n      .subscribe((dataSource: WFSDataSource) => {\r\n        const layer: VectorLayerOptions = {\r\n          title: 'WFS (polygon)',\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    const wfsDatasourcePoint: WFSDataOptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'CASERNE',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '3.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasourcePoint)\r\n      .subscribe((dataSource: WFSDataSource) => {\r\n        const layer: VectorLayerOptions = {\r\n          title: 'WFS (point)',\r\n          visible: true,\r\n          source: dataSource,\r\n          styleByAttribute: {\r\n            attribute: 'en_caserne',\r\n            data: ['true', 'false'],\r\n            stroke: ['red', 'blue'],\r\n            fill: ['#ffffff', '#ffffff'],\r\n            radius: [7, 7],\r\n            width: [2, 2],\r\n            hoverStyle: {\r\n                label: {\r\n                  attribute: 'Caserne: ${nom_service_incendie}\\n Mun: ${ville}',\r\n                  style: {\r\n                    textAlign: 'left',\r\n                    textBaseline: 'bottom',\r\n                    font: '12px Calibri,sans-serif',\r\n                    fill: { color: '#000' },\r\n                    backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\r\n                    backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\r\n                    stroke: { color: '#fff', width: 3 },\r\n                    overflow: true,\r\n                    offsetX: 10,\r\n                    offsetY: -10,\r\n                    padding: [2.5, 2.5, 2.5, 2.5]\r\n                  }\r\n                },\r\n                baseStyle: {\r\n                  circle: {\r\n                    stroke: {\r\n                      color: 'orange',\r\n                      width: 5\r\n                    },\r\n                    width: [5],\r\n                    radius: 15\r\n                  }\r\n                }\r\n            }\r\n          }\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Hover</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/hover\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\r\n  igoHoverFeature\r\n  [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\r\n  [igoHoverFeatureEnabled]=\"true\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\r\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\r\n  </igo-map-browser>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMapModule } from '@igo2/geo';\r\n\r\nimport { AppHoverComponent } from './hover.component';\r\nimport { AppHoverRoutingModule } from './hover-routing.module';\r\nimport { CommonModule } from '@angular/common';\r\n\r\n@NgModule({\r\n  declarations: [AppHoverComponent],\r\n  imports: [\r\n    CommonModule,\r\n    AppHoverRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoMapModule\r\n  ],\r\n  exports: [AppHoverComponent]\r\n})\r\nexport class AppHoverModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppMeasureComponent } from './measure.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'measure',\r\n    component: AppMeasureComponent\r\n  }\r\n];\r\n\r\nexport const AppMeasureRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  FeatureStore,\r\n  FeatureWithMeasure\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-measure',\r\n  templateUrl: './measure.component.html',\r\n  styleUrls: ['./measure.component.scss']\r\n})\r\nexport class AppMeasureComponent {\r\n\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6,\r\n    projection: 'EPSG:3857'\r\n  };\r\n\r\n  public store = new FeatureStore<FeatureWithMeasure>([], {map: this.map});\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Simple Map</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/measure\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMapModule, IgoMeasureModule } from '@igo2/geo';\r\n\r\nimport { AppMeasureComponent } from './measure.component';\r\nimport { AppMeasureRoutingModule } from './measure-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppMeasureComponent],\r\n  imports: [\r\n    AppMeasureRoutingModule,\r\n    MatCardModule,\r\n    IgoMapModule,\r\n    IgoMeasureModule\r\n  ],\r\n  exports: [AppMeasureComponent]\r\n})\r\nexport class AppMeasureModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppDrawComponent } from './draw.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'draw',\r\n    component: AppDrawComponent\r\n  }\r\n];\r\n\r\nexport const AppDrawRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  FeatureStore,\r\n  FeatureWithDraw\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-draw',\r\n  templateUrl: './draw.component.html',\r\n  styleUrls: ['./draw.component.scss']\r\n})\r\nexport class AppDrawComponent {\r\n\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6,\r\n    projection: 'EPSG:3857'\r\n  };\r\n\r\n  public store = new FeatureStore<FeatureWithDraw>([], {map: this.map});\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Simple Map</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/draw\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-draw [store]=\"store\" [map]=\"map\"></igo-draw>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMapModule, IgoDrawModule } from '@igo2/geo';\r\n\r\nimport { AppDrawComponent } from './draw.component';\r\nimport { AppDrawRoutingModule } from './draw-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppDrawComponent],\r\n  imports: [\r\n    AppDrawRoutingModule,\r\n    MatCardModule,\r\n    IgoMapModule,\r\n    IgoDrawModule\r\n  ],\r\n  exports: [AppDrawComponent]\r\n})\r\nexport class AppDrawModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Query</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser\r\n    [map]=\"map\"\r\n    [view]=\"view\"\r\n    igoOverlay\r\n    igoQuery\r\n    [queryFeatures]=\"true\"\r\n    (query)=\"handleQueryResults($event)\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-panel title=\"Details\">\r\n    <ng-container *ngIf=\"feature$ | async as feature\">\r\n      <h1>Query Title : <span style=\"background-color: #e0e0e0;\">{{getTitle(feature)}}</span></h1>\r\n      <igo-feature-details [feature]=\"feature\"></igo-feature-details>\r\n    </ng-container>\r\n  </igo-panel>\r\n\r\n</mat-card>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppQueryComponent } from './query.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'query',\r\n    component: AppQueryComponent\r\n  }\r\n];\r\n\r\nexport const AppQueryRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport olPoint from 'ol/geom/Point';\r\nimport olPolygon from 'ol/geom/Polygon';\r\nimport olLineString from 'ol/geom/LineString';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  FeatureDataSource,\r\n  DataSourceService,\r\n  LayerService,\r\n  OverlayService,\r\n  Feature,\r\n  QueryableDataSourceOptions,\r\n  QueryFormat,\r\n  QueryHtmlTarget,\r\n  SearchResult,\r\n  FeatureMotion\r\n} from '@igo2/geo';\r\n\r\nimport { getEntityTitle, EntityStore } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-query',\r\n  templateUrl: './query.component.html',\r\n  styleUrls: ['./query.component.scss']\r\n})\r\nexport class AppQueryComponent {\r\n  public feature$ = new BehaviorSubject<Feature>(undefined);\r\n\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private overlayService: OverlayService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wms',\r\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n        queryable: true,\r\n        queryTitle: 'num_rts',\r\n        params: {\r\n          layers: 'bgr_v_sous_route_res_sup_act',\r\n          version: '1.3.0'\r\n        }\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'WMS',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n      });\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wms',\r\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n        queryable: true,\r\n        queryFormat: QueryFormat.HTMLGML2,\r\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\r\n        params: {\r\n          layers: 'bgr_v_sous_route_res_sup_act',\r\n          version: '1.3.0'\r\n        }\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'WMS html with a pre call in GML',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n      });\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'vector',\r\n        queryable: true,\r\n        queryTitle: 'So beautiful ${name}',\r\n        sourceFields: [\r\n          { name: 'name', alias: 'Alias name' },\r\n          { name: 'description', alias: 'Alias description' }\r\n        ]\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Vector Layer',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n        this.addFeatures(dataSource as FeatureDataSource);\r\n      });\r\n  }\r\n\r\n  addFeatures(dataSource: FeatureDataSource) {\r\n    const feature1 = new olFeature({\r\n      name: 'feature1',\r\n      geometry: new olLineString([\r\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\r\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\r\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\r\n      ]),\r\n    });\r\n\r\n    const feature2 = new olFeature({\r\n      name: 'feature2',\r\n      geometry: new olPoint(\r\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\r\n      ),\r\n    });\r\n\r\n    const feature3 = new olFeature({\r\n      name: 'feature3',\r\n      geometry: new olPolygon([\r\n        [\r\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\r\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\r\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\r\n        ]\r\n      ]),\r\n    });\r\n\r\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\r\n  }\r\n\r\n  handleQueryResults(results) {\r\n    const features: Feature[] = results.features;\r\n    let feature: Feature;\r\n    if (features.length) {\r\n      feature = features[0];\r\n    }\r\n    this.feature$.next(feature);\r\n\r\n    this.map.queryResultsOverlay.setFeatures([feature], FeatureMotion.None);\r\n  }\r\n\r\n  getTitle(result: SearchResult) {\r\n    return getEntityTitle(result);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport {\r\n  IgoMapModule,\r\n  IgoOverlayModule,\r\n  IgoQueryModule,\r\n  IgoFeatureModule\r\n} from '@igo2/geo';\r\n\r\nimport { AppQueryComponent } from './query.component';\r\nimport { AppQueryRoutingModule } from './query-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppQueryComponent],\r\n  imports: [\r\n    AppQueryRoutingModule,\r\n    CommonModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoOverlayModule,\r\n    IgoQueryModule,\r\n    IgoFeatureModule\r\n  ],\r\n  exports: [AppQueryComponent]\r\n})\r\nexport class AppQueryModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppCatalogComponent } from './catalog.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'catalog',\r\n    component: AppCatalogComponent\r\n  }\r\n];\r\n\r\nexport const AppCatalogRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\nimport { LanguageService, ConfigService, StorageService } from '@igo2/core';\r\nimport { IgoMap, LayerService, Catalog, CatalogItem, CatalogService } from '@igo2/geo';\r\nimport { EntityStore } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-catalog',\r\n  templateUrl: './catalog.component.html',\r\n  styleUrls: ['./catalog.component.scss']\r\n})\r\nexport class AppCatalogComponent implements OnInit {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  public catalogStore = new EntityStore<Catalog>([]);\r\n\r\n  public catalogItemStore = new EntityStore<CatalogItem>([]);\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService,\r\n    private catalogService: CatalogService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe(layer => this.map.addLayer(layer));\r\n\r\n    this.loadCatalogs();\r\n  }\r\n\r\n  /**\r\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\r\n   * @internal\r\n   * @param event Select event\r\n   */\r\n  onCatalogSelectChange(event: {selected: boolean; catalog: Catalog}) {\r\n    this.loadCatalogItems(event.catalog);\r\n  }\r\n\r\n  /**\r\n   * Get all the available catalogs from the CatalogService and\r\n   * load them into the store.\r\n   */\r\n  private loadCatalogs() {\r\n    this.catalogService.loadCatalogs()\r\n      .subscribe((catalogs: Catalog[]) => {\r\n        this.catalogStore.clear();\r\n        this.catalogStore.load(catalogs.concat((this.storageService.get('addedCatalogs') || []) as Catalog[]));\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Get the selected catalog's items from the CatalogService and\r\n   * load them into the store.\r\n   * @param catalog Selected catalog\r\n   */\r\n  private loadCatalogItems(catalog: Catalog) {\r\n    this.catalogService.loadCatalogItems(catalog)\r\n      .subscribe((items: CatalogItem[]) => {\r\n        this.catalogItemStore.clear();\r\n        this.catalogItemStore.load(items);\r\n      });\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Catalog</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: ConfigService, LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/catalog\">code of this example</a><br>\r\n    See catalog section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-panel title=\"Catalog Library\">\r\n    <igo-catalog-library\r\n      [store]=\"catalogStore\"\r\n      (catalogSelectChange)=\"onCatalogSelectChange($event)\">\r\n    </igo-catalog-library>\r\n  </igo-panel>\r\n\r\n  <igo-panel title=\"Catalog Browser\">\r\n    <igo-catalog-browser\r\n      [store]=\"catalogItemStore\"\r\n      [map]=\"map\">\r\n    </igo-catalog-browser>\r\n  </igo-panel>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport { IgoMapModule, IgoCatalogModule } from '@igo2/geo';\r\n\r\nimport { environment } from '../../../environments/environment';\r\nimport { AppCatalogComponent } from './catalog.component';\r\nimport { AppCatalogRoutingModule } from './catalog-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppCatalogComponent],\r\n  imports: [\r\n    CommonModule,\r\n    AppCatalogRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    IgoConfigModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoCatalogModule\r\n  ],\r\n  exports: [AppCatalogComponent],\r\n  providers: [\r\n    provideConfigOptions({\r\n      default: environment.igo\r\n    })\r\n  ]\r\n})\r\nexport class AppCatalogModule {}\r\n","export class ExportError extends Error {}\r\n\r\nexport class ExportInvalidFileError extends ExportError {\r\n  constructor() {\r\n    super('Invalid context');\r\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ExportNothingToExportError extends ExportError {\r\n  constructor() {\r\n    super('Nothing to export');\r\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\r\n  }\r\n}\r\n","export class ImportError extends Error {}\r\n\r\nexport class ImportInvalidFileError extends ImportError {\r\n  constructor() {\r\n    super('Invalid file');\r\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportUnreadableFileError extends ImportError {\r\n  constructor() {\r\n      super('Failed to read file');\r\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportNothingToImportError extends ImportError {\r\n  constructor() {\r\n      super('Nothing to import');\r\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSizeError extends ImportError {\r\n  constructor() {\r\n      super('File is too large');\r\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSRSError extends ImportError {\r\n  constructor() {\r\n      super('Invalid SRS definition');\r\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n","export enum TypePermission {\r\n  null,\r\n  read,\r\n  write\r\n}\r\n\r\nexport enum Scope {\r\n  public,\r\n  protected,\r\n  private\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\n\r\nimport { BehaviorSubject, Observable, of, Subject } from 'rxjs';\r\nimport {\r\n  map,\r\n  tap,\r\n  catchError,\r\n  debounceTime,\r\n  mergeMap,\r\n  first,\r\n  skip\r\n} from 'rxjs/operators';\r\n\r\nimport olPoint from 'ol/geom/Point';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport Cluster from 'ol/source/Cluster';\r\nimport olVectorSource from 'ol/source/Vector';\r\n\r\nimport { Tool } from '@igo2/common';\r\nimport { uuid, ObjectUtils } from '@igo2/utils';\r\nimport {\r\n  ConfigService,\r\n  RouteService,\r\n  Message,\r\n  MessageService,\r\n  Notification,\r\n  LanguageService\r\n} from '@igo2/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport type { IgoMap, Layer } from '@igo2/geo';\r\n\r\nimport { TypePermission } from './context.enum';\r\nimport {\r\n  ContextsList,\r\n  ContextServiceOptions,\r\n  Context,\r\n  DetailedContext,\r\n  ContextMapView,\r\n  ContextPermission,\r\n  ContextProfils\r\n} from './context.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ContextService {\r\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\r\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\r\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\r\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\r\n  public importedContext: Array<DetailedContext> = [];\r\n  public toolsChanged$ = new Subject<DetailedContext>();\r\n  private mapViewFromRoute: ContextMapView = {};\r\n  private options: ContextServiceOptions;\r\n  private baseUrl: string;\r\n  private contextMessage: Notification;\r\n\r\n  // Until the ContextService is completely refactored, this is needed\r\n  // to track the current tools\r\n  private tools: Tool[];\r\n  private toolbar: string[];\r\n\r\n  get defaultContextUri(): string {\r\n    return this._defaultContextUri || this.options.defaultContextUri;\r\n  }\r\n  set defaultContextUri(uri: string) {\r\n    this._defaultContextUri = uri;\r\n  }\r\n  private _defaultContextUri: string;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private authService: AuthService,\r\n    private languageService: LanguageService,\r\n    private config: ConfigService,\r\n    private messageService: MessageService,\r\n    @Optional() private route: RouteService\r\n  ) {\r\n    this.options = Object.assign(\r\n      {\r\n        basePath: 'contexts',\r\n        contextListFile: '_contexts.json',\r\n        defaultContextUri: '_default'\r\n      },\r\n      this.config.getConfig('context')\r\n    );\r\n\r\n    this.baseUrl = this.options.url;\r\n\r\n    this.readParamsFromRoute();\r\n\r\n    if (this.authService.hasAuthService) {\r\n      this.authService.logged$.subscribe((logged) => {\r\n        if (logged) {\r\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\r\n            this.handleContextsChange();\r\n          });\r\n          this.loadContexts();\r\n        }\r\n      });\r\n    } else {\r\n      this.loadContexts();\r\n      this.handleContextsChange(false);\r\n    }\r\n  }\r\n\r\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\r\n    let url = this.baseUrl + '/contexts';\r\n    if (permissions && this.authService.authenticated) {\r\n      url += '?permission=' + permissions.join();\r\n      if (hidden) {\r\n        url += '&hidden=true';\r\n      }\r\n    }\r\n    return this.http.get<ContextsList>(url);\r\n  }\r\n\r\n  getById(id: string): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts/' + id;\r\n    return this.http.get<Context>(url);\r\n  }\r\n\r\n  getDetails(id: string): Observable<DetailedContext> {\r\n    const url = `${this.baseUrl}/contexts/${id}/details`;\r\n    return this.http.get<DetailedContext>(url).pipe(\r\n      catchError((res) => {\r\n        return this.handleError(res, id);\r\n      })\r\n    );\r\n  }\r\n\r\n  getDefault(): Observable<DetailedContext> {\r\n    const url = this.baseUrl + '/contexts/default';\r\n    return this.http.get<DetailedContext>(url).pipe(\r\n      tap((context) => {\r\n        this.defaultContextId$.next(context.id);\r\n      })\r\n    );\r\n  }\r\n\r\n  getProfilByUser(): Observable<ContextProfils[]> {\r\n    if (this.baseUrl) {\r\n      const url = this.baseUrl + '/profils?';\r\n      return this.http.get<ContextProfils[]>(url);\r\n    }\r\n    return of([]);\r\n  }\r\n\r\n  setDefault(id: string): Observable<any> {\r\n    const url = this.baseUrl + '/contexts/default';\r\n    return this.http.post(url, { defaultContextId: id });\r\n  }\r\n\r\n  hideContext(id: string) {\r\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\r\n    return this.http.post(url, {});\r\n  }\r\n\r\n  showContext(id: string) {\r\n    const url = this.baseUrl + '/contexts/' + id + '/show';\r\n    return this.http.post(url, {});\r\n  }\r\n\r\n  delete(id: string, imported = false): Observable<void> {\r\n    const contexts: ContextsList = { ours: [] };\r\n    Object.keys(this.contexts$.value).forEach(\r\n      (key) =>\r\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\r\n    );\r\n\r\n    if (imported) {\r\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\r\n      return of(this.contexts$.next(contexts));\r\n    }\r\n\r\n    const url = this.baseUrl + '/contexts/' + id;\r\n    return this.http.delete<void>(url).pipe(\r\n      tap((res) => {\r\n        this.contexts$.next(contexts);\r\n      })\r\n    );\r\n  }\r\n\r\n  create(context: DetailedContext): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts';\r\n    return this.http.post<Context>(url, context).pipe(\r\n      map((contextCreated) => {\r\n        if (this.authService.authenticated) {\r\n          contextCreated.permission = TypePermission[TypePermission.write];\r\n        } else {\r\n          contextCreated.permission = TypePermission[TypePermission.read];\r\n        }\r\n        this.contexts$.value.ours.unshift(contextCreated);\r\n        this.contexts$.next(this.contexts$.value);\r\n        return contextCreated;\r\n      })\r\n    );\r\n  }\r\n\r\n  clone(id: string, properties = {}): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\r\n    return this.http.post<Context>(url, properties).pipe(\r\n      map((contextCloned) => {\r\n        contextCloned.permission = TypePermission[TypePermission.write];\r\n        this.contexts$.value.ours.unshift(contextCloned);\r\n        this.contexts$.next(this.contexts$.value);\r\n        return contextCloned;\r\n      })\r\n    );\r\n  }\r\n\r\n  update(id: string, context: Context): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts/' + id;\r\n    return this.http.patch<Context>(url, context);\r\n  }\r\n\r\n  // =================================================================\r\n\r\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\r\n    const association = {\r\n      toolId\r\n    };\r\n    return this.http.post<void>(url, association);\r\n  }\r\n\r\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\r\n    return this.http.delete(url);\r\n  }\r\n\r\n  getPermissions(id: string): Observable<ContextPermission[]> {\r\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\r\n    return this.http.get<ContextPermission[]>(url);\r\n  }\r\n\r\n  addPermissionAssociation(\r\n    contextId: string,\r\n    profil: string,\r\n    type: TypePermission\r\n  ): Observable<ContextPermission[] | Message[]> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\r\n    const association = {\r\n      profil,\r\n      typePermission: type\r\n    };\r\n\r\n    return this.http.post<ContextPermission[]>(url, association).pipe(\r\n      catchError((res) => {\r\n        return [this.handleError(res, undefined, true)];\r\n      })\r\n    );\r\n  }\r\n\r\n  deletePermissionAssociation(\r\n    contextId: string,\r\n    permissionId: string\r\n  ): Observable<void> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\r\n    return this.http.delete<void>(url);\r\n  }\r\n\r\n  // ======================================================================\r\n\r\n  getLocalContexts(): Observable<ContextsList> {\r\n    const url = this.getPath(this.options.contextListFile);\r\n    return this.http.get<ContextsList>(url).pipe(\r\n      map((res: any) => {\r\n        return { ours: res };\r\n      })\r\n    );\r\n  }\r\n\r\n  getLocalContext(uri: string): Observable<DetailedContext> {\r\n    const url = this.getPath(`${uri}.json`);\r\n    return this.http.get<DetailedContext>(url).pipe(\r\n      mergeMap((res) => {\r\n        if (!res.base) {\r\n          return of(res);\r\n        }\r\n        const urlBase = this.getPath(`${res.base}.json`);\r\n        return this.http.get<DetailedContext>(urlBase).pipe(\r\n          map((resBase: DetailedContext) => {\r\n            const resMerge = res;\r\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\r\n            resMerge.layers = (resBase.layers || [])\r\n              .concat(res.layers || [])\r\n              .reverse()\r\n              .filter(\r\n                (l, index, self) =>\r\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\r\n              )\r\n              .reverse();\r\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\r\n            resMerge.message = res.message || resBase.message;\r\n            resMerge.messages = res.messages || resBase.messages;\r\n            resMerge.tools = (res.tools || [])\r\n              .concat(resBase.tools || [])\r\n              .filter(\r\n                (t, index, self) =>\r\n                  self.findIndex((t2) => t2.name === t.name) === index\r\n              );\r\n            return resMerge;\r\n          }),\r\n          catchError((err) => {\r\n            return this.handleError(err, uri);\r\n          })\r\n        );\r\n      }),\r\n      catchError((err2) => {\r\n        return this.handleError(err2, uri);\r\n      })\r\n    );\r\n  }\r\n\r\n  loadContexts(permissions?: string[], hidden?: boolean) {\r\n    let request;\r\n    if (this.baseUrl) {\r\n      request = this.get(permissions, hidden);\r\n    } else {\r\n      request = this.getLocalContexts();\r\n    }\r\n    request.subscribe((contexts) => {\r\n      contexts.ours = this.importedContext.concat(contexts.ours);\r\n      this.contexts$.next(contexts);\r\n    });\r\n  }\r\n\r\n  loadDefaultContext() {\r\n    const loadFct = (direct = false) => {\r\n      if (!direct && this.baseUrl && this.authService.authenticated) {\r\n        this.getDefault().subscribe(\r\n          (_context: DetailedContext) => {\r\n            this.defaultContextUri = _context.uri;\r\n            this.addContextToList(_context);\r\n            this.setContext(_context);\r\n          },\r\n          () => {\r\n            this.defaultContextId$.next(undefined);\r\n            this.loadContext(this.defaultContextUri);\r\n          }\r\n        );\r\n      } else {\r\n        this.loadContext(this.defaultContextUri);\r\n      }\r\n    };\r\n\r\n    if (this.route && this.route.options.contextKey) {\r\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\r\n        const contextParam = params[this.route.options.contextKey as string];\r\n        let direct = false;\r\n        if (contextParam) {\r\n          this.defaultContextUri = contextParam;\r\n          direct = true;\r\n        }\r\n        loadFct(direct);\r\n      });\r\n    } else {\r\n      loadFct();\r\n    }\r\n  }\r\n\r\n  loadContext(uri: string) {\r\n    const context = this.context$.value;\r\n\r\n    if (context && context.uri === uri) {\r\n      return;\r\n    }\r\n\r\n    this.getContextByUri(uri)\r\n      .pipe(first())\r\n      .subscribe(\r\n        (_context: DetailedContext) => {\r\n          this.addContextToList(_context);\r\n          this.setContext(_context);\r\n        },\r\n        (err) => {\r\n          if (uri !== this.options.defaultContextUri) {\r\n            this.loadContext(this.options.defaultContextUri);\r\n          }\r\n        }\r\n      );\r\n  }\r\n\r\n  setContext(context: DetailedContext) {\r\n    this.handleContextMessage(context);\r\n    const currentContext = this.context$.value;\r\n    if (currentContext && context && context.id === currentContext.id) {\r\n      if (context.map.view.keepCurrentView === undefined) {\r\n        context.map.view.keepCurrentView = true;\r\n      }\r\n      this.context$.next(context);\r\n      return;\r\n    }\r\n\r\n    if (!context.map) {\r\n      context.map = { view: {} };\r\n    }\r\n\r\n    Object.assign(context.map.view, this.mapViewFromRoute);\r\n\r\n    this.context$.next(context);\r\n  }\r\n\r\n  loadEditedContext(uri: string) {\r\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\r\n      this.setEditedContext(_context);\r\n    });\r\n  }\r\n\r\n  setEditedContext(context: DetailedContext) {\r\n    this.editedContext$.next(context);\r\n  }\r\n\r\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\r\n    const view = igoMap.ol.getView();\r\n    const proj = view.getProjection().getCode();\r\n    const center: any = new olPoint(view.getCenter()).transform(\r\n      proj,\r\n      'EPSG:4326'\r\n    );\r\n\r\n    const context = {\r\n      uri: uuid(),\r\n      title: '',\r\n      scope: 'private',\r\n      map: {\r\n        view: {\r\n          center: center.getCoordinates(),\r\n          zoom: view.getZoom(),\r\n          projection: proj,\r\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\r\n        }\r\n      },\r\n      layers: [],\r\n      tools: []\r\n    };\r\n\r\n    let layers = [];\r\n    if (empty === true) {\r\n      layers = igoMap.layers$\r\n        .getValue()\r\n        .filter(\r\n          (lay) =>\r\n            lay.baseLayer === true ||\r\n            lay.options.id === 'searchPointerSummaryId'\r\n        )\r\n        .sort((a, b) => a.zIndex - b.zIndex);\r\n    } else {\r\n      layers = igoMap.layers$.getValue().sort((a, b) => a.zIndex - b.zIndex);\r\n    }\r\n\r\n    let i = 0;\r\n    for (const l of layers) {\r\n      const layer: any = l;\r\n      const opts = {\r\n        id: layer.options.id ? String(layer.options.id) : undefined,\r\n        layerOptions: {\r\n          title: layer.options.title,\r\n          zIndex: ++i,\r\n          visible: layer.visible\r\n        },\r\n        sourceOptions: {\r\n          type: layer.dataSource.options.type,\r\n          params: layer.dataSource.options.params,\r\n          url: layer.dataSource.options.url,\r\n          queryable: layer.queryable\r\n        }\r\n      };\r\n      if (opts.sourceOptions.type) {\r\n        context.layers.push(opts);\r\n      }\r\n    }\r\n\r\n    context.tools = this.tools.map((tool) => {\r\n      return { id: String(tool.id), global: tool.global };\r\n    });\r\n\r\n    return context;\r\n  }\r\n\r\n  getContextFromLayers(\r\n    igoMap: IgoMap,\r\n    layers: Layer[],\r\n    name: string\r\n  ): DetailedContext {\r\n    const currentContext = this.context$.getValue();\r\n    const view = igoMap.ol.getView();\r\n    const proj = view.getProjection().getCode();\r\n    const center: any = new olPoint(view.getCenter()).transform(\r\n      proj,\r\n      'EPSG:4326'\r\n    );\r\n\r\n    const context = {\r\n      uri: name,\r\n      title: name,\r\n      map: {\r\n        view: {\r\n          center: center.getCoordinates(),\r\n          zoom: view.getZoom(),\r\n          projection: proj\r\n        }\r\n      },\r\n      layers: [],\r\n      toolbar: [],\r\n      tools: [],\r\n      extraFeatures: []\r\n    };\r\n\r\n    const currentLayers = igoMap.layers$.getValue();\r\n    context.layers = currentLayers\r\n      .filter((l) => l.baseLayer)\r\n      .map((l) => {\r\n        return {\r\n          baseLayer: true,\r\n          sourceOptions: l.options.sourceOptions,\r\n          title: l.options.title,\r\n          visible: l.visible\r\n        };\r\n      });\r\n\r\n    layers.forEach((layer) => {\r\n      const layerFound = currentContext.layers.find(\r\n        (contextLayer) =>\r\n          layer.id === contextLayer.source.id && !contextLayer.baseLayer\r\n      );\r\n\r\n      if (layerFound) {\r\n        let layerStyle = layerFound[`style`];\r\n        if (layerFound[`styleByAttribute`]) {\r\n          layerStyle = undefined;\r\n        } else if (layerFound[`clusterBaseStyle`]) {\r\n          layerStyle = undefined;\r\n          delete layerFound.sourceOptions[`source`];\r\n          delete layerFound.sourceOptions[`format`];\r\n        }\r\n        const opts = {\r\n          baseLayer: layerFound.baseLayer,\r\n          title: layer.options.title,\r\n          zIndex: layer.zIndex,\r\n          styleByAttribute: layerFound[`styleByAttribute`],\r\n          clusterBaseStyle: layerFound[`clusterBaseStyle`],\r\n          style: layerStyle,\r\n          clusterParam: layerFound[`clusterParam`],\r\n          visible: layer.visible,\r\n          opacity: layer.opacity,\r\n          sourceOptions: layerFound.sourceOptions\r\n        };\r\n        context.layers.push(opts);\r\n      } else {\r\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\r\n          const catalogLayer = layer.options;\r\n          catalogLayer.zIndex = layer.zIndex;\r\n          delete catalogLayer.source;\r\n          context.layers.push(catalogLayer);\r\n        } else {\r\n          let features;\r\n          const writer = new GeoJSON();\r\n          if (layer.ol.getSource() instanceof Cluster) {\r\n            const clusterSource = layer.ol.getSource() as Cluster;\r\n            features = writer.writeFeatures(\r\n              clusterSource.getFeatures(),\r\n              {\r\n                dataProjection: 'EPSG:4326',\r\n                featureProjection: 'EPSG:3857'\r\n              }\r\n            );\r\n          } else {\r\n          //   features = writer.writeFeatures(\r\n          //     layer.ol.getSource().getFeatures(),\r\n          //     {\r\n          //       dataProjection: 'EPSG:4326',\r\n          //       featureProjection: 'EPSG:3857'\r\n          //     }\r\n          //   );\r\n          }\r\n          features = JSON.parse(features);\r\n          features.name = layer.options.title;\r\n          context.extraFeatures.push(features);\r\n        }\r\n      }\r\n    });\r\n\r\n    context.toolbar = this.toolbar;\r\n    context.tools = this.tools;\r\n\r\n    return context;\r\n  }\r\n\r\n  setTools(tools: Tool[]) {\r\n    this.tools = tools;\r\n  }\r\n\r\n  setToolbar(toolbar: string[]) {\r\n    this.toolbar = toolbar;\r\n  }\r\n\r\n  private handleContextMessage(context: DetailedContext) {\r\n    if (this.contextMessage) {\r\n      this.messageService.remove(this.contextMessage.id);\r\n    }\r\n    if (this.context$.value && context.uri && this.context$.value.uri !== context.uri) {\r\n      this.messageService.removeAllAreNotError();\r\n    }\r\n\r\n    context.messages = context.messages ? context.messages : [];\r\n    context.messages.push(context.message);\r\n    context.messages.map(message => {\r\n      if (message) {\r\n        message.title = message.title\r\n          ? this.languageService.translate.instant(message.title)\r\n          : undefined;\r\n        message.text = message.text\r\n          ? this.languageService.translate.instant(message.text)\r\n          : undefined;\r\n        this.messageService.message(message as Message);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getContextByUri(uri: string): Observable<DetailedContext> {\r\n    if (this.baseUrl) {\r\n      let contextToLoad;\r\n      for (const key of Object.keys(this.contexts$.value)) {\r\n        contextToLoad = this.contexts$.value[key].find((c) => {\r\n          return c.uri === uri;\r\n        });\r\n        if (contextToLoad) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (contextToLoad && contextToLoad.imported) {\r\n        return of(contextToLoad);\r\n      }\r\n\r\n      // TODO : use always id or uri\r\n      const id = contextToLoad ? contextToLoad.id : uri;\r\n      return this.getDetails(id);\r\n    }\r\n\r\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\r\n      return currentContext.uri === uri && currentContext.imported === true;\r\n    });\r\n\r\n    if (importedContext) {\r\n      return of(importedContext);\r\n    } else {\r\n      return this.getLocalContext(uri);\r\n    }\r\n  }\r\n\r\n  getContextLayers(igoMap: IgoMap) {\r\n    const layers: Layer[] = [];\r\n    const mapLayers = igoMap.layers$.getValue();\r\n    mapLayers.forEach((layer) => {\r\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\r\n        layers.push(layer);\r\n      }\r\n    });\r\n    return layers;\r\n  }\r\n\r\n  private readParamsFromRoute() {\r\n    if (!this.route) {\r\n      return;\r\n    }\r\n\r\n    this.route.queryParams.subscribe((params) => {\r\n      const centerKey = this.route.options.centerKey;\r\n      if (centerKey && params[centerKey as string]) {\r\n        const centerParams = params[centerKey as string];\r\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\r\n        this.mapViewFromRoute.geolocate = false;\r\n      }\r\n\r\n      const projectionKey = this.route.options.projectionKey;\r\n      if (projectionKey && params[projectionKey as string]) {\r\n        const projectionParam = params[projectionKey as string];\r\n        this.mapViewFromRoute.projection = projectionParam;\r\n      }\r\n\r\n      const zoomKey = this.route.options.zoomKey;\r\n      if (zoomKey && params[zoomKey as string]) {\r\n        const zoomParam = params[zoomKey as string];\r\n        this.mapViewFromRoute.zoom = Number(zoomParam);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getPath(file: string) {\r\n    const basePath = this.options.basePath.replace(/\\/$/, '');\r\n\r\n    return `${basePath}/${file}`;\r\n  }\r\n\r\n  private handleError(\r\n    error: HttpErrorResponse,\r\n    uri: string,\r\n    permissionError?: boolean\r\n  ): Message[] {\r\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\r\n    const titleContext = context ? context.title : uri;\r\n    error.error.title = this.languageService.translate.instant(\r\n      'igo.context.contextManager.invalid.title'\r\n    );\r\n\r\n    error.error.message = this.languageService.translate.instant(\r\n      'igo.context.contextManager.invalid.text',\r\n      { value: titleContext }\r\n    );\r\n\r\n    error.error.toDisplay = true;\r\n\r\n    if (permissionError) {\r\n      error.error.title = this.languageService.translate.instant(\r\n        'igo.context.contextManager.errors.addPermissionTitle'\r\n      );\r\n      error.error.message = this.languageService.translate.instant(\r\n        'igo.context.contextManager.errors.addPermission'\r\n      );\r\n    }\r\n\r\n    throw error;\r\n  }\r\n\r\n  private handleContextsChange(\r\n    keepCurrentContext = true\r\n  ) {\r\n    const context = this.context$.value;\r\n    const editedContext = this.editedContext$.value;\r\n    if (!context || context.uri === this.options.defaultContextUri) {\r\n      keepCurrentContext = false;\r\n    }\r\n    if (!keepCurrentContext || !this.findContext(context)) {\r\n      this.defaultContextUri = undefined;\r\n      this.loadDefaultContext();\r\n    } else {\r\n      this.getContextByUri(context.uri)\r\n        .pipe(first())\r\n        .subscribe(\r\n          (newContext: DetailedContext) => {\r\n            this.toolsChanged$.next(newContext);\r\n          }\r\n        );\r\n\r\n      if (this.baseUrl && this.authService.authenticated) {\r\n        this.getDefault().subscribe();\r\n      }\r\n    }\r\n    const editedFound = this.findContext(editedContext);\r\n    if (!editedFound || editedFound.permission !== 'write') {\r\n      this.setEditedContext(undefined);\r\n    }\r\n  }\r\n\r\n  private addContextToList(context: Context) {\r\n    const contextFound = this.findContext(context);\r\n    if (!contextFound) {\r\n      const contextSimplifie = {\r\n        id: context.id,\r\n        uri: context.uri,\r\n        title: context.title,\r\n        scope: context.scope,\r\n        permission: TypePermission[TypePermission.read]\r\n      };\r\n\r\n      if (this.contexts$.value && this.contexts$.value.public) {\r\n        this.contexts$.value.public.push(contextSimplifie);\r\n        this.contexts$.next(this.contexts$.value);\r\n      }\r\n    }\r\n  }\r\n\r\n  private findContext(context: Context) {\r\n    if (!context) {\r\n      return false;\r\n    }\r\n\r\n    const contexts = this.contexts$.value;\r\n    let found;\r\n    for (const key of Object.keys(contexts)) {\r\n      const value = contexts[key];\r\n      found = value.find(\r\n        (c) =>\r\n          (context.id && c.id === context.id) ||\r\n          (context.uri && c.uri === context.uri)\r\n      );\r\n      if (found) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { ContextImportExportComponent } from './context-import-export/context-import-export.component';\r\nimport { IgoSpinnerModule } from '@igo2/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\n@NgModule({\r\n  imports: [\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatDividerModule,\r\n    MatTabsModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule,\r\n    IgoSpinnerModule,\r\n    MatTooltipModule,\r\n  ],\r\n  exports: [\r\n    ContextImportExportComponent\r\n  ],\r\n  declarations: [\r\n    ContextImportExportComponent\r\n  ]\r\n})\r\nexport class IgoContextImportExportModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextImportExportModule> {\r\n    return {\r\n      ngModule: IgoContextImportExportModule\r\n    };\r\n  }\r\n}\r\n","import { Directive, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { filter } from 'rxjs/operators';\r\n\r\nimport { MapViewOptions, MapBrowserComponent, MapControlsOptions, MapScaleLineOptions } from '@igo2/geo';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { ContextService } from './context.service';\r\nimport { DetailedContext, ContextMapView } from './context.interface';\r\nimport { MediaService } from '@igo2/core';\r\n\r\n@Directive({\r\n  selector: '[igoMapContext]'\r\n})\r\nexport class MapContextDirective implements OnInit, OnDestroy {\r\n  private component: MapBrowserComponent;\r\n  private context$$: Subscription;\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    component: MapBrowserComponent,\r\n    private contextService: ContextService,\r\n    private mediaService: MediaService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.context$$ = this.contextService.context$\r\n      .pipe(filter(context => context !== undefined))\r\n      .subscribe(context => this.handleContextChange(context));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.context$$.unsubscribe();\r\n  }\r\n\r\n  private handleContextChange(context: DetailedContext) {\r\n    if (context.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    // This creates a new ol.Map when the context changes. Doing that\r\n    // allows the print tool to work properly even when the map's canvas\r\n    // has been tainted (CORS) with the layers of another context. This could\r\n    // have some side effects such as unbinding all listeners on the first map.\r\n    // A better solution would be to create a new map (preview) before\r\n    // printing and avoid the tainted canvas issue. This will come later so\r\n    // this snippet of code is kept here in case it takes too long becomes\r\n    // an issue\r\n\r\n    // const target = this.component.map.ol.getTarget();\r\n    // this.component.map.ol.setTarget(undefined);\r\n    // this.component.map.init();\r\n    // this.component.map.ol.setTarget(target);\r\n\r\n    const viewContext: ContextMapView = context.map.view;\r\n    if (!this.component.view || viewContext.keepCurrentView !== true) {\r\n      this.component.view = viewContext as MapViewOptions;\r\n    }\r\n\r\n    const controlsContext: MapControlsOptions = context.map.controls;\r\n    if (!this.component.controls && controlsContext) {\r\n      if (this.mediaService.isMobile()) {\r\n        if (typeof(controlsContext.scaleLine) !== 'boolean') {\r\n          const scaleLineOption = controlsContext.scaleLine as MapScaleLineOptions;\r\n          if (!scaleLineOption.minWidth) {\r\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\r\n            controlsContext.scaleLine = scaleLineOption;\r\n          }\r\n        }\r\n      }\r\n      this.component.controls = controlsContext;\r\n    }\r\n  }\r\n}\r\n","import { Directive, OnInit, OnDestroy, Optional, Input } from '@angular/core';\r\n\r\nimport { Subscription, merge } from 'rxjs';\r\nimport { buffer, debounceTime, filter } from 'rxjs/operators';\r\n\r\nimport { RouteService, ConfigService } from '@igo2/core';\r\nimport {\r\n  MapBrowserComponent,\r\n  Layer,\r\n  LayerService,\r\n  LayerOptions,\r\n  StyleListService,\r\n  StyleService\r\n} from '@igo2/geo';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { ContextService } from './context.service';\r\nimport { DetailedContext } from './context.interface';\r\nimport {\r\n  addImportedFeaturesToMap,\r\n  addImportedFeaturesStyledToMap\r\n} from '../../context-import-export/shared/context-import.utils';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\n\r\n@Directive({\r\n  selector: '[igoLayerContext]'\r\n})\r\nexport class LayerContextDirective implements OnInit, OnDestroy {\r\n  private context$$: Subscription;\r\n  private queryParams: any;\r\n\r\n  private contextLayers: Layer[] = [];\r\n\r\n  @Input() removeLayersOnContextChange: boolean = true;\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    private component: MapBrowserComponent,\r\n    private contextService: ContextService,\r\n    private layerService: LayerService,\r\n    private configService: ConfigService,\r\n    private styleListService: StyleListService,\r\n    private styleService: StyleService,\r\n    @Optional() private route: RouteService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.context$$ = this.contextService.context$\r\n      .pipe(filter((context) => context !== undefined))\r\n      .subscribe((context) => this.handleContextChange(context));\r\n\r\n    if (\r\n      this.route &&\r\n      this.route.options.visibleOnLayersKey &&\r\n      this.route.options.visibleOffLayersKey &&\r\n      this.route.options.contextKey\r\n    ) {\r\n      const queryParams$$ = this.route.queryParams.subscribe((params) => {\r\n        if (Object.keys(params).length > 0) {\r\n          this.queryParams = params;\r\n          queryParams$$.unsubscribe();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.context$$.unsubscribe();\r\n  }\r\n\r\n  private handleContextChange(context: DetailedContext) {\r\n    if (context.layers === undefined) {\r\n      return;\r\n    }\r\n    if (this.removeLayersOnContextChange === true) {\r\n      this.map.removeAllLayers();\r\n    } else {\r\n      this.map.removeLayers(this.contextLayers);\r\n    }\r\n    this.contextLayers = [];\r\n\r\n    const layersAndIndex$ = merge(\r\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\r\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\r\n      })\r\n    );\r\n\r\n    layersAndIndex$\r\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\r\n      .subscribe((layers: Layer[]) => {\r\n        layers = layers\r\n          .filter((layer: Layer) => layer !== undefined)\r\n          .map((layer) => {\r\n            layer.visible = this.computeLayerVisibilityFromUrl(layer);\r\n            layer.zIndex = layer.zIndex;\r\n\r\n            return layer;\r\n          });\r\n\r\n        this.contextLayers.concat(layers);\r\n        this.map.addLayers(layers);\r\n\r\n        if (context.extraFeatures) {\r\n          context.extraFeatures.forEach((featureCollection) => {\r\n            const format = new GeoJSON();\r\n            const title = featureCollection.name;\r\n            featureCollection = JSON.stringify(featureCollection);\r\n            featureCollection = format.readFeatures(featureCollection, {\r\n              dataProjection: 'EPSG:4326',\r\n              featureProjection: 'EPSG:3857'\r\n            });\r\n            if (!this.configService.getConfig('importWithStyle')) {\r\n              addImportedFeaturesToMap(featureCollection, this.map, title);\r\n            } else {\r\n              addImportedFeaturesStyledToMap(\r\n                featureCollection,\r\n                this.map,\r\n                title,\r\n                this.styleListService,\r\n                this.styleService\r\n              );\r\n            }\r\n          });\r\n        }\r\n      });\r\n  }\r\n\r\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\r\n    const params = this.queryParams;\r\n    const currentContext = this.contextService.context$.value.uri;\r\n    const currentLayerid: string = layer.id;\r\n\r\n    let visible = layer.visible;\r\n    if (!params || !currentLayerid) {\r\n      return visible;\r\n    }\r\n\r\n    const contextParams = params[this.route.options.contextKey as string];\r\n    if (contextParams === currentContext || !contextParams) {\r\n      let visibleOnLayersParams = '';\r\n      let visibleOffLayersParams = '';\r\n      let visiblelayers: string[] = [];\r\n      let invisiblelayers: string[] = [];\r\n\r\n      if (\r\n        this.route.options.visibleOnLayersKey &&\r\n        params[this.route.options.visibleOnLayersKey as string]\r\n      ) {\r\n        visibleOnLayersParams =\r\n          params[this.route.options.visibleOnLayersKey as string];\r\n      }\r\n      if (\r\n        this.route.options.visibleOffLayersKey &&\r\n        params[this.route.options.visibleOffLayersKey as string]\r\n      ) {\r\n        visibleOffLayersParams =\r\n          params[this.route.options.visibleOffLayersKey as string];\r\n      }\r\n\r\n      /* This order is important because to control whichever\r\n       the order of * param. First whe open and close everything.*/\r\n      if (visibleOnLayersParams === '*') {\r\n        visible = true;\r\n      }\r\n      if (visibleOffLayersParams === '*') {\r\n        visible = false;\r\n      }\r\n\r\n      // After, managing named layer by id (context.json OR id from datasource)\r\n      visiblelayers = visibleOnLayersParams.split(',');\r\n      invisiblelayers = visibleOffLayersParams.split(',');\r\n      if (visiblelayers.indexOf(currentLayerid) > -1  || visiblelayers.indexOf(currentLayerid.toString()) > -1) {\r\n        visible = true;\r\n      }\r\n      if (invisiblelayers.indexOf(currentLayerid) > -1 || invisiblelayers.indexOf(currentLayerid.toString()) > -1) {\r\n        visible = false;\r\n      }\r\n    }\r\n\r\n    return visible;\r\n  }\r\n}\r\n","import * as olStyle from 'ol/style';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport {\r\n  FeatureDataSource,\r\n  FeatureDataSourceOptions,\r\n  IgoMap,\r\n  VectorLayer,\r\n  QueryableDataSourceOptions,\r\n  StyleService,\r\n  StyleListService,\r\n  StyleByAttribute,\r\n  ClusterParam,\r\n  ClusterDataSourceOptions,\r\n  ClusterDataSource\r\n} from '@igo2/geo';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\r\nimport { ContextService } from '../../context-manager/shared/context.service';\r\nimport OlFeature from 'ol/Feature';\r\n\r\nexport function handleFileImportSuccess(\r\n  file: File,\r\n  context: DetailedContext,\r\n  messageService: MessageService,\r\n  languageService: LanguageService,\r\n  contextService: ContextService\r\n) {\r\n  if (Object.keys(context).length <= 0) {\r\n    handleNothingToImportError(file, messageService, languageService);\r\n    return;\r\n  }\r\n\r\n  const contextTitle = computeLayerTitleFromFile(file);\r\n\r\n  addContextToContextList(context, contextTitle, contextService);\r\n\r\n  const translate = languageService.translate;\r\n  const messageTitle = translate.instant(\r\n    'igo.context.contextImportExport.import.success.title'\r\n  );\r\n  const message = translate.instant(\r\n    'igo.context.contextImportExport.import.success.text',\r\n    {\r\n      value: contextTitle\r\n    }\r\n  );\r\n  messageService.success(message, messageTitle);\r\n}\r\n\r\nexport function handleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService,\r\n  sizeMb?: number\r\n) {\r\n  sizeMb = sizeMb ? sizeMb : 30;\r\n  const errMapping = {\r\n    'Invalid file': handleInvalidFileImportError,\r\n    'File is too large': handleSizeFileImportError,\r\n    'Failed to read file': handleUnreadbleFileImportError\r\n  };\r\n  errMapping[error.message](\r\n    file,\r\n    error,\r\n    messageService,\r\n    languageService,\r\n    sizeMb\r\n  );\r\n}\r\n\r\nexport function handleInvalidFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant(\r\n    'igo.context.contextImportExport.import.invalid.title'\r\n  );\r\n  const message = translate.instant(\r\n    'igo.context.contextImportExport.import.invalid.text',\r\n    {\r\n      value: file.name,\r\n      mimeType: file.type\r\n    }\r\n  );\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleSizeFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService,\r\n  sizeMb: number\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant(\r\n    'igo.context.contextImportExport.import.tooLarge.title'\r\n  );\r\n  const message = translate.instant(\r\n    'igo.context.contextImportExport.import.tooLarge.text',\r\n    {\r\n      value: file.name,\r\n      size: sizeMb\r\n    }\r\n  );\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleUnreadbleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant(\r\n    'igo.context.contextImportExport.import.unreadable.title'\r\n  );\r\n  const message = translate.instant(\r\n    'igo.context.contextImportExport.import.unreadable.text',\r\n    {\r\n      value: file.name\r\n    }\r\n  );\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleNothingToImportError(\r\n  file: File,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant(\r\n    'igo.context.contextImportExport.import.empty.title'\r\n  );\r\n  const message = translate.instant(\r\n    'igo.context.contextImportExport.import.empty.text',\r\n    {\r\n      value: file.name\r\n    }\r\n  );\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function addContextToContextList(\r\n  context: DetailedContext,\r\n  contextTitle: string,\r\n  contextService: ContextService\r\n) {\r\n  context.title = contextTitle;\r\n  context.imported = true;\r\n  contextService.contexts$.value.ours.unshift(context);\r\n  contextService.contexts$.next(contextService.contexts$.value);\r\n  contextService.importedContext.unshift(context);\r\n  contextService.loadContext(context.uri);\r\n}\r\n\r\nexport function getFileExtension(file: File): string {\r\n  return file.name.split('.').pop().toLowerCase();\r\n}\r\n\r\nexport function computeLayerTitleFromFile(file: File): string {\r\n  return file.name.substr(0, file.name.lastIndexOf('.'));\r\n}\r\n\r\nexport function addImportedFeaturesToMap(\r\n  olFeatures: OlFeature<OlGeometry>[],\r\n  map: IgoMap,\r\n  layerTitle: string\r\n): VectorLayer {\r\n  const r = Math.floor(Math.random() * 255);\r\n  const g = Math.floor(Math.random() * 255);\r\n  const b = Math.floor(Math.random() * 255);\r\n  const stroke = new olStyle.Stroke({\r\n    color: [r, g, b, 1],\r\n    width: 2\r\n  });\r\n\r\n  const fill = new olStyle.Fill({\r\n    color: [r, g, b, 0.4]\r\n  });\r\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n    type: 'vector',\r\n    queryable: true\r\n  };\r\n  const source = new FeatureDataSource(sourceOptions);\r\n  source.ol.addFeatures(olFeatures);\r\n  const layer = new VectorLayer({\r\n    title: layerTitle,\r\n    source,\r\n    style: new olStyle.Style({\r\n      stroke,\r\n      fill,\r\n      image: new olStyle.Circle({\r\n        radius: 5,\r\n        stroke,\r\n        fill\r\n      })\r\n    })\r\n  });\r\n  map.addLayer(layer);\r\n\r\n  return layer;\r\n}\r\n\r\nexport function addImportedFeaturesStyledToMap(\r\n  olFeatures: OlFeature<OlGeometry>[],\r\n  map: IgoMap,\r\n  layerTitle: string,\r\n  styleListService: StyleListService,\r\n  styleService: StyleService\r\n): VectorLayer {\r\n  let style;\r\n  let distance: number;\r\n\r\n  if (\r\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\r\n  ) {\r\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\r\n      layerTitle.toString() + '.styleByAttribute'\r\n    );\r\n\r\n    style = (feature) => {\r\n      return styleService.createStyleByAttribute(feature, styleByAttribute);\r\n    };\r\n  } else if (\r\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\r\n  ) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(\r\n      layerTitle.toString() + '.clusterParam'\r\n    );\r\n    distance = styleListService.getStyleList(\r\n      layerTitle.toString() + '.distance'\r\n    );\r\n\r\n    const baseStyle = styleService.createStyle(\r\n      styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\r\n    );\r\n\r\n    style = (feature) => {\r\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\r\n    };\r\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\r\n    style = styleService.createStyle(\r\n      styleListService.getStyleList(layerTitle.toString() + '.style')\r\n    );\r\n  } else {\r\n    style = styleService.createStyle(\r\n      styleListService.getStyleList('default.style')\r\n    );\r\n  }\r\n  let source;\r\n\r\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\r\n    const sourceOptions: ClusterDataSourceOptions &\r\n      QueryableDataSourceOptions = {\r\n      distance,\r\n      type: 'cluster',\r\n      queryable: true\r\n    };\r\n    source = new ClusterDataSource(sourceOptions);\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else {\r\n    const sourceOptions: FeatureDataSourceOptions &\r\n      QueryableDataSourceOptions = {\r\n      type: 'vector',\r\n      queryable: true\r\n    };\r\n    source = new FeatureDataSource(sourceOptions);\r\n    source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  const layer = new VectorLayer({\r\n    title: layerTitle,\r\n    source,\r\n    style\r\n  });\r\n  map.addLayer(layer);\r\n\r\n  return layer;\r\n}\r\n","export enum ContextListControlsEnum {\r\n  always = 'always',\r\n  never = 'never',\r\n  default = 'default'\r\n}\r\n","import { Component } from '@angular/core';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\n\r\n@Component({\r\n  selector: 'igo-bookmark-dialog',\r\n  templateUrl: './bookmark-dialog.component.html'\r\n})\r\nexport class BookmarkDialogComponent {\r\n  public title: string;\r\n\r\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\r\n}\r\n","<h1 mat-dialog-title class=\"mat-typography\">{{ 'igo.context.bookmarkButton.dialog.title' |translate }}</h1>\r\n<div mat-dialog-content class=\"mat-typography\">\r\n  <mat-form-field>\r\n    <input matInput required autocomplete=\"off\"\r\n      maxlength=\"128\"\r\n      [placeholder]=\"'igo.context.bookmarkButton.dialog.placeholder' |translate\"\r\n      [(ngModel)]=\"title\">\r\n  </mat-form-field>\r\n</div>\r\n<div mat-dialog-actions>\r\n  <button mat-button color=\"primary\"\r\n         [disabled]=\"!title\"\r\n         (click)=\"dialogRef.close(title)\">\r\n    {{'igo.common.confirmDialog.confirmBtn' | translate}}\r\n  </button>\r\n  <button mat-button\r\n          (click)=\"dialogRef.close(false)\">\r\n    {{'igo.common.confirmDialog.cancelBtn' |translate}}\r\n  </button>\r\n</div>\r\n","<mat-list-item\r\n  class=\"mat-list-item\"\r\n  [ngClass]=\"{'mat-list-item-light': hidden}\">\r\n  <button mat-list-avatar\r\n    *ngIf=\"auth.authenticated\"\r\n    mat-icon-button\r\n    igoStopPropagation\r\n    [matTooltip]=\"auth.authenticated ? ('igo.context.contextManager.favorite' | translate) : ''\"\r\n    matTooltipShowDelay=\"500\"\r\n    [color]=\"default ? 'primary' : 'default'\"\r\n    (click)=\"favoriteClick(context)\">\r\n    <mat-icon *ngIf=\"!context.iconImage\" svgIcon=\"{{context.icon ? context.icon : context.scope === 'public' ? 'earth' : 'star'}}\"></mat-icon>\r\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\">\r\n  </button>\r\n  <h4 matLine>{{context.title}}</h4>\r\n\r\n  <div *ngIf=\"auth.authenticated\"\r\n       igoStopPropagation\r\n       class=\"igo-actions-container\">\r\n\r\n     <button *ngIf=\"collapsed && selected && (context.permission === typePermission[typePermission.write] || context.imported)\"\r\n       class=\"save-button\"\r\n       mat-icon-button\r\n       [matTooltip]=\"'igo.context.contextManager.save' | translate\"\r\n       matTooltipShowDelay=\"500\"\r\n       [color]=\"color\"\r\n       (click)=\"save.emit(context)\">\r\n       <mat-icon svgIcon=\"content-save\"></mat-icon>\r\n     </button>\r\n\r\n    <div #actions class=\"igo-actions-expand-container\">\r\n\r\n      <button *ngIf=\"canShare && !context.imported\"\r\n        mat-icon-button\r\n        [matTooltip]=\"'igo.context.contextManager.managePermissions' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        [color]=\"color\"\r\n        (click)=\"managePermissions.emit(context)\">\r\n        <mat-icon svgIcon=\"account-arrow-right\"></mat-icon>\r\n      </button>\r\n\r\n      <!--button\r\n        mat-icon-button\r\n        [matTooltip]=\"'igo.context.contextManager.manageTools' | translate\"\r\n        [color]=\"color\"\r\n        (click)=\"manageTools.emit(context)\">\r\n        <mat-icon svgIcon=\"widgets\"></mat-icon>\r\n      </button-->\r\n\r\n      <button *ngIf=\"!context.imported\"\r\n        class=\"clone-button\"\r\n        mat-icon-button\r\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        [color]=\"color\"\r\n        (click)=\"clone.emit(context)\">\r\n        <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n      </button>\r\n\r\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] && !context.imported\"\r\n        class=\"edit-button\"\r\n        mat-icon-button\r\n        [color]=\"color\"\r\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        (click)=\"edit.emit(context)\">\r\n        <mat-icon svgIcon=\"pencil\"></mat-icon>\r\n      </button>\r\n\r\n      <button *ngIf=\"!context.hidden && !context.imported\"\r\n        class=\"hide-button\"\r\n        mat-icon-button\r\n        [color]=\"color\"\r\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        (click)=\"hide.emit(context)\">\r\n        <mat-icon svgIcon=\"eye\"></mat-icon>\r\n      </button>\r\n\r\n      <button *ngIf=\"context.hidden && !context.imported\"\r\n        class=\"hide-button\"\r\n        mat-icon-button\r\n        [color]=\"color\"\r\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        (click)=\"show.emit(context)\">\r\n        <mat-icon svgIcon=\"eye-off\"></mat-icon>\r\n      </button>\r\n\r\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] || context.imported\"\r\n        class=\"delete-button\"\r\n        mat-icon-button\r\n        color=\"warn\"\r\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        (click)=\"delete.emit(context)\">\r\n        <mat-icon svgIcon=\"delete\"></mat-icon>\r\n      </button>\r\n    </div>\r\n\r\n    <button\r\n      class=\"actions-button\"\r\n      mat-icon-button\r\n      igoCollapse\r\n      [color]=\"color\"\r\n      [target]=\"actions\"\r\n      [collapsed]=collapsed\r\n      (click)=\"collapsed = !collapsed\">\r\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\r\n    </button>\r\n\r\n  </div>\r\n\r\n</mat-list-item>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { StorageService } from '@igo2/core';\r\nimport { AuthService } from '@igo2/auth';\r\nimport { TypePermission } from '../shared/context.enum';\r\nimport { DetailedContext } from '../shared/context.interface';\r\n\r\n@Component({\r\n  selector: 'igo-context-item',\r\n  templateUrl: './context-item.component.html',\r\n  styleUrls: ['./context-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContextItemComponent {\r\n  public typePermission = TypePermission;\r\n  public color = 'primary';\r\n  public collapsed = true;\r\n\r\n  @Input()\r\n  get context(): DetailedContext {\r\n    return this._context;\r\n  }\r\n  set context(value: DetailedContext) {\r\n    this._context = value;\r\n  }\r\n  private _context: DetailedContext;\r\n\r\n  @Input()\r\n  get default(): boolean {\r\n    return this._default;\r\n  }\r\n  set default(value: boolean) {\r\n    this._default = value;\r\n  }\r\n  private _default = false;\r\n\r\n  @Input() selected: boolean;\r\n\r\n  @Output() edit = new EventEmitter<DetailedContext>();\r\n  @Output() delete = new EventEmitter<DetailedContext>();\r\n  @Output() save = new EventEmitter<DetailedContext>();\r\n  @Output() clone = new EventEmitter<DetailedContext>();\r\n  @Output() hide = new EventEmitter<DetailedContext>();\r\n  @Output() show = new EventEmitter<DetailedContext>();\r\n  @Output() favorite = new EventEmitter<DetailedContext>();\r\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\r\n  @Output() manageTools = new EventEmitter<DetailedContext>();\r\n\r\n  get hidden(): boolean {\r\n    return this.context.hidden;\r\n  }\r\n\r\n  get canShare(): boolean {\r\n    return this.storageService.get('canShare') === true;\r\n  }\r\n\r\n  constructor(\r\n    public auth: AuthService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  favoriteClick(context) {\r\n    if (this.auth.authenticated) {\r\n      this.favorite.emit(context);\r\n    }\r\n  }\r\n}\r\n","<igo-list [navigation]=\"true\">\r\n  <mat-form-field *ngIf=\"showFilter()\" [ngClass]=\"auth.authenticated && configService.getConfig('context') ? 'context-filter-min-width' : 'context-filter-max-width'\">\r\n    <input\r\n      matInput\r\n      type=\"text\"\r\n      [placeholder]=\"'igo.context.contextManager.filterPlaceHolder' | translate\"\r\n      [(ngModel)]=\"term\">\r\n    <button\r\n      mat-button\r\n      mat-icon-button\r\n      matSuffix\r\n      class=\"clear-button\"\r\n      *ngIf=\"term.length\"\r\n      aria-label=\"Clear\"\r\n      color=\"warn\"\r\n      (click)=\"clearFilter()\">\r\n      <mat-icon svgIcon=\"close\"></mat-icon>\r\n    </button>\r\n  </mat-form-field>\r\n\r\n  <button\r\n  *ngIf=\"!sortedAlpha\"\r\n  class=\"sort-alpha\"\r\n  mat-icon-button\r\n  [matTooltip]=\"'igo.context.contextManager.sortAlphabetically' | translate\"\r\n  matTooltipShowDelay=\"500\"\r\n  (click)=\"toggleSort(true)\">\r\n  <mat-icon color=\"primary\" svgIcon=\"sort-alphabetical-variant\"></mat-icon>\r\n  </button>\r\n  <button\r\n    *ngIf=\"sortedAlpha\"\r\n    class=\"sort-alpha\"\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.context.contextManager.sortContextOrder' | translate\"\r\n    matTooltipShowDelay=\"500\"\r\n    (click)=\"toggleSort(false)\">\r\n    <mat-icon color=\"warn\" svgIcon=\"sort-variant-remove\"></mat-icon>\r\n  </button>\r\n\r\n  <igo-actionbar *ngIf=\"auth.authenticated && configService.getConfig('context')\"\r\n    class=\"add-context-button\"\r\n    [iconColor]=\"color\"\r\n    [store]=\"actionStore\"\r\n    [withIcon]=\"true\"\r\n    icon=\"plus\"\r\n    [withTitle]=\"actionbarMode === 'overlay'\"\r\n    [horizontal]=\"false\"\r\n    [mode]=\"actionbarMode\">\r\n  </igo-actionbar>\r\n\r\n  <button *ngIf=\"auth.authenticated && configService.getConfig('context')\"\r\n    class=\"users-filter\"\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matMenuTriggerFor]=\"accountMenu\">\r\n    <mat-icon color=\"primary\" svgIcon=\"filter-menu\"></mat-icon>\r\n  </button>\r\n\r\n  <mat-menu #accountMenu=\"matMenu\">\r\n    <ng-container *ngFor=\"let user of users\">\r\n      <span class=\"profilsMenu\">\r\n        <mat-checkbox\r\n          class=\"mat-menu-item\"\r\n          [checked]=\"getPermission(user).checked\"\r\n          [indeterminate]=\"getPermission(user).indeterminate\"\r\n          (click)=\"$event.stopPropagation()\"\r\n          (change)=\"userSelection(user)\">\r\n        </mat-checkbox>\r\n        <button *ngIf=\"user.childs\"\r\n          [matMenuTriggerFor]=\"subAccountMenu\"\r\n          mat-menu-item>\r\n          {{user.title}}\r\n        </button>\r\n        <button\r\n          mat-menu-item\r\n          *ngIf=\"!user.childs\">\r\n          {{user.title}}\r\n        </button>\r\n      </span>\r\n\r\n      <mat-menu #subAccountMenu=\"matMenu\">\r\n        <mat-checkbox *ngFor=\"let child of user.childs\"\r\n          class=\"mat-menu-item\"\r\n          [checked]=\"getPermission(child).checked\"\r\n          (click)=\"$event.stopPropagation()\"\r\n          (change)=\"userSelection(child, user)\">\r\n          {{child.title}}\r\n        </mat-checkbox>\r\n      </mat-menu>\r\n    </ng-container>\r\n\r\n    <span class=\"profilsMenu\">\r\n      <mat-checkbox\r\n        class=\"mat-menu-item\"\r\n        [checked]=\"showHidden\"\r\n        (click)=\"$event.stopPropagation()\"\r\n        (change)=\"showHiddenContexts.emit()\">\r\n      </mat-checkbox>\r\n      <button mat-menu-item>\r\n        {{ 'igo.context.contextManager.showHidden' | translate }}\r\n      </button>\r\n    </span>\r\n  </mat-menu>\r\n\r\n  <ng-template ngFor let-groupContexts [ngForOf]=\"contexts$ | async | keyvalue\">\r\n\r\n    <igo-collapsible *ngIf=\"groupContexts.value.length && auth.authenticated\" [title]=\"titleMapping[groupContexts.key] | translate\"\r\n      [collapsed]=\"collapsed[titleMapping[groupContexts.key]]\" (toggle)=\"collapsed[titleMapping[groupContexts.key]] = $event\">\r\n\r\n      <ng-template ngFor let-context [ngForOf]=\"groupContexts.value\">\r\n        <igo-context-item\r\n          igoListItem\r\n          color=\"accent\"\r\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\r\n          [context]=\"context\"\r\n          [default]=\"context.id && this.defaultContextId && this.defaultContextId === context.id\"\r\n          (edit)=\"edit.emit(context)\"\r\n          (delete)=\"delete.emit(context)\"\r\n          (clone)=\"clone.emit(context)\"\r\n          (save)=\"save.emit(context)\"\r\n          (hide)=\"hideContext(context)\"\r\n          (show)=\"showContext(context)\"\r\n          (favorite)=\"favorite.emit(context)\"\r\n          (manageTools)=\"manageTools.emit(context)\"\r\n          (managePermissions)=\"managePermissions.emit(context)\"\r\n          (select)=\"select.emit(context)\"\r\n          (unselect)=\"unselect.emit(context)\">\r\n        </igo-context-item>\r\n      </ng-template>\r\n\r\n    </igo-collapsible>\r\n\r\n    <ng-template *ngIf=\"groupContexts.value.length && !auth.authenticated\" ngFor let-context [ngForOf]=\"groupContexts.value\">\r\n      <igo-context-item\r\n        igoListItem\r\n        color=\"accent\"\r\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\r\n        [context]=\"context\"\r\n        [default]=\"this.defaultContextId === context.id\"\r\n        (select)=\"select.emit(context)\"\r\n        (unselect)=\"unselect.emit(context)\">\r\n      </igo-context-item>\r\n    </ng-template>\r\n\r\n  </ng-template>\r\n</igo-list>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  ChangeDetectionStrategy,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport {\r\n  DetailedContext,\r\n  ContextsList,\r\n  ContextUserPermission,\r\n  ContextProfils\r\n} from '../shared/context.interface';\r\nimport { ContextListControlsEnum } from './context-list.enum';\r\nimport {\r\n  Subscription,\r\n  BehaviorSubject,\r\n  ReplaySubject,\r\n  EMPTY,\r\n  timer\r\n} from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\r\nimport { debounce } from 'rxjs/operators';\r\nimport { ActionStore, ActionbarMode } from '@igo2/common';\r\nimport { ContextService } from '../shared/context.service';\r\n\r\n@Component({\r\n  selector: 'igo-context-list',\r\n  templateUrl: './context-list.component.html',\r\n  styleUrls: ['./context-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContextListComponent implements OnInit, OnDestroy {\r\n  private contextsInitial: ContextsList = { ours: [] };\r\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\r\n    this.contextsInitial\r\n  );\r\n\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  private change$$: Subscription;\r\n\r\n  @Input()\r\n  get contexts(): ContextsList {\r\n    return this._contexts;\r\n  }\r\n  set contexts(value: ContextsList) {\r\n    this._contexts = value;\r\n    this.cdRef.detectChanges();\r\n    this.next();\r\n  }\r\n  private _contexts: ContextsList = { ours: [] };\r\n\r\n  @Input()\r\n  get selectedContext(): DetailedContext {\r\n    return this._selectedContext;\r\n  }\r\n  set selectedContext(value: DetailedContext) {\r\n    this._selectedContext = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n  private _selectedContext: DetailedContext;\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get defaultContextId(): string {\r\n    return this._defaultContextId;\r\n  }\r\n  set defaultContextId(value: string) {\r\n    this._defaultContextId = value;\r\n  }\r\n  private _defaultContextId: string;\r\n\r\n  public collapsed: { contextScope }[] = [];\r\n\r\n  @Output() select = new EventEmitter<DetailedContext>();\r\n  @Output() unselect = new EventEmitter<DetailedContext>();\r\n  @Output() edit = new EventEmitter<DetailedContext>();\r\n  @Output() delete = new EventEmitter<DetailedContext>();\r\n  @Output() save = new EventEmitter<DetailedContext>();\r\n  @Output() clone = new EventEmitter<DetailedContext>();\r\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\r\n  @Output() hide = new EventEmitter<DetailedContext>();\r\n  @Output() show = new EventEmitter<DetailedContext>();\r\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\r\n  @Output() favorite = new EventEmitter<DetailedContext>();\r\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\r\n  @Output() manageTools = new EventEmitter<DetailedContext>();\r\n  @Output() filterPermissionsChanged = new EventEmitter<\r\n    ContextUserPermission[]\r\n  >();\r\n\r\n  public titleMapping = {\r\n    ours: 'igo.context.contextManager.ourContexts',\r\n    shared: 'igo.context.contextManager.sharedContexts',\r\n    public: 'igo.context.contextManager.publicContexts'\r\n  };\r\n\r\n  public users: ContextProfils[];\r\n  public permissions: ContextUserPermission[] = [];\r\n\r\n  public actionStore = new ActionStore([]);\r\n  public actionbarMode = ActionbarMode.Overlay;\r\n\r\n  public color = 'primary';\r\n\r\n  public showHidden = false;\r\n\r\n  /**\r\n   * Context filter term\r\n   */\r\n  @Input()\r\n  set term(value: string) {\r\n    this._term = value;\r\n    this.next();\r\n  }\r\n  get term(): string {\r\n    return this._term;\r\n  }\r\n  public _term: string = '';\r\n\r\n  get sortedAlpha(): boolean {\r\n    return this._sortedAlpha;\r\n  }\r\n  set sortedAlpha(value: boolean) {\r\n    this._sortedAlpha = value;\r\n    this.next();\r\n  }\r\n  private _sortedAlpha: boolean = undefined;\r\n\r\n  public showContextFilter = ContextListControlsEnum.always;\r\n\r\n  public thresholdToFilter = 5;\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private contextService: ContextService,\r\n    public configService: ConfigService,\r\n    public auth: AuthService,\r\n    private dialog: MatDialog,\r\n    private languageService: LanguageService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.change$$ = this.change$\r\n      .pipe(\r\n        debounce(() => {\r\n          return this.contexts.ours.length === 0 ? EMPTY : timer(50);\r\n        })\r\n      )\r\n      .subscribe(() => {\r\n        this.contexts$.next(this.filterContextsList(this.contexts));\r\n      });\r\n\r\n    this.actionStore.load([\r\n      {\r\n        id: 'emptyContext',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContext'\r\n        ),\r\n        icon: 'map-outline',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContextTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(true);\r\n        }\r\n      },\r\n      {\r\n        id: 'contextFromMap',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMap'\r\n        ),\r\n        icon: 'map-check',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMapTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(false);\r\n        }\r\n      }\r\n    ]);\r\n  }\r\n\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n  private filterContextsList(contexts: ContextsList) {\r\n    if (this.term === '') {\r\n      if (this.sortedAlpha) {\r\n        contexts = this.sortContextsList(contexts);\r\n      }\r\n      return contexts;\r\n    } else {\r\n      const ours = contexts.ours.filter((context) => {\r\n        const filterNormalized = this.term\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const contextTitleNormalized = context.title\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        return contextTitleNormalized.includes(filterNormalized);\r\n      });\r\n\r\n      let updateContexts: ContextsList = {\r\n        ours\r\n      };\r\n\r\n      if (this.contexts.public) {\r\n        const publics = contexts.public.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.public = publics;\r\n      }\r\n\r\n      if (this.contexts.shared) {\r\n        const shared = contexts.shared.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.shared = shared;\r\n      }\r\n\r\n      if (this.sortedAlpha) {\r\n        updateContexts = this.sortContextsList(updateContexts);\r\n      }\r\n      return updateContexts;\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n\r\n  public showFilter() {\r\n    switch (this.showContextFilter) {\r\n      case ContextListControlsEnum.always:\r\n        return true;\r\n      case ContextListControlsEnum.never:\r\n        return false;\r\n      default:\r\n        let totalLength = this.contexts.ours.length;\r\n        this.contexts.public\r\n          ? (totalLength += this.contexts.public.length)\r\n          : (totalLength += 0);\r\n        this.contexts.shared\r\n          ? (totalLength += this.contexts.shared.length)\r\n          : (totalLength += 0);\r\n        if (totalLength >= this.thresholdToFilter) {\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  }\r\n\r\n  sortContextsList(contexts: ContextsList) {\r\n    if (contexts) {\r\n      const contextsList = JSON.parse(JSON.stringify(contexts));\r\n      contextsList.ours.sort((a, b) => {\r\n        if (this.normalize(a.title) < this.normalize(b.title)) {\r\n          return -1;\r\n        }\r\n        if (this.normalize(a.title) > this.normalize(b.title)) {\r\n          return 1;\r\n        }\r\n        return 0;\r\n      });\r\n\r\n      if (contextsList.shared) {\r\n        contextsList.shared.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      } else if (contextsList.public) {\r\n        contextsList.public.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      }\r\n      return contextsList;\r\n    }\r\n  }\r\n\r\n  normalize(str: string) {\r\n    return str\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .toLowerCase();\r\n  }\r\n\r\n  toggleSort(sortAlpha: boolean) {\r\n    this.sortedAlpha = sortAlpha;\r\n  }\r\n\r\n  clearFilter() {\r\n    this.term = '';\r\n  }\r\n\r\n  createContext(empty?: boolean) {\r\n    this.dialog\r\n      .open(BookmarkDialogComponent, { disableClose: false })\r\n      .afterClosed()\r\n      .pipe(take(1))\r\n      .subscribe((title: string) => {\r\n        if (title) {\r\n          this.create.emit({ title, empty });\r\n        }\r\n      });\r\n  }\r\n\r\n  getPermission(user?): ContextUserPermission {\r\n    if (user) {\r\n      const permission = this.permissions.find((p) => p.name === user.name);\r\n      return permission;\r\n    }\r\n  }\r\n\r\n  userSelection(user, parent?) {\r\n    const permission = this.getPermission(user);\r\n    if (permission) {\r\n      permission.checked = !permission.checked;\r\n      this.storageService.set(\r\n        'contexts.permissions.' + permission.name,\r\n        permission.checked\r\n      );\r\n      permission.indeterminate = false;\r\n    }\r\n\r\n    if (parent) {\r\n      let indeterminate = false;\r\n\r\n      for (const c of parent.childs) {\r\n        const cPermission = this.getPermission(c);\r\n        if (cPermission.checked !== permission.checked) {\r\n          indeterminate = true;\r\n          break;\r\n        }\r\n      }\r\n      const parentPermission = this.getPermission(parent);\r\n      if (parentPermission) {\r\n        parentPermission.checked = permission.checked;\r\n        this.storageService.set(\r\n          'contexts.permissions.' + parentPermission.name,\r\n          permission.checked\r\n        );\r\n        parentPermission.indeterminate = indeterminate;\r\n      }\r\n    }\r\n\r\n    if (user.childs) {\r\n      for (const c of user.childs) {\r\n        const childrenPermission = this.getPermission(c);\r\n        if (\r\n          childrenPermission &&\r\n          childrenPermission.checked !== permission.checked\r\n        ) {\r\n          childrenPermission.checked = permission.checked;\r\n          this.storageService.set(\r\n            'contexts.permissions.' + childrenPermission.name,\r\n            permission.checked\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    this.filterPermissionsChanged.emit(this.permissions);\r\n  }\r\n\r\n  hideContext(context: DetailedContext) {\r\n    context.hidden = true;\r\n    if (!this.showHidden) {\r\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\r\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\r\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\r\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\r\n      this.contexts = contexts;\r\n    }\r\n    this.hide.emit(context);\r\n  }\r\n\r\n  showContext(context: DetailedContext) {\r\n    context.hidden = false;\r\n    this.show.emit(context);\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Self,\r\n  OnInit,\r\n  OnDestroy,\r\n  HostListener\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { MessageService, LanguageService, StorageService } from '@igo2/core';\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ConfirmDialogService } from '@igo2/common';\r\nimport { MapService } from '@igo2/geo';\r\n\r\nimport {\r\n  Context,\r\n  DetailedContext,\r\n  ContextsList,\r\n  ContextUserPermission\r\n} from '../shared/context.interface';\r\nimport { ContextService } from '../shared/context.service';\r\nimport { ContextListComponent } from './context-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoContextListBinding]'\r\n})\r\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\r\n  private component: ContextListComponent;\r\n  private contexts$$: Subscription;\r\n  private selectedContext$$: Subscription;\r\n  private defaultContextId$$: Subscription;\r\n\r\n  @HostListener('select', ['$event'])\r\n  onSelect(context: Context) {\r\n    this.contextService.loadContext(context.uri);\r\n  }\r\n\r\n  @HostListener('edit', ['$event'])\r\n  onEdit(context: Context) {\r\n    this.contextService.loadEditedContext(context.uri);\r\n  }\r\n\r\n  @HostListener('save', ['$event'])\r\n  onSave(context: Context) {\r\n    const map = this.mapService.getMap();\r\n    const contextFromMap = this.contextService.getContextFromMap(map);\r\n\r\n    const msgSuccess = () => {\r\n      const translate = this.languageService.translate;\r\n      const message = translate.instant(\r\n        'igo.context.contextManager.dialog.saveMsg',\r\n        {\r\n          value: context.title\r\n        }\r\n      );\r\n      const title = translate.instant(\r\n        'igo.context.contextManager.dialog.saveTitle'\r\n      );\r\n      this.messageService.success(message, title);\r\n    };\r\n\r\n    if (context.imported) {\r\n      contextFromMap.title = context.title;\r\n      this.contextService.delete(context.id, true);\r\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\r\n        this.contextService.loadContext(contextCreated.uri);\r\n        msgSuccess();\r\n      });\r\n      return;\r\n    }\r\n\r\n    const changes: any = {\r\n      layers: contextFromMap.layers,\r\n      map: {\r\n        view: contextFromMap.map.view\r\n      }\r\n    };\r\n\r\n    this.contextService.update(context.id, changes).subscribe(() => {\r\n      msgSuccess();\r\n    });\r\n  }\r\n\r\n  @HostListener('favorite', ['$event'])\r\n  onFavorite(context: Context) {\r\n    this.contextService.setDefault(context.id).subscribe(() => {\r\n      this.contextService.defaultContextId$.next(context.id);\r\n      const translate = this.languageService.translate;\r\n      const message = translate.instant(\r\n        'igo.context.contextManager.dialog.favoriteMsg',\r\n        {\r\n          value: context.title\r\n        }\r\n      );\r\n      const title = translate.instant(\r\n        'igo.context.contextManager.dialog.favoriteTitle'\r\n      );\r\n      this.messageService.success(message, title);\r\n    });\r\n  }\r\n\r\n  @HostListener('manageTools', ['$event'])\r\n  onManageTools(context: Context) {\r\n    this.contextService.loadEditedContext(context.uri);\r\n  }\r\n\r\n  @HostListener('managePermissions', ['$event'])\r\n  onManagePermissions(context: Context) {\r\n    this.contextService.loadEditedContext(context.uri);\r\n  }\r\n\r\n  @HostListener('delete', ['$event'])\r\n  onDelete(context: Context) {\r\n    const translate = this.languageService.translate;\r\n    this.confirmDialogService\r\n      .open(\r\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\r\n      )\r\n      .subscribe((confirm) => {\r\n        if (confirm) {\r\n          this.contextService\r\n            .delete(context.id, context.imported)\r\n            .subscribe(() => {\r\n              const message = translate.instant(\r\n                'igo.context.contextManager.dialog.deleteMsg',\r\n                {\r\n                  value: context.title\r\n                }\r\n              );\r\n              const title = translate.instant(\r\n                'igo.context.contextManager.dialog.deleteTitle'\r\n              );\r\n              this.messageService.info(message, title);\r\n            });\r\n        }\r\n      });\r\n  }\r\n\r\n  @HostListener('clone', ['$event'])\r\n  onClone(context: DetailedContext) {\r\n    const properties = {\r\n      title: context.title + '-copy',\r\n      uri: context.uri + '-copy'\r\n    };\r\n    this.contextService.clone(context.id, properties).subscribe(() => {\r\n      const translate = this.languageService.translate;\r\n      const message = translate.instant(\r\n        'igo.context.contextManager.dialog.cloneMsg',\r\n        {\r\n          value: context.title\r\n        }\r\n      );\r\n      const title = translate.instant(\r\n        'igo.context.contextManager.dialog.cloneTitle'\r\n      );\r\n      this.messageService.success(message, title);\r\n    });\r\n  }\r\n\r\n  @HostListener('create', ['$event'])\r\n  onCreate(opts: { title: string; empty: boolean }) {\r\n    const { title, empty } = opts;\r\n    const context = this.contextService.getContextFromMap(\r\n      this.component.map,\r\n      empty\r\n    );\r\n    context.title = title;\r\n    this.contextService.create(context).subscribe(() => {\r\n      const translate = this.languageService.translate;\r\n      const titleD = translate.instant(\r\n        'igo.context.bookmarkButton.dialog.createTitle'\r\n      );\r\n      const message = translate.instant(\r\n        'igo.context.bookmarkButton.dialog.createMsg',\r\n        {\r\n          value: context.title\r\n        }\r\n      );\r\n      this.messageService.success(message, titleD);\r\n      this.contextService.loadContext(context.uri);\r\n    });\r\n  }\r\n\r\n  @HostListener('filterPermissionsChanged')\r\n  loadContexts() {\r\n    const permissions = ['none'];\r\n    for (const p of this.component.permissions) {\r\n      if (p.checked === true || p.indeterminate === true) {\r\n        permissions.push(p.name);\r\n      }\r\n    }\r\n    this.component.showHidden\r\n      ? this.contextService.loadContexts(permissions, true)\r\n      : this.contextService.loadContexts(permissions, false);\r\n  }\r\n\r\n  @HostListener('showHiddenContexts')\r\n  showHiddenContexts() {\r\n    this.component.showHidden = !this.component.showHidden;\r\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\r\n    this.loadContexts();\r\n  }\r\n\r\n  @HostListener('show', ['$event'])\r\n  onShowContext(context: DetailedContext) {\r\n    this.contextService.showContext(context.id).subscribe();\r\n  }\r\n\r\n  @HostListener('hide', ['$event'])\r\n  onHideContext(context: DetailedContext) {\r\n    this.contextService.hideContext(context.id).subscribe();\r\n  }\r\n\r\n  constructor(\r\n    @Self() component: ContextListComponent,\r\n    private contextService: ContextService,\r\n    private mapService: MapService,\r\n    private languageService: LanguageService,\r\n    private confirmDialogService: ConfirmDialogService,\r\n    private messageService: MessageService,\r\n    private auth: AuthService,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input contexts\r\n    this.component.contexts = { ours: [] };\r\n    this.component.showHidden = this.storageService.get(\r\n      'contexts.showHidden'\r\n    ) as boolean;\r\n\r\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\r\n      this.handleContextsChange(contexts)\r\n    );\r\n\r\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\r\n      (id) => {\r\n        this.component.defaultContextId = id;\r\n      }\r\n    );\r\n\r\n    // See feature-list.component for an explanation about the debounce time\r\n    this.selectedContext$$ = this.contextService.context$\r\n      .pipe(debounceTime(100))\r\n      .subscribe((context) => (this.component.selectedContext = context));\r\n\r\n    this.auth.authenticate$.subscribe((authenticate) => {\r\n      if (authenticate) {\r\n        this.contextService.getProfilByUser().subscribe((profils) => {\r\n          this.component.users = profils;\r\n          this.component.permissions = [];\r\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\r\n            acc = acc.concat(cur);\r\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\r\n            return acc;\r\n          }, []);\r\n\r\n          for (const user of profilsAcc) {\r\n            const permission: ContextUserPermission = {\r\n              name: user.name,\r\n              checked: this.storageService.get(\r\n                'contexts.permissions.' + user.name\r\n              ) as boolean\r\n            };\r\n            if (permission.checked === null) {\r\n              permission.checked = true;\r\n            }\r\n            this.component.permissions.push(permission);\r\n          }\r\n\r\n          const permissions = ['none'];\r\n          for (const p of this.component.permissions) {\r\n            if (p.checked === true || p.indeterminate === true) {\r\n              permissions.push(p.name);\r\n            }\r\n          }\r\n\r\n          this.component.showHidden\r\n            ? this.contextService.loadContexts(permissions, true)\r\n            : this.contextService.loadContexts(permissions, false);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.contexts$$.unsubscribe();\r\n    this.selectedContext$$.unsubscribe();\r\n    this.defaultContextId$$.unsubscribe();\r\n  }\r\n\r\n  private handleContextsChange(contexts: ContextsList) {\r\n    this.component.contexts = contexts;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, EMPTY } from 'rxjs';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { Poi } from './poi.interface';\r\n\r\n@Injectable()\r\nexport class PoiService {\r\n  private baseUrl: string;\r\n\r\n  constructor(private http: HttpClient, private config: ConfigService) {\r\n    this.baseUrl = this.config.getConfig('context.url');\r\n  }\r\n\r\n  get(): Observable<Poi[]> {\r\n    if (!this.baseUrl) {\r\n      return EMPTY;\r\n    }\r\n\r\n    const url = this.baseUrl + '/pois';\r\n    return this.http.get<Poi[]>(url);\r\n  }\r\n\r\n  delete(id: string): Observable<void> {\r\n    const url = this.baseUrl + '/pois/' + id;\r\n    return this.http.delete<void>(url);\r\n  }\r\n\r\n  create(context: Poi): Observable<Poi> {\r\n    const url = this.baseUrl + '/pois';\r\n    return this.http.post<Poi>(url, context);\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoConfirmDialogModule, IgoStopPropagationModule } from '@igo2/common';\r\nimport { IgoAuthModule } from '@igo2/auth';\r\n\r\nimport { BookmarkButtonComponent } from './bookmark-button/bookmark-button.component';\r\nimport { BookmarkDialogComponent } from './bookmark-button/bookmark-dialog.component';\r\nimport { PoiButtonComponent } from './poi-button/poi-button.component';\r\nimport { PoiDialogComponent } from './poi-button/poi-dialog.component';\r\nimport { PoiService } from './poi-button/shared/poi.service';\r\nimport { UserDialogComponent } from './user-button/user-dialog.component';\r\nimport { UserButtonComponent } from './user-button/user-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoLanguageModule,\r\n    IgoConfirmDialogModule,\r\n    IgoStopPropagationModule,\r\n    IgoAuthModule,\r\n    FormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatTooltipModule,\r\n    MatFormFieldModule,\r\n    MatDialogModule,\r\n    MatInputModule\r\n  ],\r\n  exports: [BookmarkButtonComponent, PoiButtonComponent, UserButtonComponent, BookmarkDialogComponent],\r\n  declarations: [\r\n    BookmarkButtonComponent,\r\n    BookmarkDialogComponent,\r\n    PoiButtonComponent,\r\n    PoiDialogComponent,\r\n    UserButtonComponent,\r\n    UserDialogComponent\r\n  ],\r\n  providers: [PoiService]\r\n})\r\nexport class IgoContextMapButtonModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextMapButtonModule> {\r\n    return {\r\n      ngModule: IgoContextMapButtonModule\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoAuthModule } from '@igo2/auth';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoListModule,\r\n  IgoKeyValueModule,\r\n  IgoCollapsibleModule,\r\n  IgoStopPropagationModule,\r\n  IgoActionbarModule\r\n} from '@igo2/common';\r\n\r\nimport { MapContextDirective } from './shared/map-context.directive';\r\nimport { LayerContextDirective } from './shared/layer-context.directive';\r\nimport { ContextListComponent } from './context-list/context-list.component';\r\nimport { ContextListBindingDirective } from './context-list/context-list-binding.directive';\r\nimport { ContextItemComponent } from './context-item/context-item.component';\r\nimport { ContextFormComponent } from './context-form/context-form.component';\r\nimport { ContextEditComponent } from './context-edit/context-edit.component';\r\nimport { ContextEditBindingDirective } from './context-edit/context-edit-binding.directive';\r\nimport { ContextPermissionsComponent } from './context-permissions/context-permissions.component';\r\nimport { ContextPermissionsBindingDirective } from './context-permissions/context-permissions-binding.directive';\r\nimport { IgoContextMapButtonModule } from '../context-map-button/context-map-button.module';\r\nimport { IgoContextImportExportModule } from '../context-import-export/context-import-export.module';\r\n\r\nconst CONTEXT_DIRECTIVES = [\r\n  MapContextDirective,\r\n  LayerContextDirective\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    MatListModule,\r\n    MatCheckboxModule,\r\n    MatRadioModule,\r\n    MatDialogModule,\r\n    MatMenuModule,\r\n    MatOptionModule,\r\n    MatAutocompleteModule,\r\n    IgoAuthModule,\r\n    IgoListModule,\r\n    IgoKeyValueModule,\r\n    IgoCollapsibleModule,\r\n    IgoStopPropagationModule,\r\n    IgoLanguageModule,\r\n    IgoContextImportExportModule,\r\n    IgoContextMapButtonModule,\r\n    IgoActionbarModule\r\n  ],\r\n  exports: [\r\n    ContextListComponent,\r\n    ContextListBindingDirective,\r\n    ContextItemComponent,\r\n    ContextFormComponent,\r\n    ContextEditComponent,\r\n    ContextEditBindingDirective,\r\n    ContextPermissionsComponent,\r\n    ContextPermissionsBindingDirective,\r\n\r\n    ...CONTEXT_DIRECTIVES\r\n  ],\r\n  declarations: [\r\n    ContextListComponent,\r\n    ContextListBindingDirective,\r\n    ContextItemComponent,\r\n    ContextFormComponent,\r\n    ContextEditComponent,\r\n    ContextEditBindingDirective,\r\n    ContextPermissionsComponent,\r\n    ContextPermissionsBindingDirective,\r\n\r\n    ...CONTEXT_DIRECTIVES\r\n  ]\r\n})\r\nexport class IgoContextManagerModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextManagerModule> {\r\n    return {\r\n      ngModule: IgoContextManagerModule\r\n    };\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { ExportOptions } from '@igo2/geo';\r\n\r\nexport enum ImportExportType {\r\n  layer = 'layer',\r\n  context = 'context'\r\n}\r\n\r\nexport enum ImportExportMode {\r\n  import = 'import',\r\n  export = 'export'\r\n}\r\n\r\n/**\r\n * Service that holds the state of the importExport module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ImportExportState {\r\n\r\n  readonly importExportType$: BehaviorSubject<ImportExportType> = new BehaviorSubject(ImportExportType.layer);\r\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> = new BehaviorSubject(ImportExportMode.import);\r\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(undefined);\r\n\r\n  setImportExportType(type: ImportExportType) {\r\n    this.importExportType$.next(type);\r\n  }\r\n\r\n  setMode(mode: ImportExportMode) {\r\n    this.selectedMode$.next(mode);\r\n  }\r\n\r\n  setsExportOptions(exportOptions: ExportOptions) {\r\n      this.exportOptions$.next(exportOptions);\r\n    }\r\n\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { Toolbox, ToolService } from '@igo2/common';\r\n\r\nimport { ExportOptions } from '@igo2/geo';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { ImportExportMode, ImportExportState } from '../import-export/import-export.state';\r\n\r\n/**\r\n * Service that holds the state of the search module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ToolState {\r\n  get toolbox(): Toolbox {\r\n    return this.toolService.toolbox;\r\n  }\r\n\r\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\r\n\r\n  constructor(\r\n    private toolService: ToolService,\r\n    private importExportState: ImportExportState\r\n    ) {}\r\n\r\n    toolToActivateFromOptions(toolToActivate: { tool: string; options: {[key: string]: any} }) {\r\n    if (!toolToActivate) { return; }\r\n    if (toolToActivate.tool === 'importExport') {\r\n      let exportOptions: ExportOptions = this.importExportState.exportOptions$.value;\r\n      if (!exportOptions) {\r\n        exportOptions = {\r\n          layers: toolToActivate.options.layers,\r\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\r\n        };\r\n      } else {\r\n        exportOptions.layers = toolToActivate.options.layers;\r\n        exportOptions.featureInMapExtent = toolToActivate.options.featureInMapExtent;\r\n      }\r\n      this.importExportState.setsExportOptions(exportOptions);\r\n      this.importExportState.setMode(ImportExportMode.export);\r\n    }\r\n\r\n    if (this.toolbox.getTool(toolToActivate.tool)) {\r\n      this.toolbox.activateTool(toolToActivate.tool);\r\n      this.openSidenav$.next(true);\r\n    }\r\n  }\r\n}\r\n","import {\r\n    FeatureMotion,\r\n    FeatureStoreSelectionStrategy,\r\n    FeatureWorkspace,\r\n    WfsWorkspace\r\n} from '@igo2/geo';\r\n\r\n\r\nexport function  handleZoomAuto(workspace: FeatureWorkspace | WfsWorkspace, storageService) {\r\n    const zoomStrategy = workspace.entityStore\r\n        .getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\r\n    zoomStrategy.setMotion(storageService.get('zoomAuto') as boolean ? FeatureMotion.Default : FeatureMotion.None);\r\n}\r\n\r\n\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { StorageService } from '@igo2/core';\r\n\r\n/**\r\n * Service that holds the state of storage service\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StorageState {\r\n  get storageService(): StorageService {\r\n    return this.igoStorageService;\r\n  }\r\n\r\n  constructor(private igoStorageService: StorageService) {}\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport {\r\n  Action,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreFilterSelectionStrategy\r\n} from '@igo2/common';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport {\r\n  FeatureWorkspace,\r\n  mapExtentStrategyActiveToolTip,\r\n  noElementSelected,\r\n  ExportOptions\r\n} from '@igo2/geo';\r\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\r\nimport { StorageState } from '../../storage/storage.state';\r\nimport { map, skipWhile } from 'rxjs/operators';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { handleZoomAuto } from './workspace.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FeatureActionsService implements OnDestroy {\r\n\r\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    this.storageService.get('workspaceMaximize') as boolean\r\n  );\r\n\r\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private storageChange$$: Subscription;\r\n\r\n  get storageService(): StorageService {\r\n    return this.storageState.storageService;\r\n  }\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    private storageState: StorageState,\r\n    public languageService: LanguageService,\r\n    private toolState: ToolState,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.storageChange$$) {\r\n      this.storageChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  loadActions(\r\n    workspace: FeatureWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n    ) {\r\n    const actions = this.buildActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$\r\n      );\r\n    workspace.actionStore.load(actions);\r\n  }\r\n\r\n  buildActions(\r\n    workspace: FeatureWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n    ): Action[] {\r\n    this.zoomAuto$.next(this.zoomAuto);\r\n    this.storageChange$$ = this.storageService.storageChange$\r\n      .pipe(\r\n        skipWhile(\r\n          (storageChange: StorageServiceEvent) =>\r\n            storageChange.key !== 'zoomAuto' || storageChange.event === StorageServiceEventEnum.CLEARED\r\n        )\r\n      )\r\n      .subscribe(() => {\r\n        this.zoomAuto$.next(this.zoomAuto);\r\n        handleZoomAuto(workspace, this.storageService);\r\n      });\r\n    return [\r\n      {\r\n        id: 'zoomAuto',\r\n        checkbox: true,\r\n        title: 'igo.integration.workspace.zoomAuto.title',\r\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\r\n        checkCondition: this.zoomAuto$,\r\n        handler: () => {\r\n          handleZoomAuto(workspace, this.storageService);\r\n          this.storageService.set(\r\n            'zoomAuto',\r\n            !this.storageService.get('zoomAuto') as boolean\r\n          );\r\n        }\r\n      },\r\n      {\r\n        id: 'filterInMapExtent',\r\n        checkbox: true,\r\n        title: 'igo.integration.workspace.inMapExtent.title',\r\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\r\n        checkCondition: rowsInMapExtentCheckCondition$,\r\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\r\n      },\r\n      {\r\n        id: 'selectedOnly',\r\n        checkbox: true,\r\n        title: 'igo.integration.workspace.selected.title',\r\n        tooltip: 'igo.integration.workspace.selected.tooltip',\r\n        checkCondition: selectOnlyCheckCondition$,\r\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\r\n      },\r\n      {\r\n        id: 'clearselection',\r\n        icon: 'select-off',\r\n        title: 'igo.integration.workspace.clearSelection.title',\r\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\r\n        handler: (ws: FeatureWorkspace) => {\r\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\r\n            selected: false\r\n          });\r\n        },\r\n        args: [workspace],\r\n        availability: (ws: FeatureWorkspace) => noElementSelected(ws)\r\n      },\r\n      {\r\n        id: 'featureDownload',\r\n        icon: 'file-export',\r\n        title: 'igo.integration.workspace.download.title',\r\n        tooltip: 'igo.integration.workspace.download.tooltip',\r\n        handler: (ws: FeatureWorkspace) => {\r\n          const filterStrategy = ws.entityStore.getStrategyOfType(\r\n            EntityStoreFilterCustomFuncStrategy\r\n          );\r\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\r\n            EntityStoreFilterSelectionStrategy\r\n          );\r\n          const layersWithSelection = filterSelectionStrategy.active\r\n            ? [ws.layer.id]\r\n            : [];\r\n          this.toolState.toolToActivateFromOptions({\r\n            tool: 'importExport',\r\n            options: {\r\n              layers: [ws.layer.id],\r\n              featureInMapExtent: filterStrategy.active,\r\n              layersWithSelection\r\n            } as ExportOptions\r\n          });\r\n        },\r\n        args: [workspace]\r\n      },\r\n      {\r\n        id: 'maximize',\r\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.integration.workspace.maximizeTooltip'\r\n        ),\r\n        icon: 'resize',\r\n        display: () => {\r\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\r\n        },\r\n        handler: () => {\r\n          if (!this.mediaService.isMobile()) {\r\n            this.maximize$.next(true);\r\n          }\r\n        },\r\n      },\r\n      {\r\n        id: 'standardExtent',\r\n        title: this.languageService.translate.instant(\r\n          'igo.integration.workspace.standardExtent'\r\n        ),\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.integration.workspace.standardExtentTooltip'\r\n        ),\r\n        icon: 'resize',\r\n        display: () => {\r\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\r\n        },\r\n        handler: () => {\r\n          this.maximize$.next(false);\r\n        }\r\n      }\r\n    ];\r\n  }\r\n}\r\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport {\r\n  Action,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreFilterSelectionStrategy,\r\n  Widget\r\n} from '@igo2/common';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport {\r\n  WfsWorkspace,\r\n  mapExtentStrategyActiveToolTip,\r\n  noElementSelected,\r\n  ExportOptions,\r\n  OgcFilterWidget,\r\n  OgcFilterableDataSource,\r\n} from '@igo2/geo';\r\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\r\nimport { StorageState } from '../../storage/storage.state';\r\nimport { map, skipWhile } from 'rxjs/operators';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { handleZoomAuto } from './workspace.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WfsActionsService implements OnDestroy  {\r\n\r\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    this.storageService.get('workspaceMaximize') as boolean\r\n  );\r\n\r\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private storageChange$$: Subscription;\r\n\r\n  get storageService(): StorageService {\r\n    return this.storageState.storageService;\r\n  }\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\r\n    private storageState: StorageState,\r\n    public languageService: LanguageService,\r\n    private mediaService: MediaService,\r\n    private toolState: ToolState) {}\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.storageChange$$) {\r\n      this.storageChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  loadActions(\r\n    workspace: WfsWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n    ) {\r\n    const actions = this.buildActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$\r\n      );\r\n    workspace.actionStore.load(actions);\r\n  }\r\n\r\n  buildActions(\r\n    workspace: WfsWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n    ): Action[] {\r\n    this.zoomAuto$.next(this.zoomAuto);\r\n    this.storageChange$$ = this.storageService.storageChange$\r\n      .pipe(skipWhile((storageChange: StorageServiceEvent) =>\r\n        storageChange.key !== 'zoomAuto' || storageChange.event === StorageServiceEventEnum.CLEARED))\r\n      .subscribe(() => {\r\n        this.zoomAuto$.next(this.zoomAuto);\r\n        handleZoomAuto(workspace, this.storageService);\r\n      });\r\n    const actions = [\r\n      {\r\n        id: 'zoomAuto',\r\n        checkbox: true,\r\n        title: 'igo.integration.workspace.zoomAuto.title',\r\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\r\n        checkCondition: this.zoomAuto$,\r\n        handler: () => {\r\n          handleZoomAuto(workspace, this.storageService);\r\n          this.storageService.set('zoomAuto', !this.storageService.get('zoomAuto') as boolean);\r\n        }\r\n      },\r\n      {\r\n        id: 'filterInMapExtent',\r\n        checkbox: true,\r\n        title: 'igo.integration.workspace.inMapExtent.title',\r\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\r\n        checkCondition: rowsInMapExtentCheckCondition$,\r\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\r\n      },\r\n      {\r\n        id: 'selectedOnly',\r\n        checkbox: true,\r\n        title: 'igo.integration.workspace.selected.title',\r\n        tooltip: 'igo.integration.workspace.selected.title',\r\n        checkCondition: selectOnlyCheckCondition$,\r\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\r\n      },\r\n      {\r\n        id: 'clearselection',\r\n        icon: 'select-off',\r\n        title: 'igo.integration.workspace.clearSelection.title',\r\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\r\n        handler: (ws: WfsWorkspace) => {\r\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), { selected: false });\r\n        },\r\n        args: [workspace],\r\n        availability: (ws: WfsWorkspace) => noElementSelected(ws)\r\n      },\r\n      {\r\n        id: 'wfsDownload',\r\n        icon: 'file-export',\r\n        title: 'igo.integration.workspace.download.title',\r\n        tooltip: 'igo.integration.workspace.download.tooltip',\r\n        handler: (ws: WfsWorkspace) => {\r\n          const filterStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\r\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\r\n          const layersWithSelection = filterSelectionStrategy.active ? [ws.layer.id] : [];\r\n          this.toolState.toolToActivateFromOptions({\r\n            tool: 'importExport',\r\n            options: { layers: [ws.layer.id], featureInMapExtent: filterStrategy.active, layersWithSelection } as ExportOptions\r\n          });\r\n        },\r\n        args: [workspace]\r\n      },\r\n      {\r\n        id: 'ogcFilter',\r\n        icon: 'filter',\r\n        title: 'igo.integration.workspace.ogcFilter.title',\r\n        tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\r\n        handler: (widget: Widget, ws: WfsWorkspace) => {\r\n          ws.activateWidget(widget, {\r\n            map: ws.map,\r\n            layer: ws.layer\r\n          });\r\n        },\r\n        args: [this.ogcFilterWidget, workspace]\r\n      },\r\n      {\r\n        id: 'maximize',\r\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.integration.workspace.maximizeTooltip'\r\n        ),\r\n        icon: 'resize',\r\n        display: () => {\r\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\r\n        },\r\n        handler: () => {\r\n          if (!this.mediaService.isMobile()) {\r\n            this.maximize$.next(true);\r\n          }\r\n        },\r\n      },\r\n      {\r\n        id: 'standardExtent',\r\n        title: this.languageService.translate.instant(\r\n          'igo.integration.workspace.standardExtent'\r\n        ),\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.integration.workspace.standardExtentTooltip'\r\n        ),\r\n        icon: 'resize',\r\n        display: () => {\r\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\r\n        },\r\n        handler: () => {\r\n          this.maximize$.next(false);\r\n        }\r\n      }\r\n    ];\r\n    return (workspace.layer.dataSource as OgcFilterableDataSource).ogcFilters$?.value?.enabled ?\r\n    actions : actions.filter(action => action.id !== 'ogcFilter');\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { EntityRecord, Workspace, WorkspaceStore, Widget, EntityStoreFilterCustomFuncStrategy, EntityStoreFilterSelectionStrategy } from '@igo2/common';\r\nimport { WfsWorkspace, FeatureWorkspace } from '@igo2/geo';\r\nimport { FeatureActionsService } from './shared/feature-actions.service';\r\nimport { WfsActionsService } from './shared/wfs-actions.service';\r\nimport { StorageService } from '@igo2/core';\r\n\r\n/**\r\n * Service that holds the state of the workspace module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WorkspaceState implements OnDestroy {\r\n\r\n  public workspacePanelExpanded: boolean = false;\r\n\r\n  readonly workspaceEnabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\r\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\r\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\r\n\r\n  readonly workspaceMaximize$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    this.storageService.get('workspaceMaximize') as boolean\r\n  );\r\n  private actionMaximize$$: Subscription[] = [];\r\n\r\n  private rowsInMapExtentCheckCondition$$: Subscription;\r\n  private selectOnlyCheckCondition$$: Subscription;\r\n\r\n  /** Subscription to the active workspace */\r\n  private activeWorkspace$$: Subscription;\r\n\r\n  /** Subscription to the active workspace widget */\r\n  private activeWorkspaceWidget$$: Subscription;\r\n\r\n  /** Active widget observable. Only one may be active for all available workspaces */\r\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> = new BehaviorSubject<Widget>(undefined);\r\n\r\n  /**\r\n   * Observable of the active workspace\r\n   */\r\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\r\n\r\n  /**\r\n   * Store that holds all the available workspaces\r\n   */\r\n  get store(): WorkspaceStore { return this._store; }\r\n  private _store: WorkspaceStore;\r\n\r\n  constructor(\r\n    private featureActionsService: FeatureActionsService,\r\n    private wfsActionsService: WfsActionsService,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.initWorkspaces();\r\n  }\r\n\r\n  /**\r\n   * Initialize the workspace store. Each time a workspace is activated,\r\n   * subscribe to it's active widget. Tracking the active widget is useful\r\n   * to make sure only one widget is active at a time.\r\n   */\r\n  private initWorkspaces() {\r\n    this._store = new WorkspaceStore([]);\r\n    this._store.stateView\r\n      .firstBy$((record: EntityRecord<Workspace>) => record.state.active === true)\r\n      .subscribe((record: EntityRecord<Workspace>) => {\r\n        const workspace = record ? record.entity : undefined;\r\n        this.workspace$.next(workspace);\r\n      });\r\n\r\n    this._store.stateView.all$()\r\n    .subscribe((workspaces: EntityRecord<Workspace>[]) => {\r\n      workspaces.map((wks: EntityRecord<Workspace>) => {\r\n        if (wks.entity.actionStore.empty) {\r\n          if (wks.entity instanceof WfsWorkspace) {\r\n            this.wfsActionsService.loadActions(\r\n              wks.entity,\r\n              this.rowsInMapExtentCheckCondition$,\r\n              this.selectOnlyCheckCondition$);\r\n          } else if (wks.entity instanceof FeatureWorkspace) {\r\n            this.featureActionsService.loadActions(\r\n              wks.entity,\r\n              this.rowsInMapExtentCheckCondition$,\r\n              this.selectOnlyCheckCondition$);\r\n          }\r\n        }\r\n\r\n      });\r\n    });\r\n\r\n    this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(maximized => {\r\n      this.setWorkspaceIsMaximized(maximized);\r\n    }));\r\n\r\n    this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(maximized => {\r\n      this.setWorkspaceIsMaximized(maximized);\r\n    }));\r\n\r\n    this.activeWorkspace$$ = this.workspace$\r\n      .subscribe((workspace: Workspace) => {\r\n        if (this.activeWorkspaceWidget$$ !== undefined) {\r\n          this.activeWorkspaceWidget$$.unsubscribe();\r\n          this.activeWorkspaceWidget$$ = undefined;\r\n        }\r\n\r\n        if (workspace !== undefined) {\r\n          this.activeWorkspaceWidget$$ = workspace.widget$\r\n            .subscribe((widget: Widget) => this.activeWorkspaceWidget$.next(widget));\r\n        }\r\n      });\r\n\r\n    this.rowsInMapExtentCheckCondition$$ = this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\r\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\r\n        if (!wks.entity.actionStore.empty) {\r\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\r\n          if (filterStrategy) {\r\n            if (rowsInMapExtent) {\r\n              filterStrategy.activate();\r\n            } else {\r\n              filterStrategy.deactivate();\r\n            }\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe((selectOnly) => {\r\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\r\n        if (!wks.entity.actionStore.empty) {\r\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\r\n          if (filterStrategy) {\r\n            if (selectOnly) {\r\n              filterStrategy.activate();\r\n            } else {\r\n              filterStrategy.deactivate();\r\n            }\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private setWorkspaceIsMaximized(maximized: boolean) {\r\n    this.storageService.set('workspaceMaximize', maximized);\r\n    this.workspaceMaximize$.next(maximized);\r\n  }\r\n\r\n  public setActiveWorkspaceById(id: string) {\r\n    const wksFromId = this.store\r\n    .all()\r\n    .find(workspace  => workspace.id === id);\r\n    if (wksFromId) {\r\n      this.store.activateWorkspace(wksFromId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Teardown all the workspaces\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.teardownWorkspaces();\r\n    this.actionMaximize$$.map(a => a.unsubscribe());\r\n    if (this.rowsInMapExtentCheckCondition$$) {\r\n      this.selectOnlyCheckCondition$$.unsubscribe();\r\n    }\r\n    if (this.selectOnlyCheckCondition$$) {\r\n      this.selectOnlyCheckCondition$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Teardown the workspace store and any subscribers\r\n   */\r\n  private teardownWorkspaces() {\r\n    this.store.clear();\r\n    if (this.activeWorkspaceWidget$$ !== undefined) {\r\n      this.activeWorkspaceWidget$$.unsubscribe();\r\n    }\r\n    if (this.activeWorkspace$$ !== undefined) {\r\n      this.activeWorkspace$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { EntityRecord, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreStrategyFuncOptions } from '@igo2/common';\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\nimport { SearchResult, SearchSourceService, SearchSource, CommonVectorStyleOptions } from '@igo2/geo';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\n/**\r\n * Service that holds the state of the search module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SearchState {\r\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\r\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\r\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\r\n\r\n  public focusedOrResolution$$: Subscription;\r\n  public selectedOrResolution$$: Subscription;\r\n\r\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject('|');\r\n\r\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  readonly searchSettingsChange$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\r\n\r\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Store that holds the search results\r\n   */\r\n  readonly store: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\r\n\r\n  /**\r\n   * Search types currently enabled in the search source service\r\n   */\r\n  get searchTypes(): string[] {\r\n    return this.searchSourceService\r\n      .getEnabledSources()\r\n      .map((source: SearchSource) => (source.constructor as any).type);\r\n  }\r\n\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private storageService: StorageService,\r\n    private configService: ConfigService) {\r\n    const searchOverlayStyle = this.configService.getConfig('searchOverlayStyle') as {\r\n      base?: CommonVectorStyleOptions,\r\n      selection?: CommonVectorStyleOptions,\r\n      focus?: CommonVectorStyleOptions\r\n    };\r\n    if (searchOverlayStyle) {\r\n      this.searchOverlayStyle = searchOverlayStyle.base;\r\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\r\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\r\n    }\r\n\r\n    const searchResultsGeometryEnabled = this.storageService.get('searchResultsGeometryEnabled') as boolean;\r\n    if (searchResultsGeometryEnabled) {\r\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\r\n    }\r\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\r\n  }\r\n\r\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\r\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\r\n      return record.entity.meta.score === 100;\r\n    };\r\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\r\n  }\r\n\r\n  /**\r\n   * Activate custom strategy\r\n   *\r\n   */\r\n  activateCustomFilterTermStrategy() {\r\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\r\n    if (strategy !== undefined) {\r\n      strategy.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate custom strategy\r\n   *\r\n   */\r\n  deactivateCustomFilterTermStrategy() {\r\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\r\n    if (strategy !== undefined) {\r\n      strategy.deactivate();\r\n    }\r\n  }\r\n\r\n  enableSearch() {\r\n    this.searchDisabled$.next(false);\r\n  }\r\n\r\n  disableSearch() {\r\n    this.searchDisabled$.next(true);\r\n  }\r\n\r\n  setSearchTerm(searchTerm: string) {\r\n    this.searchTerm$.next(searchTerm);\r\n  }\r\n\r\n  setSearchType(searchType: string) {\r\n    this.searchSourceService.enableSourcesByType(searchType);\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  setSearchSettingsChange() {\r\n    this.searchSettingsChange$.next(true);\r\n  }\r\n\r\n  setSelectedResult(result: SearchResult) {\r\n    this.selectedResult$.next(result);\r\n  }\r\n\r\n  setSearchResultsGeometryStatus(value) {\r\n    this.storageService.set('searchResultsGeometryEnabled', value);\r\n    this.searchResultsGeometryEnabled$.next(value);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoSearchModule } from '@igo2/geo';\r\n\r\nimport { SearchBarBindingDirective } from './search-bar-binding.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [IgoSearchModule],\r\n  declarations: [SearchBarBindingDirective],\r\n  exports: [SearchBarBindingDirective],\r\n})\r\nexport class IgoAppSearchBarModule {}\r\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoFlexibleModule, IgoCustomHtmlModule, IgoPanelModule } from '@igo2/common';\r\nimport {\r\n  IgoFeatureModule,\r\n  IgoSearchModule,\r\n  IgoFeatureDetailsModule\r\n} from '@igo2/geo';\r\n\r\nimport { SearchResultsToolComponent } from './search-results-tool.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatBadgeModule,\r\n    MatTooltipModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule,\r\n    IgoFeatureModule,\r\n    IgoSearchModule,\r\n    IgoFlexibleModule,\r\n    IgoPanelModule,\r\n    IgoFeatureDetailsModule,\r\n    IgoCustomHtmlModule\r\n  ],\r\n  declarations: [SearchResultsToolComponent],\r\n  exports: [SearchResultsToolComponent],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class IgoAppSearchResultsToolModule {}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoAppSearchBarModule } from './search-bar/search-bar.module';\r\nimport { IgoAppSearchResultsToolModule } from './search-results-tool/search-results-tool.module';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: [\r\n   IgoAppSearchBarModule,\r\n   IgoAppSearchResultsToolModule\r\n  ],\r\n})\r\nexport class IgoAppSearchModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Search</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: ConfigService, LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/search\">code of this example</a><br>\r\n    See search section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\r\n    <hr>\r\n    <br>\r\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\r\n      F2 activate/deactivate the pointer location.\r\n    </span>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser #mapBrowser [map]=\"map\" [view]=\"view\" igoOverlay [igoContextMenu]=actionbarMenu\r\n\r\n    igoSearchPointerSummary\r\n    [igoSearchPointerSummaryDelay]=\"500\"\r\n    [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\r\n    (menuPosition)=\"onContextMenuOpen($event)\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-panel title=\"Search\">\r\n    <igo-search-bar\r\n      (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\r\n      [searchSettings]=\"true\"\r\n      [store]=\"searchStore\"\r\n      [termSplitter]=\"termSplitter\"\r\n      (searchTermChange)=\"onSearchTermChange($event)\"\r\n      (search)=\"onSearch($event)\"\r\n      (clearFeature)=\"removeFeatureFromMap()\"\r\n      (searchSettingsChange)=\"onSearchSettingsChange()\">\r\n    </igo-search-bar>\r\n\r\n    <igo-search-results\r\n      [store]=\"searchStore\"\r\n      [term]=\"term\"\r\n      [termSplitter]=\"termSplitter\"\r\n      placeholder=\"false\"\r\n      [settingsChange$]=\"settingsChange$\"\r\n      (resultFocus)=\"onResultFocus($event)\"\r\n      (resultSelect)=\"onResultFocus($event)\"\r\n      (moreResults)=\"onSearch($event)\">\r\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\r\n          <igo-search-add-button\r\n            [map]=\"map\"\r\n            [layer]=\"result\">\r\n          </igo-search-add-button>\r\n        </ng-template>\r\n    </igo-search-results>\r\n\r\n  </igo-panel>\r\n\r\n  <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\r\n    <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\r\n  </igo-panel>\r\n\r\n</mat-card>\r\n\r\n<ng-template #actionbarMenu>\r\n  <igo-actionbar\r\n    [store]=\"store\"\r\n    [withIcon]=\"false\"\r\n    [horizontal]=\"true\"\r\n    [mode]=\"'context'\">\r\n  </igo-actionbar>\r\n</ng-template>\r\n\r\n<igo-message-center></igo-message-center>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppSearchComponent } from './search.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'search',\r\n    component: AppSearchComponent\r\n  }\r\n];\r\n\r\nexport const AppSearchRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { BehaviorSubject } from 'rxjs';\r\nimport {\r\n  Component,\r\n  ElementRef,\r\n  OnDestroy,\r\n  OnInit,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport * as proj from 'ol/proj';\r\n\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\nimport { EntityStore, ActionStore } from '@igo2/common';\r\nimport {\r\n  FEATURE,\r\n  Feature,\r\n  FeatureMotion,\r\n  GoogleLinks,\r\n  IgoMap,\r\n  LayerService,\r\n  MapService,\r\n  Layer,\r\n  ProjectionService,\r\n  Research,\r\n  SearchResult,\r\n  SearchService\r\n} from '@igo2/geo';\r\n\r\nimport { SearchState } from '@igo2/integration';\r\n\r\n@Component({\r\n  selector: 'app-search',\r\n  templateUrl: './search.component.html',\r\n  styleUrls: ['./search.component.scss']\r\n})\r\nexport class AppSearchComponent implements OnInit, OnDestroy {\r\n  public store = new ActionStore([]);\r\n\r\n  public igoSearchPointerSummaryEnabled: boolean = false;\r\n\r\n  public termSplitter: string = '|';\r\n\r\n  public map = new IgoMap({\r\n    overlay: true,\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  public osmLayer: Layer;\r\n\r\n  @ViewChild('mapBrowser', { read: ElementRef, static: true }) mapBrowser: ElementRef;\r\n\r\n  public lonlat;\r\n  public mapProjection: string;\r\n  public term: string;\r\n\r\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  get searchStore(): EntityStore<SearchResult> {\r\n    return this.searchState.store;\r\n  }\r\n\r\n  get isTouchScreen(): boolean {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  public selectedFeature: Feature;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private projectionService: ProjectionService,\r\n    private mapService: MapService,\r\n    private layerService: LayerService,\r\n    private searchState: SearchState,\r\n    private searchService: SearchService,\r\n    private mediaService: MediaService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe(layer => {\r\n        this.osmLayer = layer;\r\n        this.map.addLayer(layer);\r\n      });\r\n  }\r\n\r\n  onPointerSummaryStatusChange(value) {\r\n    this.igoSearchPointerSummaryEnabled = value;\r\n  }\r\n\r\n  onSearchTermChange(term = '') {\r\n    this.term = term;\r\n    const termWithoutHashtag = term.replace(/(#[^\\s]*)/g, '').trim();\r\n    if (termWithoutHashtag.length < 2) {\r\n      this.searchStore.clear();\r\n      this.selectedFeature = undefined;\r\n    }\r\n  }\r\n\r\n  onSearch(event: { research: Research; results: SearchResult[] }) {\r\n    const results = event.results;\r\n    this.searchStore.state.updateAll({ focused: false, selected: false });\r\n    const newResults = this.searchStore.entities$.value\r\n      .filter((result: SearchResult) => result.source !== event.research.source)\r\n      .concat(results);\r\n    this.searchStore.updateMany(newResults);\r\n  }\r\n\r\n  onSearchSettingsChange() {\r\n    this.settingsChange$.next(true);\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map when it's being focused\r\n   * @internal\r\n   * @param result A search result that could be a feature\r\n   */\r\n  onResultFocus(result: SearchResult) {\r\n    this.tryAddFeatureToMap(result);\r\n    this.selectedFeature = (result as SearchResult<Feature>).data;\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map overlay\r\n   * @param layer A search result that could be a feature\r\n   */\r\n  private tryAddFeatureToMap(layer: SearchResult) {\r\n    if (layer.meta.dataType !== FEATURE) {\r\n      return undefined;\r\n    }\r\n\r\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\r\n    if (layer.data.geometry === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.map.searchResultsOverlay.setFeatures(\r\n      [layer.data] as Feature[],\r\n      FeatureMotion.Default\r\n    );\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.store.load([\r\n      {\r\n        id: 'coordinates',\r\n        title: 'coordinates',\r\n        handler: this.onSearchCoordinate.bind(this)\r\n      },\r\n      {\r\n        id: 'googleMaps',\r\n        title: 'googleMap',\r\n        handler: this.onOpenGoogleMaps.bind(this),\r\n        args: ['1']\r\n      },\r\n      {\r\n        id: 'googleStreetView',\r\n        title: 'googleStreetView',\r\n        handler: this.onOpenGoogleStreetView.bind(this)\r\n      }\r\n    ]);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  /*\r\n   * Remove a feature to the map overlay\r\n   */\r\n  removeFeatureFromMap() {\r\n    this.map.searchResultsOverlay.clear();\r\n  }\r\n\r\n  onContextMenuOpen(event: { x: number; y: number }) {\r\n    const position = this.mapPosition(event);\r\n    const coord = this.mapService.getMap().ol.getCoordinateFromPixel(position);\r\n    this.mapProjection = this.mapService.getMap().projection;\r\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\r\n  }\r\n\r\n  mapPosition(event: { x: number; y: number }) {\r\n    const contextmenuPoint = event;\r\n    contextmenuPoint.y =\r\n      contextmenuPoint.y -\r\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\r\n      window.scrollY;\r\n    contextmenuPoint.x =\r\n      contextmenuPoint.x -\r\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\r\n      window.scrollX;\r\n    const position = [contextmenuPoint.x, contextmenuPoint.y];\r\n    return position;\r\n  }\r\n\r\n  onPointerSearch(event) {\r\n    this.lonlat = event;\r\n    this.onSearchCoordinate();\r\n  }\r\n\r\n  onSearchCoordinate() {\r\n    this.searchStore.clear();\r\n    const results = this.searchService.reverseSearch(this.lonlat);\r\n\r\n    for (const i in results) {\r\n      if (results.length > 0) {\r\n        results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\r\n          this.onSearch({ research: results[i], results: _results });\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  onOpenGoogleMaps() {\r\n    window.open(GoogleLinks.getGoogleMapsCoordLink(this.lonlat[0], this.lonlat[1]));\r\n  }\r\n\r\n  onOpenGoogleStreetView() {\r\n    window.open(\r\n      GoogleLinks.getGoogleStreetViewLink(this.lonlat[0], this.lonlat[1])\r\n    );\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\n\r\nimport {\r\n  IgoPanelModule,\r\n  IgoActionbarModule,\r\n  IgoContextMenuModule\r\n} from '@igo2/common';\r\n\r\nimport {\r\n  IgoFeatureModule,\r\n  IgoMapModule,\r\n  IgoSearchModule,\r\n  provideIChercheSearchSource,\r\n  provideILayerSearchSource,\r\n  provideNominatimSearchSource,\r\n  provideIChercheReverseSearchSource,\r\n  provideCoordinatesReverseSearchSource,\r\n  provideCadastreSearchSource,\r\n  provideStoredQueriesSearchSource,\r\n  provideStoredQueriesReverseSearchSource\r\n} from '@igo2/geo';\r\n\r\nimport { IgoAppSearchModule } from '@igo2/integration';\r\n\r\nimport { AppSearchComponent } from './search.component';\r\nimport { AppSearchRoutingModule } from './search-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppSearchComponent],\r\n  imports: [\r\n    CommonModule,\r\n    AppSearchRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    IgoMessageModule.forRoot(),\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoSearchModule.forRoot(),\r\n    IgoAppSearchModule,\r\n    IgoActionbarModule,\r\n    IgoContextMenuModule,\r\n    IgoFeatureModule\r\n  ],\r\n  exports: [AppSearchComponent],\r\n  providers: [\r\n    provideCoordinatesReverseSearchSource(),\r\n    provideCadastreSearchSource(),\r\n    provideIChercheSearchSource(),\r\n    provideILayerSearchSource(),\r\n    provideNominatimSearchSource(),\r\n    provideIChercheReverseSearchSource(),\r\n    provideStoredQueriesSearchSource(),\r\n    provideStoredQueriesReverseSearchSource()\r\n  ]\r\n})\r\nexport class AppSearchModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppPrintComponent } from './print.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'print',\r\n    component: AppPrintComponent\r\n  }\r\n];\r\n\r\nexport const AppPrintRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { IgoMap, LayerService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-print',\r\n  templateUrl: './print.component.html',\r\n  styleUrls: ['./print.component.scss']\r\n})\r\nexport class AppPrintComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: false\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 9\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Quebec Base Map',\r\n        sourceOptions: {\r\n          type: 'wmts',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\r\n          layer: 'carte_gouv_qc_ro',\r\n          matrixSet: 'EPSG_3857',\r\n          version: '1.3.0',\r\n          crossOrigin: 'anonymous',\r\n          attributions: \" <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Qubec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>\"\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'School board',\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n          params: {\r\n            LAYERS: 'MELS_CS_ANGLO_S',\r\n            VERSION: '1.3.0'\r\n          },\r\n          crossOrigin: 'anonymous'\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n    //\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Embacle',\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n          params: {\r\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n            VERSION: '1.3.0'\r\n          },\r\n          crossOrigin: 'anonymous'\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n\r\n    // this.layerService\r\n    //   .createAsyncLayer({\r\n    //     title: 'Geomet',\r\n    //     sourceOptions: {\r\n    //       type: 'wms',\r\n    //       url: 'http://geo.weather.gc.ca/geomet/?lang=fr',\r\n    //       params: {\r\n    //         LAYERS: 'RADAR_1KM_RDBR',\r\n    //         VERSION: '1.3.0'\r\n    //       },\r\n    //       crossOrigin: 'anonymous'\r\n    //     }\r\n    //   })\r\n    //   .subscribe(l => this.map.addLayer(l));\r\n\r\n    /*\r\n        //CORS error if activate (for test)\r\n        this.layerService\r\n          .createAsyncLayer({\r\n            title: 'Geomet',\r\n            sourceOptions: {\r\n              type: 'wms',\r\n              url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wms',\r\n              params: {\r\n                layers: 'swtq',\r\n                version: '1.3.0',\r\n              }\r\n            }\r\n          })\r\n          .subscribe(l => this.map.addLayer(l));\r\n    */\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Print</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/print\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\r\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-print [map]=\"map\"></igo-print>\r\n\r\n</mat-card>\r\n\r\n<igo-message-center></igo-message-center>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\nimport { IgoMapModule, IgoPrintModule } from '@igo2/geo';\r\n\r\nimport { AppPrintComponent } from './print.component';\r\nimport { AppPrintRoutingModule } from './print-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppPrintComponent],\r\n  imports: [\r\n    AppPrintRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoMessageModule,\r\n    IgoMapModule,\r\n    IgoPrintModule\r\n  ],\r\n  exports: [AppPrintComponent]\r\n})\r\nexport class AppPrintModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppImportExportComponent } from './import-export.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'import-export',\r\n    component: AppImportExportComponent\r\n  }\r\n];\r\n\r\nexport const AppImportExportRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { IgoMap, LayerService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-import-export',\r\n  templateUrl: './import-export.component.html',\r\n  styleUrls: ['./import-export.component.scss']\r\n})\r\nexport class AppImportExportComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 9\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Import / Export</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/import-export\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-import-export [map]=\"map\"></igo-import-export>\r\n\r\n</mat-card>\r\n\r\n<igo-message-center></igo-message-center>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\nimport {\r\n  IgoMapModule,\r\n  IgoImportExportModule,\r\n  provideStyleListOptions\r\n} from '@igo2/geo';\r\n\r\nimport { AppImportExportComponent } from './import-export.component';\r\nimport { AppImportExportRoutingModule } from './import-export-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppImportExportComponent],\r\n  imports: [\r\n    AppImportExportRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoMessageModule,\r\n    IgoMapModule,\r\n    IgoImportExportModule\r\n  ],\r\n  exports: [AppImportExportComponent],\r\n  providers: [\r\n    provideStyleListOptions({\r\n      path: './assets/import-style.json'\r\n    })\r\n  ]\r\n})\r\nexport class AppImportExport {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppDirectionsComponent } from './directions.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'directions',\r\n    component: AppDirectionsComponent\r\n  }\r\n];\r\n\r\nexport const AppDirectionsRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  LayerService,\r\n  MapService,\r\n  FeatureStore,\r\n  Feature,\r\n  ProjectionService\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-directions',\r\n  templateUrl: './directions.component.html',\r\n  styleUrls: ['./directions.component.scss']\r\n})\r\nexport class AppDirectionsComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 9,\r\n    geolocate: true\r\n  };\r\n\r\n  public stopsStore = new FeatureStore<Feature>([], { map: this.map });\r\n  public routeStore = new FeatureStore<Feature>([], { map: this.map });\r\n\r\n  constructor(\r\n    private projectionService: ProjectionService,\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService,\r\n    private mapService: MapService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe(l => this.map.addLayer(l));\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Directions</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/directions\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\r\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-directions-form [stopsStore]=\"stopsStore\" [routeStore]=\"routeStore\" [map]=\"map\"></igo-directions-form>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\nimport {\r\n  IgoMapModule,\r\n  IgoDirectionsModule,\r\n  provideOsrmDirectionsSource\r\n} from '@igo2/geo';\r\n\r\nimport { AppDirectionsComponent } from './directions.component';\r\nimport { AppDirectionsRoutingModule } from './directions-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppDirectionsComponent],\r\n  imports: [\r\n    AppDirectionsRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoMessageModule,\r\n    IgoMapModule,\r\n    IgoDirectionsModule\r\n  ],\r\n  exports: [AppDirectionsComponent],\r\n  providers: [provideOsrmDirectionsSource()]\r\n})\r\nexport class AppDirectionsModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppTimeFilterComponent } from './time-filter.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'time-filter',\r\n    component: AppTimeFilterComponent\r\n  }\r\n];\r\n\r\nexport const AppTimeFilterRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  TimeFilterableDataSourceOptions,\r\n  TimeFilterType,\r\n  TimeFilterStyle\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-time-filter',\r\n  templateUrl: './time-filter.component.html',\r\n  styleUrls: ['./time-filter.component.scss']\r\n})\r\nexport class AppTimeFilterComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    // const datasource: TimeFilterableDataSourceOptions = {\r\n    //   type: 'wms',\r\n    //   url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\r\n    //   params: {\r\n    //     layers: 'vg_observation_v_inondation_embacle_wmst',\r\n    //     version: '1.3.0'\r\n    //   },\r\n    //   timeFilterable: true,\r\n    //   timeFilter: {\r\n    //     min: '2017-01-01',\r\n    //     max: '2018-01-01',\r\n    //     range: true,\r\n    //     type: TimeFilterType.DATETIME,\r\n    //     style: TimeFilterStyle.SLIDER,\r\n    //     step: 86400000,\r\n    //     timeInterval: 2000\r\n    //   }\r\n    // };\r\n\r\n    const datasourceYear: TimeFilterableDataSourceOptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n        VERSION: '1.3.0'\r\n      },\r\n      timeFilterable: true,\r\n      timeFilter: {\r\n        min: '2013',\r\n        max: '2019',\r\n        range: false,\r\n        type: TimeFilterType.YEAR,\r\n        style: TimeFilterStyle.SLIDER,\r\n        step: 1,\r\n        timeInterval: 2000\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceYear)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle YEAR',\r\n            visible: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Time filter</mat-card-title>\r\n  <mat-card-content>\r\n    <li>npm install --save moment@2.22.2</li>\r\n    <li>npm install --save @mat-datetimepicker/core@3.0.0-beta.0</li>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/time-filter\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-panel title=\"Layers\">\r\n    <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\r\n  </igo-panel>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\r\n\r\nimport { AppTimeFilterComponent } from './time-filter.component';\r\nimport { AppTimeFilterRoutingModule } from './time-filter-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppTimeFilterComponent],\r\n  imports: [\r\n    AppTimeFilterRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoFilterModule\r\n  ],\r\n  exports: [AppTimeFilterComponent]\r\n})\r\nexport class AppTimeFilterModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppOgcFilterComponent } from './ogc-filter.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'ogc-filter',\r\n    component: AppOgcFilterComponent\r\n  }\r\n];\r\n\r\nexport const AppOgcFilterRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  WMSDataSourceOptions,\r\n  WFSDataSourceOptions,\r\n  WFSDataSourceOptionsParams,\r\n  OgcFilterableDataSourceOptions,\r\n  AnyBaseOgcFilterOptions,\r\n  OgcFilterOperatorType,\r\n  OgcFilterDuringOptions\r\n} from '@igo2/geo';\r\n\r\nimport {Fill, Stroke, Circle, Style} from 'ol/style';\r\n\r\n@Component({\r\n  selector: 'app-ogc-filter',\r\n  templateUrl: './ogc-filter.component.html',\r\n  styleUrls: ['./ogc-filter.component.scss']\r\n})\r\nexport class AppOgcFilterComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const datasource: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        { name: 'code_municipalite', alias: '# de la municipalite' },\r\n        { name: 'date_observation', excludeFromOgcFilters: true },\r\n        { name: 'urgence', values: ['immdiate', 'inconnue'] }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          logical: 'Or',\r\n          filters: [\r\n            {\r\n              operator: 'PropertyIsEqualTo',\r\n              propertyName: 'code_municipalite',\r\n              expression: '10043'\r\n            },\r\n            {\r\n              operator: 'Intersects',\r\n              geometryName: 'the_geom',\r\n              wkt_geometry: `MULTIPOLYGON(((\r\n              -8379441.158019895 5844447.897707146,\r\n              -8379441.158019895 5936172.331649357,\r\n              -8134842.66750733 5936172.331649357,\r\n              -8134842.66750733 5844447.897707146,\r\n              -8379441.158019895 5844447.897707146\r\n            ), (\r\n              -8015003 5942074,\r\n              -8015003 5780349,\r\n              -7792364 5780349,\r\n              -7792364 5942074,\r\n              -8015003 5942074\r\n            )))`\r\n            }\r\n          ] as AnyBaseOgcFilterOptions[]\r\n        }\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasource)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (PropertyIsEqualTo OR Intersects)',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'orange',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilter: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters:\r\n          {\r\n            operator: 'During',\r\n            propertyName: 'date_observation',\r\n            begin: '2016-01-21T00:00:00-05:00',\r\n            end: '2016-01-26T00:00:00-05:00'\r\n          } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2016-02-10T00:00:00-05:00',\r\n      stepDate: 'P2D'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilter)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: P2D)',\r\n            id: '1',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'red',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n\r\n    const datasourceDuringFilterTime: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters:\r\n          {\r\n            operator: 'During',\r\n            propertyName: 'date_observation',\r\n            begin: '2016-01-01T04:00:00-05:00',\r\n            end: '2016-01-12T16:00:00-05:00'\r\n          } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2016-02-14T20:00:00-05:00',\r\n      stepDate: 'PT4H'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTime)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: PT4H)',\r\n            id: '2',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'blue',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeMonth: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters:\r\n          {\r\n            operator: 'During',\r\n            propertyName: 'date_observation',\r\n            begin: '2016-01-01T00:00:00-05:00',\r\n            end: '2016-03-31T00:00:00-05:00',\r\n            displayFormat: 'MMMM'\r\n          } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2018-12-31T00:00:00-05:00',\r\n      stepDate: 'P1M'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: P1M)',\r\n            id: '3',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'yellow',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeYear: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters:\r\n          {\r\n            operator: 'During',\r\n            propertyName: 'date_observation',\r\n            begin: '2014-01-01T00:00:00-05:00',\r\n            end: '2019-12-31T00:00:00-05:00',\r\n            sliderOptions: {\r\n              interval: 2000,\r\n              displayFormat: 'YY'\r\n            },\r\n            displayFormat: 'YYYY'\r\n          } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2014-01-01T00:00:00-05:00',\r\n      maxDate: '2019-12-31T00:00:00-05:00',\r\n      stepDate: 'P1Y'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: P1Y)',\r\n            id: '4',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'green',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeInterval: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters:\r\n          {\r\n            operator: 'During',\r\n            propertyName: 'date_observation',\r\n            begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\r\n            end: 'today', // \"now\" can also be used. Instead of midnight, the current time will be used\r\n          } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2025-12-31T00:00:00-05:00',\r\n      stepDate: 'P1D'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Interval from Now, Step: P1D)',\r\n            id: '5',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'black',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeRestrictedToStep: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters:\r\n          {\r\n            operator: 'During',\r\n            propertyName: 'date_observation',\r\n            begin: '2019-01-01 00:00:00',\r\n            restrictToStep: true\r\n          } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2025-12-31T00:00:00-05:00',\r\n      stepDate: 'P1M'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, RestrictToStep, Step: P1M)',\r\n            id: '6',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'black'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'red',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const wmsOgcFilterOptions: WMSoptions = {\r\n        type: 'wms',\r\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n        optionsFromCapabilities: true,\r\n        params: {\r\n          LAYERS: 'vg_observation_v_inondation23avril2017_wmst',\r\n          VERSION: '1.3.0'\r\n        },\r\n        sourceFields: [\r\n          { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\r\n        ],\r\n        ogcFilters: {\r\n          enabled: true,\r\n          editable: true,\r\n          filters:\r\n          {\r\n            operator: 'During',\r\n            propertyName: 'date_observation'\r\n          } as OgcFilterDuringOptions,\r\n          allowedOperatorsType: OgcFilterOperatorType.Time\r\n        }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wmsOgcFilterOptions)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Inondation (During, optionsFromCapabilities)',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WMSoptions\r\n      extends WMSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const filterableWMSwithPushButtons: WMSoptions = {\r\n      type: 'wms',\r\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n      params: {\r\n        LAYERS: 'radars_photos',\r\n        VERSION: '1.3.0'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        pushButtons: {\r\n          selectorType: 'pushButton',\r\n          order: 2,\r\n          groups : [\r\n            {title: 'Nom du group1 - push', name: '1 - push', ids : ['id1']},\r\n          ],\r\n          bundles: [\r\n            {\r\n              id: 'id1',\r\n              title: 'Rgions',\r\n              logical: 'Or',\r\n              vertical: true,\r\n              selectors: [\r\n                {\r\n                  title: 'Montral & Laval',\r\n                  enabled: false,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    logical: 'Or',\r\n                    filters: [\r\n                      {\r\n                        operator: 'PropertyIsEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Montral'\r\n                      },\r\n                      {\r\n                        operator: 'PropertyIsEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Laval'\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Outside Montral & Laval',\r\n                  enabled: false,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    logical: 'And',\r\n                    filters: [\r\n                      {\r\n                        operator: 'PropertyIsNotEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Montral'\r\n                      },\r\n                      {\r\n                        operator: 'PropertyIsNotEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Laval'\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        },\r\n        checkboxes: {\r\n          selectorType: 'checkbox',\r\n          order: 1,\r\n          groups : [\r\n            {title: 'Nom du group1 - checkbox', name: '1 - checkbox', ids : ['id1']},\r\n          ],\r\n          bundles: [\r\n            {\r\n              id: 'id1',\r\n              title: 'Type de radar photo',\r\n              logical: 'Or',\r\n              selectors: [\r\n                {\r\n                  title: 'Radar photo fixe',\r\n                  enabled: true,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Radar photo fixe'\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Radar photo mobile',\r\n                  enabled: false,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Radar photo mobile'\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Radar photo fixe + feu rouge',\r\n                  enabled: false,\r\n                  color: '0,200,0',\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Radar feu rouge',\r\n                  enabled: false,\r\n                  color: '255,0,0',\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Appareil de surveillance au feu rouge'\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        },\r\n        allowedOperatorsType: OgcFilterOperatorType.Basic\r\n        },\r\n      paramsWFS: {\r\n        featureTypes: 'radars_photos',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '1.1.0',\r\n        outputFormat: 'geojson',\r\n        outputFormatDownload: 'shp'\r\n      } as WFSDataSourceOptionsParams\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(filterableWMSwithPushButtons)\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Filterable WMS layers with predefined filters (push buttons)',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    // const datasourceWmsWith2Layers: WMSoptions = {\r\n    //   type: 'wms',\r\n    //   url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n    //   urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n    //   params: {\r\n    //     layers: 'stations_meteoroutieres,histo_stations_meteoroutieres',\r\n    //     version: '1.3.0'\r\n    //   },\r\n    //   ogcFilters: {\r\n    //     enabled: true,\r\n    //     editable: true\r\n    //   },\r\n    //   paramsWFS: {\r\n    //     featureTypes: 'histo_stations_meteoroutieres',\r\n    //     fieldNameGeometry: 'geometry',\r\n    //     maxFeatures: 10000,\r\n    //     version: '1.1.0',\r\n    //     outputFormat: 'geojson',\r\n    //     outputFormatDownload: 'shp'\r\n    //   } as WFSDataSourceOptionsParams\r\n    // };\r\n    //\r\n    // this.dataSourceService\r\n    //   .createAsyncDataSource(datasourceWmsWith2Layers)\r\n    //   .subscribe(dataSource => {\r\n    //     this.map.addLayer(\r\n    //       this.layerService.createLayer({\r\n    //         title: 'Layer build from 2 WMS layers',\r\n    //         source: dataSource\r\n    //       })\r\n    //     );\r\n    //   });\r\n\r\n    // const datasourceWms: WMSoptions = {\r\n    //   type: 'wms',\r\n    //   url: '/geoserver/wms',\r\n    //   urlWfs: '/geoserver/wfs',\r\n    //   params: {\r\n    //     LAYERS: 'water_areas',\r\n    //     VERSION: '1.3.0'\r\n    //   },\r\n    //   ogcFilters: {\r\n    //     enabled: true,\r\n    //     editable: true,\r\n    //     filters: {\r\n    //       operator: 'PropertyIsEqualTo',\r\n    //       propertyName: 'waterway',\r\n    //       expression: 'riverbank'\r\n    //     }\r\n    //   },\r\n    //   sourceFields: [\r\n    //     { name: 'waterway', alias: 'Chemin d eau' },\r\n    //     { name: 'osm_id' },\r\n    //     { name: 'landuse', values: ['yes', 'no'] }\r\n    //   ],\r\n    //   paramsWFS: {\r\n    //     featureTypes: 'water_areas',\r\n    //     fieldNameGeometry: 'the_geom',\r\n    //     maxFeatures: 10000,\r\n    //     version: '1.1.0',\r\n    //     outputFormat: 'application/json',\r\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\r\n    //   } as WFSDataSourceOptionsParams\r\n    // };\r\n    //\r\n    // this.dataSourceService\r\n    //   .createAsyncDataSource(datasourceWms)\r\n    //   .subscribe(dataSource => {\r\n    //     this.map.addLayer(\r\n    //       this.layerService.createLayer({\r\n    //         title: 'Geoserver water_areas',\r\n    //         source: dataSource\r\n    //       })\r\n    //     );\r\n    //   });\r\n  }\r\n}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Ogc filter</mat-card-title>\r\n  <mat-card-content>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/ogc-filter\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-panel title=\"Layers\">\r\n    <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\r\n\r\n    </igo-ogc-filterable-list>\r\n  </igo-panel>\r\n\r\n</mat-card>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\r\n\r\nimport { AppOgcFilterComponent } from './ogc-filter.component';\r\nimport { AppOgcFilterRoutingModule } from './ogc-filter-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppOgcFilterComponent],\r\n  imports: [\r\n    AppOgcFilterRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoFilterModule\r\n  ],\r\n  exports: [AppOgcFilterComponent]\r\n})\r\nexport class AppOgcFilterModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Spatial filter</mat-card-title>\r\n  <mat-card-content>\r\n    <li>npm install --save moment@2.22.2</li>\r\n    <li>npm install --save @mat-datetimepicker/core@3.0.0-beta.0</li>\r\n    <li>Dependencies: LanguageService</li>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/spatial-filter\">code of this example</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser\r\n    [map]=\"map\"\r\n    [view]=\"view\"\r\n    igoOverlay igoQuery\r\n    (query)=\"handleQueryResults($event)\"\r\n    [queryFeatures]=\"true\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-panel title=\"Spatial Filter\">\r\n    <igo-spatial-filter-type\r\n      [store]=\"spatialListStore\"\r\n      [selectedQueryType]=\"queryType\"\r\n      [zone]=\"zone\"\r\n      (eventType)=\"getOutputType($event)\"\r\n      (eventQueryType)=\"getOutputQueryType($event)\"\r\n      (zoneChange)=\"onZoneChange($event)\">\r\n    </igo-spatial-filter-type>\r\n\r\n    <igo-spatial-filter-item\r\n      [type]=\"type\"\r\n      [queryType]=\"queryType\"\r\n      [map]=\"map\"\r\n      [zone]=\"zone\"\r\n      [loading]=\"loading\"\r\n      [store]=\"store\"\r\n      [layers]=\"layers\"\r\n      (radiusEvent)=\"radius = $event\"\r\n      (freehandControl)=\"freehandDrawIsActive = $event\"\r\n      (drawZoneEvent)=\"zone = $event\"\r\n      (itemTypeChange)=\"itemType = $event\"\r\n      (thematicChange)=\"thematics = $event\"\r\n      (toggleSearch)=\"getOutputToggleSearch()\"\r\n      (clearButtonEvent)=\"layers = $event\"\r\n      (clearSearchEvent)=\"getOutputClearSearch()\">\r\n    </igo-spatial-filter-item>\r\n  </igo-panel>\r\n\r\n  <igo-panel title=\"Details\">\r\n    <ng-container *ngIf=\"selectedFeature$ | async as feature\">\r\n      <igo-feature-details [feature]=\"feature\"></igo-feature-details>\r\n    </ng-container>\r\n  </igo-panel>\r\n\r\n  <igo-message-center></igo-message-center>\r\n\r\n</mat-card>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'spatial-filter',\r\n    component: AppSpatialFilterComponent\r\n  }\r\n];\r\n\r\nexport const AppSpatialFilterRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, Input } from '@angular/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  Feature,\r\n  moveToOlFeatures,\r\n  FeatureMotion,\r\n  ClusterDataSource,\r\n  featureToOl,\r\n  DataSource,\r\n  QueryableDataSourceOptions,\r\n  Layer,\r\n  SpatialFilterService,\r\n  SpatialFilterQueryType,\r\n  SpatialFilterType,\r\n  SpatialFilterItemType,\r\n  SpatialFilterThematic\r\n} from '@igo2/geo';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\nimport { EntityStore } from '@igo2/common';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport * as olstyle from 'ol/style';\r\nimport olSourceCluster from 'ol/source/Cluster';\r\nimport olSourceVector from 'ol/source/Vector';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\n@Component({\r\n  selector: 'app-spatial-filter',\r\n  templateUrl: './spatial-filter.component.html',\r\n  styleUrls: ['./spatial-filter.component.scss']\r\n})\r\nexport class AppSpatialFilterComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  view = {\r\n    center: [-71.9, 46.9],\r\n    zoom: 10\r\n  };\r\n\r\n  @Input() type: SpatialFilterType;\r\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\r\n  @Input() freehandDrawIsActive: boolean;\r\n\r\n  public layers: Layer[] = [];\r\n\r\n  public queryType: SpatialFilterQueryType;\r\n  public thematics: SpatialFilterThematic[];\r\n  public zone: Feature;\r\n  public radius: number;\r\n\r\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  public store = new EntityStore<Feature>([]); // Store to print results at the end\r\n\r\n  public spatialListStore = new EntityStore<Feature>([]);\r\n\r\n  public loading = false;\r\n\r\n  constructor(\r\n    private spatialFilterService: SpatialFilterService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource,\r\n            baseLayer: true,\r\n            visible: true\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  getOutputType(event: SpatialFilterType) {\r\n    this.type = event;\r\n    this.queryType = undefined;\r\n    this.radius = undefined;\r\n  }\r\n\r\n  getOutputQueryType(event: SpatialFilterQueryType) {\r\n    this.queryType = event;\r\n    if (this.queryType) {\r\n      this.loadFilterList();\r\n    }\r\n  }\r\n\r\n  private loadFilterList() {\r\n    this.spatialFilterService\r\n      .loadFilterList(this.queryType)\r\n      .subscribe((features: Feature[]) => {\r\n        features.sort((a, b) => {\r\n          if (a.properties.nom < b.properties.nom) {\r\n            return -1;\r\n          }\r\n          if (a.properties.nom > b.properties.nom) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n        this.spatialListStore.clear();\r\n        this.spatialListStore.load(features);\r\n      });\r\n  }\r\n\r\n  getOutputToggleSearch() {\r\n    this.loadThematics();\r\n  }\r\n\r\n  getOutputClearSearch() {\r\n    this.zone = undefined;\r\n    this.queryType = undefined;\r\n  }\r\n\r\n  private loadThematics() {\r\n    this.loading = true;\r\n    this.tryAddFeaturesToMap([this.zone]);\r\n    if (!this.thematics) {\r\n      const theme: SpatialFilterThematic = {\r\n        name: ''\r\n      };\r\n      this.thematics = [theme];\r\n    }\r\n    if (this.type === SpatialFilterType.Polygon) {\r\n      this.radius = undefined;\r\n    }\r\n    this.thematics.forEach(thematic => {\r\n      this.spatialFilterService\r\n        .loadFilterItem(\r\n          this.zone,\r\n          this.itemType,\r\n          this.queryType,\r\n          thematic,\r\n          this.radius\r\n        )\r\n        .subscribe((features: Feature[]) => {\r\n          this.store.insertMany(features);\r\n          const featuresPoint: Feature[] = [];\r\n          const featuresLinePoly: Feature[] = [];\r\n          let idPoint;\r\n          let idLinePoly;\r\n          features.forEach(feature => {\r\n            if (feature.geometry.type === 'Point') {\r\n              featuresPoint.push(feature);\r\n              idPoint = feature.meta.id;\r\n            } else {\r\n              featuresLinePoly.push(feature);\r\n              idLinePoly = feature.meta.id;\r\n            }\r\n          });\r\n          this.tryAddPointToMap(featuresPoint, idPoint);\r\n          this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\r\n          this.loading = false;\r\n          if (features.length >= 10000) {\r\n            this.messageService.alert(\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.maxSizeAlert'\r\n              ),\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.warning'\r\n              ),\r\n              { timeOut: 10000 }\r\n            );\r\n          }\r\n          if (!features.length) {\r\n            this.messageService.alert(\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.zeroResults'\r\n              ),\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.warning'\r\n              ),\r\n              { timeOut: 10000 }\r\n            );\r\n          }\r\n        });\r\n    });\r\n  }\r\n\r\n  onZoneChange(feature: Feature) {\r\n    this.zone = feature;\r\n    if (feature) {\r\n      this.tryAddFeaturesToMap([feature]);\r\n      this.zoomToFeatureExtent(feature);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add zone feature to the map overlay\r\n   */\r\n  public tryAddFeaturesToMap(features: Feature[]) {\r\n    let i = 1;\r\n    for (const feature of features) {\r\n      if (this.type === SpatialFilterType.Predefined) {\r\n        for (const layer of this.map.layers) {\r\n          if (\r\n            layer.options._internal &&\r\n            layer.options._internal.code === feature.properties.code\r\n          ) {\r\n            return;\r\n          }\r\n          if (layer.title.startsWith('Zone')) {\r\n            this.map.removeLayer(layer);\r\n          }\r\n        }\r\n      }\r\n      for (const layer of this.map.layers) {\r\n        if (layer.title.startsWith('Zone')) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            title: ('Zone ' + i) as string,\r\n            _internal: {\r\n              code:\r\n                this.type === SpatialFilterType.Predefined\r\n                  ? feature.properties.code\r\n                  : undefined\r\n            },\r\n            source: dataSource,\r\n            visible: true,\r\n            style: (_feature, resolution) => {\r\n              const coordinates = (features[0] as any).coordinates;\r\n              return new olstyle.Style({\r\n                image: new olstyle.Circle({\r\n                  radius: coordinates\r\n                    ? this.radius /\r\n                      Math.cos((Math.PI / 180) * coordinates[1]) /\r\n                      resolution\r\n                    : undefined,\r\n                  fill: new olstyle.Fill({\r\n                    color: 'rgba(200, 200, 20, 0.2)'\r\n                  }),\r\n                  stroke: new olstyle.Stroke({\r\n                    width: 1,\r\n                    color: 'orange'\r\n                  })\r\n                }),\r\n                stroke: new olstyle.Stroke({\r\n                  width: 1,\r\n                  color: 'orange'\r\n                }),\r\n                fill: new olstyle.Fill({\r\n                  color: 'rgba(200, 200, 20, 0.2)'\r\n                })\r\n              });\r\n            }\r\n          });\r\n          const featuresOl = features.map(f => {\r\n            return featureToOl(f, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceVector<OlGeometry> | olSourceCluster;\r\n          ol.addFeatures(featuresOl);\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to point features to the map\r\n   * Necessary to create clusters\r\n   */\r\n  private tryAddPointToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length >= 1) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.map.layers) {\r\n        if (layer.title.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'cluster',\r\n          id,\r\n          queryable: true,\r\n          distance: 120,\r\n          meta: {\r\n            title: 'Cluster'\r\n          }\r\n        } as QueryableDataSourceOptions)\r\n        .subscribe((dataSource: ClusterDataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            title: (features[0].meta.title + ' ' + i) as string,\r\n            source: dataSource,\r\n            visible: true,\r\n            clusterParam: {\r\n              clusterRanges: [{ minRadius: 1, maxRadius: 5, style: {} }]\r\n            }\r\n          });\r\n          const featuresOl = features.map(feature => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceCluster;\r\n          ol.getSource().addFeatures(featuresOl);\r\n          if (this.map.layers.find(layer => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.map.layers.find(layer => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title + ' ' + i) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add line or polygon features to the map\r\n   */\r\n  private tryAddLayerToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length > 1) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.map.layers) {\r\n        if (layer.title.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          id,\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            title: (features[0].meta.title + ' ' + i) as string,\r\n            source: dataSource,\r\n            visible: true\r\n          });\r\n          const featuresOl = features.map(feature => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceVector<OlGeometry> | olSourceCluster;\r\n          ol.addFeatures(featuresOl);\r\n          if (this.map.layers.find(layer => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.map.layers.find(layer => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title + ' ' + i) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n        });\r\n    }\r\n  }\r\n\r\n  zoomToFeatureExtent(feature) {\r\n    if (feature) {\r\n      const olFeature = this.format.readFeature(feature, {\r\n        dataProjection: feature.projection,\r\n        featureProjection: this.map.projection\r\n      });\r\n      moveToOlFeatures(this.map, [olFeature], FeatureMotion.Zoom);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Permit the query action on one item result\r\n   */\r\n  handleQueryResults(results) {\r\n    const features: Feature[] = results.features;\r\n    let feature;\r\n    if (features.length) {\r\n      feature = features[0];\r\n    }\r\n    this.selectedFeature$.next(feature);\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoPanelModule, IgoFormModule } from '@igo2/common';\r\nimport { IgoMapModule, IgoFilterModule, IgoQueryModule, IgoFeatureModule, IgoFeatureDetailsModule } from '@igo2/geo';\r\nimport { IgoMessageModule } from '@igo2/core';\r\n\r\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\r\nimport { AppSpatialFilterRoutingModule } from './spatial-filter-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppSpatialFilterComponent],\r\n  imports: [\r\n    AppSpatialFilterRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoMessageModule,\r\n    IgoQueryModule,\r\n    IgoFeatureModule,\r\n    IgoFeatureDetailsModule,\r\n    IgoFilterModule,\r\n    IgoFormModule,\r\n    CommonModule\r\n  ],\r\n  exports: [AppSpatialFilterComponent]\r\n})\r\nexport class AppSpatialFilterModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Workspace</mat-card-title>\r\n  <mat-card-content>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/workspace\">code of this example</a>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-workspace-selector\r\n    igoWorkspaceSelector\r\n    [store]=\"workspaceStore\"\r\n    [map]=\"map\">\r\n  </igo-workspace-selector>\r\n\r\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\r\n    <igo-entity-table-paginator\r\n      *ngIf=\"workspace.inResolutionRange$ | async\"\r\n      [store]=\"workspace.entityStore\"\r\n      [paginatorOptions]=\"paginatorOptions\"\r\n      [entitySortChange$]=\"entitySortChange$\"\r\n      (paginatorChange)=\"paginatorChange($event)\">\r\n    </igo-entity-table-paginator>\r\n  </ng-container>\r\n\r\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\r\n    <igo-actionbar\r\n      *ngIf=\"workspace.actionStore\"\r\n      [store]=\"workspace.actionStore\"\r\n      [horizontal]=\"true\"\r\n      [withToggleButton]=\"true\"\r\n      [withTitle]=\"true\"\r\n      [mode]=\"actionbarMode\">\r\n    </igo-actionbar>\r\n\r\n    <igo-entity-table\r\n      *ngIf=\"workspace.entityStore && workspace.meta && workspace.meta.tableTemplate && (workspace.inResolutionRange$ | async)\"\r\n      class=\"table-compact table-centered\"\r\n      [paginator]=\"workspacePaginator\"\r\n      [scrollBehavior]=\"scrollBehavior\"\r\n      [store]=\"workspace.entityStore\"\r\n      [template]=\"workspace.meta.tableTemplate\">\r\n    </igo-entity-table>\r\n    <mat-card-content\r\n    *ngIf=\"!(workspace.inResolutionRange$ | async)\">\r\n      No data available at this scale. Please zoom in. \r\n    </mat-card-content>\r\n\r\n    <igo-workspace-widget-outlet [workspace]=\"workspace\"></igo-workspace-widget-outlet>\r\n\r\n  </ng-container>\r\n\r\n</mat-card>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppWorkspaceComponent } from './workspace.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'workspace',\r\n    component: AppWorkspaceComponent\r\n  }\r\n];\r\n\r\nexport const AppWorkspaceRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\nimport { Observable, BehaviorSubject } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  ActionbarMode,\r\n  EntityRecord,\r\n  EntityTableScrollBehavior,\r\n  Workspace,\r\n  WorkspaceStore,\r\n  EntityTablePaginatorOptions\r\n} from '@igo2/common';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  WFSDataSourceOptions\r\n} from '@igo2/geo';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { WorkspaceState } from '@igo2/integration';\r\n\r\n@Component({\r\n  selector: 'app-workspace',\r\n  templateUrl: './workspace.component.html',\r\n  styleUrls: ['./workspace.component.scss']\r\n})\r\nexport class AppWorkspaceComponent implements OnInit {\r\n\r\n  public workspacePaginator: MatPaginator;\r\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public paginatorOptions: EntityTablePaginatorOptions = {\r\n    pageSize: 5, // Number of items to display on a page.\r\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\r\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\r\n  };\r\n\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-72, 47.2],\r\n    zoom: 5\r\n  };\r\n\r\n  get workspaceStore(): WorkspaceStore {\r\n    return this.workspaceState.store;\r\n  }\r\n\r\n  public selectedWorkspace$: Observable<Workspace>;\r\n\r\n  public actionbarMode = ActionbarMode.Overlay;\r\n\r\n  public scrollBehavior = EntityTableScrollBehavior.Instant;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    public workspaceState: WorkspaceState,\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.selectedWorkspace$ = this.workspaceStore.stateView\r\n      .firstBy$(\r\n        (record: EntityRecord<Workspace>) => record.state.selected === true\r\n      )\r\n      .pipe(\r\n        map((record: EntityRecord<Workspace>) => {\r\n          const entity = record === undefined ? undefined : record.entity;\r\n          if (entity) {\r\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\r\n            // The reason why it's has been remove is that this button trigger a tool (importExport)\r\n            // and this tool is not available in the igo2-lib demo.\r\n            // This is why it's has been removed frome the actions's list.\r\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\r\n            entity.actionStore.view.filter((action) => {\r\n              return action.id !== 'wfsDownload';\r\n            });\r\n          }\r\n          return entity;\r\n\r\n        })\r\n      );\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe(dataSource => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    // const wmsDataSourceOptions = {\r\n    //   type: 'wms',\r\n    //   url: 'https://ahocevar.com/geoserver/wms',\r\n    //   urlWfs: 'https://ahocevar.com/geoserver/wfs',\r\n    //   params: {\r\n    //     LAYERS: 'water_areas',\r\n    //     VERSION: '1.3.0'\r\n    //   },\r\n    //   paramsWFS: {\r\n    //     featureTypes: 'water_areas',\r\n    //     fieldNameGeometry: 'the_geom',\r\n    //     maxFeatures: 10000,\r\n    //     version: '1.1.0',\r\n    //     outputFormat: 'application/json',\r\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\r\n    //   },\r\n    //   sourceFields: [\r\n    //     {name: 'waterway', alias: 'Chemin d eau'},\r\n    //     {name: 'osm_id'},\r\n    //     {name: 'landuse'}\r\n    //   ],\r\n    //   ogcFilters: {\r\n    //     enabled: true,\r\n    //     editable: true\r\n    //   },\r\n    //   serverType: 'geoserver'\r\n    // };\r\n    //\r\n    // this.dataSourceService\r\n    //   .createAsyncDataSource(wmsDataSourceOptions as OgcFilterableDataSourceOptions)\r\n    //   .subscribe(dataSource => {\r\n    //     const layer = {\r\n    //       optionsFromCapabilities: true,\r\n    //       title: 'WMS Geoserver filterable ',\r\n    //       visible: true,\r\n    //       source: dataSource\r\n    //     };\r\n    //     this.map.addLayer(this.layerService.createLayer(layer));\r\n    //   });\r\n\r\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\r\n      type: 'wfs',\r\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n      params: {\r\n        featureTypes: 'etablissement_mtq',\r\n        fieldNameGeometry: 'geometry',\r\n        version: '2.0.0',\r\n        outputFormat: 'geojson'\r\n      },\r\n      sourceFields: [\r\n        { name: 'idetablis', alias: 'ID' },\r\n        { name: 'nometablis', alias: 'Name' },\r\n        { name: 'typetablis', alias: 'Type' }\r\n      ]\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDataSourceOptions)\r\n      .subscribe(dataSource => {\r\n        const layer = {\r\n          title: 'Simple WFS ',\r\n          maxResolution: 3000,\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n\r\n  paginatorChange(event: MatPaginator) {\r\n    this.workspacePaginator = event;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport {\r\n  IgoActionModule,\r\n  IgoEntityModule,\r\n  IgoWorkspaceModule,\r\n  IgoPanelModule\r\n} from '@igo2/common';\r\nimport {\r\n  IgoMapModule,\r\n  IgoGeoWorkspaceModule\r\n} from '@igo2/geo';\r\n\r\nimport { AppWorkspaceComponent } from './workspace.component';\r\nimport { AppWorkspaceRoutingModule } from './workspace-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppWorkspaceComponent],\r\n  imports: [\r\n    CommonModule,\r\n    AppWorkspaceRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoActionModule,\r\n    IgoEntityModule,\r\n    IgoWorkspaceModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoGeoWorkspaceModule\r\n  ],\r\n  exports: [AppWorkspaceComponent]\r\n})\r\nexport class AppWorkspaceModule {}\r\n","<mat-card>\r\n  <mat-card-subtitle>Geo</mat-card-subtitle>\r\n  <mat-card-title>Context</mat-card-title>\r\n  <mat-card-content>\r\n    <p>* Dependencies: LanguageService</p>\r\n\r\n    <br>\r\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/context/context\">code of this example</a><br>\r\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/contexts\"> contexts</a>\r\n    <hr>\r\n  </mat-card-content>\r\n\r\n  <igo-map-browser\r\n    igoMapContext\r\n    igoLayerContext\r\n    [map]=\"map\">\r\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\r\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\r\n  </igo-map-browser>\r\n\r\n  <igo-panel title=\"Contexts list\">\r\n    <igo-context-list igoContextListBinding [map]=\"map\"></igo-context-list>\r\n  </igo-panel>\r\n\r\n  <igo-panel title=\"Layers\">\r\n    <igo-layer-list igoLayerListBinding [map]=\"map\">\r\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\r\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\r\n      </ng-template>\r\n    </igo-layer-list>\r\n  </igo-panel>\r\n\r\n</mat-card>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\n\r\nimport { AppContextComponent } from './context.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'context',\r\n    component: AppContextComponent\r\n  }\r\n];\r\n\r\nexport const AppContextRoutingModule = RouterModule.forChild(\r\n  routes\r\n);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { IgoMap, OverlayService, MapService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-context',\r\n  templateUrl: './context.component.html',\r\n  styleUrls: ['./context.component.scss']\r\n})\r\nexport class AppContextComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private mapService: MapService,\r\n    private overlayService: OverlayService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { HttpClientJsonpModule } from '@angular/common/http';\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport {\r\n  IgoMapModule,\r\n  IgoLayerModule,\r\n  IgoMetadataModule,\r\n  IgoOverlayModule,\r\n  IgoQueryModule,\r\n  IgoFeatureModule\r\n} from '@igo2/geo';\r\nimport { IgoContextManagerModule } from '@igo2/context';\r\n\r\nimport { AppContextComponent } from './context.component';\r\nimport { AppContextRoutingModule } from './context-routing.module';\r\n\r\n@NgModule({\r\n  declarations: [AppContextComponent],\r\n  imports: [\r\n    HttpClientJsonpModule,\r\n    AppContextRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoLayerModule,\r\n    IgoMetadataModule,\r\n    IgoOverlayModule,\r\n    IgoQueryModule,\r\n    IgoFeatureModule,\r\n    IgoContextManagerModule\r\n  ],\r\n  exports: [AppContextComponent]\r\n})\r\nexport class AppContextModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\n\r\nconst routes: Routes = [\r\n  { path: '', redirectTo: '/home', pathMatch: 'full' },\r\n  { path: '**', redirectTo: '/home' }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forRoot(routes, { useHash: true })],\r\n  exports: [RouterModule]\r\n})\r\nexport class AppRoutingModule {}\r\n","import { MediaMatcher } from '@angular/cdk/layout';\r\nimport {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  OnDestroy,\r\n  Renderer2\r\n} from '@angular/core';\r\n\r\nimport { userAgent } from '@igo2/utils';\r\nimport { version } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss']\r\n})\r\nexport class AppComponent implements OnDestroy {\r\n  mobileQuery: MediaQueryList;\r\n\r\n  public title = 'IGO';\r\n  public version = version;\r\n  private themeClass = 'deeppurple-theme';\r\n  private _mobileQueryListener: () => void;\r\n\r\n  constructor(\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n    private media: MediaMatcher,\r\n    private renderer: Renderer2\r\n  ) {\r\n    this.mobileQuery = media.matchMedia('(max-width: 600px)');\r\n    this._mobileQueryListener = () => changeDetectorRef.detectChanges();\r\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\r\n\r\n    this.renderer.addClass(document.body, this.themeClass);\r\n\r\n    this.detectOldBrowser();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\r\n  }\r\n\r\n  private detectOldBrowser() {\r\n    const oldBrowser = userAgent.satisfies({\r\n      ie: '<11',\r\n      chrome: '<64',\r\n      firefox: '<60'\r\n    });\r\n\r\n    if (oldBrowser) {\r\n      console.log('Very old browser ! ', userAgent.getBrowser());\r\n    }\r\n  }\r\n}\r\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\r\n  <mat-toolbar color=\"primary\" class=\"example-toolbar\">\r\n    <button mat-icon-button (click)=\"snav.toggle()\"><mat-icon svgIcon=\"menu\"></mat-icon></button>\r\n    <h1>{{title}}</h1>\r\n    <h5>{{version.lib}}</h5>\r\n  </mat-toolbar>\r\n\r\n  <mat-sidenav-container class=\"example-sidenav-container\" [style.marginTop.px]=\"mobileQuery.matches ? 56 : 0\">\r\n    <mat-sidenav #snav opened=\"true\" [mode]=\"mobileQuery.matches ? 'over' : 'side'\" [fixedInViewport]=\"mobileQuery.matches\" fixedTopGap=\"56\">\r\n      <mat-nav-list>\r\n        <a mat-list-item routerLink=\".\">Home</a>\r\n\r\n        <hr>\r\n\r\n        <a mat-list-item routerLink=\"activity\">Activity</a>\r\n        <a mat-list-item routerLink=\"config\">Config</a>\r\n        <a mat-list-item routerLink=\"language\">Language</a>\r\n        <a mat-list-item routerLink=\"media\">Media</a>\r\n        <a mat-list-item routerLink=\"message\">Message</a>\r\n        <a mat-list-item routerLink=\"request\">Request</a>\r\n\r\n        <hr>\r\n\r\n        <a mat-list-item routerLink=\"auth-form\">Authentification</a>\r\n\r\n        <hr>\r\n\r\n        <a mat-list-item routerLink=\"action\">Action</a>\r\n        <a mat-list-item routerLink=\"dynamic-component\">Dynamic Component</a>\r\n        <a mat-list-item routerLink=\"entity-table\">Entity Table</a>\r\n        <a mat-list-item routerLink=\"entity-selector\">Entity Selector</a>\r\n        <a mat-list-item routerLink=\"form\">Form</a>\r\n        <a mat-list-item routerLink=\"table\">Table</a>\r\n        <a mat-list-item routerLink=\"tool\">Tool</a>\r\n        <a mat-list-item routerLink=\"widget\">Widget</a>\r\n\r\n        <hr>\r\n\r\n        <a mat-list-item routerLink=\"simple-map\">Simple map</a>\r\n        <a mat-list-item routerLink=\"layer\">Layer</a>\r\n        <a mat-list-item routerLink=\"legend\">Legend</a>\r\n        <a mat-list-item routerLink=\"overlay\">Overlay</a>\r\n        <a mat-list-item routerLink=\"geometry\">Geometry</a>\r\n        <a mat-list-item routerLink=\"feature\">Feature</a>\r\n        <a mat-list-item routerLink=\"hover\">Hover</a>\r\n        <a mat-list-item routerLink=\"measure\">Measure</a>\r\n        <a mat-list-item routerLink=\"draw\">Draw</a>\r\n        <a mat-list-item routerLink=\"query\">Query</a>\r\n        <a mat-list-item routerLink=\"catalog\">Catalog</a>\r\n        <a mat-list-item routerLink=\"search\">Search</a>\r\n        <a mat-list-item routerLink=\"print\">Print</a>\r\n        <a mat-list-item routerLink=\"import-export\">Import/Export</a>\r\n        <a mat-list-item routerLink=\"directions\">Directions</a>\r\n        <a mat-list-item routerLink=\"time-filter\">Time filter</a>\r\n        <a mat-list-item routerLink=\"ogc-filter\">OGC filter</a>\r\n        <a mat-list-item routerLink=\"spatial-filter\">Spatial filter</a>\r\n        <a mat-list-item routerLink=\"workspace\">Workspace</a>\r\n\r\n        <hr>\r\n\r\n        <a mat-list-item routerLink=\"context\">Context</a>\r\n\r\n      </mat-nav-list>\r\n    </mat-sidenav>\r\n\r\n    <mat-sidenav-content>\r\n      <router-outlet></router-outlet>\r\n    </mat-sidenav-content>\r\n\r\n  </mat-sidenav-container>\r\n</div>\r\n","import { BrowserModule, DomSanitizer } from '@angular/platform-browser';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { NgModule } from '@angular/core';\r\nimport { HammerModule } from '@angular/platform-browser';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconRegistry, MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSidenavModule } from '@angular/material/sidenav';\r\nimport { MatToolbarModule } from '@angular/material/toolbar';\r\nimport { AppHomeModule } from './core/home/home.module';\r\nimport { AppActivityModule } from './core/activity/activity.module';\r\nimport { AppConfigModule } from './core/config/config.module';\r\nimport { AppLanguageModule } from './core/language/language.module';\r\nimport { AppMediaModule } from './core/media/media.module';\r\nimport { AppMessageModule } from './core/message/message.module';\r\nimport { AppRequestModule } from './core/request/request.module';\r\n\r\nimport { AppActionModule } from './common/action/action.module';\r\nimport { AppDynamicComponentModule } from './common/dynamic-component/dynamic-component.module';\r\nimport { AppEntityTableModule } from './common/entity-table/entity-table.module';\r\nimport { AppEntitySelectorModule } from './common/entity-selector/entity-selector.module';\r\nimport { AppFormModule } from './common/form/form.module';\r\nimport { AppTableModule } from './common/table/table.module';\r\nimport { AppToolModule } from './common/tool/tool.module';\r\nimport { AppWidgetModule } from './common/widget/widget.module';\r\n\r\nimport { AppAuthFormModule } from './auth/auth-form/auth-form.module';\r\n\r\nimport { AppSimpleMapModule } from './geo/simple-map/simple-map.module';\r\nimport { AppLayerModule } from './geo/layer/layer.module';\r\nimport { AppLegendModule } from './geo/legend/legend.module';\r\nimport { AppOverlayModule } from './geo/overlay/overlay.module';\r\nimport { AppGeometryModule } from './geo/geometry/geometry.module';\r\nimport { AppFeatureModule } from './geo/feature/feature.module';\r\nimport { AppHoverModule } from './geo/hover/hover.module';\r\nimport { AppMeasureModule } from './geo/measure/measure.module';\r\nimport { AppDrawModule } from './geo/draw/draw.module';\r\nimport { AppQueryModule } from './geo/query/query.module';\r\nimport { AppCatalogModule } from './geo/catalog/catalog.module';\r\nimport { AppSearchModule } from './geo/search/search.module';\r\nimport { AppPrintModule } from './geo/print/print.module';\r\nimport { AppImportExport } from './geo/import-export/import-export.module';\r\nimport { AppDirectionsModule } from './geo/directions/directions.module';\r\nimport { AppTimeFilterModule } from './geo/time-filter/time-filter.module';\r\nimport { AppOgcFilterModule } from './geo/ogc-filter/ogc-filter.module';\r\nimport { AppSpatialFilterModule } from './geo/spatial-filter/spatial-filter.module';\r\nimport { AppWorkspaceModule } from './geo/workspace/workspace.module';\r\n\r\nimport { AppContextModule } from './context/context/context.module';\r\n\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { AppComponent } from './app.component';\r\n\r\n@NgModule({\r\n  declarations: [AppComponent],\r\n  imports: [\r\n    BrowserModule,\r\n    BrowserAnimationsModule,\r\n    MatSidenavModule,\r\n    MatToolbarModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n\r\n    AppHomeModule,\r\n    AppActivityModule,\r\n    AppConfigModule,\r\n    AppLanguageModule,\r\n    AppMediaModule,\r\n    AppMessageModule,\r\n    AppRequestModule,\r\n\r\n    AppActionModule,\r\n    AppDynamicComponentModule,\r\n    AppEntityTableModule,\r\n    AppEntitySelectorModule,\r\n    AppFormModule,\r\n    AppTableModule,\r\n    AppToolModule,\r\n    AppWidgetModule,\r\n\r\n    AppAuthFormModule,\r\n\r\n    AppSimpleMapModule,\r\n    AppLayerModule,\r\n    AppLegendModule,\r\n    AppOverlayModule,\r\n    AppGeometryModule,\r\n    AppFeatureModule,\r\n    AppHoverModule,\r\n    AppMeasureModule,\r\n    AppDrawModule,\r\n    AppQueryModule,\r\n    AppCatalogModule,\r\n    AppSearchModule,\r\n    AppPrintModule,\r\n    AppImportExport,\r\n    AppDirectionsModule,\r\n    AppTimeFilterModule,\r\n    AppOgcFilterModule,\r\n    AppSpatialFilterModule,\r\n    AppWorkspaceModule,\r\n\r\n    AppContextModule,\r\n\r\n    AppRoutingModule,\r\n\r\n    HammerModule\r\n  ],\r\n  bootstrap: [AppComponent]\r\n})\r\nexport class AppModule {\r\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\r\n    matIconRegistry.addSvgIconSet(\r\n      domSanitizer.bypassSecurityTrustResourceUrl(\r\n        './assets/igo2/core/icons/mdi.svg'\r\n      )\r\n    );\r\n  }\r\n}\r\n","import { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\n\r\nimport 'hammerjs';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nplatformBrowserDynamic()\r\n  .bootstrapModule(AppModule)\r\n  .catch(err => console.log(err));\r\n","var map = {\n\t\"./af\": 62275,\n\t\"./af.js\": 62275,\n\t\"./ar\": 90857,\n\t\"./ar-dz\": 11218,\n\t\"./ar-dz.js\": 11218,\n\t\"./ar-kw\": 14754,\n\t\"./ar-kw.js\": 14754,\n\t\"./ar-ly\": 66680,\n\t\"./ar-ly.js\": 66680,\n\t\"./ar-ma\": 92178,\n\t\"./ar-ma.js\": 92178,\n\t\"./ar-sa\": 56522,\n\t\"./ar-sa.js\": 56522,\n\t\"./ar-tn\": 95682,\n\t\"./ar-tn.js\": 95682,\n\t\"./ar.js\": 90857,\n\t\"./az\": 70164,\n\t\"./az.js\": 70164,\n\t\"./be\": 79774,\n\t\"./be.js\": 79774,\n\t\"./bg\": 60947,\n\t\"./bg.js\": 60947,\n\t\"./bm\": 21832,\n\t\"./bm.js\": 21832,\n\t\"./bn\": 89650,\n\t\"./bn-bd\": 74477,\n\t\"./bn-bd.js\": 74477,\n\t\"./bn.js\": 89650,\n\t\"./bo\": 66005,\n\t\"./bo.js\": 66005,\n\t\"./br\": 98492,\n\t\"./br.js\": 98492,\n\t\"./bs\": 70534,\n\t\"./bs.js\": 70534,\n\t\"./ca\": 52061,\n\t\"./ca.js\": 52061,\n\t\"./cs\": 84737,\n\t\"./cs.js\": 84737,\n\t\"./cv\": 61167,\n\t\"./cv.js\": 61167,\n\t\"./cy\": 77996,\n\t\"./cy.js\": 77996,\n\t\"./da\": 9528,\n\t\"./da.js\": 9528,\n\t\"./de\": 14540,\n\t\"./de-at\": 49430,\n\t\"./de-at.js\": 49430,\n\t\"./de-ch\": 67978,\n\t\"./de-ch.js\": 67978,\n\t\"./de.js\": 14540,\n\t\"./dv\": 83426,\n\t\"./dv.js\": 83426,\n\t\"./el\": 6616,\n\t\"./el.js\": 6616,\n\t\"./en-au\": 63816,\n\t\"./en-au.js\": 63816,\n\t\"./en-ca\": 32162,\n\t\"./en-ca.js\": 32162,\n\t\"./en-gb\": 83305,\n\t\"./en-gb.js\": 83305,\n\t\"./en-ie\": 61954,\n\t\"./en-ie.js\": 61954,\n\t\"./en-il\": 43060,\n\t\"./en-il.js\": 43060,\n\t\"./en-in\": 59923,\n\t\"./en-in.js\": 59923,\n\t\"./en-nz\": 13540,\n\t\"./en-nz.js\": 13540,\n\t\"./en-sg\": 16505,\n\t\"./en-sg.js\": 16505,\n\t\"./eo\": 41907,\n\t\"./eo.js\": 41907,\n\t\"./es\": 86640,\n\t\"./es-do\": 41246,\n\t\"./es-do.js\": 41246,\n\t\"./es-mx\": 56131,\n\t\"./es-mx.js\": 56131,\n\t\"./es-us\": 36430,\n\t\"./es-us.js\": 36430,\n\t\"./es.js\": 86640,\n\t\"./et\": 62551,\n\t\"./et.js\": 62551,\n\t\"./eu\": 32711,\n\t\"./eu.js\": 32711,\n\t\"./fa\": 54572,\n\t\"./fa.js\": 54572,\n\t\"./fi\": 33390,\n\t\"./fi.js\": 33390,\n\t\"./fil\": 87860,\n\t\"./fil.js\": 87860,\n\t\"./fo\": 48216,\n\t\"./fo.js\": 48216,\n\t\"./fr\": 99291,\n\t\"./fr-ca\": 98527,\n\t\"./fr-ca.js\": 98527,\n\t\"./fr-ch\": 58407,\n\t\"./fr-ch.js\": 58407,\n\t\"./fr.js\": 99291,\n\t\"./fy\": 47054,\n\t\"./fy.js\": 47054,\n\t\"./ga\": 49540,\n\t\"./ga.js\": 49540,\n\t\"./gd\": 73917,\n\t\"./gd.js\": 73917,\n\t\"./gl\": 51486,\n\t\"./gl.js\": 51486,\n\t\"./gom-deva\": 56245,\n\t\"./gom-deva.js\": 56245,\n\t\"./gom-latn\": 48868,\n\t\"./gom-latn.js\": 48868,\n\t\"./gu\": 59652,\n\t\"./gu.js\": 59652,\n\t\"./he\": 89019,\n\t\"./he.js\": 89019,\n\t\"./hi\": 42040,\n\t\"./hi.js\": 42040,\n\t\"./hr\": 63402,\n\t\"./hr.js\": 63402,\n\t\"./hu\": 79322,\n\t\"./hu.js\": 79322,\n\t\"./hy-am\": 27609,\n\t\"./hy-am.js\": 27609,\n\t\"./id\": 57942,\n\t\"./id.js\": 57942,\n\t\"./is\": 98275,\n\t\"./is.js\": 98275,\n\t\"./it\": 73053,\n\t\"./it-ch\": 4378,\n\t\"./it-ch.js\": 4378,\n\t\"./it.js\": 73053,\n\t\"./ja\": 46176,\n\t\"./ja.js\": 46176,\n\t\"./jv\": 679,\n\t\"./jv.js\": 679,\n\t\"./ka\": 92726,\n\t\"./ka.js\": 92726,\n\t\"./kk\": 72953,\n\t\"./kk.js\": 72953,\n\t\"./km\": 86957,\n\t\"./km.js\": 86957,\n\t\"./kn\": 59181,\n\t\"./kn.js\": 59181,\n\t\"./ko\": 47148,\n\t\"./ko.js\": 47148,\n\t\"./ku\": 27752,\n\t\"./ku.js\": 27752,\n\t\"./ky\": 65675,\n\t\"./ky.js\": 65675,\n\t\"./lb\": 41263,\n\t\"./lb.js\": 41263,\n\t\"./lo\": 65746,\n\t\"./lo.js\": 65746,\n\t\"./lt\": 11143,\n\t\"./lt.js\": 11143,\n\t\"./lv\": 38753,\n\t\"./lv.js\": 38753,\n\t\"./me\": 44054,\n\t\"./me.js\": 44054,\n\t\"./mi\": 31573,\n\t\"./mi.js\": 31573,\n\t\"./mk\": 30202,\n\t\"./mk.js\": 30202,\n\t\"./ml\": 68523,\n\t\"./ml.js\": 68523,\n\t\"./mn\": 79794,\n\t\"./mn.js\": 79794,\n\t\"./mr\": 56681,\n\t\"./mr.js\": 56681,\n\t\"./ms\": 56975,\n\t\"./ms-my\": 39859,\n\t\"./ms-my.js\": 39859,\n\t\"./ms.js\": 56975,\n\t\"./mt\": 3691,\n\t\"./mt.js\": 3691,\n\t\"./my\": 5152,\n\t\"./my.js\": 5152,\n\t\"./nb\": 7607,\n\t\"./nb.js\": 7607,\n\t\"./ne\": 21526,\n\t\"./ne.js\": 21526,\n\t\"./nl\": 86368,\n\t\"./nl-be\": 40076,\n\t\"./nl-be.js\": 40076,\n\t\"./nl.js\": 86368,\n\t\"./nn\": 68420,\n\t\"./nn.js\": 68420,\n\t\"./oc-lnc\": 51906,\n\t\"./oc-lnc.js\": 51906,\n\t\"./pa-in\": 94504,\n\t\"./pa-in.js\": 94504,\n\t\"./pl\": 54721,\n\t\"./pl.js\": 54721,\n\t\"./pt\": 74645,\n\t\"./pt-br\": 54548,\n\t\"./pt-br.js\": 54548,\n\t\"./pt.js\": 74645,\n\t\"./ro\": 71977,\n\t\"./ro.js\": 71977,\n\t\"./ru\": 26042,\n\t\"./ru.js\": 26042,\n\t\"./sd\": 78849,\n\t\"./sd.js\": 78849,\n\t\"./se\": 27739,\n\t\"./se.js\": 27739,\n\t\"./si\": 50084,\n\t\"./si.js\": 50084,\n\t\"./sk\": 92449,\n\t\"./sk.js\": 92449,\n\t\"./sl\": 23086,\n\t\"./sl.js\": 23086,\n\t\"./sq\": 33139,\n\t\"./sq.js\": 33139,\n\t\"./sr\": 30607,\n\t\"./sr-cyrl\": 30063,\n\t\"./sr-cyrl.js\": 30063,\n\t\"./sr.js\": 30607,\n\t\"./ss\": 40131,\n\t\"./ss.js\": 40131,\n\t\"./sv\": 21665,\n\t\"./sv.js\": 21665,\n\t\"./sw\": 5642,\n\t\"./sw.js\": 5642,\n\t\"./ta\": 33622,\n\t\"./ta.js\": 33622,\n\t\"./te\": 74825,\n\t\"./te.js\": 74825,\n\t\"./tet\": 48336,\n\t\"./tet.js\": 48336,\n\t\"./tg\": 39238,\n\t\"./tg.js\": 39238,\n\t\"./th\": 99463,\n\t\"./th.js\": 99463,\n\t\"./tk\": 39986,\n\t\"./tk.js\": 39986,\n\t\"./tl-ph\": 29672,\n\t\"./tl-ph.js\": 29672,\n\t\"./tlh\": 40043,\n\t\"./tlh.js\": 40043,\n\t\"./tr\": 51212,\n\t\"./tr.js\": 51212,\n\t\"./tzl\": 50110,\n\t\"./tzl.js\": 50110,\n\t\"./tzm\": 80482,\n\t\"./tzm-latn\": 38309,\n\t\"./tzm-latn.js\": 38309,\n\t\"./tzm.js\": 80482,\n\t\"./ug-cn\": 42495,\n\t\"./ug-cn.js\": 42495,\n\t\"./uk\": 54157,\n\t\"./uk.js\": 54157,\n\t\"./ur\": 80984,\n\t\"./ur.js\": 80984,\n\t\"./uz\": 64141,\n\t\"./uz-latn\": 43662,\n\t\"./uz-latn.js\": 43662,\n\t\"./uz.js\": 64141,\n\t\"./vi\": 12607,\n\t\"./vi.js\": 12607,\n\t\"./x-pseudo\": 66460,\n\t\"./x-pseudo.js\": 66460,\n\t\"./yo\": 92948,\n\t\"./yo.js\": 92948,\n\t\"./zh-cn\": 62658,\n\t\"./zh-cn.js\": 62658,\n\t\"./zh-hk\": 39352,\n\t\"./zh-hk.js\": 39352,\n\t\"./zh-mo\": 38274,\n\t\"./zh-mo.js\": 38274,\n\t\"./zh-tw\": 98451,\n\t\"./zh-tw.js\": 98451\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;"]}