{"version":3,"file":"main.b82c73636cdf6a5d.js","mappings":"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O0D,EAAgBR,cAC7BQ,EAAgBZ,UAAUu8P,eAAer/P,EAAMI,GAC/CxK,GAAO,EACR,EAET,SCzKIqoD,GAAYC,eACdohN,SAGFC,QACGC,gBAAgBd,IAChB5xM,MAAOh5C,GAAQhV,QAAQC,IAAI+U,uBCd9B,IAAAtnB,GAAA,CACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,mBACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,YACA,eACA,YACA,eACA,YACA,eACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,sBACA,kBACA,qBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,gBACA,mBACA,eACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,cACA,iBACA,aACA,gBACA,cACA,iBACA,cACA,mBACA,sBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,eACA,kBACA,gBACA,mBACA,gBACA,oBAIA,SAAAizQ,EAAA/iQ,GACA,IAAAxJ,EAAAwsQ,GAAAhjQ,GACA,OAAAijQ,EAAAzsQ,EACA,CACA,SAAAwsQ,GAAAhjQ,GACA,IAAAijQ,EAAAjvQ,EAAAlE,GAAAkQ,GAAA,CACA,IAAA+c,EAAA,IAAAjf,MAAA,uBAAAkC,EAAA,KACA,MAAA+c,EAAA4kC,KAAA,mBACA5kC,CACA,CACA,OAAAjtB,GAAAkQ,EACA,CACA+iQ,EAAA1rQ,KAAA,WACA,OAAAE,OAAAF,KAAAvH,GACA,EACAizQ,EAAA7pQ,QAAA8pQ,GACAE,GAAAC,QAAAJ,EACAA,EAAAvsQ,GAAA","names":["Base64","static","getByte","s","i","charCodeAt","getByte64","this","ALPHA","indexOf","charAt","decode","b10","pads","imax","length","x","String","PADCHAR","push","fromCharCode","join","encode","customCacheHasher","parameters","map","param","HttpParams","toString","undefined","JSON","parse","stringify","userAgent","Bowser","window","navigator","Clipboard","copy","element","successful","textArea","createTextArea","selectText","copyTextToClipboard","destroyTextArea","text","document","createElement","value","body","appendChild","removeChild","getOSName","oldContentEditable","contentEditable","oldReadOnly","readOnly","range","createRange","selection","getSelection","contenteditable","readonly","selectNodeContents","removeAllRanges","addRange","setSelectionRange","select","compareVersion","execCommand","StringUtils","diff","s1","s2","p","changeData","getChanges","nextS","slice","mtc","ins","sbs","nextThis","del","result","getMatchingSubstring","l","m","match","slen","o","fis","isThisLonger","longer","shorter","bi","split","len","cd","fil","sub","rc","rotateArray","array","n","res","Array","isValidNumber","isNaN","Number","isOctalNumber","startsWith","ChangeType","ADDED","DELETED","MODIFIED","ChangeUtils","findChanges","obj1","obj2","ignoreKeys","items","added","deleted","modified","obj1Clone","obj2Clone","fromItem","index","findIndex","id","change","type","toItem","splice","fromItemClone","toItemClone","keysChanged","compareObject","oldValue","newValue","itemAdded","baseKey","keys","Set","Object","forEach","key","keyString","isArray","concat","DomUtils","create","doc","tagName","options","el","remove","node","parentNode","downloadContent","content","mimeType","fileName","downloadFromUri","uri","setAttribute","style","display","click","encodeURIComponent","ObjectUtils","resolve","obj","keysArray","replace","current","shift","isObject","item","Date","mergeDeep","target","source","ignoreUndefined","output","assign","filter","copyDeep","src","prop","hasOwnProperty","removeDuplicateCaseInsensitive","summaryCapitalizeObject","capitalizeObject","upperCaseCount","property","upperCaseProperty","toUpperCase","count","capitalizedProperty","capitalizedPropertyObject","singlePossibility","paramClosestToLowercase","f","toLowerCase","reduce","prev","y","removeUndefined","removeNull","naturalCompare","a","b","direction","nullsFirst","nullScore","ax","bx","_","$1","$2","Infinity","an","bn","nn","localeCompare","objectsAreEquivalent","obj1Props","getOwnPropertyNames","obj2Props","removeKeys","_obj","isEmpty","NumberUtils","roundToNDecimal","num","decimal","roundFactor","Math","pow","round","strEnum","S4","random","substring","uuid","SubjectStatus","Error","Done","Working","Waiting","Watcher","status$","Subject","status$$","status","_status","next","subscribe","callback","scope","watch","pipe","distinctUntilChanged","handleStatusChange","call","unsubscribe","unwatch","ActivityService","counter$","BehaviorSubject","ids","constructor","register","unregister","factory","fac","providedIn","ActivityInterceptor","activityService","intercept","req","activity","headers","get","actReq","clone","delete","handle","finalize","i0","i1","IgoActivityModule","forRoot","ngModule","providers","provide","HTTP_INTERCEPTORS","useClass","multi","version","lib","releaseDate","ConfigService","config","httpClient","handler","HttpClient","getConfig","load","baseConfig","default","path","Promise","_reject","catchError","error","console","log","throwError","configResponse","CONFIG_OPTIONS","InjectionToken","provideConfigOptions","useValue","configFactory","configService","IgoConfigModule","APP_INITIALIZER","useFactory","deps","LanguageLoader","prefix","suffix","getTranslation","lang","igoLocale$","appLocale$","forkJoin","translations","acc","defaultLanguageLoader","http","provideDefaultLanguageLoader","loader","TranslateLoader","HttpBackend","IgoMissingTranslationHandler","params","translateService","langs","substr","IgoLanguageModule","TranslateModule","missingTranslationHandler","MissingTranslationHandler","IgoMessageModule","CommonModule","ToastrModule","positionClass","timeOut","extendedTimeOut","titleClass","messageClass","closeButton","progressBar","enableHtml","tapToDismiss","maxOpened","preventDuplicates","resetTimeoutOnDuplicate","countDuplicates","includeTitleDuplicates","MessageType","ERROR","ALERT","WARNING","INFO","SUCCESS","SHOW","LanguageService","translate","language","language$","getBrowserLang","getLanguage","setDefaultLang","setLanguage","combineLatest","use","reloadLang","MessageService","injector","languageService","messages$","activeMessageTranslations","debounceTime","r","toastr","toasts","toast","activeMessageTranslation","find","amt","toastId","translatedTextInterpolateParams","textInterpolateParams","translatedTitleInterpolateParams","titleInterpolateParams","k","instant","textKey","titleKey","first","toastRef","componentInstance","message","title","ToastrService","showError","httpError","caught","messageType","toastrConfig","iconClasses","currentDate","from","to","showIcon","handleTemplate","messageShown","success","info","show","alert","handleNgxToastr","translatedTitlenterpolateParams","translatedTitle","activeToast","warning","removeAllAreNotError","mess","template","html","Injector","i2","ErrorInterceptor","originalReq","interceptError","errorContainer","handleError","handleCaughtError","handleUncaughtError","HttpErrorResponse","errorObj","statusText","url","toDisplay","messageService","IgoErrorModule","parentModule","dbConfig","name","objectStoresMeta","store","storeConfig","keyPath","autoIncrement","storeSchema","keypath","unique","IgoCoreModule","matIconRegistry","domSanitizer","addSvgIconSet","bypassSecurityTrustResourceUrl","HttpClientModule","NgxIndexedDBModule","ROUTE_SERVICE_OPTIONS","RouteService","router","route","centerKey","zoomKey","projectionKey","contextKey","searchKey","visibleOnLayersKey","visibleOffLayersKey","directionsCoordKey","directionsOptionsKey","toolKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","vectorKey","queryParams","decodeURIComponent","location","search","includes","pair","navigate","Media","Mobile","Tablet","Desktop","MediaOrientation","Portrait","Landscape","MediaService","media$","orientation$","breakpointObserver","observe","Breakpoints","HandsetLandscape","matches","HandsetPortrait","TabletLandscape","TabletPortrait","WebLandscape","WebPortrait","getMedia","getOrientation","isTouchScreen","documentElement","isMobile","isDesktop","StorageScope","SESSION","LOCAL","StorageServiceEventEnum","REMOVED","CLEARED","BaseStorage","storageChange$","sessionStorage","getItem","localStorage","set","previousValue","setItem","currentValue","event","removeItem","clear","StorageService","super","getNumber","v","endposition","CompressionService","base64Index","Map","indexBase64","generateBase64Index","compressBlob","blob","Observable","observer","reader","FileReader","readAsDataURL","onload","base64","valueOf","text64","compressed","compressStringBase64","object","decompressBlob","compressedData","decompressed","decompressStringBase64","byteCharacters","atob","byteNumbers","byteArray","Uint8Array","Blob","out","bits","chr","rem","c","j","NetworkService","stateChangeEventEmitter","EventEmitter","onlineSubscription","offlineSubscription","previousMessageId","state","connection","onLine","checkNetworkState","fromEvent","messageObj","emitEvent","emit","ngOnDestroy","currentState","reportState","startWith","RegexService","getAll","IgoActionbarModule","MatButtonModule","MatIconModule","MatTooltipModule","MatMenuModule","MatListModule","MatCardModule","MatCheckboxModule","IgoActionModule","IgoMatBadgeIconModule","MatBadgeModule","IgoCollapsibleModule","ConfirmDialogComponent","dialogRef","confirmMessage","selectors","decls","vars","consts","rf","ctx","close","ConfirmDialogService","dialog","open","disableClose","afterClosed","IgoConfirmDialogModule","imports","MatDialogModule","IgoContextMenuModule","IgoCustomHtmlModule","MatInputModule","DOMService","getDom","dom","_this","_asyncToGenerator","response","err","toPromise","IgoDOMModule","IgoDrapDropModule","IgoDynamicOutletModule","DynamicComponent","componentFactory","componentRef","subscriptions","inputs","inputs$$","subscribers","setTarget","createComponent","updateInputs","updateSubscribers","destroy","unobserveAllInputs","unsubscribeAll","instance","propName","unobserveInput","inputValue","observeInput","setInputValue","onUpdateInputs","prototype","getPrototypeOf","descriptor","getOwnPropertyDescriptor","outputs","emitter","subscriber","_subscriber","observable","values","DynamicComponentService","resolver","componentCls","resolveComponentFactory","IgoDynamicComponentModule","IgoFlexibleModule","IgoFormFormModule","FormsModule","ReactiveFormsModule","IgoFormFieldModule","MatFormFieldModule","MatSelectModule","IgoFormGroupModule","FormService","formBuilder","form","fields","groups","control","group","field","addControl","validator","validators","getValidators","setValidators","disabled","extendFieldConfig","partial","validatorOption","validatorStr","getValidator","Validators","FormFieldService","component","getFieldByType","IgoFormModule","IgoEntitySelectorModule","IgoStopPropagationModule","IgoEntityTablePaginatorModule","MatPaginatorModule","IgoImageModule","IgoEntityTableModule","MatTableModule","MatAutocompleteModule","MatSortModule","MatDatepickerModule","IgoEntityModule","InteractiveTourLoader","jsonURL","allToursOptions","getPathToConfigFile","loadConfigTour","getJSON","data","e","getTourOptionData","toolName","nameInConfigFile","InteractiveTourService","mediaService","interactiveTourLoader","shepherdService","previousStep","nextIndex","isAppHaveTour","haveTour","isToolHaveTourConfig","disabledTourButton","stepConfig","conditions","condition","querySelector","isTourDisplayInMobile","getButtons","buttonKind","classes","getAction","actionName","addProgress","self","nbTry","checkExist","setInterval","getCurrentStep","attachTo","cancel","clearInterval","currentStepElement","getElement","querySelectorAll","classList","add","header","stepsArray","steps","progress","className","innerText","insertBefore","checkNext","tour","service","complete","nextStep","_setupModal","executeAction","step","actionConfig","action","executeActionPromise","waitFor","maxTry","maxWait","getShepherdSteps","shepherdSteps","on","position","popperOptions","modifiers","offset","beforeShowPromise","all","beforeChange","beforeShow","buttons","noBackButton","class","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","hide","onHide","startTour","defaultStepOptions","cancelIcon","enabled","modal","confirmCancel","addSteps","tourObject","start","i3","IgoInteractiveTourModule","IgoKeyValueModule","IgoClickoutModule","IgoListModule","IgoPanelModule","IgoSpinnerModule","MatProgressSpinnerModule","IgoTableModule","CdkTableModule","EntityTableColumnRenderer","Default","HTML","UnsanitizedHTML","Editable","Icon","ButtonGroup","EntityTableScrollBehavior","Auto","Instant","Smooth","EntityTableSelectionState","None","All","Some","getEntityProperty","entity","t","safeObject","getEntityId","meta","idProperty","getEntityTitle","titleProperty","getEntityIcon","icon","iconProperty","EntityStateManager","change$","ReplaySubject","getKey","size","setMany","entities","setAll","update","changes","exclusive","updateMany","updateManyExclusive","reverse","reverseMany","reversedChanges","reverseChanges","updateAll","allKeys","getAllKeys","some","changeKey","entries","bunch","storeKeys","EntityView","source$","values$","values$$","lifted","joins","filter$","filters$","filterIndex","sort$","getKey$","count$","empty$","empty","_index","all$","firstBy","clause","firstBy$","manyBy","manyBy$","sort","createIndex","addFilter","removeFilter","lift","observables$","liftJoinedSource","liftSource","skip","_values","filters","processValues","setValues","sources$","joinData","computeJoinedValue","joinIndex","filterValues","sortValues","clauses","every","v1","v2","valueAccessor","generateIndex","EntityStore","entities$","view","stateView","getProperty","pristine","_pristine","createStateManager","createDataView","createStateView","softClear","updateCount","insert","insertMany","deleteMany","currentRecord","statesAreTheSame","revision","ref","record","newState","currentStateIsEmpty","newStateIsEmpty","EntityStoreWithStrategy","strategies","addStrategy","strategy","activate","_strategy","bindStore","removeStrategy","unbindStore","getStrategyOfType","activateStrategyOfType","deactivateStrategyOfType","deactivate","EntityStoreWatcher","cdRef","innerStateIndex","entities$$","state$$","setChangeDetector","setStore","teardownObservers","setupObservers","detectChanges","onEntitiesChange","onStateChange","changesDetected","storeIndex","innerIndex","storeValue","innerValue","EntityStoreStrategy","stores","active","active$","doDeactivate","doActivate","EntityStoreFilterCustomFuncStrategy","filterStore","unfilterStore","filterAll","unfilterAll","filterClauseFunc","filterId","EntityStoreFilterSelectionStrategy","has","selected","ctx_r0","emptyValue","emptyText","ctx_r1","multiSelectValue","multiText$","record_r3","ctx_r2","titleAccessor","EntitySelectorComponent","selected$","selected$$","watcher","multiAllText","multiNoneText","placeholder","selectedChange","ngOnInit","records","onSelectFromStore","onSelectionChange","multiSelect","_value","updateMultiToggleWithEntities","$event","EntitySelectorComponent_mat_option_3_Template","EntitySelectorComponent_mat_option_4_Template","EntitySelectorComponent_ng_template_5_Template","StopPropagationDirective","onClick","stopPropagation","hostBindings","EntityTablePaginatorComponent","hidePageSize","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","count$$","entitySortChange$$","paginationLabelTranslation$$","entitySortChange$","paginatorOptions","page","paginatorChange","paginator","ngOnChanges","emitPaginator","firstPage","initPaginatorOptions","translateLabels","label","_intl","firstPageLabel","getRangeLabel","rangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","of","startIndex","max","min","viewQuery","MatPaginator","ImageErrorDirective","errorImageUrl","hideError","onError","nativeElement","EntityTableRowDirective","renderer","selectOnClick","highlightSelection","_selected","toggleSelected","scroll","scrollBehavior","addCls","selectedCls","highlightedCls","removeCls","scrollIntoView","scrollMode","behavior","block","inline","cls","addClass","removeClass","SanitizeHtmlPipe","_sanitizer","transform","bypassSecurityTrustHtml","pure","SecureImagePipe","HttpHeaders","activityInterceptor","regexDepot","RegExp","test","responseType","switchMap","onloadend","_r10","ctx_r9","onToggleRows","checked","selectionState_r8","ctx_r7","entityTableSelectionState","EntityTableComponent_th_3_ng_container_1_ng_container_1_Template","ctx_r6","selectionState$","EntityTableComponent_th_3_ng_container_1_Template","selectMany","shiftKey","preventDefault","record_r11","_r14","$implicit","ctx_r13","onShiftToggleRow","rowIsSelected","ctx_r15","onToggleRow","column_r16","tooltip","EntityTableComponent_ng_container_5_ng_container_1_th_1_Template","EntityTableComponent_ng_container_5_ng_container_2_th_1_Template","ctx_r32","getCellClass","record_r31","getValue","ctx_r37","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_ng_template_3_Template","ctx_r34","isImg","_r38","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_Template","ctx_r30","isUrl","_r33","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_Template","ctx_r48","record_r47","ctx_r53","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_ng_template_3_Template","ctx_r50","_r54","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_Template","ctx_r46","_r49","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_Template","_r79","record_r63","ctx_r77","onDateChange","_r76","ctx_r67","_r85","onFocus","onChange","onBlur","_r93","ctx_r91","onValueChange","ctx_r69","getValidationAttributeValue","_r99","ctx_r97","ctx_r70","_r105","ctx_r103","onBooleanValueChange","ctx_r71","option_r110","_r113","ctx_r111","onSelectValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_mat_option_1_Template","ctx_r72","multiple","domainValues","ctx_r73","_r74","option_r119","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_div_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_checkbox_5_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_7_Template","_r122","ctx_r120","onAutocompleteValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_option_10_Template","ctx_r64","formGroup","filteredOptions","ctx_r126","ctx_r131","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_ng_template_3_Template","ctx_r128","_r132","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_td_0_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_Template","ctx_r66","_r127","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_Template","ctx_r62","isEdition","_r65","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_Template","_r147","ctx_r143","record_r142","ctx_r144","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_2_Template","ctx_r141","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_Template","_r162","button_r156","record_r154","ctx_r160","onButtonClick","color","_r167","ctx_r165","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_Template","ctx_r155","editMode","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_Template","ctx_r153","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_Template","columnRenderer_r24","ctx_r19","entityTableColumnRenderer","EntityTableComponent_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_Template","columnIsSortable","getColumnRenderer","ctx_r3","getHeaderClass","record_r173","_r175","ctx_r174","onRowSelect","ctx_r176","onRowClick","ctx_r4","getRowClass","_r178","ctx_r177","ctx_r5","__decorate","Cacheable","maxCacheCount","tslib_es6","w6","Function","EntityTableComponent","_focusMonitor","_elementRef","ngControl","_parentForm","_controlName","_defaultErrorStateMatcher","dateAdapter","UntypedFormGroup","selection$$","dataSource$$","lastRecordCheckedKey","_paginator","dataSource","sortNullsFirst","withPaginator","entityClick","entitySelectChange","entitySortChange","columns","column","visible","selectionCheckbox","MatTableDataSource","fixedHeader","tableHeight","setLocale","handleDatasource","getColumnKeyWithoutPropertiesTag","properties","controls","setValue","option","viewValue","moment","format","enableEdit","validation","mandatory","setControl","parseInt","valueChanges","filterNormalized","normalize","formControlValue","linkColumnForce","date","utc","newKey","disable","unsubscribeStore","firstSelected","firstSelectedStateviewPosition","pageMax","pageToReach","floor","computeSelectionState","getTrackByFunction","refresh","onSort","toggle","selectNode","stopImmediatePropagation","recordIndex","lastRecordChecked","indexes","_record","selectedRecords","selectionCount","sortable","pop","list_id","list_option","edition","validationType","getTableClass","func","headerClassFunc","rowClassFunc","tableFunc","cellClassFunc","columnFunc","clickFunc","features","MatFormFieldControl","useExisting","EntityTableComponent_th_3_Template","EntityTableComponent_td_4_Template","EntityTableComponent_ng_container_5_Template","EntityTableComponent_tr_6_Template","EntityTableComponent_tr_7_Template","EntityTableComponent_igo_entity_table_paginator_8_Template","_c0","Toolbox","activeTool$","toolbar$","activeTool$$","activeToolHistory","tool","tools$","setToolbar","toolbar","initStore","getTool","getTools","setTools","tools","getToolbar","activateTool","activatePreviousTool","deactivateTool","previous","clearActiveToolHistory","setActiveTool","ToolService","toolbox","IgoToolboxModule","IgoToolModule","IgoWidgetOutletModule","WidgetService","dynamicComponentService","widgetCls","IgoWidgetModule","IgoWorkspaceSelectorModule","IgoWorkspaceWidgetOutletModule","IgoWorkspaceModule","ColorPickerFormFieldModule","ActionbarMode","Dock","Overlay","Context","ActionStore","icon$","ActionbarItemComponent_mat_list_item_0_button_4_mat_icon_2_Template","disabled$","withIcon","_r6","ActionbarItemComponent_mat_list_item_0_button_4_Template","ActionbarItemComponent_mat_list_item_0_span_5_Template","withTooltip","tooltip$","ngClass$","withTitle","_r9","ctx_r8","checkCondition$","ActionbarItemComponent_mat_list_item_1_mat_checkbox_4_Template","ActionbarItemComponent","noDisplay$","ngClass$$","disabled$$","availability$$","icon$$","checkCondition$$","tooltip$$","noDisplay$$","display$$","noDisplay","trigger","args","ngClass","updateNgClass","isObservable","updateIcon","checkCondition","updateCheckCondition","updateTooltip","availability","available","ActionbarItemComponent_mat_list_item_0_Template","ActionbarItemComponent_mat_list_item_1_Template","checkbox","_r8","scrollUp","onTriggerAction","toggleCollapseAction","action_r13","_r15","ctx_r14","ctx_r12","ActionbarComponent_mat_list_0_3_ng_template_0_Template","_r17","ctx_r16","scrollDown","ActionbarComponent_mat_list_0_div_1_Template","ActionbarComponent_mat_list_0_igo_actionbar_item_2_Template","ActionbarComponent_mat_list_0_3_Template","ActionbarComponent_mat_list_0_div_4_Template","heightCondition","positionConditionTop","withToggleButton","collapsed","positionConditionLow","action_r20","_r22","ctx_r21","ActionbarComponent_div_1_ng_template_7_Template","_r18","iconColor","overlayClass","xPosition","yPosition","action_r24","_r26","ctx_r25","ctx_r23","ActionbarComponent_mat_card_2_ng_template_2_Template","ActionbarComponent","overlay","elRef","actionbarMode","heightCondition$","positionConditionTop$","positionConditionLow$","mode","horizontal","scrollActive","_overlayClass","isCollapsed","withTitleClass","withIconClass","horizontalClass","clientHeight","scrollHeight","scrollTop","scrollBy","hostVars","ActionbarComponent_mat_list_0_Template","ActionbarComponent_div_1_Template","ActionbarComponent_mat_card_2_Template","LongPressDirective","touchTimeout","touchDuration","onlyIOS","longpress","touchstart","touches","touchEnd","setTimeout","touchend","clearTimeout","DynamicOutletComponent","dynamicComponent","eq","inputsAreEquivalents","subscribersAreEquivalents","renderComponent","ViewContainerRef","DynamicOutletComponent_ng_template_0_Template","IgoFormFieldComponent","compType","formControlIsRequired","required","getControlErrorMessage","messages","errorMessages","errors","getFieldComponent","getFieldInputs","getFieldSubscribers","FormFieldComponent","formFieldService","fieldInputs","fieldSubscribers","fieldOptions","disableSwitch","formControl","FormFieldComponent_ng_container_0_Template","getFieldNgClass","field_r3","FormGroupComponent_div_0_div_1_Template","getErrorMessage","FormGroupComponent","getFieldColSpan","colSpan","cols","ngContentSelectors","FormGroupComponent_div_0_Template","FormGroupComponent_mat_error_3_Template","_r3","onDisableSwitchClick","FormFieldTextComponent","toggleDisabled","enable","FormFieldTextComponent_mat_icon_2_Template","FormFieldTextComponent_mat_error_3_Template","choice_r3","_r5","FormFieldSelectComponent","choices","choices$","FormFieldSelectComponent_mat_option_2_Template","FormFieldSelectComponent_mat_icon_4_Template","FormFieldSelectComponent_mat_error_5_Template","FormFieldTextareaComponent","FormFieldTextareaComponent_mat_icon_3_Template","FormFieldTextareaComponent_mat_error_4_Template","FormComponent","formData","autocomplete","submitForm","hasButtons","children","setData","onSubmit","getData","getAllFormFields","updateDataWithFormField","reset","_c2","FlexibleComponent","main","initial","_initial","_collapsed","expanded","_expanded","initialMobile","_initialMobile","collapsedMobile","_collapsedMobile","expandedMobile","_expandedMobile","_direction","_state","sizes","setSize","transitionTime","mediaService$$","media","height","width","startInteractiveTour","getClass","_r7","discoverTitleInLocale$","InteractiveTourComponent_ng_container_0_button_1_Template","InteractiveTourComponent_ng_container_0_ng_template_2_Template","styleButton","_r2","InteractiveTourComponent","interactiveTourService","toolService","tourToStart","getTourToStart","activeToolName","isActiveTool","isToolHaveTour","showTourButton","inMobileAndShow","InteractiveTourComponent_ng_container_0_Template","SpinnerComponent","shown$","shown","SpinnerActivityDirective","spinner","counter$$","TableDataSource","DataSource","_database","_model","_sort","_filterChange","connect","merge","dataChange","sortChange","getFilteredData","getSortedData","disconnect","filterable","propertyA","propertyB","TableActionColor","primary","accent","warn","_r11","ctx_r10","masterToggle","hasValue","isAllSelected","row_r12","isSelected","TableComponent_ng_container_8_ng_container_1_th_1_Template","TableComponent_ng_container_8_ng_container_2_th_1_Template","ctx_r26","model","row_r27","_c1","TableComponent_ng_container_8_ng_container_3_td_1_Template","ctx_r29","row_r30","TableComponent_ng_container_8_ng_template_4_td_0_Template","TableComponent_ng_container_8_ng_container_1_Template","TableComponent_ng_container_8_ng_container_2_Template","TableComponent_ng_container_8_ng_container_3_Template","TableComponent_ng_container_8_ng_template_4_Template","_r20","action_r34","_r36","row_r32","ctx_r35","handleClickAction","ctx_r33","getActionColor","TableComponent_td_11_button_1_Template","actions","row_r38","_r40","ctx_r39","TableComponent","database","hasFilterInput","_hasFIlterInput","displayedColumns","SelectionModel","displayed","unshift","changed","ngAfterViewInit","colorId","row","MatSort","TableComponent_div_1_Template","TableComponent_th_6_Template","TableComponent_td_7_Template","TableComponent_ng_container_8_Template","TableComponent_th_10_Template","TableComponent_td_11_Template","TableComponent_tr_12_Template","TableComponent_tr_13_Template","TableDatabase","copiedData","ToolComponent","ToolboxColor","White","Grey","Primary","toolSlideInOut","speed","transition","animate","actionStore","toolbarWithTitle$","_r4","onAnimationStart","onAnimationComplete","animation$","tool_r2","getToolInputs","ToolboxComponent","isActive","toolbar$$","animating$","animating$$","classColorGrey","classColorPrimary","onToolbarChange","onActiveToolChange","onAnimate","_tool","_toolbox","activeTool","toolActivated","childrenToolActivated","parent","unAnimate","animation","ToolboxComponent_igo_actionbar_0_Template","ToolboxComponent_div_2_Template","changeDetection","widget","getEffectiveSubscribers","WidgetOutletComponent","baseSubscribers","onCancel","onComplete","destroyWidget","baseSubscriber","WidgetOutletComponent_igo_dynamic_outlet_0_Template","WorkspaceStore","activeWorkspace$","activateWorkspace","workspace","deactivateWorkspace","Workspace","widget$","widgetInputs$","widgetSubscribers$","entityStore","hasWidget","deactivateWidget","activateWidget","WorkspaceSelectorComponent","getWorkspaceTitle","onSelectedChange","widget_r1","ngIf","onWidgetCancel","onWidgetComplete","WorkspaceWidgetOutletComponent","WorkspaceWidgetOutletComponent_ng_container_0_Template","ColorPickerFormFieldComponent","setAlpha","outputFormat","onTouch","hexColor","setFormat","_hexColor","tinycolor","toHexString","writeValue","registerOnChange","fn","registerOnTouched","toRgbString","toHsvString","closePicker","NG_VALUE_ACCESSOR","forwardRef","dep_r2","DocViewerComponent_ng_container_5_li_4_Template","dependencies","DocViewerComponent","subtitle","DocViewerComponent_ng_container_5_Template","AppHomeRoutingModule","RouterModule","forChild","AppHomeComponent","ExampleModule","MatDividerModule","DocViewerModule","SharedModule","MatGridListModule","AppHomeModule","codeUrl","configUrl","SRC_PATH","ExampleViewerComponent","codeFolder","configFolder","ExampleViewerComponent_a_5_Template","ExampleViewerComponent_a_6_Template","AppActivityRoutingModule","AppActivityComponent","idsActivity","counter","AppActivityModule","environment","production","igo","projections","code","alias","def","extent","auth","intern","allowAnonymous","interactiveTour","tourInMobile","importExport","catalog","sources","queryFormat","queryHtmlTarget","regFilters","tooltipType","searchSources","storedqueriesreverse","nominatim","icherche","searchUrl","order","limit","showAdvancedSettings","coordinatesreverse","showInPointerSummary","icherchereverse","ilayer","AppConfigRoutingModule","AppConfigComponent","configLanguage","AppConfigModule","AppLanguageRoutingModule","AppLanguageComponent","app","changeLanguage","AppLanguageModule","AppMediaRoutingModule","AppMediaComponent","orientation","AppMediaModule","AppMessageRoutingModule","AppMessageComponent","AppMessageModule","AppRequestRoutingModule","AppRequestComponent","callHttp","rep","callHttpError","AppRequestModule","AppActionRoutingModule","AppActionComponent","added$","AppActionModule","AppSalutationComponent","AppExplanationComponent","AppDynamicComponentRoutingModule","AppDynamicComponentComponent","toggleComponent","AppDynamicComponentModule","AppEntityTableRoutingModule","AppEntityTableComponent","description","image","AppEntityTableModule","selected_r1","AppEntitySelectorRoutingModule","AppEntitySelectorComponent","getTitle","AppEntitySelectorComponent_div_3_Template","AppEntitySelectorModule","fillForm","clearForm","form_r1","data$","submitDisabled","AppFormRoutingModule","AppFormComponent","formService","form$","valueChanges$$","valid","AppFormComponent_igo_form_2_Template","AppFormModule","AppTableRoutingModule","AppTableComponent","showName","handleSelect","rows","AppTableModule","cursorPointer","PanelComponent","withHeader","_withHeader","PanelComponent_div_0_Template","AppSalutationToolComponent","ChangeDetectorRef","AppAboutToolComponent","AppToolRoutingModule","AppToolComponent","panelTitle","activateSalutationTool","AppToolComponent_button_3_Template","AppToolComponent_button_5_Template","AppToolModule","AppSalutationWidgetComponent","AppWidgetRoutingModule","AppWidgetComponent","widgetService","AppWidgetModule","TokenService","tokenKey","token","jwtDecode","isExpired","jwt","currentTime","getTime","exp","AuthService","tokenService","authenticate$","logged$","redirectUrl","languageForce","anonymous","hasAuthService","authenticated","globalCacheBusterNotifier","login","username","password","myHeader","encodePassword","loginCall","loginWithToken","infosUser","typeConnection","loginAnonymous","post","tap","logout","isAuthenticated","getToken","decodeToken","goToRedirectUrl","loginRoute","navigateByUrl","homeRoute","getUserInfo","getProfils","updateUser","user","patch","logged","isAnonymous","isAdmin","tokenDecoded","locale","i4","AuthGoogleComponent","authService","appRef","apiKey","clientId","loadSDKGoogle","loadPlatform","handleSignInClick","gapi","auth2","getAuthInstance","signIn","handleSignOutClick","signOut","handleClientLoad","initClient","client","init","discoveryDocs","then","updateTextButton","isSignedIn","listen","updateSigninStatus","loginGoogle","access_token","btn","innerHTML","tick","fjs","getElementsByTagName","js","loading","AuthInternComponent","_allowAnonymous","fb","loginUser","errorMsg","AuthInternComponent_button_18_Template","AuthInternComponent_div_19_Template","AuthFacebookComponent","appId","loadSDKFacebook","subscribeEvents","FB","Event","statusChangeCallback","loginFacebook","authResponse","accessToken","getElementById","AuthMicrosoftComponent","msalService","msalGuardConfig","_destroying$","broadcastService","PublicClientApplication","cache","cacheLocation","MsalBroadcastService","inProgress$","InteractionStatus","takeUntil","checkAccount","loginMicrosoft","loginPopup","getConf","authRequest","setActiveAccount","account","acquireTokenSilent","tokenId","idToken","catch","_ref","InteractionRequiredAuthError","acquireTokenPopup","_x","apply","arguments","conf","MSAL_GUARD_CONFIG","MsalServiceb2c","redirectHash","logger","hash","initializeWrapperLibrary","WrapperSKU","Angular","initialize","request","acquireTokenRedirect","silentRequest","handleRedirectObservable","handleRedirectPromise","loginRedirect","logoutRequest","logoutRedirect","logoutPopup","ssoSilent","getLogger","setLogger","MSAL_INSTANCE","MsalBroadcastServiceb2c","msalInstance","_msalSubject","msalSubject$","_inProgress","asObservable","Startup","addEventCallback","EventMessageUtils","getInteractionStatusFromEvent","verbose","eventType","AuthMicrosoftb2cComponent","browserAuthOptions","loginMicrosoftb2c","onLogin","_r13","_r19","ctx_r18","AuthFormComponent_div_0_div_2_igo_auth_google_4_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoft_5_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoftb2c_6_Template","AuthFormComponent_div_0_div_2_igo_auth_facebook_7_Template","AuthFormComponent_div_0_div_2_igo_auth_intern_8_Template","google","microsoft","microsoftb2c","facebook","_r21","ctx_r20","_r24","home","AuthFormComponent_div_0_div_4_button_4_Template","AuthFormComponent_div_0_div_1_Template","AuthFormComponent_div_0_div_2_Template","AuthFormComponent_div_0_div_3_Template","AuthFormComponent_div_0_div_4_Template","backgroundDisable","showLoginDiv","showAlreadyConnectedDiv","showLogoutDiv","AuthFormComponent","isLogoutRoute","_backgroundDisable","hasAlreadyConnectedDiv","_hasAlreadyConnectedDiv","hasLogoutDiv","_hasLogoutDiv","_showAlreadyConnectedDiv","_showLogoutDiv","isLoginRoute","analyzeRoute","getName","logoutRoute","firstName","sourceId","events","NavigationStart","changeEvent","currentRoute","AuthFormComponent_div_0_Template","AuthInterceptor","refreshInProgress","trustHosts","hostsWithCredentials","hostsWithAuthByKey","hostname","withCredentials","handleHostsWithCredentials","hostWithKey","handleHostsAuthByKey","refreshToken","href","host","authReq","hashUser","Md5","hashStr","interceptXhr","xhr","setRequestHeader","alterUrlWithKeyAuth","urlDecomposed","urlWithKeyAdded","paramsToKeep","reqUrl","hostWithCredentials","domainRegFilters","hostWithAuthByKey","keyProperty","keyValue","MSALConfigFactory","msConf","redirectUri","authority","MSALConfigFactoryb2c","MSALAngularConfigFactory","interactionType","InteractionType","Popup","scopes","loginHint","MSALAngularConfigFactoryb2c","provideAuthMicrosoft","MsalService","AuthStorageService","userIgo","preference","mergePreference","IgoAuthModule","MsalModule","AppAuthFormRoutingModule","AppAuthFormComponent","AppAuthFormModule","IgoMetadataModule","generateIdFromSourceOptions","wms","generateWMSIdFromSourceOptions","wmts","generateWMTSIdFromSourceOptions","xyz","generateXYZIdFromSourceOptions","feature","generateFeatureIdFromSourceOptions","wfs","generateWfsIdFromSourceOptions","arcgisrest","generateArcgisRestIdFromSourceOptions","imagearcgisrest","tilearcgisrest","osm","_options","tiledebug","generateId","layers","LAYERS","chain","standardizeUrl","layer","featureTypes","origin","urlStandardized","dataService","ol","legend","createOlSource","getLegend","setLegend","FeatureDataSource","sourceOptions","getSourceFormatFromOptions","olSourceVector","olFormatCls","formatType","olformat","formatOptions","onUnwatch","queryTitle","OSMDataSource","olSourceOSM","XYZDataSource","olSourceXYZ","OgcFilterOperatorType","BasicNumericOperator","Basic","BasicAndSpatial","Spatial","Time","OgcFilterOperator","BBOX","PropertyIsBetween","Contains","During","PropertyIsEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","Intersects","PropertyIsNull","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsLike","PropertyIsNotEqualTo","Within","And","Or","Not","OgcFilterWriter","filterSequence","operators","spatial","fieldRestrict","defineOgcFiltersDefaultOptions","ogcFiltersOptions","fieldNameGeometry","srcType","ogcFiltersDefaultValue","editable","geometryName","advancedOgcFilters","pushButtons","checkboxes","radioButtons","buildFilter","proj","ourBboxFilter","enableBbox","filterAssembly","olfilter","getCode","checkIgoFiltersProperties","bundleFilter","wfsOptions","srsName","featureNS","featurePrefix","query","olFormatWFS","writeGetFeature","XMLSerializer","serializeToString","filterObject","logicalArray","createFilter","operator","logical","filterOptions","wfsPropertyName","propertyName","wfsPattern","pattern","wfsMatchCase","matchCase","wfsWildCard","wildCard","wfsSingleChar","singleChar","wfsEscapeChar","escapeChar","wfsLowerBoundary","lowerBoundary","wfsUpperBoundary","upperBoundary","wfsGeometryName","wfsExtent","wfsWktGeometry","wkt_geometry","wfsSrsName","wfsBegin","parseFilterOptionDate","begin","minDate","wfsEnd","end","maxDate","wfsExpression","expression","geometry","olFormatWKT","readGeometry","dataProjection","featureProjection","defineInterfaceFilterSequence","level","addInterfaceFilter","computeAllowedOperators","defaultOperatorsType","allowedOperators","fieldsHasSpatialOperator","includeContains","effectiveOperators","srcField","allowedOperatorsType","igoOgcFilterObject","parentLogical","filterid","sliderOptions","igoSpatialSelector","igoSNRC","filterArray","addFilterProperties","rebuiltIgoOgcFilterObjectFromSequence","sequence","nextElement","lastProcessedFilter","lastParentLogical","uiFilter","computeIgoSelector","computedSelectors","selector","bundles","bundle","selectorType","selectorGroup","handleOgcFiltersAppliedValue","ogcFilters","filterQueryStringSelector","filterQueryStringAdvancedFilters","pushConditions","formatGroupAndFilter","checkboxConditions","selectorsCorr","verifyMultipleEnableds","radioConditions","selectConditions","filterQueryString","formatProcessedOgcFilter","enableds","list","selectorBundle","g","bundleCondition","selectorsType","ogcselector","enabledSelector","processedFilter","layersOrTypenames","appliedFilter","layerOrTypenames","defaultValue","isValid","defaultEpsg","defaultMaxFeatures","defaultWfsVersion","defaultFieldNameGeometry","gmlRegex","buildUrl","randomParam","paramsWFS","queryStringValues","formatWFSQueryString","igoFilters","ogcFilterWriter","filterOrBox","filterOrPush","xmlFilter","baseUrl","download","dynamicUrl","dataSourceOptions","epsg","forceDefaultOutputFormat","versionWfs200","urlWfs","effectiveCount","effectiveStartIndex","epsgCode","paramMaxFeatures","cnt","maxFeatures","srs","valueReference","sourceFields","fieldsNames","sourcefield","separator","getFeature","getpropertyvalue","checkWfsParams","wfsDataSourceOptions","getFormatFromOptions","OlFormat","gmlFormat","olFormatGML2","olFormatGML32","olFormatGML3","olFormatOSMXML","WFSDataSource","wfsService","authInterceptor","mostRecentIdCallOGCFilter","sf","getSourceFieldsFromWFS","setOgcFilters","resolution","wfsProj","olProjection","currentExtent","olproj","OlLoadingStrategy","triggerEvent","notify","DataService","WFSService","defineFieldAndValuefromWFS","getfeatureSourceField","wfsGetFeature","nb","d","fieldList","fieldListWoGeom","fieldListWoGeomStr","olFormats","effectiveOlFormats","gmlDataSourceOptions","sourceFieldsToRetrieveValues","concatMap","allowGml","firstFeature","readFeatures","getKeys","getGeometryName","processingArray","chunkSize","results","mfeatures","loopFeatures","built_properties_value","kv","getProperties","boundedBy","fieldType","featureProperties","QueryFormat","GML2","GML3","GEOJSON","GEOJSON2","ESRIJSON","TEXT","HTMLGML2","QueryFormatMimeType","QueryHtmlTarget","IFRAME","BLANK","WMSDataSource","mapLabel","timeFilter","timeFilter$","sourceParams","dpi","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","wfsCheckup","buildDynamicDownloadUrlFromParamsWFS","sourceField","initOgcFilters","calendarModeYear","FILTER","updateParams","timeFilterableDataSourceOptions","timeFilterable","setTimeFilter","igoRefresh","asWFSDataSourceOptions","olSourceImageWMS","ratio","scale","projParam","contentDependent","projection","contentDependentLegend","VERSION","currentStyle","createDefaultTileGrid","projectionExtent","getExtent","extentGetWidth","resolutions","matrixIds","z","olTileGridWMTS","extentGetTopLeft","WMTSDataSource","tileGrid","olSourceWMTS","CartoDataSource","crossOrigin","olSourceCarto","htmlString","layerOptions","types","oneType","cartocss","colors","layer_name","ArcGISRestDataSource","esrijsonFormat","olFormatEsriJSON","attributions","overlaps","time","customParams","bind","olloadingstrategy","legendInfo","svg","legendElement","htmlImgSrc","contentType","imageData","uniqueValueInfos","symbol","createSVG","stroke","strokeWidth","outlineColor","outline","fill","ImageArcGISRestDataSource","renderingRule","ImageArcGISRest","layerId","TileArcGISRestDataSource","olSourceTileArcGISRest","TileDebugDataSource","baseOptions","TileGrid","TileDebug","WebSocketDataSource","ws","createWebSocket","WebSocket","onmessage","onMessage","onclose","onClose","onerror","onopen","onOpen","featureAdded","readFeature","featureToRemove","getFeatureById","getId","removeFeature","addFeature","MVTDataSource","mvtFormat","featureClass","olFormatMVT","olSourceVectorTile","ClusterDataSource","olSourceCluster","stringToLonLat","str","mapProjection","opts","lonLat","coordStr","negativeLon","degreesLon","minutesLon","secondsLon","directionLon","decimalLon","negativeLat","degreesLat","minutesLat","secondsLat","directionLat","decimalLat","zone","radius","lon","lat","projectionStr","projectionRegex","lonlatCoord","lonLatPattern","lonLatRegex","dmsCoord","dmsCoordPattern","dmsRegex","patternUtm","utmRegex","patternMtm","mtmRegex","ddCoord","patternDd","ddRegex","dmdCoord","patternDmd","dmdRegex","patternBELL","bellRegex","mmCoord","mmPattern","mmRegex","isXYCoords","toLocaleUpperCase","trim","parseFloat","convertDMSToDD","epsgUtm","epsgMtm","forceNA","dest","abs","degrees","minutes","seconds","neg","dd","convertDDToDMS","lonLatDD","lonLatDMS","ceil","int","toFixed","formatScale","getResolutionFromScale","inchesPerMeter","ctrlKeyDown","originalEvent","altKey","MAC","metaKey","ctrlKey","roundCoordTo","coord","roundCoordToString","EsriStyleGenerator","_converters","_renderers","esriPMS","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","_convertPointToPixel","point","_transformColor","_getResolutionForScale","units","mpu","rotation","_transformAngle","angle","olstyle","font","weight","family","textBaseline","verticalAlignment","textAlign","horizontalAlignment","offsetX","xoffset","offsetY","yoffset","_convertOutline","lineDash","ol3Rad","PI","points","radius2","_convertLabelingInfo","labelingInfo","mapUnits","styles","ii","labelExpression","maxScale","minScale","minResolution","maxResolution","getText","setText","defaultSymbol","defaultStyle","classBreakInfos","classBreakInfo","classMinValue","minValue","classMaxValue","field1","infos","me","generateStyle","layerInfo","drawingInfo","styleFunctions","drawingInfoStyle","labelingInfoStyleFunctions","TimeFilterType","DATE","TIME","DATETIME","YEAR","TimeFilterStyle","CALENDAR","SLIDER","MapService","getMap","setMap","TypeCapabilities","CapabilitiesService","mapService","parsers","WMSCapabilities","WMTSCapabilities","esriJSON","EsriJSON","getWMSOptions","getCapabilities","capabilities","parseWMSOptions","getWMTSOptions","parseWMTSOptions","getCartoOptions","jsonp","mapId","cartoOptions","parseCartoOptions","getArcgisOptions","serviceCapabilities","arcgisOptions","parseArcgisOptions","getImageArcgisOptions","legendUrl","parseTileOrImageArcgisOptions","getTileArcgisOptions","fromObject","_i","read","findDataSourceInCapabilities","Capability","Layer","metadata","DataURL","abstract","Abstract","keywordList","KeywordList","queryable","getTimeFilter","legendOptions","Style","getStyle","isExtentInGeographic","EX_GeographicBoundingBox","queryFormatMimeTypePriority","Request","GetFeatureInfo","Format","keyEnum","_layerOptionsFromSource","Title","MaxScaleDenominator","MinScaleDenominator","OnlineResource","extern","stepDate","Contents","Identifier","optionsFromCapabilities","ouputOptions","layer_definition","olAttribution","copyrightText","timeExtent","timeInfo","setTime","toUTCString","serviceDescription","displayField","layerName","layerArray","Name","dimension","Dimension","minMaxDim","stylesAvailable","ProjectionService","registerProjection","utmZone","mtmZone","lon0","proj4","defs","olproj4","setExtent","OptionsService","DataSourceService","capabilitiesService","optionsService","wfsDataSourceService","projectionService","datasources$","createAsyncDataSource","context","detailedContextUri","createOSMDataSource","createFeatureDataSource","createWFSDataSource","wmsContext","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","observables","optionsFromApi","optionsMerged","getArcgisRestOptions","i5","i6","geoDBService","layerDBService","legendCollapsed","firstLoadComponent","olLoadingProblem","hasBeenVisible$","hasBeenVisible$$","resolution$$","isIgoInternalLayer","zIndex","getZIndex","setZIndex","baseLayer","opacity","setOpacity","isInResolutionsRange","isInResolutionsRange$","setMaxResolution","updateInResolutionsRange","getMaxResolution","setMinResolution","getMinResolution","setVisible","visible$","showOnEachLayerVisibility","showMessage","displayed$","showInLayerList","createOlLayer","maxScaleDenom","minScaleDenom","unobserveResolution","observeResolution","viewController","resolution$","getResolution","LinkedProperties","OPACITY","VISIBLE","OGCFILTERS","MINRESOLUTION","MAXRESOLUTION","ZINDEX","TIMEFILTER","TooltipType","TITLE","ABSTRACT","CUSTOM","ImageWatcher","loaded","handleLoadStart","handleLoadEnd","handleLoadError","un","__watchers__","watcherIndex","params_","TileWatcher","tile","VectorWatcher","olSource","getUrl","ImageLayer","valStatus","olOptions","olLayerImage","getSource","setImageLoadFunction","customLoader","interceptor","XMLHttpRequest","alteredUrlWithKeyAuth","abort","getImage","arrayBufferView","TextDecoder","imageUrl","URL","createObjectURL","send","TileLayer","tileLayer","olLayerTile","tileSource","setTileLoadFunction","modifiedUrl","FEATURE","FeatureMotion","Move","Zoom","featureToOl","projectionOut","olFeature","OlFormatGeoJSON","setId","mapTitle","getEntityRevision","featureFromOl","projectionIn","olLayer","exclude","excludeOffline","idColumn","olFormat","writeGeometryObject","getGeometry","excludeAttribute","excludeAttributeOffline","getRevision","computeOlFeaturesExtent","olFeatures","olextent","featureExtent","computeOlFeatureExtent","olExtent","olFeatureExtent","olFeatureProjection","olGeometry","scaleExtent","featuresAreOutOfView","featuresExtent","edgeRatio","edgesRatio","viewExtent","featuresAreTooDeepInView","areaRatio","mapExtent","mapExtentArea","featuresExtentArea","getZoom","moveToOlFeatures","motion","getOlProjection","zoomToExtent","moveToExtent","hideOlFeature","setStyle","tryBindStoreLayer","VectorLayer","bindLayer","addLayer","FeatureStore","searchDocument","_searchDocument","setLayerFeatures","viewScale","checkLayer","setLayerOlFeatures","setStoreOlFeatures","clearLayer","computeOlFeaturesDiff","olFeaturesMap","olFeaturesToRemove","newOlFeature","olFeaturesToAddIds","getFeatures","removeOlFeaturesFromLayer","addOlFeaturesToLayer","setLayerExtent","viewProjection","addFeatures","FeatureStoreInMapExtentStrategy","stores$$","states$$","empty$$","watchStore","skipWhile","updateEntitiesInExtent","unwatchStore","unwatchAll","state$","inMapExtent","entitiesInMapExtent","entitiesWithNoGeom","FeatureStoreInMapResolutionStrategy","updateEntitiesInResolution","mapResolution","inMapResolution","GeoPropertiesStrategy","propertyTypeDetectorService","updateEntitiesPropertiesState","layers$","pairwise","prevLayers","currentLayers","prevLayersId","layersId","geoService","firstN","distinctValues","containGeoServices","entry","valuedAreGeoservices","isGeoService","geoServiceAssociations","getGeoService","propertiesForLayerName","propertyForLayerName","urlProperty","layerNameProperty","geoServiceStates","geoServiceAssociation","arcgisLayerName","appliedLayerName","potentialLayerId","LAYER","haveGeoServiceProperties","geoServiceState","urlValue","layerNameValue","entitiesToProcess","FeatureStoreLoadingStrategy","setMotion","subscription","onFeaturesChange","selectMotion","getFeatureId","FeatureStoreLoadingLayerStrategy","onSourceChanges","flatMap","cluster","OlDragSelectInteraction","OlDragBoxInteraction","FeatureStoreSelectionStrategy","mapClickListener","olDragSelectInteraction","olDragSelectInteractionEndKey","overlayStore","_overlayStore","createOverlayStore","unselectAll","deactivateSelection","unlistenToMapClick","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","removeOverlayLayer","stores$","onMapClick","unByKey","getFeaturesAtPixel","pixel","hitTolerance","layerFilter","onSelectFromMap","olInteractions","getInteractions","getArray","olInteraction","addInteraction","onDragBoxEnd","removeInteraction","mapBrowserEvent","getFeaturesInExtent","overlayFeaturesKeys","featuresKeys","doMotion","groupedFeatures","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","overlayLayer","createOverlayLayer","exportable","browsable","removeLayer","FeatureStoreSearchIndexStrategy","initStoreSearchIndex","Document","tokenize","onEntitiesChanges","percentDistinctValueRatio","featuresProperties","fp","igoSearchID","toIndex","columnsToNotIndex","contentToIndex","searchIndex","sf2","columnsToIndex","propertiesToIndex","tryAddLoadingStrategy","tryAddSelectionStrategy","createOverlayMarkerStyle","markerColor","markerOutlineColor","svgIconColor","svgOutlineColor","newColor","ColorAsArray","newOutlineColor","anchor","overflow","StyleService","createStyle","olStyle","parsedStyle","parseStyle","labelMinResolution","labelMaxResolution","labelMinResolutionFromScale","labelMaxResolutionFromScale","attribute","getLabel","styleOptions","olCls","getOlCls","_key","olKey","getOlKey","createStyleByAttribute","styleByAttribute","guessTypeFeature","labelStyle","baseStyle","val","OlFeature","createClusterStyle","clusterParam","layerStyle","clusterRanges","minRadius","maxRadius","showRange","dynamicRadius","clusterRadius","radiusMin","getRadius","image_","setRadius","radiusCalc","labelMatch","labelToGet","matchAll","getType","createOverlayLayerStyle","createOverlayDefaultStyle","markerStyle","createBufferStyle","strokeRGBA","fillRGBA","bufferRadius","customStyle","fillColor","strokeColor","fillWithOpacity","strokeWithOpacity","overlayDataSource","setFeatures","removeOlFeature","addOlFeatures","addOlFeature","removeFeatures","LayerWatcher","propertyChange$","unwatchLayer","setPropertyChange","watchLayer","evt","layer$$","MapViewAction","MapController","olMap","observerKeys","getOlMap","setOlMap","MapViewController","rotation$","padding","maxZoomOnExtent","maxLayerZoomExtent","extent$","extent$$","states","stateIndex","stateHistory","olView","getView","setPadding","top","right","bottom","left","onMoveEnd","monitorRotation","getRotation","getProjection","getCenter","center","calculateExtent","getSize","getScale","getScaleFromResolution","unit","getUnits","zoomIn","zoomTo","zoomOut","zoom","cancelAnimations","duration","easing","oleasing","resetRotation","hasPreviousState","hasNextState","previousState","setStateIndex","nextState","clearStateHistory","setInitialState","fromCenter","toCenter","distCenter","sqrt","fromExtent","fromSize","xSize","maxZoom","fit","isFinished","setState","viewStatesAreEqual","state1","state2","tolerance","trunc","GeolocationOverlayType","Position","PositionDirection","Accuracy","Buffer","MapGeolocationController","storageService","arrowRotation","subscriptions$$","geolocationOverlay","positionFeatureStyle","accuracyFeatureStyle","bufferStyle","buffer","bufferStroke","bufferFill","showBufferRadius","arrowStyle","displacement","rotateWithView","geolocation","emissionIntervalSeconds$","position$","tracking$","followPosition$","lastPosition","_buffer","handleFeatureCreation","accuracyThreshold","_accuracyThreshold","olGeolocation","tracking","getTracking","setTracking","followPosition","_followPosition","deleteGeolocationFeatures","deleteFeatureByType","onPositionChange","trackingOptions","enableHighAccuracy","maximumAge","timeout","interval","updateArrowFeatureOrientation","position4326","coordinates","dateTime","arrowFeature","getFeatureByType","isMoving","distanceBetweenPoints","accuracy","theta","atan2","coord1","coord2","olSphere","addOnChangedListener","listener","deleteChangedListener","updateGeolocationOptions","geolocate","alwaysTracking","storedTracking","storedFollowPosition","geolocateProperties","altitude","altitudeAccuracy","heading","timestamp","handleViewFromFeatures","featureById","positionGeometry","Point","accuracyGeometry","fromCircle","OlCircle","positionFeature","positionFeatureArrow","accuracyFeature","positionFeatureExists","positionFeatureArrowExists","accuracyFeatureExists","setGeometry","bufferFeature","bufferFeatureExists","bufferGeometry","edgeRatios","areOutOfView","getLinkedLayersOptions","linkedLayers","getIgoLayerByLinkId","linkId","getRootParentByProperty","layerToUse","parentLayer","hasParentLayer","getDirectParentLayerByProperty","layerHasLinkWithProperty","hasLinkWithProperty","layerLLOptions","links","currentLinkId","parents","pl","linkedIds","getDirectChildLayersByProperty","link","lid","getAllChildLayersByProperty","knownChildLayers","childLayers","cl","getDirectParentLayerByDeletion","syncedDelete","getDirectChildLayersByDeletion","getAllChildLayersByDeletion","initLayerSyncFromRootParentLayers","rootLayersByProperty","plbp","IgoMap","forcedOffline$","layersAddedByClick$","queryResultsOverlay","searchResultsOverlay","geolocationController","swipeEnabled$","mapCenter$","selectedFeatures$","bufferDataSource","layerWatcher","mapViewOptions","defaultOptions","attribution","projectionCode","olControlAttribution","scaleLine","olControlScaleLine","interactions","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","olinteraction","setView","once","pc","handleLayerPropertyChange","propertyChange","initiatorIgoLayer","isLayerProperty","isDatasourceProperty","rootParentByProperty","clbp","resolutionPropertyHasChanged","initiatorIgoLayerSourceType","initiatorIgoLayerOgcFilterableDataSourceOptions","getUid","lLayerType","appliedOgcFilter","getParams","appliedTimeFilter","updateView","viewOptions","constrainResolution","updateControls","getControls","removeControl","changeBaseLayer","bl","getBaseLayers","setMinZoom","minZoom","setMaxZoom","getLayerById","getLayerByAlias","getLayerByOlUId","olUId","getLayerByOlLayer","addLayers","offsetZIndex","offsetBaseLayerZIndex","addedLayers","doAddLayer","setLayers","removeLayers","newLayers","layersToRemove","removeLayerFromIDB","handleLinkedLayersDeletion","linkedLayer","linkedIndex","doRemoveLayer","srcLayer","rootParentByDeletion","getRootParentByDeletion","layerHasLinkDeletion","hasLinkWithSyncedDelete","clbd","removeAllLayers","raiseLayer","getLayerIndex","moveLayer","raiseLayers","lowerLayer","lowerLayers","reverseLayers","layerTo","zIndexFrom","existingLayer","maxZIndex","sortLayersByZIndex","layer1","layer2","_layer","MapBrowserComponent","activityId","_view","_controls","PointerPositionDirective","lastTimeoutRequest","pointerMoveListener","pointerPositionDelay","pointerPositionCoord","listenToMapPointerMove","unlistenToMapPointerMove","onPointerEvent","delay","dragging","lonlat","coordinate","featureRandomStyleFunction","circle","cos","featureRandomStyle","hoverFeatureMarkerStyle","olStyles","backgroundFill","backgroundStroke","pointerPositionSummaryMarkerStyle","HoverFeatureDirective","styleService","pointerHoverFeatureStore","store$$","layers$$","selectionLayer","selectionMVT","mvtStyleOptions","singleClickMapListener","hoverFeatureId","igoHoverFeatureDelay","igoHoverFeatureEnabled","mouseout","subscribeToPointerStore","olLayerVectorTile","renderMode","declutter","olVectorTileSource","createHoverStyle","hoverStyle","localHoverStyle","hasLabelStyle","unsubscribeToPointerStore","unlistenToMapSingleClick","resultsUnderPointerPosition","addFeatureOverlay","onMapEvent","onMapSingleClickEvent","topMostOlLayer","maximumZindex","getPixelFromCoordinate","forEachFeatureAtPixel","mapFeature","layerOL","igoLayer","ol_uid","canProcessHover","olLayerVector","myLayerVector","localOlFeature","handleRenderFeature","setLayerStyleFromOptions","featuresToLoad","myLabelOlFeature","setProperties","labelGeom","OlGeom","myLayerVectorTile","igoStyle","setSource","mvtFeatures","localFeature","RenderFeature","hoverEntity","hoverSummary","getHoverSummary","summary","geom","getOrientedFlatCoordinates","coords","flatCoords","idx","zoneMtm","lonMin","deltaLon","zoneUtm","computeProjectionsConstraints","projectionsLimitations","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","InsertSourceInsertDBEnum","System","User","geoNetworkService","trackFeatureListenerId","initialOpacityValue","initialVisibleValue","initialMinResValue","initialMaxResValue","so","preload","bypassResolution","bypassVisible","flash","idbInfo","storeToIdb","firstLoad","maintainFeaturesInIdb","trackFeature","enableTrackFeature","vector","vectorSource","failure","customWFSLoader","setLoader","idbLoader","customIDBLoader","maintainOptionsInIdb","zip","deleteByKey","igoStyleObject","olStyleToBasicIgoStyle","layerOlStyle","getFill","getColor","getStroke","layerData","contextUri","insertEvent","dsFeatures","geojsonObject","writeFeatures","listenerKey","vectorContext","getVectorContext","frameState","flashGeom","elapsed","elapsedRatio","easeOut","getStyleFunction","style2","styleClone","setColor","setWidth","getWidth","drawGeometry","render","stopAnimation","centerMapOnFeature","feat","setCenter","getCoordinates","disableTrackFeature","alteredUrl","nbOfFeature","threshold","idAssociatedCall","removeLoadedExtent","responseText","getFormat","DOMParser","parseFromString","readProjection","responseXML","layerID","VectorTileLayer","vectorTile","vectorTileSource","onLoad","computeMVTOptionsOnHover","vectorTileLayerOptions","GeoDBService","ngxIndexedDBService","compression","dbName","collisionsMap","_newData","regionID","insertSource","compress","subject","geoDBData","object$","getByID","dbObject","currentRegionID","collisions","customUpdate","deleteRequest","isDeleted","getRegionCountByID","getRegionByID","datas","IDBKey","IDBKeyRange","only","getAllByIndex","deleteByRegionID","dbRequest","openCursor","keyRange","lowerBound","DBMode","openCursorByIndex","resetCounters","resetCollisionsMap","revertCollisions","getByKey","take","newData","GeoNetworkService","networkService","networkOnline","simpleGetOptions","getOnline","getOffline","isOnline","LayerDBService","layerDBData","LayerService","dataSourceService","createLayer","createTileLayer","createVectorLayer","createImageLayer","_layerOptions","createVectorTileLayer","createAsyncLayer","handleLegacyStyles","serviceStyle","clusterBaseStyle","layerOptionsOl","applyMapboxStyle","legacyStyleOptions","legacyOption","mapboxStyle","getStuff","sprite","getAbsoluteUrl","res2","stylefunction","createAsyncIdbLayers","layersOptions","idbl","i7","CatalogItemType","Group","TypeCatalog","baselayers","composite","QueryService","queryEnabled","defaultFeatureCount","featureCount","previousMessageIds","queryLayer","getQueryUrl","urlGml","mergeMap","gmlRes","mergedGML","mergeGML","imposedGeom","imposedProperties","extractData","urlGmls","checkScaleAndResolution","requestDataForHTMLGML2","checkScale","checkResolution","olmline","olgeom","pts","ptsArray","firstFeatureType","olmpoly","nbFeatures","bbox","getQueryParams","bboxExtent","titleContent","queryTileField","olmpts","returnGeometry","queryTitleContent","featureGeometryCoordinates","featureGeometryType","appendLineString","appendPolygon","convexHull","cross","lower","upper","imposedGeometry","queryDataSource","allowedFieldsAndAlias","getAllowedFieldsAndAlias","extractGML3Data","extractGeoJSONData","extractEsriJSONData","extractTextData","extractHtmlData","extractGML2Data","geomToAdd","createGeometryFromUrlClick","wmsDatasource","FEATURE_COUNT","getQueryTitle","sourceTitle","searchParams","bboxRaw","clickx","clicky","clickx1","clicky1","wktPoly","wmsParser","featureToResult","parser","htmlTarget","crs","bodyTagStart","bodyTagEnd","lastIndexOf","striptags","queryString","pairs","featureOL","featureGeometry","GEOMETRIE","shape","SHAPE","SHAPE_S","SHAPE_L","SHAPE_P","the_geom","geom32198","datasource","forceGML2","queryUrls","getCustomQueryUrl","WMSGetFeatureInfoOptions","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","getFeatureInfoUrl","sql","queryPrecision","tileArcGISRestDatasource","deltaX","deltaY","mime","getLabelMatch","layerIsQueryable","olLayerFeatureIsQueryable","layerFeatureIsQueryable","queryLayerFeatures","QueryDirective","queryService","queries$$","queryFeatures","queryFeaturesHitTolerance","queryFeaturesCondition","waitForAllQueries","cancelOngoingQueries","queries$","doQueryFeatures","queryLayers","query$","clickedFeatures","values_","queryFormatAsWms","newFeature","nom","id_","_icon","OlRenderFeature","renderFeatureFromOl","olRenderFeature","geometryType","ends","getEnds","OlPolygon","getFlatCoordinates","OlPoint","OlLineString","dragExtent","forEachFeatureIntersectingExtent","olDragSelectInteractionOnQuery","SearchSource","getDefaultOptions","showInSettings","settings","featureStoresWithIndex","storesWithIndex","_featureStoresWithIndex","setWorkspaces","workspaces","fw","datasets","setParamFromSetting","setting","saveInStorage","confValue","displayOrder","storageOptions","getHashtagsValid","term","settingsName","hashtags","searchSourceSetting","getSettingsValues","hashtagsValid","hashtag","hashtagKey","QuerySearchSource","GoogleLinks","getGoogleMapsCoordLink","getGoogleStreetViewLink","getGoogleMapsNameLink","encodeURI","OsmLinks","getOpenStreetMapLink","getOpenStreetCamLink","PropertyTypeDetectorService","regexService","geoServiceRegexes","getGeoServiceRegexes","getPropertyType","geoServiceRegex","availableProperties","matchingGeoservice","Catalog","removable","externalProvider","forcedProperties","matrixSet","requestEncoding","groupImpose","groupSeparator","sortDirection","setCrossOriginAnonymous","showLegend","profils","WMSCatalog","_collectCatlogItems","collectCatalogItems","WMTSCatalog","BaselayersCatalog","ArcGISRestCatalog","TileOrImageArcGISRestCatalog","typeCatalog","CompositeCatalog","CatalogService","loadCatalogs","contextConfig","catalogConfig","apiUrl","catalogsFromConfig","baseLayers","baseLayersCatalog","catalogsFromApi$","catalogs","_response","EMPTY","loadCatalogItems","newCatalog","CatalogFactory","createInstanceCatalog","loadCatalogBaseLayerItems","getCatalogBaseLayersOptions","loadCatalogWMSLayerItems","getCatalogCapabilities","Service","finalLayers","flattenWmsCapabilities","capabilitiesCapabilityLayer","includeRecursiveItems","modifiedParent","modifiedLayer","ff","loadCatalogWMTSLayerItems","getWMTSItems","loadCatalogArcGISRestItems","getArcGISRESTItems","loadCatalogCompositeLayerItems","compositeCatalog","catalogsFromInstance","request1$","request2$","flatDeepLayer","arr","pushImposeGroup","outGroupImpose","address","flatLayer","obs","request3$","recursiveGroupByLayerAddress","keyFn","layerTitle","outItem","indicesMatchTitle","indicesMatchNewMetadataUrl","bInd","nPosition","newMetadataUrl","groupByGroupId","groupId","ind","ix","computeForcedProperties","layerNameFromCatalog","returnProperty","metadataUrl","metadataAbstract","metadataAbstractAll","metadataUrlAll","forcedPropertiesForAllLayers","forcedProperty","prepareCatalogItemLayer","idParent","layersQueryFormat","configuredQueryFormat","retrieveLayerInfoFormat","baseSourceOptions","propertiesToForce","baseAbstract","layerOnlineResource","layerPrepare","prepareCatalogItemGroup","itemListIn","regexes","idGroup","groupItem","testLayerRegexes","layerItem","itemsPrepare","loopLevel","findCatalogInfoFormat","ServiceIdentification","regex","currentLayerInfoFormat","baseInfoFormat","configuredInfoFormat","specific","catalogService","onGroupAddedChange","onLayerAddedChange","item_r1","catalogAllowLegend","toggleCollapsedGroup","CatalogBrowserComponent_ng_template_1_ng_container_0_Template","CatalogBrowserComponent_ng_template_1_ng_container_1_Template","isGroup","isLayer","CatalogBrowserComponent","layerService","currentItems","addLayerToMap","removeLayerFromMap","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","security","currLayer","sortCatalogItemsByTitle","returnItem","titleA","titleB","CatalogBrowserComponent_ng_template_1_Template","IgoBadgeIconDirective","igoMatBadgeIcon","getNamedSvgIcon","svgObj","updateSvg","matBadgeHidden","hidden","updateHidden","matBadgeDisabled","updateDisabled","igoMatBadgeInverseColor","inverseColor","updateColor","igoMatBadgeInheritColor","inheritColor","igoMatBadgeColor","igoMatBadgeBackgroundColor","backgroundColor","badge","originalColor","alignItems","justifyContent","background","getComputedStyle","getPropertyValue","MetadataService","openMetadata","MetadataButtonComponent","metadataService","_color","MetadataAbstractComponent","MetadataButtonComponent_button_0_Template","MAT_DIALOG_DATA","MetadataAbstractComponent_mat_dialog_content_4_Template","MetadataAbstractComponent_mat_dialog_content_5_Template","CollapseDirective","_target","collapseTarget","expandTarget","item_r6","toggleLegendItem","computeItemTitle","style_r18","onChangeStyle","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_mat_option_4_Template","ctx_r11","_r29","ctx_r27","onLoadImage","imgGraphValue","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_img_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_small_2_Template","ctx_r22","imagesHeight","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_2_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_mat_list_item_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_Template","items_r1","LayerLegendComponent_ng_container_0_ng_container_1_Template","LayerLegendComponent_ng_container_0_ng_template_2_Template","LayerLegendComponent","updateLegendOnResolutionChange","legendItems$","renderedLegends","lastlLegend","listStyles","STYLES","onViewControllerStateChange","getLegendGraphic","obsLegGraph","leg","transfertToggleLegendItem","newLegends","outLegends","lastLegends","layerLegend","localLayerOptions","wmsDataSourceOptions","updateLegend","legendItems","sA","sa","elemRef","renderedLegend","LayerLegendComponent_ng_container_0_Template","igoLayer$","CatalogBrowserLayerComponent","inRange$","isPreview$","isVisible$","isPreview$$","layerLegendShown$","mouseInsideAdd","addedChange","addedLayerIsPreview","isVisible","computeTitleTooltip","layerTooltip","layerMetadata","onMouseEvent","onToggleClick","askForLegend","haveGroup","oLayer","getBadgeIcon","computeTooltip","CatalogBrowserLayerComponent_mat_icon_1_Template","CatalogBrowserLayerComponent_button_5_Template","CatalogBrowserLayerComponent_igo_layer_legend_20_Template","ListItemDirective","focused","_focused","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","_disabled","beforeDisable","beforeEnable","toggleDisabledClass","getOffsetTop","offsetTop","focusedCls","disabledCls","CatalogBrowserGroupComponent_button_5_mat_icon_1_Template","_r16","onLayerPreview","ctx_r17","item_r12","CatalogBrowserGroupComponent_ng_template_13_ng_container_0_Template","CatalogBrowserGroupComponent_ng_template_13_ng_container_1_Template","CatalogBrowserGroupComponent","preview$","toggleCollapsed","layerAddedChange","evaluateAdded","evaluateDisabled","onToggleCollapsed","tryToggleGroup","onTitleClick","CatalogBrowserGroupComponent_button_5_Template","CatalogBrowserGroupComponent_ng_container_6_Template","CatalogBrowserGroupComponent_ng_template_9_Template","CatalogBrowserGroupComponent_ng_template_13_Template","LayerListToolService","keyword","sortAlpha","onlyVisible","onlyInRange","keywordInitialized","sortedAlphaInitialized","onlyVisibleInitialized","onlyInRangeInitialized","check","layerCheck","toggleVisibility","eyeTooltip","queryBadgeHidden$","inResolutionRange$","toggleLayerTool","LayerItemComponent","activeLayer","_activeLayer","selectionMode","layerTool$","showLegend$","tooltipText","selectAll","_selectAll","network$$","toggleLegendOnVisibilityChange","expandLegendIfVisible","orderable","lowerDisabled","raiseDisabled","queryBadge","toggleLegend","updateQueryBadge","onResolutionChange","toggleLegendOnClick","inResolutionRange","LayerItemComponent_mat_checkbox_1_Template","LayerItemComponent_button_5_Template","LayerItemComponent_button_6_Template","LayerItemComponent_button_7_Template","LayerItemComponent_igo_layer_legend_10_Template","LayerListControlsEnum","always","never","LayerListSelectVisibleEnum","ALL_VISIBLE","ALL_HIDDEN","MIXED","NULL","LayerListDisplacement","Raise","Lower","onAppliedFilterAndSortChange","toggleSelectionMode","layersAreAllVisible","layerFilterAndSortOptions","selectAllCheck","layersChecked","layersCheck","layer_r11","getLowerLayer","getUpperLayer","expandLegendOfVisibleLayers","layerItemChangeDetection$","LayerListComponent_ng_template_6_igo_layer_item_0_Template","excludeBaseLayers","zoomLayerExtents","LayerListComponent_igo_panel_8_button_2_Template","_r28","moveActiveLayer","layerListDisplacement","ctx_r31","changeOpacity","LayerListComponent_igo_panel_8_button_21_Template","isLayerRemovable","badgeOpacity","activeLayerExtentIsValid","templateLayerToolbar","checkOpacity","_r39","ctx_r38","zoomLayersExtents","_r41","ctx_r40","ctx_r42","ctx_r43","ctx_r44","LayerListComponent_igo_panel_9_mat_slider_25_Template","LayerListComponent_igo_panel_9_button_26_Template","isAllLayersRemovable","statusSelectedLayersCheck","lowerDisabledSelection","raiseDisabledSelection","_r32","activeLayersExtentAreValid","LayerListComponent","thresholdToFilterAndSort","showToolbar$","layerTool","hideSelectedLayers","activeLayer$","change$$","ogcButton","timeButton","_map","_layers","removeProblemLayerInList","floatLabel","appliedFilterAndSort","_keyword","_onlyVisible","_sortedAlpha","isUpperBaselayer","isLowerBaselayer","raisableLayers","lowerableLayers","layersCheckedOpacity","toggleOpacity","selectAllCheck$","selectAllCheck$$","debounce","timer","computeShowToolbar","computeLayers","checks","lay","showButtonZoomToExtent","layerExtent","layersExtent","clearKeyword","actiontype","fromUi","sortedLayersToMove","layersToMove","base","mapIndex","currentLayer","previousLayer","raisableLayer","layersToRaise","checkItems","getElementsByClassName","itemFocused","targetToScroll","nextLayer","lowerableLayer","layersToLower","layersOut","filterLayers","sortLayersByTitle","sortLayersByZindex","onKeywordChange","showToolbar","keepLayerIds","layerKeywords","kw","localKeyword","dataSourceType","keywordRegex","keywordInList","statusSelectedLayers","findTrue","findFalse","eventMapIndex","isScrolledIntoView","elemSource","elem","docViewTop","elemTop","layersList","contentQueries","dirIndex","LayerListComponent_igo_layer_list_tool_0_Template","LayerListComponent_div_2_Template","LayerListComponent_ng_template_6_Template","LayerListComponent_igo_panel_8_Template","LayerListComponent_igo_panel_9_Template","clearTerm","LayerListToolComponent","onlyVisible$","sortAlpha$","term$","onlyVisible$$","sortAlpha$$","term$$","toggleSortAlpha","toggleOnlyVisible","LayerListToolComponent_button_4_Template","toggleShowAllLegends","showAllLegendsValue","layer_r9","LayerLegendListComponent_ng_template_6_igo_layer_legend_item_0_Template","LayerLegendListComponent","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","showAllLegend","allowShowAllLegends","allLegendsShown","computeShownLayers","shownLayers","LayerLegendListComponent_mat_slide_toggle_1_Template","LayerLegendListComponent_mat_divider_3_Template","LayerLegendListComponent_ng_template_6_Template","LayerLegendListComponent_p_8_Template","LayerLegendListComponent_p_12_Template","LayerLegendListComponent_p_16_Template","LayerLegendListComponent_p_20_Template","LayerLegendItemComponent","ClickoutDirective","clickout","handleMouseClick","contains","ListComponent","navigation","_navigation","_selection","selectedItem","_selectedItem","focusedItem","_focusedItem","navigationEnabled","listItems$$","listItems","handleKeyboardEvent","enableNavigation","focusNext","toArray","igoList","getFocusedIndex","offsetHeight","focusPrevious","disableNavigation","scrollToItem","findSelectedItem","findFocusedItem","item2","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","IgoLayerModule","MatSlideToggleModule","MatSliderModule","i8","i9","i10","i11","i12","i13","i14","i15","i16","IgoCatalogBrowserModule","predefinedCatalog_r7","predefinedCatalog_r8","type_r9","addedCatalog","emailAddress","AddCatalogDialogComponent","defaultAddedCatalogType","addedCatalogType$$","predefinedCatalogsList$","typeCapabilities","predefinedCatalogs","storeViewAll$$","updateValueAndValidity","computePredefinedCatalogList","changeUrlOrTitle","patchValue","addCatalog","AddCatalogDialogComponent_mat_option_11_Template","AddCatalogDialogComponent_mat_option_18_Template","AddCatalogDialogComponent_mat_option_23_Template","AddCatalogDialogComponent_span_24_Template","AddCatalogDialogComponent_span_25_Template","_r0","catalog_r2","onCatalogRemove","onCatalogSelect","addCatalogDialog","CatalogLibaryComponent","addCatalogAllowed","catalogSelectChange","addingCatalog$$","addedCatalogs","getCatalogs","unsubscribeAddingCatalog","predefinedCatalog","mapName","ServiceType","catalogToAdd","newCatalogs","CatalogLibaryComponent_ng_template_1_Template","CatalogLibaryComponent_div_3_Template","removeCatalogFromLibrary","CatalogLibaryItemComponent","catalogRemove","CatalogLibaryItemComponent_mat_icon_4_Template","CatalogLibaryItemComponent_button_5_Template","CatalogLibaryItemComponent_button_6_Template","IgoCatalogLibraryModule","IgoCatalogModule","IgoDownloadModule","IgoDrawModule","MatButtonToggleModule","BrowserModule","BrowserAnimationsModule","MatRadioModule","IgoFeatureDetailsModule","IgoFeatureFormModule","IgoFeatureModule","IgoGeometryFormFieldModule","IgoGeometryModule","FilterableDataSourcePipe","arg","isTimeFilterable","isOgcFilterable","TimeFilterButtonComponent_div_1_igo_time_filter_item_2_Template","timeFilterCollapse","TimeFilterButtonComponent","TimeFilterButtonComponent_button_0_Template","TimeFilterButtonComponent_div_1_Template","handleDateChange","startDate","endDate","getRangeMaxDate","getRangeMinDate","TimeFilterFormComponent_div_0_div_1_Template","TimeFilterFormComponent_div_0_div_2_Template","isRange","year_r21","_r23","year","ctx_r24","handleYearChange","TimeFilterFormComponent_div_1_div_1_mat_option_4_Template","listYears","startYear_r27","endYear_r28","_r30","startYear","TimeFilterFormComponent_div_1_div_2_mat_option_5_Template","endYear","TimeFilterFormComponent_div_1_div_2_mat_option_10_Template","startListYears","endListYears","TimeFilterFormComponent_div_1_div_1_Template","TimeFilterFormComponent_div_1_div_2_Template","ctx_r36","_r35","_r34","handleSliderYearChange","TimeFilterFormComponent_div_3_p_9_Template","ctx_r41","toggleFilterState","playYear","resetFilter","handleSliderValue","playIcon","resetIcon","_r47","handleSliderDateChange","_r45","_r44","ctx_r49","playFilter","dateToNumber","handleSliderTooltip","TimeFilterFormComponent","initStartYear","initEndYear","valueArray","yearChange","mySlider","getStepDefinition","timeInterval","getTimezoneOffset","is","getFullYear","checkFilterValue","storeCurrentFilterValue","timeFromWms","newStartListYears","newEndListYears","setupDateOutput","applyTypeChange","handleListYearChange","handleListYearStartChange","newDate","setSliderThumbLabel","thumbLabel","findThumbLabel","childNodes","textContent","stopFilter","that","newMinDateNumber","maxDateNumber","getRoundedDate","toDateString","toTimeString","setSeconds","setHours","setMinutes","getDay","selectedHour","getHours","selectedMinute","getMinutes","atMinute","coeff","asMilliseconds","MatSlider","TimeFilterFormComponent_div_0_Template","TimeFilterFormComponent_div_1_Template","TimeFilterFormComponent_div_3_Template","TimeFilterFormComponent_div_4_Template","TimeFilterService","filterByDate","newdateform","newdateformStart","newdateformEnd","dates","reformatDateTime","filterByYear","years","month","getMonth","day","getUTCDate","hour","getUTCHours","minute","getUTCMinutes","toggleFiltersCollapsed","TimeFilterItemComponent_mat_list_item_0_button_4_Template","_r1","filtersCollapsed","TimeFilterItemComponent","timeFilterService","TimeFilterItemComponent_mat_list_item_0_Template","TimeFilterItemComponent_igo_layer_legend_5_Template","layer_r1","TimeFilterListComponent","TimeFilterListComponent_ng_template_1_Template","WktService","wktToFeature","wkt","wktProj","featureProj","olWKT","extentToWkt","epsgTO","extentProj","roundCoordinateArray","wktLine","wktMultiPoints","coordinateArray","roundArray","snrcToWkt","snrc","ew","sn","snrc250kIndex","snrc50kIndex","snrc1m","snrc250k","snrc50k","ar1m","part1m","part250k","part50k","partEW","partSN","unit1mEW","unit1mSN","unit250kEW","unit250kSN","unit50kEW","unit50kSN","index250kEW","index250kSN","index50kEW","index50kSN","increment250kEW","increment250kSN","increment50kEW","increment50kSN","unitPerTypeEW","unitPerTypeSN","ul","lr","ur","ll","field_r12","clearSelectedField","currentFilter","inputClearable","updateFieldsList","changeField","OgcFilterFormComponent_mat_form_field_14_mat_option_10_Template","OgcFilterFormComponent_mat_form_field_14_button_12_Template","selectedField$","filteredFields$","operator_r20","igoSpatialSelector_r22","changeSpatialSelector","OgcFilterFormComponent_mat_form_field_28_mat_option_2_Template","igoSpatialSelectors","value_r28","clearProperty","updateValuesList","changeProperty","OgcFilterFormComponent_mat_form_field_30_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_30_button_7_Template","_r25","detectProperty","filteredValues$","isClearable","changeSNRC","OgcFilterFormComponent_mat_form_field_35_button_3_Template","changeMapExtentGeometry","OgcFilterFormComponent_ng_container_37_button_1_Template","value_r49","_r51","_r53","ctx_r52","ctx_r54","ctx_r55","ctx_r56","changeNumericProperty","OgcFilterFormComponent_mat_form_field_40_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_40_button_7_Template","_r46","value_r60","_r62","ctx_r61","ctx_r59","_r64","ctx_r63","ctx_r65","OgcFilterFormComponent_mat_form_field_41_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_41_button_7_Template","_r57","_r69","ctx_r68","pos","OgcFilterFormComponent","wktService","ogcFilterOperator","allOgcFilterOperators","ogcFilterOperators$","inputOperator","fields$","currentFilterIsSpatial$","defaultStepMillisecond","refreshFilters","_snrc","activeFilters","interfaceOgcFilters","sFields","excludeFromOgcFilters","sfs","currentFilterIsSpatial","_filterFields","_filterValues","detectedProperty","deleteFilter","changeLogical","changeOperator","changeCaseSensitive","refreshFilter","changeSNRCGeometry","isSpatial","isTemporalOperator","OgcFilterFormComponent_mat_form_field_14_Template","OgcFilterFormComponent_mat_option_25_Template","OgcFilterFormComponent_mat_form_field_28_Template","OgcFilterFormComponent_mat_form_field_30_Template","OgcFilterFormComponent_mat_form_field_35_Template","OgcFilterFormComponent_ng_container_37_Template","OgcFilterFormComponent_mat_form_field_40_Template","OgcFilterFormComponent_mat_form_field_41_Template","OgcFilterFormComponent_igo_ogc_filter_time_42_Template","_c3","_c4","refreshFunc","currentFilter_r3","OgcFilterableFormComponent_1_ng_template_0_Template","OgcFilterableFormComponent","OgcFilterableFormComponent_igo_ogc_filter_selection_0_Template","OgcFilterableFormComponent_1_Template","OGCFilterService","filterByOgc","filterString","setOgcWFSFiltersOptions","wfsDatasource","setOgcWMSFiltersOptions","filtered","_r12","addFilterToSequence","addFilterDisabled","OgcFilterableItemComponent_div_9_igo_layer_legend_2_Template","changeOgcFilterType","OgcFilterableItemComponent","ogcFilterService","lastRunOgcFilter","defaultLogicalParent","hasActiveSpatialFilter","filtersAreEditable","hasSelector","lastLevel","firstFieldName","includedFields","datasourceOptions","firstOperatorName","force","af","rebuildFilter","ogcDataSource","ogcLayer","isAdvancedOgcFilters","changeOgcFiltersAdvancedOgcFilters","OgcFilterableItemComponent_mat_icon_2_Template","OgcFilterableItemComponent_span_3_Template","OgcFilterableItemComponent_button_5_Template","OgcFilterableItemComponent_button_6_Template","OgcFilterableItemComponent_div_9_Template","OgcFilterableItemComponent_section_11_Template","layer_r2","OgcFilterableListComponent","OgcFilterableListComponent_div_1_Template","OgcFilterableListComponent_ng_template_3_Template","OgcFilterButtonComponent_div_1_igo_ogc_filterable_item_2_Template","ogcFilterCollapse","OgcFilterButtonComponent","currentPushButtonGroup","gr","cntPushButtons","cb","button","currentCheckboxGroup","cntCheckboxes","currentRadioButtonsGroup","cntRadioButtons","radio","currentSelectGroup","cntSelect","currentAutocompleteGroup","cntAutocomplete","filterActiveValue","OgcFilterButtonComponent_button_0_Template","OgcFilterButtonComponent_div_1_Template","OGCFilterTimeService","stepMillisecond","stepIsYearDuration","months","weeks","days","hours","stepIsMonthDuration","stepIsWeekDuration","week","stepIsDayDuration","stepIsHourDuration","stepIsMinuteDuration","addStep","toDate","subtractStep","subtract","selectorGroup_r11","currentPushButtonsGroup","OgcFilterSelectionComponent_div_1_div_1_div_2_mat_option_4_Template","getPushButtonsGroups","ogcPushButton_r16","selector_r2","getToolTip","getButtonColor","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_mat_button_toggle_4_Template","bundle_r14","bundleIsVertical","OgcFilterSelectionComponent_div_1_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_Template","selectorGroup_r23","currentCheckboxesGroup","OgcFilterSelectionComponent_div_1_div_2_div_2_mat_option_4_Template","getCheckboxesGroups","ogcCheckbox_r29","_r31","displayLessResults","displayMoreResults","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_1_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_2_Template","ctx_r28","isLessResults","bundle_r26","isMoreResults","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_Template","OgcFilterSelectionComponent_div_1_div_2_div_2_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_Template","selectorGroup_r43","OgcFilterSelectionComponent_div_1_div_3_div_2_mat_option_4_Template","getRadioButtonsGroups","emptyRadioButtons","ogcRadioButton_r52","_r59","ctx_r58","_r61","ctx_r60","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_1_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_2_Template","bundle_r46","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_4_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_5_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_Template","unfiltered","OgcFilterSelectionComponent_div_1_div_3_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_Template","selectorGroup_r66","_r68","OgcFilterSelectionComponent_div_1_div_4_div_2_mat_option_4_Template","getSelectGroups","_r75","ctx_r74","emptySelect","_r80","ctx_r79","selectAllSelected","ctx_r81","toggleAllSelection","bundle_r69","ctx_r83","selectOptionClick","ctx_r78","ogcSelect_r82","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_option_5_Template","_r91","ctx_r89","ctx_r87","ogcSelect_r88","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_mat_option_1_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_Template","_r72","OgcFilterSelectionComponent_div_1_div_4_div_2_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_Template","autocompleteGroup_r96","_r98","OgcFilterSelectionComponent_div_1_div_5_div_2_mat_option_4_Template","ctx_r93","getAutocompleteGroups","_r103","ctx_r102","emptyAutocomplete","ogcAutocomplete_r108","_r110","ctx_r109","autocompleteOptionClick","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_mat_option_6_Template","bundle_r99","ctx_r101","displayFn","filteredOgcAutocomplete","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_Template","ctx_r94","OgcFilterSelectionComponent_div_1_div_5_div_2_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_Template","OgcFilterSelectionComponent_div_1_div_1_Template","OgcFilterSelectionComponent_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_Template","OgcFilterSelectionComponent_div_1_div_4_Template","OgcFilterSelectionComponent_div_1_div_5_Template","ctx_r113","OgcFilterSelectionComponent_div_2_h3_2_Template","OgcFilterSelectionComponent_div_2_h3_3_Template","_r115","ctx_r114","ctx_r116","ctx_r117","OgcFilterSelectionComponent","domService","sel","checkboxesIndex","radioButtonsIndex","baseIndex","_currentFilter","selectEnabled$","selectEnableds$","autocompleteEnabled$","applyFiltersTimeout","ogcFiltersSelectors","ogcSelector","pushButtonsGroup","checkboxesGroup","radioButtonsGroup","selectGroup","autocompleteGroup","selectEnabled","compSelect","applyFilters","selectEnableds","autocompleteEnabled","buildForm","selectMulti","getSelectEnabled","getSelectDomValues","getAutocompleteEnabled","getAutocompleteDomValues","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","onAutocompleteChangeGroup","toolTip","_this2","domSelectors","domValues","domSelector","filterDOM","domOptions","newBundle","comp","_this3","pushButton","vertical","currentOgcSelection","markAsUntouched","deselect","newStatus","isUserInput","currentGroups","currentGroup","selectorsLength","OgcFilterSelectionComponent_div_1_Template","OgcFilterSelectionComponent_div_2_Template","SpatialFilterType","Predefined","Polygon","SpatialFilterItemType","Address","Thematics","queryType_r1","SpatialFilterTypeComponent","_store","queryType","selectedTypeIndex","UntypedFormControl","spatialType","activeDrawType","selectedQueryType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange","onTypeChange","onDrawTypeChange","SpatialFilterTypeComponent_mat_option_8_Template","SpatialFilterService","urlFilterList","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","routes","getKeyByValue","loadFilterList","featureCollection","loadThematicsList","loadFilterItem","itemType","thematic","urlItem","bufferInput","simplified","loc","loadItemById","featureType","featureCode","loadBufferGeometry","filterType","bufferOutput","MeasureType","Length","Area","MeasureLengthUnit","Meters","Kilometers","Miles","Feet","MeasureLengthUnitAbbreviation","MeasureAreaUnit","SquareMeters","SquareKilometers","SquareMiles","SquareFeet","Hectares","Acres","MeasureAreaUnitAbbreviation","metersToKilometers","metersToFeet","metersToMiles","squareMetersToSquareKilometers","squareMetersToSquareMiles","squareMetersToSquareFeet","squareMetersToHectares","squareMetersToAcres","metersToUnit","conversion","squareMetersToUnit","formatMeasure","measure","parts","toLocaleString","minimumFractionDigits","maximumFractionDigits","unitAbbr","createMeasureInteractionStyle","measureOlGeometryLength","olGetLength","measureOlGeometryArea","olGetArea","measureOlGeometry","area","lengths","coordinatesLength","olSegment","updateOlGeometryMidpoints","olMidpoints","olMidpointPoint","getOlGeometryMidpoints","midpointsLength","midpointCoordinate","getCoordinateAt","olMidpoint","setCoordinates","expectedNumber","clearOlMidpointTooltip","olTooltip","removeOverlay","getTooltipsOfOlGeometry","olTooltips","getOlTooltipsAtMidpoints","olCenterTooltip","getOlTooltipAtCenter","olCenter","createOlTooltipAtPoint","olPoint","srcGeomType","OlOverlay","stopEvent","setPosition","entities_r4","measureUnit_r5","SpatialFilterListComponent","spatialFilterService","_queryType","_zone","zoneWithBuffer","bufferFormControl","selectedZone","measureUnit","measureUnits","formValueChanges$$","bufferValueChanges$$","featureGeom","onZoneChange","onMeasureUnitChange","SpatialFilterListComponent_mat_option_10_Template","SpatialFilterListComponent_mat_option_22_Template","KeyValuePipe","keyValues","property_r3","openSecureUrl","getEmbeddedLinkText","FeatureDetailsComponent_table_0_tr_2_td_1_Template","FeatureDetailsComponent_table_0_tr_2_td_2_Template","FeatureDetailsComponent_table_0_tr_2_td_3_Template","FeatureDetailsComponent_table_0_tr_2_td_4_Template","FeatureDetailsComponent_table_0_tr_2_td_5_Template","FeatureDetailsComponent_table_0_tr_2_td_6_Template","FeatureDetailsComponent_table_0_tr_2_td_7_Template","FeatureDetailsComponent_table_0_tr_2_td_8_Template","isEmbeddedLink","isDoc","FeatureDetailsComponent_table_0_tr_2_Template","filterFeatureProperties","htmlSanitizer","urlSanitizer","FeatureDetailsComponent","sanitizer","unsubscribe$","ready","_source","_feature","selectFeature","routeEvent","htmlDisplayEvent","isHtmlDisplay","docOrImage","fileUrl","div","getAttribute","offlineButtonState","Route","FeatureDetailsComponent_table_0_Template","FeatureDetailsComponent_iframe_1_Template","createDrawInteractionStyle","createDrawHoleInteractionStyle","getMousePositionFromOlGeometryEvent","olEvent","DrawControl","start$","end$","changes$","modify$","select$","abort$","freehand$","ispredefinedRadius$","predefinedRadius$","radiusDrawEnd$","keyDown$$","olGeometryType","olInteractionStyle","olDrawingLayer","olDrawInteraction","olSelectInteraction","olModifyInteraction","onDrawStartKey","onDrawEndKey","onDrawAbortKey","onDrawKey","mousePosition","radiusVal","radiusValData","radiusCercle","olDrawingLayerSource","drawingLayer","createOlInnerOverlayLayer","interactionStyle","activateModifyAndSelect","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","setOlInteractionStyle","setGeometryType","getGeometryType","OlVectorLayer","drawingLayerSource","OlVectorSource","drawingLayerStyle","OlDraw","maxPoints","freehand","stopClick","freehandCondition","onDrawStart","onDrawEnd","OlModify","OlSelect","doubleClick","onSelect","unsubscribeKeyDown","olGeometryEvent","subscribeKeyDown","removeLastPoint","finishDrawing","abortDrawing","ModifyControl","olOverlayLayer","onModifyStartKey","onModifyEndKey","onModifyKey","olModifyInteractionIsActive","olTranslateInteraction","onTranslateStartKey","onTranslateEndKey","onTranslateKey","olTranslateInteractionIsActive","olDrawInteractionIsActive","drawKeyUp$$","drawKeyDown$$","removedOlInteractions","olLinearRingsLayer","olOuterGeometry","olOverlaySource","olLinearRingsSource","modify","createOlLinearRingsLayer","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","setOlGeometry","addOlLinearRingsLayer","removeOlLinearRingsLayer","clearOlLinearRingsSource","drawStyle","deactivateModifyInteraction","onModifyStart","onModifyEnd","subscribeToKeyDown","unsubscribeToKeyDown","OlTranslate","deactivateTranslateInteraction","onTranslateStart","onTranslateEnd","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","unsubscribeToDrawKeyUp","deactivateDrawInteraction","linearRingCoordinates","getLinearRing","addLinearRingToOlGeometry","_linearRingCoordinates","updateLinearRingOfOlGeometry","addLinearRingToOlPolygon","olPolygon","olLinearRing","appendLinearRing","OlLinearRing","newCoordinates","getLinearRings","measureLengthUnit","measureAreaUnit","perimeter","MeasurerDialogComponent","onNoClick","MeasurerDialogComponent_table_4_Template","MeasurerDialogComponent_table_5_Template","onToggleDisplayLines","displayLines","onToggleDisplayDistance","displayDistance","onToggleDisplayAreas","displayAreas","onLengthUnitChange","measureType","measure_r17","measureUnitsAuto","activeMeasureType","onAreaUnitChange","MeasurerComponent_ng_container_29_igo_measurer_item_1_Template","MeasurerComponent_ng_container_29_igo_measurer_item_2_Template","_r27","onCalculateClick","onDeleteClick","MeasurerComponent","tableTemplate","hasLine$","hasArea$","measure$","showTooltips","drawControlIsDisabled","drawLineControl","drawPolygonControl","modifyControl","activeOlGeometry","activeLengthUnit","activeAreaUnit","onFeatureAddedKey","onFeatureRemovedKey","activeDrawControl","drawStart$$","drawEnd$$","drawChanges$$","modifyStart$$","modifyEnd$$","modifyChanges$$","selectedFeatures$$","olDrawSource","setActiveMeasureType","_activeMeasureType","minSegmentLength","table","drawControlIsActive","createDrawLineControl","createDrawPolygonControl","createModifyControl","toggleDrawControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","onMeasureTypeChange","onToggleDrawControl","deactivateDrawControl","onToggleMeasureUnitsAuto","onDisplayDistance","onDisplayLines","onDisplayAreas","updateTooltipsOfOlGeometry","sum","openDialog","selectedFeature","drawingLayerFeature","onModifyClick","_olFeature","activateModifyControl","clearTooltipsOfOlGeometry","many","updateMeasureOfOlGeometry","objectsExists","objectExist","OlStyle","activateDrawControl","drawControl","onDrawChanges","clearMeasures","clearTooltipsOfOlSource","finalizeMeasureOfOlGeometry","addFeatureToStore","onModifyChanges","_measure","featureId","OlGeoJSON","olMidpointsTooltips","updateOlTooltipsAtMidpoints","typeGeom","updateOlTooltip","updateOlTooltipAtCenter","updateOlGeometryCenter","centerCoordinate","olGetCenter","showTooltipsOfOlGeometry","shouldShowTooltip","addOverlay","forEachFeature","showTooltipsOfOlSource","_unit","_type","computeTooltipInnerHTML","MeasurerComponent_mat_divider_13_Template","MeasurerComponent_mat_slide_toggle_15_Template","MeasurerComponent_mat_divider_17_Template","MeasurerComponent_mat_slide_toggle_20_Template","MeasurerComponent_mat_slide_toggle_22_Template","MeasurerComponent_mat_divider_24_Template","MeasurerComponent_ng_container_29_Template","MeasurerComponent_mat_divider_31_Template","MeasurerComponent_button_35_Template","MeasurerComponent_button_38_Template","MeasureFormatPipe","onDrawControlChange","onfreehandControlChange","freehandDrawIsActive","measureUnit_r15","SpatialFilterItemComponent_div_7_mat_option_7_Template","measureUnit_r19","SpatialFilterItemComponent_div_8_mat_option_7_Template","radiusFormControl","onItemTypeChange","item_r23","selectedThematics","node_r35","onToggleChange","node_r39","childrensToggle","treeControl","isExpanded","hasChildrenSelected","SpatialFilterItemComponent_div_14_mat_header_cell_3_Template","SpatialFilterItemComponent_div_14_mat_header_cell_5_Template","SpatialFilterItemComponent_div_14_mat_header_row_6_Template","SpatialFilterItemComponent_div_14_mat_row_7_Template","SpatialFilterItemComponent_div_14_mat_tree_node_9_Template","SpatialFilterItemComponent_div_14_mat_nested_tree_node_10_Template","hasChild","clearSearch","disabledClearSearch","ctx_r45","clearDrawZone","_r48","ctx_r47","toggleVisibleList","SpatialFilterItemComponent_div_28_button_1_Template","entityChange","listIsVisible","SpatialFilterItemComponent","geometryTypes","drawGuide$","drawStyle$","PointStyle","overlayStyle","PolyStyle","overlayStyle$","allLayers","thematicLength","_thematicLength","toggleSearch","itemTypeChange","thematicChange","drawZoneEvent","bufferEvent","radiusEvent","freehandControl","predefinedRadius","clearButtonEvent","clearSearchEvent","export","openWorkspace","selectedItemType","selectedSourceAddress","NestedTreeControl","childrens","thematics","MatTreeNestedDataSource","value$","value$$","radiusChanges$$","bufferChanges$$","geometryTypeField","drawGuideField","drawGuide","drawGuidePlaceholder","drawZone","limits","child","selectedRecordStrategy","selectionStrategy","detach","isPolygon","isPoint","isPredefined","collapse","expand","numSelected","numNodes","bool","selectedThematicsName","nodeSelected","toggleSearchButton","createTableTemplate","clearButton","disableSearchButton","formValue","typeColumn","nameColumn","SpatialFilterItemComponent_mat_slide_toggle_5_Template","SpatialFilterItemComponent_mat_slide_toggle_6_Template","SpatialFilterItemComponent_div_7_Template","SpatialFilterItemComponent_div_8_Template","SpatialFilterItemComponent_mat_radio_button_13_Template","SpatialFilterItemComponent_div_14_Template","SpatialFilterItemComponent_button_16_Template","SpatialFilterItemComponent_button_17_Template","SpatialFilterItemComponent_button_27_Template","SpatialFilterItemComponent_div_28_Template","sliderMode","modeChange","changePropertyByPass","beginValue","restrictedToStep","endValue","yearOnlyInputChange","yearSelected","onlyYearBegin","filterStateDisable","calendarView","handleDate","onlyYearEnd","hour_r27","minute_r28","changeTemporalProperty","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_12_Template","beginHourFormControl","beginHours","beginMinuteFormControl","beginMinutes","hour_r37","minute_r38","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_12_Template","endHourFormControl","endHours","endMinuteFormControl","endMinutes","_r43","monthSelected","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_Template","filterEndFunction","calendarType","OgcFilterTimeComponent_div_3_div_2_div_10_Template","OgcFilterTimeComponent_div_3_div_2_div_11_Template","ctx_r51","filterBeginFunction","OgcFilterTimeComponent_div_3_div_1_Template","OgcFilterTimeComponent_div_3_div_2_Template","calendarTypeYear","OgcFilterTimeComponent","ogcFilterTimeService","_beginValue","_endValue","_defaultMin","_defaultMax","_defaultDisplayFormat","_defaultSliderModeEnabled","endDatepickerTime","beginDatepickerTime","beginTime","endTime","stepMilliseconds","sliderInterval","displayFormat","parseFilter","handleMin","handleMax","getUTCFullYear","isCalendarYearMode","setFilterStateDisable","updateHoursMinutesArray","updateValues","dateFilter","intervalInt","_now","endOf","getDateFromStringWithoutTime","valueTmp","getDateTime","dateStringFromYearNotime","toISOString","datePicker","dateValue","monthDiff","dateValuePlus1","monthDiffPlus1","asYears","asMonths","weekDiff","weekDiffPlus1","asWeeks","dayDiff","_mod","asDays","hourDiff","asHours","valuetmp","valuetmp2","handleMinuteIncrement","handleHourIncrement","fullBeginHoursArray","checkEndValue","fullEndHoursArray","fullBeginMinutesArray","fullEndMinutesArray","beginTmp","endTmp","restrictToStep","stringDate","dateItems","minDefaultDate","maxDefaultDate","minDefaultISOString","maxDefaultISOString","filterOriginConfig","toLocaleDateString","OgcFilterTimeComponent_mat_slide_toggle_1_Template","OgcFilterTimeComponent_div_2_Template","OgcFilterTimeComponent_div_3_Template","OgcFilterTimeSliderComponent","slider","sliderValue","calculatedStep","_defaultSliderInterval","beginMillisecond","maxMillisecond","sliderDisplayWith","calculateStep","handleSliderInput","dateTmp","toAdd","_emitInputEvent","matSliderChange","dateBeginTmp","dateEndTmp","startOf","GeometryFormFieldInputComponent","olGeoJSON","defaultDrawStyleRadius","olGeometryEnds$$","olGeometryChanges$$","createMeasureTooltip","activeControl","_geometryType","deactivateControl","createDrawControl","toggleControl","_drawControlIsActive","_freehandDrawIsActive","_predefinedRadius","controlOptions","_drawStyle","olGuideStyle","getGuideStyleFromDrawStyle","_overlayStyle","addGeoJSONToOverlay","olModify","features_","addOlOverlayLayer","onTouched","updateDrawStyleWithDrawGuide","activateControl","onOlGeometryEnds","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","lastIndex","lastLength","olLastMidpoint","innerHtml","guideStyle","GeometryFormFieldInputComponent_ng_template_0_Template","IgoFilterModule","MAT_DATE_LOCALE","MatTabsModule","MatTreeModule","MatOptionModule","MatNativeDateModule","MatDatetimepickerModule","MatNativeDatetimeModule","i17","i18","i19","i20","i21","i22","i23","i24","i25","i26","i27","i28","i29","IgoImportExportModule","IgoMapModule","measureUnit_r1","MeasurerItemComponent","measure$$","auto","toggleAutoUnit","_auto","computeBestMeasureUnit","computeBestAreaUnit","converted","possibleUnits","computeBestLengthUnit","MeasurerItemComponent_mat_option_8_Template","IgoMeasurerModule","IgoMeasureModule","IgoPrintModule","querySearchSourceFactory","IgoQueryModule","DirectionsSource","DirectionsSourceService","directionsSourceServiceFactory","provideDirectionsSourceService","IgoDirectionsModule","DragDropModule","sourceCanSearch","sourceCanReverseSearch","reverseSearch","sourceCanReverseSearchAsSummary","findDiff","str1","str2","computeTermSimilarity","caseSensitive","termFrom","termTo","totalDiff","delta","SearchSourceService","getSources","getEnabledSources","enableSourcesByType","SearchService","searchSourceService","termIsValid","distance","getEnabledOnly","searchType","asPointerSummary","reverseSourceFonction","reverseSearchCoordsFormat","reverseSearchSources","searchSourceServiceFactory","IChercheSearchResultFormatter","formatResult","IgoHttpParameterCodec","encodeKey","encodeValue","decodeKey","decodeValue","IChercheSearchSource","formatter","title$","hashtagsLieuxToKeep","getAllowedTypes","ecmax","showAdvancedParams","Boolean","computeRequestParams","getSearch","extractResults","typeSetting","typesMatched","computeOptionsParam","q","computeTerm","xMin","yMin","xMax","yMax","encoder","dataToResult","computeProperties","dataType","titleHtml","highlight","title2","title3","score","nextPage","propertiesBlacklist","googleLinksProperties","GoogleMaps","googleMaps","googleMapsNom","pointOnFeature","municipalite","GoogleStreetView","routing","keep","h","cacheHasher","IChercheReverseSearchSource","getReverseSearch","getSubtitle","computeExtent","subtitleHtml","pointerSummaryTitle","defaultIChercheSearchResultFormatterFactory","ichercheSearchSourceFactory","provideIChercheSearchSource","ichercheReverseSearchSourceFactory","provideIChercheReverseSearchSource","CoordinatesSearchResultFormatter","CoordinatesReverseSearchSource","reverseSearchCoordsFormatEnabled","dataDMS","lonLatConversion","rawCoord3857","convertedLonLat","igo2CoordFormat","utmZoneFromLonLat","utmName","rawCoordUtm","mtmZoneFromLonLat","long","mtmName","rawCoordMtm","rawCoord","numericEpsgCode","roundedCoordString","roundedCoordStringDMS","circleGeometry","polygonGeometry","writer","writeGeometry","OpenStreetMap","defaultCoordinatesSearchResultFormatterFactory","CoordinatesReverseSearchSourceFactory","_projectionService","provideCoordinatesReverseSearchSource","LayerListBindingDirective","layersOrResolutionChange$$","layersVisibility$$","setLayersVisibilityStatus","visibles","allLayersAreVisible","toggleTrackFeature","TrackFeatureButtonComponent","TrackFeatureButtonComponent_button_0_Template","ILayerSearchResultFormatter","allowedKey","dataR","ILayerSearchSource","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","formatOpt","urls","urlOpt","ilayerSearchResultFormatterFactory","ilayerSearchSourceFactory","provideILayerSearchSource","IgoSearchSelectorModule","IgoSearchSettingsModule","IgoSearchBarModule","IgoSearchResultsModule","IgoSearchModule","OgcFilterComponent","OgcFilterWidget","ogcFilterWidgetFactory","provideOgcFilterWidget","IgoOgcFilterModule","IgoWorkspaceUpdatorModule","IgoConfirmationPopupModule","IgoGeoWorkspaceModule","StyleListService","styleList","getStyleList","baseStyleList","styleListResponse","STYLELIST_OPTIONS","provideStyleListOptions","styleListFactory","styleListService","IgoStyleListModule","FontType","Arial","ArialBlack","Verdana","Tahoma","TrebuchetMS","Impact","TimesNewRoman","Georgia","AmericanTypewriter","Courier","LucidaConsole","BrushScriptMT","ComicSansMS","DrawStyleService","labelsAreShown","fontSize","fontStyle","getFillColor","setFillColor","getStrokeColor","setStrokeColor","getStrokeWidth","getLabelsAreShown","toggleLabelsAreShown","setIcon","getIcon","getFontSize","setFontSize","getFontStyle","setFontStyle","getOffsetX","setOffsetX","getOffsetY","setOffsetY","createIndividualElementStyle","fontSizeAndStyle","labelsAreOffset","textToShow","textIgoStyleObject","flatCoordinates","IgoStyleModule","FeatureDetailsDirective","feature$","routingEvent","setFeature","bindClicking","routeElement","addEventListener","IgoOverlayModule","DownloadService","DSOptions","currentProj","outputFormatDownload","baseurl","openDownload","DownloadButtonComponent","downloadService","DownloadButtonComponent_button_0_Template","GeometryType","LineString","Circle","LabelType","Coordinates","Custom","CoordinatesUnit","DecimalDegree","DegreesMinutesSeconds","DrawIconService","icons","getIconsList","getIcons","getPath","createInteractionStyle","Olstyle","DDtoDMS","onLabelTypeChange","option_r8","optionAvailable","getProperLengthLabel","DrawPopupComponent_ng_container_3_mat_radio_group_14_mat_radio_button_1_Template","arrayBuiltInType","option_r12","DrawPopupComponent_ng_container_3_ng_container_15_mat_checkbox_1_Template","unit_r17","onChangeCoordinateUnit","DrawPopupComponent_ng_container_3_div_16_mat_option_8_Template","currentCoordinates","coordinatesMeasureUnit","allCoordinatesUnits","unit_r22","getLengthUnitEnum","onChangeLengthUnit","DrawPopupComponent_ng_container_3_div_17_mat_option_8_Template","lengthLabelT","currentLength","lengthMeasureUnit","allLengthUnits","unit_r27","getAreaUnitEnum","onChangeAreaUnit","DrawPopupComponent_ng_container_3_div_18_mat_option_10_Template","currentArea","areaMeasureUnit","allAreaUnits","DrawPopupComponent_ng_container_3_mat_radio_group_14_Template","DrawPopupComponent_ng_container_3_ng_container_15_Template","DrawPopupComponent_ng_container_3_div_16_Template","DrawPopupComponent_ng_container_3_div_17_Template","DrawPopupComponent_ng_container_3_div_18_Template","cancelDrawing","confirm","customOrPredefined","labelType","labelFlag","polygonCheck","noLabelButton","getLabelLength","currentLabel","DrawPopupComponent","confirmFlag","lengthInMeters","areaInMetersSquare","coordinatesInDD","currentCoordinatesUnit","longlatDD","labelLength","longitudeLatitude","longitude","latitude","point4326","circularPolygon","buildArrayType","input","lengthUnit","areaUnit","coordinatesUnit","selectOptions","currentOption","getLength","DrawPopupComponent_ng_container_3_Template","DrawPopupComponent_ng_container_4_Template","DrawShorcutsComponent","openPicker","getFeatureFillColor","fontSelect_r9","StyleModalDrawingComponent","drawStyleService","styleModalData","linestringOnly","buildStyleData","drawingStyle","allFontStyles","getFeatureFontSize","getFeatureFontStyle","getFeatureStrokeColor","getFeatureOffsetX","getFeatureOffsetY","StyleModalDrawingComponent_ng_container_6_Template","StyleModalDrawingComponent_mat_option_27_Template","DrawLayerPopupComponent","labelString","onToggleFreehandMode","freehandMode","measureUnit_r12","DrawComponent_div_23_mat_option_7_Template","layer_r15","activeDrawingLayer","deleteDrawings","icon_html_r22","onIconChange","DrawComponent_mat_form_field_44_div_6_Template","DrawComponent_mat_form_field_44_mat_option_10_Template","openStyleModalDialog","DrawComponent","drawIconService","_stores","drawControls","_drawControls","_activeDrawingLayer","activeLayerChange","drawControlsEvent","layersIDEvent","activeStore","layerCounterID","draw$","activeDrawingLayerSource","drawSelect$$","strokeForm","radiusFormControlChange$$","Subscription","numberOfDrawings","isCreatingNewLayer","currGeometryType","draw","editLabelDrawing","dc","onLayerChange","changeRadius","newTitle","isNewLayer","autoFocus","onFontChange","onColorChange","onOffsetLabelChange","openDrawDialog","isDrawEnd","updateLabelOfOlGeometry","updateLabelType","updateMeasureUnit","updateFontSizeAndStyle","updateFillAndStrokeColor","updateOffset","onSelectDraw","updateHeightTable","clearLabelsOfOlGeometry","onModifyDraw","longLat","radiusLabel","olGeometryLength","lengthLabel","circleArea","areaLabel","olGeometryArea","replaceFeatureInStore","labelTypeAndUnit","olGeometryCoordinates","entityCoordinates","rad","center4326","lon4326","lat4326","extent4326","getDistance","setupLayer","onToggleLabels","selectionChange","olGeometryFeature","openShorcutsDialog","elementStyle","toggleIsChecked","isCircle","numberId","isAnIcon","onGeometryTypeChange","_label","fontStyle_","fillColor_","strokeColor_","offsetX_","offsetY_","typeOfLabel","labelType_","measureUnit_","updateActiveLayer","isLineString","radiusMeters","pointStyle","selectedMeasureUnit","DrawComponent_mat_slide_toggle_22_Template","DrawComponent_div_23_Template","DrawComponent_mat_option_32_Template","DrawComponent_button_36_Template","DrawComponent_button_39_Template","DrawComponent_mat_form_field_44_Template","DrawComponent_button_49_Template","OgcFilterableListBindingDirective","GeometryFormFieldComponent","geometryType$","GeometryFormFieldComponent_div_3_Template","GeometryFormFieldComponent_mat_form_field_4_Template","ImportError","ImportInvalidFileError","setPrototypeOf","ImportUnreadableFileError","ImportNothingToImportError","ImportSizeError","ImportSRSError","ImportOgreServerError","padTo2Digits","padStart","handleFileImportSuccess","file","confirmDialogService","handleNothingToImportError","computeLayerTitleFromFile","dformat","getDate","addLayerAndFeaturesStyledToMap","imposedSourceOptions","imposedLayerOptions","addLayerAndFeaturesToMap","randomStyle","searchIndexEnabled","handleInvalidFileImportError","handleUnreadbleFileImportError","handleSizeFileImportError","sizeMb","handleSRSImportError","handleOgreServerImportError","getFileExtension","ImportService","GeoJSON","GML","GPX","KML","Shapefile","ogreUrl","clientSideFileSizeMax","importConfig","clientSideFileSizeMaxMb","formats","allowedExtensions","formatExtensionAssociation","import","importAsync","getFileImporter","extension","zipMimeTypes","allowedZipMimeTypes","allowedMimeTypes","importFile","importFileWithOgre","importer","parseFeaturesFromFile","readAsText","FormData","append","parseFeaturesFromGeoJSON","errMsg","msg","writeFeatureObject","ExportFormat","EncodingFormat","ExportError","ExportInvalidFileError","ExportNothingToExportError","ExportService","CSVcomma","CSVsemicolon","aggregateInComment","gpxAggregateInComment","encoding","exportOlFeatures","generateFeature","exportAsync","excludePrefix","generateAggregatedFeature","comment","nothingToExport","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","encodingType","featuresText","UTF8","acceptCharset","enctype","LATIN1","featuresJson","encodedProperties","geojsonField","outputNameField","outputName","ogreFormat","outputFormatField","submit","CustomHtmlComponent","_html","projection_r6","translateKey","ImportExportComponent_form_8_mat_option_7_p_1_Template","ImportExportComponent_form_8_mat_option_7_p_2_Template","inputProj","ImportExportComponent_form_8_mat_option_7_Template","importFiles","files","importForm","projections$","invalid","loading$","fileSizeMb","importHtmlClarifications","ImportExportComponent_section_9_div_1_Template","ImportExportComponent_section_9_igo_custom_html_2_Template","layer_r29","onlySelectedClick","inLayersIdToExportSelectionOnly","onlySelected","ImportExportComponent_form_12_mat_option_10_mat_slide_toggle_4_Template","layerHasSelectedFeatures","format_r40","ImportExportComponent_form_12_ng_container_18_mat_option_1_Template","formats$","encoding_r43","ImportExportComponent_form_12_div_23_ng_container_6_mat_option_1_Template","encodings$","ImportExportComponent_form_12_div_23_ng_container_6_Template","exportHtmlClarifications","ImportExportComponent_form_12_span_9_Template","ImportExportComponent_form_12_mat_option_10_Template","ImportExportComponent_form_12_ng_container_18_Template","ImportExportComponent_form_12_mat_option_20_Template","ImportExportComponent_form_12_div_22_Template","ImportExportComponent_form_12_div_23_Template","ImportExportComponent_form_12_div_24_Template","ImportExportComponent_form_12_div_25_Template","ImportExportComponent_form_12_div_26_Template","handleExportFormSubmit","ImportExportComponent_form_12_igo_custom_html_36_Template","getLayerTitleById","exportableLayers$","forceNaming","combineLayers","ImportExportComponent","importService","exportService","controlFormat","exportableLayers$$","formats$$","encodings$$","formLayer$$","exportOptions$$","espgCodeRegex","projectionsConstraints","popupChecked","previousLayerSpecs$","selectFirstProj","_projectionsLimitations","computeProjections","selectedMode","selectMode","exportOptions$","exportOptionsChange","popupAllowed","loadConfig","configFileSizeMb","exportOptions","computeFormats","handlePopup","handlePreviousLayerSpecs","selectedLayers","previousSpecs","encodings","configProjection","getWorkspaceByLayerId","wksFromLayerId","wksFromLayer","layersWithSelection","specs","onFileImportSuccess","onFileImportError","preCheck","p2","closed","onPopupBlockedError","geomTypesCSV","featuresCSV","filename","layerIndex","dSOptions","wks","featureInMapExtent","geomTypes","featureGeomType","currentGeomType","geomType","circular","gpxFeatureCnt","previousFeature","currentFeature","titleEmptyRows","createTitleEmptyRows","onFileExportError","onFileExportSuccess","titleRow","headerRow","emptyRow","previousFeatureKeys","firstKeyPrevious","currentFeatureKeys","firstKeyCurrent","previousKey","firstKeyAll","sameKeys","unset","importExportOptions","allowToStoreLayer","importWithStyle","handleFileImportError","extraMessage","handleFileExportError","handleNothingToExportError","loadEncodings","encodingDefaultValue","appliedformats","formatsType","onlyUrl","onlyVector","vectorAndUrl","customList","allowedFormats","validateListFormat","configImportExportFormats","validatedListFormat","commonFormats","layersWithCustomFormats","previousCustomListFormats","finalFormats","modeChanged","handleFileExportSuccess","onImportExportChange","ImportExportComponent_form_8_Template","ImportExportComponent_section_9_Template","ImportExportComponent_section_10_Template","ImportExportComponent_form_12_Template","ExportButtonComponent","layerIsExportable","workspaceId","ExportButtonComponent_button_0_Template","ZoomButtonComponent","getMinZoom","getMaxZoom","onGeolocationClick","GeolocateButtonComponent","tracking$$","ngAfterContentInit","GeolocateButtonComponent_div_0_Template","HomeExtentButtonComponent","extentOverride","centerOverride","zoomOverride","homeExtentButtonExtent","homeExtentButtonCenter","homeExtentButtonZoom","computeHomeExtent","WakeLockButtonComponent","noSleep","NoSleep","satisfies","ie","edge","chrome","firefox","opera","safari","disableWakeLock","enableWakeLock","toggleWakeLock","rotated$","azimuthRounded","rotationRounded","currentStyle$","RotationButtonComponent","showIfNoRotation","radians","deg","bearingToAzimuth","RotationButtonComponent_div_0_Template","OverlayAction","ZoomIfOutMapExtent","OverlayService","features$","OverlayDirective","overlayService","features$$","olFormatGeoJSON","handleFeatures","jsGeoPdfPlugin","jsPDFAPI","setGeoArea","pdfExt","geoExt","minx","maxx","maxy","miny","bounds","bbox_obj","internal","newAdditionalObject","bounds_obj","proj_obj","objId","title_obj","bbox_id","write","PrintOutputFormat","PrintPaperFormat","PrintOrientation","PrintResolution","PrintSaveImageFormat","PrintLegendPosition","PrintService","zipFile","nbFileToProcess","imgSizeAdded","TEXTPDFFONT","titleFont","titleFontStyle","subtitleFont","subtitleFontStyle","commentFont","commentFontStyle","commentFontSize","print","paperFormat","legendPostion","legendPosition","GeoPdfPlugin","jsPDF","API","dimensions","margins","titleSizes","subtitleSizes","A1","A0","fontSizeInPt","getTextPdfObjectSizeAndMarg","addTextInPdfDoc","marginLeft","showProjection","showScale","addProjScale","addComment","addMap","handleMeasureLayer","addGeoRef","addLegendSamePage","addLegend","saveDoc","docHeight","getHeight","pdf_extents","pdf_units2points","canvasOverlayHTMLMeasures","mapOverlayMeasuresHTML","getOverlayContainer","html2canvas","addCanvas","getLayersLegendHtml","legends","getLayersLegends","legendUrls","images$","getDataImage","rxMap","dataImage","htmlImg","dataImages","getLayersLegendImage","doZipFile","canvas","useCORS","removeHtmlElement","generateCanvaFileToZip","saveCanvasImageAsFile","pageWidth","setFont","textMarginLeft","textDimensions","getTextDimensions","w","commentMarginLeft","commentMarginBottom","textToAdd","textFont","textFontStyle","textFontSize","textMarginTop","isComment","splitTextToSize","heightPixels","textProjScale","_this4","imageSize","pourcentageReduction","imgData","addPage","toDataURL","addImage","_this5","marginsLegend","defineNbFileToProcess","ms","getImageSizeToFitPdf","rect","docSize","_this6","mapSize","viewResolution","dimensionPixels","setMapResolution","_ref2","mapCanvas","getViewport","mapResultCanvas","drawMap","resetOriginalMapSize","drawMapControls","mapStatus$$","mapStatus","_x2","initialSize","widthPixels","scaling","setResolution","updateSize","renderSync","_this7","handleCanvas","mapContextResult","getContext","parentElement","globalAlpha","matrix","CanvasRenderingContext2D","setTransform","fillStyle","fillRect","drawImage","_this8","mapOverlayHTML","getOverlayContainerStopEvent","cloneNode","addNorthDirection","addAttribution","canvasOverlayHTML","allowTaint","northDirection","HTMLButton","HTMLattribution","downloadMapImage","printResolution","_this9","initialMapSize","_ref3","addLegendToImage","newCanvas","newContext","positionHCanvas","commentWidth","measureText","positionHProjScale","commentNbLine","positionHComment","fillText","projectionScaleText","CommentLengthToCut","positionLastBlank","commentCurrentLine","positionFirstCutChar","fileNameWithExt","tfwFileNameWithExt","tiwContent","getWorldFileInformation","addFileToZip","saveAs","saveFileProcessing","_x3","setMapImageResolution","scaleFactor","newMapSize","_this10","canvasLegend","canvasHeight","canvasWidth","legendHeight","legendWidth","legendX","legendY","strokeRect","renderMap","save","returnPromise","pageHeight","canHeight","canWidth","heightRatio","widthRatio","maxRatio","currentResolution","nameWithExt","blobFormat","toBlob","JSZip","msSaveBlob","msToBlob","getZipFile","generateAsync","maxLength","legendPosition_r9","PrintFormComponent_mat_option_43_ng_container_1_Template","PrintFormComponent_mat_option_43_ng_container_2_Template","outputFormat_r13","paperFormat_r14","imageFormat_r15","resolution_r16","orientation_r17","PrintFormComponent","outputFormats","paperFormats","orientations","imageFormats","legendPositions","isPrintService","imageFormat","imageFormatField","Jpeg","onlySelf","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","none","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","minLength","handleFormSubmit","toggleImageSaveProp","clearValidators","changeCommentLength","A2","A3","A4","A5","PrintFormComponent_mat_error_8_Template","PrintFormComponent_mat_error_16_Template","PrintFormComponent_mat_error_24_Template","PrintFormComponent_mat_option_43_Template","PrintFormComponent_mat_option_52_Template","PrintFormComponent_mat_option_61_Template","PrintFormComponent_mat_option_70_Template","PrintFormComponent_mat_option_79_Template","PrintFormComponent_mat_option_88_Template","maxlength","PrintComponent","printService","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","DirectionsFormat","SourceDirectionsType","Trip","ProposalType","Coord","Text","DirectionType","Stop","Vertex","DirectionRelativePositionType","Start","Intermediate","End","updateStoreSorting","stopsStore","computeRelativePosition","totalLength","relativePosition","addStopToStore","stops","positions","stop","maxPosition","insertPosition","stopToUpdate","directionsStyle","vertexStyle","stopStyle","routeStyle","formatDistance","formatDuration","formatInstruction","modifier","stepPosition","exit","lastStep","directive","cssClass","translatedDirection","translateBearing","bearing","translatedModifier","translateModifier","aggregatedDirection","coma","cntSuffix","instruction","DirectionsService","directionsSourceService","directionsOptions","routeSource","downloadDirection","align","addInstructions","setPageHeaderFooter","setHTMLTableContent","directionsInstruction","tblBody","cellImage","cellText","img","span","spanDistance","verticalAlign","matListItem","iconsArray","iconName","iconCanvas","formattedDirection","maneuver","bearing_after","HTMLtable","autoTable","startY","titlePosition","margin","columnStyles","cellWidth","theme","didDrawCell","cell","section","raw","pageCount","getNumberOfPages","now","logo","setPage","baseline","getCurrentPageInfo","pageNumber","DOCUMENT","StopsStore","storeInitialized$","clearStops","StopsFeatureStore","RoutesFeatureStore","StepFeatureStore","stop_r1","clearStop","result_r12","DirectionsInputsComponent_div_1_mat_optgroup_9_mat_option_1_Template","source_r10","removeStop","DirectionsInputsComponent_div_1_div_10_button_4_Template","onStopEnter","onStopLeave","stopIsDragged","onInputFocus","setStopText","DirectionsInputsComponent_div_1_button_6_Template","chooseProposal","DirectionsInputsComponent_div_1_mat_optgroup_9_Template","DirectionsInputsComponent_div_1_div_10_Template","getNgClass","getPlaceholder","stopWithHover","getOptionText","searchProposals","DirectionsInputsComponent","invalidKeys","onMapClickEventKeys","stopsFeatureStore","coordRoundedDecimals","stopInputHasFocus","unlistenMapSingleClick","geomCoord","validateTerm","keyIsValid","extra","removeStopFromStore","computeStopsPosition","stopsToComputePosition","drop","moveStops","previousIndex","currentIndex","fromIndex","moveItemInArray","listenMapSingleClick","roundedCoord","olProj","olObservable","DirectionsInputsComponent_div_1_Template","resetStops","zoomRoute","copyDirectionsToClipboard","copyLinkToClipboard","printDirections","DirectionsButtonsComponent","directionsService","activeRoute","routesFeatureStore","zoomToActiveRoute$","stepFeatureStore","addStop","directionsBody","directionsToText","indent","activeRouteDirective","wayPointList","wayPointsCnt","stopText","localCnt","formatStep","routingOptions","directionsKey","stopsCoordinates","directionsUrl","pathname","DirectionsButtonsComponent_button_4_Template","DirectionsButtonsComponent_button_7_Template","DirectionsButtonsComponent_button_9_Template","DirectionsButtonsComponent_button_11_Template","DirectionsButtonsComponent_button_13_Template","direction_r5","cnt_r6","changeRoute","activeDirection","DirectionsResultsComponent_div_0_mat_form_field_1_mat_option_6_Template","directions","step_r10","showSegment","cnt_r11","DirectionsResultsComponent_div_0_mat_form_field_1_Template","DirectionsResultsComponent_div_0_mat_divider_2_Template","onStepsListBlur","DirectionsResultsComponent_div_0_mat_list_item_8_Template","DirectionsResultsComponent","activeFeatureWithDirection","showRouteSegmentGeometry","vertexId","lastPoint","olGeom","geojsonGeom","previousVertex","DirectionsResultsComponent_div_0_Template","DirectionsComponent","searchService","zoomRoute$$","storeEmpty$$","storeChange$$","routesQueries$$","selectStopInteraction","translateStop","selectedRoute","focusOnStop","isTranslating","previousStops","searchs$$","initEntityStores","initStopsFeatureStore","loadingStrategy","initRoutesFeatureStore","initStepFeatureStore","initOlInteraction","u","freezeStores","monitorEmptyEntityStore","monitorEntityStoreChange","monitorActiveRouteZoom","routeExtent","executeStopTranslation","olCondition","selectCoordinates","addedStop","onStopInputHasFocusChange","translatedStopId","translationCoordinates","translatedStop","handleStopDiff","handleStopsFeature","getRoutes","cancelSearch","simplifiedStops","stopIdToProcess","changedStop","researches","isCoord","requests$","sp","storedSource","addStopOverlay","stopFeature","isOverview","stopsWithCoordinates","roundedCoordinates","routeResponse","overview","alternatives","continue_straight","addDirectionToRoutesFeatureStore","previousRoute","routeFeatureStore","addStopToStopsFeatureStore","stopColor","previousStop","stopFeatureStore","stopOpacity","OsrmDirectionsSource","_name","directionsParams","getRouteParams","getRoute","extractRoutesData","formatRoute","waypoints","geometries","roadNetworkRoute","stepsUI","legs","sourceType","weight_name","osrmDirectionsSourcesFactory","provideOsrmDirectionsSource","SEARCH_TYPES","SearchPointerSummaryDirective","pointerSearchStore","reverseSearch$$","hasPointerReverseSearchSource","searchPointerSummaryFeatureId","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","mouseleave","ngAfterContentChecked","unsubscribeReverseSearch","entitiesToPointerOverlay","computeSummaryClosestFeature","closestResultByType","summarizedClosestType","processedSummarizedClosestType","typeIndex","addPointerOverlay","onSearchCoordinate","sortByOrder","r1","r2","_results","onSearch","research","newResults","pointerSummary","CadastreSearchSource","endsWith","getCadastre","numero","lot","computeGeometry","NoLot","cadastreSearchSourceFactory","provideCadastreSearchSource","NominatimSearchSource","place_id","display_name","osm_type","boundingbox","computeTermTags","tag","computeTermSettings","nominatimSearchSourceFactory","provideNominatimSearchSource","StoredQueriesSearchSource","resultTitle","storedQueriesOptions","multipleFieldsQuery","defaultResultTitle","storedquery_id","splitPrefix","outputformat","srsname","storedqueriesParams","termSplitter","resultArray","extractWFSData","idxEnd","resultTotLenght","patternGml3","geojson","wfsfeatures","splittedTerm","remainingTerm","splitterRegex","wfsversion","StoredQueriesReverseSearchSource","longField","latField","longLatParams","doc_type","storedqueriesSearchSourceFactory","provideStoredQueriesSearchSource","storedqueriesReverseSearchSourceFactory","provideStoredQueriesReverseSearchSource","WorkspaceSearchSource","limitValue","fswi","termToUse","gettedIndex","sortedResultToProcess","resultsCnt","subtitleHtml2","workspaceSearchSourceFactory","provideWorkspaceSearchSource","searchType_r2","getSearchTypeTitle","SearchSelectorComponent","searchType$","searchType$$","searchTypes","setSearchType","searchTypeChange","onSetSearchType","onSearchTypeChange","SearchSelectorComponent_mat_radio_button_8_Template","checkUncheckAllSources","searchSourcesAllEnabled","source_r6","settingValue_r18","setting_r13","settingsValueCheckedRadioButton","getAvailableHashtagsValues","SearchSettingsComponent_ng_container_7_ng_container_7_span_6_mat_radio_button_2_Template","checkUncheckAll","allEnabled","settingValue_r32","settingsValueCheckedCheckbox","displayBlock","SearchSettingsComponent_ng_container_7_ng_container_7_span_7_div_1_Template","SearchSettingsComponent_ng_container_7_ng_container_7_span_7_mat_checkbox_3_Template","getAvailableValues","SearchSettingsComponent_ng_container_7_ng_container_7_span_6_Template","SearchSettingsComponent_ng_container_7_ng_container_7_span_7_Template","_r42","onCheckSearchSource","SearchSettingsComponent_ng_container_7_button_3_Template","SearchSettingsComponent_ng_container_7_button_4_Template","SearchSettingsComponent_ng_container_7_ng_container_7_Template","changePointerReverseSearch","pointerSummaryEnabled","SearchSettingsComponent","lastKeyTime","searchResultsGeometryEnabled","searchSourceChange","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","hasReverseSearchSourcesForPointerSummary","getSearchSources","textSearchSources","computeSourcesCheckAllBehavior","settingValue","computeSettingCheckAllBehavior","enabledSourcesCnt","disabledSourcesCnt","storage","changeSearchResultsGeometry","SearchSettingsComponent_div_6_Template","SearchSettingsComponent_ng_container_7_Template","SearchSettingsComponent_mat_slide_toggle_11_Template","onClearButtonClick","onSearchSettingsChange","SearchBarComponent","placeholder$","stream$","stream$$","researches$$","showSearchButton","withDivider","setTerm","_reverseSearchCoordsFormatEnabled","appearance","searchSelector","searchSettings","searchTermChange","clearFeature","searchSettingsChange","onSetTerm","handlePlaceholder","configValue","onKeyup","doSearch","reverseCoordEvent","slug","ss","rawTerm","terms","onResearchCompleted","SearchBarComponent_mat_label_3_Template","SearchBarComponent_button_10_Template","SearchBarComponent_mat_divider_12_Template","SearchBarComponent_button_14_Template","SearchBarComponent_igo_search_selector_15_Template","SearchBarComponent_igo_search_settings_16_Template","showIcons","tooltipHtml","SearchResultsItemComponent_ng_template_3_span_0_Template","onZoomHandler","SearchResultsItemComponent","withZoomButton","zoomEvent","getEntityTitleHtml","titleHtmlProperty","hideBtn","showBtn","SearchResultsItemComponent_mat_icon_1_Template","SearchResultsItemComponent_div_2_Template","SearchResultsItemComponent_ng_template_3_Template","SearchResultsItemComponent_button_6_Template","SaveFeatureDialogComponent","filteredLayers$","SaveFeatureDialogComponent_mat_option_13_Template","addFeatureToLayer","addFeatureToLayerTooltip$","SearchResultAddButtonComponent","layersSubcriptions","saveSearchResultInLayer","currEvent","Stroke","Fill","searchLayer","SearchResultAddButtonComponent_button_0_Template","SearchResultAddButtonComponent_button_1_Template","CollapsibleComponent","_title","group_r4","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_ng_container_1_Template","computeGroupTitle","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_ng_container_0_Template","result_r20","resultFocus","resultUnfocus","onResultSelect","templateSearchToolbar","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_ng_template_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_span_1_Template","results_r17","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_Template","searchResultMode","Grouped","SearchResultsComponent_igo_list_0_ng_template_1_Template","results$","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_ng_container_1_Template","group_r39","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_Template","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_ng_container_0_Template","group_r42","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_Template","result_r47","_r56","group_r44","SearchResultsComponent_igo_list_1_ng_template_6_ng_template_0_Template","SearchResultsComponent_igo_list_1_ng_template_6_span_1_Template","SearchResultsComponent_igo_list_1_ng_container_1_Template","SearchResultsComponent_igo_list_1_ng_template_2_Template","SearchResultsComponent_igo_list_1_ng_template_4_Template","SearchResultsComponent_igo_list_1_ng_template_6_Template","SearchResultMode","Flat","SearchResultsComponent","showResultsCount","settingsChange$$","pageIterator","tabsMode","_term","settingsChange$","resultSelect","moreResults","resultMouseenter","resultMouseleave","_results$","liftResults","groupResults","grouped","sourceResults","SearchResultsComponent_igo_list_0_Template","SearchResultsComponent_igo_list_1_Template","WfsWorkspace","getLayerWksOptionTabQuery","queryOptions","tabQuery","getLayerWksOptionMapQuery","mapQueryOnOpenTab","getInResolutionRange","getCommonVectorSelectedStyle","markerOpacity","fillOpacity","strokeOpacity","getCommonVectorStyle","isOlFeature","markerColorAsArray","markerColorRGB","mapExtentStrategyActiveToolTip","addOrRemoveLayer","addedLayerId","ws$","geoServiceAction","getGeoServiceAction","geoServiceProperties","relations","columnsFromFeatures","col","cellClass","relationsColumn","relation","class_icon","createFilterInMapExtentOrResolutionStrategy","WfsWorkspaceService","zoomAuto","createWorkspace","srcId","createFeatureStore","inMapExtentStrategy","geoPropertiesStrategy","inMapResolutionStrategy","confQueryOverlayStyle","FeatureWorkspace","FeatureWorkspaceService","searchStrategy","ConfirmationPopupComponent","cancelAction","confirmedAction","EditionWorkspace","adding$","_deleteFeature","getDomainValues","modifyStyle","newFeaturefilterClauseFunc","editFeaturefilterClauseFunc","edit","deleteFeature","deleteUrl","columnName","editFeature","editionOpt","original_properties","original_geometry","idkey","addWithDraw","featureOl","createModifyInteraction","olCollection","Collection","EditionWorkspaceService","relationLayers$","rowsInMapExtentCheckCondition$","wktFormat","WKT","geoJsonFormat","wksConfig","wmsLinkId","wfsLinkId","linkProperties","hasOgcFilters","clonedLinks","workspaceLayer","rendererType","modifyButton","deleteButton","saveFeature","cancelEdit","validateFeature","sanitizeParameter","addUrl","addHeaders","modifyProtocol","modifyUrl","protocole","modifyHeaders","modifyFeature","hasGeometry","projDest","geomDatabaseProj","refreshMap","removeZ","relationLayers","fromSave","wfsOlLayer","wmsOlLayer","_t","WmsWorkspaceService","printable","WorkspaceSelectorDirective","wfsWorkspaceService","wmsWorkspaceService","editionWorkspaceService","featureWorkspaceService","changeWorkspace","rowsInMapExtentCheckCondition","workspaceStore","onLayersChange","adding","editableLayers","layerIsEditable","editableLayersIds","workspacesToAdd","getOrCreateWorkspace","workspacesToRemove","wmsWks","getLayerFillColor","StyleModalLayerComponent","initialValues","defaultValues","getLayerStrokeColor","arrayColor","setLayerFillColor","cAA","setLayerStrokeColor","StyleModalLayerComponent_div_6_Template","StyleModalLayerButtonComponent","infoContent","InfoSectionComponent","InfoSectionComponent_div_0_Template","pointerCoord","AppSimpleMapRoutingModule","AppSimpleMapComponent","pointerCoordDelay","onPointerMove","AppSimpleMapComponent_p_9_Template","AppSimpleMapModule","AppLayerRoutingModule","AppLayerComponent","AppLayerComponent_ng_template_10_Template","AppLayerModule","AppLegendRoutingModule","AppLegendComponent","AppLegendModule","AppOverlayRoutingModule","AppOverlayComponent","AppOverlayModule","AppGeometryRoutingModule","AppGeometryComponent","AppGeometryComponent_igo_form_5_Template","AppGeometryModule","AppFeatureRoutingModule","AppFeatureComponent","AppFeatureModule","AppHoverRoutingModule","AppHoverComponent","pointerHoverFeatureDelay","AppHoverModule","AppMeasureRoutingModule","AppMeasureComponent","AppMeasureModule","AppDrawRoutingModule","AppDrawComponent","AppDrawModule","feature_r3","AppQueryComponent_ng_container_5_div_1_Template","features_r1","AppQueryRoutingModule","AppQueryComponent","feature1","olLineString","feature2","feature3","handleQueryResults","AppQueryComponent_ng_container_5_Template","AppQueryModule","AppCatalogRoutingModule","AppCatalogComponent","catalogStore","catalogItemStore","onCatalogSelectChange","AppCatalogModule","IgoContextImportExportModule","TypePermission","null","ContextService","context$","contexts$","ours","defaultContextId$","editedContext$","importedContext","toolsChanged$","mapViewFromRoute","defaultContextUri","_defaultContextUri","basePath","contextListFile","readParamsFromRoute","handleContextsChange","loadContexts","permissions","getById","getDetails","getDefault","getContextByUri","getProfilByUser","setDefault","defaultContextId","hideContext","showContext","imported","contexts","contextCreated","permission","contextCloned","addToolAssociation","contextId","toolId","deleteToolAssociation","getPermissions","addPermissionAssociation","profil","typePermission","deletePermissionAssociation","permissionId","getLocalContexts","getLocalContext","urlBase","resBase","resMerge","l2","t2","err2","loadDefaultContext","loadFct","direct","_context","addContextToList","setContext","loadContext","contextParam","handleContextMessage","currentContext","keepCurrentView","loadEditedContext","setEditedContext","getContextFromMap","igoMap","global","getContextFromLayers","extraFeatures","layerFound","contextLayer","layerFoundAs","olVectorSource","getExtraFeatures","catalogLayer","Cluster","cleanedOlFeatures","contextToLoad","getContextLayers","mapLayers","permissionError","titleContext","keepCurrentContext","editedContext","findContext","editedFound","public","found","MapContextDirective","contextService","context$$","handleContextChange","viewContext","controlsContext","scaleLineOption","minWidth","collectFeaturesFromExtraFeatures","LayerContextDirective","contextLayers","removeLayersOnContextChange","layersAndIndex$","handleAddLayers","addImportedFeaturesStyledToMap","addImportedFeaturesToMap","featureKeys","computeLayerVisibilityFromUrl","currentLayerid","contextParams","visibleOnLayersParams","visibleOffLayersParams","visiblelayers","invisiblelayers","PoiService","IgoContextMapButtonModule","IgoContextManagerModule","IgoShareMapModule","IgoSidenavModule","MatSidenavModule","IgoContextModule","ContextExportService","ContextImportService","parseContextFromFile","ContextImportExportComponent_form_9_mat_option_18_Template","userControlledLayerList","ContextImportExportComponent","contextImportService","contextExportService","layerList","activeImportExport","contextOptions","contextTitle","addContextToContextList","ContextImportExportComponent_div_8_Template","ContextImportExportComponent_form_9_Template","ContextListControlsEnum","BookmarkDialogComponent","iconImage","favoriteClick","ContextItemComponent_button_1_mat_icon_2_Template","ContextItemComponent_button_1_img_3_Template","managePermissions","ContextItemComponent_div_5_button_1_Template","ContextItemComponent_div_5_button_4_Template","ContextItemComponent_div_5_button_5_Template","ContextItemComponent_div_5_button_6_Template","ContextItemComponent_div_5_button_7_Template","ContextItemComponent_div_5_button_8_Template","ContextItemComponent_div_5_button_9_Template","canShare","ContextItemComponent","showFavorite","favorite","manageTools","ContextItemComponent_button_1_Template","ContextItemComponent_button_2_Template","ContextItemComponent_div_5_Template","clearFilter","ContextListComponent_mat_form_field_2_button_6_Template","toggleSort","user_r17","child_r24","userSelection","getPermission","ContextListComponent_ng_container_10_button_4_Template","ContextListComponent_ng_container_10_button_5_Template","ContextListComponent_ng_container_10_mat_checkbox_9_Template","indeterminate","childs","context_r36","selectedContext","_r50","groupContexts_r32","titleMapping","ContextListComponent_ng_template_17_igo_collapsible_0_ng_template_2_Template","context_r54","ctx_r57","ContextListComponent_ng_template_17_1_ng_template_0_Template","ContextListComponent_ng_template_17_igo_collapsible_0_Template","ContextListComponent_ng_template_17_1_Template","ContextListComponent","contextsInitial","_contexts","_selectedContext","_defaultContextId","showHiddenContexts","filterPermissionsChanged","shared","users","showHidden","sortedAlpha","showContextFilter","thresholdToFilter","filterContextsList","createContext","sortContextsList","updateContexts","publics","showFilter","contextsList","parentPermission","childrenPermission","ContextListComponent_mat_form_field_2_Template","ContextListComponent_button_4_Template","ContextListComponent_button_5_Template","ContextListComponent_igo_actionbar_6_Template","ContextListComponent_button_7_Template","ContextListComponent_ng_container_10_Template","ContextListComponent_ng_template_17_Template","ContextListBindingDirective","contexts$$","selectedContext$$","defaultContextId$$","onEdit","onSave","contextFromMap","msgSuccess","onFavorite","onManageTools","onManagePermissions","onDelete","onClone","onCreate","onShowContext","onHideContext","storedContextUri","authenticate","profilsAcc","cur","ContextFormComponent","btnSubmitText","_btnSubmitText","uriSplit","ContextFormComponent_span_8_Template","ContextEditComponent","ContextEditComponent_igo_context_form_0_Template","ContextEditBindingDirective","editedContext$$","submitSuccessed","handleEditedContextChange","scopeChanged","ContextPermissionsComponent_div_0_div_2_mat_radio_button_8_Template","profil_r11","onProfilSelected","ContextPermissionsComponent_div_0_form_3_mat_option_6_Template","permission_r19","removePermission","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_button_7_Template","profilTitle","canWrite","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_Template","groupPermissions_r16","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_Template","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_Template","ContextPermissionsComponent_div_0_div_1_Template","ContextPermissionsComponent_div_0_div_2_Template","ContextPermissionsComponent_div_0_form_3_Template","ContextPermissionsComponent_div_0_igo_list_4_Template","ContextPermissionsComponent","_permissions","_profils","baseUrlProfils","addPermission","profilTitleNormalized","ContextPermissionsComponent_div_0_Template","ContextPermissionsBindingDirective","onAddPermission","onRemovePermission","onScopeChanged","permissionsArray","ShareMapService","getUrlWithApi","formValues","createContextShared","updateContextShared","getUrlWithoutApi","publicShareOption","llc","layerlistControls","querystring","visibleKey","invisibleKey","visibleLayers","invisibleLayers","layersUrl","layersToLoop","contextLayersID","addedLayersQueryParamsWms","makeLayersByService","addedLayersQueryParamsWmts","addedLayersQueryParamsArcgisRest","addedLayersQueryParamsImageArcgisRest","addedLayersQueryParamsTileArcgisRest","arrayCenter","typeService","addedLayersByService","layerVersion","linkUrl","addedLayer","addedLayerPosition","definedUrl","addedLayersQueryParams","linkUrlKey","layersKey","linkUrlQueryParams","layersQueryParams","ShareMapUrlComponent_div_13_h4_1_Template","ShareMapUrlComponent_div_13_li_4_Template","ShareMapUrlComponent_div_13_li_6_Template","ShareMapUrlComponent_div_13_li_8_Template","ShareMapUrlComponent_div_13_li_10_Template","ShareMapUrlComponent_div_13_li_12_Template","ShareMapUrlComponent_div_13_h4_14_Template","ShareMapUrlComponent_div_13_li_17_Template","ShareMapUrlComponent_div_13_li_19_Template","ShareMapUrlComponent_div_13_li_21_Template","ShareMapUrlComponent_div_13_li_23_Template","ShareMapUrlComponent","shareMapService","mapState$$","resetUrl","ShareMapUrlComponent_div_13_Template","ShareMapUrlComponent_igo_custom_html_15_Template","userId","ShareMapApiComponent","idContextShared","createUrl","ShareMapApiComponent_span_10_Template","ShareMapApiComponent_button_18_Template","ShareMapApiComponent_button_19_Template","ShareMapApiComponent_div_20_Template","ShareMapComponent","hasApi","ShareMapComponent_mat_tab_group_0_Template","ShareMapComponent_igo_share_map_url_1_Template","IgoAppSearchBarModule","IgoAppSearchResultsToolModule","IgoAppSearchModule","openGuide","guide_r7","formatFileName","headerHtml","AboutToolComponent","_headerHtml","_discoverTitleInLocale","discoverTitleInLocale","trainingGuideURLs","baseUrlProfil","baseUrlGuide","guides","guide","AboutToolComponent_button_2_Template","AboutToolComponent_button_3_Template","AboutToolComponent_button_6_Template","AboutToolComponent_igo_custom_html_7_Template","ImportExportType","ImportExportMode","ImportExportState","importExportType$","selectedMode$","setImportExportType","setMode","setsExportOptions","ToolState","importExportState","openSidenav$","toolToActivateFromOptions","toolToActivate","ContextState","toolState","onContextChange","updateTools","contextTool","baseTool","parentIndex","StorageState","igoStorageService","handleZoomAuto","getWorkspaceActions","selectOnlyCheckCondition$","ogcFilterWidget","zoomAuto$","maximize$","datePipe","noElementSelected","filterStrategy","totalPagesExp","tableWidth","horizontalPageBreak","cellPadding","minCellWidth","didDrawPage","putTotalPages","returnActions","FeatureActionsService","storageState","storageChange$$","loadActions","buildActions","storageChange","WfsActionsService","EditionActionsService","WorkspaceState","featureActionsService","wfsActionsService","editionActionsService","workspacePanelExpanded","workspaceEnabled$","workspaceMaximize$","actionMaximize$$","rowsInMapExtentCheckCondition$$","selectOnlyCheckCondition$$","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","workspace$","workspaceSelection","workspaceSelection$","initWorkspaces","maximized","setWorkspaceIsMaximized","rowsInMapExtent","selectOnly","setActiveWorkspaceById","wksFromId","setActiveWorkspaceByTitle","wksFromTitle","teardownWorkspaces","MapState","_legendToolShowAll","applyNewLayers","layer_r5","AdvancedSwipeComponent_div_0_mat_option_12_Template","startSwipe","swipe","searchEmit","catalogEmit","contextEmit","AdvancedSwipeComponent","mapState","listForSwipe","AdvancedSwipeComponent_div_0_Template","AdvancedSwipeComponent_ng_template_1_Template","projection_r11","translatedValue","AdvancedCoordinatesComponent","formattedScale$","currentCenterDefaultProj","inMtmZone","inLambert2","defaultProj","currentZones","setScaleValue","currentMtmZone","currentUtmZone","back2quebec","updateProjectionsZoneChange","checkLambert","tempInputProj","positionInList","updateZoneMtmUtm","displayCenter","modifiedProj","pushMtm","tk","iter","currentExtentWGS","AdvancedCoordinatesComponent_mat_form_field_2_Template","AdvancedCoordinatesComponent_ng_template_3_Template","AdvancedCoordinatesComponent_mat_form_field_5_Template","AdvancedCoordinatesComponent_ng_template_6_Template","AdvancedCoordinatesComponent_mat_option_17_Template","AdvancedMapToolComponent","toggleTracking","toggleFollow","MapProximityState","defaultProximityRadiusValue","enabled$","proximityRadiusValue$","proximitylocationType$","proximityFeatureStore","subs$$","currentPositionCoordinate$","subscribeProximityMonitor","currentPos","locationType","proximityRadiusValue","roundedCoordLonLat","layerToMonitor","layerSource","olFeaturesAtCoordinate","getFeaturesAtCoordinate","olFeatureAtCoordinate","featureAtThisPosition","closestOlFeature","getClosestFeatureToCoordinate","closestOlGeom","closestFeature","geometryClosestPoint","getClosestPoint","lineLength","coordFromCalculatedDistance","layerSrcId","layerSrcTitle","coord_r4","coord2_r6","MapProximityToolComponent","mapProximityState","maxDistance","userDefinedMapCenter","userDefinedFollowPosition","onLocationTypeChange","MapProximityToolComponent_mat_form_field_3_Template","MapProximityToolComponent_mat_form_field_5_Template","MapProximityToolComponent_button_7_Template","WorkspaceButtonComponent","workspaceState","hasWorkspace$","hasWorkspace$$","layer$","WorkspaceButtonComponent_button_0_Template","activateExport","MapDetailsToolComponent_igo_layer_list_0_ng_template_1_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_p_4_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_5_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_6_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_7_Template","layerAdditionAllowed","searchToolInToolbar","catalogToolInToolbar","contextToolInToolbar","MapDetailsToolComponent_ng_template_2_mat_list_0_Template","delayedShowEmptyMapContent","MapDetailsToolComponent","layerListControls","filterSortOptions","MapDetailsToolComponent_igo_layer_list_0_Template","MapDetailsToolComponent_ng_template_2_Template","LayerLegendListBindingDirective","onShowAllLegends","showAllLegendsValue$","MapLegendToolComponent_1_ng_template_0_Template","visibleLayers$","MapLegendToolComponent_ng_template_6_mat_list_0_p_4_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_5_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_6_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_7_Template","MapLegendToolComponent_ng_template_6_mat_list_0_Template","MapLegendToolComponent","visibleOrInRangeLayers$$","visibleOrInRangeLayers$","visibleOrInRangeLayers","MapLegendToolComponent_igo_layer_legend_list_0_Template","MapLegendToolComponent_1_Template","MapLegendToolComponent_p_3_Template","MapLegendToolComponent_ng_template_6_Template","MapToolComponent","MapToolComponent_ng_template_4_Template","LayerListToolState","keyword$","selectedTab$","setKeyword","setSortAlpha","setOnlyVisible","setSelectedTab","tab","getLayerListControls","activateTimeFilter","activateOgcFilter","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_style_modal_layer_button_0_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_time_filter_button_3_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_ogc_filter_button_4_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_export_button_5_Template","isStyleEditButton","isTimeFilterButton","isOGCFilterButton","isExportButton","onLayerListChange","MapToolsComponent_igo_layer_list_5_ng_template_1_Template","MapToolsComponent_10_ng_template_0_Template","MapToolsComponent_ng_template_15_mat_list_0_p_4_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_5_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_6_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_7_Template","MapToolsComponent_ng_template_15_mat_list_0_Template","MapToolsComponent","layerListToolState","selectedTabAtOpening","_layerListControls","stateOptions","stateKeyword","stateOnlyVisible","stateSortAlpha","tabGroup","selectedTab","userSelectedTab","tabChanged","appliedFilters","MapToolsComponent_igo_layer_list_5_Template","MapToolsComponent_igo_layer_legend_list_9_Template","MapToolsComponent_10_Template","MapToolsComponent_p_12_Template","MapToolsComponent_ng_template_15_Template","SearchState","searchLayerStores","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","focusedOrResolution$$","selectedOrResolution$$","searchTermSplitter$","searchTerm$","searchDisabled$","searchResultsGeometryEnabled$","searchSettingsChange$","selectedResult$","createCustomFilterTermStrategy","wksSource","searchableWks","monitorLayerDeletion","activateCustomFilterTermStrategy","deactivateCustomFilterTermStrategy","enableSearch","disableSearch","setSearchTerm","searchTerm","setSearchSettingsChange","setSelectedResult","setSearchResultsGeometryStatus","ContextManagerToolComponent","toolToOpenOnContextChange","editContext","ContextEditorToolComponent","ContextPermissionManagerToolComponent","ContextShareToolComponent","CatalogState","_catalogStore","catalogItemsStores","clearCatalogItemsStores","getCatalogItemsStore","setCatalogItemsStore","store_r1","CatalogBrowserToolComponent","catalogState","store$","catalog$$","authenticate$$","CatalogBrowserToolComponent_igo_catalog_browser_0_Template","CatalogLibraryToolComponent","DirectionState","DirectionsToolComponent","directionState","contextState","currentContextUri","DrawState","layersID","deletedStore","drawControlIndex","DrawingToolComponent","drawState","addLayersID","addDrawControls","OgcFilterToolComponent","ActiveOgcFilterToolComponent","feature_r1","SpatialFilterToolComponent","activeLayers","iterator","selectedFeature$","spatialListStore","moveendKey","getOutputType","getOutputQueryType","activateExportTool","re","layerToOpenWks","zeroResults","selectWorkspaceEntity","getOutputToggleSearch","loadThematics","getOutputClearSearch","clearMap","tryAddFeaturesToMap","featuresPoint","featuresLinePoly","idPoint","idLinePoly","tryAddPointToMap","tryAddLayerToMap","zoomToFeatureExtent","_internal","featuresOl","createSvgIcon","pushLayer","xmlSerializer","SpatialFilterToolComponent_ng_container_4_Template","MatIconRegistry","TimeFilterListBindingDirective","TimeFilterToolComponent","ActiveTimeFilterToolComponent","ImportExportToolComponent","importExportType","importExportShowBothType","selectType","userSelectedType","userSelectedMode","importExportTypeChange","ImportExportToolComponent_mat_tab_group_0_Template","ImportExportToolComponent_igo_import_export_1_Template","ImportExportToolComponent_igo_context_import_export_2_Template","MeasureState","getOverlays","MeasurerToolComponent","measureState","PrintToolComponent","result_r6","isSelectedResultOutOfView$","toggleTopPanel","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_button_4_Template","featureTitle","topPanelState$","onResultFocus","onResultUnfocus","SearchResultsToolComponent_igo_flexible_2_ng_template_5_Template","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_Template","topPanelState","SearchResultsToolComponent","searchState","topPanelStateDefault","hasFeatureEmphasisOnSelection","showResultsGeometries$$","getRoute$$","shownResultsGeometries","shownResultsEmphasisGeometries","focusedResult$","isSelectedResultOutOfView$$","abstractFocusedResult","abstractSelectedResult","debouncedEmpty$","debouncedEmpty$$","searchTerm$$","topPanelState$$","computeElementRef","adjustTopPanel","buildResultEmphasis","monitorResultOutOfView","searchResults","clearFeatureEmphasis","selectedResult","selectedOlFeatureExtent","abstractResult","computedStyle","zIndexOffset","shownResult","tryAddFeatureToMap","routingCoordLoaded","currentCoord","SearchResultsToolComponent_div_0_Template","SearchResultsToolComponent_igo_flexible_2_Template","ElementRef","ContextMenuDirective","viewContainerRef","elementRef","overlayRef","menuContext","menuPosition","onContextMenu","TouchEvent","pageX","pageY","MouseEvent","positionStrategy","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","scrollStrategy","scrollStrategies","attach","TemplatePortal","clickTarget","overlayElement","dispose","result_r7","AppSearchRoutingModule","AppSearchComponent","osmLayer","mapBrowser","searchStore","igoReverseSearchCoordsFormatEnabled","onPointerSummaryStatusChange","onSearchTermChange","onReverseCoordsFormatStatusChange","searchCoordinate","openGoogleMaps","openGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","contextmenuPoint","getBoundingClientRect","scrollY","scrollX","AppSearchComponent_span_2_Template","AppSearchComponent_ng_template_9_Template","AppSearchComponent_igo_panel_11_Template","AppSearchComponent_ng_template_12_Template","AppSearchModule","AppPrintRoutingModule","AppPrintComponent","AppPrintModule","AppImportExportRoutingModule","AppImportExportComponent","AppImportExport","AppDirectionsRoutingModule","AppDirectionsComponent","AppDirectionsModule","AppTimeFilterRoutingModule","AppTimeFilterComponent","AppTimeFilterModule","AppOgcFilterRoutingModule","AppOgcFilterComponent","AppOgcFilterModule","AppSpatialFilterRoutingModule","AppSpatialFilterComponent","AppSpatialFilterComponent_ng_container_12_Template","AppSpatialFilterModule","workspace_r2","AppWorkspaceComponent_ng_container_5_igo_entity_table_paginator_1_Template","workspace_r7","workspacePaginator","AppWorkspaceComponent_ng_container_7_igo_actionbar_1_Template","AppWorkspaceComponent_ng_container_7_igo_entity_table_2_Template","AppWorkspaceComponent_ng_container_7_mat_card_content_4_Template","AppWorkspaceRoutingModule","AppWorkspaceComponent","selectedWorkspace$","AppWorkspaceComponent_ng_container_5_Template","AppWorkspaceComponent_ng_container_7_Template","AppWorkspaceModule","AppContextRoutingModule","AppContextComponent","AppContextComponent_ng_template_15_Template","AppContextModule","HttpClientJsonpModule","redirectTo","pathMatch","AppRoutingModule","useHash","AppComponent","changeDetectorRef","mobileQuery","_mobileQueryListener","matchMedia","detectOldBrowser","handleSplashScreen","NavigationEnd","_removeSplashScreen","intro","stylesheet","removeEventListener","getBrowser","defaultTooltipOptions","showDelay","hideDelay","touchendHideDelay","disableTooltipInteractivity","AppModule","bootstrap","MAT_FORM_FIELD_DEFAULT_OPTIONS","appInitializerFactory","ApplicationRef","MAT_TOOLTIP_DEFAULT_OPTIONS","DatePipe","MatToolbarModule","HammerModule","applicationRef","isStable","setTranslation","enableProdMode","__NgCli_bootstrap_1","bootstrapModule","webpackContext","webpackContextResolve","__webpack_require__","module","exports"],"sourceRoot":"webpack:///","sources":["./packages/utils/src/lib/base64.ts","./packages/utils/src/lib/cache.utils.ts","./packages/utils/src/lib/user-agent.ts","./packages/utils/src/lib/clipboard.ts","./packages/utils/src/lib/string-utils.ts","./packages/utils/src/lib/change.interface.ts","./packages/utils/src/lib/change.ts","./packages/utils/src/lib/dom.utils.ts","./packages/utils/src/lib/file.ts","./packages/utils/src/lib/object-utils.ts","./packages/utils/src/lib/number-utils.ts","./packages/utils/src/lib/strenum.ts","./packages/utils/src/lib/uuid.ts","./packages/utils/src/lib/watcher.ts","./packages/core/src/lib/activity/activity.service.ts","./packages/core/src/lib/activity/activity.interceptor.ts","./packages/core/src/lib/activity/activity.module.ts","./packages/core/src/lib/config/version.ts","./packages/core/src/lib/config/config.service.ts","./packages/core/src/lib/config/config.provider.ts","./packages/core/src/lib/config/config.module.ts","./packages/core/src/lib/language/shared/language.loader.ts","./packages/core/src/lib/language/shared/language.provider.ts","./packages/core/src/lib/language/shared/missing-translation.guard.ts","./packages/core/src/lib/language/language.module.ts","./packages/core/src/lib/message/message.module.ts","./packages/core/src/lib/message/shared/message.enum.ts","./packages/core/src/lib/language/shared/language.service.ts","./packages/core/src/lib/message/shared/message.service.ts","./packages/core/src/lib/request/error.interceptor.ts","./packages/core/src/lib/request/error.module.ts","./packages/core/src/lib/core.module.ts","./packages/core/src/lib/route/route.service.ts","./packages/core/src/lib/media/media.enum.ts","./packages/core/src/lib/media/media.service.ts","./packages/core/src/lib/storage/storage.interface.ts","./packages/core/src/lib/storage/storage.ts","./packages/core/src/lib/storage/storage.service.ts","./packages/core/src/lib/compression/compression.service.ts","./packages/core/src/lib/network/network.service.ts","./packages/core/src/lib/regex/regex.service.ts","./packages/common/src/lib/action/actionbar/actionbar.module.ts","./packages/common/src/lib/action/action.module.ts","./packages/common/src/lib/badge-icon/badge-icon.module.ts","./packages/common/src/lib/collapsible/collapsible.module.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.html","./packages/common/src/lib/confirm-dialog/confirm-dialog.service.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.module.ts","./packages/common/src/lib/context-menu/context-menu.module.ts","./packages/common/src/lib/custom-html/custom-html.module.ts","./packages/common/src/lib/dom/dom.service.ts","./packages/common/src/lib/dom/dom.module.ts","./packages/common/src/lib/drag-drop/drag-drop.module.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.module.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.service.ts","./packages/common/src/lib/dynamic-component/dynamic-component.module.ts","./packages/common/src/lib/flexible/flexible.module.ts","./packages/common/src/lib/form/form/form.module.ts","./packages/common/src/lib/form/form-field/form-field.module.ts","./packages/common/src/lib/form/form-group/form-group.module.ts","./packages/common/src/lib/form/shared/form.service.ts","./packages/common/src/lib/form/shared/form-field.service.ts","./packages/common/src/lib/form/form.module.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.module.ts","./packages/common/src/lib/stop-propagation/stop-propagation.module.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.module.ts","./packages/common/src/lib/image/image.module.ts","./packages/common/src/lib/entity/entity-table/entity-table.module.ts","./packages/common/src/lib/entity/entity.module.ts","./packages/common/src/lib/interactive-tour/interactive-tour.loader.ts","./packages/common/src/lib/interactive-tour/interactive-tour.service.ts","./packages/common/src/lib/interactive-tour/interactive-tour.module.ts","./packages/common/src/lib/keyvalue/keyvalue.module.ts","./packages/common/src/lib/clickout/clickout.module.ts","./packages/common/src/lib/list/list.module.ts","./packages/common/src/lib/panel/panel.module.ts","./packages/common/src/lib/spinner/spinner.module.ts","./packages/common/src/lib/table/table.module.ts","./packages/common/src/lib/entity/shared/entity.enums.ts","./packages/common/src/lib/entity/shared/entity.utils.ts","./packages/common/src/lib/entity/shared/state.ts","./packages/common/src/lib/entity/shared/view.ts","./packages/common/src/lib/entity/shared/store.ts","./packages/common/src/lib/entity/shared/store-strategy.ts","./packages/common/src/lib/entity/shared/watcher.ts","./packages/common/src/lib/entity/shared/strategies/strategy.ts","./packages/common/src/lib/entity/shared/strategies/filter-custom-function.ts","./packages/common/src/lib/entity/shared/strategies/filter-selection.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.component.html","./packages/common/src/lib/entity/entity-selector/entity-selector.component.ts","./packages/common/src/lib/stop-propagation/stop-propagation.directive.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.html","./packages/common/src/lib/image/image-error.directive.ts","./packages/common/src/lib/entity/entity-table/entity-table-row.directive.ts","./packages/common/src/lib/custom-html/custom-html.pipe.ts","./packages/common/src/lib/image/secure-image.pipe.ts","./packages/common/src/lib/entity/entity-table/entity-table.component.html","./packages/common/src/lib/entity/entity-table/entity-table.component.ts","./packages/common/src/lib/tool/shared/toolbox.ts","./packages/common/src/lib/tool/shared/tool.service.ts","./packages/common/src/lib/tool/toolbox/toolbox.module.ts","./packages/common/src/lib/tool/tool.module.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.module.ts","./packages/common/src/lib/widget/shared/widget.service.ts","./packages/common/src/lib/widget/widget.module.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.module.ts","./packages/common/src/lib/workspace/workspace.module.ts","./packages/common/src/lib/color-picker-form-field/color-picker-form-field.module.ts","./packages/common/src/lib/action/shared/action.enums.ts","./packages/common/src/lib/action/shared/store.ts","./packages/common/src/lib/action/actionbar/actionbar-item.component.html","./packages/common/src/lib/action/actionbar/actionbar-item.component.ts","./packages/common/src/lib/action/actionbar/actionbar.component.html","./packages/common/src/lib/action/actionbar/actionbar.component.ts","./packages/common/src/lib/context-menu/long-press.directive.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.html","./packages/common/src/lib/form/shared/form-field-component.ts","./packages/common/src/lib/form/shared/form.utils.ts","./packages/common/src/lib/form/form-field/form-field.component.html","./packages/common/src/lib/form/form-field/form-field.component.ts","./packages/common/src/lib/form/form-group/form-group.component.html","./packages/common/src/lib/form/form-group/form-group.component.ts","./packages/common/src/lib/form/form-field/form-field-text.component.html","./packages/common/src/lib/form/form-field/form-field-text.component.ts","./packages/common/src/lib/form/form-field/form-field-select.component.html","./packages/common/src/lib/form/form-field/form-field-select.component.ts","./packages/common/src/lib/form/form-field/form-field-textarea.component.html","./packages/common/src/lib/form/form-field/form-field-textarea.component.ts","./packages/common/src/lib/form/form/form.component.ts","./packages/common/src/lib/form/form/form.component.html","./packages/common/src/lib/flexible/flexible.component.ts","./packages/common/src/lib/flexible/flexible.component.html","./packages/common/src/lib/interactive-tour/interactive-tour.component.html","./packages/common/src/lib/interactive-tour/interactive-tour.component.ts","./packages/common/src/lib/spinner/spinner.component.ts","./packages/common/src/lib/spinner/spinner.component.html","./packages/common/src/lib/spinner/spinner-activity.directive.ts","./packages/common/src/lib/table/table-datasource.ts","./packages/common/src/lib/table/table-action-color.enum.ts","./packages/common/src/lib/table/table.component.html","./packages/common/src/lib/table/table.component.ts","./packages/common/src/lib/table/table-database.ts","./packages/common/src/lib/tool/shared/tool-component.ts","./packages/common/src/lib/tool/shared/toolbox.enums.ts","./packages/common/src/lib/tool/toolbox/toolbox.animation.ts","./packages/common/src/lib/tool/toolbox/toolbox.component.html","./packages/common/src/lib/tool/toolbox/toolbox.component.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.html","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.ts","./packages/common/src/lib/workspace/shared/store.ts","./packages/common/src/lib/workspace/shared/workspace.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.html","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.html","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.ts","./packages/common/src/lib/color-picker-form-field/color-picker-form-field.component.ts","./packages/common/src/lib/color-picker-form-field/color-picker-form-field.component.html","./demo/src/app/components/doc-viewer/doc-viewer.component.html","./demo/src/app/components/doc-viewer/doc-viewer.component.ts","./demo/src/app/core/home/home-routing.module.ts","./demo/src/app/core/home/home.component.ts","./demo/src/app/core/home/home.component.html","./demo/src/app/components/example/example.module.ts","./demo/src/app/components/doc-viewer/doc-viewer.module.ts","./demo/src/app/shared/shared.module.ts","./demo/src/app/core/home/home.module.ts","./demo/src/app/components/example/example-viewer/example-viewer.component.html","./demo/src/app/components/example/example-viewer/example-viewer.component.ts","./demo/src/app/core/activity/activity-routing.module.ts","./demo/src/app/core/activity/activity.component.ts","./demo/src/app/core/activity/activity.component.html","./demo/src/app/core/activity/activity.module.ts","./demo/src/environments/environment.prod.ts","./demo/src/app/core/config/config-routing.module.ts","./demo/src/app/core/config/config.component.ts","./demo/src/app/core/config/config.component.html","./demo/src/app/core/config/config.module.ts","./demo/src/app/core/language/language-routing.module.ts","./demo/src/app/core/language/language.component.ts","./demo/src/app/core/language/language.component.html","./demo/src/app/core/language/language.module.ts","./demo/src/app/core/media/media-routing.module.ts","./demo/src/app/core/media/media.component.ts","./demo/src/app/core/media/media.component.html","./demo/src/app/core/media/media.module.ts","./demo/src/app/core/message/message-routing.module.ts","./demo/src/app/core/message/message.component.ts","./demo/src/app/core/message/message.component.html","./demo/src/app/core/message/message.module.ts","./demo/src/app/core/request/request-routing.module.ts","./demo/src/app/core/request/request.component.ts","./demo/src/app/core/request/request.component.html","./demo/src/app/core/request/request.module.ts","./demo/src/app/common/action/action-routing.module.ts","./demo/src/app/common/action/action.component.ts","./demo/src/app/common/action/action.component.html","./demo/src/app/common/action/action.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.ts","./demo/src/app/common/dynamic-component/dynamic-component-routing.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.html","./demo/src/app/common/dynamic-component/dynamic-component.module.ts","./demo/src/app/common/entity-table/entity-table-routing.module.ts","./demo/src/app/common/entity-table/entity-table.component.ts","./demo/src/app/common/entity-table/entity-table.component.html","./demo/src/app/common/entity-table/entity-table.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.html","./demo/src/app/common/entity-selector/entity-selector-routing.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.ts","./demo/src/app/common/entity-selector/entity-selector.module.ts","./demo/src/app/common/form/form.component.html","./demo/src/app/common/form/form-routing.module.ts","./demo/src/app/common/form/form.component.ts","./demo/src/app/common/form/form.module.ts","./demo/src/app/common/table/table-routing.module.ts","./demo/src/app/common/table/table.component.ts","./demo/src/app/common/table/table.component.html","./demo/src/app/common/table/table.module.ts","./packages/common/src/lib/panel/panel.component.html","./packages/common/src/lib/panel/panel.component.ts","./demo/src/app/common/tool/tool.component.html","./demo/src/app/common/tool/tool.component.ts","./demo/src/app/common/tool/tool-routing.module.ts","./demo/src/app/common/tool/tool.module.ts","./demo/src/app/common/widget/widget.component.ts","./demo/src/app/common/widget/widget-routing.module.ts","./demo/src/app/common/widget/widget.component.html","./demo/src/app/common/widget/widget.module.ts","./packages/auth/src/lib/shared/token.service.ts","./packages/auth/src/lib/shared/auth.service.ts","./packages/auth/src/lib/auth-form/auth-google.component.ts","./packages/auth/src/lib/auth-form/auth-google.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.html","./packages/auth/src/lib/auth-form/auth-microsoft.component.ts","./packages/auth/src/lib/auth-form/auth-microsoft.component.html","./packages/auth/src/lib/shared/auth-msalServiceb2c.service..ts","./packages/auth/src/lib/shared/auth-msalBroadcastServiceb2c.service.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.html","./packages/auth/src/lib/auth-form/auth-form.component.html","./packages/auth/src/lib/auth-form/auth-form.component.ts","./packages/auth/src/lib/shared/auth.interceptor.ts","./packages/auth/src/lib/shared/auth-microsoft.provider.ts","./packages/auth/src/lib/shared/protected.directive.ts","./packages/auth/src/lib/shared/storage.service.ts","./packages/auth/src/lib/auth.module.ts","./demo/src/app/auth/auth-form/auth-form-routing.module.ts","./demo/src/app/auth/auth-form/auth-form.component.ts","./demo/src/app/auth/auth-form/auth-form.component.html","./demo/src/app/auth/auth-form/auth-form.module.ts","./packages/geo/src/lib/metadata/metadata.module.ts","./packages/geo/src/lib/utils/id-generator.ts","./packages/geo/src/lib/datasource/shared/datasources/datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","./packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","./packages/geo/src/lib/filter/shared/ogc-filter.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/data.service.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","./packages/geo/src/lib/query/shared/query.enums.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","./packages/geo/src/lib/datasource/utils/tilegrid.ts","./packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","./packages/geo/src/lib/map/shared/map.utils.ts","./packages/geo/src/lib/style/shared/datasource/esri-style-generator.ts","./packages/geo/src/lib/filter/shared/time-filter.enum.ts","./packages/geo/src/lib/map/shared/map.service.ts","./packages/geo/src/lib/datasource/shared/capabilities.service.ts","./packages/geo/src/lib/map/shared/projection.service.ts","./packages/geo/src/lib/datasource/shared/options/options.service.ts","./packages/geo/src/lib/datasource/shared/datasource.service.ts","./packages/geo/src/lib/layer/shared/layers/layer.ts","./packages/geo/src/lib/layer/shared/layers/layer.interface.ts","./packages/geo/src/lib/layer/utils/image-watcher.ts","./packages/geo/src/lib/layer/utils/tile-watcher.ts","./packages/geo/src/lib/layer/utils/vector-watcher.ts","./packages/geo/src/lib/layer/shared/layers/image-layer.ts","./packages/geo/src/lib/layer/shared/layers/tile-layer.ts","./packages/geo/src/lib/feature/shared/feature.enums.ts","./packages/geo/src/lib/feature/shared/feature.utils.ts","./packages/geo/src/lib/feature/shared/feature-store.utils.ts","./packages/geo/src/lib/feature/shared/store.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","./packages/geo/src/lib/feature/shared/strategies/geo-properties.ts","./packages/geo/src/lib/feature/shared/strategies/loading.ts","./packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","./packages/geo/src/lib/feature/shared/strategies/selection.ts","./packages/geo/src/lib/feature/shared/strategies/search.ts","./packages/geo/src/lib/feature/shared/strategies.utils.ts","./packages/geo/src/lib/style/shared/overlay/overlay-marker-style.utils.ts","./packages/geo/src/lib/style/style-service/style.service.ts","./packages/geo/src/lib/style/shared/overlay/overlay-style.utils.ts","./packages/geo/src/lib/overlay/shared/overlay.ts","./packages/geo/src/lib/overlay/shared/overlay.utils.ts","./packages/geo/src/lib/map/utils/layer-watcher.ts","./packages/geo/src/lib/map/shared/map.enums.ts","./packages/geo/src/lib/map/shared/controllers/controller.ts","./packages/geo/src/lib/map/shared/controllers/view.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.interface.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.ts","./packages/geo/src/lib/map/shared/linkedLayers.utils.ts","./packages/geo/src/lib/map/shared/map.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.html","./packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","./packages/geo/src/lib/style/shared/feature/feature-style.ts","./packages/geo/src/lib/map/shared/hover-feature.directive.ts","./packages/geo/src/lib/map/shared/projection.utils.ts","./packages/geo/src/lib/offline/geoDB/geoDB.enums.ts","./packages/geo/src/lib/layer/shared/layers/vector-layer.ts","./packages/geo/src/lib/style/shared/vector/conversion.utils.ts","./packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","./packages/geo/src/lib/layer/utils/layer.utils.ts","./packages/geo/src/lib/offline/geoDB/geoDB.service.ts","./packages/geo/src/lib/offline/shared/geo-network.service.ts","./packages/geo/src/lib/offline/layerDB/layerDB.service.ts","./packages/geo/src/lib/layer/shared/layer.service.ts","./packages/geo/src/lib/catalog/shared/catalog.enum.ts","./packages/geo/src/lib/query/shared/query.service.ts","./packages/geo/src/lib/query/shared/query.utils.ts","./packages/geo/src/lib/query/shared/query.directive.ts","./packages/geo/src/lib/search/shared/sources/source.ts","./packages/geo/src/lib/query/shared/query-search-source.ts","./packages/geo/src/lib/utils/googleLinks.ts","./packages/geo/src/lib/utils/osmLinks.ts","./packages/geo/src/lib/utils/propertyTypeDetector/propertyTypeDetector.service.ts","./packages/geo/src/lib/catalog/shared/catalog.abstract.ts","./packages/geo/src/lib/catalog/shared/catalogs.ts","./packages/geo/src/lib/catalog/shared/catalog.service.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","./packages/common/src/lib/badge-icon/badge-icon.directive.ts","./packages/geo/src/lib/metadata/shared/metadata.service.ts","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","./packages/common/src/lib/collapsible/collapse.directive.ts","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","./packages/common/src/lib/list/list-item.directive.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","./packages/geo/src/lib/layer/layer-item/layer-item.component.html","./packages/geo/src/lib/layer/layer-item/layer-item.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","./packages/geo/src/lib/layer/layer-list/layer-list.component.html","./packages/geo/src/lib/layer/layer-list/layer-list.component.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","./packages/common/src/lib/clickout/clickout.directive.ts","./packages/common/src/lib/list/list.component.ts","./packages/common/src/lib/list/list.component.html","./packages/geo/src/lib/layer/layer.module.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","./packages/geo/src/lib/catalog/catalog.module.ts","./packages/geo/src/lib/download/download.module.ts","./packages/geo/src/lib/draw/draw/draw.module.ts","./packages/geo/src/lib/feature/feature-details/feature-details.module.ts","./packages/geo/src/lib/feature/feature-form/feature-form.module.ts","./packages/geo/src/lib/feature/feature.module.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","./packages/geo/src/lib/geometry/geometry.module.ts","./packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","./packages/geo/src/lib/filter/shared/time-filter.service.ts","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","./packages/geo/src/lib/wkt/shared/wkt.service.ts","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","./packages/geo/src/lib/filter/shared/ogc-filter.service.ts","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","./packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","./packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","./packages/geo/src/lib/filter/shared/spatial-filter.service.ts","./packages/geo/src/lib/measure/shared/measure.enum.ts","./packages/geo/src/lib/measure/shared/measure.utils.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","./packages/common/src/lib/keyvalue/keyvalue.pipe.ts","./packages/geo/src/lib/feature/feature-details/feature-details.component.html","./packages/geo/src/lib/feature/feature-details/feature-details.component.ts","./packages/geo/src/lib/geometry/shared/geometry.utils.ts","./packages/geo/src/lib/geometry/shared/controls/draw.ts","./packages/geo/src/lib/geometry/shared/controls/modify.ts","./packages/geo/src/lib/layer/shared/layer.enums.ts","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","./packages/geo/src/lib/measure/measurer/measurer.component.html","./packages/geo/src/lib/measure/measurer/measurer.component.ts","./packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","./packages/geo/src/lib/filter/filter.module.ts","./packages/geo/src/lib/import-export/import-export.module.ts","./packages/geo/src/lib/map/map.module.ts","./packages/geo/src/lib/measure/measurer/measurer-item.component.html","./packages/geo/src/lib/measure/measurer/measurer-item.component.ts","./packages/geo/src/lib/measure/measurer/measurer.module.ts","./packages/geo/src/lib/measure/measure.module.ts","./packages/geo/src/lib/print/print.module.ts","./packages/geo/src/lib/query/shared/query-search-source.providers.ts","./packages/geo/src/lib/query/query.module.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.ts","./packages/geo/src/lib/directions/shared/directions-source.service.ts","./packages/geo/src/lib/directions/directions.module.ts","./packages/geo/src/lib/search/shared/search.utils.ts","./packages/geo/src/lib/search/shared/search-source.service.ts","./packages/geo/src/lib/search/shared/search.service.ts","./packages/geo/src/lib/search/shared/search-source-service.providers.ts","./packages/geo/src/lib/search/shared/sources/icherche.ts","./packages/geo/src/lib/search/shared/sources/icherche.providers.ts","./packages/geo/src/lib/search/shared/sources/coordinates.ts","./packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","./packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","./packages/geo/src/lib/search/shared/sources/ilayer.ts","./packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","./packages/geo/src/lib/search/search-selector/search-selector.module.ts","./packages/geo/src/lib/search/search-settings/search-settings.module.ts","./packages/geo/src/lib/search/search-bar/search-bar.module.ts","./packages/geo/src/lib/search/search-results/search-results.module.ts","./packages/geo/src/lib/search/search.module.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","./packages/geo/src/lib/workspace/widgets/widgets.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.module.ts","./packages/geo/src/lib/workspace/workspace.module.ts","./packages/geo/src/lib/style/style-list/style-list.service.ts","./packages/geo/src/lib/style/style-list/style-list.provider.ts","./packages/geo/src/lib/style/style-list/style-list.module.ts","./packages/geo/src/lib/style/shared/font.enum.ts","./packages/geo/src/lib/style/style-service/draw-style.service.ts","./packages/geo/src/lib/style/style.module.ts","./packages/geo/src/lib/feature/feature-details/feature-details.directive.ts","./packages/geo/src/lib/overlay/overlay.module.ts","./packages/geo/src/lib/download/shared/download.service.ts","./packages/geo/src/lib/download/download-button/download-button.component.html","./packages/geo/src/lib/download/download-button/download-button.component.ts","./packages/geo/src/lib/draw/shared/draw.enum.ts","./packages/geo/src/lib/draw/shared/draw-icon.service.ts","./packages/geo/src/lib/draw/shared/draw.utils.ts","./packages/geo/src/lib/draw/draw/draw-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.html","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.html","./packages/geo/src/lib/draw/draw/draw.component.html","./packages/geo/src/lib/draw/draw/draw.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list-binding.directive.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.html","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.ts","./packages/geo/src/lib/import-export/shared/import.errors.ts","./packages/geo/src/lib/import-export/shared/import.utils.ts","./packages/geo/src/lib/import-export/shared/import.service.ts","./packages/geo/src/lib/import-export/shared/export.type.ts","./packages/geo/src/lib/import-export/shared/export.errors.ts","./packages/geo/src/lib/import-export/shared/export.service.ts","./packages/common/src/lib/custom-html/custom-html.component.ts","./packages/common/src/lib/custom-html/custom-html.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.ts","./packages/geo/src/lib/import-export/shared/export.utils.ts","./packages/geo/src/lib/import-export/export-button/export-button.component.html","./packages/geo/src/lib/import-export/export-button/export-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.ts","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","./packages/geo/src/lib/overlay/shared/overlay.enum.ts","./packages/geo/src/lib/overlay/shared/overlay.service.ts","./packages/geo/src/lib/overlay/shared/overlay.directive.ts","./packages/geo/src/lib/print/shared/geopdf.ts","./packages/geo/src/lib/print/shared/print.type.ts","./packages/geo/src/lib/print/shared/print.service.ts","./packages/geo/src/lib/layer/utils/outputLegend.ts","./packages/geo/src/lib/print/print-form/print-form.component.html","./packages/geo/src/lib/print/print-form/print-form.component.ts","./packages/geo/src/lib/print/print/print.component.ts","./packages/geo/src/lib/print/print/print.component.html","./packages/geo/src/lib/directions/shared/directions.enum.ts","./packages/geo/src/lib/directions/shared/directions.utils.ts","./packages/geo/src/lib/directions/shared/directions.service.ts","./packages/geo/src/lib/directions/shared/store.ts","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","./packages/geo/src/lib/directions/directions-results/directions-results.component.html","./packages/geo/src/lib/directions/directions-results/directions-results.component.ts","./packages/geo/src/lib/directions/directions.component.ts","./packages/geo/src/lib/directions/directions.component.html","./packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","./packages/geo/src/lib/search/shared/search.enums.ts","./packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","./packages/geo/src/lib/search/shared/sources/cadastre.ts","./packages/geo/src/lib/search/shared/sources/cadastre.providers.ts","./packages/geo/src/lib/search/shared/sources/nominatim.ts","./packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","./packages/geo/src/lib/search/shared/sources/workspace.ts","./packages/geo/src/lib/search/shared/sources/workspace.providers.ts","./packages/geo/src/lib/search/search-selector/search-selector.component.html","./packages/geo/src/lib/search/search-selector/search-selector.component.ts","./packages/geo/src/lib/search/search-settings/search-settings.component.html","./packages/geo/src/lib/search/search-settings/search-settings.component.ts","./packages/geo/src/lib/search/search-bar/search-bar.component.html","./packages/geo/src/lib/search/search-bar/search-bar.component.ts","./packages/geo/src/lib/search/search-results/search-results-item.component.html","./packages/geo/src/lib/search/search-results/search-results-item.component.ts","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.html","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.ts","./packages/geo/src/lib/search/search-results/search-results-add-button.component.html","./packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","./packages/common/src/lib/collapsible/collapsible.component.ts","./packages/common/src/lib/collapsible/collapsible.component.html","./packages/geo/src/lib/search/search-results/search-results.component.html","./packages/geo/src/lib/search/search-results/search-results.component.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.ts","./packages/geo/src/lib/style/shared/vector/commonVectorStyle.ts","./packages/geo/src/lib/workspace/shared/workspace.utils.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","./packages/geo/src/lib/workspace/shared/edition-workspace.ts","./packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","./packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.html","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.html","./packages/geo/src/lib/map/info-section/info-section.component.html","./packages/geo/src/lib/map/info-section/info-section.component.ts","./demo/src/app/geo/simple-map/simple-map.component.html","./demo/src/app/geo/simple-map/simple-map-routing.module.ts","./demo/src/app/geo/simple-map/simple-map.component.ts","./demo/src/app/geo/simple-map/simple-map.module.ts","./demo/src/app/geo/layer/layer.component.html","./demo/src/app/geo/layer/layer-routing.module.ts","./demo/src/app/geo/layer/layer.component.ts","./demo/src/app/geo/layer/layer.module.ts","./demo/src/app/geo/legend/legend-routing.module.ts","./demo/src/app/geo/legend/legend.component.ts","./demo/src/app/geo/legend/legend.component.html","./demo/src/app/geo/legend/legend.module.ts","./demo/src/app/geo/overlay/overlay-routing.module.ts","./demo/src/app/geo/overlay/overlay.component.ts","./demo/src/app/geo/overlay/overlay.component.html","./demo/src/app/geo/overlay/overlay.module.ts","./demo/src/app/geo/geometry/geometry.component.html","./demo/src/app/geo/geometry/geometry-routing.module.ts","./demo/src/app/geo/geometry/geometry.component.ts","./demo/src/app/geo/geometry/geometry.module.ts","./demo/src/app/geo/feature/feature-routing.module.ts","./demo/src/app/geo/feature/feature.component.ts","./demo/src/app/geo/feature/feature.component.html","./demo/src/app/geo/feature/feature.module.ts","./demo/src/app/geo/hover/hover-routing.module.ts","./demo/src/app/geo/hover/hover.component.ts","./demo/src/app/geo/hover/hover.component.html","./demo/src/app/geo/hover/hover.module.ts","./demo/src/app/geo/measure/measure-routing.module.ts","./demo/src/app/geo/measure/measure.component.ts","./demo/src/app/geo/measure/measure.component.html","./demo/src/app/geo/measure/measure.module.ts","./demo/src/app/geo/draw/draw-routing.module.ts","./demo/src/app/geo/draw/draw.component.ts","./demo/src/app/geo/draw/draw.component.html","./demo/src/app/geo/draw/draw.module.ts","./demo/src/app/geo/query/query.component.html","./demo/src/app/geo/query/query-routing.module.ts","./demo/src/app/geo/query/query.component.ts","./demo/src/app/geo/query/query.module.ts","./demo/src/app/geo/catalog/catalog-routing.module.ts","./demo/src/app/geo/catalog/catalog.component.ts","./demo/src/app/geo/catalog/catalog.component.html","./demo/src/app/geo/catalog/catalog.module.ts","./packages/context/src/lib/context-import-export/context-import-export.module.ts","./packages/context/src/lib/context-manager/shared/context.enum.ts","./packages/context/src/lib/context-manager/shared/context.service.ts","./packages/context/src/lib/context-manager/shared/map-context.directive.ts","./packages/context/src/lib/context-import-export/shared/context-import.utils.ts","./packages/context/src/lib/context-manager/shared/layer-context.directive.ts","./packages/context/src/lib/context-map-button/poi-button/shared/poi.service.ts","./packages/context/src/lib/context-map-button/context-map-button.module.ts","./packages/context/src/lib/context-manager/context-manager.module.ts","./packages/context/src/lib/share-map/share-map.module.ts","./packages/context/src/lib/sidenav/sidenav.module.ts","./packages/context/src/lib/context.module.ts","./packages/context/src/lib/context-import-export/shared/context-export.errors.ts","./packages/context/src/lib/context-import-export/shared/context-export.service.ts","./packages/context/src/lib/context-import-export/shared/context-import.errors.ts","./packages/context/src/lib/context-import-export/shared/context-import.service.ts","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.html","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.ts","./packages/context/src/lib/context-import-export/shared/context-export.utils.ts","./packages/context/src/lib/context-manager/context-list/context-list.enum.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.ts","./packages/context/src/lib/context-manager/context-list/context-list.component.html","./packages/context/src/lib/context-manager/context-list/context-list.component.ts","./packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","./packages/context/src/lib/context-manager/context-form/context-form.component.html","./packages/context/src/lib/context-manager/context-form/context-form.component.ts","./packages/context/src/lib/context-manager/context-edit/context-edit.component.html","./packages/context/src/lib/context-manager/context-edit/context-edit.component.ts","./packages/context/src/lib/context-manager/context-edit/context-edit-binding.directive.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.html","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions-binding.directive.ts","./packages/context/src/lib/share-map/shared/share-map.service.ts","./packages/context/src/lib/share-map/share-map/share-map-url.component.html","./packages/context/src/lib/share-map/share-map/share-map-url.component.ts","./packages/context/src/lib/share-map/share-map/share-map-api.component.html","./packages/context/src/lib/share-map/share-map/share-map-api.component.ts","./packages/context/src/lib/share-map/share-map/share-map.component.html","./packages/context/src/lib/share-map/share-map/share-map.component.ts","./packages/integration/src/lib/search/search-bar/search-bar.module.ts","./packages/integration/src/lib/search/search-results-tool/search-results-tool.module.ts","./packages/integration/src/lib/search/search.module.ts","./packages/integration/src/lib/about/about-tool/about-tool.component.html","./packages/integration/src/lib/about/about-tool/about-tool.component.ts","./packages/integration/src/lib/import-export/import-export.state.ts","./packages/integration/src/lib/tool/tool.state.ts","./packages/integration/src/lib/context/context.state.ts","./packages/integration/src/lib/storage/storage.state.ts","./packages/integration/src/lib/workspace/shared/workspace.utils.ts","./packages/integration/src/lib/workspace/shared/feature-actions.service.ts","./packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","./packages/integration/src/lib/workspace/shared/edition-actions.service.ts","./packages/integration/src/lib/workspace/workspace.state.ts","./packages/integration/src/lib/map/map.state.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.html","./packages/integration/src/lib/map/map-proximity.state.ts","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.html","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.ts","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.html","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.ts","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.html","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.ts","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list-binding.directive.ts","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.html","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.ts","./packages/integration/src/lib/map/map-tool/map-tool.component.html","./packages/integration/src/lib/map/map-tool/map-tool.component.ts","./packages/integration/src/lib/map/layer-list-tool.state.ts","./packages/integration/src/lib/map/map-tools/map-tools.component.html","./packages/integration/src/lib/map/map-tools/map-tools.component.ts","./packages/integration/src/lib/search/search.state.ts","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.ts","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.html","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.ts","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.html","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.ts","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.html","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.ts","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.html","./packages/integration/src/lib/catalog/catalog.state.ts","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.html","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.html","./packages/integration/src/lib/directions/directions.state.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.html","./packages/integration/src/lib/draw/draw.state.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.html","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.html","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.html","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.html","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list-binding.directive.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.html","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.ts","./packages/integration/src/lib/measure/measure.state.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.html","./packages/integration/src/lib/print/print-tool/print-tool.component.ts","./packages/integration/src/lib/print/print-tool/print-tool.component.html","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.html","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.ts","./packages/common/src/lib/context-menu/context-menu.directive.ts","./demo/src/app/geo/search/search.component.html","./demo/src/app/geo/search/search-routing.module.ts","./demo/src/app/geo/search/search.component.ts","./demo/src/app/geo/search/search.module.ts","./demo/src/app/geo/print/print-routing.module.ts","./demo/src/app/geo/print/print.component.ts","./demo/src/app/geo/print/print.component.html","./demo/src/app/geo/print/print.module.ts","./demo/src/app/geo/import-export/import-export-routing.module.ts","./demo/src/app/geo/import-export/import-export.component.ts","./demo/src/app/geo/import-export/import-export.component.html","./demo/src/app/geo/import-export/import-export.module.ts","./demo/src/app/geo/directions/directions-routing.module.ts","./demo/src/app/geo/directions/directions.component.ts","./demo/src/app/geo/directions/directions.component.html","./demo/src/app/geo/directions/directions.module.ts","./demo/src/app/geo/time-filter/time-filter-routing.module.ts","./demo/src/app/geo/time-filter/time-filter.component.ts","./demo/src/app/geo/time-filter/time-filter.component.html","./demo/src/app/geo/time-filter/time-filter.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter-routing.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.html","./demo/src/app/geo/ogc-filter/ogc-filter.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.html","./demo/src/app/geo/spatial-filter/spatial-filter-routing.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.ts","./demo/src/app/geo/spatial-filter/spatial-filter.module.ts","./demo/src/app/geo/workspace/workspace.component.html","./demo/src/app/geo/workspace/workspace-routing.module.ts","./demo/src/app/geo/workspace/workspace.component.ts","./demo/src/app/geo/workspace/workspace.module.ts","./demo/src/app/context/context/context.component.html","./demo/src/app/context/context/context-routing.module.ts","./demo/src/app/context/context/context.component.ts","./demo/src/app/context/context/context.module.ts","./demo/src/app/app-routing.module.ts","./demo/src/app/app.component.ts","./demo/src/app/app.component.html","./demo/src/app/app.module.ts","./demo/src/main.ts","./node_modules/moment/locale/ sync ^\\.\\/.*$"],"sourcesContent":["/* eslint-disable */\r\n\r\nconst ALPHA =\r\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\r\n\r\nexport class Base64 {\r\n  private static PADCHAR: string = '=';\r\n  private static ALPHA: string = ALPHA;\r\n\r\n  private static getByte(s: string, i: number): number {\r\n    const x = s.charCodeAt(i);\r\n    return x;\r\n  }\r\n\r\n  private static getByte64(s: string, i: number): number {\r\n    const idx = this.ALPHA.indexOf(s.charAt(i));\r\n    return idx;\r\n  }\r\n\r\n  public static decode(s: string): string {\r\n    let pads = 0,\r\n      i,\r\n      b10,\r\n      imax = s.length,\r\n      x = [];\r\n\r\n    s = String(s);\r\n\r\n    if (imax === 0) {\r\n      return s;\r\n    }\r\n\r\n    if (s.charAt(imax - 1) === this.PADCHAR) {\r\n      pads = 1;\r\n      if (s.charAt(imax - 2) === this.PADCHAR) {\r\n        pads = 2;\r\n      }\r\n      imax -= 4;\r\n    }\r\n\r\n    for (i = 0; i < imax; i += 4) {\r\n      b10 =\r\n        (this.getByte64(s, i) << 18) |\r\n        (this.getByte64(s, i + 1) << 12) |\r\n        (this.getByte64(s, i + 2) << 6) |\r\n        this.getByte64(s, i + 3);\r\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\r\n    }\r\n\r\n    switch (pads) {\r\n      case 1:\r\n        b10 =\r\n          (this.getByte64(s, i) << 18) |\r\n          (this.getByte64(s, i + 1) << 12) |\r\n          (this.getByte64(s, i + 2) << 6);\r\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\r\n        break;\r\n      case 2:\r\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\r\n        x.push(String.fromCharCode(b10 >> 16));\r\n        break;\r\n    }\r\n\r\n    return x.join('');\r\n  }\r\n\r\n  public static encode(s: string): string {\r\n    s = String(s);\r\n\r\n    let i,\r\n      b10,\r\n      x = [],\r\n      imax = s.length - (s.length % 3);\r\n\r\n    if (s.length === 0) {\r\n      return s;\r\n    }\r\n\r\n    for (i = 0; i < imax; i += 3) {\r\n      b10 =\r\n        (this.getByte(s, i) << 16) |\r\n        (this.getByte(s, i + 1) << 8) |\r\n        this.getByte(s, i + 2);\r\n      x.push(this.ALPHA.charAt(b10 >> 18));\r\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\r\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\r\n      x.push(this.ALPHA.charAt(b10 & 63));\r\n    }\r\n\r\n    switch (s.length - imax) {\r\n      case 1:\r\n        b10 = this.getByte(s, i) << 16;\r\n        x.push(\r\n          this.ALPHA.charAt(b10 >> 18) +\r\n            this.ALPHA.charAt((b10 >> 12) & 63) +\r\n            this.PADCHAR +\r\n            this.PADCHAR\r\n        );\r\n        break;\r\n      case 2:\r\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\r\n        x.push(\r\n          this.ALPHA.charAt(b10 >> 18) +\r\n            this.ALPHA.charAt((b10 >> 12) & 63) +\r\n            this.ALPHA.charAt((b10 >> 6) & 63) +\r\n            this.PADCHAR\r\n        );\r\n        break;\r\n    }\r\n\r\n    return x.join('');\r\n  }\r\n}\r\n","import { HttpParams } from '@angular/common/http';\r\n\r\nexport function customCacheHasher(parameters: unknown[]): unknown[] {\r\n  return parameters.map((param) => {\r\n    if (param instanceof HttpParams) {\r\n      return param.toString();\r\n    }\r\n    return param !== undefined ? JSON.parse(JSON.stringify(param)) : param;\r\n  });\r\n}\r\n","import * as Bowser from 'bowser';\n\nexport interface UserAgent extends Bowser.Parser.Parser {\n  compareVersion: (version: string) => boolean;\n}\n\nexport const userAgent = Bowser.getParser(\n  window.navigator.userAgent\n) as UserAgent;\n","import { userAgent } from './user-agent';\n\nexport class Clipboard {\n  static copy(element: HTMLTextAreaElement | string): boolean {\n    let successful = false;\n    if (typeof element === 'string') {\n      const textArea = Clipboard.createTextArea(element);\n      Clipboard.selectText(textArea);\n      successful = Clipboard.copyTextToClipboard();\n      Clipboard.destroyTextArea(textArea);\n    } else {\n      Clipboard.selectText(element);\n      successful = Clipboard.copyTextToClipboard();\n    }\n    return successful;\n  }\n\n  private static createTextArea(text: string): HTMLTextAreaElement {\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    return textArea;\n  }\n\n  private static destroyTextArea(textArea) {\n    document.body.removeChild(textArea);\n  }\n\n  private static selectText(textArea) {\n    if (userAgent.getOSName() === 'iOS') {\n      const oldContentEditable = textArea.contentEditable;\n      const oldReadOnly = textArea.readOnly;\n      const range = document.createRange();\n      const selection = window.getSelection();\n\n      textArea.contenteditable = true;\n      textArea.readonly = false;\n      range.selectNodeContents(textArea);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      textArea.setSelectionRange(0, 999999);\n      textArea.contentEditable = oldContentEditable;\n      textArea.readOnly = oldReadOnly;\n    } else {\n      textArea.select();\n    }\n  }\n\n  private static copyTextToClipboard(): boolean {\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\n      return document.execCommand('copy');\n    }\n    return false;\n  }\n}\n","export class StringUtils {\r\n  static diff(s1: string, s2: string, p = 4): string {\r\n    if (!s1 && !s2) {\r\n      return '';\r\n    }\r\n    if (!s1) {\r\n      return '<span class=\"inserted\">' + s2 + '</span>';\r\n    }\r\n    if (!s2) {\r\n      return '<span class=\"deleted\">' + s1 + '</span>';\r\n    }\r\n    s1 = s1.toString();\r\n    s2 = s2.toString();\r\n    const changeData = StringUtils.getChanges(s1, s2, '', p);\r\n    const nextS = s2.slice(\r\n      changeData.mtc.length + changeData.ins.length + changeData.sbs.length\r\n    ); // remaining part of \"s\"\r\n    const nextThis = s1.slice(\r\n      changeData.mtc.length + changeData.del.length + changeData.sbs.length\r\n    ); // remaining part of \"this\"\r\n    let result = ''; // the glorious result\r\n    if (changeData.del.length > 0) {\r\n      changeData.del = '<span class=\"deleted\">' + changeData.del + '</span>';\r\n    }\r\n    if (changeData.ins.length > 0) {\r\n      changeData.ins = '<span class=\"inserted\">' + changeData.ins + '</span>';\r\n    }\r\n    result = changeData.mtc + changeData.del + changeData.ins + changeData.sbs;\r\n    result +=\r\n      nextThis !== '' || nextS !== ''\r\n        ? StringUtils.diff(nextThis, nextS, p)\r\n        : '';\r\n    return result;\r\n  }\r\n\r\n  private static getMatchingSubstring(s, l, m) {\r\n    // returns the first matching substring in-between the two strings\r\n    let i = 0;\r\n    let match = false;\r\n    const slen = s.length;\r\n    const o = { fis: slen, mtc: m, sbs: '' }; // temporary object used to construct the cd (change data) object\r\n\r\n    while (i < slen) {\r\n      l[i] === s[i]\r\n        ? match\r\n          ? (o.sbs += s[i]) // o.sbs holds the matching substring itsef\r\n          : ((match = true), (o.fis = i), (o.sbs = s[i]))\r\n        : match\r\n        ? (i = slen) // stop after the first found substring\r\n        : (i = i);\r\n      ++i;\r\n    }\r\n    return o;\r\n  }\r\n\r\n  private static getChanges(s1, s2, m, p) {\r\n    const isThisLonger = s1.length >= s1.length ? true : false;\r\n    let [longer, shorter] = isThisLonger ? [s1, s2] : [s2, s1]; // assignment of longer and shorter by es6 destructuring\r\n    let bi = 0; // base index designating the index of first mismacthing character in both strings\r\n\r\n    while (shorter[bi] === longer[bi] && bi < shorter.length) {\r\n      ++bi;\r\n    } // make bi the index of first mismatching character\r\n    longer = longer.split('').slice(bi); // as the longer string will be rotated it is converted into array\r\n    shorter = shorter.slice(bi); // shorter and longer now starts from the first mismatching character\r\n\r\n    const len = longer.length; // length of the longer string\r\n    let cd: any = {\r\n      fis: shorter.length, // the index of matching string in the shorter string\r\n      fil: len, // the index of matching string in the longer string\r\n      sbs: '', // the matching substring itself\r\n      mtc: m + s2.slice(0, bi)\r\n    }; // if exists mtc holds the matching string at the front\r\n    let sub: any = { sbs: '' }; // returned substring per 1 character rotation of the longer string\r\n\r\n    if (shorter !== '') {\r\n      for (let rc = 0; rc < len && sub.sbs.length < p; rc++) {\r\n        // rc -> rotate count, p -> precision factor\r\n        sub = StringUtils.getMatchingSubstring(\r\n          shorter,\r\n          StringUtils.rotateArray(longer, rc),\r\n          cd.mtc\r\n        ); // rotate longer string 1 char and get substring\r\n        sub.fil =\r\n          rc < len - sub.fis\r\n            ? sub.fis + rc // mismatch is longer than the mismatch in short\r\n            : sub.fis - len + rc; // mismatch is shorter than the mismatch in short\r\n        if (sub.sbs.length > cd.sbs.length) {\r\n          cd = sub; // only keep the one with the longest substring.\r\n        }\r\n      }\r\n    }\r\n    // insert the mismatching delete subsrt and insert substr to the cd object and attach the previous substring\r\n    [cd.del, cd.ins] = isThisLonger\r\n      ? [longer.slice(0, cd.fil).join(''), shorter.slice(0, cd.fis)]\r\n      : [shorter.slice(0, cd.fis), longer.slice(0, cd.fil).join('')];\r\n    return cd.del.indexOf(' ') === -1 ||\r\n      cd.ins.indexOf(' ') === -1 ||\r\n      cd.del === '' ||\r\n      cd.ins === '' ||\r\n      cd.sbs === ''\r\n      ? cd\r\n      : StringUtils.getChanges(cd.del, cd.ins, cd.mtc, p);\r\n  }\r\n\r\n  private static rotateArray(array, n) {\r\n    const len = array.length;\r\n    const res = new Array(array.length);\r\n    if (n % len === 0) {\r\n      return array.slice();\r\n    } else {\r\n      for (let i = 0; i < len; i++) {\r\n        res[i] = array[(i + (len + (n % len))) % len];\r\n      }\r\n    }\r\n    return res;\r\n  }\r\n\r\n  static isValidNumber(value: string): boolean {\r\n    return !isNaN(Number(value));\r\n  }\r\n\r\n  static isOctalNumber(value: string): boolean {\r\n    return (\r\n      StringUtils.isValidNumber(value) &&\r\n      value.startsWith('0') &&\r\n      value.length > 1\r\n    );\r\n  }\r\n}\r\n","export enum ChangeType {\n  ADDED = 'added',\n  DELETED = 'deleted',\n  MODIFIED = 'modified'\n}\n\nexport interface Change {\n  type: ChangeType;\n  keysChanged?: {\n    key: string;\n    newValue: any;\n    oldValue: any;\n  }[];\n}\n\nexport interface GroupingChanges {\n  added: ChangeItem[];\n  deleted: ChangeItem[];\n  modified: ChangeItem[];\n}\n\nexport interface ChangeItem {\n  change: Change;\n  value: any;\n  oldValue?: any;\n  newValue?: any;\n}\n","import { StringUtils } from './string-utils';\r\nimport { GroupingChanges, ChangeType } from './change.interface';\r\n\r\nexport class ChangeUtils {\r\n  static findChanges(\r\n    obj1: any[],\r\n    obj2: any[],\r\n    ignoreKeys: string[] = []\r\n  ): GroupingChanges {\r\n    const items: GroupingChanges = {\r\n      added: [],\r\n      deleted: [],\r\n      modified: []\r\n    };\r\n\r\n    if (!obj1 || !obj2) {\r\n      return items;\r\n    }\r\n\r\n    const obj1Clone: any = [...obj1];\r\n    const obj2Clone: any = [...obj2];\r\n\r\n    for (const fromItem of obj1Clone) {\r\n      const index = obj2Clone.findIndex((s) => s.id === fromItem.id);\r\n\r\n      if (index === -1) {\r\n        items.deleted.push({\r\n          change: { type: ChangeType.DELETED },\r\n          value: fromItem\r\n        });\r\n        continue;\r\n      }\r\n\r\n      const toItem = obj2Clone.splice(index, 1)[0];\r\n      const fromItemClone = JSON.parse(JSON.stringify(fromItem));\r\n      const toItemClone = JSON.parse(JSON.stringify(toItem));\r\n\r\n      const keysChanged = ChangeUtils.compareObject(\r\n        fromItemClone,\r\n        toItemClone,\r\n        undefined,\r\n        ignoreKeys\r\n      );\r\n\r\n      if (keysChanged.length) {\r\n        items.modified.push({\r\n          change: {\r\n            type: ChangeType.MODIFIED,\r\n            keysChanged\r\n          },\r\n          value: fromItemClone,\r\n          oldValue: fromItem,\r\n          newValue: toItem\r\n        });\r\n      }\r\n    }\r\n\r\n    items.added = obj2Clone.map((itemAdded) => {\r\n      return {\r\n        change: { type: ChangeType.ADDED },\r\n        value: itemAdded\r\n      };\r\n    });\r\n\r\n    return items;\r\n  }\r\n\r\n  private static compareObject(fromItem, toItem, baseKey?, ignoreKeys = []) {\r\n    const fromItemClone = JSON.parse(JSON.stringify(fromItem));\r\n    const toItemClone = JSON.parse(JSON.stringify(toItem));\r\n\r\n    const keys: any = new Set([\r\n      ...Object.keys(fromItem),\r\n      ...Object.keys(toItem)\r\n    ]);\r\n    let keysChanged = [];\r\n    keys.forEach((key) => {\r\n      const keyString = baseKey ? `${baseKey}.${key}` : key;\r\n      if (ignoreKeys.indexOf(keyString) !== -1) {\r\n        return;\r\n      }\r\n\r\n      if (Array.isArray(fromItem[key])) {\r\n        fromItem[key] = fromItem[key].join(',<br>');\r\n      }\r\n      if (Array.isArray(toItem[key])) {\r\n        toItem[key] = toItem[key].join(',<br>');\r\n      }\r\n\r\n      if (\r\n        typeof fromItem[key] === 'object' &&\r\n        typeof toItem[key] === 'object' &&\r\n        fromItem[key] !== null &&\r\n        toItem[key] !== null\r\n      ) {\r\n        keysChanged = keysChanged.concat(\r\n          this.compareObject(fromItem[key], toItem[key], keyString)\r\n        );\r\n      } else {\r\n        if (fromItem[key] !== toItem[key]) {\r\n          keysChanged.push({\r\n            key: keyString,\r\n            oldValue: fromItemClone[key],\r\n            newValue: toItemClone[key]\r\n          });\r\n          fromItem[key] = StringUtils.diff(fromItem[key], toItem[key]);\r\n        }\r\n      }\r\n    });\r\n\r\n    return keysChanged;\r\n  }\r\n}\r\n","export class DomUtils {\r\n  static create<K extends keyof HTMLElementTagNameMap>(\r\n    doc: Document,\r\n    tagName: K,\r\n    options?: Partial<HTMLElementTagNameMap[K]>\r\n  ): HTMLElementTagNameMap[K] {\r\n    const el = doc.createElement(tagName);\r\n\r\n    for (const key in options) {\r\n      el[key] = options[key];\r\n    }\r\n\r\n    return el;\r\n  }\r\n\r\n  static remove(node: HTMLElement | SVGElement): void {\r\n    if (!node.parentNode) {\r\n      return;\r\n    }\r\n    node.parentNode.removeChild(node);\r\n  }\r\n}\r\n","/**\r\n * Trigger download of a file\r\n *\r\n * @param content File content\r\n * @param mimeType File mime type\r\n * @param fileName File name\r\n */\r\nexport function downloadContent(\r\n  content: string,\r\n  mimeType: string,\r\n  fileName: string\r\n) {\r\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\r\n  downloadFromUri(uri, fileName);\r\n}\r\n\r\n/**\r\n * Trigger download of a file\r\n *\r\n * @param content File content\r\n * @param mimeType File mime type\r\n * @param fileName File name\r\n */\r\nexport function downloadFromUri(uri: string, fileName: string) {\r\n  const element = document.createElement('a');\r\n  element.setAttribute('href', uri);\r\n  element.setAttribute('download', fileName);\r\n  element.style.display = 'none';\r\n  document.body.appendChild(element);\r\n\r\n  element.click();\r\n\r\n  document.body.removeChild(element);\r\n}\r\n","export class ObjectUtils {\r\n  static resolve(obj: object, key: string): any {\r\n    const keysArray = key.replace(/\\[/g, '.').replace(/\\]/g, '').split('.');\r\n    let current = obj;\r\n    while (keysArray.length) {\r\n      if (typeof current !== 'object') {\r\n        return undefined;\r\n      }\r\n      current = current[keysArray.shift()];\r\n    }\r\n\r\n    return current;\r\n  }\r\n\r\n  static isObject(item: object) {\r\n    return (\r\n      item &&\r\n      typeof item === 'object' &&\r\n      !Array.isArray(item) &&\r\n      item !== null &&\r\n      !(item instanceof Date)\r\n    );\r\n  }\r\n\r\n  static mergeDeep(\r\n    target: object,\r\n    source: object,\r\n    ignoreUndefined = false\r\n  ): any {\r\n    const output = Object.assign({}, target);\r\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\r\n      Object.keys(source)\r\n        .filter((key) => !ignoreUndefined || source[key] !== undefined)\r\n        .forEach((key) => {\r\n          if (ObjectUtils.isObject(source[key])) {\r\n            if (!(key in target)) {\r\n              Object.assign(output, { [key]: source[key] });\r\n            } else {\r\n              output[key] = ObjectUtils.mergeDeep(\r\n                target[key],\r\n                source[key],\r\n                ignoreUndefined\r\n              );\r\n            }\r\n          } else {\r\n            Object.assign(output, { [key]: source[key] });\r\n          }\r\n        });\r\n    }\r\n    return output;\r\n  }\r\n\r\n  static copyDeep(src): any {\r\n    const target = Array.isArray(src) ? [] : {};\r\n    for (const prop in src) {\r\n      if (src.hasOwnProperty(prop)) {\r\n        const value = src[prop];\r\n        if (value && typeof value === 'object') {\r\n          target[prop] = this.copyDeep(value);\r\n        } else {\r\n          target[prop] = value;\r\n        }\r\n      }\r\n    }\r\n    return target;\r\n  }\r\n\r\n  static removeDuplicateCaseInsensitive(obj: object) {\r\n    const summaryCapitalizeObject = {};\r\n    const capitalizeObject = {};\r\n    const upperCaseCount = [];\r\n\r\n    for (const property in obj) {\r\n      if (obj.hasOwnProperty(property)) {\r\n        const upperCaseProperty = property.toUpperCase();\r\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\r\n          summaryCapitalizeObject[upperCaseProperty] = [\r\n            { [property]: obj[property] }\r\n          ];\r\n        } else {\r\n          summaryCapitalizeObject[upperCaseProperty].push({\r\n            [property]: obj[property]\r\n          });\r\n        }\r\n        // counting the number of uppercase lettersMna\r\n        upperCaseCount.push({\r\n          key: property,\r\n          count: property.replace(/[^A-Z]/g, '').length\r\n        });\r\n      }\r\n    }\r\n    for (const capitalizedProperty in summaryCapitalizeObject) {\r\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\r\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\r\n          const capitalizedPropertyObject =\r\n            summaryCapitalizeObject[capitalizedProperty];\r\n          if (capitalizedPropertyObject.length === 1) {\r\n            // for single params (no duplicates)\r\n            const singlePossibility = capitalizedPropertyObject[0];\r\n            capitalizeObject[capitalizedProperty] =\r\n              singlePossibility[Object.keys(singlePossibility)[0]];\r\n          } else if (capitalizedPropertyObject.length > 1) {\r\n            // defining the closest to lowercase property\r\n            const paramClosestToLowercase = upperCaseCount\r\n              .filter(\r\n                (f) => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\r\n              )\r\n              .reduce((prev, current) => {\r\n                return prev.y < current.y ? prev : current;\r\n              });\r\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\r\n              obj[paramClosestToLowercase.key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    for (const property in obj) {\r\n      if (obj.hasOwnProperty(property)) {\r\n        delete obj[property];\r\n      }\r\n    }\r\n\r\n    for (const property in capitalizeObject) {\r\n      if (capitalizeObject.hasOwnProperty(property)) {\r\n        obj[property] = capitalizeObject[property];\r\n      }\r\n    }\r\n  }\r\n\r\n  static removeUndefined(obj: object): any {\r\n    const output = {};\r\n    if (ObjectUtils.isObject(obj)) {\r\n      Object.keys(obj)\r\n        .filter((key) => obj[key] !== undefined)\r\n        .forEach((key) => {\r\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\r\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\r\n          } else {\r\n            output[key] = obj[key];\r\n          }\r\n        });\r\n\r\n      return output;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n      return obj.map((o) => ObjectUtils.removeUndefined(o));\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  static removeNull(obj: object): any {\r\n    const output = {};\r\n    if (ObjectUtils.isObject(obj)) {\r\n      Object.keys(obj)\r\n        .filter((key) => obj[key] !== null)\r\n        .forEach((key) => {\r\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\r\n            output[key] = ObjectUtils.removeNull(obj[key]);\r\n          } else {\r\n            output[key] = obj[key];\r\n          }\r\n        });\r\n\r\n      return output;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n      return obj.map((o) => ObjectUtils.removeNull(o));\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\r\n    if (direction === 'desc') {\r\n      b = [a, (a = b)][0];\r\n    }\r\n\r\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\r\n    // nullsFirst = true : always first\r\n    // nullsFirst = false : always end\r\n    if (\r\n      a === null ||\r\n      a === '' ||\r\n      a === undefined ||\r\n      b === null ||\r\n      b === '' ||\r\n      b === undefined\r\n    ) {\r\n      const nullScore =\r\n        a === b\r\n          ? 0\r\n          : a === undefined\r\n          ? 3\r\n          : b === undefined\r\n          ? -3\r\n          : a === null\r\n          ? 2\r\n          : b === null\r\n          ? -2\r\n          : a === ''\r\n          ? 1\r\n          : -1;\r\n      if (direction === 'desc') {\r\n        return nullsFirst !== false ? nullScore : nullScore * -1;\r\n      }\r\n      return nullsFirst === true ? nullScore * -1 : nullScore;\r\n    }\r\n\r\n    const ax = [];\r\n    const bx = [];\r\n    a = '' + a;\r\n    b = '' + b;\r\n\r\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\r\n      ax.push([$1 || Infinity, $2 || '']);\r\n    });\r\n\r\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\r\n      bx.push([$1 || Infinity, $2 || '']);\r\n    });\r\n\r\n    while (ax.length && bx.length) {\r\n      const an = ax.shift();\r\n      const bn = bx.shift();\r\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\r\n      if (nn) {\r\n        return nn;\r\n      }\r\n    }\r\n\r\n    return ax.length - bx.length;\r\n  }\r\n\r\n  /**\r\n   * Return true if two object are equivalent.\r\n   * Objects are considered equivalent if they have the same properties and\r\n   * if all of their properties (first-level only) share the same value.\r\n   * @param obj1 First object\r\n   * @param obj2 Second object\r\n   * @returns Whether two objects arer equivalent\r\n   */\r\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\r\n    if (obj1 === obj2) {\r\n      return true;\r\n    }\r\n\r\n    const obj1Props = Object.getOwnPropertyNames(obj1);\r\n    const obj2Props = Object.getOwnPropertyNames(obj2);\r\n    if (obj1Props.length !== obj2Props.length) {\r\n      return false;\r\n    }\r\n\r\n    for (const prop of obj1Props) {\r\n      if (obj1[prop] !== obj2[prop]) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Return a new object with an array of keys removed\r\n   * @param obj Source object\r\n   * @param keys Keys to remove\r\n   * @returns A new object\r\n   */\r\n  static removeKeys(obj: object, keys: string[]): object {\r\n    const newObj = Object.keys(obj)\r\n      .filter((key) => keys.indexOf(key) < 0)\r\n      .reduce((_obj, key) => {\r\n        _obj[key] = obj[key];\r\n        return _obj;\r\n      }, {});\r\n\r\n    return newObj;\r\n  }\r\n\r\n  static isEmpty(obj: object): boolean {\r\n    return Object.keys(obj).length === 0;\r\n  }\r\n}\r\n","export class NumberUtils {\r\n  static roundToNDecimal(num: number, decimal: number = 3): number {\r\n    const roundFactor = Math.pow(10, decimal);\r\n    return Math.round(num * roundFactor) / roundFactor;\r\n  }\r\n}\r\n","/** Utility function to create a K:V from a list of strings */\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\n  return o.reduce((res, key) => {\n    res[key] = key;\n    return res;\n  }, Object.create(null));\n}\n","export function S4() {\n  // eslint-disable-next-line no-bitwise\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n\nexport function uuid() {\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\n  return id.toLowerCase();\n}\n","import { Subject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nexport enum SubjectStatus {\n  Error = 0,\n  Done = 1,\n  Working = 2,\n  Waiting = 3\n}\n\nexport abstract class Watcher {\n  public status$ = new Subject<SubjectStatus>();\n  protected status$$: Subscription;\n\n  get status(): SubjectStatus {\n    return this._status;\n  }\n  set status(value: SubjectStatus) {\n    this._status = value;\n    this.status$.next(value);\n  }\n  private _status: SubjectStatus;\n\n  protected abstract watch();\n\n  protected abstract unwatch();\n\n  subscribe(callback: Function, scope?: any) {\n    this.watch();\n\n    this.status$$ = this.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status: SubjectStatus) => {\n        this.handleStatusChange(status);\n        callback.call(scope, this);\n      });\n  }\n\n  unsubscribe() {\n    this.unwatch();\n    if (this.status$$ !== undefined) {\n      this.status$$.unsubscribe();\n      this.status$$ = undefined;\n    }\n    this.status = SubjectStatus.Waiting;\n  }\n\n  protected handleStatusChange(status: SubjectStatus) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { uuid } from '@igo2/utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActivityService {\n  public counter$ = new BehaviorSubject<number>(0);\n\n  private ids: string[] = [];\n\n  constructor() {}\n\n  register(): string {\n    const id = uuid();\n    this.ids.push(id);\n    this.counter$.next(this.ids.length);\n\n    return id;\n  }\n\n  unregister(id: string) {\n    const index = this.ids.indexOf(id);\n    if (index === -1) {\n      return;\n    }\n    this.ids.splice(index, 1);\n\n    this.counter$.next(this.ids.length);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { finalize } from 'rxjs/operators';\n\nimport { ActivityService } from './activity.service';\n\n@Injectable()\nexport class ActivityInterceptor implements HttpInterceptor {\n  constructor(private activityService: ActivityService) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const activity = req.headers.get('activityInterceptor');\n    if (activity) {\n      const actReq = req.clone({\n        headers: req.headers.delete('activityInterceptor')\n      });\n      if (activity === 'false') {\n        return next.handle(actReq);\n      }\n    }\n\n    const id = this.activityService.register();\n\n    return next.handle(req).pipe(\n      finalize(() => {\n        this.activityService.unregister(id);\n      })\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ActivityInterceptor } from './activity.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoActivityModule {\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\n    return {\n      ngModule: IgoActivityModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ActivityInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n}\n","export interface Version {\r\n  lib: string;\r\n  releaseDate: number;\r\n}\r\n\r\nexport const version: Version = {\r\n  lib: '16.0.0-rc.0',\r\n  releaseDate: 1695139270215\r\n};\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpBackend, HttpClient } from '@angular/common/http';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { ConfigOptions } from './config.interface';\r\nimport { version } from './version';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ConfigService {\r\n  private config: object = {};\r\n  private httpClient: HttpClient;\r\n\r\n  constructor(handler: HttpBackend) {\r\n    this.httpClient = new HttpClient(handler);\r\n  }\r\n\r\n  /**\r\n   * Use to get the data found in config file\r\n   */\r\n  public getConfig(key: string): any {\r\n    return ObjectUtils.resolve(this.config, key);\r\n  }\r\n\r\n  /**\r\n   * This method loads \"[path]\" to get all config's variables\r\n   */\r\n  public load(options: ConfigOptions) {\r\n    const baseConfig = options.default || {};\r\n    if (!options.path) {\r\n      this.config = baseConfig;\r\n      return true;\r\n    }\r\n\r\n    return new Promise((resolve, _reject) => {\r\n      this.httpClient\r\n        .get(options.path)\r\n        .pipe(\r\n          catchError((error: any): any => {\r\n            console.log(`Configuration file ${options.path} could not be read`);\r\n            resolve(true);\r\n            return throwError(error.error || 'Server error');\r\n          })\r\n        )\r\n        .subscribe((configResponse: object) => {\r\n          this.config = ObjectUtils.mergeDeep(\r\n            ObjectUtils.mergeDeep({ version }, baseConfig),\r\n            configResponse\r\n          );\r\n          resolve(true);\r\n        });\r\n    });\r\n  }\r\n}\r\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { ConfigService } from './config.service';\nimport { ConfigOptions } from './config.interface';\n\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\n\nexport function provideConfigOptions(options: ConfigOptions) {\n  return {\n    provide: CONFIG_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function configFactory(\n  configService: ConfigService,\n  options: ConfigOptions\n) {\n  return () => configService.load(options);\n}\n\nexport function provideConfigLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: configFactory,\n    multi: true,\n    deps: [ConfigService, CONFIG_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideConfigOptions, provideConfigLoader } from './config.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoConfigModule {\n  static forRoot(): ModuleWithProviders<IgoConfigModule> {\n    return {\n      ngModule: IgoConfigModule,\n      providers: [provideConfigOptions({}), provideConfigLoader()]\n    };\n  }\n}\n","import { HttpBackend, HttpClient } from '@angular/common/http';\r\n\r\nimport { forkJoin, map } from 'rxjs';\r\n\r\nimport { TranslateLoader } from '@ngx-translate/core';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { ConfigService } from '../../config/config.service';\r\n\r\nexport class LanguageLoader implements TranslateLoader {\r\n  private httpClient: HttpClient;\r\n\r\n  constructor(\r\n    handler: HttpBackend,\r\n    private prefix?: string | string[],\r\n    private suffix: string = '.json',\r\n    private config?: ConfigService\r\n  ) {\r\n    this.httpClient = new HttpClient(handler);\r\n  }\r\n\r\n  public getTranslation(lang: string): any {\r\n    const igoLocale$ = this.httpClient.get(`locale/libs_locale/${lang}.json`);\r\n\r\n    if (this.config && !this.prefix) {\r\n      const prefix = this.config.getConfig('language.prefix');\r\n      this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\r\n    }\r\n\r\n    if (!this.prefix || this.prefix.length === 0) {\r\n      return igoLocale$;\r\n    }\r\n\r\n    const appLocale$ = (this.prefix as string[]).map((prefix) =>\r\n      this.httpClient.get(`${prefix}${lang}${this.suffix}`)\r\n    );\r\n\r\n    const locale$ = forkJoin([igoLocale$, ...appLocale$]);\r\n\r\n    return locale$.pipe(\r\n      map((translations) => {\r\n        return translations.reduce(\r\n          (acc, current) => ObjectUtils.mergeDeep(acc, current),\r\n          {}\r\n        );\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { HttpBackend } from '@angular/common/http';\r\nimport { TranslateLoader } from '@ngx-translate/core';\r\n\r\nimport { ConfigService } from '../../config/config.service';\r\nimport { LanguageLoader } from './language.loader';\r\n\r\nexport function defaultLanguageLoader(\r\n  http: HttpBackend,\r\n  config?: ConfigService\r\n) {\r\n  return new LanguageLoader(http, undefined, undefined, config);\r\n}\r\n\r\nexport function provideLanguageLoader(loader?) {\r\n  return {\r\n    provide: TranslateLoader,\r\n    useFactory: loader || defaultLanguageLoader,\r\n    deps: [HttpBackend]\r\n  };\r\n}\r\n\r\nexport function provideDefaultLanguageLoader(loader?) {\r\n  return {\r\n    provide: TranslateLoader,\r\n    useFactory: loader || defaultLanguageLoader,\r\n    deps: [HttpBackend, ConfigService]\r\n  };\r\n}\r\n","import {\n  MissingTranslationHandler,\n  MissingTranslationHandlerParams\n} from '@ngx-translate/core';\n\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\n  handle(params: MissingTranslationHandlerParams) {\n    if (!params.translateService.langs.length) {\n      const error =\n        'Translations are not yet loaded. \\\n         Check that the LanguageService is injected.';\n      throw new Error(error);\n    }\n\n    if (params.key.substr(0, 4) === 'igo.') {\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\n    } else {\n      return params.key;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport {\n  TranslateModule,\n  MissingTranslationHandler\n} from '@ngx-translate/core';\n\nimport { provideDefaultLanguageLoader } from './shared/language.provider';\nimport { IgoMissingTranslationHandler } from './shared/missing-translation.guard';\n\n@NgModule({\n  imports: [\n    TranslateModule.forRoot({\n      missingTranslationHandler: {\n        provide: MissingTranslationHandler,\n        useClass: IgoMissingTranslationHandler\n      }\n    })\n  ],\n  declarations: [],\n  exports: [TranslateModule]\n})\nexport class IgoLanguageModule {\n  static forRoot(): ModuleWithProviders<IgoLanguageModule> {\n    return {\n      ngModule: IgoLanguageModule,\n      providers: [provideDefaultLanguageLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { GlobalConfig, ToastrModule } from 'ngx-toastr';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    ToastrModule.forRoot({\r\n      positionClass: 'toast-bottom-right',\r\n      timeOut: 10000,\r\n      extendedTimeOut: 10000,\r\n      titleClass: 'mat-subtitle-2',\r\n      messageClass: 'toast-message',\r\n      closeButton: true,\r\n      progressBar: true,\r\n      enableHtml: true,\r\n      tapToDismiss: true,\r\n      maxOpened: 4,\r\n      preventDuplicates: true,\r\n      resetTimeoutOnDuplicate: true,\r\n      countDuplicates: false,\r\n      includeTitleDuplicates: true\r\n    } as GlobalConfig)\r\n  ],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoMessageModule {\r\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\r\n    return {\r\n      ngModule: IgoMessageModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","export enum MessageType {\n  ERROR = 'error',\n  ALERT = 'warning', // todo delete (transition to ngx-toastr)\n  WARNING = 'warning',\n  INFO = 'info',\n  SUCCESS = 'success',\n  SHOW = 'show'\n}\n","import { Injectable } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { BehaviorSubject, combineLatest } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LanguageService {\r\n  private language: string;\r\n  readonly language$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  constructor(public translate: TranslateService) {\r\n    this.language = this.translate.getBrowserLang();\r\n    const lang = this.getLanguage();\r\n    this.translate.setDefaultLang(lang);\r\n    this.language$.next(lang);\r\n  }\r\n\r\n  public getLanguage(): string {\r\n    return this.language.match(/en|fr/) ? this.language : 'en';\r\n  }\r\n\r\n  public setLanguage(language: string) {\r\n    this.language = language.match(/en|fr/) ? language : 'en';\r\n    combineLatest([\r\n      this.translate.use(this.language),\r\n      this.translate.reloadLang(this.language)\r\n    ]).subscribe(() => {\r\n      this.language$.next(this.language);\r\n    });\r\n  }\r\n}\r\n","import { Injectable, Inject, Injector } from '@angular/core';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { BehaviorSubject, forkJoin } from 'rxjs';\r\n\r\nimport { ConfigService } from '../../config/config.service';\r\n\r\nimport { Message, MessageOptions } from './message.interface';\r\nimport { ActiveToast, IndividualConfig, ToastrService } from 'ngx-toastr';\r\nimport { MessageType } from './message.enum';\r\nimport { LanguageService } from '../../language/shared/language.service';\r\nimport { debounceTime, first } from 'rxjs/operators';\r\n\r\ninterface ActiveMessageTranslation {\r\n  id: number;\r\n  titleKey: string;\r\n  textKey: string;\r\n  textInterpolateParams?: Object;\r\n  titleInterpolateParams?: Object;\r\n}\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MessageService {\r\n  public messages$ = new BehaviorSubject<Message[]>([]);\r\n  private options?: MessageOptions;\r\n  private activeMessageTranslations: ActiveMessageTranslation[] = [];\r\n\r\n  constructor(\r\n    @Inject(Injector) private injector: Injector,\r\n    private configService: ConfigService,\r\n    private languageService: LanguageService\r\n  ) {\r\n    this.options = this.configService.getConfig('message');\r\n    this.languageService.language$.pipe(debounceTime(500)).subscribe((r) => {\r\n      if (this.toastr.toasts.length === 0) {\r\n        this.activeMessageTranslations = [];\r\n      }\r\n      this.toastr.toasts.map((toast) => {\r\n        const activeMessageTranslation = this.activeMessageTranslations.find(\r\n          (amt) => amt.id === toast.toastId\r\n        );\r\n        if (activeMessageTranslation) {\r\n          const translatedTextInterpolateParams = {\r\n            ...activeMessageTranslation.textInterpolateParams\r\n          };\r\n          const translatedTitleInterpolateParams = {\r\n            ...activeMessageTranslation.titleInterpolateParams\r\n          };\r\n\r\n          if (activeMessageTranslation.textInterpolateParams) {\r\n            Object.keys(activeMessageTranslation.textInterpolateParams).map(\r\n              (k) => {\r\n                if (k) {\r\n                  translatedTextInterpolateParams[k] =\r\n                    this.languageService.translate.instant(\r\n                      activeMessageTranslation.textInterpolateParams[k]\r\n                    );\r\n                }\r\n              }\r\n            );\r\n          }\r\n          if (activeMessageTranslation.titleInterpolateParams) {\r\n            Object.keys(activeMessageTranslation.titleInterpolateParams).map(\r\n              (k) => {\r\n                if (k) {\r\n                  translatedTitleInterpolateParams[k] =\r\n                    this.languageService.translate.instant(\r\n                      activeMessageTranslation.titleInterpolateParams[k]\r\n                    );\r\n                }\r\n              }\r\n            );\r\n          }\r\n\r\n          forkJoin([\r\n            this.languageService.translate.get(\r\n              activeMessageTranslation.textKey,\r\n              translatedTextInterpolateParams\r\n            ),\r\n            this.languageService.translate.get(\r\n              activeMessageTranslation.titleKey,\r\n              translatedTitleInterpolateParams\r\n            )\r\n          ])\r\n            .pipe(first())\r\n            .subscribe((res: [string, string]) => {\r\n              toast.toastRef.componentInstance.message = res[0];\r\n              toast.toastRef.componentInstance.title = res[1];\r\n            });\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private get toastr(): ToastrService {\r\n    return this.injector.get(ToastrService);\r\n  }\r\n\r\n  showError(httpError: HttpErrorResponse) {\r\n    httpError.error.caught = true;\r\n    return this.error(httpError.error.message, httpError.error.title);\r\n  }\r\n\r\n  message(message: Message) {\r\n    const messageType = message.type;\r\n    this.toastr.toastrConfig.iconClasses[messageType] = `toast-${messageType}`;\r\n\r\n    this.messages$.next(this.messages$.value.concat([message]));\r\n\r\n    message.options = message.options || ({} as MessageOptions);\r\n    const currentDate = new Date();\r\n\r\n    message.options.from = message.options.from\r\n      ? message.options.from\r\n      : new Date('1 jan 1900');\r\n    message.options.to = message.options.to\r\n      ? message.options.to\r\n      : new Date('1 jan 3000');\r\n    if (typeof message.options.from === 'string') {\r\n      message.options.from = new Date(\r\n        Date.parse(message.options.from.replace(/-/g, ' '))\r\n      );\r\n    }\r\n    if (typeof message.options.to === 'string') {\r\n      message.options.to = new Date(\r\n        Date.parse(message.options.to.replace(/-/g, ' '))\r\n      );\r\n    }\r\n    if (\r\n      currentDate > message.options.from &&\r\n      currentDate < message.options.to\r\n    ) {\r\n      if (message.showIcon === false) {\r\n        this.toastr.toastrConfig.iconClasses[\r\n          messageType\r\n        ] = `toast-${messageType} toast-no-icon`;\r\n      }\r\n      message = this.handleTemplate(message);\r\n\r\n      if (message.text) {\r\n        let messageShown: ActiveToast<any>;\r\n        switch (message.type) {\r\n          case MessageType.SUCCESS:\r\n            messageShown = this.success(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          case MessageType.ERROR:\r\n            messageShown = this.error(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          case MessageType.INFO:\r\n            messageShown = this.info(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          case MessageType.SHOW:\r\n            messageShown = this.show(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          case MessageType.ALERT:\r\n          case MessageType.WARNING:\r\n            messageShown = this.alert(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          default:\r\n            messageShown = this.info(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n        }\r\n        message.options.id = messageShown.toastId;\r\n      }\r\n    }\r\n  }\r\n\r\n  success(\r\n    text: string,\r\n    title: string = 'igo.core.message.success',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'success',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  error(\r\n    text: string,\r\n    title: string = 'igo.core.message.error',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'error',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  info(\r\n    text: string,\r\n    title: string = 'igo.core.message.info',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'info',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  alert(\r\n    text: string,\r\n    title: string = 'igo.core.message.alert',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'alert',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  show(\r\n    text: string,\r\n    title: string = 'igo.core.message.info',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'show',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  private handleNgxToastr(\r\n    type: 'alert' | 'info' | 'error' | 'success' | 'show',\r\n    text: string,\r\n    title: string,\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    const translatedTextInterpolateParams = { ...textInterpolateParams };\r\n    const translatedTitlenterpolateParams = { ...titleInterpolateParams };\r\n\r\n    if (textInterpolateParams) {\r\n      Object.keys(textInterpolateParams).map((k) => {\r\n        if (textInterpolateParams[k]) {\r\n          translatedTextInterpolateParams[k] =\r\n            this.languageService.translate.instant(textInterpolateParams[k]);\r\n        }\r\n      });\r\n    }\r\n    if (titleInterpolateParams) {\r\n      Object.keys(titleInterpolateParams).map((k) => {\r\n        if (k) {\r\n          translatedTitlenterpolateParams[k] =\r\n            this.languageService.translate.instant(titleInterpolateParams[k]);\r\n        }\r\n      });\r\n    }\r\n\r\n    const message = this.languageService.translate.instant(\r\n      text,\r\n      translatedTextInterpolateParams\r\n    );\r\n    const translatedTitle = this.languageService.translate.instant(\r\n      title,\r\n      translatedTitlenterpolateParams\r\n    );\r\n\r\n    let activeToast;\r\n    switch (type) {\r\n      case 'success':\r\n        activeToast = this.toastr.success(message, translatedTitle, options);\r\n        break;\r\n      case 'error':\r\n        activeToast = this.toastr.error(message, translatedTitle, options);\r\n        break;\r\n      case 'show':\r\n      case 'info':\r\n        activeToast = this.toastr.info(message, translatedTitle, options);\r\n        break;\r\n      case 'alert':\r\n        activeToast = this.toastr.warning(message, translatedTitle, options);\r\n        break;\r\n    }\r\n    this.activeMessageTranslations.push({\r\n      id: activeToast.toastId,\r\n      titleKey: title,\r\n      textKey: text,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    });\r\n    return activeToast;\r\n  }\r\n\r\n  remove(id?: number) {\r\n    this.toastr.remove(id);\r\n  }\r\n\r\n  removeAllAreNotError() {\r\n    for (const mess of this.messages$.value) {\r\n      if (mess.type !== MessageType.ERROR) {\r\n        this.remove(mess.options.id);\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleTemplate(message: Message): Message {\r\n    if (!this.options?.template || message.html) {\r\n      return message;\r\n    }\r\n\r\n    let html = this.options?.template;\r\n    html = html.replace('${text}', message.text);\r\n    html = html.replace('${title}', message.title);\r\n\r\n    message.html = undefined;\r\n    message.text = html;\r\n    message.title = undefined;\r\n    return message;\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport {\r\n  HttpInterceptor,\r\n  HttpHandler,\r\n  HttpRequest,\r\n  HttpEvent,\r\n  HttpErrorResponse\r\n} from '@angular/common/http';\r\n\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError, finalize } from 'rxjs/operators';\r\n\r\nimport { MessageService } from '../message/shared/message.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ErrorInterceptor implements HttpInterceptor {\r\n  constructor(private injector: Injector) {}\r\n\r\n  intercept(\r\n    originalReq: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    const interceptError = originalReq.headers.get('interceptError');\r\n    const req = originalReq.clone({\r\n      headers: originalReq.headers.delete('interceptError')\r\n    });\r\n    if (interceptError === 'false') {\r\n      return next.handle(req);\r\n    }\r\n    const errorContainer = { httpError: undefined };\r\n    return next.handle(req).pipe(\r\n      catchError((error) => this.handleError(error, errorContainer)),\r\n      finalize(() => {\r\n        this.handleCaughtError(errorContainer);\r\n        this.handleUncaughtError(errorContainer);\r\n      })\r\n    );\r\n  }\r\n\r\n  private handleError(\r\n    httpError: HttpErrorResponse,\r\n    errorContainer: { httpError: HttpErrorResponse }\r\n  ) {\r\n    if (httpError instanceof HttpErrorResponse) {\r\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\r\n      errorObj.message = httpError.error?.message || httpError.statusText;\r\n      errorObj.caught = false;\r\n\r\n      httpError = new HttpErrorResponse({\r\n        error: errorObj,\r\n        headers: httpError.headers,\r\n        status: httpError.status,\r\n        statusText: httpError.statusText,\r\n        url: httpError.url\r\n      });\r\n    }\r\n\r\n    errorContainer.httpError = httpError;\r\n    return throwError(httpError);\r\n  }\r\n\r\n  private handleCaughtError(errorContainer: { httpError: HttpErrorResponse }) {\r\n    const httpError = errorContainer.httpError;\r\n    if (httpError && httpError.error.toDisplay) {\r\n      httpError.error.caught = true;\r\n      const messageService = this.injector.get(MessageService);\r\n      messageService.error(httpError.error.message, httpError.error.title);\r\n    }\r\n  }\r\n\r\n  private handleUncaughtError(errorContainer: {\r\n    httpError: HttpErrorResponse;\r\n  }) {\r\n    const httpError = errorContainer.httpError;\r\n    if (httpError && !httpError.error.caught) {\r\n      const messageService = this.injector.get(MessageService);\r\n      httpError.error.caught = true;\r\n      messageService.error(\r\n        'igo.core.errors.uncaught.message',\r\n        'igo.core.errors.uncaught.title'\r\n      );\r\n    }\r\n  }\r\n}\r\n","import {\n  NgModule,\n  ModuleWithProviders,\n  Optional,\n  SkipSelf\n} from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ErrorInterceptor } from './error.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoErrorModule {\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\n    return {\n      ngModule: IgoErrorModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ErrorInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\n    if (parentModule) {\n      throw new Error(\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\n      );\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\n\r\nimport { IgoActivityModule } from './activity/activity.module';\r\nimport { IgoConfigModule } from './config/config.module';\r\nimport { IgoLanguageModule } from './language/language.module';\r\nimport { IgoMessageModule } from './message/message.module';\r\nimport { IgoErrorModule } from './request/error.module';\r\nimport { DBConfig, NgxIndexedDBModule } from 'ngx-indexed-db';\r\n\r\nconst dbConfig: DBConfig = {\r\n  name: 'igo2DB',\r\n  version: 2,\r\n  objectStoresMeta: [\r\n    {\r\n      store: 'geoData',\r\n      storeConfig: { keyPath: 'url', autoIncrement: false },\r\n      storeSchema: [\r\n        { name: 'regionID', keypath: 'regionID', options: { unique: false } }\r\n      ]\r\n    },\r\n    {\r\n      store: 'layerData',\r\n      storeConfig: { keyPath: 'layerId', autoIncrement: false },\r\n      storeSchema: [\r\n        {\r\n          name: 'layerOptions',\r\n          keypath: 'layerOptions',\r\n          options: { unique: false }\r\n        },\r\n        {\r\n          name: 'sourceOptions',\r\n          keypath: 'sourceOptions',\r\n          options: { unique: false }\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n};\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    HttpClientModule,\r\n    IgoActivityModule.forRoot(),\r\n    IgoConfigModule.forRoot(),\r\n    IgoErrorModule.forRoot(),\r\n    IgoLanguageModule.forRoot(),\r\n    IgoMessageModule.forRoot(),\r\n    NgxIndexedDBModule.forRoot(dbConfig)\r\n  ],\r\n  declarations: [],\r\n  exports: [\r\n    IgoActivityModule,\r\n    IgoConfigModule,\r\n    IgoErrorModule,\r\n    IgoLanguageModule,\r\n    IgoMessageModule\r\n  ]\r\n})\r\nexport class IgoCoreModule {\r\n  static forRoot(): ModuleWithProviders<IgoCoreModule> {\r\n    return {\r\n      ngModule: IgoCoreModule,\r\n      providers: []\r\n    };\r\n  }\r\n\r\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\r\n    matIconRegistry.addSvgIconSet(\r\n      domSanitizer.bypassSecurityTrustResourceUrl(\r\n        './assets/igo2/core/icons/mdi.svg'\r\n      )\r\n    );\r\n  }\r\n}\r\n","import { Injectable, Inject, InjectionToken, Optional } from '@angular/core';\r\nimport { ActivatedRoute, Params, Router } from '@angular/router';\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { RouteServiceOptions } from './route.interface';\r\n\r\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\r\n  'routeServiceOptions'\r\n);\r\n\r\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\r\n  return {\r\n    provide: ROUTE_SERVICE_OPTIONS,\r\n    useValue: options\r\n  };\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RouteService {\r\n  public options: RouteServiceOptions;\r\n\r\n  constructor(\r\n    private router: Router,\r\n    public route: ActivatedRoute,\r\n    @Inject(ROUTE_SERVICE_OPTIONS)\r\n    @Optional()\r\n    options: RouteServiceOptions\r\n  ) {\r\n    const defaultOptions = {\r\n      centerKey: 'center',\r\n      zoomKey: 'zoom',\r\n      projectionKey: 'projection',\r\n      contextKey: 'context',\r\n      searchKey: 'search',\r\n      visibleOnLayersKey: 'visiblelayers',\r\n      visibleOffLayersKey: 'invisiblelayers',\r\n      directionsCoordKey: 'routing',\r\n      directionsOptionsKey: 'routingOptions',\r\n      toolKey: 'tool',\r\n      wmsUrlKey: 'wmsUrl',\r\n      wmsLayersKey: 'wmsLayers',\r\n      wmtsUrlKey: 'wmtsUrl',\r\n      wmtsLayersKey: 'wmtsLayers',\r\n      arcgisUrlKey: 'arcgisUrl',\r\n      arcgisLayersKey: 'arcgisLayers',\r\n      iarcgisUrlKey: 'iarcgisUrl',\r\n      iarcgisLayersKey: 'iarcgisLayers',\r\n      tarcgisUrlKey: 'tarcgisUrl',\r\n      tarcgisLayersKey: 'tarcgisLayers',\r\n      vectorKey: 'vector'\r\n    };\r\n    this.options = Object.assign({}, defaultOptions, options);\r\n  }\r\n\r\n  get queryParams(): Observable<Params> {\r\n    let url = decodeURIComponent(location.search);\r\n    if (url.includes('er=')) {\r\n      url = url.replace('er', '&center');\r\n      const queryParams: any = url\r\n        .slice(1)\r\n        .split('&')\r\n        .map((p) => p.split('='))\r\n        .reduce((obj, pair) => {\r\n          const [key, value] = pair.map(decodeURIComponent);\r\n          obj[key] = value;\r\n          return obj;\r\n        }, {});\r\n      this.router.navigate([], { queryParams });\r\n    }\r\n    return this.route.queryParams;\r\n  }\r\n}\r\n","export enum Media {\n  Mobile = 'mobile',\n  Tablet = 'tablet',\n  Desktop = 'desktop'\n}\n\nexport enum MediaOrientation {\n  Portrait = 'portrait',\n  Landscape = 'landscape'\n}\n","import { Injectable } from '@angular/core';\r\nimport { Breakpoints, BreakpointObserver } from '@angular/cdk/layout';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Media, MediaOrientation } from './media.enum';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MediaService {\r\n  public media$ = new BehaviorSubject<Media>(undefined);\r\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\r\n\r\n  constructor(breakpointObserver: BreakpointObserver) {\r\n    breakpointObserver\r\n      .observe([Breakpoints.HandsetLandscape])\r\n      .subscribe((res) => {\r\n        if (res.matches) {\r\n          this.media$.next(Media.Mobile);\r\n          this.orientation$.next(MediaOrientation.Landscape);\r\n        }\r\n      });\r\n\r\n    breakpointObserver\r\n      .observe([Breakpoints.HandsetPortrait])\r\n      .subscribe((res) => {\r\n        if (res.matches) {\r\n          this.media$.next(Media.Mobile);\r\n          this.orientation$.next(MediaOrientation.Portrait);\r\n        }\r\n      });\r\n\r\n    breakpointObserver\r\n      .observe([Breakpoints.TabletLandscape])\r\n      .subscribe((res) => {\r\n        if (res.matches) {\r\n          this.media$.next(Media.Tablet);\r\n          this.orientation$.next(MediaOrientation.Landscape);\r\n        }\r\n      });\r\n\r\n    breakpointObserver\r\n      .observe([Breakpoints.TabletPortrait])\r\n      .subscribe((res) => {\r\n        if (res.matches) {\r\n          this.media$.next(Media.Tablet);\r\n          this.orientation$.next(MediaOrientation.Portrait);\r\n        }\r\n      });\r\n\r\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe((res) => {\r\n      if (res.matches) {\r\n        this.media$.next(Media.Desktop);\r\n        this.orientation$.next(MediaOrientation.Landscape);\r\n      }\r\n    });\r\n\r\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe((res) => {\r\n      if (res.matches) {\r\n        this.media$.next(Media.Desktop);\r\n        this.orientation$.next(MediaOrientation.Portrait);\r\n      }\r\n    });\r\n  }\r\n\r\n  getMedia(): Media {\r\n    return this.media$.value;\r\n  }\r\n\r\n  getOrientation(): MediaOrientation {\r\n    return this.orientation$.value;\r\n  }\r\n\r\n  isTouchScreen(): boolean {\r\n    return 'ontouchstart' in document.documentElement ? true : false;\r\n  }\r\n\r\n  isMobile(): boolean {\r\n    const media = this.getMedia();\r\n    return media === 'mobile';\r\n  }\r\n\r\n  isDesktop(): boolean {\r\n    const media = this.getMedia();\r\n    return media === 'desktop';\r\n  }\r\n}\r\n","export enum StorageScope {\n  SESSION = 'Session',\n  LOCAL = 'Local'\n}\n\nexport interface StorageOptions {\n  key: string;\n}\n\nexport interface StorageServiceEvent {\n  key?: string;\n  scope: StorageScope;\n  event: StorageServiceEventEnum;\n  previousValue?: any;\n  currentValue?: any;\n}\n\nexport enum StorageServiceEventEnum {\n  ADDED = 'Added',\n  MODIFIED = 'Modified',\n  REMOVED = 'Removed',\n  CLEARED = 'Cleared'\n}\n","import { ConfigService } from '../config/config.service';\r\nimport {\r\n  StorageScope,\r\n  StorageOptions,\r\n  StorageServiceEvent,\r\n  StorageServiceEventEnum\r\n} from './storage.interface';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nexport abstract class BaseStorage<T extends StorageOptions = StorageOptions> {\r\n  protected options?: T;\r\n\r\n  public storageChange$: BehaviorSubject<StorageServiceEvent> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  constructor(config: ConfigService) {\r\n    this.options = config.getConfig('storage') || { key: 'igo' };\r\n  }\r\n\r\n  /**\r\n   * Use to get the data found in storage file\r\n   */\r\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\r\n    let value: any;\r\n\r\n    if (!scope || scope === StorageScope.SESSION) {\r\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\r\n    }\r\n\r\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\r\n      value = localStorage.getItem(`${this.options.key}.${key}`);\r\n    }\r\n\r\n    if (value) {\r\n      try {\r\n        value = JSON.parse(value);\r\n      } catch {\r\n        value = value;\r\n      }\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  set(\r\n    key: string,\r\n    value: string | object | boolean | number,\r\n    scope: StorageScope = StorageScope.LOCAL\r\n  ) {\r\n    const previousValue = this.get(key, scope);\r\n    if (scope === StorageScope.SESSION) {\r\n      sessionStorage.setItem(\r\n        `${this.options.key}.${key}`,\r\n        JSON.stringify(value)\r\n      );\r\n    } else {\r\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\r\n    }\r\n    const currentValue = this.get(key, scope);\r\n\r\n    if (currentValue !== previousValue) {\r\n      this.storageChange$.next({\r\n        key,\r\n        scope,\r\n        event:\r\n          previousValue !== undefined\r\n            ? StorageServiceEventEnum.MODIFIED\r\n            : StorageServiceEventEnum.ADDED,\r\n        previousValue,\r\n        currentValue\r\n      });\r\n    }\r\n  }\r\n\r\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\r\n    const previousValue = this.get(key, scope);\r\n    if (scope === StorageScope.SESSION) {\r\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\r\n    } else {\r\n      localStorage.removeItem(`${this.options.key}.${key}`);\r\n    }\r\n    this.storageChange$.next({\r\n      key,\r\n      scope,\r\n      event: StorageServiceEventEnum.REMOVED,\r\n      previousValue\r\n    });\r\n  }\r\n\r\n  clear(scope: StorageScope = StorageScope.LOCAL) {\r\n    if (scope === StorageScope.SESSION) {\r\n      sessionStorage.clear();\r\n    } else {\r\n      localStorage.clear();\r\n    }\r\n    this.storageChange$.next({ scope, event: StorageServiceEventEnum.CLEARED });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '../config/config.service';\r\nimport { StorageOptions } from './storage.interface';\r\nimport { BaseStorage } from './storage';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StorageService extends BaseStorage<StorageOptions> {\r\n  constructor(private config: ConfigService) {\r\n    super(config);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, Observer } from 'rxjs';\r\nimport { CompressedData } from './compressedData.interface';\r\n\r\nfunction getNumber(v: number, endposition: number, length: number) {\r\n  /* tslint:disable:no-bitwise*/\r\n  const mask = (1 << length) - 1;\r\n  return (v >> endposition) & mask;\r\n  /* tslint:enable:no-bitwise*/\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CompressionService {\r\n  private base64Index = new Map<string, number>();\r\n  private indexBase64 = new Map<number, string>();\r\n\r\n  constructor() {\r\n    this.generateBase64Index();\r\n  }\r\n\r\n  private generateBase64Index() {\r\n    // https://fr.wikipedia.org/wiki/Base64\r\n    // A-Z => [0, 25]\r\n    for (let i = 0; i < 26; i++) {\r\n      this.base64Index.set(String.fromCharCode('A'.charCodeAt(0) + i), i);\r\n      this.indexBase64.set(i, String.fromCharCode('A'.charCodeAt(0) + i));\r\n    }\r\n    // a-z => [26, 51]\r\n    for (let i = 0; i < 26; i++) {\r\n      this.base64Index.set(String.fromCharCode('a'.charCodeAt(0) + i), i + 26);\r\n      this.indexBase64.set(i + 26, String.fromCharCode('a'.charCodeAt(0) + i));\r\n    }\r\n    // 0-9 => [52, 61]\r\n    for (let i = 0; i < 10; i++) {\r\n      this.base64Index.set(String.fromCharCode('0'.charCodeAt(0) + i), i + 52);\r\n      this.indexBase64.set(i + 52, String.fromCharCode('0'.charCodeAt(0) + i));\r\n    }\r\n    // + / => [62, 63]\r\n    this.base64Index.set('+', 62);\r\n    this.base64Index.set('/', 63);\r\n    this.indexBase64.set(62, '+');\r\n    this.indexBase64.set(63, '/');\r\n  }\r\n\r\n  compressBlob(blob: Blob): Observable<CompressedData> {\r\n    if (!blob) {\r\n      return;\r\n    }\r\n\r\n    const observable = new Observable((observer: Observer<CompressedData>) => {\r\n      const reader = new FileReader();\r\n      reader.readAsDataURL(blob);\r\n      reader.onload = () => {\r\n        const base64 = reader.result.valueOf() as string;\r\n        const text64 = base64.substr(base64.indexOf(',') + 1);\r\n        const compressed = this.compressStringBase64(text64);\r\n        const compressedData: CompressedData = {\r\n          length: text64.length,\r\n          type: blob.type,\r\n          object: compressed\r\n        };\r\n        observer.next(compressedData);\r\n      };\r\n    });\r\n    return observable;\r\n  }\r\n\r\n  decompressBlob(compressedData: CompressedData): Blob {\r\n    /* tslint:disable:no-bitwise*/\r\n    const object = compressedData.object;\r\n    const length = compressedData.length;\r\n    const decompressed: string = this.decompressStringBase64(object, length);\r\n    const byteCharacters = atob(decompressed);\r\n    const byteNumbers = new Array(byteCharacters.length);\r\n    for (let i = 0; i < byteCharacters.length; i++) {\r\n      byteNumbers[i] = byteCharacters.charCodeAt(i);\r\n    }\r\n    const byteArray = new Uint8Array(byteNumbers);\r\n    const blob = new Blob([byteArray], { type: compressedData.type });\r\n    /* tslint:enable:no-bitwise*/\r\n    return blob;\r\n  }\r\n\r\n  private compressStringBase64(s: string): string {\r\n    /* tslint:disable:no-bitwise*/\r\n    let out = '';\r\n    let bits = 16;\r\n    let chr = 0;\r\n    let rem = 0;\r\n    for (const c of s) {\r\n      const value = this.base64Index.get(c);\r\n      if (bits > 6) {\r\n        bits -= 6;\r\n        chr += value << bits;\r\n      } else {\r\n        rem = 6 - bits;\r\n        chr += value >> rem;\r\n        out += String.fromCharCode(chr);\r\n        chr = value << (16 - rem);\r\n        bits = 16 - rem;\r\n      }\r\n    }\r\n    if (s.length % 8 !== 0) {\r\n      out += String.fromCharCode(chr);\r\n    }\r\n    /* tslint:enable:no-bitwise*/\r\n    return String.fromCharCode(9731) + out;\r\n  }\r\n\r\n  private decompressStringBase64(c: string, length: number): string {\r\n    /* tslint:disable:no-bitwise*/\r\n    if (!c) {\r\n      return;\r\n    }\r\n\r\n    if (c.charCodeAt(0) !== 9731) {\r\n      return c;\r\n    }\r\n\r\n    let chr = 0;\r\n    let rem = 0;\r\n    let bits = 16;\r\n    let out = '';\r\n    let j = 1;\r\n    let value = c.charCodeAt(j);\r\n    for (let i = 0; i < length; i++) {\r\n      if (bits > 6) {\r\n        bits -= 6;\r\n        chr = getNumber(value, bits, 6);\r\n        out += this.indexBase64.get(chr);\r\n      } else {\r\n        rem = 6 - bits;\r\n        chr = getNumber(value, 0, bits) << rem;\r\n        value = c.charCodeAt(++j);\r\n        chr += getNumber(value, 16 - rem, rem);\r\n        out += this.indexBase64.get(chr);\r\n        bits = 16 - rem;\r\n      }\r\n    }\r\n    return out;\r\n    /* tslint:enable:no-bitwise*/\r\n  }\r\n}\r\n","import { Injectable, EventEmitter, OnDestroy, Injector } from '@angular/core';\r\nimport { Observable, Subscription, fromEvent } from 'rxjs';\r\nimport { debounceTime, startWith } from 'rxjs/operators';\r\n\r\nimport { MessageService } from '../message/shared/message.service';\r\nimport { ConnectionState } from './network.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NetworkService implements OnDestroy {\r\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\r\n  private onlineSubscription: Subscription;\r\n  private offlineSubscription: Subscription;\r\n  private previousMessageId;\r\n\r\n  private state: ConnectionState = {\r\n    connection: window.navigator.onLine\r\n  };\r\n\r\n  constructor(\r\n    private messageService: MessageService,\r\n    private injector: Injector\r\n  ) {\r\n    this.checkNetworkState();\r\n  }\r\n\r\n  private checkNetworkState() {\r\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\r\n      if (this.previousMessageId) {\r\n        this.messageService.remove(this.previousMessageId);\r\n      }\r\n      const messageObj = this.messageService.info(\r\n        'igo.core.network.online.message',\r\n        'igo.core.network.online.title'\r\n      );\r\n      this.previousMessageId = messageObj.toastId;\r\n      this.state.connection = true;\r\n      this.emitEvent();\r\n    });\r\n\r\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\r\n      if (this.previousMessageId) {\r\n        this.messageService.remove(this.previousMessageId);\r\n      }\r\n      const messageObj = this.messageService.info(\r\n        'igo.core.network.offline.message',\r\n        'igo.core.network.offline.title'\r\n      );\r\n      this.previousMessageId = messageObj.toastId;\r\n      this.state.connection = false;\r\n      this.emitEvent();\r\n    });\r\n  }\r\n\r\n  private emitEvent() {\r\n    this.stateChangeEventEmitter.emit(this.state);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    try {\r\n      this.offlineSubscription.unsubscribe();\r\n      this.onlineSubscription.unsubscribe();\r\n    } catch (e) {}\r\n  }\r\n\r\n  currentState(reportState = true): Observable<ConnectionState> {\r\n    return reportState\r\n      ? this.stateChangeEventEmitter.pipe(\r\n          debounceTime(300),\r\n          startWith(this.state)\r\n        )\r\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ConfigService } from '../config/config.service';\r\nimport { RegexOptions } from './regex.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RegexService {\r\n  protected options: RegexOptions;\r\n\r\n  constructor(private config: ConfigService) {\r\n    this.options = this.config.getConfig('regex');\r\n  }\r\n\r\n  getAll() {\r\n    return this.options;\r\n  }\r\n\r\n  get(key) {\r\n    if (this.options) {\r\n      return this.options[key];\r\n    }\r\n    return;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ActionbarComponent } from './actionbar.component';\nimport { ActionbarItemComponent } from './actionbar-item.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatListModule,\n    MatCardModule,\n    MatCheckboxModule\n  ],\n  exports: [ActionbarComponent],\n  declarations: [ActionbarComponent, ActionbarItemComponent]\n})\nexport class IgoActionbarModule {}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoActionbarModule } from './actionbar/actionbar.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, IgoActionbarModule],\r\n  exports: [IgoActionbarModule],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoActionModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { IgoBadgeIconDirective } from './badge-icon.directive';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\n\n@NgModule({\n  imports: [MatBadgeModule, MatIconModule],\n  declarations: [IgoBadgeIconDirective],\n  exports: [MatBadgeModule, IgoBadgeIconDirective]\n})\nexport class IgoMatBadgeIconModule {\n  static forRoot(): ModuleWithProviders<IgoMatBadgeIconModule> {\n    return {\n      ngModule: IgoMatBadgeIconModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { CollapseDirective } from './collapse.directive';\nimport { CollapsibleComponent } from './collapsible.component';\n\n@NgModule({\n  imports: [MatIconModule, MatListModule],\n  declarations: [CollapsibleComponent, CollapseDirective],\n  exports: [CollapsibleComponent, CollapseDirective]\n})\nexport class IgoCollapsibleModule {\n  static forRoot(): ModuleWithProviders<IgoCollapsibleModule> {\n    return {\n      ngModule: IgoCollapsibleModule,\n      providers: []\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-confirm-dialog',\n  templateUrl: './confirm-dialog.component.html',\n  styleUrls: ['./confirm-dialog.component.scss']\n})\nexport class ConfirmDialogComponent {\n  public confirmMessage: string;\n\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\n}\n","<h2 mat-dialog-title class=\"mat-typography\">\r\n  {{ 'igo.common.confirmDialog.title' | translate }}\r\n</h2>\r\n<div mat-dialog-content class=\"mat-typography\">{{ confirmMessage }}</div>\r\n<div mat-dialog-actions>\r\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(true)\">\r\n    {{ 'igo.common.confirmDialog.confirmBtn' | translate }}\r\n  </button>\r\n  <button mat-button (click)=\"dialogRef.close(false)\">\r\n    {{ 'igo.common.confirmDialog.cancelBtn' | translate }}\r\n  </button>\r\n</div>\r\n","import { Injectable } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\r\n\r\n@Injectable()\r\nexport class ConfirmDialogService {\r\n  constructor(\r\n    private dialog: MatDialog,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  public open(message: string): Observable<any> {\r\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\r\n      disableClose: false\r\n    });\r\n    dialogRef.componentInstance.confirmMessage =\r\n      this.languageService.translate.instant(message);\r\n\r\n    return dialogRef.afterClosed();\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogService } from './confirm-dialog.service';\n\n@NgModule({\n  imports: [MatButtonModule, MatDialogModule, IgoLanguageModule],\n  declarations: [ConfirmDialogComponent],\n  exports: [ConfirmDialogComponent],\n  providers: [ConfirmDialogService]\n})\nexport class IgoConfirmDialogModule {\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\n    return {\n      ngModule: IgoConfirmDialogModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ContextMenuDirective } from './context-menu.directive';\nimport { LongPressDirective } from './long-press.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ContextMenuDirective, LongPressDirective],\n  exports: [ContextMenuDirective, LongPressDirective]\n})\nexport class IgoContextMenuModule {\n  static forRoot(): ModuleWithProviders<IgoContextMenuModule> {\n    return {\n      ngModule: IgoContextMenuModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { CustomHtmlComponent } from './custom-html.component';\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatInputModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ],\n  exports: [SanitizeHtmlPipe, CustomHtmlComponent],\n  declarations: [SanitizeHtmlPipe, CustomHtmlComponent]\n})\nexport class IgoCustomHtmlModule {\n  static forRoot(): ModuleWithProviders<IgoCustomHtmlModule> {\n    return {\n      ngModule: IgoCustomHtmlModule\n    };\n  }\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { catchError, map } from 'rxjs/operators';\r\nimport { throwError } from 'rxjs';\r\n\r\nimport { DOMOptions, DOMValue } from './dom.interfaces';\r\nimport { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DOMService {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  async getDom(dom: DOMOptions): Promise<DOMValue[]> {\r\n    const url = dom.url;\r\n    let result: DOMValue[];\r\n\r\n    await this.http\r\n      .get<any>(url)\r\n      .pipe(\r\n        map((response) => {\r\n          result = response;\r\n          return response;\r\n        }),\r\n        catchError((err: HttpErrorResponse) => {\r\n          return throwError(err);\r\n        })\r\n      )\r\n      .toPromise();\r\n\r\n    return result;\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { DOMService } from './dom.service';\r\n\r\n@NgModule({\r\n  providers: [DOMService]\r\n})\r\nexport class IgoDOMModule {\r\n  static forRoot(): ModuleWithProviders<IgoDOMModule> {\r\n    return {\r\n      ngModule: IgoDOMModule,\r\n      providers: [DOMService]\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { DragAndDropDirective } from './drag-drop.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [DragAndDropDirective],\n  exports: [DragAndDropDirective]\n})\nexport class IgoDrapDropModule {\n  static forRoot(): ModuleWithProviders<IgoDrapDropModule> {\n    return {\n      ngModule: IgoDrapDropModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { DynamicOutletComponent } from './dynamic-outlet.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [DynamicOutletComponent],\r\n  declarations: [DynamicOutletComponent]\r\n})\r\nexport class IgoDynamicOutletModule {}\r\n","import {\r\n  ComponentFactory,\r\n  ComponentRef,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\n\r\nimport { Observable, Subscription } from 'rxjs';\r\n\r\n/**\r\n * This class is used in the DynamicComponentOutlet component. It holds\r\n * a reference to a component factory and can render that component\r\n * in a target element on demand. It's also possible to set inputs\r\n * and to subscribe to outputs.\r\n */\r\nexport class DynamicComponent<C> {\r\n  /**\r\n   * Component reference\r\n   */\r\n  private componentRef: ComponentRef<C>;\r\n\r\n  /**\r\n   * Subscriptions to the component's outputs. Those need\r\n   * to be unsubscribed when the component is destroyed.\r\n   */\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  /**\r\n   * Component target element\r\n   */\r\n  private target: ViewContainerRef;\r\n\r\n  /**\r\n   * Component inputs\r\n   */\r\n  private inputs: { [key: string]: any } = {};\r\n\r\n  /**\r\n   * Subscriptions to the component's async inputs\r\n   */\r\n  private inputs$$: { [key: string]: Subscription } = {};\r\n\r\n  /**\r\n   * Subscribers to the component's outputs\r\n   */\r\n  private subscribers: { [key: string]: (event: any) => void } = {};\r\n\r\n  constructor(private componentFactory: ComponentFactory<C>) {}\r\n\r\n  /**\r\n   * Render the component to a target element.\r\n   * Set it's inputs and subscribe to it's outputs.\r\n   * @param target Target element\r\n   */\r\n  setTarget(target: ViewContainerRef) {\r\n    this.target = target;\r\n    this.componentRef = target.createComponent(this.componentFactory);\r\n    this.updateInputs(this.inputs);\r\n    this.updateSubscribers(this.subscribers);\r\n  }\r\n\r\n  /**\r\n   * Destroy this component. That means, removing from it's target\r\n   * element and unsubscribing to it's outputs.\r\n   */\r\n  destroy() {\r\n    if (this.target !== undefined) {\r\n      this.target.clear();\r\n    }\r\n    if (this.componentRef !== undefined) {\r\n      this.componentRef.destroy();\r\n      this.componentRef = undefined;\r\n    }\r\n    this.unobserveAllInputs();\r\n    this.unsubscribeAll();\r\n  }\r\n\r\n  /**\r\n   * Update the component inputs. This is an update so any\r\n   * key not defined won't be overwritten.\r\n   */\r\n  updateInputs(inputs: { [key: string]: any }) {\r\n    this.inputs = inputs;\r\n    if (this.componentRef === undefined) {\r\n      return;\r\n    }\r\n\r\n    const instance = this.componentRef.instance;\r\n    const allowedInputs = this.componentFactory.inputs;\r\n    allowedInputs.forEach(\r\n      (value: { propName: string; templateName: string }) => {\r\n        const key = value.propName;\r\n\r\n        this.unobserveInput(key);\r\n\r\n        const inputValue = inputs[key];\r\n        if (inputs.hasOwnProperty(key)) {\r\n          if (inputValue instanceof Observable) {\r\n            this.observeInput(key, inputValue);\r\n          } else {\r\n            this.setInputValue(instance, key, inputValue);\r\n          }\r\n        }\r\n      }\r\n    );\r\n\r\n    if (typeof (instance as any).onUpdateInputs === 'function') {\r\n      (instance as any).onUpdateInputs();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set an instance's input value\r\n   * @param instance Component instance\r\n   * @param key Input key\r\n   * @param value Input value\r\n   */\r\n  private setInputValue(instance: C, key: string, value: any) {\r\n    const currentValue = instance[key];\r\n    if (value === currentValue) {\r\n      return;\r\n    }\r\n\r\n    const prototype = Object.getPrototypeOf(instance);\r\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\r\n    if (descriptor !== undefined && descriptor.set !== undefined) {\r\n      descriptor.set.call(instance, value);\r\n    } else {\r\n      instance[key] = value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the component subscribers. This is an update so any\r\n   * key not defined won't be overwritten.\r\n   */\r\n  updateSubscribers(subscribers: { [key: string]: (event: any) => void }) {\r\n    this.subscribers = subscribers;\r\n    if (this.componentRef === undefined) {\r\n      return;\r\n    }\r\n\r\n    const instance = this.componentRef.instance;\r\n    const allowedSubscribers = this.componentFactory.outputs;\r\n    allowedSubscribers.forEach(\r\n      (value: { propName: string; templateName: string }) => {\r\n        const key = value.propName;\r\n        if (subscribers.hasOwnProperty(key)) {\r\n          const emitter = instance[key];\r\n          const subscriber = subscribers[key];\r\n          if (Array.isArray(subscriber)) {\r\n            subscriber.forEach((_subscriber) => {\r\n              this.subscriptions.push(emitter.subscribe(_subscriber));\r\n            });\r\n          } else {\r\n            this.subscriptions.push(emitter.subscribe(subscriber));\r\n          }\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Subscribe to an observable input and update the component's input value\r\n   * accordingly\r\n   * @param key Input key\r\n   * @param observable Observable\r\n   */\r\n  private observeInput(key: string, observable: Observable<any>) {\r\n    this.inputs$$[key] = observable.subscribe((value: any) => {\r\n      const instance = this.componentRef.instance;\r\n      this.setInputValue(instance, key, value);\r\n\r\n      if (typeof (instance as any).onUpdateInputs === 'function') {\r\n        (instance as any).onUpdateInputs();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to an observable input\r\n   * @param key Input key\r\n   */\r\n  private unobserveInput(key: string) {\r\n    if (this.inputs$$[key] !== undefined) {\r\n      this.inputs$$[key].unsubscribe();\r\n      this.inputs$$[key] = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to all outputs.\r\n   */\r\n  private unobserveAllInputs() {\r\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\r\n      if (s !== undefined) {\r\n        s.unsubscribe();\r\n      }\r\n    });\r\n    this.inputs$$ = {};\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to all outputs.\r\n   */\r\n  private unsubscribeAll() {\r\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\r\n    this.subscriptions = [];\r\n  }\r\n}\r\n","import { ComponentFactoryResolver, Injectable } from '@angular/core';\r\n\r\nimport { DynamicComponent } from './dynamic-component';\r\n\r\n/**\r\n * Service to creates DynamicComponent instances from base component classes\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DynamicComponentService {\r\n  constructor(private resolver: ComponentFactoryResolver) {}\r\n\r\n  /**\r\n   * Creates a DynamicComponent instance from a base component class\r\n   * @param componentCls The component class\r\n   * @returns DynamicComponent instance\r\n   */\r\n  create(componentCls: any): DynamicComponent<any> {\r\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\r\n    return new DynamicComponent<typeof componentCls>(factory);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoDynamicOutletModule } from './dynamic-outlet/dynamic-outlet.module';\r\nimport { DynamicComponentService } from './shared/dynamic-component.service';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, IgoDynamicOutletModule],\r\n  exports: [IgoDynamicOutletModule],\r\n  providers: [DynamicComponentService]\r\n})\r\nexport class IgoDynamicComponentModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FlexibleComponent } from './flexible.component';\n\n@NgModule({\n  imports: [],\n  declarations: [FlexibleComponent],\n  exports: [FlexibleComponent]\n})\nexport class IgoFlexibleModule {\n  static forRoot(): ModuleWithProviders<IgoFlexibleModule> {\n    return {\n      ngModule: IgoFlexibleModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { FormComponent } from './form.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, FormsModule, ReactiveFormsModule],\r\n  exports: [FormComponent, FormsModule, ReactiveFormsModule],\r\n  declarations: [FormComponent]\r\n})\r\nexport class IgoFormFormModule {}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoDynamicOutletModule } from '../../dynamic-component/dynamic-outlet/dynamic-outlet.module';\n\nimport { FormFieldComponent } from './form-field.component';\nimport { FormFieldSelectComponent } from './form-field-select.component';\nimport { FormFieldTextComponent } from './form-field-text.component';\nimport { FormFieldTextareaComponent } from './form-field-textarea.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    IgoLanguageModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ],\n  declarations: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ]\n})\nexport class IgoFormFieldModule {}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoFormFieldModule } from '../form-field/form-field.module';\r\nimport { FormGroupComponent } from './form-group.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatFormFieldModule,\r\n    IgoLanguageModule,\r\n    IgoFormFieldModule\r\n  ],\r\n  exports: [FormGroupComponent],\r\n  declarations: [FormGroupComponent]\r\n})\r\nexport class IgoFormGroupModule {}\r\n","import { Injectable } from '@angular/core';\r\nimport { UntypedFormBuilder, Validators, ValidatorFn } from '@angular/forms';\r\n\r\nimport {\r\n  Form,\r\n  FormField,\r\n  FormFieldConfig,\r\n  FormFieldGroup,\r\n  FormFieldGroupConfig\r\n} from './form.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FormService {\r\n  constructor(private formBuilder: UntypedFormBuilder) {}\r\n\r\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\r\n    const control = this.formBuilder.group({});\r\n    fields.forEach((field: FormField) => {\r\n      control.addControl(field.name, field.control);\r\n    });\r\n    groups.forEach((group: FormFieldGroup) => {\r\n      control.addControl(group.name, group.control);\r\n    });\r\n\r\n    return { fields, groups, control };\r\n  }\r\n\r\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\r\n    const options = config.options || {};\r\n    const control = this.formBuilder.group({});\r\n    fields.forEach((field: FormField) => {\r\n      control.addControl(field.name, field.control);\r\n    });\r\n\r\n    if (options.validator) {\r\n      const validators = this.getValidators(options.validator); // convert string to actual validator\r\n      control.setValidators(validators);\r\n    }\r\n\r\n    return Object.assign({}, config, { fields, control }) as FormFieldGroup;\r\n  }\r\n\r\n  field(config: FormFieldConfig): FormField {\r\n    const options = config.options || {};\r\n    const state = {\r\n      value: '',\r\n      disabled: options.disabled\r\n    };\r\n    const control = this.formBuilder.control(state);\r\n\r\n    if (options.validator) {\r\n      const validators = this.getValidators(options.validator); // convert string to actual validator\r\n      control.setValidators(validators);\r\n    }\r\n\r\n    return Object.assign({ type: 'text' }, config, { control }) as FormField;\r\n  }\r\n\r\n  extendFieldConfig(\r\n    config: FormFieldConfig,\r\n    partial: Partial<FormFieldConfig>\r\n  ): FormFieldConfig {\r\n    const options = Object.assign(\r\n      {},\r\n      config.options || {},\r\n      partial.options || {}\r\n    );\r\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\r\n    const subscribers = Object.assign(\r\n      {},\r\n      config.subscribers || {},\r\n      partial.subscribers || {}\r\n    );\r\n    return Object.assign({}, config, { options, inputs, subscribers });\r\n  }\r\n\r\n  private getValidators(\r\n    validatorOption: string | string[] | ValidatorFn\r\n  ): ValidatorFn | ValidatorFn[] {\r\n    if (Array.isArray(validatorOption)) {\r\n      return validatorOption.map((validatorStr) => {\r\n        return this.getValidator(validatorStr);\r\n      });\r\n    }\r\n\r\n    return this.getValidator(validatorOption);\r\n  }\r\n\r\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\r\n    if (typeof validatorStr !== 'string') {\r\n      return validatorStr;\r\n    }\r\n\r\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\r\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\r\n    const match = validatorStr.match(re);\r\n\r\n    if (!match) {\r\n      return Validators[validatorStr];\r\n    }\r\n\r\n    const name = match[1];\r\n    const args = match[2];\r\n    return Validators[name](args);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * Service where all available form fields are registered.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FormFieldService {\r\n  static fields: { [key: string]: any } = {};\r\n\r\n  static register(type: string, component: any) {\r\n    FormFieldService.fields[type] = component;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Return field component by type\r\n   * @param type Field type\r\n   * @returns Field component\r\n   */\r\n  getFieldByType(type: string): any {\r\n    return FormFieldService.fields[type];\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoFormFormModule } from './form/form.module';\r\nimport { IgoFormGroupModule } from './form-group/form-group.module';\r\nimport { IgoFormFieldModule } from './form-field/form-field.module';\r\nimport { FormService } from './shared/form.service';\r\nimport { FormFieldService } from './shared/form-field.service';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoFormGroupModule, IgoFormFieldModule],\r\n  exports: [IgoFormFormModule, IgoFormGroupModule, IgoFormFieldModule],\r\n  declarations: [],\r\n  providers: [FormService, FormFieldService]\r\n})\r\nexport class IgoFormModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { MatSelectModule } from '@angular/material/select';\r\n\r\nimport { EntitySelectorComponent } from './entity-selector.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, FormsModule, MatSelectModule],\r\n  exports: [EntitySelectorComponent],\r\n  declarations: [EntitySelectorComponent]\r\n})\r\nexport class IgoEntitySelectorModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { StopDropPropagationDirective } from './stop-drop-propagation.directive';\nimport { StopPropagationDirective } from './stop-propagation.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [StopDropPropagationDirective, StopPropagationDirective],\n  exports: [StopDropPropagationDirective, StopPropagationDirective]\n})\nexport class IgoStopPropagationModule {\n  static forRoot(): ModuleWithProviders<IgoStopPropagationModule> {\n    return {\n      ngModule: IgoStopPropagationModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { EntityTablePaginatorComponent } from './entity-table-paginator.component';\r\nimport { MatPaginatorModule } from '@angular/material/paginator';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [MatPaginatorModule],\r\n  exports: [EntityTablePaginatorComponent],\r\n  declarations: [EntityTablePaginatorComponent]\r\n})\r\nexport class IgoEntityTablePaginatorModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ImageErrorDirective } from './image-error.directive';\nimport { SecureImagePipe } from './secure-image.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [SecureImagePipe, ImageErrorDirective],\n  exports: [SecureImagePipe, ImageErrorDirective]\n})\nexport class IgoImageModule {\n  static forRoot(): ModuleWithProviders<IgoImageModule> {\n    return {\n      ngModule: IgoImageModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSortModule } from '@angular/material/sort';\r\nimport { MatTableModule } from '@angular/material/table';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\n\r\nimport { IgoStopPropagationModule } from '../../stop-propagation/stop-propagation.module';\r\nimport { IgoCustomHtmlModule } from '../../custom-html/custom-html.module';\r\nimport { EntityTableRowDirective } from './entity-table-row.directive';\r\nimport { EntityTableComponent } from './entity-table.component';\r\nimport { MatPaginatorModule } from '@angular/material/paginator';\r\nimport { IgoEntityTablePaginatorModule } from '../entity-table-paginator/entity-table-paginator.module';\r\nimport { IgoImageModule } from '../../image/image.module';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatDatepickerModule } from '@angular/material/datepicker';\r\nimport { MatSelectModule } from '@angular/material/select';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatTableModule,\r\n    MatAutocompleteModule,\r\n    MatSortModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatCheckboxModule,\r\n    MatPaginatorModule,\r\n    MatSelectModule,\r\n    IgoStopPropagationModule,\r\n    IgoCustomHtmlModule,\r\n    IgoEntityTablePaginatorModule,\r\n    IgoImageModule,\r\n    IgoLanguageModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatInputModule,\r\n    MatDatepickerModule,\r\n    MatTooltipModule\r\n  ],\r\n  exports: [EntityTableComponent],\r\n  declarations: [EntityTableComponent, EntityTableRowDirective]\r\n})\r\nexport class IgoEntityTableModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoEntitySelectorModule } from './entity-selector/entity-selector.module';\r\nimport { IgoEntityTableModule } from './entity-table/entity-table.module';\r\nimport { IgoEntityTablePaginatorModule } from './entity-table-paginator/entity-table-paginator.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [\r\n    IgoEntitySelectorModule,\r\n    IgoEntityTableModule,\r\n    IgoEntityTablePaginatorModule\r\n  ],\r\n  declarations: []\r\n})\r\nexport class IgoEntityModule {}\r\n","import { catchError } from 'rxjs/operators';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { Injectable } from '@angular/core';\r\nimport { InteractiveTourOptions } from './interactive-tour.interface';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\n@Injectable()\r\nexport class InteractiveTourLoader {\r\n  private jsonURL: string;\r\n  private allToursOptions;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private configService: ConfigService\r\n  ) {\r\n    this.jsonURL = this.getPathToConfigFile();\r\n  }\r\n\r\n  public loadConfigTour() {\r\n    this.getJSON().subscribe(\r\n      (data) => {\r\n        this.allToursOptions = data;\r\n      },\r\n      (err) => {\r\n        throw new Error(\r\n          `Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.`\r\n        );\r\n      }\r\n    );\r\n  }\r\n\r\n  public getPathToConfigFile(): string {\r\n    return (\r\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\r\n      './config/interactiveTour.json'\r\n    );\r\n  }\r\n\r\n  public getJSON(): Observable<any> {\r\n    return this.http.get(this.jsonURL).pipe(\r\n      catchError((e) => {\r\n        e.error.caught = true;\r\n        throw e;\r\n      })\r\n    );\r\n  }\r\n\r\n  public getTourOptionData(toolName): InteractiveTourOptions {\r\n    if (this.allToursOptions === undefined) {\r\n      return undefined;\r\n    }\r\n    let nameInConfigFile = toolName;\r\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\r\n    return this.allToursOptions[nameInConfigFile];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ShepherdService } from 'angular-shepherd';\r\n\r\nimport { ConfigService, MediaService, LanguageService } from '@igo2/core';\r\nimport { InteractiveTourLoader } from './interactive-tour.loader';\r\nimport {\r\n  InteractiveTourOptions,\r\n  InteractiveTourStep,\r\n  InteractiveTourAction\r\n} from './interactive-tour.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class InteractiveTourService {\r\n  private previousStep: InteractiveTourStep;\r\n  private nextIndex = 1;\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    private mediaService: MediaService,\r\n    private languageService: LanguageService,\r\n    private interactiveTourLoader: InteractiveTourLoader,\r\n    private shepherdService: ShepherdService\r\n  ) {\r\n    if (this.isAppHaveTour()) {\r\n      this.interactiveTourLoader.loadConfigTour();\r\n    }\r\n  }\r\n\r\n  public isAppHaveTour() {\r\n    const haveTour = this.configService.getConfig(\r\n      'interactiveTour.activateInteractiveTour'\r\n    );\r\n    if (haveTour === undefined) {\r\n      return true;\r\n    } else {\r\n      return haveTour;\r\n    }\r\n  }\r\n\r\n  public isToolHaveTourConfig(toolName: string): boolean {\r\n    const checkTourActiveOptions =\r\n      this.interactiveTourLoader.getTourOptionData(toolName);\r\n    if (checkTourActiveOptions === undefined) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  public disabledTourButton(toolName: string): boolean {\r\n    const stepConfig: InteractiveTourOptions =\r\n      this.interactiveTourLoader.getTourOptionData(toolName);\r\n\r\n    if (stepConfig?.conditions) {\r\n      for (const condition of stepConfig?.conditions) {\r\n        if (document.querySelector(condition) === null) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public isMobile(): boolean {\r\n    return this.mediaService.isMobile();\r\n  }\r\n\r\n  public isTourDisplayInMobile(): boolean {\r\n    const showInMobile = this.configService.getConfig(\r\n      'interactiveTour.tourInMobile'\r\n    );\r\n    if (showInMobile === undefined) {\r\n      return true;\r\n    }\r\n    return this.configService.getConfig('interactiveTour.tourInMobile');\r\n  }\r\n\r\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\r\n    if (buttonKind === 'noBackButton') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.nextButton'\r\n          ),\r\n          type: 'next'\r\n        }\r\n      ];\r\n    }\r\n    if (buttonKind === 'first') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-secondary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.exitButton'\r\n          ),\r\n          type: 'cancel'\r\n        },\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.nextButton'\r\n          ),\r\n          type: 'next'\r\n        }\r\n      ];\r\n    }\r\n\r\n    if (buttonKind === 'last') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-secondary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.backButton'\r\n          ),\r\n          type: 'back'\r\n        },\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.exitButton'\r\n          ),\r\n          type: 'cancel'\r\n        }\r\n      ];\r\n    }\r\n\r\n    return [\r\n      {\r\n        classes: 'shepherd-button-secondary',\r\n        text: this.languageService.translate.instant(\r\n          'igo.common.interactiveTour.backButton'\r\n        ),\r\n        type: 'back'\r\n      },\r\n      {\r\n        classes: 'shepherd-button-primary',\r\n        text: this.languageService.translate.instant(\r\n          'igo.common.interactiveTour.nextButton'\r\n        ),\r\n        type: 'next'\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getAction(actionName: string) {\r\n    const action = {\r\n      click: 'click'\r\n    };\r\n    return action[actionName.toLowerCase()];\r\n  }\r\n\r\n  private addProgress() {\r\n    const self = this as any;\r\n    let nbTry = 0;\r\n    const maxTry = 21;\r\n    const checkExist = setInterval(() => {\r\n      if (self.getCurrentStep()) {\r\n        if (\r\n          self.getCurrentStep().options.attachTo.element &&\r\n          !document.querySelector(\r\n            self.getCurrentStep().options.attachTo.element\r\n          )\r\n        ) {\r\n          self.cancel();\r\n          clearInterval(checkExist);\r\n          return;\r\n        } else {\r\n          const currentStepElement = self.getCurrentStep().getElement();\r\n          if (currentStepElement) {\r\n            const shepherdList = currentStepElement.querySelectorAll(\r\n              '.shepherd-content, .shepherd-text'\r\n            );\r\n            shepherdList.forEach((element) => {\r\n              element.classList.add('mat-typography');\r\n            });\r\n          }\r\n          const header = currentStepElement\r\n            ? currentStepElement.querySelector('.shepherd-header')\r\n            : undefined;\r\n\r\n          nbTry++;\r\n          if (header || nbTry > maxTry) {\r\n            clearInterval(checkExist);\r\n          }\r\n\r\n          if (header) {\r\n            const stepsArray = self.steps;\r\n            const progress = document.createElement('span');\r\n            progress.className = 'shepherd-progress';\r\n            progress.innerText = `${\r\n              stepsArray.indexOf(self.getCurrentStep()) + 1\r\n            }/${stepsArray.length}`;\r\n            header.insertBefore(\r\n              progress,\r\n              currentStepElement.querySelector('.shepherd-cancel-icon')\r\n            );\r\n          }\r\n        }\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  private checkNext(index, tour, service) {\r\n    if (tour.getCurrentStep()) {\r\n      if (\r\n        tour.getCurrentStep().options.attachTo.element &&\r\n        document.querySelector(tour.getCurrentStep().options.attachTo.element)\r\n      ) {\r\n        tour.complete();\r\n        return;\r\n      }\r\n\r\n      if (index.index === tour.steps.length - 1) {\r\n        tour.complete();\r\n        return;\r\n      }\r\n\r\n      tour.steps.splice(index.index, 1);\r\n      const nextStep = tour.steps[index.index];\r\n      if (\r\n        nextStep.options.attachTo.element &&\r\n        !document.querySelector(nextStep.options.attachTo.element)\r\n      ) {\r\n        service.checkNext(index, tour, service);\r\n      } else {\r\n        tour._setupModal();\r\n        tour.show(nextStep.id);\r\n      }\r\n    }\r\n  }\r\n\r\n  private executeAction(\r\n    step: InteractiveTourStep,\r\n    actionConfig: InteractiveTourAction\r\n  ) {\r\n    if (!actionConfig) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      actionConfig.condition &&\r\n      ((actionConfig.condition.charAt(0) === '!' &&\r\n        document.querySelector(actionConfig.condition.slice(1))) ||\r\n        (actionConfig.condition.charAt(0) !== '!' &&\r\n          !document.querySelector(actionConfig.condition)))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const element: HTMLElement = document.querySelector(\r\n      actionConfig.element || step.element\r\n    ) as HTMLElement;\r\n    const action = this.getAction(actionConfig.action);\r\n    if (element && action) {\r\n      element[action]();\r\n    }\r\n  }\r\n\r\n  private executeActionPromise(\r\n    step: InteractiveTourStep,\r\n    actionConfig: InteractiveTourAction\r\n  ) {\r\n    return new Promise<void>((resolve) => {\r\n      this.executeAction(step, actionConfig);\r\n      if (!actionConfig || !actionConfig.waitFor) {\r\n        resolve();\r\n        return;\r\n      }\r\n      let nbTry = 0;\r\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\r\n      const checkExist = setInterval(() => {\r\n        nbTry++;\r\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\r\n          clearInterval(checkExist);\r\n          resolve();\r\n        }\r\n      }, 100);\r\n    });\r\n  }\r\n\r\n  private getShepherdSteps(stepConfig: InteractiveTourOptions) {\r\n    const shepherdSteps = [];\r\n\r\n    let i = 0;\r\n    for (const step of stepConfig.steps) {\r\n      shepherdSteps.push({\r\n        attachTo: {\r\n          element: step.element,\r\n          on: step.position || stepConfig.position\r\n        },\r\n        popperOptions: {\r\n          modifiers: [{ name: 'offset', options: { offset: [0, 15] } }]\r\n        },\r\n        beforeShowPromise: () => {\r\n          return Promise.all([\r\n            this.executeActionPromise(\r\n              this.previousStep,\r\n              this.previousStep ? this.previousStep.beforeChange : undefined\r\n            ),\r\n            this.executeActionPromise(step, step.beforeShow)\r\n          ]);\r\n        },\r\n        buttons: this.getButtons(\r\n          i === 0\r\n            ? 'first'\r\n            : i + 1 === stepConfig.steps.length\r\n            ? 'last'\r\n            : stepConfig.steps[i].noBackButton\r\n            ? 'noBackButton'\r\n            : undefined\r\n        ),\r\n        classes: step.class,\r\n        highlightClass: step.highlightClass,\r\n        scrollTo: step.scrollToElement || stepConfig.scrollToElement || true,\r\n        canClickTarget: step.disableInteraction\r\n          ? !step.disableInteraction\r\n          : undefined,\r\n        title: this.languageService.translate.instant(\r\n          step.title || stepConfig.title\r\n        ),\r\n        text: [this.languageService.translate.instant(step.text)],\r\n        when: {\r\n          show: () => {\r\n            this.executeAction(step, step.onShow);\r\n          },\r\n          hide: () => {\r\n            this.previousStep = step;\r\n            this.executeAction(step, step.onHide);\r\n          }\r\n        }\r\n      });\r\n      i++;\r\n    }\r\n\r\n    return shepherdSteps;\r\n  }\r\n\r\n  public startTour(toolName: string) {\r\n    const stepConfig: InteractiveTourOptions =\r\n      this.interactiveTourLoader.getTourOptionData(toolName);\r\n\r\n    this.shepherdService.defaultStepOptions = {\r\n      classes: stepConfig.class,\r\n      highlightClass: stepConfig.highlightClass,\r\n      canClickTarget: stepConfig.disableInteraction\r\n        ? !stepConfig.disableInteraction\r\n        : true,\r\n      cancelIcon: {\r\n        enabled: true\r\n      }\r\n    };\r\n\r\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\r\n\r\n    this.shepherdService.modal = true;\r\n    this.shepherdService.confirmCancel = false;\r\n    this.shepherdService.addSteps(shepherdSteps);\r\n\r\n    this.shepherdService.tourObject.on('show', this.addProgress);\r\n    this.shepherdService.tourObject.on('cancel', (index) => {\r\n      this.checkNext(index, this.shepherdService.tourObject, this);\r\n    });\r\n\r\n    this.shepherdService.start();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { InteractiveTourComponent } from './interactive-tour.component';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\n\n@NgModule({\n  declarations: [InteractiveTourComponent],\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  providers: [InteractiveTourService, InteractiveTourLoader],\n  exports: [InteractiveTourComponent]\n})\nexport class IgoInteractiveTourModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { KeyValuePipe } from './keyvalue.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [KeyValuePipe],\n  exports: [KeyValuePipe]\n})\nexport class IgoKeyValueModule {\n  static forRoot(): ModuleWithProviders<IgoKeyValueModule> {\n    return {\n      ngModule: IgoKeyValueModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ClickoutDirective } from './clickout.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ClickoutDirective],\n  exports: [ClickoutDirective]\n})\nexport class IgoClickoutModule {\n  static forRoot(): ModuleWithProviders<IgoClickoutModule> {\n    return {\n      ngModule: IgoClickoutModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { IgoClickoutModule } from '../clickout/clickout.module';\n\nimport { ListItemDirective } from './list-item.directive';\nimport { ListComponent } from './list.component';\n\n@NgModule({\n  imports: [CommonModule, MatIconModule, MatListModule, IgoClickoutModule],\n  declarations: [ListItemDirective, ListComponent],\n  exports: [ListItemDirective, ListComponent]\n})\nexport class IgoListModule {\n  static forRoot(): ModuleWithProviders<IgoListModule> {\n    return {\n      ngModule: IgoListModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { PanelComponent } from './panel.component';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [PanelComponent],\n  declarations: [PanelComponent]\n})\nexport class IgoPanelModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\n\nimport { SpinnerActivityDirective } from './spinner-activity.directive';\nimport { SpinnerComponent } from './spinner.component';\n\n@NgModule({\n  imports: [CommonModule, MatProgressSpinnerModule],\n  declarations: [SpinnerActivityDirective, SpinnerComponent],\n  exports: [SpinnerActivityDirective, SpinnerComponent]\n})\nexport class IgoSpinnerModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { TableComponent } from './table.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    CdkTableModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTableModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSortModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  declarations: [TableComponent],\n  exports: [TableComponent]\n})\nexport class IgoTableModule {\n  static forRoot(): ModuleWithProviders<IgoTableModule> {\n    return {\n      ngModule: IgoTableModule,\n      providers: []\n    };\n  }\n}\n","export enum EntityOperationType {\n  Insert = 'Insert',\n  Update = 'Update',\n  Delete = 'Delete'\n}\n\nexport enum EntityTableColumnRenderer {\n  Default = 'Default',\n  HTML = 'HTML',\n  UnsanitizedHTML = 'UnsanitizedHTML',\n  Editable = 'Editable',\n  Icon = 'Icon',\n  ButtonGroup = 'ButtonGroup'\n}\n\nexport enum EntityTableScrollBehavior {\n  Auto = 'auto',\n  Instant = 'instant',\n  Smooth = 'smooth'\n}\n\nexport enum EntityTableSelectionState {\n  None = 'None',\n  All = 'All',\n  Some = 'Some'\n}\n","import { t } from 'typy';\r\n\r\nimport { EntityKey } from './entity.interfaces';\r\n\r\n/**\r\n * Get an entity's named property. Nested properties are supported\r\n * with the dotted notation. (i.e 'author.name')\r\n *\r\n * Note: this method is a 'best attempt' at getting an entity's property.\r\n * It fits the most common cases but you might need to explicitely define\r\n * a property getter when using an EntityStore, for example.\r\n * @param entity Entity\r\n * @param property Property name\r\n * @returns Property value\r\n */\r\nexport function getEntityProperty(entity: object, property: string): any {\r\n  return t(entity, property).safeObject;\r\n}\r\n\r\n/**\r\n * Get an entity's id. An entity's id can be one of:\r\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\r\n *\r\n * Note: See the note in the 'getEntityProperty' documentation.\r\n * @param entity Entity\r\n * @returns Entity id\r\n */\r\nexport function getEntityId(entity: object): EntityKey {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\r\n}\r\n\r\n/**\r\n * Get an entity's title. An entity's title can be one of:\r\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\r\n * @param entity Entity\r\n * @returns Entity title\r\n */\r\nexport function getEntityTitle(entity: object): string {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.title\r\n    ? meta.title\r\n    : getEntityProperty(entity, meta.titleProperty || 'title');\r\n}\r\n\r\n/**\r\n * Get an entity's HTML title. An entity's HTML title can be one of:\r\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\r\n * @param entity Entity\r\n * @returns Entity HTML title\r\n */\r\nexport function getEntityTitleHtml(entity: object): string {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.titleHtml\r\n    ? meta.titleHtml\r\n    : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\r\n}\r\n\r\n/**\r\n * Get an entity's icon. An entity's icon can be one of:\r\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\r\n * @param entity Entity\r\n * @returns Entity icon\r\n */\r\nexport function getEntityIcon(entity: object): string {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.icon\r\n    ? meta.icon\r\n    : getEntityProperty(entity, meta.iconProperty || 'icon');\r\n}\r\n\r\n/**\r\n * Get an entity's revision.\r\n * @param entity Entity\r\n * @returns Entity revision\r\n */\r\nexport function getEntityRevision(entity: object): number {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.revision || 0;\r\n}\r\n","import { ReplaySubject } from 'rxjs';\n\nimport { EntityKey, EntityState } from './entity.interfaces';\nimport { getEntityId } from './entity.utils';\n\ninterface EntityStateManagerOptions<E extends object> {\n  getKey?: (entity: object) => EntityKey;\n  index?: Map<EntityKey, E>;\n}\n\n/**\n * This class is used to track a store's entities state\n */\nexport class EntityStateManager<\n  E extends object,\n  S extends EntityState = EntityState\n> {\n  /**\n   * State index\n   */\n  readonly index = new Map<EntityKey, S>();\n\n  /**\n   * Change emitter\n   */\n  readonly change$ = new ReplaySubject<void>(1);\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  constructor(private options: EntityStateManagerOptions<E> = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n\n    this.next();\n  }\n\n  /**\n   * Clear state\n   */\n  clear() {\n    if (this.index.size > 0) {\n      this.index.clear();\n      this.next();\n    }\n  }\n\n  /**\n   * Get an entity's state\n   * @param entity Entity\n   * @returns State\n   */\n  get(entity: E): S {\n    return (this.index.get(this.getKey(entity)) || {}) as S;\n  }\n\n  /**\n   * Set an entity's state\n   * @param entity Entity\n   * @param state State\n   */\n  set(entity: E, state: S) {\n    this.setMany([entity], state);\n  }\n\n  /**\n   * Set many entitie's state\n   * @param entitie Entities\n   * @param state State\n   */\n  setMany(entities: E[], state: S) {\n    entities.forEach((entity: E) => {\n      this.index.set(this.getKey(entity), Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Set state of all entities that already have a state. This is not\n   * the same as setting the state of all the store's entities.\n   * @param state State\n   */\n  setAll(state: S) {\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\n      this.index.set(key, Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Update an entity's state\n   * @param entity Entity\n   * @param changes State changes\n   */\n  update(entity: E, changes: Partial<S>, exclusive = false) {\n    this.updateMany([entity], changes, exclusive);\n  }\n\n  /**\n   * Update many entitie's state\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\n    if (exclusive === true) {\n      return this.updateManyExclusive(entities, changes);\n    }\n\n    entities.forEach((entity: E) => {\n      const state = Object.assign({}, this.get(entity), changes);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Reversee an entity's state\n   * @param entity Entity\n   * @param keys State keys to reverse\n   */\n  reverse(entity: E, keys: string[]) {\n    this.reverseMany([entity], keys);\n  }\n\n  /**\n   * Reverse many entitie's state\n   * @param entitie Entities\n   * @param keys State keys to reverse\n   */\n  reverseMany(entities: E[], keys: string[]) {\n    entities.forEach((entity: E) => {\n      const currentState = this.get(entity);\n      const changes = keys.reduce(\n        (acc: { [key: string]: boolean }, key: string) => {\n          acc[key] = currentState[key] || false;\n          return acc;\n        },\n        {}\n      ) as Partial<S>;\n      const reversedChanges = this.reverseChanges(changes);\n      const state = Object.assign({}, currentState, reversedChanges);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Update state of all entities that already have a state. This is not\n   * the same as updating the state of all the store's entities.\n   * @param changes State\n   */\n  updateAll(changes: Partial<S>) {\n    const allKeys = this.getAllKeys();\n    Array.from(allKeys).forEach((key: EntityKey) => {\n      const state = Object.assign({}, this.index.get(key), changes);\n      this.index.set(key, state);\n    });\n    this.next();\n  }\n\n  /**\n   * When some state changes are flagged as 'exclusive', reverse\n   * the state of all other entities. Changes are reversable when\n   * they are boolean.\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\n    const reverseChanges = this.reverseChanges(changes);\n\n    const keys = entities.map((entity: E) => this.getKey(entity));\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\n    allKeys.forEach((key: EntityKey) => {\n      const state = this.index.get(key) || ({} as S);\n\n      if (keys.indexOf(key) >= 0) {\n        this.index.set(key, Object.assign({}, state, changes));\n      } else {\n        // Update only if the reverse changes would modify\n        // a key already present in the current state\n        const shouldUpdate = Object.keys(reverseChanges).some(\n          (changeKey: string) => {\n            return (\n              state[changeKey] !== undefined &&\n              state[changeKey] !== reverseChanges[changeKey]\n            );\n          }\n        );\n        if (shouldUpdate === true) {\n          this.index.set(key, Object.assign({}, state, reverseChanges));\n        }\n      }\n    });\n\n    this.next();\n  }\n\n  /**\n   * Compute a 'reversed' version of some state changes.\n   * Changes are reversable when they are boolean.\n   * @param changes State changes\n   * @returns Reversed state changes\n   */\n  private reverseChanges(changes: Partial<S>): Partial<S> {\n    return Object.entries(changes).reduce(\n      (reverseChanges: Partial<S>, bunch: [string, any]) => {\n        const [changeKey, value] = bunch;\n        if (typeof value === typeof true) {\n          (reverseChanges as object)[changeKey] = !value;\n        }\n        return reverseChanges;\n      },\n      {}\n    );\n  }\n\n  /**\n   * Return all the keys in that state and in the store it's bound to, if any.\n   * @returns Set of keys\n   */\n  private getAllKeys(): Set<EntityKey> {\n    const storeKeys = Array.from(this.options?.index?.keys() ?? []);\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\n  }\n\n  /**\n   * Emit 'change' event\n   */\n  private next() {\n    this.change$.next();\n  }\n}\n","import { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime, map, skip } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils, uuid } from '@igo2/utils';\r\nimport {\r\n  EntityKey,\r\n  EntityFilterClause,\r\n  EntitySortClause,\r\n  EntityJoinClause\r\n} from './entity.interfaces';\r\n\r\n/**\r\n * An entity view streams entities from an observable source. These entities\r\n * can be filtered or sorted without affecting the source. A view can also\r\n * combine data from multiple sources, joined together.\r\n */\r\nexport class EntityView<E extends object, V extends object = E> {\r\n  /**\r\n   * Observable stream of values\r\n   */\r\n  readonly values$ = new BehaviorSubject<V[]>([]);\r\n\r\n  /**\r\n   * Subscription to the source (and joined sources) values\r\n   */\r\n  private values$$: Subscription;\r\n\r\n  /**\r\n   * Whether this view has been lifted\r\n   */\r\n  private lifted = false;\r\n\r\n  /**\r\n   * Join clauses\r\n   */\r\n  private joins: EntityJoinClause[] = [];\r\n\r\n  /**\r\n   * Observable of a filter clause\r\n   */\r\n  private filter$ = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Observable of filter clauses\r\n   */\r\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject(\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Filters index\r\n   */\r\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\r\n\r\n  /**\r\n   * Observable of a sort clause\r\n   */\r\n  private sort$ = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Method for indexing\r\n   */\r\n  get getKey(): (V) => EntityKey {\r\n    return this.getKey$.value;\r\n  }\r\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Number of entities\r\n   */\r\n  readonly count$ = new BehaviorSubject<number>(0);\r\n  get count(): number {\r\n    return this.count$.value;\r\n  }\r\n\r\n  /**\r\n   * Whether the store is empty\r\n   */\r\n  readonly empty$ = new BehaviorSubject<boolean>(true);\r\n  get empty(): boolean {\r\n    return this.empty$.value;\r\n  }\r\n\r\n  /**\r\n   * Store index\r\n   */\r\n  get index(): Map<EntityKey, V> {\r\n    return this._index;\r\n  }\r\n  private _index: Map<EntityKey, V>;\r\n\r\n  constructor(private source$: BehaviorSubject<E[]>) {}\r\n\r\n  /**\r\n   * Get a value from the view by key\r\n   * @param key Key\r\n   * @returns Value\r\n   */\r\n  get(key: EntityKey): V {\r\n    if (this._index === undefined) {\r\n      throw new Error(\r\n        'This view has no index, therefore, this method is unavailable.'\r\n      );\r\n    }\r\n    return this.index.get(key);\r\n  }\r\n\r\n  /**\r\n   * Get all the values\r\n   * @returns Array of values\r\n   */\r\n  all(): V[] {\r\n    return this.values$.value;\r\n  }\r\n\r\n  /**\r\n   * Observe all the values\r\n   * @returns Observable of values\r\n   */\r\n  all$(): BehaviorSubject<V[]> {\r\n    return this.values$;\r\n  }\r\n\r\n  /**\r\n   * Get the first value that respects a criteria\r\n   * @returns A value\r\n   */\r\n  firstBy(clause: EntityFilterClause<V>): V {\r\n    return this.values$.value.find(clause);\r\n  }\r\n\r\n  /**\r\n   * Observe the first value that respects a criteria\r\n   * @returns Observable of a value\r\n   */\r\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\r\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\r\n  }\r\n\r\n  /**\r\n   * Get all the values that respect a criteria\r\n   * @returns Array of values\r\n   */\r\n  manyBy(clause: EntityFilterClause<V>): V[] {\r\n    return this.values$.value.filter(clause);\r\n  }\r\n\r\n  /**\r\n   * Observe all the values that respect a criteria\r\n   * @returns Observable of values\r\n   */\r\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\r\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\r\n  }\r\n\r\n  /**\r\n   * Clear the filter and sort and unsubscribe from the source\r\n   */\r\n  clear() {\r\n    this.filter(undefined);\r\n    this.sort(undefined);\r\n  }\r\n\r\n  destroy() {\r\n    if (this.values$$ !== undefined) {\r\n      this.values$$.unsubscribe();\r\n    }\r\n    this.clear();\r\n  }\r\n\r\n  /**\r\n   * Create an index\r\n   * @param getKey Method to get a value's id\r\n   * @returns The view\r\n   */\r\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\r\n    this._index = new Map();\r\n    this.getKey$.next(getKey);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Join another source to the stream (chainable)\r\n   * @param clause Join clause\r\n   * @returns The view\r\n   */\r\n  join(clause: EntityJoinClause): EntityView<E, V> {\r\n    if (this.lifted === true) {\r\n      throw new Error(\r\n        'This view has already been lifted, therefore, no join is allowed.'\r\n      );\r\n    }\r\n    this.joins.push(clause);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Filter values (chainable)\r\n   * @param clause Filter clause\r\n   * @returns The view\r\n   */\r\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\r\n    this.filter$.next(clause);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param clause Filter clause\r\n   * @returns The filter id\r\n   */\r\n  addFilter(clause: EntityFilterClause<V>): string {\r\n    const id = uuid();\r\n    this.filterIndex.set(id, clause);\r\n    this.filters$.next(Array.from(this.filterIndex.values()));\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Remove a filter by id\r\n   * @param clause Filter clause\r\n   */\r\n  removeFilter(id: string) {\r\n    this.filterIndex.delete(id);\r\n    this.filters$.next(Array.from(this.filterIndex.values()));\r\n  }\r\n\r\n  /**\r\n   * Sort values (chainable)\r\n   * @param clauseSort clause\r\n   * @returns The view\r\n   */\r\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\r\n    this.sort$.next(clause);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Create the final observable\r\n   * @returns Observable\r\n   */\r\n  lift() {\r\n    this.lifted = true;\r\n    const source$ =\r\n      this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\r\n    const observables$ = [\r\n      source$,\r\n      this.filters$,\r\n      this.filter$,\r\n      this.sort$,\r\n      this.getKey$\r\n    ];\r\n\r\n    this.values$$ = combineLatest(observables$)\r\n      .pipe(skip(1), debounceTime(5))\r\n      .subscribe((bunch: any[]) => {\r\n        const [_values, filters, filter, sort, getKey] = bunch;\r\n        const values = this.processValues(_values, filters, filter, sort);\r\n        const generateIndex = getKey !== undefined;\r\n        this.setValues(values, generateIndex);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Create the source observable when no joins are defined\r\n   * @returns Observable\r\n   */\r\n  private liftSource(): Observable<V[]> {\r\n    return this.source$ as any as Observable<V[]>;\r\n  }\r\n\r\n  /**\r\n   * Create the source observable when joins are defined\r\n   * @returns Observable\r\n   */\r\n  private liftJoinedSource(): Observable<V[]> {\r\n    const sources$ = [\r\n      this.source$,\r\n      combineLatest(this.joins.map((join: EntityJoinClause) => join.source))\r\n    ];\r\n\r\n    return combineLatest(sources$).pipe(\r\n      map((bunch: [E[], any[]]) => {\r\n        const [entities, joinData] = bunch;\r\n        return entities.reduce((values: V[], entity: E) => {\r\n          const value = this.computeJoinedValue(entity, joinData);\r\n          if (value !== undefined) {\r\n            values.push(value);\r\n          }\r\n          return values;\r\n        }, []);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Apply joins to a source's entity and return the final value\r\n   * @returns Final value\r\n   */\r\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\r\n    let value = entity as Partial<V>;\r\n    let joinIndex = 0;\r\n    while (value !== undefined && joinIndex < this.joins.length) {\r\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\r\n      joinIndex += 1;\r\n    }\r\n    return value as V;\r\n  }\r\n\r\n  /**\r\n   * Filter and sort values before streaming them\r\n   * @param values Values\r\n   * @param filters Filter clauses\r\n   * @param filter Filter clause\r\n   * @param sort Sort clause\r\n   * @returns Filtered and sorted values\r\n   */\r\n  private processValues(\r\n    values: V[],\r\n    filters: EntityFilterClause[],\r\n    filter: EntityFilterClause,\r\n    sort: EntitySortClause\r\n  ): V[] {\r\n    values = values.slice(0);\r\n    values = this.filterValues(values, filters.concat([filter]));\r\n    values = this.sortValues(values, sort);\r\n    return values;\r\n  }\r\n\r\n  /**\r\n   * Filter values\r\n   * @param values Values\r\n   * @param filters Filter clauses\r\n   * @returns Filtered values\r\n   */\r\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\r\n    if (clauses.length === 0) {\r\n      return values;\r\n    }\r\n\r\n    return values.filter((value: V) => {\r\n      return clauses\r\n        .filter((clause: EntityFilterClause) => clause !== undefined)\r\n        .every((clause: EntityFilterClause) => clause(value));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sort values\r\n   * @param values Values\r\n   * @param sort Sort clause\r\n   * @returns Sorted values\r\n   */\r\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\r\n    if (clause === undefined) {\r\n      return values;\r\n    }\r\n    return values.sort((v1: V, v2: V) => {\r\n      return ObjectUtils.naturalCompare(\r\n        clause.valueAccessor(v1),\r\n        clause.valueAccessor(v2),\r\n        clause.direction,\r\n        clause.nullsFirst\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set value and optionally generate an index\r\n   * @param values Values\r\n   * @param generateIndex boolean\r\n   */\r\n  private setValues(values: V[], generateIndex: boolean) {\r\n    if (generateIndex === true) {\r\n      this._index = this.generateIndex(values);\r\n    }\r\n\r\n    this.values$.next(values);\r\n\r\n    const count = values.length;\r\n    const empty = count === 0;\r\n    this.count$.next(count);\r\n    this.empty$.next(empty);\r\n  }\r\n\r\n  /**\r\n   * Generate a complete index of all the values\r\n   * @param entities Entities\r\n   * @returns Index\r\n   */\r\n  private generateIndex(values: V[]): Map<EntityKey, V> {\r\n    const entries = values.map((value: V) => [this.getKey(value), value]);\r\n    return new Map(entries as [EntityKey, V][]);\r\n  }\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStateManager } from './state';\r\nimport { EntityView } from './view';\r\nimport { EntityKey, EntityState, EntityRecord } from './entity.interfaces';\r\nimport { getEntityId, getEntityProperty } from './entity.utils';\r\n\r\nexport interface EntityStoreOptions {\r\n  getKey?: (entity: object) => EntityKey;\r\n  getProperty?: (entity: object, property: string) => any;\r\n}\r\n\r\n/**\r\n * An entity store class holds any number of entities\r\n * as well as their state. It can be observed, filtered and sorted and\r\n * provides methods to insert, update or delete entities.\r\n */\r\nexport class EntityStore<\r\n  E extends object = object,\r\n  S extends EntityState = EntityState\r\n> {\r\n  /**\r\n   * Observable of the raw entities\r\n   */\r\n  readonly entities$ = new BehaviorSubject<E[]>([]);\r\n\r\n  /**\r\n   * Number of entities\r\n   */\r\n  readonly count$ = new BehaviorSubject<number>(0);\r\n  get count(): number {\r\n    return this.count$.value;\r\n  }\r\n\r\n  /**\r\n   * Whether the store is empty\r\n   */\r\n  readonly empty$ = new BehaviorSubject<boolean>(true);\r\n  get empty(): boolean {\r\n    return this.empty$.value;\r\n  }\r\n\r\n  /**\r\n   * Entity store state\r\n   */\r\n  readonly state: EntityStateManager<E, S>;\r\n\r\n  /**\r\n   * View of all the entities\r\n   */\r\n  readonly view: EntityView<E>;\r\n\r\n  /**\r\n   * View of all the entities and their state\r\n   */\r\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\r\n\r\n  /**\r\n   * Method to get an entity's id\r\n   */\r\n  readonly getKey: (E) => EntityKey;\r\n\r\n  /**\r\n   * Method to get an entity's named property\r\n   */\r\n  readonly getProperty: (E, prop: string) => any;\r\n\r\n  /**\r\n   * Store index\r\n   */\r\n  get index(): Map<EntityKey, E> {\r\n    return this._index;\r\n  }\r\n  private _index: Map<EntityKey, E>;\r\n\r\n  /**\r\n   * Store index\r\n   */\r\n  get pristine(): boolean {\r\n    return this._pristine;\r\n  }\r\n  private _pristine: boolean = true;\r\n\r\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\r\n    this.getKey = options.getKey ? options.getKey : getEntityId;\r\n    this.getProperty = options.getProperty\r\n      ? options.getProperty\r\n      : getEntityProperty;\r\n\r\n    this.state = this.createStateManager();\r\n    this.view = this.createDataView();\r\n    this.stateView = this.createStateView();\r\n\r\n    this.view.lift();\r\n    this.stateView.lift();\r\n\r\n    if (entities.length > 0) {\r\n      this.load(entities);\r\n    } else {\r\n      this._index = this.generateIndex(entities);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get an entity from the store by key\r\n   * @param key Key\r\n   * @returns Entity\r\n   */\r\n  get(key: EntityKey): E {\r\n    return this.index.get(key);\r\n  }\r\n\r\n  /**\r\n   * Get all entities in the store\r\n   * @returns Array of entities\r\n   */\r\n  all(): E[] {\r\n    return this.entities$.value;\r\n  }\r\n\r\n  /**\r\n   * Set this store's entities\r\n   * @param entities Entities\r\n   */\r\n  load(entities: E[], pristine: boolean = true) {\r\n    this._index = this.generateIndex(entities);\r\n    this._pristine = pristine;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Clear the store's entities but keep the state and views intact.\r\n   * Views won't return any data but future data will be subject to the\r\n   * current views filter and sort\r\n   */\r\n  softClear() {\r\n    if (this.index && this.index.size > 0) {\r\n      this.index.clear();\r\n      this._pristine = true;\r\n      this.next();\r\n    } else if (this.index) {\r\n      this.updateCount();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the store's entities, state and views\r\n   */\r\n  clear() {\r\n    this.stateView.clear();\r\n    this.view.clear();\r\n    this.state.clear();\r\n    this.softClear();\r\n  }\r\n\r\n  destroy() {\r\n    this.stateView.destroy();\r\n    this.view.destroy();\r\n    this.clear();\r\n  }\r\n\r\n  /**\r\n   * Insert an entity into the store\r\n   * @param entity Entity\r\n   */\r\n  insert(entity: E) {\r\n    this.insertMany([entity]);\r\n  }\r\n\r\n  /**\r\n   * Insert many entities into the store\r\n   * @param entities Entities\r\n   */\r\n  insertMany(entities: E[]) {\r\n    entities.forEach((entity: E) =>\r\n      this.index.set(this.getKey(entity), entity)\r\n    );\r\n    this._pristine = false;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Update or insert an entity into the store\r\n   * @param entity Entity\r\n   */\r\n  update(entity: E) {\r\n    this.updateMany([entity]);\r\n  }\r\n\r\n  /**\r\n   * Update or insert many entities into the store\r\n   * @param entities Entities\r\n   */\r\n  updateMany(entities: E[]) {\r\n    entities.forEach((entity: E) =>\r\n      this.index.set(this.getKey(entity), entity)\r\n    );\r\n    this._pristine = false;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Delete an entity from the store\r\n   * @param entity Entity\r\n   */\r\n  delete(entity: E) {\r\n    this.deleteMany([entity]);\r\n  }\r\n\r\n  /**\r\n   * Delete many entities from the store\r\n   * @param entities Entities\r\n   */\r\n  deleteMany(entities: E[]) {\r\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\r\n    this._pristine = false;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Generate a complete index of all the entities\r\n   * @param entities Entities\r\n   * @returns Index\r\n   */\r\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\r\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\r\n    return new Map(entries as [EntityKey, E][]);\r\n  }\r\n\r\n  /**\r\n   * Push the index's entities into the entities$ observable\r\n   */\r\n  private next() {\r\n    this.entities$.next(Array.from(this.index.values()));\r\n    this.updateCount();\r\n  }\r\n\r\n  /**\r\n   * Update the store's count and empty\r\n   */\r\n  private updateCount() {\r\n    const count = this.index.size;\r\n    const empty = count === 0;\r\n    this.count$.next(count);\r\n    this.empty$.next(empty);\r\n  }\r\n\r\n  /**\r\n   * Create the entity state manager\r\n   * @returns EntityStateManager\r\n   */\r\n  private createStateManager() {\r\n    return new EntityStateManager<E, S>({\r\n      getKey: this.getKey,\r\n      index: this.index\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create the data view\r\n   * @returns EntityView<E>\r\n   */\r\n  private createDataView() {\r\n    return new EntityView<E>(this.entities$);\r\n  }\r\n\r\n  /**\r\n   * Create the state view\r\n   * @returns EntityView<EntityRecord<E>>\r\n   */\r\n  private createStateView() {\r\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\r\n      .join({\r\n        source: this.state.change$,\r\n        reduce: (entity: E): EntityRecord<E, S> => {\r\n          const key = this.getKey(entity);\r\n          const state = this.state.get(entity);\r\n          const currentRecord = this.stateView.get(key);\r\n\r\n          if (\r\n            currentRecord !== undefined &&\r\n            currentRecord.entity === entity &&\r\n            this.statesAreTheSame(currentRecord.state, state)\r\n          ) {\r\n            return currentRecord;\r\n          }\r\n\r\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\r\n          const ref = `${key}-${revision}`;\r\n          return { entity, state, revision, ref };\r\n        }\r\n      })\r\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\r\n  }\r\n\r\n  private statesAreTheSame(currentState: S, newState: S): boolean {\r\n    if (currentState === newState) {\r\n      return true;\r\n    }\r\n\r\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\r\n    const newStateIsEmpty = Object.keys(newState).length === 0;\r\n    return currentStateIsEmpty && newStateIsEmpty;\r\n  }\r\n}\r\n","import { EntityState } from './entity.interfaces';\r\nimport { EntityStoreStrategy } from './strategies/strategy';\r\nimport { EntityStore, EntityStoreOptions } from './store';\r\n\r\nexport class EntityStoreWithStrategy<\r\n  E extends object = object,\r\n  S extends EntityState = EntityState\r\n> extends EntityStore<E, S> {\r\n  /**\r\n   * Strategies\r\n   */\r\n  private strategies: EntityStoreStrategy[] = [];\r\n\r\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\r\n    super(entities, options);\r\n  }\r\n\r\n  /**\r\n   * Add a strategy to this store\r\n   * @param strategy Entity store strategy\r\n   * @returns Entity store\r\n   */\r\n  addStrategy(\r\n    strategy: EntityStoreStrategy,\r\n    activate: boolean = false\r\n  ): EntityStore {\r\n    const existingStrategy = this.strategies.find(\r\n      (_strategy: EntityStoreStrategy) => {\r\n        return strategy.constructor === _strategy.constructor;\r\n      }\r\n    );\r\n    if (existingStrategy !== undefined) {\r\n      throw new Error(\r\n        'A strategy of this type already exists on that EntityStore.'\r\n      );\r\n    }\r\n\r\n    this.strategies.push(strategy);\r\n    strategy.bindStore(this);\r\n\r\n    if (activate === true) {\r\n      strategy.activate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove a strategy from this store\r\n   * @param strategy Entity store strategy\r\n   * @returns Entity store\r\n   */\r\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\r\n    const index = this.strategies.indexOf(strategy);\r\n    if (index >= 0) {\r\n      this.strategies.splice(index, 1);\r\n      strategy.unbindStore(this);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Return strategies of a given type\r\n   * @param type Entity store strategy class\r\n   * @returns Strategies\r\n   */\r\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\r\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\r\n      return strategy instanceof type;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate strategies of a given type\r\n   * @param type Entity store strategy class\r\n   */\r\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\r\n    const strategy = this.getStrategyOfType(type);\r\n    if (strategy !== undefined) {\r\n      strategy.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate strategies of a given type\r\n   * @param type Entity store strategy class\r\n   */\r\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\r\n    const strategy = this.getStrategyOfType(type);\r\n    if (strategy !== undefined) {\r\n      strategy.deactivate();\r\n    }\r\n  }\r\n}\r\n","import { ChangeDetectorRef } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { skip } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { EntityKey } from './entity.interfaces';\r\n\r\nimport { EntityStore } from './store';\r\n\r\n/**\r\n * This class is used to synchronize a component's changes\r\n * detection with an EntityStore changes. For example, it is frequent\r\n * to have a component subscribe to a store's selected entity and, at the same time,\r\n * this component provides a way to select an entity with, let's say, a click.\r\n *\r\n * This class automatically handles those case and triggers the compoent's\r\n * change detection when needed.\r\n *\r\n * Note: If the component observes the store's stateView, a workspace is\r\n * probably not required because the stateView catches any changes to the\r\n * entities and their state.\r\n */\r\nexport class EntityStoreWatcher<E extends object> {\r\n  /**\r\n   * Component change detector\r\n   */\r\n  private cdRef: ChangeDetectorRef;\r\n\r\n  /**\r\n   * Entity store\r\n   */\r\n  private store: EntityStore<E>;\r\n\r\n  /**\r\n   * Component inner state\r\n   */\r\n  private innerStateIndex = new Map<EntityKey, { [key: string]: any }>();\r\n\r\n  /**\r\n   * Subscription to the store's entities\r\n   */\r\n  private entities$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the store's state\r\n   */\r\n  private state$$: Subscription;\r\n\r\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\r\n    this.setChangeDetector(cdRef);\r\n    this.setStore(store);\r\n  }\r\n\r\n  destroy() {\r\n    this.setChangeDetector(undefined);\r\n    this.setStore(undefined);\r\n  }\r\n\r\n  /**\r\n   * Bind this workspace to a store and start watching for changes\r\n   * @param store Entity store\r\n   */\r\n  setStore(store?: EntityStore<E>) {\r\n    if (store === undefined) {\r\n      this.teardownObservers();\r\n      this.innerStateIndex.clear();\r\n      this.store = undefined;\r\n      return;\r\n    }\r\n\r\n    this.setStore(undefined);\r\n    this.store = store;\r\n    this.setupObservers();\r\n    this.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * Bind this workspace to a component's change detector\r\n   * @param cdRef Change detector\r\n   */\r\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\r\n    this.cdRef = cdRef;\r\n  }\r\n\r\n  /**\r\n   * Set up observers on a store's entities and their state\r\n   * @param store Entity store\r\n   */\r\n  private setupObservers() {\r\n    this.teardownObservers();\r\n\r\n    this.entities$$ = this.store.entities$.subscribe((entities: E[]) =>\r\n      this.onEntitiesChange(entities)\r\n    );\r\n\r\n    this.state$$ = this.store.state.change$\r\n      .pipe(skip(1))\r\n      .subscribe(() => this.onStateChange());\r\n  }\r\n\r\n  /**\r\n   * Teardown store observers\r\n   */\r\n  private teardownObservers() {\r\n    if (this.entities$$ !== undefined) {\r\n      this.entities$$.unsubscribe();\r\n    }\r\n    if (this.state$$ !== undefined) {\r\n      this.state$$.unsubscribe();\r\n    }\r\n    this.entities$$ = undefined;\r\n    this.state$$ = undefined;\r\n  }\r\n\r\n  /**\r\n   * When the entities change, always trigger the changes detection\r\n   */\r\n  private onEntitiesChange(entities: E[]) {\r\n    this.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * When the entities state change, trigger the change detection\r\n   * only if the component has not handled these changes yet. For example,\r\n   * the component might have initiated thoses changes itself.\r\n   */\r\n  private onStateChange() {\r\n    let changesDetected = false;\r\n    const storeIndex = this.store.state.index;\r\n    const innerIndex = this.innerStateIndex;\r\n\r\n    if (storeIndex.size !== innerIndex.size) {\r\n      changesDetected = this.detectChanges();\r\n    }\r\n\r\n    const storeKeys = Array.from(storeIndex.keys());\r\n    for (const key of storeKeys) {\r\n      const storeValue = storeIndex.get(key);\r\n      const innerValue = innerIndex.get(key);\r\n      if (changesDetected === false) {\r\n        if (innerValue === undefined) {\r\n          changesDetected = this.detectChanges();\r\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\r\n          changesDetected = this.detectChanges();\r\n        }\r\n      }\r\n\r\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trigger the change detection of the workspace is bound to a change detector\r\n   */\r\n  private detectChanges() {\r\n    if (this.cdRef !== undefined) {\r\n      this.cdRef.detectChanges();\r\n    }\r\n    return true;\r\n  }\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\r\nimport { EntityStore } from '../store';\r\n\r\n/**\r\n * Entity store strategies. They can do pretty much anything during a store's\r\n * lifetime. For example, they may act as triggers when something happens.\r\n * Sharing a strategy is a good idea when multiple strategies would have\r\n * on cancelling effect on each other.\r\n *\r\n * At creation, strategy is inactive and needs to be manually activated.\r\n */\r\nexport class EntityStoreStrategy {\r\n  /**\r\n   * Feature store\r\n   * @internal\r\n   */\r\n  protected stores: EntityStore[] = [];\r\n\r\n  /**\r\n   * Whether this strategy is active\r\n   * @internal\r\n   */\r\n  get active(): boolean {\r\n    return this.active$.value;\r\n  }\r\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\r\n    this.options = options;\r\n  }\r\n\r\n  /**\r\n   * Activate the strategy. If it's already active, it'll be deactivated\r\n   * and activated again.\r\n   */\r\n  activate() {\r\n    if (this.active === true) {\r\n      this.doDeactivate();\r\n    }\r\n    this.active$.next(true);\r\n    this.doActivate();\r\n  }\r\n\r\n  /**\r\n   * Activate the strategy. If it's already active, it'll be deactivated\r\n   * and activated again.\r\n   */\r\n  deactivate() {\r\n    this.active$.next(false);\r\n    this.doDeactivate();\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: EntityStore) {\r\n    if (this.stores.indexOf(store) < 0) {\r\n      this.stores.push(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from store\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: EntityStore) {\r\n    const index = this.stores.indexOf(store);\r\n    if (index >= 0) {\r\n      this.stores.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Do the stataegy activation\r\n   * @internal\r\n   */\r\n  protected doActivate() {}\r\n\r\n  /**\r\n   * Do the strategy deactivation\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {}\r\n}\r\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\r\nimport { EntityStore } from '../store';\r\nimport { EntityStoreStrategy } from './strategy';\r\n\r\n/**\r\n * When active, this strategy filters a store's stateView to return\r\n * selected entities only.\r\n */\r\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\r\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Store / filter ids map\r\n   */\r\n  private filters: Map<EntityStore, string> = new Map();\r\n\r\n  /**\r\n   * Bind this strategy to a store and start filtering it\r\n   * @param store Entity store\r\n   */\r\n  bindStore(store: EntityStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.filterStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop filtering it\r\n   * @param store Entity store\r\n   */\r\n  unbindStore(store: EntityStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unfilterStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start filtering all stores\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.filterAll();\r\n  }\r\n\r\n  /**\r\n   * Stop filtering all stores\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unfilterAll();\r\n  }\r\n\r\n  /**\r\n   * Filter all stores\r\n   */\r\n  private filterAll() {\r\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\r\n  }\r\n\r\n  /**\r\n   * Unfilter all stores\r\n   */\r\n  private unfilterAll() {\r\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\r\n  }\r\n\r\n  /**\r\n   * Filter a store and add it to the filters map\r\n   */\r\n  private filterStore(store: EntityStore) {\r\n    this.filters.set(\r\n      store,\r\n      store.stateView.addFilter(this.options.filterClauseFunc)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unfilter a store and delete it from the filters map\r\n   */\r\n  private unfilterStore(store: EntityStore) {\r\n    const filterId = this.filters.get(store);\r\n    if (filterId === undefined) {\r\n      return;\r\n    }\r\n\r\n    store.stateView.removeFilter(filterId);\r\n    this.filters.delete(store);\r\n  }\r\n}\r\n","import { EntityRecord } from '../entity.interfaces';\r\nimport { EntityStore } from '../store';\r\nimport { EntityStoreStrategy } from './strategy';\r\n\r\n/**\r\n * When active, this strategy filters a store's stateView to return\r\n * selected entities only.\r\n */\r\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Store / filter ids map\r\n   */\r\n  private filters: Map<EntityStore, string> = new Map();\r\n\r\n  /**\r\n   * Bind this strategy to a store and start filtering it\r\n   * @param store Entity store\r\n   */\r\n  bindStore(store: EntityStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.filterStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop filtering it\r\n   * @param store Entity store\r\n   */\r\n  unbindStore(store: EntityStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unfilterStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start filtering all stores\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.filterAll();\r\n  }\r\n\r\n  /**\r\n   * Stop filtering all stores\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unfilterAll();\r\n  }\r\n\r\n  /**\r\n   * Filter all stores\r\n   */\r\n  private filterAll() {\r\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\r\n  }\r\n\r\n  /**\r\n   * Unfilter all stores\r\n   */\r\n  private unfilterAll() {\r\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\r\n  }\r\n\r\n  /**\r\n   * Filter a store and add it to the filters map\r\n   */\r\n  private filterStore(store: EntityStore) {\r\n    if (this.filters.has(store)) {\r\n      return;\r\n    }\r\n\r\n    const filter = (record: EntityRecord<object>) => {\r\n      return record.state.selected === true;\r\n    };\r\n    this.filters.set(store, store.stateView.addFilter(filter));\r\n  }\r\n\r\n  /**\r\n   * Unfilter a store and delete it from the filters map\r\n   */\r\n  private unfilterStore(store: EntityStore) {\r\n    const filterId = this.filters.get(store);\r\n    if (filterId === undefined) {\r\n      return;\r\n    }\r\n\r\n    store.stateView.removeFilter(filterId);\r\n    this.filters.delete(store);\r\n  }\r\n}\r\n","<mat-form-field class=\"igo-entity-selector\" subscriptSizing=\"dynamic\">\r\n  <mat-select\r\n    [disabled]=\"disabled\"\r\n    [value]=\"selected$ | async\"\r\n    [multiple]=\"multi\"\r\n    [placeholder]=\"placeholder\"\r\n    (selectionChange)=\"onSelectionChange($event)\"\r\n  >\r\n    <mat-option\r\n      *ngIf=\"emptyText !== undefined && multi === false\"\r\n      [value]=\"emptyValue\"\r\n      >{{ emptyText }}</mat-option\r\n    >\r\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{\r\n      multiText$ | async\r\n    }}</mat-option>\r\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\r\n      <mat-option [value]=\"record.entity\">\r\n        {{ titleAccessor(record.entity) }}\r\n      </mat-option>\r\n    </ng-template>\r\n  </mat-select>\r\n</mat-form-field>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { EntityRecord } from '../shared/entity.interfaces';\r\nimport { EntityStore } from '../shared/store';\r\nimport { EntityStoreWatcher } from '../shared/watcher';\r\nimport { getEntityTitle } from '../shared/entity.utils';\r\n\r\n@Component({\r\n  selector: 'igo-entity-selector',\r\n  templateUrl: './entity-selector.component.html',\r\n  styleUrls: ['./entity-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * The selected entity\r\n   * @internal\r\n   */\r\n  readonly selected$ = new BehaviorSubject<object>(undefined);\r\n\r\n  /**\r\n   * The current multi select option text\r\n   * @internal\r\n   */\r\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\r\n\r\n  readonly multiSelectValue = { id: 'IGO_MULTI_SELECT' };\r\n\r\n  readonly emptyValue = { id: 'IGO_EMPTY_SELECT' };\r\n\r\n  /**\r\n   * Subscription to the selected entity\r\n   */\r\n  private selected$$: Subscription;\r\n\r\n  /**\r\n   * Store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<object>;\r\n\r\n  /**\r\n   * Entity store\r\n   */\r\n  @Input() store: EntityStore<object>;\r\n\r\n  /**\r\n   * Title accessor\r\n   */\r\n  @Input() titleAccessor: (object) => string = getEntityTitle;\r\n\r\n  /**\r\n   * Text to display when nothing is selected\r\n   */\r\n  @Input() emptyText: string = undefined;\r\n\r\n  /**\r\n   * Wheter selecting many entities is allowed\r\n   */\r\n  @Input() multi: boolean = false;\r\n\r\n  /**\r\n   * Text to display for the select all option\r\n   */\r\n  @Input() multiAllText: string = 'All';\r\n\r\n  /**\r\n   * Text to display for the select none option\r\n   */\r\n  @Input() multiNoneText: string = 'None';\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Wheter the selector is disabled or not\r\n   */\r\n  @Input() disabled: boolean = false;\r\n\r\n  /**\r\n   * Event emitted when the selection changes\r\n   */\r\n  @Output() selectedChange = new EventEmitter<{\r\n    selected: boolean;\r\n    value: object | object[];\r\n  }>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Create a store watcher and subscribe to the selected entity\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n\r\n    this.selected$$ = this.store.stateView\r\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\r\n      .subscribe((records: EntityRecord<object>[]) => {\r\n        const entities = records.map(\r\n          (record: EntityRecord<object>) => record.entity\r\n        );\r\n        this.onSelectFromStore(entities);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the selected entity and destroy the store watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n    this.selected$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * On selection change, update the store's state and emit an event\r\n   * @internal\r\n   */\r\n  onSelectionChange(event: { value: object | undefined }) {\r\n    const values = event.value instanceof Array ? event.value : [event.value];\r\n\r\n    const multiSelect = values.find(\r\n      (_value: object) => _value === this.multiSelectValue\r\n    );\r\n    let entities = values.filter(\r\n      (_value: object) => _value !== this.multiSelectValue\r\n    );\r\n    if (multiSelect !== undefined) {\r\n      if (entities.length === this.store.count) {\r\n        entities = [];\r\n      } else if (entities.length < this.store.count) {\r\n        entities = this.store.all();\r\n      }\r\n    }\r\n\r\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\r\n    if (entities.length === 0) {\r\n      this.store.state.updateAll({ selected: false });\r\n    } else {\r\n      this.store.state.updateMany(entities, { selected: true }, true);\r\n    }\r\n\r\n    const value = this.multi ? entities : event.value;\r\n    this.selectedChange.emit({ selected: true, value });\r\n  }\r\n\r\n  private onSelectFromStore(entities: object[]) {\r\n    if (this.multi === true) {\r\n      this.selected$.next(entities);\r\n    } else {\r\n      const entity = entities.length > 0 ? entities[0] : undefined;\r\n      this.selected$.next(entity);\r\n    }\r\n\r\n    this.updateMultiToggleWithEntities(entities);\r\n  }\r\n\r\n  private updateMultiToggleWithEntities(entities: object[]) {\r\n    if (\r\n      entities.length === this.store.count &&\r\n      this.multiText$.value !== this.multiNoneText\r\n    ) {\r\n      this.multiText$.next(this.multiNoneText);\r\n    } else if (\r\n      entities.length < this.store.count &&\r\n      this.multiText$.value !== this.multiAllText\r\n    ) {\r\n      this.multiText$.next(this.multiAllText);\r\n    }\r\n  }\r\n}\r\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopPropagation]'\n})\nexport class StopPropagationDirective {\n  @HostListener('click', ['$event'])\n  public onClick(event: any): void {\n    event.stopPropagation();\n  }\n}\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnChanges,\r\n  ViewChild,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { EntityStore } from '../shared';\r\nimport { MatPaginator, PageEvent } from '@angular/material/paginator';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\r\n\r\n@Component({\r\n  selector: 'igo-entity-table-paginator',\r\n  templateUrl: './entity-table-paginator.component.html',\r\n  styleUrls: ['./entity-table-paginator.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\r\n  public disabled: boolean = false;\r\n  public hidePageSize: boolean = false;\r\n  public pageIndex: number = 0;\r\n  public pageSize: number = 50;\r\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\r\n  public showFirstLastButtons: boolean = true;\r\n  private count$$: Subscription;\r\n  private entitySortChange$$: Subscription;\r\n  private paginationLabelTranslation$$: Subscription[] = [];\r\n\r\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n  /**\r\n   * Entity store\r\n   */\r\n  @Input() store: EntityStore<object>;\r\n\r\n  /**\r\n   * Paginator options\r\n   */\r\n  @Input()\r\n  paginatorOptions: EntityTablePaginatorOptions;\r\n\r\n  /**\r\n   * Event emitted when the paginator changes the page size or page index.\r\n   */\r\n  @Output() page: EventEmitter<PageEvent>;\r\n\r\n  public length: number = 0;\r\n\r\n  /**\r\n   * Paginator emitted.\r\n   */\r\n  @Output() paginatorChange: EventEmitter<MatPaginator> =\r\n    new EventEmitter<MatPaginator>();\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\r\n\r\n  ngOnChanges() {\r\n    this.unsubscribeAll();\r\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\r\n      this.length = count;\r\n      this.emitPaginator();\r\n    });\r\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\r\n      if (this.paginator) {\r\n        this.paginator.firstPage();\r\n      }\r\n    });\r\n    this.initPaginatorOptions();\r\n    this.translateLabels();\r\n  }\r\n\r\n  initPaginatorOptions() {\r\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\r\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\r\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\r\n    this.pageSizeOptions =\r\n      this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\r\n    if (this.mediaService.isMobile()) {\r\n      this.showFirstLastButtons = false;\r\n      this.hidePageSize = true;\r\n    } else {\r\n      this.showFirstLastButtons =\r\n        this.paginatorOptions?.showFirstLastButtons ||\r\n        this.showFirstLastButtons;\r\n      this.hidePageSize =\r\n        this.paginatorOptions?.hidePageSize || this.hidePageSize;\r\n    }\r\n  }\r\n\r\n  translateLabels() {\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.firstPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.firstPageLabel = label;\r\n        })\r\n    );\r\n\r\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\r\n\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.itemsPerPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.itemsPerPageLabel = label;\r\n        })\r\n    );\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.lastPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.lastPageLabel = label;\r\n        })\r\n    );\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.nextPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.nextPageLabel = label;\r\n        })\r\n    );\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.previousPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.previousPageLabel = label;\r\n        })\r\n    );\r\n  }\r\n\r\n  rangeLabel = (page: number, pageSize: number, length: number) => {\r\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.of')\r\n        .subscribe((label: string) => {\r\n          of.next(label);\r\n        })\r\n    );\r\n    if (length === 0 || pageSize === 0) {\r\n      return `0 ${of.value} ${length}`;\r\n    }\r\n    length = Math.max(length, 0);\r\n    const startIndex = page * pageSize;\r\n    const endIndex =\r\n      startIndex < length\r\n        ? Math.min(startIndex + pageSize, length)\r\n        : startIndex + pageSize;\r\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\r\n  };\r\n\r\n  private unsubscribeAll() {\r\n    this.paginationLabelTranslation$$.map((sub) => sub.unsubscribe());\r\n    if (this.count$$) {\r\n      this.count$$.unsubscribe();\r\n    }\r\n    if (this.entitySortChange$$) {\r\n      this.entitySortChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.unsubscribeAll();\r\n  }\r\n\r\n  emitPaginator() {\r\n    this.paginatorChange.emit(this.paginator);\r\n  }\r\n}\r\n","<mat-paginator\r\n  [disabled]=\"disabled\"\r\n  [hidePageSize]=\"hidePageSize\"\r\n  [length]=\"length\"\r\n  [pageIndex]=\"pageIndex\"\r\n  [pageSize]=\"pageSize\"\r\n  [pageSizeOptions]=\"pageSizeOptions\"\r\n  [showFirstLastButtons]=\"showFirstLastButtons\"\r\n  (page)=\"emitPaginator()\"\r\n>\r\n</mat-paginator>\r\n","import { Directive, HostListener, Input, ElementRef } from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoImageError]'\r\n})\r\nexport class ImageErrorDirective {\r\n  @Input() errorImageUrl: string = './assets/igo2/common/images/na.png';\r\n  @Input() hideError: boolean = false;\r\n\r\n  constructor(private el: ElementRef) {}\r\n\r\n  @HostListener('error', ['$event'])\r\n  public onError(event: any): void {\r\n    if (this.hideError) {\r\n      this.el.nativeElement.style.display = 'none';\r\n    } else {\r\n      event.target.src = this.errorImageUrl;\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  ElementRef,\r\n  Renderer2,\r\n  EventEmitter,\r\n  Output,\r\n  HostListener\r\n} from '@angular/core';\r\n\r\nimport scrollIntoView from 'scroll-into-view-if-needed';\r\n\r\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\r\n\r\n/**\r\n * Directive that handles an entity table row click and selection.\r\n */\r\n@Directive({\r\n  selector: '[igoEntityTableRow]'\r\n})\r\nexport class EntityTableRowDirective {\r\n  /**\r\n   * Class added to a selected row\r\n   */\r\n  static selectedCls = 'igo-entity-table-row-selected';\r\n\r\n  /**\r\n   * Class added to a highlighted row\r\n   */\r\n  static highlightedCls = 'igo-entity-table-row-highlighted';\r\n\r\n  /**\r\n   * Whether a row supports selection\r\n   */\r\n  @Input() selection = false;\r\n\r\n  /**\r\n   * Whether clicking a row should select it (if selection is true)\r\n   */\r\n  @Input() selectOnClick: boolean = true;\r\n\r\n  /**\r\n   * Whether the selected row should be highlighted\r\n   */\r\n  @Input() highlightSelection: boolean = true;\r\n\r\n  /**\r\n   * Whether a row is selected\r\n   */\r\n  @Input()\r\n  set selected(value: boolean) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n    if (value === this._selected) {\r\n      return;\r\n    }\r\n\r\n    this.toggleSelected(value);\r\n    this.scroll();\r\n  }\r\n  get selected(): boolean {\r\n    return this._selected;\r\n  }\r\n  private _selected = false;\r\n\r\n  /**\r\n   * Scroll behavior on selection\r\n   */\r\n  @Input()\r\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\r\n\r\n  /**\r\n   * Event emitted when a row is selected\r\n   */\r\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\r\n\r\n  /**\r\n   * When a row is clicked, select it if it's supported\r\n   * @ignore\r\n   */\r\n  @HostListener('click')\r\n  onClick() {\r\n    if (this.selection === false || this.selectOnClick === false) {\r\n      return;\r\n    }\r\n\r\n    this.toggleSelected(true);\r\n    this.select.emit(this);\r\n  }\r\n\r\n  constructor(\r\n    private renderer: Renderer2,\r\n    private el: ElementRef\r\n  ) {}\r\n\r\n  /**\r\n   * Select a row and add or remove the selected class from it\r\n   * @param selected Whether the row should be selected\r\n   */\r\n  private toggleSelected(selected: boolean) {\r\n    this._selected = selected;\r\n    if (selected === true) {\r\n      this.addCls(EntityTableRowDirective.selectedCls);\r\n      if (this.highlightSelection === true) {\r\n        this.addCls(EntityTableRowDirective.highlightedCls);\r\n      }\r\n    } else {\r\n      this.removeCls(EntityTableRowDirective.selectedCls);\r\n      this.removeCls(EntityTableRowDirective.highlightedCls);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Scroll to the selected row\r\n   */\r\n  private scroll() {\r\n    if (this._selected === true) {\r\n      scrollIntoView(this.el.nativeElement, {\r\n        scrollMode: 'if-needed',\r\n        behavior: 'smooth',\r\n        block: 'end',\r\n        inline: 'nearest'\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the selected CSS class\r\n   */\r\n  private addCls(cls: string) {\r\n    this.renderer.addClass(this.el.nativeElement, cls);\r\n  }\r\n\r\n  /**\r\n   * Remove the selected CSS class\r\n   */\r\n  private removeCls(cls: string) {\r\n    this.renderer.removeClass(this.el.nativeElement, cls);\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\r\n\r\n@Pipe({ name: 'sanitizeHtml' })\r\nexport class SanitizeHtmlPipe implements PipeTransform {\r\n  constructor(private _sanitizer: DomSanitizer) {}\r\n  transform(v: string): SafeHtml {\r\n    return this._sanitizer.bypassSecurityTrustHtml(v);\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\n\r\nimport { Cacheable } from 'ts-cacheable';\r\nimport { Observable } from 'rxjs';\r\nimport { catchError, switchMap } from 'rxjs/operators';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\n@Pipe({\r\n  name: 'secureImage'\r\n})\r\nexport class SecureImagePipe implements PipeTransform {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private configService?: ConfigService\r\n  ) {}\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  transform(url: string): Observable<string> {\r\n    const headers = new HttpHeaders({\r\n      'Content-Type': 'text/plain',\r\n      activityInterceptor: 'false',\r\n      interceptError: 'false'\r\n    });\r\n\r\n    const regexDepot = new RegExp(\r\n      this.configService?.getConfig('depot.url') + '.*?(?=\"|$)'\r\n    );\r\n    if (regexDepot.test(url)) {\r\n      url = url.match(regexDepot)[0];\r\n    }\r\n\r\n    return this.http\r\n      .get(url, {\r\n        headers,\r\n        responseType: 'blob'\r\n      })\r\n      .pipe(\r\n        catchError((err) => {\r\n          err.error.caught = true;\r\n          err.error.toDisplay = false;\r\n          throw err;\r\n        }),\r\n        switchMap((blob) => {\r\n          return new Observable((observer) => {\r\n            const reader = new FileReader();\r\n            reader.readAsDataURL(blob);\r\n            reader.onloadend = () => {\r\n              observer.next(reader.result);\r\n              observer.complete();\r\n            };\r\n          });\r\n        })\r\n      ) as Observable<string>;\r\n  }\r\n}\r\n","<div class=\"table-container\" [ngStyle]=\"{ height: tableHeight }\">\r\n  <table\r\n    id=\"currentWorkspaceTable\"\r\n    mat-table\r\n    matSort\r\n    [ngClass]=\"getTableClass()\"\r\n    [dataSource]=\"dataSource\"\r\n    [trackBy]=\"getTrackByFunction()\"\r\n    (matSortChange)=\"onSort($event)\"\r\n  >\r\n    <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\r\n      <th mat-header-cell *matHeaderCellDef>\r\n        <ng-container *ngIf=\"selectMany\">\r\n          <ng-container *ngIf=\"selectionState$ | async as selectionState\">\r\n            <mat-checkbox\r\n              (change)=\"onToggleRows($event.checked)\"\r\n              [checked]=\"selectionState === entityTableSelectionState.All\"\r\n              [indeterminate]=\"\r\n                selectionState === entityTableSelectionState.Some\r\n              \"\r\n            >\r\n            </mat-checkbox>\r\n          </ng-container>\r\n        </ng-container>\r\n      </th>\r\n      <td mat-cell *matCellDef=\"let record\">\r\n        <mat-checkbox\r\n          (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\"\r\n          (click)=\"\r\n            $event.shiftKey\r\n              ? onShiftToggleRow(!rowIsSelected(record), record, $event)\r\n              : $event.stopPropagation()\r\n          \"\r\n          (change)=\"onToggleRow($event.checked, record)\"\r\n          [checked]=\"rowIsSelected(record)\"\r\n        >\r\n        </mat-checkbox>\r\n      </td>\r\n    </ng-container>\r\n\r\n    <ng-container\r\n      [matColumnDef]=\"column.name\"\r\n      *ngFor=\"let column of template.columns\"\r\n    >\r\n      <ng-container *ngIf=\"columnIsSortable(column)\">\r\n        <th\r\n          mat-header-cell\r\n          *matHeaderCellDef\r\n          mat-sort-header\r\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\r\n          class=\"mat-body-1\"\r\n        >\r\n          {{ column.title }}\r\n        </th>\r\n      </ng-container>\r\n\r\n      <ng-container *ngIf=\"!columnIsSortable(column)\">\r\n        <th\r\n          mat-header-cell\r\n          *matHeaderCellDef\r\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\r\n          class=\"mat-body-1\"\r\n        >\r\n          {{ column.title }}\r\n        </th>\r\n      </ng-container>\r\n\r\n      <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\r\n        <ng-container\r\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\"\r\n        >\r\n          <ng-container *matCellDef=\"let record\">\r\n            <td\r\n              mat-cell\r\n              class=\"mat-cell-text\"\r\n              *ngIf=\"!isUrl(getValue(record, column)); else isAnUrlDefault\"\r\n              [ngClass]=\"getCellClass(record, column)\"\r\n            >\r\n              {{ getValue(record, column) }}\r\n            </td>\r\n            <ng-template #isAnUrlDefault>\r\n              <td\r\n                mat-cell\r\n                class=\"mat-cell-text\"\r\n                [ngClass]=\"getCellClass(record, column)\"\r\n              >\r\n                <a\r\n                  href=\"{{ getValue(record, column) }}\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  (click)=\"$event.stopPropagation()\"\r\n                >\r\n                  <img\r\n                    igoImageError\r\n                    *ngIf=\"isImg(getValue(record, column)); else notImg\"\r\n                    src=\"{{ getValue(record, column) | secureImage | async }}\"\r\n                    width=\"50\"\r\n                    heigth=\"auto\"\r\n                  />\r\n                  <ng-template #notImg\r\n                    ><span\r\n                      >{{ 'igo.common.entity-table.targetHtmlUrl' | translate }}\r\n                    </span></ng-template\r\n                  >\r\n                </a>\r\n              </td>\r\n            </ng-template>\r\n          </ng-container>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\r\n          <ng-container *matCellDef=\"let record\">\r\n            <td\r\n              mat-cell\r\n              class=\"mat-cell-text\"\r\n              *ngIf=\"!isUrl(getValue(record, column)); else isAnUrlHTML\"\r\n              [ngClass]=\"getCellClass(record, column)\"\r\n              [innerHTML]=\"getValue(record, column)\"\r\n            ></td>\r\n            <ng-template #isAnUrlHTML>\r\n              <td\r\n                mat-cell\r\n                class=\"mat-cell-text\"\r\n                [ngClass]=\"getCellClass(record, column)\"\r\n              >\r\n                <a\r\n                  href=\"{{ getValue(record, column) }}\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  (click)=\"$event.stopPropagation()\"\r\n                >\r\n                  <img\r\n                    igoImageError\r\n                    *ngIf=\"isImg(getValue(record, column)); else notImg\"\r\n                    src=\"{{ getValue(record, column) | secureImage | async }}\"\r\n                    width=\"50\"\r\n                    heigth=\"auto\"\r\n                  />\r\n                  <ng-template #notImg\r\n                    ><span\r\n                      >{{ 'igo.geo.targetHtmlUrl' | translate }}\r\n                    </span></ng-template\r\n                  >\r\n                </a>\r\n              </td>\r\n            </ng-template>\r\n          </ng-container>\r\n        </ng-container>\r\n        <ng-container\r\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\"\r\n        >\r\n          <ng-container *matCellDef=\"let record\">\r\n            <td\r\n              mat-cell\r\n              class=\"mat-cell-text edition\"\r\n              [formGroup]=\"formGroup\"\r\n              *ngIf=\"isEdition(record); else isUnsanitizedHTML\"\r\n              [ngClass]=\"getCellClass(record, column)\"\r\n            >\r\n              <div class=\"date-picker\" *ngIf=\"column.type === 'date'\">\r\n                <mat-datepicker-toggle\r\n                  matSuffix\r\n                  [for]=\"picker\"\r\n                ></mat-datepicker-toggle>\r\n                <input\r\n                  matInput\r\n                  [matDatepicker]=\"picker\"\r\n                  [formControlName]=\"column.name\"\r\n                  value=\"{{ getValue(record, column) }}\"\r\n                  (dateChange)=\"onDateChange(column.name, record, $event)\"\r\n                />\r\n                <mat-datepicker #picker></mat-datepicker>\r\n              </div>\r\n              <input\r\n                matInput\r\n                type=\"time\"\r\n                *ngIf=\"column.type === 'time'\"\r\n                [formControlName]=\"column.name\"\r\n                step=\"900\"\r\n                (focus)=\"column.onFocus($event)\"\r\n                (keypress)=\"column.onChange($event)\"\r\n                (blur)=\"column.onBlur($event)\"\r\n              />\r\n              <input\r\n                matInput\r\n                type=\"number\"\r\n                class=\"class_number_edition\"\r\n                *ngIf=\"column.type === 'number'\"\r\n                [formControlName]=\"column.name\"\r\n                step=\"{{ column.step }}\"\r\n                value=\"{{ getValue(record, column) }}\"\r\n                (input)=\"onValueChange(column.name, record, $event)\"\r\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\r\n                required=\"{{\r\n                  getValidationAttributeValue(column, 'mandatory')\r\n                }}\"\r\n                min=\"{{ getValidationAttributeValue(column, 'minValue') }}\"\r\n                max=\"{{ getValidationAttributeValue(column, 'maxValue') }}\"\r\n              />\r\n              <input\r\n                matInput\r\n                type=\"text\"\r\n                *ngIf=\"!column.type || column.type === 'string'\"\r\n                [formControlName]=\"column.name\"\r\n                value=\"{{ getValue(record, column) }}\"\r\n                (input)=\"onValueChange(column.name, record, $event)\"\r\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\r\n                required=\"{{\r\n                  getValidationAttributeValue(column, 'mandatory')\r\n                }}\"\r\n              />\r\n              <mat-checkbox\r\n                *ngIf=\"column.type === 'boolean'\"\r\n                [formControlName]=\"column.name\"\r\n                [checked]=\"getValue(record, column)\"\r\n                (change)=\"onBooleanValueChange(column.name, record, $event)\"\r\n              ></mat-checkbox>\r\n              <mat-select\r\n                *ngIf=\"column.type === 'list'\"\r\n                required=\"{{\r\n                  getValidationAttributeValue(column, 'mandatory')\r\n                }}\"\r\n                [formControlName]=\"column.name\"\r\n                [multiple]=\"column.multiple\"\r\n                (selectionChange)=\"\r\n                  onSelectValueChange(column.name, record, $event)\r\n                \"\r\n                [value]=\"getValue(record, column)\"\r\n              >\r\n                <mat-option\r\n                  *ngFor=\"let option of column.domainValues\"\r\n                  [value]=\"option.id\"\r\n                  [disabled]=\"option.disabled\"\r\n                >\r\n                  {{ option.value }}\r\n                </mat-option>\r\n              </mat-select>\r\n              <input\r\n                matInput\r\n                type=\"text\"\r\n                [formControlName]=\"column.name\"\r\n                *ngIf=\"column.type === 'autocomplete'\"\r\n                [matAutocomplete]=\"auto\"\r\n                required=\"{{\r\n                  getValidationAttributeValue(column, 'mandatory')\r\n                }}\"\r\n                value=\"{{ getValue(record, column) }}\"\r\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\r\n              />\r\n              <mat-autocomplete\r\n                #auto=\"matAutocomplete\"\r\n                (optionSelected)=\"\r\n                  onAutocompleteValueChange(column, record, $event)\r\n                \"\r\n                panelWidth=\"430px\"\r\n              >\r\n                <mat-option\r\n                  *ngFor=\"let option of filteredOptions[column.name] | async\"\r\n                  [value]=\"option.id\"\r\n                >\r\n                  {{ option.value }}\r\n                </mat-option>\r\n              </mat-autocomplete>\r\n            </td>\r\n            <ng-template #isUnsanitizedHTML>\r\n              <td\r\n                mat-cell\r\n                class=\"mat-cell-text\"\r\n                *ngIf=\"\r\n                  !isUrl(getValue(record, column));\r\n                  else isAnUrlUnsanitizedHTML\r\n                \"\r\n                [ngClass]=\"getCellClass(record, column)\"\r\n                [innerHTML]=\"getValue(record, column) | sanitizeHtml\"\r\n              ></td>\r\n              <ng-template #isAnUrlUnsanitizedHTML>\r\n                <td\r\n                  mat-cell\r\n                  class=\"mat-cell-text\"\r\n                  [ngClass]=\"getCellClass(record, column)\"\r\n                >\r\n                  <a\r\n                    href=\"{{ getValue(record, column) }}\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    (click)=\"$event.stopPropagation()\"\r\n                  >\r\n                    <img\r\n                      igoImageError\r\n                      *ngIf=\"isImg(getValue(record, column)); else notImg\"\r\n                      src=\"{{ getValue(record, column) | secureImage | async }}\"\r\n                      width=\"50\"\r\n                      heigth=\"auto\"\r\n                    />\r\n                    <ng-template #notImg\r\n                      ><span\r\n                        >{{ 'igo.geo.targetHtmlUrl' | translate }}\r\n                      </span></ng-template\r\n                    >\r\n                  </a>\r\n                </td>\r\n              </ng-template>\r\n            </ng-template>\r\n          </ng-container>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\r\n          <td\r\n            mat-cell\r\n            *matCellDef=\"let record\"\r\n            class=\"mat-cell-text\"\r\n            [ngClass]=\"getCellClass(record, column)\"\r\n          >\r\n            <mat-icon\r\n              *ngIf=\"column.onClick\"\r\n              svgIcon=\"{{ getValue(record, column) || column.icon }}\"\r\n              (click)=\"column.onClick($event)\"\r\n            ></mat-icon>\r\n            <mat-icon\r\n              *ngIf=\"!column.onClick\"\r\n              svgIcon=\"{{ getValue(record, column) || column.icon }}\"\r\n            ></mat-icon>\r\n          </td>\r\n        </ng-container>\r\n        <ng-container\r\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\"\r\n        >\r\n          <ng-container *matCellDef=\"let record\">\r\n            <td\r\n              mat-cell\r\n              class=\"mat-cell-text\"\r\n              [ngClass]=\"getCellClass(record, column)\"\r\n            >\r\n              <span *ngFor=\"let button of getValue(record, column)\">\r\n                <ng-container\r\n                  *ngIf=\"\r\n                    isEdition(record) === button.editMode ||\r\n                    button.editMode === undefined\r\n                  \"\r\n                >\r\n                  <button\r\n                    *ngIf=\"button.style === 'mat-icon-button'\"\r\n                    igoStopPropagation\r\n                    mat-icon-button\r\n                    [color]=\"button.color\"\r\n                    (mousedown)=\"onButtonClick(button.click, record)\"\r\n                    [disabled]=\"button.disabled\"\r\n                  >\r\n                    <mat-icon svgIcon=\"{{ button.icon }}\"></mat-icon>\r\n                  </button>\r\n                  <button\r\n                    *ngIf=\"button.style !== 'mat-icon-button'\"\r\n                    igoStopPropagation\r\n                    mat-mini-fab\r\n                    [color]=\"button.color\"\r\n                    (mousedown)=\"onButtonClick(button.click, record)\"\r\n                    [disabled]=\"button.disabled\"\r\n                  >\r\n                    <mat-icon svgIcon=\"{{ button.icon }}\"></mat-icon>\r\n                  </button>\r\n                </ng-container>\r\n              </span>\r\n            </td>\r\n          </ng-container>\r\n        </ng-container>\r\n      </ng-container>\r\n    </ng-container>\r\n\r\n    <tr\r\n      mat-header-row\r\n      *matHeaderRowDef=\"headers; sticky: fixedHeader\"\r\n      [ngClass]=\"getHeaderClass()\"\r\n    ></tr>\r\n    <tr\r\n      mat-row\r\n      igoEntityTableRow\r\n      *matRowDef=\"let record; columns: headers\"\r\n      [scrollBehavior]=\"scrollBehavior\"\r\n      [ngClass]=\"getRowClass(record)\"\r\n      [selection]=\"selection\"\r\n      [selected]=\"rowIsSelected(record)\"\r\n      (select)=\"onRowSelect(record)\"\r\n      (click)=\"onRowClick(record)\"\r\n    ></tr>\r\n  </table>\r\n  <igo-entity-table-paginator\r\n    *ngIf=\"withPaginator\"\r\n    [store]=\"store\"\r\n    [paginatorOptions]=\"paginatorOptions\"\r\n    [entitySortChange$]=\"entitySortChange$\"\r\n    (paginatorChange)=\"paginatorChange($event)\"\r\n  >\r\n  </igo-entity-table-paginator>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  OnDestroy,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  ElementRef,\r\n  Optional,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\r\n\r\nimport {\r\n  EntityKey,\r\n  EntityRecord,\r\n  EntityState,\r\n  EntityStore,\r\n  EntityTableTemplate,\r\n  EntityTableColumn,\r\n  EntityTableColumnRenderer,\r\n  EntityTableSelectionState,\r\n  EntityTableScrollBehavior\r\n} from '../shared';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { MatTableDataSource } from '@angular/material/table';\r\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\r\nimport { MatFormFieldControl } from '@angular/material/form-field';\r\nimport {\r\n  UntypedFormBuilder,\r\n  NgControl,\r\n  NgForm,\r\n  FormControlName,\r\n  UntypedFormGroup\r\n} from '@angular/forms';\r\nimport { FocusMonitor } from '@angular/cdk/a11y';\r\nimport { DateAdapter, ErrorStateMatcher } from '@angular/material/core';\r\nimport { map } from 'rxjs/operators';\r\nimport { default as moment } from 'moment';\r\nimport { StringUtils } from '@igo2/utils';\r\n\r\n@Component({\r\n  selector: 'igo-entity-table',\r\n  templateUrl: './entity-table.component.html',\r\n  styleUrls: ['./entity-table.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  providers: [\r\n    { provide: MatFormFieldControl, useExisting: EntityTableComponent }\r\n  ]\r\n})\r\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy {\r\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public formGroup: UntypedFormGroup = new UntypedFormGroup({});\r\n\r\n  public filteredOptions = {};\r\n\r\n  /**\r\n   * Reference to the column renderer types\r\n   * @internal\r\n   */\r\n  entityTableColumnRenderer = EntityTableColumnRenderer;\r\n\r\n  /**\r\n   * Reference to the selection's state\r\n   * @internal\r\n   */\r\n  entityTableSelectionState = EntityTableSelectionState;\r\n\r\n  /**\r\n   * Observable of the selection,s state\r\n   * @internal\r\n   */\r\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Subscription to the store's selection\r\n   */\r\n  private selection$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the dataSource\r\n   */\r\n  private dataSource$$: Subscription;\r\n\r\n  /**\r\n   * The last record checked. Useful for selecting\r\n   * multiple records by holding the shift key and checking\r\n   * checkboxes.\r\n   */\r\n  private lastRecordCheckedKey: EntityKey;\r\n\r\n  /**\r\n   * Entity store\r\n   */\r\n  @Input() store: EntityStore<object>;\r\n\r\n  /**\r\n   * Table paginator\r\n   */\r\n  @Input() set paginator(value: MatPaginator) {\r\n    this._paginator = value;\r\n    this.dataSource.paginator = value;\r\n  }\r\n\r\n  get paginator(): MatPaginator {\r\n    return this._paginator;\r\n  }\r\n  private _paginator: MatPaginator;\r\n\r\n  /**\r\n   * Table template\r\n   */\r\n  @Input() template: EntityTableTemplate;\r\n\r\n  /**\r\n   * Scroll behavior on selection\r\n   */\r\n  @Input()\r\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\r\n\r\n  /**\r\n   * Whether nulls should be first when sorting\r\n   */\r\n  @Input()\r\n  sortNullsFirst: boolean = false;\r\n\r\n  /**\r\n   * Show the table paginator or not. False by default.\r\n   */\r\n  @Input()\r\n  withPaginator: boolean = false;\r\n\r\n  /**\r\n   * Paginator options\r\n   */\r\n  @Input()\r\n  paginatorOptions: EntityTablePaginatorOptions;\r\n\r\n  /**\r\n   * Event emitted when an entity (row) is clicked\r\n   */\r\n  @Output() entityClick = new EventEmitter<object>();\r\n\r\n  /**\r\n   * Event emitted when an entity (row) is selected\r\n   */\r\n  @Output() entitySelectChange = new EventEmitter<{\r\n    added: object[];\r\n  }>();\r\n\r\n  /**\r\n   * Event emitted when the table sort is changed.\r\n   */\r\n  @Output() entitySortChange: EventEmitter<{\r\n    column: EntityTableColumn;\r\n    direction: string;\r\n  }> = new EventEmitter(undefined);\r\n\r\n  /**\r\n   * Table headers\r\n   * @internal\r\n   */\r\n  get headers(): string[] {\r\n    let columns = this.template.columns\r\n      .filter((column: EntityTableColumn) => column.visible !== false)\r\n      .map((column: EntityTableColumn) => column.name);\r\n\r\n    if (this.selectionCheckbox === true) {\r\n      columns = ['selectionCheckbox'].concat(columns);\r\n    }\r\n\r\n    return columns;\r\n  }\r\n\r\n  /**\r\n   * Data source consumable by the underlying material table\r\n   * @internal\r\n   */\r\n  dataSource = new MatTableDataSource<object>();\r\n\r\n  /**\r\n   * Whether selection is supported\r\n   * @internal\r\n   */\r\n  get selection(): boolean {\r\n    return this.template.selection || false;\r\n  }\r\n\r\n  /**\r\n   * Whether a selection checkbox should be displayed\r\n   * @internal\r\n   */\r\n  get selectionCheckbox(): boolean {\r\n    return this.template.selectionCheckbox || false;\r\n  }\r\n\r\n  /**\r\n   * Whether selection many entities should eb supported\r\n   * @internal\r\n   */\r\n  get selectMany(): boolean {\r\n    return this.template.selectMany || false;\r\n  }\r\n\r\n  /**\r\n   * Whether selection many entities should eb supported\r\n   * @internal\r\n   */\r\n  get fixedHeader(): boolean {\r\n    return this.template.fixedHeader === undefined\r\n      ? true\r\n      : this.template.fixedHeader;\r\n  }\r\n\r\n  get tableHeight(): string {\r\n    return this.template.tableHeight ? this.template.tableHeight : 'auto';\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private formBuilder: UntypedFormBuilder,\r\n    protected _focusMonitor: FocusMonitor,\r\n    protected _elementRef: ElementRef<HTMLElement>,\r\n    @Optional() @Self() public ngControl: NgControl,\r\n    @Optional() protected _parentForm: NgForm,\r\n    @Optional() protected _controlName: FormControlName,\r\n    protected _defaultErrorStateMatcher: ErrorStateMatcher,\r\n    private dateAdapter: DateAdapter<Date>\r\n  ) {\r\n    this.dateAdapter.setLocale('fr-CA');\r\n  }\r\n\r\n  /**\r\n   * Track the selection state to properly display the selection checkboxes\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.handleDatasource();\r\n    this.dataSource.paginator = this.paginator;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const store = changes.store;\r\n    if (store && store.currentValue !== store.previousValue) {\r\n      this.handleDatasource();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process text or number value change (edition)\r\n   */\r\n  onValueChange(column: string, record: EntityRecord<any>, event) {\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\r\n    record.entity.properties[key] = event.target.value;\r\n  }\r\n\r\n  /**\r\n   * Process boolean value change (edition)\r\n   */\r\n  onBooleanValueChange(column: string, record: EntityRecord<any>, event) {\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\r\n    record.entity.properties[key] = event.checked;\r\n  }\r\n\r\n  /**\r\n   * Process select value change (edition)\r\n   */\r\n  onSelectValueChange(column: string, record: EntityRecord<any>, event) {\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\r\n    record.entity.properties[key] = event.value;\r\n  }\r\n\r\n  /**\r\n   * Process autocomplete value change (edition)\r\n   */\r\n  onAutocompleteValueChange(\r\n    column: EntityTableColumn,\r\n    record: EntityRecord<any>,\r\n    event\r\n  ) {\r\n    this.formGroup.controls[column.name].setValue(event.option.viewValue);\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column.name);\r\n    record.entity.properties[key] = event.option.value;\r\n  }\r\n\r\n  /**\r\n   * Process date value change (edition)\r\n   */\r\n  onDateChange(column: string, record: EntityRecord<any>, event) {\r\n    const format = 'YYYY-MM-DD';\r\n    const value = moment(event.value).format(format);\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\r\n    record.entity.properties[key] = value;\r\n  }\r\n\r\n  /**\r\n   * Enable edition mode for one row\r\n   * More than one row can be edited at the same time\r\n   */\r\n  private enableEdit(record: EntityRecord<any>) {\r\n    const item = record.entity.properties || record.entity;\r\n    this.template.columns.forEach((column) => {\r\n      column.title =\r\n        column.validation?.mandatory && !column.title.includes('*')\r\n          ? column.title + ' *'\r\n          : column.title;\r\n\r\n      const key = this.getColumnKeyWithoutPropertiesTag(column.name);\r\n      if (column.type === 'boolean') {\r\n        if (!item[key] || item[key] === null) {\r\n          item[key] = false;\r\n        } else if (typeof item[key] === 'string') {\r\n          item[key] = JSON.parse(item[key].toLowerCase());\r\n        }\r\n        this.formGroup.setControl(\r\n          column.name,\r\n          this.formBuilder.control(item[key])\r\n        );\r\n      } else if (column.type === 'list') {\r\n        if (column.multiple) {\r\n          this.formGroup.setControl(\r\n            column.name,\r\n            this.formBuilder.control([item[key]])\r\n          );\r\n        } else {\r\n          this.formGroup.setControl(\r\n            column.name,\r\n            this.formBuilder.control(item[key])\r\n          );\r\n\r\n          typeof item[key] === 'string'\r\n            ? this.formGroup.controls[column.name].setValue(parseInt(item[key]))\r\n            : this.formGroup.controls[column.name].setValue(item[key]);\r\n        }\r\n      } else if (column.type === 'autocomplete') {\r\n        this.formGroup.setControl(\r\n          column.name,\r\n          this.formBuilder.control(item[key])\r\n        );\r\n\r\n        this.filteredOptions[column.name] = new Observable<any[]>();\r\n        this.filteredOptions[column.name] = this.formGroup.controls[\r\n          column.name\r\n        ].valueChanges.pipe(\r\n          map((value) => {\r\n            if (value?.length) {\r\n              return column.domainValues?.filter((option) => {\r\n                const filterNormalized = value\r\n                  ? value\r\n                      .toLowerCase()\r\n                      .normalize('NFD')\r\n                      .replace(/[\\u0300-\\u036f]/g, '')\r\n                  : '';\r\n                const featureNameNormalized = option.value\r\n                  .toLowerCase()\r\n                  .normalize('NFD')\r\n                  .replace(/[\\u0300-\\u036f]/g, '');\r\n                return featureNameNormalized.includes(filterNormalized);\r\n              });\r\n            }\r\n          })\r\n        );\r\n\r\n        let formControlValue = item[key];\r\n        column.domainValues.forEach((option) => {\r\n          if (\r\n            typeof formControlValue === 'string' &&\r\n            StringUtils.isValidNumber(formControlValue) &&\r\n            !StringUtils.isOctalNumber(formControlValue)\r\n          ) {\r\n            formControlValue = parseInt(formControlValue);\r\n          }\r\n          if (\r\n            option.value === formControlValue ||\r\n            option.id === formControlValue\r\n          ) {\r\n            formControlValue = option.value;\r\n          }\r\n        });\r\n\r\n        this.formGroup.controls[column.name].setValue(formControlValue);\r\n        if (this.isEdition(record) && column.linkColumnForce) {\r\n          const entity = record.entity as any;\r\n          this.formGroup.controls[column.name].setValue(\r\n            entity?.properties[\r\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\r\n            ]\r\n          );\r\n        }\r\n      } else if (column.type === 'date') {\r\n        if (column.visible !== false) {\r\n          if (item[key]) {\r\n            let date = moment(item[key]);\r\n            item[key] = date.utc().format('YYYY-MM-DD');\r\n            this.formGroup.setControl(\r\n              column.name,\r\n              this.formBuilder.control(item[key])\r\n            );\r\n          } else {\r\n            const newKey = this.getColumnKeyWithoutPropertiesTag(column.name);\r\n            record.entity.properties[newKey] = null;\r\n            this.formGroup.setControl(\r\n              column.name,\r\n              this.formBuilder.control(null)\r\n            );\r\n          }\r\n        }\r\n      } else {\r\n        this.formGroup.setControl(\r\n          column.name,\r\n          this.formBuilder.control(item[key])\r\n        );\r\n      }\r\n\r\n      if (\r\n        this.formGroup.controls[column.name] &&\r\n        this.getValidationAttributeValue(column, 'readonly')\r\n      ) {\r\n        this.formGroup.controls[column.name].disable();\r\n      }\r\n    });\r\n  }\r\n\r\n  private handleDatasource() {\r\n    this.unsubscribeStore();\r\n    this.selection$$ = this.store.stateView\r\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\r\n      .subscribe((records: EntityRecord<object>[]) => {\r\n        const firstSelected = records[0];\r\n        const firstSelectedStateviewPosition = this.store.stateView\r\n          .all()\r\n          .indexOf(firstSelected);\r\n        const pageMax = this.paginator\r\n          ? this.paginator.pageSize * (this.paginator.pageIndex + 1)\r\n          : 0;\r\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\r\n\r\n        if (\r\n          this.paginator &&\r\n          (firstSelectedStateviewPosition < pageMin ||\r\n            firstSelectedStateviewPosition >= pageMax)\r\n        ) {\r\n          const pageToReach = Math.floor(\r\n            firstSelectedStateviewPosition / this.paginator.pageSize\r\n          );\r\n          this.dataSource.paginator.pageIndex = pageToReach;\r\n        }\r\n        this.selectionState$.next(this.computeSelectionState(records));\r\n      });\r\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\r\n      if (all[0]) {\r\n        this.enableEdit(all[0]);\r\n      }\r\n      this.dataSource.data = all;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unbind the store watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unsubscribeStore();\r\n  }\r\n\r\n  private unsubscribeStore() {\r\n    if (this.selection$$) {\r\n      this.selection$$.unsubscribe();\r\n    }\r\n    if (this.dataSource$$) {\r\n      this.dataSource$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trackby function\r\n   * @param record Record\r\n   * @param index Record index\r\n   * @internal\r\n   */\r\n  getTrackByFunction() {\r\n    return (index: number, record: EntityRecord<object, EntityState>) => {\r\n      return record.ref;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Trigger a refresh of thre table. This can be useful when\r\n   * the data source doesn't emit a new value but for some reason\r\n   * the records need an update.\r\n   * @internal\r\n   */\r\n  refresh() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  paginatorChange(event: MatPaginator) {\r\n    this.paginator = event;\r\n  }\r\n\r\n  /**\r\n   * On sort, sort the store\r\n   * @param event Sort event\r\n   * @internal\r\n   */\r\n  onSort(event: { active: string; direction: string }) {\r\n    const direction = event.direction;\r\n    const column = this.template.columns.find(\r\n      (c: EntityTableColumn) => c.name === event.active\r\n    );\r\n\r\n    if (direction === 'asc' || direction === 'desc') {\r\n      this.store.stateView.sort({\r\n        valueAccessor: (record: EntityRecord<object>) =>\r\n          this.getValue(record, column),\r\n        direction,\r\n        nullsFirst: this.sortNullsFirst\r\n      });\r\n      this.entitySortChange.emit({ column, direction });\r\n      this.entitySortChange$.next(true);\r\n    } else {\r\n      this.store.stateView.sort(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When an entity is clicked, emit an event\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onRowClick(record: EntityRecord<object>) {\r\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\r\n    this.entityClick.emit(record.entity);\r\n  }\r\n\r\n  /**\r\n   * When an entity is selected, select it in the store and emit an event. Even if\r\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\r\n   * multiple rows should be achieved by using the checkboxes.\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onRowSelect(record: EntityRecord<object>) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n\r\n    const entity = record.entity;\r\n    this.store.state.update(entity, { selected: true }, true);\r\n    this.entitySelectChange.emit({ added: [entity] });\r\n  }\r\n\r\n  /**\r\n   * Select or unselect all rows at once. On select, emit an event.\r\n   * @param toggle Select or unselect\r\n   * @internal\r\n   */\r\n  onToggleRows(toggle: boolean) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n\r\n    this.store.state.updateAll({ selected: toggle });\r\n    if (toggle === true) {\r\n      const entities = this.store.stateView\r\n        .all()\r\n        .map((record: EntityRecord<object>) => record.entity);\r\n      this.entitySelectChange.emit({ added: [entities] });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When an entity is toggled, select or unselect it in the store. On select,\r\n   * emit an event.\r\n   * @param toggle Select or unselect\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n\r\n    const entity = record.entity;\r\n    const exclusive = toggle === true && !this.selectMany;\r\n    this.store.state.update(entity, { selected: toggle }, exclusive);\r\n    if (toggle === true) {\r\n      this.entitySelectChange.emit({ added: [entity] });\r\n    }\r\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\r\n  }\r\n\r\n  /**\r\n   * When an entity is toggled, select or unselect it in the store. On select,\r\n   * emit an event.\r\n   * @param toggle Select or unselect\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onShiftToggleRow(\r\n    toggle: boolean,\r\n    record: EntityRecord<object>,\r\n    event: MouseEvent\r\n  ) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n\r\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\r\n      this.onToggleRow(toggle, record);\r\n      return;\r\n    }\r\n\r\n    // This is a workaround mat checkbox wrong behavior\r\n    // when the shift key is held.\r\n    // See https://github.com/angular/components/issues/6232\r\n    const range = window.document.createRange();\r\n    range.selectNode(event.target as HTMLElement);\r\n    window.getSelection().removeAllRanges();\r\n    window.getSelection().addRange(range);\r\n    event.stopImmediatePropagation();\r\n\r\n    const records = this.store.stateView.all();\r\n    const recordIndex = records.indexOf(record);\r\n    const lastRecordChecked = this.store.stateView.get(\r\n      this.lastRecordCheckedKey\r\n    );\r\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\r\n    const indexes = [recordIndex, lastRecordIndex];\r\n    const selectRecords = records.slice(\r\n      Math.min(...indexes),\r\n      Math.max(...indexes) + 1\r\n    );\r\n\r\n    const entities = selectRecords.map(\r\n      (_record: EntityRecord<object>) => _record.entity\r\n    );\r\n    this.store.state.updateMany(entities, { selected: toggle });\r\n    if (toggle === true) {\r\n      this.entitySelectChange.emit({ added: entities });\r\n    }\r\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\r\n  }\r\n\r\n  /**\r\n   * Compute the selection state\r\n   * @returns Whether all, some or no rows are selected\r\n   * @internal\r\n   */\r\n  private computeSelectionState(\r\n    selectedRecords: EntityRecord<object>[]\r\n  ): EntityTableSelectionState {\r\n    const states = EntityTableSelectionState;\r\n    const selectionCount = selectedRecords.length;\r\n    return selectionCount === 0\r\n      ? states.None\r\n      : selectionCount === this.store.stateView.count\r\n      ? states.All\r\n      : states.Some;\r\n  }\r\n\r\n  /**\r\n   * Whether a column is sortable\r\n   * @param column Column\r\n   * @returns True if a column is sortable\r\n   * @internal\r\n   */\r\n  columnIsSortable(column: EntityTableColumn): boolean {\r\n    let sortable = column.sort;\r\n    if (sortable === undefined) {\r\n      sortable = this.template.sort === undefined ? false : this.template.sort;\r\n    }\r\n    return sortable;\r\n  }\r\n\r\n  /**\r\n   * Whether a row is should be selected based on the underlying entity state\r\n   * @param record Record\r\n   * @returns True if a row should be selected\r\n   * @internal\r\n   */\r\n  rowIsSelected(record: EntityRecord<object>): boolean {\r\n    const state = record.state;\r\n    return state.selected ? state.selected : false;\r\n  }\r\n\r\n  isImg(value) {\r\n    if (this.isUrl(value)) {\r\n      return (\r\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !==\r\n        -1\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  isUrl(value) {\r\n    if (typeof value === 'string') {\r\n      return (\r\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Method to access an entity's values\r\n   * @param record Record\r\n   * @param column Column\r\n   * @returns Any value\r\n   * @internal\r\n   */\r\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\r\n    const entity = record.entity;\r\n    let value;\r\n    if (column.valueAccessor !== undefined) {\r\n      return column.valueAccessor(entity, record);\r\n    }\r\n    if (this.template.valueAccessor !== undefined) {\r\n      return this.template.valueAccessor(entity, column.name, record);\r\n    }\r\n    value = this.store.getProperty(entity, column.name);\r\n\r\n    if (column.type === 'boolean') {\r\n      if (value === undefined || value === null || value === '') {\r\n        value = false;\r\n      } else if (typeof value !== 'boolean' && value !== undefined) {\r\n        if (typeof value === 'number') {\r\n          value = Boolean(value);\r\n        } else {\r\n          value = JSON.parse(value.toLowerCase());\r\n        }\r\n      }\r\n      if (!this.isEdition(record)) {\r\n        value = value ? '&#10003;' : ''; // check mark\r\n      }\r\n    } else if (column.type === 'list' && value && column.domainValues) {\r\n      const entity = record.entity as any;\r\n      if (column.multiple) {\r\n        let list_id;\r\n        typeof value === 'string'\r\n          ? (list_id = value.match(/[\\w.-]+/g).map(Number))\r\n          : (list_id = value);\r\n        let list_option = [];\r\n\r\n        column.domainValues.forEach((option) => {\r\n          if (list_id.includes(option.id)) {\r\n            if (record.edition) {\r\n              list_option.push(option.id);\r\n            } else {\r\n              list_option.push(option.value);\r\n            }\r\n          }\r\n        });\r\n\r\n        this.isEdition(record) ? (value = list_id) : (value = list_option);\r\n      } else {\r\n        if (!this.isEdition(record) && column.linkColumnForce) {\r\n          value =\r\n            entity?.properties[\r\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\r\n            ];\r\n        } else {\r\n          column.domainValues.forEach((option) => {\r\n            if (\r\n              typeof value === 'string' &&\r\n              StringUtils.isValidNumber(value) &&\r\n              !StringUtils.isOctalNumber(value)\r\n            ) {\r\n              value = parseInt(value);\r\n            }\r\n            if (option.value === value || option.id === value) {\r\n              this.isEdition(record)\r\n                ? (value = option.id)\r\n                : (value = option.value);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    } else if (column.type === 'autocomplete' && value && column.domainValues) {\r\n      const entity = record.entity as any;\r\n      if (!this.isEdition(record) && column.linkColumnForce) {\r\n        value =\r\n          entity?.properties[\r\n            this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\r\n          ];\r\n      } else {\r\n        column.domainValues.forEach((option) => {\r\n          if (\r\n            typeof value === 'string' &&\r\n            StringUtils.isValidNumber(value) &&\r\n            !StringUtils.isOctalNumber(value)\r\n          ) {\r\n            value = parseInt(value);\r\n          }\r\n          if (option.value === value || option.id === value) {\r\n            value = option.value;\r\n          }\r\n        });\r\n      }\r\n    } else if (column.type === 'date') {\r\n      if (this.isEdition(record)) {\r\n        if (value) {\r\n          let date = moment(value);\r\n          value = date.format();\r\n          this.formGroup.controls[column.name].setValue(value);\r\n        }\r\n      } else if (!this.isEdition(record) && value === null) {\r\n        value = '';\r\n      }\r\n    }\r\n\r\n    if (value === undefined) {\r\n      value = '';\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Method to access an entity's validation values\r\n   * @param column Column\r\n   * @param validationType string\r\n   * @returns Any value (false if no validation or not the one concerned)\r\n   * @internal\r\n   */\r\n  getValidationAttributeValue(\r\n    column: EntityTableColumn,\r\n    validationType: string\r\n  ): any {\r\n    if (\r\n      column.validation !== undefined &&\r\n      column.validation[validationType] !== undefined\r\n    ) {\r\n      return column.validation[validationType];\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public isEdition(record) {\r\n    return record.entity.edition ? true : false;\r\n  }\r\n\r\n  /**\r\n   * Return the type of renderer of a column\r\n   * @param column Column\r\n   * @returns Renderer type\r\n   * @internal\r\n   */\r\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\r\n    if (column.renderer !== undefined) {\r\n      return column.renderer;\r\n    }\r\n    return EntityTableColumnRenderer.Default;\r\n  }\r\n\r\n  /**\r\n   * Return the table ngClass\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getTableClass(): { [key: string]: boolean } {\r\n    return {\r\n      'igo-entity-table-with-selection': this.selection\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Return a header ngClass\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getHeaderClass(): { [key: string]: boolean } {\r\n    const func = this.template.headerClassFunc;\r\n    if (func instanceof Function) {\r\n      return func();\r\n    }\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Return a row ngClass\r\n   * @param record Record\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getRowClass(record: EntityRecord<object>): { [key: string]: boolean } {\r\n    const entity = record.entity;\r\n    const func = this.template.rowClassFunc;\r\n    if (func instanceof Function) {\r\n      return func(entity, record);\r\n    }\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Return a row ngClass\r\n   * @param record Record\r\n   * @param column Column\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getCellClass(\r\n    record: EntityRecord<object>,\r\n    column: EntityTableColumn\r\n  ): { [key: string]: boolean } {\r\n    const entity = record.entity;\r\n    const cls = {};\r\n\r\n    const tableFunc = this.template.cellClassFunc;\r\n    if (tableFunc instanceof Function) {\r\n      Object.assign(cls, tableFunc(entity, column, record));\r\n    }\r\n\r\n    const columnFunc = column.cellClassFunc;\r\n    if (columnFunc instanceof Function) {\r\n      Object.assign(cls, columnFunc(entity, record));\r\n    }\r\n\r\n    return cls;\r\n  }\r\n\r\n  /**\r\n   * When a button is clicked\r\n   * @param func Function\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onButtonClick(\r\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\r\n    record: EntityRecord<object>\r\n  ) {\r\n    this.enableEdit(record);\r\n    if (typeof clickFunc === 'function') {\r\n      clickFunc(record.entity, record);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieve column name without his \"properties\" tag (useful for edition workspace properties)\r\n   */\r\n  public getColumnKeyWithoutPropertiesTag(column: string) {\r\n    if (column.includes('properties.')) {\r\n      return column.split('.')[1];\r\n    }\r\n    return column;\r\n  }\r\n}\r\n","import { EntityRecord, EntityStore } from '../../entity';\nimport { Tool, ToolboxOptions } from './tool.interface';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n/**\n * Service where all available tools and their component are registered.\n */\nexport class Toolbox {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Ordered list of tool names to display in a toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Observable of the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Active tool history. Useful for activating the previous tool.\n   */\n  private activeToolHistory: string[] = [];\n\n  /**\n   * Tool store\n   */\n  private store = new EntityStore<Tool>([], {\n    getKey: (tool: Tool) => tool.name\n  });\n\n  get tools$(): BehaviorSubject<Tool[]> {\n    return this.store.entities$;\n  }\n\n  constructor(private options: ToolboxOptions = {}) {\n    this.setToolbar(options.toolbar);\n    this.initStore();\n  }\n\n  /**\n   * Destroy the toolbox\n   */\n  destroy() {\n    this.activeTool$$.unsubscribe();\n    this.store.destroy();\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return this.store.get(name);\n  }\n\n  /**\n   * Return all tools\n   * @returns Array of tools\n   */\n  getTools(): Tool[] {\n    return this.store.all();\n  }\n\n  /**\n   * Set tool configurations\n   * @param tools Tools\n   */\n  setTools(tools: Tool[]) {\n    this.store.load(tools);\n  }\n\n  /**\n   * Get toolbar\n   * @returns Toolbar value\n   */\n  getToolbar(): string[] {\n    return this.toolbar$.getValue();\n  }\n\n  /**\n   * Set toolbar\n   * @param toolbar A list of tool names\n   */\n  setToolbar(toolbar: string[]) {\n    this.toolbar$.next(toolbar || []);\n  }\n\n  /**\n   * Activate a tool (and deactivate other tools)\n   * @param name Tool name\n   * @param options Tool options\n   */\n  activateTool(name: string, options: { [key: string]: any } = {}) {\n    const tool = this.getTool(name);\n    if (tool === undefined) {\n      return;\n    }\n\n    this.store.state.update(tool, { active: true, options }, true);\n  }\n\n  /**\n   * Activate the previous tool, if any\n   */\n  activatePreviousTool() {\n    if (this.activeToolHistory.length <= 1) {\n      this.deactivateTool();\n      return;\n    }\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\n    this.activateTool(previous);\n  }\n\n  /**\n   * Activate the tool below, if any\n   */\n  /* activateBelowTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index + 1] !== undefined) {\n      this.deactivateTool();\n      const below = arrayTools[index + 1];\n      this.activateTool(below);\n    } else {\n      this.deactivateTool();\n      const below = arrayTools[0];\n      this.activateTool(below);\n    }\n  } */\n\n  /**\n   * Activate the tool above, if any\n   */\n  /* activateAboveTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index - 1] !== undefined) {\n      this.deactivateTool();\n      const above = arrayTools[index - 1];\n      this.activateTool(above);\n    } else {\n      this.deactivateTool();\n      const above = arrayTools[arrayTools.length - 1];\n      this.activateTool(above);\n    }\n  } */\n\n  /**\n   * Deactivate the active tool\n   */\n  deactivateTool() {\n    this.clearActiveToolHistory();\n    this.store.state.updateAll({ active: false });\n  }\n\n  /**\n   * Initialize the tool store and start observing the active tool\n   */\n  private initStore() {\n    this.store = new EntityStore<Tool>([], {\n      getKey: (entity: Tool) => entity.name\n    });\n\n    this.activeTool$$ = this.store.stateView\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Tool>) => {\n        if (record === undefined) {\n          this.setActiveTool(undefined);\n          return;\n        }\n\n        const tool = record.entity;\n        const options = Object.assign(\n          {},\n          tool.options || {},\n          record.state.options || {}\n        );\n        this.setActiveTool(Object.assign({}, tool, { options }));\n      });\n  }\n\n  /**\n   * Set the active tool and update the tool history\n   * @param tool Tool\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    this.activeTool$.next(tool);\n    if (tool === undefined) {\n      this.clearActiveToolHistory();\n    } else {\n      this.activeToolHistory = this.activeToolHistory\n        .filter((name: string) => name !== tool.name)\n        .concat([tool.name]);\n    }\n  }\n\n  /**\n   * Clear the tool history\n   */\n  private clearActiveToolHistory() {\n    this.activeToolHistory = [];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Tool } from './tool.interface';\nimport { Toolbox } from './toolbox';\n\n/**\n * Service where runtime tool configurations are registered\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolService {\n  static tools: { [key: string]: Tool } = {};\n\n  /**\n   * Toolbox that holds main tools\n   */\n  public toolbox: Toolbox = new Toolbox();\n\n  static register(tool: Tool) {\n    ToolService.tools[tool.name] = tool;\n  }\n\n  constructor() {\n    this.toolbox.setTools(this.getTools());\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return ToolService.tools[name];\n  }\n\n  /**\n   * Return all tools\n   * @returns tTols\n   */\n  getTools(): Tool[] {\n    return Object.values(ToolService.tools);\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoActionModule } from '../../action/action.module';\r\nimport { IgoDynamicComponentModule } from '../../dynamic-component/dynamic-component.module';\r\n\r\nimport { ToolboxComponent } from './toolbox.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoActionModule, IgoDynamicComponentModule],\r\n  exports: [ToolboxComponent],\r\n  declarations: [ToolboxComponent]\r\n})\r\nexport class IgoToolboxModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { ToolService } from './shared/tool.service';\r\nimport { IgoToolboxModule } from './toolbox/toolbox.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [IgoToolboxModule],\r\n  declarations: []\r\n})\r\nexport class IgoToolModule {\r\n  static forRoot(): ModuleWithProviders<IgoToolModule> {\r\n    return {\r\n      ngModule: IgoToolModule,\r\n      providers: [ToolService]\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoDynamicComponentModule } from '../../dynamic-component/dynamic-component.module';\r\n\r\nimport { WidgetOutletComponent } from './widget-outlet.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoDynamicComponentModule],\r\n  exports: [WidgetOutletComponent],\r\n  declarations: [WidgetOutletComponent]\r\n})\r\nexport class IgoWidgetOutletModule {}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { DynamicComponentService } from '../../dynamic-component/shared/dynamic-component.service';\r\n\r\nimport { Widget } from './widget';\r\nimport { WidgetComponent } from './widget.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WidgetService {\r\n  constructor(private dynamicComponentService: DynamicComponentService) {}\r\n\r\n  create(widgetCls: any): Widget {\r\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\r\nimport { WidgetService } from './shared/widget.service';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, IgoWidgetOutletModule],\r\n  exports: [IgoWidgetOutletModule],\r\n  declarations: [],\r\n  providers: [WidgetService]\r\n})\r\nexport class IgoWidgetModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoEntitySelectorModule } from '../../entity/entity-selector/entity-selector.module';\r\nimport { WorkspaceSelectorComponent } from './workspace-selector.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoEntitySelectorModule],\r\n  exports: [WorkspaceSelectorComponent],\r\n  declarations: [WorkspaceSelectorComponent]\r\n})\r\nexport class IgoWorkspaceSelectorModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoWidgetOutletModule } from '../../widget/widget-outlet/widget-outlet.module';\r\n\r\nimport { WorkspaceWidgetOutletComponent } from './workspace-widget-outlet.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoWidgetOutletModule],\r\n  exports: [WorkspaceWidgetOutletComponent],\r\n  declarations: [WorkspaceWidgetOutletComponent]\r\n})\r\nexport class IgoWorkspaceWidgetOutletModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\r\nimport { IgoWorkspaceWidgetOutletModule } from './workspace-widget-outlet/workspace-widget-outlet.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [IgoWorkspaceSelectorModule, IgoWorkspaceWidgetOutletModule],\r\n  declarations: []\r\n})\r\nexport class IgoWorkspaceModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { ColorPickerFormFieldComponent } from './color-picker-form-field.component';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\n\r\n@NgModule({\r\n  imports: [\r\n    FormsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  declarations: [ColorPickerFormFieldComponent],\r\n  exports: [ColorPickerFormFieldComponent]\r\n})\r\nexport class ColorPickerFormFieldModule {}\r\n","export enum ActionbarMode {\n  Dock = 'dock',\n  Overlay = 'overlay',\n  Context = 'context'\n}\n","import { EntityStore } from '../../entity';\r\nimport { Action } from './action.interfaces';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * actions.\r\n */\r\nexport class ActionStore extends EntityStore<Action> {}\r\n","<mat-list-item\n  *ngIf=\"!action.checkbox\"\n  class=\"actionbar-item\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n  (click)=\"onClick()\"\n>\n  <button\n    *ngIf=\"withIcon\"\n    matListItemAvatar\n    mat-icon-button\n    [color]=\"color\"\n    [disabled]=\"disabled$ | async\"\n    [disableRipple]=\"true\"\n  >\n    <mat-icon *ngIf=\"withIcon\" svgIcon=\"{{ icon$ | async }}\"></mat-icon>\n  </button>\n  <span *ngIf=\"withTitle\" matLine>{{ title | translate }}</span>\n</mat-list-item>\n\n<mat-list-item\n  class=\"item-checkbox\"\n  *ngIf=\"action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n>\n  <mat-checkbox\n    *ngIf=\"withTitle\"\n    (change)=\"action.handler()\"\n    [checked]=\"checkCondition$ | async\"\n  >\n    {{ title | translate }}\n  </mat-checkbox>\n</mat-list-item>\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\r\n\r\nimport { Action } from '../shared/action.interfaces';\r\n\r\n/**\r\n * An action button\r\n */\r\n@Component({\r\n  selector: 'igo-actionbar-item',\r\n  templateUrl: './actionbar-item.component.html',\r\n  styleUrls: ['./actionbar-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\r\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  readonly ngClass$: BehaviorSubject<{ [key: string]: boolean }> =\r\n    new BehaviorSubject({});\r\n\r\n  private ngClass$$: Subscription;\r\n\r\n  private disabled$$: Subscription;\r\n\r\n  private availability$$: Subscription;\r\n\r\n  private icon$$: Subscription;\r\n\r\n  private checkCondition$$: Subscription;\r\n\r\n  private tooltip$$: Subscription;\r\n\r\n  private noDisplay$$: Subscription;\r\n\r\n  private display$$: Subscription;\r\n\r\n  /**\r\n   * Action\r\n   */\r\n  @Input() action: Action;\r\n\r\n  /**\r\n   * Color\r\n   */\r\n  @Input() color = 'default';\r\n\r\n  /**\r\n   * Whether the action title is displayed\r\n   */\r\n  @Input() withTitle = true;\r\n\r\n  /**\r\n   * Whether the action icon is displayed\r\n   */\r\n  @Input() withIcon = true;\r\n\r\n  /**\r\n   * Whether a tooltip should be shown\r\n   */\r\n  @Input() withTooltip = true;\r\n\r\n  /**\r\n   * Whether the action is disabled\r\n   */\r\n  @Input()\r\n  set disabled(value: boolean) {\r\n    this.disabled$.next(value);\r\n  }\r\n  get disabled(): boolean {\r\n    return this.disabled$.value;\r\n  }\r\n\r\n  /**\r\n   * Whether the action is display or not\r\n   */\r\n  @Input()\r\n  set noDisplay(value: boolean) {\r\n    this.noDisplay$.next(value);\r\n  }\r\n  get noDisplay(): boolean {\r\n    return this.noDisplay$.value;\r\n  }\r\n\r\n  /**\r\n   * Event emitted when the action button is clicked\r\n   */\r\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return this.action.title;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    const args = this.action.args || [];\r\n\r\n    if (this.action.ngClass !== undefined) {\r\n      this.ngClass$$ = this.action\r\n        .ngClass(...args)\r\n        .subscribe((ngClass: { [key: string]: boolean }) =>\r\n          this.updateNgClass(ngClass)\r\n        );\r\n    }\r\n\r\n    if (isObservable(this.action.icon)) {\r\n      this.icon$$ = this.action.icon.subscribe((icon: string) =>\r\n        this.updateIcon(icon)\r\n      );\r\n    } else {\r\n      this.updateIcon(this.action.icon);\r\n    }\r\n\r\n    if (isObservable(this.action.checkCondition)) {\r\n      this.checkCondition$$ = this.action.checkCondition.subscribe(\r\n        (checkCondition: boolean) => this.updateCheckCondition(checkCondition)\r\n      );\r\n    } else {\r\n      this.updateCheckCondition(this.action.checkCondition);\r\n    }\r\n\r\n    if (isObservable(this.action.tooltip)) {\r\n      this.tooltip$$ = this.action.tooltip.subscribe((tooltip: string) =>\r\n        this.updateTooltip(tooltip)\r\n      );\r\n    } else {\r\n      this.updateTooltip(this.action.tooltip);\r\n    }\r\n\r\n    if (this.action.availability !== undefined) {\r\n      this.availability$$ = this.action\r\n        .availability(...args)\r\n        .subscribe((available: boolean) => (this.disabled = !available));\r\n    }\r\n\r\n    this.disabled$$ = this.disabled$.subscribe((disabled: boolean) =>\r\n      this.updateNgClass({ 'igo-actionbar-item-disabled': disabled })\r\n    );\r\n\r\n    if (this.action.display !== undefined) {\r\n      this.display$$ = this.action\r\n        .display(...args)\r\n        .subscribe((display: boolean) => (this.noDisplay = !display));\r\n    }\r\n\r\n    this.noDisplay$$ = this.noDisplay$.subscribe((noDisplay: boolean) =>\r\n      this.updateNgClass({ 'igo-actionbar-item-no-display': noDisplay })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    if (this.ngClass$$ !== undefined) {\r\n      this.ngClass$$.unsubscribe();\r\n      this.ngClass$$ = undefined;\r\n    }\r\n\r\n    if (this.availability$$ !== undefined) {\r\n      this.availability$$.unsubscribe();\r\n      this.availability$$ = undefined;\r\n    }\r\n\r\n    if (this.display$$ !== undefined) {\r\n      this.display$$.unsubscribe();\r\n      this.display$$ = undefined;\r\n    }\r\n\r\n    if (this.checkCondition$$ !== undefined) {\r\n      this.checkCondition$$.unsubscribe();\r\n      this.checkCondition$$ = undefined;\r\n    }\r\n\r\n    if (this.icon$$ !== undefined) {\r\n      this.icon$$.unsubscribe();\r\n      this.icon$$ = undefined;\r\n    }\r\n\r\n    if (this.tooltip$$ !== undefined) {\r\n      this.tooltip$$.unsubscribe();\r\n      this.tooltip$$ = undefined;\r\n    }\r\n\r\n    this.disabled$$.unsubscribe();\r\n    this.noDisplay$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * When the action button is clicked, emit the 'trigger' event but don't\r\n   * invoke the action handler. This is handled by the parent component.\r\n   * @internal\r\n   */\r\n  onClick() {\r\n    if (this.disabled === true) {\r\n      return;\r\n    }\r\n    this.trigger.emit(this.action);\r\n  }\r\n\r\n  private updateNgClass(ngClass: { [key: string]: boolean }) {\r\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\r\n  }\r\n\r\n  private updateTooltip(tooltip: string) {\r\n    this.tooltip$.next(tooltip);\r\n  }\r\n\r\n  private updateCheckCondition(checkCondition: boolean) {\r\n    this.checkCondition$.next(checkCondition);\r\n  }\r\n\r\n  private updateIcon(icon: string) {\r\n    this.icon$.next(icon);\r\n  }\r\n}\r\n","<mat-list *ngIf=\"mode === actionbarMode.Dock\" matListItemIcon>\r\n  <div\r\n    *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\r\n    id=\"topChevron\"\r\n  >\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\r\n      (click)=\"scrollUp()\"\r\n    >\r\n      <mat-icon svgIcon=\"chevron-up\"></mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n  <igo-actionbar-item\r\n    *ngIf=\"withToggleButton\"\r\n    color=\"accent\"\r\n    [withTitle]=\"false\"\r\n    [withIcon]=\"true\"\r\n    [color]=\"color\"\r\n    [disabled]=\"store.view.empty\"\r\n    [action]=\"toggleCollapseAction\"\r\n    (trigger)=\"onTriggerAction(toggleCollapseAction)\"\r\n  >\r\n  </igo-actionbar-item>\r\n\r\n  <ng-template\r\n    #buttonContent\r\n    *ngIf=\"!collapsed\"\r\n    ngFor\r\n    let-action\r\n    [ngForOf]=\"store.view.all$() | async\"\r\n  >\r\n    <igo-actionbar-item\r\n      color=\"accent\"\r\n      [withTitle]=\"withTitle\"\r\n      [withIcon]=\"withIcon\"\r\n      [withTooltip]=\"withTooltip\"\r\n      [color]=\"color\"\r\n      [disabled]=\"store.state.get(action).disabled\"\r\n      [action]=\"action\"\r\n      (trigger)=\"onTriggerAction(action)\"\r\n    >\r\n    </igo-actionbar-item>\r\n  </ng-template>\r\n\r\n  <div\r\n    *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\r\n    id=\"lowChevron\"\r\n  >\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\r\n      (click)=\"scrollDown()\"\r\n    >\r\n      <mat-icon svgIcon=\"chevron-down\"></mat-icon>\r\n    </button>\r\n  </div>\r\n</mat-list>\r\n\r\n<div *ngIf=\"mode === actionbarMode.Overlay\">\r\n  <button\r\n    class=\"buttonOverlay\"\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\r\n    [matMenuTriggerFor]=\"actionbarMenu\"\r\n    [disabled]=\"store.view.empty\"\r\n    [color]=\"iconColor\"\r\n  >\r\n    <mat-icon [svgIcon]=\"icon\"></mat-icon>\r\n  </button>\r\n\r\n  <mat-menu\r\n    #actionbarMenu=\"matMenu\"\r\n    class=\"igo-compact-menu igo-no-min-width-menu\"\r\n    overlapTrigger=\"true\"\r\n    [xPosition]=\"xPosition\"\r\n    [yPosition]=\"yPosition\"\r\n    [class]=\"overlayClass\"\r\n  >\r\n    <mat-list>\r\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\r\n        <igo-actionbar-item\r\n          color=\"accent\"\r\n          [withTitle]=\"withTitle\"\r\n          [withIcon]=\"withIcon\"\r\n          [color]=\"color\"\r\n          [action]=\"action\"\r\n          (trigger)=\"onTriggerAction(action)\"\r\n        >\r\n        </igo-actionbar-item>\r\n      </ng-template>\r\n    </mat-list>\r\n  </mat-menu>\r\n</div>\r\n<mat-card\r\n  *ngIf=\"mode === actionbarMode.Context\"\r\n  class=\"context-menu-card mat-elevation-z4\"\r\n>\r\n  <mat-list>\r\n    <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\r\n      <igo-actionbar-item\r\n        color=\"accent\"\r\n        [withTitle]=\"withTitle\"\r\n        [withIcon]=\"withIcon\"\r\n        [color]=\"color\"\r\n        [action]=\"action\"\r\n        (trigger)=\"onTriggerAction(action)\"\r\n      >\r\n      </igo-actionbar-item>\r\n      <br />\r\n    </ng-template>\r\n  </mat-list>\r\n</mat-card>\r\n","import {\r\n  Component,\r\n  Input,\r\n  HostBinding,\r\n  ChangeDetectorRef,\r\n  ChangeDetectionStrategy,\r\n  OnChanges,\r\n  OnDestroy,\r\n  SimpleChanges,\r\n  ElementRef\r\n} from '@angular/core';\r\n\r\nimport { MediaService, Media } from '@igo2/core';\r\nimport { EntityStoreWatcher } from '../../entity';\r\nimport { Action } from '../shared/action.interfaces';\r\nimport { ActionbarMode } from '../shared/action.enums';\r\nimport { ActionStore } from '../shared/store';\r\nimport { Overlay } from '@angular/cdk/overlay';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n/**\r\n * A list of action buttons.\r\n * This component can be displayed in one of two way: 'dock' or 'overlay'\r\n */\r\n@Component({\r\n  selector: 'igo-actionbar',\r\n  templateUrl: './actionbar.component.html',\r\n  styleUrls: ['./actionbar.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ActionbarComponent implements OnDestroy, OnChanges {\r\n  /**\r\n   * Reference to the ActionbarMode enum for use in the template\r\n   * @internal\r\n   */\r\n  actionbarMode = ActionbarMode;\r\n\r\n  /**\r\n   * Whether the actionbar is collapsed (Dock mode)\r\n   * @internal\r\n   */\r\n  collapsed = false;\r\n\r\n  /**\r\n   * Toggle collapse action (Dock)\r\n   * @internal\r\n   */\r\n  toggleCollapseAction = {\r\n    id: 'actionbar_toggle',\r\n    icon: 'dots-vertical',\r\n    handler: () => {\r\n      this.collapsed = !this.collapsed;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Action store watcher\r\n   * @internal\r\n   */\r\n  private watcher: EntityStoreWatcher<Action>;\r\n\r\n  /**\r\n   * Height Condition for scroll button\r\n   */\r\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\r\n    false\r\n  );\r\n\r\n  /**\r\n   * Position Condition for top scroll button\r\n   */\r\n  positionConditionTop$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(true);\r\n\r\n  /**\r\n   * Position Condition for low scroll button\r\n   */\r\n  positionConditionLow$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(true);\r\n\r\n  /**\r\n   * Action store\r\n   */\r\n  @Input() store: ActionStore;\r\n\r\n  /**\r\n   * Actionbar mode\r\n   */\r\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\r\n\r\n  /**\r\n   * Whether a toggle button should be displayed (Dock mode)\r\n   */\r\n  @Input() withToggleButton = false;\r\n\r\n  /**\r\n   * Whether a the actionbar should display buttons horizontally\r\n   */\r\n  @Input() horizontal = false;\r\n\r\n  /**\r\n   * Color\r\n   */\r\n  @Input() color = 'default';\r\n\r\n  /**\r\n   * Color of the button if action mode === overlay\r\n   */\r\n  @Input() iconColor = 'default';\r\n\r\n  /**\r\n   * Whether action titles are displayed\r\n   */\r\n  @Input() withTitle = true;\r\n\r\n  /**\r\n   * Whether action tooltips are displayed\r\n   */\r\n  @Input() withTooltip = true;\r\n\r\n  /**\r\n   * Whether action titles are displayed (condition for scroll button)\r\n   */\r\n  @Input() scrollActive = true;\r\n\r\n  /**\r\n   * Whether action icons are displayed\r\n   */\r\n  @Input() withIcon = true;\r\n\r\n  /**\r\n   * Which icon want to be shown\r\n   */\r\n  @Input() icon = 'dots-horizontal';\r\n\r\n  /**\r\n   * Overlay X position\r\n   */\r\n  @Input() xPosition = 'before';\r\n\r\n  /**\r\n   * Overlay Y position\r\n   */\r\n  @Input() yPosition = 'above';\r\n\r\n  /**\r\n   * Class to add to the actionbar overlay\r\n   */\r\n  @Input()\r\n  set overlayClass(value: string) {\r\n    this._overlayClass = value;\r\n  }\r\n  get overlayClass(): string {\r\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\r\n  }\r\n  private _overlayClass = '';\r\n\r\n  @HostBinding('class.is-collapsed') isCollapsed = this.collapsed;\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.with-title')\r\n  get withTitleClass() {\r\n    return this.withTitle;\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.with-icon')\r\n  get withIconClass() {\r\n    return this.withIcon;\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.horizontal')\r\n  get horizontalClass() {\r\n    return this.horizontal;\r\n  }\r\n\r\n  get heightCondition(): boolean {\r\n    const el = this.elRef.nativeElement;\r\n    if (this.scrollActive === false) {\r\n      if (el.clientHeight < el.scrollHeight) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get positionConditionTop(): boolean {\r\n    if (this.elRef.nativeElement.scrollTop === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get positionConditionLow(): boolean {\r\n    const el = this.elRef.nativeElement;\r\n    if (el.scrollTop >= el.scrollHeight - el.clientHeight) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get isDesktop(): boolean {\r\n    return this.mediaService.getMedia() === Media.Desktop;\r\n  }\r\n\r\n  constructor(\r\n    public overlay: Overlay,\r\n    private elRef: ElementRef,\r\n    private cdRef: ChangeDetectorRef,\r\n    public mediaService: MediaService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const store = changes.store;\r\n    if (store && store.currentValue !== store.previousValue) {\r\n      if (this.watcher !== undefined) {\r\n        this.watcher.destroy();\r\n      }\r\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n  }\r\n\r\n  /**\r\n   * Invoke the action handler\r\n   * @internal\r\n   */\r\n  onTriggerAction(action: Action) {\r\n    const args = action.args || [];\r\n    action.handler(...args);\r\n  }\r\n\r\n  scrollDown() {\r\n    this.elRef.nativeElement.scrollBy(0, 52);\r\n  }\r\n\r\n  scrollUp() {\r\n    this.elRef.nativeElement.scrollBy(0, -52);\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  HostListener,\r\n  Output,\r\n  EventEmitter,\r\n  Input\r\n} from '@angular/core';\r\nimport { userAgent } from '@igo2/utils';\r\n\r\n/**\r\n * IgoLongPress trigger longpress event after a define duration.\r\n * This directive exist to patch the unavailable contextmenu event on iOS.\r\n * @param touchDuration touch duration in ms, default value is 400ms\r\n * @param iOSOnly define if longpress is triggered only for iOS, default value = true\r\n */\r\n@Directive({\r\n  selector: '[igoLongPress]'\r\n})\r\nexport class LongPressDirective {\r\n  private touchTimeout: any;\r\n  @Input() touchDuration: number = 400;\r\n  @Input() onlyIOS: boolean = true;\r\n  @Output() longpress = new EventEmitter();\r\n\r\n  constructor() {}\r\n\r\n  @HostListener('touchstart', ['$event'])\r\n  public touchstart(e: TouchEvent) {\r\n    if (e.touches.length > 1) {\r\n      this.touchEnd();\r\n      return;\r\n    }\r\n    this.touchTimeout = setTimeout(() => {\r\n      if (this.onlyIOS) {\r\n        if (userAgent.getOSName() === 'iOS') {\r\n          this.longpress.emit(e);\r\n        }\r\n      } else {\r\n        this.longpress.emit(e);\r\n      }\r\n    }, this.touchDuration);\r\n  }\r\n  @HostListener('touchmove')\r\n  @HostListener('touchcancel')\r\n  @HostListener('touchend')\r\n  public touchend() {\r\n    this.touchEnd();\r\n  }\r\n\r\n  private touchEnd() {\r\n    clearTimeout(this.touchTimeout);\r\n  }\r\n}\r\n","import {\n  Input,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  Component,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ViewContainerRef,\n  ViewChild\n} from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { DynamicComponent } from '../shared/dynamic-component';\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\n\n@Component({\n  selector: 'igo-dynamic-outlet',\n  templateUrl: 'dynamic-outlet.component.html',\n  styleUrls: ['dynamic-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\n  /**\n   * The dynamic component base class or the dynamic component itself\n   */\n  @Input() component: DynamicComponent<any> | any;\n\n  /**\n   * The dynamic component inputs\n   */\n  @Input() inputs: { [key: string]: any } = {};\n\n  /**\n   * The subscribers to the dynamic component outputs\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * The dynamic component\n   */\n  private dynamicComponent: DynamicComponent<any>;\n\n  /**\n   * The view element to render the component to\n   * @ignore\n   */\n  @ViewChild('target', { read: ViewContainerRef, static: true })\n  private target: ViewContainerRef;\n\n  constructor(\n    private dynamicComponentService: DynamicComponentService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * If the dynamic component changes, create it.\n   * If the inputs or subscribers change, update the current component's\n   * inputs or subscribers.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const component = changes.component;\n    const inputs = changes.inputs;\n    const subscribers = changes.subscribers;\n    const eq = ObjectUtils.objectsAreEquivalent;\n\n    if (!component || !component.currentValue) {\n      return;\n    }\n\n    if (component.currentValue !== component.previousValue) {\n      this.createComponent(component.currentValue);\n    } else {\n      const inputsAreEquivalents =\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\n      const subscribersAreEquivalents =\n        subscribers &&\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\n\n      if (inputsAreEquivalents === false) {\n        this.updateInputs();\n      }\n\n      if (subscribersAreEquivalents === false) {\n        this.updateSubscribers();\n      }\n    }\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * Destroy the dynamic component and all it's subscribers\n   * @internal\n   */\n  ngOnDestroy() {\n    if (this.dynamicComponent) {\n      this.dynamicComponent.destroy();\n    }\n  }\n\n  /**\n   * Create a  DynamicComponent out of the component class and render it.\n   * @internal\n   */\n  private createComponent(component: DynamicComponent<any> | any) {\n    if (this.dynamicComponent !== undefined) {\n      this.dynamicComponent.destroy();\n    }\n    this.dynamicComponent =\n      component instanceof DynamicComponent\n        ? component\n        : this.dynamicComponentService.create(component);\n    this.renderComponent();\n  }\n\n  /**\n   * Create and render the dynamic component. Set it's inputs and subscribers\n   * @internal\n   */\n  private renderComponent() {\n    this.updateInputs();\n    this.updateSubscribers();\n    this.dynamicComponent.setTarget(this.target);\n  }\n\n  /**\n   * Update the dynamic component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateInputs() {\n    this.dynamicComponent.updateInputs(this.inputs);\n  }\n\n  /**\n   * Update the dynamic component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateSubscribers() {\n    this.dynamicComponent.updateSubscribers(this.subscribers);\n  }\n}\n","<ng-template #target></ng-template>\n","import { FormFieldService } from './form-field.service';\n\nexport function IgoFormFieldComponent(type: string): (cls: any) => any {\n  return (compType: any) => {\n    FormFieldService.register(type, compType);\n  };\n}\n","import { AbstractControl } from '@angular/forms';\r\n\r\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\r\n\r\nexport function formControlIsRequired(control: AbstractControl): boolean {\r\n  if (control.validator) {\r\n    const validator = control.validator({} as AbstractControl);\r\n    if (validator && validator.required) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  if ((control as any).controls) {\r\n    const requiredControl = Object.keys((control as any).controls).find(\r\n      (key: string) => {\r\n        return formControlIsRequired((control as any).controls[key]);\r\n      }\r\n    );\r\n    return requiredControl !== undefined;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport function getDefaultErrorMessages(): { [key: string]: string } {\r\n  return {\r\n    required: 'igo.common.form.errors.required'\r\n  };\r\n}\r\n\r\nexport function getControlErrorMessage(\r\n  control: AbstractControl,\r\n  messages: { [key: string]: string }\r\n): string {\r\n  const errors = control.errors || {};\r\n  const errorKeys = Object.keys(errors);\r\n  const errorMessages = errorKeys\r\n    .map((key: string) => messages[key])\r\n    .filter((message: string) => message !== undefined);\r\n  return errorMessages.length > 0 ? errorMessages[0] : '';\r\n}\r\n\r\nexport function getAllFormFields(form: Form): FormField[] {\r\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\r\n    return acc.concat(group.fields);\r\n  }, [].concat(form.fields));\r\n}\r\n\r\nexport function getFormFieldByName(form: Form, name: string): FormField {\r\n  const fields = getAllFormFields(form);\r\n  return fields.find((field: FormField) => {\r\n    return field.name === name;\r\n  });\r\n}\r\n","<ng-container *ngIf=\"field !== undefined\">\r\n  <igo-dynamic-outlet\r\n    [component]=\"getFieldComponent()\"\r\n    [inputs]=\"getFieldInputs()\"\r\n    [subscribers]=\"getFieldSubscribers()\"\r\n  >\r\n  </igo-dynamic-outlet>\r\n</ng-container>\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport {\r\n  FormField,\r\n  FormFieldInputs,\r\n  FormFieldOptions,\r\n  FormFieldSubscribers\r\n} from '../shared/form.interfaces';\r\nimport { FormFieldService } from '../shared/form-field.service';\r\nimport { getDefaultErrorMessages } from '../shared';\r\n\r\n/**\r\n * This component renders the proper form input based on\r\n * the field configuration it receives.\r\n */\r\n@Component({\r\n  selector: 'igo-form-field',\r\n  templateUrl: './form-field.component.html',\r\n  styleUrls: ['./form-field.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormFieldComponent {\r\n  /**\r\n   * Field configuration\r\n   */\r\n  @Input() field: FormField;\r\n\r\n  /**\r\n   * Field inputs cache\r\n   */\r\n  private fieldInputs: FormFieldInputs = undefined;\r\n\r\n  /**\r\n   * Field subscribers cache\r\n   */\r\n  private fieldSubscribers: FormFieldSubscribers = undefined;\r\n\r\n  get fieldOptions(): FormFieldOptions {\r\n    return this.field.options || {};\r\n  }\r\n\r\n  constructor(private formFieldService: FormFieldService) {}\r\n\r\n  getFieldComponent(): any {\r\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\r\n  }\r\n\r\n  getFieldInputs(): FormFieldInputs {\r\n    if (this.fieldInputs !== undefined) {\r\n      return this.fieldInputs;\r\n    }\r\n\r\n    const errors = this.fieldOptions.errors || {};\r\n    this.fieldInputs = Object.assign(\r\n      {\r\n        placeholder: this.field.title,\r\n        disableSwitch: this.fieldOptions.disableSwitch || false\r\n      },\r\n      Object.assign({}, this.field.inputs || {}),\r\n      {\r\n        formControl: this.field.control,\r\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\r\n      }\r\n    );\r\n    return this.fieldInputs;\r\n  }\r\n\r\n  getFieldSubscribers(): FormFieldSubscribers {\r\n    if (this.fieldSubscribers !== undefined) {\r\n      return this.fieldSubscribers;\r\n    }\r\n\r\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\r\n    return this.fieldSubscribers;\r\n  }\r\n}\r\n","<div *ngIf=\"group && group.fields.length > 0\" class=\"igo-form-group-fields\">\r\n  <div\r\n    *ngFor=\"let field of group.fields\"\r\n    class=\"igo-form-field-wrapper\"\r\n    [ngClass]=\"getFieldNgClass(field)\"\r\n  >\r\n    <igo-form-field [field]=\"field\"></igo-form-field>\r\n  </div>\r\n</div>\r\n\r\n<div class=\"igo-form-group-extra-content\">\r\n  <ng-content></ng-content>\r\n</div>\r\n\r\n<mat-error *ngIf=\"formControl.errors\">{{\r\n  getErrorMessage() | translate\r\n}}</mat-error>\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\nimport { UntypedFormGroup } from '@angular/forms';\r\n\r\nimport { getControlErrorMessage } from '../shared/form.utils';\r\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\r\n\r\n/**\r\n * A configurable form, optionnally bound to an entity\r\n * (for example in case of un update). Submitting that form\r\n * emits an event with the form data but no other operation is performed.\r\n */\r\n@Component({\r\n  selector: 'igo-form-group',\r\n  templateUrl: './form-group.component.html',\r\n  styleUrls: ['./form-group.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormGroupComponent {\r\n  /**\r\n   * Form field group\r\n   */\r\n  @Input() group: FormFieldGroup;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() errors: { [key: string]: string };\r\n\r\n  /**\r\n   * Form group control\r\n   */\r\n  get formControl(): UntypedFormGroup {\r\n    return this.group.control;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Return the number of columns a field should occupy.\r\n   * The maximum allowed is 2, even if the field config says more.\r\n   * @param field Field\r\n   * @returns Number of columns\r\n   * @internal\r\n   */\r\n  getFieldColSpan(field: FormField): number {\r\n    let colSpan = 2;\r\n    const options = field.options || {};\r\n    if (options.cols && options.cols > 0) {\r\n      colSpan = Math.min(options.cols, 2);\r\n    }\r\n\r\n    return colSpan;\r\n  }\r\n\r\n  /**\r\n   * Return the number of columns a field should occupy.\r\n   * The maximum allowed is 2, even if the field config says more.\r\n   * @param field Field\r\n   * @returns Number of columns\r\n   * @internal\r\n   */\r\n  getFieldNgClass(field: FormField): { [key: string]: boolean } {\r\n    const colspan = this.getFieldColSpan(field);\r\n    return { [`igo-form-field-colspan-${colspan}`]: true };\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  getErrorMessage(): string {\r\n    const options = this.group.options || {};\r\n    return getControlErrorMessage(this.formControl, options.errors || {});\r\n  }\r\n}\r\n","<mat-form-field>\r\n  <input\r\n    matInput\r\n    [required]=\"required\"\r\n    [placeholder]=\"placeholder\"\r\n    [formControl]=\"formControl\"\r\n  />\r\n  <mat-icon\r\n    *ngIf=\"disableSwitch === true\"\r\n    class=\"igo-form-disable-switch\"\r\n    [svgIcon]=\"\r\n      (disabled$ | async) === true\r\n        ? 'checkbox-blank-outline'\r\n        : 'checkbox-marked-outline'\r\n    \"\r\n    (click)=\"onDisableSwitchClick()\"\r\n    matPrefix\r\n  >\r\n  </mat-icon>\r\n  <mat-error *ngIf=\"formControl.errors\">{{\r\n    getErrorMessage() | translate\r\n  }}</mat-error>\r\n</mat-form-field>\r\n","import {\r\n  Input,\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport type { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport {\r\n  formControlIsRequired,\r\n  getControlErrorMessage\r\n} from '../shared/form.utils';\r\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\r\n\r\n/**\r\n * This component renders a text field\r\n */\r\n@IgoFormFieldComponent('text')\r\n@Component({\r\n  selector: 'igo-form-field-text',\r\n  templateUrl: './form-field-text.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormFieldTextComponent implements OnInit {\r\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * The field's form control\r\n   */\r\n  @Input() formControl: UntypedFormControl;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() errors: { [key: string]: string };\r\n\r\n  /**\r\n   * Wheter a disable switch should be available\r\n   */\r\n  @Input() disableSwitch: boolean = false;\r\n\r\n  /**\r\n   * Whether the field is required\r\n   */\r\n  get required(): boolean {\r\n    return formControlIsRequired(this.formControl);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.disabled$.next(this.formControl.disabled);\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  getErrorMessage(): string {\r\n    return getControlErrorMessage(this.formControl, this.errors);\r\n  }\r\n\r\n  onDisableSwitchClick() {\r\n    this.toggleDisabled();\r\n  }\r\n\r\n  private toggleDisabled() {\r\n    const disabled = !this.disabled$.value;\r\n    if (disabled === true) {\r\n      this.formControl.disable();\r\n    } else {\r\n      this.formControl.enable();\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n}\r\n","<mat-form-field>\r\n  <mat-select\r\n    [required]=\"required\"\r\n    [placeholder]=\"placeholder\"\r\n    [formControl]=\"formControl\"\r\n  >\r\n    <mat-option *ngFor=\"let choice of choices$ | async\" [value]=\"choice.value\">\r\n      {{ choice.title }}\r\n    </mat-option>\r\n  </mat-select>\r\n  <mat-icon\r\n    *ngIf=\"disableSwitch === true\"\r\n    class=\"igo-form-disable-switch\"\r\n    [svgIcon]=\"\r\n      (disabled$ | async) === true\r\n        ? 'checkbox-blank-outline'\r\n        : 'checkbox-marked-outline'\r\n    \"\r\n    (click)=\"onDisableSwitchClick()\"\r\n    matPrefix\r\n  >\r\n  </mat-icon>\r\n  <mat-error *ngIf=\"formControl.errors\">{{\r\n    getErrorMessage() | translate\r\n  }}</mat-error>\r\n</mat-form-field>\r\n","import {\r\n  Input,\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport type { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport {\r\n  formControlIsRequired,\r\n  getControlErrorMessage\r\n} from '../shared/form.utils';\r\nimport { FormFieldSelectChoice } from '../shared/form.interfaces';\r\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\r\n\r\n/**\r\n * This component renders a select field\r\n */\r\n@IgoFormFieldComponent('select')\r\n@Component({\r\n  selector: 'igo-form-field-select',\r\n  templateUrl: './form-field-select.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormFieldSelectComponent implements OnInit {\r\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Select input choices\r\n   */\r\n  @Input()\r\n  set choices(value: FormFieldSelectChoice[]) {\r\n    this.choices$.next(value);\r\n  }\r\n  get choices(): FormFieldSelectChoice[] {\r\n    return this.choices$.value;\r\n  }\r\n  readonly choices$: BehaviorSubject<FormFieldSelectChoice[]> =\r\n    new BehaviorSubject([]);\r\n\r\n  /**\r\n   * The field's form control\r\n   */\r\n  @Input() formControl: UntypedFormControl;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() errors: { [key: string]: string };\r\n\r\n  /**\r\n   * Wheter a disable switch should be available\r\n   */\r\n  @Input() disableSwitch: boolean = false;\r\n\r\n  /**\r\n   * Whether the field is required\r\n   */\r\n  get required(): boolean {\r\n    return formControlIsRequired(this.formControl);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.disabled$.next(this.formControl.disabled);\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  getErrorMessage(): string {\r\n    return getControlErrorMessage(this.formControl, this.errors);\r\n  }\r\n\r\n  onDisableSwitchClick() {\r\n    this.toggleDisabled();\r\n  }\r\n\r\n  private toggleDisabled() {\r\n    const disabled = !this.disabled$.value;\r\n    if (disabled === true) {\r\n      this.formControl.disable();\r\n    } else {\r\n      this.formControl.enable();\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n}\r\n","<mat-form-field>\r\n  <textarea\r\n    matInput\r\n    [required]=\"required\"\r\n    [placeholder]=\"placeholder\"\r\n    [formControl]=\"formControl\"\r\n  >\r\n  </textarea>\r\n  <mat-icon\r\n    *ngIf=\"disableSwitch === true\"\r\n    class=\"igo-form-disable-switch\"\r\n    [svgIcon]=\"\r\n      (disabled$ | async) === true\r\n        ? 'checkbox-blank-outline'\r\n        : 'checkbox-marked-outline'\r\n    \"\r\n    (click)=\"onDisableSwitchClick()\"\r\n    matPrefix\r\n  >\r\n  </mat-icon>\r\n  <mat-error *ngIf=\"formControl.errors\">{{\r\n    getErrorMessage() | translate\r\n  }}</mat-error>\r\n</mat-form-field>\r\n","import {\r\n  Input,\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport type { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport {\r\n  formControlIsRequired,\r\n  getControlErrorMessage\r\n} from '../shared/form.utils';\r\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\r\n\r\n/**\r\n * This component renders a textarea field\r\n */\r\n@IgoFormFieldComponent('textarea')\r\n@Component({\r\n  selector: 'igo-form-field-textarea',\r\n  templateUrl: './form-field-textarea.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormFieldTextareaComponent implements OnInit {\r\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * The field's form control\r\n   */\r\n  @Input() formControl: UntypedFormControl;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() errors: { [key: string]: string };\r\n\r\n  /**\r\n   * Wheter a disable switch should be available\r\n   */\r\n  @Input() disableSwitch: boolean = false;\r\n\r\n  /**\r\n   * Whether the field is required\r\n   */\r\n  get required(): boolean {\r\n    return formControlIsRequired(this.formControl);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.disabled$.next(this.formControl.disabled);\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  getErrorMessage(): string {\r\n    return getControlErrorMessage(this.formControl, this.errors);\r\n  }\r\n\r\n  onDisableSwitchClick() {\r\n    this.toggleDisabled();\r\n  }\r\n\r\n  private toggleDisabled() {\r\n    const disabled = !this.disabled$.value;\r\n    if (disabled === true) {\r\n      this.formControl.disable();\r\n    } else {\r\n      this.formControl.enable();\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  ChangeDetectionStrategy,\r\n  ViewChild,\r\n  ElementRef\r\n} from '@angular/core';\r\n\r\nimport { t } from 'typy';\r\n\r\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\r\nimport { getAllFormFields } from '../shared/form.utils';\r\n\r\n/**\r\n * A configurable form\r\n */\r\n@Component({\r\n  selector: 'igo-form',\r\n  templateUrl: './form.component.html',\r\n  styleUrls: ['./form.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormComponent implements OnChanges {\r\n  /**\r\n   * Form\r\n   */\r\n  @Input() form: Form;\r\n\r\n  /**\r\n   * Input data\r\n   */\r\n  @Input() formData: { [key: string]: any };\r\n\r\n  /**\r\n   * Form autocomplete\r\n   */\r\n  @Input() autocomplete: string = 'off';\r\n\r\n  /**\r\n   * Event emitted when the form is submitted\r\n   */\r\n  @Output() submitForm = new EventEmitter<{ [key: string]: any }>();\r\n\r\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\r\n\r\n  get hasButtons(): boolean {\r\n    return this.buttons.nativeElement.children.length !== 0;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Is the entity or the template change, recreate the form or repopulate it.\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const formData = changes.formData;\r\n    if (formData && formData.currentValue !== formData.previousValue) {\r\n      if (formData.currentValue === undefined) {\r\n        this.clear();\r\n      } else {\r\n        this.setData(formData.currentValue);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transform the form data to a feature and emit an event\r\n   * @param event Form submit event\r\n   * @internal\r\n   */\r\n  onSubmit() {\r\n    this.submitForm.emit(this.getData());\r\n  }\r\n\r\n  getData(): { [key: string]: any } {\r\n    const data = {};\r\n    getAllFormFields(this.form).forEach((field: FormField) => {\r\n      this.updateDataWithFormField(data, field);\r\n    });\r\n    return data;\r\n  }\r\n\r\n  private setData(data: { [key: string]: any }) {\r\n    this.form.fields.forEach((field: FormField) => {\r\n      field.control.setValue(t(data, field.name).safeObject);\r\n    });\r\n\r\n    this.form.groups.forEach((group: FormFieldGroup) => {\r\n      group.fields.forEach((field: FormField) => {\r\n        field.control.setValue(t(data, field.name).safeObject);\r\n      });\r\n    });\r\n  }\r\n\r\n  private updateDataWithFormField(\r\n    data: { [key: string]: any },\r\n    field: FormField\r\n  ) {\r\n    const control = field.control;\r\n    if (!control.disabled) {\r\n      data[field.name] = control.value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear form\r\n   */\r\n  private clear() {\r\n    this.form.control.reset();\r\n  }\r\n}\r\n","<form\r\n  [autocomplete]=\"autocomplete\"\r\n  [formGroup]=\"form.control\"\r\n  (ngSubmit)=\"onSubmit()\"\r\n>\r\n  <div\r\n    class=\"igo-form-body\"\r\n    [ngClass]=\"{ 'igo-form-body-with-buttons': hasButtons }\"\r\n  >\r\n    <div class=\"igo-form-content\">\r\n      <ng-content></ng-content>\r\n    </div>\r\n    <div #buttons class=\"igo-form-buttons\">\r\n      <ng-content select=\"[formButtons]\"></ng-content>\r\n    </div>\r\n  </div>\r\n</form>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  OnDestroy,\r\n  Input,\r\n  ViewChild,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { Media, MediaService } from '@igo2/core';\r\n\r\nimport { FlexibleState, FlexibleDirection } from './flexible.type';\r\n\r\n@Component({\r\n  selector: 'igo-flexible',\r\n  templateUrl: './flexible.component.html',\r\n  styleUrls: ['./flexible.component.scss']\r\n})\r\nexport class FlexibleComponent implements OnInit, OnDestroy {\r\n  static transitionTime = 250;\r\n\r\n  @ViewChild('flexibleMain', { static: true }) main;\r\n\r\n  @Input()\r\n  get initial(): string {\r\n    return this._initial;\r\n  }\r\n  set initial(value: string) {\r\n    this._initial = value;\r\n  }\r\n  private _initial = '0';\r\n\r\n  @Input()\r\n  get collapsed(): string {\r\n    return this._collapsed;\r\n  }\r\n  set collapsed(value: string) {\r\n    this._collapsed = value;\r\n  }\r\n  private _collapsed = '0';\r\n\r\n  @Input()\r\n  get expanded(): string {\r\n    return this._expanded;\r\n  }\r\n  set expanded(value: string) {\r\n    this._expanded = value;\r\n  }\r\n  private _expanded = '100%';\r\n\r\n  @Input()\r\n  get initialMobile(): string {\r\n    return this._initialMobile;\r\n  }\r\n  set initialMobile(value: string) {\r\n    this._initialMobile = value;\r\n  }\r\n  private _initialMobile: string = this.expanded;\r\n\r\n  @Input()\r\n  get collapsedMobile(): string {\r\n    return this._collapsedMobile;\r\n  }\r\n  set collapsedMobile(value: string) {\r\n    this._collapsedMobile = value;\r\n  }\r\n  private _collapsedMobile: string = this.collapsed;\r\n\r\n  @Input()\r\n  get expandedMobile(): string {\r\n    return this._expandedMobile;\r\n  }\r\n  set expandedMobile(value: string) {\r\n    this._expandedMobile = value;\r\n  }\r\n  private _expandedMobile: string = this.expanded;\r\n\r\n  @Input()\r\n  get direction(): FlexibleDirection {\r\n    return this._direction;\r\n  }\r\n  set direction(value: FlexibleDirection) {\r\n    this._direction = value;\r\n  }\r\n  private _direction: FlexibleDirection = 'column';\r\n\r\n  @Input()\r\n  get state(): FlexibleState {\r\n    return this._state;\r\n  }\r\n  set state(value: FlexibleState) {\r\n    const sizes = {\r\n      initial: this.initial,\r\n      collapsed: this.collapsed,\r\n      expanded: this.expanded\r\n    };\r\n\r\n    if (this.mediaService.isMobile()) {\r\n      Object.assign(sizes, {\r\n        initial: this.initialMobile,\r\n        collapsed: this.collapsedMobile,\r\n        expanded: this.expandedMobile\r\n      });\r\n    }\r\n\r\n    const size = sizes[value];\r\n    if (size !== undefined) {\r\n      this.setSize(size);\r\n      setTimeout(() => {\r\n        this._state = value;\r\n      }, FlexibleComponent.transitionTime);\r\n    }\r\n  }\r\n  private _state: FlexibleState = 'initial';\r\n\r\n  private mediaService$$: Subscription;\r\n\r\n  constructor(\r\n    private el: ElementRef,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.el.nativeElement.className += this.direction;\r\n\r\n    // Since this component supports different sizes\r\n    // on mobile, force a redraw when the media changes\r\n    this.mediaService$$ = this.mediaService.media$.subscribe(\r\n      (media: Media) => (this.state = this.state)\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    if (this.mediaService$$) {\r\n      this.mediaService$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  private setSize(size: string) {\r\n    this._state = 'transition';\r\n\r\n    if (this.direction === 'column') {\r\n      this.main.nativeElement.style.height = size;\r\n    } else if (this.direction === 'row') {\r\n      this.main.nativeElement.style.width = size;\r\n    }\r\n  }\r\n}\r\n","<div #flexibleMain class=\"igo-flexible-main {{ state }} {{ direction }}\">\r\n  <div class=\"igo-container\">\r\n    <ng-content></ng-content>\r\n  </div>\r\n</div>\r\n<div class=\"igo-flexible-fill\">\r\n  <div>\r\n    <div class=\"igo-container\">\r\n      <ng-content select=\"[igoFlexibleFill]\"></ng-content>\r\n    </div>\r\n  </div>\r\n</div>\r\n","<ng-container *ngIf=\"showTourButton\">\n  <button\n    *ngIf=\"styleButton === 'icon'; else raisedButton\"\n    (click)=\"startInteractiveTour()\"\n    [ngClass]=\"getClass()\"\n    color=\"primary\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      disabledTourButton\n        ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n          | translate)\n        : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n    \"\n    [disabled]=\"disabledTourButton\"\n  >\n    <mat-icon iconPositionEnd svgIcon=\"presentation-play\"> </mat-icon>\n  </button>\n\n  <ng-template #raisedButton>\n    <button\n      (click)=\"startInteractiveTour()\"\n      [ngClass]=\"getClass()\"\n      color=\"primary\"\n      mat-raised-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"disabledTourButton\"\n    >\n      {{ 'igo.common.interactiveTour.buttonTitle' | translate }}\n      {{ discoverTitleInLocale$ | async | translate }}\n      <mat-icon\n        iconPositionEnd\n        svgIcon=\"presentation-play\"\n        [matTooltip]=\"\n          disabledTourButton\n            ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n              | translate)\n            : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n        \"\n      >\n      </mat-icon>\n    </button>\n  </ng-template>\n</ng-container>\n","import { Component, ViewEncapsulation, Input } from '@angular/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { ToolService } from '../tool/shared/tool.service';\nimport { Observable, of } from 'rxjs';\n\n@Component({\n  selector: 'igo-interactive-tour',\n  templateUrl: './interactive-tour.component.html',\n  styleUrls: ['./interactive-tour.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class InteractiveTourComponent {\n  /**\n   * Toolbox that holds main tools\n   */\n  @Input() tourToStart: string = '';\n  @Input() styleButton: 'icon' | 'raised';\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\n\n  getClass() {\n    return {\n      'tour-button-tool-icon': this.styleButton === 'icon',\n      'tour-button-tool': this.styleButton === 'raised'\n    };\n  }\n\n  get toolbox() {\n    return this.toolService.toolbox;\n  }\n\n  getTourToStart() {\n    if (this.tourToStart) {\n      return this.tourToStart;\n    } else {\n      return this.activeToolName;\n    }\n  }\n\n  get activeToolName() {\n    if (this.toolbox) {\n      if (this.isActiveTool) {\n        return this.toolbox.activeTool$.getValue().name;\n      } else {\n        return 'global';\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  get isActiveTool(): boolean {\n    if (this.toolbox) {\n      return this.toolbox.activeTool$.getValue() !== undefined;\n    } else {\n      return undefined;\n    }\n  }\n\n  get isToolHaveTour(): boolean {\n    if (this.activeToolName === 'about' && !this.tourToStart) {\n      return false;\n    }\n    return this.interactiveTourService.isToolHaveTourConfig(\n      this.getTourToStart()\n    );\n  }\n\n  get showTourButton(): boolean {\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\n    let haveTour: boolean;\n    haveTour = this.isToolHaveTour;\n    if (haveTour === false) {\n      return false;\n    }\n\n    let inMobileAndShow: boolean;\n    if (this.interactiveTourService.isMobile()) {\n      inMobileAndShow = this.isTourDisplayInMobile;\n      if (inMobileAndShow === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get isTourDisplayInMobile(): boolean {\n    return this.interactiveTourService.isTourDisplayInMobile();\n  }\n\n  get disabledTourButton(): boolean {\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\n  }\n\n  constructor(\n    private interactiveTourService: InteractiveTourService,\n    private toolService: ToolService\n  ) {}\n\n  startInteractiveTour() {\n    const tour = this.getTourToStart();\n    if (tour) {\n      this.interactiveTourService.startTour(tour);\n    } else {\n      return;\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-spinner',\r\n  templateUrl: './spinner.component.html',\r\n  styleUrls: ['./spinner.component.scss']\r\n})\r\nexport class SpinnerComponent {\r\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  @Input()\r\n  set shown(value: boolean) {\r\n    this.shown$.next(value);\r\n  }\r\n  get shown(): boolean {\r\n    return this.shown$.value;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  show() {\r\n    this.shown = true;\r\n  }\r\n\r\n  hide() {\r\n    this.shown = false;\r\n  }\r\n}\r\n","<div\r\n  [ngClass]=\"{\r\n    'igo-spinner-container': true,\r\n    'igo-spinner-shown': (shown$ | async)\r\n  }\"\r\n>\r\n  <div class=\"igo-spinner-background\"></div>\r\n  <mat-progress-spinner\r\n    diameter=\"40\"\r\n    mode=\"indeterminate\"\r\n  ></mat-progress-spinner>\r\n</div>\r\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { ActivityService } from '@igo2/core';\nimport { SpinnerComponent } from './spinner.component';\n\n/**\n * A directive to bind a SpinnerComponent to the activity service.\n * The activity service tracks any HTTP request and this directive\n * will display the spinner it's attached to when the activity counter\n * is greater than 0.\n */\n@Directive({\n  selector: '[igoSpinnerActivity]'\n})\nexport class SpinnerActivityDirective implements OnInit, OnDestroy {\n  /**\n   * Subscription to the activity service counter\n   */\n  private counter$$: Subscription;\n\n  constructor(\n    @Self() private spinner: SpinnerComponent,\n    private activityService: ActivityService\n  ) {}\n\n  /**\n   * Subscribe to the activity service counter and display the spinner\n   * when it's is greater than 0.\n   * @internal\n   */\n  ngOnInit() {\n    this.counter$$ = this.activityService.counter$\n      .pipe(debounceTime(50))\n      .subscribe((count: number) => {\n        count > 0 ? this.spinner.show() : this.spinner.hide();\n      });\n  }\n\n  /**\n   * Unsubcribe to the activity service counter.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.counter$$.unsubscribe();\n  }\n}\n","import { DataSource } from '@angular/cdk/table';\r\nimport { MatSort } from '@angular/material/sort';\r\n\r\nimport { Observable, BehaviorSubject, merge } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { TableModel } from './table-model.interface';\r\nimport { TableDatabase } from './table-database';\r\n\r\nexport class TableDataSource extends DataSource<any> {\r\n  get filter(): string {\r\n    return this._filterChange.value;\r\n  }\r\n  set filter(filter: string) {\r\n    this._filterChange.next(filter);\r\n  }\r\n  private _filterChange = new BehaviorSubject('');\r\n\r\n  constructor(\r\n    private _database: TableDatabase,\r\n    private _model: TableModel,\r\n    private _sort: MatSort\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  // Connect function called by the table to retrieve one stream containing\r\n  // the data to render.\r\n  connect(): Observable<any[]> {\r\n    if (!this._database) {\r\n      return merge([]);\r\n    }\r\n    const displayDataChanges = [\r\n      this._database.dataChange,\r\n      this._filterChange,\r\n      this._sort.sortChange\r\n    ];\r\n\r\n    return merge(...displayDataChanges).pipe(\r\n      map(() => {\r\n        return this.getFilteredData(this._database.data);\r\n      }),\r\n      map((data) => {\r\n        return this.getSortedData(data);\r\n      })\r\n    );\r\n  }\r\n\r\n  disconnect() {}\r\n\r\n  getFilteredData(data): any[] {\r\n    if (!this.filter) {\r\n      return data;\r\n    }\r\n    return data.slice().filter((item: any) => {\r\n      const searchStr: string = this._model.columns\r\n        .filter((c) => c.filterable)\r\n        .map((c) => ObjectUtils.resolve(item, c.name))\r\n        .join(' ')\r\n        .toLowerCase();\r\n\r\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\r\n    });\r\n  }\r\n\r\n  getSortedData(data): any[] {\r\n    if (!this._sort.active || this._sort.direction === '') {\r\n      return data;\r\n    }\r\n\r\n    return data.sort((a, b) => {\r\n      const propertyA: number | string = ObjectUtils.resolve(\r\n        a,\r\n        this._sort.active\r\n      );\r\n      const propertyB: number | string = ObjectUtils.resolve(\r\n        b,\r\n        this._sort.active\r\n      );\r\n\r\n      return ObjectUtils.naturalCompare(\r\n        propertyB,\r\n        propertyA,\r\n        this._sort.direction\r\n      );\r\n    });\r\n  }\r\n}\r\n","export enum TableActionColor {\n  primary,\n  accent,\n  warn\n}\n","<div class=\"table-box\">\r\n  <div class=\"table-header\" *ngIf=\"hasFilterInput\">\r\n    <mat-form-field floatPlaceholder=\"never\">\r\n      <input\r\n        matInput\r\n        #filter\r\n        [placeholder]=\"'igo.common.table.filter' | translate\"\r\n      />\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"table-container\">\r\n    <table mat-table #table [dataSource]=\"dataSource\" matSort>\r\n      <!-- Checkbox Column -->\r\n      <ng-container matColumnDef=\"selectionCheckbox\">\r\n        <th mat-header-cell *matHeaderCellDef>\r\n          <mat-checkbox\r\n            (change)=\"$event ? masterToggle() : null\"\r\n            [checked]=\"selection.hasValue() && isAllSelected()\"\r\n            [indeterminate]=\"selection.hasValue() && !isAllSelected()\"\r\n          >\r\n          </mat-checkbox>\r\n        </th>\r\n        <td mat-cell *matCellDef=\"let row\">\r\n          <mat-checkbox\r\n            (click)=\"$event.stopPropagation()\"\r\n            (change)=\"$event ? selection.toggle(row) : null\"\r\n            [checked]=\"selection.isSelected(row)\"\r\n          >\r\n          </mat-checkbox>\r\n        </td>\r\n      </ng-container>\r\n\r\n      <ng-container\r\n        [matColumnDef]=\"column.name\"\r\n        *ngFor=\"let column of model.columns\"\r\n      >\r\n        <ng-container *ngIf=\"column.sortable\">\r\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>\r\n            {{ column.title }}\r\n          </th>\r\n        </ng-container>\r\n\r\n        <ng-container *ngIf=\"!column.sortable\">\r\n          <th mat-header-cell *matHeaderCellDef>{{ column.title }}</th>\r\n        </ng-container>\r\n\r\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\r\n          <td\r\n            mat-cell\r\n            *matCellDef=\"let row\"\r\n            class=\"mat-cell-text\"\r\n            [ngClass]=\"\r\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\r\n            \"\r\n          >\r\n            {{ getValue(row, column.name) }}\r\n          </td>\r\n        </ng-container>\r\n\r\n        <ng-template #cellHTML>\r\n          <td\r\n            mat-cell\r\n            *matCellDef=\"let row\"\r\n            class=\"mat-cell-text\"\r\n            [ngClass]=\"\r\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\r\n            \"\r\n            [innerHTML]=\"getValue(row, column.name)\"\r\n          ></td>\r\n        </ng-template>\r\n      </ng-container>\r\n\r\n      <!-- Action Column -->\r\n      <ng-container matColumnDef=\"action\">\r\n        <th mat-header-cell *matHeaderCellDef></th>\r\n        <td mat-cell *matCellDef=\"let row\">\r\n          <button\r\n            *ngFor=\"let action of model.actions\"\r\n            mat-mini-fab\r\n            [color]=\"getActionColor(action.color)\"\r\n            (click)=\"handleClickAction($event, action, row)\"\r\n          >\r\n            <mat-icon svgIcon=\"{{ action.icon }}\"></mat-icon>\r\n          </button>\r\n        </td>\r\n      </ng-container>\r\n\r\n      <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\r\n      <tr\r\n        mat-row\r\n        *matRowDef=\"let row; columns: displayedColumns\"\r\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\r\n        (click)=\"selection.toggle(row)\"\r\n      ></tr>\r\n    </table>\r\n  </div>\r\n</div>\r\n","import {\r\n  Component,\r\n  ElementRef,\r\n  ViewChild,\r\n  Input,\r\n  Output,\r\n  OnChanges,\r\n  OnInit,\r\n  AfterViewInit,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { MatSort } from '@angular/material/sort';\r\nimport { SelectionModel } from '@angular/cdk/collections';\r\n\r\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\r\nimport { fromEvent } from 'rxjs';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { TableModel } from './table-model.interface';\r\nimport { TableDatabase } from './table-database';\r\nimport { TableDataSource } from './table-datasource';\r\nimport { TableActionColor } from './table-action-color.enum';\r\n\r\n@Component({\r\n  selector: 'igo-table',\r\n  templateUrl: './table.component.html',\r\n  styleUrls: ['./table.component.scss']\r\n})\r\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\r\n  @Input()\r\n  get database(): TableDatabase {\r\n    return this._database;\r\n  }\r\n  set database(value: TableDatabase) {\r\n    this._database = value;\r\n  }\r\n  private _database: TableDatabase;\r\n\r\n  @Input()\r\n  get model(): TableModel {\r\n    return this._model;\r\n  }\r\n  set model(value: TableModel) {\r\n    this._model = value;\r\n  }\r\n  private _model: TableModel;\r\n\r\n  @Input()\r\n  get hasFilterInput(): boolean {\r\n    return this._hasFIlterInput;\r\n  }\r\n  set hasFilterInput(value: boolean) {\r\n    this._hasFIlterInput = value;\r\n  }\r\n  private _hasFIlterInput = true;\r\n\r\n  public displayedColumns;\r\n  public dataSource: TableDataSource | null;\r\n  public selection = new SelectionModel<any>(true, []);\r\n\r\n  @Output()\r\n  select = new EventEmitter<{\r\n    added: any[];\r\n    removed: any[];\r\n    source: SelectionModel<any>;\r\n  }>();\r\n\r\n  @ViewChild('filter') filter: ElementRef;\r\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\r\n\r\n  ngOnInit() {\r\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\r\n\r\n    if (this.model) {\r\n      this.displayedColumns = this.model.columns\r\n        .filter((c) => c.displayed !== false)\r\n        .map((c) => c.name);\r\n\r\n      if (this.model.selectionCheckbox) {\r\n        this.displayedColumns.unshift('selectionCheckbox');\r\n      }\r\n      if (this.model.actions && this.model.actions.length) {\r\n        this.displayedColumns.push('action');\r\n      }\r\n    }\r\n\r\n    this.selection.changed.subscribe((e) => this.select.emit(e));\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    if (this.filter) {\r\n      fromEvent(this.filter.nativeElement, 'keyup')\r\n        .pipe(debounceTime(150), distinctUntilChanged())\r\n        .subscribe(() => {\r\n          if (!this.dataSource) {\r\n            return;\r\n          }\r\n          this.dataSource.filter = this.filter.nativeElement.value;\r\n        });\r\n    }\r\n  }\r\n\r\n  ngOnChanges(change) {\r\n    if (change.database) {\r\n      this.dataSource = new TableDataSource(\r\n        this.database,\r\n        this.model,\r\n        this.sort\r\n      );\r\n      this.selection.clear();\r\n    }\r\n  }\r\n\r\n  getActionColor(colorId: number): string {\r\n    return TableActionColor[colorId];\r\n  }\r\n\r\n  getValue(row, key) {\r\n    return ObjectUtils.resolve(row, key);\r\n  }\r\n\r\n  /** Whether the number of selected elements matches the total number of rows. */\r\n  isAllSelected() {\r\n    const numSelected = this.selection.selected.length;\r\n    const numRows = this.database.data.length;\r\n    return numSelected === numRows;\r\n  }\r\n\r\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\r\n  masterToggle() {\r\n    this.isAllSelected()\r\n      ? this.selection.clear()\r\n      : this.database.data.forEach((row) => this.selection.select(row));\r\n  }\r\n\r\n  handleClickAction(event, action, row) {\r\n    event.stopPropagation();\r\n    action.click(row);\r\n  }\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\n\nexport class TableDatabase {\n  /** Stream that emits whenever the data has been modified. */\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\n  get data(): any[] {\n    return this.dataChange.value;\n  }\n\n  constructor(data?) {\n    if (data) {\n      this.dataChange.next(data);\n    }\n  }\n\n  set(data) {\n    this.dataChange.next(data);\n  }\n\n  add(item) {\n    const copiedData = this.data.slice();\n    copiedData.push(item);\n    this.set(copiedData);\n  }\n\n  remove(item) {\n    const copiedData = this.data.slice();\n    const index = copiedData.indexOf(item);\n    copiedData.splice(index, 1);\n    this.set(copiedData);\n  }\n}\n","import { Tool } from './tool.interface';\r\nimport { ToolService } from './tool.service';\r\n\r\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\r\n  return (compType: any) => {\r\n    ToolService.register(\r\n      Object.assign({}, tool, {\r\n        component: compType\r\n      } as Tool)\r\n    );\r\n  };\r\n}\r\n","export enum ToolboxColor {\n  White = 'white',\n  Grey = 'grey',\n  Primary = 'primary'\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translate3d(0, 0, 0)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","<igo-actionbar\r\n  *ngIf=\"(toolbar$ | async).length > 0\"\r\n  [store]=\"actionStore\"\r\n  [withIcon]=\"true\"\r\n  [withTitle]=\"toolbarWithTitle$ | async\"\r\n  [withTooltip]=\"(toolbarWithTitle$ | async) === false\"\r\n  [scrollActive]=\"toolbarWithTitle$ | async\"\r\n  [horizontal]=\"false\"\r\n>\r\n</igo-actionbar>\r\n\r\n<div\r\n  *ngIf=\"activeTool$ | async as tool\"\r\n  class=\"igo-tool-container mat-body-1\"\r\n  [ngClass]=\"{\r\n    'igo-tool-container-with-toolbar': !actionStore.empty,\r\n    'igo-tool-container-with-animation': animate\r\n  }\"\r\n  [@toolSlideInOut]=\"animation$ | async\"\r\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\r\n  (@toolSlideInOut.done)=\"onAnimationComplete()\"\r\n>\r\n  <igo-dynamic-outlet\r\n    [component]=\"tool.component\"\r\n    [inputs]=\"getToolInputs(tool)\"\r\n  >\r\n  </igo-dynamic-outlet>\r\n</div>\r\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  HostBinding,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Subscription, BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Action, ActionStore } from '../../action';\nimport { Tool } from '../shared/tool.interface';\nimport { ToolboxColor } from '../shared/toolbox.enums';\nimport { Toolbox } from '../shared/toolbox';\nimport { toolSlideInOut } from './toolbox.animation';\n\n@Component({\n  selector: 'igo-toolbox',\n  templateUrl: 'toolbox.component.html',\n  styleUrls: ['toolbox.component.scss'],\n  animations: [toolSlideInOut()],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ToolboxComponent implements OnInit, OnDestroy {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  get isActive(): boolean {\n    return !!this.activeTool$.value;\n  }\n\n  /**\n   * Store of actions that toggle tools\n   */\n  actionStore: ActionStore = new ActionStore([]);\n\n  /**\n   * Observable of he anmation state\n   */\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\n\n  /**\n   * Observable of the toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Whether the Toolbar should display actions' titles\n   */\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\n    map((tool: Tool | undefined) => tool === undefined)\n  );\n\n  /**\n   * Subscription to the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Subscription to the toolbar\n   */\n  private toolbar$$: Subscription;\n\n  /**\n   * Observable of the ongoing animation. This is useful when\n   * multiple animations are triggered at once i.e. when the user clicks\n   * too fast on different actions\n   */\n  private animating$ = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Subscription to the ongoing animation\n   */\n  private animating$$: Subscription;\n\n  /**\n   * Toolbox\n   */\n  @Input() toolbox: Toolbox;\n\n  /**\n   * Whether the toolbox should animate the first tool entering\n   */\n  @Input() animate: boolean = false;\n\n  /**\n   * Color of Toolbox\n   */\n  @Input() color: ToolboxColor = ToolboxColor.White;\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-grey')\n  get classColorGrey() {\n    return this.color === ToolboxColor.Grey;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-primary')\n  get classColorPrimary() {\n    return this.color === ToolboxColor.Primary;\n  }\n\n  /**\n   * Initialize the toolbar and subscribe to the active tool\n   * @internal\n   */\n  ngOnInit() {\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\n      this.onToolbarChange(toolbar)\n    );\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\n      this.onActiveToolChange(tool)\n    );\n  }\n\n  /**\n   * Unsubscribe to the active tool and destroy the action store\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toolbar$$.unsubscribe();\n    this.activeTool$$.unsubscribe();\n    this.actionStore.destroy();\n  }\n\n  /**\n   * Track the starting animation\n   * @internal\n   */\n  onAnimationStart() {\n    this.animating$.next(true);\n  }\n\n  /**\n   * Untrack the completed animation\n   * @internal\n   */\n  onAnimationComplete() {\n    this.animating$.next(false);\n  }\n\n  /**\n   * Return a tool's inputs\n   * @param tool Tool\n   * @returns Tool inputs\n   * @internal\n   */\n  getToolInputs(tool: Tool): { [key: string]: any } {\n    return tool.options || {};\n  }\n\n  /**\n   * Initialize an action store\n   * @param toolbar Toolbar\n   */\n  private onToolbarChange(toolbar: string[]) {\n    this.setToolbar(toolbar);\n  }\n\n  /**\n   * Activate a tool and trigger an animation or not\n   * @param tool Tool to activate\n   */\n  private onActiveToolChange(tool: Tool) {\n    if (!this.animate) {\n      this.setActiveTool(tool);\n      return;\n    }\n    this.onAnimate(() => this.setActiveTool(tool));\n  }\n\n  /**\n   * Set the active tool\n   * @param tool Tool to activate\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    if (tool === undefined) {\n      this.actionStore.state.updateAll({ active: false });\n    } else {\n      const action = this.actionStore.get(tool.name);\n      if (action !== undefined) {\n        this.actionStore.state.update(action, { active: true }, true);\n      }\n    }\n\n    this.activeTool$.next(tool);\n    if (this.animate) {\n      this.animation$.next('enter');\n    }\n  }\n\n  /**\n   * Initialize the toolbar\n   */\n  private setToolbar(toolbar: string[]) {\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\n      const tool = this.toolbox.getTool(toolName);\n      if (tool === undefined) {\n        return acc;\n      }\n\n      acc.push({\n        id: tool.name,\n        title: tool.title,\n        icon: tool.icon,\n        // iconImage: tool.iconImage,\n        tooltip: tool.tooltip,\n        args: [tool, this.toolbox],\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\n          _toolbox.activateTool(_tool.name);\n        },\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\n          return this.toolbox.activeTool$.pipe(\n            map((activeTool: Tool) => {\n              let toolActivated = false;\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\n                toolActivated = true;\n              }\n\n              let childrenToolActivated = false;\n              if (\n                activeTool !== undefined &&\n                _tool.name === activeTool.parent\n              ) {\n                childrenToolActivated = true;\n              }\n\n              return {\n                'tool-activated': toolActivated,\n                'children-tool-activated': childrenToolActivated\n              };\n            })\n          );\n        }\n      });\n      return acc;\n    }, []);\n    this.actionStore.load(actions);\n    this.toolbar$.next(toolbar);\n  }\n\n  /**\n   * Observe the ongoing animation and ignore any incoming animation\n   * while one is still ongoing.\n   * @param callback Callback to execute when the animation completes\n   */\n  private onAnimate(callback: () => void) {\n    this.unAnimate();\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\n      if (!animation) {\n        callback.call(this);\n        this.unAnimate();\n      }\n    });\n  }\n\n  /**\n   * Stop observing an animation when it's complete\n   */\n  private unAnimate() {\n    if (this.animating$$) {\n      this.animating$$.unsubscribe();\n    }\n  }\n}\n","<igo-dynamic-outlet\r\n  *ngIf=\"widget\"\r\n  [component]=\"widget\"\r\n  [inputs]=\"inputs\"\r\n  [subscribers]=\"getEffectiveSubscribers()\"\r\n>\r\n</igo-dynamic-outlet>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { DynamicComponent } from '../../dynamic-component';\r\n\r\nimport { WidgetComponent } from '../shared/widget.interfaces';\r\n\r\n/**\r\n * This component dynamically renders a widget. It also subscribes\r\n * to the widget's 'cancel' and 'complete' events and destroys it\r\n * when any of those event is emitted.\r\n */\r\n@Component({\r\n  selector: 'igo-widget-outlet',\r\n  templateUrl: './widget-outlet.component.html',\r\n  styleUrls: ['./widget-outlet.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WidgetOutletComponent implements OnDestroy {\r\n  /**\r\n   * Widget subscribers to 'cancel' and 'complete'\r\n   * @internal\r\n   */\r\n  private baseSubscribers = {\r\n    cancel: (event: any) => this.onCancel(event),\r\n    complete: (event: any) => this.onComplete(event)\r\n  };\r\n\r\n  /**\r\n   * Widget\r\n   */\r\n  @Input() widget: DynamicComponent<WidgetComponent>;\r\n\r\n  /**\r\n   * Widget inputs\r\n   */\r\n  @Input() inputs: { [key: string]: any };\r\n\r\n  /**\r\n   * Widget subscribers\r\n   */\r\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\r\n\r\n  /**\r\n   * Event emitted when the widget emits 'complete'\r\n   */\r\n  @Output() complete = new EventEmitter<any>();\r\n\r\n  /**\r\n   * Event emitted when the widget emits 'cancel'\r\n   */\r\n  @Output() cancel = new EventEmitter<any>();\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Destroy the current widget and all it's inner subscriptions\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.destroyWidget();\r\n  }\r\n\r\n  /**\r\n   * Get the effective subscribers. That means a combination of the base\r\n   * subscribers and any subscriber given as input.\r\n   * @returns Combined subscribers\r\n   * @internal\r\n   */\r\n  getEffectiveSubscribers(): { [key: string]: (event: any) => void } {\r\n    const subscribers = Object.assign({}, this.subscribers);\r\n\r\n    // Base subscribers\r\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\r\n      const subscriber = subscribers[key];\r\n      const baseSubscriber = this.baseSubscribers[key];\r\n      if (subscriber !== undefined) {\r\n        subscribers[key] = (event: any) => {\r\n          subscriber(event);\r\n          baseSubscriber(event);\r\n        };\r\n      } else {\r\n        subscribers[key] = baseSubscriber;\r\n      }\r\n    });\r\n\r\n    return subscribers;\r\n  }\r\n\r\n  /**\r\n   * When the widget emits 'cancel', propagate that event and destroy\r\n   * the widget\r\n   */\r\n  private onCancel(event: any) {\r\n    this.cancel.emit(event);\r\n    this.destroyWidget();\r\n  }\r\n\r\n  /**\r\n   * When the widget emits 'complete', propagate that event and destroy\r\n   * the widget\r\n   */\r\n  private onComplete(event: any) {\r\n    this.complete.emit(event);\r\n    this.destroyWidget();\r\n  }\r\n\r\n  /**\r\n   * Destroy the current widget\r\n   */\r\n  private destroyWidget() {\r\n    if (this.widget !== undefined) {\r\n      this.widget.destroy();\r\n    }\r\n    this.widget = undefined;\r\n  }\r\n}\r\n","import { EntityStore } from '../../entity';\r\nimport { Workspace } from './workspace';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * workspaces.\r\n */\r\nexport class WorkspaceStore extends EntityStore<Workspace> {\r\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Activate the an workspace workspace and deactivate the one currently active\r\n   * @param workspace Workspace\r\n   */\r\n  activateWorkspace(workspace: Workspace) {\r\n    const active = this.activeWorkspace$.value;\r\n    if (active !== undefined) {\r\n      active.deactivate();\r\n    }\r\n\r\n    this.deactivateWorkspace();\r\n    if (workspace !== undefined) {\r\n      this.state.update(workspace, { active: true, selected: true }, true);\r\n      this.activeWorkspace$.next(workspace);\r\n      workspace.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate the current workspace\r\n   * @param workspace Workspace\r\n   */\r\n  deactivateWorkspace() {\r\n    const active = this.activeWorkspace$.value;\r\n    if (active !== undefined) {\r\n      active.deactivate();\r\n      this.activeWorkspace$.next(undefined);\r\n    }\r\n  }\r\n}\r\n","import { Subscription, BehaviorSubject, Subject } from 'rxjs';\r\n\r\nimport { ActionStore } from '../../action';\r\nimport { Widget } from '../../widget';\r\nimport { EntityStoreWithStrategy } from '../../entity';\r\n\r\nimport { WorkspaceOptions } from './workspace.interfaces';\r\n\r\n/**\r\n * This class is responsible of managing the relations between\r\n * entities and the actions that consume them. It also defines an\r\n * entity table template that may be used by an entity table component.\r\n */\r\nexport class Workspace<E extends object = object> {\r\n  /**\r\n   * Observable of the selected widget\r\n   */\r\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\r\n\r\n  /**\r\n   * Observable of the selected widget's inputs\r\n   */\r\n  readonly widgetInputs$ = new BehaviorSubject<{ [key: string]: any }>({});\r\n\r\n  /**\r\n   * Observable of the selected widget's subscribers\r\n   */\r\n  readonly widgetSubscribers$ = new BehaviorSubject<{\r\n    [key: string]: (event: any) => void;\r\n  }>({});\r\n\r\n  /**\r\n   * Subscription to the selected entity\r\n   */\r\n  private entities$$: Subscription;\r\n\r\n  /**\r\n   * State change that trigger an update of the actions availability\r\n   */\r\n  private change: Subject<void> = new Subject();\r\n\r\n  /**\r\n   * Subscription to state changes\r\n   */\r\n  private change$: Subscription;\r\n\r\n  /**\r\n   * Workspace id\r\n   */\r\n  get id(): string {\r\n    return this.options.id;\r\n  }\r\n\r\n  /**\r\n   * Workspace title\r\n   */\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  /**\r\n   * Workspace title\r\n   */\r\n  get meta(): { [key: string]: any } {\r\n    return this.options.meta || {};\r\n  }\r\n\r\n  /**\r\n   * Entities store\r\n   */\r\n  get entityStore(): EntityStoreWithStrategy<E> {\r\n    return this.options.entityStore as EntityStoreWithStrategy<E>;\r\n  }\r\n\r\n  /**\r\n   * Actions store (some actions activate a widget)\r\n   */\r\n  get actionStore(): ActionStore {\r\n    return this.options.actionStore;\r\n  }\r\n\r\n  /**\r\n   * Selected widget\r\n   */\r\n  get widget(): Widget {\r\n    return this.widget$.value;\r\n  }\r\n\r\n  /**\r\n   * Whether a widget is selected\r\n   */\r\n  get hasWidget(): boolean {\r\n    return this.widget !== undefined;\r\n  }\r\n\r\n  constructor(protected options: WorkspaceOptions) {}\r\n\r\n  /**\r\n   * Whether this strategy is active\r\n   * @internal\r\n   */\r\n  get active(): boolean {\r\n    return this.active$.value;\r\n  }\r\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Activate the workspace. By doing that, the workspace will observe\r\n   * the selected entity (from the store) and update the actions availability.\r\n   * For example, some actions require an entity to be selected.\r\n   */\r\n  activate() {\r\n    if (this.active === true) {\r\n      this.deactivate();\r\n    }\r\n    this.active$.next(true);\r\n\r\n    if (this.entityStore !== undefined) {\r\n      this.entities$$ = this.entityStore.stateView\r\n        .all$()\r\n        .subscribe(() => this.onStateChange());\r\n    }\r\n\r\n    this.change.next();\r\n  }\r\n\r\n  /**\r\n   * Deactivate the workspace. Unsubcribe to the selected entity.\r\n   */\r\n  deactivate() {\r\n    this.active$.next(false);\r\n    this.deactivateWidget();\r\n\r\n    if (this.entities$$ !== undefined) {\r\n      this.entities$$.unsubscribe();\r\n    }\r\n    if (this.change$ !== undefined) {\r\n      this.change$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a widget. In itself, activating a widget doesn't render it but,\r\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\r\n   * show up.\r\n   * @param widget Widget\r\n   * @param inputs Inputs the widget will receive\r\n   */\r\n  activateWidget(\r\n    widget: Widget,\r\n    inputs: { [key: string]: any } = {},\r\n    subscribers: { [key: string]: (event: any) => void } = {}\r\n  ) {\r\n    this.widget$.next(widget);\r\n    this.widgetInputs$.next(inputs);\r\n    this.widgetSubscribers$.next(subscribers);\r\n    this.change.next();\r\n  }\r\n\r\n  /**\r\n   * Deactivate a widget.\r\n   */\r\n  deactivateWidget() {\r\n    this.widget$.next(undefined);\r\n    this.change.next();\r\n  }\r\n\r\n  /**\r\n   * When the state changes, update the actions availability.\r\n   */\r\n  private onStateChange() {\r\n    this.change.next();\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { getEntityTitle } from '../../entity';\r\nimport { Workspace } from '../shared/workspace';\r\nimport { WorkspaceStore } from '../shared/store';\r\n\r\n/**\r\n * Drop list that activates the selected workspace emit an event.\r\n */\r\n@Component({\r\n  selector: 'igo-workspace-selector',\r\n  templateUrl: './workspace-selector.component.html',\r\n  styleUrls: ['./workspace-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WorkspaceSelectorComponent {\r\n  /**\r\n   * Store that holds the available workspaces.\r\n   */\r\n  @Input() store: WorkspaceStore;\r\n\r\n  /**\r\n   * Wheither the selector must be disabled or not.\r\n   */\r\n  @Input() disabled: boolean;\r\n\r\n  /**\r\n   * Event emitted when an workspace is selected or unselected\r\n   */\r\n  @Output() selectedChange = new EventEmitter<{\r\n    selected: boolean;\r\n    value: Workspace;\r\n  }>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  getWorkspaceTitle(workspace: Workspace): string {\r\n    return getEntityTitle(workspace);\r\n  }\r\n\r\n  /**\r\n   * When an workspace is manually selected, select it into the\r\n   * store and emit an event.\r\n   * @internal\r\n   * @param event The selection change event\r\n   */\r\n  onSelectedChange(event: { value: Workspace }) {\r\n    const workspace = event.value;\r\n    this.store.activateWorkspace(workspace);\r\n    this.selectedChange.emit({ selected: true, value: workspace });\r\n  }\r\n}\r\n","<igo-entity-selector\r\n  [store]=\"store\"\r\n  [multi]=\"false\"\r\n  [titleAccessor]=\"getWorkspaceTitle\"\r\n  [disabled]=\"disabled\"\r\n  (selectedChange)=\"onSelectedChange($event)\"\r\n>\r\n</igo-entity-selector>\r\n","<ng-container *ngIf=\"widget$ | async as widget\">\r\n  <igo-widget-outlet\r\n    [widget]=\"widget\"\r\n    [inputs]=\"widgetInputs$ | async\"\r\n    [subscribers]=\"widgetSubscribers$ | async\"\r\n    (cancel)=\"onWidgetCancel(widget)\"\r\n    (complete)=\"onWidgetComplete(widget)\"\r\n  >\r\n  </igo-widget-outlet>\r\n</ng-container>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Widget } from '../../widget';\r\nimport { Workspace } from '../shared/workspace';\r\n\r\n/**\r\n * This component dynamically render an Workspace's active widget.\r\n * It also deactivate that widget whenever the widget's component\r\n * emit the 'cancel' or 'complete' event.\r\n */\r\n@Component({\r\n  selector: 'igo-workspace-widget-outlet',\r\n  templateUrl: './workspace-widget-outlet.component.html',\r\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WorkspaceWidgetOutletComponent {\r\n  /**\r\n   * Workspace\r\n   */\r\n  @Input() workspace: Workspace;\r\n\r\n  /**\r\n   * Event emitted when a widget is deactivate which happens\r\n   * when the widget's component emits the 'cancel' or 'complete' event.\r\n   */\r\n  @Output() deactivateWidget = new EventEmitter<Widget>();\r\n\r\n  /**\r\n   * Observable of the workspace's active widget\r\n   * @internal\r\n   */\r\n  get widget$(): BehaviorSubject<Widget> {\r\n    return this.workspace.widget$;\r\n  }\r\n\r\n  /**\r\n   * Observable of the workspace's widget inputs\r\n   * @internal\r\n   */\r\n  get widgetInputs$(): BehaviorSubject<{ [key: string]: any }> {\r\n    return this.workspace.widgetInputs$;\r\n  }\r\n\r\n  /**\r\n   * Observable of the workspace's widget inputs\r\n   * @internal\r\n   */\r\n  get widgetSubscribers$(): BehaviorSubject<{\r\n    [key: string]: (event: any) => void;\r\n  }> {\r\n    return this.workspace.widgetSubscribers$;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * When a widget's component emit the 'cancel' event,\r\n   * deactivate that widget and emit the 'deactivateWidget' event.\r\n   * @param widget Widget\r\n   * @internal\r\n   */\r\n  onWidgetCancel(widget: Widget) {\r\n    this.workspace.deactivateWidget();\r\n    this.deactivateWidget.emit(widget);\r\n  }\r\n\r\n  /**\r\n   * When a widget's component emit the 'cancel' event,\r\n   * deactivate that widget and emit the 'deactivateWidget' event.\r\n   * @param widget Widget\r\n   * @internal\r\n   */\r\n  onWidgetComplete(widget: Widget) {\r\n    this.workspace.deactivateWidget();\r\n    this.deactivateWidget.emit(widget);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  EventEmitter,\r\n  forwardRef,\r\n  Output,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { Input } from '@angular/core';\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\nimport tinycolor from 'tinycolor2';\r\n\r\n@Component({\r\n  selector: 'igo-color-picker-form-field',\r\n  templateUrl: './color-picker-form-field.component.html',\r\n  styleUrls: ['./color-picker-form-field.component.scss'],\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => ColorPickerFormFieldComponent),\r\n      multi: true\r\n    }\r\n  ]\r\n})\r\nexport class ColorPickerFormFieldComponent\r\n  implements ControlValueAccessor, OnInit\r\n{\r\n  // native color picker can't give transparency\r\n  // set transparency manually\r\n  @Input() setAlpha: number = 1;\r\n\r\n  // by default native color picker gives hex result\r\n  @Input() outputFormat: 'hex' | 'rgba' | 'hsla' = 'rgba';\r\n\r\n  // default color\r\n  @Input() color: string = '#000';\r\n\r\n  // open and close native color picker event\r\n  @Output() open = new EventEmitter<boolean>();\r\n  @Output() close = new EventEmitter<boolean>();\r\n\r\n  onChange: any = () => {};\r\n  onTouch: any = () => {};\r\n\r\n  // final value we get as result with custom format\r\n  set value(value: string) {\r\n    value = !value ? this.color : value;\r\n    this.onChange(value);\r\n    this.onTouch(value);\r\n    this._value = value;\r\n  }\r\n  get value(): string {\r\n    return this._value;\r\n  }\r\n  public _value: string;\r\n\r\n  // native color picker accept hex format\r\n  set hexColor(value: string) {\r\n    this.value = this.setFormat(value);\r\n    this._hexColor = value;\r\n  }\r\n  get hexColor(): string {\r\n    return this._hexColor;\r\n  }\r\n  public _hexColor: string;\r\n\r\n  ngOnInit(): void {\r\n    if (this.color) {\r\n      this._hexColor = tinycolor(this.color)\r\n        .setAlpha(this.setAlpha)\r\n        .toHexString();\r\n    }\r\n  }\r\n\r\n  writeValue(value: string) {\r\n    this.value = value;\r\n  }\r\n\r\n  registerOnChange(fn: any) {\r\n    this.onChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: any) {\r\n    this.onTouch = fn;\r\n  }\r\n\r\n  setFormat(color: string): string {\r\n    switch (this.outputFormat) {\r\n      case 'hex':\r\n        color = tinycolor(color).setAlpha(this.setAlpha).toHexString();\r\n        break;\r\n      case 'rgba':\r\n        color = tinycolor(color).setAlpha(this.setAlpha).toRgbString();\r\n        break;\r\n      case 'hsla':\r\n        color = tinycolor(color).setAlpha(this.setAlpha).toHsvString();\r\n        break;\r\n      default:\r\n        color = tinycolor(color).setAlpha(this.setAlpha).toRgbString();\r\n        break;\r\n    }\r\n    return color;\r\n  }\r\n\r\n  closePicker() {\r\n    setTimeout(() => {\r\n      this.close.emit(true);\r\n    }, 300);\r\n  }\r\n}\r\n","<mat-form-field\n  class=\"fill-field\"\n  floatLabel=\"always\"\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  subscriptSizing=\"dynamic\"\n>\n  <mat-label>{{ value }}</mat-label>\n  <input\n    matInput\n    [readonly]=\"true\"\n    (click)=\"open.emit(true)\"\n    (blur)=\"closePicker()\"\n    [(ngModel)]=\"hexColor\"\n    type=\"color\"\n  />\n</mat-form-field>\n","<h6 class=\"mat-subtitle-2 m-b-0\">{{ subtitle }}</h6>\n<h2>{{ title }}</h2>\n\n<div class=\"mat-body-1\">\n  <ng-container *ngIf=\"dependencies?.length\">\n    <label for=\"\">Dependencies:</label>\n    <ul>\n      <li *ngFor=\"let dep of dependencies\">{{ dep }}</li>\n    </ul>\n  </ng-container>\n  <ng-content></ng-content>\n</div>\n<!-- <mat-card appearance=\"outlined\">\n  <mat-card-header>\n    <mat-card-subtitle>{{subtitle}}</mat-card-subtitle>\n    <mat-card-title>{{title}}</mat-card-title>\n  </mat-card-header>\n  <mat-card-content>\n    <ng-container *ngIf=\"dependencies?.length\">\n        <label for=\"\">Dependencies:</label>\n        <ul>\n            <li *ngFor=\"let dep of dependencies\">{{dep}}</li>\n        </ul>\n        <br />\n    </ng-container>\n    <ng-content></ng-content>\n  </mat-card-content>\n</mat-card> -->\n","import { Component, Input } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-doc-viewer',\r\n  templateUrl: './doc-viewer.component.html',\r\n  styleUrls: ['./doc-viewer.component.scss']\r\n})\r\nexport class DocViewerComponent {\r\n  @Input() title: string;\r\n  @Input() subtitle: string;\r\n  @Input() dependencies: string[];\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppHomeComponent } from './home.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'home',\r\n    component: AppHomeComponent\r\n  }\r\n];\r\n\r\nexport const AppHomeRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\nimport { InteractiveTourService } from '@igo2/common';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.scss']\n})\nexport class AppHomeComponent {\n  constructor(private interactiveTourService: InteractiveTourService) {}\n\n  startTour() {\n    this.interactiveTourService.startTour('global');\n  }\n}\n","<app-doc-viewer>\r\n  <div style=\"text-align: center\">\r\n    <h1 id=\"igo-title\">Welcome to IGO</h1>\r\n    <img class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\" />\r\n  </div>\r\n\r\n  <p>\r\n    <igo-interactive-tour\r\n      tourToStart=\"global\"\r\n      menuIsOpen=\"true\"\r\n      styleButton=\"raised\"\r\n    >\r\n    </igo-interactive-tour>\r\n  </p>\r\n\r\n  <p class=\"mat-body-1\">\r\n    IGO2 library contains many components and services that may benefit any web\r\n    application. <br />\r\n    IGO2 library is open source project using Angular, Angular Material and\r\n    OpenLayers.\r\n  </p>\r\n\r\n  <h3>IGO2 library is divided into several elements:</h3>\r\n  <ul class=\"mat-body-1\">\r\n    <li>\r\n      <b>@igo2/utils</b> : Basic utilies without dependency (ex: base64,\r\n      clipboard, uuid)\r\n    </li>\r\n    <li>\r\n      <b>@igo2/core</b> : Element affecting the core of the application (ex:\r\n      config, language, message, media, request)\r\n    </li>\r\n    <li>\r\n      <b>@igo2/common</b> : Library containing reusable components (ex:\r\n      clickout, drag-drop, list, panel, spinner, table)\r\n    </li>\r\n    <li>\r\n      <b>@igo2/auth</b> : Library grouping the authentication and security\r\n      module\r\n    </li>\r\n    <li>\r\n      <b>@igo2/geo</b> : Library containing the geomatic components. Depends on\r\n      Openlayers.\r\n    </li>\r\n    <li>\r\n      <b>@igo2/context</b> : Library of components uniting @igo2/geo and\r\n      @igo2/auth\r\n    </li>\r\n    <li><b>@igo2/integration</b> : Library integrate basic components</li>\r\n  </ul>\r\n\r\n  <h2>Here are some links to help you start:</h2>\r\n  <ul>\r\n    <li>\r\n      <h2>\r\n        <a\r\n          target=\"_blank\"\r\n          rel=\"noopener\"\r\n          href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\"\r\n          >Installation</a\r\n        >\r\n      </h2>\r\n    </li>\r\n    <li>\r\n      <h2>\r\n        <a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\"\r\n          >Angular Documentation</a\r\n        >\r\n      </h2>\r\n    </li>\r\n  </ul>\r\n\r\n  <span class=\"mat-body-1\"\r\n    >*** Modules in <code>@igo2/core</code> must be imported only once</span\r\n  >\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { ExampleViewerComponent } from './example-viewer/example-viewer.component';\r\nimport { ExampleSeeCodeComponent } from './example-see-code/example-see-code.component';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\n@NgModule({\r\n  declarations: [ExampleViewerComponent, ExampleSeeCodeComponent],\r\n  exports: [ExampleViewerComponent],\r\n  imports: [\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    MatDividerModule,\r\n    MatIconModule,\r\n    MatTooltipModule\r\n  ]\r\n})\r\nexport class ExampleModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { DocViewerComponent } from './doc-viewer.component';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\n@NgModule({\r\n  declarations: [DocViewerComponent],\r\n  exports: [DocViewerComponent],\r\n  imports: [CommonModule, MatCardModule]\r\n})\r\nexport class DocViewerModule {}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ExampleModule } from '../components/example/example.module';\nimport { DocViewerModule } from '../components/doc-viewer/doc-viewer.module';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatGridListModule } from '@angular/material/grid-list';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\n@NgModule({\n  declarations: [],\n  exports: [\n    CommonModule,\n    ExampleModule,\n    DocViewerModule,\n    MatCardModule,\n    MatButtonModule,\n    MatGridListModule,\n    MatIconModule,\n    MatInputModule,\n    MatTooltipModule\n  ],\n  imports: [CommonModule]\n})\nexport class SharedModule {}\n","import { NgModule } from '@angular/core';\r\n\r\nimport { AppHomeComponent } from './home.component';\r\nimport { AppHomeRoutingModule } from './home-routing.module';\r\nimport { IgoInteractiveTourModule } from '@igo2/common';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppHomeComponent],\r\n  imports: [AppHomeRoutingModule, IgoInteractiveTourModule, SharedModule],\r\n  exports: [AppHomeComponent]\r\n})\r\nexport class AppHomeModule {}\r\n","<mat-card appearance=\"outlined\">\r\n  <mat-card-header>\r\n    <mat-card-subtitle>\r\n      {{ title }}\r\n    </mat-card-subtitle>\r\n    <div class=\"actions\">\r\n      <a\r\n        *ngIf=\"codeFolder\"\r\n        mat-icon-button\r\n        [href]=\"codeUrl\"\r\n        target=\"_blank\"\r\n        matTooltip=\"View code example\"\r\n      >\r\n        <mat-icon svgIcon=\"code-tags\"></mat-icon>\r\n      </a>\r\n      <a\r\n        *ngIf=\"configFolder\"\r\n        mat-icon-button\r\n        [href]=\"configUrl\"\r\n        target=\"_blank\"\r\n        matTooltip=\"View config example\"\r\n      >\r\n        <mat-icon svgIcon=\"cog\"></mat-icon>\r\n      </a>\r\n    </div>\r\n  </mat-card-header>\r\n\r\n  <mat-divider class=\"m-b-16\"></mat-divider>\r\n\r\n  <mat-card-content class=\"mat-body-1\">\r\n    <ng-content></ng-content>\r\n  </mat-card-content>\r\n</mat-card>\r\n","import { Component, Input } from '@angular/core';\r\n\r\nconst SRC_PATH =\r\n  'https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src';\r\n\r\n@Component({\r\n  selector: 'app-example-viewer',\r\n  templateUrl: './example-viewer.component.html',\r\n  styleUrls: ['./example-viewer.component.scss']\r\n})\r\nexport class ExampleViewerComponent {\r\n  @Input() title: string;\r\n  @Input() codeFolder: string;\r\n  @Input() configFolder: string;\r\n\r\n  get codeUrl() {\r\n    return `${SRC_PATH}/app/${this.codeFolder}`;\r\n  }\r\n\r\n  get configUrl() {\r\n    return `${SRC_PATH}/${this.configFolder}`;\r\n  }\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppActivityComponent } from './activity.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'activity',\r\n    component: AppActivityComponent\r\n  }\r\n];\r\n\r\nexport const AppActivityRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\n\nimport { ActivityService } from '@igo2/core';\n\n@Component({\n  selector: 'app-activity',\n  templateUrl: './activity.component.html',\n  styleUrls: ['./activity.component.scss']\n})\nexport class AppActivityComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private activityService: ActivityService) {}\n\n  register() {\n    this.idsActivity.push(this.activityService.register());\n  }\n\n  unregister() {\n    this.activityService.unregister(this.idsActivity.pop());\n  }\n\n  get counter() {\n    return this.activityService.counter$.value;\n  }\n}\n","<app-doc-viewer title=\"Activity\" subtitle=\"Core\">\n  <p>Register activities in service. Use to display a loading icon</p>\n\n  <li>\n    Import <code>IgoActivityModule</code> only if you want register http calls\n  </li>\n  <li>Import <code>IgoActivityModule</code> only once</li>\n\n  <app-example-viewer codeFolder=\"core/activity\">\n    <div class=\"d-flex actions-container\">\n      <button mat-raised-button (click)=\"register()\">Register</button>\n      <button mat-raised-button (click)=\"unregister()\">Unregister</button>\n    </div>\n\n    <div class=\"mat-body-1 sub-content\">\n      <p>Counter: {{ counter }}</p>\n\n      <igo-spinner igoSpinnerActivity></igo-spinner>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoActivityModule } from '@igo2/core';\nimport { IgoSpinnerModule } from '@igo2/common';\n\nimport { AppActivityComponent } from './activity.component';\nimport { AppActivityRoutingModule } from './activity-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppActivityComponent],\n  imports: [\n    AppActivityRoutingModule,\n    SharedModule,\n    IgoActivityModule.forRoot(), // Only if you want register http calls\n    IgoSpinnerModule\n  ],\n  exports: [AppActivityComponent]\n})\nexport class AppActivityModule {}\n","interface Environment {\r\n  production: boolean;\r\n  igo: any;\r\n}\r\n\r\nexport const environment: Environment = {\r\n  production: true,\r\n  igo: {\r\n    projections: [\r\n      {\r\n        code: 'EPSG:32198',\r\n        alias: 'Quebec Lambert',\r\n        def: '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\r\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\r\n      }\r\n    ],\r\n    auth: {\r\n      intern: {\r\n        enabled: true\r\n      },\r\n      allowAnonymous: true\r\n    },\r\n    interactiveTour: {\r\n      tourInMobile: true\r\n    },\r\n    importExport: {\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\r\n    },\r\n    language: {\r\n      prefix: './locale/'\r\n    },\r\n    catalog: {\r\n      sources: [\r\n        {\r\n          id: 'Gououvert',\r\n          title: 'Gouvouvert',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi'\r\n        },\r\n        {\r\n          id: 'DefiningInfoFormat',\r\n          title: 'Defining info_format',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          queryFormat: {\r\n            html: '*',\r\n            'application/json': [\r\n              'stations_meteoroutieres',\r\n              'histo_stations_meteoroutieres'\r\n            ]\r\n          },\r\n          queryHtmlTarget: 'iframe',\r\n          count: 30\r\n        },\r\n        {\r\n          id: 'catalogwithregex',\r\n          title: 'Filtered catalog by regex',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          regFilters: ['zpegt']\r\n        },\r\n        {\r\n          id: 'catalogwithtooltipcontrol',\r\n          title: 'Controling tooltip format',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n          tooltipType: 'abstract' // or title\r\n        }\r\n      ]\r\n    },\r\n    searchSources: {\r\n      storedqueriesreverse: { enabled: false },\r\n      nominatim: {\r\n        enabled: false\r\n      },\r\n      icherche: {\r\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\r\n        order: 2,\r\n        enabled: true,\r\n        params: {\r\n          limit: '8'\r\n        },\r\n        showAdvancedSettings: true\r\n      },\r\n      coordinatesreverse: {\r\n        showInPointerSummary: true\r\n      },\r\n      icherchereverse: {\r\n        showInPointerSummary: true,\r\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\r\n        order: 3,\r\n        enabled: true\r\n      },\r\n      ilayer: {\r\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\r\n        order: 4,\r\n        enabled: true,\r\n        params: {\r\n          limit: '5'\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppConfigComponent } from './config.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'config',\r\n    component: AppConfigComponent\r\n  }\r\n];\r\n\r\nexport const AppConfigRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\nimport { ConfigService, LanguageOptions } from '@igo2/core';\n\n@Component({\n  selector: 'app-config',\n  templateUrl: './config.component.html',\n  styleUrls: ['./config.component.scss']\n})\nexport class AppConfigComponent {\n  public configLanguage: LanguageOptions;\n\n  constructor(private configService: ConfigService) {\n    this.configLanguage = this.configService.getConfig('language');\n  }\n}\n","<app-doc-viewer title=\"Config\" subtitle=\"Core\">\r\n  <p>Load config in your angular application</p>\r\n\r\n  <li>Import <code>IgoConfigModule</code> only once</li>\r\n\r\n  <app-example-viewer\r\n    title=\"Simple config\"\r\n    codeFolder=\"core/config\"\r\n    configFolder=\"environments\"\r\n  >\r\n    <p class=\"mat-body-1\">Config language: {{ configLanguage | json }}</p>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\r\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\r\n\r\nimport { environment } from '../../../environments/environment';\r\nimport { AppConfigComponent } from './config.component';\r\nimport { AppConfigRoutingModule } from './config-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppConfigComponent],\r\n  imports: [AppConfigRoutingModule, SharedModule, IgoConfigModule.forRoot()],\r\n  exports: [AppConfigComponent],\r\n  providers: [\r\n    provideConfigOptions({\r\n      default: environment.igo\r\n    })\r\n  ]\r\n})\r\nexport class AppConfigModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppLanguageComponent } from './language.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'language',\r\n    component: AppLanguageComponent\r\n  }\r\n];\r\n\r\nexport const AppLanguageRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-language',\n  templateUrl: './language.component.html',\n  styleUrls: ['./language.component.scss']\n})\nexport class AppLanguageComponent {\n  public app = {\n    title: 'IGO'\n  };\n  constructor(private languageService: LanguageService) {}\n\n  changeLanguage(language: string) {\n    this.languageService.setLanguage(language);\n    console.log(this.languageService);\n  }\n}\n","<app-doc-viewer title=\"Language\" subtitle=\"Core\">\r\n  <p>Translate your angular application</p>\r\n\r\n  <li>Import <code>IgoLanguageModule</code> only once</li>\r\n  <li>\r\n    Configure the\r\n    <a\r\n      href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale\"\r\n      >locale files</a\r\n    >\r\n  </li>\r\n\r\n  <app-example-viewer codeFolder=\"core/language\">\r\n    <div class=\"d-flex actions-container\">\r\n      <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\r\n      <button mat-raised-button (click)=\"changeLanguage('fr')\">Franais</button>\r\n    </div>\r\n\r\n    <div class=\"m-t-12\">\r\n      {{ 'welcome' | translate: app }}\r\n    </div>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { AppLanguageComponent } from './language.component';\nimport { AppLanguageRoutingModule } from './language-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppLanguageComponent],\n  imports: [\n    AppLanguageRoutingModule,\n    SharedModule,\n    IgoLanguageModule.forRoot()\n  ],\n  exports: [AppLanguageComponent]\n})\nexport class AppLanguageModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppMediaComponent } from './media.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'media',\r\n    component: AppMediaComponent\r\n  }\r\n];\r\n\r\nexport const AppMediaRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { MediaService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-media',\r\n  templateUrl: './media.component.html',\r\n  styleUrls: ['./media.component.scss']\r\n})\r\nexport class AppMediaComponent {\r\n  constructor(private mediaService: MediaService) {}\r\n\r\n  get media() {\r\n    return this.mediaService.getMedia();\r\n  }\r\n\r\n  get orientation() {\r\n    return this.mediaService.getOrientation();\r\n  }\r\n\r\n  get isTouchScreen() {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Media\" subtitle=\"Core\">\n  <p>Detect type of media (mobile, tablet, desktop)</p>\n\n  <app-example-viewer codeFolder=\"core/media\">\n    <p>Current media: {{ media }}</p>\n    <p>Current orientation: {{ orientation }}</p>\n    <p>\n      Device mode:\n      {{ isTouchScreen ? 'Touch device' : 'Not a touch device ' }}\n    </p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { AppMediaComponent } from './media.component';\nimport { AppMediaRoutingModule } from './media-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppMediaComponent],\n  imports: [AppMediaRoutingModule, SharedModule],\n  exports: [AppMediaComponent]\n})\nexport class AppMediaModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppMessageComponent } from './message.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'message',\r\n    component: AppMessageComponent\r\n  }\r\n];\r\n\r\nexport const AppMessageRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\n\nimport { MessageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-message',\n  templateUrl: './message.component.html',\n  styleUrls: ['./message.component.scss']\n})\nexport class AppMessageComponent {\n  constructor(private messageService: MessageService) {}\n\n  success() {\n    this.messageService.success('Congratulations', 'Success');\n  }\n\n  info() {\n    this.messageService.info('Welcome to IGO', 'Info');\n  }\n\n  alert() {\n    this.messageService.alert('Warning', 'Alert');\n  }\n  error() {\n    this.messageService.error('There is a bug', 'Error');\n  }\n}\n","<app-doc-viewer title=\"Message\" subtitle=\"Core\">\n  <p>Show message to user.</p>\n\n  <li>Import <code>IgoMessageModule</code> only once</li>\n  <li>Dependencies: BrowserAnimationsModule</li>\n\n  <app-example-viewer codeFolder=\"core/message\">\n    <div class=\"d-flex m-t-16 actions-container\">\n      <button mat-raised-button (click)=\"success()\">Success message</button>\n      <button mat-raised-button color=\"primary\" (click)=\"info()\">\n        Info message\n      </button>\n      <button mat-raised-button color=\"accent\" (click)=\"alert()\">\n        Alert message\n      </button>\n      <button mat-raised-button color=\"warn\" (click)=\"error()\">\n        Error message\n      </button>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\n\r\nimport { AppMessageComponent } from './message.component';\r\nimport { AppMessageRoutingModule } from './message-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppMessageComponent],\r\n  imports: [AppMessageRoutingModule, SharedModule, IgoMessageModule.forRoot()],\r\n  exports: [AppMessageComponent]\r\n})\r\nexport class AppMessageModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppRequestComponent } from './request.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'request',\r\n    component: AppRequestComponent\r\n  }\r\n];\r\n\r\nexport const AppRequestRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-request',\r\n  templateUrl: './request.component.html',\r\n  styleUrls: ['./request.component.scss']\r\n})\r\nexport class AppRequestComponent {\r\n  constructor(\r\n    private http: HttpClient,\r\n    public languageService: LanguageService\r\n  ) {}\r\n\r\n  callHttp() {\r\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\r\n    this.http.get(url).subscribe((rep) => {\r\n      console.log(rep);\r\n    });\r\n  }\r\n\r\n  callHttpError() {\r\n    const url = '404';\r\n    this.http.get(url).subscribe((rep) => {\r\n      console.log(rep);\r\n    });\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Request\" subtitle=\"Core\">\r\n  <p>Register http calls in console</p>\r\n\r\n  <li>\r\n    Import <code>IgoLoggingModule</code> only if you want register http calls in\r\n    console\r\n  </li>\r\n  <li>\r\n    Import <code>IgoErrorModule</code> only if you want register errors from\r\n    http call in console\r\n  </li>\r\n  <li>Import modules only once</li>\r\n\r\n  <app-example-viewer codeFolder=\"core/core\">\r\n    <div class=\"actions-container\">\r\n      <button mat-raised-button (click)=\"callHttp()\">Log</button>\r\n      <button mat-raised-button (click)=\"callHttpError()\">Error</button>\r\n    </div>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\n\nimport { IgoErrorModule, IgoLanguageModule } from '@igo2/core';\n\nimport { AppRequestComponent } from './request.component';\nimport { AppRequestRoutingModule } from './request-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppRequestComponent],\n  imports: [\n    AppRequestRoutingModule,\n    SharedModule,\n    HttpClientModule,\n    IgoLanguageModule.forRoot(),\n    IgoErrorModule.forRoot() // Only if you want register errors from http call in console\n    // IgoLoggingModule.forRoot() // Only if you want register http calls in console\n  ],\n  exports: [AppRequestComponent]\n})\nexport class AppRequestModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppActionComponent } from './action.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'action',\r\n    component: AppActionComponent\r\n  }\r\n];\r\n\r\nexport const AppActionRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  Media,\n  MediaOrientation,\n  MediaService,\n  LanguageService\n} from '@igo2/core';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\nimport { Overlay } from '@angular/cdk/overlay';\n\n@Component({\n  selector: 'app-action',\n  templateUrl: './action.component.html',\n  styleUrls: ['./action.component.scss']\n})\nexport class AppActionComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  private added$ = new BehaviorSubject(false);\n\n  get actionbarMode(): ActionbarMode {\n    const media = this.mediaService.media$.value;\n    const orientation = this.mediaService.orientation$.value;\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\n      return ActionbarMode.Dock;\n    }\n    return ActionbarMode.Overlay;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private mediaService: MediaService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'add',\n        title: 'Add',\n        icon: 'plus',\n        tooltip: 'Add Tooltip',\n        handler: () => {\n          alert('Add!');\n          this.added$.next(true);\n        }\n      },\n      {\n        id: 'edit',\n        title: 'Edit',\n        icon: 'pencil',\n        tooltip: 'Edit Tooltip',\n        args: ['1'],\n        handler: (item: string) => {\n          alert(`Edit item ${item}!`);\n        },\n        availability: () => this.added$\n      },\n      {\n        id: 'delete',\n        title: 'Delete',\n        tooltip: 'Delete Tooltip',\n        icon: 'delete',\n        handler: () => {\n          alert('Delete!');\n          this.added$.next(false);\n        },\n        availability: () => this.added$\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Action\" subtitle=\"Common\">\n  <app-example-viewer title=\"Action Bar\" codeFolder=\"common/action\">\n    <igo-actionbar\n      [store]=\"store\"\n      [withIcon]=\"true\"\n      [withTitle]=\"actionbarMode === 'overlay'\"\n      [horizontal]=\"true\"\n      [mode]=\"actionbarMode\"\n    >\n    </igo-actionbar>\n  </app-example-viewer>\n\n  <!-- <app-example-viewer title=\"Action context-menu\" codeFolder=\"common/action\">\n    <mat-card [igoContextMenu]=\"actionbarMenu\">\n      <mat-card-header>\n        <mat-card-subtitle>Common</mat-card-subtitle>\n        <mat-card-title>Action context-menu</mat-card-title>\n      </mat-card-header>\n      <div></div>\n    </mat-card>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"true\"\n        [horizontal]=\"true\"\n        [mode]=\"'context'\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer> -->\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoActionModule, IgoContextMenuModule } from '@igo2/common';\n\nimport { AppActionComponent } from './action.component';\nimport { AppActionRoutingModule } from './action-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppActionComponent],\n  imports: [\n    SharedModule,\n    AppActionRoutingModule,\n    IgoActionModule,\n    IgoContextMenuModule\n  ],\n  exports: [AppActionComponent]\n})\nexport class AppActionModule {}\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { OnUpdateInputs } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-salutation-component',\r\n  template: '<p>Hello, my name is {{name}}.</p>',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSalutationComponent implements OnUpdateInputs {\r\n  @Input() name: string;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'app-explanation-component',\r\n  template:\r\n    '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppExplanationComponent implements OnUpdateInputs {\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'app-dynamic-component',\r\n  templateUrl: './dynamic-component.component.html',\r\n  styleUrls: ['./dynamic-component.component.scss']\r\n})\r\nexport class AppDynamicComponentComponent {\r\n  component: any = AppSalutationComponent;\r\n\r\n  inputs = { name: 'Bob' };\r\n\r\n  toggleComponent() {\r\n    this.component =\r\n      this.component === AppSalutationComponent\r\n        ? AppExplanationComponent\r\n        : AppSalutationComponent;\r\n  }\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppDynamicComponentComponent } from './dynamic-component.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'dynamic-component',\r\n    component: AppDynamicComponentComponent\r\n  }\r\n];\r\n\r\nexport const AppDynamicComponentRoutingModule = RouterModule.forChild(routes);\r\n","<app-doc-viewer title=\"Dynamic Component\" subtitle=\"Common\">\r\n  <app-example-viewer codeFolder=\"common/dynamic-component\">\r\n    <igo-dynamic-outlet [component]=\"component\" [inputs]=\"inputs\">\r\n    </igo-dynamic-outlet>\r\n\r\n    <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">\r\n      Toggle Component\r\n    </button>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoDynamicComponentModule } from '@igo2/common';\r\n\r\nimport {\r\n  AppSalutationComponent,\r\n  AppExplanationComponent,\r\n  AppDynamicComponentComponent\r\n} from './dynamic-component.component';\r\nimport { AppDynamicComponentRoutingModule } from './dynamic-component-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppSalutationComponent,\r\n    AppDynamicComponentComponent,\r\n    AppExplanationComponent\r\n  ],\r\n  imports: [\r\n    SharedModule,\r\n    AppDynamicComponentRoutingModule,\r\n    IgoDynamicComponentModule\r\n  ],\r\n  exports: [AppDynamicComponentComponent]\r\n})\r\nexport class AppDynamicComponentModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppEntityTableComponent } from './entity-table.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'entity-table',\r\n    component: AppEntityTableComponent\r\n  }\r\n];\r\n\r\nexport const AppEntityTableRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  EntityStore,\r\n  EntityTableButton,\r\n  getEntityProperty,\r\n  EntityTableColumnRenderer,\r\n  EntityTablePaginatorOptions\r\n} from '@igo2/common';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-entity-table',\r\n  templateUrl: './entity-table.component.html',\r\n  styleUrls: ['./entity-table.component.scss']\r\n})\r\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\r\n  public store = new EntityStore([]);\r\n  public paginator: MatPaginator;\r\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public paginatorOptions: EntityTablePaginatorOptions = { pageSize: 10 };\r\n\r\n  public template = {\r\n    selection: true,\r\n    selectionCheckbox: true,\r\n    selectMany: true,\r\n    sort: true,\r\n    valueAccessor: (entity: object, name: string) => {\r\n      return getEntityProperty(entity, name);\r\n    },\r\n    columns: [\r\n      {\r\n        name: 'selected',\r\n        title: 'Selected',\r\n        valueAccessor: (entity: object) => {\r\n          return this.store.state.get(entity).selected\r\n            ? 'radiobox-marked'\r\n            : 'radiobox-blank';\r\n        },\r\n        renderer: EntityTableColumnRenderer.Icon\r\n      },\r\n      {\r\n        name: 'id',\r\n        title: 'ID'\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name'\r\n      },\r\n      {\r\n        name: 'description',\r\n        title: 'Description',\r\n        renderer: EntityTableColumnRenderer.HTML\r\n      },\r\n      {\r\n        name: 'url',\r\n        title: 'Hyperlink'\r\n      },\r\n      {\r\n        name: 'image',\r\n        title: 'Image'\r\n      },\r\n      {\r\n        name: 'action',\r\n        title: '',\r\n        valueAccessor: (entity: object) => {\r\n          return [\r\n            {\r\n              icon: 'home',\r\n              color: 'warn',\r\n              click: (row) => {\r\n                console.log(row);\r\n              }\r\n            }\r\n          ] as EntityTableButton[];\r\n        },\r\n        renderer: EntityTableColumnRenderer.ButtonGroup\r\n      }\r\n    ]\r\n  };\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    const ids = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\r\n\r\n    const entities = ids.map((id) => {\r\n      if (id === 3) {\r\n        return {\r\n          id,\r\n          name: `Name ${id}`,\r\n          description: `<b>Description ${id}</b>`,\r\n          url: 'https://igouverte.org',\r\n          image: 'https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png'\r\n        };\r\n      }\r\n      return {\r\n        id,\r\n        name: `Name ${id}`,\r\n        description: `<b>Description ${id}</b>`,\r\n        url: 'https://igouverte.org',\r\n        image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'\r\n      };\r\n    });\r\n    this.store.load(entities);\r\n  }\r\n\r\n  entitySortChange() {\r\n    this.entitySortChange$.next(true);\r\n  }\r\n\r\n  paginatorChange(event: MatPaginator) {\r\n    this.paginator = event;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Entity Table\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/entity-table\">\n    <igo-entity-table\n      [store]=\"store\"\n      [withPaginator]=\"true\"\n      [paginatorOptions]=\"paginatorOptions\"\n      [template]=\"template\"\n      (entitySortChange)=\"entitySortChange()\"\n    >\n    </igo-entity-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport {\r\n  IgoEntityTableModule,\r\n  IgoEntityTablePaginatorModule\r\n} from '@igo2/common';\r\n\r\nimport { AppEntityTableComponent } from './entity-table.component';\r\nimport { AppEntityTableRoutingModule } from './entity-table-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppEntityTableComponent],\r\n  imports: [\r\n    AppEntityTableRoutingModule,\r\n    SharedModule,\r\n    IgoEntityTableModule,\r\n    IgoEntityTablePaginatorModule\r\n  ],\r\n  exports: [AppEntityTableComponent]\r\n})\r\nexport class AppEntityTableModule {}\r\n","<app-doc-viewer title=\"Entity Selector\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/entity-selector\">\n    <igo-entity-selector\n      [store]=\"store\"\n      [titleAccessor]=\"getTitle\"\n      [emptyText]=\"''\"\n      [placeholder]=\"'Select an entity'\"\n      (selectedChange)=\"onSelectedChange($event)\"\n    >\n    </igo-entity-selector>\n\n    <div *ngIf=\"selected$ | async as selected\">\n      <p>ID: {{ selected.id }}</p>\n      <p>Name: {{ selected.name }}</p>\n      <p>Description: <span [innerHtml]=\"selected.description\"></span></p>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppEntitySelectorComponent } from './entity-selector.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'entity-selector',\r\n    component: AppEntitySelectorComponent\r\n  }\r\n];\r\n\r\nexport const AppEntitySelectorRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { EntityStore } from '@igo2/common';\r\n\r\ninterface DemoEntity {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-entity-selector',\r\n  templateUrl: './entity-selector.component.html',\r\n  styleUrls: ['./entity-selector.component.scss']\r\n})\r\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\r\n  public store = new EntityStore([]);\r\n\r\n  public selected$ = new BehaviorSubject<DemoEntity>(undefined);\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    this.store.load([\r\n      { id: '2', name: 'Name 2', description: '<b>Description 2</b>' },\r\n      { id: '1', name: 'Name 1', description: '<b>Description 1</b>' },\r\n      { id: '3', name: 'Name 3', description: '<b>Description 3</b>' }\r\n    ]);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  getTitle(entity: DemoEntity): string {\r\n    return entity.name;\r\n  }\r\n\r\n  onSelectedChange(event: { selected: boolean; entity: DemoEntity }) {\r\n    this.selected$.next(event.entity);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoEntitySelectorModule } from '@igo2/common';\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\nimport { AppEntitySelectorRoutingModule } from './entity-selector-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppEntitySelectorComponent],\n  imports: [\n    SharedModule,\n    AppEntitySelectorRoutingModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [AppEntitySelectorComponent]\n})\nexport class AppEntitySelectorModule {}\n","<app-doc-viewer title=\"Form\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/form\">\n    <igo-form\n      *ngIf=\"form$ | async as form\"\n      [form]=\"form\"\n      [formData]=\"data$ | async\"\n      (submitForm)=\"onSubmit($event)\"\n    >\n      <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n      <div formButtons class=\"actions-container\">\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"fillForm()\"\n        >\n          Fill Form\n        </button>\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"clearForm()\"\n        >\n          Clear Form\n        </button>\n        <button\n          mat-flat-button\n          type=\"submit\"\n          color=\"primary\"\n          [disabled]=\"submitDisabled\"\n        >\n          Submit\n        </button>\n      </div>\n    </igo-form>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppFormComponent } from './form.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'form',\r\n    component: AppFormComponent\r\n  }\r\n];\r\n\r\nexport const AppFormRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { Validators } from '@angular/forms';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { Form, FormService } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-form',\r\n  templateUrl: './form.component.html',\r\n  styleUrls: ['./form.component.scss']\r\n})\r\nexport class AppFormComponent implements OnInit, OnDestroy {\r\n  form$ = new BehaviorSubject<Form>(undefined);\r\n\r\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\r\n\r\n  submitDisabled = true;\r\n\r\n  private valueChanges$$: Subscription;\r\n\r\n  constructor(\r\n    private formService: FormService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    const fieldConfigs = [\r\n      {\r\n        name: 'id',\r\n        title: 'ID',\r\n        options: {\r\n          cols: 1,\r\n          validator: Validators.required\r\n        }\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name',\r\n        options: {\r\n          cols: 1,\r\n          validator: Validators.required\r\n        }\r\n      },\r\n      {\r\n        name: 'status',\r\n        title: 'Status',\r\n        type: 'select',\r\n        options: {\r\n          cols: 2\r\n        },\r\n        inputs: {\r\n          choices: [\r\n            { value: 1, title: 'Single' },\r\n            { value: 2, title: 'Married' }\r\n          ]\r\n        }\r\n      }\r\n    ];\r\n\r\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\r\n    const form = this.formService.form(\r\n      [],\r\n      [this.formService.group({ name: 'info' }, fields)]\r\n    );\r\n\r\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\r\n      this.submitDisabled = !form.control.valid;\r\n    });\r\n\r\n    this.form$.next(form);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.valueChanges$$.unsubscribe();\r\n  }\r\n\r\n  fillForm() {\r\n    this.data$.next({\r\n      id: 1,\r\n      name: 'Bob',\r\n      status: 2\r\n    });\r\n  }\r\n\r\n  clearForm() {\r\n    this.form$.value.control.reset();\r\n  }\r\n\r\n  onSubmit(data: { [key: string]: any }) {\r\n    alert(JSON.stringify(data));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoFormModule } from '@igo2/common';\r\n\r\nimport { AppFormComponent } from './form.component';\r\nimport { AppFormRoutingModule } from './form-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppFormComponent],\r\n  imports: [SharedModule, AppFormRoutingModule, IgoFormModule],\r\n  exports: [AppFormComponent]\r\n})\r\nexport class AppFormModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppTableComponent } from './table.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'table',\r\n    component: AppTableComponent\r\n  }\r\n];\r\n\r\nexport const AppTableRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { TableDatabase, TableActionColor } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-table',\r\n  templateUrl: './table.component.html',\r\n  styleUrls: ['./table.component.scss']\r\n})\r\nexport class AppTableComponent implements OnInit {\r\n  public database: TableDatabase;\r\n\r\n  public model = {\r\n    columns: [\r\n      {\r\n        name: 'id',\r\n        title: 'ID',\r\n        sortable: false,\r\n        filterable: true\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name',\r\n        sortable: true,\r\n        filterable: true\r\n      },\r\n      {\r\n        name: 'description',\r\n        title: 'Description',\r\n        sortable: true,\r\n        filterable: true\r\n      }\r\n    ],\r\n    actions: [\r\n      {\r\n        icon: 'file-document',\r\n        color: TableActionColor.primary,\r\n        click: (row) => this.showName(row.name)\r\n      }\r\n    ],\r\n    selectionCheckbox: true\r\n  };\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    this.database = new TableDatabase([\r\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\r\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\r\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\r\n    ]);\r\n  }\r\n\r\n  showName(name) {\r\n    alert(name);\r\n  }\r\n\r\n  handleSelect(rows) {\r\n    console.log(rows);\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Table\" subtitle=\"Common\">\r\n  <app-example-viewer codeFolder=\"common/table\">\r\n    <igo-table\r\n      [database]=\"database\"\r\n      [model]=\"model\"\r\n      [hasFilterInput]=\"true\"\r\n      (select)=\"handleSelect($event)\"\r\n    >\r\n    </igo-table>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoTableModule } from '@igo2/common';\r\n\r\nimport { AppTableComponent } from './table.component';\r\nimport { AppTableRoutingModule } from './table-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppTableComponent],\r\n  imports: [SharedModule, AppTableRoutingModule, IgoTableModule],\r\n  exports: [AppTableComponent]\r\n})\r\nexport class AppTableModule {}\r\n","<div\r\n  *ngIf=\"withHeader\"\r\n  class=\"igo-panel-header\"\r\n  title=\"\"\r\n  [ngClass]=\"{ 'igo-cursor-pointer': cursorPointer === true }\"\r\n>\r\n  <div class=\"panel-left\">\r\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\r\n  </div>\r\n  <h3 class=\"igo-panel-title\">\r\n    {{ title }}\r\n    <ng-content select=\"[panelHeader]\"></ng-content>\r\n  </h3>\r\n  <div class=\"panel-right\">\r\n    <ng-content select=\"[panelRightButton]\"></ng-content>\r\n  </div>\r\n</div>\r\n<div class=\"igo-panel-content\" title=\"\">\r\n  <ng-content></ng-content>\r\n</div>\r\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  HostBinding\n} from '@angular/core';\n\n@Component({\n  selector: 'igo-panel',\n  templateUrl: './panel.component.html',\n  styleUrls: ['./panel.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PanelComponent {\n  @Input() title: string;\n\n  @Input()\n  @HostBinding('class.igo-panel-with-header')\n  get withHeader(): boolean {\n    return this._withHeader;\n  }\n  set withHeader(value: boolean) {\n    this._withHeader = value;\n  }\n  private _withHeader = true;\n\n  @Input() cursorPointer: boolean = false;\n}\n","<app-doc-viewer title=\"Tool\" subtitle=\"Common\">\r\n  <app-example-viewer codeFolder=\"common/tool\">\r\n    <igo-panel [title]=\"panelTitle\">\r\n      <button\r\n        mat-icon-button\r\n        panelLeftButton\r\n        (click)=\"toolbox.activatePreviousTool()\"\r\n        *ngIf=\"activeTool$ | async\"\r\n      >\r\n        <mat-icon svgIcon=\"arrow-back\"></mat-icon>\r\n      </button>\r\n\r\n      <button\r\n        mat-icon-button\r\n        panelRightButton\r\n        (click)=\"toolbox.deactivateTool()\"\r\n        *ngIf=\"activeTool$ | async\"\r\n      >\r\n        <mat-icon svgIcon=\"menu\"></mat-icon>\r\n      </button>\r\n\r\n      <igo-toolbox\r\n        [toolbox]=\"toolbox\"\r\n        [animate]=\"true\"\r\n        color=\"primary\"\r\n      ></igo-toolbox>\r\n    </igo-panel>\r\n\r\n    <button\r\n      mat-flat-button\r\n      type=\"button\"\r\n      color=\"primary\"\r\n      (click)=\"activateSalutationTool()\"\r\n    >\r\n      Activate Salutation Tool\r\n    </button>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  OnDestroy,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  OnUpdateInputs,\r\n  Tool,\r\n  Toolbox,\r\n  ToolComponent,\r\n  ToolService\r\n} from '@igo2/common';\r\n\r\n@ToolComponent({\r\n  name: 'demo-salutation',\r\n  title: 'Salutation',\r\n  icon: 'account',\r\n  options: { name: 'Jack' }\r\n})\r\n@Component({\r\n  selector: 'app-salutation-tool',\r\n  template: ` <p>Hello, my name is {{ name }}.</p> `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSalutationToolComponent implements OnUpdateInputs {\r\n  @Input() name: string;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n}\r\n\r\n@ToolComponent({\r\n  name: 'demo-about',\r\n  title: 'About',\r\n  icon: 'information'\r\n})\r\n@Component({\r\n  selector: 'app-about-tool',\r\n  template: ` <p>I'm a tool inside a toolbox.</p> `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppAboutToolComponent {}\r\n\r\n@Component({\r\n  selector: 'app-tool',\r\n  templateUrl: './tool.component.html',\r\n  styleUrls: ['./tool.component.scss']\r\n})\r\nexport class AppToolComponent implements OnInit, OnDestroy {\r\n  toolbox = new Toolbox();\r\n\r\n  get activeTool$(): BehaviorSubject<Tool> {\r\n    return this.toolbox.activeTool$;\r\n  }\r\n\r\n  get panelTitle(): string {\r\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\r\n  }\r\n\r\n  constructor(\r\n    private toolService: ToolService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\r\n    this.toolbox.setTools(this.toolService.getTools());\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.toolbox.destroy();\r\n  }\r\n\r\n  activateSalutationTool() {\r\n    this.toolbox.activateTool('demo-salutation', { name: 'Bob' });\r\n  }\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppToolComponent } from './tool.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'tool',\r\n    component: AppToolComponent\r\n  }\r\n];\r\n\r\nexport const AppToolRoutingModule = RouterModule.forChild(routes);\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoPanelModule, IgoToolModule } from '@igo2/common';\r\n\r\nimport {\r\n  AppToolComponent,\r\n  AppSalutationToolComponent,\r\n  AppAboutToolComponent\r\n} from './tool.component';\r\nimport { AppToolRoutingModule } from './tool-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppToolComponent,\r\n    AppSalutationToolComponent,\r\n    AppAboutToolComponent\r\n  ],\r\n  imports: [\r\n    SharedModule,\r\n    AppToolRoutingModule,\r\n    IgoLanguageModule,\r\n    IgoPanelModule,\r\n    IgoToolModule.forRoot()\r\n  ],\r\n  exports: [AppToolComponent]\r\n})\r\nexport class AppToolModule {}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport {\r\n  DynamicComponent,\r\n  OnUpdateInputs,\r\n  WidgetComponent,\r\n  WidgetService\r\n} from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-salutation-widget',\r\n  template: `\r\n    <p>Hello, my name is {{ name }}.</p>\r\n    <button mat-flat-button (click)=\"complete.emit(name)\">\r\n      Nice to meet you\r\n    </button>\r\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\r\n  `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSalutationWidgetComponent\r\n  implements OnUpdateInputs, WidgetComponent\r\n{\r\n  @Input() name: string;\r\n\r\n  @Output() complete = new EventEmitter<string>();\r\n\r\n  @Output() cancel = new EventEmitter<string>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'app-widget',\r\n  templateUrl: './widget.component.html',\r\n  styleUrls: ['./widget.component.scss']\r\n})\r\nexport class AppWidgetComponent {\r\n  widget: DynamicComponent<WidgetComponent>;\r\n\r\n  inputs = { name: 'Bob' };\r\n\r\n  constructor(private widgetService: WidgetService) {\r\n    this.widget = this.widgetService.create(AppSalutationWidgetComponent);\r\n  }\r\n\r\n  onWidgetComplete(name: string) {\r\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\r\n  }\r\n\r\n  onWidgetCancel() {\r\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\r\n  }\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppWidgetComponent } from './widget.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'widget',\r\n    component: AppWidgetComponent\r\n  }\r\n];\r\n\r\nexport const AppWidgetRoutingModule = RouterModule.forChild(routes);\r\n","<app-doc-viewer title=\"Widget\" subtitle=\"Common\">\r\n  <app-example-viewer codeFolder=\"common/widget\">\r\n    <igo-widget-outlet\r\n      [widget]=\"widget\"\r\n      [inputs]=\"inputs\"\r\n      (complete)=\"onWidgetComplete($event)\"\r\n      (cancel)=\"onWidgetCancel()\"\r\n    >\r\n    </igo-widget-outlet>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoWidgetModule } from '@igo2/common';\r\n\r\nimport {\r\n  AppSalutationWidgetComponent,\r\n  AppWidgetComponent\r\n} from './widget.component';\r\nimport { AppWidgetRoutingModule } from './widget-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppSalutationWidgetComponent, AppWidgetComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppWidgetRoutingModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    IgoWidgetModule\r\n  ],\r\n  exports: [AppWidgetComponent]\r\n})\r\nexport class AppWidgetModule {}\r\n","import { Injectable, Injector } from '@angular/core';\nimport jwtDecode from 'jwt-decode';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TokenService {\n  private options?: AuthOptions;\n  private tokenKey: string;\n\n  constructor(private injector: Injector) {\n    const config = this.injector.get<ConfigService>(ConfigService);\n    this.options = config.getConfig('auth');\n    this.tokenKey = this.options?.tokenKey;\n  }\n\n  set(token: string) {\n    localStorage.setItem(this.tokenKey, token);\n  }\n\n  remove() {\n    localStorage.removeItem(this.tokenKey);\n  }\n\n  get(): string {\n    return localStorage.getItem(this.tokenKey);\n  }\n\n  decode() {\n    const token = this.get();\n    if (!token) {\n      return;\n    }\n    return jwtDecode(token);\n  }\n\n  isExpired() {\n    const jwt = this.decode();\n    const currentTime = new Date().getTime() / 1000;\n    if (jwt && currentTime < jwt.exp) {\n      return false;\n    }\n    return true;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Router } from '@angular/router';\r\n\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\nimport { tap, catchError } from 'rxjs/operators';\r\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\r\n\r\nimport { ConfigService, LanguageService, MessageService } from '@igo2/core';\r\nimport { Base64 } from '@igo2/utils';\r\n\r\nimport { User, IInfosUser } from './auth.interface';\r\nimport { TokenService } from './token.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\r\n  public logged$ = new BehaviorSubject<boolean>(undefined);\r\n  public redirectUrl: string;\r\n  public languageForce = false;\r\n  private anonymous = false;\r\n\r\n  get hasAuthService() {\r\n    return this.config.getConfig('auth.url') !== undefined;\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private tokenService: TokenService,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    @Optional() private router: Router\r\n  ) {\r\n    this.authenticate$.next(this.authenticated);\r\n    this.authenticate$.subscribe((authenticated) => {\r\n      this.logged$.next(authenticated);\r\n      globalCacheBusterNotifier.next();\r\n    });\r\n  }\r\n\r\n  login(username: string, password: string): Observable<void> {\r\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n\r\n    const body = {\r\n      username,\r\n      password: this.encodePassword(password)\r\n    };\r\n\r\n    return this.loginCall(body, myHeader);\r\n  }\r\n\r\n  loginWithToken(\r\n    token: string,\r\n    type: string,\r\n    infosUser?: IInfosUser\r\n  ): Observable<void> {\r\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n\r\n    const body = {\r\n      token,\r\n      typeConnection: type,\r\n      infosUser\r\n    };\r\n\r\n    return this.loginCall(body, myHeader);\r\n  }\r\n\r\n  loginAnonymous(): Observable<boolean> {\r\n    this.anonymous = true;\r\n    this.logged$.next(true);\r\n    return of(true);\r\n  }\r\n\r\n  refresh(): Observable<void> {\r\n    const url = this.config.getConfig('auth.url');\r\n    return this.http.post(`${url}/refresh`, {}).pipe(\r\n      tap((data: any) => {\r\n        this.tokenService.set(data.token);\r\n      }),\r\n      catchError((err) => {\r\n        err.error.caught = true;\r\n        throw err;\r\n      })\r\n    );\r\n  }\r\n\r\n  logout(): Observable<boolean> {\r\n    this.anonymous = false;\r\n    this.tokenService.remove();\r\n    this.authenticate$.next(false);\r\n    return of(true);\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return !this.tokenService.isExpired();\r\n  }\r\n\r\n  getToken(): string {\r\n    return this.tokenService.get();\r\n  }\r\n\r\n  decodeToken() {\r\n    if (this.isAuthenticated()) {\r\n      return this.tokenService.decode();\r\n    }\r\n    return false;\r\n  }\r\n\r\n  goToRedirectUrl() {\r\n    if (!this.router) {\r\n      return;\r\n    }\r\n    const redirectUrl = this.redirectUrl || this.router.url;\r\n\r\n    const options = this.config.getConfig('auth') || {};\r\n    if (redirectUrl === options.loginRoute) {\r\n      const homeRoute = options.homeRoute || '/';\r\n      this.router.navigateByUrl(homeRoute);\r\n    } else if (redirectUrl) {\r\n      this.router.navigateByUrl(redirectUrl);\r\n    }\r\n  }\r\n\r\n  getUserInfo(): Observable<User> {\r\n    const url = this.config.getConfig('auth.url') + '/info';\r\n    return this.http.get<User>(url);\r\n  }\r\n\r\n  getProfils(): Observable<{ profils: string[] }> {\r\n    const url = this.config.getConfig('auth.url');\r\n    return this.http.get<{ profils: string[] }>(`${url}/profils`);\r\n  }\r\n\r\n  updateUser(user: User): Observable<User> {\r\n    const url = this.config.getConfig('auth.url');\r\n    return this.http.patch<User>(url, user);\r\n  }\r\n\r\n  private encodePassword(password: string) {\r\n    return Base64.encode(password);\r\n  }\r\n\r\n  // authenticated or anonymous\r\n  get logged(): boolean {\r\n    return this.authenticated || this.isAnonymous;\r\n  }\r\n\r\n  get isAnonymous(): boolean {\r\n    return this.anonymous;\r\n  }\r\n\r\n  get authenticated(): boolean {\r\n    return this.isAuthenticated();\r\n  }\r\n\r\n  get isAdmin(): boolean {\r\n    const token = this.decodeToken();\r\n    if (token && token.user && token.user.isAdmin) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private loginCall(body, headers) {\r\n    const url = this.config.getConfig('auth.url');\r\n    return this.http.post(`${url}/login`, body, { headers }).pipe(\r\n      tap((data: any) => {\r\n        this.tokenService.set(data.token);\r\n        const tokenDecoded = this.decodeToken();\r\n        if (tokenDecoded && tokenDecoded.user) {\r\n          if (tokenDecoded.user.locale && !this.languageForce) {\r\n            this.languageService.setLanguage(tokenDecoded.user.locale);\r\n          }\r\n          if (tokenDecoded.user.isExpired) {\r\n            this.messageService.alert('igo.auth.error.Password expired');\r\n          }\r\n        }\r\n        this.authenticate$.next(true);\r\n      }),\r\n      catchError((err) => {\r\n        err.error.caught = true;\r\n        throw err;\r\n      })\r\n    );\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  ApplicationRef,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\n\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\nimport { AuthGoogleOptions } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-google',\r\n  templateUrl: './auth-google.component.html',\r\n  styleUrls: ['./auth-google.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthGoogleComponent {\r\n  private options?: AuthGoogleOptions;\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private appRef: ApplicationRef\r\n  ) {\r\n    this.options = this.config.getConfig('auth.google');\r\n\r\n    if (this.options?.apiKey && this.options?.clientId) {\r\n      this.loadSDKGoogle();\r\n      this.loadPlatform();\r\n    } else {\r\n      console.warn(\r\n        'Google authentification needs \"apiKey\" and \"clientId\" options'\r\n      );\r\n    }\r\n  }\r\n\r\n  public handleSignInClick() {\r\n    (window as any).gapi.auth2.getAuthInstance().signIn();\r\n  }\r\n\r\n  public handleSignOutClick() {\r\n    (window as any).gapi.auth2.getAuthInstance().signOut();\r\n  }\r\n\r\n  private handleClientLoad() {\r\n    (window as any).gapi.load('client:auth2', () => this.initClient());\r\n  }\r\n\r\n  private initClient() {\r\n    (window as any).gapi.client\r\n      .init({\r\n        apiKey: this.options?.apiKey,\r\n        clientId: this.options?.clientId,\r\n        discoveryDocs: [\r\n          'https://people.googleapis.com/$discovery/rest?version=v1'\r\n        ],\r\n        scope: 'profile'\r\n      })\r\n      .then(() => {\r\n        this.handleSignOutClick();\r\n        this.updateTextButton();\r\n        (window as any).gapi.auth2\r\n          .getAuthInstance()\r\n          .isSignedIn.listen((rep) => {\r\n            this.updateSigninStatus(rep);\r\n          });\r\n      });\r\n  }\r\n\r\n  private updateSigninStatus(isSignedIn) {\r\n    this.updateTextButton();\r\n    if (isSignedIn) {\r\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\r\n    }\r\n  }\r\n\r\n  private updateTextButton() {\r\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\r\n    if (btn && this.languageService.getLanguage() !== 'en') {\r\n      if (btn.innerHTML === 'Sign in with Google') {\r\n        btn.innerHTML = this.languageService.translate.instant(\r\n          'igo.auth.google.login'\r\n        );\r\n      } else if (btn.innerHTML === 'Signed in with Google') {\r\n        btn.innerHTML = this.languageService.translate.instant(\r\n          'igo.auth.google.logged'\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private loginGoogle(token) {\r\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\r\n      this.appRef.tick();\r\n      this.login.emit(true);\r\n    });\r\n  }\r\n\r\n  private loadSDKGoogle() {\r\n    const fjs = document.getElementsByTagName('script')[0];\r\n    const js = document.createElement('script');\r\n    js.id = 'google-jssdk';\r\n    js.src = 'https://apis.google.com/js/api.js';\r\n    js.onload = () => {\r\n      this.handleClientLoad();\r\n    };\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n  }\r\n\r\n  private loadPlatform() {\r\n    const fjs = document.getElementsByTagName('script')[0];\r\n    const js = document.createElement('script');\r\n    js.id = 'google-platform';\r\n    js.src = 'https://apis.google.com/js/platform.js';\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n  }\r\n}\r\n","<div\r\n  class=\"g-signin2 google-login-button\"\r\n  data-height=\"40\"\r\n  data-width=\"265\"\r\n  data-longtitle=\"true\"\r\n></div>\r\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\r\n  <div>\r\n    <mat-form-field class=\"full-width\">\r\n      <mat-label>{{ 'igo.auth.user' | translate }}</mat-label>\r\n      <input\r\n        matInput\r\n        required\r\n        placeholder=\"{{ 'igo.auth.user' | translate }}\"\r\n        formControlName=\"username\"\r\n      />\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div>\r\n    <mat-form-field class=\"full-width\">\r\n      <mat-label>{{ 'igo.auth.password' | translate }}</mat-label>\r\n      <input\r\n        matInput\r\n        required\r\n        type=\"password\"\r\n        placeholder=\"{{ 'igo.auth.password' | translate }}\"\r\n        formControlName=\"password\"\r\n      />\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <button mat-raised-button type=\"submit\">\r\n    {{ 'igo.auth.login' | translate }}\r\n  </button>\r\n  <button\r\n    *ngIf=\"allowAnonymous\"\r\n    mat-raised-button\r\n    class=\"anonymous\"\r\n    type=\"button\"\r\n    [disabled]=\"loading\"\r\n    (click)=\"loginAnonymous()\"\r\n  >\r\n    {{ 'igo.auth.accessAnonymous' | translate }}\r\n  </button>\r\n  <div *ngIf=\"error\">\r\n    <br />\r\n    <font size=\"3\" color=\"red\">{{ error }}</font>\r\n  </div>\r\n</form>\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  Input,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport {\r\n  Validators,\r\n  UntypedFormGroup,\r\n  UntypedFormBuilder\r\n} from '@angular/forms';\r\n\r\nimport { AuthService } from '../shared/auth.service';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-auth-intern',\r\n  templateUrl: './auth-intern.component.html',\r\n  styleUrls: ['./auth-intern.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.Default\r\n})\r\nexport class AuthInternComponent {\r\n  @Input()\r\n  get allowAnonymous(): boolean {\r\n    return this._allowAnonymous;\r\n  }\r\n  set allowAnonymous(value: boolean) {\r\n    this._allowAnonymous = value;\r\n  }\r\n  private _allowAnonymous = true;\r\n\r\n  public error = '';\r\n  public form: UntypedFormGroup;\r\n  public loading = false;\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  constructor(\r\n    public auth: AuthService,\r\n    private languageService: LanguageService,\r\n    fb: UntypedFormBuilder\r\n  ) {\r\n    this.form = fb.group({\r\n      username: ['', Validators.required],\r\n      password: ['', Validators.required]\r\n    });\r\n  }\r\n\r\n  loginUser(values: any) {\r\n    this.loading = true;\r\n    this.auth.login(values.username, values.password).subscribe(\r\n      () => {\r\n        this.login.emit(true);\r\n        this.loading = false;\r\n      },\r\n      (error: any) => {\r\n        try {\r\n          this.languageService.translate\r\n            .get('igo.auth.error.' + error.error.message)\r\n            .subscribe((errorMsg) => (this.error = errorMsg));\r\n        } catch (e) {\r\n          this.error = error.error.message;\r\n        }\r\n        this.loading = false;\r\n      }\r\n    );\r\n    return false;\r\n  }\r\n\r\n  loginAnonymous() {\r\n    this.auth.loginAnonymous().subscribe(() => {\r\n      this.login.emit(true);\r\n    });\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  ApplicationRef,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { AuthFacebookOptions } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-facebook',\r\n  templateUrl: './auth-facebook.component.html',\r\n  styleUrls: ['./auth-facebook.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthFacebookComponent {\r\n  private options?: AuthFacebookOptions;\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private appRef: ApplicationRef\r\n  ) {\r\n    this.options = this.config.getConfig('auth.facebook');\r\n\r\n    if (this.options?.appId) {\r\n      this.loadSDKFacebook();\r\n    } else {\r\n      console.warn('Facebook authentification needs \"appId\" option');\r\n    }\r\n  }\r\n\r\n  private subscribeEvents() {\r\n    (window as any).FB.Event.subscribe('auth.statusChange', (rep) => {\r\n      this.statusChangeCallback(rep);\r\n    });\r\n  }\r\n\r\n  private statusChangeCallback(response) {\r\n    if (response.status === 'connected') {\r\n      const accessToken = response.authResponse.accessToken;\r\n      this.loginFacebook(accessToken);\r\n    }\r\n  }\r\n\r\n  private loginFacebook(token) {\r\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\r\n      this.appRef.tick();\r\n      this.login.emit(true);\r\n    });\r\n  }\r\n\r\n  private loadSDKFacebook() {\r\n    if (document.getElementById('facebook-jssdk')) {\r\n      return;\r\n    }\r\n\r\n    const urlSDK =\r\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\r\n\r\n    const fjs = document.getElementsByTagName('script')[0];\r\n    const js = document.createElement('script');\r\n    js.id = 'facebook-jssdk';\r\n    js.src = `${urlSDK}&appId=${this.options?.appId}`;\r\n    js.onload = () => {\r\n      this.subscribeEvents();\r\n    };\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n  }\r\n}\r\n","<div\r\n  scope=\"public_profile,email\"\r\n  class=\"fb-login-button\"\r\n  data-max-rows=\"1\"\r\n  data-size=\"large\"\r\n  data-button-type=\"login_with\"\r\n  data-show-faces=\"false\"\r\n  data-auto-logout-link=\"false\"\r\n  data-use-continue-as=\"false\"\r\n></div>\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  ApplicationRef,\r\n  Output,\r\n  EventEmitter,\r\n  Inject\r\n} from '@angular/core';\r\nimport {\r\n  MsalBroadcastService,\r\n  MsalService,\r\n  MSAL_GUARD_CONFIG\r\n} from '@azure/msal-angular';\r\nimport {\r\n  InteractionStatus,\r\n  AuthenticationResult,\r\n  PublicClientApplication,\r\n  PopupRequest,\r\n  SilentRequest,\r\n  InteractionRequiredAuthError\r\n} from '@azure/msal-browser';\r\nimport { ConfigService } from '@igo2/core';\r\nimport {\r\n  AuthMicrosoftOptions,\r\n  MSPMsalGuardConfiguration\r\n} from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\nimport { filter, takeUntil } from 'rxjs/operators';\r\nimport { Subject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-auth-microsoft',\r\n  templateUrl: './auth-microsoft.component.html',\r\n  styleUrls: ['./auth-microsoft.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthMicrosoftComponent {\r\n  private options?: AuthMicrosoftOptions;\r\n  private readonly _destroying$ = new Subject<void>();\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n  private broadcastService: MsalBroadcastService;\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private appRef: ApplicationRef,\r\n    private msalService: MsalService,\r\n    @Inject(MSAL_GUARD_CONFIG)\r\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\r\n  ) {\r\n    this.options = this.config.getConfig('auth.microsoft');\r\n\r\n    this.msalService.instance = new PublicClientApplication({\r\n      auth: this.options,\r\n      cache: {\r\n        cacheLocation: 'sessionStorage'\r\n      }\r\n    });\r\n\r\n    this.broadcastService = new MsalBroadcastService(\r\n      this.msalService.instance,\r\n      this.msalService\r\n    );\r\n\r\n    if (this.options?.clientId) {\r\n      this.broadcastService.inProgress$\r\n        .pipe(\r\n          filter(\r\n            (status: InteractionStatus) => status === InteractionStatus.None\r\n          ),\r\n          takeUntil(this._destroying$)\r\n        )\r\n        .subscribe(() => {\r\n          this.checkAccount();\r\n        });\r\n    } else {\r\n      console.warn('Microsoft authentification needs \"clientId\" option');\r\n    }\r\n  }\r\n\r\n  public loginMicrosoft() {\r\n    this.msalService\r\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\r\n      .subscribe((response: AuthenticationResult) => {\r\n        this.msalService.instance.setActiveAccount(response.account);\r\n        this.checkAccount();\r\n      });\r\n  }\r\n\r\n  private checkAccount() {\r\n    this.msalService.instance\r\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\r\n      .then((response: AuthenticationResult) => {\r\n        const tokenAccess = response.accessToken;\r\n        const tokenId = response.idToken;\r\n        this.authService\r\n          .loginWithToken(tokenAccess, 'microsoft', { tokenId })\r\n          .subscribe(() => {\r\n            this.appRef.tick();\r\n            this.login.emit(true);\r\n          });\r\n      })\r\n      .catch(async (error) => {\r\n        if (error instanceof InteractionRequiredAuthError) {\r\n          // fallback to interaction when silent call fails\r\n          return this.msalService.acquireTokenPopup(\r\n            this.getConf().authRequest as SilentRequest\r\n          );\r\n        }\r\n        console.log(error);\r\n      })\r\n      .catch((error) => {\r\n        console.log('Silent token fails');\r\n      });\r\n  }\r\n\r\n  private getConf(): MSPMsalGuardConfiguration {\r\n    return this.msalGuardConfig.filter((conf) => conf.type === 'add')[0];\r\n  }\r\n}\r\n","<button\r\n  class=\"microsoft-login-button\"\r\n  mat-raised-button\r\n  (click)=\"loginMicrosoft()\"\r\n>\r\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\r\n  {{ 'igo.auth.microsoft.login' | translate }}\r\n</button>\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { Location } from '@angular/common';\r\nimport {\r\n  IPublicClientApplication,\r\n  EndSessionRequest,\r\n  EndSessionPopupRequest,\r\n  AuthenticationResult,\r\n  RedirectRequest,\r\n  SilentRequest,\r\n  PopupRequest,\r\n  SsoSilentRequest,\r\n  Logger,\r\n  WrapperSKU\r\n} from '@azure/msal-browser';\r\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\r\nimport { Observable, from } from 'rxjs';\r\nimport { IMsalService } from '@azure/msal-angular';\r\n\r\n@Injectable()\r\nexport class MsalServiceb2c implements IMsalService {\r\n  private redirectHash: string;\r\n  private logger: Logger;\r\n  private name = '@azure/msal-angular';\r\n  private version = '2.0.0-beta.2';\r\n  constructor(\r\n    @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\r\n    private location: Location\r\n  ) {\r\n    const hash = this.location.path(true).split('#').pop();\r\n    if (hash) {\r\n      this.redirectHash = `#${hash}`;\r\n    }\r\n    this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\r\n  }\r\n\r\n  initialize(): Observable<void> {\r\n    return from(this.instance.initialize());\r\n  }\r\n\r\n  acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\r\n    return from(this.instance.acquireTokenPopup(request));\r\n  }\r\n  acquireTokenRedirect(request: RedirectRequest): Observable<void> {\r\n    return from(this.instance.acquireTokenRedirect(request));\r\n  }\r\n  acquireTokenSilent(\r\n    silentRequest: SilentRequest\r\n  ): Observable<AuthenticationResult> {\r\n    return from(this.instance.acquireTokenSilent(silentRequest));\r\n  }\r\n  handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\r\n    return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\r\n  }\r\n  loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\r\n    return from(this.instance.loginPopup(request));\r\n  }\r\n  loginRedirect(request?: RedirectRequest): Observable<void> {\r\n    return from(this.instance.loginRedirect(request));\r\n  }\r\n  logout(logoutRequest?: EndSessionRequest): Observable<void> {\r\n    return from(this.instance.logout(logoutRequest));\r\n  }\r\n  logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\r\n    return from(this.instance.logoutRedirect(logoutRequest));\r\n  }\r\n  logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\r\n    return from(this.instance.logoutPopup(logoutRequest));\r\n  }\r\n  ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\r\n    return from(this.instance.ssoSilent(request));\r\n  }\r\n  /**\r\n   * Gets logger for msal-angular.\r\n   * If no logger set, returns logger instance created with same options as msal-browser\r\n   */\r\n  getLogger(): Logger {\r\n    if (!this.logger) {\r\n      this.logger = this.instance.getLogger().clone(this.name, this.version);\r\n    }\r\n    return this.logger;\r\n  }\r\n  // Create a logger instance for msal-angular with the same options as msal-browser\r\n  setLogger(logger: Logger): void {\r\n    this.logger = logger.clone(this.name, this.version);\r\n    this.instance.setLogger(logger);\r\n  }\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\r\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\r\nimport {\r\n  EventMessage,\r\n  EventMessageUtils,\r\n  IPublicClientApplication,\r\n  InteractionStatus\r\n} from '@azure/msal-browser';\r\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\r\n\r\n@Injectable()\r\nexport class MsalBroadcastServiceb2c {\r\n  private _msalSubject: Subject<EventMessage>;\r\n  public msalSubject$: Observable<EventMessage>;\r\n  private _inProgress: BehaviorSubject<InteractionStatus>;\r\n  public inProgress$: Observable<InteractionStatus>;\r\n\r\n  constructor(\r\n    @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\r\n    private authService: MsalServiceb2c\r\n  ) {\r\n    this._msalSubject = new Subject<EventMessage>();\r\n    this.msalSubject$ = this._msalSubject.asObservable();\r\n\r\n    // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\r\n    this._inProgress = new BehaviorSubject<InteractionStatus>(\r\n      InteractionStatus.Startup\r\n    );\r\n    this.inProgress$ = this._inProgress.asObservable();\r\n\r\n    this.msalInstance.addEventCallback((message: EventMessage) => {\r\n      this._msalSubject.next(message);\r\n      const status = EventMessageUtils.getInteractionStatusFromEvent(message);\r\n      if (status !== null) {\r\n        this.authService\r\n          .getLogger()\r\n          .verbose(\r\n            `BroadcastService - ${message.eventType} results in setting inProgress to ${status}`\r\n          );\r\n        this._inProgress.next(status);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  ApplicationRef,\r\n  Output,\r\n  EventEmitter,\r\n  Inject\r\n} from '@angular/core';\r\n\r\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\r\nimport {\r\n  InteractionStatus,\r\n  AuthenticationResult,\r\n  PublicClientApplication,\r\n  PopupRequest,\r\n  SilentRequest,\r\n  InteractionRequiredAuthError\r\n} from '@azure/msal-browser';\r\nimport { ConfigService } from '@igo2/core';\r\nimport {\r\n  AuthMicrosoftb2cOptions,\r\n  MSPMsalGuardConfiguration\r\n} from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\nimport { filter, takeUntil } from 'rxjs/operators';\r\nimport { Subject } from 'rxjs';\r\nimport { MsalBroadcastServiceb2c } from '../shared/auth-msalBroadcastServiceb2c.service';\r\nimport { MsalServiceb2c } from '../shared/auth-msalServiceb2c.service.';\r\n\r\n@Component({\r\n  selector: 'igo-auth-microsoftb2c',\r\n  templateUrl: './auth-microsoftb2c.component.html',\r\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthMicrosoftb2cComponent {\r\n  private options: AuthMicrosoftb2cOptions;\r\n  private readonly _destroying$ = new Subject<void>();\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n  private broadcastService: MsalBroadcastServiceb2c;\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private appRef: ApplicationRef,\r\n    private msalService: MsalServiceb2c,\r\n    @Inject(MSAL_GUARD_CONFIG)\r\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\r\n  ) {\r\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\r\n\r\n    this.msalService.instance = new PublicClientApplication({\r\n      auth: this.options.browserAuthOptions,\r\n      cache: {\r\n        cacheLocation: 'sessionStorage'\r\n      }\r\n    });\r\n\r\n    this.broadcastService = new MsalBroadcastServiceb2c(\r\n      this.msalService.instance,\r\n      this.msalService\r\n    );\r\n\r\n    if (this.options.browserAuthOptions.clientId) {\r\n      this.broadcastService.inProgress$\r\n        .pipe(\r\n          filter(\r\n            (status: InteractionStatus) => status === InteractionStatus.None\r\n          ),\r\n          takeUntil(this._destroying$)\r\n        )\r\n        .subscribe(() => {\r\n          this.checkAccount();\r\n        });\r\n    } else {\r\n      console.warn('Microsoft authentification needs \"clientId\" option');\r\n    }\r\n  }\r\n\r\n  public loginMicrosoftb2c() {\r\n    this.msalService\r\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\r\n      .subscribe((response: AuthenticationResult) => {\r\n        this.msalService.instance.setActiveAccount(response.account);\r\n        this.checkAccount();\r\n      });\r\n  }\r\n\r\n  private checkAccount() {\r\n    this.msalService.instance\r\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\r\n      .then((response: AuthenticationResult) => {\r\n        const token = response.idToken;\r\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\r\n          this.appRef.tick();\r\n          this.login.emit(true);\r\n        });\r\n      })\r\n      .catch(async (error) => {\r\n        if (error instanceof InteractionRequiredAuthError) {\r\n          // fallback to interaction when silent call fails\r\n          return this.msalService.acquireTokenPopup(\r\n            this.getConf().authRequest as SilentRequest\r\n          );\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.log('Silent token fails');\r\n      });\r\n  }\r\n\r\n  private getConf(): MSPMsalGuardConfiguration {\r\n    return this.msalGuardConfig.filter((conf) => conf.type === 'b2c')[0];\r\n  }\r\n}\r\n","<button\r\n  class=\"microsoft-login-button\"\r\n  mat-raised-button\r\n  (click)=\"loginMicrosoftb2c()\"\r\n>\r\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\r\n  {{ 'igo.auth.microsoftb2c.login' | translate }}\r\n</button>\r\n","<div *ngIf=\"visible\">\r\n  <div\r\n    *ngIf=\"!auth.logged && backgroundDisable\"\r\n    class=\"backgroundDisable\"\r\n  ></div>\r\n\r\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\r\n    <h1>{{ 'igo.auth.connection' | translate }}</h1>\r\n\r\n    <igo-auth-google\r\n      *ngIf=\"options.google && options.google.enabled !== false\"\r\n      (login)=\"onLogin()\"\r\n    >\r\n    </igo-auth-google>\r\n    <igo-auth-microsoft\r\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\r\n      (login)=\"onLogin()\"\r\n    >\r\n    </igo-auth-microsoft>\r\n    <igo-auth-microsoftb2c\r\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\r\n      (login)=\"onLogin()\"\r\n    >\r\n    </igo-auth-microsoftb2c>\r\n    <igo-auth-facebook\r\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\r\n      (login)=\"onLogin()\"\r\n    >\r\n    </igo-auth-facebook>\r\n    <igo-auth-intern\r\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\r\n      [allowAnonymous]=\"options.allowAnonymous\"\r\n      (login)=\"onLogin()\"\r\n    >\r\n    </igo-auth-intern>\r\n  </div>\r\n\r\n  <div\r\n    *ngIf=\"auth.logged && showAlreadyConnectedDiv\"\r\n    class=\"login center-block\"\r\n  >\r\n    <p>{{ 'igo.auth.welcome' | translate: user }}</p>\r\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">\r\n      {{ 'igo.auth.signOut' | translate }}\r\n    </button>\r\n  </div>\r\n\r\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\r\n    <p>{{ 'igo.auth.deconnection' | translate }}</p>\r\n    <button\r\n      *ngIf=\"options.homeRoute\"\r\n      mat-raised-button\r\n      type=\"button\"\r\n      (click)=\"home()\"\r\n    >\r\n      {{ 'igo.auth.home' | translate }}\r\n    </button>\r\n  </div>\r\n</div>\r\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  OnInit,\n  Input,\n  Optional,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Router, NavigationStart } from '@angular/router';\nimport { filter } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthFormComponent implements OnInit {\n  @Input()\n  get backgroundDisable(): boolean {\n    if (this.isLogoutRoute || this.isLogoutRoute) {\n      return false;\n    }\n    return this._backgroundDisable;\n  }\n  set backgroundDisable(value: boolean) {\n    this._backgroundDisable = value.toString() === 'true';\n  }\n  private _backgroundDisable = true;\n\n  @Input()\n  get hasAlreadyConnectedDiv(): boolean {\n    return this._hasAlreadyConnectedDiv;\n  }\n  set hasAlreadyConnectedDiv(value: boolean) {\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _hasAlreadyConnectedDiv = true;\n\n  @Input()\n  get hasLogoutDiv(): boolean {\n    return this._hasLogoutDiv;\n  }\n  set hasLogoutDiv(value: boolean) {\n    this._hasLogoutDiv = value.toString() === 'true';\n  }\n  private _hasLogoutDiv = true;\n\n  @Input()\n  get showAlreadyConnectedDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasAlreadyConnectedDiv;\n    }\n    return this._showAlreadyConnectedDiv;\n  }\n  set showAlreadyConnectedDiv(value: boolean) {\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _showAlreadyConnectedDiv = false;\n\n  @Input()\n  get showLogoutDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasLogoutDiv;\n    }\n    return this._showLogoutDiv;\n  }\n  set showLogoutDiv(value: boolean) {\n    this._showLogoutDiv = value.toString() === 'true';\n  }\n  private _showLogoutDiv = false;\n\n  get showLoginDiv(): boolean {\n    if (!this.isLogoutRoute) {\n      return true;\n    }\n  }\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  public options?: AuthOptions;\n  public user;\n\n  public visible = true;\n\n  private isLoginRoute: boolean;\n  private isLogoutRoute: boolean;\n\n  constructor(\n    public auth: AuthService,\n    private config: ConfigService,\n    @Optional() private router: Router\n  ) {\n    this.options = this.config.getConfig('auth');\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\n  }\n\n  public ngOnInit() {\n    this.analyzeRoute();\n    this.getName();\n  }\n\n  public onLogin() {\n    this.auth.goToRedirectUrl();\n    this.getName();\n    this.login.emit(true);\n  }\n\n  public logout() {\n    this.auth.logout().subscribe(() => {\n      this.user = undefined;\n      if (this.router) {\n        if (this.options?.logoutRoute) {\n          this.router.navigate([this.options?.logoutRoute]);\n        } else if (this.options?.homeRoute) {\n          this.router.navigate([this.options?.homeRoute]);\n        }\n      }\n    });\n  }\n\n  public home() {\n    if (this.router && this.options?.homeRoute) {\n      this.router.navigate([this.options?.homeRoute]);\n    }\n  }\n\n  private getName() {\n    const tokenDecoded = this.auth.decodeToken();\n    if (tokenDecoded) {\n      this.user = {\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\n      };\n    }\n  }\n\n  private analyzeRoute() {\n    if (!this.router) {\n      return;\n    }\n\n    this.router.events\n      .pipe(filter((event) => event instanceof NavigationStart))\n      .subscribe((changeEvent: any) => {\n        if (changeEvent.url) {\n          const currentRoute = changeEvent.url;\n          const logoutRoute = this.options?.logoutRoute;\n          const loginRoute = this.options?.loginRoute;\n\n          this.isLogoutRoute = currentRoute === logoutRoute;\n          this.isLoginRoute = currentRoute === loginRoute;\n\n          if (this.isLogoutRoute) {\n            this.auth.logout();\n          }\n        }\n      });\n  }\n}\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport {\r\n  HttpEvent,\r\n  HttpInterceptor,\r\n  HttpHandler,\r\n  HttpRequest\r\n} from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { TokenService } from './token.service';\r\nimport { AuthByKeyOptions, WithCredentialsOptions } from './auth.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthInterceptor implements HttpInterceptor {\r\n  private refreshInProgress = false;\r\n  private trustHosts: string[];\r\n  private hostsWithCredentials: WithCredentialsOptions[];\r\n  private hostsWithAuthByKey: AuthByKeyOptions[];\r\n\r\n  constructor(\r\n    private config: ConfigService,\r\n    private tokenService: TokenService,\r\n    private http: HttpClient\r\n  ) {\r\n    this.trustHosts = this.config.getConfig('auth.trustHosts') || [];\r\n    this.trustHosts.push(window.location.hostname);\r\n\r\n    this.hostsWithCredentials =\r\n      this.config.getConfig('auth.hostsWithCredentials') || [];\r\n    this.hostsWithAuthByKey = this.config.getConfig('auth.hostsByKey') || [];\r\n  }\r\n\r\n  intercept(\r\n    originalReq: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\r\n    let req = originalReq.clone();\r\n    const hostWithKey = this.handleHostsAuthByKey(originalReq.url);\r\n    if (hostWithKey) {\r\n      req = req.clone({\r\n        params: req.params.set(hostWithKey.key, hostWithKey.value)\r\n      });\r\n    }\r\n    if (withCredentials) {\r\n      req = originalReq.clone({\r\n        withCredentials\r\n      });\r\n      return next.handle(req);\r\n    }\r\n    this.refreshToken();\r\n    const token = this.tokenService.get();\r\n    const element = document.createElement('a');\r\n    element.href = req.url;\r\n    if (element.host === '') {\r\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\r\n    }\r\n\r\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\r\n      return next.handle(req);\r\n    }\r\n\r\n    const authHeader = `Bearer ${token}`;\r\n    let authReq = req.clone({\r\n      headers: req.headers.set('Authorization', authHeader)\r\n    });\r\n\r\n    const tokenDecoded: any = this.tokenService.decode();\r\n    if (\r\n      authReq.params.get('_i') === 'true' &&\r\n      tokenDecoded &&\r\n      tokenDecoded.user &&\r\n      tokenDecoded.user.sourceId\r\n    ) {\r\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\r\n      authReq = authReq.clone({\r\n        params: authReq.params.set('_i', hashUser)\r\n      });\r\n    } else if (authReq.params.get('_i') === 'true') {\r\n      authReq = authReq.clone({\r\n        params: authReq.params.delete('_i')\r\n      });\r\n    }\r\n\r\n    return next.handle(authReq);\r\n  }\r\n\r\n  interceptXhr(xhr, url: string): boolean {\r\n    const withCredentials = this.handleHostsWithCredentials(url);\r\n    if (withCredentials) {\r\n      xhr.withCredentials = withCredentials;\r\n      return true;\r\n    }\r\n\r\n    this.refreshToken();\r\n    const element = document.createElement('a');\r\n    element.href = url;\r\n\r\n    const token = this.tokenService.get();\r\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\r\n      return false;\r\n    }\r\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\r\n    return true;\r\n  }\r\n\r\n  alterUrlWithKeyAuth(url: string): string {\r\n    const hostWithKey = this.handleHostsAuthByKey(url);\r\n    let interceptedUrl = url;\r\n    if (hostWithKey) {\r\n      const urlDecomposed = interceptedUrl.split(/[?&]/);\r\n      let urlWithKeyAdded = urlDecomposed.shift();\r\n      const paramsToKeep = urlDecomposed.filter((p) => p.length !== 0);\r\n      paramsToKeep.push(`${hostWithKey.key}=${hostWithKey.value}`);\r\n      if (paramsToKeep.length) {\r\n        urlWithKeyAdded += '?' + paramsToKeep.join('&');\r\n      }\r\n      return urlWithKeyAdded;\r\n    }\r\n    return;\r\n  }\r\n\r\n  private handleHostsWithCredentials(reqUrl: string) {\r\n    let withCredentials = false;\r\n    for (const hostWithCredentials of this.hostsWithCredentials) {\r\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\r\n      if (domainRegex.test(reqUrl)) {\r\n        withCredentials =\r\n          hostWithCredentials.withCredentials !== undefined\r\n            ? hostWithCredentials.withCredentials\r\n            : undefined;\r\n        break;\r\n      }\r\n    }\r\n    return withCredentials;\r\n  }\r\n\r\n  private handleHostsAuthByKey(reqUrl: string): { key: string; value: string } {\r\n    let hostWithKey;\r\n    for (const hostWithAuthByKey of this.hostsWithAuthByKey) {\r\n      const domainRegex = new RegExp(hostWithAuthByKey.domainRegFilters);\r\n      if (domainRegex.test(reqUrl)) {\r\n        var replace = `${hostWithAuthByKey.keyProperty}=${hostWithAuthByKey.keyValue}`;\r\n        var keyAdded = new RegExp(replace, 'gm');\r\n        if (!keyAdded.test(reqUrl)) {\r\n          hostWithKey = {\r\n            key: hostWithAuthByKey.keyProperty,\r\n            value: hostWithAuthByKey.keyValue\r\n          };\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return hostWithKey;\r\n  }\r\n\r\n  refreshToken() {\r\n    const jwt = this.tokenService.decode();\r\n    const currentTime = new Date().getTime() / 1000;\r\n\r\n    if (\r\n      !this.refreshInProgress &&\r\n      jwt &&\r\n      currentTime < jwt.exp &&\r\n      currentTime > jwt.exp - 1800\r\n    ) {\r\n      this.refreshInProgress = true;\r\n\r\n      const url = this.config.getConfig('auth.url');\r\n      return this.http.post(`${url}/refresh`, {}).subscribe(\r\n        (data: any) => {\r\n          this.tokenService.set(data.token);\r\n          this.refreshInProgress = false;\r\n        },\r\n        (err) => {\r\n          err.error.caught = true;\r\n          return err;\r\n        }\r\n      );\r\n    }\r\n  }\r\n}\r\n","import {\r\n  MSAL_GUARD_CONFIG,\r\n  MSAL_INSTANCE,\r\n  MsalService\r\n} from '@azure/msal-angular';\r\n\r\nimport { PublicClientApplication, InteractionType } from '@azure/msal-browser';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { BrowserAuthOptions } from '@azure/msal-browser';\r\n\r\nimport {\r\n  AuthMicrosoftOptions,\r\n  MSPMsalGuardConfiguration\r\n} from './auth.interface';\r\n\r\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\r\n\r\nexport function MSALConfigFactory(\r\n  config: ConfigService\r\n): PublicClientApplication {\r\n  const msConf: BrowserAuthOptions | null = config.getConfig('auth.microsoft');\r\n\r\n  msConf.redirectUri = msConf?.redirectUri || window.location.href;\r\n  msConf.authority =\r\n    msConf?.authority || 'https://login.microsoftonline.com/organizations';\r\n\r\n  const myMsalObj = new PublicClientApplication({\r\n    auth: msConf,\r\n    cache: {\r\n      cacheLocation: 'sessionStorage'\r\n    }\r\n  });\r\n\r\n  return myMsalObj;\r\n}\r\n\r\nexport function MSALConfigFactoryb2c(\r\n  config: ConfigService\r\n): PublicClientApplication {\r\n  const msConf: BrowserAuthOptions | null = config.getConfig(\r\n    'auth.microsoftb2c.browserAuthOptions'\r\n  );\r\n  msConf.redirectUri = msConf?.redirectUri || window.location.href;\r\n  msConf.authority =\r\n    msConf?.authority || 'https://login.microsoftonline.com/organizations';\r\n\r\n  const myMsalObj = new PublicClientApplication({\r\n    auth: msConf,\r\n    cache: {\r\n      cacheLocation: 'sessionStorage'\r\n    }\r\n  });\r\n\r\n  return myMsalObj;\r\n}\r\n\r\nexport function MSALAngularConfigFactory(\r\n  config: ConfigService\r\n): MSPMsalGuardConfiguration {\r\n  const msConf: AuthMicrosoftOptions = config.getConfig('auth.microsoft');\r\n\r\n  return {\r\n    interactionType: InteractionType.Popup,\r\n    authRequest: {\r\n      scopes: ['user.read'],\r\n      loginHint: 'todo'\r\n    },\r\n    type: 'add'\r\n  };\r\n}\r\n\r\nexport function MSALAngularConfigFactoryb2c(\r\n  config: ConfigService\r\n): MSPMsalGuardConfiguration {\r\n  const msConf: BrowserAuthOptions | null = config.getConfig(\r\n    'auth.microsoftb2c.browserAuthOptions'\r\n  );\r\n\r\n  return {\r\n    interactionType: InteractionType.Popup,\r\n    authRequest: {\r\n      scopes: [msConf?.clientId]\r\n    },\r\n    type: 'b2c'\r\n  };\r\n}\r\n\r\nexport function provideAuthMicrosoft(type?: string) {\r\n  if (type === 'b2c') {\r\n    return [\r\n      {\r\n        provide: MSAL_INSTANCE,\r\n        useFactory: MSALConfigFactoryb2c,\r\n        deps: [ConfigService]\r\n      },\r\n      {\r\n        provide: MSAL_GUARD_CONFIG,\r\n        useFactory: MSALAngularConfigFactoryb2c,\r\n        deps: [ConfigService],\r\n        multi: true\r\n      },\r\n      MsalServiceb2c\r\n    ];\r\n  } else {\r\n    return [\r\n      {\r\n        provide: MSAL_INSTANCE,\r\n        useFactory: MSALConfigFactory,\r\n        deps: [ConfigService]\r\n      },\r\n      {\r\n        provide: MSAL_GUARD_CONFIG,\r\n        useFactory: MSALAngularConfigFactory,\r\n        deps: [ConfigService],\r\n        multi: true\r\n      },\r\n      MsalService\r\n    ];\r\n  }\r\n}\r\n","import { Directive, ElementRef } from '@angular/core';\nimport { AuthService } from './auth.service';\n\n@Directive({\n  selector: '[igoProtected]'\n})\nexport class ProtectedDirective {\n  constructor(authentication: AuthService, el: ElementRef) {\n    if (!authentication.isAuthenticated()) {\n      el.nativeElement.parentNode.removeChild(el.nativeElement);\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { StorageScope, ConfigService, BaseStorage } from '@igo2/core';\r\nimport { AuthService } from './auth.service';\r\nimport { TokenService } from './token.service';\r\nimport { AuthStorageOptions } from './storage.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthStorageService extends BaseStorage<AuthStorageOptions> {\r\n  constructor(\r\n    config: ConfigService,\r\n    private http: HttpClient,\r\n    private authService: AuthService,\r\n    private tokenService: TokenService\r\n  ) {\r\n    super(config);\r\n\r\n    this.authService.authenticate$.subscribe((isAuthenticated) => {\r\n      if (isAuthenticated && this.options.url) {\r\n        this.http\r\n          .get(this.options.url)\r\n          .subscribe((userIgo: { preference: object }) => {\r\n            if (userIgo && userIgo.preference) {\r\n              for (const key of Object.keys(userIgo.preference)) {\r\n                const value = userIgo.preference[key];\r\n                super.set(key, value);\r\n              }\r\n            }\r\n          });\r\n      }\r\n    });\r\n  }\r\n\r\n  set(\r\n    key: string,\r\n    value: string | object | boolean | number,\r\n    scope: StorageScope = StorageScope.LOCAL\r\n  ) {\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      const preference = {};\r\n      preference[key] = value;\r\n      this.http.patch(this.options.url, { preference }).subscribe();\r\n    }\r\n    super.set(key, value, scope);\r\n  }\r\n\r\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      const preference = {};\r\n      preference[key] = undefined;\r\n      this.http.patch(this.options.url, { preference }).subscribe();\r\n    }\r\n    super.remove(key, scope);\r\n  }\r\n\r\n  clear(scope: StorageScope = StorageScope.LOCAL) {\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      this.http\r\n        .patch(\r\n          this.options.url,\r\n          { preference: {} },\r\n          {\r\n            params: {\r\n              mergePreference: 'false'\r\n            }\r\n          }\r\n        )\r\n        .subscribe();\r\n    }\r\n\r\n    let token: string;\r\n    if (scope === StorageScope.LOCAL) {\r\n      token = this.tokenService.get();\r\n    }\r\n\r\n    super.clear(scope);\r\n\r\n    if (token) {\r\n      this.tokenService.set(token);\r\n    }\r\n\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      this.http\r\n        .get(this.options.url)\r\n        .subscribe((userIgo: { preference: object }) => {\r\n          if (userIgo && userIgo.preference) {\r\n            for (const key of Object.keys(userIgo.preference)) {\r\n              const value = userIgo.preference[key];\r\n              super.set(key, value);\r\n            }\r\n          }\r\n        });\r\n    }\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MsalModule } from '@azure/msal-angular';\r\n\r\nimport { StorageService, IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { AuthStorageService } from './shared/storage.service';\r\nimport { ProtectedDirective } from './shared/protected.directive';\r\nimport { AuthInterceptor } from './shared/auth.interceptor';\r\nimport { provideAuthMicrosoft } from './shared/auth-microsoft.provider';\r\n\r\nimport { AuthInternComponent } from './auth-form/auth-intern.component';\r\nimport { AuthFormComponent } from './auth-form/auth-form.component';\r\nimport { AuthGoogleComponent } from './auth-form/auth-google.component';\r\nimport { AuthFacebookComponent } from './auth-form/auth-facebook.component';\r\nimport { AuthMicrosoftComponent } from './auth-form/auth-microsoft.component';\r\nimport { AuthMicrosoftb2cComponent } from './auth-form/auth-microsoftb2c.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule,\r\n    MsalModule\r\n  ],\r\n  declarations: [\r\n    AuthFormComponent,\r\n    AuthGoogleComponent,\r\n    AuthInternComponent,\r\n    AuthFacebookComponent,\r\n    AuthMicrosoftComponent,\r\n    AuthMicrosoftb2cComponent,\r\n    ProtectedDirective\r\n  ],\r\n  exports: [AuthFormComponent, ProtectedDirective]\r\n})\r\nexport class IgoAuthModule {\r\n  static forRoot(): ModuleWithProviders<IgoAuthModule> {\r\n    return {\r\n      ngModule: IgoAuthModule,\r\n      providers: [\r\n        {\r\n          provide: HTTP_INTERCEPTORS,\r\n          useClass: AuthInterceptor,\r\n          multi: true\r\n        },\r\n        {\r\n          provide: StorageService,\r\n          useClass: AuthStorageService\r\n        },\r\n        ...provideAuthMicrosoft('add'),\r\n        ...provideAuthMicrosoft('b2c')\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppAuthFormComponent } from './auth-form.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'auth-form',\r\n    component: AppAuthFormComponent\r\n  }\r\n];\r\n\r\nexport const AppAuthFormRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss']\n})\nexport class AppAuthFormComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private languageService: LanguageService) {}\n}\n","<app-doc-viewer\n  title=\"Authentification\"\n  subtitle=\"Auth\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"auth/auth-form\" configFolder=\"environments\">\n    The dialog opens automatically if you are not logged in\n  </app-example-viewer>\n</app-doc-viewer>\n<igo-auth-form></igo-auth-form>\n","import { NgModule } from '@angular/core';\n\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { AppAuthFormComponent } from './auth-form.component';\nimport { AppAuthFormRoutingModule } from './auth-form-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppAuthFormComponent],\n  imports: [AppAuthFormRoutingModule, SharedModule, IgoAuthModule.forRoot()],\n  exports: [AppAuthFormComponent]\n})\nexport class AppAuthFormModule {}\n","import { MatDialogModule } from '@angular/material/dialog';\r\nimport { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport {\r\n  MetadataButtonComponent,\r\n  MetadataAbstractComponent\r\n} from './metadata-button/metadata-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule,\r\n    MatDialogModule\r\n  ],\r\n  exports: [MetadataButtonComponent, MetadataAbstractComponent],\r\n  declarations: [MetadataButtonComponent, MetadataAbstractComponent]\r\n})\r\nexport class IgoMetadataModule {\r\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\r\n    return {\r\n      ngModule: IgoMetadataModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\r\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\r\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\r\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\r\nimport { WFSDataSourceOptions } from '../datasource';\r\n\r\n/**\r\n * Generate a id from it's datasource options.\r\n * @param options Data source options\r\n * @returns A id\r\n */\r\nexport function generateIdFromSourceOptions(\r\n  options: DataSourceOptions\r\n): string {\r\n  const generators = {\r\n    wms: generateWMSIdFromSourceOptions,\r\n    wmts: generateWMTSIdFromSourceOptions,\r\n    xyz: generateXYZIdFromSourceOptions,\r\n    feature: generateFeatureIdFromSourceOptions,\r\n    wfs: generateWfsIdFromSourceOptions,\r\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\r\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\r\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\r\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\r\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\r\n  };\r\n  const generator = generators[options.type] || generateId;\r\n  return generator(options);\r\n}\r\n\r\n/**\r\n * Generate a id from WMS data source options\r\n * @param options WMS data source options\r\n * @returns A md5 hash of the the url and layers\r\n */\r\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\r\n  const layers = options.params.LAYERS;\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'wms' + url + layers;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from WMTS data source options\r\n * @param options WMTS data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateWMTSIdFromSourceOptions(\r\n  options: WMTSDataSourceOptions\r\n) {\r\n  const layer = options.layer;\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'wmts' + url + layer;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from XYZ data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'xyz' + url;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from feature data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateFeatureIdFromSourceOptions(\r\n  options: WMTSDataSourceOptions\r\n) {\r\n  if (!options.url) {\r\n    return generateId(options);\r\n  }\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'feature' + url;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from feature data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\r\n  if (!options.url || !options.params) {\r\n    return generateId(options);\r\n  }\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'wfs' + url + options.params.featureTypes;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n/**\r\n * Generate a id from ArcGIS Rest data source options\r\n * @param options ArcGIS Rest data source options\r\n * @returns A md5 hash of the url and layers\r\n */\r\nexport function generateArcgisRestIdFromSourceOptions(\r\n  options: ArcGISRestDataSourceOptions\r\n) {\r\n  const layers = options.layer;\r\n  const url = standardizeUrl(options.url);\r\n  const chain = (options.type || 'arcgis') + url + layers;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a unique id\r\n * @returns A uuid\r\n */\r\nexport function generateId(_options: AnyDataSourceOptions) {\r\n  return uuid();\r\n}\r\n\r\nexport function standardizeUrl(url: string): string {\r\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\r\n  const urlDecomposed = absUrl.split(/[?&]/);\r\n  let urlStandardized = urlDecomposed.shift();\r\n  const paramsToKeep = urlDecomposed.filter(\r\n    (p) => p.length !== 0 && p.charAt(0) !== '_'\r\n  );\r\n  if (paramsToKeep.length) {\r\n    urlStandardized += '?' + paramsToKeep.join('&');\r\n  }\r\n  return urlStandardized;\r\n}\r\n","import olSource from 'ol/source/Source';\r\nimport olVectorSource from 'ol/source/Vector';\r\nimport olClusterSource from 'ol/source/Cluster';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { DataSourceOptions, Legend } from './datasource.interface';\r\n\r\nimport { DataService } from './data.service';\r\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\r\nimport {\r\n  LegendMapViewOptions,\r\n  LegendOptions\r\n} from '../../../layer/shared/layers/legend.interface';\r\n\r\nexport abstract class DataSource {\r\n  public id: string;\r\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource;\r\n  private legend: Legend[];\r\n\r\n  constructor(\r\n    public options: DataSourceOptions = {},\r\n    protected dataService?: DataService\r\n  ) {\r\n    this.options = options;\r\n    this.id = this.options.id || this.generateId();\r\n    this.ol = this.createOlSource();\r\n  }\r\n\r\n  protected abstract createOlSource(): olSource;\r\n\r\n  protected generateId(): string {\r\n    return generateIdFromSourceOptions(this.options);\r\n  }\r\n\r\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\r\n    return this.legend ? this.legend : [];\r\n  }\r\n\r\n  public setLegend(options: LegendOptions): Legend[] {\r\n    if (options.url) {\r\n      this.legend = [{ url: options.url }];\r\n    } else if (options.html) {\r\n      this.legend = [{ html: options.html }];\r\n    } else {\r\n      this.legend = [];\r\n    }\r\n\r\n    return this.legend;\r\n  }\r\n\r\n  protected abstract onUnwatch();\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public declare options: FeatureDataSourceOptions;\n  public declare ol: olSourceVector<OlGeometry>;\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public declare options: OSMDataSourceOptions;\n  public declare ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\r\n\r\nexport class XYZDataSource extends DataSource {\r\n  public declare options: XYZDataSourceOptions;\r\n  public declare ol: olSourceXYZ;\r\n\r\n  protected createOlSource(): olSourceXYZ {\r\n    return new olSourceXYZ(this.options);\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","export enum OgcFilterOperatorType {\r\n  BasicNumericOperator = 'basicnumericoperator',\r\n  Basic = 'basic',\r\n  BasicAndSpatial = 'basicandspatial',\r\n  Spatial = 'spatial',\r\n  All = 'all',\r\n  Time = 'time'\r\n}\r\n\r\nexport enum OgcFilterOperator {\r\n  BBOX = 'BBox',\r\n  PropertyIsBetween = 'PropertyIsBetween',\r\n  Contains = 'Contains',\r\n  During = 'During',\r\n  PropertyIsEqualTo = 'PropertyIsEqualTo',\r\n  PropertyIsGreaterThan = 'PropertyIsGreaterThan',\r\n  PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\r\n  Intersects = 'Intersects',\r\n  PropertyIsNull = 'PropertyIsNull',\r\n  PropertyIsLessThan = 'PropertyIsLessThan',\r\n  PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\r\n  PropertyIsLike = 'PropertyIsLike',\r\n  PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\r\n  Within = 'Within',\r\n  And = 'And',\r\n  Or = 'Or',\r\n  Not = 'Not'\r\n}\r\n","import * as olfilter from 'ol/format/filter';\r\nimport olFormatWKT from 'ol/format/WKT';\r\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\r\nimport olGeometry from 'ol/geom/Geometry';\r\n\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { uuid, ObjectUtils } from '@igo2/utils';\r\n\r\nimport {\r\n  OgcFilter,\r\n  IgoOgcFilterObject,\r\n  AnyBaseOgcFilterOptions,\r\n  OgcInterfaceFilterOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFiltersOptions,\r\n  IgoOgcSelector,\r\n  SelectorGroup,\r\n  OgcSelectorBundle\r\n} from './ogc-filter.interface';\r\nimport { OgcFilterOperatorType, OgcFilterOperator } from './ogc-filter.enum';\r\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { default as moment } from 'moment';\r\nexport class OgcFilterWriter {\r\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\r\n  public operators = {\r\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.PropertyIsLike as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['string']\r\n    },\r\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsBetween as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\r\n    [OgcFilterOperator.PropertyIsNull as string]: {\r\n      spatial: false,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.Intersects as string]: {\r\n      spatial: true,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\r\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\r\n  };\r\n\r\n  defineOgcFiltersDefaultOptions(\r\n    ogcFiltersOptions: OgcFiltersOptions,\r\n    fieldNameGeometry: string,\r\n    srcType?: string\r\n  ): OgcFiltersOptions {\r\n    let ogcFiltersDefaultValue = true; // default values for wfs.\r\n    if (srcType && srcType === 'wms') {\r\n      ogcFiltersDefaultValue = false;\r\n    }\r\n\r\n    ogcFiltersOptions = ogcFiltersOptions || {};\r\n    ogcFiltersOptions.enabled =\r\n      ogcFiltersOptions.enabled === undefined\r\n        ? ogcFiltersDefaultValue\r\n        : ogcFiltersOptions.enabled;\r\n    ogcFiltersOptions.editable =\r\n      ogcFiltersOptions.editable === undefined\r\n        ? ogcFiltersDefaultValue\r\n        : ogcFiltersOptions.editable;\r\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\r\n\r\n    ogcFiltersOptions.advancedOgcFilters = true;\r\n    if (\r\n      ogcFiltersOptions.enabled &&\r\n      (ogcFiltersOptions.pushButtons ||\r\n        ogcFiltersOptions.checkboxes ||\r\n        ogcFiltersOptions.radioButtons ||\r\n        ogcFiltersOptions.select ||\r\n        ogcFiltersOptions.autocomplete)\r\n    ) {\r\n      ogcFiltersOptions.advancedOgcFilters = false;\r\n    }\r\n    return ogcFiltersOptions;\r\n  }\r\n\r\n  public buildFilter(\r\n    filters?: IgoOgcFilterObject,\r\n    extent?: [number, number, number, number],\r\n    proj?: olProjection,\r\n    fieldNameGeometry?: string,\r\n    options?: OgcFilterableDataSourceOptions\r\n  ): string {\r\n    let ourBboxFilter;\r\n    let enableBbox: boolean;\r\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\r\n      enableBbox = false;\r\n    } else {\r\n      enableBbox = true;\r\n    }\r\n    if (filters) {\r\n      fieldNameGeometry =\r\n        (filters as any).geometryName !== undefined\r\n          ? (filters as any).geometryName\r\n          : fieldNameGeometry;\r\n    }\r\n    if (extent && filters) {\r\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\r\n    }\r\n    let filterAssembly: OgcFilter;\r\n    if (filters) {\r\n      filters = this.checkIgoFiltersProperties(\r\n        filters,\r\n        fieldNameGeometry,\r\n        proj\r\n      );\r\n      if (extent && enableBbox) {\r\n        filterAssembly = olfilter.and(\r\n          ourBboxFilter,\r\n          this.bundleFilter(filters, options)\r\n        );\r\n      } else {\r\n        filterAssembly = this.bundleFilter(filters, options);\r\n      }\r\n    } else {\r\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\r\n    }\r\n\r\n    const wfsOptions: WriteGetFeatureOptions = {\r\n      srsName: '',\r\n      featureNS: '',\r\n      featurePrefix: '',\r\n      featureTypes: ['featureTypes'],\r\n      filter: filterAssembly,\r\n      outputFormat: '',\r\n      geometryName: fieldNameGeometry\r\n    };\r\n\r\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\r\n    const str = new XMLSerializer().serializeToString(query);\r\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\r\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\r\n\r\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\r\n  }\r\n\r\n  private bundleFilter(\r\n    filterObject: any,\r\n    options?: OgcFilterableDataSourceOptions\r\n  ) {\r\n    if (filterObject instanceof Array) {\r\n      const logicalArray = [];\r\n      filterObject.forEach((element) => {\r\n        logicalArray.push(this.bundleFilter(element, options));\r\n      });\r\n      return logicalArray;\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        return this.createFilter(\r\n          {\r\n            operator: filterObject.logical,\r\n            logicalArray: this.bundleFilter(filterObject.filters, options)\r\n          },\r\n          options\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        return this.createFilter(\r\n          filterObject as AnyBaseOgcFilterOptions,\r\n          options\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private createFilter(\r\n    filterOptions,\r\n    options?: OgcFilterableDataSourceOptions\r\n  ): OgcFilter {\r\n    const operator = filterOptions.operator;\r\n    const logicalArray = filterOptions.logicalArray;\r\n\r\n    const wfsPropertyName = filterOptions.propertyName;\r\n    const wfsPattern = filterOptions.pattern;\r\n    const wfsMatchCase = filterOptions.matchCase\r\n      ? filterOptions.matchCase\r\n      : true;\r\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\r\n    const wfsSingleChar = filterOptions.singleChar\r\n      ? filterOptions.singleChar\r\n      : '.';\r\n    const wfsEscapeChar = filterOptions.escapeChar\r\n      ? filterOptions.escapeChar\r\n      : '!';\r\n\r\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\r\n    const wfsUpperBoundary = filterOptions.upperBoundary;\r\n\r\n    const wfsGeometryName = filterOptions.geometryName;\r\n    const wfsExtent = filterOptions.extent;\r\n    const wfsWktGeometry = filterOptions.wkt_geometry;\r\n    const wfsSrsName = filterOptions.srsName\r\n      ? filterOptions.srsName\r\n      : 'EPSG:3857';\r\n\r\n    const wfsBegin = this.parseFilterOptionDate(\r\n      filterOptions.begin,\r\n      options ? options.minDate : undefined\r\n    );\r\n    const wfsEnd = this.parseFilterOptionDate(\r\n      filterOptions.end,\r\n      options ? options.maxDate : undefined\r\n    );\r\n\r\n    const wfsExpression = filterOptions.expression;\r\n\r\n    let geometry: olGeometry;\r\n    if (wfsWktGeometry) {\r\n      const wkt = new olFormatWKT();\r\n      geometry = wkt.readGeometry(wfsWktGeometry, {\r\n        dataProjection: wfsSrsName,\r\n        featureProjection: wfsSrsName || 'EPSG:3857'\r\n      });\r\n    }\r\n\r\n    switch (operator.toLowerCase()) {\r\n      case OgcFilterOperator.BBOX.toLowerCase():\r\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\r\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\r\n        return olfilter.between(\r\n          wfsPropertyName,\r\n          wfsLowerBoundary || 1e40 * -1,\r\n          wfsUpperBoundary || 1e40\r\n        );\r\n      case OgcFilterOperator.Contains.toLowerCase():\r\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\r\n      case OgcFilterOperator.During.toLowerCase():\r\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\r\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\r\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\r\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\r\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\r\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.Intersects.toLowerCase():\r\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\r\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\r\n        return olfilter.isNull(wfsPropertyName);\r\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\r\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\r\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\r\n        return olfilter.like(\r\n          wfsPropertyName,\r\n          wfsPattern\r\n            ? wfsPattern.replace(/[()_]/gi, wfsSingleChar)\r\n            : wfsWildCard,\r\n          wfsWildCard,\r\n          wfsSingleChar,\r\n          wfsEscapeChar,\r\n          wfsMatchCase\r\n        );\r\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\r\n        return olfilter.notEqualTo(\r\n          wfsPropertyName,\r\n          wfsExpression,\r\n          wfsMatchCase\r\n        );\r\n      case OgcFilterOperator.Within.toLowerCase():\r\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\r\n      // LOGICAL\r\n      case OgcFilterOperator.And.toLowerCase():\r\n        return olfilter.and.apply(null, logicalArray);\r\n      case OgcFilterOperator.Or.toLowerCase():\r\n        return olfilter.or.apply(null, logicalArray);\r\n      case OgcFilterOperator.Not.toLowerCase():\r\n        return olfilter.not.apply(null, logicalArray);\r\n\r\n      default:\r\n        return undefined;\r\n    }\r\n  }\r\n\r\n  public defineInterfaceFilterSequence(\r\n    filterObject: any,\r\n    geometryName,\r\n    logical = '',\r\n    level = -1\r\n  ): OgcInterfaceFilterOptions[] {\r\n    if (filterObject instanceof Array) {\r\n      filterObject.forEach((element) => {\r\n        this.filterSequence.concat(\r\n          this.defineInterfaceFilterSequence(\r\n            element,\r\n            geometryName,\r\n            logical,\r\n            level\r\n          )\r\n        );\r\n      });\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        level = level + 1;\r\n        this.filterSequence.concat(\r\n          this.defineInterfaceFilterSequence(\r\n            filterObject.filters,\r\n            geometryName,\r\n            filterObject.logical,\r\n            level\r\n          )\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        this.filterSequence.push(\r\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\r\n        );\r\n      }\r\n    }\r\n    return this.filterSequence;\r\n  }\r\n\r\n  public computeAllowedOperators(\r\n    fields?: SourceFieldsOptionsParams[],\r\n    propertyName?: string,\r\n    defaultOperatorsType?: OgcFilterOperatorType\r\n  ) {\r\n    let effectiveOperators: {} = {};\r\n    let allowedOperators;\r\n    let fieldsHasSpatialOperator: boolean;\r\n    let includeContains: boolean;\r\n\r\n    if (fields && propertyName) {\r\n      const srcField = fields.find((field) => field.name === propertyName);\r\n      allowedOperators =\r\n        srcField && srcField.allowedOperatorsType\r\n          ? srcField.allowedOperatorsType\r\n          : defaultOperatorsType;\r\n    }\r\n\r\n    if (fields) {\r\n      fields.map((field) => {\r\n        if (!field.allowedOperatorsType) {\r\n          return;\r\n        }\r\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\r\n        if (\r\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\r\n          allowedOperatorsType ===\r\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\r\n          allowedOperatorsType ===\r\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\r\n        ) {\r\n          fieldsHasSpatialOperator = true;\r\n          if (\r\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\r\n          ) {\r\n            includeContains = true;\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    allowedOperators = allowedOperators\r\n      ? allowedOperators\r\n      : OgcFilterOperatorType.BasicAndSpatial;\r\n\r\n    switch (allowedOperators.toLowerCase()) {\r\n      case OgcFilterOperatorType.All:\r\n        effectiveOperators = this.operators;\r\n        break;\r\n      case OgcFilterOperatorType.Spatial:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\r\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.BasicAndSpatial:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\r\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.Basic:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.Time:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.BasicNumericOperator:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          },\r\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          },\r\n          [OgcFilterOperator.PropertyIsLessThan]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          },\r\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          }\r\n        };\r\n        break;\r\n      default:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\r\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\r\n        };\r\n    }\r\n\r\n    if (fieldsHasSpatialOperator) {\r\n      (effectiveOperators as any).Intersects = {\r\n        spatial: true,\r\n        fieldRestrict: []\r\n      };\r\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\r\n      if (includeContains) {\r\n        (effectiveOperators as any).Contains = {\r\n          spatial: true,\r\n          fieldRestrict: []\r\n        };\r\n      }\r\n    }\r\n\r\n    return effectiveOperators;\r\n  }\r\n\r\n  public addInterfaceFilter(\r\n    igoOgcFilterObject?,\r\n    geometryName?,\r\n    level = 0,\r\n    parentLogical = 'Or'\r\n  ): OgcInterfaceFilterOptions {\r\n    if (!igoOgcFilterObject) {\r\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\r\n    }\r\n    const f = {\r\n      propertyName: '',\r\n      operator: '',\r\n      active: '',\r\n      filterid: uuid(),\r\n      step: '',\r\n      begin: '',\r\n      end: '',\r\n      sliderOptions: {},\r\n      lowerBoundary: '',\r\n      upperBoundary: '',\r\n      expression: '',\r\n      pattern: '',\r\n      wildCard: '*',\r\n      singleChar: '.',\r\n      escapeChar: '!',\r\n      matchCase: true,\r\n      igoSpatialSelector: '',\r\n      igoSNRC: '',\r\n      geometryName: '',\r\n      geometry: '',\r\n      wkt_geometry: '',\r\n      extent: '',\r\n      srsName: '',\r\n      parentLogical: '',\r\n      level: 0\r\n    };\r\n\r\n    return Object.assign(\r\n      f,\r\n      {\r\n        parentLogical,\r\n        level,\r\n        geometryName\r\n      },\r\n      igoOgcFilterObject\r\n    );\r\n  }\r\n\r\n  public checkIgoFiltersProperties(\r\n    filterObject: any,\r\n    fieldNameGeometry,\r\n    proj: olProjection,\r\n    active = false\r\n  ) {\r\n    const filterArray = [];\r\n    if (filterObject instanceof Array) {\r\n      filterObject.forEach((element) => {\r\n        filterArray.push(\r\n          this.checkIgoFiltersProperties(\r\n            element,\r\n            fieldNameGeometry,\r\n            proj,\r\n            active\r\n          )\r\n        );\r\n      });\r\n      return filterArray;\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        return Object.assign(\r\n          {},\r\n          {\r\n            logical: filterObject.logical,\r\n            filters: this.checkIgoFiltersProperties(\r\n              filterObject.filters,\r\n              fieldNameGeometry,\r\n              proj,\r\n              active\r\n            )\r\n          }\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        return this.addFilterProperties(\r\n          filterObject as OgcInterfaceFilterOptions,\r\n          fieldNameGeometry,\r\n          proj,\r\n          active\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private addFilterProperties(\r\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\r\n    fieldNameGeometry,\r\n    proj: olProjection,\r\n    active = false\r\n  ) {\r\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\r\n      ? igoOgcFilterObject.filterid\r\n      : uuid();\r\n    const status = igoOgcFilterObject.hasOwnProperty('active')\r\n      ? igoOgcFilterObject.active\r\n      : active;\r\n\r\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\r\n      ? igoOgcFilterObject.srsName\r\n      : proj\r\n      ? proj.getCode()\r\n      : 'EPSG:3857';\r\n\r\n    return Object.assign(\r\n      {},\r\n      {\r\n        filterid,\r\n        active: status,\r\n        igoSpatialSelector: 'fixedExtent',\r\n        srsName\r\n      },\r\n      igoOgcFilterObject,\r\n      { geometryName: fieldNameGeometry }\r\n    );\r\n  }\r\n\r\n  public rebuiltIgoOgcFilterObjectFromSequence(\r\n    sequence: OgcInterfaceFilterOptions[]\r\n  ): IgoOgcFilterObject {\r\n    if (sequence instanceof Array) {\r\n      if (sequence.length >= 1) {\r\n        let lastParentLogical = sequence[0].parentLogical;\r\n        let nextElement: any;\r\n        let logicalArray = [];\r\n        let lastProcessedFilter;\r\n        sequence.forEach((uiFilter) => {\r\n          const element = Object.assign({}, uiFilter);\r\n          const index = sequence.indexOf(uiFilter);\r\n          if (index >= 0 && index < sequence.length - 1) {\r\n            nextElement = sequence[index + 1];\r\n          } else {\r\n            nextElement = element;\r\n          }\r\n          delete element.active;\r\n          delete element.filterid;\r\n          delete element.parentLogical;\r\n          logicalArray.push(element);\r\n\r\n          if (sequence.length === 1) {\r\n            lastProcessedFilter = element;\r\n          } else if (lastParentLogical !== nextElement.parentLogical) {\r\n            if (logicalArray.length === 1) {\r\n              console.log(\r\n                'You must set at ' +\r\n                  'least two operator in a logical (' +\r\n                  lastParentLogical +\r\n                  ')'\r\n              );\r\n            } else {\r\n              lastProcessedFilter = Object.assign(\r\n                {},\r\n                { logical: lastParentLogical, filters: logicalArray }\r\n              );\r\n              logicalArray = [lastProcessedFilter];\r\n              lastParentLogical = nextElement.parentLogical;\r\n            }\r\n          }\r\n        });\r\n        return lastProcessedFilter;\r\n      } else {\r\n        return undefined;\r\n      }\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\r\n    if (\r\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\r\n    ) {\r\n      return selectors;\r\n    }\r\n    let selector: IgoOgcSelector;\r\n    if (selectors.groups && selectors.bundles) {\r\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\r\n        throw new Error('You must set an id for each of your bundles');\r\n      }\r\n      selector = ObjectUtils.copyDeep(selectors);\r\n      selector.groups.forEach((group) => {\r\n        group.title = group.title ? group.title : group.name;\r\n        group.enabled = group.enabled ? group.enabled : false;\r\n        group.computedSelectors = ObjectUtils.copyDeep(\r\n          selector.bundles.filter((b) => group.ids.includes(b.id))\r\n        );\r\n      });\r\n    } else if (!selectors.groups && selectors.bundles) {\r\n      selector = ObjectUtils.copyDeep(selectors);\r\n      selector.groups = [\r\n        {\r\n          title: 'group1',\r\n          name: 'group1',\r\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\r\n        } as SelectorGroup\r\n      ];\r\n    } else {\r\n      selector = {\r\n        bundles: selectors as any,\r\n        groups: [\r\n          {\r\n            title: 'group1',\r\n            name: 'group1',\r\n            computedSelectors: ObjectUtils.copyDeep(\r\n              selectors\r\n            ) as OgcSelectorBundle[]\r\n          } as SelectorGroup\r\n        ],\r\n        selectorType: selector.selectorType\r\n      };\r\n    }\r\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\r\n      selector.groups[0].enabled = true;\r\n    }\r\n    return selector;\r\n  }\r\n\r\n  public handleOgcFiltersAppliedValue(\r\n    options: OgcFilterableDataSourceOptions,\r\n    fieldNameGeometry: string,\r\n    extent?: [number, number, number, number],\r\n    proj?: olProjection\r\n  ): string {\r\n    const ogcFilters = options.ogcFilters;\r\n    if (!ogcFilters) {\r\n      return;\r\n    }\r\n    const conditions = [];\r\n    let filterQueryStringSelector = '';\r\n    let filterQueryStringAdvancedFilters = '';\r\n    if (\r\n      ogcFilters.enabled &&\r\n      (ogcFilters.pushButtons ||\r\n        ogcFilters.checkboxes ||\r\n        ogcFilters.radioButtons ||\r\n        ogcFilters.select ||\r\n        ogcFilters.autocomplete)\r\n    ) {\r\n      let selectors;\r\n      if (ogcFilters.pushButtons) {\r\n        selectors = ogcFilters.pushButtons;\r\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\r\n        for (const condition of pushConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.checkboxes) {\r\n        selectors = ogcFilters.checkboxes;\r\n        const checkboxConditions = this.formatGroupAndFilter(\r\n          ogcFilters,\r\n          selectors\r\n        );\r\n        for (const condition of checkboxConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.radioButtons) {\r\n        selectors = ogcFilters.radioButtons;\r\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\r\n        const radioConditions = this.formatGroupAndFilter(\r\n          ogcFilters,\r\n          selectorsCorr\r\n        );\r\n        for (const condition of radioConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.select) {\r\n        selectors = ogcFilters.select;\r\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\r\n        const selectConditions = this.formatGroupAndFilter(\r\n          ogcFilters,\r\n          selectorsCorr\r\n        );\r\n        for (const condition of selectConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.autocomplete) {\r\n        selectors = ogcFilters.autocomplete;\r\n        const selectConditions = this.formatGroupAndFilter(\r\n          ogcFilters,\r\n          selectors\r\n        );\r\n        for (const condition of selectConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n\r\n      if (conditions.length >= 1) {\r\n        filterQueryStringSelector = this.buildFilter(\r\n          conditions.length === 1\r\n            ? conditions[0]\r\n            : { logical: 'And', filters: conditions },\r\n          extent,\r\n          proj,\r\n          ogcFilters.geometryName\r\n        );\r\n      }\r\n    }\r\n    if (ogcFilters.enabled && ogcFilters.filters) {\r\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\r\n      const igoFilters = ogcFilters.filters;\r\n      filterQueryStringAdvancedFilters = this.buildFilter(\r\n        igoFilters,\r\n        extent,\r\n        proj,\r\n        ogcFilters.geometryName,\r\n        options\r\n      );\r\n    }\r\n\r\n    let filterQueryString = ogcFilters.advancedOgcFilters\r\n      ? filterQueryStringAdvancedFilters\r\n      : filterQueryStringSelector;\r\n    if (options.type === 'wms') {\r\n      filterQueryString = this.formatProcessedOgcFilter(\r\n        filterQueryString,\r\n        (options as any).params.LAYERS\r\n      );\r\n    }\r\n    if (options.type === 'wfs') {\r\n      filterQueryString = this.formatProcessedOgcFilter(\r\n        filterQueryString,\r\n        (options as any).params.featureTypes\r\n      );\r\n    }\r\n\r\n    return filterQueryString;\r\n  }\r\n\r\n  public verifyMultipleEnableds(selectors) {\r\n    selectors.bundles.forEach((bundle) => {\r\n      if (!bundle.multiple && bundle.selectors) {\r\n        const enableds = bundle.selectors.reduce(\r\n          (list, filter, index) =>\r\n            filter.enabled === true ? list.concat(index) : list,\r\n          []\r\n        );\r\n        if (enableds.length > 1) {\r\n          enableds.splice(0, 1);\r\n          enableds.forEach((index) => {\r\n            bundle.selectors[index].enabled = false;\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return selectors;\r\n  }\r\n\r\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\r\n    selectors = this.computeIgoSelector(selectors);\r\n    const selectorBundle = selectors.groups.find(\r\n      (g) => g.enabled\r\n    ).computedSelectors;\r\n    const conditions = [];\r\n    selectorBundle.map((bundle) => {\r\n      const bundleCondition = [];\r\n      const selectorsType = bundle.selectors as any;\r\n      if (!selectorsType) {\r\n        return;\r\n      }\r\n      selectorsType\r\n        .filter((ogcselector) => ogcselector.enabled === true)\r\n        .forEach((enabledSelector) =>\r\n          bundleCondition.push(enabledSelector.filters)\r\n        );\r\n      if (bundleCondition.length === 1) {\r\n        conditions.push(bundleCondition[0]);\r\n      } else if (bundleCondition.length > 1) {\r\n        conditions.push({\r\n          logical: bundle.logical,\r\n          filters: bundleCondition\r\n        });\r\n      }\r\n    });\r\n\r\n    if (selectors.selectorType === 'pushButton') {\r\n      ogcFilters.pushButtons = selectors;\r\n    } else if (selectors.selectorType === 'checkbox') {\r\n      ogcFilters.checkboxes = selectors;\r\n    } else if (selectors.selectorType === 'radioButton') {\r\n      ogcFilters.radioButtons = selectors;\r\n    } else if (selectors.selectorType === 'select') {\r\n      ogcFilters.select = selectors;\r\n    } else if (selectors.selectorType === 'autocomplete') {\r\n      ogcFilters.autocomplete = selectors;\r\n    }\r\n    return conditions;\r\n  }\r\n\r\n  public formatProcessedOgcFilter(\r\n    processedFilter: string,\r\n    layersOrTypenames: string\r\n  ): string {\r\n    if (!processedFilter) {\r\n      return undefined;\r\n    }\r\n    let appliedFilter = '';\r\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\r\n      appliedFilter = processedFilter;\r\n    } else {\r\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\r\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\r\n          'filter=',\r\n          ''\r\n        )})`;\r\n      });\r\n    }\r\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\r\n    const filterValue =\r\n      appliedFilter.length > 0\r\n        ? appliedFilter.replace('filter=', '')\r\n        : undefined;\r\n    return filterValue;\r\n  }\r\n\r\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\r\n    if (!value) {\r\n      return defaultValue;\r\n    } else if (value === 'today') {\r\n      return undefined;\r\n    } else if (moment(value).isValid()) {\r\n      return value;\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n}\r\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\n\r\nimport * as OlFormat from 'ol/format';\r\nimport olFormatGML2 from 'ol/format/GML2';\r\nimport olFormatGML3 from 'ol/format/GML3';\r\nimport olFormatGML32 from 'ol/format/GML32';\r\nimport olFormatOSMXML from 'ol/format/OSMXML';\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nexport const defaultEpsg = 'EPSG:3857';\r\nexport const defaultMaxFeatures = 5000;\r\nexport const defaultWfsVersion = '2.0.0';\r\nexport const defaultFieldNameGeometry = 'geometry';\r\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\r\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\r\n\r\n/**\r\n * This method build the WFS URL based on the layer property.\r\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\r\n * @param extent  An extent like array [number, number, number, number]\r\n * @param proj  olProjection\r\n * @param ogcFilters  OgcFiltersOptions\r\n * @returns A string representing the datasource options, based on filter and views\r\n */\r\nexport function buildUrl(\r\n  options: WFSDataSourceOptions,\r\n  extent,\r\n  proj: olProjection,\r\n  ogcFilters: OgcFiltersOptions,\r\n  randomParam?: boolean\r\n): string {\r\n  const paramsWFS = options.paramsWFS;\r\n  const queryStringValues = formatWFSQueryString(\r\n    options,\r\n    undefined,\r\n    options.paramsWFS.srsName\r\n  );\r\n  let igoFilters;\r\n  if (ogcFilters && ogcFilters.enabled) {\r\n    igoFilters = ogcFilters.filters;\r\n  }\r\n  const ogcFilterWriter = new OgcFilterWriter();\r\n  const filterOrBox = ogcFilterWriter.buildFilter(\r\n    igoFilters,\r\n    extent,\r\n    proj,\r\n    ogcFilters.geometryName,\r\n    options\r\n  );\r\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n    options,\r\n    ogcFilters.geometryName,\r\n    extent,\r\n    proj\r\n  );\r\n\r\n  let prefix = 'filter';\r\n  if (!filterOrPush) {\r\n    prefix = 'bbox';\r\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\r\n  }\r\n\r\n  paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters\r\n    ? filterOrBox\r\n    : `${prefix}=${filterOrPush}`;\r\n  let baseUrl = queryStringValues.find((f) => f.name === 'getfeature').value;\r\n  const patternFilter = /(filter|bbox)=.*/gi;\r\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter)\r\n    ? `${baseUrl}&${paramsWFS.xmlFilter}`\r\n    : baseUrl;\r\n  options.download = Object.assign({}, options.download, {\r\n    dynamicUrl: baseUrl\r\n  });\r\n  if (randomParam) {\r\n    baseUrl += `$&_t${new Date().getTime()}`;\r\n  }\r\n  return baseUrl.replace(/&&/g, '&');\r\n}\r\n\r\n/**\r\n * This method build/standardize WFS call query params based on the layer property.\r\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\r\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\r\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\r\n * @param properties  String: Used to control the queried fields  (WFS service).\r\n * @returns An array array of {name: '', value: ''} of predefined query params.\r\n */\r\nexport function formatWFSQueryString(\r\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\r\n  count?: number,\r\n  epsg?: string,\r\n  properties?: string,\r\n  startIndex: number = 0,\r\n  forceDefaultOutputFormat: boolean = false\r\n): { name: string; value: string }[] {\r\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\r\n  const url = dataSourceOptions.urlWfs;\r\n  const paramsWFS = dataSourceOptions.paramsWFS;\r\n  const effectiveCount = count || defaultMaxFeatures;\r\n  const effectiveStartIndex =\r\n    paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\r\n  const epsgCode = epsg || defaultEpsg;\r\n  let outputFormat = paramsWFS.outputFormat\r\n    ? `outputFormat=${paramsWFS.outputFormat}`\r\n    : '';\r\n  let version = paramsWFS.version\r\n    ? `version=${paramsWFS.version}`\r\n    : `version=${defaultWfsVersion}`;\r\n  const paramTypename =\r\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\r\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\r\n  const paramMaxFeatures =\r\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\r\n  let cnt = count\r\n    ? `${paramMaxFeatures}=${effectiveCount}`\r\n    : paramsWFS.maxFeatures\r\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\r\n    : `${paramMaxFeatures}=${effectiveCount}`;\r\n  if (forceDefaultOutputFormat) {\r\n    outputFormat = '';\r\n    version = 'version=1.1.0';\r\n    cnt = cnt.replace('count', 'maxFeatures');\r\n  }\r\n\r\n  const srs = epsg\r\n    ? `srsname=${epsgCode}`\r\n    : paramsWFS.srsName\r\n    ? 'srsname=' + paramsWFS.srsName\r\n    : `srsname=${epsgCode}`;\r\n\r\n  let propertyName = '';\r\n  let valueReference = '';\r\n  if (properties) {\r\n    propertyName = `propertyName=${properties}`;\r\n    valueReference = `valueReference=${properties}`;\r\n  }\r\n  const sourceFields = dataSourceOptions.sourceFields;\r\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\r\n    const fieldsNames = [];\r\n    dataSourceOptions.sourceFields.forEach((sourcefield) => {\r\n      fieldsNames.push(sourcefield.name);\r\n    });\r\n    propertyName = `propertyName=${fieldsNames.join(',')},${\r\n      paramsWFS.fieldNameGeometry\r\n    }`;\r\n  }\r\n\r\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\r\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\r\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\r\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\r\n\r\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\r\n  getpropertyvalue += `&${cnt}&${valueReference}`;\r\n\r\n  return [\r\n    { name: 'outputformat', value: outputFormat },\r\n    { name: 'version', value: version },\r\n    { name: 'typename', value: featureTypes },\r\n    { name: 'count', value: cnt },\r\n    { name: 'srsname', value: srs },\r\n    { name: 'propertyname', value: propertyName },\r\n    { name: 'valuereference', value: valueReference },\r\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\r\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\r\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\r\n  ];\r\n}\r\n\r\n/**\r\n * Validate/Modify layer's wfs options based on :\r\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\r\n * https://github.com/openlayers/openlayers/pull/6400\r\n * 2- Set default values for optionals parameters.\r\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\r\n * @returns An array array of {name: '', value: ''} of predefined query params.\r\n */\r\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\r\n  if (srcType && srcType === 'wfs') {\r\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\r\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\r\n  }\r\n\r\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\r\n  wfsDataSourceOptions.urlWfs =\r\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\r\n\r\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\r\n  paramsWFS.fieldNameGeometry =\r\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\r\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\r\n\r\n  let outputFormat;\r\n  if (paramsWFS.outputFormat) {\r\n    outputFormat = paramsWFS.outputFormat;\r\n  }\r\n\r\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\r\n    paramsWFS.version = '1.1.0';\r\n  }\r\n  return Object.assign({}, wfsDataSourceOptions);\r\n}\r\n\r\nexport function getFormatFromOptions(\r\n  options: WFSDataSourceOptions | WMSDataSourceOptions\r\n) {\r\n  const wfsOptions = options as WFSDataSourceOptions;\r\n\r\n  let olFormatCls;\r\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\r\n    ? wfsOptions.paramsWFS.outputFormat\r\n    : undefined;\r\n\r\n  if (!outputFormat) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  }\r\n\r\n  if (OlFormat[outputFormat]) {\r\n    olFormatCls = OlFormat[outputFormat];\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('gml2')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({\r\n      ...wfsOptions.formatOptions,\r\n      ...{ gmlFormat: olFormatGML2 }\r\n    });\r\n  } else if (outputFormat.toLowerCase().match('gml32')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({\r\n      ...wfsOptions.formatOptions,\r\n      ...{ gmlFormat: olFormatGML32 }\r\n    });\r\n  } else if (outputFormat.toLowerCase().match('gml3')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({\r\n      ...wfsOptions.formatOptions,\r\n      ...{ gmlFormat: olFormatGML3 }\r\n    });\r\n  } else if (outputFormat.toLowerCase().match('topojson')) {\r\n    olFormatCls = OlFormat.TopoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('geojson')) {\r\n    olFormatCls = OlFormat.GeoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\r\n    olFormatCls = OlFormat.EsriJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('json')) {\r\n    olFormatCls = OlFormat.GeoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('gpx')) {\r\n    olFormatCls = OlFormat.GPX;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('WKT')) {\r\n    olFormatCls = OlFormat.WKT;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\r\n    olFormatCls = olFormatOSMXML;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('kml')) {\r\n    olFormatCls = OlFormat.KML;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  }\r\n\r\n  return new olFormatCls();\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\r\nimport olProjection from 'ol/proj/Projection';\r\nimport * as olproj from 'ol/proj';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WFSService } from './wfs.service';\r\n\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\nimport {\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFiltersOptions\r\n} from '../../../filter/shared/ogc-filter.interface';\r\nimport {\r\n  defaultFieldNameGeometry,\r\n  checkWfsParams,\r\n  getFormatFromOptions,\r\n  buildUrl\r\n} from './wms-wfs.utils';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\n\r\nexport class WFSDataSource extends DataSource {\r\n  public declare ol: olSourceVector<OlGeometry>;\r\n  public mostRecentIdCallOGCFilter: number = 0;\r\n\r\n  set ogcFilters(value: OgcFiltersOptions) {\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\r\n  }\r\n  get ogcFilters(): OgcFiltersOptions {\r\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n  }\r\n\r\n  constructor(\r\n    public options: WFSDataSourceOptions,\r\n    protected wfsService: WFSService,\r\n    private authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(checkWfsParams(options, 'wfs'));\r\n\r\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions)\r\n      .ogcFilters;\r\n    const fieldNameGeometry =\r\n      this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\r\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(\r\n        ogcFilters,\r\n        fieldNameGeometry\r\n      );\r\n    if (\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\r\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\r\n    ) {\r\n      this.wfsService.getSourceFieldsFromWFS(this.options);\r\n    }\r\n\r\n    if (ogcFilters?.pushButtons) {\r\n      ogcFilters.pushButtons.selectorType = 'pushButton';\r\n    }\r\n    if (ogcFilters?.checkboxes) {\r\n      ogcFilters.checkboxes.selectorType = 'checkbox';\r\n    }\r\n    if (ogcFilters?.radioButtons) {\r\n      ogcFilters.radioButtons.selectorType = 'radioButton';\r\n    }\r\n    if (ogcFilters?.select) {\r\n      ogcFilters.select.selectorType = 'select';\r\n    }\r\n    if (ogcFilters?.autocomplete) {\r\n      ogcFilters.autocomplete.selectorType = 'autocomplete';\r\n    }\r\n\r\n    this.setOgcFilters(\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters,\r\n      true\r\n    );\r\n  }\r\n\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    const vectorSource = new olSourceVector({\r\n      format: getFormatFromOptions(this.options),\r\n      url: (extent, resolution, proj: olProjection) => {\r\n        const paramsWFS = this.options.paramsWFS;\r\n        const wfsProj = paramsWFS.srsName\r\n          ? new olProjection({ code: paramsWFS.srsName })\r\n          : proj;\r\n        const ogcFilters = (this.options as OgcFilterableDataSourceOptions)\r\n          .ogcFilters;\r\n        const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\r\n        paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\r\n        return buildUrl(this.options, currentExtent, wfsProj, ogcFilters);\r\n      },\r\n      strategy: OlLoadingStrategy.bbox\r\n    });\r\n    return vectorSource;\r\n  }\r\n\r\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\r\n    this.ogcFilters = ogcFilters;\r\n    this.mostRecentIdCallOGCFilter += 1;\r\n    if (triggerEvent) {\r\n      this.ol.notify('ogcFilters', this.ogcFilters);\r\n    }\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","export abstract class DataService {\r\n  abstract getData(): string;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { combineLatest, Observable, of } from 'rxjs';\r\nimport olFeature from 'ol/Feature';\r\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\nimport { DataService } from './data.service';\r\nimport {\r\n  formatWFSQueryString,\r\n  gmlRegex,\r\n  defaultEpsg,\r\n  defaultMaxFeatures,\r\n  getFormatFromOptions\r\n} from './wms-wfs.utils';\r\nimport { concatMap } from 'rxjs/operators';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WFSService extends DataService {\r\n  constructor(private http: HttpClient) {\r\n    super();\r\n  }\r\n\r\n  getData() {\r\n    console.log('This is defining a data service.');\r\n    return 'This is defining a data service.';\r\n  }\r\n\r\n  public getSourceFieldsFromWFS(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\r\n  ) {\r\n    if (\r\n      !dataSourceOptions.sourceFields ||\r\n      dataSourceOptions.sourceFields.length === 0\r\n    ) {\r\n      dataSourceOptions.sourceFields = [];\r\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\r\n        (getfeatureSourceField) => {\r\n          dataSourceOptions.sourceFields = getfeatureSourceField;\r\n        }\r\n      );\r\n    } else {\r\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\r\n        (getfeatureSourceField) => {\r\n          dataSourceOptions.sourceFields.forEach((sourcefield) => {\r\n            if (sourcefield.alias === undefined) {\r\n              sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\r\n            }\r\n            if (\r\n              sourcefield.values === undefined ||\r\n              sourcefield.values.length === 0\r\n            ) {\r\n              sourcefield.values = getfeatureSourceField.find(\r\n                (sf) => sf.name === sourcefield.name\r\n              ).values;\r\n            }\r\n          });\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  private wfsGetFeature(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\r\n    nb: number = defaultMaxFeatures,\r\n    epsgCode: string = defaultEpsg,\r\n    propertyName?: string,\r\n    startIndex: number = 0,\r\n    forceDefaultOutputFormat: boolean = false\r\n  ): Observable<any> {\r\n    const queryStringValues = formatWFSQueryString(\r\n      dataSourceOptions,\r\n      nb,\r\n      epsgCode,\r\n      propertyName,\r\n      startIndex,\r\n      forceDefaultOutputFormat\r\n    );\r\n    const baseUrl = queryStringValues.find(\r\n      (f) => f.name === 'getfeature'\r\n    ).value;\r\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\r\n    if (\r\n      forceDefaultOutputFormat ||\r\n      gmlRegex.test(outputFormat) ||\r\n      !outputFormat\r\n    ) {\r\n      return this.http.get(baseUrl, { responseType: 'text' });\r\n    } else {\r\n      return this.http.get(baseUrl);\r\n    }\r\n  }\r\n\r\n  defineFieldAndValuefromWFS(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\r\n  ): Observable<any> {\r\n    return new Observable((d) => {\r\n      const sourceFields = [];\r\n      let fieldList;\r\n      let fieldListWoGeom;\r\n      let fieldListWoGeomStr;\r\n      let olFormats;\r\n      let effectiveOlFormats;\r\n\r\n      olFormats = getFormatFromOptions(dataSourceOptions);\r\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions =\r\n        JSON.parse(JSON.stringify(dataSourceOptions));\r\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\r\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\r\n\r\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\r\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields\r\n        ?.filter((f) => !f.values)\r\n        .map((f) => f.name);\r\n\r\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\r\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true)\r\n        .pipe(\r\n          concatMap((res) =>\r\n            String(res).toLowerCase().includes('exception')\r\n              ? of(false)\r\n              : of(true)\r\n          ),\r\n          concatMap((allowGml) => {\r\n            // If the service return GML (return no exception)\r\n            return this.wfsGetFeature(dataSourceOptions, 1).pipe(\r\n              concatMap((firstFeature) => {\r\n                const features = olFormats.readFeatures(firstFeature);\r\n                fieldList = features[0].getKeys();\r\n                if (\r\n                  dataSourceOptions.sourceFields ||\r\n                  dataSourceOptions.sourceFields.length === 0\r\n                ) {\r\n                  sourceFieldsToRetrieveValues = fieldList;\r\n                }\r\n                fieldListWoGeom = fieldList.filter(\r\n                  (field) =>\r\n                    sourceFieldsToRetrieveValues.includes(field) &&\r\n                    field !== features[0].getGeometryName() &&\r\n                    !field.match(/boundedby/gi)\r\n                );\r\n                fieldListWoGeomStr = fieldListWoGeom.join(',');\r\n                const processingArray = [];\r\n                let startIndex = 0;\r\n                // If the service do not allow gml return, dice the call in multiple\r\n                // calls by increment of chunkSize with the original outputFormat\r\n                if (\r\n                  !allowGml &&\r\n                  dataSourceOptions.paramsWFS.version === '2.0.0' &&\r\n                  dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures\r\n                ) {\r\n                  const chunkSize = 1000;\r\n                  while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\r\n                    processingArray.push(\r\n                      this.wfsGetFeature(\r\n                        dataSourceOptions,\r\n                        chunkSize,\r\n                        dataSourceOptions.paramsWFS.srsName,\r\n                        fieldListWoGeomStr,\r\n                        startIndex\r\n                      )\r\n                    );\r\n                    startIndex += chunkSize;\r\n                  }\r\n                  effectiveOlFormats = olFormats;\r\n                } else {\r\n                  processingArray.push(\r\n                    this.wfsGetFeature(\r\n                      dataSourceOptions,\r\n                      dataSourceOptions.paramsWFS.maxFeatures ||\r\n                        defaultMaxFeatures,\r\n                      dataSourceOptions.paramsWFS.srsName,\r\n                      fieldListWoGeomStr,\r\n                      0,\r\n                      true\r\n                    )\r\n                  );\r\n                }\r\n                return combineLatest(processingArray);\r\n              })\r\n            );\r\n          })\r\n        )\r\n        .subscribe((results) => {\r\n          let mfeatures: olFeature<OlGeometry>[] = [];\r\n          results.map((result) => {\r\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\r\n            mfeatures = mfeatures.concat(loopFeatures);\r\n          });\r\n          this.built_properties_value(mfeatures).forEach((element) => {\r\n            sourceFields.push(element);\r\n          });\r\n          d.next(sourceFields);\r\n          d.complete();\r\n        });\r\n    });\r\n  }\r\n\r\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\r\n    if (features.length === 0) {\r\n      return [];\r\n    }\r\n    const kv = Object.assign({}, features[0].getProperties());\r\n    delete kv[features[0].getGeometryName()];\r\n    delete kv.boundedBy;\r\n    const sourceFields = [];\r\n    for (const property in kv) {\r\n      if (kv.hasOwnProperty(property)) {\r\n        const fieldType =\r\n          typeof features[0].get(property) === 'object'\r\n            ? undefined\r\n            : typeof features[0].get(property);\r\n        sourceFields.push({\r\n          name: property,\r\n          alias: property,\r\n          type: fieldType,\r\n          values: [kv[property]]\r\n        });\r\n      }\r\n    }\r\n    features.every((element) => {\r\n      const featureProperties = element.getProperties();\r\n      for (const key in featureProperties) {\r\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\r\n          sourceFields\r\n            .filter((f) => f.name === key)\r\n            .forEach((v) => {\r\n              if (v.values.indexOf(featureProperties[key]) === -1) {\r\n                v.values.push(featureProperties[key]);\r\n              }\r\n            });\r\n        }\r\n      }\r\n      return true;\r\n    });\r\n    return sourceFields;\r\n  }\r\n}\r\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import olSourceImageWMS from 'ol/source/ImageWMS';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport {\r\n  TimeFilterableDataSourceOptions,\r\n  WMSDataSourceOptions\r\n} from './wms-datasource.interface';\r\nimport { WFSService } from './wfs.service';\r\n\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\nimport {\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFiltersOptions,\r\n  OgcFilterDuringOptions\r\n} from '../../../filter/shared/ogc-filter.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\nimport {\r\n  formatWFSQueryString,\r\n  checkWfsParams,\r\n  defaultFieldNameGeometry\r\n} from './wms-wfs.utils';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/legend.interface';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { TimeFilterOptions } from '../../../filter';\r\n\r\nexport interface TimeFilterableDataSource extends WMSDataSource {\r\n  options: TimeFilterableDataSourceOptions;\r\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\r\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\r\n  filterByDate(date: Date | [Date, Date]);\r\n  filterByYear(year: string | [string, string]);\r\n}\r\n\r\nexport class WMSDataSource extends DataSource {\r\n  public declare ol: olSourceImageWMS;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  set ogcFilters(value: OgcFiltersOptions) {\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\r\n  }\r\n  get ogcFilters(): OgcFiltersOptions {\r\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n  }\r\n\r\n  set timeFilter(value: TimeFilterOptions) {\r\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\r\n  }\r\n  get timeFilter(): TimeFilterOptions {\r\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\r\n  }\r\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  constructor(\r\n    public options: WMSDataSourceOptions,\r\n    protected wfsService: WFSService\r\n  ) {\r\n    super(options);\r\n    const sourceParams: any = options.params;\r\n\r\n    const dpi = sourceParams.DPI || 96;\r\n    sourceParams.DPI = dpi;\r\n    sourceParams.MAP_RESOLUTION = dpi;\r\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\r\n\r\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\r\n      setInterval(() => {\r\n        this.refresh();\r\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\r\n    }\r\n\r\n    let fieldNameGeometry = defaultFieldNameGeometry;\r\n\r\n    // ####   START if paramsWFS\r\n    if (options.paramsWFS) {\r\n      const wfsCheckup = checkWfsParams(options, 'wms');\r\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\r\n\r\n      fieldNameGeometry =\r\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\r\n\r\n      options.download = Object.assign({}, options.download, {\r\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\r\n      });\r\n    } //  ####   END  if paramsWFS\r\n\r\n    if (!options.sourceFields || options.sourceFields.length === 0) {\r\n      options.sourceFields = [];\r\n    } else {\r\n      options.sourceFields.forEach((sourceField) => {\r\n        sourceField.alias = sourceField.alias\r\n          ? sourceField.alias\r\n          : sourceField.name;\r\n        // to allow only a list of sourcefield with names\r\n      });\r\n    }\r\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\r\n      .ogcFilters;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (!initOgcFilters) {\r\n      (options as OgcFilterableDataSourceOptions).ogcFilters =\r\n        ogcFilterWriter.defineOgcFiltersDefaultOptions(\r\n          initOgcFilters,\r\n          fieldNameGeometry,\r\n          'wms'\r\n        );\r\n    } else {\r\n      initOgcFilters.advancedOgcFilters =\r\n        initOgcFilters.pushButtons ||\r\n        initOgcFilters.checkboxes ||\r\n        initOgcFilters.radioButtons ||\r\n        initOgcFilters.select ||\r\n        initOgcFilters.autocomplete\r\n          ? false\r\n          : true;\r\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\r\n        const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\r\n        if (filterDuring.calendarModeYear) {\r\n          initOgcFilters.advancedOgcFilters = false;\r\n        }\r\n      }\r\n      if (initOgcFilters.pushButtons) {\r\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\r\n      }\r\n      if (initOgcFilters.checkboxes) {\r\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\r\n      }\r\n      if (initOgcFilters.radioButtons) {\r\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\r\n      }\r\n      if (initOgcFilters.select) {\r\n        initOgcFilters.select.selectorType = 'select';\r\n      }\r\n      if (initOgcFilters.autocomplete) {\r\n        initOgcFilters.autocomplete.selectorType = 'autocomplete';\r\n      }\r\n    }\r\n\r\n    if (\r\n      sourceParams.LAYERS.split(',').length > 1 &&\r\n      initOgcFilters &&\r\n      initOgcFilters.enabled\r\n    ) {\r\n      console.log('*******************************');\r\n      console.log(\r\n        'BE CAREFULL, YOUR WMS LAYERS (' +\r\n          sourceParams.LAYERS +\r\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\r\n      );\r\n      console.log('*******************************');\r\n    }\r\n\r\n    if (\r\n      options.paramsWFS &&\r\n      initOgcFilters &&\r\n      initOgcFilters.enabled &&\r\n      initOgcFilters.editable &&\r\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\r\n    ) {\r\n      this.wfsService.getSourceFieldsFromWFS(options);\r\n    }\r\n\r\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n      options,\r\n      fieldNameGeometry\r\n    );\r\n    sourceParams.FILTER = filterQueryString;\r\n    this.ol.updateParams({ FILTER: sourceParams.FILTER });\r\n    this.setOgcFilters(initOgcFilters, true);\r\n\r\n    const timeFilterableDataSourceOptions =\r\n      options as TimeFilterableDataSourceOptions;\r\n    if (\r\n      timeFilterableDataSourceOptions?.timeFilterable &&\r\n      timeFilterableDataSourceOptions?.timeFilter\r\n    ) {\r\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\r\n    }\r\n  }\r\n\r\n  refresh() {\r\n    this.ol.updateParams({ igoRefresh: Math.random() });\r\n  }\r\n\r\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\r\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\r\n    const downloadUrl = queryStringValues.find(\r\n      (f) => f.name === 'getfeature'\r\n    ).value;\r\n    return downloadUrl;\r\n  }\r\n\r\n  protected createOlSource(): olSourceImageWMS {\r\n    return new olSourceImageWMS(Object.assign({ ratio: 1 }, this.options));\r\n  }\r\n\r\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\r\n    this.ogcFilters = ogcFilters;\r\n    if (triggerEvent) {\r\n      this.ol.notify('ogcFilters', this.ogcFilters);\r\n    }\r\n  }\r\n\r\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\r\n    this.timeFilter = timeFilter;\r\n    if (triggerEvent) {\r\n      this.timeFilter$.next(this.timeFilter);\r\n      this.ol.notify('timeFilter', this.ogcFilters);\r\n    }\r\n  }\r\n\r\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\r\n    let legend = super.getLegend();\r\n    if (legend.length > 0 && style === undefined && !view?.scale) {\r\n      return legend;\r\n    }\r\n\r\n    let contentDependent = false;\r\n    let projParam;\r\n\r\n    if (\r\n      view?.size &&\r\n      view?.extent &&\r\n      view?.projection &&\r\n      this.options.contentDependentLegend\r\n    ) {\r\n      projParam =\r\n        this.params.VERSION === '1.3.0' || this.params.VERSION === undefined\r\n          ? 'CRS'\r\n          : 'SRS';\r\n      contentDependent = true;\r\n    }\r\n\r\n    const sourceParams = this.params;\r\n\r\n    let layers = [];\r\n    if (sourceParams.LAYERS !== undefined) {\r\n      layers = sourceParams.LAYERS.split(',');\r\n    }\r\n\r\n    const baseUrl = this.options.url.replace(/\\?$/, '');\r\n    const params = [\r\n      'REQUEST=GetLegendGraphic',\r\n      'SERVICE=WMS',\r\n      'FORMAT=image/png',\r\n      'SLD_VERSION=1.1.0',\r\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\r\n    ];\r\n    if (style !== undefined) {\r\n      params.push(`STYLE=${style}`);\r\n    }\r\n    if (view?.scale !== undefined) {\r\n      params.push(`SCALE=${view.scale}`);\r\n    }\r\n    if (contentDependent) {\r\n      params.push(`WIDTH=${view.size[0]}`);\r\n      params.push(`HEIGHT=${view.size[1]}`);\r\n      params.push(`BBOX=${view.extent.join(',')}`);\r\n      params.push(`${projParam}=${view.projection}`);\r\n    }\r\n\r\n    legend = layers.map((layer: string) => {\r\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\r\n      return {\r\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\r\n        title: layers.length > 1 ? layer : undefined,\r\n        currentStyle: style === undefined ? undefined : (style as string)\r\n      };\r\n    });\r\n\r\n    return legend;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n\r\nexport interface TimeFilterableDataSource extends WMSDataSource {\r\n  options: TimeFilterableDataSourceOptions;\r\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\r\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\r\n  filterByDate(date: Date | [Date, Date]);\r\n  filterByYear(year: string | [string, string]);\r\n}\r\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\nimport * as olproj from 'ol/proj';\nimport {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","import { Options } from 'ol/source/WMTS';\r\nimport olSourceWMTS from 'ol/source/WMTS';\r\n\r\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\r\nimport { DataSource } from './datasource';\r\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\r\n\r\nexport class WMTSDataSource extends DataSource {\r\n  public declare options: WMTSDataSourceOptions;\r\n  public declare ol: olSourceWMTS;\r\n\r\n  constructor(options: WMTSDataSourceOptions) {\r\n    super(options);\r\n  }\r\n\r\n  protected createOlSource(): olSourceWMTS {\r\n    const sourceOptions = Object.assign(\r\n      {\r\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\r\n      },\r\n      this.options\r\n    ) as Options;\r\n\r\n    return new olSourceWMTS(sourceOptions);\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceCarto from 'ol/source/CartoDB';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\n\r\nexport class CartoDataSource extends DataSource {\r\n  public declare ol: olSourceCarto;\r\n  public declare options: CartoDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): olSourceCarto {\r\n    const crossOrigin = this.options.crossOrigin\r\n      ? this.options.crossOrigin\r\n      : 'anonymous';\r\n    const sourceOptions = Object.assign(\r\n      {\r\n        crossOrigin\r\n      },\r\n      this.options\r\n    );\r\n    return new olSourceCarto(sourceOptions);\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legend = super.getLegend();\r\n    if (legend.length > 0) {\r\n      return legend;\r\n    }\r\n\r\n    let htmlString = '<table>';\r\n    if (this.options.config.layers[0].legend !== null) {\r\n      this.options.config.layers[0].legend.items.forEach((f) => {\r\n        if (f.visible === true) {\r\n          htmlString +=\r\n            '<tr><td>' +\r\n            '<p><font size=\"5\" color=\"' +\r\n            f.value +\r\n            '\"> &#9679</font></p></td>' +\r\n            '<td>' +\r\n            f.name +\r\n            '</td></tr>';\r\n        }\r\n      });\r\n      htmlString += '</table>';\r\n      return [{ html: htmlString }];\r\n    } else {\r\n      // Try to build the legend from the cartocss options\r\n      const layerOptions = this.options.config.layers[0].options;\r\n      // All available cartocss style options\r\n      const types = [\r\n        'polygon-fill:',\r\n        'marker-fill:',\r\n        'shield-fill:',\r\n        'building-fill:',\r\n        'line-color:'\r\n      ];\r\n      for (const oneType of types) {\r\n        if (layerOptions.cartocss.includes(oneType)) {\r\n          const type = layerOptions.cartocss.split(oneType).pop();\r\n          const color = type.substr(0, type.indexOf(';'));\r\n          if (color.includes('ramp')) {\r\n            const colors = color.split(', (')[1].split(',');\r\n            const data = color.split(', (')[2].split(',');\r\n            for (let j = 0; j < colors.length; j++) {\r\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\r\n              data[j] = data[j].replace(/(\"|\\))/g, '');\r\n              if (data[j].replace(/\\s+/g, '') === '=') {\r\n                data[j] = 'Autres';\r\n              }\r\n              htmlString +=\r\n                '<tr><td>' +\r\n                '<p><font size=\"5\" color=\"' +\r\n                colors[j] +\r\n                '\"> &#9679</font></p></td>' +\r\n                '<td>' +\r\n                data[j] +\r\n                '</td></tr>';\r\n            }\r\n            break;\r\n          } else {\r\n            const title = layerOptions.layer_name\r\n              ? layerOptions.layer_name\r\n              : '';\r\n            htmlString +=\r\n              '<tr><td>' +\r\n              '<p><font size=\"5\" color=\"' +\r\n              color +\r\n              '\"> &#9679</font></p>' +\r\n              '</td><td>' +\r\n              title +\r\n              '</td></tr>';\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      htmlString += '</table>';\r\n      return [{ html: htmlString }];\r\n    }\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\r\nimport * as olloadingstrategy from 'ol/loadingstrategy';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\r\n\r\nexport class ArcGISRestDataSource extends DataSource {\r\n  public declare ol: olSourceVector<OlGeometry>;\r\n  public declare options: ArcGISRestDataSourceOptions;\r\n\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    const esrijsonFormat = new olFormatEsriJSON();\r\n    return new olSourceVector({\r\n      attributions: this.options.params.attributions,\r\n      overlaps: false,\r\n      format: esrijsonFormat,\r\n      url: function (extent, resolution, proj) {\r\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\r\n        const geometry = encodeURIComponent(\r\n          '{\"xmin\":' +\r\n            extent[0] +\r\n            ',\"ymin\":' +\r\n            extent[1] +\r\n            ',\"xmax\":' +\r\n            extent[2] +\r\n            ',\"ymax\":' +\r\n            extent[3] +\r\n            ',\"spatialReference\":{\"wkid\":102100}}'\r\n        );\r\n        const params = [\r\n          'f=json',\r\n          `geometry=${geometry}`,\r\n          'geometryType=esriGeometryEnvelope',\r\n          'inSR=102100',\r\n          'spatialRel=esriSpatialRelIntersects',\r\n          'outFields=*',\r\n          'returnGeometry=true',\r\n          'outSR=102100'\r\n        ];\r\n        if (this.options.params.time) {\r\n          const time = `time=${this.options.params.time}`;\r\n          params.push(time);\r\n        }\r\n        if (this.options.params.customParams) {\r\n          this.options.params.customParams.forEach((element) => {\r\n            params.push(element);\r\n          });\r\n        }\r\n        return `${baseUrl}?${params.join('&')}`;\r\n      }.bind(this),\r\n      strategy: olloadingstrategy.bbox\r\n    });\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (legendInfo === undefined || legend.length > 0) {\r\n      return legend;\r\n    }\r\n    if (!legendInfo) {\r\n      return;\r\n    }\r\n    let htmlString = '<table>';\r\n    let src: string;\r\n    let label: string;\r\n    let svg: string;\r\n\r\n    if (legendInfo.legend) {\r\n      for (const legendElement of legendInfo.legend) {\r\n        src = this.htmlImgSrc(\r\n          legendElement.contentType,\r\n          legendElement.imageData\r\n        );\r\n        label = legendElement.label\r\n          ? legendElement.label.replace('<Null>', 'Null')\r\n          : '';\r\n        htmlString +=\r\n          `<tr><td align='left'><img src=\"` +\r\n          src +\r\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n          label +\r\n          '</td></tr>';\r\n      }\r\n    } else if (legendInfo.type === 'uniqueValue') {\r\n      for (const legendElement of legendInfo.uniqueValueInfos) {\r\n        label = legendElement.label.replace('<Null>', 'Null');\r\n        if (legendElement.symbol.type === 'esriPMS') {\r\n          src = this.htmlImgSrc(\r\n            legendElement.symbol.contentType,\r\n            legendElement.symbol.imageData\r\n          );\r\n          htmlString +=\r\n            `<tr><td align='left'><img src=\"` +\r\n            src +\r\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n            label +\r\n            '</td></tr>';\r\n        } else if (legendElement.symbol.type !== 'esriPMS') {\r\n          svg = this.createSVG(legendElement.symbol);\r\n          htmlString +=\r\n            `<tr><td align='left'>` +\r\n            svg +\r\n            `</td><td class=\"mat-typography\">` +\r\n            label +\r\n            '</td></tr>';\r\n        }\r\n      }\r\n    } else if (legendInfo.type === 'simple') {\r\n      label = legendInfo.label\r\n        ? legendInfo.label.replace('<Null>', 'Null')\r\n        : '';\r\n      if (legendInfo.symbol.type === 'esriPMS') {\r\n        src = this.htmlImgSrc(\r\n          legendInfo.symbol.contentType,\r\n          legendInfo.symbol.imageData\r\n        );\r\n        htmlString +=\r\n          `<tr><td align='left'><img src=\"` +\r\n          src +\r\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n          label +\r\n          '</td></tr>';\r\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\r\n        svg = this.createSVG(legendInfo.symbol);\r\n        htmlString +=\r\n          `<tr><td align='left'>` +\r\n          svg +\r\n          `</td><td class=\"mat-typography\">` +\r\n          label +\r\n          '</td></tr>';\r\n      }\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  htmlImgSrc(contentType: string, imageData: string): string {\r\n    return `data:${contentType};base64,${imageData}`;\r\n  }\r\n\r\n  createSVG(symbol): string {\r\n    let svg: string = '';\r\n\r\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\r\n\r\n    if (symbol.type === 'esriSLS') {\r\n      const width: number = symbol.width ? symbol.width : 0;\r\n\r\n      const stroke: string =\r\n        `stroke:rgba(` +\r\n        color[0] +\r\n        ',' +\r\n        color[1] +\r\n        ',' +\r\n        color[2] +\r\n        ',' +\r\n        color[3] +\r\n        ')';\r\n      const strokeWidth: string = `stroke-width:` + width;\r\n\r\n      if (symbol.style === 'esriSLSSolid') {\r\n        svg =\r\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\r\n          stroke +\r\n          ';' +\r\n          strokeWidth +\r\n          `\"/></svg>`;\r\n      } else if (symbol.style === 'esriSLSDash') {\r\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\r\n        svg =\r\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\r\n          stroke +\r\n          ';' +\r\n          strokeWidth +\r\n          `\" ` +\r\n          strokeDashArray +\r\n          `/></svg>`;\r\n      }\r\n    } else if (\r\n      symbol.style === 'esriSMSCircle' ||\r\n      symbol.style === 'esriSFSSolid'\r\n    ) {\r\n      const outlineColor = symbol.outline.color;\r\n      const outlineWidth = symbol.outline.width;\r\n      const size = symbol.size;\r\n\r\n      const stroke =\r\n        `stroke:rgba(` +\r\n        outlineColor[0] +\r\n        ',' +\r\n        outlineColor[1] +\r\n        ',' +\r\n        outlineColor[2] +\r\n        ',' +\r\n        outlineColor[3] +\r\n        ')';\r\n      const strokeWidth = `stroke-width:` + outlineWidth;\r\n      const fill =\r\n        `fill:rgba(` +\r\n        color[0] +\r\n        ',' +\r\n        color[1] +\r\n        ',' +\r\n        color[2] +\r\n        ',' +\r\n        color[3] +\r\n        ')';\r\n\r\n      if (symbol.style === 'esriSMSCircle') {\r\n        svg =\r\n          `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` +\r\n          size / 2 +\r\n          `\" style=\"` +\r\n          stroke +\r\n          ';' +\r\n          strokeWidth +\r\n          ';' +\r\n          fill +\r\n          `\"/></svg>`;\r\n      } else {\r\n        svg =\r\n          `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` +\r\n          stroke +\r\n          ';' +\r\n          strokeWidth +\r\n          ';' +\r\n          fill +\r\n          `\"/></svg>`;\r\n      }\r\n    }\r\n    return svg;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\nexport class ImageArcGISRestDataSource extends DataSource {\r\n  public declare ol: ImageArcGISRest;\r\n  public declare options: ArcGISRestImageDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): ImageArcGISRest {\r\n    const params =\r\n      this.options.layer === undefined\r\n        ? this.options.params\r\n        : Object.assign(\r\n            { LAYERS: `show:${this.options.layer}` },\r\n            this.options.params\r\n          );\r\n\r\n    if (typeof params.renderingRule === 'object') {\r\n      params.renderingRule = JSON.stringify(params.renderingRule);\r\n    }\r\n\r\n    return new ImageArcGISRest({\r\n      ratio: 1,\r\n      params,\r\n      url: this.options.url\r\n    });\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (\r\n      legendInfo === undefined ||\r\n      this.options.layer === undefined ||\r\n      legend.length > 0\r\n    ) {\r\n      return legend;\r\n    }\r\n\r\n    if (!legendInfo) {\r\n      return;\r\n    }\r\n    let htmlString = '<table>';\r\n\r\n    for (const legendElement of legendInfo.legend) {\r\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\r\n      const label = legendElement.label.replace('<Null>', 'Null');\r\n      htmlString +=\r\n        `<tr><td align='left'><img src=\"` +\r\n        src +\r\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n        label +\r\n        '</td></tr>';\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\r\nimport { Options } from 'ol/source/TileArcGISRest';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\n\r\nexport class TileArcGISRestDataSource extends DataSource {\r\n  public declare ol: olSourceTileArcGISRest;\r\n  public declare options: TileArcGISRestDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): olSourceTileArcGISRest {\r\n    return new olSourceTileArcGISRest(this.options as Options);\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (\r\n      legendInfo === undefined ||\r\n      this.options.layer === undefined ||\r\n      legend.length > 0\r\n    ) {\r\n      return legend;\r\n    }\r\n\r\n    if (!legendInfo) {\r\n      return;\r\n    }\r\n    let htmlString = '<table>';\r\n\r\n    for (const legendElement of legendInfo.legend) {\r\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\r\n      const label = legendElement.label.replace('<Null>', 'Null');\r\n      htmlString +=\r\n        `<tr><td align='left'><img src=\"` +\r\n        src +\r\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n        label +\r\n        '</td></tr>';\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public declare options: TileDebugDataSourceOptions;\n  public declare ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { FeatureDataSource } from './feature-datasource';\r\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\r\n\r\nexport class WebSocketDataSource extends FeatureDataSource {\r\n  public ws: WebSocket;\r\n  public declare options: WebSocketDataSourceOptions;\r\n\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    this.createWebSocket();\r\n    this.options.format = this.getSourceFormatFromOptions(this.options);\r\n    return super.createOlSource();\r\n  }\r\n\r\n  private createWebSocket() {\r\n    this.ws = new WebSocket(this.options.url);\r\n    this.ws.onmessage = this.onMessage.bind(this);\r\n\r\n    if (this.options.onclose) {\r\n      this.ws.onclose = this.onClose.bind(this);\r\n    }\r\n\r\n    if (this.options.onerror) {\r\n      this.ws.onerror = this.onError.bind(this);\r\n    }\r\n\r\n    if (this.options.onopen) {\r\n      this.ws.onopen = this.onOpen.bind(this);\r\n    }\r\n  }\r\n\r\n  onMessage(event) {\r\n    const featureAdded = this.options.format.readFeature(\r\n      event.data\r\n    ) as olFeature<OlGeometry>;\r\n\r\n    switch (this.options.onmessage) {\r\n      case 'update':\r\n        // ol don't add if same ID\r\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\r\n        if (featureToRemove) {\r\n          this.ol.removeFeature(featureToRemove);\r\n        }\r\n        this.ol.addFeature(featureAdded);\r\n        break;\r\n      case 'delete':\r\n        this.ol.clear(true);\r\n        this.ol.addFeature(featureAdded);\r\n        break;\r\n      case 'add':\r\n      default:\r\n        this.ol.addFeature(featureAdded);\r\n    }\r\n  }\r\n\r\n  onClose(event) {\r\n    // thrown message to user\r\n  }\r\n\r\n  onError(event) {\r\n    // thrown message to user\r\n  }\r\n\r\n  onOpen(event) {\r\n    // thrown message to user ?\r\n  }\r\n\r\n  public onUnwatch() {\r\n    this.ws.close();\r\n  }\r\n}\r\n","import { Md5 } from 'ts-md5';\r\nimport feature from 'ol/Feature';\r\nimport olSourceVectorTile from 'ol/source/VectorTile';\r\nimport olFormatMVT from 'ol/format/MVT';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\r\n\r\nexport class MVTDataSource extends DataSource {\r\n  public declare options: MVTDataSourceOptions;\r\n  public declare ol: olSourceVectorTile;\r\n\r\n  protected createOlSource(): olSourceVectorTile {\r\n    let mvtFormat;\r\n    if (this.options.featureClass === 'feature') {\r\n      mvtFormat = new olFormatMVT({ featureClass: feature });\r\n    } else {\r\n      mvtFormat = new olFormatMVT();\r\n    }\r\n    this.options.format = mvtFormat;\r\n    return new olSourceVectorTile(this.options);\r\n  }\r\n\r\n  protected generateId() {\r\n    if (!this.options.url) {\r\n      return uuid();\r\n    }\r\n    const chain = 'mvt' + this.options.url;\r\n    return Md5.hashStr(chain) as string;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceCluster from 'ol/source/Cluster';\n\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public declare options: ClusterDataSourceOptions;\n  public declare ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import * as olproj from 'ol/proj';\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { MAC } from 'ol/has';\r\n\r\nimport { NumberUtils } from '@igo2/utils';\r\n\r\nimport { MapViewState } from './map.interface';\r\nimport { Projection } from './projection.interfaces';\r\n\r\n/**\r\n * This method extracts a coordinate tuple from a string.\r\n * @param str Any string\r\n * @param mapProjection string Map Projection\r\n * @param opts.forceNA boolean Force North America Zone\r\n * @returns object:\r\n *             lonLat: Coordinate,\r\n *             message: Message of error,\r\n *             radius: radius of the confience of coordinate,\r\n *             conf: confidence of the coordinate}\r\n */\r\nexport function stringToLonLat(\r\n  str: string,\r\n  mapProjection: string,\r\n  opts: { forceNA?: boolean } = {}\r\n): {\r\n  lonLat: [number, number] | undefined;\r\n  message: string;\r\n  radius: number | undefined;\r\n  conf: number | undefined;\r\n} {\r\n  let lonLat: [number, number];\r\n  let coordStr: string;\r\n  let negativeLon: string;\r\n  let degreesLon: string;\r\n  let minutesLon: string;\r\n  let secondsLon: string;\r\n  let directionLon: string;\r\n  let decimalLon: string;\r\n  let negativeLat: string;\r\n  let degreesLat: string;\r\n  let minutesLat: string;\r\n  let secondsLat: string;\r\n  let directionLat: string;\r\n  let decimalLat: string;\r\n  let zone: string;\r\n  let radius: string;\r\n  let conf: string;\r\n  let lon: any;\r\n  let lat: any;\r\n\r\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\r\n  const toProjection = '4326';\r\n  let projectionStr: string;\r\n  const projectionRegex = new RegExp(projectionPattern, 'g');\r\n\r\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\r\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\r\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\r\n\r\n  const dmsCoord =\r\n    '([0-9]{1,2})[:|]?\\\\s*([0-9]{1,2})?[:|\\'||]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"||]?\\\\s*';\r\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\r\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\r\n\r\n  const patternUtm =\r\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\r\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\r\n\r\n  const patternMtm =\r\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\r\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\r\n\r\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\r\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\r\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\r\n\r\n  const dmdCoord =\r\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\r\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\r\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\r\n\r\n  /* eslint-disable max-len */\r\n  const patternBELL =\r\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\r\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\r\n\r\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\r\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\r\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\r\n\r\n  let isXYCoords = false;\r\n\r\n  str = str.toLocaleUpperCase().trim();\r\n\r\n  // Extract projection\r\n  if (projectionRegex.test(str)) {\r\n    [coordStr, projectionStr] = str.split(';').map((s) => s.trim());\r\n  } else {\r\n    coordStr = str;\r\n  }\r\n  if (lonLatRegex.test(coordStr)) {\r\n    [, negativeLon, lon, , decimalLon, negativeLat, lat, , decimalLat] =\r\n      coordStr.match(lonLatPattern);\r\n\r\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\r\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\r\n  } else if (dmsRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      directionLon,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      directionLat\r\n    ] = coordStr.match(dmsCoordPattern);\r\n\r\n    if (directionLon === 'S' || directionLon === 'N') {\r\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\r\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\r\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\r\n      directionLon = [directionLat, (directionLat = directionLon)][0];\r\n    }\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat(degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat(degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (utmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\r\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\r\n    [lon, lat] = olproj.transform(\r\n      [parseFloat(lon), parseFloat(lat)],\r\n      epsgUtm,\r\n      'EPSG:4326'\r\n    );\r\n  } else if (mtmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\r\n    const epsgMtm =\r\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\r\n    [lon, lat] = olproj.transform(\r\n      [parseFloat(lon), parseFloat(lat)],\r\n      epsgMtm,\r\n      'EPSG:4326'\r\n    );\r\n  } else if (dmdRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      decimalLon,\r\n      negativeLat,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      decimalLat\r\n    ] = coordStr.match(patternDmd);\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (ddRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      degreesLon,\r\n      decimalLon,\r\n      negativeLat,\r\n      degreesLat,\r\n      decimalLat\r\n    ] = coordStr.match(patternDd);\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (bellRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLat,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      ,\r\n      directionLat,\r\n      negativeLon,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      ,\r\n      directionLon,\r\n      radius,\r\n      conf\r\n    ] = coordStr.match(patternBELL);\r\n\r\n    // Set default value for North America\r\n    if (!directionLon) {\r\n      directionLon = 'W';\r\n    }\r\n\r\n    // Check if real minutes or decimals\r\n    if (minutesLon && minutesLon.length > 2) {\r\n      lon = parseFloat(\r\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\r\n      );\r\n    } else {\r\n      lon = convertDMSToDD(\r\n        parseFloat(degreesLon),\r\n        parseFloat(minutesLon),\r\n        parseFloat(secondsLon),\r\n        directionLon\r\n      );\r\n    }\r\n\r\n    if (minutesLat && minutesLat.length > 2) {\r\n      lat = parseFloat(\r\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\r\n      );\r\n    } else {\r\n      lat = convertDMSToDD(\r\n        parseFloat(degreesLat),\r\n        parseFloat(minutesLat),\r\n        parseFloat(secondsLat),\r\n        directionLat\r\n      );\r\n    }\r\n  } else if (mmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\r\n\r\n    if (decimalLon) {\r\n      lon = parseFloat(lon + '.' + decimalLon);\r\n    }\r\n\r\n    if (decimalLat) {\r\n      lat = parseFloat(lat + '.' + decimalLat);\r\n    }\r\n  } else {\r\n    return {\r\n      lonLat: undefined,\r\n      message: '',\r\n      radius: undefined,\r\n      conf: undefined\r\n    };\r\n  }\r\n\r\n  if (opts.forceNA && !isXYCoords) {\r\n    // Set a negative coordinate for North America zone\r\n    if (lon > 0 && lat > 0) {\r\n      if (lon > lat) {\r\n        lon = -lon;\r\n      } else {\r\n        lat = -lat;\r\n      }\r\n    }\r\n\r\n    // Reverse coordinate to respect lonLat convention\r\n    if (lon > lat) {\r\n      lon = [lat, (lat = lon)][0];\r\n    }\r\n  }\r\n\r\n  lonLat = [Number(lon), Number(lat)] as [number, number];\r\n\r\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\r\n  if (\r\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\r\n    lonLat[0] > 180 ||\r\n    lonLat[0] < -180 ||\r\n    lonLat[1] > 90 ||\r\n    lonLat[1] < -90\r\n  ) {\r\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\r\n    const dest = 'EPSG:' + toProjection;\r\n\r\n    try {\r\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\r\n    } catch (e) {\r\n      return {\r\n        lonLat: undefined,\r\n        message: 'Projection ' + source + ' not supported',\r\n        radius: undefined,\r\n        conf: undefined\r\n      };\r\n    }\r\n  }\r\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\r\n    return {\r\n      lonLat,\r\n      message: '',\r\n      radius: radius ? parseInt(radius, 10) : undefined,\r\n      conf: conf ? parseInt(conf, 10) : undefined\r\n    };\r\n  } else {\r\n    return {\r\n      lonLat: undefined,\r\n      message: 'Coordinate out of Longitude/Latitude bounds',\r\n      radius: undefined,\r\n      conf: undefined\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Convert degrees minutes seconds to dd\r\n * @param degrees Degrees\r\n * @param minutes Minutes\r\n * @param seconds Seconds\r\n * @param direction Direction\r\n */\r\nfunction convertDMSToDD(\r\n  degrees: number,\r\n  minutes: number,\r\n  seconds: number,\r\n  direction: string\r\n) {\r\n  minutes = minutes || 0;\r\n  seconds = seconds || 0;\r\n\r\n  const neg = degrees < 0;\r\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\r\n\r\n  if (neg || direction === 'S' || direction === 'W') {\r\n    dd = -dd;\r\n  } // Don't do anything for N or E\r\n  return dd;\r\n}\r\n\r\n/**\r\n * Convert dd to degrees minutes seconds\r\n * @param lonLatDD longitude and latitude in dd\r\n * @param decimal number of decimals for seconds\r\n * @returns longitude and latitude in dms\r\n */\r\nexport function convertDDToDMS(\r\n  lonLatDD: [number, number],\r\n  decimal: number = 3\r\n): string[] {\r\n  const lonLatDMS = [];\r\n\r\n  lonLatDD.forEach((dd) => {\r\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\r\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\r\n    const minutes = Math.floor(int);\r\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\r\n\r\n    lonLatDMS.push(`${degrees} ${minutes}' ${seconds}\"`);\r\n  });\r\n  return lonLatDMS;\r\n}\r\n\r\n/**\r\n * Return true of two view states are equal.\r\n * @param state1 View state\r\n * @param state2 View state\r\n * @returns True if the view states are equal\r\n */\r\nexport function viewStatesAreEqual(\r\n  state1: MapViewState,\r\n  state2: MapViewState\r\n): boolean {\r\n  if (state1 === undefined || state2 === undefined) {\r\n    return false;\r\n  }\r\n\r\n  const tolerance = 1 / 10000;\r\n  return (\r\n    state1.zoom === state2.zoom &&\r\n    Math.trunc(state1.center[0] / tolerance) ===\r\n      Math.trunc(state2.center[0] / tolerance) &&\r\n    Math.trunc(state1.center[1] / tolerance) ===\r\n      Math.trunc(state2.center[1] / tolerance)\r\n  );\r\n}\r\n\r\n/**\r\n * Format the scale to a human readable text\r\n * @param Scale of the map\r\n * @returns Human readable scale text\r\n */\r\nexport function formatScale(scale) {\r\n  scale = Math.round(scale);\r\n  if (scale < 10000) {\r\n    return scale + '';\r\n  }\r\n\r\n  scale = Math.round(scale / 1000);\r\n  if (scale < 1000) {\r\n    return scale + 'K';\r\n  }\r\n\r\n  scale = Math.round(scale / 1000);\r\n  return scale + 'M';\r\n}\r\n\r\n/**\r\n * Return the resolution from a scale denom\r\n * @param scale Scale denom\r\n * @param dpi DPI\r\n * @returns Resolution\r\n */\r\nexport function getResolutionFromScale(\r\n  scale: number,\r\n  dpi: number = 96\r\n): number {\r\n  const inchesPerMeter = 39.3701;\r\n  return scale / (inchesPerMeter * dpi);\r\n}\r\n\r\n/**\r\n * Return the resolution from a scale denom\r\n * @param Scale denom\r\n * @returns Resolution\r\n */\r\nexport function getScaleFromResolution(\r\n  resolution: number,\r\n  unit: string = 'm',\r\n  dpi: number = 96\r\n): number {\r\n  const inchesPerMeter = 39.3701;\r\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\r\n}\r\n\r\n/**\r\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\r\n * @param event OL MapBrowserPointerEvent\r\n * @returns Whether the CTRL key is pushed\r\n */\r\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\r\n  const originalEvent = event.originalEvent;\r\n  return (\r\n    !originalEvent.altKey &&\r\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\r\n    !originalEvent.shiftKey\r\n  );\r\n}\r\n\r\nexport function roundCoordTo(\r\n  coord: [number, number],\r\n  decimal: number = 3\r\n): [number, number] {\r\n  return [\r\n    NumberUtils.roundToNDecimal(coord[0], decimal),\r\n    NumberUtils.roundToNDecimal(coord[1], decimal)\r\n  ] as [number, number];\r\n}\r\n\r\nexport function roundCoordToString(\r\n  coord: [number, number],\r\n  decimal: number = 3\r\n): [string, string] {\r\n  return roundCoordTo(coord, decimal).map((r) => r.toString()) as [\r\n    string,\r\n    string\r\n  ];\r\n}\r\n\r\n/**\r\n * Returns an array of converted coordinates.\r\n * Conversion is done for every configured projections\r\n * and for the current UTM zone and MTM zone.\r\n * @param lonLat [number, number] array of the coordinate to transform.\r\n * @param projections  Projection[] Array of destination projection.\r\n * @param reverseCoords To reverse coords from latLon to lonLat (search option)\r\n * @returns Returns an array of converted coordinates.\r\n */\r\nexport function lonLatConversion(\r\n  lonLat: [number, number],\r\n  projections: Projection[]\r\n): {\r\n  code: string;\r\n  alias: string;\r\n  coord: [number, number];\r\n  igo2CoordFormat: string;\r\n}[] {\r\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [\r\n    number,\r\n    number\r\n  ];\r\n  const convertedLonLat = [\r\n    {\r\n      code: 'EPSG:3857',\r\n      alias: 'Web Mercator',\r\n      coord: rawCoord3857,\r\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\r\n    }\r\n  ];\r\n\r\n  // detect the current utm zone.\r\n  const utmZone = utmZoneFromLonLat(lonLat);\r\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n  const utmName = `UTM-${utmZone}`;\r\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [\r\n    number,\r\n    number\r\n  ];\r\n  convertedLonLat.push({\r\n    code: epsgUtm,\r\n    alias: 'UTM',\r\n    coord: rawCoordUtm,\r\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\r\n  });\r\n\r\n  // detect the current mtm zone.\r\n  const mtmZone = mtmZoneFromLonLat(lonLat);\r\n  if (mtmZone) {\r\n    const epsgMtm =\r\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n    const mtmName = `MTM-${mtmZone}`;\r\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [\r\n      number,\r\n      number\r\n    ];\r\n    convertedLonLat.push({\r\n      code: epsgMtm,\r\n      alias: 'MTM',\r\n      coord: rawCoordMtm,\r\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\r\n    });\r\n  }\r\n\r\n  projections.forEach((projection) => {\r\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [\r\n      number,\r\n      number\r\n    ];\r\n    const numericEpsgCode = projection.code.split(':')[1];\r\n    convertedLonLat.push({\r\n      code: projection.code,\r\n      alias: projection.alias || projection.code,\r\n      coord: rawCoord,\r\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\r\n        ', '\r\n      )} ; ${numericEpsgCode}`\r\n    });\r\n  });\r\n\r\n  return convertedLonLat;\r\n}\r\n\r\n/**\r\n * Detect the current utm zone of the lon/lat coordinate.\r\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\r\n * @returns number The UTM zone.\r\n */\r\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\r\n  return Math.ceil((lonLat[0] + 180) / 6);\r\n}\r\n\r\n/**\r\n * Detect the current mtm zone of the lon/lat coordinate.\r\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\r\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\r\n */\r\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\r\n  const long = lonLat[0];\r\n  let mtmZone;\r\n  if (long < -51 && long > -54) {\r\n    mtmZone = 1;\r\n  }\r\n  if (long < -54 && long > -57) {\r\n    mtmZone = 2;\r\n  }\r\n  if (long < -57 && long > -60) {\r\n    mtmZone = 3;\r\n  }\r\n  if (long < -60 && long > -63) {\r\n    mtmZone = 4;\r\n  }\r\n  if (long < -63 && long > -66) {\r\n    mtmZone = 5;\r\n  }\r\n  if (long < -66 && long > -69) {\r\n    mtmZone = 6;\r\n  }\r\n  if (long < -69 && long > -72) {\r\n    mtmZone = 7;\r\n  }\r\n  if (long < -72 && long > -75) {\r\n    mtmZone = 8;\r\n  }\r\n  if (long < -75 && long > -78) {\r\n    mtmZone = 9;\r\n  }\r\n  if (long < -78 && long > -81) {\r\n    mtmZone = 10;\r\n  }\r\n  return mtmZone;\r\n}\r\n","import * as olstyle from 'ol/style';\r\nimport * as olproj from 'ol/proj';\r\n\r\nexport class EsriStyleGenerator {\r\n  public _converters: any;\r\n  public _renderers: any;\r\n\r\n  constructor() {\r\n    this._converters = {};\r\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\r\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\r\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\r\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\r\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\r\n    this._renderers = {};\r\n    this._renderers.uniqueValue = this._renderUniqueValue;\r\n    this._renderers.simple = this._renderSimple;\r\n    this._renderers.classBreaks = this._renderClassBreaks;\r\n  }\r\n  static _convertPointToPixel(point) {\r\n    return point / 0.75;\r\n  }\r\n  static _transformColor(color): [number, number, number, number] {\r\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\r\n    return [color[0], color[1], color[2], color[3] / 255];\r\n  }\r\n\r\n  static _getResolutionForScale(scale, units) {\r\n    const dpi = 96;\r\n    const mpu = olproj.METERS_PER_UNIT[units];\r\n    const inchesPerMeter = 39.3701;\r\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\r\n  }\r\n\r\n  /* convert an Esri Text Symbol */\r\n  static _convertEsriTS(symbol) {\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n    const text = symbol.text !== undefined ? symbol.text : undefined;\r\n    return new olstyle.Style({\r\n      text: new olstyle.Text({\r\n        fill: new olstyle.Fill({\r\n          color: EsriStyleGenerator._transformColor(symbol.color)\r\n        }),\r\n        font:\r\n          symbol.font.style +\r\n          ' ' +\r\n          symbol.font.weight +\r\n          ' ' +\r\n          symbol.font.size +\r\n          ' px ' +\r\n          symbol.font.family,\r\n        textBaseline: symbol.verticalAlignment,\r\n        textAlign: symbol.horizontalAlignment,\r\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\r\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\r\n        rotation,\r\n        text\r\n      })\r\n    });\r\n  }\r\n  /* convert an Esri Picture Marker Symbol */\r\n  static _convertEsriPMS(symbol) {\r\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n\r\n    return new olstyle.Style({\r\n      image: new olstyle.Icon({\r\n        src,\r\n        rotation\r\n      })\r\n    });\r\n  }\r\n  /* convert an Esri Simple Fill Symbol */\r\n  static _convertEsriSFS(symbol) {\r\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\r\n    const fill = new olstyle.Fill({\r\n      color: EsriStyleGenerator._transformColor(symbol.color)\r\n    });\r\n    const stroke = symbol.outline\r\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\r\n      : undefined;\r\n    return new olstyle.Style({\r\n      fill,\r\n      stroke\r\n    });\r\n  }\r\n  static _convertOutline(outline) {\r\n    let lineDash;\r\n    const color = EsriStyleGenerator._transformColor(outline.color);\r\n    if (outline.style === 'esriSLSDash') {\r\n      lineDash = [5];\r\n    } else if (outline.style === 'esriSLSDashDot') {\r\n      lineDash = [5, 5, 1, 2];\r\n    } else if (outline.style === 'esriSLSDashDotDot') {\r\n      lineDash = [5, 5, 1, 2, 1, 2];\r\n    } else if (outline.style === 'esriSLSDot') {\r\n      lineDash = [1, 2];\r\n    } else if (outline.style === 'esriSLSNull') {\r\n      // line not visible, make color fully transparent\r\n      color[3] = 0;\r\n    }\r\n    return new olstyle.Stroke({\r\n      color,\r\n      lineDash,\r\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\r\n    });\r\n  }\r\n  /* convert an Esri Simple Line Symbol */\r\n  static _convertEsriSLS(symbol) {\r\n    return new olstyle.Style({\r\n      stroke: EsriStyleGenerator._convertOutline(symbol)\r\n    });\r\n  }\r\n  static _transformAngle(angle) {\r\n    if (angle === 0 || angle === undefined) {\r\n      return undefined;\r\n    }\r\n    const normalRad = (angle * Math.PI) / 180;\r\n    const ol3Rad = -normalRad + Math.PI / 2;\r\n    if (ol3Rad < 0) {\r\n      return 2 * Math.PI + ol3Rad;\r\n    } else {\r\n      return ol3Rad;\r\n    }\r\n  }\r\n  /* convert an Esri Simple Marker Symbol */\r\n  static _convertEsriSMS(symbol) {\r\n    const fill = new olstyle.Fill({\r\n      color: EsriStyleGenerator._transformColor(symbol.color)\r\n    });\r\n    const stroke = symbol.outline\r\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\r\n      : undefined;\r\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n    if (symbol.style === 'esriSMSCircle') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.Circle({\r\n          radius,\r\n          fill,\r\n          stroke\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSCross') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          radius2: 0,\r\n          angle: 0,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSDiamond') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSSquare') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          angle: Math.PI / 4,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSX') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          radius2: 0,\r\n          angle: Math.PI / 4,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSTriangle') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 3,\r\n          radius,\r\n          angle: 0,\r\n          rotation\r\n        })\r\n      });\r\n    }\r\n  }\r\n\r\n  _convertLabelingInfo(labelingInfo, mapUnits) {\r\n    const styles = [];\r\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\r\n      const labelExpression = labelingInfo[i].labelExpression;\r\n      // only limited support for label expressions\r\n      const field = labelExpression.substr(\r\n        labelExpression.indexOf('[') + 1,\r\n        labelExpression.indexOf(']') - 1\r\n      );\r\n      const symbol = labelingInfo[i].symbol;\r\n      const maxScale = labelingInfo[i].maxScale;\r\n      const minScale = labelingInfo[i].minScale;\r\n      let minResolution = null;\r\n      if (maxScale !== 0) {\r\n        minResolution = EsriStyleGenerator._getResolutionForScale(\r\n          maxScale,\r\n          mapUnits\r\n        );\r\n      }\r\n      let maxResolution = null;\r\n      if (minScale !== 0) {\r\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\r\n          minScale,\r\n          mapUnits\r\n        );\r\n      }\r\n      const style = this._converters[symbol.type].call(this, symbol);\r\n      styles.push(\r\n        (() => {\r\n          return function (feature, resolution) {\r\n            let visible = true;\r\n            if (this.minResolution !== null && this.maxResolution !== null) {\r\n              visible =\r\n                resolution < this.maxResolution &&\r\n                resolution >= this.minResolution;\r\n            } else if (this.minResolution !== null) {\r\n              visible = resolution >= this.minResolution;\r\n            } else if (this.maxResolution !== null) {\r\n              visible = resolution < this.maxResolution;\r\n            }\r\n            if (visible) {\r\n              const value = feature.get(this.field);\r\n              this.style.getText().setText(value);\r\n              return [this.style];\r\n            }\r\n          };\r\n        })().bind({\r\n          minResolution,\r\n          maxResolution,\r\n          field,\r\n          style\r\n        })\r\n      );\r\n    }\r\n    return styles;\r\n  }\r\n\r\n  _renderSimple(renderer) {\r\n    const style = this._converters[renderer.symbol.type].call(\r\n      this,\r\n      renderer.symbol\r\n    );\r\n    return (() => {\r\n      return () => {\r\n        return [style];\r\n      };\r\n    })();\r\n  }\r\n  _renderClassBreaks(renderer) {\r\n    const defaultSymbol = renderer.defaultSymbol;\r\n    const defaultStyle = this._converters[defaultSymbol.type].call(\r\n      this,\r\n      defaultSymbol\r\n    );\r\n    const field = renderer.field;\r\n    const classes = [];\r\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\r\n      const classBreakInfo = renderer.classBreakInfos[i];\r\n      let min;\r\n      if (\r\n        classBreakInfo.classMinValue === null ||\r\n        classBreakInfo.classMinValue === undefined\r\n      ) {\r\n        if (i === 0) {\r\n          min = renderer.minValue;\r\n        } else {\r\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\r\n        }\r\n      } else {\r\n        min = classBreakInfo.classMinValue;\r\n      }\r\n      const max = classBreakInfo.classMaxValue;\r\n      const symbol = classBreakInfo.symbol;\r\n      const style = this._converters[symbol.type].call(this, symbol);\r\n      classes.push({ min, max, style });\r\n    }\r\n    return (() => {\r\n      return (feature) => {\r\n        const value = feature.get(field);\r\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\r\n          let condition;\r\n          if (i === 0) {\r\n            condition = value >= classes[i].min && value <= classes[i].max;\r\n          } else {\r\n            condition = value > classes[i].min && value <= classes[i].max;\r\n          }\r\n          if (condition) {\r\n            return [classes[i].style];\r\n          }\r\n        }\r\n        return [defaultStyle];\r\n      };\r\n    })();\r\n  }\r\n  _renderUniqueValue(renderer) {\r\n    const defaultSymbol = renderer.defaultSymbol;\r\n    let defaultStyle = [];\r\n    if (defaultSymbol) {\r\n      defaultStyle = [\r\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\r\n      ];\r\n    }\r\n    const field = renderer.field1;\r\n    const infos = renderer.uniqueValueInfos;\r\n    const me = this;\r\n    return (() => {\r\n      const hash = {};\r\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\r\n        const info = infos[i];\r\n        const symbol = info.symbol;\r\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\r\n      }\r\n\r\n      return (feature) => {\r\n        const style = hash[feature.get(field)];\r\n        return style ? style : defaultStyle;\r\n      };\r\n    })();\r\n  }\r\n  generateStyle(layerInfo, mapUnits) {\r\n    const drawingInfo = layerInfo.drawingInfo;\r\n    let styleFunctions = [];\r\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\r\n      this,\r\n      drawingInfo.renderer\r\n    );\r\n    if (drawingInfoStyle !== undefined) {\r\n      styleFunctions.push(drawingInfoStyle);\r\n    }\r\n    if (layerInfo.labelingInfo) {\r\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\r\n        layerInfo.labelingInfo,\r\n        mapUnits\r\n      );\r\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\r\n    }\r\n    if (styleFunctions.length === 1) {\r\n      return styleFunctions[0];\r\n    } else {\r\n      return (() => {\r\n        return (feature, resolution) => {\r\n          let styles = [];\r\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\r\n            const result = styleFunctions[i].call(null, feature, resolution);\r\n            if (result) {\r\n              styles = styles.concat(result);\r\n            }\r\n          }\r\n          return styles;\r\n        };\r\n      })();\r\n    }\r\n  }\r\n}\r\n","export enum TimeFilterType {\r\n  DATE = 'date',\r\n  TIME = 'time',\r\n  DATETIME = 'datetime',\r\n  YEAR = 'year'\r\n}\r\n\r\nexport enum TimeFilterStyle {\r\n  CALENDAR = 'calendar',\r\n  SLIDER = 'slider'\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable, forkJoin, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport { WMSCapabilities, WMTSCapabilities, EsriJSON } from 'ol/format';\r\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\r\nimport olAttribution from 'ol/control/Attribution';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\r\nimport { EsriStyleGenerator } from '../../style/shared/datasource/esri-style-generator';\r\nimport {\r\n  QueryFormat,\r\n  QueryFormatMimeType\r\n} from '../../query/shared/query.enums';\r\n\r\nimport {\r\n  WMTSDataSourceOptions,\r\n  WMSDataSourceOptions,\r\n  CartoDataSourceOptions,\r\n  ArcGISRestDataSourceOptions,\r\n  TileArcGISRestDataSourceOptions,\r\n  ArcGISRestImageDataSourceOptions\r\n} from './datasources';\r\nimport {\r\n  LegendOptions,\r\n  ItemStyleOptions\r\n} from '../../layer/shared/layers/legend.interface';\r\nimport {\r\n  TimeFilterType,\r\n  TimeFilterStyle\r\n} from '../../filter/shared/time-filter.enum';\r\nimport * as olproj from 'ol/proj';\r\n\r\nexport enum TypeCapabilities {\r\n  wms = 'wms',\r\n  wmts = 'wmts',\r\n  arcgisrest = 'esriJSON',\r\n  imagearcgisrest = 'esriJSON',\r\n  tilearcgisrest = 'esriJSON'\r\n}\r\n\r\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CapabilitiesService {\r\n  private parsers = {\r\n    wms: new WMSCapabilities(),\r\n    wmts: new WMTSCapabilities(),\r\n    esriJSON: new EsriJSON()\r\n  };\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private mapService: MapService\r\n  ) {}\r\n\r\n  getWMSOptions(\r\n    baseOptions: WMSDataSourceOptions\r\n  ): Observable<WMSDataSourceOptions> {\r\n    const url = baseOptions.url;\r\n    const version = (baseOptions.params as any).VERSION;\r\n\r\n    return this.getCapabilities('wms', url, version).pipe(\r\n      map((capabilities: any) => {\r\n        return capabilities\r\n          ? this.parseWMSOptions(baseOptions, capabilities)\r\n          : undefined;\r\n      })\r\n    );\r\n  }\r\n\r\n  getWMTSOptions(\r\n    baseOptions: WMTSDataSourceOptions\r\n  ): Observable<WMTSDataSourceOptions> {\r\n    const url = baseOptions.url;\r\n    const version = baseOptions.version;\r\n\r\n    const options = this.getCapabilities('wmts', url, version).pipe(\r\n      map((capabilities: any) => {\r\n        return capabilities\r\n          ? this.parseWMTSOptions(baseOptions, capabilities)\r\n          : undefined;\r\n      })\r\n    );\r\n    return options;\r\n  }\r\n\r\n  getCartoOptions(\r\n    baseOptions: CartoDataSourceOptions\r\n  ): Observable<CartoDataSourceOptions> {\r\n    const baseUrl =\r\n      'https://' +\r\n      baseOptions.account +\r\n      '.carto.com/api/v2/viz/' +\r\n      baseOptions.mapId +\r\n      '/viz.json';\r\n\r\n    return this.http\r\n      .jsonp(baseUrl, 'callback')\r\n      .pipe(\r\n        map((cartoOptions: any) =>\r\n          this.parseCartoOptions(baseOptions, cartoOptions)\r\n        )\r\n      );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getArcgisOptions(\r\n    baseOptions: ArcGISRestDataSourceOptions\r\n  ): Observable<ArcGISRestDataSourceOptions> {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const serviceCapabilities = this.getCapabilities(\r\n      'arcgisrest',\r\n      baseOptions.url\r\n    );\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    return forkJoin([arcgisOptions, serviceCapabilities]).pipe(\r\n      map((res: any) => {\r\n        return this.parseArcgisOptions(baseOptions, res[0], res[1]);\r\n      })\r\n    );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getImageArcgisOptions(\r\n    baseOptions:\r\n      | ArcGISRestImageDataSourceOptions\r\n      | TileArcGISRestDataSourceOptions\r\n  ): Observable<\r\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\r\n  > {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const legendUrl = baseOptions.url + '/legend?f=json';\r\n    const serviceCapabilities = this.getCapabilities(\r\n      'imagearcgisrest',\r\n      baseOptions.url\r\n    );\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    const legend = this.http.get(legendUrl).pipe(\r\n      map((res: any) => res),\r\n      catchError((err) => {\r\n        console.log('No legend associated with this Image Service');\r\n        return of(err);\r\n      })\r\n    );\r\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\r\n      map((res: any) => {\r\n        return this.parseTileOrImageArcgisOptions(\r\n          baseOptions,\r\n          res[0],\r\n          res[1],\r\n          res[2]\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getTileArcgisOptions(\r\n    baseOptions: TileArcGISRestDataSourceOptions\r\n  ): Observable<\r\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\r\n  > {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const legendUrl = baseOptions.url + '/legend?f=json';\r\n    const serviceCapabilities = this.getCapabilities(\r\n      'tilearcgisrest',\r\n      baseOptions.url\r\n    );\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    const legendInfo = this.http.get(legendUrl).pipe(\r\n      map((res: any) => res),\r\n      catchError((err) => {\r\n        console.log('No legend associated with this Tile Service');\r\n        return of(err);\r\n      })\r\n    );\r\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\r\n      map((res: any) =>\r\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\r\n      )\r\n    );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getCapabilities(\r\n    service: TypeCapabilitiesStrings,\r\n    baseUrl: string,\r\n    version?: string\r\n  ): Observable<any> {\r\n    const params = new HttpParams({\r\n      fromObject: {\r\n        request: 'GetCapabilities',\r\n        service: service.toUpperCase(),\r\n        version: version || '1.3.0',\r\n        _i: 'true'\r\n      }\r\n    });\r\n\r\n    let request;\r\n    if (TypeCapabilities[service] === 'esriJSON') {\r\n      request = this.http.get(baseUrl + '?f=json');\r\n    } else {\r\n      request = this.http.get(baseUrl, {\r\n        params,\r\n        responseType: 'text'\r\n      });\r\n    }\r\n\r\n    return request.pipe(\r\n      map((res) => {\r\n        if (TypeCapabilities[service] === 'esriJSON') {\r\n          return res as object;\r\n        }\r\n        if (\r\n          String(res).toLowerCase().includes('serviceexception') &&\r\n          String(res).toLowerCase().includes('access denied')\r\n        ) {\r\n          throw {\r\n            error: {\r\n              message: 'Service error getCapabilities: Access is denied'\r\n            }\r\n          };\r\n        } else {\r\n          return this.parsers[service].read(res);\r\n        }\r\n      }),\r\n      catchError((e) => {\r\n        if (typeof e.error !== 'undefined') {\r\n          e.error.caught = true;\r\n        }\r\n        throw e;\r\n      })\r\n    );\r\n  }\r\n\r\n  private parseWMSOptions(\r\n    baseOptions: WMSDataSourceOptions,\r\n    capabilities: any\r\n  ): WMSDataSourceOptions {\r\n    const layers = (baseOptions.params as any).LAYERS;\r\n    const layer = this.findDataSourceInCapabilities(\r\n      capabilities.Capability.Layer,\r\n      layers\r\n    );\r\n\r\n    if (!layer) {\r\n      throw {\r\n        error: {\r\n          message: 'Layer not found'\r\n        }\r\n      };\r\n    }\r\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\r\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\r\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\r\n    let queryable = layer.queryable;\r\n    const timeFilter = this.getTimeFilter(layer);\r\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\r\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\r\n    let isExtentInGeographic = true;\r\n    if (layer.EX_GeographicBoundingBox) {\r\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\r\n        if (index < 2 && (coord > 180 || coord < -180)) {\r\n          isExtentInGeographic = false;\r\n        }\r\n        if (index >= 2 && (coord > 90 || coord < -90)) {\r\n          isExtentInGeographic = false;\r\n        }\r\n      });\r\n    } else {\r\n      isExtentInGeographic = false;\r\n    }\r\n\r\n    const extent = isExtentInGeographic\r\n      ? olproj.transformExtent(\r\n          layer.EX_GeographicBoundingBox,\r\n          'EPSG:4326',\r\n          this.mapService.getMap().projection\r\n        )\r\n      : undefined;\r\n\r\n    let queryFormat: QueryFormat;\r\n    const queryFormatMimeTypePriority = [\r\n      QueryFormatMimeType.GEOJSON,\r\n      QueryFormatMimeType.GEOJSON2,\r\n      QueryFormatMimeType.GML3,\r\n      QueryFormatMimeType.GML2,\r\n      QueryFormatMimeType.JSON,\r\n      QueryFormatMimeType.HTML\r\n    ];\r\n\r\n    for (const mimeType of queryFormatMimeTypePriority) {\r\n      if (\r\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\r\n          mimeType\r\n        ) !== -1\r\n      ) {\r\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\r\n          (key) => QueryFormatMimeType[key] === mimeType\r\n        );\r\n        queryFormat = QueryFormat[keyEnum];\r\n        break;\r\n      }\r\n    }\r\n    if (!queryFormat) {\r\n      queryable = false;\r\n    }\r\n\r\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\r\n      _layerOptionsFromSource: {\r\n        title: layer.Title,\r\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\r\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\r\n        extent,\r\n        metadata: {\r\n          url: metadata ? metadata.OnlineResource : undefined,\r\n          extern: metadata ? true : undefined,\r\n          abstract,\r\n          keywordList\r\n        },\r\n        legendOptions\r\n      },\r\n      queryable,\r\n      queryFormat,\r\n      timeFilter: timeFilterable ? timeFilter : undefined,\r\n      timeFilterable: timeFilterable ? true : undefined,\r\n      minDate: timeFilterable ? timeFilter.min : undefined,\r\n      maxDate: timeFilterable ? timeFilter.max : undefined,\r\n      stepDate: timeFilterable ? timeFilter.step : undefined\r\n    });\r\n\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseWMTSOptions(\r\n    baseOptions: WMTSDataSourceOptions,\r\n    capabilities: any\r\n  ): WMTSDataSourceOptions {\r\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\r\n    const layer = capabilities.Contents.Layer.find(\r\n      (el) => el.Identifier === baseOptions.layer\r\n    );\r\n\r\n    const options = optionsFromCapabilities(capabilities, baseOptions);\r\n\r\n    const ouputOptions = Object.assign(options, baseOptions);\r\n    const sourceOptions = ObjectUtils.removeUndefined({\r\n      _layerOptionsFromSource: {\r\n        title: layer.Title\r\n      }\r\n    });\r\n\r\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\r\n  }\r\n\r\n  private parseCartoOptions(\r\n    baseOptions: CartoDataSourceOptions,\r\n    cartoOptions: any\r\n  ): CartoDataSourceOptions {\r\n    const layers = [];\r\n    const params = cartoOptions.layers[1].options.layer_definition;\r\n    params.layers.forEach((element) => {\r\n      layers.push({\r\n        type: element.type.toLowerCase(),\r\n        options: element.options,\r\n        legend: element.legend\r\n      });\r\n    });\r\n    const options = ObjectUtils.removeUndefined({\r\n      config: {\r\n        version: params.version,\r\n        layers\r\n      }\r\n    });\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseArcgisOptions(\r\n    baseOptions: ArcGISRestDataSourceOptions,\r\n    arcgisOptions: any,\r\n    serviceCapabilities: any\r\n  ): ArcGISRestDataSourceOptions {\r\n    const title = arcgisOptions.name;\r\n    let legendInfo: any;\r\n\r\n    if (arcgisOptions.drawingInfo?.renderer) {\r\n      legendInfo = arcgisOptions.drawingInfo.renderer;\r\n    } else {\r\n      legendInfo = undefined;\r\n    }\r\n\r\n    let style;\r\n    if (arcgisOptions.drawingInfo) {\r\n      const styleGenerator = new EsriStyleGenerator();\r\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\r\n      style = styleGenerator.generateStyle(arcgisOptions, units);\r\n    }\r\n    const attributions = new olAttribution({\r\n      target: arcgisOptions.copyrightText\r\n    });\r\n    let timeExtent;\r\n    let timeFilter;\r\n    if (arcgisOptions.timeInfo) {\r\n      const time = arcgisOptions.timeInfo.timeExtent;\r\n      timeExtent = time[0] + ',' + time[1];\r\n      const min = new Date();\r\n      min.setTime(time[0]);\r\n      const max = new Date();\r\n      max.setTime(time[1]);\r\n      timeFilter = {\r\n        min: min.toUTCString(),\r\n        max: max.toUTCString(),\r\n        range: true,\r\n        type: TimeFilterType.DATETIME,\r\n        style: TimeFilterStyle.CALENDAR\r\n      };\r\n    }\r\n    const params = Object.assign(\r\n      {},\r\n      {\r\n        style,\r\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\r\n        time: timeExtent\r\n      }\r\n    );\r\n    const options = ObjectUtils.removeUndefined({\r\n      params,\r\n      _layerOptionsFromSource: {\r\n        title,\r\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\r\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\r\n        metadata: {\r\n          extern: false,\r\n          abstract:\r\n            arcgisOptions.description || serviceCapabilities.serviceDescription\r\n        }\r\n      },\r\n      legendInfo,\r\n      timeFilter,\r\n      sourceFields: arcgisOptions.fields,\r\n      queryTitle: arcgisOptions.displayField\r\n    });\r\n    options.attributions = attributions;\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseTileOrImageArcgisOptions(\r\n    baseOptions:\r\n      | TileArcGISRestDataSourceOptions\r\n      | ArcGISRestImageDataSourceOptions,\r\n    arcgisOptions: any,\r\n    legend: any,\r\n    serviceCapabilities: any\r\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\r\n    const title = arcgisOptions.name;\r\n    const legendInfo = legend.layers\r\n      ? legend.layers.find((x) => x.layerName === title)\r\n      : undefined;\r\n    const attributions = new olAttribution({\r\n      target: arcgisOptions.copyrightText\r\n    });\r\n    let timeExtent;\r\n    let timeFilter;\r\n    if (arcgisOptions.timeInfo) {\r\n      const time = arcgisOptions.timeInfo.timeExtent;\r\n      timeExtent = time[0] + ',' + time[1];\r\n      const min = new Date();\r\n      min.setTime(time[0]);\r\n      const max = new Date();\r\n      max.setTime(time[1]);\r\n      timeFilter = {\r\n        min: min.toUTCString(),\r\n        max: max.toUTCString(),\r\n        range: true,\r\n        type: TimeFilterType.DATETIME,\r\n        style: TimeFilterStyle.CALENDAR\r\n      };\r\n    }\r\n    const params = Object.assign(\r\n      {},\r\n      {\r\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\r\n        time: timeExtent\r\n      }\r\n    );\r\n    const options = ObjectUtils.removeUndefined({\r\n      params,\r\n      _layerOptionsFromSource: {\r\n        title,\r\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\r\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\r\n        metadata: {\r\n          extern: false,\r\n          abstract:\r\n            arcgisOptions.description || serviceCapabilities.serviceDescription\r\n        }\r\n      },\r\n      legendInfo,\r\n      timeFilter,\r\n      sourceFields: arcgisOptions.fields,\r\n      queryTitle: arcgisOptions.displayField\r\n    });\r\n    options.attributions = attributions;\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private findDataSourceInCapabilities(layerArray, name): any {\r\n    if (Array.isArray(layerArray)) {\r\n      let layer;\r\n      layerArray.find((value) => {\r\n        layer = this.findDataSourceInCapabilities(value, name);\r\n        return layer !== undefined;\r\n      }, this);\r\n\r\n      return layer;\r\n    } else if (layerArray.Layer) {\r\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\r\n    } else {\r\n      if (layerArray.Name && layerArray.Name === name) {\r\n        return layerArray;\r\n      }\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  getTimeFilter(layer) {\r\n    let dimension;\r\n\r\n    if (layer.Dimension) {\r\n      const timeFilter: any = {};\r\n      dimension = layer.Dimension[0];\r\n\r\n      if (dimension.values) {\r\n        const minMaxDim = dimension.values.split('/');\r\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\r\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\r\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\r\n      }\r\n\r\n      if (dimension.default) {\r\n        timeFilter.value = dimension.default;\r\n      }\r\n      return timeFilter;\r\n    }\r\n  }\r\n\r\n  getStyle(Style): LegendOptions {\r\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\r\n      return {\r\n        name: style.Name,\r\n        title: style.Title\r\n      };\r\n    })\r\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\r\n      .filter(\r\n        (item, index, self) =>\r\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\r\n          index\r\n      );\r\n\r\n    const legendOptions: LegendOptions = {\r\n      stylesAvailable: styleOptions\r\n    } as LegendOptions;\r\n\r\n    return legendOptions;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport proj4 from 'proj4';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olproj4 from 'ol/proj/proj4';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Projection } from './projection.interfaces';\r\n\r\n/**\r\n * When injected, this service automatically registers and\r\n * projection defined in the application config. A custom projection\r\n * needs to be registered to be usable by OL.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ProjectionService {\r\n  constructor(private config: ConfigService) {\r\n    const projections = this.config.getConfig('projections') || [];\r\n    projections.forEach((projection: Projection) => {\r\n      projection.alias = projection.alias ? projection.alias : projection.code;\r\n      this.registerProjection(projection);\r\n    });\r\n\r\n    // register all utm zones\r\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\r\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\r\n      const proj: Projection = { code, def, extent: undefined };\r\n      this.registerProjection(proj);\r\n    }\r\n\r\n    // register all mtm zones\r\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\r\n      const code =\r\n        mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n      let lon0;\r\n      if (Number(mtmZone) <= 2) {\r\n        lon0 = -50 - Number(mtmZone) * 3;\r\n      } else if (Number(mtmZone) >= 12) {\r\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\r\n      } else {\r\n        lon0 = -49.5 - Number(mtmZone) * 3;\r\n      }\r\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\r\n      const proj: Projection = { code, def, extent: undefined };\r\n      this.registerProjection(proj);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define a proj4 projection and register it in OL\r\n   * @param projection Projection\r\n   */\r\n  registerProjection(projection: Projection) {\r\n    proj4.defs(projection.code, projection.def);\r\n    olproj4.register(proj4);\r\n    if (projection.extent) {\r\n      olproj.get(projection.code).setExtent(projection.extent);\r\n    }\r\n  }\r\n}\r\n","import { Observable } from 'rxjs';\r\n\r\nimport {\r\n  ArcGISRestDataSourceOptions,\r\n  ArcGISRestImageDataSourceOptions,\r\n  TileArcGISRestDataSourceOptions,\r\n  WMSDataSourceOptions\r\n} from '../datasources';\r\n\r\nexport abstract class OptionsService {\r\n  abstract getWMSOptions(\r\n    _baseOptions: WMSDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<WMSDataSourceOptions>;\r\n  abstract getArcgisRestOptions(\r\n    _baseOptions:\r\n      | ArcGISRestDataSourceOptions\r\n      | ArcGISRestImageDataSourceOptions\r\n      | TileArcGISRestDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<\r\n    | ArcGISRestDataSourceOptions\r\n    | ArcGISRestImageDataSourceOptions\r\n    | TileArcGISRestDataSourceOptions\r\n  >;\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\nimport { CapabilitiesService } from './capabilities.service';\r\nimport { OptionsService } from './options/options.service';\r\nimport { WFSService } from './datasources/wfs.service';\r\nimport {\r\n  DataSource,\r\n  OSMDataSource,\r\n  OSMDataSourceOptions,\r\n  FeatureDataSource,\r\n  FeatureDataSourceOptions,\r\n  XYZDataSource,\r\n  XYZDataSourceOptions,\r\n  TileDebugDataSource,\r\n  TileDebugDataSourceOptions,\r\n  WFSDataSource,\r\n  WFSDataSourceOptions,\r\n  WMTSDataSource,\r\n  WMTSDataSourceOptions,\r\n  WMSDataSource,\r\n  WMSDataSourceOptions,\r\n  CartoDataSource,\r\n  CartoDataSourceOptions,\r\n  ArcGISRestDataSource,\r\n  ArcGISRestDataSourceOptions,\r\n  ImageArcGISRestDataSource,\r\n  ArcGISRestImageDataSourceOptions,\r\n  TileArcGISRestDataSource,\r\n  TileArcGISRestDataSourceOptions,\r\n  WebSocketDataSource,\r\n  AnyDataSourceOptions,\r\n  MVTDataSource,\r\n  MVTDataSourceOptions,\r\n  ClusterDataSource,\r\n  ClusterDataSourceOptions\r\n} from './datasources';\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { ProjectionService } from '../../map/shared/projection.service';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DataSourceService {\r\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    @Optional() private optionsService: OptionsService,\r\n    private wfsDataSourceService: WFSService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private projectionService: ProjectionService,\r\n    private authInterceptor?: AuthInterceptor\r\n  ) {}\r\n\r\n  createAsyncDataSource(\r\n    context: AnyDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<DataSource> {\r\n    if (!context.type) {\r\n      console.error(context);\r\n      throw new Error('Datasource needs a type');\r\n    }\r\n    let dataSource;\r\n    switch (context.type.toLowerCase()) {\r\n      case 'osm':\r\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\r\n        break;\r\n      case 'vector':\r\n        dataSource = this.createFeatureDataSource(\r\n          context as FeatureDataSourceOptions\r\n        );\r\n        break;\r\n      case 'wfs':\r\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\r\n        break;\r\n      case 'wms':\r\n        const wmsContext = context as WMSDataSourceOptions;\r\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\r\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\r\n        break;\r\n      case 'wmts':\r\n        dataSource = this.createWMTSDataSource(\r\n          context as WMTSDataSourceOptions\r\n        );\r\n        break;\r\n      case 'xyz':\r\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\r\n        break;\r\n      case 'tiledebug':\r\n        dataSource = this.createTileDebugDataSource(\r\n          context as TileDebugDataSource\r\n        );\r\n        break;\r\n      case 'carto':\r\n        dataSource = this.createCartoDataSource(\r\n          context as CartoDataSourceOptions\r\n        );\r\n        break;\r\n      case 'arcgisrest':\r\n        dataSource = this.createArcGISRestDataSource(\r\n          context as ArcGISRestDataSourceOptions,\r\n          detailedContextUri\r\n        );\r\n        break;\r\n      case 'imagearcgisrest':\r\n        dataSource = this.createArcGISRestImageDataSource(\r\n          context as ArcGISRestImageDataSourceOptions,\r\n          detailedContextUri\r\n        );\r\n        break;\r\n      case 'websocket':\r\n        dataSource = this.createWebSocketDataSource(\r\n          context as FeatureDataSourceOptions\r\n        );\r\n        break;\r\n      case 'mvt':\r\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\r\n        break;\r\n      case 'tilearcgisrest':\r\n        dataSource = this.createTileArcGISRestDataSource(\r\n          context as TileArcGISRestDataSourceOptions,\r\n          detailedContextUri\r\n        );\r\n        break;\r\n      case 'cluster':\r\n        dataSource = this.createClusterDataSource(\r\n          context as ClusterDataSourceOptions\r\n        );\r\n        break;\r\n      default:\r\n        console.error(context);\r\n        throw new Error('Invalid datasource type');\r\n    }\r\n\r\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\r\n\r\n    return dataSource;\r\n  }\r\n\r\n  private createOSMDataSource(\r\n    context: OSMDataSourceOptions\r\n  ): Observable<OSMDataSource> {\r\n    return new Observable((d) => d.next(new OSMDataSource(context)));\r\n  }\r\n\r\n  private createFeatureDataSource(\r\n    context: FeatureDataSourceOptions\r\n  ): Observable<FeatureDataSource> {\r\n    return new Observable((d) => d.next(new FeatureDataSource(context)));\r\n  }\r\n\r\n  private createWebSocketDataSource(\r\n    context: FeatureDataSourceOptions\r\n  ): Observable<WebSocketDataSource> {\r\n    return new Observable((d) => d.next(new WebSocketDataSource(context)));\r\n  }\r\n\r\n  private createWFSDataSource(\r\n    context: WFSDataSourceOptions\r\n  ): Observable<WFSDataSource> {\r\n    return new Observable((d) =>\r\n      d.next(\r\n        new WFSDataSource(\r\n          context,\r\n          this.wfsDataSourceService,\r\n          this.authInterceptor\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  private createWMSDataSource(\r\n    context: WMSDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<any> {\r\n    const observables = [];\r\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\r\n      observables.push(\r\n        this.capabilitiesService.getWMSOptions(context).pipe(\r\n          catchError((e) => {\r\n            this.messageService.error(\r\n              'igo.geo.dataSource.unavailable',\r\n              'igo.geo.dataSource.unavailableTitle',\r\n              undefined,\r\n              { value: context.params.LAYERS }\r\n            );\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n\r\n    if (\r\n      this.optionsService &&\r\n      context.optionsFromApi &&\r\n      window.navigator.onLine\r\n    ) {\r\n      observables.push(\r\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\r\n          catchError((e) => {\r\n            e.error.toDisplay = true;\r\n            e.error.title = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailableTitle'\r\n            );\r\n            e.error.message = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.optionsApiUnavailable'\r\n            );\r\n            return of({});\r\n          })\r\n        )\r\n      );\r\n    }\r\n\r\n    observables.push(of(context));\r\n\r\n    return forkJoin(observables).pipe(\r\n      map((options: WMSDataSourceOptions[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createWMTSDataSource(\r\n    context: WMTSDataSourceOptions\r\n  ): Observable<WMTSDataSource> {\r\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\r\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\r\n        map((options: WMTSDataSourceOptions) => {\r\n          return options ? new WMTSDataSource(options) : undefined;\r\n        }),\r\n        catchError(() => {\r\n          this.messageService.error(\r\n            'igo.geo.dataSource.unavailable',\r\n            'igo.geo.dataSource.unavailableTitle',\r\n            undefined,\r\n            { value: context.layer }\r\n          );\r\n          return of(undefined);\r\n        })\r\n      );\r\n    }\r\n\r\n    return new Observable((d) => d.next(new WMTSDataSource(context)));\r\n  }\r\n\r\n  private createXYZDataSource(\r\n    context: XYZDataSourceOptions\r\n  ): Observable<XYZDataSource> {\r\n    return new Observable((d) => d.next(new XYZDataSource(context)));\r\n  }\r\n\r\n  private createTileDebugDataSource(\r\n    context: TileDebugDataSourceOptions\r\n  ): Observable<TileDebugDataSource> {\r\n    return new Observable((d) => d.next(new TileDebugDataSource(context)));\r\n  }\r\n\r\n  private createCartoDataSource(\r\n    context: CartoDataSourceOptions\r\n  ): Observable<CartoDataSource> {\r\n    if (context.mapId) {\r\n      return this.capabilitiesService\r\n        .getCartoOptions(context)\r\n        .pipe(\r\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\r\n        );\r\n    }\r\n    return new Observable((d) => d.next(new CartoDataSource(context)));\r\n  }\r\n\r\n  private createArcGISRestDataSource(\r\n    context: ArcGISRestDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<ArcGISRestDataSource> {\r\n    const observables = [];\r\n    if (window.navigator.onLine) {\r\n      observables.push(\r\n        this.capabilitiesService.getArcgisOptions(context).pipe(\r\n          catchError((e) => {\r\n            this.messageService.error(\r\n              'igo.geo.dataSource.unavailable',\r\n              'igo.geo.dataSource.unavailableTitle',\r\n              undefined,\r\n              { value: context.layer }\r\n            );\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n    if (\r\n      this.optionsService &&\r\n      context.optionsFromApi &&\r\n      window.navigator.onLine\r\n    ) {\r\n      observables.push(\r\n        this.optionsService\r\n          .getArcgisRestOptions(context, detailedContextUri)\r\n          .pipe(\r\n            catchError((e) => {\r\n              e.error.toDisplay = true;\r\n              e.error.title = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.unavailableTitle'\r\n              );\r\n              e.error.message = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.optionsApiUnavailable'\r\n              );\r\n              return of({});\r\n            })\r\n          )\r\n      );\r\n    }\r\n    observables.push(of(context));\r\n    return forkJoin(observables).pipe(\r\n      map((options: ArcGISRestDataSource[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new ArcGISRestDataSource(optionsMerged);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createArcGISRestImageDataSource(\r\n    context: ArcGISRestImageDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<ArcGISRestImageDataSourceOptions> {\r\n    const observables = [];\r\n\r\n    if (window.navigator.onLine) {\r\n      observables.push(\r\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\r\n          catchError((e) => {\r\n            this.messageService.error(\r\n              'igo.geo.dataSource.unavailable',\r\n              'igo.geo.dataSource.unavailableTitle',\r\n              undefined,\r\n              { value: context.params.LAYERS }\r\n            );\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n    if (\r\n      this.optionsService &&\r\n      context.optionsFromApi &&\r\n      window.navigator.onLine\r\n    ) {\r\n      observables.push(\r\n        this.optionsService\r\n          .getArcgisRestOptions(context, detailedContextUri)\r\n          .pipe(\r\n            catchError((e) => {\r\n              e.error.toDisplay = true;\r\n              e.error.title = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.unavailableTitle'\r\n              );\r\n              e.error.message = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.optionsApiUnavailable'\r\n              );\r\n              return of({});\r\n            })\r\n          )\r\n      );\r\n    }\r\n    observables.push(of(context));\r\n    return forkJoin(observables).pipe(\r\n      map((options: ImageArcGISRestDataSource[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new ImageArcGISRestDataSource(optionsMerged);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createTileArcGISRestDataSource(\r\n    context: TileArcGISRestDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<TileArcGISRestDataSource> {\r\n    const observables = [];\r\n    if (window.navigator.onLine) {\r\n      observables.push(\r\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\r\n          catchError((e) => {\r\n            this.messageService.error(\r\n              'igo.geo.dataSource.unavailable',\r\n              'igo.geo.dataSource.unavailableTitle',\r\n              undefined,\r\n              { value: context.params.LAYERS }\r\n            );\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n    if (\r\n      this.optionsService &&\r\n      context.optionsFromApi &&\r\n      window.navigator.onLine\r\n    ) {\r\n      observables.push(\r\n        this.optionsService\r\n          .getArcgisRestOptions(context, detailedContextUri)\r\n          .pipe(\r\n            catchError((e) => {\r\n              e.error.toDisplay = true;\r\n              e.error.title = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.unavailableTitle'\r\n              );\r\n              e.error.message = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.optionsApiUnavailable'\r\n              );\r\n              return of({});\r\n            })\r\n          )\r\n      );\r\n    }\r\n    observables.push(of(context));\r\n    return forkJoin(observables).pipe(\r\n      map((options: TileArcGISRestDataSource[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new TileArcGISRestDataSource(optionsMerged);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createMVTDataSource(\r\n    context: MVTDataSourceOptions\r\n  ): Observable<MVTDataSource> {\r\n    return new Observable((d) => d.next(new MVTDataSource(context)));\r\n  }\r\n\r\n  private createClusterDataSource(\r\n    context: ClusterDataSourceOptions\r\n  ): Observable<ClusterDataSource> {\r\n    return new Observable((d) => d.next(new ClusterDataSource(context)));\r\n  }\r\n}\r\n","import {\r\n  BehaviorSubject,\r\n  Observable,\r\n  Subject,\r\n  Subscription,\r\n  combineLatest\r\n} from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport olLayer from 'ol/layer/Layer';\r\nimport olSource from 'ol/source/Source';\r\n\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport { DataSource, Legend } from '../../../datasource';\r\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\r\n\r\nimport { LayerOptions } from './layer.interface';\r\nimport { Message, MessageService } from '@igo2/core';\r\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\r\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\r\nimport { MapBase } from '../../../map/shared/map.abstract';\r\n\r\nexport abstract class Layer {\r\n  public collapsed: boolean;\r\n  public dataSource: DataSource;\r\n  public legend: Legend[];\r\n  public legendCollapsed: boolean = true;\r\n  public firstLoadComponent: boolean = true;\r\n  public map: MapBase;\r\n  public ol: olLayer<olSource>;\r\n  public olLoadingProblem: boolean = false;\r\n  public status$: Subject<SubjectStatus>;\r\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  private hasBeenVisible$$: Subscription;\r\n  private resolution$$: Subscription;\r\n\r\n  /**\r\n   * Define if a layer is generated by code OR defined by layer/context user layer.\r\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\r\n   * return false by default.\r\n   */\r\n  get isIgoInternalLayer(): boolean {\r\n    return this.options.isIgoInternalLayer || false;\r\n  }\r\n\r\n  get id(): string {\r\n    return this.options.id || this.dataSource.id;\r\n  }\r\n\r\n  get alias(): string {\r\n    return this.options.alias;\r\n  }\r\n\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  set title(title: string) {\r\n    this.options.title = title;\r\n  }\r\n\r\n  get zIndex(): number {\r\n    return this.ol.getZIndex();\r\n  }\r\n\r\n  set zIndex(zIndex: number) {\r\n    this.ol.setZIndex(zIndex);\r\n  }\r\n\r\n  get baseLayer(): boolean {\r\n    return this.options.baseLayer;\r\n  }\r\n\r\n  set baseLayer(baseLayer: boolean) {\r\n    this.options.baseLayer = baseLayer;\r\n  }\r\n\r\n  get opacity(): number {\r\n    return this.ol.get('opacity');\r\n  }\r\n\r\n  set opacity(opacity: number) {\r\n    this.ol.setOpacity(opacity);\r\n  }\r\n\r\n  set isInResolutionsRange(value: boolean) {\r\n    this.isInResolutionsRange$.next(value);\r\n  }\r\n  get isInResolutionsRange(): boolean {\r\n    return this.isInResolutionsRange$.value;\r\n  }\r\n  readonly isInResolutionsRange$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject(false);\r\n\r\n  set maxResolution(value: number) {\r\n    this.ol.setMaxResolution(value === 0 ? 0 : value || Infinity);\r\n    this.updateInResolutionsRange();\r\n  }\r\n  get maxResolution(): number {\r\n    return this.ol.getMaxResolution();\r\n  }\r\n\r\n  set minResolution(value: number) {\r\n    this.ol.setMinResolution(value || 0);\r\n    this.updateInResolutionsRange();\r\n  }\r\n  get minResolution(): number {\r\n    return this.ol.getMinResolution();\r\n  }\r\n\r\n  set visible(value: boolean) {\r\n    this.ol.setVisible(value);\r\n    this.visible$.next(value);\r\n    if (!this.hasBeenVisible$.value && value) {\r\n      this.hasBeenVisible$.next(value);\r\n    }\r\n    if (this.options?.messages && value) {\r\n      this.options?.messages\r\n        .filter((m) => m.options?.showOnEachLayerVisibility)\r\n        .map((message) => this.showMessage(message));\r\n    }\r\n  }\r\n  get visible(): boolean {\r\n    return this.visible$.value;\r\n  }\r\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\r\n\r\n  get displayed(): boolean {\r\n    return this.visible && this.isInResolutionsRange;\r\n  }\r\n  readonly displayed$: Observable<boolean> = combineLatest([\r\n    this.isInResolutionsRange$,\r\n    this.visible$\r\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\r\n\r\n  get showInLayerList(): boolean {\r\n    return this.options.showInLayerList !== false;\r\n  }\r\n\r\n  constructor(\r\n    public options: LayerOptions,\r\n    protected messageService?: MessageService,\r\n    protected authInterceptor?: AuthInterceptor,\r\n    protected geoDBService?: GeoDBService,\r\n    public layerDBService?: LayerDBService\r\n  ) {\r\n    this.dataSource = options.source;\r\n\r\n    this.ol = this.createOlLayer();\r\n    if (options.zIndex !== undefined) {\r\n      this.zIndex = options.zIndex;\r\n    }\r\n\r\n    if (options.baseLayer && options.visible === undefined) {\r\n      options.visible = false;\r\n    }\r\n\r\n    this.maxResolution =\r\n      options.maxResolution ||\r\n      getResolutionFromScale(Number(options.maxScaleDenom));\r\n    this.minResolution =\r\n      options.minResolution ||\r\n      getResolutionFromScale(Number(options.minScaleDenom));\r\n\r\n    this.visible = options.visible === undefined ? true : options.visible;\r\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\r\n\r\n    if (\r\n      options.legendOptions &&\r\n      (options.legendOptions.url || options.legendOptions.html)\r\n    ) {\r\n      this.legend = this.dataSource.setLegend(options.legendOptions);\r\n    }\r\n\r\n    this.legendCollapsed = options.legendOptions\r\n      ? options.legendOptions.collapsed\r\n        ? options.legendOptions.collapsed\r\n        : true\r\n      : true;\r\n\r\n    this.ol.set('_layer', this, true);\r\n  }\r\n\r\n  protected abstract createOlLayer(): olLayer<olSource>;\r\n\r\n  setMap(map: MapBase | undefined) {\r\n    this.map = map;\r\n\r\n    this.unobserveResolution();\r\n    if (map !== undefined) {\r\n      this.observeResolution();\r\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\r\n        if (this.options.messages && this.visible) {\r\n          this.options.messages.map((message) => {\r\n            this.showMessage(message);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private showMessage(message: Message) {\r\n    if (!this.messageService) {\r\n      return;\r\n    }\r\n    message.title = message.title;\r\n    message.text = message.text;\r\n    this.messageService.message(message as Message);\r\n  }\r\n\r\n  private observeResolution() {\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\r\n      this.updateInResolutionsRange()\r\n    );\r\n  }\r\n\r\n  private unobserveResolution() {\r\n    if (this.resolution$$ !== undefined) {\r\n      this.resolution$$.unsubscribe();\r\n      this.resolution$$ = undefined;\r\n    }\r\n  }\r\n\r\n  private updateInResolutionsRange() {\r\n    if (this.map !== undefined) {\r\n      const resolution = this.map.viewController.getResolution();\r\n      const minResolution = this.minResolution;\r\n      const maxResolution =\r\n        this.maxResolution === undefined ? Infinity : this.maxResolution;\r\n      this.isInResolutionsRange =\r\n        resolution >= minResolution && resolution <= maxResolution;\r\n    } else {\r\n      this.isInResolutionsRange = false;\r\n    }\r\n  }\r\n}\r\n","import olLayer from 'ol/layer/Layer';\r\nimport olSource from 'ol/source/Source';\r\nimport { Message } from '@igo2/core';\r\n\r\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\r\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\r\nimport { MapExtent } from '../../../map/shared/map.interface';\r\nimport { LegendOptions } from './legend.interface';\r\n\r\nexport interface LayerOptions {\r\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\r\n  source?: DataSource;\r\n  sourceOptions?: AnyDataSourceOptions;\r\n  title?: string;\r\n  id?: string;\r\n  alias?: string;\r\n  security?: LayerSecurityOptions;\r\n  baseLayer?: boolean;\r\n  opacity?: number;\r\n  visible?: boolean;\r\n  extent?: MapExtent;\r\n  zIndex?: number;\r\n  messages?: Message[];\r\n  minResolution?: number;\r\n  maxResolution?: number;\r\n  minScaleDenom?: number;\r\n  maxScaleDenom?: number;\r\n  showInLayerList?: boolean;\r\n  removable?: boolean;\r\n  workspace?: GeoWorkspaceOptions;\r\n  legendOptions?: LegendOptions;\r\n  ol?: olLayer<olSource>;\r\n  tooltip?: TooltipContent;\r\n  _internal?: { [key: string]: string };\r\n  active?: boolean;\r\n  check?: boolean;\r\n  linkedLayers?: LayersLink;\r\n  showButtonZoomToExtent?: boolean;\r\n}\r\n\r\nexport interface LayerSecurityOptions {\r\n  profils?: string[];\r\n}\r\n\r\nexport interface GeoWorkspaceOptions {\r\n  srcId?: string;\r\n  workspaceId?: string;\r\n  minResolution?: number;\r\n  maxResolution?: number;\r\n  enabled?: boolean;\r\n  queryOptions?: GeoWorkspaceQueryOptions;\r\n  pageSize?: number;\r\n  pageSizeOptions?: number[];\r\n  searchIndexEnabled?: boolean;\r\n  printable?: boolean;\r\n}\r\n\r\nexport interface GeoWorkspaceQueryOptions {\r\n  mapQueryOnOpenTab?: boolean;\r\n  tabQuery?: boolean;\r\n}\r\n\r\nexport interface LayersLink {\r\n  linkId: string;\r\n  links?: LayersLinkProperties[];\r\n}\r\nexport interface LayersLinkProperties {\r\n  linkedIds: string[];\r\n  syncedDelete: boolean;\r\n  properties: LinkedProperties[];\r\n}\r\n\r\nexport enum LinkedProperties {\r\n  OPACITY = 'opacity',\r\n  VISIBLE = 'visible',\r\n  OGCFILTERS = 'ogcFilters',\r\n  MINRESOLUTION = 'minResolution',\r\n  MAXRESOLUTION = 'maxResolution',\r\n  ZINDEX = 'zIndex',\r\n  TIMEFILTER = 'timeFilter'\r\n}\r\n\r\nexport interface GroupLayers {\r\n  title: string;\r\n  layers?: LayerOptions;\r\n  collapsed?: boolean;\r\n}\r\n\r\nexport interface TooltipContent {\r\n  type?: TooltipType;\r\n  text?: string;\r\n}\r\nexport enum TooltipType {\r\n  TITLE = 'title',\r\n  ABSTRACT = 'abstract',\r\n  CUSTOM = 'custom'\r\n}\r\n","import olSourceImage from 'ol/source/Image';\r\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\r\nimport { MessageService } from '@igo2/core';\r\nimport { ImageLayer } from '../shared/layers/image-layer';\r\n\r\nexport class ImageWatcher extends Watcher {\r\n  protected id: string;\r\n  protected loaded = 0;\r\n  protected loading = 0;\r\n\r\n  private source: olSourceImage;\r\n\r\n  private messageService: MessageService;\r\n\r\n  constructor(layer: ImageLayer, messageService: MessageService) {\r\n    super();\r\n    this.source = layer.options.source.ol;\r\n    this.id = uuid();\r\n    this.messageService = messageService;\r\n  }\r\n\r\n  protected watch() {\r\n    this.source.on(`imageloadstart`, (e) => this.handleLoadStart(e));\r\n    this.source.on(`imageloadend`, (e) => this.handleLoadEnd(e));\r\n    this.source.on(`imageloaderror`, (e) => this.handleLoadEnd(e));\r\n    this.source.on(`imageloaderror`, (e) => this.handleLoadError(e));\r\n  }\r\n\r\n  protected unwatch() {\r\n    this.source.un(`imageloadstart`, (e) => this.handleLoadStart(e));\r\n    this.source.un(`imageloadend`, (e) => this.handleLoadEnd(e));\r\n    this.source.un(`imageloaderror`, (e) => this.handleLoadEnd(e));\r\n    this.source.un(`imageloaderror`, (e) => this.handleLoadError(e));\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    if (!event.image.__watchers__) {\r\n      event.image.__watchers__ = [];\r\n    }\r\n    event.image.__watchers__.push(this.id);\r\n\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event) {\r\n    if (!event.image.__watchers__) {\r\n      return;\r\n    }\r\n\r\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\r\n    if (watcherIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    event.image.__watchers__.splice(watcherIndex, 1);\r\n\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleLoadError(event) {\r\n    if (!event.image.__watchers__) {\r\n      return;\r\n    }\r\n    this.messageService.error(\r\n      'igo.geo.dataSource.unavailable',\r\n      'igo.geo.dataSource.unavailableTitle',\r\n      undefined,\r\n      { value: event.target.params_.LAYERS }\r\n    );\r\n    this.loaded = -1;\r\n    this.loading = 0;\r\n    this.status = SubjectStatus.Error;\r\n  }\r\n}\r\n","import olSourceTile from 'ol/source/Tile';\r\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\r\n\r\nimport { TileLayer } from '../shared/layers/tile-layer';\r\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\r\n\r\nexport class TileWatcher extends Watcher {\r\n  private id: string;\r\n  private loaded = 0;\r\n  private loading = 0;\r\n\r\n  private source: olSourceTile;\r\n\r\n  constructor(layer: TileLayer | VectorTileLayer) {\r\n    super();\r\n    this.source = layer.options.source.ol;\r\n    this.id = uuid();\r\n  }\r\n\r\n  protected watch() {\r\n    this.source.on(`tileloadstart`, (e) => this.handleLoadStart(e));\r\n    this.source.on(`tileloadend`, (e) => this.handleLoadEnd(e));\r\n    this.source.on(`tileloaderror`, (e) => this.handleLoadEnd(e));\r\n  }\r\n\r\n  protected unwatch() {\r\n    this.source.un(`tileloadstart`, (e) => this.handleLoadStart(e));\r\n    this.source.un(`tileloadend`, (e) => this.handleLoadEnd(e));\r\n    this.source.un(`tileloaderror`, (e) => this.handleLoadEnd(e));\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    // This is to avoid increasing\r\n    // the number of loaded tiles if a tile was loading\r\n    // before subscribing to this watcher\r\n    if (!event.tile.__watchers__) {\r\n      event.tile.__watchers__ = [];\r\n    }\r\n    event.tile.__watchers__.push(this.id);\r\n\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event) {\r\n    if (!event.tile.__watchers__) {\r\n      return;\r\n    }\r\n\r\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\r\n    if (watcherIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    event.tile.__watchers__.splice(watcherIndex, 1);\r\n\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { uuid, Watcher, SubjectStatus } from '@igo2/utils';\r\n\r\nimport { VectorLayer } from '../shared/layers/vector-layer';\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\n\r\nexport class VectorWatcher extends Watcher {\r\n  private id: string;\r\n  private loaded = 0;\r\n  private loading = 0;\r\n\r\n  private layer: VectorLayer;\r\n\r\n  constructor(layer: VectorLayer) {\r\n    super();\r\n    this.layer = layer;\r\n    this.id = uuid();\r\n  }\r\n\r\n  protected watch() {\r\n    let olSource = this.layer.options.source.ol;\r\n    if (this.layer.dataSource instanceof ClusterDataSource) {\r\n      olSource = (this.layer.options.source.options as any).source;\r\n    }\r\n\r\n    if (olSource.getUrl()) {\r\n      olSource.on(`featuresloadstart`, (e) => this.handleLoadStart(e));\r\n      olSource.on(`featuresloadend`, (e) => this.handleLoadEnd(e));\r\n      olSource.on(`featuresloaderror`, (e) => this.handleLoadEnd(e));\r\n    }\r\n  }\r\n\r\n  protected unwatch() {\r\n    let olSource = this.layer.options.source.ol;\r\n    if (this.layer.dataSource instanceof ClusterDataSource) {\r\n      olSource = (this.layer.options.source.options as any).source;\r\n    }\r\n    if (olSource.getUrl()) {\r\n      olSource.un(`featuresloadstart`, (e) => this.handleLoadStart(e));\r\n      olSource.un(`featuresloadend`, (e) => this.handleLoadEnd(e));\r\n      olSource.un(`featuresloaderror`, (e) => this.handleLoadEnd(e));\r\n    }\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event: any) {\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import olLayerImage from 'ol/layer/Image';\r\nimport olSourceImage from 'ol/source/Image';\r\n\r\nimport { AuthInterceptor } from '@igo2/auth';\r\n\r\nimport { ImageWatcher } from '../../utils';\r\nimport { IgoMap } from '../../../map/shared';\r\n\r\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\r\n\r\nimport { Layer } from './layer';\r\nimport { ImageLayerOptions } from './image-layer.interface';\r\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\r\nimport { MessageService } from '@igo2/core';\r\n\r\nexport class ImageLayer extends Layer {\r\n  public declare dataSource: WMSDataSource | ImageArcGISRestDataSource;\r\n  public declare options: ImageLayerOptions;\r\n  public declare ol: olLayerImage<olSourceImage>;\r\n\r\n  private watcher: ImageWatcher;\r\n\r\n  constructor(\r\n    options: ImageLayerOptions,\r\n    public messageService: MessageService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(options, messageService, authInterceptor);\r\n    this.watcher = new ImageWatcher(this, this.messageService);\r\n    this.status$ = this.watcher.status$;\r\n    this.status$.subscribe((valStatus) => {\r\n      if (valStatus === 0) {\r\n        this.olLoadingProblem = true;\r\n      }\r\n    });\r\n  }\r\n\r\n  protected createOlLayer(): olLayerImage<olSourceImage> {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceImage\r\n    });\r\n\r\n    const image = new olLayerImage(olOptions);\r\n    if (this.authInterceptor) {\r\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\r\n        this.customLoader(tile, src, this.authInterceptor, this.messageService);\r\n      });\r\n    }\r\n\r\n    return image;\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n\r\n  private customLoader(\r\n    tile,\r\n    src: string,\r\n    interceptor: AuthInterceptor,\r\n    messageService: MessageService\r\n  ) {\r\n    const xhr = new XMLHttpRequest();\r\n\r\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\r\n    let url = src;\r\n    if (alteredUrlWithKeyAuth) {\r\n      url = alteredUrlWithKeyAuth;\r\n    }\r\n    xhr.open('GET', url);\r\n    const intercepted = interceptor.interceptXhr(xhr, url);\r\n    if (!intercepted) {\r\n      xhr.abort();\r\n      tile.getImage().src = url;\r\n      return;\r\n    }\r\n\r\n    xhr.responseType = 'arraybuffer';\r\n\r\n    xhr.onload = function () {\r\n      const arrayBufferView = new Uint8Array((this as any).response);\r\n      const responseString = new TextDecoder().decode(arrayBufferView);\r\n      if (responseString.includes('ServiceExceptionReport')) {\r\n        messageService.error(\r\n          'igo.geo.dataSource.optionsApiUnavailable',\r\n          'igo.geo.dataSource.unavailableTitle'\r\n        );\r\n      }\r\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\r\n      const urlCreator = window.URL;\r\n      const imageUrl = urlCreator.createObjectURL(blob);\r\n      tile.getImage().src = imageUrl;\r\n    };\r\n    xhr.send();\r\n  }\r\n}\r\n","import olLayerTile from 'ol/layer/Tile';\r\nimport olSourceTile from 'ol/source/Tile';\r\nimport Tile from 'ol/Tile';\r\n\r\nimport { TileWatcher } from '../../utils';\r\nimport { IgoMap } from '../../../map/shared';\r\n\r\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\r\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\r\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\r\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\r\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\r\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\r\n\r\nimport { Layer } from './layer';\r\nimport { TileLayerOptions } from './tile-layer.interface';\r\n\r\nimport { MessageService } from '@igo2/core';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nexport class TileLayer extends Layer {\r\n  public declare dataSource:\r\n    | OSMDataSource\r\n    | WMTSDataSource\r\n    | XYZDataSource\r\n    | TileDebugDataSource\r\n    | CartoDataSource\r\n    | TileArcGISRestDataSource;\r\n  public declare options: TileLayerOptions;\r\n  public declare ol: olLayerTile<olSourceTile>;\r\n\r\n  private watcher: TileWatcher;\r\n\r\n  constructor(\r\n    options: TileLayerOptions,\r\n    public messageService?: MessageService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(options, messageService);\r\n\r\n    this.watcher = new TileWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerTile<olSourceTile> {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol\r\n    });\r\n    const tileLayer = new olLayerTile(olOptions);\r\n    const tileSource = tileLayer.getSource();\r\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\r\n      this.customLoader(tile, url, this.authInterceptor);\r\n    });\r\n\r\n    return tileLayer;\r\n  }\r\n\r\n  /**\r\n   * Custom loader for tile layer.\r\n   * @internal\r\n   * @param tile the current tile\r\n   * @param url the url string or function to retrieve the data\r\n   */\r\n  customLoader(tile, url: string, interceptor: AuthInterceptor) {\r\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\r\n    let modifiedUrl = url;\r\n    if (alteredUrlWithKeyAuth) {\r\n      modifiedUrl = alteredUrlWithKeyAuth;\r\n    }\r\n    tile.getImage().src = modifiedUrl;\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n}\r\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import * as olextent from 'ol/extent';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olstyle from 'ol/style';\r\nimport OlFeature from 'ol/Feature';\r\nimport type { GeometryLayout } from 'ol/geom/Geometry';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlRenderFeature from 'ol/render/Feature';\r\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport OlLayer from 'ol/layer/Layer';\r\nimport OlSource from 'ol/source/Source';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport {\r\n  EntityKey,\r\n  getEntityId,\r\n  getEntityTitle,\r\n  getEntityRevision,\r\n  getEntityIcon,\r\n  getEntityProperty\r\n} from '@igo2/common';\r\n\r\nimport { MapExtent, MapViewController } from '../../map/shared';\r\nimport { FEATURE, FeatureMotion } from './feature.enums';\r\nimport { Feature, FeatureGeometry } from './feature.interfaces';\r\n\r\n/**\r\n * Create an Openlayers feature object out of a feature definition.\r\n * The output object has a reference to the feature id.\r\n * @param feature Feature definition\r\n * @param projectionOut Feature object projection\r\n * @returns OpenLayers feature object\r\n */\r\nexport function featureToOl(\r\n  feature: Feature,\r\n  projectionOut: string,\r\n  getId?: (Feature) => EntityKey\r\n): OlFeature<OlGeometry> {\r\n  getId = getId ? getId : getEntityId;\r\n\r\n  const olFormat = new OlFormatGeoJSON();\r\n  const olFeature = olFormat.readFeature(feature, {\r\n    dataProjection: feature.projection,\r\n    featureProjection: projectionOut\r\n  });\r\n\r\n  olFeature.setId(getId(feature));\r\n\r\n  const title = getEntityTitle(feature);\r\n  if (title !== undefined) {\r\n    olFeature.set('_title', title, true);\r\n  }\r\n\r\n  if (feature.extent !== undefined) {\r\n    olFeature.set('_extent', feature.extent, true);\r\n  }\r\n\r\n  if (feature.projection !== undefined) {\r\n    olFeature.set('_projection', feature.projection, true);\r\n  }\r\n\r\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\r\n  if (mapTitle !== undefined) {\r\n    olFeature.set('_mapTitle', mapTitle, true);\r\n  }\r\n\r\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\r\n\r\n  const icon = getEntityIcon(feature);\r\n  if (icon !== undefined) {\r\n    olFeature.set('_icon', icon, true);\r\n  }\r\n\r\n  if (feature.meta && feature.meta.style) {\r\n    olFeature.set('_style', feature.meta.style, true);\r\n  }\r\n\r\n  if (feature.sourceId) {\r\n    olFeature.set('_sourceId', feature.sourceId, true);\r\n  }\r\n\r\n  return olFeature;\r\n}\r\n\r\nexport function renderFeatureFromOl(\r\n  olRenderFeature: OlRenderFeature,\r\n  projectionIn: string,\r\n  olLayer?: OlLayer<OlSource>,\r\n  projectionOut = 'EPSG:4326'\r\n): Feature {\r\n  let geom;\r\n  let title;\r\n  let exclude;\r\n  let excludeOffline;\r\n\r\n  if (olLayer) {\r\n    title = olLayer.get('title');\r\n    if (olLayer.get('sourceOptions')) {\r\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\r\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\r\n    }\r\n  } else {\r\n    title = olRenderFeature.get('_title');\r\n  }\r\n\r\n  const olFormat = new OlFormatGeoJSON();\r\n  const properties = olRenderFeature.getProperties();\r\n  const geometryType = olRenderFeature.getType();\r\n\r\n  if (geometryType === 'Polygon') {\r\n    const ends = olRenderFeature.getEnds() as number[];\r\n    geom = new OlPolygon(\r\n      olRenderFeature.getFlatCoordinates(),\r\n      'XY' as GeometryLayout,\r\n      ends\r\n    );\r\n  } else if (geometryType === 'Point') {\r\n    geom = new OlPoint(\r\n      olRenderFeature.getFlatCoordinates(),\r\n      'XY' as GeometryLayout\r\n    );\r\n  } else if (geometryType === 'LineString') {\r\n    geom = new OlLineString(\r\n      olRenderFeature.getFlatCoordinates(),\r\n      'XY' as GeometryLayout\r\n    );\r\n  }\r\n\r\n  const geometry = olFormat.writeGeometryObject(geom, {\r\n    dataProjection: projectionOut,\r\n    featureProjection: projectionIn\r\n  }) as FeatureGeometry;\r\n\r\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\r\n  const mapTitle = olRenderFeature.get('_mapTitle');\r\n  const extent = olproj.transformExtent(\r\n    olRenderFeature.getExtent(),\r\n    projectionIn,\r\n    projectionOut\r\n  ) as [number, number, number, number];\r\n  return {\r\n    type: FEATURE,\r\n    projection: projectionOut,\r\n    extent,\r\n    meta: {\r\n      id,\r\n      title: title ? title : mapTitle ? mapTitle : id,\r\n      mapTitle,\r\n      excludeAttribute: exclude,\r\n      excludeAttributeOffline: excludeOffline\r\n    },\r\n    properties,\r\n    geometry,\r\n    ol: olRenderFeature\r\n  };\r\n}\r\n/**\r\n * Create a feature object out of an OL feature\r\n * The output object has a reference to the feature id.\r\n * @param olFeature OL Feature\r\n * @param projectionIn OL feature projection\r\n * @param olLayer OL Layer\r\n * @param projectionOut Feature projection\r\n * @returns Feature\r\n */\r\nexport function featureFromOl(\r\n  olFeature: OlFeature<OlGeometry>,\r\n  projectionIn: string,\r\n  olLayer?: OlLayer<OlSource>,\r\n  projectionOut = 'EPSG:4326'\r\n): Feature {\r\n  let title;\r\n  let exclude;\r\n  let excludeOffline;\r\n  let idColumn; // for arcgisrest and tilearcgisrest source\r\n  const olFormat = new OlFormatGeoJSON();\r\n\r\n  const keys = olFeature.getKeys().filter((key: string) => {\r\n    return !key.startsWith('_') && key !== 'geometry';\r\n  });\r\n  const properties = keys.reduce((acc: object, key: string) => {\r\n    acc[key] = olFeature.get(key);\r\n    return acc;\r\n  }, {});\r\n\r\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\r\n    dataProjection: projectionOut,\r\n    featureProjection: projectionIn\r\n  }) as FeatureGeometry;\r\n\r\n  if (olLayer) {\r\n    title = olLayer.get('title');\r\n    const sourceOptions = olLayer.get('sourceOptions');\r\n    if (sourceOptions) {\r\n      exclude = sourceOptions.excludeAttribute;\r\n      excludeOffline = sourceOptions.excludeAttributeOffline;\r\n      idColumn =\r\n        sourceOptions.idColumn ||\r\n        (sourceOptions.type === 'arcgisrest' ||\r\n        sourceOptions.type === 'tilearcgisrest'\r\n          ? 'OBJECTID'\r\n          : undefined);\r\n    }\r\n  } else {\r\n    title = olFeature.get('_title');\r\n  }\r\n  const mapTitle = olFeature.get('_mapTitle');\r\n  const id = olFeature.getId()\r\n    ? olFeature.getId()\r\n    : olFeature.get(idColumn)\r\n    ? olFeature.get(idColumn)\r\n    : uuid();\r\n  const newFeature = olFeature.get('_newFeature');\r\n\r\n  return {\r\n    type: FEATURE,\r\n    projection: projectionOut,\r\n    extent: olFeature.get('_extent'),\r\n    meta: {\r\n      id,\r\n      title: title ? title : mapTitle ? mapTitle : id,\r\n      mapTitle,\r\n      revision: olFeature.getRevision(),\r\n      style: olFeature.get('_style'),\r\n      excludeAttribute: exclude,\r\n      excludeAttributeOffline: excludeOffline\r\n    },\r\n    properties,\r\n    geometry,\r\n    ol: olFeature\r\n  };\r\n}\r\n\r\n/**\r\n * Compute an OL feature extent in it's map projection\r\n * @param map Map\r\n * @param olFeature OL feature\r\n * @returns Extent in the map projection\r\n */\r\nexport function computeOlFeatureExtent(\r\n  olFeature: OlFeature<OlGeometry>,\r\n  projection: olproj.Projection\r\n): [number, number, number, number] {\r\n  let olExtent = olextent.createEmpty();\r\n\r\n  const olFeatureExtent = olFeature.get('_extent');\r\n  const olFeatureProjection = olFeature.get('_projection');\r\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\r\n    olExtent = olproj.transformExtent(\r\n      olFeatureExtent,\r\n      olFeatureProjection,\r\n      projection\r\n    );\r\n  } else {\r\n    const olGeometry = olFeature.getGeometry();\r\n    if (olGeometry !== null) {\r\n      olExtent = olGeometry.getExtent();\r\n    }\r\n  }\r\n\r\n  return olExtent as [number, number, number, number];\r\n}\r\n\r\n/**\r\n * Compute a multiple OL features extent in their map projection\r\n * @param map Map\r\n * @param olFeatures OL features\r\n * @returns Extent in the map projection\r\n */\r\nexport function computeOlFeaturesExtent(\r\n  olFeatures: OlFeature<OlGeometry>[],\r\n  projection: olproj.Projection\r\n): [number, number, number, number] {\r\n  const extent = olextent.createEmpty();\r\n\r\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n    const featureExtent = computeOlFeatureExtent(olFeature, projection);\r\n    olextent.extend(extent, featureExtent);\r\n  });\r\n\r\n  return extent as [number, number, number, number];\r\n}\r\n\r\n/**\r\n * Scale an extent.\r\n * @param extent Extent\r\n * @param Scaling factors for top, right, bottom and left directions, in that order\r\n * @returns Scaled extent\r\n */\r\nexport function scaleExtent(\r\n  extent: [number, number, number, number],\r\n  scale: [number, number, number, number]\r\n): [number, number, number, number] {\r\n  const [width, height] = olextent.getSize(extent);\r\n  return [\r\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\r\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\r\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\r\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\r\n  ];\r\n}\r\n\r\n/**\r\n * Return true if features are out of view.\r\n * If features are too close to the edge, they are considered out of view.\r\n * By default, we define the edge as 5% (0.05) of the extent size.\r\n * @param map Map\r\n * @param featuresExtent The features's extent\r\n * @param edgeRatio Number or Number[] Single value OR an array =>\r\n *  [top,right,bottom,left] directions, in that order\r\n * @returns Return true if features are out of view\r\n */\r\nexport function featuresAreOutOfView(\r\n  extent: MapExtent,\r\n  featuresExtent: [number, number, number, number],\r\n  edgeRatio: number | number[] = 0.05\r\n) {\r\n  const edgesRatio = Array.isArray(edgeRatio)\r\n    ? edgeRatio\r\n    : [edgeRatio, edgeRatio, edgeRatio, edgeRatio];\r\n  const scale = [-1, -1, -1, -1].map((x, i) => x * edgesRatio[i]);\r\n  const viewExtent = scaleExtent(\r\n    extent,\r\n    scale as [number, number, number, number]\r\n  );\r\n\r\n  return !olextent.containsExtent(viewExtent, featuresExtent);\r\n}\r\n\r\n/**\r\n * Return true if features are too deep into the view. This results\r\n * in features being too small.\r\n * Features are considered too small if their extent occupies less than\r\n * 1% of the map extent.\r\n * @param map Map\r\n * @param featuresExtent The features's extent\r\n * @param areaRatio The features extent to view extent acceptable ratio\r\n * @returns Return true if features are too deep in the view\r\n */\r\nexport function featuresAreTooDeepInView(\r\n  viewController: MapViewController,\r\n  featuresExtent: [number, number, number, number],\r\n  areaRatio?: number\r\n) {\r\n  // An area ratio of 0.004 means that the feature extent's width and height\r\n  // should be about 1/16 of the map extent's width and height\r\n  areaRatio = areaRatio ? areaRatio : 0.004;\r\n  const mapExtent = viewController.getExtent();\r\n  const mapExtentArea = olextent.getArea(mapExtent);\r\n  const featuresExtentArea = olextent.getArea(featuresExtent);\r\n\r\n  if (featuresExtentArea === 0 && viewController.getZoom() > 13) {\r\n    // In case it's a point\r\n    return false;\r\n  }\r\n\r\n  return featuresExtentArea / mapExtentArea < areaRatio;\r\n}\r\n\r\n/**\r\n * Fit view to include the features extent.\r\n * By default, this method will let the features occupy about 50% of the viewport.\r\n * @param map Map\r\n * @param olFeatures OL features\r\n * @param motion To motion to the new map view\r\n * @param scale If this is defined, the original view will be scaled\r\n *  by that factor before any logic is applied.\r\n */\r\nexport function moveToOlFeatures(\r\n  viewController: MapViewController,\r\n  olFeatures: OlFeature<OlGeometry>[],\r\n  motion: FeatureMotion = FeatureMotion.Default,\r\n  scale?: [number, number, number, number],\r\n  areaRatio?: number\r\n) {\r\n  const extent = viewController.getExtent();\r\n  const projection = viewController.getOlProjection();\r\n  const featuresExtent = computeOlFeaturesExtent(olFeatures, projection);\r\n  let viewExtent = featuresExtent;\r\n  if (scale !== undefined) {\r\n    viewExtent = scaleExtent(viewExtent, scale);\r\n  }\r\n\r\n  if (motion === FeatureMotion.Zoom) {\r\n    viewController.zoomToExtent(viewExtent);\r\n  } else if (motion === FeatureMotion.Move) {\r\n    viewController.moveToExtent(viewExtent);\r\n  } else if (motion === FeatureMotion.Default) {\r\n    if (\r\n      featuresAreOutOfView(extent, featuresExtent) ||\r\n      featuresAreTooDeepInView(viewController, featuresExtent, areaRatio)\r\n    ) {\r\n      viewController.zoomToExtent(viewExtent);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Hide an OL feature\r\n * @param olFeature OL feature\r\n */\r\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\r\n  olFeature.setStyle(new olstyle.Style({}));\r\n}\r\n\r\n/**\r\n * Compute a diff between a source array of Ol features and a target array\r\n * @param source Source array of OL features\r\n * @param starget Target array of OL features\r\n * @returns Features to add and remove\r\n */\r\nexport function computeOlFeaturesDiff(\r\n  source: OlFeature<OlGeometry>[],\r\n  target: OlFeature<OlGeometry>[]\r\n): {\r\n  add: OlFeature<OlGeometry>[];\r\n  remove: OlFeature<OlGeometry>[];\r\n} {\r\n  const olFeaturesMap = new Map();\r\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n    olFeaturesMap.set(olFeature.getId(), olFeature);\r\n  });\r\n\r\n  const olFeaturesToRemove = [];\r\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\r\n    if (newOlFeature === undefined) {\r\n      olFeaturesToRemove.push(olFeature);\r\n    } else if (\r\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\r\n    ) {\r\n      olFeaturesToRemove.push(olFeature);\r\n    } else {\r\n      olFeaturesMap.delete(newOlFeature.getId());\r\n    }\r\n  });\r\n\r\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\r\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\r\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\r\n  });\r\n\r\n  return {\r\n    add: olFeaturesToAdd,\r\n    remove: olFeaturesToRemove\r\n  };\r\n}\r\n","import { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureStore } from './store';\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n","import OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olextent from 'ol/extent';\r\n\r\nimport { Document } from 'flexsearch';\r\n\r\nimport { getEntityId, EntityKey, EntityStoreWithStrategy } from '@igo2/common';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { IgoMap, MapExtent } from '../../map/shared';\r\n\r\nimport { FeatureMotion } from './feature.enums';\r\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\r\nimport {\r\n  computeOlFeaturesDiff,\r\n  featureFromOl,\r\n  featureToOl,\r\n  moveToOlFeatures,\r\n  computeOlFeaturesExtent\r\n} from './feature.utils';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * features and the map layer to display them on. Synchronization\r\n * between the store and the layer is handled by strategies.\r\n */\r\nexport class FeatureStore<\r\n  T extends Feature = Feature\r\n> extends EntityStoreWithStrategy<T> {\r\n  /**\r\n   * Vector layer to display the features on\r\n   */\r\n  layer: VectorLayer;\r\n\r\n  /**\r\n   * The map the layer is bound to\r\n   */\r\n  readonly map: IgoMap;\r\n\r\n  /**\r\n   * The layer's data source\r\n   */\r\n  get source(): FeatureDataSource {\r\n    return this.layer\r\n      ? (this.layer.dataSource as FeatureDataSource)\r\n      : undefined;\r\n  }\r\n\r\n  /**\r\n   * The searchable index of loaded feature. Computed if strategy is provided\r\n   */\r\n  set searchDocument(v: Document<T>) {\r\n    this._searchDocument = v;\r\n  }\r\n\r\n  get searchDocument(): Document<T> {\r\n    return this._searchDocument;\r\n  }\r\n  private _searchDocument: Document<T>;\r\n\r\n  constructor(entities: T[], options: FeatureStoreOptions) {\r\n    super(entities, options);\r\n    this.map = options.map;\r\n  }\r\n\r\n  /**\r\n   * Bind this store to a vector layer\r\n   * @param layer Vector layer\r\n   * @returns Feature store\r\n   */\r\n  bindLayer(layer: VectorLayer): FeatureStore {\r\n    this.layer = layer;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set the layer's features and perform a motion to make them visible. Strategies\r\n   * make extensive use of that method.\r\n   * @param features Features\r\n   * @param motion Optional: The type of motion to perform\r\n   */\r\n  setLayerFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    viewScale?: [number, number, number, number],\r\n    areaRatio?: number,\r\n    getId?: (Feature) => EntityKey\r\n  ) {\r\n    getId = getId ? getId : getEntityId;\r\n    this.checkLayer();\r\n\r\n    const olFeatures = features.map((feature: Feature) =>\r\n      featureToOl(feature, this.map.projection, getId)\r\n    );\r\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\r\n  }\r\n\r\n  /**\r\n   * Set the store's features from an array of OL features.\r\n   * @param olFeatures Ol features\r\n   */\r\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\r\n    this.checkLayer();\r\n\r\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      olFeature.set('_featureStore', this, true);\r\n      return featureFromOl(olFeature, this.layer.map.projection);\r\n    });\r\n    this.load(features as T[]);\r\n  }\r\n\r\n  /**\r\n   * Remove all features from the layer\r\n   */\r\n  clearLayer() {\r\n    this.checkLayer();\r\n    this.source.ol.clear();\r\n  }\r\n\r\n  /**\r\n   * Check wether a layer is bound or not and throw an error if not.\r\n   */\r\n  private checkLayer() {\r\n    if (this.layer === undefined) {\r\n      throw new Error('This FeatureStore is not bound to a layer.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the layer's features and perform a motion to make them visible.\r\n   * @param features Openlayers feature objects\r\n   * @param motion Optional: The type of motion to perform\r\n   */\r\n  public setLayerOlFeatures(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    viewScale?: [number, number, number, number],\r\n    areaRatio?: number\r\n  ) {\r\n    const olSource = this.layer.ol.getSource();\r\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\r\n    if (diff.remove.length > 0) {\r\n      this.removeOlFeaturesFromLayer(diff.remove);\r\n    }\r\n\r\n    if (diff.add.length > 0) {\r\n      this.addOlFeaturesToLayer(diff.add);\r\n    }\r\n\r\n    if (diff.add.length > 0) {\r\n      // If features are added, do a motion toward the newly added features\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        diff.add,\r\n        motion,\r\n        viewScale,\r\n        areaRatio\r\n      );\r\n    } else if (diff.remove.length > 0) {\r\n      // Else, do a motion toward all the features\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        olFeatures,\r\n        motion,\r\n        viewScale,\r\n        areaRatio\r\n      );\r\n    }\r\n  }\r\n\r\n  setLayerExtent(): void {\r\n    let features = this.entities$.getValue();\r\n    let extent = olextent.createEmpty() as MapExtent;\r\n    let olFeatures = [];\r\n\r\n    features.forEach((feature) => {\r\n      olFeatures.push(featureToOl(feature, this.map.projection));\r\n    });\r\n    const featuresExtent = computeOlFeaturesExtent(\r\n      olFeatures,\r\n      this.map.viewProjection\r\n    );\r\n    olextent.extend(extent, featuresExtent);\r\n    this.layer.setExtent(extent);\r\n  }\r\n  /**\r\n   * Add features to the the layer\r\n   * @param features Openlayers feature objects\r\n   */\r\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\r\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n      olFeature.set('_featureStore', this, true);\r\n    });\r\n    this.source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  /**\r\n   * Remove features from the the layer\r\n   * @param features Openlayers feature objects\r\n   */\r\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\r\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n      this.source.ol.removeFeature(olFeature);\r\n    });\r\n  }\r\n}\r\n","import * as olextent from 'ol/extent';\r\n\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureStoreInMapExtentStrategyOptions } from '../feature.interfaces';\r\nimport { Subscription } from 'rxjs';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\n/**\r\n * This strategy maintain the store features updated while the map is moved.\r\n * The features's state inside the map are tagged inMapExtent = true;\r\n */\r\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n  private states$$: Subscription[] = [];\r\n  private empty$$: Subscription;\r\n\r\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n    this.empty$$ = store.empty$\r\n      .pipe(skipWhile((empty) => !empty))\r\n      .subscribe(() => this.updateEntitiesInExtent(store));\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.updateEntitiesInExtent(store);\r\n    this.states$$.push(\r\n      store.layer.map.viewController.state$.subscribe(() => {\r\n        this.updateEntitiesInExtent(store);\r\n      })\r\n    );\r\n  }\r\n\r\n  private updateEntitiesInExtent(store) {\r\n    if (store?.layer?.map?.viewController) {\r\n      store.state.updateAll({ inMapExtent: false });\r\n      const mapExtent = store.layer.map.viewController.getExtent();\r\n      let entitiesInMapExtent = [];\r\n      let entitiesWithNoGeom = [];\r\n      for (const entity of store.entities$.value) {\r\n        if (entity.ol) {\r\n          if (\r\n            olextent.intersects(entity.ol.getGeometry().getExtent(), mapExtent)\r\n          ) {\r\n            entitiesInMapExtent.push(entity);\r\n          }\r\n        } else {\r\n          entitiesWithNoGeom.push(entity);\r\n        }\r\n      }\r\n      if (entitiesInMapExtent.length > 0) {\r\n        store.state.updateMany(\r\n          entitiesInMapExtent,\r\n          { inMapExtent: true },\r\n          false\r\n        );\r\n      }\r\n      if (entitiesWithNoGeom.length > 0) {\r\n        store.state.updateMany(\r\n          entitiesWithNoGeom,\r\n          { inMapExtent: true },\r\n          false\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    this.stores$$.clear();\r\n    this.states$$.map((state) => state.unsubscribe());\r\n    if (this.empty$$) {\r\n      this.empty$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\r\nimport { Subscription } from 'rxjs';\r\n\r\n/**\r\n * This strategy maintain the store features updated while the map is scrolled.\r\n * The features's state inside the map's resolution are tagged inMapResolution = true;\r\n */\r\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n  private resolution$$: Subscription[] = [];\r\n  private empty$$: Subscription;\r\n\r\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n    this.empty$$ = store.empty$.subscribe(() =>\r\n      this.updateEntitiesInResolution(\r\n        store,\r\n        store.layer.map.viewController.getResolution()\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.updateEntitiesInResolution(\r\n      store,\r\n      store.layer.map.viewController.getResolution()\r\n    );\r\n    this.resolution$$.push(\r\n      store.layer.map.viewController.resolution$.subscribe((res) => {\r\n        this.updateEntitiesInResolution(store, res);\r\n      })\r\n    );\r\n  }\r\n\r\n  private updateEntitiesInResolution(store, mapResolution: number) {\r\n    if (\r\n      mapResolution > store.layer.minResolution &&\r\n      mapResolution < store.layer.maxResolution\r\n    ) {\r\n      store.state.updateAll({ inMapResolution: true });\r\n    } else {\r\n      store.state.updateAll({ inMapResolution: false });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    this.stores$$.clear();\r\n    this.resolution$$.map((state) => state.unsubscribe());\r\n    if (this.empty$$) {\r\n      this.empty$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { EntityStoreStrategy } from '@igo2/common';\r\nimport { CapabilitiesService } from '../../../datasource/shared/capabilities.service';\r\nimport { FeatureStore } from '../store';\r\nimport {\r\n  Feature,\r\n  FeatureStorePropertyTypeStrategyOptions\r\n} from '../feature.interfaces';\r\nimport { Subscription, debounceTime, pairwise } from 'rxjs';\r\nimport { PropertyTypeDetectorService } from '../../../utils/propertyTypeDetector/propertyTypeDetector.service';\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\r\nimport { IgoMap } from '../../../map/shared/map';\r\nimport { Layer } from '../../../layer/shared/layers/layer';\r\nimport { GeoServiceDefinition } from '../../../utils';\r\n\r\n/**\r\n * This strategy maintain the store features updated to detect geoproperties\r\n * (wms/arcgis... layer and url).\r\n * The features's state inside the map are tagged haveGeoServiceProperties = true;\r\n */\r\nexport class GeoPropertiesStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n  private states$$: Subscription[] = [];\r\n  private empty$$: Subscription;\r\n\r\n  /**\r\n   * The map the layer is bound to\r\n   */\r\n  private readonly map: IgoMap;\r\n\r\n  constructor(\r\n    protected options: FeatureStorePropertyTypeStrategyOptions,\r\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {\r\n    super(options);\r\n    this.map = options.map;\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.updateEntitiesPropertiesState(store);\r\n    this.states$$.push(\r\n      this.map.layers$\r\n        .pipe(debounceTime(750), pairwise())\r\n        .subscribe(([prevLayers, currentLayers]) => {\r\n          let prevLayersId;\r\n          if (prevLayers) {\r\n            prevLayersId = prevLayers.map((l) => l.id);\r\n          }\r\n          const layers = currentLayers.filter(\r\n            (l) => !prevLayersId.includes(l.id)\r\n          );\r\n          this.updateEntitiesPropertiesState(store, layers);\r\n        })\r\n    );\r\n    this.states$$.push(\r\n      store.entities$.pipe(debounceTime(750)).subscribe((a) => {\r\n        this.updateEntitiesPropertiesState(store);\r\n      })\r\n    );\r\n  }\r\n\r\n  private updateEntitiesPropertiesState(store: FeatureStore, layers?: Layer[]) {\r\n    const layersId = this.map.layers.map((l) => l.id);\r\n    let entities: Feature[] = [];\r\n    if (layers) {\r\n      entities = store.entities$.value;\r\n    } else {\r\n      const allSV = store.stateView.all();\r\n      entities = allSV.length\r\n        ? store.stateView\r\n            .all()\r\n            .filter((s) => !s.state.geoService)\r\n            .map((e) => e.entity)\r\n        : store.entities$.value;\r\n    }\r\n    const sampling = entities.length >= 250 ? 250 : entities.length;\r\n    const firstN = entities.slice(0, sampling);\r\n    let allKeys = [];\r\n    firstN.map((e) => {\r\n      allKeys = allKeys.concat(Object.keys(e.properties || {}));\r\n    });\r\n    allKeys = [...new Set(allKeys)];\r\n    const distinctValues = {};\r\n    allKeys.map((k) => {\r\n      distinctValues[k] = [\r\n        ...new Set(entities.map((item) => item.properties[k]))\r\n      ];\r\n    });\r\n    const containGeoServices = {};\r\n    Object.entries(distinctValues).forEach((entry: [string, []]) => {\r\n      const [key, values] = entry;\r\n      const valuedAreGeoservices = values.filter((value) =>\r\n        this.propertyTypeDetectorService.isGeoService(value)\r\n      );\r\n      if (valuedAreGeoservices?.length) {\r\n        containGeoServices[key] = valuedAreGeoservices;\r\n      }\r\n    });\r\n    interface GeoServiceAssociation {\r\n      url: string;\r\n      layerNameProperty: string;\r\n      urlProperty: string;\r\n      geoService: GeoServiceDefinition;\r\n    }\r\n    const geoServiceAssociations: GeoServiceAssociation[] = [];\r\n    Object.entries(containGeoServices).forEach((entry: [string, []]) => {\r\n      const [key, values] = entry;\r\n      values.map((value) => {\r\n        const geoService = this.propertyTypeDetectorService.getGeoService(\r\n          value,\r\n          allKeys\r\n        );\r\n        if (geoService) {\r\n          const propertiesForLayerName = allKeys.filter((p) =>\r\n            geoService.propertiesForLayerName.includes(p)\r\n          );\r\n          // providing the the first matching regex;\r\n          const propertyForLayerName = propertiesForLayerName.length\r\n            ? propertiesForLayerName[0]\r\n            : undefined;\r\n          if (propertyForLayerName) {\r\n            geoServiceAssociations.push({\r\n              url: value,\r\n              urlProperty: key,\r\n              layerNameProperty: propertyForLayerName,\r\n              geoService\r\n            });\r\n          }\r\n        }\r\n      });\r\n    });\r\n    const geoServiceStates: {\r\n      geoServiceAssociation: GeoServiceAssociation;\r\n      state: any;\r\n    }[] = [];\r\n    geoServiceAssociations.map((geoServiceAssociation) => {\r\n      const url = geoServiceAssociation.url;\r\n      const type = geoServiceAssociation.geoService.type || 'wms';\r\n      distinctValues[geoServiceAssociation.layerNameProperty].map(\r\n        (layerName) => {\r\n          let appliedLayerName = layerName;\r\n          let arcgisLayerName = undefined;\r\n          if (\r\n            ['arcgisrest', 'imagearcgisrest', 'tilearcgisrest'].includes(type)\r\n          ) {\r\n            appliedLayerName = undefined;\r\n            arcgisLayerName = layerName;\r\n          }\r\n          const so = ObjectUtils.removeUndefined({\r\n            sourceOptions: {\r\n              type: type || 'wms',\r\n              url,\r\n              optionsFromCapabilities: true,\r\n              optionsFromApi: true,\r\n              params: {\r\n                LAYERS: appliedLayerName,\r\n                LAYER: arcgisLayerName\r\n              }\r\n            }\r\n          });\r\n          const potentialLayerId = generateIdFromSourceOptions(\r\n            so.sourceOptions\r\n          );\r\n          geoServiceStates.push({\r\n            geoServiceAssociation,\r\n            state: {\r\n              added: layersId.find((l) => l === potentialLayerId) !== undefined,\r\n              haveGeoServiceProperties: true,\r\n              type,\r\n              url,\r\n              layerName\r\n            }\r\n          });\r\n        }\r\n      );\r\n    });\r\n    geoServiceStates.map((geoServiceState) => {\r\n      const urlProperty = geoServiceState.geoServiceAssociation.urlProperty;\r\n      const layerNameProperty =\r\n        geoServiceState.geoServiceAssociation.layerNameProperty;\r\n\r\n      const urlValue = geoServiceState.state.url;\r\n      const layerNameValue = geoServiceState.state.layerName;\r\n      const entitiesToProcess = entities.filter(\r\n        (e) =>\r\n          e.properties[urlProperty] === urlValue &&\r\n          e.properties[layerNameProperty] === layerNameValue\r\n      );\r\n      const ns = {\r\n        geoService: geoServiceState.state\r\n      };\r\n      store.state.updateMany(entitiesToProcess, ns, true);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    this.stores$$.clear();\r\n    this.states$$.map((state) => state.unsubscribe());\r\n    if (this.empty$$) {\r\n      this.empty$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { Subscription } from 'rxjs';\r\n\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureMotion } from '../feature.enums';\r\nimport {\r\n  Feature,\r\n  FeatureStoreLoadingStrategyOptions\r\n} from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\n/**\r\n * This strategy loads a store's features into it's layer counterpart.\r\n * The store -> layer binding is a one-way binding. That means any entity\r\n * added to the store will be added to the layer but the opposite is false.\r\n *\r\n * Important: This strategy observes filtered entities, not raw entities. This\r\n * is not configurable yet.\r\n */\r\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's features\r\n   */\r\n  private stores$$ = new Map<FeatureStore, Subscription>();\r\n\r\n  private motion: FeatureMotion;\r\n\r\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\r\n    super(options);\r\n    this.setMotion(options.motion);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define the motion to apply on load\r\n   * @param motion Feature motion\r\n   */\r\n  setMotion(motion: FeatureMotion) {\r\n    this.motion = motion;\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for entities changes in a store.\r\n   * Important: Never observe a store's sorted entities. It makes no sense\r\n   * to display sorted entities (instead of unsorted) on a layer and it\r\n   * would potentially result in a lot of useless computation.\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    const subscription = store.view\r\n      .all$()\r\n      .subscribe((features: Feature[]) =>\r\n        this.onFeaturesChange(features, store)\r\n      );\r\n    this.stores$$.set(store, subscription);\r\n  }\r\n\r\n  /**\r\n   * Stop watching for entities changes in a store.\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const subscription = this.stores$$.get(store);\r\n    if (subscription !== undefined) {\r\n      subscription.unsubscribe();\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for entities changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach(\r\n      (entries: [FeatureStore, Subscription]) => {\r\n        entries[1].unsubscribe();\r\n      }\r\n    );\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Load features into a layer or clear the layer if the array of features is empty.\r\n   * @param features Store filtered features\r\n   * @param store Feature store\r\n   */\r\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\r\n    if (features.length === 0) {\r\n      store.clearLayer();\r\n    } else {\r\n      store.setLayerFeatures(\r\n        features,\r\n        this.selectMotion(store),\r\n        this.options.viewScale,\r\n        this.options.areaRatio,\r\n        this.options.getFeatureId\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Selects the best motion\r\n   * @param store A FeatureStore to apply the motion\r\n   * @returns The motion selected\r\n   */\r\n  private selectMotion(store: FeatureStore) {\r\n    if (this.motion !== undefined) {\r\n      return this.motion;\r\n    }\r\n\r\n    if (store.pristine === true) {\r\n      // If features have just been loaded into the store, move/zoom on them\r\n      return FeatureMotion.Default;\r\n    } else if (store.count > store.view.count) {\r\n      // If features have been filtered, move/zoom on the remaining ones\r\n      return FeatureMotion.Default;\r\n    } else {\r\n      // On insert, update or delete, do nothing\r\n      return FeatureMotion.None;\r\n    }\r\n  }\r\n}\r\n","import OlEvent from 'ol/events/Event';\r\n\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\r\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\r\n\r\n/**\r\n * This strategy loads a layer's features into it's store counterpart.\r\n * The layer -> store binding is a one-way binding. That means any OL feature\r\n * added to the layer will be added to the store but the opposite is false.\r\n *\r\n * Important: In it's current state, this strategy is to meant to be combined\r\n * with a standard Loading strategy and it would probably cause recursion issues.\r\n */\r\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n\r\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.onSourceChanges(store);\r\n    const olSource = store.layer.ol.getSource();\r\n    olSource.on('change', (event: OlEvent) => {\r\n      this.onSourceChanges(store);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach(\r\n      (entries: [FeatureStore, string]) => {}\r\n    );\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Load features from an OL source into a  store or clear the store if the source is empty\r\n   * @param features Store filtered features\r\n   * @param store Feature store\r\n   */\r\n  private onSourceChanges(store: FeatureStore) {\r\n    let olFeatures = store.layer.ol.getSource().getFeatures();\r\n\r\n    if (store.layer.dataSource instanceof ClusterDataSource) {\r\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\r\n        cluster.get('features')\r\n      );\r\n    }\r\n    if (olFeatures.length === 0) {\r\n      store.clear();\r\n    } else {\r\n      store.setStoreOlFeatures(olFeatures);\r\n    }\r\n  }\r\n}\r\n","import OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\r\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\r\nimport { EventsKey } from 'ol/events';\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport { Subscription, combineLatest } from 'rxjs';\r\nimport { map, debounceTime, skip } from 'rxjs/operators';\r\n\r\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureDataSource } from '../../../datasource';\r\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../../map/shared/map';\r\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\r\n\r\nimport {\r\n  Feature,\r\n  FeatureStoreSelectionStrategyOptions\r\n} from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureMotion } from '../feature.enums';\r\n\r\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\r\n  constructor(options) {\r\n    super(options);\r\n  }\r\n}\r\n\r\n/**\r\n * This strategy synchronizes a store and a layer selected entities.\r\n * The store <-> layer binding is a two-way binding.\r\n *\r\n * In many cases, a single strategy bound to multiple stores\r\n * will yield better results that multiple strategies with each their\r\n * own store. In the latter scenario, a click on overlapping features\r\n * would trigger the strategy of each layer and they would cancel\r\n * each other as well as move the map view around needlessly.\r\n */\r\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Listener to the map click event that allows selecting a feature\r\n   * by clicking on the map\r\n   */\r\n  private mapClickListener;\r\n\r\n  private olDragSelectInteraction: OlDragSelectInteraction;\r\n\r\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\r\n\r\n  /**\r\n   * Subscription to all stores selected entities\r\n   */\r\n  private stores$$: Subscription;\r\n\r\n  private motion: FeatureMotion;\r\n\r\n  /**\r\n   * The map the layers belong to\r\n   */\r\n  get map(): IgoMap {\r\n    return this.options.map;\r\n  }\r\n\r\n  /**\r\n   * A feature store that'll contain the selected features. It has it's own\r\n   * layer, shared by all the stores this staretgy is bound to.\r\n   */\r\n  get overlayStore(): FeatureStore {\r\n    return this._overlayStore;\r\n  }\r\n  private _overlayStore: FeatureStore;\r\n\r\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\r\n    super(options);\r\n    this.setMotion(options.motion);\r\n    this._overlayStore = this.createOverlayStore();\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and force this strategy's\r\n   * reactivation to properly setup watchers.\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      // Force reactivation\r\n      this.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and force this strategy's\r\n   * reactivation to properly setup watchers.\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      // Force reactivation\r\n      this.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define the motion to apply on select\r\n   * @param motion Feature motion\r\n   */\r\n  setMotion(motion: FeatureMotion) {\r\n    this.motion = motion;\r\n  }\r\n\r\n  /**\r\n   * Unselect all entities, from all stores\r\n   */\r\n  unselectAll() {\r\n    this.stores.forEach((store: FeatureStore) => {\r\n      store.state.updateAll({ selected: false });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay\r\n   */\r\n  clear() {\r\n    this.overlayStore.source.ol.clear();\r\n    this.overlayStore.clear();\r\n  }\r\n\r\n  /**\r\n   * Deactivate the selection without removing the selection\r\n   * overlay.\r\n   */\r\n  deactivateSelection() {\r\n    this.unlistenToMapClick();\r\n    this.removeDragBoxInteraction();\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer, setup the map click lsitener and\r\n   * start watching for stores selection\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.addOverlayLayer();\r\n    this.listenToMapClick();\r\n    if (this.options.dragBox === true) {\r\n      this.addDragBoxInteraction();\r\n    }\r\n    this.watchAll();\r\n  }\r\n\r\n  /**\r\n   * Remove the overlay layer, remove the map click lsitener and\r\n   * stop watching for stores selection\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.deactivateSelection();\r\n    this.removeOverlayLayer();\r\n  }\r\n\r\n  /**\r\n   * Create a single observable of all the stores. With a single observable,\r\n   * features can be added all at once to the overlay layer and a single\r\n   * motion can be performed. Multiple observable would have\r\n   * a cancelling effect on each other.\r\n   */\r\n  private watchAll() {\r\n    this.unwatchAll();\r\n\r\n    const stores$ = this.stores.map((store: FeatureStore) => {\r\n      return store.stateView\r\n        .manyBy$((record: EntityRecord<Feature>) => {\r\n          return record.state.selected === true;\r\n        })\r\n        .pipe(\r\n          map((records: EntityRecord<Feature>[]) =>\r\n            records.map((record) => record.entity)\r\n          )\r\n        );\r\n    });\r\n    this.stores$$ = combineLatest(stores$)\r\n      .pipe(\r\n        debounceTime(5),\r\n        skip(1), // Skip intial selection\r\n        map((features: Array<Feature[]>) =>\r\n          features.reduce((a, b) => a.concat(b))\r\n        )\r\n      )\r\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\r\n  }\r\n\r\n  /**\r\n   * Stop watching for selection in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    if (this.stores$$ !== undefined) {\r\n      this.stores$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a 'singleclick' listener to the map that'll allow selecting\r\n   * features by clicking on the map. The selection will be performed\r\n   * only on the layers bound to this strategy.\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: MapBrowserPointerEvent<any>) => {\r\n        this.onMapClick(event);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove the map click listener\r\n   */\r\n  private unlistenToMapClick() {\r\n    unByKey(this.mapClickListener);\r\n  }\r\n\r\n  /**\r\n   * On map click, select feature at pixel\r\n   * @param event OL MapBrowserPointerEvent\r\n   */\r\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\r\n    const exclusive = !ctrlKeyDown(event);\r\n    const reverse = !exclusive;\r\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\r\n      hitTolerance: this.options.hitTolerance || 0,\r\n      layerFilter: (olLayer) => {\r\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\r\n          return store.layer?.ol === olLayer;\r\n        });\r\n        return storeOlLayer !== undefined;\r\n      }\r\n    }) as OlFeature<OlGeometry>[];\r\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\r\n  }\r\n\r\n  /**\r\n   * Add a drag box interaction and, on drag box end, select features\r\n   */\r\n  private addDragBoxInteraction() {\r\n    let olDragSelectInteraction;\r\n    const olInteractions = this.map.ol.getInteractions().getArray();\r\n\r\n    // There can only be one dragbox interaction, so find the current one, if any\r\n    // Don't keep a reference to the current dragbox because we don't want\r\n    // to remove it when this startegy is deactivated\r\n    for (const olInteraction of olInteractions) {\r\n      if (olInteraction instanceof OlDragSelectInteraction) {\r\n        olDragSelectInteraction = olInteraction;\r\n        break;\r\n      }\r\n    }\r\n    // If no drag box interaction is found, create a new one and add it to the map\r\n    if (olDragSelectInteraction === undefined) {\r\n      olDragSelectInteraction = new OlDragSelectInteraction({\r\n        condition: ctrlKeyDown\r\n      });\r\n      this.map.ol.addInteraction(olDragSelectInteraction);\r\n      this.olDragSelectInteraction = olDragSelectInteraction;\r\n    }\r\n\r\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\r\n      'boxend',\r\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove drag box interaction\r\n   */\r\n  private removeDragBoxInteraction() {\r\n    if (this.olDragSelectInteractionEndKey !== undefined) {\r\n      unByKey(this.olDragSelectInteractionEndKey);\r\n    }\r\n    if (this.olDragSelectInteraction !== undefined) {\r\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\r\n    }\r\n    this.olDragSelectInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * On dragbox end, select features in drag box\r\n   * @param event OL MapBrowserPointerEvent\r\n   */\r\n  private onDragBoxEnd(event: OlDragBoxEvent) {\r\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\r\n    const target = event.target as any;\r\n    const extent = target.getGeometry().getExtent();\r\n    const olFeatures = this.stores.reduce(\r\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\r\n        const olSource = store.layer.ol.getSource();\r\n        acc.push(...olSource.getFeaturesInExtent(extent));\r\n        return acc;\r\n      },\r\n      []\r\n    );\r\n    this.onSelectFromMap(olFeatures, exclusive, false);\r\n  }\r\n\r\n  /**\r\n   * When features are selected from the store, add\r\n   * them to this startegy's overlay layer (select on map)\r\n   * @param features Store features\r\n   */\r\n  private onSelectFromStore(features: Feature[]) {\r\n    const motion = this.motion;\r\n    const olOverlayFeatures = this.overlayStore.layer.ol\r\n      .getSource()\r\n      .getFeatures();\r\n    const overlayFeaturesKeys = olOverlayFeatures.map(\r\n      (olFeature: OlFeature<OlGeometry>) => olFeature.getId()\r\n    );\r\n    const featuresKeys = features.map(this.overlayStore.getKey);\r\n\r\n    let doMotion;\r\n    if (features.length === 0) {\r\n      doMotion = false;\r\n    } else {\r\n      doMotion =\r\n        overlayFeaturesKeys.length !== featuresKeys.length ||\r\n        !overlayFeaturesKeys.every(\r\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\r\n        );\r\n    }\r\n\r\n    this.overlayStore.setLayerFeatures(\r\n      features,\r\n      doMotion ? motion : FeatureMotion.None,\r\n      this.options.viewScale,\r\n      this.options.areaRatio,\r\n      this.options.getFeatureId\r\n    );\r\n  }\r\n\r\n  /**\r\n   * When features are selected from the map, also select them\r\n   * in their store.\r\n   * @param olFeatures OL feature objects\r\n   */\r\n  private onSelectFromMap(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    exclusive: boolean,\r\n    reverse: boolean\r\n  ) {\r\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\r\n\r\n    this.stores.forEach((store: FeatureStore) => {\r\n      const features = groupedFeatures.get(store);\r\n      if (features === undefined && exclusive === true) {\r\n        this.unselectAllFeaturesFromStore(store);\r\n      } else if (features === undefined && exclusive === false) {\r\n        // Do nothing\r\n      } else {\r\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Select features in store\r\n   * @param store: Feature store\r\n   * @param features Features\r\n   */\r\n  private selectFeaturesFromStore(\r\n    store: FeatureStore,\r\n    features: Feature[],\r\n    exclusive: boolean,\r\n    reverse: boolean\r\n  ) {\r\n    if (reverse === true) {\r\n      store.state.reverseMany(features, ['selected']);\r\n    } else {\r\n      store.state.updateMany(features, { selected: true }, exclusive);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unselect all features from store\r\n   * @param store: Feature store\r\n   */\r\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\r\n    store.state.updateAll({ selected: false });\r\n  }\r\n\r\n  /**\r\n   * This method returns a store -> features mapping from a list\r\n   * of OL selected features. OL features keep a reference to the store\r\n   * they are from.\r\n   * @param olFeatures: OL feature objects\r\n   * @returns Store -> features mapping\r\n   */\r\n  private groupFeaturesByStore(\r\n    olFeatures: OlFeature<OlGeometry>[]\r\n  ): Map<FeatureStore, Feature[]> {\r\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\r\n    if (olFeatures === null || olFeatures === undefined) {\r\n      return groupedFeatures;\r\n    }\r\n\r\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n      const store = olFeature.get('_featureStore');\r\n      if (store === undefined) {\r\n        return;\r\n      }\r\n\r\n      let features = groupedFeatures.get(store);\r\n      if (features === undefined) {\r\n        features = [];\r\n        groupedFeatures.set(store, features);\r\n      }\r\n\r\n      const feature = store.get(olFeature.getId());\r\n      if (feature !== undefined) {\r\n        features.push(feature);\r\n      }\r\n    });\r\n\r\n    return groupedFeatures;\r\n  }\r\n\r\n  /**\r\n   * Create an overlay store that'll contain the selected features.\r\n   * @returns Overlay store\r\n   */\r\n  private createOverlayStore(): FeatureStore {\r\n    const overlayLayer = this.options.layer\r\n      ? this.options.layer\r\n      : this.createOverlayLayer();\r\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Create an overlay store that'll contain the selected features.\r\n   * @returns Overlay layer\r\n   */\r\n  private createOverlayLayer(): VectorLayer {\r\n    return new VectorLayer({\r\n      zIndex: 300,\r\n      source: new FeatureDataSource(),\r\n      style: undefined,\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the overlay store's layer to the map to display the selected\r\n   * features.\r\n   */\r\n  private addOverlayLayer() {\r\n    if (this.overlayStore.layer.map === undefined) {\r\n      this.map.addLayer(this.overlayStore.layer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the overlay layer from the map\r\n   */\r\n  private removeOverlayLayer() {\r\n    this.overlayStore.source.ol.clear();\r\n    this.map.removeLayer(this.overlayStore.layer);\r\n  }\r\n}\r\n","import { Document, DocumentOptions } from 'flexsearch';\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureStoreSearchIndexStrategyOptions } from '../feature.interfaces';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\n/**\r\n *\r\n * This strategy loads a layer's features's properties into a searchable index.\r\n */\r\nexport class FeatureStoreSearchIndexStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n\r\n  constructor(protected options: FeatureStoreSearchIndexStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  private initStoreSearchIndex(store) {\r\n    store.searchDocument = new Document({ tokenize: 'full' });\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's entities changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n    this.initStoreSearchIndex(store);\r\n\r\n    store.entities$\r\n      .pipe(skipWhile((e) => !e.length))\r\n      .subscribe(() => this.onEntitiesChanges(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's entities changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      store.searchDocument = undefined;\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach(\r\n      (entries: [FeatureStore, string]) => {}\r\n    );\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Maintain searcahble index for every loaded entities\r\n   * @param store Feature store\r\n   */\r\n  private onEntitiesChanges(store: FeatureStore) {\r\n    const ratio = this.options.percentDistinctValueRatio || 2;\r\n    const featuresProperties = [];\r\n    store.index.forEach((value, key) => {\r\n      const fp = value.properties;\r\n      fp.igoSearchID = key;\r\n      featuresProperties.push(fp);\r\n    });\r\n    const toIndex = [];\r\n    let columnsToNotIndex = [];\r\n    let contentToIndex = [];\r\n    if (this.options.sourceFields) {\r\n      columnsToNotIndex = this.options.sourceFields.filter(\r\n        (sf) => !sf.searchIndex?.enabled\r\n      );\r\n      contentToIndex = this.options.sourceFields\r\n        .filter((sf) => sf.searchIndex?.enabled)\r\n        .map((sf2) => {\r\n          return Object.assign(\r\n            {},\r\n            { field: sf2.name, tokenize: 'full' },\r\n            sf2.searchIndex\r\n          );\r\n        });\r\n    } else {\r\n      if (featuresProperties.length) {\r\n        // THIS METHOD COMPUTE COLUMN DISTINCT VALUE TO FILTER WHICH COLUMN TO INDEX BASED ON A RATIO or discard float columns\r\n        const columns = Object.keys(featuresProperties[0]);\r\n        const columnsToIndex = [];\r\n        columnsToNotIndex = columns\r\n          .map((column) => {\r\n            const distinctValues = [\r\n              ...new Set(featuresProperties.map((item) => item[column]))\r\n            ];\r\n            // identify column to not index based on a ratio distinctValues/nb of features OR discart exclusive float column (ex: lat, long)\r\n            if (\r\n              (distinctValues.length / featuresProperties.length) * 100 <=\r\n                ratio ||\r\n              distinctValues.every((n) => Number(n) === n && n % 1 !== 0)\r\n            ) {\r\n              columnsToNotIndex.push(column);\r\n            } else {\r\n              columnsToIndex.push(column);\r\n            }\r\n          })\r\n          .filter((f) => f);\r\n        const keysToIndex = columnsToIndex.filter((f) => f !== 'igoSearchID');\r\n        contentToIndex = keysToIndex.map((key) => {\r\n          return { field: key, tokenize: 'full' };\r\n        });\r\n      }\r\n    }\r\n    store.index.forEach((value, key) => {\r\n      const propertiesToIndex = JSON.parse(JSON.stringify(value.properties));\r\n      columnsToNotIndex.map((c) => delete propertiesToIndex[c]);\r\n      if (Object.keys(propertiesToIndex).length) {\r\n        toIndex.push(propertiesToIndex);\r\n      }\r\n    });\r\n\r\n    if (toIndex.length === 0) {\r\n      this.initStoreSearchIndex(store);\r\n    } else {\r\n      store.searchDocument = new Document({\r\n        document: {\r\n          id: 'igoSearchID',\r\n          index: contentToIndex\r\n        } as DocumentOptions<any>\r\n      });\r\n      toIndex.map((i) => {\r\n        store.searchDocument.add(i.igoSearchID, i);\r\n      });\r\n    }\r\n  }\r\n}\r\n","import { FeatureStore } from './store';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import * as olstyle from 'ol/style';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\n\r\n/**\r\n * Create a marker style for points\r\n * @returns Style\r\n */\r\nexport function createOverlayMarkerStyle({\r\n  text,\r\n  opacity = 1,\r\n  markerColor = [0, 161, 222],\r\n  markerOutlineColor = [255, 255, 255]\r\n}: {\r\n  text?: string;\r\n  opacity?: number;\r\n  markerColor?: string | number[];\r\n  markerOutlineColor?: string | number[];\r\n} = {}): olstyle.Style {\r\n  let iconColor;\r\n  let svgIconColor;\r\n  let svgOutlineColor;\r\n  let svg;\r\n\r\n  const newColor = ColorAsArray(markerColor).slice(0);\r\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\r\n\r\n  if (\r\n    newColor.length === 4 &&\r\n    (typeof markerColor !== 'string' ||\r\n      /^#[0-9A-F]{8}$/i.test(markerColor as string))\r\n  ) {\r\n    opacity = newColor[3];\r\n  }\r\n\r\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\r\n  iconColor = markerColor;\r\n\r\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\r\n\r\n  svg =\r\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\r\n    '<path fill=' +\r\n    svgIconColor +\r\n    ' stroke=' +\r\n    svgOutlineColor +\r\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\r\n    '</svg>';\r\n\r\n  return new olstyle.Style({\r\n    image: new olstyle.Icon({\r\n      src: svg,\r\n      opacity,\r\n      anchor: [0.5, 0.92]\r\n    }),\r\n    text: new olstyle.Text({\r\n      text,\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olStyle from 'ol/style';\r\nimport OlFeature from 'ol/Feature';\r\n\r\nimport { createOverlayMarkerStyle } from '../shared/overlay/overlay-marker-style.utils';\r\nimport RenderFeature from 'ol/render/Feature';\r\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\r\nimport { StyleByAttribute } from '../shared/vector/vector-style.interface';\r\nimport { ClusterParam } from '../../layer/shared/clusterParam';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StyleService {\r\n  public style: olStyle.Style;\r\n\r\n  /**\r\n   * Create a style based on a object as\r\n   * style: {\r\n   *       \"stroke\": {\r\n   *         \"color\": \"blue\",\r\n   *         \"lineDash\": [10, 5]\r\n   *       },\r\n   *       \"text\": {\r\n   *         \"minScaleDenom\": 50000,\r\n   *         \"maxScaleDenom\": 200000,\r\n   *         \"minResolution\": 100,\r\n   *         \"maxResolution\": 400,\r\n   *         \"attribute\": \"THE COLUMN NAME TO RETRIEVE THE LABEL VALUE\",\r\n   *         \"text\": \"MY HARCODED TEXT\",\r\n   *         \"stroke\": {\r\n   *           \"color\": \"blue\",\r\n   *           \"width\": 0.75\r\n   *         },\r\n   *         \"fill\": {\r\n   *           \"color\": \"black\"\r\n   *         },\r\n   *         \"font\": \"20px sans-serif\",\r\n   *         \"overflow\": true,\r\n   *         \"offsetX\": 10,\r\n   *         \"offsetY\": 20,\r\n   *         \"padding\": [2.5, 2.5, 2.5, 2.5]\r\n   *       },\r\n   *       \"width\": 5\r\n   *     }\r\n   *\r\n   * @param options\r\n   * @param feature feature to apply style on\r\n   * @param resolution current map resolution, to control label resolution range\r\n   * @returns\r\n   */\r\n  createStyle(\r\n    options: { [key: string]: any },\r\n    feature?: RenderFeature | OlFeature<OlGeometry>,\r\n    resolution?: number\r\n  ) {\r\n    if (!options) {\r\n      return createOverlayMarkerStyle();\r\n    }\r\n    if (typeof options === 'function' || options instanceof olStyle.Style) {\r\n      return options;\r\n    }\r\n    const parsedStyle = this.parseStyle('style', options);\r\n    if (parsedStyle.getText()) {\r\n      let labelMinResolution = 0;\r\n      let labelMaxResolution = Infinity;\r\n      if (options.text) {\r\n        const labelMinResolutionFromScale = options.text?.minScaleDenom\r\n          ? getResolutionFromScale(Number(options.text.minScaleDenom))\r\n          : undefined;\r\n        const labelMaxResolutionFromScale = options.text?.maxScaleDenom\r\n          ? getResolutionFromScale(Number(options.text.maxScaleDenom))\r\n          : undefined;\r\n        const minResolution = options.text?.minResolution\r\n          ? options.text.minResolution\r\n          : 0;\r\n        const maxResolution = options.text?.maxResolution\r\n          ? options.text.maxResolution\r\n          : Infinity;\r\n\r\n        labelMinResolution = labelMinResolutionFromScale || minResolution;\r\n        labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\r\n      }\r\n      if (\r\n        options.text?.minScaleDenom ||\r\n        options.text?.maxScaleDenom ||\r\n        options.text?.minResolution ||\r\n        options.text?.maxResolution\r\n      ) {\r\n        if (\r\n          feature &&\r\n          resolution >= labelMinResolution &&\r\n          resolution <= labelMaxResolution\r\n        ) {\r\n          if (feature && options.text.attribute) {\r\n            parsedStyle\r\n              .getText()\r\n              .setText(this.getLabel(feature, options.text.attribute));\r\n          }\r\n        } else {\r\n          parsedStyle.setText();\r\n        }\r\n      }\r\n    }\r\n    return parsedStyle;\r\n  }\r\n\r\n  public parseStyle(key: string, value: any) {\r\n    const styleOptions = {};\r\n    const olCls = this.getOlCls(key);\r\n\r\n    if (olCls && value instanceof Object) {\r\n      Object.keys(value).forEach((_key) => {\r\n        const olKey = this.getOlKey(_key);\r\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\r\n      });\r\n      return new olCls(styleOptions);\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  private getOlKey(key: any) {\r\n    let olKey;\r\n    switch (key.toLowerCase()) {\r\n      case 'circle':\r\n      case 'regularshape':\r\n      case 'icon':\r\n        olKey = 'image';\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return olKey || key;\r\n  }\r\n\r\n  private getOlCls(key: any) {\r\n    let olCls = olStyle[key.charAt(0).toUpperCase() + key.slice(1)];\r\n    if (key === 'regularshape') {\r\n      olCls = olStyle.RegularShape;\r\n    }\r\n    if (key === 'backgroundFill') {\r\n      olCls = olStyle.Fill;\r\n    }\r\n    if (key === 'backgroundStroke') {\r\n      olCls = olStyle.Stroke;\r\n    }\r\n\r\n    return olCls;\r\n  }\r\n\r\n  createStyleByAttribute(\r\n    feature: RenderFeature | OlFeature<OlGeometry>,\r\n    styleByAttribute: StyleByAttribute,\r\n    resolution: number\r\n  ) {\r\n    let style;\r\n    const type = styleByAttribute.type\r\n      ? styleByAttribute.type\r\n      : this.guessTypeFeature(feature);\r\n    const attribute = styleByAttribute.attribute;\r\n    const data = styleByAttribute.data;\r\n    const stroke = styleByAttribute.stroke;\r\n    const width = styleByAttribute.width;\r\n    const fill = styleByAttribute.fill;\r\n    const anchor = styleByAttribute.anchor;\r\n    const radius = styleByAttribute.radius;\r\n    const icon = styleByAttribute.icon;\r\n    const scale = styleByAttribute.scale;\r\n    const size = data ? data.length : 0;\r\n    const label = styleByAttribute.label\r\n      ? styleByAttribute.label.attribute\r\n      : undefined;\r\n    const labelMinResolutionFromScale = styleByAttribute.label?.minScaleDenom\r\n      ? getResolutionFromScale(Number(styleByAttribute.label.minScaleDenom))\r\n      : undefined;\r\n    const labelMaxResolutionFromScale = styleByAttribute.label?.maxScaleDenom\r\n      ? getResolutionFromScale(Number(styleByAttribute.label.maxScaleDenom))\r\n      : undefined;\r\n    const minResolution = styleByAttribute.label?.minResolution\r\n      ? styleByAttribute.label.minResolution\r\n      : 0;\r\n    const maxResolution = styleByAttribute.label?.maxResolution\r\n      ? styleByAttribute.label.maxResolution\r\n      : Infinity;\r\n\r\n    const labelMinResolution = labelMinResolutionFromScale || minResolution;\r\n    const labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\r\n\r\n    let labelStyle = styleByAttribute.label?.style\r\n      ? this.parseStyle('text', styleByAttribute.label.style)\r\n      : undefined;\r\n    if (!labelStyle && label) {\r\n      labelStyle = new olStyle.Text();\r\n    }\r\n    const baseStyle = styleByAttribute.baseStyle;\r\n\r\n    if (labelStyle) {\r\n      if (\r\n        resolution >= labelMinResolution &&\r\n        resolution <= labelMaxResolution\r\n      ) {\r\n        labelStyle.setText(this.getLabel(feature, label));\r\n      } else {\r\n        labelStyle.setText('');\r\n      }\r\n    }\r\n\r\n    if (type === 'circle') {\r\n      for (let i = 0; i < size; i++) {\r\n        const val =\r\n          typeof feature.get(attribute) !== 'undefined' &&\r\n          feature.get(attribute) !== null\r\n            ? feature.get(attribute)\r\n            : '';\r\n        if (\r\n          val === data[i] ||\r\n          val.toString().match(new RegExp(data[i], 'gmi'))\r\n        ) {\r\n          if (icon) {\r\n            style = [\r\n              new olStyle.Style({\r\n                image: new olStyle.Icon({\r\n                  color: fill ? fill[i] : undefined,\r\n                  src: icon[i],\r\n                  scale: scale ? scale[i] : 1,\r\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\r\n                }),\r\n                text:\r\n                  labelStyle instanceof olStyle.Text ? labelStyle : undefined\r\n              })\r\n            ];\r\n            return style;\r\n          }\r\n          style = [\r\n            new olStyle.Style({\r\n              image: new olStyle.Circle({\r\n                radius: radius ? radius[i] : 4,\r\n                stroke: new olStyle.Stroke({\r\n                  color: stroke ? stroke[i] : 'black',\r\n                  width: width ? width[i] : 1\r\n                }),\r\n                fill: new olStyle.Fill({\r\n                  color: fill ? fill[i] : 'black'\r\n                })\r\n              }),\r\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\r\n        if (baseStyle) {\r\n          style = this.createStyle(baseStyle, feature, resolution);\r\n          if (labelStyle) {\r\n            style.setText(labelStyle);\r\n          }\r\n          return style;\r\n        }\r\n        style = [\r\n          new olStyle.Style({\r\n            image: new olStyle.Circle({\r\n              radius: 4,\r\n              stroke: new olStyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olStyle.Fill({\r\n                color: '#bbbbf2'\r\n              })\r\n            })\r\n          })\r\n        ];\r\n        return style;\r\n      }\r\n    } else if (type === 'regular') {\r\n      for (let i = 0; i < size; i++) {\r\n        const val =\r\n          typeof feature.get(attribute) !== 'undefined' &&\r\n          feature.get(attribute) !== null\r\n            ? feature.get(attribute)\r\n            : '';\r\n        if (\r\n          val === data[i] ||\r\n          val.toString().match(new RegExp(data[i], 'gmi'))\r\n        ) {\r\n          style = [\r\n            new olStyle.Style({\r\n              stroke: new olStyle.Stroke({\r\n                color: stroke ? stroke[i] : 'black',\r\n                width: width ? width[i] : 1\r\n              }),\r\n              fill: new olStyle.Fill({\r\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\r\n              }),\r\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n      if (feature instanceof OlFeature) {\r\n        if (!feature.getStyle()) {\r\n          if (baseStyle) {\r\n            style = this.createStyle(baseStyle, feature, resolution);\r\n            if (labelStyle) {\r\n              style.setText(labelStyle);\r\n            }\r\n            return style;\r\n          }\r\n          style = [\r\n            new olStyle.Style({\r\n              stroke: new olStyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olStyle.Fill({\r\n                color: '#bbbbf2'\r\n              })\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  createClusterStyle(\r\n    feature: RenderFeature | OlFeature<OlGeometry>,\r\n    resolution: number,\r\n    clusterParam: ClusterParam = {},\r\n    layerStyle\r\n  ) {\r\n    let style;\r\n    const size = feature.get('features').length;\r\n    if (size !== 1) {\r\n      if (clusterParam.clusterRanges) {\r\n        for (const r of clusterParam.clusterRanges) {\r\n          if (\r\n            (!r.minRadius || r.minRadius <= size) &&\r\n            (!r.maxRadius || r.maxRadius >= size)\r\n          ) {\r\n            style = this.createStyle(r.style) as olStyle.Circle;\r\n\r\n            if (r.showRange) {\r\n              const text = new olStyle.Text({\r\n                text: size.toString(),\r\n                fill: new olStyle.Fill({\r\n                  color: '#fff'\r\n                })\r\n              });\r\n              style.setText(text);\r\n            }\r\n\r\n            if (r.dynamicRadius) {\r\n              let clusterRadius: number;\r\n              const radiusMin = style.getRadius();\r\n              clusterRadius = 5 * Math.log(size);\r\n              if (clusterRadius < radiusMin) {\r\n                clusterRadius = radiusMin;\r\n              }\r\n              style.image_.setRadius(clusterRadius);\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!style) {\r\n        let clusterRadius: number;\r\n        if (clusterParam.radiusCalc) {\r\n          clusterRadius = clusterParam.radiusCalc(size);\r\n        } else {\r\n          const radiusMin = 6;\r\n          clusterRadius = 5 * Math.log(size);\r\n          if (clusterRadius < radiusMin) {\r\n            clusterRadius = radiusMin;\r\n          }\r\n        }\r\n\r\n        style = [\r\n          new olStyle.Style({\r\n            image: new olStyle.Circle({\r\n              radius: clusterRadius,\r\n              stroke: new olStyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olStyle.Fill({\r\n                color: 'rgba(24, 134, 45, 0.5)'\r\n              })\r\n            }),\r\n            text: new olStyle.Text({\r\n              text: size.toString(),\r\n              fill: new olStyle.Fill({\r\n                color: '#fff'\r\n              })\r\n            })\r\n          })\r\n        ];\r\n      }\r\n    } else {\r\n      style = this.createStyle(layerStyle, feature, resolution);\r\n    }\r\n    return style;\r\n  }\r\n\r\n  getLabel(feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    if (!label) {\r\n      return;\r\n    }\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach((v) => {\r\n      label = label.replace(v[0], feature.get(v[1]));\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.get(labelMatch) || labelMatch;\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  private guessTypeFeature(feature) {\r\n    switch (feature.getGeometry().getType()) {\r\n      case 'Point':\r\n      case 'MultiPoint':\r\n      case 'Circle':\r\n        return 'circle';\r\n      default:\r\n        return 'regular';\r\n    }\r\n  }\r\n}\r\n","import * as olstyle from 'ol/style';\r\nimport OlFeature from 'ol/Feature';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\nimport { StyleService } from '../../../style/style-service/style.service';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\r\n\r\n/**\r\n * Create an overlay style with markers for points and a basic stroke/fill\r\n * combination for lines and polygons\r\n * @returns Style function\r\n */\r\nexport function createOverlayLayerStyle(): (\r\n  olFeature: OlFeature<OlGeometry>,\r\n  resolution: number\r\n) => olstyle.Style {\r\n  const defaultStyle = createOverlayDefaultStyle();\r\n  const markerStyle = createOverlayMarkerStyle();\r\n\r\n  let style;\r\n\r\n  return (olFeature: OlFeature<OlGeometry>, resolution) => {\r\n    if (olFeature.getId() === 'bufferFeature') {\r\n      style = createBufferStyle(\r\n        olFeature.get('bufferStroke'),\r\n        2,\r\n        olFeature.get('bufferFill'),\r\n        olFeature.get('bufferText')\r\n      );\r\n      return style;\r\n    } else {\r\n      const customStyle = olFeature.get('_style');\r\n      if (customStyle) {\r\n        const styleService = new StyleService();\r\n        return styleService.createStyle(customStyle, olFeature, resolution);\r\n      }\r\n      const geometryType = olFeature.getGeometry().getType();\r\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\r\n      style.getText().setText(olFeature.get('_mapTitle'));\r\n      return style;\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Create a basic style for lines and polygons\r\n * @returns Style\r\n */\r\nexport function createOverlayDefaultStyle({\r\n  text,\r\n  strokeWidth = 2,\r\n  fillColor = [0, 161, 222, 0.3],\r\n  strokeColor = [0, 161, 222, 0.9]\r\n}: {\r\n  text?: string;\r\n  strokeWidth?: number;\r\n  fillColor?: string | number[];\r\n  strokeColor?: string | number[];\r\n} = {}): olstyle.Style {\r\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\r\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\r\n\r\n  const stroke = new olstyle.Stroke({\r\n    width: strokeWidth,\r\n    color: strokeWithOpacity\r\n  });\r\n\r\n  const fill = new olstyle.Fill({\r\n    color: fillWithOpacity\r\n  });\r\n\r\n  return new olstyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    }),\r\n    text: new olstyle.Text({\r\n      text,\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n\r\nfunction createBufferStyle(\r\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\r\n  strokeWidth: number = 2,\r\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\r\n  bufferRadius?\r\n): olstyle.Style {\r\n  const stroke = new olstyle.Stroke({\r\n    width: strokeWidth,\r\n    color: strokeRGBA\r\n  });\r\n\r\n  const fill = new olstyle.Fill({\r\n    color: fillRGBA\r\n  });\r\n\r\n  return new olstyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    }),\r\n    text: new olstyle.Text({\r\n      font: '12px Calibri,sans-serif',\r\n      text: bufferRadius,\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n","import OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport {\r\n  Feature,\r\n  FeatureMotion,\r\n  featureToOl,\r\n  moveToOlFeatures\r\n} from '../../feature/shared';\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\n\r\nimport { createOverlayLayer } from './overlay.utils';\r\nimport { MapBase } from '../../map/shared/map.abstract';\r\n\r\n/**\r\n * This class is simply a shortcut for adding features to a map.\r\n * It does nothing more than a standard layer but it's shipped with\r\n * a defautl style based on the geometry type of the features it contains.\r\n * @todo Enhance that by using a FeatureStore and strategies.\r\n */\r\nexport class Overlay<T extends MapBase = MapBase> {\r\n  /**\r\n   * The map to add the layer to\r\n   */\r\n  private map: T;\r\n\r\n  /**\r\n   * Overlay layer\r\n   */\r\n  private layer: VectorLayer;\r\n\r\n  /**\r\n   * Overlay layer's data source\r\n   */\r\n  get dataSource(): FeatureDataSource {\r\n    return this.layer.dataSource as FeatureDataSource;\r\n  }\r\n\r\n  constructor(map?: T) {\r\n    this.layer = createOverlayLayer();\r\n    this.setMap(map);\r\n  }\r\n\r\n  /**\r\n   * Bind this to a map and add the overlay layer to that map\r\n   * @param map Map\r\n   */\r\n  setMap(map: T) {\r\n    if (map === undefined) {\r\n      if (this.map !== undefined) {\r\n        this.map.ol.removeLayer(this.layer.ol);\r\n      }\r\n    } else {\r\n      map.ol.addLayer(this.layer.ol);\r\n    }\r\n    this.map = map;\r\n  }\r\n\r\n  /**\r\n   * Set the overlay features and, optionally, move to them\r\n   * @param features Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\r\n   */\r\n  setFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    sourceId?: string\r\n  ) {\r\n    if (sourceId) {\r\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\r\n        if (olFeature.get('_sourceId') === sourceId) {\r\n          this.removeOlFeature(olFeature);\r\n        }\r\n      }\r\n    } else {\r\n      this.clear();\r\n    }\r\n    this.addFeatures(features, motion);\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the  overlay and, optionally, move to it\r\n   * @param feature Feature\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\r\n    this.addFeatures([feature], motion);\r\n  }\r\n\r\n  /**\r\n   * Add features to the  overlay and, optionally, move to them\r\n   * @param features Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    const olFeatures = [];\r\n    features.forEach((feature: Feature) => {\r\n      const olFeature = featureToOl(feature, this.map.projection);\r\n      const olGeometry = olFeature.getGeometry();\r\n      if (olGeometry === null) {\r\n        return;\r\n      }\r\n      olFeatures.push(olFeature);\r\n    });\r\n\r\n    this.addOlFeatures(olFeatures, motion);\r\n  }\r\n\r\n  /**\r\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\r\n   * @param olFeature OpenLayers Feature\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addOlFeature(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    this.addOlFeatures([olFeature], motion);\r\n  }\r\n\r\n  /**\r\n   * Add OpenLayers features to the overlay and, optionally, move to them\r\n   * @param olFeatures OpenLayers Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addOlFeatures(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    this.dataSource.ol.addFeatures(olFeatures);\r\n    moveToOlFeatures(this.map.viewController, olFeatures, motion);\r\n  }\r\n\r\n  /**\r\n   * Remove a feature from the overlay\r\n   * @param feature Feature\r\n   */\r\n  removeFeature(feature: Feature) {\r\n    this.removeFeatures([feature]);\r\n  }\r\n\r\n  /**\r\n   * Remove features from the overlay\r\n   * @param features Features\r\n   */\r\n  removeFeatures(features: Feature[]) {\r\n    features.forEach((feature: Feature) => {\r\n      if (feature.meta) {\r\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\r\n          this.removeOlFeature(\r\n            this.dataSource.ol.getFeatureById(feature.meta.id)\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove an OpenLayers feature from the overlay\r\n   * @param olFeature OpenLayers Feature\r\n   */\r\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\r\n    this.dataSource.ol.removeFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay\r\n   */\r\n  clear() {\r\n    this.dataSource.ol.clear();\r\n  }\r\n}\r\n","import { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { createOverlayLayerStyle } from '../../style/shared/overlay/overlay-style.utils';\r\n\r\n/**\r\n * Create an overlay layer and it's source\r\n * @returns Overlay layer\r\n */\r\nexport function createOverlayLayer(): VectorLayer {\r\n  const overlayDataSource = new FeatureDataSource();\r\n  return new VectorLayer({\r\n    title: 'Overlay',\r\n    zIndex: 300,\r\n    source: overlayDataSource,\r\n    style: createOverlayLayerStyle()\r\n  });\r\n}\r\n","import { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { Watcher, SubjectStatus } from '@igo2/utils';\r\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\r\nimport { ObjectEvent } from 'ol/Object';\r\n\r\nexport class LayerWatcher extends Watcher {\r\n  public propertyChange$: BehaviorSubject<{\r\n    event: ObjectEvent;\r\n    layer: Layer;\r\n  }> = new BehaviorSubject(undefined);\r\n  private loaded = 0;\r\n  private loading = 0;\r\n  private layers: Layer[] = [];\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  watch() {}\r\n\r\n  unwatch() {\r\n    this.layers.forEach((layer) => this.unwatchLayer(layer), this);\r\n  }\r\n\r\n  setPropertyChange(change: ObjectEvent, layer: Layer) {\r\n    if (\r\n      ![\r\n        LinkedProperties.TIMEFILTER,\r\n        LinkedProperties.OGCFILTERS,\r\n        LinkedProperties.VISIBLE,\r\n        LinkedProperties.OPACITY,\r\n        LinkedProperties.MINRESOLUTION,\r\n        LinkedProperties.MAXRESOLUTION\r\n      ].includes(change.key as any)\r\n    ) {\r\n      return;\r\n    }\r\n    this.propertyChange$.next({ event: change, layer });\r\n  }\r\n\r\n  watchLayer(layer: Layer) {\r\n    if (layer.status$ === undefined) {\r\n      return;\r\n    }\r\n    layer.ol.on('propertychange', (evt) => this.setPropertyChange(evt, layer));\r\n    layer.dataSource.ol.on('propertychange', (evt) =>\r\n      this.setPropertyChange(evt, layer)\r\n    );\r\n\r\n    this.layers.push(layer);\r\n\r\n    const layer$$ = layer.status$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((status) => {\r\n        if (status === SubjectStatus.Error) {\r\n          this.loading = 0;\r\n          this.loaded = -1;\r\n        }\r\n        if (status === SubjectStatus.Working) {\r\n          this.loading += 1;\r\n        } else if (status === SubjectStatus.Done) {\r\n          this.loaded += 1;\r\n        }\r\n\r\n        if (this.loaded >= this.loading) {\r\n          this.loading = this.loaded = 0;\r\n          this.status = SubjectStatus.Done;\r\n        } else if (this.loading > 0) {\r\n          this.status = SubjectStatus.Working;\r\n        }\r\n      });\r\n\r\n    this.subscriptions.push(layer$$);\r\n  }\r\n\r\n  unwatchLayer(layer: Layer) {\r\n    layer.ol.un('propertychange', (evt) => this.setPropertyChange(evt, layer));\r\n    layer.dataSource.ol.un('propertychange', (evt) =>\r\n      this.setPropertyChange(evt, layer)\r\n    );\r\n    layer.status$.next(SubjectStatus.Done);\r\n    const index = this.layers.indexOf(layer);\r\n    if (index >= 0) {\r\n      const status = (layer as any).watcher.status;\r\n      if (\r\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\r\n      ) {\r\n        this.loaded += 1;\r\n      }\r\n      this.subscriptions[index].unsubscribe();\r\n      this.subscriptions.splice(index, 1);\r\n      this.layers.splice(index, 1);\r\n      (layer as any).watcher.unwatch();\r\n    }\r\n  }\r\n}\r\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import { EventsKey } from 'ol/events';\r\nimport OlMap from 'ol/Map';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\n/**\r\n * Base map controller\r\n */\r\nexport class MapController {\r\n  /**\r\n   * OL Map\r\n   */\r\n  protected olMap: OlMap;\r\n\r\n  /**\r\n   * Array of observer keys\r\n   */\r\n  protected observerKeys: EventsKey[] = [];\r\n\r\n  /**\r\n   * Return the OL map this controller is bound to\r\n   * @returns OL Map\r\n   */\r\n  getOlMap(): OlMap {\r\n    return this.olMap;\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\r\n      throw new Error('This controller is already bound to a map.');\r\n    }\r\n\r\n    if (olMap === undefined) {\r\n      this.teardownObservers();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\r\n    this.observerKeys = [];\r\n  }\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport OlMapEvent from 'ol/MapEvent';\r\n\r\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport * as oleasing from 'ol/easing';\r\nimport * as olproj from 'ol/proj';\r\nimport OlProjection from 'ol/proj/Projection';\r\nimport OlView from 'ol/View';\r\n\r\nimport { MapViewAction } from '../map.enums';\r\nimport { MapExtent, MapViewState } from '../map.interface';\r\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\r\nimport { MapController } from './controller';\r\nimport { EventsKey } from 'ol/events';\r\nimport { ObjectEvent } from 'ol/Object';\r\n\r\nexport interface MapViewControllerOptions {\r\n  stateHistory: boolean;\r\n}\r\n\r\n/**\r\n * Controller to handle map view interactions\r\n */\r\nexport class MapViewController extends MapController {\r\n  /**\r\n   * Observable of the current rotation in radians\r\n   */\r\n  readonly rotation$ = new BehaviorSubject<number>(0);\r\n\r\n  /**\r\n   * Observable of the current resolution\r\n   */\r\n  resolution$ = new BehaviorSubject<number>(undefined);\r\n\r\n  /**\r\n   * Observable of the current state\r\n   */\r\n  state$ = new BehaviorSubject<MapViewState>(undefined);\r\n\r\n  /**\r\n   * View Padding\r\n   * Values in the array are top, right, bottom and left padding.\r\n   */\r\n  padding = [0, 0, 0, 0];\r\n\r\n  /**\r\n   * Max zoom after set extent\r\n   */\r\n  maxZoomOnExtent = 19;\r\n\r\n  /**\r\n   * Max extent possible when zooming\r\n   */\r\n  maxLayerZoomExtent: MapExtent;\r\n\r\n  /**\r\n   * Extent stream\r\n   */\r\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\r\n\r\n  /**\r\n   * Subscription to the movement stream\r\n   */\r\n  private extent$$: Subscription;\r\n\r\n  /**\r\n   * History of states\r\n   */\r\n  private states: MapViewState[] = [];\r\n\r\n  /**\r\n   * Current state index\r\n   */\r\n  private stateIndex: number = 0;\r\n\r\n  /**\r\n   * Whether the view controller should keep the view's state history\r\n   */\r\n  get stateHistory(): boolean {\r\n    return this.options ? this.options.stateHistory === true : false;\r\n  }\r\n\r\n  /**\r\n   * OL View\r\n   */\r\n  get olView(): OlView {\r\n    return this.olMap.getView();\r\n  }\r\n\r\n  constructor(private options?: MapViewControllerOptions) {\r\n    super();\r\n  }\r\n\r\n  setPadding(padding: {\r\n    top?: number;\r\n    bottom?: number;\r\n    left?: number;\r\n    right?: number;\r\n  }) {\r\n    // Values in the array are top, right, bottom and left padding.\r\n    if (padding.top || padding.top === 0) {\r\n      this.padding[0] = padding.top;\r\n    }\r\n    if (padding.right || padding.right === 0) {\r\n      this.padding[1] = padding.right;\r\n    }\r\n    if (padding.bottom || padding.bottom === 0) {\r\n      this.padding[2] = padding.bottom;\r\n    }\r\n    if (padding.left || padding.left === 0) {\r\n      this.padding[3] = padding.left;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    super.setOlMap(olMap);\r\n    this.setupObservers();\r\n  }\r\n\r\n  /**\r\n   * Observe move moveend and subscribe to the extent stream\r\n   */\r\n  setupObservers() {\r\n    if (this.stateHistory === true) {\r\n      this.observerKeys.push(\r\n        this.olMap.on('moveend', (event: OlMapEvent) =>\r\n          this.onMoveEnd(event)\r\n        ) as EventsKey\r\n      );\r\n    }\r\n\r\n    this.extent$$ = this.extent$\r\n      .pipe(debounceTime(25))\r\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\r\n        this.setExtent(value.extent, value.action);\r\n      });\r\n  }\r\n\r\n  monitorRotation() {\r\n    this.observerKeys.push(\r\n      this.olMap.getView().on('change:rotation', (evt: ObjectEvent) => {\r\n        this.rotation$.next(evt.target.getRotation());\r\n      }) as EventsKey\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    super.teardownObservers();\r\n    if (this.extent$$ !== undefined) {\r\n      this.extent$$.unsubscribe();\r\n      this.extent$$ = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the view's OL projection\r\n   * @returns OL projection\r\n   */\r\n  getOlProjection(): OlProjection {\r\n    return this.olView.getProjection();\r\n  }\r\n\r\n  /**\r\n   * Get the current map view center\r\n   * @param projection Output projection\r\n   * @returns Center\r\n   */\r\n  getCenter(projection?: string | OlProjection): [number, number] {\r\n    let center = this.olView.getCenter() as [number, number];\r\n    if (projection && center) {\r\n      center = olproj.transform(center, this.getOlProjection(), projection) as [\r\n        number,\r\n        number\r\n      ];\r\n    }\r\n    return center;\r\n  }\r\n\r\n  /**\r\n   * Get the current view extent\r\n   * @param projection Output projection\r\n   * @returns Extent\r\n   */\r\n  getExtent(projection?: string | OlProjection): MapExtent {\r\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\r\n    if (projection && extent) {\r\n      extent = olproj.transformExtent(\r\n        extent,\r\n        this.getOlProjection(),\r\n        projection\r\n      );\r\n    }\r\n    return extent as [number, number, number, number];\r\n  }\r\n\r\n  /**\r\n   * Get the current scale\r\n   * @param dpi Dot per inches\r\n   * @returns View scale\r\n   */\r\n  getScale(dpi = 96) {\r\n    return getScaleFromResolution(\r\n      this.getResolution(),\r\n      this.getOlProjection().getUnits(),\r\n      dpi\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the current resolution\r\n   * @returns Projection denominator\r\n   */\r\n  getResolution(): number {\r\n    return this.olView.getResolution();\r\n  }\r\n\r\n  /**\r\n   * Get the current zoom level\r\n   * @returns Zoom level\r\n   */\r\n  getZoom(): number {\r\n    return Math.round(this.olView.getZoom());\r\n  }\r\n\r\n  /**\r\n   * Zoom in\r\n   */\r\n  zoomIn() {\r\n    this.zoomTo(this.olView.getZoom() + 1);\r\n  }\r\n\r\n  /**\r\n   * Zoom out\r\n   */\r\n  zoomOut() {\r\n    this.zoomTo(this.olView.getZoom() - 1);\r\n  }\r\n\r\n  /**\r\n   * Zoom to specific zoom level\r\n   * @param zoom Zoom level\r\n   */\r\n  zoomTo(zoom: number) {\r\n    this.olView.cancelAnimations();\r\n    this.olView.animate({\r\n      zoom,\r\n      duration: 250,\r\n      easing: oleasing.easeOut\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Move to extent after a short delay (100ms) unless\r\n   * a new movement gets registered in the meantime.\r\n   * @param extent Extent to move to\r\n   */\r\n  moveToExtent(extent: [number, number, number, number]) {\r\n    this.extent$.next({ extent, action: MapViewAction.Move });\r\n  }\r\n\r\n  /**\r\n   * Zoom to extent after a short delay (100ms) unless\r\n   * a new movement gets registered in the meantime.\r\n   * @param extent Extent to zoom to\r\n   */\r\n  zoomToExtent(extent: [number, number, number, number]) {\r\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\r\n  }\r\n\r\n  /**\r\n   * Return the current view rotation\r\n   * @returns Rotation angle in radians\r\n   */\r\n  getRotation(): number {\r\n    return this.olView.getRotation();\r\n  }\r\n\r\n  /**\r\n   * Reset the view rotation to 0\r\n   */\r\n  resetRotation() {\r\n    this.olView.animate({ rotation: 0 });\r\n  }\r\n\r\n  /**\r\n   * Whether the view has a previous state\r\n   * @returns True if the view has a previous state\r\n   */\r\n  hasPreviousState(): boolean {\r\n    return this.states.length > 1 && this.stateIndex > 0;\r\n  }\r\n\r\n  /**\r\n   * Whether the view has a next state\r\n   * @returns True if the view has a next state\r\n   */\r\n  hasNextState(): boolean {\r\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\r\n  }\r\n\r\n  /**\r\n   * Restore the previous view state\r\n   */\r\n  previousState() {\r\n    if (this.hasPreviousState()) {\r\n      this.setStateIndex(this.stateIndex - 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore the next view state\r\n   */\r\n  nextState() {\r\n    if (this.hasNextState()) {\r\n      this.setStateIndex(this.stateIndex + 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the state history\r\n   */\r\n  clearStateHistory() {\r\n    this.states = [];\r\n    this.stateIndex = 0;\r\n  }\r\n\r\n  /**\r\n   * Update the the view to it's intial state\r\n   */\r\n  setInitialState() {\r\n    if (this.states.length > 0) {\r\n      this.setStateIndex(0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move to the extent retrieved from the stream\r\n   * @param extent Extent\r\n   * @param action Either zoom or move\r\n   * @param animation With or without animation to the target extent.\r\n   */\r\n  private setExtent(\r\n    extent: MapExtent,\r\n    action: MapViewAction,\r\n    animation: boolean = true\r\n  ) {\r\n    const olView = this.olView;\r\n    olView.cancelAnimations();\r\n    const duration = animation ? 500 : 0;\r\n    const zoom = olView.getZoom();\r\n\r\n    const fromCenter = olView.getCenter();\r\n    const toCenter = [\r\n      extent[0] + (extent[2] - extent[0]) / 2,\r\n      extent[1] + (extent[3] - extent[1]) / 2\r\n    ];\r\n    const distCenter = Math.sqrt(\r\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\r\n        Math.pow(fromCenter[1] - toCenter[1], 2)\r\n    );\r\n    const fromExtent = olView.calculateExtent();\r\n    const fromSize = Math.sqrt(\r\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\r\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\r\n    );\r\n    const toSize = Math.sqrt(\r\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\r\n    );\r\n    const moySize = (toSize + fromSize) / 2;\r\n    const xSize = distCenter / moySize;\r\n\r\n    const maxZoom =\r\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\r\n        ? zoom\r\n        : this.maxZoomOnExtent;\r\n\r\n    olView.fit(extent, {\r\n      size: this.olMap.getSize(),\r\n      maxZoom,\r\n      padding: this.padding,\r\n      duration: xSize > 4 ? 0 : duration,\r\n      callback: (isFinished: boolean) => {\r\n        if (!isFinished) {\r\n          olView.fit(extent, {\r\n            size: this.olMap.getSize(),\r\n            maxZoom,\r\n            padding: this.padding,\r\n            duration: xSize > 4 ? 0 : duration\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the view state index\r\n   * @param index State index\r\n   */\r\n  private setStateIndex(index: number) {\r\n    this.stateIndex = index;\r\n    this.setState(this.states[index]);\r\n  }\r\n\r\n  /**\r\n   * Set the view state\r\n   * @param state View state\r\n   */\r\n  private setState(state: MapViewState) {\r\n    this.olView.animate({\r\n      resolution: state.resolution,\r\n      center: state.center,\r\n      duration: 0\r\n    });\r\n  }\r\n\r\n  /**\r\n   * On move end, get the view state and record it.\r\n   * @param event Map event\r\n   */\r\n  private onMoveEnd(event: OlMapEvent) {\r\n    const resolution = this.getResolution();\r\n    if (this.resolution$.value !== resolution) {\r\n      this.resolution$.next(resolution);\r\n    }\r\n\r\n    const state = {\r\n      resolution,\r\n      center: this.getCenter(),\r\n      zoom: this.getZoom()\r\n    };\r\n\r\n    if (this.stateHistory === true) {\r\n      const stateIndex = this.stateIndex;\r\n      const stateAtIndex =\r\n        this.states.length === 0 ? undefined : this.states[stateIndex];\r\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\r\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\r\n        this.stateIndex = this.states.length - 1;\r\n      }\r\n    }\r\n\r\n    this.state$.next(state);\r\n  }\r\n}\r\n","import { ProjectionLike } from 'ol/proj';\n\nexport interface MapGeolocationControllerOptions {\n  projection: ProjectionLike;\n  accuracyThreshold?: number;\n  followPosition?: boolean;\n  buffer?: GeolocationBuffer;\n}\n\nexport interface MapGeolocationState {\n  position: number[];\n  projection: string;\n  accuracy: number;\n  altitude: number;\n  altitudeAccuracy: number;\n  heading: number;\n  speed: number;\n  enableHighAccuracy: boolean;\n  timestamp: Date;\n}\nexport interface GeolocationBuffer {\n  bufferRadius?: number;\n  bufferStroke?: [number, number, number, number];\n  bufferFill?: [number, number, number, number];\n  showBufferRadius?: boolean;\n}\n\nexport enum GeolocationOverlayType {\n  Position = 'position',\n  PositionDirection = 'positionDirection',\n  Accuracy = 'accuracy',\n  Buffer = 'buffer'\n}\n","import { BehaviorSubject, interval, Subscription } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport OlMap from 'ol/Map';\r\nimport olGeolocation from 'ol/Geolocation';\r\nimport Geometry from 'ol/geom/Geometry';\r\nimport * as olproj from 'ol/proj';\r\nimport olFeature from 'ol/Feature';\r\nimport { MapController } from './controller';\r\nimport { Point, Polygon } from 'ol/geom';\r\nimport { fromCircle } from 'ol/geom/Polygon';\r\nimport * as olSphere from 'ol/sphere';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport * as olstyle from 'ol/style';\r\nimport { StorageService, ConfigService } from '@igo2/core';\r\nimport { Overlay } from '../../../overlay/shared/overlay';\r\nimport { FeatureMotion } from '../../../feature/shared/feature.enums';\r\nimport { MapViewOptions } from '../map.interface';\r\nimport { MapBase } from '../map.abstract';\r\nimport {\r\n  computeOlFeaturesExtent,\r\n  featuresAreOutOfView,\r\n  hideOlFeature,\r\n  moveToOlFeatures\r\n} from '../../../feature/shared/feature.utils';\r\nimport {\r\n  GeolocationBuffer,\r\n  GeolocationOverlayType,\r\n  MapGeolocationControllerOptions,\r\n  MapGeolocationState\r\n} from './geolocation.interface';\r\n\r\n/**\r\n * Controller to handle map view interactions\r\n */\r\nexport class MapGeolocationController extends MapController {\r\n  private arrowRotation: number;\r\n  private subscriptions$$: Subscription[] = [];\r\n  private geolocationOverlay: Overlay;\r\n  private positionFeatureStyle: olstyle.Style | olstyle.Style[] =\r\n    new olstyle.Style({\r\n      image: new olstyle.Circle({\r\n        radius: 6,\r\n        fill: new olstyle.Fill({\r\n          color: '#3399CC'\r\n        }),\r\n        stroke: new olstyle.Stroke({\r\n          color: '#fff',\r\n          width: 2\r\n        })\r\n      })\r\n    });\r\n  private accuracyFeatureStyle: olstyle.Style | olstyle.Style[] =\r\n    new olstyle.Style({\r\n      stroke: new olstyle.Stroke({\r\n        color: 'rgba(120, 120, 120, 0.4)',\r\n        width: 1\r\n      }),\r\n      fill: new olstyle.Fill({\r\n        color: 'rgba(120, 120, 120, 0.4)'\r\n      })\r\n    });\r\n\r\n  private get bufferStyle(): olstyle.Style {\r\n    return new olstyle.Style({\r\n      stroke: new olstyle.Stroke({ width: 2, color: this.buffer.bufferStroke }),\r\n      fill: new olstyle.Fill({ color: this.buffer.bufferFill }),\r\n      text: new olstyle.Text({\r\n        textAlign: 'left',\r\n        offsetX: 10,\r\n        offsetY: -10,\r\n        font: '12px Calibri,sans-serif',\r\n        text: this.buffer.showBufferRadius\r\n          ? `${this.buffer.bufferRadius}m`\r\n          : '',\r\n        fill: new olstyle.Fill({ color: '#000' }),\r\n        stroke: new olstyle.Stroke({ color: '#fff', width: 3 })\r\n      })\r\n    });\r\n  }\r\n\r\n  private get arrowStyle(): olstyle.Style {\r\n    return new olstyle.Style({\r\n      image: new olstyle.RegularShape({\r\n        radius: 5.5,\r\n        fill: new olstyle.Fill({\r\n          color: 'rgba(0, 132, 202)'\r\n        }),\r\n        stroke: new olstyle.Stroke({\r\n          color: '#fff',\r\n          width: 1.5\r\n        }),\r\n        points: 3,\r\n        displacement: [0, 9],\r\n        rotation: this.arrowRotation,\r\n        rotateWithView: true\r\n      })\r\n    });\r\n  }\r\n\r\n  private geolocation: olGeolocation;\r\n\r\n  /**\r\n   * Observable of the current emission interval of the position. In seconds\r\n   */\r\n  public readonly emissionIntervalSeconds$: BehaviorSubject<number> =\r\n    new BehaviorSubject(5);\r\n\r\n  /**\r\n   * Observable of the current position\r\n   */\r\n  public readonly position$ = new BehaviorSubject<MapGeolocationState>(\r\n    undefined\r\n  );\r\n  /**\r\n   * Observable of the tracking state\r\n   */\r\n  public readonly tracking$ = new BehaviorSubject<boolean>(undefined);\r\n  /**\r\n   * Observable of the follow position state\r\n   */\r\n  public readonly followPosition$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  private lastPosition: { coordinates: number[]; dateTime: Date };\r\n\r\n  /**\r\n   * Whether the geolocate should show a buffer around the current position\r\n   */\r\n  set buffer(value: GeolocationBuffer) {\r\n    this._buffer = value;\r\n    this.handleFeatureCreation(this.position$.value);\r\n  }\r\n  get buffer(): GeolocationBuffer {\r\n    return this._buffer;\r\n  }\r\n  private _buffer: GeolocationBuffer;\r\n\r\n  /**\r\n   * Whether the geolocate controller accuracy threshold to store/show the position.\r\n   */\r\n  set accuracyThreshold(value: number) {\r\n    this._accuracyThreshold = value;\r\n    this.handleFeatureCreation(this.position$.value);\r\n  }\r\n\r\n  get accuracyThreshold(): number {\r\n    return this._accuracyThreshold;\r\n  }\r\n  private _accuracyThreshold;\r\n\r\n  get olGeolocation() {\r\n    return this.geolocation;\r\n  }\r\n\r\n  /**\r\n   * Whether the activate the geolocation.\r\n   */\r\n  get tracking() {\r\n    return this.geolocation.getTracking();\r\n  }\r\n\r\n  set tracking(value: boolean) {\r\n    this.geolocation.setTracking(value || false);\r\n    this.tracking$.next(value);\r\n    if (this.storageService && value !== undefined) {\r\n      this.storageService.set('geolocation.tracking', value);\r\n    }\r\n    if (!value) {\r\n      this.position$.next(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether the activate the view tracking of the current position\r\n   */\r\n  set followPosition(value: boolean) {\r\n    this._followPosition = value;\r\n    this.followPosition$.next(value);\r\n    if (this.configService?.getConfig('geolocate.followPosition') === false) {\r\n      this._followPosition = false;\r\n      this.followPosition$.next(false);\r\n    }\r\n    this.handleFeatureCreation(this.position$.value);\r\n    if (this.storageService && value !== undefined) {\r\n      this.storageService.set('geolocation.followPosition', value);\r\n    }\r\n  }\r\n\r\n  get followPosition() {\r\n    return this._followPosition;\r\n  }\r\n\r\n  private _followPosition;\r\n\r\n  constructor(\r\n    private map: MapBase,\r\n    private options?: MapGeolocationControllerOptions,\r\n    private storageService?: StorageService,\r\n    private configService?: ConfigService\r\n  ) {\r\n    super();\r\n    this.geolocationOverlay = new Overlay(this.map);\r\n    this._followPosition =\r\n      this.options && this.options.followPosition\r\n        ? this.options.followPosition\r\n        : false;\r\n\r\n    this._buffer =\r\n      this.options && this.options.buffer ? this.options.buffer : undefined;\r\n    this._accuracyThreshold =\r\n      this.options && this.options.accuracyThreshold\r\n        ? this.options.accuracyThreshold\r\n        : 5000;\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    super.setOlMap(olMap);\r\n    this.setupObservers();\r\n  }\r\n\r\n  private deleteGeolocationFeatures() {\r\n    this.deleteFeatureByType(GeolocationOverlayType.Position);\r\n    this.deleteFeatureByType(GeolocationOverlayType.PositionDirection);\r\n    this.deleteFeatureByType(GeolocationOverlayType.Accuracy);\r\n    this.deleteFeatureByType(GeolocationOverlayType.Buffer);\r\n  }\r\n\r\n  setupObservers() {\r\n    this.tracking$.subscribe((tracking) => {\r\n      if (tracking) {\r\n        this.onPositionChange(true, true);\r\n      } else {\r\n        this.deleteGeolocationFeatures();\r\n      }\r\n    });\r\n\r\n    this.geolocation = new olGeolocation({\r\n      // enableHighAccuracy must be set to true to have the heading value.\r\n      trackingOptions: {\r\n        enableHighAccuracy: true,\r\n        maximumAge: 10000,\r\n        timeout: 600000\r\n      },\r\n      projection: this.options.projection\r\n    });\r\n    let tracking = false;\r\n    this.subscriptions$$.push(\r\n      this.emissionIntervalSeconds$\r\n        .pipe(switchMap((value) => interval(value * 1000)))\r\n        .subscribe(() => {\r\n          if (tracking === this.tracking) {\r\n            this.onPositionChange(true);\r\n          } else {\r\n            tracking = this.tracking;\r\n            this.onPositionChange(true, true);\r\n          }\r\n        })\r\n    );\r\n\r\n    this.geolocation.on('change', (evt) => {\r\n      this.onPositionChange(false, false);\r\n    });\r\n  }\r\n\r\n  updateArrowFeatureOrientation(position: MapGeolocationState) {\r\n    const position4326 = olproj.transform(\r\n      position.position,\r\n      position.projection,\r\n      'EPSG:4326'\r\n    );\r\n    if (!this.lastPosition) {\r\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\r\n      return;\r\n    }\r\n    const arrowFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.PositionDirection\r\n    );\r\n    const isMoving =\r\n      position?.speed > 1.25 &&\r\n      this.distanceBetweenPoints(this.lastPosition.coordinates, position4326) >\r\n        0.003;\r\n    if (position.accuracy <= this.accuracyThreshold && isMoving) {\r\n      // Calculate the heading using current position and last recorded\r\n      // because ol heading not returning right value\r\n      var dx = position4326[1] - this.lastPosition.coordinates[1];\r\n      var dy = position4326[0] - this.lastPosition.coordinates[0];\r\n      var theta = Math.atan2(dy, dx);\r\n      if (theta < 0) theta = 2 * Math.PI + theta;\r\n      this.arrowRotation = theta;\r\n      if (arrowFeature) {\r\n        arrowFeature.setStyle(this.arrowStyle);\r\n      }\r\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\r\n    } else {\r\n      if (\r\n        arrowFeature &&\r\n        new Date().getTime() - this.lastPosition.dateTime.getTime() > 3000\r\n      )\r\n        hideOlFeature(arrowFeature);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns distance in km between coord1 and coord2\r\n   */\r\n  private distanceBetweenPoints(coord1: number[], coord2: number[]): number {\r\n    return olSphere.getDistance(coord1, coord2) / 1000;\r\n  }\r\n\r\n  public addOnChangedListener(event: (geo: olGeolocation) => any) {\r\n    let listener = () => {\r\n      event(this.geolocation);\r\n    };\r\n    this.geolocation.on('change', listener);\r\n    return listener;\r\n  }\r\n\r\n  public deleteChangedListener(event: () => any) {\r\n    this.geolocation.un('change', event);\r\n  }\r\n\r\n  public updateGeolocationOptions(options: MapViewOptions) {\r\n    if (!options) {\r\n      return;\r\n    }\r\n    // todo maybe a dedicated interface for geolocation should be defined instead of putting these inside the mapviewoptions?\r\n    let tracking = options.geolocate;\r\n    let followPosition = options.alwaysTracking;\r\n    if (this.storageService) {\r\n      const storedTracking = this.storageService.get(\r\n        'geolocation.tracking'\r\n      ) as boolean;\r\n      if (storedTracking !== null && storedTracking !== undefined) {\r\n        tracking = storedTracking;\r\n      }\r\n\r\n      const storedFollowPosition = this.storageService.get(\r\n        'geolocation.followPosition'\r\n      ) as boolean;\r\n      if (storedFollowPosition !== null && storedFollowPosition !== undefined) {\r\n        followPosition = storedFollowPosition;\r\n      }\r\n    }\r\n    this.tracking = tracking;\r\n    this.followPosition = followPosition;\r\n    this.buffer = options.buffer;\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    if (this.subscriptions$$.length) {\r\n      this.subscriptions$$.map((s) => s.unsubscribe());\r\n    }\r\n    super.teardownObservers();\r\n  }\r\n\r\n  /**\r\n   * On position change, get the position, show it on the map and record it.\r\n   * @param emitEvent Map event\r\n   */\r\n  private onPositionChange(\r\n    emitEvent: boolean = false,\r\n    zoomTo: boolean = false\r\n  ) {\r\n    if (!this.tracking) {\r\n      return;\r\n    }\r\n    const geolocateProperties = this.geolocation.getProperties();\r\n\r\n    if (geolocateProperties.accuracy > this.accuracyThreshold) {\r\n      console.warn('Poor geolocation accuracy. No position are stored/shown');\r\n      this.position$.next(undefined);\r\n      return;\r\n    }\r\n\r\n    const position: MapGeolocationState = {\r\n      position: geolocateProperties.position,\r\n      projection: this.geolocation.getProjection().getCode(),\r\n      accuracy: geolocateProperties.accuracy,\r\n      altitude: geolocateProperties.altitude,\r\n      altitudeAccuracy: geolocateProperties.altitudeAccuracy,\r\n      heading: geolocateProperties.heading,\r\n      speed: geolocateProperties.speed,\r\n      enableHighAccuracy: geolocateProperties.trackingOptions\r\n        ?.enableHighAccuracy\r\n        ? true\r\n        : false,\r\n      timestamp: new Date()\r\n    };\r\n    this.handleFeatureCreation(position);\r\n    this.handleViewFromFeatures(position, zoomTo);\r\n    if (emitEvent) {\r\n      this.position$.next(position);\r\n    }\r\n  }\r\n\r\n  private getFeatureByType(type: GeolocationOverlayType): olFeature<Geometry> {\r\n    return this.geolocationOverlay.dataSource.ol.getFeatureById(type);\r\n  }\r\n\r\n  private deleteFeatureByType(type: GeolocationOverlayType) {\r\n    const featureById =\r\n      this.geolocationOverlay?.dataSource.ol.getFeatureById(type);\r\n    if (featureById) {\r\n      this.geolocationOverlay.dataSource.ol.removeFeature(featureById);\r\n    }\r\n  }\r\n\r\n  private handleFeatureCreation(position: MapGeolocationState) {\r\n    if (!position || !position.position) {\r\n      return;\r\n    }\r\n    const positionGeometry = new Point(position.position);\r\n    const accuracyGeometry = fromCircle(\r\n      new OlCircle(position.position, position.accuracy || 0)\r\n    );\r\n    let positionFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.Position\r\n    );\r\n    let positionFeatureArrow = this.getFeatureByType(\r\n      GeolocationOverlayType.PositionDirection\r\n    );\r\n    let accuracyFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.Accuracy\r\n    );\r\n    const positionFeatureExists = positionFeature ? true : false;\r\n    const positionFeatureArrowExists = positionFeatureArrow ? true : false;\r\n    const accuracyFeatureExists = accuracyFeature ? true : false;\r\n    if (!positionFeatureArrowExists) {\r\n      positionFeatureArrow = new olFeature<Point>({\r\n        geometry: positionGeometry\r\n      });\r\n      positionFeatureArrow.setId(GeolocationOverlayType.PositionDirection);\r\n      hideOlFeature(positionFeatureArrow);\r\n    }\r\n    if (!positionFeatureExists) {\r\n      positionFeature = new olFeature<Point>({ geometry: positionGeometry });\r\n      positionFeature.setId(GeolocationOverlayType.Position);\r\n      positionFeature.setStyle(this.positionFeatureStyle);\r\n    }\r\n    if (!accuracyFeatureExists) {\r\n      accuracyFeature = new olFeature<Polygon>({ geometry: accuracyGeometry });\r\n      accuracyFeature.setId(GeolocationOverlayType.Accuracy);\r\n      accuracyFeature.setStyle(this.accuracyFeatureStyle);\r\n    }\r\n\r\n    if (positionGeometry) {\r\n      positionFeatureExists\r\n        ? positionFeature.setGeometry(positionGeometry)\r\n        : this.geolocationOverlay.addOlFeature(\r\n            positionFeature,\r\n            FeatureMotion.None\r\n          );\r\n      positionFeatureArrowExists\r\n        ? positionFeatureArrow.setGeometry(positionGeometry)\r\n        : this.geolocationOverlay.addOlFeature(\r\n            positionFeatureArrow,\r\n            FeatureMotion.None\r\n          );\r\n      this.updateArrowFeatureOrientation(position);\r\n      accuracyFeatureExists\r\n        ? accuracyFeature.setGeometry(accuracyGeometry)\r\n        : this.geolocationOverlay.addOlFeature(\r\n            accuracyFeature,\r\n            FeatureMotion.None\r\n          );\r\n\r\n      if (this.buffer) {\r\n        let bufferFeature = this.getFeatureByType(\r\n          GeolocationOverlayType.Buffer\r\n        );\r\n        const bufferFeatureExists = bufferFeature ? true : false;\r\n        const bufferGeometry = new OlCircle(\r\n          position.position,\r\n          this.buffer.bufferRadius\r\n        );\r\n        if (!bufferFeatureExists) {\r\n          bufferFeature = new olFeature(bufferGeometry);\r\n          bufferFeature.setId(GeolocationOverlayType.Buffer);\r\n          bufferFeature.setStyle(this.positionFeatureStyle);\r\n        }\r\n        bufferFeature.setStyle(this.bufferStyle);\r\n        bufferFeatureExists\r\n          ? bufferFeature.setGeometry(bufferGeometry)\r\n          : this.geolocationOverlay.addOlFeature(\r\n              bufferFeature,\r\n              FeatureMotion.None\r\n            );\r\n      }\r\n    }\r\n  }\r\n  handleViewFromFeatures(\r\n    position: MapGeolocationState,\r\n    zoomTo: boolean = false\r\n  ) {\r\n    let positionFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.Position\r\n    );\r\n    let positionFeatureArrow = this.getFeatureByType(\r\n      GeolocationOverlayType.PositionDirection\r\n    );\r\n    let accuracyFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.Accuracy\r\n    );\r\n    let bufferFeature = this.getFeatureByType(GeolocationOverlayType.Buffer);\r\n    const features = [\r\n      positionFeature,\r\n      positionFeatureArrow,\r\n      accuracyFeature,\r\n      bufferFeature\r\n    ].filter((f) => f);\r\n    if (features.length > 0) {\r\n      const featuresExtent = computeOlFeaturesExtent(\r\n        features,\r\n        this.map.viewProjection\r\n      );\r\n      const edgeRatios =\r\n        position?.speed > 12.5\r\n          ? [0.25, 0.25, 0.25, 0.25]\r\n          : [0.15, 0.1, 0.1, 0.1];\r\n      const areOutOfView = featuresAreOutOfView(\r\n        this.map.getExtent(),\r\n        featuresExtent,\r\n        edgeRatios\r\n      );\r\n      let motion =\r\n        this.followPosition && areOutOfView\r\n          ? FeatureMotion.Move\r\n          : FeatureMotion.None;\r\n      if (zoomTo) {\r\n        motion = FeatureMotion.Zoom;\r\n      }\r\n      motion !== FeatureMotion.None\r\n        ? moveToOlFeatures(this.map.viewController, features, motion)\r\n        : undefined;\r\n    }\r\n  }\r\n}\r\n","import { ObjectEvent } from 'ol/Object';\r\nimport { getUid } from 'ol/util';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport {\r\n  OgcFilterableDataSource,\r\n  OgcFilterableDataSourceOptions\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\r\nimport olSourceImageWMS from 'ol/source/ImageWMS';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport {\r\n  TimeFilterableDataSource,\r\n  TimeFilterableDataSourceOptions\r\n} from '../../datasource';\r\nimport { MapBase } from '../shared/map.abstract';\r\n\r\nexport function getLinkedLayersOptions(layer: Layer) {\r\n  return layer.options.linkedLayers;\r\n}\r\n\r\nexport function getIgoLayerByLinkId(map: MapBase, id: string) {\r\n  return map.layers.find((l) => l.options.linkedLayers?.linkId === id);\r\n}\r\n\r\nexport function layerHasLinkWithProperty(\r\n  layer: Layer,\r\n  property: LinkedProperties\r\n): boolean {\r\n  let hasLinkWithProperty = false;\r\n  const layerLLOptions = getLinkedLayersOptions(layer);\r\n  if (layerLLOptions?.links) {\r\n    const link = layerLLOptions.links.find((l) =>\r\n      l.properties.includes(property)\r\n    );\r\n    hasLinkWithProperty = link ? true : false;\r\n  }\r\n  return hasLinkWithProperty;\r\n}\r\n\r\nexport function layerHasLinkDeletion(layer: Layer): boolean {\r\n  let hasLinkWithSyncedDelete = false;\r\n  const layerLLOptions = getLinkedLayersOptions(layer);\r\n  if (layerLLOptions?.links) {\r\n    const link = layerLLOptions.links.find((l) => l.syncedDelete);\r\n    hasLinkWithSyncedDelete = link ? true : false;\r\n  }\r\n  return hasLinkWithSyncedDelete;\r\n}\r\n\r\nexport function getRootParentByProperty(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  property: LinkedProperties\r\n): Layer {\r\n  let layerToUse = layer;\r\n  let parentLayer = layerToUse;\r\n  let hasParentLayer = true;\r\n  while (hasParentLayer) {\r\n    layerToUse = parentLayer;\r\n    parentLayer = getDirectParentLayerByProperty(map, layerToUse, property);\r\n    hasParentLayer = parentLayer ? true : false;\r\n  }\r\n  if (!hasParentLayer) {\r\n    if (!layerHasLinkWithProperty(layerToUse, property)) {\r\n      layerToUse = undefined;\r\n    }\r\n  }\r\n  return hasParentLayer ? parentLayer : layerToUse;\r\n}\r\n\r\nexport function getDirectParentLayerByProperty(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  property: LinkedProperties\r\n): Layer {\r\n  if (layer?.options.linkedLayers?.linkId) {\r\n    const currentLinkId = layer.options.linkedLayers.linkId;\r\n    let parents = map.layers.filter((pl) => {\r\n      const linkedLayers = pl.options.linkedLayers;\r\n      if (linkedLayers && linkedLayers.links) {\r\n        const a = linkedLayers.links.find(\r\n          (l) =>\r\n            l.linkedIds.includes(currentLinkId) &&\r\n            l.properties.includes(property)\r\n        );\r\n        return a;\r\n      }\r\n    });\r\n    if (parents.length > 1) {\r\n      console.warn(`Your layer ${\r\n        layer.title || layer.id\r\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\r\n            , The first parent (${\r\n              parents[0].title || parents[0].id\r\n            }) will be use to sync properties`);\r\n    }\r\n    return parents[0];\r\n  }\r\n}\r\n\r\nexport function getDirectChildLayersByProperty(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  property: LinkedProperties\r\n): Layer[] {\r\n  let linkedIds = [];\r\n  if (layer?.options.linkedLayers?.links) {\r\n    layer.options.linkedLayers.links\r\n      .filter((l) => l.properties.includes(property))\r\n      .map((link) => {\r\n        linkedIds = linkedIds.concat(link.linkedIds);\r\n      });\r\n  }\r\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\r\n}\r\n\r\nexport function getAllChildLayersByProperty(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  knownChildLayers: Layer[],\r\n  property: LinkedProperties\r\n): Layer[] {\r\n  let childLayers = getDirectChildLayersByProperty(map, layer, property);\r\n  childLayers.map((cl) => {\r\n    knownChildLayers.push(cl);\r\n    const directChildLayers = getDirectChildLayersByProperty(map, cl, property);\r\n    if (directChildLayers) {\r\n      getAllChildLayersByProperty(map, cl, knownChildLayers, property);\r\n    }\r\n  });\r\n  return knownChildLayers;\r\n}\r\n\r\nexport function getRootParentByDeletion(map: MapBase, layer: Layer): Layer {\r\n  let layerToUse = layer;\r\n  let parentLayer = layerToUse;\r\n  let hasParentLayer = true;\r\n  while (hasParentLayer) {\r\n    layerToUse = parentLayer;\r\n    parentLayer = getDirectParentLayerByDeletion(map, layerToUse);\r\n    hasParentLayer = parentLayer ? true : false;\r\n  }\r\n  if (!hasParentLayer) {\r\n    if (!layerHasLinkDeletion(layerToUse)) {\r\n      layerToUse = undefined;\r\n    }\r\n  }\r\n  return hasParentLayer ? parentLayer : layerToUse;\r\n}\r\n\r\nexport function getDirectParentLayerByDeletion(\r\n  map: MapBase,\r\n  layer: Layer\r\n): Layer {\r\n  if (layer.options.linkedLayers?.linkId) {\r\n    const currentLinkId = layer.options.linkedLayers.linkId;\r\n    let parents = map.layers.filter((pl) => {\r\n      const linkedLayers = pl.options.linkedLayers;\r\n      if (linkedLayers && linkedLayers.links) {\r\n        const a = linkedLayers.links.find(\r\n          (l) => l.linkedIds.includes(currentLinkId) && l.syncedDelete\r\n        );\r\n        return a;\r\n      }\r\n    });\r\n    if (parents.length > 1) {\r\n      console.warn(`Your layer ${\r\n        layer.title || layer.id\r\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\r\n          , The first parent (${\r\n            parents[0].title || parents[0].id\r\n          }) will be use to sync properties`);\r\n    }\r\n    return parents[0];\r\n  }\r\n}\r\n\r\nexport function getDirectChildLayersByDeletion(\r\n  map: MapBase,\r\n  layer: Layer\r\n): Layer[] {\r\n  let linkedIds = [];\r\n  if (layer?.options.linkedLayers?.links) {\r\n    layer.options.linkedLayers.links\r\n      .filter((l) => l.syncedDelete)\r\n      .map((link) => {\r\n        linkedIds = linkedIds.concat(link.linkedIds);\r\n      });\r\n  }\r\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\r\n}\r\n\r\nexport function getAllChildLayersByDeletion(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  knownChildLayers: Layer[]\r\n): Layer[] {\r\n  let childLayers = getDirectChildLayersByDeletion(map, layer);\r\n  childLayers.map((cl) => {\r\n    knownChildLayers.push(cl);\r\n    const directChildLayers = getDirectChildLayersByDeletion(map, cl);\r\n    if (directChildLayers) {\r\n      getAllChildLayersByDeletion(map, cl, knownChildLayers);\r\n    }\r\n  });\r\n  return knownChildLayers;\r\n}\r\n\r\nexport function initLayerSyncFromRootParentLayers(\r\n  map: MapBase,\r\n  layers: Layer[]\r\n) {\r\n  const rootLayersByProperty = {};\r\n  const keys = Object.keys(LinkedProperties);\r\n  keys.map((k) => {\r\n    rootLayersByProperty[LinkedProperties[k]] = [];\r\n  });\r\n  layers\r\n    .filter((l) => getLinkedLayersOptions(l))\r\n    .map((l) => {\r\n      keys.map((key) => {\r\n        const k = LinkedProperties[key];\r\n        const plbp = getRootParentByProperty(map, l, k as LinkedProperties);\r\n        const layers = rootLayersByProperty[k];\r\n        const layersId = layers.map((l) => l.id);\r\n        if (plbp && !layersId.includes(plbp.id)) {\r\n          rootLayersByProperty[k].push(plbp);\r\n        }\r\n      });\r\n    });\r\n  Object.keys(rootLayersByProperty).map((k) => {\r\n    const layers = rootLayersByProperty[k];\r\n    layers.map((l: Layer) => l.ol.notify(k, undefined));\r\n  });\r\n}\r\n\r\nexport function handleLayerPropertyChange(\r\n  map: MapBase,\r\n  propertyChange: ObjectEvent,\r\n  initiatorIgoLayer: Layer\r\n) {\r\n  if (!propertyChange) {\r\n    return;\r\n  }\r\n  const ogcFilterWriter = new OgcFilterWriter();\r\n  let isLayerProperty = true;\r\n  let isDatasourceProperty = true;\r\n  const key = propertyChange.key;\r\n  let newValue;\r\n  if (key === 'ogcFilters') {\r\n    isLayerProperty = false;\r\n    isDatasourceProperty = true;\r\n    newValue = (\r\n      initiatorIgoLayer.dataSource.options as OgcFilterableDataSourceOptions\r\n    ).ogcFilters;\r\n  } else if (key === 'timeFilter') {\r\n    isLayerProperty = false;\r\n    isDatasourceProperty = true;\r\n    newValue = (\r\n      initiatorIgoLayer.dataSource.options as TimeFilterableDataSourceOptions\r\n    ).timeFilter;\r\n  } else {\r\n    isLayerProperty = true;\r\n    isDatasourceProperty = false;\r\n    newValue = initiatorIgoLayer.ol.get(key);\r\n  }\r\n\r\n  const initiatorLinkedLayersOptions =\r\n    getLinkedLayersOptions(initiatorIgoLayer);\r\n  if (initiatorLinkedLayersOptions) {\r\n    let rootParentByProperty = getRootParentByProperty(\r\n      map,\r\n      initiatorIgoLayer,\r\n      key as LinkedProperties\r\n    );\r\n    if (!rootParentByProperty) {\r\n      rootParentByProperty = initiatorIgoLayer;\r\n    }\r\n\r\n    const clbp = [rootParentByProperty];\r\n    getAllChildLayersByProperty(\r\n      map,\r\n      rootParentByProperty,\r\n      clbp,\r\n      key as LinkedProperties\r\n    );\r\n\r\n    let resolutionPropertyHasChanged = false;\r\n    const initiatorIgoLayerSourceType =\r\n      initiatorIgoLayer.options.source.options.type;\r\n    const initiatorIgoLayerOgcFilterableDataSourceOptions = initiatorIgoLayer\r\n      .dataSource.options as OgcFilterableDataSourceOptions;\r\n    clbp.map((l) => {\r\n      if (\r\n        initiatorIgoLayer &&\r\n        l &&\r\n        getUid(initiatorIgoLayer.ol) !== getUid(l?.ol)\r\n      ) {\r\n        const lLayerType = l.options.source.options.type;\r\n        if (isLayerProperty) {\r\n          l.ol.set(key, newValue, true);\r\n          if (key === 'visible') {\r\n            l.visible$.next(newValue);\r\n          }\r\n          if (key === 'minResolution' || key === 'maxResolution') {\r\n            resolutionPropertyHasChanged = true;\r\n          }\r\n        } else if (isDatasourceProperty) {\r\n          if (key === 'ogcFilters') {\r\n            (l.dataSource as OgcFilterableDataSource).setOgcFilters(\r\n              newValue,\r\n              false\r\n            );\r\n            if (lLayerType === 'wfs') {\r\n              l.ol.getSource().refresh();\r\n            }\r\n            if (lLayerType === 'wms') {\r\n              let appliedOgcFilter;\r\n              if (initiatorIgoLayerSourceType === 'wfs') {\r\n                appliedOgcFilter = ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n                  initiatorIgoLayerOgcFilterableDataSourceOptions,\r\n                  (initiatorIgoLayer.dataSource.options as any)\r\n                    .fieldNameGeometry,\r\n                  undefined,\r\n                  map.viewController.getOlProjection()\r\n                );\r\n              } else if (initiatorIgoLayerSourceType === 'wms') {\r\n                appliedOgcFilter = (\r\n                  initiatorIgoLayer.dataSource as WMSDataSource\r\n                ).ol.getParams().FILTER;\r\n              }\r\n              (l.dataSource as WMSDataSource).ol.updateParams({\r\n                FILTER: appliedOgcFilter\r\n              });\r\n            }\r\n          } else if (\r\n            l.dataSource instanceof WMSDataSource &&\r\n            key === 'timeFilter'\r\n          ) {\r\n            (l.dataSource as TimeFilterableDataSource).setTimeFilter(\r\n              newValue,\r\n              false\r\n            );\r\n            const appliedTimeFilter = (\r\n              initiatorIgoLayer.ol.getSource() as olSourceImageWMS\r\n            ).getParams().TIME;\r\n            l.dataSource.ol.updateParams({ TIME: appliedTimeFilter });\r\n          }\r\n        }\r\n      }\r\n    });\r\n    if (resolutionPropertyHasChanged) {\r\n      map.viewController.resolution$.next(map.viewController.resolution$.value);\r\n    }\r\n  }\r\n}\r\n","import olMap from 'ol/Map';\r\nimport olView, { ViewOptions } from 'ol/View';\r\nimport olControlAttribution from 'ol/control/Attribution';\r\nimport olControlScaleLine from 'ol/control/ScaleLine';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olproj4 from 'ol/proj/proj4';\r\nimport OlProjection from 'ol/proj/Projection';\r\nimport * as olinteraction from 'ol/interaction';\r\nimport { getUid } from 'ol/util';\r\nimport olLayer from 'ol/layer/Layer';\r\nimport olSource from 'ol/source/Source';\r\n\r\nimport proj4 from 'proj4';\r\nimport { BehaviorSubject, pairwise, skipWhile, Subject } from 'rxjs';\r\n\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport { Layer, VectorLayer } from '../../layer/shared/layers';\r\nimport { Overlay } from '../../overlay/shared/overlay';\r\n\r\nimport { LayerWatcher } from '../utils/layer-watcher';\r\nimport {\r\n  MapViewOptions,\r\n  MapOptions,\r\n  MapAttributionOptions,\r\n  MapScaleLineOptions,\r\n  MapExtent,\r\n  MapControlsOptions\r\n} from './map.interface';\r\nimport { MapBase } from './map.abstract';\r\nimport { MapViewController } from './controllers/view';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { MapGeolocationController } from './controllers/geolocation';\r\nimport { StorageService, ConfigService } from '@igo2/core';\r\nimport { ObjectEvent } from 'ol/Object';\r\nimport {\r\n  getAllChildLayersByDeletion,\r\n  getRootParentByDeletion,\r\n  handleLayerPropertyChange,\r\n  initLayerSyncFromRootParentLayers\r\n} from './linkedLayers.utils';\r\n\r\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\r\n// Move some stuff into controllers.\r\nexport class IgoMap implements MapBase {\r\n  public ol: olMap;\r\n  public forcedOffline$ = new BehaviorSubject<boolean>(false);\r\n  public layers$ = new BehaviorSubject<Layer[]>([]);\r\n  public layersAddedByClick$ = new BehaviorSubject<Layer[]>(undefined);\r\n  public status$: Subject<SubjectStatus>;\r\n  public propertyChange$: Subject<{ event: ObjectEvent; layer: Layer }>;\r\n  public overlay: Overlay;\r\n  public queryResultsOverlay: Overlay;\r\n  public searchResultsOverlay: Overlay;\r\n  public viewController: MapViewController;\r\n  public geolocationController: MapGeolocationController;\r\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\r\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\r\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\r\n\r\n  public bufferDataSource: FeatureDataSource;\r\n\r\n  private layerWatcher: LayerWatcher;\r\n  private options: MapOptions;\r\n  private mapViewOptions: MapViewOptions;\r\n  private defaultOptions: Partial<MapOptions> = {\r\n    controls: { attribution: false }\r\n  };\r\n\r\n  get layers(): Layer[] {\r\n    return this.layers$.value;\r\n  }\r\n\r\n  /** @deprecated use projectionCode */\r\n  get projection(): string {\r\n    return this.projectionCode;\r\n  }\r\n\r\n  get viewProjection(): olproj.Projection {\r\n    return this.viewController.getOlProjection();\r\n  }\r\n\r\n  get projectionCode(): string {\r\n    return this.viewProjection.getCode();\r\n  }\r\n\r\n  constructor(\r\n    options?: MapOptions,\r\n    private storageService?: StorageService,\r\n    private configService?: ConfigService\r\n  ) {\r\n    this.options = Object.assign({}, this.defaultOptions, options);\r\n    this.layerWatcher = new LayerWatcher();\r\n    this.status$ = this.layerWatcher.status$;\r\n    this.propertyChange$ = this.layerWatcher.propertyChange$;\r\n    olproj4.register(proj4);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    const controls = [];\r\n    if (this.options.controls) {\r\n      if (this.options.controls.attribution) {\r\n        const attributionOpt = (\r\n          this.options.controls.attribution === true\r\n            ? {}\r\n            : this.options.controls.attribution\r\n        ) as MapAttributionOptions;\r\n        controls.push(new olControlAttribution(attributionOpt));\r\n      }\r\n      if (this.options.controls.scaleLine) {\r\n        const scaleLineOpt = (\r\n          this.options.controls.scaleLine === true\r\n            ? {}\r\n            : this.options.controls.scaleLine\r\n        ) as MapScaleLineOptions;\r\n        controls.push(new olControlScaleLine(scaleLineOpt));\r\n      }\r\n    }\r\n    let interactions = {};\r\n    if (this.options.interactions === false) {\r\n      interactions = {\r\n        altShiftDragRotate: false,\r\n        doubleClickZoom: false,\r\n        keyboard: false,\r\n        mouseWheelZoom: false,\r\n        shiftDragZoom: false,\r\n        dragPan: false,\r\n        pinchRotate: false,\r\n        pinchZoom: false\r\n      };\r\n    }\r\n\r\n    this.ol = new olMap({\r\n      interactions: olinteraction.defaults(interactions),\r\n      controls\r\n    });\r\n\r\n    this.setView(this.options.view || {});\r\n    this.viewController = new MapViewController({\r\n      stateHistory: true\r\n    });\r\n    this.viewController.setOlMap(this.ol);\r\n    this.overlay = new Overlay(this);\r\n    this.queryResultsOverlay = new Overlay(this);\r\n    this.searchResultsOverlay = new Overlay(this);\r\n    this.ol.once('rendercomplete', () => {\r\n      this.geolocationController = new MapGeolocationController(\r\n        this,\r\n        {\r\n          projection: this.viewController.getOlProjection()\r\n        },\r\n        this.storageService,\r\n        this.configService\r\n      );\r\n      this.geolocationController.setOlMap(this.ol);\r\n      if (this.geolocationController) {\r\n        this.geolocationController.updateGeolocationOptions(\r\n          this.mapViewOptions\r\n        );\r\n      }\r\n      this.layers$.pipe(pairwise()).subscribe(([prevLayers, currentLayers]) => {\r\n        let prevLayersId;\r\n        if (prevLayers) {\r\n          prevLayersId = prevLayers.map((l) => l.id);\r\n        }\r\n        const layers = currentLayers.filter(\r\n          (l) => !prevLayersId.includes(l.id)\r\n        );\r\n\r\n        for (const layer of layers) {\r\n          if (layer.options.linkedLayers) {\r\n            layer.ol.once('postrender', () => {\r\n              initLayerSyncFromRootParentLayers(this, layers);\r\n            });\r\n          }\r\n        }\r\n      });\r\n      this.viewController.monitorRotation();\r\n    });\r\n    this.propertyChange$\r\n      .pipe(skipWhile((pc) => !pc))\r\n      .subscribe((p) => handleLayerPropertyChange(this, p.event, p.layer));\r\n  }\r\n\r\n  setTarget(id: string) {\r\n    this.ol.setTarget(id);\r\n    if (id !== undefined) {\r\n      this.layerWatcher.subscribe(() => {}, null);\r\n    } else {\r\n      this.layerWatcher.unsubscribe();\r\n    }\r\n  }\r\n\r\n  updateView(options: MapViewOptions) {\r\n    const currentView = this.ol.getView();\r\n    const viewOptions: MapViewOptions = {\r\n      ...currentView.getProperties(),\r\n      ...options\r\n    };\r\n\r\n    if (options.zoom && options.resolution == null) {\r\n      viewOptions.resolution = undefined;\r\n    }\r\n\r\n    this.setView(viewOptions);\r\n    if (options.maxZoomOnExtent) {\r\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\r\n    }\r\n    this.mapViewOptions = options;\r\n  }\r\n\r\n  /**\r\n   * Set the map view\r\n   * @param options Map view options\r\n   */\r\n  setView(options: MapViewOptions) {\r\n    if (this.viewController !== undefined) {\r\n      this.viewController.clearStateHistory();\r\n    }\r\n\r\n    const viewOptions: ViewOptions = { constrainResolution: true, ...options };\r\n    if (options.center) {\r\n      viewOptions.center = olproj.fromLonLat(\r\n        options.center,\r\n        options.projection\r\n      );\r\n    }\r\n\r\n    this.ol.setView(new olView(viewOptions));\r\n\r\n    if (options.maxLayerZoomExtent) {\r\n      this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\r\n    }\r\n  }\r\n\r\n  updateControls(value: MapControlsOptions) {\r\n    if (value === undefined) {\r\n      return;\r\n    }\r\n\r\n    const controls = [];\r\n    if (value.attribution) {\r\n      const attributionOpt = (\r\n        value.attribution === true ? {} : value.attribution\r\n      ) as MapAttributionOptions;\r\n      controls.push(new olControlAttribution(attributionOpt));\r\n    }\r\n    if (value.scaleLine) {\r\n      const scaleLineOpt = (\r\n        value.scaleLine === true ? {} : value.scaleLine\r\n      ) as MapScaleLineOptions;\r\n      controls.push(new olControlScaleLine(scaleLineOpt));\r\n    }\r\n\r\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\r\n    currentControls.forEach((control) => {\r\n      this.ol.removeControl(control);\r\n    });\r\n    controls.forEach((control) => {\r\n      this.ol.addControl(control);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Deprecated\r\n   * TODO: Move to ViewController and update every place it's used\r\n   */\r\n  getCenter(projection?: string | OlProjection): [number, number] {\r\n    return this.viewController.getCenter(projection);\r\n  }\r\n\r\n  /**\r\n   * Deprecated\r\n   * TODO: Move to ViewController and update every place it's used\r\n   */\r\n  getExtent(projection?: string | OlProjection): MapExtent {\r\n    return this.viewController.getExtent(projection);\r\n  }\r\n\r\n  // TODO: Move to ViewController and update every place it's used\r\n  getZoom(): number {\r\n    return this.viewController.getZoom();\r\n  }\r\n\r\n  changeBaseLayer(baseLayer: Layer) {\r\n    if (!baseLayer) {\r\n      return;\r\n    }\r\n\r\n    for (const bl of this.getBaseLayers()) {\r\n      bl.visible = false;\r\n    }\r\n\r\n    baseLayer.visible = true;\r\n\r\n    this.viewController.olView.setMinZoom(\r\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\r\n    );\r\n    this.viewController.olView.setMaxZoom(\r\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\r\n    );\r\n  }\r\n\r\n  getBaseLayers(): Layer[] {\r\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\r\n  }\r\n\r\n  getLayerById(id: string): Layer {\r\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\r\n  }\r\n\r\n  getLayerByAlias(alias: string): Layer {\r\n    return this.layers.find(\r\n      (layer: Layer) => layer.alias && layer.alias === alias\r\n    );\r\n  }\r\n\r\n  getLayerByOlUId(olUId: string): Layer {\r\n    return this.layers.find(\r\n      (layer: Layer) => getUid(layer.ol) && getUid(layer.ol) === olUId\r\n    );\r\n  }\r\n\r\n  getLayerByOlLayer(olLayer: olLayer<olSource>): Layer {\r\n    const olUId = getUid(olLayer);\r\n    return this.getLayerByOlUId(olUId);\r\n  }\r\n\r\n  /**\r\n   * Add a single layer\r\n   * @param layer Layer to add\r\n   * @param push DEPRECATED\r\n   */\r\n  addLayer(layer: Layer, push = true) {\r\n    this.addLayers([layer]);\r\n  }\r\n\r\n  /**\r\n   * Add many layers\r\n   * @param layers Layers to add\r\n   * @param push DEPRECATED\r\n   */\r\n  addLayers(layers: Layer[], push = true) {\r\n    let offsetZIndex = 0;\r\n    let offsetBaseLayerZIndex = 0;\r\n    const addedLayers = layers\r\n      .map((layer: Layer) => {\r\n        if (!layer) {\r\n          return;\r\n        }\r\n        const offset = layer.zIndex\r\n          ? 0\r\n          : layer.baseLayer\r\n          ? offsetBaseLayerZIndex++\r\n          : offsetZIndex++;\r\n        return this.doAddLayer(layer, offset);\r\n      })\r\n      .filter((layer: Layer | undefined) => layer !== undefined);\r\n    this.setLayers([].concat(this.layers, addedLayers));\r\n  }\r\n\r\n  /**\r\n   * Remove a single layer\r\n   * @param layer Layer to remove\r\n   */\r\n  removeLayer(layer: Layer) {\r\n    this.removeLayers([layer]);\r\n  }\r\n\r\n  /**\r\n   * Remove many layers\r\n   * @param layers Layers to remove\r\n   */\r\n  removeLayers(layers: Layer[]) {\r\n    const newLayers = this.layers$.value.slice(0);\r\n    const layersToRemove = [];\r\n    layers.forEach((layer: Layer) => {\r\n      if (layer instanceof VectorLayer) {\r\n        layer.removeLayerFromIDB();\r\n      }\r\n      const index = newLayers.indexOf(layer);\r\n      if (index >= 0) {\r\n        layersToRemove.push(layer);\r\n        newLayers.splice(index, 1);\r\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\r\n        layersToRemove.map((linkedLayer) => {\r\n          const linkedIndex = newLayers.indexOf(linkedLayer);\r\n          if (linkedIndex >= 0) {\r\n            newLayers.splice(linkedIndex, 1);\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\r\n    this.setLayers(newLayers);\r\n  }\r\n\r\n  /**\r\n   * Build a list of linked layers to delete\r\n   * @param srcLayer Layer that has triggered the deletion\r\n   * @param layersToRemove list to append the layer to delete into\r\n   */\r\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\r\n    let rootParentByDeletion = getRootParentByDeletion(this, srcLayer);\r\n    if (!rootParentByDeletion) {\r\n      rootParentByDeletion = srcLayer;\r\n    }\r\n    const clbd = getAllChildLayersByDeletion(this, rootParentByDeletion, [\r\n      rootParentByDeletion\r\n    ]);\r\n    for (const layer of clbd) {\r\n      layersToRemove.push(layer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all layers\r\n   */\r\n  removeAllLayers() {\r\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\r\n    this.layers$.next([]);\r\n  }\r\n\r\n  raiseLayer(layer: Layer) {\r\n    const index = this.getLayerIndex(layer);\r\n    if (index > 1) {\r\n      this.moveLayer(layer, index, index - 1);\r\n    }\r\n  }\r\n\r\n  raiseLayers(layers: Layer[]) {\r\n    for (const layer of layers) {\r\n      this.raiseLayer(layer);\r\n    }\r\n  }\r\n\r\n  lowerLayer(layer: Layer) {\r\n    const index = this.getLayerIndex(layer);\r\n    if (index < this.layers.length - 1) {\r\n      this.moveLayer(layer, index, index + 1);\r\n    }\r\n  }\r\n\r\n  lowerLayers(layers: Layer[]) {\r\n    const reverseLayers = layers.reverse();\r\n    for (const layer of reverseLayers) {\r\n      this.lowerLayer(layer);\r\n    }\r\n  }\r\n\r\n  moveLayer(layer: Layer, from: number, to: number) {\r\n    const layerTo = this.layers[to];\r\n    const zIndexTo = layerTo.zIndex;\r\n    const zIndexFrom = layer.zIndex;\r\n\r\n    if (layerTo.baseLayer || layer.baseLayer) {\r\n      return;\r\n    }\r\n\r\n    layer.zIndex = zIndexTo;\r\n    layerTo.zIndex = zIndexFrom;\r\n\r\n    this.layers[to] = layer;\r\n    this.layers[from] = layerTo;\r\n    this.layers$.next(this.layers.slice(0));\r\n  }\r\n\r\n  /**\r\n   * Add a layer to the OL map and start watching. If the layer is already\r\n   * added to this map, make it visible but don't add it one again.\r\n   * @param layer Layer\r\n   * @returns The layer added, if any\r\n   */\r\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\r\n    if (layer.baseLayer && layer.visible) {\r\n      this.changeBaseLayer(layer);\r\n    }\r\n\r\n    const existingLayer = this.getLayerById(layer.id);\r\n    if (existingLayer !== undefined) {\r\n      existingLayer.visible = true;\r\n      return;\r\n    }\r\n\r\n    if (!layer.baseLayer && layer.zIndex) {\r\n      layer.zIndex += 10;\r\n    }\r\n\r\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\r\n      const maxZIndex = Math.max(\r\n        layer.baseLayer ? 0 : 10,\r\n        ...this.layers\r\n          .filter(\r\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\r\n          )\r\n          .map((l) => l.zIndex)\r\n      );\r\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\r\n    }\r\n\r\n    if (layer.baseLayer && layer.zIndex > 9) {\r\n      layer.zIndex = 10; // baselayer must have zIndex < 10\r\n    }\r\n\r\n    layer.setMap(this);\r\n    this.layerWatcher.watchLayer(layer);\r\n    this.ol.addLayer(layer.ol);\r\n\r\n    return layer;\r\n  }\r\n\r\n  /**\r\n   * Remove a layer from the OL map and stop watching\r\n   * @param layer Layer\r\n   */\r\n  private doRemoveLayer(layer: Layer) {\r\n    this.layerWatcher.unwatchLayer(layer);\r\n    this.ol.removeLayer(layer.ol);\r\n    layer.setMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Update the layers observable\r\n   * @param layers Layers\r\n   */\r\n  private setLayers(layers: Layer[]) {\r\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\r\n  }\r\n\r\n  /**\r\n   * Sort layers by descending zIndex\r\n   * @param layers Array of layers\r\n   * @returns The original array, sorted by zIndex\r\n   */\r\n  private sortLayersByZIndex(layers: Layer[]) {\r\n    // Sort by descending zIndex\r\n    return layers.sort(\r\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get layer index in the map's inenr array of layers\r\n   * @param layer Layer\r\n   * @returns The layer index\r\n   */\r\n  private getLayerIndex(layer: Layer) {\r\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  AfterViewInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { SubjectStatus } from '@igo2/utils';\r\nimport { ActivityService } from '@igo2/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\r\n\r\n@Component({\r\n  selector: 'igo-map-browser',\r\n  templateUrl: './map-browser.component.html',\r\n  styleUrls: ['./map-browser.component.scss']\r\n})\r\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\r\n  private activityId: string;\r\n  private status$$: Subscription;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get view(): MapViewOptions {\r\n    return this._view;\r\n  }\r\n  set view(value: MapViewOptions) {\r\n    this._view = value;\r\n    if (this.map !== undefined) {\r\n      this.map.updateView(value);\r\n    }\r\n  }\r\n  private _view: MapViewOptions;\r\n\r\n  get controls(): MapControlsOptions {\r\n    return this._controls;\r\n  }\r\n\r\n  set controls(value: MapControlsOptions) {\r\n    this._controls = value;\r\n    if (this.map !== undefined) {\r\n      this.map.updateControls(value);\r\n    }\r\n  }\r\n  private _controls: MapControlsOptions;\r\n\r\n  public id = `igo-map-target-${new Date().getTime()}`;\r\n\r\n  constructor(private activityService: ActivityService) {}\r\n\r\n  ngOnInit() {\r\n    this.status$$ = this.map.status$.subscribe((status) =>\r\n      this.handleStatusChange(status)\r\n    );\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    this.map.setTarget(this.id);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.map.setTarget(undefined);\r\n    this.activityService.unregister(this.activityId);\r\n    this.status$$.unsubscribe();\r\n  }\r\n\r\n  private handleStatusChange(status: SubjectStatus) {\r\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\r\n      this.activityId = this.activityService.register();\r\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\r\n      this.activityService.unregister(this.activityId);\r\n      this.activityId = undefined;\r\n    }\r\n  }\r\n}\r\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  Self,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\n\r\nimport { transform } from 'ol/proj';\r\nimport { MediaService } from '@igo2/core';\r\nimport { unByKey } from 'ol/Observable';\r\n/**\r\n * This directive return the pointer coordinate (on click or pointermove)\r\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\r\n * to avoid too many emitted values.\r\n */\r\n@Directive({\r\n  selector: '[igoPointerPosition]'\r\n})\r\nexport class PointerPositionDirective implements OnInit, OnDestroy {\r\n  private lastTimeoutRequest;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener;\r\n\r\n  /**\r\n   * Listener to the map click event\r\n   */\r\n  private mapClickListener;\r\n\r\n  /**\r\n   * Delay before emitting an event\r\n   */\r\n  @Input() pointerPositionDelay: number = 1000;\r\n\r\n  /**\r\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\r\n   */\r\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.listenToMapPointerMove();\r\n    this.listenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * Stop listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unlistenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: MapBrowserPointerEvent<any>) =>\r\n        this.onPointerEvent(event, this.pointerPositionDelay)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On map click\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    unByKey(this.pointerMoveListener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map clicks\r\n   */\r\n  private unlistenToMapClick() {\r\n    this.mapClickListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\r\n    if (event.dragging || this.mediaService.isTouchScreen()) {\r\n      return;\r\n    }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n\r\n    const lonlat = transform(\r\n      event.coordinate,\r\n      this.mapProjection,\r\n      'EPSG:4326'\r\n    ) as [number, number];\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      this.pointerPositionCoord.emit(lonlat);\r\n    }, delay);\r\n  }\r\n}\r\n","import * as olStyle from 'ol/style';\r\nimport * as olGeom from 'ol/geom';\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { StyleService } from '../../style-service/style.service';\r\n\r\nexport function featureRandomStyleFunction(): (\r\n  olFeature: olFeature<OlGeometry>,\r\n  resolution: number\r\n) => olStyle.Style {\r\n  const r = Math.floor(Math.random() * 255);\r\n  const g = Math.floor(Math.random() * 255);\r\n  const b = Math.floor(Math.random() * 255);\r\n  const stroke = new olStyle.Stroke({\r\n    color: [r, g, b, 1],\r\n    width: 2\r\n  });\r\n  const fill = new olStyle.Fill({\r\n    color: [r, g, b, 0.4]\r\n  });\r\n  return (olFeature: olFeature<OlGeometry>, resolution: number) => {\r\n    const customStyle = olFeature.get('_style');\r\n    if (customStyle) {\r\n      if (\r\n        customStyle.circle &&\r\n        olFeature.get('rad') &&\r\n        olFeature.get('longitude') &&\r\n        olFeature.get('latitude')\r\n      ) {\r\n        const lonLat: [number, number] = [\r\n          olFeature.get('longitude'),\r\n          olFeature.get('latitude')\r\n        ];\r\n        const radius =\r\n          olFeature.get('rad') /\r\n          Math.cos((Math.PI / 180) * lonLat[1]) /\r\n          resolution;\r\n        customStyle.circle.radius = radius;\r\n      }\r\n      const styleService = new StyleService();\r\n      return styleService.createStyle(customStyle, undefined, resolution);\r\n    }\r\n    const style = new olStyle.Style({\r\n      stroke,\r\n      fill,\r\n      image: new olStyle.Circle({\r\n        radius: 5,\r\n        stroke,\r\n        fill\r\n      }),\r\n      text: olFeature.get('_mapTitle')\r\n        ? new olStyle.Text({\r\n            text: olFeature.get('_mapTitle').toString(),\r\n            offsetX: 5,\r\n            offsetY: -5,\r\n            font: '12px Calibri,sans-serif',\r\n            fill: new olStyle.Fill({ color: '#000' }),\r\n            stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\r\n            overflow: true\r\n          })\r\n        : undefined\r\n    });\r\n    return style;\r\n  };\r\n}\r\n\r\nexport function featureRandomStyle(): olStyle.Style {\r\n  const r = Math.floor(Math.random() * 255);\r\n  const g = Math.floor(Math.random() * 255);\r\n  const b = Math.floor(Math.random() * 255);\r\n  const stroke = new olStyle.Stroke({\r\n    color: [r, g, b, 1],\r\n    width: 2\r\n  });\r\n  const fill = new olStyle.Fill({\r\n    color: [r, g, b, 0.4]\r\n  });\r\n\r\n  const style = new olStyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olStyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    })\r\n  });\r\n  return style;\r\n}\r\n\r\n/**\r\n * Create a default style for the pointer position and it's label summary.\r\n * @param feature olFeature\r\n * @returns OL style function\r\n */\r\nexport function hoverFeatureMarkerStyle(\r\n  feature: olFeature<olGeom.Geometry>,\r\n  resolution: number\r\n): olStyle.Style[] {\r\n  const olStyleText = new olStyle.Style({\r\n    text: new olStyle.Text({\r\n      text: feature.get('hoverSummary'),\r\n      textAlign: 'left',\r\n      textBaseline: 'top',\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olStyle.Fill({ color: '#000' }),\r\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\r\n      backgroundStroke: new olStyle.Stroke({\r\n        color: 'rgba(200, 200, 200, 0.75)',\r\n        width: 2\r\n      }),\r\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true,\r\n      offsetX: 10,\r\n      offsetY: 20,\r\n      padding: [2.5, 2.5, 2.5, 2.5]\r\n    })\r\n  });\r\n  const olStyles = [olStyleText];\r\n  switch (feature.getGeometry().getType()) {\r\n    case 'Point':\r\n      olStyles.push(\r\n        new olStyle.Style({\r\n          image: new olStyle.Circle({\r\n            radius: 10,\r\n            stroke: new olStyle.Stroke({\r\n              color: 'blue',\r\n              width: 3\r\n            })\r\n          })\r\n        })\r\n      );\r\n      break;\r\n    default:\r\n      olStyles.push(\r\n        new olStyle.Style({\r\n          stroke: new olStyle.Stroke({\r\n            color: 'white',\r\n            width: 5\r\n          })\r\n        })\r\n      );\r\n      olStyles.push(\r\n        new olStyle.Style({\r\n          stroke: new olStyle.Stroke({\r\n            color: 'blue',\r\n            width: 3\r\n          })\r\n        })\r\n      );\r\n  }\r\n\r\n  return olStyles;\r\n}\r\n\r\n/**\r\n * Create a default style for the pointer position and it's label summary.\r\n * @param feature olFeature\r\n * @returns OL style function\r\n */\r\nexport function pointerPositionSummaryMarkerStyle(\r\n  feature: olFeature<OlGeometry>,\r\n  resolution: number\r\n): olStyle.Style {\r\n  return new olStyle.Style({\r\n    image: new olStyle.Icon({\r\n      src: './assets/igo2/geo/icons/cross_black_18px.svg'\r\n    }),\r\n\r\n    text: new olStyle.Text({\r\n      text: feature.get('pointerSummary'),\r\n      textAlign: 'left',\r\n      textBaseline: 'bottom',\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olStyle.Fill({ color: '#000' }),\r\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\r\n      backgroundStroke: new olStyle.Stroke({\r\n        color: 'rgba(200, 200, 200, 0.75)',\r\n        width: 2\r\n      }),\r\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true,\r\n      offsetX: 10,\r\n      offsetY: -10,\r\n      padding: [2.5, 2.5, 2.5, 2.5]\r\n    })\r\n  });\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  OnDestroy,\r\n  Self,\r\n  OnInit,\r\n  HostListener\r\n} from '@angular/core';\r\nimport olLayerVectorTile from 'ol/layer/VectorTile';\r\nimport olLayerVector from 'ol/layer/Vector';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport olVectorTileSource from 'ol/source/VectorTile';\r\n\r\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\n\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlFeature from 'ol/Feature';\r\nimport * as OlGeom from 'ol/geom';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { VectorLayer, Layer, VectorTileLayer } from '../../layer/shared/layers';\r\nimport { first } from 'rxjs/operators';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\r\nimport { MediaService } from '@igo2/core';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { unByKey } from 'ol/Observable';\r\nimport RenderFeature from 'ol/render/Feature';\r\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\r\nimport { hoverFeatureMarkerStyle } from '../../style/shared/feature/feature-style';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\n/**\r\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\r\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\r\n * By default, no search sources. Config in config file must be defined.\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoHoverFeature]'\r\n})\r\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\r\n  public store: FeatureStore<Feature>;\r\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> =\r\n    new EntityStore<OlFeature<OlGeometry>>([]);\r\n  private lastTimeoutRequest;\r\n  private store$$: Subscription;\r\n  private layers$$: Subscription;\r\n\r\n  private selectionLayer: olLayerVectorTile;\r\n  private selectionMVT = {};\r\n  private mvtStyleOptions: StyleByAttribute;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener;\r\n\r\n  private singleClickMapListener;\r\n\r\n  private hoverFeatureId: string = 'hoverFeatureId';\r\n  /**\r\n   * The delay where the mouse must be motionless before trigger the reverse search\r\n   */\r\n  @Input() igoHoverFeatureDelay: number = 1000;\r\n\r\n  /**\r\n   * If the user has enabled or not the directive\r\n   */\r\n  @Input() igoHoverFeatureEnabled: boolean = false;\r\n\r\n  @HostListener('mouseout')\r\n  mouseout() {\r\n    clearTimeout(this.lastTimeoutRequest);\r\n    this.clearLayer();\r\n  }\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private mediaService: MediaService,\r\n    private styleService: StyleService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.listenToMapPointerMove();\r\n    this.subscribeToPointerStore();\r\n    this.listenToMapClick();\r\n\r\n    this.map.status$\r\n      .pipe(first((status) => status === SubjectStatus.Done))\r\n      .subscribe(() => {\r\n        this.store = new FeatureStore<Feature>([], { map: this.map });\r\n        this.initStore();\r\n      });\r\n\r\n    // To handle context change without using the contextService.\r\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\r\n      if (this.store && !layers.find((l) => l.id === 'hoverFeatureId')) {\r\n        this.initStore();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize the pointer position store\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      isIgoInternalLayer: true,\r\n      id: 'hoverFeatureId',\r\n      title: 'hoverFeature',\r\n      zIndex: 900,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      style: hoverFeatureMarkerStyle\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n\r\n    this.selectionLayer = new olLayerVectorTile({\r\n      map: this.map.ol,\r\n      zIndex: 901,\r\n      renderMode: 'vector',\r\n      declutter: true,\r\n      source: new olVectorTileSource({ projection: this.map.projection }),\r\n      style: (feature, resolution) => {\r\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\r\n          return this.createHoverStyle(\r\n            feature,\r\n            this.mvtStyleOptions,\r\n            resolution\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  createHoverStyle(\r\n    feature: RenderFeature | OlFeature<OlGeometry>,\r\n    hoverStyle: StyleByAttribute,\r\n    resolution: number\r\n  ) {\r\n    const localHoverStyle = { ...hoverStyle };\r\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\r\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\r\n\r\n    if (!feature.get('_isLabel')) {\r\n      localHoverStyle.label = undefined;\r\n      hasLabelStyle = false;\r\n      label = undefined;\r\n    } else {\r\n      // clear the style for label....\r\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\r\n      const radius = [];\r\n      const stroke = [];\r\n      const width = [];\r\n      const fill = [];\r\n      for (let i = 0; i < size; i++) {\r\n        radius.push(0);\r\n        stroke.push('rgba(255, 255, 255, 0)');\r\n        width.push(0);\r\n        fill.push('rgba(255, 255, 255, 0)');\r\n      }\r\n      localHoverStyle.radius = radius;\r\n      localHoverStyle.stroke = stroke;\r\n      localHoverStyle.width = width;\r\n      localHoverStyle.fill = fill;\r\n    }\r\n    if (!hasLabelStyle && label) {\r\n      localHoverStyle.label.style = {\r\n        textAlign: 'left',\r\n        textBaseline: 'top',\r\n        font: '12px Calibri,sans-serif',\r\n        fill: { color: '#000' },\r\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\r\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\r\n        stroke: { color: '#fff', width: 3 },\r\n        overflow: true,\r\n        offsetX: 10,\r\n        offsetY: 20,\r\n        padding: [2.5, 2.5, 2.5, 2.5]\r\n      };\r\n    }\r\n    return this.styleService.createStyleByAttribute(\r\n      feature,\r\n      localHoverStyle,\r\n      resolution\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unsubscribeToPointerStore();\r\n    this.unlistenToMapSingleClick();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to pointermove result store\r\n   * @internal\r\n   */\r\n  subscribeToPointerStore() {\r\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(\r\n      (resultsUnderPointerPosition) => {\r\n        this.addFeatureOverlay(resultsUnderPointerPosition);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On map singleclick\r\n   */\r\n  private listenToMapClick() {\r\n    this.singleClickMapListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to pointer store.\r\n   * @internal\r\n   */\r\n  unsubscribeToPointerStore() {\r\n    this.store$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   * @internal\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    unByKey(this.pointerMoveListener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map singleclick\r\n   * @internal\r\n   */\r\n  private unlistenToMapSingleClick() {\r\n    unByKey(this.singleClickMapListener);\r\n    this.singleClickMapListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Trigger clear layer on singleclick.\r\n   * @param event OL map browser singleclick event\r\n   */\r\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\r\n    this.clearLayer();\r\n  }\r\n\r\n  /**\r\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\r\n    if (\r\n      event.dragging ||\r\n      !this.igoHoverFeatureEnabled ||\r\n      this.mediaService.isTouchScreen()\r\n    ) {\r\n      this.clearLayer();\r\n      return;\r\n    }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n    let maximumZindex = -Infinity;\r\n    let topMostOlLayer;\r\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\r\n      this.map.ol.forEachFeatureAtPixel(\r\n        pixel,\r\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\r\n          if (!layerOL) {\r\n            return;\r\n          }\r\n          const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\r\n          if (!this.canProcessHover(igoLayer as any)) {\r\n            return;\r\n          }\r\n          if (igoLayer.zIndex <= maximumZindex) {\r\n            return;\r\n          }\r\n          maximumZindex = igoLayer.zIndex;\r\n          topMostOlLayer = layerOL;\r\n        },\r\n        {\r\n          hitTolerance: 10,\r\n          layerFilter: (olLayer) =>\r\n            olLayer instanceof olLayerVector ||\r\n            olLayer instanceof olLayerVectorTile\r\n        }\r\n      );\r\n      if (!topMostOlLayer) {\r\n        // To clear label\r\n        this.clearLayer();\r\n        this.pointerHoverFeatureStore.clear();\r\n        return;\r\n      }\r\n\r\n      this.map.ol.forEachFeatureAtPixel(\r\n        pixel,\r\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\r\n          // To avoid flashing feature\r\n          if (\r\n            mapFeature.get('hoverSummary') === undefined &&\r\n            mapFeature.getProperties() !==\r\n              this.pointerHoverFeatureStore.all()[0]?.getProperties()\r\n          ) {\r\n            this.clearLayer();\r\n            let igoLayer;\r\n            if (layerOL instanceof olLayerVector) {\r\n              const myLayerVector = this.map.getLayerByOlUId(\r\n                (layerOL as any).ol_uid\r\n              ) as VectorLayer;\r\n              if (!this.canProcessHover(myLayerVector)) {\r\n                return;\r\n              }\r\n              let localOlFeature = this.handleRenderFeature(mapFeature);\r\n              this.setLayerStyleFromOptions(myLayerVector, localOlFeature);\r\n              const featuresToLoad = [localOlFeature];\r\n              localOlFeature.set('_isLabel', false);\r\n              const myLabelOlFeature = new OlFeature();\r\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\r\n              const labelGeom =\r\n                localOlFeature.getGeometry().getType() === 'Point'\r\n                  ? localOlFeature.getGeometry()\r\n                  : new OlGeom.Point(event.coordinate);\r\n              myLabelOlFeature.setGeometry(labelGeom);\r\n              myLabelOlFeature.setId(localOlFeature.getId());\r\n              myLabelOlFeature.set('_isLabel', true);\r\n              this.setLayerStyleFromOptions(myLayerVector, myLabelOlFeature);\r\n              featuresToLoad.push(myLabelOlFeature);\r\n              this.pointerHoverFeatureStore.load(featuresToLoad);\r\n              igoLayer = myLayerVector;\r\n              return true;\r\n            }\r\n            if (layerOL instanceof olLayerVectorTile) {\r\n              const myLayerVectorTile = this.map.getLayerByOlUId(\r\n                (layerOL as any).ol_uid\r\n              ) as VectorTileLayer;\r\n              if (!this.canProcessHover(myLayerVectorTile)) {\r\n                return;\r\n              }\r\n              if (\r\n                myLayerVectorTile?.options?.igoStyle?.styleByAttribute\r\n                  ?.hoverStyle\r\n              ) {\r\n                this.mvtStyleOptions =\r\n                  myLayerVectorTile.options.igoStyle.styleByAttribute.hoverStyle;\r\n              } else if (myLayerVectorTile?.options?.igoStyle?.hoverStyle) {\r\n                this.mvtStyleOptions =\r\n                  myLayerVectorTile.options.igoStyle.hoverStyle;\r\n              }\r\n              this.selectionLayer.setSource(layerOL.getSource());\r\n              layerOL\r\n                .getFeatures(event.pixel)\r\n                .then(\r\n                  (mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\r\n                    if (!mvtFeatures.length) {\r\n                      this.selectionMVT = {};\r\n                      this.selectionLayer.changed();\r\n                      this.clearLayer();\r\n                      return;\r\n                    }\r\n                    const feature = mvtFeatures[0];\r\n                    if (!feature) {\r\n                      this.clearLayer();\r\n                      return;\r\n                    }\r\n                    let localOlFeature = this.handleRenderFeature(feature);\r\n                    localOlFeature.set('_isLabel', false);\r\n                    const myLabelOlFeature = new OlFeature();\r\n                    myLabelOlFeature.setProperties(\r\n                      localOlFeature.getProperties()\r\n                    );\r\n                    const labelGeom =\r\n                      localOlFeature.getGeometry().getType() === 'Point'\r\n                        ? localOlFeature.getGeometry()\r\n                        : new OlGeom.Point(event.coordinate);\r\n                    myLabelOlFeature.setGeometry(labelGeom);\r\n                    myLabelOlFeature.setId(localOlFeature.getId());\r\n                    myLabelOlFeature.set('_isLabel', true);\r\n                    this.setLayerStyleFromOptions(\r\n                      myLayerVectorTile,\r\n                      myLabelOlFeature\r\n                    );\r\n                    this.pointerHoverFeatureStore.load([myLabelOlFeature]);\r\n                    this.selectionMVT[feature.getId()] = localOlFeature;\r\n                    this.selectionLayer.changed();\r\n                  }\r\n                );\r\n              igoLayer = myLayerVectorTile;\r\n            }\r\n          }\r\n        },\r\n        {\r\n          hitTolerance: 10,\r\n          layerFilter: (olLayer) => olLayer === topMostOlLayer\r\n        }\r\n      );\r\n    }, this.igoHoverFeatureDelay);\r\n  }\r\n\r\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\r\n    if (!igoLayer) {\r\n      return false;\r\n    }\r\n    if (!igoLayer.visible) {\r\n      return false;\r\n    }\r\n    if (!igoLayer.options) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      !igoLayer.options.igoStyle?.styleByAttribute &&\r\n      !igoLayer.options.igoStyle?.hoverStyle\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      igoLayer.options.igoStyle?.styleByAttribute &&\r\n      !igoLayer.options.igoStyle?.styleByAttribute.hoverStyle &&\r\n      !igoLayer.options.igoStyle?.hoverStyle\r\n    ) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  handleRenderFeature(\r\n    feature: RenderFeature | OlFeature<OlGeometry>\r\n  ): OlFeature<OlGeometry> {\r\n    let localFeature: OlFeature<OlGeometry>;\r\n    if (feature instanceof RenderFeature) {\r\n      localFeature = new OlFeature({\r\n        geometry: this.getGeometry(feature)\r\n      });\r\n      localFeature.setId(feature.getId());\r\n    } else if (feature instanceof OlFeature) {\r\n      localFeature = feature;\r\n    }\r\n    localFeature.setProperties(feature.getProperties());\r\n    return localFeature;\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the pointer store\r\n   * @param text string\r\n   */\r\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\r\n    if (hoverEntity.length > 0) {\r\n      const result = hoverEntity[0];\r\n      this.clearLayer();\r\n      const feature = new OlFeature({\r\n        geometry: result.getGeometry(),\r\n        meta: { id: this.hoverFeatureId },\r\n        hoverSummary: this.getHoverSummary(result.getProperties())\r\n      });\r\n\r\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\r\n    }\r\n  }\r\n\r\n  private setLayerStyleFromOptions(\r\n    igoLayer: VectorLayer | VectorTileLayer,\r\n    feature: OlFeature<OlGeometry>\r\n  ) {\r\n    const resolution = this.store.layer.map.viewController.getResolution();\r\n    if (igoLayer?.options?.igoStyle?.styleByAttribute?.hoverStyle) {\r\n      this.store.layer.ol.setStyle(\r\n        this.createHoverStyle(\r\n          feature,\r\n          igoLayer.options.igoStyle.styleByAttribute.hoverStyle,\r\n          resolution\r\n        )\r\n      );\r\n      return;\r\n    }\r\n    if (igoLayer?.options?.igoStyle?.hoverStyle) {\r\n      this.store.layer.ol.setStyle(\r\n        this.createHoverStyle(\r\n          feature,\r\n          igoLayer.options.igoStyle.hoverStyle,\r\n          resolution\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  private getHoverSummary(properties): string {\r\n    let summary = '';\r\n    for (const [key, value] of Object.entries(properties)) {\r\n      if (!key.startsWith('_') && key !== 'geometry') {\r\n        summary += `${key}: ${value}` + '\\n';\r\n      }\r\n    }\r\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\r\n  }\r\n\r\n  private getGeometry(feature): OlGeom.Geometry {\r\n    let geom;\r\n    if (!feature.getOrientedFlatCoordinates) {\r\n      geom = feature.getGeometry();\r\n    } else {\r\n      const coords = feature.getOrientedFlatCoordinates();\r\n      const flatCoords = [];\r\n\r\n      coords.forEach((c, idx) => {\r\n        if (idx % 2 === 0) {\r\n          flatCoords.push([\r\n            parseFloat(coords[idx]),\r\n            parseFloat(coords[idx + 1])\r\n          ]);\r\n        }\r\n      });\r\n\r\n      // TODO: test MultiX\r\n      switch (feature.getType()) {\r\n        case 'Point':\r\n          geom = new OlGeom.Point(flatCoords);\r\n          break;\r\n        case 'Polygon':\r\n          geom = new OlGeom.Polygon([flatCoords]);\r\n          break;\r\n        case 'LineString':\r\n          geom = new OlGeom.LineString([flatCoords]);\r\n          break;\r\n      }\r\n    }\r\n\r\n    return geom;\r\n  }\r\n\r\n  /**\r\n   * Clear the pointer store features\r\n   */\r\n  private clearLayer() {\r\n    this.selectionMVT = {};\r\n    if (this.selectionLayer) {\r\n      this.selectionLayer.changed();\r\n    }\r\n    if (this.store) {\r\n      this.store.clearLayer();\r\n    }\r\n  }\r\n}\r\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\r\n\r\n/**\r\n * Return a number of zone MTM for a longitude for province of Quebec only\r\n * @param lon number\r\n * @returns zone\r\n */\r\nexport function zoneMtm(lon: number): number {\r\n  let lonMin = -54;\r\n  const lonMax = -81;\r\n  if (lon < lonMax || lon > lonMin) {\r\n    return 0;\r\n  } else {\r\n    const deltaLon = 3;\r\n    let zone = 2;\r\n    while (Math.abs(lon - lonMin) > deltaLon) {\r\n      lonMin = lonMin - deltaLon;\r\n      zone++;\r\n    }\r\n    return zone;\r\n  }\r\n}\r\n/**\r\n * Return a number of zone UTM for a longitude\r\n * @param lon number\r\n * @returns zone\r\n */\r\nexport function zoneUtm(lon: number): number {\r\n  let lonMin = -180;\r\n  const lonMax = 180;\r\n  const deltaLon = 6;\r\n  let zone = 1;\r\n  while (Math.abs(lon - lonMin) > deltaLon) {\r\n    lonMin = lonMin + deltaLon;\r\n    zone++;\r\n  }\r\n  return zone;\r\n}\r\n\r\n/**\r\n * Compute the contraints of projections\r\n * @param projectionsLimitations: ProjectionsLimitationsOptions\r\n * @returns projectionsContraints: ProjectionsLimitationsOptions\r\n */\r\nexport function computeProjectionsConstraints(\r\n  projectionsLimitations: ProjectionsLimitationsOptions\r\n): ProjectionsLimitationsOptions {\r\n  const mtmZone = projectionsLimitations.mtmZone;\r\n  const utmZone = projectionsLimitations.utmZone;\r\n  const projectionsConstraints = {\r\n    projFromConfig:\r\n      projectionsLimitations.projFromConfig === false ? false : true,\r\n    nad83: projectionsLimitations.nad83 === false ? false : true,\r\n    wgs84: projectionsLimitations.wgs84 === false ? false : true,\r\n    webMercator: projectionsLimitations.webMercator === false ? false : true,\r\n    utm: projectionsLimitations.utm === false ? false : true,\r\n    mtm: projectionsLimitations.mtm === false ? false : true,\r\n    utmZone: {\r\n      minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\r\n      maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21\r\n    },\r\n    mtmZone: {\r\n      minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\r\n      maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10\r\n    }\r\n  };\r\n  return projectionsConstraints;\r\n}\r\n","export enum InsertSourceInsertDBEnum {\r\n  System = 'system',\r\n  User = 'user'\r\n}\r\n","import olLayerVector from 'ol/layer/Vector';\r\nimport olSourceVector from 'ol/source/Vector';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { easeOut } from 'ol/easing';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\nimport { getVectorContext } from 'ol/render';\r\nimport olFeature from 'ol/Feature';\r\nimport olProjection from 'ol/proj/Projection';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olformat from 'ol/format';\r\n\r\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\r\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\r\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\r\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\r\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\r\n\r\nimport { VectorWatcher } from '../../utils';\r\nimport { IgoMap, MapExtent, getResolutionFromScale } from '../../../map/shared';\r\nimport { Layer } from './layer';\r\nimport { VectorLayerOptions } from './vector-layer.interface';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { MessageService } from '@igo2/core';\r\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport {\r\n  buildUrl,\r\n  defaultMaxFeatures\r\n} from '../../../datasource/shared/datasources/wms-wfs.utils';\r\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\r\nimport {\r\n  GeoNetworkService,\r\n  SimpleGetOptions\r\n} from '../../../offline/shared/geo-network.service';\r\nimport {\r\n  catchError,\r\n  concatMap,\r\n  debounceTime,\r\n  delay,\r\n  first\r\n} from 'rxjs/operators';\r\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\r\nimport { fromEvent, of, zip } from 'rxjs';\r\nimport { InsertSourceInsertDBEnum } from '../../../offline/geoDB/geoDB.enums';\r\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\r\nimport { LayerDBData } from '../../../offline';\r\nimport BaseEvent from 'ol/events/Event';\r\nimport { olStyleToBasicIgoStyle } from '../../../style/shared/vector/conversion.utils';\r\nimport { FeatureDataSourceOptions } from '../../../datasource/shared/datasources/feature-datasource.interface';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nexport class VectorLayer extends Layer {\r\n  public declare dataSource:\r\n    | FeatureDataSource\r\n    | WFSDataSource\r\n    | ArcGISRestDataSource\r\n    | WebSocketDataSource\r\n    | ClusterDataSource;\r\n  public declare options: VectorLayerOptions;\r\n  public declare ol: olLayerVector<olSourceVector<OlGeometry>>;\r\n  private watcher: VectorWatcher;\r\n  private trackFeatureListenerId;\r\n\r\n  get browsable(): boolean {\r\n    return this.options.browsable !== false;\r\n  }\r\n\r\n  get exportable(): boolean {\r\n    return this.options.exportable !== false;\r\n  }\r\n\r\n  constructor(\r\n    options: VectorLayerOptions,\r\n    public messageService?: MessageService,\r\n    public authInterceptor?: AuthInterceptor,\r\n    private geoNetworkService?: GeoNetworkService,\r\n    public geoDBService?: GeoDBService,\r\n    public layerDBService?: LayerDBService\r\n  ) {\r\n    super(\r\n      options,\r\n      messageService,\r\n      authInterceptor,\r\n      geoDBService,\r\n      layerDBService\r\n    );\r\n    this.watcher = new VectorWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\r\n    const initialOpacityValue = this.options.opacity || 1;\r\n    const initialVisibleValue = this.options.visible !== false;\r\n    const initialMinResValue =\r\n      this.options.minResolution ||\r\n      getResolutionFromScale(Number(this.options.minScaleDenom));\r\n    const initialMaxResValue =\r\n      this.options.maxResolution ||\r\n      getResolutionFromScale(Number(this.options.maxScaleDenom));\r\n    const so = this.options.sourceOptions as FeatureDataSourceOptions;\r\n    if (this.dataSource instanceof FeatureDataSource) {\r\n      if (so?.preload?.bypassResolution || so?.preload?.bypassVisible) {\r\n        this.options.opacity = 0;\r\n        if (\r\n          so.preload.bypassResolution &&\r\n          (this.options.minResolution || this.options.maxResolution)\r\n        ) {\r\n          this.options.minResolution = 0;\r\n          this.options.maxResolution = Infinity;\r\n        }\r\n        if (so.preload.bypassVisible && !initialVisibleValue) {\r\n          this.options.visible = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceVector<OlGeometry>\r\n    });\r\n\r\n    if (this.options.animation) {\r\n      this.dataSource.ol.on(\r\n        'addfeature',\r\n        function (e) {\r\n          this.flash(e.feature);\r\n        }.bind(this)\r\n      );\r\n    }\r\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\r\n      if (this.options.idbInfo.firstLoad) {\r\n        this.maintainFeaturesInIdb();\r\n      }\r\n      this.dataSource.ol.once('featuresloadend', () => {\r\n        this.dataSource.ol.on('addfeature', () => this.maintainFeaturesInIdb());\r\n        this.dataSource.ol.on('changefeature', () =>\r\n          this.maintainFeaturesInIdb()\r\n        );\r\n        this.dataSource.ol.on('clear', () => this.maintainFeaturesInIdb());\r\n        this.dataSource.ol.on('removefeature', () =>\r\n          this.maintainFeaturesInIdb()\r\n        );\r\n      });\r\n    }\r\n\r\n    if (\r\n      this.dataSource instanceof FeatureDataSource &&\r\n      (so?.preload?.bypassResolution || so?.preload?.bypassVisible)\r\n    ) {\r\n      this.dataSource.ol.once('featuresloadend', () => {\r\n        if (initialOpacityValue) {\r\n          this.opacity = initialOpacityValue;\r\n        }\r\n        if (so.preload.bypassResolution) {\r\n          this.minResolution = initialMinResValue;\r\n          this.maxResolution = initialMaxResValue;\r\n        }\r\n        if (so.preload.bypassVisible) {\r\n          this.visible = initialVisibleValue;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (this.options.trackFeature) {\r\n      this.enableTrackFeature(this.options.trackFeature);\r\n    }\r\n\r\n    const vector = new olLayerVector(olOptions);\r\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\r\n    const url = vectorSource.getUrl();\r\n    if (url) {\r\n      let loader;\r\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\r\n      if (\r\n        wfsOptions?.type === 'wfs' &&\r\n        (wfsOptions.params || wfsOptions.paramsWFS)\r\n      ) {\r\n        loader = (extent, resolution, proj, success, failure) => {\r\n          this.customWFSLoader(\r\n            vectorSource,\r\n            wfsOptions,\r\n            this.authInterceptor,\r\n            extent,\r\n            resolution,\r\n            proj,\r\n            success,\r\n            failure\r\n          );\r\n        };\r\n      } else {\r\n        loader = (extent, resolution, proj, success, failure) => {\r\n          this.customLoader(\r\n            vectorSource,\r\n            url,\r\n            this.authInterceptor,\r\n            extent,\r\n            resolution,\r\n            proj,\r\n            success,\r\n            failure\r\n          );\r\n        };\r\n      }\r\n      if (loader) {\r\n        vectorSource.setLoader(loader);\r\n      }\r\n    } else if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\r\n      const idbLoader = (extent, resolution, proj, success, failure) => {\r\n        this.customIDBLoader(\r\n          vectorSource,\r\n          olOptions.id,\r\n          extent,\r\n          proj,\r\n          success,\r\n          failure\r\n        );\r\n      };\r\n      if (idbLoader) {\r\n        vectorSource.setLoader(idbLoader);\r\n      }\r\n    }\r\n\r\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\r\n      vector.once('sourceready', () => {\r\n        if (this.options.idbInfo.firstLoad) {\r\n          this.maintainOptionsInIdb();\r\n        }\r\n        fromEvent<BaseEvent>(vector, 'change')\r\n          .pipe(debounceTime(750))\r\n          .subscribe(() => this.maintainOptionsInIdb());\r\n        vector.on('change:zIndex', () => this.maintainOptionsInIdb());\r\n      });\r\n    }\r\n    return vector;\r\n  }\r\n\r\n  removeLayerFromIDB() {\r\n    if (this.geoDBService && this.layerDBService) {\r\n      zip(\r\n        this.geoDBService.deleteByKey(this.id),\r\n        this.layerDBService.deleteByKey(this.id)\r\n      ).subscribe();\r\n    }\r\n  }\r\n\r\n  private maintainOptionsInIdb() {\r\n    this.options.igoStyle.igoStyleObject = olStyleToBasicIgoStyle(this.ol);\r\n    const layerData: LayerDBData = ObjectUtils.removeUndefined({\r\n      layerId: this.id,\r\n      detailedContextUri: this.options.idbInfo.contextUri,\r\n      sourceOptions: {\r\n        id: this.id,\r\n        type: 'vector',\r\n        queryable: true\r\n      },\r\n      layerOptions: {\r\n        workspace: this.options.workspace,\r\n        zIndex: this.ol ? this.zIndex : 1000000,\r\n        id: this.id,\r\n        isIgoInternalLayer: this.isIgoInternalLayer,\r\n        title: this.title,\r\n        igoStyle: this.options.igoStyle,\r\n        idbInfo: Object.assign({}, this.options.idbInfo, { firstLoad: false })\r\n      },\r\n      insertEvent: `${this.title}-${this.id}-${new Date()}`\r\n    });\r\n    this.layerDBService.update(layerData);\r\n  }\r\n\r\n  private maintainFeaturesInIdb() {\r\n    const dsFeatures = this.dataSource.ol.getFeatures();\r\n    const geojsonObject = JSON.parse(\r\n      new olformat.GeoJSON().writeFeatures(dsFeatures, {\r\n        dataProjection: 'EPSG:4326',\r\n        featureProjection: this.dataSource.ol.getProjection() || 'EPSG:3857'\r\n      })\r\n    );\r\n    this.geoDBService.update(\r\n      this.id,\r\n      this.id,\r\n      geojsonObject,\r\n      InsertSourceInsertDBEnum.User,\r\n      `${this.title}-${this.id}-${new Date()}`\r\n    );\r\n  }\r\n\r\n  protected flash(feature) {\r\n    const start = new Date().getTime();\r\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\r\n\r\n    function animate(event) {\r\n      const vectorContext = getVectorContext(event);\r\n      const frameState = event.frameState;\r\n      const flashGeom = feature.getGeometry().clone();\r\n      const elapsed = frameState.time - start;\r\n      const elapsedRatio = elapsed / this.options.animation.duration;\r\n      const opacity = easeOut(1 - elapsedRatio);\r\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\r\n      newColor[3] = opacity;\r\n      let style = this.ol\r\n        .getStyleFunction()\r\n        .call(this, feature)\r\n        .find((style2) => {\r\n          return style2.getImage();\r\n        });\r\n      if (!style) {\r\n        style = this.ol.getStyleFunction().call(this, feature)[0];\r\n      }\r\n      const styleClone = style.clone();\r\n\r\n      switch (feature.getGeometry().getType()) {\r\n        case 'Point':\r\n          if (\r\n            styleClone.getImage() !== null &&\r\n            typeof styleClone.getImage().getRadius === 'function'\r\n          ) {\r\n            const radius =\r\n              easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\r\n            styleClone.getImage().setRadius(radius);\r\n            styleClone.getImage().setOpacity(opacity);\r\n          }\r\n\r\n          break;\r\n        case 'LineString':\r\n          // TODO\r\n          if (styleClone.getImage()) {\r\n            styleClone.getImage().getStroke().setColor(newColor);\r\n            styleClone\r\n              .getImage()\r\n              .getStroke()\r\n              .setWidth(\r\n                easeOut(elapsedRatio) *\r\n                  (styleClone.getImage().getStroke().getWidth() * 3)\r\n              );\r\n          }\r\n          if (styleClone.getStroke()) {\r\n            styleClone.getStroke().setColor(newColor);\r\n            styleClone\r\n              .getStroke()\r\n              .setWidth(\r\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\r\n              );\r\n          }\r\n          break;\r\n        case 'Polygon':\r\n          // TODO\r\n          if (styleClone.getImage()) {\r\n            styleClone.getImage().getFill().setColor(newColor);\r\n          }\r\n          if (styleClone.getFill()) {\r\n            styleClone.getFill().setColor(newColor);\r\n          }\r\n          break;\r\n      }\r\n\r\n      styleClone.setText('');\r\n      vectorContext.setStyle(styleClone);\r\n      vectorContext.drawGeometry(flashGeom);\r\n\r\n      if (elapsed > this.options.animation.duration) {\r\n        unByKey(listenerKey);\r\n        // remove last geometry\r\n        // there is a little flash before feature disappear, better solution ?\r\n        this.map.ol.render();\r\n        return;\r\n      }\r\n      // tell OpenLayers to continue postcompose animation\r\n      this.map.ol.render();\r\n    }\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n\r\n  public setExtent(extent: MapExtent): void {\r\n    this.options.extent = extent;\r\n  }\r\n\r\n  public onUnwatch() {\r\n    this.dataSource.onUnwatch();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  public stopAnimation() {\r\n    this.dataSource.ol.un(\r\n      'addfeature',\r\n      function (e) {\r\n        if (this.visible) {\r\n          this.flash(e.feature);\r\n        }\r\n      }.bind(this)\r\n    );\r\n  }\r\n\r\n  public enableTrackFeature(id: string | number) {\r\n    this.trackFeatureListenerId = this.dataSource.ol.on(\r\n      'addfeature',\r\n      this.trackFeature.bind(this, id)\r\n    );\r\n  }\r\n  public centerMapOnFeature(id: string | number) {\r\n    const feat = this.dataSource.ol.getFeatureById(id);\r\n    if (feat) {\r\n      this.map.ol\r\n        .getView()\r\n        .setCenter((feat.getGeometry() as any).getCoordinates());\r\n    }\r\n  }\r\n\r\n  public trackFeature(id, feat) {\r\n    if (feat.feature.getId() === id && this.visible) {\r\n      this.centerMapOnFeature(id);\r\n    }\r\n  }\r\n\r\n  public disableTrackFeature(id?: string | number) {\r\n    unByKey(this.trackFeatureListenerId);\r\n  }\r\n\r\n  /**\r\n   * Custom loader for a WFS datasource\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param options olOptions from source\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param resolution the current resolution\r\n   * @param proj the projection to retrieve the data\r\n   * @param success success callback\r\n   * @param failure failure callback\r\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\r\n   */\r\n  public customWFSLoader(\r\n    vectorSource,\r\n    options,\r\n    interceptor,\r\n    extent,\r\n    resolution,\r\n    proj,\r\n    success,\r\n    failure,\r\n    randomParam?: boolean\r\n  ) {\r\n    {\r\n      const paramsWFS = options.paramsWFS;\r\n      const wfsProj = paramsWFS.srsName\r\n        ? new olProjection({ code: paramsWFS.srsName })\r\n        : proj;\r\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\r\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\r\n      const url = buildUrl(\r\n        options,\r\n        currentExtent,\r\n        wfsProj,\r\n        (options as OgcFilterableDataSourceOptions).ogcFilters,\r\n        randomParam\r\n      );\r\n      let startIndex = 0;\r\n      if (\r\n        paramsWFS.version === '2.0.0' &&\r\n        paramsWFS.maxFeatures > defaultMaxFeatures\r\n      ) {\r\n        const nbOfFeature = 1000;\r\n        while (startIndex < paramsWFS.maxFeatures) {\r\n          let alteredUrl = url.replace(\r\n            'count=' + paramsWFS.maxFeatures,\r\n            'count=' + nbOfFeature\r\n          );\r\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\r\n          alteredUrl += '&startIndex=' + startIndex;\r\n          alteredUrl.replace(/&&/g, '&');\r\n          this.getFeatures(\r\n            vectorSource,\r\n            interceptor,\r\n            currentExtent,\r\n            wfsProj,\r\n            proj,\r\n            alteredUrl,\r\n            nbOfFeature,\r\n            success,\r\n            failure\r\n          );\r\n          startIndex += nbOfFeature;\r\n        }\r\n      } else {\r\n        this.getFeatures(\r\n          vectorSource,\r\n          interceptor,\r\n          currentExtent,\r\n          wfsProj,\r\n          proj,\r\n          url,\r\n          paramsWFS.maxFeatures,\r\n          success,\r\n          failure\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Custom loader to get feature from a WFS datasource\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param dataProjection the projection of the retrieved data\r\n   * @param featureProjection the projection of the created features\r\n   * @param url the url string to retrieve the data\r\n   * @param threshold the threshold to manage \"more features\" (TODO)\r\n   * @param success success callback\r\n   * @param failure failure callback\r\n   */\r\n  private getFeatures(\r\n    vectorSource: olSourceVector<OlGeometry>,\r\n    interceptor,\r\n    extent,\r\n    dataProjection,\r\n    featureProjection,\r\n    url: string,\r\n    threshold: number,\r\n    success,\r\n    failure\r\n  ) {\r\n    const idAssociatedCall = (this.dataSource as WFSDataSource)\r\n      .mostRecentIdCallOGCFilter;\r\n    const xhr = new XMLHttpRequest();\r\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\r\n    let modifiedUrl = url;\r\n    if (alteredUrlWithKeyAuth) {\r\n      modifiedUrl = alteredUrlWithKeyAuth;\r\n    }\r\n    xhr.open('GET', modifiedUrl);\r\n    if (interceptor) {\r\n      interceptor.interceptXhr(xhr, modifiedUrl);\r\n    }\r\n    const onError = () => {\r\n      vectorSource.removeLoadedExtent(extent);\r\n      failure();\r\n    };\r\n    xhr.onerror = onError;\r\n    xhr.onload = () => {\r\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\r\n        const features = vectorSource\r\n          .getFormat()\r\n          .readFeatures(xhr.responseText, {\r\n            dataProjection,\r\n            featureProjection\r\n          }) as olFeature<OlGeometry>[];\r\n        // TODO Manage \"More feature\"\r\n        /*if (features.length === 0 || features.length < threshold ) {\r\n          console.log('No more data to download at this resolution');\r\n        }*/\r\n        // Avoids retrieving an older call that took longer to be process\r\n        if (\r\n          idAssociatedCall ===\r\n          (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter\r\n        ) {\r\n          vectorSource.addFeatures(features);\r\n          success(features);\r\n        } else {\r\n          success([]);\r\n        }\r\n      } else {\r\n        onError();\r\n      }\r\n    };\r\n    xhr.send();\r\n  }\r\n\r\n  /**\r\n   * Custom loader for vector layer.\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param url the url string or function to retrieve the data\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param resolution the current resolution\r\n   * @param projection the projection to retrieve the data\r\n   */\r\n  private customLoader(\r\n    vectorSource,\r\n    url,\r\n    interceptor,\r\n    extent,\r\n    resolution,\r\n    projection,\r\n    success,\r\n    failure\r\n  ) {\r\n    const xhr = new XMLHttpRequest();\r\n    let modifiedUrl = url;\r\n    if (typeof url !== 'function') {\r\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\r\n      if (alteredUrlWithKeyAuth) {\r\n        modifiedUrl = alteredUrlWithKeyAuth;\r\n      }\r\n    } else {\r\n      modifiedUrl = url(extent, resolution, projection);\r\n    }\r\n\r\n    if (this.geoNetworkService && typeof url !== 'function') {\r\n      const format = vectorSource.getFormat();\r\n      const type = format.getType();\r\n\r\n      let responseType = type;\r\n      const onError = () => {\r\n        vectorSource.removeLoadedExtent(extent);\r\n        failure();\r\n      };\r\n\r\n      const options: SimpleGetOptions = { responseType };\r\n      this.geoNetworkService.geoDBService\r\n        .get(url)\r\n        .pipe(delay(750))\r\n        .pipe(\r\n          concatMap((r) =>\r\n            r\r\n              ? of(r)\r\n              : this.geoNetworkService.get(modifiedUrl, options).pipe(\r\n                  first(),\r\n                  catchError((res) => {\r\n                    onError();\r\n                    throw res;\r\n                  })\r\n                )\r\n          )\r\n        )\r\n        .subscribe((content) => {\r\n          if (content) {\r\n            const format = vectorSource.getFormat();\r\n            const type = format.getType();\r\n            let source;\r\n            if (type === 'json' || type === 'text') {\r\n              source = content;\r\n            } else if (type === 'xml') {\r\n              source = content;\r\n              if (!source) {\r\n                source = new DOMParser().parseFromString(\r\n                  content,\r\n                  'application/xml'\r\n                );\r\n              }\r\n            } else if (type === 'arraybuffer') {\r\n              source = content;\r\n            }\r\n            if (source) {\r\n              const features = format.readFeatures(source, {\r\n                extent,\r\n                featureProjection: projection\r\n              });\r\n              vectorSource.addFeatures(features, format.readProjection(source));\r\n              success(features);\r\n            } else {\r\n              onError();\r\n            }\r\n          }\r\n        });\r\n    } else {\r\n      xhr.open('GET', modifiedUrl);\r\n      const format = vectorSource.getFormat();\r\n      if (format.getType() === 'arraybuffer') {\r\n        xhr.responseType = 'arraybuffer';\r\n      }\r\n      if (interceptor) {\r\n        interceptor.interceptXhr(xhr, modifiedUrl);\r\n      }\r\n\r\n      const onError = () => {\r\n        vectorSource.removeLoadedExtent(extent);\r\n        failure();\r\n      };\r\n      xhr.onerror = onError;\r\n      xhr.onload = () => {\r\n        // status will be 0 for file:// urls\r\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\r\n          const type = format.getType();\r\n          let source;\r\n          if (type === 'json' || type === 'text') {\r\n            source = xhr.responseText;\r\n          } else if (type === 'xml') {\r\n            source = xhr.responseXML;\r\n            if (!source) {\r\n              source = new DOMParser().parseFromString(\r\n                xhr.responseText,\r\n                'application/xml'\r\n              );\r\n            }\r\n          } else if (type === 'arraybuffer') {\r\n            source = xhr.response;\r\n          }\r\n          if (source) {\r\n            const features = format.readFeatures(source, {\r\n              extent,\r\n              featureProjection: projection\r\n            });\r\n            vectorSource.addFeatures(features, format.readProjection(source));\r\n            success(features);\r\n          } else {\r\n            onError();\r\n          }\r\n        } else {\r\n          onError();\r\n        }\r\n      };\r\n      xhr.send();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Custom loader for vector layer.\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param layerID the url string or function to retrieve the data\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param resolution the current resolution\r\n   * @param projection the projection to retrieve the data\r\n   */\r\n  private customIDBLoader(\r\n    vectorSource,\r\n    layerID,\r\n    extent,\r\n    projection,\r\n    success,\r\n    failure\r\n  ) {\r\n    if (this.geoNetworkService) {\r\n      const onError = () => {\r\n        vectorSource.removeLoadedExtent(extent);\r\n        failure();\r\n      };\r\n      this.geoNetworkService.geoDBService.get(layerID).subscribe((content) => {\r\n        if (content) {\r\n          const format = vectorSource.getFormat();\r\n          const type = format.getType();\r\n          let source;\r\n          if (type === 'json' || type === 'text') {\r\n            source = content;\r\n          } else if (type === 'xml') {\r\n            source = content;\r\n            if (!source) {\r\n              source = new DOMParser().parseFromString(\r\n                content,\r\n                'application/xml'\r\n              );\r\n            }\r\n          } else if (type === 'arraybuffer') {\r\n            source = content;\r\n          }\r\n          if (source) {\r\n            const features = format.readFeatures(source, {\r\n              extent,\r\n              featureProjection: projection\r\n            });\r\n            vectorSource.addFeatures(features, format.readProjection(source));\r\n            success(features);\r\n          } else {\r\n            onError();\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n","import olLayerVector from 'ol/layer/Vector';\r\nimport olSourceVector from 'ol/source/Vector';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nexport function olStyleToBasicIgoStyle(\r\n  layer: olLayerVector<olSourceVector<OlGeometry>>\r\n) {\r\n  const layerOlStyle = layer.getStyle();\r\n  if (typeof layerOlStyle === 'function' || layerOlStyle instanceof Array) {\r\n    return;\r\n  }\r\n\r\n  const rStyle = {\r\n    fill: {\r\n      color: layerOlStyle.getFill().getColor()\r\n    },\r\n    stroke: {\r\n      color: layerOlStyle.getStroke().getColor(),\r\n      width: 2\r\n    },\r\n    circle: {\r\n      fill: {\r\n        color: (layerOlStyle.getImage() as any).getFill().getColor()\r\n      },\r\n      stroke: {\r\n        color: (layerOlStyle.getImage() as any).getStroke().getColor(),\r\n        width: 2\r\n      },\r\n      radius: 5\r\n    }\r\n  };\r\n  return rStyle;\r\n}\r\n","import olLayerVectorTile from 'ol/layer/VectorTile';\r\nimport olSourceVectorTile from 'ol/source/VectorTile';\r\n\r\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\r\n\r\nimport { Layer } from './layer';\r\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\r\nimport { TileWatcher } from '../../utils';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { IgoMap } from '../../../map/shared';\r\nimport { MessageService } from '@igo2/core';\r\nimport VectorTile from 'ol/VectorTile';\r\n\r\nexport class VectorTileLayer extends Layer {\r\n  public declare dataSource: MVTDataSource;\r\n  public declare options: VectorTileLayerOptions;\r\n  public declare ol: olLayerVectorTile;\r\n\r\n  private watcher: TileWatcher;\r\n\r\n  constructor(\r\n    options: VectorTileLayerOptions,\r\n    public messageService?: MessageService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(options, messageService, authInterceptor);\r\n    this.watcher = new TileWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerVectorTile {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceVectorTile\r\n    });\r\n\r\n    const vectorTile = new olLayerVectorTile(olOptions);\r\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\r\n\r\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\r\n      const loader = this.customLoader(\r\n        url,\r\n        tile.getFormat(),\r\n        this.authInterceptor,\r\n        tile.onLoad.bind(tile)\r\n      );\r\n      if (loader) {\r\n        tile.setLoader(loader);\r\n      }\r\n    });\r\n\r\n    return vectorTile;\r\n  }\r\n\r\n  /**\r\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\r\n   * @internal\r\n   * @param url the url string or function to retrieve the data\r\n   * @param format the format of the tile\r\n   * @param interceptor the interceptor of the data\r\n   * @param success On success event action to trigger\r\n   * @param failure On failure event action to trigger TODO\r\n   */\r\n  customLoader(url, format, interceptor, success, failure?) {\r\n    return (extent, resolution, projection) => {\r\n      const xhr = new XMLHttpRequest();\r\n      let modifiedUrl = url;\r\n      if (typeof url !== 'function') {\r\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\r\n        if (alteredUrlWithKeyAuth) {\r\n          modifiedUrl = alteredUrlWithKeyAuth;\r\n        }\r\n      } else {\r\n        modifiedUrl = url(extent, resolution, projection);\r\n      }\r\n      xhr.open('GET', modifiedUrl);\r\n      if (interceptor) {\r\n        interceptor.interceptXhr(xhr, modifiedUrl);\r\n      }\r\n\r\n      if (format.getType() === 'arraybuffer') {\r\n        xhr.responseType = 'arraybuffer';\r\n      }\r\n      xhr.onload = (event) => {\r\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\r\n          const type = format.getType();\r\n          let source;\r\n          if (type === 'json' || type === 'text') {\r\n            source = xhr.responseText;\r\n          } else if (type === 'xml') {\r\n            source = xhr.responseXML;\r\n            if (!source) {\r\n              source = new DOMParser().parseFromString(\r\n                xhr.responseText,\r\n                'application/xml'\r\n              );\r\n            }\r\n          } else if (type === 'arraybuffer') {\r\n            source = xhr.response;\r\n          }\r\n          if (source) {\r\n            success.call(\r\n              this,\r\n              format.readFeatures(source, {\r\n                extent,\r\n                featureProjection: projection\r\n              }),\r\n              format.readProjection(source)\r\n            );\r\n          } else {\r\n            // TODO\r\n            failure.call(this);\r\n          }\r\n        } else {\r\n          // TODO\r\n          failure.call(this);\r\n        }\r\n      };\r\n      xhr.onerror = () => {\r\n        // TODO\r\n        failure.call(this);\r\n      };\r\n      xhr.send();\r\n    };\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n}\r\n","import { AnyLayerOptions } from '../shared/layers/any-layer.interface';\r\nimport { VectorTileLayerOptions } from '../shared/layers/vectortile-layer.interface';\r\n\r\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\r\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\r\n  if (\r\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\r\n    (vectorTileLayerOptions.igoStyle?.styleByAttribute?.hoverStyle ||\r\n      vectorTileLayerOptions.igoStyle?.hoverStyle)\r\n  ) {\r\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\r\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\r\n  }\r\n  return layerOptions;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { DBMode, NgxIndexedDBService } from 'ngx-indexed-db';\r\nimport { Observable, of, Subject } from 'rxjs';\r\nimport { concatMap, first, map, take } from 'rxjs/operators';\r\nimport { CompressionService } from '@igo2/core';\r\nimport { GeoDBData } from './geoDB.interface';\r\nimport { InsertSourceInsertDBEnum } from './geoDB.enums';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeoDBService {\r\n  readonly dbName: string = 'geoData';\r\n  public collisionsMap: Map<number, string[]> = new Map();\r\n  public _newData: number = 0;\r\n\r\n  constructor(\r\n    private ngxIndexedDBService: NgxIndexedDBService,\r\n    private compression: CompressionService\r\n  ) {}\r\n\r\n  /**\r\n   * Only blob can be compressed\r\n   * @param url\r\n   * @param regionID\r\n   * @param object object to handle\r\n   * @param insertSource type of event user or system\r\n   * @param insertEvent Name of the event where the insert has been triggered\r\n   * @returns\r\n   */\r\n  update(\r\n    url: string,\r\n    regionID: any,\r\n    object: any,\r\n    insertSource: InsertSourceInsertDBEnum,\r\n    insertEvent: string\r\n  ): Observable<any> {\r\n    if (!object) {\r\n      return;\r\n    }\r\n    let compress = false;\r\n\r\n    const subject: Subject<GeoDBData> = new Subject();\r\n    let object$: Observable<any> = of(object);\r\n    if (object instanceof Blob) {\r\n      object$ = this.compression.compressBlob(object);\r\n      compress = true;\r\n    }\r\n    let geoDBData: GeoDBData;\r\n    object$\r\n      .pipe(\r\n        first(),\r\n        concatMap((object) => {\r\n          geoDBData = {\r\n            url,\r\n            regionID,\r\n            object: object,\r\n            compressed: compress,\r\n            insertSource,\r\n            insertEvent\r\n          };\r\n          return this.ngxIndexedDBService.getByID(this.dbName, url);\r\n        }),\r\n        concatMap((dbObject: GeoDBData) => {\r\n          if (!dbObject) {\r\n            this._newData++;\r\n            return this.ngxIndexedDBService.add(this.dbName, geoDBData);\r\n          } else {\r\n            const currentRegionID = dbObject.regionID;\r\n            if (currentRegionID !== regionID) {\r\n              const collisions = this.collisionsMap.get(currentRegionID);\r\n              if (collisions !== undefined) {\r\n                collisions.push(dbObject.url);\r\n                this.collisionsMap.set(currentRegionID, collisions);\r\n              } else {\r\n                this.collisionsMap.set(currentRegionID, [dbObject.url]);\r\n              }\r\n            }\r\n            return this.customUpdate(geoDBData);\r\n          }\r\n        })\r\n      )\r\n      .subscribe((response) => {\r\n        subject.next(response);\r\n        subject.complete();\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  private customUpdate(geoDBData: GeoDBData): Observable<GeoDBData> {\r\n    const subject: Subject<GeoDBData> = new Subject();\r\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\r\n      this.dbName,\r\n      geoDBData.url\r\n    );\r\n    deleteRequest\r\n      .pipe(\r\n        concatMap((isDeleted) =>\r\n          isDeleted\r\n            ? this.ngxIndexedDBService.add(this.dbName, geoDBData)\r\n            : of(undefined)\r\n        )\r\n      )\r\n      .subscribe((object) => {\r\n        if (object) {\r\n          subject.next(object);\r\n        }\r\n        subject.complete();\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  get(url: string): Observable<any> {\r\n    return this.ngxIndexedDBService.getByID(this.dbName, url).pipe(\r\n      map((data: GeoDBData) => {\r\n        if (data) {\r\n          const object = data.object;\r\n          if (!data.compressed) {\r\n            return object;\r\n          }\r\n          return this.compression.decompressBlob(object);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  getByID(url: string): Observable<any> {\r\n    return this.ngxIndexedDBService.getByID(this.dbName, url);\r\n  }\r\n\r\n  deleteByKey(url: string): Observable<any> {\r\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, url);\r\n  }\r\n\r\n  getRegionCountByID(id: number): Observable<number> {\r\n    const subject: Subject<number> = new Subject();\r\n    const dbRequest = this.getRegionByID(id).subscribe((datas) => {\r\n      subject.next(datas.length);\r\n      subject.complete();\r\n    });\r\n    return subject;\r\n  }\r\n\r\n  getRegionByID(id: number): Observable<any[]> {\r\n    if (!id) {\r\n      return;\r\n    }\r\n\r\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\r\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\r\n      this.dbName,\r\n      'regionID',\r\n      IDBKey\r\n    );\r\n    return dbRequest;\r\n  }\r\n\r\n  deleteByRegionID(id: number): Observable<any> {\r\n    if (!id) {\r\n      return;\r\n    }\r\n\r\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\r\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\r\n      this.dbName,\r\n      'regionID',\r\n      IDBKey\r\n    );\r\n    dbRequest.subscribe((datas: GeoDBData[]) => {\r\n      datas.forEach((data) => {\r\n        this.ngxIndexedDBService.deleteByKey(this.dbName, data.url);\r\n      });\r\n    });\r\n    return dbRequest;\r\n  }\r\n\r\n  openCursor(\r\n    keyRange: IDBKeyRange = IDBKeyRange.lowerBound(0),\r\n    mode: DBMode = DBMode.readonly\r\n  ) {\r\n    const request = this.ngxIndexedDBService.openCursorByIndex(\r\n      this.dbName,\r\n      'regionID',\r\n      keyRange,\r\n      mode\r\n    );\r\n    return request;\r\n  }\r\n\r\n  resetCounters() {\r\n    this.resetCollisionsMap();\r\n    this._newData = 0;\r\n  }\r\n\r\n  resetCollisionsMap() {\r\n    this.collisionsMap = new Map();\r\n  }\r\n\r\n  revertCollisions() {\r\n    for (const [regionID, collisions] of this.collisionsMap) {\r\n      for (const url of collisions) {\r\n        this.ngxIndexedDBService\r\n          .getByKey(this.dbName, url)\r\n          .pipe(take(1))\r\n          .subscribe((dbObject: GeoDBData) => {\r\n            const updatedObject = dbObject;\r\n            updatedObject.regionID = regionID;\r\n            this.customUpdate(dbObject);\r\n          });\r\n      }\r\n    }\r\n  }\r\n\r\n  get newData(): number {\r\n    return this._newData;\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { ConnectionState, NetworkService } from '@igo2/core';\r\nimport { Observable } from 'rxjs';\r\nimport { GeoDBService } from '../geoDB/geoDB.service';\r\n\r\nexport enum ResponseType {\r\n  Arraybuffer = 'arraybuffer',\r\n  Blob = 'blob',\r\n  Text = 'text',\r\n  Json = 'json'\r\n}\r\nexport interface SimpleGetOptions {\r\n  responseType: ResponseType;\r\n  withCredentials?: boolean;\r\n}\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeoNetworkService {\r\n  private networkOnline: boolean = true;\r\n  constructor(\r\n    private http: HttpClient,\r\n    public geoDBService: GeoDBService,\r\n    private networkService: NetworkService\r\n  ) {\r\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\r\n      this.networkOnline = state.connection;\r\n    });\r\n  }\r\n\r\n  get(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\r\n    if (window.navigator.onLine && this.networkOnline) {\r\n      return this.getOnline(url, simpleGetOptions);\r\n    }\r\n    return this.getOffline(url);\r\n  }\r\n\r\n  private getOnline(\r\n    url: string,\r\n    simpleGetOptions: SimpleGetOptions\r\n  ): Observable<any> {\r\n    let request;\r\n    switch (simpleGetOptions.responseType) {\r\n      // TODO Ajuster pour autre formats\r\n      case 'arraybuffer':\r\n        request = this.http.get(url, {\r\n          responseType: 'arraybuffer',\r\n          withCredentials: simpleGetOptions.withCredentials\r\n        });\r\n        break;\r\n      case 'blob':\r\n        request = this.http.get(url, {\r\n          responseType: 'blob',\r\n          withCredentials: simpleGetOptions.withCredentials\r\n        });\r\n        break;\r\n      case 'text':\r\n        request = this.http.get(url, {\r\n          responseType: 'text',\r\n          withCredentials: simpleGetOptions.withCredentials\r\n        });\r\n        break;\r\n      case 'json':\r\n        request = this.http.get(url, {\r\n          responseType: 'json',\r\n          withCredentials: simpleGetOptions.withCredentials\r\n        });\r\n        break;\r\n      default:\r\n        request = this.http.get(url, {\r\n          responseType: 'blob',\r\n          withCredentials: simpleGetOptions.withCredentials\r\n        });\r\n        break;\r\n    }\r\n    return request;\r\n  }\r\n\r\n  private getOffline(url: string): Observable<any> {\r\n    return this.geoDBService.get(url);\r\n  }\r\n\r\n  public isOnline() {\r\n    return this.networkOnline && window.navigator.onLine;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { NgxIndexedDBService } from 'ngx-indexed-db';\r\nimport { Observable, of, Subject } from 'rxjs';\r\nimport { concatMap, first } from 'rxjs/operators';\r\nimport { LayerDBData } from './layerDB.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerDBService {\r\n  readonly dbName: string = 'layerData';\r\n\r\n  constructor(private ngxIndexedDBService: NgxIndexedDBService) {}\r\n\r\n  /**\r\n   * This method allow to update the stored layer into the indexeddb (layerData)\r\n   * @param layerDBData\r\n   * @returns\r\n   */\r\n  update(layerDBData: LayerDBData): Observable<any> {\r\n    const subject: Subject<LayerDBData> = new Subject();\r\n    this.ngxIndexedDBService\r\n      .getByID(this.dbName, layerDBData.layerId)\r\n      .pipe(\r\n        first(),\r\n        concatMap((dbObject: LayerDBData) => {\r\n          if (!dbObject) {\r\n            return this.ngxIndexedDBService.add(this.dbName, layerDBData);\r\n          } else {\r\n            return this.customUpdate(layerDBData);\r\n          }\r\n        })\r\n      )\r\n      .subscribe((response) => {\r\n        subject.next(response);\r\n        subject.complete();\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  private customUpdate(layerDBData: LayerDBData): Observable<LayerDBData> {\r\n    const subject: Subject<LayerDBData> = new Subject();\r\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\r\n      this.dbName,\r\n      layerDBData.layerId\r\n    );\r\n    deleteRequest\r\n      .pipe(\r\n        concatMap((isDeleted) =>\r\n          isDeleted\r\n            ? this.ngxIndexedDBService.add(this.dbName, layerDBData)\r\n            : of(undefined)\r\n        )\r\n      )\r\n      .subscribe((object) => {\r\n        if (object) {\r\n          subject.next(object);\r\n        }\r\n        subject.complete();\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  /**\r\n   * This method retrieve an idb layer definition\r\n   * @param layerId\r\n   * @returns\r\n   */\r\n  getByID(layerId: string): Observable<LayerDBData> {\r\n    return this.ngxIndexedDBService.getByID(this.dbName, layerId);\r\n  }\r\n\r\n  /**\r\n   * This method delete an idb layer definition\r\n   * @param layerId\r\n   * @returns\r\n   */\r\n  deleteByKey(layerId: string): Observable<boolean> {\r\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, layerId);\r\n  }\r\n\r\n  /**\r\n   * This method retrive all idb layer definition\r\n   * @param layerId\r\n   * @returns\r\n   */\r\n  getAll(): Observable<LayerDBData[]> {\r\n    return this.ngxIndexedDBService.getAll(this.dbName);\r\n  }\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { combineLatest, Observable, of } from 'rxjs';\r\nimport { map, catchError, concatMap } from 'rxjs/operators';\r\nimport { stylefunction } from 'ol-mapbox-style';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport olLayerVectorTile from 'ol/layer/VectorTile';\r\n\r\nimport { Style } from 'ol/style';\r\nimport * as olStyle from 'ol/style';\r\n\r\nimport {\r\n  OSMDataSource,\r\n  FeatureDataSource,\r\n  XYZDataSource,\r\n  TileDebugDataSource,\r\n  WFSDataSource,\r\n  WMTSDataSource,\r\n  WMSDataSource,\r\n  CartoDataSource,\r\n  ImageArcGISRestDataSource,\r\n  ArcGISRestDataSource,\r\n  TileArcGISRestDataSource,\r\n  WebSocketDataSource,\r\n  MVTDataSource,\r\n  ClusterDataSource\r\n} from '../../datasource';\r\n\r\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\r\n\r\nimport {\r\n  Layer,\r\n  ImageLayer,\r\n  ImageLayerOptions,\r\n  TileLayer,\r\n  TileLayerOptions,\r\n  VectorLayer,\r\n  VectorLayerOptions,\r\n  AnyLayerOptions,\r\n  VectorTileLayer,\r\n  VectorTileLayerOptions,\r\n  LayerOptions\r\n} from './layers';\r\n\r\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { MessageService } from '@igo2/core';\r\nimport { GeoNetworkService } from '../../offline/shared/geo-network.service';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\nimport { LayerDBService } from '../../offline/layerDB/layerDB.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private styleService: StyleService,\r\n    private dataSourceService: DataSourceService,\r\n    private geoNetworkService: GeoNetworkService,\r\n    private messageService: MessageService,\r\n    private layerDBService: LayerDBService,\r\n    @Optional() private authInterceptor: AuthInterceptor\r\n  ) {}\r\n\r\n  createLayer(layerOptions: AnyLayerOptions): Layer {\r\n    if (!layerOptions.source) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      layerOptions.source.options &&\r\n      layerOptions.source.options._layerOptionsFromSource\r\n    ) {\r\n      layerOptions = ObjectUtils.mergeDeep(\r\n        layerOptions.source.options._layerOptionsFromSource,\r\n        layerOptions || {}\r\n      );\r\n    }\r\n\r\n    let layer;\r\n    switch (layerOptions.source.constructor) {\r\n      case OSMDataSource:\r\n      case WMTSDataSource:\r\n      case XYZDataSource:\r\n      case TileDebugDataSource:\r\n      case CartoDataSource:\r\n      case TileArcGISRestDataSource:\r\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\r\n        break;\r\n      case FeatureDataSource:\r\n      case WFSDataSource:\r\n      case ArcGISRestDataSource:\r\n      case WebSocketDataSource:\r\n      case ClusterDataSource:\r\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\r\n        break;\r\n      case ImageArcGISRestDataSource:\r\n      case WMSDataSource:\r\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\r\n        break;\r\n      case MVTDataSource:\r\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\r\n        layer = this.createVectorTileLayer(\r\n          _layerOptions as VectorTileLayerOptions\r\n        );\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return layer;\r\n  }\r\n\r\n  createAsyncLayer(\r\n    _layerOptions: AnyLayerOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<Layer> {\r\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\r\n    if (layerOptions.source) {\r\n      return new Observable((d) => d.next(this.createLayer(layerOptions)));\r\n    }\r\n\r\n    return this.dataSourceService\r\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\r\n      .pipe(\r\n        map((source) => {\r\n          if (source === undefined) {\r\n            return undefined;\r\n          }\r\n          return this.createLayer(Object.assign(layerOptions, { source }));\r\n        })\r\n      );\r\n  }\r\n\r\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\r\n    return new ImageLayer(\r\n      layerOptions,\r\n      this.messageService,\r\n      this.authInterceptor\r\n    );\r\n  }\r\n\r\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\r\n    return new TileLayer(\r\n      layerOptions,\r\n      this.messageService,\r\n      this.authInterceptor\r\n    );\r\n  }\r\n\r\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\r\n    let style: Style[] | Style | OlStyleLike = layerOptions.style;\r\n    let igoLayer: VectorLayer;\r\n\r\n    if (!layerOptions.igoStyle) {\r\n      layerOptions.igoStyle = {};\r\n    }\r\n    const legacyStyleOptions = [\r\n      'styleByAttribute',\r\n      'hoverStyle',\r\n      'mapboxStyle',\r\n      'clusterBaseStyle',\r\n      'style'\r\n    ];\r\n    // handling legacy property.\r\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\r\n    if (\r\n      layerOptions.igoStyle.igoStyleObject &&\r\n      !layerOptions.idbInfo?.storeToIdb\r\n    ) {\r\n      style = (feature, resolution) =>\r\n        this.styleService.createStyle(\r\n          layerOptions.igoStyle.igoStyleObject,\r\n          feature,\r\n          resolution\r\n        );\r\n    } else if (\r\n      layerOptions.igoStyle.igoStyleObject &&\r\n      layerOptions.idbInfo?.storeToIdb\r\n    ) {\r\n      // temporary fix todo : handle it with geostyler.\r\n      style = this.styleService.parseStyle(\r\n        'style',\r\n        layerOptions.igoStyle.igoStyleObject\r\n      );\r\n    }\r\n\r\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\r\n      const source = layerOptions.source as ArcGISRestDataSource;\r\n      style = source.options.params.style;\r\n    } else if (layerOptions.igoStyle?.styleByAttribute) {\r\n      const serviceStyle = this.styleService;\r\n      layerOptions.style = (feature, resolution) => {\r\n        return serviceStyle.createStyleByAttribute(\r\n          feature,\r\n          layerOptions.igoStyle.styleByAttribute,\r\n          resolution\r\n        );\r\n      };\r\n      igoLayer = new VectorLayer(\r\n        layerOptions,\r\n        this.messageService,\r\n        this.authInterceptor,\r\n        this.geoNetworkService,\r\n        this.geoNetworkService.geoDBService,\r\n        this.layerDBService\r\n      );\r\n    }\r\n\r\n    if (layerOptions.source instanceof ClusterDataSource) {\r\n      const serviceStyle = this.styleService;\r\n      const baseStyle = layerOptions.igoStyle.clusterBaseStyle;\r\n      layerOptions.style = (feature, resolution) => {\r\n        return serviceStyle.createClusterStyle(\r\n          feature,\r\n          resolution,\r\n          layerOptions.clusterParam,\r\n          baseStyle\r\n        );\r\n      };\r\n      igoLayer = new VectorLayer(\r\n        layerOptions,\r\n        this.messageService,\r\n        this.authInterceptor,\r\n        this.geoNetworkService,\r\n        this.geoNetworkService.geoDBService,\r\n        this.layerDBService\r\n      );\r\n    }\r\n\r\n    const layerOptionsOl = Object.assign({}, layerOptions, {\r\n      style\r\n    });\r\n\r\n    if (!igoLayer) {\r\n      igoLayer = new VectorLayer(\r\n        layerOptionsOl,\r\n        this.messageService,\r\n        this.authInterceptor,\r\n        this.geoNetworkService,\r\n        this.geoNetworkService.geoDBService,\r\n        this.layerDBService\r\n      );\r\n    }\r\n\r\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\r\n\r\n    return igoLayer;\r\n  }\r\n\r\n  private handleLegacyStyles(layerOptions, legacyStyleOptions: string[]) {\r\n    legacyStyleOptions.map((legacyOption) => {\r\n      if (layerOptions[legacyOption]) {\r\n        let newKey = legacyOption;\r\n        if (legacyOption === 'style') {\r\n          if (layerOptions[legacyOption] instanceof olStyle.Style) {\r\n            return;\r\n          }\r\n          if (typeof layerOptions[legacyOption] === 'object') {\r\n            newKey = 'igoStyleObject';\r\n          } else {\r\n            return;\r\n          }\r\n        }\r\n        layerOptions.igoStyle[newKey] = layerOptions[legacyOption];\r\n        delete layerOptions[legacyOption];\r\n        console.warn(`\r\n        The location of this style option (${legacyOption}) is deprecated.\r\n        Please move this property within igoStyle property.\r\n        Ex: ${legacyOption}: {...} must be transfered to igoStyle: { ${newKey}: {...} }\r\n        This legacy conversion will be deleted in 2024.\r\n        `);\r\n      }\r\n    });\r\n  }\r\n\r\n  private createVectorTileLayer(\r\n    layerOptions: VectorTileLayerOptions\r\n  ): VectorTileLayer {\r\n    let style: Style[] | Style | OlStyleLike;\r\n    let igoLayer: VectorTileLayer;\r\n\r\n    if (!layerOptions.igoStyle) {\r\n      layerOptions.igoStyle = {};\r\n    }\r\n    const legacyStyleOptions = [\r\n      'styleByAttribute',\r\n      'hoverStyle',\r\n      'mapboxStyle',\r\n      'style'\r\n    ];\r\n    // handling legacy property.\r\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\r\n\r\n    if (layerOptions.igoStyle.igoStyleObject) {\r\n      style = (feature, resolution) =>\r\n        this.styleService.createStyle(\r\n          layerOptions.igoStyle.igoStyleObject,\r\n          feature,\r\n          resolution\r\n        );\r\n    }\r\n\r\n    if (layerOptions.igoStyle.styleByAttribute) {\r\n      const serviceStyle = this.styleService;\r\n      layerOptions.style = (feature, resolution) => {\r\n        return serviceStyle.createStyleByAttribute(\r\n          feature,\r\n          layerOptions.igoStyle.styleByAttribute,\r\n          resolution\r\n        );\r\n      };\r\n      igoLayer = new VectorTileLayer(\r\n        layerOptions,\r\n        this.messageService,\r\n        this.authInterceptor\r\n      );\r\n    }\r\n\r\n    const layerOptionsOl = Object.assign({}, layerOptions, {\r\n      style\r\n    });\r\n\r\n    if (!igoLayer) {\r\n      igoLayer = new VectorTileLayer(\r\n        layerOptionsOl,\r\n        this.messageService,\r\n        this.authInterceptor\r\n      );\r\n    }\r\n\r\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\r\n    return igoLayer;\r\n  }\r\n\r\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\r\n    if (layerOptions.igoStyle?.mapboxStyle) {\r\n      this.getStuff(layerOptions.igoStyle.mapboxStyle.url).subscribe((res) => {\r\n        if (res.sprite) {\r\n          const url = this.getAbsoluteUrl(\r\n            layerOptions.igoStyle.mapboxStyle.url,\r\n            res.sprite\r\n          );\r\n          this.getStuff(url + '.json').subscribe((res2) => {\r\n            stylefunction(\r\n              layer.ol as olLayerVectorTile,\r\n              res,\r\n              layerOptions.igoStyle.mapboxStyle.source,\r\n              undefined,\r\n              res2,\r\n              url + '.png'\r\n            );\r\n          });\r\n        } else {\r\n          stylefunction(\r\n            layer.ol as olLayerVectorTile,\r\n            res,\r\n            layerOptions.igoStyle.mapboxStyle.source\r\n          );\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private getStuff(url: string) {\r\n    return this.http.get(url).pipe(\r\n      map((res: any) => res),\r\n      catchError((err) => {\r\n        console.log('No style was found');\r\n        return of(err);\r\n      })\r\n    );\r\n  }\r\n\r\n  private getAbsoluteUrl(source, url) {\r\n    const r = new RegExp('^http|//', 'i');\r\n    if (r.test(url)) {\r\n      return url;\r\n    } else {\r\n      if (source.substr(source.length - 1) === '/') {\r\n        return source + url;\r\n      } else {\r\n        return source + '/' + url;\r\n      }\r\n    }\r\n  }\r\n\r\n  createAsyncIdbLayers(contextUri: string = '*'): Observable<Layer[]> {\r\n    return this.layerDBService.getAll().pipe(\r\n      concatMap((res) => {\r\n        const idbLayers =\r\n          contextUri !== '*'\r\n            ? res.filter((l) => l.detailedContextUri === contextUri)\r\n            : res;\r\n        const layersOptions: LayerOptions[] = idbLayers.map((idbl) =>\r\n          Object.assign({}, idbl.layerOptions, {\r\n            sourceOptions: idbl.sourceOptions\r\n          })\r\n        );\r\n        return combineLatest(\r\n          layersOptions.map((layerOptions) =>\r\n            this.createAsyncLayer(layerOptions)\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n}\r\n","export enum CatalogItemType {\r\n  Layer = 'layer',\r\n  Group = 'group'\r\n}\r\n\r\nexport enum TypeCatalog {\r\n  wms,\r\n  wmts,\r\n  baselayers,\r\n  arcgisrest,\r\n  tilearcgisrest,\r\n  imagearcgisrest,\r\n  composite\r\n}\r\n\r\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, mergeMap } from 'rxjs/operators';\r\n\r\nimport { default as striptags } from 'striptags';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport * as olextent from 'ol/extent';\r\nimport olFormatGML2 from 'ol/format/GML2';\r\nimport olFormatGML3 from 'ol/format/GML3';\r\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\r\nimport olFeature from 'ol/Feature';\r\nimport * as olgeom from 'ol/geom';\r\n\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { uuid } from '@igo2/utils';\r\nimport {\r\n  Feature,\r\n  FeatureGeometry\r\n} from '../../feature/shared/feature.interfaces';\r\nimport { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport {\r\n  WMSDataSource,\r\n  CartoDataSource,\r\n  TileArcGISRestDataSource,\r\n  WMSDataSourceOptions,\r\n  ImageArcGISRestDataSource\r\n} from '../../datasource';\r\n\r\nimport {\r\n  QueryFormat,\r\n  QueryFormatMimeType,\r\n  QueryHtmlTarget\r\n} from './query.enums';\r\nimport {\r\n  QueryOptions,\r\n  QueryableDataSource,\r\n  QueryableDataSourceOptions,\r\n  QueryUrlData\r\n} from './query.interfaces';\r\nimport { MapExtent } from '../../map/shared/map.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class QueryService {\r\n  public queryEnabled = true;\r\n  public defaultFeatureCount = 20; // default feature count\r\n  public featureCount = 20; // feature count\r\n\r\n  private previousMessageIds = [];\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\r\n    if (this.previousMessageIds.length) {\r\n      this.previousMessageIds.forEach((id) => {\r\n        this.messageService.remove(id);\r\n      });\r\n    }\r\n\r\n    const newLayers = layers\r\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\r\n      .map((layer: Layer) => this.queryLayer(layer, options));\r\n    // the directive accept array in this format [observable, observable...]\r\n    // if we use multiple 'url' in queryUrl so the result => this form [observable, observable, [observable, observable]]\r\n    // so we need to flat the array\r\n    let flatArray = [].concat.apply([], newLayers);\r\n    return flatArray;\r\n  }\r\n\r\n  queryLayer(\r\n    layer: Layer,\r\n    options: QueryOptions\r\n  ): Observable<Feature[]> | Observable<Feature[]>[] {\r\n    const url = this.getQueryUrl(\r\n      layer.dataSource,\r\n      options,\r\n      false,\r\n      layer.map.viewController.getExtent()\r\n    );\r\n    if (!url) {\r\n      return of([]);\r\n    }\r\n\r\n    const resolution: number = layer.map.viewController.getResolution();\r\n    const scale: number = layer.map.viewController.getScale();\r\n\r\n    if (\r\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\r\n      QueryFormat.HTMLGML2\r\n    ) {\r\n      if (typeof url === 'string') {\r\n        const urlGml = this.getQueryUrl(\r\n          layer.dataSource,\r\n          options,\r\n          true\r\n        ) as string;\r\n        return this.http.get(urlGml, { responseType: 'text' }).pipe(\r\n          mergeMap((gmlRes) => {\r\n            const mergedGML = this.mergeGML(gmlRes, url, layer);\r\n            const imposedGeom = mergedGML[0];\r\n            const imposedProperties = mergedGML[1];\r\n            return this.http\r\n              .get(url, { responseType: 'text' })\r\n              .pipe(\r\n                map((res) =>\r\n                  this.extractData(\r\n                    res,\r\n                    layer,\r\n                    options,\r\n                    url,\r\n                    imposedGeom,\r\n                    imposedProperties\r\n                  )\r\n                )\r\n              );\r\n          })\r\n        );\r\n      }\r\n      const urlGmls = this.getQueryUrl(layer.dataSource, options, true);\r\n      let observables: any = [];\r\n      for (let i = 0; i < urlGmls.length; i++) {\r\n        const element = urlGmls[i] as QueryUrlData;\r\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\r\n          observables.push(\r\n            this.requestDataForHTMLGML2(element.url, url[i].url, layer, options)\r\n          );\r\n        }\r\n      }\r\n      return observables;\r\n    } else {\r\n      if (typeof url === 'string') {\r\n        const request = this.http.get(url, { responseType: 'text' });\r\n        return request.pipe(\r\n          map((res) => this.extractData(res, layer, options, url))\r\n        );\r\n      }\r\n      let observables: any = [];\r\n      for (let i = 0; i < url.length; i++) {\r\n        const element: QueryUrlData = url[i];\r\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\r\n          const request = this.http.get(element.url, { responseType: 'text' });\r\n          observables.push(\r\n            request.pipe(\r\n              map((res) => this.extractData(res, layer, options, element.url))\r\n            )\r\n          );\r\n        }\r\n      }\r\n      return observables;\r\n    }\r\n  }\r\n\r\n  private requestDataForHTMLGML2(\r\n    urlGml: string,\r\n    url: string,\r\n    layer: Layer,\r\n    options: QueryOptions\r\n  ): Observable<Feature[]> {\r\n    return this.http.get(urlGml, { responseType: 'text' }).pipe(\r\n      mergeMap((gmlRes) => {\r\n        const mergedGML = this.mergeGML(gmlRes, url, layer);\r\n        const imposedGeom = mergedGML[0];\r\n        const imposedProperties = mergedGML[1];\r\n        return this.http\r\n          .get(url, { responseType: 'text' })\r\n          .pipe(\r\n            map((res) =>\r\n              this.extractData(\r\n                res,\r\n                layer,\r\n                options,\r\n                url,\r\n                imposedGeom,\r\n                imposedProperties\r\n              )\r\n            )\r\n          );\r\n      })\r\n    );\r\n  }\r\n\r\n  private checkScaleAndResolution(\r\n    resolution: number,\r\n    scale: number,\r\n    element: QueryUrlData\r\n  ): boolean {\r\n    let checkScale: boolean;\r\n    let checkResolution: boolean;\r\n\r\n    if (\r\n      !element.minResolution &&\r\n      !element.maxResolution &&\r\n      !element.minScale &&\r\n      !element.maxScale\r\n    ) {\r\n      return true;\r\n    } else {\r\n      /******************* checking Resolution *******************/\r\n      if (element.minResolution && element.maxResolution) {\r\n        // if \"minResolution\" and \"maxResolution\" exists check if resoltion is between\r\n        if (\r\n          resolution >= element.minResolution &&\r\n          resolution <= element.maxResolution\r\n        ) {\r\n          checkResolution = true;\r\n        }\r\n      } else {\r\n        // check if \"minResolution\" or \"maxResolution\" exists\r\n        if (element.minResolution && resolution >= element.minResolution) {\r\n          checkResolution = true;\r\n        }\r\n        if (element.maxResolution && resolution <= element.maxResolution) {\r\n          checkResolution = true;\r\n        }\r\n      }\r\n\r\n      /******************* checking Scale *******************/\r\n      if (element.minScale && element.maxScale) {\r\n        // if \"minScale\" and \"maxScale\" exists check if scale is between\r\n        if (scale > element.minScale && scale < element.maxScale) {\r\n          checkScale = true;\r\n        }\r\n      } else {\r\n        // check if \"minScale\" or \"maxScale\" exists\r\n        if (element.maxScale && scale <= element.maxScale) {\r\n          checkScale = true;\r\n        }\r\n        if (element.minScale && scale >= element.minScale) {\r\n          checkScale = true;\r\n        }\r\n      }\r\n\r\n      /******************* result of checking *******************/\r\n      if (checkScale === true && checkResolution === true) {\r\n        return true;\r\n      } else if (\r\n        (checkResolution === true && !checkScale) ||\r\n        (checkScale === true && !checkResolution)\r\n      ) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  private mergeGML(\r\n    gmlRes,\r\n    url,\r\n    layer: Layer\r\n  ): [FeatureGeometry, { [key: string]: any }] {\r\n    const parser = new olFormatGML2();\r\n    let features = parser.readFeatures(gmlRes);\r\n    // Handle non standard GML output (MapServer)\r\n    if (features.length === 0) {\r\n      const wmsParser = new olformat.WMSGetFeatureInfo();\r\n      features = wmsParser.readFeatures(gmlRes);\r\n    }\r\n    const olmline = new olgeom.MultiLineString([]);\r\n    let pts;\r\n    const ptsArray = [];\r\n    let olmpoly = new olgeom.MultiPolygon([]);\r\n    let firstFeatureType;\r\n    const nbFeatures = features.length;\r\n\r\n    // Check if geometry intersect bbox\r\n    // for geoserver getfeatureinfo response in data projection, not call projection\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const bboxRaw = searchParams.bbox;\r\n    const bbox = bboxRaw.split(',');\r\n    const bboxExtent = olextent.createEmpty();\r\n    olextent.extend(bboxExtent, bbox);\r\n    const outBboxExtent = false;\r\n    let titleContent;\r\n    let queryTileField;\r\n    if (layer.options?.source?.options) {\r\n      const dataSourceOptions = layer.options.source\r\n        .options as QueryableDataSourceOptions;\r\n      if (dataSourceOptions.queryTitle) {\r\n        queryTileField = dataSourceOptions.queryTitle;\r\n      }\r\n    }\r\n    features.map((feature) => {\r\n      if (queryTileField) {\r\n        let queryTitleContent = feature.getProperties()[queryTileField];\r\n        if (queryTitleContent) {\r\n          titleContent = !titleContent\r\n            ? queryTitleContent\r\n            : `${titleContent},${queryTitleContent}`;\r\n        }\r\n      }\r\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\r\n        outBboxExtent = true;\r\n        // TODO: Check to project the geometry?\r\n      }*/\r\n      const featureGeometryCoordinates = (\r\n        feature.getGeometry() as any\r\n      ).getCoordinates();\r\n      const featureGeometryType = feature.getGeometry().getType();\r\n\r\n      if (!firstFeatureType && !outBboxExtent) {\r\n        firstFeatureType = featureGeometryType;\r\n      }\r\n      if (!outBboxExtent) {\r\n        switch (featureGeometryType) {\r\n          case 'Point':\r\n            if (nbFeatures === 1) {\r\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\r\n            } else {\r\n              ptsArray.push(featureGeometryCoordinates);\r\n            }\r\n            break;\r\n          case 'LineString':\r\n            olmline.appendLineString(\r\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\r\n            );\r\n            break;\r\n          case 'Polygon':\r\n            olmpoly.appendPolygon(\r\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\r\n            );\r\n            break;\r\n          case 'MultiPolygon':\r\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\r\n            break;\r\n          default:\r\n            return;\r\n        }\r\n      }\r\n    });\r\n\r\n    let olmpts;\r\n    if (ptsArray.length === 0 && pts) {\r\n      olmpts = {\r\n        type: pts.getType(),\r\n        coordinates: pts.getCoordinates()\r\n      };\r\n    } else {\r\n      olmpts = {\r\n        type: 'Polygon',\r\n        coordinates: [this.convexHull(ptsArray)]\r\n      };\r\n    }\r\n\r\n    let returnGeometry;\r\n    switch (firstFeatureType) {\r\n      case 'LineString':\r\n        returnGeometry = {\r\n          type: olmline.getType(),\r\n          coordinates: olmline.getCoordinates()\r\n        };\r\n        break;\r\n      case 'Point':\r\n        returnGeometry = olmpts;\r\n        break;\r\n      case 'Polygon':\r\n        returnGeometry = {\r\n          type: olmpoly.getType(),\r\n          coordinates: olmpoly.getCoordinates()\r\n        };\r\n        break;\r\n      case 'MultiPolygon':\r\n        returnGeometry = {\r\n          type: olmpoly.getType(),\r\n          coordinates: olmpoly.getCoordinates()\r\n        };\r\n        break;\r\n    }\r\n    const imposedProperties = {};\r\n\r\n    if (queryTileField) {\r\n      imposedProperties[queryTileField] = titleContent;\r\n    }\r\n\r\n    return [returnGeometry, imposedProperties];\r\n  }\r\n\r\n  cross(a, b, o) {\r\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\r\n  }\r\n\r\n  /**\r\n   * @param points An array of [X, Y] coordinates\r\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\r\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\r\n   */\r\n  convexHull(points) {\r\n    points.sort((a, b) => {\r\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\r\n    });\r\n\r\n    const lower = [];\r\n    for (const point of points) {\r\n      while (\r\n        lower.length >= 2 &&\r\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\r\n      ) {\r\n        lower.pop();\r\n      }\r\n      lower.push(point);\r\n    }\r\n\r\n    const upper = [];\r\n    for (let i = points.length - 1; i >= 0; i--) {\r\n      while (\r\n        upper.length >= 2 &&\r\n        this.cross(\r\n          upper[upper.length - 2],\r\n          upper[upper.length - 1],\r\n          points[i]\r\n        ) <= 0\r\n      ) {\r\n        upper.pop();\r\n      }\r\n      upper.push(points[i]);\r\n    }\r\n\r\n    upper.pop();\r\n    lower.pop();\r\n    return lower.concat(upper);\r\n  }\r\n\r\n  private extractData(\r\n    res,\r\n    layer: Layer,\r\n    options: QueryOptions,\r\n    url: string,\r\n    imposedGeometry?,\r\n    imposedProperties?: { [key: string]: any }\r\n  ): Feature[] {\r\n    const queryDataSource = layer.dataSource as QueryableDataSource;\r\n\r\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\r\n    let features = [];\r\n    switch (queryDataSource.options.queryFormat) {\r\n      case QueryFormat.GML3:\r\n        features = this.extractGML3Data(\r\n          res,\r\n          layer.zIndex,\r\n          allowedFieldsAndAlias\r\n        );\r\n        break;\r\n      case QueryFormat.JSON:\r\n      case QueryFormat.GEOJSON:\r\n      case QueryFormat.GEOJSON2:\r\n        features = this.extractGeoJSONData(\r\n          res,\r\n          layer.zIndex,\r\n          allowedFieldsAndAlias\r\n        );\r\n        break;\r\n      case QueryFormat.ESRIJSON:\r\n        features = this.extractEsriJSONData(\r\n          res,\r\n          layer.zIndex,\r\n          allowedFieldsAndAlias\r\n        );\r\n        break;\r\n      case QueryFormat.TEXT:\r\n        features = this.extractTextData(res);\r\n        break;\r\n      case QueryFormat.HTML:\r\n        features = this.extractHtmlData(\r\n          res,\r\n          queryDataSource.queryHtmlTarget,\r\n          url\r\n        );\r\n        break;\r\n      case QueryFormat.HTMLGML2:\r\n        features = this.extractHtmlData(\r\n          res,\r\n          queryDataSource.queryHtmlTarget,\r\n          url,\r\n          imposedGeometry,\r\n          imposedProperties\r\n        );\r\n        break;\r\n      case QueryFormat.GML2:\r\n      default:\r\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\r\n        break;\r\n    }\r\n    if (\r\n      features.length > 0 &&\r\n      (features[0].geometry === null || !features[0].geometry)\r\n    ) {\r\n      const geomToAdd = this.createGeometryFromUrlClick(url);\r\n\r\n      for (const feature of features) {\r\n        feature.geometry = geomToAdd;\r\n      }\r\n    }\r\n\r\n    const wmsDatasource = layer.dataSource as WMSDataSource;\r\n    const featureCount = wmsDatasource.params?.FEATURE_COUNT\r\n      ? new RegExp('FEATURE_COUNT=' + this.featureCount)\r\n      : new RegExp('FEATURE_COUNT=' + this.defaultFeatureCount);\r\n\r\n    if (\r\n      featureCount.test(url) &&\r\n      ((wmsDatasource.params?.FEATURE_COUNT &&\r\n        this.featureCount > 1 &&\r\n        features.length === this.featureCount) ||\r\n        (!wmsDatasource.params?.FEATURE_COUNT &&\r\n          features.length === this.defaultFeatureCount))\r\n    ) {\r\n      const messageObj = this.messageService.info(\r\n        'igo.geo.query.featureCountMax',\r\n        undefined,\r\n        undefined,\r\n        { value: layer.title }\r\n      );\r\n      this.previousMessageIds.push(messageObj.toastId);\r\n    }\r\n\r\n    return features.map((feature: Feature, index: number) => {\r\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\r\n\r\n      let exclude;\r\n      if (layer.options.sourceOptions?.type === 'wms') {\r\n        const sourceOptions = layer.options\r\n          .sourceOptions as WMSDataSourceOptions;\r\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\r\n      }\r\n\r\n      let title = this.getQueryTitle(feature, layer);\r\n      if (!title && features.length > 1) {\r\n        title = `${layer.title} (${index + 1})`;\r\n      } else if (!title) {\r\n        title = layer.title;\r\n      }\r\n\r\n      const meta = Object.assign({}, feature.meta || {}, {\r\n        id: uuid(),\r\n        title,\r\n        mapTitle: mapLabel,\r\n        sourceTitle: layer.title,\r\n        order: 1000 - layer.zIndex,\r\n        excludeAttribute: exclude\r\n      });\r\n\r\n      return Object.assign(feature, {\r\n        meta,\r\n        projection:\r\n          queryDataSource.options.type === 'carto'\r\n            ? 'EPSG:4326'\r\n            : options.projection\r\n      });\r\n    });\r\n  }\r\n\r\n  private createGeometryFromUrlClick(url) {\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const bboxRaw = searchParams.bbox;\r\n    const width = parseInt(searchParams.width, 10);\r\n    const height = parseInt(searchParams.height, 10);\r\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\r\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\r\n\r\n    const bbox = bboxRaw.split(',');\r\n    let threshold =\r\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\r\n\r\n    // for context in degree (EPSG:4326,4269...)\r\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\r\n      threshold = 0.045;\r\n    }\r\n    const clickx =\r\n      parseFloat(bbox[0]) +\r\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\r\n        width -\r\n      threshold;\r\n    const clicky =\r\n      parseFloat(bbox[1]) +\r\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\r\n        height -\r\n      threshold;\r\n    const clickx1 = clickx + threshold * 2;\r\n    const clicky1 = clicky + threshold * 2;\r\n\r\n    const wktPoly =\r\n      'POLYGON((' +\r\n      clickx +\r\n      ' ' +\r\n      clicky +\r\n      ', ' +\r\n      clickx +\r\n      ' ' +\r\n      clicky1 +\r\n      ', ' +\r\n      clickx1 +\r\n      ' ' +\r\n      clicky1 +\r\n      ', ' +\r\n      clickx1 +\r\n      ' ' +\r\n      clicky +\r\n      ', ' +\r\n      clickx +\r\n      ' ' +\r\n      clicky +\r\n      '))';\r\n\r\n    const format = new olformat.WKT();\r\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\r\n    const f = tenPercentWidthGeom.getGeometry() as any;\r\n\r\n    const newGeom = {\r\n      type: f.getType(),\r\n      coordinates: f.getCoordinates()\r\n    };\r\n\r\n    return newGeom;\r\n  }\r\n\r\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\r\n    const parser = new olFormatGML2();\r\n    let features = parser.readFeatures(res);\r\n    // Handle non standard GML output (MapServer)\r\n    if (features.length === 0) {\r\n      const wmsParser = new olformat.WMSGetFeatureInfo();\r\n      try {\r\n        features = wmsParser.readFeatures(res);\r\n      } catch (e) {\r\n        console.warn(\r\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\r\n        );\r\n      }\r\n    }\r\n\r\n    return features.map((feature) =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\r\n    const parser = new olFormatGML3();\r\n    let features = [];\r\n    try {\r\n      features = parser.readFeatures(res);\r\n    } catch (e) {\r\n      console.warn('query.service: GML3 is not well supported');\r\n    }\r\n    return features.map((feature) =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\r\n    let features = [];\r\n    try {\r\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\r\n    } catch (e) {\r\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\r\n    }\r\n    features.map(\r\n      (feature) =>\r\n        (feature.meta = {\r\n          id: uuid(),\r\n          order: 1000 - zIndex,\r\n          alias: allowedFieldsAndAlias\r\n        })\r\n    );\r\n    return features;\r\n  }\r\n\r\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\r\n    if (res) {\r\n      try {\r\n        if (JSON.parse(res).error) {\r\n          return [];\r\n        }\r\n      } catch (e) {}\r\n    }\r\n    const parser = new olFormatEsriJSON();\r\n    const features = parser.readFeatures(res);\r\n\r\n    return features.map((feature) =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractTextData(res) {\r\n    // TODO\r\n    return [];\r\n  }\r\n\r\n  private extractHtmlData(\r\n    res,\r\n    htmlTarget: QueryHtmlTarget,\r\n    url,\r\n    imposedGeometry?,\r\n    imposedProperties?: { [key: string]: any }\r\n  ) {\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\r\n    const geomToAdd = this.createGeometryFromUrlClick(url);\r\n\r\n    if (\r\n      htmlTarget !== QueryHtmlTarget.BLANK &&\r\n      htmlTarget !== QueryHtmlTarget.IFRAME\r\n    ) {\r\n      htmlTarget = QueryHtmlTarget.IFRAME;\r\n    }\r\n\r\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\r\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\r\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\r\n    const body = striptags(\r\n      res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, '')\r\n    );\r\n    if (body === '' || res === '') {\r\n      return [];\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: FEATURE,\r\n        projection,\r\n        properties: Object.assign(\r\n          { target: htmlTarget, body: res, url },\r\n          imposedProperties\r\n        ),\r\n        geometry: imposedGeometry || geomToAdd\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getQueryParams(url) {\r\n    const queryString = url.split('?');\r\n    if (!queryString[1]) {\r\n      return;\r\n    }\r\n    const pairs = queryString[1].split('&');\r\n\r\n    const result = {};\r\n    pairs.forEach((pair) => {\r\n      pair = pair.split('=');\r\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\r\n    });\r\n    return result;\r\n  }\r\n\r\n  public featureToResult(\r\n    featureOL: olFeature<olgeom.Geometry>,\r\n    zIndex: number,\r\n    allowedFieldsAndAlias?\r\n  ): Feature {\r\n    const featureGeometry = featureOL.getGeometry() as any;\r\n    const properties: any = Object.assign({}, featureOL.getProperties());\r\n    delete properties.geometry;\r\n    delete properties.GEOMETRIE;\r\n    delete properties.boundedBy;\r\n    delete properties.shape;\r\n    delete properties.SHAPE;\r\n    delete properties.SHAPE_S;\r\n    delete properties.SHAPE_L;\r\n    delete properties.SHAPE_P;\r\n    delete properties.the_geom;\r\n    delete properties.geom;\r\n    delete properties.geom32198;\r\n\r\n    let geometry;\r\n    if (featureGeometry) {\r\n      geometry = {\r\n        type: featureGeometry.getType(),\r\n        coordinates: featureGeometry.getCoordinates()\r\n      };\r\n    }\r\n\r\n    return {\r\n      type: FEATURE,\r\n      projection: undefined,\r\n      properties,\r\n      geometry,\r\n      meta: {\r\n        id: uuid(),\r\n        order: 1000 - zIndex,\r\n        alias: allowedFieldsAndAlias\r\n      }\r\n    };\r\n  }\r\n\r\n  private getQueryUrl(\r\n    datasource: QueryableDataSource,\r\n    options: QueryOptions,\r\n    forceGML2 = false,\r\n    mapExtent?: MapExtent\r\n  ): string | QueryUrlData[] {\r\n    let url;\r\n\r\n    if (datasource.options.queryUrls) {\r\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\r\n    }\r\n\r\n    switch (datasource.constructor) {\r\n      case WMSDataSource:\r\n        const wmsDatasource = datasource as WMSDataSource;\r\n\r\n        const WMSGetFeatureInfoOptions = {\r\n          INFO_FORMAT:\r\n            wmsDatasource.params.INFO_FORMAT ||\r\n            this.getMimeInfoFormat(datasource.options.queryFormat),\r\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\r\n          FEATURE_COUNT:\r\n            wmsDatasource.params.FEATURE_COUNT || this.defaultFeatureCount\r\n        };\r\n\r\n        if (wmsDatasource.params.FEATURE_COUNT) {\r\n          this.featureCount = wmsDatasource.params.FEATURE_COUNT;\r\n        }\r\n\r\n        if (forceGML2) {\r\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\r\n            QueryFormat.GML2\r\n          );\r\n        }\r\n\r\n        url = wmsDatasource.ol.getFeatureInfoUrl(\r\n          options.coordinates,\r\n          options.resolution,\r\n          options.projection,\r\n          WMSGetFeatureInfoOptions\r\n        );\r\n        // const wmsVersion =\r\n        //   wmsDatasource.params.VERSION ||\r\n        //   wmsDatasource.params.version ||\r\n        //   '1.3.0';\r\n        // if (wmsVersion !== '1.3.0') {\r\n        //   url = url.replace('&I=', '&X=');\r\n        //   url = url.replace('&J=', '&Y=');\r\n        // }\r\n        break;\r\n      case CartoDataSource:\r\n        const cartoDatasource = datasource as CartoDataSource;\r\n        const baseUrl =\r\n          'https://' +\r\n          cartoDatasource.options.account +\r\n          '.carto.com/api/v2/sql?';\r\n        const format = 'format=GeoJSON';\r\n        const sql =\r\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\r\n        const clause =\r\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\r\n        const meters = cartoDatasource.options.queryPrecision\r\n          ? cartoDatasource.options.queryPrecision\r\n          : '1000';\r\n        const coordinates =\r\n          options.coordinates[0] +\r\n          ',' +\r\n          options.coordinates[1] +\r\n          '),3857),' +\r\n          meters +\r\n          '))';\r\n\r\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\r\n        break;\r\n      case ImageArcGISRestDataSource:\r\n      case TileArcGISRestDataSource:\r\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\r\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\r\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\r\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\r\n        const clickBuffer = maxDelta * 0.005;\r\n        const threshold = tileArcGISRestDatasource.options.queryPrecision\r\n          ? tileArcGISRestDatasource.options.queryPrecision\r\n          : clickBuffer;\r\n        const extent = olextent.buffer(\r\n          olextent.boundingExtent([options.coordinates]),\r\n          threshold\r\n        );\r\n        const serviceUrl =\r\n          tileArcGISRestDatasource.options.url +\r\n          '/' +\r\n          tileArcGISRestDatasource.options.layer +\r\n          '/query/';\r\n        const geometry = encodeURIComponent(\r\n          '{\"xmin\":' +\r\n            extent[0] +\r\n            ',\"ymin\":' +\r\n            extent[1] +\r\n            ',\"xmax\":' +\r\n            extent[2] +\r\n            ',\"ymax\":' +\r\n            extent[3] +\r\n            ',\"spatialReference\":{\"wkid\":102100}}'\r\n        );\r\n        const params = [\r\n          'f=json',\r\n          `geometry=${geometry}`,\r\n          'geometryType=esriGeometryEnvelope',\r\n          'inSR=102100',\r\n          'spatialRel=esriSpatialRelIntersects',\r\n          'outFields=*',\r\n          'returnGeometry=true',\r\n          'outSR=102100'\r\n        ];\r\n        url = `${serviceUrl}?${params.join('&')}`;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return url;\r\n  }\r\n\r\n  private getMimeInfoFormat(queryFormat: string) {\r\n    let mime = 'application/vnd.ogc.gml';\r\n    const keyEnum = Object.keys(QueryFormat).find(\r\n      (key) => QueryFormat[key] === queryFormat\r\n    );\r\n    if (keyEnum) {\r\n      mime = QueryFormatMimeType[keyEnum];\r\n    }\r\n\r\n    return mime;\r\n  }\r\n\r\n  getAllowedFieldsAndAlias(layer: any) {\r\n    let allowedFieldsAndAlias;\r\n    if (\r\n      layer.options?.source?.options?.sourceFields &&\r\n      layer.options.source.options.sourceFields.length >= 1\r\n    ) {\r\n      allowedFieldsAndAlias = {};\r\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\r\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\r\n        allowedFieldsAndAlias[sourceField.name] = alias;\r\n      });\r\n    }\r\n    return allowedFieldsAndAlias;\r\n  }\r\n\r\n  getQueryTitle(feature: Feature, layer: Layer): string {\r\n    let title;\r\n    if (layer.options?.source?.options) {\r\n      const dataSourceOptions = layer.options.source\r\n        .options as QueryableDataSourceOptions;\r\n      if (dataSourceOptions.queryTitle) {\r\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\r\n      }\r\n    }\r\n\r\n    return title;\r\n  }\r\n\r\n  getLabelMatch(feature: Feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach((v) => {\r\n      label = label.replace(v[0], feature.properties[v[1]]);\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.properties[labelMatch] || labelMatch;\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  /**\r\n   * @param datasource QueryableDataSource\r\n   * @param options QueryOptions\r\n   * @mapExtent extent of the map when click event\r\n   *\r\n   */\r\n\r\n  getCustomQueryUrl(\r\n    datasource: QueryableDataSource,\r\n    options: QueryOptions,\r\n    mapExtent?: MapExtent\r\n  ): QueryUrlData[] {\r\n    const extent = olextent.getForViewAndSize(\r\n      options.coordinates,\r\n      options.resolution,\r\n      0,\r\n      [101, 101]\r\n    );\r\n\r\n    return datasource.options.queryUrls.map((item) => {\r\n      let data: QueryUrlData = {\r\n        url: item.url\r\n          .replace(/\\{bbox\\}/g, extent.join(','))\r\n          .replace(/\\{x\\}/g, options.coordinates[0].toString())\r\n          .replace(/\\{y\\}/g, options.coordinates[1].toString())\r\n          .replace(/\\{resolution\\}/g, options.resolution.toString())\r\n          .replace(/\\{srid\\}/g, options.projection.replace('EPSG:', ''))\r\n      };\r\n\r\n      // if the queryFormat changed to \"QueryFormat.HTMLGML2\": mapExtent will be undefined\r\n      // we need to check \"mapExtent\" befor replace variables in the url\r\n      if (mapExtent) {\r\n        data.url\r\n          .replace(/\\{xmin\\}/g, mapExtent[0].toString())\r\n          .replace(/\\{ymin\\}/g, mapExtent[1].toString())\r\n          .replace(/\\{xmax\\}/g, mapExtent[2].toString())\r\n          .replace(/\\{ymax\\}/g, mapExtent[3].toString());\r\n      }\r\n\r\n      if (item.maxResolution) {\r\n        data.maxResolution = item.maxResolution;\r\n      }\r\n\r\n      if (item.minResolution) {\r\n        data.minResolution = item.minResolution;\r\n      }\r\n\r\n      if (item.minScale) {\r\n        data.minScale = item.minScale;\r\n      }\r\n\r\n      if (item.maxScale) {\r\n        data.maxScale = item.maxScale;\r\n      }\r\n\r\n      return data;\r\n    });\r\n  }\r\n}\r\n","import OlLayer from 'ol/layer/Layer';\r\nimport OlSource from 'ol/source/Source';\r\n\r\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\r\nimport { QueryableDataSource } from './query.interfaces';\r\n\r\n/**\r\n * Whether a layer is queryable\r\n * @param layer Layer\r\n * @returns True if the layer s squeryable\r\n */\r\nexport function layerIsQueryable(layer: AnyLayer): boolean {\r\n  const dataSource = layer.dataSource as QueryableDataSource;\r\n  return dataSource.options.queryable === true;\r\n}\r\n\r\n/**\r\n * Whether an OL layer is queryable\r\n * @param layer Layer\r\n * @returns True if the ol layer is queryable\r\n */\r\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\r\n  const layer = olLayer.get('_layer');\r\n  return layer === undefined ? false : layerIsQueryable(layer);\r\n}\r\n\r\n/**\r\n * Whether a layer's feature is queryable\r\n * @param layer Layer\r\n * @returns True if the layer's feature is queryable\r\n */\r\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\r\n  const dataSource = layer.dataSource as QueryableDataSource;\r\n  return dataSource.options.queryLayerFeatures !== undefined\r\n    ? dataSource.options.queryLayerFeatures === true\r\n    : true;\r\n}\r\n\r\n/**\r\n * Whether an OL Vector layer is queryable\r\n * @param layer Layer\r\n * @returns True if the ol vector layer is queryable\r\n */\r\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\r\n  const layer = olLayer.get('_layer');\r\n  return layer === undefined\r\n    ? false\r\n    : layerIsQueryable(layer) && layerFeatureIsQueryable(layer);\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  AfterViewInit,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { Subscription, Observable, of, zip } from 'rxjs';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport OlRenderFeature from 'ol/render/Feature';\r\nimport OlLayer from 'ol/layer/Layer';\r\nimport OlSource from 'ol/source/Source';\r\nimport olVectorSource from 'ol/source/Vector';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { EventsKey } from 'ol/events';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\r\nimport { featureFromOl } from '../../feature/shared/feature.utils';\r\nimport { QueryService } from './query.service';\r\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\r\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\r\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { QueryableDataSourceOptions } from './query.interfaces';\r\n\r\n/**\r\n * This directive makes a map queryable with a click of with a drag box.\r\n * By default, all layers are queryable but this can ben controlled at\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoQuery]'\r\n})\r\nexport class QueryDirective implements AfterViewInit, OnDestroy {\r\n  /**\r\n   * Subscriptions to ongoing queries\r\n   */\r\n  private queries$$: Subscription[] = [];\r\n\r\n  /**\r\n   * Listener to the map click event\r\n   */\r\n  private mapClickListener;\r\n\r\n  /**\r\n   * OL drag box interaction\r\n   */\r\n  private olDragSelectInteraction: OlDragSelectInteraction;\r\n\r\n  /**\r\n   * Ol drag box \"end\" event key\r\n   */\r\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\r\n\r\n  /**\r\n   * Whter to query features or not\r\n   */\r\n  @Input() queryFeatures: boolean = false;\r\n\r\n  /**\r\n   * Feature query hit tolerance\r\n   */\r\n  @Input() queryFeaturesHitTolerance: number = 0;\r\n\r\n  /**\r\n   * Feature query hit tolerance\r\n   */\r\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\r\n\r\n  /**\r\n   * Whether all query should complete before emitting an event\r\n   */\r\n  @Input() waitForAllQueries: boolean = true;\r\n\r\n  /**\r\n   * Event emitted when a query (or all queries) complete\r\n   */\r\n  @Output() query = new EventEmitter<{\r\n    features: Feature[] | Feature[][];\r\n    event: MapBrowserPointerEvent<any>;\r\n  }>();\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map as any as IgoMap;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private queryService: QueryService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to click and drag box events\r\n   * @internal\r\n   */\r\n  ngAfterViewInit() {\r\n    this.listenToMapClick();\r\n    this.addDragBoxInteraction();\r\n  }\r\n\r\n  /**\r\n   * Stop listening to click and drag box events and cancel ongoind requests\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.cancelOngoingQueries();\r\n    this.unlistenToMapClick();\r\n    this.removeDragBoxInteraction();\r\n  }\r\n\r\n  /**\r\n   * On map click, issue queries\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map clicks\r\n   */\r\n  private unlistenToMapClick() {\r\n    unByKey(this.mapClickListener);\r\n    this.mapClickListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Issue queries from a map event and emit events with the results\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\r\n    this.cancelOngoingQueries();\r\n    if (!this.queryService.queryEnabled) {\r\n      return;\r\n    }\r\n\r\n    const queries$ = [];\r\n    if (this.queryFeatures) {\r\n      queries$.push(this.doQueryFeatures(event));\r\n    }\r\n\r\n    const resolution = this.map.ol.getView().getResolution();\r\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\r\n    queries$.push(\r\n      ...this.queryService.query(queryLayers, {\r\n        coordinates: event.coordinate as [number, number],\r\n        projection: this.map.projection,\r\n        resolution\r\n      })\r\n    );\r\n\r\n    if (queries$.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (this.waitForAllQueries) {\r\n      this.queries$$.push(\r\n        zip(...queries$).subscribe((results: Feature[][]) => {\r\n          const features = [].concat(...results);\r\n          this.query.emit({ features, event });\r\n        })\r\n      );\r\n    } else {\r\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\r\n        return query$.subscribe((features: Feature[]) => {\r\n          this.query.emit({ features, event });\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Query features already present on the map\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private doQueryFeatures(\r\n    event: MapBrowserPointerEvent<any>\r\n  ): Observable<Feature[]> {\r\n    const clickedFeatures = [];\r\n\r\n    if (event.type === 'singleclick') {\r\n      this.map.ol.forEachFeatureAtPixel(\r\n        event.pixel,\r\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\r\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\r\n          if (\r\n            (layer.dataSource.options as QueryableDataSourceOptions)\r\n              .queryFormatAsWms\r\n          ) {\r\n            return;\r\n          }\r\n          if (featureOL) {\r\n            if (featureOL.get('features')) {\r\n              for (const feature of featureOL.get('features')) {\r\n                const newFeature = featureFromOl(feature, this.map.projection);\r\n                newFeature.meta = {\r\n                  title: feature.values_.nom,\r\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\r\n                  icon: feature.values_._icon,\r\n                  sourceTitle: layerOL.values_.title,\r\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer)\r\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\r\n                };\r\n                clickedFeatures.push(newFeature);\r\n              }\r\n            } else if (featureOL instanceof OlRenderFeature) {\r\n              const newFeature = renderFeatureFromOl(\r\n                featureOL,\r\n                this.map.projection,\r\n                layerOL\r\n              );\r\n              newFeature.meta = {\r\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\r\n                sourceTitle: layerOL.values_.title,\r\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n                title:\r\n                  this.queryService.getQueryTitle(newFeature, layer) ||\r\n                  newFeature.meta.title\r\n              };\r\n              clickedFeatures.push(newFeature);\r\n            } else {\r\n              const newFeature = featureFromOl(\r\n                featureOL,\r\n                this.map.projection,\r\n                layerOL\r\n              );\r\n              newFeature.meta = {\r\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\r\n                sourceTitle: layerOL.values_.title,\r\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n                title:\r\n                  this.queryService.getQueryTitle(newFeature, layer) ||\r\n                  newFeature.meta.title\r\n              };\r\n              clickedFeatures.push(newFeature);\r\n            }\r\n          }\r\n        },\r\n        {\r\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\r\n          layerFilter: this.queryFeaturesCondition\r\n            ? this.queryFeaturesCondition\r\n            : olLayerFeatureIsQueryable\r\n        }\r\n      );\r\n    } else if (event.type === 'boxend') {\r\n      const target = event.target as any;\r\n      const dragExtent = target.getGeometry().getExtent();\r\n      this.map.layers\r\n        .filter(layerIsQueryable)\r\n        .filter((layer) => layer instanceof VectorLayer && layer.visible)\r\n        .map((layer) => {\r\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\r\n          featuresOL.forEachFeatureIntersectingExtent(\r\n            dragExtent,\r\n            (olFeature: any) => {\r\n              const newFeature: Feature = featureFromOl(\r\n                olFeature,\r\n                this.map.projection,\r\n                layer.ol\r\n              );\r\n              newFeature.meta = {\r\n                id: layer.id + '.' + olFeature.getId(),\r\n                icon: olFeature.values_._icon,\r\n                sourceTitle: layer.title,\r\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n                title:\r\n                  this.queryService.getQueryTitle(newFeature, layer) ||\r\n                  newFeature.meta.title\r\n              };\r\n              clickedFeatures.push(newFeature);\r\n            }\r\n          );\r\n        });\r\n    }\r\n\r\n    return of(clickedFeatures);\r\n  }\r\n\r\n  /**\r\n   * Cancel ongoing requests, if any\r\n   */\r\n  private cancelOngoingQueries() {\r\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\r\n    this.queries$$ = [];\r\n  }\r\n\r\n  /**\r\n   * Add a drag box interaction and, on drag box end, select features\r\n   */\r\n  private addDragBoxInteraction() {\r\n    let olDragSelectInteractionOnQuery;\r\n    const olInteractions = this.map.ol.getInteractions().getArray();\r\n\r\n    // There can only be one dragbox interaction, so find the current one, if any\r\n    // Don't keep a reference to the current dragbox because we don't want\r\n    // to remove it when this startegy is deactivated\r\n    for (const olInteraction of olInteractions) {\r\n      if (olInteraction instanceof OlDragSelectInteraction) {\r\n        olDragSelectInteractionOnQuery = olInteraction;\r\n        break;\r\n      }\r\n    }\r\n    // If no drag box interaction is found, create a new one and add it to the map\r\n    if (olDragSelectInteractionOnQuery === undefined) {\r\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\r\n        condition: ctrlKeyDown\r\n      });\r\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\r\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\r\n    }\r\n\r\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\r\n      'boxend',\r\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove drag box interaction\r\n   */\r\n  private removeDragBoxInteraction() {\r\n    if (this.olDragSelectInteractionEndKey !== undefined) {\r\n      unByKey(this.olDragSelectInteractionEndKey);\r\n    }\r\n    if (this.olDragSelectInteraction !== undefined) {\r\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\r\n    }\r\n    this.olDragSelectInteraction = undefined;\r\n  }\r\n}\r\n","import { ObjectUtils } from '@igo2/utils';\r\nimport { StorageService } from '@igo2/core';\r\nimport {\r\n  ISearchSourceParams,\r\n  SearchSourceOptions,\r\n  SearchSourceSettings\r\n} from './source.interfaces';\r\nimport { FeatureStore } from '../../../feature';\r\nimport { Workspace } from '@igo2/common';\r\n\r\n/**\r\n * Base search source class\r\n */\r\nexport class SearchSource {\r\n  /**\r\n   * Search source ID\r\n   * @internal\r\n   */\r\n  static id = '';\r\n\r\n  /**\r\n   * Search source type\r\n   * @internal\r\n   */\r\n  static type = '';\r\n\r\n  /**\r\n   * Search source options\r\n   * @internal\r\n   */\r\n  protected options: SearchSourceOptions;\r\n\r\n  /**\r\n   * Get search source's id\r\n   * @returns Search source's id\r\n   */\r\n  getId(): string {\r\n    throw new Error('You have to implement the method \"getId\".');\r\n  }\r\n  /**\r\n   * Get search source's type\r\n   * @returns Search source's type\r\n   */\r\n  getType(): string {\r\n    throw new Error('You have to implement the method \"getType\".');\r\n  }\r\n\r\n  /**\r\n   * Get search source's default options\r\n   * @returns Search source default options\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\r\n  }\r\n\r\n  /**\r\n   * Search source's title\r\n   */\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  /**\r\n   * Whether the search source is available\r\n   */\r\n  get available(): boolean {\r\n    return this.options.available !== false;\r\n  }\r\n\r\n  /**\r\n   * Whether the search source is enabled\r\n   */\r\n  set enabled(value: boolean) {\r\n    this.options.enabled = value;\r\n  }\r\n  get enabled(): boolean {\r\n    return this.available && this.options.enabled !== false;\r\n  }\r\n\r\n  get showInPointerSummary(): boolean {\r\n    const showInPointerSummary = this.options.showInPointerSummary;\r\n    return showInPointerSummary ? showInPointerSummary : false;\r\n  }\r\n\r\n  get showInSettings(): boolean {\r\n    const showInSettings = this.options.showInSettings;\r\n    return showInSettings === undefined ? true : showInSettings;\r\n  }\r\n\r\n  /**\r\n   * Search url\r\n   */\r\n  get searchUrl(): string {\r\n    return this.options.searchUrl;\r\n  }\r\n\r\n  /**\r\n   * Search query params\r\n   */\r\n  get params(): ISearchSourceParams | null {\r\n    return this.options.params;\r\n  }\r\n\r\n  /**\r\n   * Search settings\r\n   */\r\n  get settings(): SearchSourceSettings[] {\r\n    return this.options.settings === undefined ? [] : this.options.settings;\r\n  }\r\n\r\n  set featureStoresWithIndex(storesWithIndex: FeatureStore[]) {\r\n    this._featureStoresWithIndex = storesWithIndex;\r\n  }\r\n  get featureStoresWithIndex() {\r\n    return this._featureStoresWithIndex;\r\n  }\r\n  private _featureStoresWithIndex: FeatureStore[];\r\n\r\n  setWorkspaces(workspaces: Workspace[]) {\r\n    if (\r\n      workspaces.filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\r\n        .length >= 1\r\n    ) {\r\n      this.options.available = true;\r\n    } else {\r\n      this.options.available = false;\r\n    }\r\n    const values = [];\r\n    this.featureStoresWithIndex = workspaces\r\n      .filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\r\n      .map((fw) => {\r\n        values.push({\r\n          title: fw.title,\r\n          value: fw.title,\r\n          enabled: true\r\n        });\r\n        return fw.entityStore as FeatureStore;\r\n      });\r\n    const datasets = this.options.settings.find((s) => s.title === 'datasets');\r\n    if (datasets) {\r\n      datasets.values = values;\r\n    }\r\n    this.setParamFromSetting(datasets);\r\n  }\r\n\r\n  /**\r\n   * Set params from selected settings\r\n   */\r\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\r\n    switch (setting.type) {\r\n      case 'radiobutton':\r\n        setting.values.forEach((conf) => {\r\n          if (conf.enabled) {\r\n            this.options.params = Object.assign(this.options.params || {}, {\r\n              [setting.name]: conf.value\r\n            });\r\n          }\r\n        });\r\n        break;\r\n      case 'checkbox':\r\n        let confValue = '';\r\n        setting.values\r\n          .filter((s) => s.available !== false)\r\n          .forEach((conf) => {\r\n            if (conf.enabled) {\r\n              confValue += conf.value + ',';\r\n            }\r\n          });\r\n        confValue = confValue.slice(0, -1);\r\n        this.options.params = Object.assign(this.options.params || {}, {\r\n          [setting.name]: confValue\r\n        });\r\n        break;\r\n    }\r\n\r\n    if (saveInStorage && this.storageService) {\r\n      this.storageService.set(this.getId() + '.options', {\r\n        params: this.options.params\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search results display order\r\n   */\r\n  get displayOrder(): number {\r\n    return this.options.order === undefined ? 99 : this.options.order;\r\n  }\r\n\r\n  constructor(\r\n    options: SearchSourceOptions,\r\n    private storageService?: StorageService\r\n  ) {\r\n    this.options = options;\r\n    if (this.storageService) {\r\n      const storageOptions = this.storageService.get(\r\n        this.getId() + '.options'\r\n      ) as object;\r\n      if (storageOptions) {\r\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\r\n      }\r\n    }\r\n\r\n    this.options = ObjectUtils.mergeDeep(\r\n      this.getDefaultOptions(),\r\n      this.options\r\n    );\r\n\r\n    // Set Default Params from Settings\r\n    this.settings.forEach((setting) => {\r\n      this.setParamFromSetting(setting, false);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get hashtags valid\r\n   * @param hashtag hashtag from query\r\n   */\r\n  getHashtagsValid(term: string, settingsName: string): string[] {\r\n    const hashtags = term.match(/(#[A-Za-z--+]+)/g);\r\n    if (!hashtags) {\r\n      return undefined;\r\n    }\r\n\r\n    const searchSourceSetting = this.getSettingsValues(settingsName);\r\n    const hashtagsValid = [];\r\n    hashtags.forEach((hashtag) => {\r\n      searchSourceSetting.values.forEach((conf) => {\r\n        const hashtagKey = hashtag.substring(1);\r\n        if (typeof conf.value === 'string') {\r\n          const types = conf.value\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n            .split(',');\r\n          const index = types.indexOf(\r\n            hashtagKey\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '')\r\n          );\r\n          if (index !== -1) {\r\n            hashtagsValid.push(types[index]);\r\n          }\r\n        }\r\n        if (\r\n          conf.hashtags &&\r\n          conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1\r\n        ) {\r\n          hashtagsValid.push(conf.value);\r\n        }\r\n      });\r\n    });\r\n\r\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\r\n  }\r\n\r\n  getSettingsValues(search: string): SearchSourceSettings {\r\n    return this.getDefaultOptions().settings.find(\r\n      (value: SearchSourceSettings) => {\r\n        return value.name === search;\r\n      }\r\n    );\r\n  }\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","export class GoogleLinks {\r\n  static getGoogleMapsCoordLink(lon, lat) {\r\n    return `https://www.google.com/maps/search/?api=1&query=${lat}%2C${lon}`;\r\n  }\r\n\r\n  static getGoogleStreetViewLink(lon, lat) {\r\n    return `https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${lat}%2C${lon}`;\r\n  }\r\n\r\n  static getGoogleMapsNameLink(name) {\r\n    const encodedName = encodeURI(name);\r\n    return `https://www.google.com/maps/search/?api=1&query=${encodedName}`;\r\n  }\r\n}\r\n","export class OsmLinks {\r\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\r\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\r\n  }\r\n\r\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\r\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { RegexService } from '@igo2/core';\r\nimport { GeoServiceDefinition } from './propertyTypeDetector.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PropertyTypeDetectorService {\r\n  public geoServiceRegexes: GeoServiceDefinition[] = [];\r\n\r\n  constructor(private regexService: RegexService) {\r\n    this.geoServiceRegexes = this.getGeoServiceRegexes();\r\n  }\r\n\r\n  getPropertyType(value) {\r\n    return typeof value;\r\n  }\r\n\r\n  private isUrl(value): boolean {\r\n    const regex = /^https?:\\/\\//;\r\n    return regex.test(value.toString());\r\n  }\r\n\r\n  isGeoService(value): boolean {\r\n    let isGeoService = false;\r\n    if (!this.isUrl) {\r\n      return;\r\n    }\r\n    for (const geoServiceRegex of this.geoServiceRegexes) {\r\n      const domainRegex = new RegExp(geoServiceRegex.url);\r\n      if (domainRegex.test(value)) {\r\n        isGeoService = true;\r\n        break;\r\n      }\r\n    }\r\n    return isGeoService;\r\n  }\r\n\r\n  getGeoService(\r\n    url: string,\r\n    availableProperties: string[]\r\n  ): GeoServiceDefinition {\r\n    if (!this.isGeoService(url)) {\r\n      return;\r\n    }\r\n    let matchingGeoservice: GeoServiceDefinition;\r\n    for (const geoServiceRegex of this.geoServiceRegexes) {\r\n      const domainRegex = new RegExp(geoServiceRegex.url);\r\n      if (domainRegex.test(url)) {\r\n        // providing the the first matching regex;\r\n        const matchingProperties = availableProperties.filter((p) =>\r\n          geoServiceRegex.propertiesForLayerName.includes(p)\r\n        );\r\n        matchingGeoservice = matchingProperties ? geoServiceRegex : undefined;\r\n        if (matchingGeoservice) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return matchingGeoservice;\r\n  }\r\n\r\n  private getGeoServiceRegexes(): GeoServiceDefinition[] {\r\n    return (this.regexService.get('geoservice') ||\r\n      []) as GeoServiceDefinition[];\r\n  }\r\n}\r\n","import { Observable } from 'rxjs';\r\n\r\nimport { TooltipType } from '../../layer/shared';\r\nimport { TimeFilterOptions } from '../../filter/shared';\r\nimport { QueryFormat, QueryHtmlTarget } from '../../query/shared';\r\n\r\nimport { ICatalog, CatalogItem, CatalogItemGroup } from './catalog.interface';\r\nimport { TypeCatalogStrings } from './catalog.enum';\r\n\r\nexport abstract class Catalog implements ICatalog {\r\n  id: string;\r\n  title: string;\r\n  url: string;\r\n  removable?: boolean;\r\n  externalProvider?: boolean;\r\n  abstract?: string;\r\n  forcedProperties?: any[];\r\n  items?: CatalogItem[];\r\n  type?: TypeCatalogStrings;\r\n  version?: string;\r\n  matrixSet?: string;\r\n  requestEncoding?: string;\r\n  regFilters?: string[];\r\n  groupImpose?: CatalogItemGroup;\r\n  groupSeparator?: string;\r\n  timeFilter?: TimeFilterOptions;\r\n  queryFormat?: QueryFormat;\r\n  queryHtmlTarget?: QueryHtmlTarget;\r\n  queryParams?: { [key: string]: string };\r\n  sourceOptions?: { [key: string]: any };\r\n  count?: number;\r\n  tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\r\n  sortDirection?: 'asc' | 'desc';\r\n  setCrossOriginAnonymous?: boolean;\r\n  showLegend?: boolean;\r\n  profils?: string[];\r\n\r\n  constructor(options: Catalog) {\r\n    Object.assign(this, options);\r\n  }\r\n\r\n  public abstract collectCatalogItems(): Observable<CatalogItem[]>;\r\n}\r\n\r\nexport type CollectCatalogItemsFn = (\r\n  _this: Catalog\r\n) => Observable<CatalogItem[]>;\r\n","import { Observable } from 'rxjs';\r\nimport { Catalog, CollectCatalogItemsFn } from './catalog.abstract';\r\nimport { TypeCatalog } from './catalog.enum';\r\nimport {\r\n  CatalogItem,\r\n  CatalogItemGroup,\r\n  ICatalog,\r\n  ICompositeCatalog\r\n} from './catalog.interface';\r\n\r\nexport class WMSCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.wms];\r\n    this.type = TypeCatalog[sType];\r\n  }\r\n\r\n  public collectCatalogItems(): Observable<CatalogItem[]> {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class WMTSCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.wmts];\r\n    this.type = TypeCatalog[sType];\r\n  }\r\n\r\n  public collectCatalogItems(): Observable<CatalogItem[]> {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class BaselayersCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.baselayers];\r\n    this.type = TypeCatalog[sType];\r\n  }\r\n\r\n  public collectCatalogItems(): Observable<CatalogItemGroup[]> {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class ArcGISRestCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\r\n    this.type = TypeCatalog[sType];\r\n  }\r\n\r\n  public collectCatalogItems() {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class TileOrImageArcGISRestCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    public _collectCatlogItems: CollectCatalogItemsFn,\r\n    typeCatalog: TypeCatalog\r\n  ) {\r\n    super(options);\r\n    this.type = TypeCatalog[TypeCatalog[typeCatalog]];\r\n  }\r\n\r\n  public collectCatalogItems() {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\r\n  declare composite: ICatalog[];\r\n\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.composite];\r\n    this.type = TypeCatalog[sType];\r\n    this.url = null;\r\n  }\r\n\r\n  public collectCatalogItems(): Observable<CatalogItem[]> {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { EMPTY, Observable, of, zip } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\nimport { uuid, ObjectUtils } from '@igo2/utils';\r\nimport { LanguageService, MessageService, ConfigService } from '@igo2/core';\r\nimport {\r\n  CapabilitiesService,\r\n  WMSDataSourceOptions,\r\n  WMSDataSourceOptionsParams,\r\n  WMTSDataSourceOptions,\r\n  ArcGISRestDataSourceOptions\r\n} from '../../datasource';\r\nimport { LayerOptions, ImageLayerOptions } from '../../layer/shared';\r\nimport { getResolutionFromScale } from '../../map/shared';\r\n\r\nimport {\r\n  CatalogItem,\r\n  CatalogItemLayer,\r\n  CatalogItemGroup,\r\n  ForcedProperty\r\n} from './catalog.interface';\r\nimport { Catalog } from './catalog.abstract';\r\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\r\nimport { QueryFormat } from '../../query/shared';\r\nimport { generateIdFromSourceOptions } from '../../utils';\r\nimport {\r\n  ArcGISRestCatalog,\r\n  BaselayersCatalog,\r\n  CompositeCatalog,\r\n  TileOrImageArcGISRestCatalog,\r\n  WMSCatalog,\r\n  WMTSCatalog\r\n} from './catalogs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CatalogService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {}\r\n\r\n  loadCatalogs(): Observable<Catalog[]> {\r\n    const contextConfig = this.config.getConfig('context') || {};\r\n    const catalogConfig = this.config.getConfig('catalog') || {};\r\n    const apiUrl = catalogConfig.url || contextConfig.url;\r\n    const catalogsFromConfig = catalogConfig.sources || [];\r\n\r\n    const observables$ = [];\r\n\r\n    if (apiUrl) {\r\n      // Base layers catalog\r\n      if (catalogConfig.baseLayers) {\r\n        const translate = this.languageService.translate;\r\n        const title = translate.instant('igo.geo.catalog.baseLayers');\r\n        const baseLayersCatalog = [\r\n          {\r\n            id: 'catalog.baselayers',\r\n            title,\r\n            url: `${apiUrl}/baselayers`,\r\n            type: 'baselayers'\r\n          }\r\n        ];\r\n        observables$.push(of(baseLayersCatalog));\r\n      }\r\n\r\n      // Catalogs from API\r\n      const catalogsFromApi$ = this.http\r\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\r\n        .pipe(\r\n          map((catalogs) =>\r\n            catalogs.map((c: any) => Object.assign(c, c.options))\r\n          ),\r\n          catchError((_response: HttpErrorResponse) => EMPTY)\r\n        );\r\n      observables$.push(catalogsFromApi$);\r\n    }\r\n\r\n    // Catalogs from config\r\n    if (catalogsFromConfig.length > 0) {\r\n      observables$.push(\r\n        of(catalogsFromConfig).pipe(\r\n          map((catalogs: Catalog[]) =>\r\n            catalogs.map((c) => {\r\n              if (!c.id) {\r\n                c.id = uuid();\r\n              }\r\n              return c;\r\n            })\r\n          )\r\n        )\r\n      );\r\n    }\r\n\r\n    return zip(...observables$).pipe(\r\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\r\n    ) as Observable<Catalog[]>;\r\n  }\r\n\r\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    let newCatalog: Catalog;\r\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\r\n    return newCatalog.collectCatalogItems();\r\n  }\r\n\r\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\r\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\r\n      map((layersOptions: LayerOptions[]) => {\r\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\r\n          return {\r\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\r\n            title: layerOptions.title,\r\n            type: CatalogItemType.Layer,\r\n            externalProvider: catalog.externalProvider,\r\n            options: layerOptions\r\n          } as CatalogItemLayer;\r\n        });\r\n        return [\r\n          {\r\n            id: 'catalog.group.baselayers',\r\n            type: CatalogItemType.Group,\r\n            externalProvider: catalog.externalProvider,\r\n            title: catalog.title,\r\n            items\r\n          }\r\n        ];\r\n      })\r\n    );\r\n  }\r\n\r\n  private getCatalogBaseLayersOptions(\r\n    catalog: Catalog\r\n  ): Observable<LayerOptions[]> {\r\n    return this.http.get<LayerOptions[]>(catalog.url);\r\n  }\r\n\r\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => {\r\n        const items = [];\r\n        if (!capabilities) {\r\n          return items;\r\n        }\r\n        if (\r\n          capabilities.Service &&\r\n          capabilities.Service.Abstract &&\r\n          capabilities.Service.Abstract.length\r\n        ) {\r\n          catalog.abstract = capabilities.Service.Abstract;\r\n        }\r\n        const finalLayers = [];\r\n        this.flattenWmsCapabilities(\r\n          capabilities.Capability.Layer,\r\n          0,\r\n          finalLayers,\r\n          catalog.groupSeparator\r\n        );\r\n        const capabilitiesCapabilityLayer = Object.assign(\r\n          {},\r\n          capabilities.Capability.Layer\r\n        );\r\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(\r\n          (f) => f.Layer.length !== 0\r\n        );\r\n        this.includeRecursiveItems(catalog, capabilitiesCapabilityLayer, items);\r\n        return items;\r\n      })\r\n    );\r\n  }\r\n\r\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\r\n    if (!finalLayers.includes(parent.Title)) {\r\n      const modifiedParent = Object.assign({}, parent);\r\n      modifiedParent.Layer = [];\r\n      finalLayers.push(modifiedParent);\r\n    }\r\n    for (const layer of parent.Layer) {\r\n      const modifiedLayer = Object.assign({}, layer);\r\n      if (level > 0) {\r\n        modifiedLayer.Title = parent.Title + separator + layer.Title;\r\n      }\r\n      if (layer.Layer) {\r\n        this.flattenWmsCapabilities(\r\n          modifiedLayer,\r\n          level + 1,\r\n          finalLayers,\r\n          separator\r\n        );\r\n      } else {\r\n        finalLayers.find((ff) => ff.Title === parent.Title).Layer.push(layer);\r\n      }\r\n    }\r\n  }\r\n\r\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\r\n    );\r\n  }\r\n\r\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => {\r\n        return this.getArcGISRESTItems(catalog, capabilities);\r\n      })\r\n    );\r\n  }\r\n\r\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\r\n\r\n    const catalogsFromInstance = [] as Catalog[];\r\n    compositeCatalog.map((component: Catalog) => {\r\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\r\n      catalogsFromInstance.push(\r\n        CatalogFactory.createInstanceCatalog(component, this)\r\n      );\r\n    });\r\n\r\n    // get CatalogItems for each original Catalog-----------------------------------------------------\r\n    const request1$ = [];\r\n    catalogsFromInstance.map((component: Catalog) =>\r\n      request1$.push(component.collectCatalogItems())\r\n    );\r\n\r\n    // integrate imposed group -----------------------------------------------------\r\n    let request2$ = [];\r\n\r\n    function flatDeepLayer(arr) {\r\n      return arr.reduce(\r\n        (acc, val) =>\r\n          acc.concat(\r\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\r\n          ),\r\n        []\r\n      );\r\n    }\r\n\r\n    if (\r\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\r\n    ) {\r\n      const pushImposeGroup = (item, index) => {\r\n        const c = catalogsFromInstance[index];\r\n        const outGroupImpose = Object.assign({}, c.groupImpose);\r\n        outGroupImpose.address = c.id;\r\n        outGroupImpose.type = CatalogItemType.Group;\r\n        outGroupImpose.externalProvider = c.externalProvider;\r\n        if (outGroupImpose.sortDirection === undefined) {\r\n          outGroupImpose.sortDirection = c.sortDirection;\r\n        }\r\n        outGroupImpose.items = [];\r\n\r\n        const flatLayer = flatDeepLayer(item);\r\n        flatLayer.map(\r\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\r\n        );\r\n        outGroupImpose.items = flatLayer;\r\n\r\n        return outGroupImpose;\r\n      };\r\n\r\n      request2$ = request1$.map((obs, idx) =>\r\n        obs.pipe(\r\n          map((items) =>\r\n            compositeCatalog[idx].groupImpose\r\n              ? pushImposeGroup(items, idx)\r\n              : items\r\n          )\r\n        )\r\n      );\r\n    } else {\r\n      request2$ = request1$;\r\n    }\r\n\r\n    // concat Group -----------------------------------------------------\r\n    const request3$ = zip(...request2$).pipe(\r\n      map(\r\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\r\n      )\r\n    );\r\n\r\n    // merge Group (first level only) -----------------------------------------------------\r\n    const groupByGroupId = (data, keyFn) =>\r\n      data.reduce((acc, group) => {\r\n        const groupId = keyFn(group);\r\n        const ind = acc.find((x) => x.id === groupId);\r\n\r\n        if (!ind) {\r\n          acc[acc.length] = group;\r\n        } else {\r\n          const ix = acc.indexOf(ind);\r\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\r\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\r\n          }\r\n          acc[ix].items.push(...group.items);\r\n        }\r\n        return acc;\r\n      }, []);\r\n\r\n    // merge Layer for each Level (catalog, group(recursive))\r\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\r\n      items.reduce((acc, item, idx, arr) => {\r\n        const layerTitle = keyFn(item);\r\n        const outItem = Object.assign({}, item);\r\n\r\n        if (item.type === CatalogItemType.Layer) {\r\n          // same title, same address => result: only one item is kept\r\n\r\n          // same title, address diff\r\n          const indicesMatchTitle = [];\r\n          const indicesMatchNewMetadataUrl = []; // metadata\r\n          const diffAddress = arr.filter((x, i) => {\r\n            let bInd = false;\r\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\r\n              if (i !== idx && x.address !== item.address) {\r\n                bInd = true;\r\n              }\r\n              indicesMatchTitle.push(i);\r\n            }\r\n            return bInd;\r\n          }); // $& i !== idx\r\n\r\n          if (diffAddress.length > 0) {\r\n            let nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\r\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\r\n            nPosition =\r\n              indicesMatchNewMetadataUrl.findIndex((x) => x === idx) + 1;\r\n            outItem.newMetadataUrl = `${item.newMetadataUrl} (${nPosition})`; // source: ${item.address.split('.')[0]}\r\n          }\r\n\r\n          const exist = acc.find(\r\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\r\n          );\r\n          if (!exist) {\r\n            acc[acc.length] = outItem;\r\n          }\r\n        } else if (item.type === CatalogItemType.Group) {\r\n          outItem.items = recursiveGroupByLayerAddress(\r\n            item.items,\r\n            (layer) => layer.title\r\n          );\r\n          acc[acc.length] = outItem;\r\n        }\r\n\r\n        return acc;\r\n      }, []);\r\n\r\n    const request4$ = request3$.pipe(\r\n      map((output) => groupByGroupId(output, (group) => group.id)),\r\n      map((output) => [].concat(...output)),\r\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\r\n    );\r\n\r\n    return request4$;\r\n  }\r\n\r\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\r\n    const sType: string = TypeCatalog[catalog.type as string];\r\n    return this.capabilitiesService\r\n      .getCapabilities(sType as any, catalog.url, catalog.version)\r\n      .pipe(\r\n        catchError((e) => {\r\n          this.messageService.error(\r\n            catalog.title\r\n              ? 'igo.geo.catalog.unavailable'\r\n              : 'igo.geo.catalog.someUnavailable',\r\n            'igo.geo.catalog.unavailableTitle',\r\n            undefined,\r\n            catalog.title ? { value: catalog.title } : undefined\r\n          );\r\n          console.error(e);\r\n          return of(undefined);\r\n        })\r\n      );\r\n  }\r\n\r\n  private computeForcedProperties(\r\n    layerNameFromCatalog: string,\r\n    forcedProperties: ForcedProperty[]\r\n  ): ForcedProperty {\r\n    if (!forcedProperties || forcedProperties.length === 0) {\r\n      return;\r\n    }\r\n    const returnProperty: ForcedProperty = {\r\n      layerName: layerNameFromCatalog,\r\n      title: undefined,\r\n      metadataUrl: undefined,\r\n      metadataAbstract: undefined,\r\n      metadataAbstractAll: undefined,\r\n      metadataUrlAll: undefined\r\n    };\r\n    //process wildcard before\r\n    // if there is a * wildcard\r\n    const forcedPropertiesForAllLayers = forcedProperties.find(\r\n      (f) => f.layerName === '*'\r\n    );\r\n    if (forcedPropertiesForAllLayers) {\r\n      // metadataAbstractAll\r\n      if (forcedPropertiesForAllLayers.metadataAbstractAll) {\r\n        returnProperty.metadataAbstractAll =\r\n          forcedPropertiesForAllLayers.metadataAbstractAll;\r\n      }\r\n      // metadataUrlAll\r\n      if (forcedPropertiesForAllLayers.metadataUrlAll) {\r\n        returnProperty.metadataUrlAll =\r\n          forcedPropertiesForAllLayers.metadataUrlAll;\r\n      }\r\n    }\r\n    forcedProperties.map((forcedProperty) => {\r\n      // if match found\r\n      if (layerNameFromCatalog === forcedProperty.layerName) {\r\n        // title\r\n        if (forcedProperty.title) {\r\n          returnProperty.title = forcedProperty.title;\r\n        }\r\n        // metadataUrl\r\n        if (forcedProperty.metadataUrl) {\r\n          returnProperty.metadataUrl = forcedProperty.metadataUrl;\r\n        }\r\n        // metadataAbstract\r\n        if (forcedProperty.metadataAbstract) {\r\n          returnProperty.metadataAbstract = forcedProperty.metadataAbstract;\r\n        }\r\n      }\r\n    });\r\n    return returnProperty;\r\n  }\r\n\r\n  /// WMS\r\n\r\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\r\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\r\n      layer.Name,\r\n      layersQueryFormat\r\n    );\r\n\r\n    const legendOptions =\r\n      catalog.showLegend && layer.Style\r\n        ? this.capabilitiesService.getStyle(layer.Style)\r\n        : undefined;\r\n\r\n    const params = Object.assign({}, catalog.queryParams, {\r\n      LAYERS: layer.Name,\r\n      VERSION: catalog.version\r\n    } as WMSDataSourceOptionsParams);\r\n\r\n    const baseSourceOptions = {\r\n      type: 'wms',\r\n      url: catalog.url,\r\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\r\n      queryFormat: configuredQueryFormat,\r\n      queryHtmlTarget:\r\n        configuredQueryFormat === QueryFormat.HTML ||\r\n        configuredQueryFormat === QueryFormat.HTMLGML2\r\n          ? 'iframe'\r\n          : undefined,\r\n      optionsFromCapabilities: true\r\n    };\r\n\r\n    const sourceOptions = Object.assign(\r\n      {},\r\n      baseSourceOptions,\r\n      catalog.sourceOptions,\r\n      { params }\r\n    ) as WMSDataSourceOptions;\r\n\r\n    const propertiesToForce = this.computeForcedProperties(\r\n      layer.Name,\r\n      catalog.forcedProperties\r\n    );\r\n    let baseAbstract;\r\n    let extern = true;\r\n    if (layer.Abstract) {\r\n      baseAbstract = layer.Abstract;\r\n    } else if (!layer.Abstract && catalog.abstract) {\r\n      baseAbstract = catalog.abstract;\r\n    }\r\n    const layerOnlineResource =\r\n      layer?.DataURL && layer?.DataURL.length > 0\r\n        ? layer?.DataURL[0].OnlineResource\r\n        : undefined;\r\n\r\n    let metadataUrl =\r\n      propertiesToForce?.metadataUrl ||\r\n      propertiesToForce?.metadataUrlAll ||\r\n      layerOnlineResource;\r\n    let metadataAbstract =\r\n      propertiesToForce?.metadataAbstract ||\r\n      propertiesToForce?.metadataAbstractAll ||\r\n      baseAbstract;\r\n\r\n    if (\r\n      !propertiesToForce?.metadataUrl &&\r\n      !propertiesToForce?.metadataUrlAll &&\r\n      (propertiesToForce?.metadataAbstract ||\r\n        propertiesToForce?.metadataAbstractAll)\r\n    ) {\r\n      extern = false;\r\n    }\r\n    if (\r\n      propertiesToForce?.metadataAbstract &&\r\n      propertiesToForce?.metadataUrlAll\r\n    ) {\r\n      extern = false;\r\n    }\r\n\r\n    const layerPrepare = {\r\n      id: generateIdFromSourceOptions(sourceOptions),\r\n      type: CatalogItemType.Layer,\r\n      title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\r\n      address: idParent,\r\n      externalProvider: catalog.externalProvider || false,\r\n      options: {\r\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\r\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\r\n        metadata: {\r\n          url: metadataUrl,\r\n          extern,\r\n          abstract: metadataAbstract,\r\n          type: baseSourceOptions.type\r\n        },\r\n        legendOptions,\r\n        tooltip: { type: catalog.tooltipType },\r\n        sourceOptions\r\n      }\r\n    } as CatalogItem;\r\n\r\n    return ObjectUtils.removeUndefined(layerPrepare);\r\n  }\r\n\r\n  private prepareCatalogItemGroup(\r\n    itemListIn,\r\n    regexes,\r\n    idGroup,\r\n    layersQueryFormat,\r\n    catalog\r\n  ) {\r\n    const groupPrepare = {\r\n      id: idGroup,\r\n      type: CatalogItemType.Group,\r\n      title: itemListIn.Title,\r\n      address: catalog.id,\r\n      externalProvider: catalog.externalProvider || false,\r\n      sortDirection: catalog.sortDirection, // propagate sortDirection\r\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\r\n        if (layer.Layer !== undefined) {\r\n          // recursive, check next level\r\n          const idGroupItemNextLevel =\r\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\r\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\r\n            layer,\r\n            regexes,\r\n            idGroupItemNextLevel,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n\r\n          items.push(groupItem);\r\n        } else {\r\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\r\n            return items;\r\n          }\r\n\r\n          const layerItem: CatalogItemLayer<ImageLayerOptions> =\r\n            this.prepareCatalogItemLayer(\r\n              layer,\r\n              idGroup,\r\n              layersQueryFormat,\r\n              catalog\r\n            );\r\n\r\n          items.push(layerItem);\r\n        }\r\n        return items;\r\n      }, [])\r\n    };\r\n    return groupPrepare;\r\n  }\r\n\r\n  private includeRecursiveItems(\r\n    catalog: Catalog,\r\n    itemListIn: any,\r\n    itemsPrepare: CatalogItem[],\r\n    loopLevel: number = 0\r\n  ) {\r\n    // Dig all levels until last level (layer object are not defined on last level)\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n    if (!itemListIn.Layer) {\r\n      return;\r\n    }\r\n\r\n    for (const item of itemListIn.Layer) {\r\n      if (item.Layer !== undefined) {\r\n        // recursive, check next level\r\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\r\n        continue;\r\n      }\r\n\r\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\r\n\r\n      // group(with layers) and layer(without group) level 1\r\n      if (loopLevel !== 0) {\r\n        // TODO: Slice that into multiple methods\r\n        // Define object of group layer\r\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\r\n        const groupItem = this.prepareCatalogItemGroup(\r\n          itemListIn,\r\n          regexes,\r\n          idGroupItem,\r\n          layersQueryFormat,\r\n          catalog\r\n        );\r\n\r\n        if (groupItem.items.length !== 0) {\r\n          itemsPrepare.push(groupItem);\r\n        }\r\n\r\n        // Break the group (don't add a group of layer for each of their layer!)\r\n        break;\r\n      } else {\r\n        // layer without group\r\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\r\n          const layerItem = this.prepareCatalogItemLayer(\r\n            item,\r\n            catalog.id,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n          itemsPrepare.push(layerItem);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /// WMTS\r\n\r\n  private getWMTSItems(\r\n    catalog,\r\n    capabilities: { [key: string]: any }\r\n  ): CatalogItemLayer[] {\r\n    if (!capabilities) {\r\n      return [];\r\n    }\r\n    const layers = capabilities.Contents.Layer;\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n\r\n    if (\r\n      capabilities.ServiceIdentification &&\r\n      capabilities.ServiceIdentification.Abstract &&\r\n      capabilities.ServiceIdentification.Abstract.length\r\n    ) {\r\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\r\n    }\r\n\r\n    return layers\r\n      .map((layer: any) => {\r\n        const propertiesToForce = this.computeForcedProperties(\r\n          layer.Title,\r\n          catalog.forcedProperties\r\n        );\r\n        let extern = true;\r\n\r\n        let metadataUrl =\r\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\r\n        let metadataAbstract =\r\n          propertiesToForce?.metadataAbstract ||\r\n          propertiesToForce?.metadataAbstractAll ||\r\n          catalog.abstract;\r\n\r\n        if (\r\n          !propertiesToForce?.metadataUrl &&\r\n          !propertiesToForce?.metadataUrlAll &&\r\n          (propertiesToForce?.metadataAbstract ||\r\n            propertiesToForce?.metadataAbstractAll)\r\n        ) {\r\n          extern = false;\r\n        }\r\n        if (\r\n          propertiesToForce?.metadataAbstract &&\r\n          propertiesToForce?.metadataUrlAll\r\n        ) {\r\n          extern = false;\r\n        }\r\n\r\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\r\n          return undefined;\r\n        }\r\n        const params = Object.assign({}, catalog.queryParams, {\r\n          version: '1.0.0'\r\n        });\r\n        const baseSourceOptions = {\r\n          type: 'wmts',\r\n          url: catalog.url,\r\n          crossOrigin: catalog.setCrossOriginAnonymous\r\n            ? 'anonymous'\r\n            : undefined,\r\n          layer: layer.Identifier,\r\n          matrixSet: catalog.matrixSet,\r\n          optionsFromCapabilities: true,\r\n          requestEncoding: catalog.requestEncoding || 'KVP',\r\n          style: 'default'\r\n        } as WMTSDataSourceOptions;\r\n        const sourceOptions = Object.assign(\r\n          {},\r\n          baseSourceOptions,\r\n          catalog.sourceOptions,\r\n          { params }\r\n        ) as WMTSDataSourceOptions;\r\n\r\n        return ObjectUtils.removeUndefined({\r\n          id: generateIdFromSourceOptions(sourceOptions),\r\n          type: CatalogItemType.Layer,\r\n          title: propertiesToForce?.title\r\n            ? propertiesToForce.title\r\n            : layer.Title,\r\n          address: catalog.id,\r\n          externalProvider: catalog.externalProvider,\r\n          options: {\r\n            sourceOptions,\r\n            metadata: {\r\n              url: metadataUrl,\r\n              extern,\r\n              abstract: metadataAbstract,\r\n              type: baseSourceOptions.type\r\n            }\r\n          }\r\n        } as CatalogItem);\r\n      })\r\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\r\n  }\r\n\r\n  /// ERSI\r\n\r\n  private getArcGISRESTItems(catalog, capabilities): CatalogItemLayer[] {\r\n    if (!capabilities) {\r\n      return [];\r\n    }\r\n    const layers = !capabilities.layers\r\n      ? []\r\n      : capabilities.layers.filter(\r\n          (layer) => !layer.type || layer.type === 'Feature Layer'\r\n        );\r\n    if (!capabilities.layers) {\r\n      this.messageService.error(\r\n        'igo.geo.catalog.someUnavailable',\r\n        'igo.geo.catalog.unavailableTitle'\r\n      );\r\n    }\r\n\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n\r\n    let abstract;\r\n    if (\r\n      capabilities.serviceDescription &&\r\n      capabilities.serviceDescription.length\r\n    ) {\r\n      const regex = /(<([^>]+)>)/gi;\r\n      abstract = capabilities.serviceDescription.replace(regex, '');\r\n    }\r\n\r\n    return layers\r\n      .map((layer: any) => {\r\n        const propertiesToForce = this.computeForcedProperties(\r\n          layer.name,\r\n          catalog.forcedProperties\r\n        );\r\n        let baseAbstract;\r\n        let extern = true;\r\n        if (layer.Abstract) {\r\n          baseAbstract = layer.Abstract;\r\n        } else if (!layer.Abstract && catalog.abstract) {\r\n          baseAbstract = catalog.abstract;\r\n        }\r\n\r\n        let metadataUrl =\r\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\r\n        let metadataAbstract =\r\n          propertiesToForce?.metadataAbstract ||\r\n          propertiesToForce?.metadataAbstractAll ||\r\n          baseAbstract;\r\n\r\n        if (\r\n          !propertiesToForce?.metadataUrl &&\r\n          !propertiesToForce?.metadataUrlAll &&\r\n          (propertiesToForce?.metadataAbstract ||\r\n            propertiesToForce?.metadataAbstractAll)\r\n        ) {\r\n          extern = false;\r\n        }\r\n        if (\r\n          propertiesToForce?.metadataAbstract &&\r\n          propertiesToForce?.metadataUrlAll\r\n        ) {\r\n          extern = false;\r\n        }\r\n\r\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\r\n          return undefined;\r\n        }\r\n        const baseSourceOptions = {\r\n          type: TypeCatalog[catalog.type],\r\n          url: catalog.url,\r\n          crossOrigin: catalog.setCrossOriginAnonymous\r\n            ? 'anonymous'\r\n            : undefined,\r\n          layer: layer.id as string,\r\n          queryable: true,\r\n          queryFormat: 'esrijson',\r\n          matrixSet: catalog.matrixSet,\r\n          optionsFromCapabilities: true,\r\n          style: 'default'\r\n        } as ArcGISRestDataSourceOptions;\r\n        const sourceOptions = Object.assign(\r\n          {},\r\n          baseSourceOptions,\r\n          catalog.sourceOptions\r\n        ) as ArcGISRestDataSourceOptions;\r\n        return ObjectUtils.removeUndefined({\r\n          id: generateIdFromSourceOptions(sourceOptions),\r\n          type: CatalogItemType.Layer,\r\n          title: propertiesToForce?.title\r\n            ? propertiesToForce.title\r\n            : layer.name,\r\n          externalProvider: catalog.externalProvider,\r\n          address: catalog.id,\r\n          options: {\r\n            sourceOptions,\r\n            minResolution: getResolutionFromScale(layer.maxScale),\r\n            maxResolution: getResolutionFromScale(layer.minScale),\r\n            metadata: {\r\n              url: metadataUrl,\r\n              extern,\r\n              abstract: metadataAbstract,\r\n              type: baseSourceOptions.type\r\n            }\r\n          }\r\n        } as CatalogItem);\r\n      })\r\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\r\n  }\r\n\r\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\r\n    if (regexes.length === 0) {\r\n      return true;\r\n    }\r\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\r\n  }\r\n\r\n  private retrieveLayerInfoFormat(\r\n    layerNameFromCatalog: string,\r\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\r\n  ): QueryFormat {\r\n    const currentLayerInfoFormat = layersQueryFormat.find(\r\n      (f) => f.layer === layerNameFromCatalog\r\n    );\r\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\r\n    let queryFormat: QueryFormat;\r\n    if (currentLayerInfoFormat) {\r\n      queryFormat = currentLayerInfoFormat.queryFormat;\r\n    } else if (baseInfoFormat) {\r\n      queryFormat = baseInfoFormat.queryFormat;\r\n    }\r\n    return queryFormat;\r\n  }\r\n\r\n  private findCatalogInfoFormat(\r\n    catalog: Catalog\r\n  ): { layer: string; queryFormat: QueryFormat }[] {\r\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\r\n    if (!catalog.queryFormat) {\r\n      return layersQueryFormat;\r\n    }\r\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\r\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\r\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\r\n          if (\r\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\r\n          ) {\r\n            layersQueryFormat.push({\r\n              layer: layerName,\r\n              queryFormat: configuredInfoFormat as QueryFormat\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        if (\r\n          !layersQueryFormat.find(\r\n            (specific) =>\r\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\r\n          )\r\n        ) {\r\n          layersQueryFormat.push({\r\n            layer: catalog.queryFormat[configuredInfoFormat],\r\n            queryFormat: configuredInfoFormat as QueryFormat\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return layersQueryFormat;\r\n  }\r\n}\r\n\r\nclass CatalogFactory {\r\n  public static createInstanceCatalog(\r\n    options: Catalog,\r\n    catalogService: CatalogService\r\n  ): Catalog {\r\n    let catalog: Catalog;\r\n    if (options.hasOwnProperty('composite')) {\r\n      catalog = new CompositeCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogCompositeLayerItems(catalog)\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\r\n      catalog = new BaselayersCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogBaseLayerItems(catalog)\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\r\n      catalog = new ArcGISRestCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogArcGISRestItems(catalog)\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\r\n      catalog = new TileOrImageArcGISRestCatalog(\r\n        options,\r\n        (catalog: Catalog) =>\r\n          catalogService.loadCatalogArcGISRestItems(catalog),\r\n        TypeCatalog.tilearcgisrest\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\r\n      catalog = new TileOrImageArcGISRestCatalog(\r\n        options,\r\n        (catalog: Catalog) =>\r\n          catalogService.loadCatalogArcGISRestItems(catalog),\r\n        TypeCatalog.imagearcgisrest\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\r\n      catalog = new WMTSCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogWMTSLayerItems(catalog)\r\n      );\r\n    } else {\r\n      catalog = new WMSCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogWMSLayerItems(catalog)\r\n      );\r\n    }\r\n\r\n    return catalog;\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\r\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\r\n    <ng-container *ngIf=\"isGroup(item)\">\r\n      <igo-catalog-browser-group\r\n        [catalog]=\"catalog\"\r\n        [group]=\"item\"\r\n        [map]=\"map\"\r\n        [state]=\"store.state\"\r\n        [resolution]=\"resolution$ | async\"\r\n        [catalogAllowLegend]=\"catalogAllowLegend\"\r\n        [collapsed]=\"store.count === 1 ? false : true\"\r\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\r\n        (addedChange)=\"onGroupAddedChange($event)\"\r\n        (layerAddedChange)=\"onLayerAddedChange($event)\"\r\n      >\r\n      </igo-catalog-browser-group>\r\n    </ng-container>\r\n\r\n    <ng-container *ngIf=\"isLayer(item)\">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]=\"item\"\r\n        [map]=\"map\"\r\n        [resolution]=\"resolution$ | async\"\r\n        [catalogAllowLegend]=\"catalogAllowLegend\"\r\n        [added]=\"store.state.get(item).added\"\r\n        (addedChange)=\"onLayerAddedChange($event)\"\r\n      >\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</igo-list>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { zip, BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\nimport {\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogItemLayer,\r\n  CatalogItemGroup,\r\n  CatalogItemState,\r\n  CatalogItemType,\r\n  AddedChangeEmitter,\r\n  AddedChangeGroupEmitter\r\n} from '../shared';\r\n\r\n/**\r\n * Component to browse a catalog's groups and layers and display them on a map.\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser',\r\n  templateUrl: './catalog-browser.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Catalog items store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<CatalogItem>;\r\n\r\n  // private resolution$$: Subscription;\r\n\r\n  get resolution$(): BehaviorSubject<number> {\r\n    return this.map.viewController.resolution$;\r\n  }\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Store holding the catalog's items\r\n   */\r\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Whether a group can be toggled when it's collapsed\r\n   */\r\n  @Input() toggleCollapsedGroup: boolean = true;\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    const currentItems = this.map.layers.map((layer: Layer) => {\r\n      return {\r\n        id: layer.options.source.id,\r\n        title: layer.title,\r\n        type: CatalogItemType.Layer\r\n      };\r\n    });\r\n    this.store.state.updateMany(currentItems, { added: true }, true);\r\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\r\n      this.store.view.sort({\r\n        direction: this.catalog.sortDirection,\r\n        valueAccessor: (item: CatalogItem) => item.title\r\n      });\r\n    }\r\n\r\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\r\n    this.catalogAllowLegend = catalogShowLegend\r\n      ? catalogShowLegend\r\n      : this.catalogAllowLegend;\r\n\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isGroup(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Group;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isLayer(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Layer;\r\n  }\r\n\r\n  /**\r\n   * When a layer is added or removed, add or remove it from the map\r\n   * @internal\r\n   * @param event Layer added event\r\n   */\r\n  onLayerAddedChange(event: AddedChangeEmitter) {\r\n    const layer = event.layer;\r\n    this.store.state.update(layer, { added: event.added }, false);\r\n    event.added\r\n      ? this.addLayerToMap(layer, event)\r\n      : this.removeLayerFromMap(layer);\r\n  }\r\n\r\n  /**\r\n   * When a froup is added or removed, add or remove it from the map\r\n   * @internal\r\n   * @param event Group added event\r\n   */\r\n  onGroupAddedChange(event: AddedChangeGroupEmitter) {\r\n    const group = event.group;\r\n    this.store.state.update(group, { added: event.added }, false);\r\n    event.added\r\n      ? this.addGroupToMap(group, event)\r\n      : this.removeGroupFromMap(group);\r\n  }\r\n\r\n  /**\r\n   * Add layer to map\r\n   * @param layer Catalog layer\r\n   */\r\n  private addLayerToMap(layer: CatalogItemLayer, event?: AddedChangeEmitter) {\r\n    this.addLayersToMap([layer], event);\r\n  }\r\n\r\n  /**\r\n   * Remove layer from map\r\n   * @param layer Catalog layer\r\n   */\r\n  private removeLayerFromMap(layer: CatalogItemLayer) {\r\n    this.removeLayersFromMap([layer]);\r\n  }\r\n\r\n  /**\r\n   * Add multiple layers to map\r\n   * @param layers Catalog layers\r\n   */\r\n  private addLayersToMap(\r\n    layers: CatalogItemLayer[],\r\n    event: AddedChangeEmitter | AddedChangeGroupEmitter\r\n  ) {\r\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\r\n      if (!layer.options.sourceOptions.optionsFromApi) {\r\n        layer.options.sourceOptions.optionsFromApi = true;\r\n      }\r\n      if (this.catalog.profils?.length) {\r\n        layer.options.security = { profils: this.catalog.profils };\r\n      }\r\n      return this.layerService.createAsyncLayer(layer.options);\r\n    });\r\n    zip(...layers$).subscribe((layers: Layer[]) => {\r\n      if (event.event.type === 'click' && event.added) {\r\n        this.map.layersAddedByClick$.next(layers);\r\n      }\r\n      this.store.state.updateMany(layers, { added: true });\r\n      this.map.addLayers(layers);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove multiple layers from map\r\n   * @param layers Catalog layers\r\n   */\r\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\r\n    layers.forEach((layer: CatalogItemLayer) => {\r\n      this.store.state.update(layer, { added: false });\r\n      if (layer.options.baseLayer === true) {\r\n        const currLayer = this.map.getLayerById(layer.options.id);\r\n        if (currLayer !== undefined) {\r\n          this.map.removeLayer(currLayer);\r\n        }\r\n      } else {\r\n        const currLayer = this.map.getLayerById(layer.id);\r\n        if (currLayer !== undefined) {\r\n          this.map.removeLayer(currLayer);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sort the layers by title. asc or desc.\r\n   * @internal\r\n   */\r\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\r\n    const returnItem = items.sort((a, b) => {\r\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n\r\n      if (titleA < titleB) {\r\n        return -1;\r\n      }\r\n      if (titleA > titleB) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n    switch (direction) {\r\n      case 'asc':\r\n        return returnItem;\r\n      case 'desc':\r\n        return returnItem.reverse();\r\n      default:\r\n        return items;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add all the layers of a group to map\r\n   * @param group Catalog group\r\n   */\r\n  private addGroupToMap(\r\n    group: CatalogItemGroup,\r\n    event: AddedChangeGroupEmitter\r\n  ) {\r\n    let layers = group.items.filter((item: CatalogItem) => {\r\n      const added = this.store.state.get(item).added || false;\r\n      return this.isLayer(item) && added === false;\r\n    });\r\n    if (group.sortDirection !== undefined) {\r\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\r\n    }\r\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[], event);\r\n  }\r\n\r\n  /**\r\n   * Remove all the layers of a group from map\r\n   * @param group Catalog group\r\n   */\r\n  private removeGroupFromMap(group: CatalogItemGroup) {\r\n    const layers = group.items.filter((item: CatalogItem) => {\r\n      const added = this.store.state.get(item).added || false;\r\n      return this.isLayer(item) && added === true;\r\n    });\r\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\r\n  }\r\n}\r\n","import { Directive, Input, ElementRef, OnInit } from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\n\r\n/**\r\n * This directive allow to add an icon inside a matBadge.\r\n * A value must be set into the matBadge directive ex: matBadge=\"icon\".\r\n * The badge content will be overrided by this current directive.\r\n */\r\n@Directive({\r\n  selector: '[igoMatBadgeIcon]'\r\n})\r\nexport class IgoBadgeIconDirective implements OnInit {\r\n  @Input()\r\n  set igoMatBadgeIcon(value: string) {\r\n    this.matIconRegistry.getNamedSvgIcon(value).subscribe((svgObj) => {\r\n      this.svg = svgObj;\r\n      this.updateSvg();\r\n    });\r\n  }\r\n  private svg: SVGElement;\r\n\r\n  @Input()\r\n  set matBadgeHidden(value: boolean) {\r\n    this.hidden = value;\r\n    this.updateHidden();\r\n  }\r\n  private hidden = false;\r\n\r\n  @Input()\r\n  set matBadgeDisabled(value: boolean) {\r\n    this.disabled = value;\r\n    this.updateDisabled();\r\n  }\r\n  private disabled = false;\r\n\r\n  @Input()\r\n  set igoMatBadgeInverseColor(value: boolean) {\r\n    this.inverseColor = value;\r\n    this.updateColor();\r\n  }\r\n  private inverseColor = false;\r\n\r\n  @Input()\r\n  set igoMatBadgeInheritColor(value: boolean) {\r\n    this.inheritColor = value;\r\n    this.updateColor();\r\n  }\r\n  private inheritColor = false;\r\n\r\n  @Input()\r\n  set igoMatBadgeColor(value: string) {\r\n    this.color = value;\r\n    this.updateColor();\r\n  }\r\n  private color;\r\n\r\n  @Input()\r\n  set igoMatBadgeBackgroundColor(value: string) {\r\n    this.backgroundColor = value;\r\n    this.updateColor();\r\n  }\r\n  private backgroundColor;\r\n\r\n  get badge() {\r\n    return this.el.nativeElement.querySelector('.mat-badge-content');\r\n  }\r\n\r\n  private originalColor: string;\r\n\r\n  constructor(\r\n    private el: ElementRef,\r\n    private matIconRegistry: MatIconRegistry\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.badge.style.alignItems = 'center';\r\n    this.badge.style.justifyContent = 'center';\r\n\r\n    this.updateHidden();\r\n    this.updateColor();\r\n    this.updateSvg();\r\n  }\r\n\r\n  private updateSvg() {\r\n    if (!this.badge) {\r\n      return;\r\n    }\r\n    this.badge.innerHTML = '';\r\n    if (this.svg) {\r\n      this.badge.appendChild(this.svg);\r\n    }\r\n  }\r\n  private updateColor() {\r\n    if (!this.badge) {\r\n      return;\r\n    }\r\n\r\n    if (this.color || this.backgroundColor) {\r\n      this.badge.style.color = this.color ? this.color : '';\r\n      this.badge.style.background = this.backgroundColor\r\n        ? this.backgroundColor\r\n        : '';\r\n    } else if (this.inheritColor) {\r\n      if (this.inverseColor) {\r\n        this.badge.style.color = 'currentColor';\r\n        this.badge.style.background = 'none';\r\n      } else {\r\n        this.badge.style.color = '';\r\n        this.badge.style.background = 'currentColor';\r\n      }\r\n    } else if (!this.inheritColor) {\r\n      if (this.inverseColor) {\r\n        this.badge.style.color = window\r\n          .getComputedStyle(this.badge, null)\r\n          .getPropertyValue('background-color');\r\n        this.badge.style.background = 'none';\r\n      } else {\r\n        this.badge.style.color = '';\r\n        this.badge.style.background = '';\r\n      }\r\n    }\r\n    this.originalColor = this.badge.style.color;\r\n    this.updateDisabled();\r\n  }\r\n\r\n  private updateHidden() {\r\n    if (!this.badge) {\r\n      return;\r\n    }\r\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\r\n  }\r\n\r\n  private updateDisabled() {\r\n    if (!this.badge || !this.inverseColor) {\r\n      return;\r\n    }\r\n    if (this.disabled) {\r\n      this.originalColor = this.badge.style.color;\r\n      this.badge.style.color = '#b9b9b9';\r\n    } else {\r\n      this.badge.style.color = this.originalColor;\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\r\n  *ngIf=\"\r\n    (options && options.metadata && options.metadata.url) ||\r\n    (options && options.metadata && options.metadata.abstract)\r\n  \"\r\n  mat-icon-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\r\n  [color]=\"color\"\r\n  (click)=\"openMetadata(options.metadata)\"\r\n>\r\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\r\n</button>\r\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  Inject,\r\n  ViewEncapsulation\r\n} from '@angular/core';\r\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\nimport {\r\n  MetadataOptions,\r\n  MetadataLayerOptions\r\n} from '../shared/metadata.interface';\r\nimport { MetadataService } from '../shared/metadata.service';\r\n\r\n@Component({\r\n  selector: 'igo-metadata-button',\r\n  templateUrl: './metadata-button.component.html',\r\n  styleUrls: ['./metadata-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MetadataButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor(\r\n    private metadataService: MetadataService,\r\n    private dialog: MatDialog\r\n  ) {}\r\n\r\n  openMetadata(metadata: MetadataOptions) {\r\n    if (metadata.extern) {\r\n      if (!metadata.url && metadata.abstract) {\r\n        this.dialog.open(MetadataAbstractComponent, {\r\n          data: {\r\n            layerTitle: this.layer.title,\r\n            abstract: metadata.abstract,\r\n            type: metadata.type\r\n          }\r\n        });\r\n      } else if (metadata.url) {\r\n        this.metadataService.open(metadata);\r\n      }\r\n    } else if (!metadata.extern && metadata.abstract) {\r\n      this.dialog.open(MetadataAbstractComponent, {\r\n        data: {\r\n          layerTitle: this.layer.title,\r\n          abstract: metadata.abstract,\r\n          type: metadata.type\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  get options(): MetadataLayerOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.options;\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'igo-metadata-abstract',\r\n  templateUrl: './metadata-abstract.component.html',\r\n  styleUrls: ['./metadata-abstract.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class MetadataAbstractComponent {\r\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  HostListener,\r\n  ElementRef,\r\n  Renderer2\r\n} from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoCollapse]'\r\n})\r\nexport class CollapseDirective {\r\n  @Input()\r\n  get target() {\r\n    return this._target;\r\n  }\r\n  set target(value: Element) {\r\n    this._target = value;\r\n  }\r\n  private _target: Element;\r\n\r\n  @Input()\r\n  get collapsed(): boolean {\r\n    return this._collapsed;\r\n  }\r\n  set collapsed(collapsed: boolean) {\r\n    collapsed ? this.collapseTarget() : this.expandTarget();\r\n    this._collapsed = collapsed;\r\n    this.toggle.emit(collapsed);\r\n  }\r\n  private _collapsed = false;\r\n\r\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\r\n\r\n  @HostListener('click')\r\n  click() {\r\n    this.collapsed = !this.collapsed;\r\n  }\r\n\r\n  constructor(\r\n    private renderer: Renderer2,\r\n    private el: ElementRef\r\n  ) {}\r\n\r\n  private collapseTarget() {\r\n    this.renderer.addClass(this.target, 'igo-collapsed');\r\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\r\n  }\r\n\r\n  private expandTarget() {\r\n    this.renderer.removeClass(this.target, 'igo-collapsed');\r\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\r\n  }\r\n}\r\n","<ng-container *ngIf=\"legendItems$ | async as items\">\r\n  <ng-container *ngIf=\"items.length; else noItems\">\r\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\r\n      <div *ngIf=\"getLegend; else noItems\">\r\n        <mat-list-item *ngIf=\"item.title\">\r\n          <mat-icon\r\n            id=\"legend-toggle\"\r\n            class=\"igo-chevron\"\r\n            matListItemIcon\r\n            igoCollapse\r\n            [target]=\"legend\"\r\n            [collapsed]=\"item.collapsed\"\r\n            (toggle)=\"toggleLegendItem($event, item)\"\r\n            svgIcon=\"chevron-up\"\r\n          >\r\n          </mat-icon>\r\n          <span matListItemTitle>{{ computeItemTitle(item) | async }} </span>\r\n        </mat-list-item>\r\n        <div\r\n          #legend\r\n          class=\"igo-layer-legend\"\r\n          [ngClass]=\"{ 'with-title': item.title }\"\r\n        >\r\n          <div *ngIf=\"currentStyle !== undefined\">\r\n            <mat-form-field>\r\n              <mat-select\r\n                tooltip-position=\"below\"\r\n                matTooltipShowDelay=\"500\"\r\n                [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\r\n                [(ngModel)]=\"currentStyle\"\r\n                (selectionChange)=\"onChangeStyle()\"\r\n              >\r\n                <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{\r\n                  style.title\r\n                }}</mat-option>\r\n              </mat-select>\r\n            </mat-form-field>\r\n          </div>\r\n          <div *ngIf=\"!item.collapsed\">\r\n            <div *ngIf=\"item.url\">\r\n              <img\r\n                igoImageError\r\n                *ngIf=\"item.imgGraphValue\"\r\n                hideError=\"true\"\r\n                #renderedLegend\r\n                id=\"{{ item.title }}\"\r\n                (load)=\"onLoadImage(item.title)\"\r\n                [src]=\"item.imgGraphValue\"\r\n                alt=\"{{ 'igo.geo.layer.legend.loadingLegendText' | translate }}\"\r\n              />\r\n              <small *ngIf=\"imagesHeight[item.title] < 16\">\r\n                {{ 'igo.geo.layer.legend.noLegendScale' | translate }}\r\n              </small>\r\n            </div>\r\n            <div\r\n              [ngStyle]=\"item.style\"\r\n              [innerHTML]=\"item.html | sanitizeHtml\"\r\n              *ngIf=\"item.html\"\r\n            ></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ng-container>\r\n  </ng-container>\r\n\r\n  <ng-template #noItems>\r\n    <small>\r\n      {{ 'igo.geo.layer.legend.noLegendText' | translate }}\r\n    </small>\r\n  </ng-template>\r\n</ng-container>\r\n","import { HttpClient } from '@angular/common/http';\r\nimport {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  ViewChildren,\r\n  ElementRef,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport type { QueryList } from '@angular/core';\r\n\r\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\r\n\r\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { Layer } from '../shared/layers';\r\nimport {\r\n  LegendMapViewOptions,\r\n  ItemStyleOptions\r\n} from '../shared/layers/legend.interface';\r\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\r\nimport { catchError, map } from 'rxjs/operators';\r\nimport { LanguageService, ConfigService } from '@igo2/core';\r\nimport { WMSDataSource, WMSDataSourceOptions } from '../../datasource';\r\nimport { SecureImagePipe } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend',\r\n  templateUrl: './layer-legend.component.html',\r\n  styleUrls: ['./layer-legend.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendComponent implements OnInit, OnDestroy {\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  /**\r\n   * Observable of the legend items\r\n   */\r\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * Subscription to the map's resolution\r\n   */\r\n  private state$$: Subscription;\r\n\r\n  /**\r\n   * The available styles\r\n   */\r\n  public styles;\r\n\r\n  /**\r\n   * The style used to make the legend\r\n   */\r\n  public currentStyle;\r\n\r\n  /**\r\n   * The scale used to make the legend\r\n   */\r\n  private scale: number = undefined;\r\n\r\n  /**\r\n   * The extent used to make the legend\r\n   */\r\n  private view: LegendMapViewOptions = undefined;\r\n  /**\r\n   * Get list of images display\r\n   */\r\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\r\n\r\n  /**\r\n   * List of size of images displayed\r\n   */\r\n  public imagesHeight: { [srcKey: string]: number } = {};\r\n\r\n  /**\r\n   * Layer\r\n   */\r\n  @Input() layer: Layer;\r\n\r\n  /**\r\n   * if getLegendGraphic is authorized\r\n   */\r\n  public getLegend = true;\r\n\r\n  /**\r\n   * activeLegend\r\n   */\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    private languageService: LanguageService,\r\n    private configService: ConfigService,\r\n    private http: HttpClient,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  /**\r\n   * On init, subscribe to the map's resolution and update the legend accordingly\r\n   */\r\n  ngOnInit() {\r\n    let lastlLegend = this.layer.legend;\r\n    this.styles = this.listStyles();\r\n    const sourceOptions = this.layer.options.source.options as any;\r\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\r\n      // if a styles is provided into the layers wms params\r\n      this.currentStyle = this.styles.find(\r\n        (style) => style.name === sourceOptions.params.STYLES\r\n      ).name;\r\n    } else if (!lastlLegend) {\r\n      // if no legend is manually provided\r\n      if (this.styles && this.styles.length > 1) {\r\n        this.currentStyle = this.styles[0].name;\r\n      }\r\n    } else if (this.styles && this.styles.length > 1) {\r\n      this.currentStyle = lastlLegend[0].currentStyle;\r\n    }\r\n    if (\r\n      typeof this.layer.options.legendOptions !== 'undefined' &&\r\n      this.layer.options.legendOptions.display === false\r\n    ) {\r\n      lastlLegend = [];\r\n    } else {\r\n      lastlLegend = this.layer.dataSource.getLegend(\r\n        this.currentStyle,\r\n        this.view\r\n      );\r\n    }\r\n\r\n    if (\r\n      this.updateLegendOnResolutionChange ||\r\n      (sourceOptions as WMSDataSourceOptions).contentDependentLegend\r\n    ) {\r\n      const state$ = this.layer.map.viewController.state$;\r\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\r\n    } else if (lastlLegend && lastlLegend.length !== 0) {\r\n      this.legendItems$.next(lastlLegend);\r\n      for (const legend of lastlLegend) {\r\n        this.getLegendGraphic(legend);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On destroy, unsubscribe to the map's view state\r\n   */\r\n  ngOnDestroy() {\r\n    if (this.state$$ !== undefined) {\r\n      this.state$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  getLegendGraphic(item: Legend) {\r\n    if (item.url) {\r\n      const secureIMG = new SecureImagePipe(this.http, this.configService);\r\n      secureIMG\r\n        .transform(item.url)\r\n        .pipe(\r\n          catchError((err) => {\r\n            if (err.error) {\r\n              err.error.caught = true;\r\n              this.getLegend = false;\r\n              this.cdRef.detectChanges();\r\n              return err;\r\n            }\r\n          })\r\n        )\r\n        .subscribe((obsLegGraph) => {\r\n          const idx = this.legendItems$.value.findIndex(\r\n            (leg) => leg.title === item.title\r\n          );\r\n          const legendGraph = obsLegGraph as string;\r\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  toggleLegendItem(collapsed: boolean, item: Legend) {\r\n    item.collapsed = collapsed;\r\n  }\r\n\r\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\r\n    const outLegends: Legend[] = newLegends;\r\n    const lastLegends = this.layer.legend;\r\n    for (let i = 0; i < lastLegends.length; i++) {\r\n      outLegends[i].collapsed = lastLegends[i].collapsed;\r\n    }\r\n    return outLegends;\r\n  }\r\n\r\n  computeItemTitle(layerLegend): Observable<string> {\r\n    const layerOptions = this.layer.dataSource.options as any;\r\n    if (layerOptions.type !== 'wms') {\r\n      return of(layerLegend.title);\r\n    }\r\n\r\n    const layers = layerOptions.params.LAYERS.split(',');\r\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\r\n    localLayerOptions.params.LAYERS = layers.find(\r\n      (layer) => layer === layerLegend.title\r\n    );\r\n    return this.capabilitiesService.getWMSOptions(localLayerOptions).pipe(\r\n      map((wmsDataSourceOptions) => {\r\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On resolution change, compute the effective scale level and update the\r\n   * legend accordingly.\r\n   * @param resolution Map resolution\r\n   */\r\n  private onViewControllerStateChange() {\r\n    this.view = {\r\n      resolution: this.layer.map.viewController.getResolution(),\r\n      extent: this.layer.map.viewController.getExtent(),\r\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\r\n      scale: this.layer.map.viewController.getScale(),\r\n      size: this.layer.map.ol.getSize()\r\n    } as LegendMapViewOptions;\r\n    this.updateLegend();\r\n  }\r\n\r\n  /**\r\n   * Update the legend with scale level and style define\r\n   */\r\n  private updateLegend() {\r\n    let legendItems = this.layer.dataSource.getLegend(\r\n      this.currentStyle,\r\n      this.view\r\n    );\r\n    if (this.layer.legend && this.layer.legend.length > 1) {\r\n      legendItems = this.transfertToggleLegendItem(legendItems);\r\n    }\r\n    this.layer.legend = legendItems;\r\n\r\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\r\n      return;\r\n    }\r\n    this.legendItems$.next(legendItems);\r\n    for (const legend of this.legendItems$.value) {\r\n      this.getLegendGraphic(legend);\r\n    }\r\n  }\r\n\r\n  private listStyles() {\r\n    const layerOptions = this.layer.options;\r\n    if (layerOptions && layerOptions.legendOptions) {\r\n      const translate = this.languageService.translate;\r\n      const title = translate.instant('igo.geo.layer.legend.default');\r\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\r\n      if (layerOptions.legendOptions.stylesAvailable) {\r\n        stylesAvailable = stylesAvailable.concat(\r\n          layerOptions.legendOptions.stylesAvailable.filter(\r\n            (sA) =>\r\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\r\n                'default' &&\r\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\r\n                'defaut'\r\n          )\r\n        );\r\n      }\r\n      stylesAvailable\r\n        .filter((sa) => !sa.title)\r\n        .map((sa) => (sa.title = sa.name));\r\n      stylesAvailable.map(\r\n        (s) =>\r\n          (s.title =\r\n            s.title.charAt(0).toUpperCase() +\r\n            s.title.slice(1).replace(/_/g, ' '))\r\n      );\r\n      return stylesAvailable;\r\n    }\r\n    return;\r\n  }\r\n\r\n  onChangeStyle() {\r\n    this.updateLegend();\r\n    let STYLES = '';\r\n    if (this.layer.dataSource instanceof WMSDataSource) {\r\n      this.layer.dataSource.ol\r\n        .getParams()\r\n        .LAYERS.split(',')\r\n        .map((layer) => (STYLES += this.currentStyle + ','));\r\n      STYLES = STYLES.slice(0, -1);\r\n      this.layer.dataSource.ol.updateParams({ STYLES });\r\n    }\r\n  }\r\n\r\n  onLoadImage(id: string) {\r\n    let elemRef: HTMLImageElement;\r\n    if (this.renderedLegends.length === 1) {\r\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\r\n    } else {\r\n      elemRef = this.renderedLegends.find(\r\n        (renderedLegend) => renderedLegend.nativeElement.id === id\r\n      ).nativeElement as HTMLImageElement;\r\n    }\r\n    this.imagesHeight[id] = elemRef.height;\r\n  }\r\n}\r\n","<mat-list-item>\n  <mat-icon *ngIf=\"haveGroup()\" matListItemIcon svgIcon=\"blank\"></mat-icon>\n  <span\n    matListItemTitle\n    matTooltipShowDelay=\"500\"\n    [ngClass]=\"catalogAllowLegend ? 'igo-cataloglayer-title' : ''\"\n    (click)=\"askForLegend($event)\"\n    [matTooltip]=\"computeTitleTooltip()\"\n  >\n    {{ title }}\n  </span>\n\n  <div matListItemMeta>\n    <button *ngIf=\"layer.externalProvider\" disabled=\"true\" mat-icon-button>\n      <mat-icon\n        class=\"igo-cataloglayer-external-icon\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n        color=\"primary\"\n        (click)=\"$event.stopPropagation()\"\n        svgIcon=\"earth-arrow-right\"\n      >\n      </mat-icon>\n    </button>\n    <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n\n    <button\n      (mouseenter)=\"onMouseEvent($event)\"\n      (mouseleave)=\"onMouseEvent($event)\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"computeTooltip() | translate\"\n      [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n      (click)=\"onToggleClick($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"icon\"\n        [igoMatBadgeIcon]=\"getBadgeIcon()\"\n        igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n        igoMatBadgeBackgroundColor=\"none\"\n        igoMatBadgeInverseColor=\"true\"\n        [matBadgeHidden]=\"\n          ((inRange$ | async) && (isVisible$ | async) === true) ||\n          ((inRange$ | async) && !added) ||\n          ((inRange$ | async) && (isPreview$ | async))\n        \"\n        [matBadgeDisabled]=\"(inRange$ | async) === false\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\"\n      >\n      </mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"\n      (layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\n    \"\n    [layer]=\"igoLayer$ | async\"\n  >\n  </igo-layer-legend>\n</div>\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\r\n\r\nimport { AddedChangeEmitter, CatalogItemLayer } from '../shared';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { first } from 'rxjs/operators';\r\nimport { Layer, TooltipType } from '../../layer/shared/layers';\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\n/**\r\n * Catalog browser layer item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser-layer',\r\n  templateUrl: './catalog-browser-layer.component.html',\r\n  styleUrls: ['./catalog-browser-layer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\r\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private isPreview$$: Subscription;\r\n  private resolution$$: Subscription;\r\n  private layers$$: Subscription;\r\n  private lastTimeoutRequest;\r\n\r\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\r\n\r\n  private mouseInsideAdd: boolean = false;\r\n\r\n  @Input() resolution: number;\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Catalog layer\r\n   */\r\n  @Input() layer: CatalogItemLayer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Whether the layer is already added to the map\r\n   */\r\n  @Input() added = false;\r\n\r\n  /**\r\n   * Event emitted when the add/remove button is clicked\r\n   */\r\n  @Output() addedChange = new EventEmitter<AddedChangeEmitter>();\r\n\r\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.layer);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.layer) || 'layers';\r\n  }\r\n\r\n  constructor(private layerService: LayerService) {}\r\n\r\n  ngOnInit(): void {\r\n    this.isPreview$$ = this.isPreview$.subscribe((value) =>\r\n      this.addedLayerIsPreview.emit(value)\r\n    );\r\n\r\n    this.layers$$ = this.map.layers$.subscribe(() => {\r\n      this.isVisible();\r\n    });\r\n\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\r\n      (resolution) => {\r\n        this.isInResolutionsRange(resolution);\r\n        this.isVisible();\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.isPreview$$.unsubscribe();\r\n    this.resolution$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  computeTitleTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return getEntityTitle(this.layer);\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    this.onToggleClick(event);\r\n  }\r\n\r\n  askForLegend(event) {\r\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\r\n    this.layerService\r\n      .createAsyncLayer(this.layer.options)\r\n      .pipe(first())\r\n      .subscribe((layer) => this.igoLayer$.next(layer));\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(event) {\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'click':\r\n        if (!this.isPreview$.value) {\r\n          if (this.added) {\r\n            this.remove(event);\r\n          } else {\r\n            this.add(event);\r\n          }\r\n        }\r\n        this.isPreview$.next(false);\r\n        break;\r\n      case 'mouseenter':\r\n        if (!this.isPreview$.value && !this.added) {\r\n          this.lastTimeoutRequest = setTimeout(() => {\r\n            this.add(event);\r\n            this.isPreview$.next(true);\r\n          }, 500);\r\n        }\r\n        this.mouseInsideAdd = true;\r\n        break;\r\n      case 'mouseleave':\r\n        if (this.isPreview$.value) {\r\n          this.remove(event);\r\n          this.isPreview$.next(false);\r\n        }\r\n        this.mouseInsideAdd = false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private add(event: Event) {\r\n    if (!this.added) {\r\n      this.added = true;\r\n      this.addedChange.emit({ added: true, layer: this.layer, event });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = false\r\n   */\r\n  private remove(event: Event) {\r\n    if (this.added) {\r\n      this.added = false;\r\n      this.addedChange.emit({ added: false, layer: this.layer, event });\r\n    }\r\n  }\r\n\r\n  haveGroup(): boolean {\r\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\r\n  }\r\n\r\n  isInResolutionsRange(resolution: number) {\r\n    const minResolution =\r\n      !this.layer.options.minResolution ||\r\n      Number.isNaN(this.layer.options.minResolution)\r\n        ? 0\r\n        : this.layer.options.minResolution;\r\n    const maxResolution =\r\n      !this.layer.options.maxResolution ||\r\n      Number.isNaN(this.layer.options.maxResolution)\r\n        ? Infinity\r\n        : this.layer.options.maxResolution;\r\n    this.inRange$.next(\r\n      resolution >= minResolution && resolution <= maxResolution\r\n    );\r\n  }\r\n\r\n  isVisible() {\r\n    if (this.layer?.id) {\r\n      const oLayer = this.map.getLayerById(this.layer?.id);\r\n      oLayer\r\n        ? this.isVisible$.next(oLayer.visible)\r\n        : this.isVisible$.next(false);\r\n    }\r\n  }\r\n\r\n  getBadgeIcon() {\r\n    if (this.inRange$.getValue()) {\r\n      return this.isVisible$.getValue() ? '' : 'eye-off';\r\n    } else {\r\n      return 'eye-off';\r\n    }\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    if (this.added) {\r\n      if (this.isPreview$.value) {\r\n        return 'igo.geo.catalog.layer.addToMap';\r\n      } else if (this.inRange$.value) {\r\n        return this.isVisible$.value\r\n          ? 'igo.geo.catalog.layer.removeFromMap'\r\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\r\n      } else {\r\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\r\n      }\r\n    } else {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : 'igo.geo.catalog.layer.addToMapOutRange';\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  ElementRef,\r\n  Renderer2,\r\n  HostListener,\r\n  EventEmitter\r\n} from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoListItem]'\r\n})\r\nexport class ListItemDirective {\r\n  static focusedCls = 'igo-list-item-focused';\r\n  static selectedCls = 'igo-list-item-selected';\r\n  static disabledCls = 'igo-list-item-disabled';\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  @Input()\r\n  get focused() {\r\n    return this._focused;\r\n  }\r\n  set focused(value: boolean) {\r\n    if (value === this._focused) {\r\n      return;\r\n    }\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\r\n\r\n    this._focused = value;\r\n    if (this.selected !== true) {\r\n      this.toggleFocusedClass();\r\n    }\r\n\r\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\r\n  }\r\n  private _focused = false;\r\n\r\n  @Input()\r\n  get selected() {\r\n    return this._selected;\r\n  }\r\n  set selected(value: boolean) {\r\n    if (value === this._selected) {\r\n      return;\r\n    }\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\r\n\r\n    this._selected = value;\r\n    this._focused = value;\r\n    this.toggleSelectedClass();\r\n\r\n    value ? this.select.emit(this) : this.unselect.emit(this);\r\n  }\r\n  private _selected = false;\r\n\r\n  @Input()\r\n  get disabled() {\r\n    return this._disabled;\r\n  }\r\n  set disabled(value: boolean) {\r\n    if (value === this._disabled) {\r\n      return;\r\n    }\r\n\r\n    if (value === true) {\r\n      this.selected = false;\r\n    }\r\n\r\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\r\n\r\n    this._disabled = value;\r\n    this.toggleDisabledClass();\r\n\r\n    value ? this.disable.emit(this) : this.enable.emit(this);\r\n  }\r\n  private _disabled = false;\r\n\r\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\r\n  @Output() focus = new EventEmitter<ListItemDirective>();\r\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\r\n  @Output() select = new EventEmitter<ListItemDirective>();\r\n  @Output() unselect = new EventEmitter<ListItemDirective>();\r\n  @Output() disable = new EventEmitter<ListItemDirective>();\r\n  @Output() enable = new EventEmitter<ListItemDirective>();\r\n\r\n  @HostListener('click')\r\n  onClick() {\r\n    this.selected = true;\r\n  }\r\n\r\n  constructor(\r\n    public renderer: Renderer2,\r\n    public el: ElementRef\r\n  ) {}\r\n\r\n  getOffsetTop(): number {\r\n    const padding = 5;\r\n\r\n    return this.el.nativeElement.offsetTop - padding;\r\n  }\r\n\r\n  private toggleFocusedClass() {\r\n    if (this.focused) {\r\n      this.addCls(ListItemDirective.focusedCls);\r\n    } else {\r\n      this.removeCls(ListItemDirective.focusedCls);\r\n    }\r\n  }\r\n\r\n  private toggleSelectedClass() {\r\n    if (this.selected) {\r\n      this.addCls(ListItemDirective.selectedCls);\r\n      this.removeCls(ListItemDirective.focusedCls);\r\n    } else {\r\n      this.removeCls(ListItemDirective.selectedCls);\r\n    }\r\n  }\r\n\r\n  private toggleDisabledClass() {\r\n    if (this.disabled) {\r\n      this.addCls(ListItemDirective.disabledCls);\r\n    } else {\r\n      this.removeCls(ListItemDirective.disabledCls);\r\n    }\r\n  }\r\n\r\n  private addCls(cls: string) {\r\n    this.renderer.addClass(this.el.nativeElement, cls);\r\n  }\r\n\r\n  private removeCls(cls: string) {\r\n    this.renderer.removeClass(this.el.nativeElement, cls);\r\n  }\r\n}\r\n","<mat-list-item>\n  <mat-icon\n    matListItemIcon\n    svgIcon=\"chevron-up\"\n    igoCollapse\n    class=\"igo-chevron\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\"\n  >\n  </mat-icon>\n\n  <span\n    class=\"igo-catalog-group-title\"\n    matListItemTitle\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"title\"\n    (click)=\"onTitleClick()\"\n    >{{ title }}</span\n  >\n\n  <div matListItemMeta>\n    <button *ngIf=\"group.externalProvider\" disabled=\"true\" mat-icon-button>\n      <mat-icon\n        class=\"igo-cataloggroup-external-icon\"\n        *ngIf=\"group.externalProvider\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n        color=\"primary\"\n        (click)=\"$event.stopPropagation()\"\n        svgIcon=\"earth-arrow-right\"\n      >\n      </mat-icon>\n    </button>\n\n    <ng-container\n      *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\"\n    >\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n        color=\"warn\"\n        [disabled]=\"disabled$ | async\"\n        (click)=\"onToggleClick($event)\"\n      >\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </ng-container>\n\n    <ng-template #notadded>\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n        [disabled]=\"disabled$ | async\"\n        (click)=\"onToggleClick($event)\"\n      >\n        <mat-icon svgIcon=\"plus\"></mat-icon>\n      </button>\n    </ng-template>\n  </div>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution\"\n        [map]=\"map\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport type { EntityStateManager } from '@igo2/common';\r\n\r\nimport {\r\n  AddedChangeEmitter,\r\n  AddedChangeGroupEmitter,\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogItemGroup,\r\n  CatalogItemState,\r\n  CatalogItemType\r\n} from '../shared';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\n/**\r\n * Catalog browser group item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser-group',\r\n  templateUrl: './catalog-browser-group.component.html',\r\n  styleUrls: ['./catalog-browser-group.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Group's items store\r\n   * @internal\r\n   */\r\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\r\n\r\n  /**\r\n   * Whether all the layers of the group are added\r\n   * @internal\r\n   */\r\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  /**\r\n   * Whether the toggle button is disabled\r\n   * @internal\r\n   */\r\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Catalog group\r\n   */\r\n  @Input() group: CatalogItemGroup;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Whether the group is collapsed\r\n   */\r\n  @Input() collapsed: boolean = true;\r\n\r\n  @Input() resolution: number;\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Whether the group can be toggled when it's collapsed\r\n   */\r\n  @Input() toggleCollapsed: boolean = true;\r\n\r\n  /**\r\n   * Parent catalog's items store state. Groups share a unique\r\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\r\n   * Sharing a unique state would also allow us to expand this component to allow\r\n   * the selection of a layer while unselecting any layer already selected in another group.\r\n   * This could be useful to display some layer info before adding it, for example.\r\n   */\r\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\r\n\r\n  /**\r\n   * Event emitted when the add/remove button of the group is clicked\r\n   */\r\n  @Output() addedChange = new EventEmitter<AddedChangeGroupEmitter>();\r\n\r\n  /**\r\n   * Event emitted when the add/remove button of a layer is clicked\r\n   */\r\n  @Output() layerAddedChange = new EventEmitter<AddedChangeEmitter>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return this.group.title;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.store.load(this.group.items);\r\n    this.evaluateAdded();\r\n    this.evaluateDisabled(this.collapsed);\r\n    if (this.group.sortDirection !== undefined) {\r\n      this.store.view.sort({\r\n        direction: this.group.sortDirection,\r\n        valueAccessor: (item: CatalogItem) => item.title\r\n      });\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isGroup(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Group;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isLayer(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Layer;\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(event: Event) {\r\n    this.added$.value ? this.remove(event) : this.add(event);\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleCollapsed(collapsed: boolean) {\r\n    this.evaluateDisabled(collapsed);\r\n  }\r\n\r\n  /**\r\n   * When a layer is added or removed, evaluate if all the layers of the group\r\n   * are now added or removed. If so, consider that the group itself is added\r\n   * or removed.\r\n   * @internal\r\n   * @param event Layer added change event\r\n   */\r\n  onLayerAddedChange(event: AddedChangeEmitter) {\r\n    this.layerAddedChange.emit(event);\r\n    this.tryToggleGroup(event);\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private add(event: Event) {\r\n    this.added$.next(true);\r\n    this.addedChange.emit({\r\n      added: true,\r\n      group: this.group,\r\n      event\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private remove(event: Event) {\r\n    this.added$.next(false);\r\n    this.addedChange.emit({\r\n      added: false,\r\n      group: this.group,\r\n      event\r\n    });\r\n  }\r\n\r\n  onLayerPreview(event) {\r\n    this.preview$.next(event);\r\n  }\r\n\r\n  /**\r\n   * If all the layers of the group added or removed, add or remove the group itself.\r\n   * @param event The last layer added change event to occur\r\n   */\r\n  private tryToggleGroup(event: AddedChangeEmitter) {\r\n    const added = event.added;\r\n    const layer = event.layer;\r\n\r\n    const layersAdded = this.store.view\r\n      .all()\r\n      .filter((item: CatalogItem) => item.id !== layer.id)\r\n      .map((item: CatalogItem) => this.state.get(item).added || false);\r\n\r\n    if (layersAdded.every((value) => value === added)) {\r\n      added ? this.add(event.event) : this.remove(event.event);\r\n    } else if (this.added$.value === true) {\r\n      this.added$.next(false);\r\n    }\r\n  }\r\n\r\n  private evaluateAdded() {\r\n    const added = this.store.all().every((item: CatalogItem) => {\r\n      return (this.state.get(item).added || false) === true;\r\n    });\r\n    this.added$.next(added);\r\n  }\r\n\r\n  private evaluateDisabled(collapsed: boolean) {\r\n    let disabled = false;\r\n    if (this.toggleCollapsed === false) {\r\n      disabled = collapsed;\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n\r\n  onTitleClick() {\r\n    this.collapsed = !this.collapsed;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerListToolService {\r\n  public keyword: string;\r\n  public sortAlpha = false;\r\n  public onlyVisible = false;\r\n  public onlyInRange = false;\r\n  public keywordInitialized = false;\r\n  public sortedAlphaInitialized = false;\r\n  public onlyVisibleInitialized = false;\r\n  public onlyInRangeInitialized = false;\r\n\r\n  constructor() {}\r\n}\r\n","<mat-list-item class=\"igo-layer-list-item\">\n  <mat-checkbox\n    *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    matListItemIcon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\"\n  >\n  </mat-checkbox>\n  <span\n    matListItemTitle\n    class=\"igo-layer-title\"\n    [matTooltip]=\"tooltipText\"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleLegendOnClick()\"\n  >\n    {{ layer.title }}\n  </span>\n\n  <div matListItemMeta>\n    <button\n      *ngIf=\"!selectionMode\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"eyeTooltip | translate\"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\"\n      >\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"selectionMode\"\n      class=\"selection-eye\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        layer.visible\n          ? ('igo.geo.layer.hideLayer' | translate)\n          : ('igo.geo.layer.showLayer' | translate)\n      \"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\"\n      >\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"!selectionMode\"\n      class=\"actions-button\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.moreOptions' | translate\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"toggleLayerTool()\"\n    >\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  >\n  </igo-layer-legend>\n</div>\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter,\r\n  Renderer2,\r\n  ElementRef,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { layerIsQueryable } from '../../query/shared/query.utils';\r\nimport { Layer, TooltipType } from '../shared/layers';\r\nimport { NetworkService, ConnectionState } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-layer-item',\r\n  templateUrl: './layer-item.component.html',\r\n  styleUrls: ['./layer-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerItemComponent implements OnInit, OnDestroy {\r\n  public focusedCls = 'igo-layer-item-focused';\r\n\r\n  @Input()\r\n  get activeLayer() {\r\n    return this._activeLayer;\r\n  }\r\n  set activeLayer(value) {\r\n    if (\r\n      value &&\r\n      this.layer &&\r\n      value.id === this.layer.id &&\r\n      !this.selectionMode\r\n    ) {\r\n      this.layerTool$.next(true);\r\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n    } else {\r\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\r\n    }\r\n  }\r\n  private _activeLayer;\r\n\r\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  tooltipText: string;\r\n\r\n  state: ConnectionState;\r\n\r\n  @Input()\r\n  get selectAll() {\r\n    return this._selectAll;\r\n  }\r\n  set selectAll(value: boolean) {\r\n    this._selectAll = value;\r\n    if (value === true) {\r\n      this.layerCheck = true;\r\n    }\r\n  }\r\n  private _selectAll = false;\r\n\r\n  @Input() layerCheck;\r\n\r\n  private resolution$$: Subscription;\r\n  private network$$: Subscription;\r\n  private layers$$: Subscription;\r\n\r\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\r\n\r\n  @Input()\r\n  get layer() {\r\n    return this._layer;\r\n  }\r\n  set layer(value) {\r\n    this._layer = value;\r\n    this.layers$.next(value);\r\n  }\r\n  private _layer;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendIfVisible: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() orderable: boolean = true;\r\n\r\n  @Input() lowerDisabled: boolean = false;\r\n\r\n  @Input() raiseDisabled: boolean = false;\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Input() selectionMode;\r\n\r\n  @Input() changeDetection;\r\n\r\n  get opacity() {\r\n    return this.layer.opacity * 100;\r\n  }\r\n  set opacity(opacity: number) {\r\n    this.layer.opacity = opacity / 100;\r\n  }\r\n\r\n  get eyeTooltip() {\r\n    if (this.inResolutionRange$.getValue() === false) {\r\n      return 'igo.geo.layer.notInResolution';\r\n    } else {\r\n      return this.layer.visible\r\n        ? 'igo.geo.layer.hideLayer'\r\n        : 'igo.geo.layer.showLayer';\r\n    }\r\n  }\r\n\r\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\r\n  @Output() checkbox = new EventEmitter<{\r\n    layer: Layer;\r\n    check: boolean;\r\n  }>();\r\n\r\n  constructor(\r\n    private networkService: NetworkService,\r\n    private renderer: Renderer2,\r\n    private elRef: ElementRef,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    if (\r\n      this.layer.visible &&\r\n      this.expandLegendIfVisible &&\r\n      this.layer.firstLoadComponent === true\r\n    ) {\r\n      this.layer.firstLoadComponent = false;\r\n      this.layer.legendCollapsed = false;\r\n    }\r\n    this.toggleLegend(this.layer.legendCollapsed);\r\n    this.updateQueryBadge();\r\n\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.onResolutionChange();\r\n    });\r\n    this.tooltipText = this.computeTooltip();\r\n\r\n    this.network$$ = this.networkService\r\n      .currentState()\r\n      .subscribe((state: ConnectionState) => {\r\n        this.state = state;\r\n        this.onResolutionChange();\r\n      });\r\n\r\n    this.layers$$ = this.layers$.subscribe(() => {\r\n      if (this.layer && this.layer.options.active) {\r\n        this.layerTool$.next(true);\r\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n      }\r\n    });\r\n\r\n    if (this.changeDetection) {\r\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n    this.network$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    this.toggleLegend(this.showLegend$.value);\r\n  }\r\n\r\n  toggleVisibility(event: Event) {\r\n    event.stopPropagation();\r\n    this.layer.visible = !this.layer.visible;\r\n    if (this.toggleLegendOnVisibilityChange) {\r\n      this.toggleLegend(!this.layer.visible);\r\n    }\r\n    this.updateQueryBadge();\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return this.layer.title;\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  private onResolutionChange() {\r\n    const inResolutionRange = this.layer.isInResolutionsRange;\r\n    if (\r\n      inResolutionRange === false &&\r\n      this.updateLegendOnResolutionChange === true\r\n    ) {\r\n      this.toggleLegend(true);\r\n    }\r\n    this.inResolutionRange$.next(inResolutionRange);\r\n  }\r\n\r\n  private updateQueryBadge() {\r\n    const hidden =\r\n      this.queryBadge === false ||\r\n      this.layer.visible === false ||\r\n      !layerIsQueryable(this.layer);\r\n    this.queryBadgeHidden$.next(hidden);\r\n  }\r\n\r\n  toggleLayerTool() {\r\n    this.layerTool$.next(!this.layerTool$.getValue());\r\n    if (this.layerTool$.getValue() === true) {\r\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n    } else {\r\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\r\n    }\r\n    this.action.emit(this.layer);\r\n  }\r\n\r\n  public check() {\r\n    this.layerCheck = !this.layerCheck;\r\n    this.checkbox.emit({ layer: this.layer, check: this.layerCheck });\r\n  }\r\n}\r\n","export enum LayerListControlsEnum {\r\n  always = 'always',\r\n  never = 'never',\r\n  default = 'default'\r\n}\r\nexport enum LayerListSelectVisibleEnum {\r\n  ALL_VISIBLE = 'ALL_VISIBLE',\r\n  ALL_HIDDEN = 'ALL_HIDDEN',\r\n  MIXED = 'MIXED',\r\n  NULL = 'NULL'\r\n}\r\n\r\nexport enum LayerListDisplacement {\r\n  Raise = 'raise',\r\n  Lower = 'lower'\r\n}\r\n","<igo-layer-list-tool\r\n  *ngIf=\"showToolbar$ | async\"\r\n  floatLabel=\"auto\"\r\n  [layersAreAllVisible]=\"layersAreAllVisible\"\r\n  [term]=\"layerFilterAndSortOptions.keyword\"\r\n  [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\r\n  [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\r\n  (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\r\n  (selection)=\"toggleSelectionMode($event)\"\r\n>\r\n</igo-layer-list-tool>\r\n\r\n<div *ngIf=\"selection\" class=\"select-all\">\r\n  <mat-checkbox\r\n    class=\"select-all-checkbox\"\r\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\r\n    (change)=\"selectAll()\"\r\n    [checked]=\"selectAllCheck\"\r\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"\r\n  >\r\n    {{\r\n      selectAllCheck\r\n        ? ('igo.geo.layer.deselectAll' | translate)\r\n        : ('igo.geo.layer.selectAll' | translate)\r\n    }}\r\n  </mat-checkbox>\r\n</div>\r\n<mat-divider></mat-divider>\r\n\r\n<igo-list #igoList [navigation]=\"false\" [selection]=\"false\">\r\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\r\n    <igo-layer-item\r\n      *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\r\n      igoListItem\r\n      [layer]=\"layer\"\r\n      [activeLayer]=\"activeLayer\"\r\n      [orderable]=\"orderable && !layer.baseLayer\"\r\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\r\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\r\n      [queryBadge]=\"queryBadge\"\r\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\r\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\r\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\r\n      [selectionMode]=\"selection\"\r\n      [selectAll]=\"selectAllCheck\"\r\n      [layerCheck]=\"layer.options.check\"\r\n      [changeDetection]=\"layerItemChangeDetection$\"\r\n      (action)=\"toggleLayerTool($event)\"\r\n      (checkbox)=\"layersCheck($event)\"\r\n    >\r\n    </igo-layer-item>\r\n  </ng-template>\r\n</igo-list>\r\n\r\n<igo-panel\r\n  *ngIf=\"!selection && layerTool && activeLayer\"\r\n  class=\"igo-layer-actions-container\"\r\n  [title]=\"activeLayer.title\"\r\n>\r\n  <div class=\"igo-layer-button-group\">\r\n    <button\r\n      *ngIf=\"isLayerRemovable(activeLayer)\"\r\n      class=\"delete-button\"\r\n      mat-icon-button\r\n      color=\"warn\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\r\n      (click)=\"removeLayers()\"\r\n    >\r\n      <mat-icon svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"down-button\"\r\n      mat-icon-button\r\n      color=\"primary\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"\r\n        sortAlpha || onlyVisible || keyword\r\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\r\n          : ('igo.geo.layer.lowerLayer' | translate)\r\n      \"\r\n      [disabled]=\"lowerDisabled\"\r\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Lower, true)\"\r\n    >\r\n      <mat-icon\r\n        aria-hidden=\"false\"\r\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\r\n        matBadgeColor=\"warn\"\r\n        matBadgeSize=\"medium\"\r\n        [matBadgeHidden]=\"lowerDisabled\"\r\n        svgIcon=\"arrow-down\"\r\n      ></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"up-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"\r\n        sortAlpha || onlyVisible || keyword\r\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\r\n          : ('igo.geo.layer.raiseLayer' | translate)\r\n      \"\r\n      [disabled]=\"raiseDisabled\"\r\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Raise, true)\"\r\n    >\r\n      <mat-icon\r\n        aria-hidden=\"false\"\r\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\r\n        matBadgeColor=\"warn\"\r\n        matBadgeSize=\"medium\"\r\n        [matBadgeHidden]=\"raiseDisabled\"\r\n        svgIcon=\"arrow-up\"\r\n      ></mat-icon>\r\n    </button>\r\n\r\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\r\n    <button\r\n      class=\"opacity-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matMenuTriggerFor]=\"opacityMenu\"\r\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\r\n    >\r\n      <mat-icon\r\n        aria-hidden=\"false\"\r\n        [matBadge]=\"badgeOpacity\"\r\n        matBadgeColor=\"primary\"\r\n        matBadgeSize=\"medium\"\r\n        svgIcon=\"opacity\"\r\n      ></mat-icon>\r\n    </button>\r\n\r\n    <mat-menu #opacityMenu=\"matMenu\" class=\"panel-opacity-menu\">\r\n      <mat-slider\r\n        id=\"opacity-slider\"\r\n        color=\"primary\"\r\n        discrete\r\n        step=\"5\"\r\n        [min]=\"0\"\r\n        [max]=\"100\"\r\n        [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\r\n        (click)=\"$event.stopPropagation()\"\r\n        matTooltipShowDelay=\"500\"\r\n        tooltip-position=\"below\"\r\n        #ngSlider\r\n        ><input\r\n          matSliderThumb\r\n          [value]=\"opacity\"\r\n          (input)=\"\r\n            changeOpacity({\r\n              source: ngSliderThumb,\r\n              parent: ngSlider,\r\n              value: ngSliderThumb.value\r\n            })\r\n          \"\r\n          #ngSliderThumb=\"matSliderThumb\"\r\n        />\r\n      </mat-slider>\r\n    </mat-menu>\r\n\r\n    <button\r\n      *ngIf=\"activeLayerExtentIsValid(activeLayer)\"\r\n      class=\"zoomLayer-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\r\n      (click)=\"zoomLayerExtents(activeLayer)\"\r\n    >\r\n      <mat-icon\r\n        matBadgeColor=\"primary\"\r\n        matBadgeSize=\"medium\"\r\n        svgIcon=\"magnify-scan\"\r\n      ></mat-icon>\r\n    </button>\r\n\r\n    <ng-container\r\n      igoLayerItemToolbar\r\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\r\n      [ngTemplateOutletContext]=\"{ layer: activeLayer }\"\r\n    >\r\n    </ng-container>\r\n\r\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\r\n  </div>\r\n</igo-panel>\r\n\r\n<igo-panel\r\n  *ngIf=\"selection && layers.length > 0\"\r\n  class=\"igo-layer-actions-container\"\r\n  [title]=\"'igo.geo.layer.tools' | translate\"\r\n>\r\n  <div class=\"actions-buttons-multi\">\r\n    <button\r\n      class=\"delete-button\"\r\n      mat-icon-button\r\n      color=\"warn\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [disabled]=\"layersChecked.length === 0\"\r\n      [matTooltip]=\"\r\n        isAllLayersRemovable(layersChecked)\r\n          ? ('igo.geo.layer.removeSelectedLayers' | translate)\r\n          : ('igo.geo.layer.removeSelectedLayersRestriction' | translate)\r\n      \"\r\n      (click)=\"removeLayers(layersChecked)\"\r\n    >\r\n      <mat-icon\r\n        aria-hidden=\"false\"\r\n        [matBadge]=\"'!'\"\r\n        matBadgeColor=\"warn\"\r\n        matBadgeSize=\"medium\"\r\n        [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\r\n        svgIcon=\"delete\"\r\n      ></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"eye-button\"\r\n      mat-icon-button\r\n      color=\"primary\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [disabled]=\"layersChecked.length === 0\"\r\n      [matTooltip]=\"\r\n        statusSelectedLayersCheck === 'ALL_HIDDEN'\r\n          ? ('igo.geo.layer.showSelectedLayers' | translate)\r\n          : ('igo.geo.layer.hideSelectedLayers' | translate)\r\n      \"\r\n      (click)=\"toggleVisibility(layersChecked)\"\r\n    >\r\n      <mat-icon\r\n        [svgIcon]=\"\r\n          statusSelectedLayersCheck === 'ALL_HIDDEN' ? 'eye-off' : 'eye'\r\n        \"\r\n      ></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"down-button\"\r\n      mat-icon-button\r\n      color=\"primary\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"\r\n        sortAlpha || onlyVisible || keyword\r\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\r\n          : ('igo.geo.layer.lowerLayer' | translate)\r\n      \"\r\n      [disabled]=\"lowerDisabledSelection\"\r\n      (click)=\"lowerLayers(layersChecked)\"\r\n    >\r\n      <mat-icon\r\n        aria-hidden=\"false\"\r\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\r\n        matBadgeColor=\"warn\"\r\n        matBadgeSize=\"medium\"\r\n        [matBadgeHidden]=\"lowerDisabledSelection\"\r\n        svgIcon=\"arrow-down\"\r\n      ></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"up-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"\r\n        sortAlpha || onlyVisible || keyword\r\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\r\n          : ('igo.geo.layer.raiseLayer' | translate)\r\n      \"\r\n      [disabled]=\"raiseDisabledSelection\"\r\n      (click)=\"raiseLayers(layersChecked)\"\r\n    >\r\n      <mat-icon\r\n        aria-hidden=\"false\"\r\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\r\n        matBadgeColor=\"warn\"\r\n        matBadgeSize=\"medium\"\r\n        [matBadgeHidden]=\"raiseDisabledSelection\"\r\n        svgIcon=\"arrow-up\"\r\n      ></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      class=\"opacity-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [disabled]=\"layersChecked.length === 0\"\r\n      [matMenuTriggerFor]=\"opacityMenu\"\r\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\r\n    >\r\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\r\n    </button>\r\n\r\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\r\n      <div id=\"opacity-menu\">\r\n        <!-- TODO: The 'tickInterval' property no longer exists -->\r\n        <mat-slider\r\n          *ngIf=\"layersChecked.length\"\r\n          id=\"opacity-slider\"\r\n          color=\"primary\"\r\n          thumbLabel\r\n          showTickMarks\r\n          step=\"5\"\r\n          [min]=\"0\"\r\n          [max]=\"100\"\r\n          [(ngModel)]=\"checkOpacity\"\r\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\r\n          matTooltipShowDelay=\"500\"\r\n          tooltip-position=\"below\"\r\n          (click)=\"$event.stopPropagation()\"\r\n          ><input matSliderThumb />\r\n        </mat-slider>\r\n      </div>\r\n    </mat-menu>\r\n\r\n    <button\r\n      *ngIf=\"\r\n        layersChecked.length !== 0 && activeLayersExtentAreValid(layersChecked)\r\n      \"\r\n      class=\"zoomLayer-button\"\r\n      color=\"primary\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\r\n      (click)=\"zoomLayersExtents(layersChecked)\"\r\n    >\r\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\r\n    </button>\r\n  </div>\r\n</igo-panel>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ContentChild,\r\n  OnInit,\r\n  OnDestroy,\r\n  Output,\r\n  EventEmitter,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport type { TemplateRef } from '@angular/core';\r\n\r\nimport scrollIntoView from 'scroll-into-view-if-needed';\r\n\r\nimport { FloatLabelType } from '@angular/material/form-field';\r\nimport {\r\n  LayerListControlsEnum,\r\n  LayerListDisplacement\r\n} from './layer-list.enum';\r\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\r\nimport {\r\n  BehaviorSubject,\r\n  ReplaySubject,\r\n  Subscription,\r\n  EMPTY,\r\n  timer\r\n} from 'rxjs';\r\nimport { debounce } from 'rxjs/operators';\r\nimport {\r\n  MetadataOptions,\r\n  MetadataLayerOptions\r\n} from '../../metadata/shared/metadata.interface';\r\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { LinkedProperties } from '../shared/layers/layer.interface';\r\nimport { MatSliderChange } from '@angular/material/slider';\r\nimport * as olextent from 'ol/extent';\r\nimport {\r\n  getAllChildLayersByProperty,\r\n  getRootParentByProperty\r\n} from '../../map/shared/linkedLayers.utils';\r\n\r\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\r\n@Component({\r\n  selector: 'igo-layer-list',\r\n  templateUrl: './layer-list.component.html',\r\n  styleUrls: ['./layer-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerListComponent implements OnInit, OnDestroy {\r\n  orderable = true;\r\n  thresholdToFilterAndSort = 5;\r\n\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public layerTool: boolean;\r\n\r\n  public hideSelectedLayers: boolean = true;\r\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\r\n\r\n  layersChecked: Layer[] = [];\r\n  public selection: boolean;\r\n\r\n  private change$$: Subscription;\r\n  private layers$$: Subscription;\r\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\r\n\r\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\r\n  templateLayerToolbar: TemplateRef<any>;\r\n\r\n  @Input() layersAreAllVisible: boolean = true;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  set layers(value: Layer[]) {\r\n    this._layers = this.removeProblemLayerInList(value);\r\n    this.next();\r\n  }\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  private _layers: Layer[];\r\n\r\n  set activeLayer(value: Layer) {\r\n    this._activeLayer = value;\r\n    this.activeLayer$.next(value);\r\n  }\r\n  get activeLayer(): Layer {\r\n    return this._activeLayer;\r\n  }\r\n  private _activeLayer: Layer;\r\n\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\r\n\r\n  @Input() excludeBaseLayers: boolean = false;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\r\n\r\n  get keyword(): string {\r\n    return this._keyword;\r\n  }\r\n  set keyword(value: string) {\r\n    this._keyword = value;\r\n    this.next();\r\n  }\r\n  private _keyword = undefined;\r\n\r\n  get onlyVisible(): boolean {\r\n    return this._onlyVisible;\r\n  }\r\n  set onlyVisible(value: boolean) {\r\n    this._onlyVisible = value;\r\n    this.next();\r\n  }\r\n  private _onlyVisible = false;\r\n\r\n  get sortAlpha(): boolean {\r\n    return this._sortedAlpha;\r\n  }\r\n  set sortAlpha(value: boolean) {\r\n    this._sortedAlpha = value;\r\n    this.next();\r\n  }\r\n  private _sortedAlpha = false;\r\n\r\n  get opacity() {\r\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\r\n  }\r\n  set opacity(opacity: number) {\r\n    this.activeLayer$.getValue().opacity = opacity / 100;\r\n  }\r\n\r\n  get badgeOpacity() {\r\n    if (this.opacity === 100) {\r\n      return;\r\n    }\r\n    return this.opacity;\r\n  }\r\n\r\n  get raiseDisabled(): boolean {\r\n    if (\r\n      !this.orderable ||\r\n      this.activeLayer.baseLayer ||\r\n      this.getUpperLayer().id === this.activeLayer.id ||\r\n      this.isUpperBaselayer(this.activeLayer)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get lowerDisabled(): boolean {\r\n    if (\r\n      !this.orderable ||\r\n      this.activeLayer.baseLayer ||\r\n      this.getLowerLayer().id === this.activeLayer.id ||\r\n      this.isLowerBaselayer(this.activeLayer)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get raiseDisabledSelection(): boolean {\r\n    if (\r\n      this.layersChecked.length === 0 ||\r\n      !this.orderable ||\r\n      !this.raisableLayers(this.layersChecked) ||\r\n      this.selectAllCheck === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get lowerDisabledSelection(): boolean {\r\n    if (\r\n      this.layersChecked.length === 0 ||\r\n      !this.orderable ||\r\n      !this.lowerableLayers(this.layersChecked) ||\r\n      this.selectAllCheck === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get checkOpacity() {\r\n    return this.layersCheckedOpacity() * 100;\r\n  }\r\n  set checkOpacity(opacity: number) {\r\n    for (const layer of this.layersChecked) {\r\n      layer.opacity = opacity / 100;\r\n    }\r\n  }\r\n\r\n  get layerListDisplacement(): typeof LayerListDisplacement {\r\n    return LayerListDisplacement;\r\n  }\r\n\r\n  public toggleOpacity = false;\r\n\r\n  public selectAllCheck: boolean;\r\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\r\n  private selectAllCheck$$: Subscription;\r\n\r\n  constructor(private elRef: ElementRef) {}\r\n\r\n  /**\r\n   * Subscribe to the search term stream and trigger researches\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.change$$ = this.change$\r\n      .pipe(\r\n        debounce(() => {\r\n          return this.layers.length === 0 ? EMPTY : timer(50);\r\n        })\r\n      )\r\n      .subscribe(() => {\r\n        this.showToolbar$.next(this.computeShowToolbar());\r\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\r\n        this.appliedFilterAndSort.emit({\r\n          keyword: this.keyword,\r\n          sortAlpha: this.sortAlpha,\r\n          onlyVisible: this.onlyVisible\r\n        });\r\n      });\r\n\r\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\r\n      this.selectAllCheck = value;\r\n    });\r\n\r\n    this.layers$$ = this.layers$.subscribe(() => {\r\n      if (this.layers) {\r\n        let checks = 0;\r\n        for (const layer of this.layers) {\r\n          layer.status$.subscribe((valStatus) => {\r\n            if (valStatus === 0) {\r\n              this.map.removeLayer(layer);\r\n            }\r\n          });\r\n          if (layer.options.active) {\r\n            this.activeLayer = layer;\r\n            this.layerTool = true;\r\n          }\r\n          if (layer.options.check) {\r\n            checks += 1;\r\n          }\r\n        }\r\n        if (this.excludeBaseLayers) {\r\n          this.selectAllCheck =\r\n            checks ===\r\n            this.layers.filter(\r\n              (lay) => lay.baseLayer !== true && lay.showInLayerList\r\n            ).length\r\n              ? true\r\n              : false;\r\n        } else {\r\n          this.selectAllCheck =\r\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\r\n              ? true\r\n              : false;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n    this.selectAllCheck$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  activeLayerExtentIsValid(layer: Layer): boolean {\r\n    let valid = false;\r\n    if (layer.options.showButtonZoomToExtent === false) {\r\n      return false;\r\n    }\r\n    const layerExtent = layer.options.extent;\r\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\r\n\r\n    if (layerExtent) {\r\n      if (maxLayerZoomExtent) {\r\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\r\n      } else {\r\n        valid = true;\r\n      }\r\n    }\r\n    return valid;\r\n  }\r\n\r\n  activeLayersExtentAreValid(layers: Layer[]): boolean {\r\n    let valid = false;\r\n    const layersExtent = olextent.createEmpty();\r\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\r\n\r\n    for (const layer of layers) {\r\n      const layerExtent = layer.options.extent;\r\n\r\n      if (layerExtent && !layerExtent.includes(Infinity)) {\r\n        olextent.extend(layersExtent, layerExtent);\r\n      }\r\n    }\r\n\r\n    if (!olextent.isEmpty(layersExtent)) {\r\n      if (maxLayerZoomExtent) {\r\n        valid = olextent.containsExtent(maxLayerZoomExtent, layersExtent);\r\n      } else {\r\n        valid = true;\r\n      }\r\n    }\r\n    return valid;\r\n  }\r\n\r\n  zoomLayerExtents(layer: Layer) {\r\n    this.map.viewController.zoomToExtent(layer.options.extent);\r\n  }\r\n\r\n  zoomLayersExtents(layers: Layer[]) {\r\n    const layersExtent = olextent.createEmpty() as [\r\n      number,\r\n      number,\r\n      number,\r\n      number\r\n    ];\r\n\r\n    for (const layer of layers) {\r\n      const layerExtent = layer.options.extent;\r\n\r\n      if (layerExtent) {\r\n        olextent.extend(layersExtent, layerExtent);\r\n      }\r\n    }\r\n    this.map.viewController.zoomToExtent(layersExtent);\r\n  }\r\n\r\n  changeOpacity(event: MatSliderChange) {\r\n    this.opacity = event.value;\r\n  }\r\n\r\n  clearKeyword() {\r\n    this.keyword = undefined;\r\n  }\r\n\r\n  getLowerLayer() {\r\n    return this.layers\r\n      .filter((l) => !l.baseLayer)\r\n      .reduce(\r\n        (prev, current) => {\r\n          return prev.zIndex < current.zIndex ? prev : current;\r\n        },\r\n        { zIndex: undefined, id: undefined }\r\n      );\r\n  }\r\n\r\n  isLowerBaselayer(layer) {\r\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\r\n    if (\r\n      this.layers &&\r\n      this.layers[index + 1] &&\r\n      this.layers[index + 1].baseLayer === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getUpperLayer() {\r\n    return this.layers\r\n      .filter((l) => !l.baseLayer)\r\n      .reduce(\r\n        (prev, current) => {\r\n          return prev.zIndex > current.zIndex ? prev : current;\r\n        },\r\n        { zIndex: undefined, id: undefined }\r\n      );\r\n  }\r\n\r\n  isUpperBaselayer(layer) {\r\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\r\n    if (\r\n      this.layers &&\r\n      this.layers[index - 1] &&\r\n      this.layers[index - 1].baseLayer === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  moveActiveLayer(\r\n    activeLayer: Layer,\r\n    actiontype: LayerListDisplacement,\r\n    fromUi: boolean = false\r\n  ) {\r\n    const sortedLayersToMove = [];\r\n    getRootParentByProperty(this.map, activeLayer, LinkedProperties.ZINDEX);\r\n    let rootParentByProperty = getRootParentByProperty(\r\n      this.map,\r\n      activeLayer,\r\n      LinkedProperties.ZINDEX\r\n    );\r\n    if (!rootParentByProperty) {\r\n      rootParentByProperty = activeLayer;\r\n    }\r\n    const layersToMove = [rootParentByProperty];\r\n    getAllChildLayersByProperty(\r\n      this.map,\r\n      rootParentByProperty,\r\n      layersToMove,\r\n      LinkedProperties.ZINDEX\r\n    );\r\n\r\n    this.layers.map((layer) => {\r\n      if (layersToMove.indexOf(layer) !== -1) {\r\n        sortedLayersToMove.push(layer);\r\n      }\r\n    });\r\n\r\n    if (actiontype === LayerListDisplacement.Raise) {\r\n      this.raiseLayers(sortedLayersToMove, fromUi);\r\n    } else if (actiontype === LayerListDisplacement.Lower) {\r\n      this.lowerLayers(sortedLayersToMove, fromUi);\r\n    }\r\n  }\r\n\r\n  /*\r\n   * For selection mode disabled attribute\r\n   */\r\n  raisableLayers(layers: Layer[]) {\r\n    let response = false;\r\n    let base = 0;\r\n    for (const layer of layers) {\r\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\r\n      const currentLayer = this.layers[mapIndex];\r\n      if (currentLayer.baseLayer) {\r\n        base += 1;\r\n      }\r\n\r\n      const previousLayer = this.layers[mapIndex - 1];\r\n      if (\r\n        previousLayer &&\r\n        previousLayer.baseLayer !== true &&\r\n        !layers.find((lay) => previousLayer.id === lay.id) &&\r\n        currentLayer.baseLayer !== true\r\n      ) {\r\n        response = true;\r\n      }\r\n    }\r\n\r\n    if (\r\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\r\n      base === this.layersChecked.length\r\n    ) {\r\n      response = false;\r\n    }\r\n    return response;\r\n  }\r\n\r\n  /*\r\n   * When multiple layers is selected but some may be allow to move\r\n   */\r\n  raisableLayer(index: number) {\r\n    if (index < 1) {\r\n      return false;\r\n    }\r\n\r\n    if (this.layers[index - 1].options.check) {\r\n      return this.raisableLayer(index - 1);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\r\n    const layersToRaise = [];\r\n    for (const layer of layers) {\r\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\r\n      if (this.raisableLayer(index)) {\r\n        layersToRaise.push(layer);\r\n      }\r\n    }\r\n    this.map.raiseLayers(layersToRaise);\r\n    if (fromUi) {\r\n      setTimeout(() => {\r\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\r\n          'mat-checkbox-checked'\r\n        );\r\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\r\n          'igo-layer-item-focused'\r\n        );\r\n        let targetToScroll;\r\n        if (checkItems.length) {\r\n          targetToScroll = checkItems[0];\r\n        }\r\n        if (itemFocused.length) {\r\n          targetToScroll = itemFocused[0];\r\n        }\r\n        if (targetToScroll) {\r\n          scrollIntoView(targetToScroll, {\r\n            scrollMode: 'if-needed',\r\n            behavior: 'smooth',\r\n            block: 'end',\r\n            inline: 'nearest'\r\n          });\r\n        }\r\n      }, 100);\r\n    }\r\n  }\r\n  /*\r\n   * For selection mode disabled attribute\r\n   */\r\n  lowerableLayers(layers: Layer[]) {\r\n    let response = false;\r\n    let base = 0;\r\n    for (const layer of layers) {\r\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\r\n      const currentLayer = this.layers[mapIndex];\r\n      if (currentLayer.baseLayer) {\r\n        base += 1;\r\n      }\r\n\r\n      const nextLayer = this.layers[mapIndex + 1];\r\n      if (\r\n        nextLayer &&\r\n        nextLayer.baseLayer !== true &&\r\n        !layers.find((lay) => nextLayer.id === lay.id)\r\n      ) {\r\n        response = true;\r\n      }\r\n    }\r\n\r\n    if (\r\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\r\n      base === this.layersChecked.length\r\n    ) {\r\n      response = false;\r\n    }\r\n    return response;\r\n  }\r\n\r\n  /*\r\n   * When multiple layers is selected but some may be allow to move\r\n   */\r\n  lowerableLayer(index: number) {\r\n    if (\r\n      index >\r\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (this.layers[index + 1].options.check) {\r\n      return this.lowerableLayer(index + 1);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\r\n    const layersToLower = [];\r\n    for (const layer of layers) {\r\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\r\n      if (this.lowerableLayer(index)) {\r\n        layersToLower.push(layer);\r\n      }\r\n    }\r\n    this.map.lowerLayers(layersToLower);\r\n    if (fromUi) {\r\n      setTimeout(() => {\r\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\r\n          'mat-checkbox-checked'\r\n        );\r\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\r\n          'igo-layer-item-focused'\r\n        );\r\n        let targetToScroll;\r\n        if (checkItems.length) {\r\n          targetToScroll = checkItems[checkItems.length - 1];\r\n        }\r\n        if (itemFocused.length) {\r\n          targetToScroll = itemFocused[0];\r\n        }\r\n        if (targetToScroll) {\r\n          scrollIntoView(targetToScroll, {\r\n            scrollMode: 'if-needed',\r\n            behavior: 'smooth',\r\n            block: 'end',\r\n            inline: 'nearest'\r\n          });\r\n        }\r\n      }, 100);\r\n    }\r\n  }\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n  private computeLayers(layers: Layer[]): Layer[] {\r\n    let layersOut = this.filterLayers(layers);\r\n    if (this.sortAlpha) {\r\n      layersOut = this.sortLayersByTitle(layersOut);\r\n    } else {\r\n      layersOut = this.sortLayersByZindex(layersOut);\r\n    }\r\n    return layersOut;\r\n  }\r\n\r\n  onKeywordChange(term) {\r\n    this.keyword = term;\r\n  }\r\n\r\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\r\n    this.keyword = appliedFilter.keyword;\r\n    this.onlyVisible = appliedFilter.onlyVisible;\r\n    this.sortAlpha = appliedFilter.sortAlpha;\r\n  }\r\n\r\n  private filterLayers(layers: Layer[]): Layer[] {\r\n    if (\r\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\r\n    ) {\r\n      return layers;\r\n    }\r\n    if (!this.keyword && !this.onlyVisible) {\r\n      return layers;\r\n    }\r\n\r\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\r\n\r\n    layers.forEach((layer: Layer) => {\r\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\r\n      const dataSourceOptions = layer.dataSource.options || {};\r\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\r\n      const keywords = metadata.keywordList || [];\r\n      const layerKeywords = keywords.map((kw: string) => {\r\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n      });\r\n\r\n      if (this.keyword && layer.title) {\r\n        const localKeyword = this.keyword\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const layerTitle = layer.title\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const dataSourceType = dataSourceOptions.type || '';\r\n        const keywordRegex = new RegExp(localKeyword, 'gi');\r\n        const keywordInList =\r\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\r\n          undefined;\r\n        if (\r\n          !keywordRegex.test(layerTitle) &&\r\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\r\n          !keywordInList\r\n        ) {\r\n          const index = keepLayerIds.indexOf(layer.id);\r\n          if (index > -1) {\r\n            keepLayerIds.splice(index, 1);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (this.onlyVisible && layer.visible === false) {\r\n        const index = keepLayerIds.indexOf(layer.id);\r\n        if (index > -1) {\r\n          keepLayerIds.splice(index, 1);\r\n        }\r\n      }\r\n    });\r\n\r\n    return layers.filter(\r\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\r\n    );\r\n  }\r\n\r\n  private sortLayersByZindex(layers: Layer[]) {\r\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\r\n  }\r\n\r\n  private sortLayersByTitle(layers: Layer[]) {\r\n    return layers.sort((a, b) => {\r\n      if (this.normalize(a.title) < this.normalize(b.title)) {\r\n        return -1;\r\n      }\r\n      if (this.normalize(a.title) > this.normalize(b.title)) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  private normalize(str: string) {\r\n    return str\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .toLowerCase();\r\n  }\r\n\r\n  private computeShowToolbar(): boolean {\r\n    switch (this.layerFilterAndSortOptions.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        return true;\r\n      case LayerListControlsEnum.never:\r\n        return false;\r\n      default:\r\n        if (\r\n          this.layers.length >= this.thresholdToFilterAndSort ||\r\n          this.keyword ||\r\n          this.onlyVisible\r\n        ) {\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  }\r\n\r\n  toggleLayerTool(layer) {\r\n    this.toggleOpacity = false;\r\n    if (this.layerTool && layer === this.activeLayer) {\r\n      this.layerTool = false;\r\n    } else {\r\n      this.layerTool = true;\r\n    }\r\n\r\n    for (const lay of this.layers) {\r\n      lay.options.active = false;\r\n    }\r\n    layer.options.active = true;\r\n    this.activeLayer = layer;\r\n  }\r\n\r\n  removeLayers(layers?: Layer[]) {\r\n    if (layers && layers.length > 0) {\r\n      this.layersChecked = [];\r\n      for (const layer of layers) {\r\n        if (layer.options.removable !== false) {\r\n          layer.map.removeLayer(layer);\r\n        } else {\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n    } else if (!layers && this.activeLayer.options.removable !== false) {\r\n      this.activeLayer.map.removeLayer(this.activeLayer);\r\n      this.layerTool = false;\r\n    }\r\n  }\r\n\r\n  toggleVisibility(layers?: Layer[]) {\r\n    if (layers && layers.length > 0) {\r\n      for (const layer of layers) {\r\n        layer.visible = this.hideSelectedLayers;\r\n      }\r\n    }\r\n    this.layerItemChangeDetection$.next(true);\r\n  }\r\n\r\n  isLayerRemovable(layer: Layer): boolean {\r\n    return layer.options.removable !== false;\r\n  }\r\n\r\n  isAllLayersRemovable(layers: Layer[]): boolean {\r\n    return layers.every((l) => this.isLayerRemovable(l));\r\n  }\r\n\r\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\r\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\r\n      LayerListSelectVisibleEnum.NULL;\r\n    let findTrue: boolean = false;\r\n    let findFalse: boolean = false;\r\n\r\n    if (this.layersChecked.length === 0) {\r\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\r\n    } else {\r\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\r\n      this.hideSelectedLayers = false;\r\n\r\n      for (const layer2 of this.layersChecked) {\r\n        if (layer2.visible === true) {\r\n          findTrue = true;\r\n        }\r\n        if (layer2.visible === false) {\r\n          findFalse = true;\r\n        }\r\n      }\r\n\r\n      if (findTrue === true && findFalse === false) {\r\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\r\n      }\r\n      if (findTrue === false && findFalse === true) {\r\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\r\n        this.hideSelectedLayers = true;\r\n      }\r\n    }\r\n\r\n    return statusSelectedLayers;\r\n  }\r\n\r\n  layersCheck(event: { layer: Layer; check: boolean }) {\r\n    event.layer.options.check = event.check;\r\n    if (event.check === true) {\r\n      const eventMapIndex = this.layers.findIndex(\r\n        (layer) => event.layer.id === layer.id\r\n      );\r\n      for (const layer of this.layersChecked) {\r\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\r\n        if (eventMapIndex < mapIndex) {\r\n          this.layersChecked.splice(\r\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\r\n            0,\r\n            event.layer\r\n          );\r\n\r\n          if (this.excludeBaseLayers) {\r\n            if (\r\n              this.layersChecked.length ===\r\n              this.layers.filter(\r\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\r\n              ).length\r\n            ) {\r\n              this.selectAllCheck = true;\r\n            } else {\r\n              this.selectAllCheck = false;\r\n            }\r\n          } else if (!this.excludeBaseLayers) {\r\n            if (\r\n              this.layersChecked.length ===\r\n              this.layers.filter((lay) => lay.showInLayerList).length\r\n            ) {\r\n              this.selectAllCheck = true;\r\n            } else {\r\n              this.selectAllCheck = false;\r\n            }\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      this.layersChecked.push(event.layer);\r\n    } else {\r\n      const index = this.layersChecked.findIndex(\r\n        (layer) => event.layer.id === layer.id\r\n      );\r\n      this.layersChecked.splice(index, 1);\r\n    }\r\n\r\n    if (this.excludeBaseLayers) {\r\n      if (\r\n        this.layersChecked.length ===\r\n        this.layers.filter(\r\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\r\n        ).length\r\n      ) {\r\n        this.selectAllCheck = true;\r\n      } else {\r\n        this.selectAllCheck = false;\r\n      }\r\n    } else if (!this.excludeBaseLayers) {\r\n      if (\r\n        this.layersChecked.length ===\r\n        this.layers.filter((lay) => lay.showInLayerList).length\r\n      ) {\r\n        this.selectAllCheck = true;\r\n      } else {\r\n        this.selectAllCheck = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  toggleSelectionMode(value: boolean) {\r\n    this.selection = value;\r\n    this.activeLayer = undefined;\r\n    if (value === true) {\r\n      this.layerTool = false;\r\n      for (const layer of this.layers) {\r\n        if (layer.options.check) {\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  layersCheckedOpacity(): any {\r\n    if (this.layersChecked.length > 1) {\r\n      return 1;\r\n    } else {\r\n      const opacity = [];\r\n      for (const layer of this.layersChecked) {\r\n        opacity.push(layer.opacity);\r\n      }\r\n      return opacity;\r\n    }\r\n  }\r\n\r\n  selectAll() {\r\n    if (!this.selectAllCheck) {\r\n      for (const layer of this.layers) {\r\n        if (\r\n          this.excludeBaseLayers &&\r\n          layer.baseLayer !== true &&\r\n          layer.showInLayerList\r\n        ) {\r\n          layer.options.check = true;\r\n          this.layersChecked.push(layer);\r\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\r\n          layer.options.check = true;\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n      this.selectAllCheck$.next(true);\r\n    } else {\r\n      for (const layer of this.layers) {\r\n        layer.options.check = false;\r\n      }\r\n      this.layersChecked = [];\r\n      this.selectAllCheck$.next(false);\r\n    }\r\n  }\r\n\r\n  isScrolledIntoView(elemSource, elem) {\r\n    const docViewTop = elemSource.scrollTop;\r\n    const docViewBottom = docViewTop + elemSource.clientHeight;\r\n\r\n    const elemTop = elem.offsetTop;\r\n    const elemBottom = elemTop + elem.clientHeight;\r\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\r\n  }\r\n\r\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\r\n    for (const layer of layersList) {\r\n      if (layer.olLoadingProblem === true) {\r\n        this.map.removeLayer(layer);\r\n      }\r\n    }\r\n    return layersList;\r\n  }\r\n}\r\n","<mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n    [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n    matTooltipShowDelay=\"500\"\n    type=\"text\"\n    [(ngModel)]=\"term\"\n  />\n  <button\n    *ngIf=\"term\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    color=\"warn\"\n    (click)=\"clearTerm()\"\n  >\n    <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"actions-container\">\n  <button\n    class=\"sort-alpha\"\n    [color]=\"sortAlpha ? 'warn' : 'primary'\"\n    mat-icon-button\n    [matTooltip]=\"\n      sortAlpha\n        ? ('igo.geo.layer.sortMapOrder' | translate)\n        : ('igo.geo.layer.sortAlphabetically' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSortAlpha()\"\n  >\n    <mat-icon\n      [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"\n    ></mat-icon>\n  </button>\n\n  <button\n    class=\"only-visible\"\n    mat-icon-button\n    [disabled]=\"layersAreAllVisible && !onlyVisible\"\n    [color]=\"onlyVisible ? 'warn' : 'primary'\"\n    [matTooltip]=\"\n      onlyVisible\n        ? ('igo.geo.layer.resetLayersList' | translate)\n        : ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleOnlyVisible()\"\n  >\n    <mat-icon\n      aria-hidden=\"false\"\n      matBadge=\"icon\"\n      igoMatBadgeIcon=\"eye\"\n      igoMatBadgeInverseColor=\"true\"\n      igoMatBadgeInheritColor=\"true\"\n      [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\"\n    >\n    </mat-icon>\n  </button>\n\n  <button\n    class=\"selection-mode\"\n    mat-icon-button\n    color=\"primary\"\n    [matTooltip]=\"\n      selectionMode\n        ? ('igo.geo.layer.deactivateSelectionMode' | translate)\n        : ('igo.geo.layer.activateSelectionMode' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSelectionMode()\"\n  >\n    <mat-icon\n      [svgIcon]=\"\n        selectionMode\n          ? 'checkbox-multiple-marked-outline'\n          : 'checkbox-multiple-blank-outline'\n      \"\n    ></mat-icon>\n  </button>\n</div>\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  EventEmitter,\r\n  Output,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material/form-field';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\r\n\r\n@Component({\r\n  selector: 'igo-layer-list-tool',\r\n  templateUrl: './layer-list-tool.component.html',\r\n  styleUrls: ['./layer-list-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerListToolComponent implements OnInit, OnDestroy {\r\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n  onlyVisible$$: Subscription;\r\n  sortAlpha$$: Subscription;\r\n  term$$: Subscription;\r\n\r\n  @Input() layersAreAllVisible: boolean = true;\r\n\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input()\r\n  set onlyVisible(value: boolean) {\r\n    this.onlyVisible$.next(value);\r\n  }\r\n  get onlyVisible(): boolean {\r\n    return this.onlyVisible$.value;\r\n  }\r\n\r\n  @Input()\r\n  set sortAlpha(value: boolean) {\r\n    this.sortAlpha$.next(value);\r\n  }\r\n  get sortAlpha(): boolean {\r\n    return this.sortAlpha$.value;\r\n  }\r\n\r\n  @Input()\r\n  set term(value: string) {\r\n    this.term$.next(value);\r\n  }\r\n  get term(): string {\r\n    return this.term$.value;\r\n  }\r\n\r\n  public selectionMode = false;\r\n\r\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\r\n  @Output() selection = new EventEmitter<boolean>();\r\n\r\n  ngOnInit(): void {\r\n    this.term$$ = this.term$.subscribe((keyword) => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword,\r\n        onlyVisible: this.onlyVisible,\r\n        sortAlpha: this.sortAlpha\r\n      });\r\n    });\r\n\r\n    this.onlyVisible$$ = this.onlyVisible$.subscribe((onlyVisible) => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword: this.term,\r\n        onlyVisible,\r\n        sortAlpha: this.sortAlpha\r\n      });\r\n    });\r\n    this.sortAlpha$$ = this.sortAlpha$.subscribe((sortAlpha) => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword: this.term,\r\n        onlyVisible: this.onlyVisible,\r\n        sortAlpha\r\n      });\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.onlyVisible$$.unsubscribe();\r\n    this.sortAlpha$$.unsubscribe();\r\n    this.term$$.unsubscribe();\r\n  }\r\n\r\n  clearTerm() {\r\n    this.term = undefined;\r\n  }\r\n  toggleSortAlpha() {\r\n    this.sortAlpha = !this.sortAlpha;\r\n  }\r\n\r\n  toggleOnlyVisible() {\r\n    this.onlyVisible = !this.onlyVisible;\r\n  }\r\n\r\n  toggleSelectionMode() {\r\n    this.selectionMode = !this.selectionMode;\r\n    this.selection.emit(this.selectionMode);\r\n  }\r\n}\r\n","<div class=\"layer-legend-list-container\">\r\n  <mat-slide-toggle\r\n    tooltip-position=\"above\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\r\n    [checked]=\"showAllLegendsValue\"\r\n    class=\"mat-typography\"\r\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\r\n    [labelPosition]=\"'before'\"\r\n    (change)=\"toggleShowAllLegends($event.checked)\"\r\n  >\r\n    {{ 'igo.geo.layer.legend.showAll' | translate }}\r\n  </mat-slide-toggle>\r\n  <mat-divider\r\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\r\n  ></mat-divider>\r\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\r\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\r\n      <igo-layer-legend-item\r\n        *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\r\n        igoListItem\r\n        [layer]=\"layer\"\r\n        [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\r\n      >\r\n      </igo-layer-legend-item>\r\n    </ng-template>\r\n  </igo-list>\r\n  <p\r\n    class=\"layers-empty mat-typography\"\r\n    *ngIf=\"\r\n      !showAllLegendsValue &&\r\n      (layersInUi$ | async).length &&\r\n      (hasVisibleOrInRangeLayers$ | async) === false &&\r\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\r\n      allowShowAllLegends\r\n    \"\r\n  >\r\n    {{ 'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate }}\r\n  </p>\r\n  <p\r\n    class=\"layers-empty mat-typography\"\r\n    *ngIf=\"\r\n      !showAllLegendsValue &&\r\n      (layersInUi$ | async).length &&\r\n      (hasVisibleOrInRangeLayers$ | async) === false &&\r\n      (hasVisibleAndNotInRangeLayers$ | async) &&\r\n      allowShowAllLegends\r\n    \"\r\n  >\r\n    {{\r\n      'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate\r\n    }}\r\n  </p>\r\n  <p\r\n    class=\"layers-empty mat-typography\"\r\n    *ngIf=\"\r\n      (layersInUi$ | async).length &&\r\n      (hasVisibleOrInRangeLayers$ | async) === false &&\r\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\r\n      !allowShowAllLegends\r\n    \"\r\n  >\r\n    {{ 'igo.geo.layer.legend.noLayersVisible' | translate }}\r\n  </p>\r\n  <p\r\n    class=\"layers-empty mat-typography\"\r\n    *ngIf=\"\r\n      (layersInUi$ | async).length &&\r\n      (hasVisibleOrInRangeLayers$ | async) === false &&\r\n      (hasVisibleAndNotInRangeLayers$ | async) &&\r\n      !allowShowAllLegends\r\n    \"\r\n  >\r\n    {{ 'igo.geo.layer.legend.noLayersVisibleButZoom' | translate }}\r\n  </p>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy,\r\n  EventEmitter,\r\n  Output\r\n} from '@angular/core';\r\nimport { Layer } from '../shared';\r\nimport {\r\n  BehaviorSubject,\r\n  ReplaySubject,\r\n  Subscription,\r\n  EMPTY,\r\n  timer\r\n} from 'rxjs';\r\nimport { debounce } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend-list',\r\n  templateUrl: './layer-legend-list.component.html',\r\n  styleUrls: ['./layer-legend-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\r\n  orderable = true;\r\n\r\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    true\r\n  );\r\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject(true);\r\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  showAllLegend: boolean = false;\r\n  public change$ = new ReplaySubject<void>(1);\r\n  private change$$: Subscription;\r\n  @Input()\r\n  set layers(value: Layer[]) {\r\n    this._layers = value;\r\n    this.next();\r\n  }\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  private _layers: Layer[];\r\n  @Input() excludeBaseLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() allowShowAllLegends: boolean = false;\r\n\r\n  @Input() showAllLegendsValue: boolean = false;\r\n\r\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\r\n\r\n  constructor() {}\r\n  ngOnInit(): void {\r\n    this.change$$ = this.change$\r\n      .pipe(\r\n        debounce(() => {\r\n          return this.layers.length === 0 ? EMPTY : timer(50);\r\n        })\r\n      )\r\n      .subscribe(() => {\r\n        const layers = this.computeShownLayers(this.layers.slice(0));\r\n        this.layers$.next(layers);\r\n        this.hasVisibleOrInRangeLayers$.next(\r\n          this.layers\r\n            .slice(0)\r\n            .filter((layer) => layer.baseLayer !== true)\r\n            .filter(\r\n              (layer) =>\r\n                layer.visible$.value && layer.isInResolutionsRange$.value\r\n            ).length > 0\r\n        );\r\n        this.hasVisibleAndNotInRangeLayers$.next(\r\n          this.layers\r\n            .slice(0)\r\n            .filter((layer) => layer.baseLayer !== true)\r\n            .filter(\r\n              (layer) =>\r\n                layer.visible$.value && !layer.isInResolutionsRange$.value\r\n            ).length > 0\r\n        );\r\n\r\n        this.layersInUi$.next(\r\n          this.layers\r\n            .slice(0)\r\n            .filter(\r\n              (layer) =>\r\n                layer.showInLayerList !== false &&\r\n                (!this.excludeBaseLayers || !layer.baseLayer)\r\n            )\r\n        );\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n  private computeShownLayers(layers: Layer[]) {\r\n    let shownLayers = layers.filter(\r\n      (layer: Layer) => layer.visible && layer.isInResolutionsRange\r\n    );\r\n    if (this.showAllLegendsValue) {\r\n      shownLayers = layers;\r\n    }\r\n    return this.sortLayersByZindex(shownLayers);\r\n  }\r\n  private sortLayersByZindex(layers: Layer[]) {\r\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\r\n  }\r\n\r\n  toggleShowAllLegends(toggle: boolean) {\r\n    this.showAllLegendsValue = toggle;\r\n    this.next();\r\n    this.allLegendsShown.emit(toggle);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { Layer, TooltipType } from '../shared/layers';\r\nimport { NetworkService, ConnectionState } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend-item',\r\n  templateUrl: './layer-legend-item.component.html',\r\n  styleUrls: ['./layer-legend-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  tooltipText: string;\r\n\r\n  state: ConnectionState;\r\n\r\n  private resolution$$: Subscription;\r\n  private network$$: Subscription;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  constructor(private networkService: NetworkService) {}\r\n\r\n  ngOnInit() {\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.onResolutionChange();\r\n    });\r\n    this.tooltipText = this.computeTooltip();\r\n\r\n    this.network$$ = this.networkService\r\n      .currentState()\r\n      .subscribe((state: ConnectionState) => {\r\n        this.state = state;\r\n        this.onResolutionChange();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n    this.network$$.unsubscribe();\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return this.layer.title;\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  private onResolutionChange() {\r\n    const inResolutionRange = this.layer.isInResolutionsRange;\r\n    this.inResolutionRange$.next(inResolutionRange);\r\n  }\r\n}\r\n","<mat-list-item class=\"igo-layer-list-item\">\r\n  <span\r\n    matListItemTitle\r\n    class=\"igo-layer-title\"\r\n    [matTooltip]=\"tooltipText\"\r\n    matTooltipShowDelay=\"500\"\r\n    >{{ layer.title }}</span\r\n  >\r\n</mat-list-item>\r\n\r\n<div #legend class=\"igo-layer-legend-container\">\r\n  <igo-layer-legend\r\n    [layer]=\"layer\"\r\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\r\n  >\r\n  </igo-layer-legend>\r\n</div>\r\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Output\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoClickout]'\n})\nexport class ClickoutDirective {\n  @Output() clickout = new EventEmitter<MouseEvent>();\n\n  @HostListener('document:click', ['$event', '$event.target'])\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\n    if (!target) {\n      return;\n    }\n\n    if (!this.el.nativeElement.contains(target)) {\n      this.clickout.emit(event);\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n}\n","import {\r\n  Component,\r\n  AfterViewInit,\r\n  OnInit,\r\n  OnDestroy,\r\n  Input,\r\n  ContentChildren,\r\n  HostListener,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport type { QueryList } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { ListItemDirective } from './list-item.directive';\r\n\r\n@Component({\r\n  selector: 'igo-list',\r\n  templateUrl: './list.component.html',\r\n  styleUrls: ['./list.component.scss']\r\n})\r\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\r\n  @Input()\r\n  get navigation() {\r\n    return this._navigation;\r\n  }\r\n  set navigation(value: boolean) {\r\n    this._navigation = value;\r\n  }\r\n  private _navigation = true;\r\n\r\n  @Input()\r\n  get selection() {\r\n    return this._selection;\r\n  }\r\n  set selection(value: boolean) {\r\n    this._selection = value;\r\n  }\r\n  private _selection = true;\r\n\r\n  get selectedItem() {\r\n    return this._selectedItem;\r\n  }\r\n  set selectedItem(value: ListItemDirective) {\r\n    this.focusedItem = value;\r\n    this._selectedItem = value;\r\n  }\r\n  private _selectedItem: ListItemDirective;\r\n\r\n  get focusedItem() {\r\n    return this._focusedItem;\r\n  }\r\n  set focusedItem(value: ListItemDirective) {\r\n    this._focusedItem = value;\r\n  }\r\n  private _focusedItem: ListItemDirective;\r\n\r\n  private navigationEnabled: boolean;\r\n  private listItems$$: Subscription;\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  @ContentChildren(ListItemDirective, { descendants: true })\r\n  listItems: QueryList<ListItemDirective>;\r\n\r\n  @HostListener('document:keydown', ['$event'])\r\n  @HostListener('document:enter', ['$event'])\r\n  handleKeyboardEvent(event: KeyboardEvent) {\r\n    // It would be nice to be able to unsubscribe to the event\r\n    // completely but until ES7 this won't be possible because\r\n    // document events are not observables\r\n    if (this.navigationEnabled) {\r\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\r\n        event.preventDefault();\r\n        this.navigate(event.key);\r\n      } else if (event.key === 'Enter') {\r\n        this.select(this.focusedItem);\r\n      }\r\n    }\r\n  }\r\n\r\n  constructor(private el: ElementRef) {}\r\n\r\n  ngOnInit() {\r\n    this.enableNavigation();\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    if (this.listItems.length) {\r\n      this.init();\r\n    }\r\n\r\n    this.listItems$$ = this.listItems.changes.subscribe(\r\n      (items: ListItemDirective[]) => this.init()\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.listItems$$.unsubscribe();\r\n  }\r\n\r\n  focus(item?: ListItemDirective) {\r\n    if (!this.selection) {\r\n      return;\r\n    }\r\n\r\n    this.unfocus();\r\n\r\n    // We need to make this check because dynamic\r\n    // lists such as in the search results list may fail\r\n    if (item !== undefined) {\r\n      item.focused = true;\r\n    }\r\n  }\r\n\r\n  unfocus() {\r\n    if (this.focusedItem !== undefined) {\r\n      this.focusedItem.focused = false;\r\n    }\r\n\r\n    this.focusedItem = undefined;\r\n  }\r\n\r\n  focusNext() {\r\n    const items = this.listItems.toArray();\r\n    let item;\r\n    const igoList = this.el.nativeElement;\r\n    let disabled = true;\r\n    let index = this.getFocusedIndex();\r\n    if (index === undefined) {\r\n      index = -1;\r\n    }\r\n\r\n    while (disabled && index < items.length - 1) {\r\n      index += 1;\r\n      item = items[index];\r\n      disabled = item.disabled;\r\n    }\r\n\r\n    if (item !== undefined) {\r\n      this.focus(item);\r\n    }\r\n\r\n    if (!items[index + 1]) {\r\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\r\n      return;\r\n    }\r\n\r\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\r\n      igoList.scrollTop =\r\n        item.el.nativeElement.offsetTop +\r\n        item.el.nativeElement.children[0].offsetHeight -\r\n        igoList.clientHeight;\r\n    }\r\n  }\r\n\r\n  focusPrevious() {\r\n    const items = this.listItems.toArray();\r\n    let item: ListItemDirective;\r\n    const igoList = this.el.nativeElement;\r\n    let disabled = true;\r\n    let index = this.getFocusedIndex();\r\n\r\n    while (disabled && index > 0) {\r\n      index -= 1;\r\n      item = items[index];\r\n      disabled = item.disabled;\r\n    }\r\n\r\n    if (item !== undefined) {\r\n      this.focus(item);\r\n    }\r\n\r\n    if (!items[index - 1]) {\r\n      igoList.scrollTop = 0;\r\n      return;\r\n    }\r\n\r\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\r\n      const padding = 3;\r\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\r\n    }\r\n  }\r\n\r\n  select(item?: ListItemDirective) {\r\n    if (!this.selection) {\r\n      return;\r\n    }\r\n\r\n    this.unselect();\r\n\r\n    if (item !== undefined) {\r\n      item.selected = true;\r\n    }\r\n  }\r\n\r\n  unselect() {\r\n    this.unfocus();\r\n\r\n    if (this.selectedItem !== undefined) {\r\n      this.selectedItem.selected = false;\r\n    }\r\n\r\n    this.selectedItem = undefined;\r\n  }\r\n\r\n  enableNavigation() {\r\n    if (this.navigation) {\r\n      this.navigationEnabled = true;\r\n    }\r\n  }\r\n\r\n  disableNavigation() {\r\n    this.navigationEnabled = false;\r\n  }\r\n\r\n  scrollToItem(item: ListItemDirective) {\r\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\r\n  }\r\n\r\n  isScrolledIntoView(elem) {\r\n    const docViewTop =\r\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\r\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\r\n\r\n    const elemTop = elem.offsetTop;\r\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\r\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\r\n  }\r\n\r\n  private init() {\r\n    this.subscribe();\r\n\r\n    this.selectedItem = this.findSelectedItem();\r\n    this.focusedItem = this.findFocusedItem();\r\n\r\n    this.enableNavigation();\r\n  }\r\n\r\n  private subscribe() {\r\n    this.unsubscribe();\r\n\r\n    this.listItems.toArray().forEach((item) => {\r\n      this.subscriptions.push(\r\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemBeforeSelect(item2)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        item.select.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemSelect(item2)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemBeforeFocus(item2)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        item.focus.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemFocus(item2)\r\n        )\r\n      );\r\n    }, this);\r\n  }\r\n\r\n  private unsubscribe() {\r\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\r\n    this.subscriptions = [];\r\n  }\r\n\r\n  private handleItemBeforeFocus(item: ListItemDirective) {\r\n    if (item !== this.focusedItem) {\r\n      this.unfocus();\r\n    }\r\n  }\r\n\r\n  private handleItemFocus(item: ListItemDirective) {\r\n    this.focusedItem = item;\r\n  }\r\n\r\n  private handleItemBeforeSelect(item: ListItemDirective) {\r\n    if (item !== this.focusedItem) {\r\n      this.unselect();\r\n    }\r\n  }\r\n\r\n  private handleItemSelect(item: ListItemDirective) {\r\n    this.selectedItem = item;\r\n  }\r\n\r\n  private findSelectedItem() {\r\n    return this.listItems.toArray().find((item) => item.selected);\r\n  }\r\n\r\n  private findFocusedItem() {\r\n    return this.listItems.toArray().find((item) => item.focused);\r\n  }\r\n\r\n  private getFocusedIndex() {\r\n    return this.listItems\r\n      .toArray()\r\n      .findIndex((item) => item === this.focusedItem);\r\n  }\r\n\r\n  private navigate(key: string) {\r\n    switch (key) {\r\n      case 'ArrowUp':\r\n        this.focusPrevious();\r\n        break;\r\n      case 'ArrowDown':\r\n        this.focusNext();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n}\r\n","<mat-list\r\n  igoClickout\r\n  [ngClass]=\"{ selectable: selection }\"\r\n  (clickout)=\"disableNavigation()\"\r\n  (click)=\"enableNavigation()\"\r\n>\r\n  <ng-content></ng-content>\r\n</mat-list>\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatSliderModule } from '@angular/material/slider';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoListModule,\r\n  IgoCollapsibleModule,\r\n  IgoImageModule,\r\n  IgoPanelModule,\r\n  IgoMatBadgeIconModule,\r\n  IgoCustomHtmlModule\r\n} from '@igo2/common';\r\n\r\nimport { LayerService } from './shared/layer.service';\r\nimport { StyleService } from '../style/style-service/style.service';\r\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\r\nimport { LayerItemComponent } from './layer-item/layer-item.component';\r\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\r\nimport { LayerListComponent } from './layer-list/layer-list.component';\r\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\r\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\r\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\r\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\r\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\r\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    MatInputModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    CommonModule,\r\n    FormsModule,\r\n    MatDividerModule,\r\n    MatMenuModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSlideToggleModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    MatListModule,\r\n    MatSliderModule,\r\n    MatBadgeModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule,\r\n    IgoImageModule,\r\n    IgoPanelModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoCustomHtmlModule\r\n  ],\r\n  exports: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ],\r\n  declarations: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ]\r\n})\r\nexport class IgoLayerModule {\r\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\r\n    return {\r\n      ngModule: IgoLayerModule,\r\n      providers: [LayerService, StyleService, LayerListToolService]\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoMatBadgeIconModule,\r\n  IgoCollapsibleModule,\r\n  IgoListModule\r\n} from '@igo2/common';\r\n\r\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\r\nimport { CatalogBrowserComponent } from './catalog-browser.component';\r\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\r\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\r\nimport { IgoLayerModule } from '../../layer/layer.module';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule,\r\n    IgoMetadataModule,\r\n    IgoLayerModule\r\n  ],\r\n  exports: [CatalogBrowserComponent],\r\n  declarations: [\r\n    CatalogBrowserComponent,\r\n    CatalogBrowserGroupComponent,\r\n    CatalogBrowserLayerComponent\r\n  ]\r\n})\r\nexport class IgoCatalogBrowserModule {}\r\n","<h1 mat-dialog-title class=\"mat-typography\">\r\n  {{ 'igo.geo.catalog.library.addTitle' | translate }}\r\n</h1>\r\n<div mat-dialog-content class=\"mat-typography\">\r\n  <form class=\"igo-form\" [formGroup]=\"form\">\r\n    <div class=\"igo-input-container\">\r\n      <mat-form-field>\r\n        <input\r\n          type=\"text\"\r\n          formControlName=\"title\"\r\n          placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\r\n          matInput\r\n          [matAutocomplete]=\"auto2\"\r\n        />\r\n        <mat-autocomplete\r\n          #auto2=\"matAutocomplete\"\r\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\r\n        >\r\n          <mat-option\r\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\r\n            matTooltipShowDelay=\"500\"\r\n            [matTooltip]=\"predefinedCatalog.title\"\r\n            [value]=\"predefinedCatalog\"\r\n          >\r\n            {{ predefinedCatalog.title }}\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n      </mat-form-field>\r\n    </div>\r\n    <div class=\"igo-input-container\">\r\n      <mat-form-field>\r\n        <input\r\n          type=\"text\"\r\n          formControlName=\"url\"\r\n          placeholder=\"URL\"\r\n          matInput\r\n          [matAutocomplete]=\"auto\"\r\n        />\r\n        <mat-autocomplete\r\n          #auto=\"matAutocomplete\"\r\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\r\n        >\r\n          <mat-option\r\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\r\n            matTooltipShowDelay=\"500\"\r\n            [matTooltip]=\"predefinedCatalog.url\"\r\n            [value]=\"predefinedCatalog\"\r\n          >\r\n            {{ predefinedCatalog.url }}\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n      </mat-form-field>\r\n    </div>\r\n    <div class=\"igo-input-container\">\r\n      <mat-form-field>\r\n        <mat-select formControlName=\"type\" placeholder=\"Type\">\r\n          <mat-option\r\n            *ngFor=\"let type of typeCapabilities\"\r\n            [value]=\"type\"\r\n            (click)=\"$event.stopPropagation()\"\r\n          >\r\n            <p matListItemTitle>{{ type }}</p>\r\n          </mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </form>\r\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\r\n    <p class=\"error\">\r\n      {{\r\n        languageService.translate.instant(\r\n          'igo.geo.catalog.externalProvider.unavailableWithEmail',\r\n          { value: addedCatalog.url, email: emailAddress }\r\n        )\r\n      }}\r\n    </p>\r\n  </span>\r\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\r\n    <p class=\"error\">\r\n      {{\r\n        languageService.translate.instant('igo.geo.catalog.unavailable', {\r\n          value: addedCatalog.url\r\n        })\r\n      }}\r\n    </p>\r\n  </span>\r\n</div>\r\n<div mat-dialog-actions style=\"justify-content: center\">\r\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\r\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\r\n      {{ 'igo.geo.catalog.library.cancel' | translate }}\r\n    </button>\r\n    <button\r\n      id=\"addCatalogBtnDialog\"\r\n      mat-raised-button\r\n      type=\"button\"\r\n      color=\"primary\"\r\n      [disabled]=\"!form.valid\"\r\n      (click)=\"addCatalog(form.value)\"\r\n    >\r\n      {{ 'igo.geo.catalog.library.add' | translate }}\r\n    </button>\r\n  </div>\r\n</div>\r\n","import { LanguageService, ConfigService } from '@igo2/core';\r\nimport { Component, OnInit, OnDestroy, Optional, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { TypeCapabilities } from '../../datasource';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\n\r\n@Component({\r\n  selector: 'igo-add-catalog-dialog',\r\n  templateUrl: './add-catalog-dialog.component.html',\r\n  styleUrls: ['./add-catalog-dialog.component.scss']\r\n})\r\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\r\n  public form: UntypedFormGroup;\r\n  private defaultAddedCatalogType = 'wms';\r\n  private addedCatalogType$$: Subscription;\r\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\r\n  typeCapabilities: string[];\r\n  predefinedCatalogs: Catalog[] = [];\r\n  store: EntityStore<Catalog>;\r\n  error = false;\r\n  addedCatalog: Catalog;\r\n  emailAddress: string;\r\n  private storeViewAll$$: Subscription;\r\n\r\n  constructor(\r\n    private formBuilder: UntypedFormBuilder,\r\n    public languageService: LanguageService,\r\n    private configService: ConfigService,\r\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\r\n    @Optional()\r\n    @Inject(MAT_DIALOG_DATA)\r\n    public data: {\r\n      predefinedCatalogs: Catalog[];\r\n      store: EntityStore<Catalog>;\r\n      error: boolean;\r\n      addedCatalog: Catalog;\r\n    }\r\n  ) {\r\n    this.store = data.store;\r\n    this.predefinedCatalogs = data.predefinedCatalogs;\r\n    this.error = data.error;\r\n    this.addedCatalog = data.addedCatalog;\r\n    this.form = this.formBuilder.group({\r\n      id: ['', []],\r\n      title: ['', []],\r\n      url: ['', [Validators.required]],\r\n      type: [this.defaultAddedCatalogType, [Validators.required]]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.store.state.clear();\r\n    this.typeCapabilities = Object.keys(TypeCapabilities);\r\n\r\n    this.addedCatalogType$$ = this.form\r\n      .get('type')\r\n      .valueChanges.subscribe((value) => {\r\n        if (value === 'wmts') {\r\n          this.form.get('title').setValidators(Validators.required);\r\n        } else {\r\n          this.form.get('title').setValidators([]);\r\n        }\r\n        this.form.get('title').updateValueAndValidity();\r\n      });\r\n\r\n    this.computePredefinedCatalogList();\r\n    this.storeViewAll$$ = this.store.view\r\n      .all$()\r\n      .subscribe(() => this.computePredefinedCatalogList());\r\n\r\n    this.emailAddress = this.configService.getConfig('emailAddress');\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.addedCatalogType$$.unsubscribe();\r\n    this.storeViewAll$$.unsubscribe();\r\n  }\r\n\r\n  changeUrlOrTitle(catalog: Catalog) {\r\n    this.form.patchValue(catalog);\r\n    this.error = false;\r\n    this.computePredefinedCatalogList();\r\n  }\r\n\r\n  computePredefinedCatalogList() {\r\n    this.predefinedCatalogsList$.next(\r\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\r\n    );\r\n  }\r\n\r\n  addCatalog(addedCatalog: Catalog) {\r\n    this.error = false;\r\n    this.dialogRef.close(addedCatalog);\r\n  }\r\n\r\n  cancel() {\r\n    this.error = false;\r\n    this.dialogRef.close();\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\">\r\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\r\n    <igo-catalog-library-item\r\n      igoListItem\r\n      color=\"accent\"\r\n      [map]=\"map\"\r\n      [catalog]=\"catalog\"\r\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\r\n      (select)=\"onCatalogSelect(catalog)\"\r\n    >\r\n    </igo-catalog-library-item>\r\n  </ng-template>\r\n</igo-list>\r\n\r\n<div *ngIf=\"addCatalogAllowed\" class=\"btnAddCatalog\">\r\n  <button\r\n    mat-raised-button\r\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\r\n    matTooltipPosition=\"above\"\r\n    color=\"primary\"\r\n    (click)=\"addCatalogDialog()\"\r\n  >\r\n    {{ 'igo.geo.catalog.library.addBtn' | translate }}\r\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\r\n  </button>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { MessageService, StorageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { Observable, Subscription } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\nimport { Md5 } from 'ts-md5';\r\nimport { CapabilitiesService } from '../../datasource';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { standardizeUrl } from '../../utils/id-generator';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\r\n\r\n/**\r\n * Component to browse a list of available catalogs\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-library',\r\n  templateUrl: './catalog-library.component.html',\r\n  styleUrls: ['./catalog-library.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Store holding the catalogs\r\n   */\r\n  @Input() store: EntityStore<Catalog>;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Determine if the form to add a catalog is allowed\r\n   */\r\n  @Input() addCatalogAllowed: boolean = false;\r\n\r\n  /**\r\n   * Determine if the form to add a catalog is allowed\r\n   */\r\n  @Input() predefinedCatalogs: Catalog[] = [];\r\n\r\n  /**\r\n   * Event emitted a catalog is selected or unselected\r\n   */\r\n  @Output() catalogSelectChange = new EventEmitter<{\r\n    selected: boolean;\r\n    catalog: Catalog;\r\n  }>();\r\n\r\n  submitDisabled = true;\r\n  private addingCatalog$$: Subscription;\r\n\r\n  get addedCatalogs(): Catalog[] {\r\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\r\n  }\r\n  set addedCatalogs(catalogs: Catalog[]) {\r\n    this.storageService.set('addedCatalogs', catalogs);\r\n  }\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    private messageService: MessageService,\r\n    private storageService: StorageService,\r\n    private dialog: MatDialog\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.store.state.clear();\r\n\r\n    this.predefinedCatalogs = this.predefinedCatalogs.map((c) => {\r\n      c.id = Md5.hashStr((c.type || 'wms') + standardizeUrl(c.url)) as string;\r\n      c.title = c.title === '' || !c.title ? c.url : c.title;\r\n      return c;\r\n    });\r\n  }\r\n\r\n  getCatalogs(): Observable<Catalog[]> {\r\n    return this.store.view.all$();\r\n  }\r\n\r\n  /**\r\n   * When a catalog is selected, update it's state in the store\r\n   * and emit the catalog select change event\r\n   * @internal\r\n   */\r\n  onCatalogSelect(catalog: Catalog) {\r\n    this.store.state.update(\r\n      catalog,\r\n      {\r\n        selected: true,\r\n        focused: true\r\n      },\r\n      true\r\n    );\r\n    this.catalogSelectChange.emit({ selected: true, catalog });\r\n  }\r\n\r\n  private unsubscribeAddingCatalog() {\r\n    if (this.addingCatalog$$) {\r\n      this.addingCatalog$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  addCatalog(addedCatalog: Catalog) {\r\n    if (!addedCatalog) {\r\n      return;\r\n    }\r\n    let id = Md5.hashStr(\r\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\r\n    ) as string;\r\n    const predefinedCatalog = this.predefinedCatalogs.find(\r\n      (c) => c.id === addedCatalog.id\r\n    );\r\n\r\n    if (predefinedCatalog) {\r\n      addedCatalog.version = predefinedCatalog.version;\r\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\r\n      id = predefinedCatalog.id;\r\n    }\r\n\r\n    if (this.store.get(id)) {\r\n      this.messageService.alert(\r\n        'igo.geo.catalog.library.inlist.message',\r\n        'igo.geo.catalog.library.inlist.title'\r\n      );\r\n      return;\r\n    }\r\n    this.unsubscribeAddingCatalog();\r\n\r\n    this.addingCatalog$$ = this.capabilitiesService\r\n      .getCapabilities(\r\n        addedCatalog.type as any,\r\n        addedCatalog.url,\r\n        addedCatalog.version\r\n      )\r\n      .pipe(\r\n        catchError((e) => {\r\n          if (e.error) {\r\n            this.addCatalogDialog(true, addedCatalog);\r\n            e.error.caught = true;\r\n            return e;\r\n          }\r\n          this.messageService.error(\r\n            'igo.geo.catalog.unavailable',\r\n            'igo.geo.catalog.unavailableTitle',\r\n            undefined,\r\n            { value: addedCatalog.url }\r\n          );\r\n          throw e;\r\n        })\r\n      )\r\n      .subscribe((capabilities) => {\r\n        let title;\r\n        let version;\r\n        switch (addedCatalog.type) {\r\n          case 'wms':\r\n            title = addedCatalog.title || capabilities.Service.Title;\r\n            version = addedCatalog.version || capabilities.version;\r\n            break;\r\n          case 'arcgisrest':\r\n          case 'imagearcgisrest':\r\n          case 'tilearcgisrest':\r\n            title = addedCatalog.title || capabilities.mapName;\r\n            break;\r\n          case 'wmts':\r\n            title =\r\n              addedCatalog.title ||\r\n              capabilities.ServiceIdentification.ServiceType;\r\n            break;\r\n          default:\r\n            title = addedCatalog.title;\r\n        }\r\n\r\n        const catalogToAdd = ObjectUtils.removeUndefined(\r\n          Object.assign(\r\n            {},\r\n            predefinedCatalog,\r\n            ObjectUtils.removeUndefined({\r\n              id,\r\n              title,\r\n              url: addedCatalog.url,\r\n              type: addedCatalog.type || 'wms',\r\n              externalProvider: addedCatalog.externalProvider || false,\r\n              removable: true,\r\n              version\r\n            })\r\n          ) as Catalog\r\n        );\r\n        this.store.insert(catalogToAdd);\r\n        const newCatalogs = this.addedCatalogs.slice(0);\r\n        newCatalogs.push(catalogToAdd);\r\n        this.addedCatalogs = newCatalogs;\r\n        this.unsubscribeAddingCatalog();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribeAddingCatalog();\r\n  }\r\n\r\n  onCatalogRemove(catalog) {\r\n    this.store.delete(catalog);\r\n    this.addedCatalogs = this.addedCatalogs\r\n      .slice(0)\r\n      .filter((c) => c.id !== catalog.id);\r\n  }\r\n\r\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\r\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\r\n      width: '700px',\r\n      data: {\r\n        predefinedCatalogs: this.predefinedCatalogs,\r\n        store: this.store,\r\n        error,\r\n        addedCatalog\r\n      }\r\n    });\r\n\r\n    dialogRef.afterClosed().subscribe((catalog) => {\r\n      this.addCatalog(catalog);\r\n    });\r\n  }\r\n}\r\n","<mat-list-item>\n  <span matListItemTitle>\n    {{ title }}\n  </span>\n  <div matListItemMeta>\n    <mat-icon\n      *ngIf=\"catalog.externalProvider\"\n      matListItemIcon\n      class=\"igo-external-provider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\"\n    >\n    </mat-icon>\n    <button\n      *ngIf=\"catalog.removable\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n      color=\"warn\"\n      (click)=\"removeCatalogFromLibrary($event)\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"igo-blank\"\n      *ngIf=\"!catalog.removable\"\n      disabled=\"true\"\n      mat-icon-button\n    >\n      <mat-icon svgIcon=\"blank\"></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\n\r\nimport { getEntityTitle } from '@igo2/common';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\n\r\n/**\r\n * Catalog library item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-library-item',\r\n  templateUrl: './catalog-library-item.component.html',\r\n  styleUrls: ['./catalog-library-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibaryItemComponent {\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  @Output() catalogRemove = new EventEmitter();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.catalog);\r\n  }\r\n\r\n  removeCatalogFromLibrary(event) {\r\n    event.stopPropagation();\r\n    this.catalogRemove.emit();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoListModule } from '@igo2/common';\r\n\r\nimport { CatalogLibaryComponent } from './catalog-library.component';\r\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\r\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\r\n\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatBadgeModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoListModule,\r\n    IgoLanguageModule,\r\n    MatButtonModule,\r\n    MatFormFieldModule,\r\n    ReactiveFormsModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatAutocompleteModule,\r\n    MatDialogModule\r\n  ],\r\n  exports: [CatalogLibaryComponent, AddCatalogDialogComponent],\r\n  declarations: [\r\n    CatalogLibaryComponent,\r\n    CatalogLibaryItemComponent,\r\n    AddCatalogDialogComponent\r\n  ]\r\n})\r\nexport class IgoCatalogLibraryModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport {\r\n  IgoListModule,\r\n  IgoCollapsibleModule,\r\n  IgoMatBadgeIconModule\r\n} from '@igo2/common';\r\n\r\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\r\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule\r\n  ],\r\n  exports: [IgoCatalogBrowserModule, IgoCatalogLibraryModule],\r\n  declarations: []\r\n})\r\nexport class IgoCatalogModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { DownloadButtonComponent } from './download-button/download-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  exports: [DownloadButtonComponent],\n  declarations: [DownloadButtonComponent]\n})\nexport class IgoDownloadModule {\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\n    return {\n      ngModule: IgoDownloadModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoEntityTableModule } from '@igo2/common';\r\nimport { DrawComponent } from './draw.component';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { DrawPopupComponent } from './draw-popup.component';\r\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\r\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\r\n\r\nimport { BrowserModule } from '@angular/platform-browser';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\n\r\nimport { MatRadioModule } from '@angular/material/radio';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatDividerModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatBadgeModule,\r\n    MatTooltipModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatListModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    MatDialogModule,\r\n    IgoLanguageModule,\r\n    IgoEntityTableModule,\r\n    BrowserModule,\r\n    BrowserAnimationsModule,\r\n    MatRadioModule,\r\n    MatCheckboxModule\r\n  ],\r\n  declarations: [\r\n    DrawComponent,\r\n    DrawPopupComponent,\r\n    DrawLayerPopupComponent,\r\n    DrawShorcutsComponent\r\n  ],\r\n  exports: [DrawComponent]\r\n})\r\nexport class IgoDrawModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoKeyValueModule, IgoImageModule } from '@igo2/common';\r\n\r\nimport { FeatureDetailsComponent } from './feature-details.component';\r\nimport { FeatureDetailsDirective } from './feature-details.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    IgoLanguageModule,\r\n    IgoKeyValueModule,\r\n    IgoImageModule\r\n  ],\r\n  exports: [FeatureDetailsComponent, FeatureDetailsDirective],\r\n  declarations: [FeatureDetailsComponent, FeatureDetailsDirective]\r\n})\r\nexport class IgoFeatureDetailsModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoFormModule } from '@igo2/common';\r\n\r\nimport { FeatureFormComponent } from './feature-form.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoFormModule],\r\n  exports: [IgoFormModule, FeatureFormComponent],\r\n  declarations: [FeatureFormComponent]\r\n})\r\nexport class IgoFeatureFormModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\r\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [IgoFeatureDetailsModule, IgoFeatureFormModule],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoFeatureModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\r\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [GeometryFormFieldComponent, GeometryFormFieldInputComponent],\r\n  declarations: [GeometryFormFieldComponent, GeometryFormFieldInputComponent]\r\n})\r\nexport class IgoGeometryFormFieldModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, IgoGeometryFormFieldModule],\r\n  exports: [IgoGeometryFormFieldModule],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoGeometryModule {}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\r\nimport { TimeFilterableDataSource } from '../../datasource';\r\n\r\n@Pipe({\r\n  name: 'filterableDataSource'\r\n})\r\nexport class FilterableDataSourcePipe implements PipeTransform {\r\n  transform(value: Layer[], arg: string): Layer[] {\r\n    let layers;\r\n\r\n    if (arg === 'time') {\r\n      layers = value.filter((layer: Layer) => {\r\n        const datasource = layer.dataSource as TimeFilterableDataSource;\r\n        return (\r\n          this.isTimeFilterable(datasource) &&\r\n          datasource.options.timeFilter !== undefined &&\r\n          Object.keys(datasource.options.timeFilter).length\r\n        );\r\n      });\r\n    }\r\n    if (arg === 'ogc') {\r\n      layers = value.filter((layer: Layer) => {\r\n        const datasource = layer.dataSource as OgcFilterableDataSource;\r\n        return this.isOgcFilterable(datasource);\r\n      });\r\n    }\r\n    return layers;\r\n  }\r\n\r\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\r\n    if (dataSource.options.type !== 'wms') {\r\n      return false;\r\n    }\r\n    return dataSource.options.timeFilterable;\r\n  }\r\n\r\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\r\n    let isOgcFilterable = false;\r\n    if (\r\n      dataSource.options.ogcFilters &&\r\n      dataSource.options.ogcFilters.enabled &&\r\n      dataSource.options.ogcFilters.editable\r\n    ) {\r\n      isOgcFilterable = true;\r\n    }\r\n    if (\r\n      dataSource.options.ogcFilters &&\r\n      dataSource.options.ogcFilters.enabled &&\r\n      (dataSource.options.ogcFilters.pushButtons ||\r\n        dataSource.options.ogcFilters.checkboxes ||\r\n        dataSource.options.ogcFilters.radioButtons ||\r\n        dataSource.options.ogcFilters.select ||\r\n        dataSource.options.ogcFilters.autocomplete)\r\n    ) {\r\n      isOgcFilterable = true;\r\n    }\r\n    return isOgcFilterable;\r\n  }\r\n}\r\n","<button\r\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\r\n  [color]=\"color\"\r\n>\r\n  <mat-icon\r\n    aria-hidden=\"false\"\r\n    [matBadge]=\"badge\"\r\n    matBadgeColor=\"warn\"\r\n    matBadgeSize=\"medium\"\r\n    svgIcon=\"history\"\r\n  ></mat-icon>\r\n</button>\r\n\r\n<div\r\n  #ogcFilter\r\n  class=\"igo-layer-actions-container\"\r\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\r\n>\r\n  <igo-time-filter-item\r\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\r\n    igoListItem\r\n    [header]=\"false\"\r\n    [layer]=\"layer\"\r\n  >\r\n  </igo-time-filter-item>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\r\nimport { TimeFilterableDataSourceOptions } from '../../datasource';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-button',\r\n  templateUrl: './time-filter-button.component.html',\r\n  styleUrls: ['./time-filter-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TimeFilterButtonComponent implements OnInit {\r\n  public options: TimeFilterableDataSourceOptions;\r\n\r\n  get badge() {\r\n    const filter = this.options.timeFilter as any;\r\n    if (filter && filter.enabled) {\r\n      return 1;\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    if (value) {\r\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\r\n    }\r\n  }\r\n  private _layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  public timeFilterCollapse = false;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\r\n  }\r\n}\r\n","<div *ngIf=\"style === 'calendar' && type !== 'year'\">\r\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\r\n    <mat-form-field>\r\n      <mat-datetimepicker-toggle\r\n        class=\"time-filter-mat-datetimepicker-toggle\"\r\n        [for]=\"datetimePicker\"\r\n        matSuffix\r\n      ></mat-datetimepicker-toggle>\r\n      <mat-datetimepicker\r\n        #datetimePicker\r\n        type=\"{{ type }}\"\r\n        openOnFocus=\"true\"\r\n        timeInterval=\"5\"\r\n      ></mat-datetimepicker>\r\n      <input\r\n        matInput\r\n        autocomplete=\"false\"\r\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\r\n        [matDatetimepicker]=\"datetimePicker\"\r\n        [(ngModel)]=\"date\"\r\n        [min]=\"min\"\r\n        [max]=\"max\"\r\n        readonly=\"readonly\"\r\n        (dateChange)=\"handleDateChange($event)\"\r\n      />\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div *ngIf=\"isRange\">\r\n    <div class=\"igo-col igo-col-100\">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle\r\n          class=\"time-filter-mat-datetimepicker-toggle\"\r\n          [for]=\"minDatetimePicker\"\r\n          matSuffix\r\n        ></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker\r\n          #minDatetimePicker\r\n          type=\"{{ type }}\"\r\n          openOnFocus=\"true\"\r\n          timeInterval=\"5\"\r\n        ></mat-datetimepicker>\r\n        <input\r\n          matInput\r\n          autocomplete=\"false\"\r\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\r\n          [matDatetimepicker]=\"minDatetimePicker\"\r\n          [(ngModel)]=\"startDate\"\r\n          [min]=\"min\"\r\n          [max]=\"getRangeMaxDate()\"\r\n          readonly=\"readonly\"\r\n          (input)=\"(startDate)\"\r\n          (dateChange)=\"handleDateChange($event)\"\r\n        />\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class=\"igo-col igo-col-100\">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle\r\n          class=\"time-filter-mat-datetimepicker-toggle\"\r\n          [for]=\"maxDatetimePicker\"\r\n          matSuffix\r\n        ></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker\r\n          #maxDatetimePicker\r\n          type=\"{{ type }}\"\r\n          openOnFocus=\"true\"\r\n          timeInterval=\"5\"\r\n        ></mat-datetimepicker>\r\n        <input\r\n          matInput\r\n          autocomplete=\"false\"\r\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\r\n          [matDatetimepicker]=\"maxDatetimePicker\"\r\n          [(ngModel)]=\"endDate\"\r\n          [min]=\"getRangeMinDate()\"\r\n          [max]=\"max\"\r\n          readonly=\"readonly\"\r\n          (dateChange)=\"handleDateChange($event)\"\r\n        />\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div *ngIf=\"style === 'calendar' && type === 'year'\">\r\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\r\n    <mat-form-field>\r\n      <mat-select\r\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\r\n        [(ngModel)]=\"year\"\r\n        (selectionChange)=\"handleYearChange($event)\"\r\n      >\r\n        <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{\r\n          year\r\n        }}</mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div *ngIf=\"isRange\">\r\n    <div class=\"igo-col igo-col-100\">\r\n      <mat-form-field>\r\n        <mat-select\r\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\r\n          [(ngModel)]=\"startYear\"\r\n          (selectionChange)=\"handleYearChange($event)\"\r\n        >\r\n          <mat-option\r\n            [value]=\"startYear\"\r\n            *ngFor=\"let startYear of startListYears\"\r\n            >{{ startYear }}</mat-option\r\n          >\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class=\"igo-col igo-col-100\">\r\n      <mat-form-field>\r\n        <mat-select\r\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\r\n          [(ngModel)]=\"endYear\"\r\n          (selectionChange)=\"handleYearChange($event)\"\r\n        >\r\n          <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{\r\n            endYear\r\n          }}</mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<br />\r\n<div\r\n  *ngIf=\"!isRange && style === 'slider' && type === 'year'\"\r\n  class=\"igo-col igo-col-100 igo-col-100-m mat-typography\"\r\n>\r\n  <span>{{ startYear }}</span>\r\n  <!-- TODO: The 'tickInterval' property no longer exists -->\r\n  <mat-slider\r\n    id=\"time-slider\"\r\n    step=\"{{ step }}\"\r\n    [min]=\"startYear\"\r\n    [max]=\"endYear\"\r\n    [color]=\"color\"\r\n    thumbLabel\r\n    [disabled]=\"!options.enabled || !layer.visible\"\r\n    #ngSlider\r\n    ><input\r\n      matSliderThumb\r\n      [value]=\"handleSliderValue()\"\r\n      (input)=\"\r\n        handleSliderYearChange({\r\n          source: ngSliderThumb,\r\n          parent: ngSlider,\r\n          value: ngSliderThumb.value\r\n        })\r\n      \"\r\n      #ngSliderThumb=\"matSliderThumb\"\r\n      (change)=\"\r\n        handleSliderYearChange({\r\n          source: ngSliderThumb,\r\n          parent: ngSlider,\r\n          value: ngSliderThumb.value\r\n        })\r\n      \"\r\n    />\r\n  </mat-slider>\r\n  <span>{{ endYear }}</span>\r\n  <p *ngIf=\"options.enabled\" class=\"date-below\">{{ year }}</p>\r\n  <div #actions class=\"igo-layer-actions-container\">\r\n    <mat-slide-toggle\r\n      (change)=\"toggleFilterState()\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\r\n      [color]=\"color\"\r\n      [checked]=\"options.enabled\"\r\n      [disabled]=\"!layer.visible\"\r\n    >\r\n    </mat-slide-toggle>\r\n    <button\r\n      [disabled]=\"!options.enabled || !layer.visible\"\r\n      mat-icon-button\r\n      color=\"primary\"\r\n      (click)=\"playYear($event)\"\r\n    >\r\n      <mat-icon svgIcon=\"{{ playIcon }}\"></mat-icon>\r\n    </button>\r\n    <button\r\n      [disabled]=\"!options.enabled || !layer.visible\"\r\n      mat-icon-button\r\n      color=\"primary\"\r\n      (click)=\"resetFilter($event)\"\r\n    >\r\n      <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n<div\r\n  *ngIf=\"style === 'slider' && type !== 'year'\"\r\n  class=\"igo-col igo-col-100 igo-col-100-m\"\r\n>\r\n  <!-- TODO: The 'tickInterval' property no longer exists -->\r\n  <mat-slider\r\n    id=\"time-slider\"\r\n    step=\"{{ step }}\"\r\n    [min]=\"dateToNumber(min)\"\r\n    [max]=\"dateToNumber(max)\"\r\n    thumbLabel\r\n    (selectionChange)=\"handleSliderDateChange($event)\"\r\n    #ngSlider\r\n    ><input\r\n      matSliderThumb\r\n      [value]=\"handleSliderValue()\"\r\n      (input)=\"\r\n        handleSliderDateChange({\r\n          source: ngSliderThumb,\r\n          parent: ngSlider,\r\n          value: ngSliderThumb.value\r\n        })\r\n      \"\r\n      #ngSliderThumb=\"matSliderThumb\"\r\n    />\r\n  </mat-slider>\r\n  <p class=\"date-below\">{{ handleSliderTooltip() }}</p>\r\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\r\n    <mat-icon svgIcon=\"{{ playIcon }}\"></mat-icon>\r\n  </button>\r\n</div>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { DateAdapter } from '@angular/material/core';\r\nimport { MatSlider } from '@angular/material/slider';\r\nimport { default as moment } from 'moment';\r\nimport olSourceImageWMS from 'ol/source/ImageWMS';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\r\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-form',\r\n  templateUrl: './time-filter-form.component.html',\r\n  styleUrls: ['./time-filter-form.component.scss']\r\n})\r\nexport class TimeFilterFormComponent implements OnInit {\r\n  @Input() layer: Layer;\r\n\r\n  @Input() options: TimeFilterOptions;\r\n\r\n  public color = 'primary';\r\n  public date: Date;\r\n  public startDate: Date;\r\n  public endDate: Date;\r\n  public year: any;\r\n  public startYear: any;\r\n  public endYear: any;\r\n  public initStartYear: any;\r\n  public initEndYear: any;\r\n  public listYears: Array<string> = [];\r\n  public startListYears: Array<string> = [];\r\n  public endListYears: Array<string> = [];\r\n\r\n  @Input()\r\n  set currentValue(value: string) {\r\n    if (value) {\r\n      if (this.type !== TimeFilterType.YEAR) {\r\n        const valueArray = value.split('/');\r\n        if (valueArray.length > 0) {\r\n          const startDate = new Date(valueArray[0]);\r\n          const endDate = new Date(valueArray[1]);\r\n          if (!isNaN(startDate.valueOf())) {\r\n            this.startDate = startDate;\r\n          }\r\n          if (!isNaN(endDate.valueOf())) {\r\n            this.endDate = endDate;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public interval: any;\r\n  public playIcon = 'play-circle';\r\n  public resetIcon = 'replay';\r\n\r\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\r\n  @Output()\r\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\r\n  @ViewChild(MatSlider) mySlider;\r\n\r\n  get type(): TimeFilterType {\r\n    return this.options.type === undefined\r\n      ? TimeFilterType.DATE\r\n      : this.options.type;\r\n  }\r\n\r\n  get isRange(): boolean {\r\n    return this.options.range === undefined ||\r\n      this.options.style === TimeFilterStyle.SLIDER\r\n      ? false\r\n      : this.options.range;\r\n  }\r\n\r\n  get style(): TimeFilterStyle {\r\n    return this.options.style === undefined\r\n      ? TimeFilterStyle.SLIDER\r\n      : this.options.style;\r\n  }\r\n\r\n  get step(): number {\r\n    let step = 10800000;\r\n    if (this.options.step === undefined) {\r\n      switch (this.type) {\r\n        case TimeFilterType.DATE:\r\n        case TimeFilterType.DATETIME:\r\n          step = 10800000;\r\n          break;\r\n        case TimeFilterType.TIME:\r\n          step = 3600000;\r\n          break;\r\n        case TimeFilterType.YEAR:\r\n          step = 31536000000;\r\n          break;\r\n        default:\r\n          step = 10800000;\r\n      }\r\n    } else {\r\n      step = this.getStepDefinition(this.options.step);\r\n    }\r\n\r\n    return step;\r\n  }\r\n\r\n  get timeInterval(): number {\r\n    return this.options.timeInterval === undefined\r\n      ? 2000\r\n      : this.options.timeInterval;\r\n  }\r\n\r\n  get min(): Date {\r\n    if (this.options.min) {\r\n      const min = new Date(this.options.min);\r\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get max(): Date {\r\n    if (this.options.max) {\r\n      const max = new Date(this.options.max);\r\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get is(): boolean {\r\n    return this.options.range === undefined ? false : this.options.range;\r\n  }\r\n\r\n  constructor(private dateAdapter: DateAdapter<Date>) {\r\n    this.dateAdapter.setLocale('fr');\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.startDate === undefined) {\r\n      this.startDate = new Date(this.min);\r\n    }\r\n    if (this.endDate === undefined) {\r\n      this.endDate = new Date(this.max);\r\n    }\r\n    if (this.startYear === undefined) {\r\n      this.startYear = new Date(this.startDate).getFullYear();\r\n      this.initStartYear = this.startYear;\r\n    }\r\n    if (this.endYear === undefined) {\r\n      this.endYear = new Date(this.endDate).getFullYear();\r\n      this.initEndYear = this.endYear;\r\n    }\r\n\r\n    if (!this.isRange) {\r\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\r\n        this.listYears.push(i);\r\n      }\r\n    } else {\r\n      for (let i = this.startYear; i < this.endYear; i++) {\r\n        this.startListYears.push(i);\r\n      }\r\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\r\n        this.endListYears.push(i);\r\n      }\r\n    }\r\n    this.options.enabled =\r\n      this.options.enabled === undefined ? true : this.options.enabled;\r\n    this.checkFilterValue();\r\n    if (this.options.enabled) {\r\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\r\n        this.yearChange.emit(this.year);\r\n      }\r\n    } else {\r\n      this.storeCurrentFilterValue();\r\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  storeCurrentFilterValue() {\r\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    if (\r\n      !this.isRange &&\r\n      this.style === TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      this.options.value = this.year.toString();\r\n    }\r\n  }\r\n\r\n  checkFilterValue() {\r\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\r\n    const timeFromWms = olSource.getParams().TIME;\r\n    if (\r\n      !this.isRange &&\r\n      this.style === TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      if (timeFromWms) {\r\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\r\n      } else if (this.options.value) {\r\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\r\n      } else {\r\n        this.year = new Date(this.min).getFullYear() + 1;\r\n      }\r\n    } else if (\r\n      this.isRange &&\r\n      this.style === TimeFilterStyle.CALENDAR &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      if (timeFromWms) {\r\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\r\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\r\n        const newStartListYears: any[] = [];\r\n        const newEndListYears: any[] = [];\r\n        for (let i = this.initStartYear; i < this.endYear; i++) {\r\n          newStartListYears.push(i);\r\n        }\r\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\r\n          newEndListYears.push(i);\r\n        }\r\n        this.startListYears = newStartListYears;\r\n        this.endListYears = newEndListYears;\r\n      }\r\n    }\r\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n  }\r\n\r\n  handleDateChange(event: any) {\r\n    this.setupDateOutput();\r\n    this.applyTypeChange();\r\n\r\n    // Only if is range, use 2 dates to make the range\r\n    if (this.isRange) {\r\n      this.change.emit([this.startDate, this.endDate]);\r\n    } else {\r\n      this.change.emit(this.startDate);\r\n    }\r\n  }\r\n\r\n  handleYearChange(event: any) {\r\n    if (this.isRange) {\r\n      this.endListYears = [];\r\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\r\n        this.endListYears.push(i);\r\n      }\r\n      this.startListYears = [];\r\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\r\n        this.startListYears.push(i);\r\n      }\r\n      this.yearChange.emit([this.startYear, this.endYear]);\r\n    } else {\r\n      this.yearChange.emit(this.year);\r\n    }\r\n  }\r\n\r\n  handleListYearChange(event: any) {\r\n    this.handleYearChange([this.startYear, this.endYear]);\r\n  }\r\n\r\n  handleListYearStartChange(event: any) {\r\n    this.change.emit([this.startDate, this.endDate]);\r\n  }\r\n\r\n  dateToNumber(date: Date): number {\r\n    let newDate;\r\n    if (date) {\r\n      newDate = new Date(date);\r\n    } else {\r\n      newDate = new Date(this.min);\r\n    }\r\n\r\n    return newDate.getTime();\r\n  }\r\n\r\n  setSliderThumbLabel(label: string) {\r\n    const thumbLabel = this.findThumbLabel(\r\n      this.mySlider._elementRef.nativeElement.childNodes\r\n    );\r\n    if (thumbLabel) {\r\n      thumbLabel.textContent = label;\r\n    }\r\n  }\r\n\r\n  findThumbLabel(test: any[]): any {\r\n    let thumbLabel;\r\n\r\n    test.forEach((value) => {\r\n      if (value.className === 'mat-slider-thumb-label-text') {\r\n        thumbLabel = value;\r\n      }\r\n\r\n      if (value.children.length > 0 && !thumbLabel) {\r\n        thumbLabel = this.findThumbLabel(value.childNodes);\r\n      }\r\n    }, this);\r\n    return thumbLabel;\r\n  }\r\n\r\n  toggleFilterState() {\r\n    this.options.enabled = !this.options.enabled;\r\n\r\n    if (this.options.enabled) {\r\n      if (\r\n        !this.isRange &&\r\n        TimeFilterStyle.SLIDER &&\r\n        this.type === TimeFilterType.YEAR\r\n      ) {\r\n        this.yearChange.emit(this.year);\r\n      }\r\n    } else {\r\n      this.stopFilter();\r\n      this.storeCurrentFilterValue();\r\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  resetFilter(event: any) {\r\n    this.date = new Date(this.min);\r\n    this.year = this.date.getFullYear();\r\n    if (\r\n      !this.isRange &&\r\n      TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      this.yearChange.emit(this.year);\r\n    } else {\r\n      this.setupDateOutput();\r\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  playFilter(event: any) {\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        (that) => {\r\n          let newMinDateNumber;\r\n          const maxDateNumber = new Date(that.max);\r\n\r\n          newMinDateNumber =\r\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\r\n          newMinDateNumber += that.mySlider.step;\r\n          that.date = new Date(newMinDateNumber);\r\n\r\n          if (newMinDateNumber > maxDateNumber.getTime()) {\r\n            that.stopFilter();\r\n          }\r\n\r\n          that.handleDateChange({ value: that.date, date: that.date });\r\n        },\r\n        this.timeInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  playYear(event: any) {\r\n    if (\r\n      this.year + this.mySlider.step >\r\n      this.max.getFullYear() + this.mySlider.step\r\n    ) {\r\n      this.stopFilter();\r\n      this.resetFilter(event);\r\n    }\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        () => {\r\n          if (this.year + this.mySlider.step > this.max.getFullYear()) {\r\n            this.stopFilter();\r\n          } else {\r\n            this.year = this.year + this.mySlider.step;\r\n          }\r\n          this.yearChange.emit(this.year);\r\n        },\r\n        this.timeInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  stopFilter() {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n  }\r\n\r\n  handleSliderDateChange(event: any) {\r\n    this.date = new Date(event.value);\r\n    this.setSliderThumbLabel(this.handleSliderTooltip());\r\n    this.handleDateChange(event);\r\n  }\r\n\r\n  handleSliderYearChange(event: any) {\r\n    this.year = event.value;\r\n    this.yearChange.emit(this.year);\r\n  }\r\n\r\n  handleSliderValue(): number {\r\n    if (this.options.current === true || !this.min) {\r\n      const currentDate = new Date();\r\n      this.date = this.getRoundedDate(currentDate);\r\n    }\r\n    if (this.type === TimeFilterType.YEAR) {\r\n      return this.year;\r\n    } else {\r\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\r\n    }\r\n  }\r\n\r\n  handleSliderTooltip() {\r\n    let label: string;\r\n\r\n    switch (this.type) {\r\n      case TimeFilterType.DATE:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toDateString()\r\n            : this.date.toDateString();\r\n        break;\r\n      case TimeFilterType.TIME:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toTimeString()\r\n            : this.date.toTimeString();\r\n        break;\r\n      // datetime\r\n      default:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toUTCString()\r\n            : this.date.toUTCString();\r\n        break;\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  setupDateOutput() {\r\n    if (this.style === TimeFilterStyle.SLIDER) {\r\n      this.startDate = new Date(this.date);\r\n      this.startDate.setSeconds(-(this.step / 1000));\r\n      this.endDate = new Date(this.startDate);\r\n      this.endDate.setSeconds(this.step / 1000);\r\n    } else if (!this.isRange && !!this.date) {\r\n      this.endDate = new Date(this.date);\r\n      this.startDate = new Date(this.date);\r\n    } else if (this.isRange && (!!this.date || !this.date)) {\r\n      this.startDate =\r\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\r\n      this.endDate =\r\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\r\n    } else if (!this.date) {\r\n      this.startDate =\r\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\r\n      this.endDate =\r\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\r\n    }\r\n  }\r\n\r\n  applyTypeChange() {\r\n    switch (this.type) {\r\n      case TimeFilterType.DATE:\r\n        if (this.startDate !== undefined || this.endDate !== undefined) {\r\n          this.startDate.setHours(0);\r\n          this.startDate.setMinutes(0);\r\n          this.startDate.setSeconds(0);\r\n          this.endDate.setHours(23);\r\n          this.endDate.setMinutes(59);\r\n          this.endDate.setSeconds(59);\r\n        }\r\n        break;\r\n      case TimeFilterType.TIME:\r\n        if (this.style === TimeFilterStyle.CALENDAR) {\r\n          if (this.startDate.getDay() !== this.min.getDay()) {\r\n            const selectedHour = this.startDate.getHours();\r\n            const selectedMinute = this.startDate.getMinutes();\r\n            this.startDate = this.min;\r\n            this.startDate.setHours(selectedHour);\r\n            this.startDate.setMinutes(selectedMinute);\r\n          }\r\n\r\n          if (this.endDate.getDay() !== this.min.getDay()) {\r\n            const selectedHour = this.endDate.getHours();\r\n            const selectedMinute = this.endDate.getMinutes();\r\n            this.endDate = this.min;\r\n            this.endDate.setHours(selectedHour);\r\n            this.endDate.setMinutes(selectedMinute);\r\n          }\r\n        }\r\n\r\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\r\n          this.startDate.setMinutes(0);\r\n          this.startDate.setSeconds(0);\r\n          this.endDate.setMinutes(59);\r\n          this.endDate.setSeconds(59);\r\n        }\r\n        break;\r\n      // datetime\r\n      default:\r\n      // do nothing\r\n    }\r\n  }\r\n\r\n  getRangeMinDate(): Date {\r\n    return this.startDate === undefined ? this.min : this.startDate;\r\n  }\r\n\r\n  getRangeMaxDate(): Date {\r\n    return this.endDate === undefined ? this.max : this.endDate;\r\n  }\r\n\r\n  /**\r\n   * Round date at a certain time, 10 minutes by Default\r\n   * @param date - Date to Round\r\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\r\n   * @return the rounded date\r\n   */\r\n  getRoundedDate(date, atMinute = 10) {\r\n    const coeff = 1000 * 60 * atMinute;\r\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\r\n  }\r\n\r\n  /**\r\n   * Get the step (period) definition from the layer dimension tag\r\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\r\n   * @return the duration in milliseconds\r\n   */\r\n  getStepDefinition(step) {\r\n    return moment.duration(step).asMilliseconds();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\r\n\r\n@Injectable()\r\nexport class TimeFilterService {\r\n  constructor() {}\r\n\r\n  filterByDate(\r\n    datasource: WMSDataSource | TileArcGISRestDataSource,\r\n    date: Date | [Date, Date]\r\n  ) {\r\n    let time;\r\n    let newdateform;\r\n    let newdateformStart;\r\n    let newdateformEnd;\r\n\r\n    if (Array.isArray(date)) {\r\n      const dates = [];\r\n      if (date[0]) {\r\n        newdateformStart = this.reformatDateTime(date[0]);\r\n        dates.push(date[0]);\r\n      }\r\n      if (date[1]) {\r\n        newdateformEnd = this.reformatDateTime(date[1]);\r\n        dates.push(date[1]);\r\n      }\r\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\r\n        if (datasource instanceof TileArcGISRestDataSource) {\r\n          time = newdateformStart + ',' + newdateformEnd;\r\n        } else {\r\n          time = newdateformStart + '/' + newdateformEnd;\r\n        }\r\n      }\r\n      if (newdateformStart === newdateformEnd) {\r\n        time = newdateformStart;\r\n      }\r\n    } else if (date) {\r\n      newdateform = this.reformatDateTime(date);\r\n      time = newdateform;\r\n    }\r\n\r\n    const params = { TIME: time };\r\n    datasource.ol.updateParams(params);\r\n    if (datasource instanceof WMSDataSource) {\r\n      const wmsDataSource = datasource as WMSDataSource;\r\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\r\n    }\r\n  }\r\n\r\n  filterByYear(\r\n    datasource: WMSDataSource | TileArcGISRestDataSource,\r\n    year: string | [string, string]\r\n  ) {\r\n    let time;\r\n    let newdateformStart;\r\n    let newdateformEnd;\r\n\r\n    if (Array.isArray(year)) {\r\n      const years = [];\r\n      if (year[0]) {\r\n        newdateformStart = year[0];\r\n        years.push(year[0]);\r\n      }\r\n      if (year[1]) {\r\n        newdateformEnd = year[1];\r\n        years.push(year[1]);\r\n      }\r\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\r\n        if (datasource instanceof TileArcGISRestDataSource) {\r\n          time = newdateformStart + ',' + newdateformEnd;\r\n        } else {\r\n          time = newdateformStart + '/' + newdateformEnd;\r\n        }\r\n      }\r\n      if (newdateformStart === newdateformEnd) {\r\n        time = newdateformStart;\r\n      }\r\n    } else {\r\n      // to reset filter.\r\n      time = year;\r\n    }\r\n\r\n    const params = { TIME: time };\r\n    datasource.ol.updateParams(params);\r\n    if (datasource instanceof WMSDataSource) {\r\n      const wmsDataSource = datasource as WMSDataSource;\r\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\r\n    }\r\n  }\r\n\r\n  private reformatDateTime(value) {\r\n    const year = value.getFullYear();\r\n    let month = value.getMonth() + 1;\r\n    let day = value.getUTCDate();\r\n    let hour = value.getUTCHours();\r\n    let minute = value.getUTCMinutes();\r\n\r\n    if (Number(month) < 10) {\r\n      month = '0' + month;\r\n    }\r\n\r\n    if (Number(day) < 10) {\r\n      day = '0' + day;\r\n    }\r\n\r\n    if (Number(hour) < 10) {\r\n      hour = '0' + hour;\r\n    }\r\n\r\n    if (Number(minute) < 10) {\r\n      minute = '0' + minute;\r\n    }\r\n\r\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\r\n  }\r\n}\r\n","<mat-list-item *ngIf=\"header\">\r\n  <mat-icon\r\n    class=\"igo-chevron\"\r\n    matListItemIcon\r\n    igoCollapse\r\n    [target]=\"filters\"\r\n    [collapsed]=\"filtersCollapsed\"\r\n    (click)=\"toggleFiltersCollapsed()\"\r\n    svgIcon=\"chevron-up\"\r\n  >\r\n  </mat-icon>\r\n\r\n  <span\r\n    matListItemTitle\r\n    (click)=\"toggleLegendOnClick()\"\r\n    [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\r\n    >{{ layer.title }}</span\r\n  >\r\n\r\n  <button\r\n    *ngIf=\"header\"\r\n    mat-icon-button\r\n    matListItemMeta\r\n    [color]=\"layer.visible ? 'primary' : 'default'\"\r\n    collapsibleButton\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"\r\n      layer.visible\r\n        ? ('igo.geo.layer.hideLayer' | translate)\r\n        : ('igo.geo.layer.showLayer' | translate)\r\n    \"\r\n    (click)=\"layer.visible = !layer.visible\"\r\n  >\r\n    <mat-icon\r\n      [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\r\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\"\r\n    >\r\n    </mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n\r\n<div #filters class=\"igo-datasource-filters-container\">\r\n  <div #legend class=\"igo-layer-legend-container\">\r\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\r\n    </igo-layer-legend>\r\n  </div>\r\n  <igo-time-filter-form\r\n    [layer]=\"layer\"\r\n    [options]=\"datasource.options.timeFilter\"\r\n    [currentValue]=\"datasource.options.params.TIME\"\r\n    (change)=\"handleDateChange($event)\"\r\n    (yearChange)=\"handleYearChange($event)\"\r\n  >\r\n  </igo-time-filter-form>\r\n</div>\r\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { TimeFilterableDataSource } from '../../datasource';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss']\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\r\n  <ng-template\r\n    ngFor\r\n    let-layer\r\n    [ngForOf]=\"layers | filterableDataSource: 'time'\"\r\n  >\r\n    <igo-time-filter-item\r\n      [header]=\"true\"\r\n      igoListItem\r\n      [layer]=\"layer\"\r\n    ></igo-time-filter-item>\r\n  </ng-template>\r\n</igo-list>\r\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport * as olproj from 'ol/proj';\r\nimport olWKT from 'ol/format/WKT';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WktService {\r\n  constructor() {}\r\n\r\n  public wktToFeature(wkt, wktProj, featureProj) {\r\n    return new olWKT().readFeature(wkt, {\r\n      dataProjection: wktProj,\r\n      featureProjection: featureProj\r\n    });\r\n  }\r\n  public extentToWkt(epsgTO, extent, extentProj) {\r\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\r\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\r\n    const wktPoly = `POLYGON((\r\n      ${extent[0]} ${extent[1]},\r\n      ${extent[0]} ${extent[3]},\r\n      ${extent[2]} ${extent[3]},\r\n      ${extent[2]} ${extent[1]},\r\n      ${extent[0]} ${extent[1]}))`;\r\n    const wktLine = `LINESTRING(\r\n      ${extent[0]} ${extent[1]},\r\n      ${extent[0]} ${extent[3]},\r\n      ${extent[2]} ${extent[3]},\r\n      ${extent[2]} ${extent[1]},\r\n      ${extent[0]} ${extent[1]})`;\r\n    const wktMultiPoints = `MULTIPOINT(\r\n        ${extent[0]} ${extent[1]},\r\n        ${extent[0]} ${extent[3]},\r\n        ${extent[2]} ${extent[3]},\r\n        ${extent[2]} ${extent[1]})`;\r\n    return {\r\n      wktPoly,\r\n      wktLine,\r\n      wktMultiPoints\r\n    };\r\n  }\r\n\r\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\r\n    const lproj = olproj.get(projection);\r\n    const units = lproj.getUnits();\r\n    const olUnits = ['ft', 'm', 'us-ft'];\r\n    if (olUnits.indexOf(units) !== -1) {\r\n      coordinateArray = this.roundArray(coordinateArray, decimal);\r\n    }\r\n    return coordinateArray;\r\n  }\r\n\r\n  private roundArray(array, decimal = 0) {\r\n    let x = 0;\r\n    while (x < array.length) {\r\n      array[x] = array[x].toFixed(decimal);\r\n      x++;\r\n    }\r\n    return array;\r\n  }\r\n\r\n  public snrcToWkt(snrc, epsgTO) {\r\n    snrc = snrc.toLowerCase();\r\n    let wktPoly;\r\n    const ew = {\r\n      1: { from: -56, to: -64 },\r\n      2: { from: -64, to: -72 },\r\n      3: { from: -72, to: -80 },\r\n      4: { from: -80, to: -88 },\r\n      5: { from: -88, to: -96 },\r\n      6: { from: -96, to: -104 },\r\n      7: { from: -104, to: -112 },\r\n      8: { from: -112, to: -120 },\r\n      9: { from: -120, to: -128 },\r\n      10: { from: -128, to: -136 }\r\n    };\r\n    const sn = {\r\n      1: { from: 44, to: 48 },\r\n      2: { from: 48, to: 52 },\r\n      3: { from: 52, to: 56 },\r\n      4: { from: 56, to: 60 },\r\n      5: { from: 60, to: 64 },\r\n      6: { from: 64, to: 68 },\r\n      7: { from: 68, to: 72 },\r\n      8: { from: 72, to: 76 },\r\n      9: { from: 76, to: -128 }\r\n    };\r\n    const snrc250kIndex = [\r\n      ['m', 'n', 'o', 'p'],\r\n      ['l', 'k', 'j', 'i'],\r\n      ['e', 'f', 'g', 'h'],\r\n      ['d', 'c', 'b', 'a']\r\n    ];\r\n\r\n    const snrc50kIndex = [\r\n      ['13', '14', '15', '16'],\r\n      ['12', '11', '10', '09'],\r\n      ['05', '06', '07', '08'],\r\n      ['04', '03', '02', '01']\r\n    ];\r\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\r\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\r\n    const checkSNRC1m = /\\d{2,3}/gi;\r\n\r\n    let snrc1m = false;\r\n    let snrc250k = false;\r\n    let snrc50k = false;\r\n\r\n    if (checkSNRC50k.test(snrc)) {\r\n      snrc50k = true;\r\n    } else {\r\n      if (checkSNRC250k.test(snrc)) {\r\n        snrc250k = true;\r\n      } else {\r\n        if (checkSNRC1m.test(snrc)) {\r\n          snrc1m = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (snrc1m) {\r\n      snrc += 'a01';\r\n    } else if (snrc250k) {\r\n      snrc += '01';\r\n    }\r\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\r\n      const regex1m = /(?=[a-p])/gi;\r\n      const ar1m = snrc.split(regex1m);\r\n      const part1m = ar1m[0];\r\n      const part250k = ar1m[1][0];\r\n      const part50k = ar1m[1].split(part250k)[1];\r\n      let separator = 1;\r\n      if (part1m.length === 3) {\r\n        separator = 2;\r\n      }\r\n      const partEW = part1m.substring(0, separator);\r\n      const partSN = part1m.substring(separator);\r\n      const unit1mEW = 8;\r\n      const unit1mSN = 4;\r\n      const unit250kEW = 2;\r\n      const unit250kSN = 1;\r\n      const unit50kEW = 0.5;\r\n      const unit50kSN = 0.25;\r\n      let index250kEW = 0;\r\n      let index250kSN = 0;\r\n      let index50kEW = 0;\r\n      let index50kSN = 0;\r\n      snrc250kIndex.forEach((element) => {\r\n        if (element.indexOf(part250k) !== -1) {\r\n          index250kSN = snrc250kIndex.indexOf(element);\r\n          index250kEW = element.indexOf(part250k);\r\n        }\r\n      });\r\n      snrc50kIndex.forEach((element) => {\r\n        if (element.indexOf(part50k) !== -1) {\r\n          index50kSN = snrc50kIndex.indexOf(element);\r\n          index50kEW = element.indexOf(part50k);\r\n        }\r\n      });\r\n\r\n      let increment250kEW = 0;\r\n      let increment250kSN = 0;\r\n      let increment50kEW = 0;\r\n      let increment50kSN = 0;\r\n      let unitPerTypeEW = unit1mEW;\r\n      let unitPerTypeSN = unit1mSN;\r\n      if (snrc250k) {\r\n        increment250kEW = index250kEW * unit250kEW;\r\n        increment250kSN = index250kSN * unit250kSN;\r\n        increment50kEW = 0;\r\n        increment50kSN = 0;\r\n        unitPerTypeEW = unit250kEW;\r\n        unitPerTypeSN = unit250kSN;\r\n      } else if (snrc50k) {\r\n        increment250kEW = index250kEW * unit250kEW;\r\n        increment250kSN = index250kSN * unit250kSN;\r\n        increment50kEW = index50kEW * unit50kEW;\r\n        increment50kSN = index50kSN * unit50kSN;\r\n        unitPerTypeEW = unit50kEW;\r\n        unitPerTypeSN = unit50kSN;\r\n      }\r\n\r\n      const coord: { ul?: any; lr?: any; ur?: any; ll?: any } = {\r\n        ul: [\r\n          ew[partEW].to + increment250kEW + increment50kEW,\r\n          sn[partSN].to - increment250kSN - increment50kSN\r\n        ]\r\n      };\r\n\r\n      coord.lr = [coord.ul[0] + unitPerTypeEW, coord.ul[1] - unitPerTypeSN];\r\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\r\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\r\n\r\n      coord.ul = olproj.transform(\r\n        [coord.ul[0], coord.ul[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.lr = olproj.transform(\r\n        [coord.lr[0], coord.lr[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.ur = olproj.transform(\r\n        [coord.ur[0], coord.ur[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.ll = olproj.transform(\r\n        [coord.ll[0], coord.ll[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n\r\n      // Rounded coordinate to shorten url in get\r\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\r\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\r\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\r\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\r\n\r\n      wktPoly =\r\n        'POLYGON((' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' '),\r\n          coord.ul.join(' ')\r\n        ].join(',') +\r\n        '))';\r\n      const wktLine =\r\n        'LINESTRING(' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' '),\r\n          coord.ul.join(' ')\r\n        ].join(',') +\r\n        ')';\r\n\r\n      const wktMultiPoints =\r\n        'MULTIPOINT(' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' ')\r\n        ].join(',') +\r\n        ')';\r\n      return {\r\n        wktPoly,\r\n        wktLine,\r\n        wktMultiPoints\r\n      };\r\n    }\r\n  }\r\n}\r\n","<div class=\"ogc-filter-form-container\">\n  <mat-checkbox\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n    (click)=\"$event.stopPropagation()\"\n    (change)=\"toggleFilterState($event)\"\n    [checked]=\"currentFilter.active\"\n  >\n  </mat-checkbox>\n\n  <mat-form-field\n    [ngClass]=\"{\n      logical:\n        activeFilters.indexOf(currentFilter) !== 0 &&\n        currentFilter.active === true,\n      logicalHidden:\n        activeFilters.indexOf(currentFilter) === 0 ||\n        currentFilter.active !== true\n    }\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.parentLogical\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.parentLogical\n          ? ('igo.geo.operators.tooltip.' + currentFilter.parentLogical\n            | translate)\n          : ''\n      \"\n      (selectionChange)=\"changeLogical($event.value)\"\n    >\n      <mat-option\n        [value]=\"ogcFilterOperator.And\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\"\n      >\n        {{ 'igo.geo.operators.And' | translate }}\n      </mat-option>\n      <mat-option\n        [value]=\"ogcFilterOperator.Or\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\"\n      >\n        {{ 'igo.geo.operators.Or' | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"field\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) === false &&\n      (fields$ | async) &&\n      (fields$ | async).length > 0 &&\n      (fields$ | async)[0].name !== ''\n    \"\n    (mouseenter)=\"inputClearable = 'selectField'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteField\"\n      [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        (selectedField$ | async)\n          ? (selectedField$ | async).alias\n          : ('igo.geo.sourceFields.selectField' | translate)\n      \"\n      (input)=\"updateFieldsList($event.target.value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteField=\"matAutocomplete\"\n      (optionSelected)=\"changeField($event.option.id)\"\n    >\n      <mat-option\n        *ngFor=\"let field of filteredFields$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"field.alias\"\n        [id]=\"field.name\"\n        [matTooltip]=\"field.alias\"\n      >\n        {{ field.alias }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        currentFilter.propertyName &&\n        inputClearable === 'selectField' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearSelectedField()\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    [ngClass]=\"{\n      operator: (currentFilterIsSpatial$ | async) === false,\n      dualInput: (currentFilterIsSpatial$ | async)\n    }\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <mat-select\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.operator\n          ? ('igo.geo.operators.tooltip.' + currentFilter.operator | translate)\n          : ('igo.geo.filter.selectOperator' | translate)\n      \"\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.operator\"\n      (selectionChange)=\"changeOperator($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let operator of ogcFilterOperators$ | async | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.' + operator.key | translate\"\n      >\n        {{ 'igo.geo.operators.' + operator.key | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"spatialSelector\"\n    *ngIf=\"currentFilterIsSpatial$ | async\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.igoSpatialSelector\"\n      (selectionChange)=\"changeSpatialSelector($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\"\n      >\n        {{ 'igo.geo.spatialSelector.' + igoSpatialSelector.type | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"singleInput\"\n    *ngIf=\"['expression', 'pattern'].indexOf(detectProperty()) !== -1\"\n    (mouseenter)=\"inputClearable = 'selectProperty'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteValues\"\n      [value]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression\n          : currentFilter.pattern\n      \"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression || ''\n          : currentFilter.pattern || ''\n      \"\n      (input)=\"updateValuesList($event.target.value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteValues=\"matAutocomplete\"\n      (optionSelected)=\"changeProperty($event.option.value)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable() &&\n        inputClearable === 'selectProperty' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty()\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <div class=\"igo-layer-button-group\">\n    <button\n      mat-icon-button\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n      color=\"warn\"\n      (click)=\"deleteFilter()\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n  </div>\n\n  <mat-form-field\n    class=\"snrc\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'snrc'\n    \"\n    (mouseenter)=\"inputClearable = 'selectSNRC'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n      [value]=\"currentFilter.igoSNRC\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n      (input)=\"changeSNRC($event.target.value)\"\n    />\n    <button\n      *ngIf=\"currentFilter.igoSNRC\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"\n        !currentFilter.active &&\n        inputClearable === 'selectSNRC' &&\n        currentFilter.active\n      \"\n      (click)=\"currentFilter.igoSNRC = ''\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <ng-container\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'fixedExtent'\n    \"\n  >\n    <button\n      [disabled]=\"!currentFilter.active\"\n      *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n      matSuffix\n      mat-icon-button\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"changeMapExtentGeometry()\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\"\n    >\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\n    </button>\n  </ng-container>\n</div>\n\n<div class=\"ogc-filter-form-container\">\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['lowerBoundary', 'begin'].indexOf(detectProperty(1)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty1'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(1) === 'lowerBoundary'\n          ? currentFilter.lowerBoundary\n          : currentFilter.begin\n      \"\n      (input)=\"updateValuesList($event.target.value, 1)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 1)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(1) &&\n        inputClearable === 'selectProperty1' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['upperBoundary', 'end'].indexOf(detectProperty(2)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty2'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(2) === 'upperBoundary'\n          ? currentFilter.upperBoundary\n          : currentFilter.end\n      \"\n      (input)=\"updateValuesList($event.target.value, 2)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 2)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(2) &&\n        inputClearable === 'selectProperty2' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n</div>\n\n<igo-ogc-filter-time\n  *ngIf=\"isTemporalOperator()\"\n  [(datasource)]=\"datasource\"\n  [(currentFilter)]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\"\n>\n</igo-ogc-filter-time>\n","import { Component, Input, OnInit } from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material/form-field';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\n\r\nimport {\r\n  OgcFilterableDataSource,\r\n  OgcFiltersOptions\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport { WktService } from '../../wkt/shared/wkt.service';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-form',\r\n  templateUrl: './ogc-filter-form.component.html',\r\n  styleUrls: ['./ogc-filter-form.component.scss']\r\n})\r\nexport class OgcFilterFormComponent implements OnInit {\r\n  ogcFilterOperator = OgcFilterOperator;\r\n  filteredValues$: Observable<string[]>;\r\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\r\n  public allOgcFilterOperators;\r\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\r\n    undefined\r\n  );\r\n  public igoSpatialSelectors;\r\n  public value = '';\r\n  public inputOperator;\r\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\r\n    undefined\r\n  );\r\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\r\n  public color = 'primary';\r\n  public disabled;\r\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\r\n  public defaultStepMillisecond = 6000;\r\n  public inputClearable: string;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() currentFilter: any;\r\n\r\n  set snrc(value: any) {\r\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\r\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\r\n    const checkSNRC1m = /^\\d{2}$/gi;\r\n    if (\r\n      checkSNRC1m.test(value) ||\r\n      checkSNRC250k.test(value) ||\r\n      checkSNRC50k.test(value)\r\n    ) {\r\n      this._snrc = value;\r\n      this.currentFilter.igoSNRC = value;\r\n    }\r\n  }\r\n\r\n  get snrc(): any {\r\n    return this._snrc;\r\n  }\r\n\r\n  private _snrc = '';\r\n\r\n  @Input() floatLabel: FloatLabelType;\r\n\r\n  get activeFilters() {\r\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\r\n      (f) => f.active === true\r\n    );\r\n  }\r\n\r\n  get allowedOperators() {\r\n    return new OgcFilterWriter().computeAllowedOperators(\r\n      this.fields$.value,\r\n      this.currentFilter.propertyName,\r\n      this.datasource.options.ogcFilters.allowedOperatorsType\r\n    );\r\n  }\r\n\r\n  constructor(private wktService: WktService) {\r\n    // TODO: Filter permitted operator based on wfscapabilities\r\n    // Need to work on regex on XML capabilities because\r\n    // comaparison operator's name varies between WFS servers...\r\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\r\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\r\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\r\n    this.igoSpatialSelectors = [\r\n      {\r\n        type: 'fixedExtent'\r\n      },\r\n      {\r\n        type: 'snrc'\r\n      }\r\n    ];\r\n    // TODO: selectFeature & drawFeature\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.datasource.options.sourceFields) {\r\n      const sFields = this.datasource.options.sourceFields.filter(\r\n        (sf) =>\r\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\r\n      );\r\n      sFields.map((sfs) => {\r\n        if (sfs.values) {\r\n          sfs.values.sort();\r\n        }\r\n      });\r\n      this.fields$.next(sFields);\r\n    }\r\n\r\n    this.updateFieldsList();\r\n    this.selectedField$.next(\r\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\r\n    );\r\n    this.updateValuesList();\r\n    this.selectedField$.subscribe((f) => {\r\n      this.ogcFilterOperators$.next(this.allowedOperators);\r\n      if (\r\n        Object.keys(this.allowedOperators).indexOf(\r\n          this.currentFilter.operator\r\n        ) === -1\r\n      ) {\r\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\r\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\r\n      }\r\n      this.updateValuesList();\r\n    });\r\n    this.currentFilterIsSpatial();\r\n  }\r\n\r\n  updateFieldsList(value?: string) {\r\n    this.filteredFields$ =\r\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\r\n    if (this.fields$.value.find((f) => f.name === value)) {\r\n      this.changeField(value);\r\n    }\r\n  }\r\n\r\n  updateValuesList(value?: string, pos?: number) {\r\n    this.filteredValues$ =\r\n      value && value.length > 0\r\n        ? of(this._filterValues(value))\r\n        : this.selectedField$.value\r\n        ? of(this.selectedField$.value.values)\r\n        : of([]);\r\n    if (value && value.length >= 1) {\r\n      this.changeProperty(value, pos);\r\n    }\r\n  }\r\n\r\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\r\n    const keywordRegex = new RegExp(\r\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\r\n      'gi'\r\n    );\r\n    return this.fields$.value.filter((val) =>\r\n      keywordRegex.test(\r\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\r\n      )\r\n    );\r\n  }\r\n\r\n  private _filterValues(value: string): string[] {\r\n    const keywordRegex = new RegExp(\r\n      value\r\n        .toString()\r\n        .normalize('NFD')\r\n        .replace(/[\\u0300-\\u036f]/g, ''),\r\n      'gi'\r\n    );\r\n    return this.selectedField$.value.values.filter(\r\n      (val) =>\r\n        val &&\r\n        keywordRegex.test(\r\n          val\r\n            .toString()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n        )\r\n    );\r\n  }\r\n\r\n  clearSelectedField() {\r\n    this.currentFilter.propertyName = '';\r\n    this.selectedField$.next(undefined);\r\n    this.clearProperty();\r\n  }\r\n\r\n  isClearable(pos?: number) {\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      return this.currentFilter[detectedProperty];\r\n    }\r\n  }\r\n  clearProperty(pos?: number) {\r\n    // this.autoCompleteInputValues.closePanel();\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      return (this.currentFilter[detectedProperty] = '');\r\n    }\r\n  }\r\n\r\n  toggleFilterState(event) {\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n      (f) => f.filterid === this.currentFilter.filterid\r\n    ).active = event.checked;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  deleteFilter() {\r\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\r\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\r\n      (f) => f.filterid !== this.currentFilter.filterid\r\n    );\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeLogical(logical: string) {\r\n    this.currentFilter.parentLogical = logical;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeOperator(operator: string) {\r\n    this.currentFilter.operator = operator;\r\n    this.currentFilterIsSpatial();\r\n\r\n    if (\r\n      this.currentFilterIsSpatial$.value &&\r\n      this.currentFilter.wkt_geometry.length === 0\r\n    ) {\r\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\r\n    } else {\r\n      this.refreshFilters();\r\n    }\r\n  }\r\n\r\n  changeField(field: string) {\r\n    this.currentFilter.propertyName = field;\r\n    this.selectedField$.next(\r\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\r\n    );\r\n    this.refreshFilters();\r\n  }\r\n\r\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\r\n  // Due to this issue, the checkbox is hide.\r\n  changeCaseSensitive(matchCase) {\r\n    this.currentFilter.matchCase = matchCase.checked;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        (f) => f.filterid === this.currentFilter.filterid\r\n      )[detectedProperty] = value;\r\n\r\n      if (refreshFilter) {\r\n        this.refreshFilters();\r\n      }\r\n    }\r\n  }\r\n\r\n  changeNumericProperty(value, pos: number) {\r\n    this.changeProperty(parseFloat(value), pos);\r\n  }\r\n\r\n  changeSpatialSelector(value: any) {\r\n    this.currentFilter.igoSpatialSelector = value;\r\n\r\n    if (value === 'fixedExtent') {\r\n      this.changeMapExtentGeometry(false);\r\n    }\r\n    this.currentFilterIsSpatial();\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeSNRC(value: any) {\r\n    this.snrc = value;\r\n    this.changeSNRCGeometry();\r\n  }\r\n\r\n  changeSNRCGeometry() {\r\n    const interfaceOgcFilter =\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        (f) => f.filterid === this.currentFilter.filterid\r\n      );\r\n    if (!interfaceOgcFilter) {\r\n      return;\r\n    }\r\n\r\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\r\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\r\n        this.snrc,\r\n        this.map.projection\r\n      ).wktPoly;\r\n    }\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeMapExtentGeometry(refresh: boolean = true) {\r\n    const interfaceOgcFilter =\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        (f) => f.filterid === this.currentFilter.filterid\r\n      );\r\n    if (!interfaceOgcFilter) {\r\n      return;\r\n    }\r\n\r\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\r\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\r\n        this.map.projection,\r\n        this.map.viewController.getExtent(),\r\n        this.map.projection\r\n      ).wktPoly;\r\n    }\r\n    if (refresh) {\r\n      this.refreshFilters();\r\n    }\r\n  }\r\n\r\n  detectProperty(pos?: number): string {\r\n    switch (this.currentFilter.operator) {\r\n      case OgcFilterOperator.PropertyIsNotEqualTo:\r\n      case OgcFilterOperator.PropertyIsEqualTo:\r\n      case OgcFilterOperator.PropertyIsGreaterThan:\r\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\r\n      case OgcFilterOperator.PropertyIsLessThan:\r\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\r\n        return 'expression';\r\n      case OgcFilterOperator.PropertyIsLike:\r\n        return 'pattern';\r\n      case OgcFilterOperator.PropertyIsBetween:\r\n        return pos && pos === 1\r\n          ? 'lowerBoundary'\r\n          : pos && pos === 2\r\n          ? 'upperBoundary'\r\n          : undefined;\r\n      case OgcFilterOperator.During:\r\n        return pos && pos === 1\r\n          ? 'begin'\r\n          : pos && pos === 2\r\n          ? 'end'\r\n          : undefined;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  private currentFilterIsSpatial() {\r\n    let isSpatial = false;\r\n    if (this.currentFilter) {\r\n      isSpatial =\r\n        [\r\n          OgcFilterOperator.Contains,\r\n          OgcFilterOperator.Intersects,\r\n          OgcFilterOperator.Within\r\n        ].indexOf(this.currentFilter.operator) !== -1;\r\n    }\r\n    this.currentFilterIsSpatial$.next(isSpatial);\r\n  }\r\n\r\n  isTemporalOperator() {\r\n    return (\r\n      this.currentFilter.operator.toLowerCase() ===\r\n      this.ogcFilterOperator.During.toLowerCase()\r\n    );\r\n  }\r\n}\r\n","<igo-ogc-filter-selection\r\n  *ngIf=\"!advancedOgcFilters\"\r\n  igoListItem\r\n  [refreshFilters]=\"refreshFunc\"\r\n  [datasource]=\"datasource\"\r\n  [map]=\"map\"\r\n  [currentFilter]=\"currentFilter\"\r\n>\r\n</igo-ogc-filter-selection>\r\n\r\n<ng-template\r\n  *ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\r\n  ngFor\r\n  let-currentFilter\r\n  [ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\"\r\n>\r\n  <igo-ogc-filter-form\r\n    [currentFilter]=\"currentFilter\"\r\n    [refreshFilters]=\"refreshFunc\"\r\n    [datasource]=\"datasource\"\r\n    [map]=\"map\"\r\n  >\r\n  </igo-ogc-filter-form>\r\n</ng-template>\r\n","import { Component, Input } from '@angular/core';\r\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-form',\r\n  templateUrl: './ogc-filterable-form.component.html'\r\n})\r\nexport class OgcFilterableFormComponent {\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  get refreshFunc() {\r\n    return this.refreshFilters;\r\n  }\r\n\r\n  get advancedOgcFilters(): boolean {\r\n    if (this.datasource.options.ogcFilters) {\r\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\r\n    }\r\n    return;\r\n  }\r\n\r\n  get currentFilter(): any {\r\n    return this.datasource.options.ogcFilters.interfaceOgcFilters\r\n      ? this.datasource.options.ogcFilters.interfaceOgcFilters[0]\r\n      : undefined;\r\n  }\r\n\r\n  public color = 'primary';\r\n\r\n  constructor() {}\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { OgcFilterWriter } from './ogc-filter';\r\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\r\n\r\n@Injectable()\r\nexport class OGCFilterService {\r\n  constructor() {}\r\n\r\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\r\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(\r\n      filterString,\r\n      wmsDatasource.options.params.LAYERS\r\n    );\r\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\r\n  }\r\n\r\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\r\n    const options: any = wfsDatasource.options;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\r\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\r\n        options.ogcFilters.filters,\r\n        options.paramsWFS.fieldNameGeometry,\r\n        new olProjection({ code: options.paramsWFS.srsName }),\r\n        true\r\n      );\r\n      if (!options.ogcFilters.interfaceOgcFilters) {\r\n        options.ogcFilters.interfaceOgcFilters =\r\n          ogcFilterWriter.defineInterfaceFilterSequence(\r\n            options.ogcFilters.filters,\r\n            options.paramsWFS.fieldNameGeometry\r\n          );\r\n      }\r\n    }\r\n  }\r\n\r\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\r\n    const options: any = wmsDatasource.options;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\r\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\r\n        options.ogcFilters.filters,\r\n        options.fieldNameGeometry,\r\n        undefined,\r\n        true\r\n      );\r\n      if (!options.ogcFilters.interfaceOgcFilters) {\r\n        options.ogcFilters.interfaceOgcFilters =\r\n          ogcFilterWriter.defineInterfaceFilterSequence(\r\n            // With some wms server, this param must be set to make spatials call.\r\n            options.ogcFilters.filters,\r\n            options.fieldNameGeometry\r\n          );\r\n      }\r\n      this.filterByOgc(\r\n        wmsDatasource as WMSDataSource,\r\n        ogcFilterWriter.buildFilter(\r\n          options.ogcFilters.filters,\r\n          undefined,\r\n          undefined,\r\n          undefined,\r\n          wmsDatasource.options\r\n        )\r\n      );\r\n      options.filtered = true;\r\n    } else {\r\n      options.ogcFilters.filters = undefined;\r\n      options.ogcFilters.interfaceOgcFilters = [];\r\n      options.filtered = false;\r\n    }\r\n  }\r\n}\r\n","<div [ngClass]=\"{ 'separate-item': header === true }\">\n  <mat-list-item>\n    <mat-icon\n      *ngIf=\"header\"\n      class=\"igo-chevron\"\n      matListItemIcon\n      igoCollapse\n      [target]=\"ogcFilters\"\n      [collapsed]=\"filtersCollapsed\"\n      (click)=\"toggleFiltersCollapsed()\"\n      svgIcon=\"chevron-up\"\n    >\n    </mat-icon>\n    <span\n      *ngIf=\"header\"\n      matListItemTitle\n      [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\n      [matTooltip]=\"layer.title\"\n      matTooltipShowDelay=\"500\"\n      (click)=\"toggleLegendOnClick()\"\n    >\n      {{ layer.title }}\n    </span>\n    <div matListItemMeta>\n      <button\n        *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\"\n        [disabled]=\"addFilterDisabled()\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.addFilter' | translate\"\n        [color]=\"color\"\n        (click)=\"addFilterToSequence()\"\n      >\n        <mat-icon svgIcon=\"plus\"></mat-icon>\n      </button>\n      <button\n        *ngIf=\"header\"\n        mat-icon-button\n        [color]=\"layer.visible ? 'primary' : 'default'\"\n        collapsibleButton\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"\n          layer.visible\n            ? ('igo.geo.layer.hideLayer' | translate)\n            : ('igo.geo.layer.showLayer' | translate)\n        \"\n        (click)=\"layer.visible = !layer.visible\"\n      >\n        <mat-icon\n          [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n          [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\"\n        >\n        </mat-icon>\n      </button>\n    </div>\n  </mat-list-item>\n\n  <div #ogcFilters>\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n      </igo-layer-legend>\n    </div>\n    <igo-ogc-filterable-form\n      [datasource]=\"datasource\"\n      [map]=\"map\"\n      [refreshFilters]=\"refreshFunc\"\n    >\n    </igo-ogc-filterable-form>\n\n    <section\n      *ngIf=\"hasSelector && filtersAreEditable\"\n      class=\"mat-typography advancedOgcFilters\"\n    >\n      <mat-divider></mat-divider>\n      <mat-checkbox\n        (change)=\"changeOgcFilterType($event)\"\n        [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\"\n      >\n        {{ 'igo.geo.filter.advancedOgcFilters' | translate }}\n      </mat-checkbox>\n    </section>\n  </div>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\r\n\r\nimport {\r\n  OgcFilterableDataSource,\r\n  OgcFiltersOptions,\r\n  OgcInterfaceFilterOptions\r\n} from '../shared/ogc-filter.interface';\r\nimport { OGCFilterService } from '../shared/ogc-filter.service';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { OgcFilterWriter } from '../shared/ogc-filter';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-item',\r\n  templateUrl: './ogc-filterable-item.component.html',\r\n  styleUrls: ['./ogc-filterable-item.component.scss']\r\n})\r\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\r\n  public color = 'primary';\r\n  private lastRunOgcFilter;\r\n  private defaultLogicalParent = OgcFilterOperator.And;\r\n  public hasActiveSpatialFilter = false;\r\n  public filtersAreEditable = true;\r\n  public filtersCollapsed = true;\r\n  public hasSelector: boolean = false;\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  private resolution$$: Subscription;\r\n  private ogcFilterWriter;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  get refreshFunc() {\r\n    return this.refreshFilters.bind(this);\r\n  }\r\n\r\n  get datasource(): OgcFilterableDataSource {\r\n    return this.layer.dataSource as OgcFilterableDataSource;\r\n  }\r\n\r\n  constructor(private ogcFilterService: OGCFilterService) {\r\n    this.ogcFilterWriter = new OgcFilterWriter();\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.layer.visible) {\r\n      this.filtersCollapsed = false;\r\n    }\r\n\r\n    const ogcFilters = this.datasource.options.ogcFilters;\r\n    if (\r\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\r\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\r\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\r\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0) ||\r\n      (ogcFilters.autocomplete && ogcFilters.autocomplete.bundles.length > 0)\r\n    ) {\r\n      if (ogcFilters.advancedOgcFilters === undefined) {\r\n        ogcFilters.advancedOgcFilters = false;\r\n      }\r\n      this.hasSelector = true;\r\n    }\r\n\r\n    switch (this.datasource.options.type) {\r\n      case 'wms':\r\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\r\n        break;\r\n      case 'wfs':\r\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (ogcFilters) {\r\n      if (ogcFilters.interfaceOgcFilters) {\r\n        this.lastRunOgcFilter = JSON.parse(\r\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\r\n        );\r\n        if (\r\n          ogcFilters.interfaceOgcFilters.filter((f) => f.wkt_geometry).length >=\r\n          1\r\n        ) {\r\n          this.hasActiveSpatialFilter = true;\r\n        }\r\n      }\r\n\r\n      this.filtersAreEditable = ogcFilters.editable\r\n        ? ogcFilters.editable\r\n        : false;\r\n    }\r\n\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.resolution$$.unsubscribe();\r\n  }\r\n\r\n  addFilterToSequence() {\r\n    this.filtersCollapsed = false;\r\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] =\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters;\r\n    const arr = interfaceOgcFilters || [];\r\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\r\n    let firstFieldName = '';\r\n    const includedFields = this.datasource.options.sourceFields.filter(\r\n      (f) => !f.excludeFromOgcFilters\r\n    );\r\n    if (includedFields.length > 0) {\r\n      firstFieldName =\r\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\r\n    }\r\n    let fieldNameGeometry;\r\n    const datasourceOptions = this.datasource\r\n      .options as WFSDataSourceOptionsParams;\r\n    if (datasourceOptions.fieldNameGeometry) {\r\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\r\n    } else if (\r\n      (this.datasource.options as any).paramsWFS &&\r\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\r\n    ) {\r\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\r\n        .fieldNameGeometry;\r\n    }\r\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\r\n      this.datasource.options.sourceFields,\r\n      firstFieldName,\r\n      this.datasource.options.ogcFilters.allowedOperatorsType\r\n    );\r\n    const firstOperatorName = Object.keys(allowedOperators)[0];\r\n\r\n    arr.push(\r\n      this.ogcFilterWriter.addInterfaceFilter(\r\n        {\r\n          propertyName: firstFieldName,\r\n          operator: firstOperatorName,\r\n          active: true,\r\n          igoSpatialSelector: 'fixedExtent',\r\n          srsName: this.map.projection\r\n        } as OgcInterfaceFilterOptions,\r\n        fieldNameGeometry,\r\n        lastLevel,\r\n        this.defaultLogicalParent\r\n      )\r\n    );\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\r\n  }\r\n\r\n  refreshFilters(force?: boolean) {\r\n    if (force === true) {\r\n      this.lastRunOgcFilter = undefined;\r\n    }\r\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\r\n    const activeFilters = ogcFilters.interfaceOgcFilters\r\n      ? ogcFilters.interfaceOgcFilters.filter((f) => f.active === true)\r\n      : [];\r\n    if (activeFilters.length === 0) {\r\n      ogcFilters.filters = undefined;\r\n      ogcFilters.filtered = false;\r\n    }\r\n    if (activeFilters.length > 1) {\r\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\r\n    }\r\n    if (\r\n      activeFilters.filter(\r\n        (af) => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\r\n      ).length === 0\r\n    ) {\r\n      this.hasActiveSpatialFilter = false;\r\n    } else {\r\n      this.hasActiveSpatialFilter = true;\r\n    }\r\n\r\n    if (\r\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\r\n    ) {\r\n      if (this.layer.dataSource.options.type === 'wfs') {\r\n        const ogcDataSource: any = this.layer.dataSource;\r\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\r\n        ogcLayer.filters =\r\n          this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\r\n            activeFilters\r\n          );\r\n        this.layer.dataSource.ol.refresh();\r\n      } else if (\r\n        this.layer.dataSource.options.type === 'wms' &&\r\n        ogcFilters.enabled\r\n      ) {\r\n        let rebuildFilter = '';\r\n        if (activeFilters.length >= 1) {\r\n          const ogcDataSource: any = this.layer.dataSource;\r\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\r\n          ogcLayer.filters =\r\n            this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\r\n              activeFilters\r\n            );\r\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\r\n            ogcLayer.filters,\r\n            undefined,\r\n            undefined,\r\n            (this.layer.dataSource.options as any).fieldNameGeometry,\r\n            ogcDataSource.options\r\n          );\r\n        }\r\n        this.ogcFilterService.filterByOgc(\r\n          this.datasource as WMSDataSource,\r\n          rebuildFilter\r\n        );\r\n        this.datasource.options.ogcFilters.filtered =\r\n          activeFilters.length === 0 ? false : true;\r\n      }\r\n\r\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\r\n    } else {\r\n      // identical filter. Nothing triggered\r\n    }\r\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(\r\n      ogcFilters,\r\n      true\r\n    );\r\n  }\r\n\r\n  public setVisible() {\r\n    this.layer.visible = true;\r\n  }\r\n\r\n  public isAdvancedOgcFilters(): boolean {\r\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\r\n  }\r\n\r\n  public addFilterDisabled(): boolean {\r\n    return (\r\n      !this.datasource.options.sourceFields ||\r\n      this.datasource.options.sourceFields.length === 0\r\n    );\r\n  }\r\n\r\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\r\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\r\n  }\r\n\r\n  changeOgcFilterType(isAdvancedOgcFilters) {\r\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\r\n    if (isAdvancedOgcFilters.checked) {\r\n      this.refreshFilters(true);\r\n    }\r\n  }\r\n\r\n  private toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    if (!this.filtersCollapsed) {\r\n      this.toggleLegend(this.showLegend$.value);\r\n    }\r\n  }\r\n\r\n  toggleFiltersCollapsed() {\r\n    this.filtersCollapsed = !this.filtersCollapsed;\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\r\n  <div\r\n    id=\"no-layer-message\"\r\n    *ngIf=\"(layers | filterableDataSource: 'ogc').length === 0\"\r\n  >\r\n    {{ 'igo.geo.filter.noFilterableLayer' | translate }}\r\n  </div>\r\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\r\n    <igo-ogc-filterable-item\r\n      igoListItem\r\n      [header]=\"true\"\r\n      [layer]=\"layer\"\r\n      [map]=\"layer.map\"\r\n    ></igo-ogc-filterable-item>\r\n  </ng-template>\r\n</igo-list>\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-list',\r\n  templateUrl: './ogc-filterable-list.component.html',\r\n  styleUrls: ['./ogc-filterable-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterableListComponent {\r\n  @Input() layers: Layer[];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  constructor() {}\r\n}\r\n","<button\r\n  *ngIf=\"\r\n    header &&\r\n    options.ogcFilters &&\r\n    options.ogcFilters.enabled &&\r\n    (options.ogcFilters.pushButtons ||\r\n      options.ogcFilters.checkboxes ||\r\n      options.ogcFilters.radioButtons ||\r\n      options.ogcFilters.select ||\r\n      options.ogcFilters.autocomplete ||\r\n      options.ogcFilters.editable)\r\n  \"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\r\n  [color]=\"color\"\r\n>\r\n  <mat-icon\r\n    aria-hidden=\"false\"\r\n    [matBadge]=\"badge\"\r\n    matBadgeColor=\"warn\"\r\n    matBadgeSize=\"medium\"\r\n    svgIcon=\"filter\"\r\n  ></mat-icon>\r\n</button>\r\n\r\n<div\r\n  #ogcFilter\r\n  class=\"igo-layer-actions-container\"\r\n  *ngIf=\"\r\n    options.ogcFilters &&\r\n    options.ogcFilters.enabled &&\r\n    (options.ogcFilters.pushButtons ||\r\n      options.ogcFilters.checkboxes ||\r\n      options.ogcFilters.radioButtons ||\r\n      options.ogcFilters.select ||\r\n      options.ogcFilters.autocomplete ||\r\n      options.ogcFilters.editable)\r\n  \"\r\n>\r\n  <igo-ogc-filterable-item\r\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\r\n    igoListItem\r\n    [header]=\"false\"\r\n    [map]=\"layer.map\"\r\n    [layer]=\"layer\"\r\n  >\r\n  </igo-ogc-filterable-item>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map/shared';\r\nimport {\r\n  OgcFilterableDataSourceOptions,\r\n  IgoOgcSelector\r\n} from '../shared/ogc-filter.interface';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-button',\r\n  templateUrl: './ogc-filter-button.component.html',\r\n  styleUrls: ['./ogc-filter-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterButtonComponent implements OnInit {\r\n  public options: OgcFilterableDataSourceOptions;\r\n\r\n  get badge() {\r\n    const filter = this.options.ogcFilters as any;\r\n    let cnt = 0;\r\n    if (filter && !filter.advancedOgcFilters) {\r\n      if (filter.pushButtons) {\r\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\r\n        const currentPushButtonGroup = pushButtons.groups.find(\r\n          (gr) => gr.enabled\r\n        );\r\n        let cntPushButtons = 0;\r\n        if (currentPushButtonGroup) {\r\n          currentPushButtonGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntPushButtons += (cb.selectors as any)?.filter(\r\n                (button) => button.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntPushButtons;\r\n      }\r\n      if (filter.checkboxes) {\r\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\r\n        const currentCheckboxGroup = checkboxes.groups.find((gr) => gr.enabled);\r\n        let cntCheckboxes = 0;\r\n        if (currentCheckboxGroup) {\r\n          currentCheckboxGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntCheckboxes += (cb.selectors as any)?.filter(\r\n                (checkbox) => checkbox.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntCheckboxes;\r\n      }\r\n      if (filter.radioButtons) {\r\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\r\n        const currentRadioButtonsGroup = radioButtons.groups.find(\r\n          (gr) => gr.enabled\r\n        );\r\n        let cntRadioButtons = 0;\r\n        if (currentRadioButtonsGroup) {\r\n          currentRadioButtonsGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntRadioButtons += (cb.selectors as any)?.filter(\r\n                (radio) => radio.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntRadioButtons;\r\n      }\r\n      if (filter.select) {\r\n        const select = filter.select as IgoOgcSelector;\r\n        const currentSelectGroup = select.groups.find((gr) => gr.enabled);\r\n        let cntSelect = 0;\r\n        if (currentSelectGroup) {\r\n          currentSelectGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntSelect += (cb.selectors as any)?.filter(\r\n                (multi) => multi.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntSelect;\r\n      }\r\n      if (filter.autocomplete) {\r\n        const autocomplete = filter.autocomplete as IgoOgcSelector;\r\n        const currentAutocompleteGroup = autocomplete.groups.find(\r\n          (gr) => gr.enabled\r\n        );\r\n        let cntAutocomplete = 0;\r\n        if (currentAutocompleteGroup) {\r\n          currentAutocompleteGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntAutocomplete += (cb.selectors as any)?.filter(\r\n                (autocomplete) => autocomplete.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntAutocomplete;\r\n      }\r\n    } else if (filter && filter.filters && !filter.filters.filters) {\r\n      return 1;\r\n    } else if (filter && filter.filters && filter.filters.filters) {\r\n      return filter.filters.filters.length;\r\n    }\r\n    if (\r\n      filter.filters &&\r\n      filter.filters.operator === 'During' &&\r\n      filter.filters.active &&\r\n      filter.interfaceOgcFilters &&\r\n      filter.interfaceOgcFilters[0].active\r\n    ) {\r\n      const filterActiveValue = filter.interfaceOgcFilters[0];\r\n      if (filter.filters.calendarModeYear) {\r\n        // year mode check just year\r\n        if (\r\n          filterActiveValue.begin.substring(0, 4) !==\r\n            this.options.minDate.substring(0, 4) ||\r\n          filterActiveValue.end.substring(0, 4) !==\r\n            this.options.maxDate.substring(0, 4)\r\n        ) {\r\n          cnt += 1;\r\n        }\r\n      } else if (\r\n        filterActiveValue.begin !== this.options.minDate ||\r\n        filterActiveValue.end !== this.options.maxDate\r\n      ) {\r\n        cnt += 1;\r\n      }\r\n    }\r\n    return cnt > 0 ? cnt : undefined;\r\n  }\r\n\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    if (value) {\r\n      this.options = this.layer.dataSource\r\n        .options as OgcFilterableDataSourceOptions;\r\n    }\r\n  }\r\n  private _layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  @Input() header: boolean;\r\n\r\n  public ogcFilterCollapse = false;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.options = this.layer.dataSource\r\n      .options as OgcFilterableDataSourceOptions;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { default as moment } from 'moment';\r\n\r\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\r\n\r\n@Injectable()\r\nexport class OGCFilterTimeService {\r\n  readonly defaultStepMillisecond = 60000;\r\n\r\n  constructor() {}\r\n\r\n  step(datasource: OgcFilterableDataSource, currentFilter): string {\r\n    return datasource.options.stepDate\r\n      ? datasource.options.stepDate\r\n      : currentFilter.step;\r\n  }\r\n\r\n  stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\r\n    const step = moment\r\n      .duration(this.step(dataSource, currentFilter))\r\n      .asMilliseconds();\r\n    return step === 0 ? this.defaultStepMillisecond : step;\r\n  }\r\n\r\n  stepIsYearDuration(step: string) {\r\n    const year = moment.duration(step);\r\n    return (\r\n      year.years() !== 0 &&\r\n      year.months() === 0 &&\r\n      year.weeks() === 0 &&\r\n      year.days() === 0 &&\r\n      year.hours() === 0 &&\r\n      year.minutes() === 0\r\n    );\r\n  }\r\n\r\n  stepIsMonthDuration(step: string) {\r\n    const month = moment.duration(step);\r\n    return (\r\n      month.months() !== 0 &&\r\n      month.weeks() === 0 &&\r\n      month.days() === 0 &&\r\n      month.hours() === 0 &&\r\n      month.minutes() === 0\r\n    );\r\n  }\r\n\r\n  stepIsWeekDuration(step: string) {\r\n    const week = moment.duration(step);\r\n    return (\r\n      week.weeks() !== 0 &&\r\n      week.days() === 7 &&\r\n      week.hours() === 0 &&\r\n      week.minutes() === 0\r\n    );\r\n  }\r\n\r\n  stepIsDayDuration(step: string) {\r\n    const day = moment.duration(step);\r\n    return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\r\n  }\r\n\r\n  stepIsHourDuration(step: string) {\r\n    const hour = moment.duration(step);\r\n    return hour.hours() !== 0 && hour.minutes() === 0;\r\n  }\r\n\r\n  stepIsMinuteDuration(step: string) {\r\n    const minute = moment.duration(step);\r\n    return minute.minutes() !== 0;\r\n  }\r\n\r\n  dateToNumber(date: Date): number {\r\n    let newDate = new Date();\r\n    if (date) {\r\n      newDate = new Date(date);\r\n    }\r\n    return newDate.getTime();\r\n  }\r\n\r\n  public addStep(value, stepMillisecond) {\r\n    return moment(value).add(stepMillisecond, 'milliseconds').toDate();\r\n  }\r\n\r\n  public subtractStep(value, stepMillisecond) {\r\n    return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\r\n  }\r\n}\r\n","<form [formGroup]=\"form\">\r\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\r\n    <div\r\n      class=\"pushButtonGroups\"\r\n      *ngIf=\"selector.selectorType === 'pushButton'\"\r\n    >\r\n      <mat-divider></mat-divider>\r\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName=\"pushButtonsGroup\"\r\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            [(value)]=\"currentPushButtonsGroup\"\r\n          >\r\n            <mat-option\r\n              *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\r\n              [value]=\"selectorGroup\"\r\n              >{{ selectorGroup.title }}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <ng-container\r\n        *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\"\r\n      >\r\n        <h3>{{ bundle.title }}</h3>\r\n        <mat-button-toggle-group\r\n          formControlName=\"pushButtons\"\r\n          class=\"mat-typography\"\r\n          appearance=\"legacy\"\r\n          vertical=\"{{ bundleIsVertical(bundle) }}\"\r\n          multiple=\"true\"\r\n        >\r\n          <mat-button-toggle\r\n            *ngFor=\"let ogcPushButton of bundle.selectors\"\r\n            [matTooltip]=\"getToolTip(ogcPushButton)\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            matTooltipClass=\"material-tooltip\"\r\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\r\n            [checked]=\"ogcPushButton.enabled\"\r\n            (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\r\n            [value]=\"ogcPushButton\"\r\n            >{{ ogcPushButton.title }}\r\n          </mat-button-toggle>\r\n        </mat-button-toggle-group>\r\n      </ng-container>\r\n    </div>\r\n\r\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\r\n      <mat-divider></mat-divider>\r\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName=\"checkboxesGroup\"\r\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            [(value)]=\"currentCheckboxesGroup\"\r\n          >\r\n            <mat-option\r\n              *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\r\n              [value]=\"selectorGroup\"\r\n              >{{ selectorGroup.title }}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <ng-container\r\n        *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\"\r\n      >\r\n        <h3>{{ bundle.title }}</h3>\r\n        <div class=\"checkboxes mat-typography\">\r\n          <mat-checkbox\r\n            *ngFor=\"let ogcCheckbox of bundle.selectors\"\r\n            [matTooltip]=\"getToolTip(ogcCheckbox)\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            matTooltipClass=\"material-tooltip\"\r\n            [checked]=\"ogcCheckbox.enabled\"\r\n            (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\r\n            [value]=\"ogcCheckbox\"\r\n            >{{ ogcCheckbox.title }}\r\n          </mat-checkbox>\r\n        </div>\r\n        <p\r\n          *ngIf=\"\r\n            isLessResults(bundle, 'checkbox') ||\r\n            isMoreResults(bundle, 'checkbox')\r\n          \"\r\n        >\r\n          <u\r\n            *ngIf=\"isLessResults(bundle, 'checkbox')\"\r\n            class=\"lessResults mat-typography\"\r\n            (click)=\"displayLessResults('checkbox')\"\r\n            >{{ 'igo.geo.filter.displayLessResults' | translate }}\r\n          </u>\r\n          <u\r\n            *ngIf=\"isMoreResults(bundle, 'checkbox')\"\r\n            class=\"moreResults mat-typography\"\r\n            (click)=\"displayMoreResults('checkbox')\"\r\n            >{{ 'igo.geo.filter.displayMoreResults' | translate }}\r\n          </u>\r\n        </p>\r\n      </ng-container>\r\n    </div>\r\n\r\n    <div\r\n      class=\"radioButtonGroups\"\r\n      *ngIf=\"selector.selectorType === 'radioButton'\"\r\n    >\r\n      <mat-divider></mat-divider>\r\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName=\"radioButtonsGroup\"\r\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            [(value)]=\"currentRadioButtonsGroup\"\r\n          >\r\n            <mat-option\r\n              *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\r\n              [value]=\"selectorGroup\"\r\n              >{{ selectorGroup.title }}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <ng-container\r\n        *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\"\r\n      >\r\n        <h3>{{ bundle.title }}</h3>\r\n        <mat-radio-group formControlName=\"radioButtons\" class=\"mat-typography\">\r\n          <mat-radio-button\r\n            *ngIf=\"bundle.unfiltered\"\r\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            matTooltipClass=\"material-tooltip\"\r\n            (change)=\"emptyRadioButtons()\"\r\n            >{{ 'igo.geo.filter.resetFilters' | translate }}\r\n          </mat-radio-button>\r\n          <mat-radio-button\r\n            *ngFor=\"let ogcRadioButton of bundle.selectors\"\r\n            [matTooltip]=\"getToolTip(ogcRadioButton)\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            matTooltipClass=\"material-tooltip\"\r\n            [checked]=\"ogcRadioButton.enabled\"\r\n            (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\r\n            [value]=\"ogcRadioButton\"\r\n            >{{ ogcRadioButton.title }}\r\n          </mat-radio-button>\r\n          <p\r\n            *ngIf=\"\r\n              isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\r\n            \"\r\n          >\r\n            <u\r\n              *ngIf=\"isLessResults(bundle, 'radio')\"\r\n              class=\"lessResults mat-typography\"\r\n              (click)=\"displayLessResults('radio')\"\r\n              >{{ 'igo.geo.filter.displayLessResults' | translate }}\r\n            </u>\r\n            <u\r\n              *ngIf=\"isMoreResults(bundle, 'radio')\"\r\n              class=\"moreResults mat-typography\"\r\n              (click)=\"displayMoreResults('radio')\"\r\n              >{{ 'igo.geo.filter.displayMoreResults' | translate }}\r\n            </u>\r\n          </p>\r\n        </mat-radio-group>\r\n      </ng-container>\r\n    </div>\r\n\r\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\r\n      <mat-divider></mat-divider>\r\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName=\"selectGroup\"\r\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            [(value)]=\"currentSelectGroup\"\r\n          >\r\n            <mat-option\r\n              *ngFor=\"let selectorGroup of getSelectGroups()\"\r\n              [value]=\"selectorGroup\"\r\n              >{{ selectorGroup.title }}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\r\n        <h3>{{ bundle.title }}</h3>\r\n        <div class=\"groupsSelector\">\r\n          <mat-button\r\n            *ngIf=\"bundle.unfiltered && !bundle.multiple\"\r\n            mat-icon-button\r\n            color=\"warn\"\r\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            matTooltipClass=\"material-tooltip\"\r\n            (click)=\"emptySelect()\"\r\n          >\r\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\r\n          </mat-button>\r\n          <mat-form-field\r\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\r\n          >\r\n            <div *ngIf=\"bundle.multiple; else notMulti\">\r\n              <mat-select\r\n                #selection\r\n                [multiple]=\"bundle.multiple\"\r\n                [placeholder]=\"bundle.title\"\r\n                formControlName=\"selectMulti\"\r\n              >\r\n                <div class=\"checkboxes mat-typography\">\r\n                  <mat-checkbox\r\n                    *ngIf=\"bundle.multiple\"\r\n                    [(ngModel)]=\"selectAllSelected\"\r\n                    [ngModelOptions]=\"{ standalone: true }\"\r\n                    (change)=\"toggleAllSelection()\"\r\n                    >Tous\r\n                  </mat-checkbox>\r\n                </div>\r\n                <mat-option\r\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\r\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\r\n                  tooltip-position=\"below\"\r\n                  matTooltipDelay=\"500\"\r\n                  matTooltipClass=\"material-tooltip\"\r\n                  (onSelectionChange)=\"\r\n                    selectOptionClick($event.source.value, bundle, $event)\r\n                  \"\r\n                  [value]=\"ogcSelect\"\r\n                  >{{ ogcSelect.title }}\r\n                </mat-option>\r\n              </mat-select>\r\n            </div>\r\n            <ng-template #notMulti>\r\n              <mat-select [placeholder]=\"bundle.title\" formControlName=\"select\">\r\n                <mat-option\r\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\r\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\r\n                  tooltip-position=\"below\"\r\n                  matTooltipDelay=\"500\"\r\n                  matTooltipClass=\"material-tooltip\"\r\n                  [value]=\"ogcSelect\"\r\n                  (onSelectionChange)=\"\r\n                    selectOptionClick($event.source.value, bundle)\r\n                  \"\r\n                  >{{ ogcSelect.title }}\r\n                </mat-option>\r\n              </mat-select>\r\n            </ng-template>\r\n          </mat-form-field>\r\n        </div>\r\n      </ng-container>\r\n    </div>\r\n\r\n    <div\r\n      class=\"autocompleteGroups\"\r\n      *ngIf=\"selector.selectorType === 'autocomplete'\"\r\n    >\r\n      <mat-divider></mat-divider>\r\n      <div class=\"groupsSelector\" *ngIf=\"getAutocompleteGroups().length > 1\">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName=\"autocompleteGroup\"\r\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            [(value)]=\"currentAutocompleteGroup\"\r\n          >\r\n            <mat-option\r\n              *ngFor=\"let autocompleteGroup of getAutocompleteGroups()\"\r\n              [value]=\"autocompleteGroup\"\r\n              >{{ autocompleteGroup.title }}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <ng-container\r\n        *ngFor=\"let bundle of currentAutocompleteGroup.computedSelectors\"\r\n      >\r\n        <h3>{{ bundle.title }}</h3>\r\n        <div class=\"groupsSelector\">\r\n          <mat-button\r\n            *ngIf=\"bundle.unfiltered\"\r\n            mat-icon-button\r\n            color=\"warn\"\r\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\r\n            tooltip-position=\"below\"\r\n            matTooltipShowDelay=\"500\"\r\n            matTooltipClass=\"material-tooltip\"\r\n            (click)=\"emptyAutocomplete()\"\r\n          >\r\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\r\n          </mat-button>\r\n          <mat-form-field\r\n            *ngIf=\"filteredOgcAutocomplete[bundle.id]\"\r\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\r\n          >\r\n            <input\r\n              matInput\r\n              type=\"text\"\r\n              formControlName=\"autocomplete\"\r\n              #autocomplete\r\n              class=\"autocomplete\"\r\n              [matAutocomplete]=\"auto\"\r\n              [placeholder]=\"bundle.title\"\r\n            />\r\n            <mat-autocomplete\r\n              #auto=\"matAutocomplete\"\r\n              #autocomplete\r\n              (optionSelected)=\"autocompleteOptionClick($event.option.value)\"\r\n              [displayWith]=\"displayFn\"\r\n            >\r\n              <mat-option\r\n                *ngFor=\"\r\n                  let ogcAutocomplete of filteredOgcAutocomplete[bundle.id]\r\n                    | async\r\n                \"\r\n                [value]=\"ogcAutocomplete\"\r\n              >\r\n                {{ ogcAutocomplete.value }}\r\n              </mat-option>\r\n            </mat-autocomplete>\r\n          </mat-form-field>\r\n        </div>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n</form>\r\n\r\n<div *ngIf=\"isTemporalOperator()\">\r\n  <mat-divider></mat-divider>\r\n  <h3 *ngIf=\"!currentFilter.title\">\r\n    {{ 'igo.geo.filter.reportingDate' | translate }}\r\n  </h3>\r\n  <h3 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h3>\r\n  <igo-ogc-filter-time\r\n    [(datasource)]=\"datasource\"\r\n    [(currentFilter)]=\"currentFilter\"\r\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\"\r\n  >\r\n  </igo-ogc-filter-time>\r\n</div>\r\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  ViewChild\r\n} from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { DOMService, DOMValue } from '@igo2/common';\r\n\r\nimport {\r\n  OgcFilterableDataSource,\r\n  IgoOgcFilterObject,\r\n  OgcPushButton,\r\n  OgcSelectorBundle,\r\n  SelectorGroup\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { OGCFilterService } from '../shared/ogc-filter.service';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { debounceTime, map } from 'rxjs/operators';\r\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\r\nimport { MatSelect } from '@angular/material/select';\r\nimport { MatOption } from '@angular/material/core';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-selection',\r\n  templateUrl: './ogc-filter-selection.component.html',\r\n  styleUrls: ['./ogc-filter-selection.component.scss'],\r\n  providers: [DOMService]\r\n})\r\nexport class OgcFilterSelectionComponent implements OnInit {\r\n  @ViewChild('selection') sel: MatSelect;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() checkboxesIndex = 5;\r\n  @Input() radioButtonsIndex = 5;\r\n  @Input() baseIndex = 5;\r\n\r\n  @Input()\r\n  get currentFilter(): any {\r\n    return this._currentFilter;\r\n  }\r\n  set currentFilter(value) {\r\n    this._currentFilter = value;\r\n    if (this._currentFilter?.sliderOptions) {\r\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\r\n    }\r\n  }\r\n  private _currentFilter: any;\r\n\r\n  public ogcFilterOperator = OgcFilterOperator;\r\n\r\n  public form: UntypedFormGroup;\r\n  private ogcFilterWriter: OgcFilterWriter;\r\n  public color = 'primary';\r\n  public selectAllSelected = false;\r\n  public selectEnabled$ = new BehaviorSubject(undefined);\r\n  public selectEnableds$ = new BehaviorSubject([]);\r\n  public autocompleteEnabled$ = new BehaviorSubject(undefined);\r\n  public filteredOgcAutocomplete = {};\r\n\r\n  public applyFiltersTimeout;\r\n\r\n  get ogcFiltersSelectors() {\r\n    const ogcSelector = [];\r\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.select) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.autocomplete);\r\n    }\r\n    ogcSelector.sort((a, b) => {\r\n      if (a.order < b.order) {\r\n        return -1;\r\n      }\r\n      if (a.order > b.order) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n    return ogcSelector;\r\n  }\r\n\r\n  get currentPushButtonsGroup() {\r\n    return this.form.get('pushButtonsGroup').value;\r\n  }\r\n  set currentPushButtonsGroup(value) {\r\n    this.form.patchValue({ pushButtonsGroup: value });\r\n  }\r\n\r\n  get currentCheckboxesGroup() {\r\n    return this.form.get('checkboxesGroup').value;\r\n  }\r\n  set currentCheckboxesGroup(value) {\r\n    this.form.patchValue({ checkboxesGroup: value });\r\n  }\r\n\r\n  get currentRadioButtonsGroup() {\r\n    return this.form.get('radioButtonsGroup').value;\r\n  }\r\n  set currentRadioButtonsGroup(value) {\r\n    this.form.patchValue({ radioButtonsGroup: value });\r\n  }\r\n\r\n  get currentSelectGroup() {\r\n    return this.form.get('selectGroup').value;\r\n  }\r\n  set currentSelectGroup(value) {\r\n    this.form.patchValue({ selectGroup: value });\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  get currentAutocompleteGroup() {\r\n    return this.form.get('autocompleteGroup').value;\r\n  }\r\n  set currentAutocompleteGroup(value) {\r\n    this.form.patchValue({ autocompleteGroup: value });\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  get selectEnabled() {\r\n    return this.selectEnabled$.value;\r\n  }\r\n\r\n  set selectEnabled(value) {\r\n    this.selectEnabled$.next(value);\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors?.forEach((selector) => {\r\n        value === selector\r\n          ? (selector.enabled = true)\r\n          : (selector.enabled = false);\r\n      });\r\n    });\r\n\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  get selectEnableds() {\r\n    return this.selectEnableds$.value;\r\n  }\r\n\r\n  set selectEnableds(value) {\r\n    this.selectEnableds$.next(value);\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors?.forEach((selector) => {\r\n        value.includes(selector)\r\n          ? (selector.enabled = true)\r\n          : (selector.enabled = false);\r\n      });\r\n    });\r\n\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  get autocompleteEnabled() {\r\n    return this.autocompleteEnabled$.value;\r\n  }\r\n\r\n  set autocompleteEnabled(value) {\r\n    this.autocompleteEnabled$.next(value);\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors?.forEach((selector) => {\r\n        value === selector.title\r\n          ? (selector.enabled = true)\r\n          : (selector.enabled = false);\r\n      });\r\n    });\r\n\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  constructor(\r\n    private ogcFilterService: OGCFilterService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private domService: DOMService,\r\n    private configService: ConfigService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {\r\n    this.ogcFilterWriter = new OgcFilterWriter();\r\n    this.buildForm();\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      pushButtons: ['', [Validators.required]],\r\n      radioButtons: ['', [Validators.required]],\r\n      pushButtonsGroup: ['', [Validators.required]],\r\n      checkboxesGroup: ['', [Validators.required]],\r\n      radioButtonsGroup: ['', [Validators.required]],\r\n      selectGroup: ['', [Validators.required]],\r\n      select: ['', [Validators.required]],\r\n      selectMulti: ['', [Validators.required]],\r\n      autocompleteGroup: ['', [Validators.required]],\r\n      autocomplete: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  getPushButtonsGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\r\n      return this.datasource.options.ogcFilters.pushButtons.groups;\r\n    }\r\n  }\r\n\r\n  getCheckboxesGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\r\n      return this.datasource.options.ogcFilters.checkboxes.groups;\r\n    }\r\n  }\r\n\r\n  getRadioButtonsGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\r\n      return this.datasource.options.ogcFilters.radioButtons.groups;\r\n    }\r\n  }\r\n\r\n  getSelectGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.select) {\r\n      return this.datasource.options.ogcFilters.select.groups;\r\n    }\r\n  }\r\n\r\n  getAutocompleteGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\r\n      return this.datasource.options.ogcFilters.autocomplete.groups;\r\n    }\r\n  }\r\n\r\n  async ngOnInit() {\r\n    if (this.datasource.options.ogcFilters) {\r\n      if (this.datasource.options.ogcFilters.pushButtons) {\r\n        this.currentPushButtonsGroup =\r\n          this.datasource.options.ogcFilters.pushButtons.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.pushButtons.groups[0];\r\n      }\r\n      if (this.datasource.options.ogcFilters.checkboxes) {\r\n        this.currentCheckboxesGroup =\r\n          this.datasource.options.ogcFilters.checkboxes.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.checkboxes.groups[0];\r\n      }\r\n      if (this.datasource.options.ogcFilters.radioButtons) {\r\n        this.currentRadioButtonsGroup =\r\n          this.datasource.options.ogcFilters.radioButtons.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.radioButtons.groups[0];\r\n      }\r\n      if (this.datasource.options.ogcFilters.select) {\r\n        this.currentSelectGroup =\r\n          this.datasource.options.ogcFilters.select.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.select.groups[0];\r\n        this.getSelectEnabled();\r\n        await this.getSelectDomValues();\r\n      }\r\n      if (this.datasource.options.ogcFilters.autocomplete) {\r\n        this.currentAutocompleteGroup =\r\n          this.datasource.options.ogcFilters.autocomplete.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.autocomplete.groups[0];\r\n        this.getAutocompleteEnabled();\r\n        await this.getAutocompleteDomValues();\r\n      }\r\n      this.applyFilters();\r\n    }\r\n\r\n    this.form\r\n      .get('pushButtonsGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onPushButtonsChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('checkboxesGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onCheckboxesChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('radioButtonsGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onRadioButtonsChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('selectGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onSelectChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('autocompleteGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onAutocompleteChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('pushButtons')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('radioButtons')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.applyFilters();\r\n      });\r\n  }\r\n\r\n  private getSelectEnabled() {\r\n    const enableds = [];\r\n    let enabled;\r\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\r\n      if (compSelect.multiple) {\r\n        compSelect.selectors?.forEach((selector) => {\r\n          if (selector.enabled) {\r\n            enableds.push(selector);\r\n          }\r\n        });\r\n        this.selectEnableds = enableds;\r\n        this.form.controls['selectMulti'].setValue(enableds);\r\n      } else {\r\n        compSelect.selectors?.forEach((selector) => {\r\n          if (selector.enabled) {\r\n            enabled = selector;\r\n          }\r\n        });\r\n        this.form.controls['select'].reset(enabled);\r\n        this.selectEnabled$.subscribe((value) => {\r\n          if (this.form.controls['select'].value !== value) {\r\n            this.form.controls['select'].setValue(value);\r\n          }\r\n        });\r\n        this.selectEnabled = enabled;\r\n      }\r\n    });\r\n  }\r\n\r\n  private getAutocompleteEnabled() {\r\n    let enabled;\r\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors?.forEach((selector) => {\r\n        if (selector.enabled) {\r\n          const dom = {\r\n            id: selector.filters.expression,\r\n            value: selector.title\r\n          };\r\n          enabled = selector.title;\r\n          this.form.controls['autocomplete'].setValue(dom);\r\n        }\r\n      });\r\n      this.autocompleteEnabled = enabled;\r\n    });\r\n  }\r\n\r\n  getToolTip(selector): string {\r\n    let toolTip;\r\n    if (selector.tooltip) {\r\n      if (Array.isArray(selector.tooltip)) {\r\n        toolTip = selector.tooltip.join('\\n');\r\n      } else {\r\n        toolTip = selector.tooltip;\r\n      }\r\n    }\r\n    return toolTip || '';\r\n  }\r\n\r\n  async getSelectDomValues() {\r\n    for (const bundle of this.datasource.options.ogcFilters.select.bundles) {\r\n      if (bundle.domSelectors) {\r\n        let domValues;\r\n        for (const domSelector of bundle.domSelectors) {\r\n          let filterDOM;\r\n          for (const domOptions of this.configService.getConfig('dom')) {\r\n            if (\r\n              domSelector.id === domOptions.id ||\r\n              domSelector.name === domOptions.name\r\n            ) {\r\n              filterDOM = {\r\n                id: domOptions.id,\r\n                url: domOptions.url,\r\n                name: domOptions.name,\r\n                values: domOptions.values\r\n              };\r\n            }\r\n          }\r\n          filterDOM.url\r\n            ? (domValues = (await this.domService.getDom(\r\n                filterDOM\r\n              )) as DOMValue[])\r\n            : (domValues = filterDOM.values);\r\n\r\n          if (domValues) {\r\n            let newBundle = bundle;\r\n            newBundle.selectors = [];\r\n            let selector;\r\n            for (const value of domValues) {\r\n              if (bundle.multiple) {\r\n                let enabled;\r\n                this.selectEnableds?.find((sel) => sel.title === value.value)\r\n                  ? (enabled = true)\r\n                  : (enabled = false);\r\n                selector = {\r\n                  title: value.value,\r\n                  enabled,\r\n                  filters: {\r\n                    operator: domSelector.operator,\r\n                    propertyName: domSelector.propertyName,\r\n                    expression: value.id\r\n                  }\r\n                };\r\n              } else {\r\n                selector = {\r\n                  title: value.value,\r\n                  enabled:\r\n                    this.selectEnabled?.title === value.value ? true : false,\r\n                  filters: {\r\n                    operator: domSelector.operator,\r\n                    propertyName: domSelector.propertyName,\r\n                    expression: value.id\r\n                  }\r\n                };\r\n              }\r\n              newBundle.selectors.push(selector);\r\n            }\r\n            this.getSelectGroups()\r\n              .find((group) => group.ids.includes(newBundle.id))\r\n              .computedSelectors.find(\r\n                (comp) => comp.title === newBundle.title\r\n              ).selectors = newBundle.selectors;\r\n          }\r\n        }\r\n        this.getSelectEnabled();\r\n      }\r\n    }\r\n  }\r\n\r\n  async getAutocompleteDomValues() {\r\n    for (const bundle of this.datasource.options.ogcFilters.autocomplete\r\n      .bundles) {\r\n      if (bundle.domSelectors) {\r\n        let domValues;\r\n        for (const domSelector of bundle.domSelectors) {\r\n          let filterDOM;\r\n          for (const domOptions of this.configService.getConfig('dom')) {\r\n            if (\r\n              domSelector.id === domOptions.id ||\r\n              domSelector.name === domOptions.name\r\n            ) {\r\n              filterDOM = {\r\n                id: domOptions.id,\r\n                url: domOptions.url,\r\n                name: domOptions.name,\r\n                values: domOptions.values\r\n              };\r\n            }\r\n          }\r\n          filterDOM.url\r\n            ? (domValues = (await this.domService.getDom(\r\n                filterDOM\r\n              )) as DOMValue[])\r\n            : (domValues = filterDOM.values);\r\n\r\n          if (domValues) {\r\n            let newBundle = bundle;\r\n            newBundle.selectors = [];\r\n            let selector;\r\n            for (const value of domValues) {\r\n              selector = {\r\n                title: value.value,\r\n                enabled:\r\n                  this.autocompleteEnabled &&\r\n                  this.autocompleteEnabled === value.value\r\n                    ? true\r\n                    : false,\r\n                filters: {\r\n                  operator: domSelector.operator,\r\n                  propertyName: domSelector.propertyName,\r\n                  expression: value.id\r\n                }\r\n              };\r\n              newBundle.selectors.push(selector);\r\n            }\r\n            this.getAutocompleteGroups()\r\n              .find((group) => group.ids.includes(newBundle.id))\r\n              .computedSelectors.find(\r\n                (comp) => comp.title === newBundle.title\r\n              ).selectors = newBundle.selectors;\r\n          }\r\n        }\r\n\r\n        this.filteredOgcAutocomplete[bundle.id] = new Observable<any[]>();\r\n        this.cdRef.detectChanges();\r\n        this.filteredOgcAutocomplete[bundle.id] = this.form.controls[\r\n          'autocomplete'\r\n        ].valueChanges.pipe(\r\n          map((value) => {\r\n            if (value.length) {\r\n              return domValues?.filter((option) => {\r\n                const filterNormalized = value\r\n                  ? value\r\n                      .toLowerCase()\r\n                      .normalize('NFD')\r\n                      .replace(/[\\u0300-\\u036f]/g, '')\r\n                  : '';\r\n                const featureNameNormalized = option.value\r\n                  .toLowerCase()\r\n                  .normalize('NFD')\r\n                  .replace(/[\\u0300-\\u036f]/g, '');\r\n                return featureNameNormalized.includes(filterNormalized);\r\n              });\r\n            }\r\n          })\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  // getButtonStyle(pb: OgcPushButton): {} {\r\n\r\n  //   let styles;\r\n  //   if (pb.color) {\r\n  //     styles = {\r\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\r\n  //     };\r\n  //   } else {\r\n  //     styles = {\r\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\r\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\r\n  //     }\r\n  //   }\r\n  //   return styles;\r\n  // }\r\n\r\n  getButtonColor(pushButton: OgcPushButton): {} {\r\n    let styles;\r\n    if (pushButton.color && pushButton.enabled) {\r\n      styles = {\r\n        'background-color': `rgba(${pushButton.color})`\r\n      };\r\n    }\r\n    return styles;\r\n  }\r\n\r\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\r\n    return bundle.vertical ? bundle.vertical : false;\r\n  }\r\n\r\n  private onPushButtonsChangeGroup() {\r\n    this.getPushButtonsGroups().map((group) => (group.enabled = false));\r\n    this.getPushButtonsGroups().find(\r\n      (group) => group === this.currentPushButtonsGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  private onCheckboxesChangeGroup() {\r\n    this.getCheckboxesGroups().map((group) => (group.enabled = false));\r\n    this.getCheckboxesGroups().find(\r\n      (group) => group === this.currentCheckboxesGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  private onRadioButtonsChangeGroup() {\r\n    this.getRadioButtonsGroups().map((group) => (group.enabled = false));\r\n    this.getRadioButtonsGroups().find(\r\n      (group) => group === this.currentRadioButtonsGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  private onSelectChangeGroup() {\r\n    this.getSelectGroups().map((group) => (group.enabled = false));\r\n    this.getSelectGroups().find(\r\n      (group) => group === this.currentSelectGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  private onAutocompleteChangeGroup() {\r\n    this.getAutocompleteGroups().map((group) => (group.enabled = false));\r\n    this.getAutocompleteGroups().find(\r\n      (group) => group === this.currentAutocompleteGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  onSelectionChange(currentOgcSelection?, selectorType?) {\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    if (selectorType === 'radioButton') {\r\n      this.emptyRadioButtons();\r\n    }\r\n\r\n    if (currentOgcSelection) {\r\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\r\n    }\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  emptyRadioButtons() {\r\n    this.currentRadioButtonsGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors.map((selector) => (selector.enabled = false));\r\n\r\n      this.applyFiltersTimeout = setTimeout(() => {\r\n        this.applyFilters();\r\n      }, 750);\r\n    });\r\n  }\r\n\r\n  emptySelect() {\r\n    this.selectEnabled = undefined;\r\n  }\r\n\r\n  emptyAutocomplete() {\r\n    this.autocompleteEnabled = undefined;\r\n    this.form.controls['autocomplete'].setValue('');\r\n    this.form.controls['autocomplete'].markAsUntouched();\r\n  }\r\n\r\n  toggleAllSelection() {\r\n    if (this.selectAllSelected) {\r\n      const enableds = [];\r\n      this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\r\n        compSelect.selectors?.forEach((selector) => {\r\n          enableds.push(selector);\r\n        });\r\n      });\r\n      this.sel.options.forEach((item: MatOption) => item.select());\r\n      this.selectEnableds = enableds;\r\n    } else {\r\n      this.sel.options.forEach((item: MatOption) => item.deselect());\r\n      this.selectEnableds = [];\r\n    }\r\n  }\r\n\r\n  selectOptionClick(value, bundle, event?) {\r\n    if (bundle.multiple) {\r\n      const enableds = this.selectEnableds;\r\n      let newStatus = true;\r\n      this.sel.options.forEach((item: MatOption) => {\r\n        if (!item.selected) {\r\n          newStatus = false;\r\n        }\r\n      });\r\n      this.selectAllSelected = newStatus;\r\n      if (event.isUserInput) {\r\n        if (enableds.length) {\r\n          for (const enabled of enableds) {\r\n            if (enabled.title === value.title) {\r\n              if (enabled.enabled && value.enabled) {\r\n                enableds.splice(enableds.indexOf(enabled), 1);\r\n                this.selectEnableds = enableds;\r\n                break;\r\n              }\r\n            } else if (enableds.indexOf(enabled) === enableds.length - 1) {\r\n              enableds.push(value);\r\n              this.selectEnableds = enableds;\r\n              break;\r\n            }\r\n          }\r\n        } else {\r\n          enableds.push(value);\r\n          this.selectEnableds = enableds;\r\n        }\r\n      }\r\n    } else {\r\n      this.selectEnabled = value;\r\n    }\r\n  }\r\n\r\n  autocompleteOptionClick(value) {\r\n    this.autocompleteEnabled = value.value;\r\n  }\r\n\r\n  displayFn(dom): string {\r\n    return dom ? dom.value : undefined;\r\n  }\r\n\r\n  private applyFilters() {\r\n    let filterQueryString = '';\r\n    const conditions = [];\r\n    const currentGroups = [\r\n      this.currentPushButtonsGroup,\r\n      this.currentCheckboxesGroup,\r\n      this.currentRadioButtonsGroup,\r\n      this.currentSelectGroup,\r\n      this.currentAutocompleteGroup\r\n    ];\r\n    for (const currentGroup of currentGroups) {\r\n      if (currentGroup.computedSelectors) {\r\n        currentGroup.computedSelectors.map((selectorBundle) => {\r\n          const bundleCondition = [];\r\n          selectorBundle.selectors\r\n            ?.filter((ogcSelector) => ogcSelector.enabled === true)\r\n            .forEach((enabledSelector) =>\r\n              bundleCondition.push(enabledSelector.filters)\r\n            );\r\n          if (bundleCondition.length >= 1) {\r\n            if (bundleCondition.length === 1) {\r\n              conditions.push(bundleCondition[0]);\r\n            } else {\r\n              conditions.push({\r\n                logical: selectorBundle.logical,\r\n                filters: bundleCondition\r\n              });\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n    if (this.isTemporalOperator() && this._currentFilter.active) {\r\n      conditions.push(\r\n        this.datasource.options.ogcFilters.interfaceOgcFilters[0]\r\n      );\r\n    }\r\n    if (conditions.length >= 1) {\r\n      filterQueryString = this.ogcFilterWriter.buildFilter(\r\n        conditions.length === 1\r\n          ? conditions[0]\r\n          : ({ logical: 'And', filters: conditions } as IgoOgcFilterObject)\r\n      );\r\n    }\r\n    if (this.datasource.options.type === 'wms') {\r\n      this.ogcFilterService.filterByOgc(\r\n        this.datasource as WMSDataSource,\r\n        filterQueryString\r\n      );\r\n    }\r\n    if (this.datasource.options.type === 'wfs') {\r\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\r\n      this.datasource.ol.refresh();\r\n    }\r\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\r\n  }\r\n\r\n  isMoreResults(bundle, type) {\r\n    let selectorsLength = 0;\r\n    for (const selectors of bundle.selectors) {\r\n      selectorsLength++;\r\n    }\r\n    const index =\r\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\r\n    return selectorsLength > index;\r\n  }\r\n\r\n  displayMoreResults(type) {\r\n    type === 'radio'\r\n      ? (this.radioButtonsIndex += 5)\r\n      : (this.checkboxesIndex += 5);\r\n    return;\r\n  }\r\n\r\n  isLessResults(bundle, type) {\r\n    let selectorsLength = 0;\r\n    for (const selectors of bundle.selectors) {\r\n      selectorsLength++;\r\n    }\r\n    const index =\r\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\r\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\r\n  }\r\n\r\n  displayLessResults(type) {\r\n    type === 'radio'\r\n      ? (this.radioButtonsIndex = this.baseIndex)\r\n      : (this.checkboxesIndex = this.baseIndex);\r\n    return;\r\n  }\r\n\r\n  isTemporalOperator() {\r\n    return (\r\n      this.currentFilter?.operator?.toLowerCase() ===\r\n      this.ogcFilterOperator.During.toLowerCase()\r\n    );\r\n  }\r\n\r\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        (filter) => filter.filterid === this.currentFilter.filterid\r\n      )[detectedProperty] = value;\r\n\r\n      if (refreshFilter) {\r\n        this.applyFilters();\r\n      }\r\n    }\r\n  }\r\n\r\n  detectProperty(pos?: number): string {\r\n    switch (this.currentFilter.operator) {\r\n      case OgcFilterOperator.PropertyIsNotEqualTo:\r\n      case OgcFilterOperator.PropertyIsEqualTo:\r\n      case OgcFilterOperator.PropertyIsGreaterThan:\r\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\r\n      case OgcFilterOperator.PropertyIsLessThan:\r\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\r\n        return 'expression';\r\n      case OgcFilterOperator.PropertyIsLike:\r\n        return 'pattern';\r\n      case OgcFilterOperator.PropertyIsBetween:\r\n        return pos && pos === 1\r\n          ? 'lowerBoundary'\r\n          : pos && pos === 2\r\n          ? 'upperBoundary'\r\n          : undefined;\r\n      case OgcFilterOperator.During:\r\n        return pos && pos === 1\r\n          ? 'begin'\r\n          : pos && pos === 2\r\n          ? 'end'\r\n          : undefined;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n}\r\n","export enum SpatialFilterQueryType {\r\n  AdmRegion = 'AdmRegion',\r\n  Mun = 'Mun',\r\n  Arrond = 'Arrond',\r\n  CircFed = 'CircFed',\r\n  CircProv = 'CircProv',\r\n  DirReg = 'DirReg',\r\n  MRC = 'MRC',\r\n  RegTour = 'RegTour'\r\n}\r\n\r\nexport enum SpatialFilterType {\r\n  Predefined = 'Predefined',\r\n  Polygon = 'Polygon',\r\n  Point = 'Point'\r\n}\r\n\r\nexport enum SpatialFilterItemType {\r\n  Address = 'Address',\r\n  Thematics = 'Thematics'\r\n}\r\n","<mat-tab-group\r\n  [selectedIndex]=\"selectedTypeIndex.value\"\r\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\r\n  (selectedTabChange)=\"onTypeChange($event)\"\r\n>\r\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' | translate\">\r\n    <mat-form-field>\r\n      <mat-label>{{\r\n        'igo.geo.spatialFilter.searchLabel' | translate\r\n      }}</mat-label>\r\n      <mat-select\r\n        (selectionChange)=\"onSelectionChange()\"\r\n        [(value)]=\"selectedQueryType\"\r\n      >\r\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\r\n          {{ 'igo.geo.terrapi.' + queryType | translate }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n    <igo-spatial-filter-list\r\n      [store]=\"store\"\r\n      [queryType]=\"selectedQueryType\"\r\n      [zone]=\"zone\"\r\n      [layers]=\"layers\"\r\n      (zoneChange)=\"zoneChange.emit($event)\"\r\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\r\n      (bufferChange)=\"bufferChange.emit($event)\"\r\n      (measureUnitChange)=\"measureUnitChange.emit($event)\"\r\n    >\r\n    </igo-spatial-filter-list>\r\n  </mat-tab>\r\n\r\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' | translate\">\r\n    <div class=\"spatial-type-toggle\">\r\n      <mat-button-toggle-group\r\n        [value]=\"activeDrawType\"\r\n        (change)=\"onDrawTypeChange($event.value)\"\r\n      >\r\n        <mat-button-toggle\r\n          [value]=\"spatialType.Polygon\"\r\n          [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' | translate\"\r\n        >\r\n          <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\r\n        </mat-button-toggle>\r\n        <mat-button-toggle\r\n          [value]=\"spatialType.Point\"\r\n          [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' | translate\"\r\n        >\r\n          <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\r\n        </mat-button-toggle>\r\n      </mat-button-toggle-group>\r\n    </div>\r\n  </mat-tab>\r\n</mat-tab-group>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport {\r\n  SpatialFilterQueryType,\r\n  SpatialFilterType\r\n} from '../../shared/spatial-filter.enum';\r\nimport { UntypedFormControl } from '@angular/forms';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { Feature } from '../../../feature';\r\nimport { MeasureLengthUnit } from '../../../measure';\r\nimport { Layer } from '../../../layer';\r\n\r\n/**\r\n * Spatial Filter Type\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-type',\r\n  templateUrl: './spatial-filter-type.component.html',\r\n  styleUrls: ['./spatial-filter-type.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterTypeComponent implements OnInit {\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  public queryType: string[] = [\r\n    'Arrond',\r\n    'CircFed',\r\n    'CircProv',\r\n    'DirReg',\r\n    'Mun',\r\n    'MRC',\r\n    'AdmRegion',\r\n    'RegTour'\r\n  ];\r\n  public selectedTypeIndex = new UntypedFormControl(0);\r\n\r\n  /**\r\n   * Reference to the SpatialFIlterType enum\r\n   * @internal\r\n   */\r\n  public spatialType = SpatialFilterType;\r\n\r\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\r\n\r\n  @Input() selectedQueryType: SpatialFilterQueryType;\r\n\r\n  @Input() zone: Feature;\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  public type: SpatialFilterType;\r\n\r\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\r\n\r\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\r\n\r\n  @Output() zoneChange = new EventEmitter<Feature>();\r\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\r\n\r\n  @Output() bufferChange = new EventEmitter<number>();\r\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    if (this.selectedTypeIndex.value === 0) {\r\n      this.type = this.spatialType.Predefined;\r\n    }\r\n    if (this.selectedTypeIndex.value === 1) {\r\n      this.type = this.activeDrawType;\r\n    }\r\n    this.eventType.emit(this.type);\r\n  }\r\n\r\n  onTypeChange(event) {\r\n    if (this.selectedTypeIndex.value === 0) {\r\n      this.type = SpatialFilterType.Predefined;\r\n    }\r\n    if (this.selectedTypeIndex.value === 1) {\r\n      this.type = this.activeDrawType;\r\n    }\r\n    this.eventType.emit(this.type);\r\n  }\r\n\r\n  onDrawTypeChange(spatialType: SpatialFilterType) {\r\n    this.activeDrawType = spatialType;\r\n    this.eventType.emit(this.activeDrawType);\r\n  }\r\n\r\n  onSelectionChange() {\r\n    this.eventQueryType.emit(this.selectedQueryType);\r\n    this.zoneChange.emit(undefined);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\nimport { map } from 'rxjs/operators';\r\nimport { Observable } from 'rxjs';\r\nimport { Feature } from '../../feature/shared';\r\nimport {\r\n  SpatialFilterQueryType,\r\n  SpatialFilterItemType,\r\n  SpatialFilterType\r\n} from './spatial-filter.enum';\r\nimport { SpatialFilterThematic } from './spatial-filter.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SpatialFilterService {\r\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\r\n\r\n  /*\r\n   * Type association with URL\r\n   */\r\n  public urlFilterList = {\r\n    AdmRegion: 'regadmin',\r\n    Arrond: 'arrondissements',\r\n    CircFed: 'circ-fed',\r\n    CircProv: 'circ-prov',\r\n    DirReg: 'dir-reg',\r\n    MRC: 'mrc',\r\n    Mun: 'municipalites',\r\n    RegTour: 'tourisme',\r\n    bornes: 'bornes-sumi',\r\n    hydro: 'hydro',\r\n    routes: 'routes'\r\n  };\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    private configService: ConfigService\r\n  ) {\r\n    this.baseUrl =\r\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\r\n  }\r\n\r\n  getKeyByValue(object, value) {\r\n    return Object.keys(object).find((key) => object[key] === value);\r\n  }\r\n\r\n  /*\r\n   * Loading data for spatial filter list component (NO GEOMETRY)\r\n   */\r\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\r\n    const urlPath = type as string;\r\n    if (urlPath) {\r\n      return this.http\r\n        .get<{ features: Feature[] }>(\r\n          this.baseUrl + this.urlFilterList[urlPath]\r\n        )\r\n        .pipe(\r\n          map((featureCollection) =>\r\n            featureCollection.features.map((f) => {\r\n              f.meta = {\r\n                id: f.properties.code\r\n              };\r\n              return f;\r\n            })\r\n          )\r\n        );\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Loading item list (STRING)\r\n   */\r\n  loadThematicsList() {\r\n    const url = 'types';\r\n    const items: SpatialFilterThematic[] = [];\r\n    return this.http.get(this.baseUrl + url).pipe(\r\n      map((types: string[]) => {\r\n        types.forEach((type) => {\r\n          if (type.startsWith('lieux')) {\r\n            const item: SpatialFilterThematic = {\r\n              name: undefined,\r\n              source: type\r\n            };\r\n            let substr = type.substring(6, type.length);\r\n            let name = substr;\r\n            if (substr.includes('.')) {\r\n              const index = substr.indexOf('.');\r\n              name = substr.substring(index + 1, substr.length);\r\n              substr = substr.substring(0, index);\r\n            }\r\n            try {\r\n              item.name = this.languageService.translate.instant(\r\n                'igo.geo.terrapi.' + name\r\n              );\r\n            } catch (e) {\r\n              item.name =\r\n                name.substring(0, 1).toUpperCase() +\r\n                name.substring(1, name.length - 1);\r\n            }\r\n\r\n            try {\r\n              item.group = this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.group.' + substr\r\n              );\r\n            } catch (e) {\r\n              item.group =\r\n                substr.substring(0, 1).toUpperCase() +\r\n                substr.substring(1, name.length - 1);\r\n            }\r\n\r\n            items.push(item);\r\n          } else {\r\n            if (this.getKeyByValue(this.urlFilterList, type)) {\r\n              const item: SpatialFilterThematic = {\r\n                name: undefined,\r\n                source: type\r\n              };\r\n              const name = this.getKeyByValue(this.urlFilterList, type);\r\n              try {\r\n                item.name = this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.' + name\r\n                );\r\n              } catch (e) {\r\n                item.name =\r\n                  name.substring(0, 1).toUpperCase() +\r\n                  name.substring(1, name.length - 1);\r\n              }\r\n              item.source = type;\r\n\r\n              items.push(item);\r\n            }\r\n          }\r\n        });\r\n        return items;\r\n      })\r\n    );\r\n  }\r\n\r\n  /*\r\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\r\n   */\r\n  loadFilterItem(\r\n    feature,\r\n    itemType: SpatialFilterItemType,\r\n    type?: SpatialFilterQueryType,\r\n    thematic?: SpatialFilterThematic,\r\n    buffer?: number\r\n  ) {\r\n    if (type) {\r\n      // Predefined type\r\n      const urlType = type as string;\r\n      const url = this.baseUrl + this.urlFilterList[urlType];\r\n      let urlItem = '';\r\n      if (itemType === SpatialFilterItemType.Address) {\r\n        urlItem = 'adresses';\r\n        return this.http\r\n          .get<{ features: Feature[] }>(\r\n            url + '/' + feature.properties.code + '/' + urlItem,\r\n            {\r\n              params: {\r\n                geometry: 'true',\r\n                icon: 'true',\r\n                bufferInput: buffer.toString(),\r\n                simplified: '100'\r\n              }\r\n            }\r\n          )\r\n          .pipe(\r\n            map((featureCollection) =>\r\n              featureCollection.features.map((f) => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: this.languageService.translate.instant(\r\n                    'igo.geo.spatialFilter.Address'\r\n                  ),\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      } else {\r\n        // If thematics search\r\n        urlItem = thematic.source;\r\n        return this.http\r\n          .get<{ features: Feature[] }>(\r\n            url + '/' + feature.properties.code + '/' + urlItem,\r\n            {\r\n              params: {\r\n                geometry: 'true',\r\n                icon: 'true',\r\n                bufferInput: buffer.toString(),\r\n                simplified: '100'\r\n              }\r\n            }\r\n          )\r\n          .pipe(\r\n            map((featureCollection) =>\r\n              featureCollection.features.map((f) => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: thematic.name,\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      }\r\n    } else {\r\n      // Draw type\r\n      const url = this.baseUrl + 'locate';\r\n      if (itemType === SpatialFilterItemType.Address) {\r\n        const urlItem = '?type=adresses';\r\n        return this.http\r\n          .post<{ features: Feature[] }>(url + urlItem, {\r\n            geometry: 'true',\r\n            icon: 'true',\r\n            loc: JSON.stringify(feature),\r\n            bufferInput: buffer.toString(),\r\n            simplified: '100'\r\n          })\r\n          .pipe(\r\n            map((featureCollection) =>\r\n              featureCollection.features.map((f) => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: this.languageService.translate.instant(\r\n                    'igo.geo.spatialFilter.Address'\r\n                  ),\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      } else {\r\n        // If thematics search\r\n        const urlItem = '?type=' + thematic.source;\r\n        return this.http\r\n          .post<{ features: Feature[] }>(url + urlItem, {\r\n            geometry: 'true',\r\n            icon: 'true',\r\n            loc: JSON.stringify(feature),\r\n            bufferInput: buffer.toString(),\r\n            simplified: '100'\r\n          })\r\n          .pipe(\r\n            map((featureCollection) =>\r\n              featureCollection.features.map((f) => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: thematic.name,\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get one territory by id (WITH GEOMETRY)\r\n   */\r\n  loadItemById(\r\n    feature: Feature,\r\n    type: SpatialFilterQueryType\r\n  ): Observable<Feature> {\r\n    const featureType = this.urlFilterList[type];\r\n    const featureCode = '/' + feature.properties.code;\r\n    if (featureType && featureCode) {\r\n      return this.http\r\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\r\n          params: {\r\n            geometry: 'true'\r\n          }\r\n        })\r\n        .pipe(\r\n          map((f) => {\r\n            f.meta = {\r\n              id: f.properties.code,\r\n              alias: f.properties.nom,\r\n              title: f.properties.nom\r\n            };\r\n            return f;\r\n          })\r\n        );\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get buffer geometry\r\n   */\r\n  loadBufferGeometry(\r\n    feature: Feature,\r\n    filterType: SpatialFilterType,\r\n    buffer?: number,\r\n    type?: SpatialFilterQueryType\r\n  ): Observable<Feature> {\r\n    if (filterType === SpatialFilterType.Predefined) {\r\n      const featureType = this.urlFilterList[type];\r\n      const featureCode = '/' + feature.properties.code;\r\n      if (featureType && featureCode) {\r\n        return this.http\r\n          .get<Feature>(this.baseUrl + featureType + featureCode, {\r\n            params: {\r\n              geometry: '100',\r\n              bufferOutput: buffer.toString()\r\n            }\r\n          })\r\n          .pipe(\r\n            map((f) => {\r\n              f.meta = {\r\n                id: f.properties.code,\r\n                alias: f.properties.nom,\r\n                title: f.properties.nom\r\n              };\r\n              return f;\r\n            })\r\n          );\r\n      }\r\n    } else {\r\n      return this.http\r\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\r\n          buffer,\r\n          loc: JSON.stringify(feature)\r\n        })\r\n        .pipe(\r\n          map((f) => {\r\n            return f;\r\n          })\r\n        );\r\n    }\r\n  }\r\n}\r\n","export const MEASURE_UNIT_AUTO = 'auto';\r\n\r\nexport enum MeasureType {\r\n  Length = 'length',\r\n  Area = 'area'\r\n}\r\n\r\nexport enum MeasureLengthUnit {\r\n  Meters = 'meters',\r\n  Kilometers = 'kilometers',\r\n  Miles = 'miles',\r\n  Feet = 'feet'\r\n}\r\n\r\nexport const MeasureLengthUnitAbbreviation = {\r\n  [MeasureLengthUnit.Meters]: 'm',\r\n  [MeasureLengthUnit.Kilometers]: 'km',\r\n  [MeasureLengthUnit.Miles]: 'mi',\r\n  [MeasureLengthUnit.Feet]: 'ft'\r\n};\r\n\r\nexport enum MeasureAreaUnit {\r\n  SquareMeters = 'squareMeters',\r\n  SquareKilometers = 'squareKilometers',\r\n  SquareMiles = 'squareMiles',\r\n  SquareFeet = 'squareFeet',\r\n  Hectares = 'hectares',\r\n  Acres = 'acres'\r\n}\r\n\r\nexport const MeasureAreaUnitAbbreviation = {\r\n  [MeasureAreaUnit.SquareMeters]: 'm',\r\n  [MeasureAreaUnit.SquareKilometers]: 'km',\r\n  [MeasureAreaUnit.SquareMiles]: 'mi',\r\n  [MeasureAreaUnit.SquareFeet]: 'ft',\r\n  [MeasureAreaUnit.Hectares]: 'ha',\r\n  [MeasureAreaUnit.Acres]: 'ac'\r\n};\r\n","import { LanguageService } from '@igo2/core';\r\nimport * as olstyle from 'ol/style';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport { getCenter as olGetCenter } from 'ol/extent';\r\nimport { getLength as olGetLength, getArea as olGetArea } from 'ol/sphere';\r\n\r\nimport { Measure } from './measure.interfaces';\r\nimport {\r\n  MeasureAreaUnit,\r\n  MeasureAreaUnitAbbreviation,\r\n  MeasureLengthUnit,\r\n  MeasureLengthUnitAbbreviation\r\n} from './measure.enum';\r\n\r\n/**\r\n * Convert value from meters to kilometers\r\n * @param value Value in meters\r\n * @returns Value in kilometers\r\n */\r\nexport function metersToKilometers(value: number): number {\r\n  return value * 0.001;\r\n}\r\n\r\n/**\r\n * Convert value from meters to feet\r\n * @param value Value in meters\r\n * @returns Value in feet\r\n */\r\nexport function metersToFeet(value: number): number {\r\n  return value * 3.2808;\r\n}\r\n\r\n/**\r\n * Convert value from meters to miles\r\n * @param value Value in meters\r\n * @returns Value in miles\r\n */\r\nexport function metersToMiles(value: number): number {\r\n  return value * 0.000621;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square kilometers\r\n * @param value Value in square meters\r\n * @returns Value in square kilometers\r\n */\r\nexport function squareMetersToSquareKilometers(value: number): number {\r\n  return value * 0.000001;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square miles\r\n * @param value Value in square meters\r\n * @returns Value in square miles\r\n */\r\nexport function squareMetersToSquareMiles(value: number): number {\r\n  return value * 0.0000003861;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square feet\r\n * @param value Value in square meters\r\n * @returns Value in square feet\r\n */\r\nexport function squareMetersToSquareFeet(value: number): number {\r\n  return value * 10.764;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to hectares\r\n * @param value Value in square meters\r\n * @returns Value in hectares\r\n */\r\nexport function squareMetersToHectares(value: number): number {\r\n  return value * 0.0001;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to acres\r\n * @param value Value in square meters\r\n * @returns Value in acres\r\n */\r\nexport function squareMetersToAcres(value: number): number {\r\n  return value * 0.00024711;\r\n}\r\n\r\n/**\r\n * Convert value from meters to the specified length unit\r\n * @param value Value in meters\r\n * @param unit Length unit\r\n * @returns Value in unit\r\n */\r\nexport function metersToUnit(\r\n  value: number,\r\n  unit: MeasureLengthUnit\r\n): number | undefined {\r\n  const conversionMapper = new Map([\r\n    [MeasureLengthUnit.Meters, (val: number) => val],\r\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\r\n    [MeasureLengthUnit.Miles, metersToMiles],\r\n    [MeasureLengthUnit.Feet, metersToFeet]\r\n  ]);\r\n  const conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to the specified area unit\r\n * @param value Value in meters\r\n * @param unit Area unit\r\n * @returns Value in unit\r\n */\r\nexport function squareMetersToUnit(\r\n  value: number,\r\n  unit: MeasureAreaUnit\r\n): number | undefined {\r\n  const conversionMapper = new Map([\r\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\r\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\r\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\r\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\r\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\r\n    [MeasureAreaUnit.Acres, squareMetersToAcres]\r\n  ]);\r\n  const conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n\r\n/**\r\n * This method format a measure to a readable format\r\n * @param measure Measure\r\n * @param options Formatting options\r\n * @returns Formatted measure\r\n */\r\nexport function formatMeasure(\r\n  measure: number,\r\n  options?: {\r\n    decimal?: number;\r\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\r\n    unitAbbr?: boolean;\r\n    locale?: string;\r\n  },\r\n  languageService?: LanguageService\r\n) {\r\n  let decimal = options.decimal;\r\n  if (decimal === undefined || decimal < 0) {\r\n    decimal = 1;\r\n  }\r\n\r\n  const parts = [];\r\n  if (options.locale !== undefined) {\r\n    parts.push(\r\n      measure.toLocaleString(options.locale, {\r\n        minimumFractionDigits: decimal,\r\n        maximumFractionDigits: decimal\r\n      })\r\n    );\r\n  } else {\r\n    parts.push(measure.toFixed(decimal).toString());\r\n  }\r\n\r\n  if (options.unit !== undefined && options.unitAbbr === true) {\r\n    if (languageService) {\r\n      parts.push(\r\n        MeasureLengthUnitAbbreviation[options.unit]\r\n          ? languageService.translate.instant(\r\n              'igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]\r\n            )\r\n          : languageService.translate.instant(\r\n              'igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit]\r\n            )\r\n      );\r\n    } else {\r\n      parts.push(\r\n        MeasureLengthUnitAbbreviation[options.unit] ||\r\n          MeasureAreaUnitAbbreviation[options.unit]\r\n      );\r\n    }\r\n  }\r\n\r\n  return parts.filter((p) => p !== undefined).join(' ');\r\n}\r\n\r\n/**\r\n * Compute best length measure unit for a given measure in meters\r\n * @param value Value in meters\r\n * @returns Measure unit\r\n */\r\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\r\n  let unit = MeasureLengthUnit.Meters;\r\n  let converted = value;\r\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\r\n  while (converted > 1000 && possibleUnits.length > 0) {\r\n    unit = possibleUnits.pop();\r\n    converted = metersToUnit(value, unit);\r\n  }\r\n  return unit;\r\n}\r\n\r\n/**\r\n * Compute best length measure unit for a given measure in square meters\r\n * @param value Value in meters\r\n * @returns Measure unit\r\n */\r\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\r\n  let unit = MeasureAreaUnit.SquareMeters;\r\n  let converted = value;\r\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\r\n  while (converted > 1000000 && possibleUnits.length > 0) {\r\n    unit = possibleUnits.pop();\r\n    converted = squareMetersToUnit(value, unit);\r\n  }\r\n  return unit;\r\n}\r\n\r\n/**\r\n * Create a default style for a measure interaction\r\n * @returns OL style\r\n */\r\nexport function createMeasureInteractionStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: '#ffcc33',\r\n      lineDash: [10, 10],\r\n      width: 2\r\n    }),\r\n    fill: new olstyle.Fill({\r\n      color: 'rgba(255, 255, 255, 0.2)'\r\n    }),\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke: new olstyle.Stroke({\r\n        color: '#ffcc33'\r\n      }),\r\n      fill: new olstyle.Fill({\r\n        color: 'rgba(255, 255, 255, 0.2)'\r\n      })\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Create a default style for a measure layer\r\n * @returns OL style\r\n */\r\nexport function createMeasureLayerStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: '#ffcc33',\r\n      width: 2\r\n    }),\r\n    fill: new olstyle.Fill({\r\n      color: 'rgba(255, 255, 255, 0.2)'\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Compute the length in meters of an OL geometry with a given projection\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Length in meters\r\n */\r\nexport function measureOlGeometryLength(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\r\n  projection: string\r\n): number | undefined {\r\n  if (olGeometry instanceof OlPoint) {\r\n    return undefined;\r\n  }\r\n  if (olGeometry.getFlatCoordinates().length === 0) {\r\n    return undefined;\r\n  }\r\n  return olGetLength(olGeometry, { projection });\r\n}\r\n\r\n/**\r\n * Compute the area in square meters of an OL geometry with a given projection\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Area in square meters\r\n */\r\nexport function measureOlGeometryArea(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\r\n  projection: string\r\n): number | undefined {\r\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\r\n    return undefined;\r\n  }\r\n  if (olGeometry.getFlatCoordinates().length === 0) {\r\n    return undefined;\r\n  }\r\n  return olGetArea(olGeometry, { projection });\r\n}\r\n\r\n/**\r\n * Compute the area (square meters), length (meters) and last length (meters)\r\n * of an OL geometry with a given projection.\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Computed measure\r\n */\r\nexport function measureOlGeometry(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\r\n  projection: string\r\n): Measure {\r\n  const length = measureOlGeometryLength(olGeometry, projection);\r\n  const area = measureOlGeometryArea(olGeometry, projection);\r\n\r\n  const lengths = [];\r\n  const coordinates = olGeometry.getFlatCoordinates();\r\n  const coordinatesLength = coordinates.length;\r\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\r\n    const olSegment = new OlLineString([\r\n      [coordinates[i], coordinates[i + 1]],\r\n      [coordinates[i + 2], coordinates[i + 3]]\r\n    ]);\r\n\r\n    lengths.push(measureOlGeometryLength(olSegment, projection));\r\n  }\r\n\r\n  return {\r\n    area,\r\n    length,\r\n    lengths\r\n  };\r\n}\r\n\r\n/**\r\n * Update an OL geometry midpoints and return an array of those points\r\n * @param olGeometry OL Geometry\r\n * @returns OL points\r\n */\r\nexport function updateOlGeometryMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlPoint[] {\r\n  let olMidpoints;\r\n  if (olGeometry instanceof OlPoint) {\r\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\r\n    olMidpoints = new Array(1);\r\n    olMidpoints[0] = olMidpointPoint;\r\n  } else {\r\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\r\n    // TODO: handle multi geometries\r\n    const coordinates = olGeometry.getFlatCoordinates();\r\n    const midpointsLength = olMidpoints.length;\r\n    for (let i = 0; i < midpointsLength; i++) {\r\n      const j = i * 2;\r\n      const olSegment = new OlLineString([\r\n        [coordinates[j], coordinates[j + 1]],\r\n        [coordinates[j + 2], coordinates[j + 3]]\r\n      ]);\r\n\r\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\r\n      const olMidpoint = olMidpoints[i];\r\n      if (olMidpoint !== undefined) {\r\n        olMidpoint.setCoordinates(midpointCoordinate);\r\n      } else {\r\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\r\n      }\r\n    }\r\n  }\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Clear an OL geometry midpoints and return an array of those points\r\n * @param olGeometry OL Geometry\r\n */\r\nexport function clearOlGeometryMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n) {\r\n  const olMidpoints = olGeometry.get('_midpoints') || [];\r\n  const midpointsLength = olMidpoints.length;\r\n  for (let i = 0; i < midpointsLength; i++) {\r\n    const olMidpoint = olMidpoints[i];\r\n    if (olMidpoint !== undefined) {\r\n      if (olMidpoint !== undefined) {\r\n        clearOlMidpointTooltip(olMidpoint);\r\n      }\r\n    }\r\n  }\r\n\r\n  olGeometry.set('_midpoints', undefined, true);\r\n\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Return an array of  OL geometry midpoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL points\r\n */\r\nfunction getOlGeometryMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlPoint[] {\r\n  let expectedNumber;\r\n  if (olGeometry instanceof OlCircle) {\r\n    expectedNumber = 0;\r\n  } else {\r\n    expectedNumber = Math.max(\r\n      olGeometry.getFlatCoordinates().length / 2 - 1,\r\n      0\r\n    );\r\n  }\r\n  // TODO: This works but it's quite messy. If time permits,\r\n  // clean this. Maybe a Tooltip class could handle that\r\n  let olMidpoints = olGeometry.get('_midpoints');\r\n\r\n  if (olMidpoints === undefined) {\r\n    if (olGeometry instanceof OlPoint) {\r\n      olMidpoints = new Array(1);\r\n    } else {\r\n      olMidpoints = new Array(expectedNumber);\r\n    }\r\n    olGeometry.set('_midpoints', olMidpoints, true);\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber === 0) {\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber === olMidpoints.length) {\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber > olMidpoints.length) {\r\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\r\n    return olMidpoints;\r\n  }\r\n\r\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\r\n    const olMidpoint = olMidpoints[expectedNumber];\r\n    if (olMidpoint !== undefined) {\r\n      clearOlMidpointTooltip(olMidpoint);\r\n    }\r\n  }\r\n  olMidpoints.splice(expectedNumber);\r\n\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Remove an OL midpoint's tooltip from the map\r\n * @param olMidpoint OL Point\r\n */\r\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\r\n  const olTooltip = olMidpoint.get('_tooltip');\r\n  if (olTooltip !== undefined) {\r\n    const olMap = olTooltip.getMap();\r\n    if (olMap !== undefined) {\r\n      olMap.removeOverlay(olTooltip);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Add an OL overlay at each midpoint and return an array of those overlays\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function updateOlTooltipsAtMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay[] {\r\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n  let typeGeom = '';\r\n  if (olGeometry instanceof OlLineString) {\r\n    typeGeom = 'line-';\r\n  } else if (olGeometry instanceof OlPolygon) {\r\n    typeGeom = 'polygone-';\r\n  }\r\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\r\n    let olTooltip = olMidpoint.get('_tooltip');\r\n    if (olTooltip === undefined) {\r\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\r\n    } else {\r\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\r\n    }\r\n    return olTooltip;\r\n  });\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Return an array of OL overlay at midspoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getOlTooltipsAtMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay[] {\r\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\r\n  return olMidpoints.map((olMidpoint: OlPoint) => {\r\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\r\n  });\r\n}\r\n\r\n/**\r\n * Update an OL geometry center and return it\r\n * @param olGeometry OL Geometry\r\n * @returns OL point\r\n */\r\nexport function updateOlGeometryCenter(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlPoint {\r\n  let olCenter = olGeometry.get('_center');\r\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\r\n  if (olCenter !== undefined) {\r\n    olCenter.setCoordinates(centerCoordinate);\r\n  } else {\r\n    olCenter = new OlPoint(centerCoordinate);\r\n    olGeometry.set('_center', olCenter);\r\n  }\r\n\r\n  return olCenter;\r\n}\r\n\r\n/**\r\n * Add an OL overlay at the center of a geometry and return that overlay\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlay\r\n */\r\nexport function updateOlTooltipAtCenter(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay {\r\n  const olCenter = updateOlGeometryCenter(olGeometry);\r\n  let olTooltip = olCenter.get('_tooltip');\r\n  if (olTooltip === undefined) {\r\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\r\n  } else {\r\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\r\n  }\r\n  return olTooltip;\r\n}\r\n\r\n/**\r\n * Return an array of OL overlay at midspoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getOlTooltipAtCenter(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay {\r\n  const olCenter = olGeometry.get('_center');\r\n  return olCenter ? olCenter.get('_tooltip') : undefined;\r\n}\r\n\r\n/**\r\n * Get all the tooltips of an OL geometry\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getTooltipsOfOlGeometry(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay[] {\r\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\r\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\r\n  if (olCenterTooltip !== undefined) {\r\n    olTooltips.push(olCenterTooltip);\r\n  }\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Create an OL overlay at a point and bind the overlay to the point\r\n * @param olPoint OL Point\r\n * @returns OL overlay\r\n */\r\nexport function createOlTooltipAtPoint(\r\n  olPoint: OlPoint,\r\n  center: boolean = false,\r\n  srcGeomType: string = ''\r\n): OlOverlay {\r\n  const olTooltip = new OlOverlay({\r\n    element: document.createElement('div'),\r\n    offset: [-30, -10],\r\n    className: (center\r\n      ? [\r\n          'igo-map-tooltip',\r\n          'igo-map-tooltip-measure',\r\n          'igo-map-tooltip-measure-area'\r\n        ]\r\n      : [\r\n          'igo-map-tooltip',\r\n          'igo-map-tooltip-measure',\r\n          `igo-map-tooltip-measure-${srcGeomType}segments`\r\n        ]\r\n    ).join(' '),\r\n    stopEvent: false\r\n  });\r\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\r\n  olPoint.set('_tooltip', olTooltip);\r\n\r\n  return olTooltip;\r\n}\r\n","<div class=\"form-list\">\n  <mat-form-field class=\"zone-list\">\n    <mat-label>{{ 'igo.geo.spatialFilter.listLabel' | translate }}</mat-label>\n    <input\n      #input\n      type=\"text\"\n      placeholder=\"{{ 'igo.geo.spatialFilter.listLabel' | translate }}\"\n      matInput\n      [formControl]=\"formControl\"\n      [matAutocomplete]=\"auto\"\n    />\n    <mat-autocomplete\n      #auto=\"matAutocomplete\"\n      (optionSelected)=\"onZoneChange($event.option.value)\"\n      [displayWith]=\"displayFn\"\n    >\n      <mat-option\n        *ngFor=\"let entities of this.store.view.all$() | async\"\n        [value]=\"entities\"\n      >\n        {{ entities.properties.nom }}\n      </mat-option>\n    </mat-autocomplete>\n  </mat-form-field>\n  <div>\n    <div class=\"buffer-div\">\n      <mat-form-field class=\"buffer\">\n        <mat-label>{{ 'igo.geo.spatialFilter.buffer' | translate }}</mat-label>\n        <input\n          type=\"number\"\n          matInput\n          placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\n          [formControl]=\"bufferFormControl\"\n          [value]=\"0\"\n          [readonly]=\"!zone\"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\n        >\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\"\n          >\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n","import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\r\nimport {\r\n  SpatialFilterQueryType,\r\n  SpatialFilterType\r\n} from './../../shared/spatial-filter.enum';\r\nimport {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { UntypedFormControl } from '@angular/forms';\r\nimport { Feature } from '../../../feature';\r\nimport { MeasureLengthUnit } from '../../../measure/shared';\r\nimport { MessageService } from '@igo2/core';\r\nimport { Layer } from '../../../layer';\r\n\r\n@Component({\r\n  selector: 'igo-spatial-filter-list',\r\n  templateUrl: './spatial-filter-list.component.html',\r\n  styleUrls: ['./spatial-filter-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  @Input()\r\n  get queryType(): SpatialFilterQueryType {\r\n    return this._queryType;\r\n  }\r\n  set queryType(queryType: SpatialFilterQueryType) {\r\n    this.formControl.setValue('');\r\n    this._queryType = queryType;\r\n  }\r\n  private _queryType: SpatialFilterQueryType;\r\n\r\n  @Input()\r\n  get zone() {\r\n    return this._zone;\r\n  }\r\n  set zone(value) {\r\n    this._zone = value;\r\n    if (!value) {\r\n      this.zoneWithBuffer = undefined;\r\n      this.bufferFormControl.setValue(0);\r\n    }\r\n  }\r\n  private _zone;\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  public zoneWithBuffer;\r\n  public selectedZone: any;\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n\r\n  public formControl = new UntypedFormControl();\r\n\r\n  public bufferFormControl = new UntypedFormControl();\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\r\n  }\r\n\r\n  @Output() zoneChange = new EventEmitter<Feature>();\r\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\r\n  @Output() bufferChange = new EventEmitter<number>();\r\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\r\n\r\n  formValueChanges$$: Subscription;\r\n  bufferValueChanges$$: Subscription;\r\n\r\n  constructor(\r\n    private spatialFilterService: SpatialFilterService,\r\n    private messageService: MessageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\r\n      (value) => {\r\n        if (value.length) {\r\n          this.store.view.filter((feature) => {\r\n            const filterNormalized = value\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            const featureNameNormalized = feature.properties.nom\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            return featureNameNormalized.includes(filterNormalized);\r\n          });\r\n        }\r\n      }\r\n    );\r\n\r\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\r\n      .pipe(debounceTime(500), distinctUntilChanged())\r\n      .subscribe((value) => {\r\n        if (\r\n          this.measureUnit === MeasureLengthUnit.Meters &&\r\n          value > 0 &&\r\n          value <= 100000\r\n        ) {\r\n          this.bufferChange.emit(value);\r\n          this.spatialFilterService\r\n            .loadBufferGeometry(\r\n              this.selectedZone,\r\n              SpatialFilterType.Predefined,\r\n              value,\r\n              this.queryType\r\n            )\r\n            .subscribe((featureGeom: Feature) => {\r\n              this.zoneWithBuffer = featureGeom;\r\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n            });\r\n        } else if (\r\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n          value > 0 &&\r\n          value <= 100\r\n        ) {\r\n          this.bufferChange.emit(value);\r\n          this.spatialFilterService\r\n            .loadBufferGeometry(\r\n              this.selectedZone,\r\n              SpatialFilterType.Predefined,\r\n              value * 1000,\r\n              this.queryType\r\n            )\r\n            .subscribe((featureGeom: Feature) => {\r\n              this.zoneWithBuffer = featureGeom;\r\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n            });\r\n        } else if (value === 0 && this.layers.length > 0) {\r\n          this.bufferChange.emit(value);\r\n          this.zoneWithBufferChange.emit(this.selectedZone);\r\n        } else if (\r\n          value < 0 ||\r\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\r\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\r\n        ) {\r\n          this.bufferFormControl.setValue(0);\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.bufferAlert',\r\n            'igo.geo.spatialFilter.warning'\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.formValueChanges$$.unsubscribe();\r\n  }\r\n\r\n  displayFn(feature?: Feature): string | undefined {\r\n    return feature ? feature.properties.nom : undefined;\r\n  }\r\n\r\n  onZoneChange(feature) {\r\n    if (feature && this.queryType) {\r\n      this.spatialFilterService\r\n        .loadItemById(feature, this.queryType)\r\n        .subscribe((featureGeom: Feature) => {\r\n          this.selectedZone = featureGeom;\r\n          this.zoneChange.emit(featureGeom);\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\r\n    if (unit === this.measureUnit) {\r\n      return;\r\n    } else {\r\n      this.measureUnit = unit;\r\n      this.measureUnitChange.emit(this.measureUnit);\r\n      this.measureUnit === MeasureLengthUnit.Meters\r\n        ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\r\n        : this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\r\n    }\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'keyvalue'\n})\nexport class KeyValuePipe implements PipeTransform {\n  transform(value: any, args?: any): any {\n    const keyValues = [];\n    Object.getOwnPropertyNames(value).forEach((key: string) =>\n      keyValues.push({ key, value: value[key] })\n    );\n\n    return keyValues;\n  }\n}\n","<table\r\n  class=\"igo-striped mat-typography\"\r\n  *ngIf=\"\r\n    ready &&\r\n    feature &&\r\n    isObject(feature.properties) &&\r\n    feature.properties.target !== 'iframe'\r\n  \"\r\n>\r\n  <tbody>\r\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\r\n      <td\r\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\r\n      >\r\n        <mat-icon matListItemIcon svgIcon=\"{{ icon }}\"></mat-icon>\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\r\n      >\r\n        <a\r\n          href=\"{{ property.value }}\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          {{ 'igo.geo.targetHtmlUrl' | translate }} {{ title }}</a\r\n        >\r\n        <button\r\n          class=\"copyClipboard\"\r\n          mat-icon-button\r\n          (click)=\"copyTextToClipboard(property.value)\"\r\n        >\r\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n        </button>\r\n      </td>\r\n\r\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\r\n        {{ property.key }}\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined &&\r\n          !isObject(property.value) &&\r\n          !isUrl(property.value) &&\r\n          !isEmbeddedLink(property.value)\r\n        \"\r\n        [innerHTML]=\"property.value\"\r\n      ></td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined &&\r\n          isEmbeddedLink(property.value)\r\n        \"\r\n      >\r\n        <u\r\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\r\n          (click)=\"openSecureUrl(property.value)\"\r\n          >{{ getEmbeddedLinkText(property.value) }}</u\r\n        >\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined &&\r\n          !isObject(property.value) &&\r\n          (isDoc(property.value) || isUrl(property.value)) &&\r\n          !isImg(property.value)\r\n        \"\r\n      >\r\n        <u\r\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\r\n          (click)=\"openSecureUrl(property.value)\"\r\n          >{{ 'igo.geo.targetHtmlUrl' | translate }}</u\r\n        >\r\n        <button\r\n          class=\"copyClipboard\"\r\n          mat-icon-button\r\n          (click)=\"copyTextToClipboard(property.value)\"\r\n        >\r\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n        </button>\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined &&\r\n          !isObject(property.value) &&\r\n          isUrl(property.value) &&\r\n          isImg(property.value)\r\n        \"\r\n      >\r\n        <a\r\n          href=\"{{ property.value }}\"\r\n          target=\"_blank\"\r\n          (click)=\"openSecureUrl(property.value)\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          <img\r\n            igoImageError\r\n            src=\"{{ property.value | secureImage | async }}\"\r\n            width=\"225\"\r\n            height=\"auto\"\r\n          />\r\n        </a>\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined && isObject(property.value)\r\n        \"\r\n        [innerHTML]=\"property.value | json\"\r\n      ></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<iframe\r\n  *ngIf=\"isHtmlDisplay()\"\r\n  [srcdoc]=\"htmlSanitizer(feature.properties)\"\r\n  [src]=\"urlSanitizer(feature.properties.url)\"\r\n></iframe>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\nimport { NetworkService, ConnectionState, MessageService } from '@igo2/core';\r\nimport { ConfigService } from '@igo2/core';\r\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\r\nimport type { Toolbox } from '@igo2/common';\r\n\r\nimport { Feature } from '../shared';\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Clipboard } from '@igo2/utils';\r\n@Component({\r\n  selector: 'igo-feature-details',\r\n  templateUrl: './feature-details.component.html',\r\n  styleUrls: ['./feature-details.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\r\n  private state: ConnectionState;\r\n  private unsubscribe$ = new Subject<void>();\r\n  ready = false;\r\n\r\n  @Input()\r\n  get source(): SearchSource {\r\n    return this._source;\r\n  }\r\n  set source(value: SearchSource) {\r\n    this._source = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() toolbox: Toolbox;\r\n\r\n  @Input()\r\n  get feature(): Feature {\r\n    return this._feature;\r\n  }\r\n  set feature(value: Feature) {\r\n    this._feature = value;\r\n    this.cdRef.detectChanges();\r\n    this.selectFeature.emit();\r\n  }\r\n\r\n  private _feature: Feature;\r\n  private _source: SearchSource;\r\n\r\n  @Output() routeEvent = new EventEmitter<boolean>();\r\n  @Output() selectFeature = new EventEmitter<boolean>();\r\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.feature);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.feature) || 'link';\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private cdRef: ChangeDetectorRef,\r\n    private sanitizer: DomSanitizer,\r\n    private networkService: NetworkService,\r\n    private messageService: MessageService,\r\n    private configService: ConfigService\r\n  ) {\r\n    this.networkService\r\n      .currentState()\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe((state: ConnectionState) => {\r\n        this.state = state;\r\n      });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.ready = true;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribe$.next();\r\n    this.unsubscribe$.complete();\r\n  }\r\n\r\n  urlSanitizer(value): SafeResourceUrl {\r\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\r\n  }\r\n\r\n  isHtmlDisplay(): boolean {\r\n    if (\r\n      this.feature &&\r\n      this.isObject(this.feature.properties) &&\r\n      this.feature.properties.target === 'iframe'\r\n    ) {\r\n      this.htmlDisplayEvent.emit(true);\r\n      return true;\r\n    } else {\r\n      this.htmlDisplayEvent.emit(false);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  htmlSanitizer(value): SafeResourceUrl {\r\n    if (!value.body) {\r\n      return;\r\n    }\r\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\r\n    if (!regexBase.test(value.body)) {\r\n      const url = new URL(value.url, window.location.origin);\r\n      value.body = value.body.replace(\r\n        '<head>',\r\n        `<head><base href=\"${url.origin}\">`\r\n      );\r\n    }\r\n\r\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\r\n  }\r\n\r\n  isObject(value) {\r\n    return typeof value === 'object';\r\n  }\r\n\r\n  openSecureUrl(value) {\r\n    let url: string;\r\n    const regexDepot = new RegExp(\r\n      this.configService?.getConfig('depot.url') + '.*?(?=\"|$)'\r\n    );\r\n\r\n    if (regexDepot.test(value)) {\r\n      url = value.match(regexDepot)[0];\r\n\r\n      this.http\r\n        .get(url, {\r\n          responseType: 'blob'\r\n        })\r\n        .subscribe(\r\n          (docOrImage) => {\r\n            const fileUrl = URL.createObjectURL(docOrImage);\r\n            window.open(fileUrl, '_blank');\r\n            this.cdRef.detectChanges();\r\n          },\r\n          (error: Error) => {\r\n            this.messageService.error(\r\n              'igo.geo.targetHtmlUrlUnauthorized',\r\n              'igo.geo.targetHtmlUrlUnauthorizedTitle'\r\n            );\r\n          }\r\n        );\r\n    } else {\r\n      let url = value;\r\n      if (this.isEmbeddedLink(value)) {\r\n        var div = document.createElement('div');\r\n        div.innerHTML = value;\r\n        url = div.children[0].getAttribute('href');\r\n      }\r\n      window.open(url, '_blank');\r\n    }\r\n  }\r\n\r\n  isUrl(value) {\r\n    if (typeof value === 'string') {\r\n      const regex = /^https?:\\/\\//;\r\n      return regex.test(value);\r\n    }\r\n  }\r\n\r\n  isDoc(value) {\r\n    if (typeof value === 'string') {\r\n      if (this.isUrl(value)) {\r\n        const regex = /(pdf|docx?|xlsx?)$/;\r\n        return regex.test(value.toLowerCase());\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  isImg(value) {\r\n    if (typeof value === 'string') {\r\n      if (this.isUrl(value)) {\r\n        const regex = /(jpe?g|png|gif)$/;\r\n        return regex.test(value.toLowerCase());\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  isEmbeddedLink(value) {\r\n    if (typeof value === 'string') {\r\n      const matchRegex = /<a/g;\r\n      const match = value.match(matchRegex) || [];\r\n      const count = match.length;\r\n      if (count === 1) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getEmbeddedLinkText(value) {\r\n    const regex = /(?:>).*?(?=<|$)/;\r\n    let text = value.match(regex)[0] as string;\r\n    text = text.replace(/>/g, '');\r\n    return text;\r\n  }\r\n\r\n  filterFeatureProperties(feature) {\r\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\r\n    const properties = {};\r\n    let offlineButtonState;\r\n\r\n    if (this.map) {\r\n      this.map.forcedOffline$\r\n        .pipe(takeUntil(this.unsubscribe$))\r\n        .subscribe((state) => {\r\n          offlineButtonState = state;\r\n        });\r\n    }\r\n\r\n    if (\r\n      feature.properties &&\r\n      feature.properties.Route &&\r\n      this.toolbox &&\r\n      !this.toolbox.getTool('directions')\r\n    ) {\r\n      delete feature.properties.Route;\r\n    }\r\n\r\n    if (allowedFieldsAndAlias) {\r\n      Object.keys(allowedFieldsAndAlias).forEach((field) => {\r\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\r\n      });\r\n      return properties;\r\n    } else if (offlineButtonState !== undefined) {\r\n      if (!offlineButtonState) {\r\n        if (\r\n          this.state.connection &&\r\n          feature.meta &&\r\n          feature.meta.excludeAttribute\r\n        ) {\r\n          const excludeAttribute = feature.meta.excludeAttribute;\r\n          excludeAttribute.forEach((attribute) => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        } else if (\r\n          !this.state.connection &&\r\n          feature.meta &&\r\n          feature.meta.excludeAttributeOffline\r\n        ) {\r\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n          excludeAttributeOffline.forEach((attribute) => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        }\r\n      } else {\r\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\r\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n          excludeAttributeOffline.forEach((attribute) => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      if (\r\n        this.state.connection &&\r\n        feature.meta &&\r\n        feature.meta.excludeAttribute\r\n      ) {\r\n        const excludeAttribute = feature.meta.excludeAttribute;\r\n        excludeAttribute.forEach((attribute) => {\r\n          delete feature.properties[attribute];\r\n        });\r\n      } else if (\r\n        !this.state.connection &&\r\n        feature.meta &&\r\n        feature.meta.excludeAttributeOffline\r\n      ) {\r\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n        excludeAttributeOffline.forEach((attribute) => {\r\n          delete feature.properties[attribute];\r\n        });\r\n      }\r\n    }\r\n    return feature.properties;\r\n  }\r\n\r\n  /**\r\n   * Copy the url to a clipboard\r\n   */\r\n  copyTextToClipboard(value: string): void {\r\n    const successful = Clipboard.copy(value);\r\n    if (successful) {\r\n      this.messageService.success('igo.geo.query.link.message');\r\n    }\r\n  }\r\n}\r\n","import OlCircle from 'ol/geom/Circle';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olstyle from 'ol/style';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlLinearRing from 'ol/geom/LinearRing';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport BasicEvent from 'ol/events/Event';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport lineIntersect from '@turf/line-intersect';\r\nimport { lineString } from '@turf/helpers';\r\n\r\nimport {\r\n  GeometrySliceMultiPolygonError,\r\n  GeometrySliceLineStringError,\r\n  GeometrySliceTooManyIntersectionError\r\n} from './geometry.errors';\r\n\r\n/**\r\n * Create a default style for draw and modify interactions\r\n * @param color Style color (R, G, B)\r\n * @returns OL style\r\n */\r\nexport function createDrawInteractionStyle(\r\n  color?: [number, number, number]\r\n): olstyle.Circle {\r\n  color = color || [0, 153, 255];\r\n  return new olstyle.Circle({\r\n    stroke: new olstyle.Stroke({\r\n      color: color.concat([1]),\r\n      width: 2\r\n    }),\r\n    fill: new olstyle.Fill({\r\n      color: color.concat([0.2])\r\n    }),\r\n    radius: 8\r\n  });\r\n}\r\n\r\n/**\r\n * Create a default style for drawing a hole\r\n * @returns OL style\r\n */\r\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: [0, 153, 255, 1],\r\n      width: 2\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Slice geometry into two parts\r\n * @param olGeometry OL geometry\r\n * @param olSlicer Slicing line\r\n * @returns New OL geometries\r\n */\r\nexport function sliceOlGeometry(\r\n  olGeometry: OlLineString | OlPolygon,\r\n  olSlicer: OlLineString\r\n): Array<OlLineString | OlPolygon> {\r\n  if (olGeometry instanceof OlPolygon) {\r\n    return sliceOlPolygon(olGeometry, olSlicer);\r\n  } else if (olGeometry instanceof OlLineString) {\r\n    return sliceOlLineString(olGeometry, olSlicer);\r\n  }\r\n  return [];\r\n}\r\n\r\n/**\r\n * Slice OL LineString into one or more lines\r\n * @param olLineString OL line string\r\n * @param olSlicer Slicing line\r\n * @returns New OL line strings\r\n */\r\nexport function sliceOlLineString(\r\n  olLineString: OlLineString,\r\n  olSlicer: OlLineString\r\n): OlLineString[] {\r\n  return [];\r\n}\r\n\r\n/**\r\n * Slice OL Polygon into one or more polygons\r\n * @param olPolygon OL polygon\r\n * @param olSlicer Slicing line\r\n * @returns New OL polygons\r\n */\r\nexport function sliceOlPolygon(\r\n  olPolygon: OlPolygon,\r\n  olSlicer: OlLineString\r\n): OlPolygon[] {\r\n  if (olPolygon.getLinearRingCount() > 1) {\r\n    throw new GeometrySliceMultiPolygonError();\r\n  }\r\n\r\n  if (olSlicer.getCoordinates().length > 2) {\r\n    throw new GeometrySliceLineStringError();\r\n  }\r\n\r\n  const olGeoJSON = new OlGeoJSON();\r\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\r\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\r\n\r\n  const parts = [[], []];\r\n  let totalIntersectionCount = 0;\r\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\r\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\r\n    const segment = lineString(segmentCoordinates);\r\n    const intersections = lineIntersect(segment, slicer).features;\r\n\r\n    const intersectionCount = intersections.length;\r\n    totalIntersectionCount += intersectionCount;\r\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\r\n      throw new GeometrySliceTooManyIntersectionError();\r\n    }\r\n\r\n    parts[0].push(segmentCoordinates[0]);\r\n    if (intersectionCount === 1) {\r\n      const intersection = intersections[0].geometry.coordinates;\r\n      parts[0].push(intersection);\r\n      parts[1].push(intersection);\r\n      parts.reverse();\r\n    }\r\n  }\r\n\r\n  if (totalIntersectionCount <= 1) {\r\n    return [];\r\n  }\r\n\r\n  parts[0].push(parts[0][0]);\r\n  parts[1].push(parts[1][0]);\r\n\r\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\r\n}\r\n\r\n/**\r\n * Splice geometry into two parts\r\n * @param olGeometry OL geometry\r\n * @param olSlicer Slicing line\r\n * @returns New OL geometries\r\n */\r\nexport function addLinearRingToOlPolygon(\r\n  olPolygon: OlPolygon,\r\n  olLinearRing: OlLinearRing\r\n) {\r\n  // TODO: make some validation and support updating an existing linear ring\r\n  olPolygon.appendLinearRing(olLinearRing);\r\n}\r\n\r\nexport function getMousePositionFromOlGeometryEvent(olEvent: BasicEvent) {\r\n  const olGeometry = olEvent.target as OlGeometry;\r\n  if (olGeometry instanceof OlPolygon) {\r\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\r\n  }\r\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\r\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\r\n}\r\n","import { EventsKey } from 'ol/events';\r\nimport OlMap from 'ol/Map';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlDraw from 'ol/interaction/Draw';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlModify from 'ol/interaction/Modify';\r\nimport OlSelect from 'ol/interaction/Select';\r\nimport BasicEvent from 'ol/events/Event';\r\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\r\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { doubleClick } from 'ol/events/condition';\r\n\r\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\r\n\r\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\r\n\r\nexport interface DrawControlOptions {\r\n  geometryType: Type | string;\r\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\r\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\r\n  drawingLayerStyle?: OlStyleLike;\r\n  interactionStyle?: OlStyleLike;\r\n  maxPoints?: number;\r\n}\r\n\r\n/**\r\n * Control to draw entities\r\n */\r\nexport class DrawControl {\r\n  /**\r\n   * Draw start observable\r\n   */\r\n  public start$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw end observable\r\n   */\r\n  public end$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw changes observable (while drawing)\r\n   */\r\n  public changes$: Subject<any> = new Subject();\r\n\r\n  /**\r\n   * Draw modify observable (modify drawn features)\r\n   */\r\n  public modify$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw select observable (modify drawn features)\r\n   */\r\n  public select$: Subject<any> = new Subject();\r\n\r\n  /**\r\n   * Draw abort observable (abort drawn features)\r\n   */\r\n  public abort$: Subject<any> = new Subject();\r\n\r\n  /**\r\n   * Freehand mode observable (defaults to false)\r\n   */\r\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  /**\r\n   * Observables from predefined radius (defaults to false and undefined)\r\n   */\r\n  ispredefinedRadius$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(undefined);\r\n  radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(undefined);\r\n\r\n  private keyDown$$: Subscription;\r\n\r\n  private olGeometryType: typeof OlGeometry | undefined | string;\r\n  private olInteractionStyle: OlStyleLike;\r\n  private olMap: OlMap;\r\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\r\n  private olDrawInteraction: OlDraw;\r\n  private olSelectInteraction: OlSelect;\r\n  private olModifyInteraction: OlModify;\r\n  private onDrawStartKey: EventsKey;\r\n  private onDrawEndKey: EventsKey;\r\n  private onDrawAbortKey: EventsKey;\r\n  private onDrawKey: EventsKey;\r\n  public radius: number;\r\n\r\n  private mousePosition: [number, number];\r\n\r\n  /**\r\n   * take the value of radius\r\n   */\r\n  get radiusVal(): number {\r\n    return this.predefinedRadius$.getValue();\r\n  }\r\n  set radiusValData(radiusCercle: number) {\r\n    this.predefinedRadius$.next(radiusCercle);\r\n  }\r\n\r\n  /**\r\n   * Wheter the control is active\r\n   */\r\n  get active(): boolean {\r\n    return this.olMap !== undefined;\r\n  }\r\n\r\n  /**\r\n   * OL overlay source\r\n   * @internal\r\n   */\r\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\r\n    return this.olDrawingLayer.getSource();\r\n  }\r\n\r\n  constructor(private options: DrawControlOptions) {\r\n    this.olDrawingLayer = options.drawingLayer\r\n      ? options.drawingLayer\r\n      : this.createOlInnerOverlayLayer();\r\n    this.olGeometryType = this.options.geometryType;\r\n    this.olInteractionStyle = this.options.interactionStyle;\r\n  }\r\n\r\n  /**\r\n   * Add or remove this control to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\r\n    if (!olMap) {\r\n      this.clearOlInnerOverlaySource();\r\n      this.removeOlInnerOverlayLayer();\r\n      this.removeOlInteractions();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n    this.addOlInnerOverlayLayer();\r\n    this.addOlInteractions(activateModifyAndSelect);\r\n  }\r\n\r\n  /**\r\n   * Return the drawing layer source\r\n   */\r\n  getSource(): OlVectorSource<OlGeometry> {\r\n    return this.olDrawingLayerSource;\r\n  }\r\n\r\n  setOlInteractionStyle(style) {\r\n    this.olInteractionStyle = style;\r\n  }\r\n\r\n  /**\r\n   * Set the current geometry type\r\n   * @param geometryType the geometry type\r\n   */\r\n  setGeometryType(geometryType: Type) {\r\n    this.olGeometryType = geometryType;\r\n  }\r\n\r\n  /**\r\n   * Get the current geometry type\r\n   */\r\n  getGeometryType() {\r\n    return this.olGeometryType;\r\n  }\r\n\r\n  /**\r\n   * Create a drawing source if none is defined in the options\r\n   */\r\n  private createOlInnerOverlayLayer(): OlVectorLayer<\r\n    OlVectorSource<OlGeometry>\r\n  > {\r\n    return new OlVectorLayer({\r\n      source: this.options.drawingLayerSource\r\n        ? this.options.drawingLayerSource\r\n        : new OlVectorSource(),\r\n      style: this.options.drawingLayerStyle,\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the drawing layer if it wasn't defined in the options\r\n   */\r\n  private removeOlInnerOverlayLayer() {\r\n    if (!this.options.drawingLayer && this.olMap) {\r\n      this.olMap.removeLayer(this.olDrawingLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the drawing layer if it wasn't defined in the options\r\n   */\r\n  private addOlInnerOverlayLayer() {\r\n    if (!this.options.drawingLayer) {\r\n      this.olMap.addLayer(this.olDrawingLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the drawing layer source if it wasn't defined in the options\r\n   */\r\n  private clearOlInnerOverlaySource() {\r\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\r\n      this.olDrawingLayerSource.clear(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add interactions to the map an set up some listeners\r\n   */\r\n  addOlInteractions(activateModifyAndSelect?: boolean) {\r\n    // Create Draw interaction\r\n    let olDrawInteraction;\r\n    if (!this.freehand$.getValue()) {\r\n      if (!this.ispredefinedRadius$.getValue()) {\r\n        olDrawInteraction = new OlDraw({\r\n          type: this.olGeometryType as Type,\r\n          source: this.getSource(),\r\n          stopClick: true,\r\n          style: this.olInteractionStyle,\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: false,\r\n          freehandCondition: () => false\r\n        });\r\n      } else {\r\n        olDrawInteraction = new OlDraw({\r\n          type: 'Point',\r\n          source: this.getSource(),\r\n          stopClick: true,\r\n          style: this.olInteractionStyle,\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: false,\r\n          freehandCondition: () => false\r\n        });\r\n      }\r\n    } else {\r\n      if (this.olGeometryType === 'Point') {\r\n        olDrawInteraction = new OlDraw({\r\n          type: 'Circle',\r\n          source: this.getSource(),\r\n          style:\r\n            typeof this.olInteractionStyle === 'function'\r\n              ? undefined\r\n              : this.olInteractionStyle,\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: true\r\n        });\r\n      } else {\r\n        olDrawInteraction = new OlDraw({\r\n          type: this.olGeometryType as Type,\r\n          source: this.getSource(),\r\n          style: this.olInteractionStyle,\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: true\r\n        });\r\n      }\r\n    }\r\n\r\n    // Add Draw interaction to map and create listeners\r\n    this.olMap.addInteraction(olDrawInteraction);\r\n    this.olDrawInteraction = olDrawInteraction;\r\n    this.onDrawStartKey = olDrawInteraction.on(\r\n      'drawstart',\r\n      (event: OlDrawEvent) => this.onDrawStart(event)\r\n    );\r\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) =>\r\n      this.onDrawEnd(event)\r\n    );\r\n    this.onDrawAbortKey = olDrawInteraction.on(\r\n      'drawabort',\r\n      (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry())\r\n    );\r\n\r\n    if (activateModifyAndSelect) {\r\n      // Create a Modify interaction, add it to map and create a listener\r\n      const olModifyInteraction = new OlModify({\r\n        source: this.getSource()\r\n      });\r\n\r\n      this.olMap.addInteraction(olModifyInteraction);\r\n      this.olModifyInteraction = olModifyInteraction;\r\n\r\n      // Create a select interaction and add it to map\r\n      if (!this.olSelectInteraction) {\r\n        const olSelectInteraction = new OlSelect({\r\n          condition: doubleClick,\r\n          style: undefined\r\n        });\r\n        this.olMap.addInteraction(olSelectInteraction);\r\n        this.olSelectInteraction = olSelectInteraction;\r\n\r\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) =>\r\n          this.onSelect(event)\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove interactions\r\n   */\r\n  private removeOlInteractions() {\r\n    this.unsubscribeKeyDown();\r\n    unByKey([\r\n      this.onDrawStartKey,\r\n      this.onDrawEndKey,\r\n      this.onDrawKey,\r\n      this.onDrawAbortKey\r\n    ]);\r\n\r\n    if (this.olMap) {\r\n      this.olMap.removeInteraction(this.olDrawInteraction);\r\n      this.olMap.removeInteraction(this.olModifyInteraction);\r\n    }\r\n\r\n    this.olDrawInteraction = undefined;\r\n    this.olModifyInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * When drawing starts, clear the overlay and start watching for changes\r\n   * @param event Draw start event\r\n   */\r\n  private onDrawStart(event: OlDrawEvent) {\r\n    const olGeometry = event.feature.getGeometry();\r\n    this.start$.next(olGeometry);\r\n    this.clearOlInnerOverlaySource();\r\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\r\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n      this.changes$.next(olGeometryEvent.target);\r\n    });\r\n    this.subscribeKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When drawing ends, update the drawing (feature) geometry observable and add\r\n   * @param event Draw event (drawend)\r\n   */\r\n  private onDrawEnd(event: OlDrawEvent) {\r\n    if (event.feature.getGeometry().getType() === 'Point') {\r\n      this.radiusDrawEnd$.next(this.predefinedRadius$.getValue());\r\n    }\r\n    this.unsubscribeKeyDown();\r\n    unByKey(this.onDrawKey);\r\n    const olGeometry = event.feature.getGeometry();\r\n    olGeometry.on('change', () => {\r\n      this.modify$.next(olGeometry);\r\n    });\r\n    this.end$.next(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * When a feature is selected, update the selected feature observable\r\n   * @param event Modify event (modifyend)\r\n   */\r\n  private onSelect(event: OlSelectEvent) {\r\n    if (event.selected.length === 1) {\r\n      this.select$.next(event.selected[0]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to key downs used as drawing interaction shorcuts\r\n   */\r\n  private subscribeKeyDown() {\r\n    this.unsubscribeKeyDown();\r\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        // On Escape or 'c' keydowns, abort the current drawing\r\n        if (event.key === 'Escape') {\r\n          this.olDrawInteraction.abortDrawing();\r\n          return;\r\n        }\r\n\r\n        // On Backspace or 'u' keydowns, remove last vertex of current drawing\r\n        if (event.key === 'Backspace') {\r\n          this.olDrawInteraction.removeLastPoint();\r\n        }\r\n\r\n        // On Enter or 'f' keydowns, finish current drawing\r\n        if (event.key === 'Enter') {\r\n          this.olDrawInteraction.finishDrawing();\r\n        }\r\n\r\n        // On space bar key down, pan to the current mouse position\r\n        if (event.key === ' ') {\r\n          this.olMap.getView().animate({\r\n            center: this.mousePosition,\r\n            duration: 100\r\n          });\r\n          return;\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key down\r\n   */\r\n  private unsubscribeKeyDown() {\r\n    if (this.keyDown$$) {\r\n      this.keyDown$$.unsubscribe();\r\n      this.keyDown$$ = undefined;\r\n    }\r\n  }\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport OlFeature from 'ol/Feature';\r\nimport * as OlStyle from 'ol/style';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlModify from 'ol/interaction/Modify';\r\nimport OlTranslate from 'ol/interaction/Translate';\r\nimport OlDraw from 'ol/interaction/Draw';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlLinearRing from 'ol/geom/LinearRing';\r\nimport OlInteraction from 'ol/interaction/Interaction';\r\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\r\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport BasicEvent from 'ol/events/Event';\r\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\r\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\r\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport { Subject, Subscription, fromEvent } from 'rxjs';\r\n\r\nimport {\r\n  addLinearRingToOlPolygon,\r\n  createDrawHoleInteractionStyle,\r\n  getMousePositionFromOlGeometryEvent\r\n} from '../geometry.utils';\r\n\r\nexport interface ModifyControlOptions {\r\n  source?: OlVectorSource<any>;\r\n  layer?: OlVectorLayer<any>;\r\n  layerStyle?: OlStyleLike;\r\n  drawStyle?: OlStyleLike;\r\n  modify?: boolean;\r\n  translate?: boolean;\r\n}\r\n\r\n/**\r\n * Control to modify geometries\r\n */\r\nexport class ModifyControl {\r\n  /**\r\n   * Modify start observable\r\n   */\r\n  public start$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Modify end observable\r\n   */\r\n  public end$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Geometry changes observable\r\n   */\r\n  public changes$: Subject<OlGeometry> = new Subject();\r\n\r\n  private olMap: OlMap;\r\n  private olOverlayLayer: OlVectorLayer<any>;\r\n  public olModifyInteraction: OlModify;\r\n  private onModifyStartKey: any;\r\n  private onModifyEndKey: any;\r\n  private onModifyKey: any;\r\n  private olModifyInteractionIsActive: boolean = false;\r\n  private olTranslateInteraction: OlTranslate;\r\n  private onTranslateStartKey: any;\r\n  private onTranslateEndKey: any;\r\n  private onTranslateKey: any;\r\n  private olTranslateInteractionIsActive: boolean = false;\r\n  private olDrawInteraction: OlDraw;\r\n  private onDrawStartKey: any;\r\n  private onDrawEndKey: any;\r\n  private onDrawKey: any;\r\n  private olDrawInteractionIsActive: boolean = false;\r\n\r\n  private mousePosition: [number, number];\r\n\r\n  private keyDown$$: Subscription;\r\n  private drawKeyUp$$: Subscription;\r\n  private drawKeyDown$$: Subscription;\r\n\r\n  private removedOlInteractions: OlInteraction[] = [];\r\n  private olLinearRingsLayer: OlVectorLayer<any>;\r\n\r\n  // This is the geometry to test against when drawing holes\r\n  private olOuterGeometry: OlGeometry;\r\n\r\n  /**\r\n   * Wheter the control is active\r\n   */\r\n  get active(): boolean {\r\n    return this.olMap !== undefined;\r\n  }\r\n\r\n  /**\r\n   * OL overlay source\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource<any> {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  /**\r\n   * OL linear rings source\r\n   * @internal\r\n   */\r\n  get olLinearRingsSource(): OlVectorSource<any> {\r\n    return this.olLinearRingsLayer.getSource();\r\n  }\r\n\r\n  /**\r\n   * Whether a modify control should be available\r\n   */\r\n  private modify: boolean = true;\r\n\r\n  /**\r\n   * Whether a translate control should be available\r\n   */\r\n  private translate: boolean = true;\r\n\r\n  constructor(private options: ModifyControlOptions) {\r\n    if (options.modify !== undefined) {\r\n      this.modify = options.modify;\r\n    }\r\n    if (options.translate !== undefined) {\r\n      this.translate = options.translate;\r\n    }\r\n\r\n    if (options.layer !== undefined) {\r\n      this.olOverlayLayer = options.layer;\r\n    } else {\r\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\r\n    }\r\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\r\n  }\r\n\r\n  /**\r\n   * Add or remove this control to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap === undefined) {\r\n      this.clearOlInnerOverlaySource();\r\n      this.removeOlInnerOverlayLayer();\r\n      this.removeOlModifyInteraction();\r\n      this.removeOlTranslateInteraction();\r\n      this.removeOlDrawInteraction();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n    this.addOlInnerOverlayLayer();\r\n\r\n    // The order in which these interactions\r\n    // are added is important\r\n    if (this.modify === true) {\r\n      this.addOlDrawInteraction();\r\n    }\r\n\r\n    if (this.translate === true) {\r\n      this.addOlTranslateInteraction();\r\n      this.activateTranslateInteraction();\r\n    }\r\n\r\n    if (this.modify === true) {\r\n      this.addOlModifyInteraction();\r\n      this.activateModifyInteraction();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the overlay source\r\n   */\r\n  getSource(): OlVectorSource<any> {\r\n    return this.olOverlaySource;\r\n  }\r\n\r\n  /**\r\n   * Add an OL geometry to the overlay and start modifying it\r\n   * @param olGeometry Ol Geometry\r\n   */\r\n  setOlGeometry(olGeometry: OlGeometry) {\r\n    const olFeature = new OlFeature({ geometry: olGeometry });\r\n    this.olOverlaySource.clear();\r\n    this.olOverlaySource.addFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Create an overlay source if none is defined in the options\r\n   */\r\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\r\n    return new OlVectorLayer({\r\n      source: this.options.source ? this.options.source : new OlVectorSource(),\r\n      style: this.options.layerStyle,\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer if it wasn't defined in the options\r\n   */\r\n  private addOlInnerOverlayLayer() {\r\n    if (this.options.layer === undefined) {\r\n      this.olMap.addLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer if it wasn't defined in the options\r\n   */\r\n  private removeOlInnerOverlayLayer() {\r\n    if (this.options.layer === undefined && this.olMap !== undefined) {\r\n      this.olMap.removeLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay source if it wasn't defined in the options\r\n   */\r\n  private clearOlInnerOverlaySource() {\r\n    if (this.options.layer === undefined && this.options.source === undefined) {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n  }\r\n\r\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\r\n    return new OlVectorLayer({\r\n      source: new OlVectorSource(),\r\n      style: createDrawHoleInteractionStyle(),\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the linear rings layer\r\n   */\r\n  private addOlLinearRingsLayer() {\r\n    this.olMap.addLayer(this.olLinearRingsLayer);\r\n  }\r\n\r\n  /**\r\n   * Clear the linear rings layer\r\n   */\r\n  private removeOlLinearRingsLayer() {\r\n    this.olMap.removeLayer(this.olLinearRingsLayer);\r\n  }\r\n\r\n  /**\r\n   * Clear the linear rings source\r\n   */\r\n  private clearOlLinearRingsSource() {\r\n    this.olLinearRingsSource.clear(true);\r\n  }\r\n\r\n  /**\r\n   * Add a modify interaction to the map an set up some listeners\r\n   */\r\n  private addOlModifyInteraction() {\r\n    const olModifyInteraction = new OlModify({\r\n      source: this.olOverlaySource,\r\n      style: this.options.drawStyle as OlStyle.Style\r\n    });\r\n    this.olModifyInteraction = olModifyInteraction;\r\n  }\r\n\r\n  /**\r\n   * Remove the modify interaction\r\n   */\r\n  private removeOlModifyInteraction() {\r\n    if (this.olModifyInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateModifyInteraction();\r\n    this.olModifyInteraction = undefined;\r\n  }\r\n\r\n  private activateModifyInteraction() {\r\n    if (this.olModifyInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.olModifyInteractionIsActive = true;\r\n    this.onModifyStartKey = this.olModifyInteraction.on(\r\n      'modifystart',\r\n      (event: OlModifyEvent) => this.onModifyStart(event)\r\n    );\r\n    this.onModifyEndKey = this.olModifyInteraction.on(\r\n      'modifyend',\r\n      (event: OlModifyEvent) => this.onModifyEnd(event)\r\n    );\r\n    this.olMap.addInteraction(this.olModifyInteraction);\r\n  }\r\n\r\n  private deactivateModifyInteraction() {\r\n    if (this.olModifyInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.olModifyInteractionIsActive = false;\r\n\r\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olModifyInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When modifying starts, clear the overlay and start watching for changes\r\n   * @param event Modify start event\r\n   */\r\n  private onModifyStart(event: OlModifyEvent) {\r\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\r\n    this.start$.next(olGeometry);\r\n    this.onModifyKey = olGeometry.on(\r\n      'change',\r\n      (olGeometryEvent: BasicEvent) => {\r\n        this.mousePosition =\r\n          getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n        this.changes$.next(\r\n          olGeometryEvent.target as OlLineString | OlCircle | OlPolygon\r\n        );\r\n      }\r\n    );\r\n    this.subscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When modifying ends, update the geometry observable and stop watching for changes\r\n   * @param event Modify end event\r\n   */\r\n  private onModifyEnd(event: OlModifyEvent) {\r\n    unByKey(this.onModifyKey);\r\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\r\n    this.unsubscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to space key down to pan the map\r\n   */\r\n  private subscribeToKeyDown() {\r\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        if (event.key === ' ') {\r\n          // On space bar, pan to the current mouse position\r\n          this.olMap.getView().animate({\r\n            center: this.mousePosition,\r\n            duration: 0\r\n          });\r\n          return;\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key down\r\n   */\r\n  private unsubscribeToKeyDown() {\r\n    if (this.keyDown$$ !== undefined) {\r\n      this.keyDown$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a translate interaction to the map an set up some listeners\r\n   */\r\n  private addOlTranslateInteraction() {\r\n    const olTranslateInteraction = new OlTranslate({\r\n      layers: [this.olOverlayLayer]\r\n    });\r\n    this.olTranslateInteraction = olTranslateInteraction;\r\n  }\r\n\r\n  /**\r\n   * Remove the translate interaction\r\n   */\r\n  private removeOlTranslateInteraction() {\r\n    if (this.olTranslateInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateTranslateInteraction();\r\n    this.olTranslateInteraction = undefined;\r\n  }\r\n\r\n  private activateTranslateInteraction() {\r\n    if (this.olTranslateInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.olTranslateInteractionIsActive = true;\r\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\r\n      'translatestart',\r\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\r\n    );\r\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\r\n      'translateend',\r\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\r\n    );\r\n    this.olMap.addInteraction(this.olTranslateInteraction);\r\n  }\r\n\r\n  private deactivateTranslateInteraction() {\r\n    if (this.olTranslateInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.olTranslateInteractionIsActive = false;\r\n    unByKey([\r\n      this.onTranslateStartKey,\r\n      this.onTranslateEndKey,\r\n      this.onTranslateKey\r\n    ]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olTranslateInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When translation starts, clear the overlay and start watching for changes\r\n   * @param event Translate start event\r\n   */\r\n  private onTranslateStart(event: OlTranslateEvent) {\r\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\r\n    this.start$.next(olGeometry);\r\n    this.onTranslateKey = olGeometry.on(\r\n      'change',\r\n      (olGeometryEvent: BasicEvent) => {\r\n        // this.changes$.next(olGeometryEvent.target);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * When translation ends, update the geometry observable and stop watchign for changes\r\n   * @param event Translate end event\r\n   */\r\n  private onTranslateEnd(event: OlTranslateEvent) {\r\n    unByKey(this.onTranslateKey);\r\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\r\n  }\r\n\r\n  /**\r\n   * Add a draw interaction to the map an set up some listeners\r\n   */\r\n  private addOlDrawInteraction() {\r\n    const olDrawInteraction = new OlDraw({\r\n      type: 'Polygon',\r\n      source: this.olLinearRingsSource,\r\n      stopClick: true,\r\n      style: createDrawHoleInteractionStyle(),\r\n      condition: (event: MapBrowserEvent<any>) => {\r\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\r\n        const intersects = olOuterGeometry.intersectsCoordinate(\r\n          event.coordinate\r\n        );\r\n        return intersects;\r\n      }\r\n    });\r\n\r\n    this.olDrawInteraction = olDrawInteraction;\r\n    this.subscribeToDrawKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to CTRL key down to activate the draw control\r\n   */\r\n  private subscribeToDrawKeyDown() {\r\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        if (event.key !== 'Control') {\r\n          return;\r\n        }\r\n\r\n        this.unsubscribeToDrawKeyDown();\r\n\r\n        const olGeometry = this.getOlGeometry();\r\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\r\n          return;\r\n        }\r\n\r\n        this.subscribeToDrawKeyUp();\r\n\r\n        this.deactivateModifyInteraction();\r\n        this.deactivateTranslateInteraction();\r\n        this.activateDrawInteraction();\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Subscribe to CTRL key up to deactivate the draw control\r\n   */\r\n  private subscribeToDrawKeyUp() {\r\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        if (event.key !== 'Control') {\r\n          return;\r\n        }\r\n\r\n        this.unsubscribeToDrawKeyUp();\r\n        this.unsubscribeToKeyDown();\r\n        this.deactivateDrawInteraction();\r\n\r\n        this.activateModifyInteraction();\r\n        if (this.translate === true) {\r\n          this.activateTranslateInteraction();\r\n        }\r\n        this.subscribeToDrawKeyDown();\r\n\r\n        this.olOuterGeometry = undefined;\r\n        this.clearOlLinearRingsSource();\r\n        this.end$.next(this.getOlGeometry());\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to draw key down\r\n   */\r\n  private unsubscribeToDrawKeyDown() {\r\n    if (this.drawKeyDown$$ !== undefined) {\r\n      this.drawKeyDown$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key up\r\n   */\r\n  private unsubscribeToDrawKeyUp() {\r\n    if (this.drawKeyUp$$ !== undefined) {\r\n      this.drawKeyUp$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the draw interaction\r\n   */\r\n  private removeOlDrawInteraction() {\r\n    if (this.olDrawInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.unsubscribeToKeyDown();\r\n    this.unsubscribeToDrawKeyUp();\r\n    this.unsubscribeToDrawKeyDown();\r\n    this.deactivateDrawInteraction();\r\n    this.clearOlLinearRingsSource();\r\n    this.olDrawInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * Activate the draw interaction\r\n   */\r\n  private activateDrawInteraction() {\r\n    if (this.olDrawInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.clearOlLinearRingsSource();\r\n    this.addOlLinearRingsLayer();\r\n\r\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\r\n      if (olInteraction instanceof OlDragBoxInteraction) {\r\n        this.olMap.removeInteraction(olInteraction);\r\n        this.removedOlInteractions.push(olInteraction);\r\n      }\r\n    });\r\n\r\n    this.olDrawInteractionIsActive = true;\r\n    this.onDrawStartKey = this.olDrawInteraction.on(\r\n      'drawstart',\r\n      (event: OlDrawEvent) => this.onDrawStart(event)\r\n    );\r\n    this.onDrawEndKey = this.olDrawInteraction.on(\r\n      'drawend',\r\n      (event: OlDrawEvent) => this.onDrawEnd(event)\r\n    );\r\n    this.olMap.addInteraction(this.olDrawInteraction);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the draw interaction\r\n   */\r\n  private deactivateDrawInteraction() {\r\n    if (this.olDrawInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.removeOlLinearRingsLayer();\r\n\r\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\r\n      this.olMap.addInteraction(olInteraction);\r\n    });\r\n    this.removedOlInteractions = [];\r\n\r\n    this.olDrawInteractionIsActive = false;\r\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olDrawInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\r\n   * @param event Draw start event\r\n   */\r\n  private onDrawStart(event: OlDrawEvent) {\r\n    const olGeometry = event.feature.getGeometry();\r\n    this.olOuterGeometry = this.getOlGeometry().clone();\r\n\r\n    const linearRingCoordinates = (\r\n      (olGeometry as any).getLinearRing() as any\r\n    ).getCoordinates();\r\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\r\n    this.start$.next(this.getOlGeometry());\r\n\r\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\r\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n      const olGeometryTarget = olGeometryEvent.target as OlPolygon;\r\n      const _linearRingCoordinates = olGeometryTarget\r\n        .getLinearRing(0)\r\n        .getCoordinates();\r\n      this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\r\n      this.changes$.next(this.getOlGeometry());\r\n    });\r\n    this.subscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When translation ends, update the geometry observable and stop watchign for changes\r\n   * @param event Draw end event\r\n   */\r\n  private onDrawEnd(event: OlDrawEvent) {\r\n    unByKey(this.onDrawKey);\r\n    this.olOuterGeometry = undefined;\r\n\r\n    const linearRingCoordinates = (\r\n      (event.feature.getGeometry() as any).getLinearRing() as any\r\n    ).getCoordinates();\r\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\r\n    this.clearOlLinearRingsSource();\r\n    this.end$.next(this.getOlGeometry());\r\n    this.unsubscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Add a linear ring to the geometry being modified\r\n   * @param coordinates Linear ring coordinates\r\n   */\r\n  private addLinearRingToOlGeometry(coordinates: number[]) {\r\n    const olGeometry = this.getOlGeometry() as OlPolygon;\r\n    const olLinearRing = new OlLinearRing(coordinates);\r\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\r\n  }\r\n\r\n  /**\r\n   * Update the last linear ring of the geometry being modified\r\n   * @param coordinates Linear ring coordinates\r\n   */\r\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\r\n    const olGeometry = this.getOlGeometry() as OlPolygon;\r\n    // Remove the last linear ring (the one we are updating)\r\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\r\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\r\n      return olLinearRing.getCoordinates();\r\n    });\r\n    newCoordinates.push(coordinates);\r\n    olGeometry.setCoordinates(newCoordinates);\r\n  }\r\n\r\n  /**\r\n   * Get the geometry being modified\r\n   * @returns OL Geometry\r\n   */\r\n  private getOlGeometry(): OlGeometry {\r\n    const olFeatures = this.olOverlaySource.getFeatures();\r\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\r\n  }\r\n}\r\n","export const LAYER = 'Layer';\n","<h3 mat-dialog-title>{{ 'igo.geo.measure.dialog.title' | translate }}</h3>\r\n<div mat-dialog-content>\r\n  <table *ngIf=\"data.length > 0\" class=\"mat-typography\">\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">\r\n          {{ 'igo.geo.measure.dialog.length.title' | translate }}\r\n        </th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{ data.length | measureFormat: measureLengthUnit.Meters }}</td>\r\n        <td>{{ 'igo.geo.measure.dialog.lengthInMeters' | translate }}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>\r\n          {{ data.length | measureFormat: measureLengthUnit.Kilometers }}\r\n        </td>\r\n        <td>{{ 'igo.geo.measure.dialog.lengthInKilometers' | translate }}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{ data.length | measureFormat: measureLengthUnit.Miles }}</td>\r\n        <td>{{ 'igo.geo.measure.dialog.lengthInMiles' | translate }}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{ data.length | measureFormat: measureLengthUnit.Feet }}</td>\r\n        <td>{{ 'igo.geo.measure.dialog.lengthInFeet' | translate }}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n\r\n  <table *ngIf=\"data.area > 0\" class=\"mat-typography\">\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">\r\n          {{ 'igo.geo.measure.dialog.area.title' | translate }}\r\n        </th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMeters }}</td>\r\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMeters' | translate }}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>\r\n          {{ data.area | measureFormat: measureAreaUnit.SquareKilometers }}\r\n        </td>\r\n        <td>\r\n          {{ 'igo.geo.measure.dialog.areaInSquareKilometers' | translate }}\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMiles }}</td>\r\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMiles' | translate }}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{ data.area | measureFormat: measureAreaUnit.Acres }}</td>\r\n        <td>{{ 'igo.geo.measure.dialog.areaInAcres' | translate }}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{ data.area | measureFormat: measureAreaUnit.Hectares }}</td>\r\n        <td>{{ 'igo.geo.measure.dialog.areaInHectares' | translate }}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{ 'igo.geo.measure.dialog.perimeterInMeters' | translate }}</td>\r\n        <td>{{ data.perimeter | measureFormat: measureLengthUnit.Meters }}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n","import { Component, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\n\r\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\r\n\r\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\r\n\r\n@Component({\r\n  selector: 'igo-measurer-dialog',\r\n  templateUrl: 'measurer-dialog.component.html',\r\n  styleUrls: ['./measurer-dialog.component.scss']\r\n})\r\nexport class MeasurerDialogComponent {\r\n  measureAreaUnit = MeasureAreaUnit;\r\n\r\n  measureLengthUnit = MeasureLengthUnit;\r\n\r\n  constructor(\r\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\r\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\r\n  ) {}\r\n\r\n  onNoClick(): void {\r\n    this.dialogRef.close();\r\n  }\r\n}\r\n","<div>\r\n  <div class=\"measure-type-toggle mat-typography\">\r\n    <mat-button-toggle-group\r\n      [value]=\"activeMeasureType\"\r\n      (change)=\"onMeasureTypeChange($event.value)\"\r\n    >\r\n      <mat-button-toggle [value]=\"measureType.Length\">\r\n        {{ 'igo.geo.measure.' + measureType.Length | translate }}\r\n      </mat-button-toggle>\r\n      <mat-button-toggle [value]=\"measureType.Area\">\r\n        {{ 'igo.geo.measure.' + measureType.Area | translate }}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class=\"measure-options mat-typography\">\r\n    <mat-slide-toggle\r\n      [disabled]=\"drawControlIsDisabled\"\r\n      [checked]=\"drawControlIsActive\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDrawControl($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleActive' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-divider *ngIf=\"hasLine$ | async\"></mat-divider>\r\n\r\n    <mat-slide-toggle\r\n      *ngIf=\"hasLine$ | async\"\r\n      [checked]=\"displayLines\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDisplayLines($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleDisplayLines' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\r\n\r\n    <mat-slide-toggle\r\n      *ngIf=\"hasArea$ | async\"\r\n      [checked]=\"displayDistance\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDisplayDistance($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleDisplayDistance' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      *ngIf=\"hasArea$ | async\"\r\n      [checked]=\"displayAreas\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDisplayAreas($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleDisplayAreas' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-divider *ngIf=\"hasArea$ | async\"></mat-divider>\r\n\r\n    <mat-slide-toggle\r\n      [checked]=\"measureUnitsAuto\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleAutoUnits' | translate }}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <ng-container *ngIf=\"measure$ | async as measure\">\r\n    <igo-measurer-item\r\n      *ngIf=\"\r\n        activeMeasureType === measureType.Length ||\r\n        activeMeasureType === measureType.Area\r\n      \"\r\n      [measureType]=\"measureType.Length\"\r\n      [measureUnit]=\"measureLengthUnit.Meters\"\r\n      [measure]=\"measure.length\"\r\n      [auto]=\"measureUnitsAuto\"\r\n      [placeholder]=\"\r\n        (activeMeasureType === measureType.Area\r\n          ? 'igo.geo.measure.perimeter'\r\n          : 'igo.geo.measure.length'\r\n        ) | translate\r\n      \"\r\n      (measureUnitChange)=\"onLengthUnitChange($event)\"\r\n    >\r\n    </igo-measurer-item>\r\n\r\n    <igo-measurer-item\r\n      *ngIf=\"activeMeasureType === measureType.Area\"\r\n      [measureType]=\"measureType.Area\"\r\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\r\n      [measure]=\"measure.area\"\r\n      [auto]=\"measureUnitsAuto\"\r\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\r\n      (measureUnitChange)=\"onAreaUnitChange($event)\"\r\n    >\r\n    </igo-measurer-item>\r\n  </ng-container>\r\n\r\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\r\n\r\n  <div class=\"measure-store-buttons\">\r\n    <button\r\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\r\n      color=\"accent\"\r\n      (click)=\"onCalculateClick()\"\r\n    >\r\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\r\n      color=\"warn\"\r\n      (click)=\"onDeleteClick()\"\r\n    >\r\n      <mat-icon svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n\r\n    <!--button\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\r\n      (click)=\"onModifyClick()\">\r\n      <mat-icon svgIcon=\"edit\"></mat-icon>\r\n    </button-->\r\n  </div>\r\n\r\n  <igo-entity-table\r\n    #table\r\n    class=\"table-compact\"\r\n    [store]=\"store\"\r\n    [template]=\"tableTemplate\"\r\n  >\r\n  </igo-entity-table>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { skip } from 'rxjs/operators';\r\n\r\nimport OlStyle from 'ol/style/Style';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport { LanguageService, StorageScope, StorageService } from '@igo2/core';\r\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\r\nimport type { EntityTableComponent } from '@igo2/common';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport {\r\n  FEATURE,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  tryBindStoreLayer,\r\n  tryAddLoadingStrategy,\r\n  tryAddSelectionStrategy\r\n} from '../../feature';\r\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\nimport {\r\n  Measure,\r\n  MeasurerDialogData,\r\n  FeatureWithMeasure\r\n} from '../shared/measure.interfaces';\r\nimport {\r\n  MeasureType,\r\n  MeasureAreaUnit,\r\n  MeasureLengthUnit\r\n} from '../shared/measure.enum';\r\nimport {\r\n  measureOlGeometry,\r\n  createMeasureInteractionStyle,\r\n  createMeasureLayerStyle,\r\n  updateOlTooltipsAtMidpoints,\r\n  updateOlTooltipAtCenter,\r\n  getTooltipsOfOlGeometry,\r\n  squareMetersToUnit,\r\n  metersToUnit,\r\n  formatMeasure\r\n} from '../shared/measure.utils';\r\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\r\n\r\n/**\r\n * Tool to measure lengths and areas\r\n */\r\n@Component({\r\n  selector: 'igo-measurer',\r\n  templateUrl: './measurer.component.html',\r\n  styleUrls: ['./measurer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Table template\r\n   * @internal\r\n   */\r\n  public tableTemplate: EntityTableTemplate;\r\n\r\n  private subscriptions$$: Subscription[] = [];\r\n\r\n  /**\r\n   * Reference to the MeasureType enum\r\n   * @internal\r\n   */\r\n  public measureType = MeasureType;\r\n\r\n  /**\r\n   * Reference to the AreaMeasureUnit enum\r\n   * @internal\r\n   */\r\n  public measureAreaUnit = MeasureAreaUnit;\r\n\r\n  /**\r\n   * Reference to the LengthMeasureUnit enum\r\n   * @internal\r\n   */\r\n  public measureLengthUnit = MeasureLengthUnit;\r\n\r\n  /**\r\n   * Whether measure units should be automatically determined\r\n   * @internal\r\n   */\r\n  public measureUnitsAuto: boolean = false;\r\n\r\n  /**\r\n   * Whether display of distances of areas\r\n   * @internal\r\n   */\r\n  public displayDistance: boolean = true;\r\n\r\n  /**\r\n   * Whether display of distances of lines\r\n   * @internal\r\n   */\r\n  public displayLines: boolean = true;\r\n\r\n  /**\r\n   * Whether display of areas\r\n   * @internal\r\n   */\r\n  public displayAreas: boolean = true;\r\n\r\n  /**\r\n   * Observable of line boolean\r\n   * @internal\r\n   */\r\n  public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Observable of area boolean\r\n   * @internal\r\n   */\r\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Observable of area\r\n   * @internal\r\n   */\r\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\r\n\r\n  /**\r\n   * Observable of selected features\r\n   * @internal\r\n   */\r\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> =\r\n    new BehaviorSubject([]);\r\n\r\n  /**\r\n   * OL draw source\r\n   * @internal\r\n   */\r\n  public showTooltips: boolean = true;\r\n\r\n  /**\r\n   * Whether draw control toggle is disabled or not\r\n   * @internal\r\n   */\r\n  public drawControlIsDisabled: boolean = true;\r\n\r\n  /**\r\n   * Draw line control\r\n   */\r\n  private drawLineControl: DrawControl;\r\n\r\n  /**\r\n   * Draw polygon control\r\n   */\r\n  private drawPolygonControl: DrawControl;\r\n\r\n  /**\r\n   * Modify control\r\n   */\r\n  private modifyControl: ModifyControl;\r\n\r\n  /**\r\n   * Active OL geometry\r\n   */\r\n  private activeOlGeometry: OlLineString | OlPolygon;\r\n\r\n  /**\r\n   * Active mlength unit\r\n   */\r\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n\r\n  /**\r\n   * Active area unit\r\n   */\r\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\r\n\r\n  /**\r\n   * Feature added listener key\r\n   */\r\n  private onFeatureAddedKey;\r\n\r\n  /**\r\n   * Feature removed listener key\r\n   */\r\n  private onFeatureRemovedKey;\r\n\r\n  /**\r\n   * Active draw control\r\n   * @internal\r\n   */\r\n  private activeDrawControl: DrawControl;\r\n\r\n  /**\r\n   * Subscription to draw start\r\n   */\r\n  private drawStart$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to draw end\r\n   */\r\n  private drawEnd$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to controls changes\r\n   */\r\n  private drawChanges$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to modify start\r\n   */\r\n  private modifyStart$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to modify end\r\n   */\r\n  private modifyEnd$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to controls changes\r\n   */\r\n  private modifyChanges$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to measures selection\r\n   */\r\n  private selectedFeatures$$: Subscription;\r\n\r\n  /**\r\n   * OL draw source\r\n   */\r\n  private olDrawSource = new OlVectorSource();\r\n\r\n  /**\r\n   * The map to measure on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The measures store\r\n   */\r\n  @Input() store: FeatureStore<FeatureWithMeasure>;\r\n\r\n  /**\r\n   * Measure type\r\n   * @internal\r\n   */\r\n  @Input()\r\n  set activeMeasureType(value: MeasureType) {\r\n    this.setActiveMeasureType(value);\r\n  }\r\n  get activeMeasureType(): MeasureType {\r\n    return this._activeMeasureType;\r\n  }\r\n  private _activeMeasureType: MeasureType;\r\n\r\n  /**\r\n   * The minimum length a segment must have to display a tooltip.\r\n   * It also applies to area tooltips.\r\n   */\r\n  @Input() minSegmentLength: number = 10;\r\n\r\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\r\n\r\n  /**\r\n   * Wheter one of the draw control is active\r\n   * @internal\r\n   */\r\n  get drawControlIsActive(): boolean {\r\n    return this.activeDrawControl !== undefined;\r\n  }\r\n\r\n  get projection(): string {\r\n    return this.map.ol.getView().getProjection().getCode();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dialog: MatDialog,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.tableTemplate = {\r\n      selection: true,\r\n      selectMany: true,\r\n      selectionCheckbox: true,\r\n      sort: true,\r\n      columns: [\r\n        {\r\n          name: 'length',\r\n          title: this.languageService.translate.instant(\r\n            'igo.geo.measure.lengthHeader'\r\n          ),\r\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\r\n            const unit = this.activeLengthUnit;\r\n            const measure = metersToUnit(\r\n              localFeature.properties.measure.length,\r\n              unit\r\n            );\r\n            return formatMeasure(measure, {\r\n              decimal: 1,\r\n              unit,\r\n              unitAbbr: false,\r\n              locale: 'fr'\r\n            });\r\n          }\r\n        },\r\n        {\r\n          name: 'area',\r\n          title: this.languageService.translate.instant(\r\n            'igo.geo.measure.areaHeader'\r\n          ),\r\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\r\n            const unit = this.activeAreaUnit;\r\n            const measure = squareMetersToUnit(\r\n              localFeature.properties.measure.area,\r\n              unit\r\n            );\r\n            return measure\r\n              ? formatMeasure(measure, {\r\n                  decimal: 1,\r\n                  unit,\r\n                  unitAbbr: false,\r\n                  locale: 'fr'\r\n                })\r\n              : '';\r\n          }\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add draw controls and activate one\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.initStore();\r\n    this.createDrawLineControl();\r\n    this.createDrawPolygonControl();\r\n    this.createModifyControl();\r\n    this.toggleDrawControl();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    this.checkDistanceAreaToggle();\r\n    this.setActiveMeasureType(MeasureType.Length);\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer and any interaction added by this component.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.setActiveMeasureType(undefined);\r\n    this.deactivateModifyControl();\r\n    this.freezeStore();\r\n    this.subscriptions$$.map((s) => s.unsubscribe());\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onMeasureTypeChange(measureType: MeasureType) {\r\n    this.activeMeasureType = measureType;\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current draw control\r\n   * @internal\r\n   */\r\n  onToggleDrawControl(toggle: boolean) {\r\n    if (toggle === true) {\r\n      this.toggleDrawControl();\r\n    } else {\r\n      this.deactivateDrawControl();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current draw control\r\n   * @internal\r\n   */\r\n  onToggleMeasureUnitsAuto(toggle: boolean) {\r\n    this.measureUnitsAuto = toggle;\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of the areas\r\n   * @internal\r\n   */\r\n  onToggleDisplayDistance(toggle: boolean) {\r\n    this.displayDistance = toggle;\r\n    this.onDisplayDistance();\r\n    toggle\r\n      ? this.storageService.set('distanceToggle', true, StorageScope.SESSION)\r\n      : this.storageService.set('distanceToggle', false, StorageScope.SESSION);\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of the lines\r\n   * @internal\r\n   */\r\n  onToggleDisplayLines(toggle: boolean) {\r\n    this.displayLines = toggle;\r\n    this.onDisplayLines();\r\n    toggle\r\n      ? this.storageService.set('linesToggle', true, StorageScope.SESSION)\r\n      : this.storageService.set('linesToggle', false, StorageScope.SESSION);\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of areas\r\n   * @internal\r\n   */\r\n  onToggleDisplayAreas(toggle: boolean) {\r\n    this.displayAreas = toggle;\r\n    this.onDisplayAreas();\r\n    toggle\r\n      ? this.storageService.set('areasToggle', true, StorageScope.SESSION)\r\n      : this.storageService.set('areasToggle', false, StorageScope.SESSION);\r\n  }\r\n\r\n  /**\r\n   * Set display parametres in current values\r\n   * @internal\r\n   */\r\n  checkDistanceAreaToggle() {\r\n    if (this.storageService.get('distanceToggle') === false) {\r\n      this.displayDistance = false;\r\n    }\r\n    if (this.storageService.get('linesToggle') === false) {\r\n      this.displayLines = false;\r\n    }\r\n    if (this.storageService.get('areasToggle') === false) {\r\n      this.displayAreas = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of areas\r\n   * @internal\r\n   */\r\n  onDisplayDistance() {\r\n    if (this.displayDistance) {\r\n      Array.from(\r\n        document.getElementsByClassName(\r\n          'igo-map-tooltip-measure-polygone-segments'\r\n        )\r\n      ).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-hidden')\r\n      );\r\n    } else {\r\n      Array.from(\r\n        document.getElementsByClassName(\r\n          'igo-map-tooltip-measure-polygone-segments'\r\n        )\r\n      ).map((value: Element) => value.classList.add('igo-map-tooltip-hidden'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of lines\r\n   * @internal\r\n   */\r\n  onDisplayLines() {\r\n    if (this.displayLines) {\r\n      Array.from(\r\n        document.getElementsByClassName('igo-map-tooltip-measure-line-segments')\r\n      ).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-hidden')\r\n      );\r\n    } else {\r\n      Array.from(\r\n        document.getElementsByClassName('igo-map-tooltip-measure-line-segments')\r\n      ).map((value: Element) => value.classList.add('igo-map-tooltip-hidden'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of areas\r\n   * @internal\r\n   */\r\n  onDisplayAreas() {\r\n    if (this.displayAreas) {\r\n      Array.from(\r\n        document.getElementsByClassName('igo-map-tooltip-measure-area')\r\n      ).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-hidden')\r\n      );\r\n    } else {\r\n      Array.from(\r\n        document.getElementsByClassName('igo-map-tooltip-measure-area')\r\n      ).map((value: Element) => value.classList.add('igo-map-tooltip-hidden'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onLengthUnitChange(unit: MeasureLengthUnit) {\r\n    this.activeLengthUnit = unit;\r\n    this.table.refresh();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onAreaUnitChange(unit: MeasureAreaUnit) {\r\n    this.activeAreaUnit = unit;\r\n    this.table.refresh();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n  }\r\n\r\n  onCalculateClick() {\r\n    const features = this.selectedFeatures$.value;\r\n    const area = features.reduce(\r\n      (sum: number, localFeature: FeatureWithMeasure) => {\r\n        return sum + localFeature.properties.measure.area || 0;\r\n      },\r\n      0\r\n    );\r\n    const length = features.reduce(\r\n      (sum: number, localFeature: FeatureWithMeasure) => {\r\n        if (localFeature.geometry.type === 'Polygon') {\r\n          return sum;\r\n        }\r\n        return sum + localFeature.properties.measure.length || 0;\r\n      },\r\n      0\r\n    );\r\n    const perimeter = features.reduce(\r\n      (sum: number, localFeature: FeatureWithMeasure) => {\r\n        if (localFeature.geometry.type === 'LineString') {\r\n          return sum;\r\n        }\r\n        return sum + localFeature.properties.measure.length || 0;\r\n      },\r\n      0\r\n    );\r\n\r\n    this.openDialog({\r\n      area,\r\n      length,\r\n      perimeter\r\n    });\r\n  }\r\n\r\n  onDeleteClick() {\r\n    this.store.deleteMany(this.selectedFeatures$.value);\r\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\r\n      this.olDrawSource.getFeatures().forEach((drawingLayerFeature) => {\r\n        const geometry = drawingLayerFeature.getGeometry() as any;\r\n        if (selectedFeature.properties.id === geometry.ol_uid) {\r\n          this.olDrawSource.removeFeature(drawingLayerFeature);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  onModifyClick() {\r\n    if (this.selectedFeatures$.value.length !== 1) {\r\n      return;\r\n    }\r\n\r\n    if (this.modifyControl.active === true) {\r\n      this.deactivateModifyControl();\r\n      this.toggleDrawControl();\r\n    } else {\r\n      const localFeature = this.selectedFeatures$.value[0];\r\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\r\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\r\n        return _olFeature.get('id') === localFeature.properties.id;\r\n      });\r\n\r\n      if (olFeature !== undefined) {\r\n        this.deactivateDrawControl();\r\n        this.activateModifyControl();\r\n\r\n        const olGeometry = olFeature.getGeometry();\r\n        this.clearTooltipsOfOlGeometry(olGeometry as OlLineString | OlPolygon);\r\n        this.modifyControl.setOlGeometry(olGeometry);\r\n      }\r\n    }\r\n  }\r\n\r\n  private openDialog(data: MeasurerDialogData): void {\r\n    this.dialog.open(MeasurerDialogComponent, { data });\r\n  }\r\n\r\n  /**\r\n   * Initialize the measure store and set up some listeners\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      title: this.languageService.translate.instant(\r\n        'igo.geo.measure.layerTitle'\r\n      ),\r\n      isIgoInternalLayer: true,\r\n      id: `igo-measures-${uuid()}`,\r\n      zIndex: 200,\r\n      source: new FeatureDataSource(),\r\n      style: createMeasureLayerStyle(),\r\n      showInLayerList: true,\r\n      exportable: true,\r\n      browsable: false,\r\n      workspace: { enabled: false }\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n    store.layer.visible = true;\r\n    layer.visible$.subscribe((visible) => {\r\n      if (visible) {\r\n        Array.from(\r\n          document.getElementsByClassName('igo-map-tooltip-measure')\r\n        ).map((value: Element) =>\r\n          value.classList.remove('igo-map-tooltip-measure-by-display')\r\n        );\r\n      } else {\r\n        Array.from(\r\n          document.getElementsByClassName('igo-map-tooltip-measure')\r\n        ).map((value: Element) =>\r\n          value.classList.add('igo-map-tooltip-measure-by-display')\r\n        );\r\n      }\r\n    });\r\n\r\n    tryAddLoadingStrategy(store);\r\n\r\n    tryAddSelectionStrategy(\r\n      store,\r\n      new FeatureStoreSelectionStrategy({\r\n        map: this.map,\r\n        many: true\r\n      })\r\n    );\r\n\r\n    this.onFeatureAddedKey = store.source.ol.on(\r\n      'addfeature',\r\n      (event: OlVectorSourceEvent<OlGeometry>) => {\r\n        const localFeature = event.feature;\r\n        const olGeometry = localFeature.getGeometry() as any;\r\n        this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\r\n        this.onDisplayDistance();\r\n      }\r\n    );\r\n\r\n    this.onFeatureRemovedKey = store.source.ol.on(\r\n      'removefeature',\r\n      (event: OlVectorSourceEvent<OlGeometry>) => {\r\n        const olGeometry = event.feature.getGeometry() as any;\r\n        this.clearTooltipsOfOlGeometry(olGeometry);\r\n      }\r\n    );\r\n\r\n    this.selectedFeatures$$ = store.stateView\r\n      .manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\r\n        return record.state.selected === true;\r\n      })\r\n      .pipe(\r\n        skip(1) // Skip initial emission\r\n      )\r\n      .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\r\n        if (this.modifyControl.active === true) {\r\n          this.deactivateModifyControl();\r\n        }\r\n        this.selectedFeatures$.next(records.map((record) => record.entity));\r\n      });\r\n\r\n    this.subscriptions$$.push(\r\n      this.store.entities$.subscribe((objectsExists) => {\r\n        if (\r\n          objectsExists.find(\r\n            (objectExist) => objectExist.geometry.type === 'Polygon'\r\n          )\r\n        ) {\r\n          this.hasArea$.next(true);\r\n        } else {\r\n          this.hasArea$.next(false);\r\n        }\r\n\r\n        if (\r\n          objectsExists.find(\r\n            (objectExist) => objectExist.geometry.type === 'LineString'\r\n          )\r\n        ) {\r\n          this.hasLine$.next(true);\r\n        } else {\r\n          this.hasLine$.next(false);\r\n        }\r\n      })\r\n    );\r\n\r\n    this.subscriptions$$.push(\r\n      this.store.count$.subscribe((cnt) => {\r\n        cnt >= 1\r\n          ? (this.store.layer.options.showInLayerList = true)\r\n          : (this.store.layer.options.showInLayerList = false);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\r\n   * and some listener removed\r\n   * @internal\r\n   */\r\n  private freezeStore() {\r\n    const store = this.store;\r\n    this.selectedFeatures$$.unsubscribe();\r\n    unByKey(this.onFeatureAddedKey);\r\n    unByKey(this.onFeatureRemovedKey);\r\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\r\n  }\r\n\r\n  /**\r\n   * Create a draw line control\r\n   */\r\n  private createDrawLineControl() {\r\n    this.drawLineControl = new DrawControl({\r\n      geometryType: 'LineString',\r\n      drawingLayerSource: this.olDrawSource,\r\n      interactionStyle: createMeasureInteractionStyle(),\r\n      drawingLayerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a draw polygon control\r\n   */\r\n  private createDrawPolygonControl() {\r\n    this.drawPolygonControl = new DrawControl({\r\n      geometryType: 'Polygon',\r\n      drawingLayerSource: this.olDrawSource,\r\n      interactionStyle: createMeasureInteractionStyle(),\r\n      drawingLayerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a draw polygon control\r\n   */\r\n  private createModifyControl() {\r\n    this.modifyControl = new ModifyControl({\r\n      source: this.olDrawSource,\r\n      drawStyle: createMeasureInteractionStyle(),\r\n      layerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate the right control\r\n   */\r\n  private toggleDrawControl() {\r\n    this.deactivateDrawControl();\r\n    // this.deactivateModifyControl();\r\n    if (this.activeMeasureType === MeasureType.Length) {\r\n      this.activateDrawControl(this.drawLineControl);\r\n    } else if (this.activeMeasureType === MeasureType.Area) {\r\n      this.activateDrawControl(this.drawPolygonControl);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param drawControl Draw control\r\n   */\r\n  private activateDrawControl(drawControl: DrawControl) {\r\n    this.drawControlIsDisabled = false;\r\n    this.activeDrawControl = drawControl;\r\n    this.drawStart$$ = drawControl.start$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry)\r\n    );\r\n    this.drawEnd$$ = drawControl.end$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry)\r\n    );\r\n    this.drawChanges$$ = drawControl.changes$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry)\r\n    );\r\n    this.drawChanges$$ = drawControl.abort$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => {\r\n        this.clearTooltipsOfOlGeometry(olGeometry);\r\n        this.clearMeasures();\r\n      }\r\n    );\r\n    drawControl.setOlMap(this.map.ol, false);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active draw control\r\n   */\r\n  private deactivateDrawControl() {\r\n    if (this.activeDrawControl === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.olDrawSource.clear();\r\n    if (this.drawStart$$ !== undefined) {\r\n      this.drawStart$$.unsubscribe();\r\n    }\r\n    if (this.drawEnd$$ !== undefined) {\r\n      this.drawEnd$$.unsubscribe();\r\n    }\r\n    if (this.drawChanges$$ !== undefined) {\r\n      this.drawChanges$$.unsubscribe();\r\n    }\r\n\r\n    this.clearTooltipsOfOlSource(this.olDrawSource);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n    this.activeDrawControl.setOlMap(undefined);\r\n    this.activeDrawControl = undefined;\r\n    this.activeOlGeometry = undefined;\r\n  }\r\n\r\n  private setActiveMeasureType(measureType: MeasureType) {\r\n    this._activeMeasureType = measureType;\r\n    this.clearMeasures();\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being drawn\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\r\n    this.activeOlGeometry = olGeometry;\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\r\n    this.activeOlGeometry = undefined;\r\n    this.finalizeMeasureOfOlGeometry(olGeometry);\r\n    this.addFeatureToStore(olGeometry);\r\n    this.clearTooltipsOfOlGeometry(olGeometry);\r\n    this.olDrawSource.clear(true);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = measureOlGeometry(olGeometry, this.projection);\r\n    this.updateMeasureOfOlGeometry(\r\n      olGeometry,\r\n      Object.assign({}, measure, {\r\n        area: undefined // We don't want to display an area tooltip while drawing.\r\n      })\r\n    );\r\n    this.measure$.next(measure);\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param modifyControl Modify control\r\n   */\r\n  private activateModifyControl() {\r\n    const selection = this.store.getStrategyOfType(\r\n      FeatureStoreSelectionStrategy\r\n    ) as FeatureStoreSelectionStrategy;\r\n    selection.deactivate();\r\n    selection.clear();\r\n\r\n    this.modifyStart$$ = this.modifyControl.start$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry)\r\n    );\r\n    this.modifyEnd$$ = this.modifyControl.end$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry)\r\n    );\r\n    this.modifyChanges$$ = this.modifyControl.changes$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry)\r\n    );\r\n    this.modifyControl.setOlMap(this.map.ol);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active modify control\r\n   */\r\n  private deactivateModifyControl() {\r\n    if (this.modifyStart$$ !== undefined) {\r\n      this.modifyStart$$.unsubscribe();\r\n    }\r\n    if (this.modifyEnd$$ !== undefined) {\r\n      this.modifyEnd$$.unsubscribe();\r\n    }\r\n    if (this.modifyChanges$$ !== undefined) {\r\n      this.modifyChanges$$.unsubscribe();\r\n    }\r\n\r\n    if (this.activeOlGeometry !== undefined) {\r\n      if (this.selectedFeatures$.value.length === 1) {\r\n        const localFeature = this.selectedFeatures$.value[0];\r\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\r\n      }\r\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n\r\n    this.olDrawSource.clear();\r\n\r\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\r\n\r\n    this.activeOlGeometry = undefined;\r\n    this.modifyControl.setOlMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being drawn\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\r\n    this.onDrawStart(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\r\n    this.onDrawChanges(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\r\n    this.finalizeMeasureOfOlGeometry(olGeometry);\r\n  }\r\n\r\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = measureOlGeometry(olGeometry, this.projection);\r\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables\r\n   * @param olGeometry Ol linestring or polygon\r\n   * @param measure Measure\r\n   */\r\n  private updateMeasureOfOlGeometry(\r\n    olGeometry: OlLineString | OlPolygon,\r\n    measure: Measure\r\n  ) {\r\n    olGeometry.setProperties({ _measure: measure }, true);\r\n    this.updateTooltipsOfOlGeometry(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Clear the measures observables\r\n   */\r\n  private clearMeasures() {\r\n    this.measure$.next({});\r\n  }\r\n\r\n  /**\r\n   * Add a feature with measures to the store. The loading stragegy of the store\r\n   * will trigger and add the feature to the map.\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\r\n    const featureId = localFeature\r\n      ? localFeature.properties.id\r\n      : olGeometry.ol_uid;\r\n    const projection = this.map.ol.getView().getProjection();\r\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\r\n      featureProjection: projection,\r\n      dataProjection: projection\r\n    }) as any;\r\n    this.store.update({\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: projection.getCode(),\r\n      properties: {\r\n        id: featureId,\r\n        measure: olGeometry.get('_measure')\r\n      },\r\n      meta: {\r\n        id: featureId\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update all the tooltips of an OL geometry\r\n   * @param olGeometry OL Geometry\r\n   * @param lengths Lengths of the OL geometry's segments\r\n   * @param measureUnit Display tooltip measure in those units\r\n   */\r\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = olGeometry.get('_measure');\r\n    const lengths = measure.lengths;\r\n    const area = measure.area;\r\n\r\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\r\n    if (lengths.length === olMidpointsTooltips.length) {\r\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\r\n        const length = lengths[i];\r\n        if (length !== undefined) {\r\n          this.updateOlTooltip(\r\n            olMidpointsTooltips[i],\r\n            metersToUnit(length, this.activeLengthUnit),\r\n            this.activeLengthUnit,\r\n            MeasureType.Length\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    if (area !== undefined) {\r\n      this.updateOlTooltip(\r\n        updateOlTooltipAtCenter(olGeometry),\r\n        squareMetersToUnit(area, this.activeAreaUnit),\r\n        this.activeAreaUnit,\r\n        MeasureType.Area\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of a geoemtry\r\n   */\r\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach(\r\n      (olTooltip: OlOverlay | undefined) => {\r\n        if (this.shouldShowTooltip(olTooltip)) {\r\n          this.map.ol.addOverlay(olTooltip);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Clear the tooltips of an OL geometrys\r\n   * @param olGeometry OL geometry with tooltips\r\n   */\r\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach(\r\n      (olTooltip: OlOverlay | undefined) => {\r\n        if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\r\n          this.map.ol.removeOverlay(olTooltip);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of all the geometries of a source\r\n   */\r\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\r\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\r\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of all the geometries of a source\r\n   */\r\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\r\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\r\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the map tooltips\r\n   * @param olDrawSource OL vector source\r\n   */\r\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\r\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\r\n      const olGeometry = olFeature.getGeometry();\r\n      if (olGeometry !== undefined) {\r\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\r\n   * @param olTooltip OL tooltip\r\n   * @param measure The measure valeu ti display\r\n   * @param measureUnit Display tooltip measure in those units\r\n   */\r\n  private updateOlTooltip(\r\n    olTooltip: OlOverlay,\r\n    measure: number,\r\n    unit: MeasureAreaUnit | MeasureLengthUnit,\r\n    type: MeasureType\r\n  ) {\r\n    olTooltip.setProperties(\r\n      { _measure: measure, _unit: unit, _type: type },\r\n      true\r\n    );\r\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\r\n    if (this.shouldShowTooltip(olTooltip)) {\r\n      this.map.ol.addOverlay(olTooltip);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compute a tooltip's content\r\n   * @param olTooltip OL overlay\r\n   * @returns Inner HTML\r\n   */\r\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\r\n    const properties = olTooltip.getProperties() as any;\r\n    return formatMeasure(\r\n      properties._measure,\r\n      {\r\n        decimal: 1,\r\n        unit: properties._unit,\r\n        unitAbbr: true,\r\n        locale: 'fr'\r\n      },\r\n      this.languageService\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Whether a tooltip should be showned based on the length\r\n   * of the segment it is bound to.\r\n   * @param olTooltip OL overlay\r\n   * @returns True if the tooltip should be shown\r\n   */\r\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\r\n    if (this.showTooltips === false) {\r\n      return false;\r\n    }\r\n\r\n    const properties = olTooltip.getProperties() as any;\r\n    const measure = properties._measure;\r\n    if (measure === undefined) {\r\n      return false;\r\n    }\r\n\r\n    if (properties._unit === MeasureType.Length) {\r\n      const minSegmentLength =\r\n        metersToUnit(this.minSegmentLength, properties._unit) || 0;\r\n      return measure > Math.max(minSegmentLength, 0);\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\r\nimport {\r\n  metersToUnit,\r\n  squareMetersToUnit,\r\n  formatMeasure\r\n} from '../shared/measure.utils';\r\n\r\n/**\r\n * This pipe returns a measure converted from meters (or square meters)\r\n * to the specified unit. It also keeps a certain number of decimals.\r\n */\r\n@Pipe({\r\n  name: 'measureFormat'\r\n})\r\nexport class MeasureFormatPipe implements PipeTransform {\r\n  /**\r\n   * @ignore\r\n   */\r\n  transform(\r\n    value: number,\r\n    unit: MeasureAreaUnit | MeasureLengthUnit,\r\n    unitAbbr: boolean = false,\r\n    decimal: number = 1\r\n  ): number {\r\n    let out;\r\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\r\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\r\n    } else if (\r\n      Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0\r\n    ) {\r\n      out = metersToUnit(value, unit as MeasureLengthUnit);\r\n    }\r\n\r\n    return out\r\n      ? formatMeasure(out, {\r\n          decimal: 1,\r\n          unit,\r\n          unitAbbr,\r\n          locale: 'fr'\r\n        })\r\n      : out;\r\n  }\r\n}\r\n","<igo-geometry-form-field-input\r\n  [formControl]=\"formControl\"\r\n  [map]=\"map\"\r\n  [geometryType]=\"geometryType\"\r\n  [drawGuide]=\"drawGuide$ | async\"\r\n  [measure]=\"measure\"\r\n  [drawControlIsActive]=\"drawControlIsActive\"\r\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\r\n  [drawStyle]=\"drawStyle$ | async\"\r\n  [overlayStyle]=\"overlayStyle$ | async\"\r\n  [radius]=\"radius\"\r\n  [predefinedRadius]=\"predefinedRadius\"\r\n>\r\n</igo-geometry-form-field-input>\r\n\r\n<div class=\"header\">\r\n  <mat-slide-toggle\r\n    *ngIf=\"!isPredefined()\"\r\n    [checked]=\"drawControlIsActive\"\r\n    [labelPosition]=\"'before'\"\r\n    (change)=\"onDrawControlChange()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.drawControl' | translate }}\r\n  </mat-slide-toggle>\r\n  <mat-slide-toggle\r\n    *ngIf=\"!isPredefined()\"\r\n    [checked]=\"freehandDrawIsActive\"\r\n    [labelPosition]=\"'before'\"\r\n    (change)=\"onfreehandControlChange()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.freehandControl' | translate }}\r\n  </mat-slide-toggle>\r\n</div>\r\n\r\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\r\n  <form class=\"buffer-form\">\r\n    <mat-form-field class=\"buffer\">\r\n      <input\r\n        type=\"number\"\r\n        matInput\r\n        placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\r\n        [formControl]=\"bufferFormControl\"\r\n        [value]=\"0\"\r\n        [readonly]=\"this.formControl.value === null\"\r\n      />\r\n    </mat-form-field>\r\n  </form>\r\n\r\n  <mat-form-field class=\"unit-field\">\r\n    <mat-select\r\n      [value]=\"measureUnit\"\r\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\r\n    >\r\n      <mat-option\r\n        *ngFor=\"let measureUnit of measureUnits\"\r\n        [value]=\"measureUnit\"\r\n      >\r\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n</div>\r\n\r\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\r\n  <form class=\"radius-form\">\r\n    <mat-form-field class=\"radius\">\r\n      <input\r\n        type=\"number\"\r\n        matInput\r\n        placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\r\n        [formControl]=\"radiusFormControl\"\r\n        [value]=\"1000\"\r\n        (input)=\"getRadius()\"\r\n        [readonly]=\"\r\n          this.freehandDrawIsActive && this.formControl.value === null\r\n        \"\r\n      />\r\n    </mat-form-field>\r\n  </form>\r\n\r\n  <mat-form-field class=\"unit-field\">\r\n    <mat-select\r\n      [value]=\"measureUnit\"\r\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\r\n    >\r\n      <mat-option\r\n        *ngFor=\"let measureUnit of measureUnits\"\r\n        [value]=\"measureUnit\"\r\n      >\r\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n</div>\r\n\r\n<mat-label class=\"title mat-typography\"\r\n  >{{ 'igo.geo.spatialFilter.search' | translate }} :\r\n</mat-label>\r\n<mat-radio-group [value]=\"selectedItemType\">\r\n  <mat-radio-button\r\n    *ngFor=\"let item of itemType\"\r\n    [value]=\"item\"\r\n    (change)=\"onItemTypeChange($event)\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.' + item | translate }}\r\n  </mat-radio-button>\r\n</mat-radio-group>\r\n\r\n<div\r\n  class=\"thematics\"\r\n  *ngIf=\"\r\n    (selectedItemType === 'Thematics' && !tableTemplate) ||\r\n    (selectedItemType === 'Thematics' && tableTemplate && !listIsVisible)\r\n  \"\r\n>\r\n  <mat-table>\r\n    <!-- Name Column -->\r\n    <ng-container matColumnDef=\"name\">\r\n      <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{\r\n        'igo.geo.spatialFilter.Thematics' | translate\r\n      }}</mat-header-cell>\r\n    </ng-container>\r\n\r\n    <!-- Select Column -->\r\n    <ng-container matColumnDef=\"select\">\r\n      <mat-header-cell *matHeaderCellDef class=\"checks-header\">\r\n        <mat-checkbox\r\n          (change)=\"$event ? masterToggle() : null\"\r\n          [checked]=\"isAllSelected()\"\r\n          [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\"\r\n        >\r\n        </mat-checkbox>\r\n      </mat-header-cell>\r\n    </ng-container>\r\n\r\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\r\n    <mat-row *matRowDef=\"let row; columns: displayedColumns\"></mat-row>\r\n  </mat-table>\r\n\r\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\r\n    <!-- This is the tree node template for leaf nodes -->\r\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\r\n      <li class=\"mat-tree-node\">\r\n        <!-- use a disabled button to provide padding for tree leaf -->\r\n        <button mat-icon-button disabled></button>\r\n        {{ node.name }}\r\n        <mat-checkbox\r\n          class=\"tree-check\"\r\n          (click)=\"$event.stopPropagation()\"\r\n          (change)=\"$event ? onToggleChange(node) : null\"\r\n          [checked]=\"selectedThematics.isSelected(node)\"\r\n        >\r\n        </mat-checkbox>\r\n      </li>\r\n    </mat-tree-node>\r\n\r\n    <!-- This is the tree node template for expandable nodes -->\r\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\r\n      <div class=\"mat-tree-node\">\r\n        <button mat-icon-button (click)=\"onToggleClick(node)\">\r\n          <mat-icon\r\n            [svgIcon]=\"\r\n              treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\r\n            \"\r\n          ></mat-icon>\r\n        </button>\r\n        {{ node.name }}\r\n        <mat-checkbox\r\n          class=\"tree-check-2\"\r\n          (change)=\"$event ? childrensToggle(node) : null\"\r\n          [checked]=\"isAllSelected(node)\"\r\n          [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\"\r\n        >\r\n        </mat-checkbox>\r\n      </div>\r\n      <ul\r\n        class=\"tree-ul\"\r\n        [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\"\r\n      >\r\n        <ng-container matTreeNodeOutlet></ng-container>\r\n      </ul>\r\n    </mat-nested-tree-node>\r\n  </mat-tree>\r\n</div>\r\n\r\n<div class=\"buttons\">\r\n  <button\r\n    *ngIf=\"isPredefined()\"\r\n    mat-raised-button\r\n    class=\"clear-search-button\"\r\n    [disabled]=\"disabledClearSearch()\"\r\n    (click)=\"clearSearch()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.clearSearch' | translate }}\r\n  </button>\r\n\r\n  <button\r\n    *ngIf=\"isPolygon() || isPoint()\"\r\n    mat-raised-button\r\n    class=\"clear-form-button\"\r\n    [disabled]=\"this.formControl.value === null\"\r\n    (click)=\"clearDrawZone()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.clearForm' | translate }}\r\n  </button>\r\n\r\n  <button\r\n    mat-raised-button\r\n    class=\"search-button\"\r\n    [disabled]=\"disableSearchButton()\"\r\n    color=\"primary\"\r\n    (click)=\"toggleSearchButton()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.goSearch' | translate }}\r\n  </button>\r\n\r\n  <button\r\n    mat-raised-button\r\n    class=\"remove-button\"\r\n    [disabled]=\"allLayers.length === 0\"\r\n    (click)=\"clearButton()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.removeLayer' | translate }}\r\n  </button>\r\n\r\n  <button\r\n    mat-raised-button\r\n    class=\"export-button\"\r\n    [disabled]=\"!store.entities$.getValue().length\"\r\n    (click)=\"export.emit()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.exportLayer' | translate }}\r\n  </button>\r\n</div>\r\n\r\n<button\r\n  class=\"chevron-down\"\r\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\r\n  mat-icon-button\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\r\n  (click)=\"toggleVisibleList()\"\r\n>\r\n  <mat-icon svgIcon=\"chevron-down\"></mat-icon>\r\n</button>\r\n\r\n<div\r\n  class=\"results\"\r\n  *ngIf=\"store.all().length && tableTemplate && listIsVisible\"\r\n>\r\n  <button\r\n    *ngIf=\"listIsVisible\"\r\n    mat-icon-button\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\r\n    (click)=\"toggleVisibleList()\"\r\n  >\r\n    <mat-icon svgIcon=\"chevron-up\"></mat-icon>\r\n  </button>\r\n  <igo-entity-table\r\n    class=\"results-list\"\r\n    [template]=\"tableTemplate\"\r\n    [store]=\"store\"\r\n    (entitySelectChange)=\"entityChange.emit($event)\"\r\n  >\r\n  </igo-entity-table>\r\n</div>\r\n","import OlFeature from 'ol/Feature';\r\nimport {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport {\r\n  SpatialFilterQueryType,\r\n  SpatialFilterType\r\n} from '../../shared/spatial-filter.enum';\r\nimport { SelectionModel } from '@angular/cdk/collections';\r\nimport { IgoMap } from '../../../map/shared';\r\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\r\nimport { Feature } from './../../../feature/shared/feature.interfaces';\r\nimport { UntypedFormControl } from '@angular/forms';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\r\nimport * as olStyle from 'ol/style';\r\nimport * as olproj from 'ol/proj';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\r\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\r\nimport { MeasureLengthUnit } from '../../../measure';\r\nimport {\r\n  EntityStoreFilterSelectionStrategy,\r\n  EntityStoreWithStrategy,\r\n  EntityTableColumnRenderer,\r\n  EntityTableTemplate\r\n} from '@igo2/common';\r\nimport { Layer, VectorLayer } from '../../../layer/shared';\r\nimport { NestedTreeControl } from '@angular/cdk/tree';\r\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\r\nimport { FeatureDataSource } from '../../../datasource/shared';\r\n\r\n/**\r\n * Spatial-Filter-Item (search parameters)\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-item',\r\n  templateUrl: './spatial-filter-item.component.html',\r\n  styleUrls: ['./spatial-filter-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get type(): SpatialFilterType {\r\n    return this._type;\r\n  }\r\n  set type(type: SpatialFilterType) {\r\n    this._type = type;\r\n    const index = this.geometryTypes.findIndex((geom) => geom === this.type);\r\n    this.geometryType = this.geometryTypes[index];\r\n    this.formControl.reset();\r\n    this.radius = undefined;\r\n    this.drawGuide$.next(null);\r\n    this.drawStyle$.next(undefined);\r\n\r\n    // Necessary to keep reference to the geometry form field input\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      const geojson: GeoJSONGeometry = {\r\n        type: 'Point',\r\n        coordinates: ''\r\n      };\r\n      this.formControl.setValue(geojson);\r\n    }\r\n\r\n    // Necessary to apply the right style when geometry type is Point\r\n    if (this.type === SpatialFilterType.Point) {\r\n      this.radius = 1000; // Base radius\r\n      this.radiusFormControl.setValue(this.radius);\r\n      this.PointStyle = (\r\n        feature: OlFeature<OlGeometry>,\r\n        resolution: number\r\n      ) => {\r\n        const geom = feature.getGeometry() as OlPoint;\r\n        const coordinates = olproj.transform(\r\n          geom.getCoordinates(),\r\n          this.map.projection,\r\n          'EPSG:4326'\r\n        );\r\n        return new olStyle.Style({\r\n          image: new olStyle.Circle({\r\n            radius:\r\n              this.radius /\r\n              Math.cos((Math.PI / 180) * coordinates[1]) /\r\n              resolution, // Latitude correction\r\n            stroke: new olStyle.Stroke({\r\n              width: 2,\r\n              color: 'rgba(0, 153, 255)'\r\n            }),\r\n            fill: new olStyle.Fill({\r\n              color: 'rgba(0, 153, 255, 0.2)'\r\n            })\r\n          })\r\n        });\r\n      };\r\n      this.overlayStyle = this.PointStyle;\r\n      this.drawStyle$.next(this.overlayStyle);\r\n    } else {\r\n      // If geometry types is Polygon\r\n      this.radius = undefined;\r\n      this.PolyStyle = () => {\r\n        return new olStyle.Style({\r\n          stroke: new olStyle.Stroke({\r\n            width: 2,\r\n            color: 'rgba(0, 153, 255)'\r\n          }),\r\n          fill: new olStyle.Fill({\r\n            color: 'rgba(0, 153, 255, 0.2)'\r\n          })\r\n        });\r\n      };\r\n      const color = [0, 153, 255];\r\n      const drawStyle = () => {\r\n        return new olStyle.Style({\r\n          image: new olStyle.Circle({\r\n            radius: 8,\r\n            stroke: new olStyle.Stroke({\r\n              width: 2,\r\n              color: 'rgba(0, 153, 255)'\r\n            }),\r\n            fill: new olStyle.Fill({\r\n              color: 'rgba(0, 153, 255, 0.2)'\r\n            })\r\n          }),\r\n          stroke: new olStyle.Stroke({\r\n            color: color.concat([1]),\r\n            width: 2\r\n          }),\r\n          fill: new olStyle.Fill({\r\n            color: color.concat([0.2])\r\n          })\r\n        });\r\n      };\r\n      this.overlayStyle = this.PolyStyle;\r\n      this.drawStyle$.next(drawStyle);\r\n    }\r\n    this.overlayStyle$.next(this.overlayStyle);\r\n  }\r\n  private _type: SpatialFilterType;\r\n\r\n  @Input() queryType: SpatialFilterQueryType;\r\n\r\n  @Input() zone: Feature;\r\n\r\n  @Input() loading;\r\n\r\n  @Input()\r\n  get store(): EntityStoreWithStrategy<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStoreWithStrategy<Feature>) {\r\n    this._store = store;\r\n    this._store.entities$.subscribe(() => {\r\n      this.cdRef.detectChanges();\r\n    });\r\n  }\r\n  private _store: EntityStoreWithStrategy<Feature>;\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\r\n  }\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  @Input() allLayers: Layer[] = [];\r\n\r\n  @Input()\r\n  get thematicLength(): number {\r\n    return this._thematicLength;\r\n  }\r\n  set thematicLength(value: number) {\r\n    this._thematicLength = value;\r\n  }\r\n  private _thematicLength: number;\r\n\r\n  @Output() toggleSearch = new EventEmitter();\r\n\r\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\r\n\r\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\r\n\r\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\r\n\r\n  @Output() bufferEvent = new EventEmitter<number>();\r\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\r\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\r\n\r\n  @Output() radiusEvent = new EventEmitter<number>();\r\n  @Output() freehandControl = new EventEmitter<boolean>();\r\n  @Output() predefinedRadius = new EventEmitter<boolean>();\r\n\r\n  @Output() clearButtonEvent = new EventEmitter();\r\n\r\n  @Output() clearSearchEvent = new EventEmitter();\r\n\r\n  @Output() export = new EventEmitter();\r\n\r\n  @Output() openWorkspace = new EventEmitter();\r\n  @Output() entityChange = new EventEmitter<any>();\r\n\r\n  public itemType: SpatialFilterItemType[] = [\r\n    SpatialFilterItemType.Address,\r\n    SpatialFilterItemType.Thematics\r\n  ];\r\n  public selectedItemType: SpatialFilterItemType =\r\n    SpatialFilterItemType.Address;\r\n  public selectedSourceAddress;\r\n\r\n  treeControl: NestedTreeControl<SpatialFilterThematic> =\r\n    new NestedTreeControl<SpatialFilterThematic>((node) => node.children);\r\n\r\n  // For thematics and results tables\r\n  public displayedColumns: string[] = ['name', 'select'];\r\n  public childrens: SpatialFilterThematic[] = [];\r\n  public groups: string[] = [];\r\n  public thematics: SpatialFilterThematic[] = [];\r\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\r\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(\r\n    true,\r\n    []\r\n  );\r\n\r\n  // For geometry form field input\r\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\r\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\r\n  overlayStyle$: BehaviorSubject<\r\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\r\n  > = new BehaviorSubject(undefined);\r\n  drawStyle$: BehaviorSubject<\r\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\r\n  > = new BehaviorSubject(undefined);\r\n\r\n  private value$$: Subscription;\r\n  private radiusChanges$$: Subscription;\r\n  private bufferChanges$$: Subscription;\r\n\r\n  public formControl = new UntypedFormControl();\r\n  public geometryType: Type | string;\r\n  public geometryTypeField = false;\r\n  public geometryTypes: string[] = ['Point', 'Polygon'];\r\n  public drawGuideField = false;\r\n  public drawGuide: number = null;\r\n  public drawGuidePlaceholder = '';\r\n  public measure = false;\r\n  public drawControlIsActive = true;\r\n  public freehandDrawIsActive = false;\r\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n  public drawZone;\r\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n\r\n  public radius: number;\r\n  public buffer: number = 0;\r\n  public radiusFormControl = new UntypedFormControl();\r\n  public bufferFormControl = new UntypedFormControl();\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n  public zoneWithBuffer;\r\n\r\n  public listIsVisible = true;\r\n  public tableTemplate: EntityTableTemplate;\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private spatialFilterService: SpatialFilterService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.spatialFilterService\r\n      .loadThematicsList()\r\n      .subscribe((items: SpatialFilterThematic[]) => {\r\n        for (const item of items) {\r\n          this.childrens.push(item);\r\n          this.childrens.sort((a, b) => {\r\n            return a.name.localeCompare(b.name);\r\n          });\r\n        }\r\n        this.groups.push(\r\n          this.languageService.translate.instant('igo.geo.terrapi.limites')\r\n        );\r\n        const limits: SpatialFilterThematic = {\r\n          name: this.groups[0],\r\n          children: []\r\n        };\r\n        this.thematics.push(limits);\r\n        this.childrens.forEach((child) => {\r\n          if (child.group && this.groups.indexOf(child.group) === -1) {\r\n            this.groups.push(child.group);\r\n            const thematic: SpatialFilterThematic = {\r\n              name: child.group,\r\n              children: []\r\n            };\r\n            this.thematics.push(thematic);\r\n          }\r\n\r\n          if (!child.group) {\r\n            if (\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.AdmRegion'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.Arrond'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.CircFed'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.CircProv'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.DirReg'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.RegTour'\r\n                )\r\n            ) {\r\n              child.group = limits.name;\r\n            } else if (\r\n              child.name ===\r\n              this.languageService.translate.instant('igo.geo.terrapi.routes')\r\n            ) {\r\n              child.group = this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.group.transport'\r\n              );\r\n            } else {\r\n              const thematic: SpatialFilterThematic = {\r\n                name: child.name,\r\n                children: [],\r\n                source: child.source\r\n              };\r\n              this.thematics.push(thematic);\r\n            }\r\n          }\r\n          this.thematics.sort((a, b) => {\r\n            return a.name.localeCompare(b.name);\r\n          });\r\n        });\r\n        this.thematics.forEach((thematic) => {\r\n          for (const child of this.childrens) {\r\n            if (child.group === thematic.name) {\r\n              thematic.children.push(child);\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n    this.dataSource.data = this.thematics;\r\n\r\n    this.drawGuide$.next(null);\r\n    this.value$.next(\r\n      this.formControl.value ? this.formControl.value : undefined\r\n    );\r\n    this.value$$ = this.formControl.valueChanges.subscribe(\r\n      (value: GeoJSONGeometry) => {\r\n        if (value) {\r\n          this.value$.next(value);\r\n          this.drawZone = this.formControl.value as Feature;\r\n          if (this.buffer !== 0) {\r\n            this.drawZoneEvent.emit(this.drawZone);\r\n            this.bufferFormControl.setValue(this.buffer);\r\n          }\r\n        } else {\r\n          this.value$.next(undefined);\r\n          this.drawZone = undefined;\r\n        }\r\n      }\r\n    );\r\n\r\n    this.value$.subscribe(() => {\r\n      this.getRadius();\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\r\n      this.getRadius();\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\r\n      .pipe(debounceTime(500))\r\n      .subscribe((value) => {\r\n        if (\r\n          this.measureUnit === MeasureLengthUnit.Meters &&\r\n          value > 0 &&\r\n          value <= 100000\r\n        ) {\r\n          this.buffer = value;\r\n          this.bufferEvent.emit(value);\r\n          this.spatialFilterService\r\n            .loadBufferGeometry(this.drawZone, SpatialFilterType.Polygon, value)\r\n            .subscribe((featureGeom: Feature) => {\r\n              this.zoneWithBuffer = featureGeom;\r\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n            });\r\n        } else if (\r\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n          value > 0 &&\r\n          value <= 100\r\n        ) {\r\n          this.buffer = value;\r\n          this.bufferEvent.emit(value);\r\n          this.spatialFilterService\r\n            .loadBufferGeometry(\r\n              this.drawZone,\r\n              SpatialFilterType.Polygon,\r\n              value * 1000\r\n            )\r\n            .subscribe((featureGeom: Feature) => {\r\n              this.zoneWithBuffer = featureGeom;\r\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n            });\r\n        } else if (value === 0) {\r\n          this.buffer = value;\r\n          this.bufferEvent.emit(value);\r\n          this.drawZoneEvent.emit(this.drawZone);\r\n        } else if (\r\n          value < 0 ||\r\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\r\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\r\n        ) {\r\n          this.bufferFormControl.setValue(0);\r\n          this.buffer = 0;\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.bufferAlert',\r\n            'igo.geo.spatialFilter.warning'\r\n          );\r\n        }\r\n      });\r\n\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: undefined,\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map: this.map,\r\n      hitTolerance: 15,\r\n      motion: FeatureMotion.Default,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n\r\n    this.store.addStrategy(selectionStrategy, true);\r\n    this.store.addStrategy(selectedRecordStrategy, false);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the value stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.value$$.unsubscribe();\r\n    this.radiusChanges$$.unsubscribe();\r\n    this.bufferChanges$$.unsubscribe();\r\n    this.cdRef.detach();\r\n    if (this.radiusChanges$$) {\r\n      this.radiusChanges$$.unsubscribe();\r\n    }\r\n    if (this.value$$) {\r\n      this.value$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  onItemTypeChange(event) {\r\n    this.selectedItemType = event.value;\r\n    this.itemTypeChange.emit(this.selectedItemType);\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\r\n    if (unit === this.measureUnit) {\r\n      return;\r\n    } else {\r\n      this.measureUnit = unit;\r\n      this.measureUnitChange.emit(this.measureUnit);\r\n      if (this.isPolygon()) {\r\n        this.measureUnit === MeasureLengthUnit.Meters\r\n          ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\r\n          : this.bufferFormControl.setValue(\r\n              this.bufferFormControl.value / 1000\r\n            );\r\n      } else if (this.isPoint()) {\r\n        this.measureUnit === MeasureLengthUnit.Meters\r\n          ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\r\n          : this.radiusFormControl.setValue(\r\n              this.radiusFormControl.value / 1000\r\n            );\r\n      }\r\n    }\r\n  }\r\n\r\n  isPredefined() {\r\n    return this.type === SpatialFilterType.Predefined;\r\n  }\r\n\r\n  isPolygon() {\r\n    return this.type === SpatialFilterType.Polygon;\r\n  }\r\n\r\n  isPoint() {\r\n    return this.type === SpatialFilterType.Point;\r\n  }\r\n\r\n  hasChild(_: number, node: SpatialFilterThematic) {\r\n    if (node.children) {\r\n      return node.children.length;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  onToggleClick(node: SpatialFilterThematic) {\r\n    this.treeControl.isExpanded(node)\r\n      ? this.treeControl.collapse(node)\r\n      : this.treeControl.expand(node);\r\n  }\r\n\r\n  isAllSelected(node?: SpatialFilterThematic) {\r\n    let numSelected;\r\n    let numNodes = 0;\r\n    if (!node) {\r\n      numSelected = this.selectedThematics.selected.length;\r\n      this.thematics.forEach((thematic) => {\r\n        if (this.groups.indexOf(thematic.name) === -1) {\r\n          numNodes++;\r\n        }\r\n      });\r\n      this.childrens.forEach((children) => {\r\n        if (\r\n          !this.thematics.find(\r\n            (thematic) => thematic.source === children.source\r\n          )\r\n        ) {\r\n          numNodes++;\r\n        }\r\n      });\r\n    } else {\r\n      numSelected = node.children.length;\r\n      node.children.forEach((children) => {\r\n        if (\r\n          this.selectedThematics.selected.find(\r\n            (thematic) => thematic === children\r\n          )\r\n        ) {\r\n          numNodes++;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (numNodes >= 1) {\r\n      return numSelected === numNodes;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  hasChildrenSelected(node: SpatialFilterThematic) {\r\n    let bool = false;\r\n    node.children.forEach((child) => {\r\n      if (\r\n        this.selectedThematics.selected.find(\r\n          (thematic) => thematic.source === child.source\r\n        )\r\n      ) {\r\n        bool = true;\r\n      }\r\n    });\r\n    return bool;\r\n  }\r\n\r\n  /**\r\n   * Apply header checkbox\r\n   */\r\n  masterToggle() {\r\n    this.isAllSelected() ? this.selectedThematics.clear() : this.selectAll();\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n\r\n    if (this.isAllSelected()) {\r\n      this.thematics.forEach((thematic) => {\r\n        if (this.hasChild(0, thematic)) {\r\n          this.treeControl.expand(thematic);\r\n        }\r\n      });\r\n    } else {\r\n      this.thematics.forEach((thematic) => {\r\n        if (this.hasChild(0, thematic)) {\r\n          this.treeControl.collapse(thematic);\r\n        }\r\n      });\r\n    }\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  selectAll(node?: SpatialFilterThematic) {\r\n    if (!node) {\r\n      this.thematics.forEach((thematic) => {\r\n        if (this.groups.indexOf(thematic.name) === -1) {\r\n          this.selectedThematics.select(thematic);\r\n        }\r\n      });\r\n      this.childrens.forEach((children) => {\r\n        if (\r\n          !this.selectedThematics.selected.find(\r\n            (thematic) => thematic.source === children.source\r\n          )\r\n        ) {\r\n          this.selectedThematics.select(children);\r\n        }\r\n      });\r\n    } else {\r\n      if (this.hasChild(0, node)) {\r\n        node.children.forEach((children) =>\r\n          this.selectedThematics.select(children)\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  childrensToggle(node: SpatialFilterThematic) {\r\n    this.isAllSelected(node)\r\n      ? node.children.forEach((child) => this.selectedThematics.deselect(child))\r\n      : this.selectAll(node);\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n    this.treeControl.expand(node);\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  /**\r\n   * Apply changes to the thematics selected tree and emit event\r\n   */\r\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\r\n    let selected = false;\r\n    if (\r\n      this.selectedThematics.selected.find(\r\n        (thematic) => thematic.source === nodeSelected.source\r\n      ) !== undefined\r\n    ) {\r\n      selected = true;\r\n    }\r\n\r\n    this.childrens.forEach((children) => {\r\n      if (children === nodeSelected && selected === false) {\r\n        this.selectedThematics.select(children);\r\n      }\r\n      if (children === nodeSelected && selected === true) {\r\n        this.selectedThematics.deselect(children);\r\n      }\r\n    });\r\n    this.thematics.forEach((thematic) => {\r\n      if (thematic === nodeSelected && selected === false) {\r\n        this.selectedThematics.select(thematic);\r\n      }\r\n      if (thematic === nodeSelected && selected === true) {\r\n        this.selectedThematics.deselect(thematic);\r\n      }\r\n    });\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  onDrawControlChange() {\r\n    this.drawControlIsActive = !this.drawControlIsActive;\r\n  }\r\n\r\n  onfreehandControlChange() {\r\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\r\n    this.freehandControl.emit(this.freehandDrawIsActive);\r\n    if (this.isPoint()) {\r\n      this.predefinedRadius.emit(!this.freehandDrawIsActive);\r\n      if (this.freehandDrawIsActive) {\r\n        this.overlayStyle$.next(undefined);\r\n        this.drawStyle$.next(undefined);\r\n      }\r\n    } else {\r\n      this.predefinedRadius.emit(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Launch search button\r\n   */\r\n  toggleSearchButton() {\r\n    if (!this.isPredefined()) {\r\n      if (this.buffer > 0) {\r\n        this.zoneWithBuffer.meta = {\r\n          id: undefined,\r\n          title: 'Zone'\r\n        };\r\n        this.zoneWithBuffer.properties = {\r\n          nom: 'Zone',\r\n          type: this.type as string\r\n        };\r\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\r\n      } else {\r\n        this.drawZone.meta = {\r\n          id: undefined,\r\n          title: 'Zone'\r\n        };\r\n        this.drawZone.properties = {\r\n          nom: 'Zone',\r\n          type: this.type as string\r\n        };\r\n        this.drawZoneEvent.emit(this.drawZone);\r\n      }\r\n    }\r\n    if (this.isPoint()) {\r\n      this.radiusEvent.emit(this.radius);\r\n    } else if (this.isPolygon()) {\r\n      this.bufferEvent.emit(this.buffer);\r\n    }\r\n    this.toggleSearch.emit();\r\n    this.store.entities$.pipe(debounceTime(500)).subscribe((value) => {\r\n      if (value.length && this.layers.length === this.thematicLength + 1) {\r\n        this.openWorkspace.emit();\r\n        this.createTableTemplate();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Launch clear button (clear store and map layers)\r\n   */\r\n  clearButton() {\r\n    this.loading = true;\r\n    if (this.store) {\r\n      this.store.clear();\r\n    }\r\n    if (this.isPoint() || this.isPolygon()) {\r\n      this.drawZone = undefined;\r\n      this.formControl.reset();\r\n    }\r\n    this.bufferFormControl.setValue(0);\r\n    this.buffer = 0;\r\n    this.bufferEvent.emit(0);\r\n    this.clearButtonEvent.emit();\r\n    this.loading = false;\r\n    this.tableTemplate = undefined;\r\n  }\r\n\r\n  clearDrawZone() {\r\n    this.formControl.reset();\r\n    this.bufferFormControl.setValue(0);\r\n    this.buffer = 0;\r\n  }\r\n\r\n  /**\r\n   * Launch clear search (clear field if type is predefined)\r\n   */\r\n  clearSearch() {\r\n    this.selectedThematics.clear();\r\n    this.bufferFormControl.setValue(0);\r\n    this.buffer = 0;\r\n    this.bufferEvent.emit(0);\r\n    this.thematicChange.emit([]);\r\n    this.clearSearchEvent.emit();\r\n  }\r\n\r\n  /**\r\n   * Verify conditions of incomplete fields or busy service\r\n   */\r\n  disableSearchButton(): boolean {\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\r\n        if (this.queryType !== undefined && this.zone !== undefined) {\r\n          return this.loading;\r\n        }\r\n      }\r\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\r\n        if (\r\n          this.queryType !== undefined &&\r\n          this.zone !== undefined &&\r\n          this.selectedThematics.selected.length > 0\r\n        ) {\r\n          return this.loading;\r\n        }\r\n      }\r\n    }\r\n    if (\r\n      this.type === SpatialFilterType.Polygon ||\r\n      this.type === SpatialFilterType.Point\r\n    ) {\r\n      if (\r\n        this.selectedItemType === SpatialFilterItemType.Address &&\r\n        this.formControl.value !== null\r\n      ) {\r\n        return this.loading;\r\n      }\r\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\r\n        if (\r\n          this.selectedThematics.selected.length > 0 &&\r\n          this.formControl.value !== null\r\n        ) {\r\n          return this.loading;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  disabledClearSearch() {\r\n    let disable = true;\r\n    this.selectedItemType === SpatialFilterItemType.Address\r\n      ? (disable = this.queryType === undefined)\r\n      : (disable =\r\n          this.queryType === undefined &&\r\n          this.selectedThematics.selected.length === 0);\r\n\r\n    return disable;\r\n  }\r\n\r\n  /**\r\n   * Manage radius value at user change\r\n   */\r\n  getRadius() {\r\n    let formValue;\r\n    if (this.formControl.value !== null) {\r\n      this.measureUnit === MeasureLengthUnit.Meters\r\n        ? (formValue = this.formControl.value.radius)\r\n        : (formValue = this.formControl.value.radius / 1000);\r\n    } else {\r\n      formValue = undefined;\r\n    }\r\n\r\n    if (this.type === SpatialFilterType.Point) {\r\n      if (!this.freehandDrawIsActive) {\r\n        if (\r\n          this.radiusFormControl.value < 0 ||\r\n          (this.measureUnit === MeasureLengthUnit.Meters &&\r\n            this.radiusFormControl.value >= 100000) ||\r\n          (this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n            this.radiusFormControl.value >= 100)\r\n        ) {\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.radiusAlert',\r\n            'igo.geo.spatialFilter.warning'\r\n          );\r\n          this.radius = 1000;\r\n          this.measureUnit === MeasureLengthUnit.Meters\r\n            ? this.radiusFormControl.setValue(this.radius)\r\n            : this.radiusFormControl.setValue(this.radius / 1000);\r\n          this.drawGuide$.next(this.radius);\r\n          return;\r\n        }\r\n      } else {\r\n        if (formValue) {\r\n          if (formValue >= 100000) {\r\n            this.messageService.alert(\r\n              'igo.geo.spatialFilter.radiusAlert',\r\n              'igo.geo.spatialFilter.warning'\r\n            );\r\n            this.formControl.reset();\r\n            return;\r\n          }\r\n          if (formValue !== this.radiusFormControl.value) {\r\n            this.radiusFormControl.setValue(formValue);\r\n            return;\r\n          }\r\n        }\r\n      }\r\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\r\n        this.radius = this.radiusFormControl.value;\r\n        this.drawGuide$.next(this.radius);\r\n      } else {\r\n        this.radius = this.radiusFormControl.value * 1000;\r\n        this.drawGuide$.next(this.radius * 1000);\r\n      }\r\n      this.overlayStyle$.next(this.PointStyle);\r\n      this.drawStyle$.next(this.PointStyle);\r\n    }\r\n  }\r\n\r\n  toggleVisibleList() {\r\n    this.listIsVisible = !this.listIsVisible;\r\n  }\r\n\r\n  private createTableTemplate() {\r\n    const typeColumn = {\r\n      name: 'meta.title',\r\n      title: this.languageService.translate.instant(\r\n        'igo.geo.spatialFilter.type'\r\n      ),\r\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n    };\r\n    const nameColumn = {\r\n      name: 'properties.nom',\r\n      title: this.languageService.translate.instant(\r\n        'igo.geo.spatialFilter.searchResults'\r\n      ),\r\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n    };\r\n    const columns = [typeColumn, nameColumn];\r\n\r\n    this.tableTemplate = {\r\n      selection: true,\r\n      sort: true,\r\n      columns\r\n    };\r\n  }\r\n}\r\n","<div class=\"datetime-container\">\r\n  <mat-slide-toggle\r\n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\r\n    [(ngModel)]=\"sliderMode\"\r\n    (change)=\"modeChange($event)\"\r\n  >\r\n    {{ 'igo.geo.filter.sliderModeTitle' | translate }}\r\n  </mat-slide-toggle>\r\n\r\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\r\n    <igo-ogc-filter-time-slider\r\n      [begin]=\"beginValue\"\r\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\r\n      [currentFilter]=\"currentFilter\"\r\n      [datasource]=\"datasource\"\r\n      (changeProperty)=\"changePropertyByPass($event)\"\r\n    >\r\n    </igo-ogc-filter-time-slider>\r\n  </div>\r\n\r\n  <div *ngIf=\"!sliderMode\">\r\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\r\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \r\n        with the datepicker  -->\r\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.timeFilter.startYear' | translate }}</mat-label>\r\n        <input\r\n          matInput\r\n          class=\"year-input-only-year\"\r\n          value=\"{{ onlyYearBegin }}\"\r\n          (change)=\"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\r\n          [disabled]=\"filterStateDisable\"\r\n        />\r\n        <mat-datepicker-toggle\r\n          matSuffix\r\n          [for]=\"beginDatepicker\"\r\n          [disabled]=\"filterStateDisable\"\r\n        ></mat-datepicker-toggle>\r\n\r\n        <mat-datepicker\r\n          panelClass=\"datepicker-year\"\r\n          #beginDatepicker\r\n          [startView]=\"calendarView()\"\r\n          [startAt]=\"beginValue\"\r\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\r\n        >\r\n        </mat-datepicker>\r\n\r\n        <input\r\n          #beginYear\r\n          class=\"year-input-hide\"\r\n          matInput\r\n          [matDatepicker]=\"beginDatepicker\"\r\n          enabled=\"false\"\r\n          readonly=\"true\"\r\n          [value]=\"\r\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\r\n          \"\r\n          [min]=\"handleDate(datasource.options.minDate)\"\r\n          [max]=\"\r\n            endValue && !restrictedToStep()\r\n              ? endValue\r\n              : handleDate(datasource.options.maxDate)\r\n          \"\r\n        />\r\n      </mat-form-field>\r\n\r\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.timeFilter.endYear' | translate }}</mat-label>\r\n        <input\r\n          matInput\r\n          class=\"year-input-only-year\"\r\n          value=\"{{ onlyYearEnd }}\"\r\n          (change)=\"yearOnlyInputChange($event, endDatepicker, 'end')\"\r\n          [disabled]=\"filterStateDisable\"\r\n        />\r\n        <mat-datepicker-toggle\r\n          matSuffix\r\n          [for]=\"endDatepicker\"\r\n          [disabled]=\"filterStateDisable\"\r\n        ></mat-datepicker-toggle>\r\n        <mat-datepicker\r\n          panelClass=\"datepicker-year\"\r\n          #endDatepicker\r\n          [startView]=\"calendarView()\"\r\n          [startAt]=\"endValue\"\r\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\r\n        >\r\n        </mat-datepicker>\r\n\r\n        <input\r\n          #endYear\r\n          class=\"year-input-hide\"\r\n          matInput\r\n          [matDatepicker]=\"endDatepicker\"\r\n          enabled=\"false\"\r\n          readonly=\"true\"\r\n          [value]=\"endValue ? endValue : handleDate(datasource.options.maxDate)\"\r\n          [min]=\"\r\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\r\n          \"\r\n          [max]=\"handleDate(datasource.options.maxDate)\"\r\n        />\r\n      </mat-form-field>\r\n      <div class=\"actions-container\">\r\n        <button\r\n          class=\"reset-button\"\r\n          mat-icon-button\r\n          color=\"primary\"\r\n          (click)=\"resetFilter()\"\r\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\r\n          [disabled]=\"filterStateDisable\"\r\n        >\r\n          <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\r\n        </button>\r\n        <mat-slide-toggle\r\n          class=\"toggle-filter-state\"\r\n          (change)=\"toggleFilterState()\"\r\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\r\n          tooltip-position=\"below\"\r\n          matTooltipShowDelay=\"500\"\r\n          [checked]=\"!filterStateDisable\"\r\n        >\r\n        </mat-slide-toggle>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType() !== 'year'\">\r\n      <div class=\"datetime-input\">\r\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\r\n          <mat-datepicker-toggle\r\n            matSuffix\r\n            [for]=\"beginDatepicker\"\r\n            [disabled]=\"filterStateDisable\"\r\n          ></mat-datepicker-toggle>\r\n          <input\r\n            #begin\r\n            matInput\r\n            [matDatepicker]=\"beginDatepicker\"\r\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\r\n            [attr.disabled]=\"!currentFilter.active\"\r\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\r\n            [matDatepickerFilter]=\"filterBeginFunction\"\r\n            [value]=\"\r\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\r\n            \"\r\n            [min]=\"handleDate(datasource.options.minDate)\"\r\n            [max]=\"\r\n              endValue && !restrictedToStep()\r\n                ? endValue\r\n                : handleDate(datasource.options.maxDate)\r\n            \"\r\n            [disabled]=\"filterStateDisable\"\r\n          />\r\n          <span class=\"filler\"></span>\r\n          <mat-datepicker\r\n            #beginDatepicker\r\n            [startView]=\"calendarView()\"\r\n            [startAt]=\"beginValue\"\r\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\r\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\"\r\n          >\r\n          </mat-datepicker>\r\n        </mat-form-field>\r\n\r\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\r\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\r\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\r\n            <mat-select\r\n              [formControl]=\"beginHourFormControl\"\r\n              [attr.disabled]=\"!currentFilter.active\"\r\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\r\n            >\r\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{\r\n                hour\r\n              }}</mat-option>\r\n            </mat-select>\r\n          </mat-form-field>\r\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\r\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\r\n            <mat-select\r\n              [formControl]=\"beginMinuteFormControl\"\r\n              [attr.disabled]=\"!currentFilter.active\"\r\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\r\n            >\r\n              <mat-option\r\n                *ngFor=\"let minute of beginMinutes\"\r\n                [value]=\"minute\"\r\n                >{{ minute }}</mat-option\r\n              >\r\n            </mat-select>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n\r\n      <div *ngIf=\"!restrictedToStep()\" class=\"datetime-input\">\r\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\r\n          <mat-datepicker-toggle\r\n            matSuffix\r\n            [for]=\"endDatepicker\"\r\n            [disabled]=\"filterStateDisable\"\r\n          ></mat-datepicker-toggle>\r\n          <input\r\n            #end\r\n            matInput\r\n            [matDatepicker]=\"endDatepicker\"\r\n            [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\r\n            [attr.disabled]=\"!currentFilter.active\"\r\n            (dateChange)=\"changeTemporalProperty(end.value, 2)\"\r\n            [matDatepickerFilter]=\"filterEndFunction\"\r\n            [value]=\"\r\n              endValue ? endValue : handleDate(datasource.options.maxDate)\r\n            \"\r\n            [min]=\"\r\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\r\n            \"\r\n            [max]=\"handleDate(datasource.options.maxDate)\"\r\n            [disabled]=\"filterStateDisable\"\r\n          />\r\n          <span class=\"filler\"></span>\r\n          <mat-datepicker\r\n            #endDatepicker\r\n            [startView]=\"calendarView()\"\r\n            [startAt]=\"endValue\"\r\n            (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\r\n            (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\"\r\n          >\r\n          </mat-datepicker>\r\n        </mat-form-field>\r\n\r\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\r\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\r\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\r\n            <mat-select\r\n              [formControl]=\"endHourFormControl\"\r\n              [attr.disabled]=\"!currentFilter.active\"\r\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\r\n            >\r\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{\r\n                hour\r\n              }}</mat-option>\r\n            </mat-select>\r\n          </mat-form-field>\r\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\r\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\r\n            <mat-select\r\n              [formControl]=\"endMinuteFormControl\"\r\n              [attr.disabled]=\"!currentFilter.active\"\r\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\r\n            >\r\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{\r\n                minute\r\n              }}</mat-option>\r\n            </mat-select>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"actions-container\">\r\n        <button\r\n          class=\"reset-button\"\r\n          mat-icon-button\r\n          color=\"primary\"\r\n          (click)=\"resetFilter()\"\r\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\r\n          [disabled]=\"filterStateDisable\"\r\n        >\r\n          <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\r\n        </button>\r\n        <mat-slide-toggle\r\n          class=\"toggle-filter-state\"\r\n          (change)=\"toggleFilterState()\"\r\n          tooltip-position=\"below\"\r\n          matTooltipShowDelay=\"500\"\r\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\r\n          [checked]=\"!filterStateDisable\"\r\n        >\r\n        </mat-slide-toggle>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ViewChild,\r\n  ElementRef,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { UntypedFormControl } from '@angular/forms';\r\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\r\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\r\nimport {\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFilterableDataSource,\r\n  OgcFilterDuringOptions\r\n} from '../shared/ogc-filter.interface';\r\n\r\nimport { default as moment } from 'moment';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-time',\r\n  templateUrl: './ogc-filter-time.component.html',\r\n  styleUrls: ['./ogc-filter-time.component.scss']\r\n})\r\nexport class OgcFilterTimeComponent implements OnInit {\r\n  @Input() datasource: OgcFilterableDataSource;\r\n  @Input() currentFilter: any;\r\n  @Output() changeProperty: EventEmitter<{\r\n    value: string;\r\n    pos: number;\r\n    refreshFilter: boolean;\r\n  }> = new EventEmitter<any>();\r\n\r\n  beginHours: number[];\r\n  endHours: number[];\r\n  beginMinutes: number[];\r\n  endMinutes: number[];\r\n  beginHourFormControl = new UntypedFormControl();\r\n  beginMinuteFormControl = new UntypedFormControl();\r\n  endHourFormControl = new UntypedFormControl();\r\n  endMinuteFormControl = new UntypedFormControl();\r\n  _beginValue: Date;\r\n  _endValue: Date;\r\n  readonly _defaultMin: string = '1900-01-01';\r\n  readonly _defaultMax: string = '2052-01-06';\r\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\r\n  readonly _defaultSliderModeEnabled: boolean = true;\r\n  ogcFilterOperator = OgcFilterOperator;\r\n  public sliderMode = false;\r\n\r\n  readonly defaultStepMillisecond = 60000;\r\n  public options: OgcFilterableDataSourceOptions;\r\n\r\n  public onlyYearBegin: number;\r\n  public onlyYearEnd: number;\r\n  public calendarTypeYear = false;\r\n  public resetIcon = 'replay';\r\n  public filterStateDisable: boolean;\r\n\r\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\r\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\r\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\r\n  @ViewChild('endTime') endTime: HTMLInputElement;\r\n\r\n  get step(): string {\r\n    return this.datasource.options.stepDate\r\n      ? this.datasource.options.stepDate\r\n      : this.currentFilter.step;\r\n  }\r\n\r\n  get stepMilliseconds(): number {\r\n    const step = moment.duration(this.step).asMilliseconds();\r\n    return step === 0 ? this.defaultStepMillisecond : step;\r\n  }\r\n\r\n  set beginValue(begin: Date) {\r\n    this._beginValue = begin;\r\n  }\r\n\r\n  get beginValue(): Date {\r\n    return this._beginValue;\r\n  }\r\n\r\n  set endValue(end: Date) {\r\n    this._endValue = end;\r\n  }\r\n\r\n  get endValue(): Date {\r\n    return this._endValue;\r\n  }\r\n\r\n  get sliderInterval(): number {\r\n    return this.currentFilter.sliderInterval === undefined\r\n      ? 2000\r\n      : this.currentFilter.sliderInterval;\r\n  }\r\n\r\n  get maxDate(): string {\r\n    return this.datasource.options.maxDate\r\n      ? this.datasource.options.maxDate\r\n      : this._defaultMax;\r\n  }\r\n\r\n  get displayFormat(): string {\r\n    return this.currentFilter.displayFormat\r\n      ? this.currentFilter.displayFormat\r\n      : this._defaultDisplayFormat;\r\n  }\r\n\r\n  public filterBeginFunction;\r\n  public filterEndFunction;\r\n\r\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\r\n\r\n  ngOnInit() {\r\n    if (this.currentFilter.sliderOptions) {\r\n      this.currentFilter.sliderOptions.enabled =\r\n        this.currentFilter.sliderOptions.enabled !== undefined\r\n          ? this.currentFilter.sliderOptions.enabled\r\n          : this._defaultSliderModeEnabled;\r\n    }\r\n    this.beginValue = this.parseFilter(this.handleMin());\r\n    this.endValue = this.parseFilter(this.handleMax());\r\n\r\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\r\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\r\n    this.calendarTypeYear = this.isCalendarYearMode();\r\n    this.setFilterStateDisable();\r\n    this.updateHoursMinutesArray();\r\n    // update value for now value\r\n    this.updateValues();\r\n    this.dateFilter(this.filterBeginFunction, 'begin');\r\n    this.dateFilter(this.filterEndFunction, 'end');\r\n  }\r\n\r\n  parseFilter(filter): Date {\r\n    if (!filter) {\r\n      return new Date();\r\n    } else if (isNaN(new Date(filter).getTime())) {\r\n      if (filter.search('now') >= 0) {\r\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\r\n        if (filter.match(/\\+/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('+') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment().add(intervalInt, interval[0]).toDate();\r\n        }\r\n        if (filter.match(/\\-/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('-') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment().subtract(intervalInt, interval[0]).toDate();\r\n        }\r\n        return new Date();\r\n      }\r\n      if (filter.search('today') >= 0) {\r\n        const _now = moment().endOf('day').toDate();\r\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\r\n        if (filter.match(/\\+/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('+') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment(_now).add(intervalInt, interval[0]).toDate();\r\n        }\r\n        if (filter.match(/\\-/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('-') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\r\n        }\r\n        return _now;\r\n      }\r\n      return new Date();\r\n    }\r\n    if (this.currentFilter.calendarModeYear) {\r\n      const date = this.getDateFromStringWithoutTime(filter);\r\n      return date;\r\n    } else {\r\n      return filter ? new Date(filter) : new Date();\r\n    }\r\n  }\r\n\r\n  changeTemporalProperty(value, position?, refreshFilter = true) {\r\n    let valueTmp = this.getDateTime(value, position);\r\n    if (this.isCalendarYearMode()) {\r\n      let dateStringFromYearNotime;\r\n      if (position === 1) {\r\n        this.beginValue = value;\r\n        this.onlyYearBegin = this.beginValue.getFullYear();\r\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\r\n      } else {\r\n        this.endValue = value;\r\n        this.onlyYearEnd = this.endValue.getFullYear();\r\n        dateStringFromYearNotime = `${this.onlyYearEnd}-01-01`;\r\n      }\r\n      // call service with string date without time\r\n      this.changeProperty.next({\r\n        value: dateStringFromYearNotime,\r\n        pos: position,\r\n        refreshFilter\r\n      });\r\n      return;\r\n    }\r\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\r\n      /* Above month: see yearSelected or monthSelected */\r\n      valueTmp = moment(valueTmp).endOf('day').toDate();\r\n    }\r\n\r\n    if (position === 1) {\r\n      this.beginValue = valueTmp;\r\n      if (this.restrictedToStep()) {\r\n        this.changeTemporalProperty(\r\n          this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds),\r\n          2,\r\n          refreshFilter\r\n        );\r\n      }\r\n    } else {\r\n      this.endValue = valueTmp;\r\n    }\r\n    this.updateHoursMinutesArray();\r\n    this.changeProperty.next({\r\n      value: valueTmp.toISOString(),\r\n      pos: position,\r\n      refreshFilter\r\n    });\r\n  }\r\n\r\n  handleDate(value): Date {\r\n    if (!value || value === '') {\r\n      return undefined;\r\n    }\r\n    if (typeof value === 'string' && this.currentFilter.calendarModeYear) {\r\n      return this.getDateFromStringWithoutTime(value);\r\n    }\r\n    return new Date(value);\r\n  }\r\n\r\n  calendarType() {\r\n    if (this.currentFilter.calendarModeYear) {\r\n      return 'year';\r\n    }\r\n    if (this.stepMilliseconds < 86400000) {\r\n      return 'datetime';\r\n    }\r\n    return 'date';\r\n  }\r\n\r\n  isCalendarYearMode(): boolean {\r\n    if (this.calendarType() === 'year') {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\r\n    const year = changeEvent.target.value;\r\n    const date = this.getDateFromStringWithoutTime(year);\r\n    this.yearSelected(date, datePicker, property);\r\n  }\r\n\r\n  yearSelected(\r\n    year,\r\n    datePicker?: any,\r\n    property?: string,\r\n    refreshFilter = true\r\n  ) {\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\r\n      if (datePicker) {\r\n        datePicker.close();\r\n      }\r\n      if (property === 'end') {\r\n        // change value 01 jan to 31 dec same year\r\n        year = moment(year).endOf('year').toDate();\r\n      } else if (\r\n        property === 'begin' &&\r\n        this.restrictedToStep() &&\r\n        !this.calendarTypeYear\r\n      ) {\r\n        this.yearSelected(year, undefined, 'end');\r\n      }\r\n      this.changeTemporalProperty(\r\n        year,\r\n        property === 'begin' ? 1 : 2,\r\n        refreshFilter\r\n      );\r\n    }\r\n  }\r\n\r\n  monthSelected(\r\n    month,\r\n    datePicker?: any,\r\n    property?: string,\r\n    refreshFilter = true\r\n  ) {\r\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\r\n      if (datePicker) {\r\n        datePicker.close();\r\n      }\r\n      if (property === 'end') {\r\n        month = moment(month).endOf('month').toDate();\r\n      } else if (property === 'begin' && this.restrictedToStep()) {\r\n        this.monthSelected(month, undefined, 'end');\r\n      }\r\n      this.changeTemporalProperty(\r\n        month,\r\n        property === 'begin' ? 1 : 2,\r\n        refreshFilter\r\n      );\r\n    }\r\n  }\r\n\r\n  calendarView() {\r\n    const test = this.stepMilliseconds;\r\n    const diff = Math.abs(\r\n      this.parseFilter(this.currentFilter.end).getTime() -\r\n        this.parseFilter(this.currentFilter.begin).getTime()\r\n    );\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\r\n      return 'multi-year';\r\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\r\n      return 'year';\r\n    } else if (test < 86400000 && diff < 86400000) {\r\n      return 'clock';\r\n    } else {\r\n      return 'month';\r\n    }\r\n  }\r\n\r\n  dateFilter(type: string, date: string) {\r\n    const dateValue = new Date(date);\r\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\r\n\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\r\n      const monthDiff = moment(dateValue).diff(\r\n        moment(this.handleMin()),\r\n        'years',\r\n        true\r\n      );\r\n      if (type === 'end') {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\r\n          moment(this.handleMin()),\r\n          'years',\r\n          true\r\n        );\r\n        this.filterEndFunction =\r\n          monthDiffPlus1 % moment.duration(this.step).asYears() === 0;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        this.filterBeginFunction =\r\n          monthDiff % moment.duration(this.step).asYears() === 0;\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\r\n      const monthDiff = moment(dateValue).diff(\r\n        moment(this.handleMin()),\r\n        'months',\r\n        true\r\n      );\r\n      if (type === 'end') {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\r\n          moment(this.handleMin()),\r\n          'months',\r\n          true\r\n        );\r\n        this.filterEndFunction =\r\n          monthDiffPlus1 % moment.duration(this.step).asMonths() === 0;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        this.filterBeginFunction =\r\n          monthDiff % moment.duration(this.step).asMonths() === 0;\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\r\n      const weekDiff = moment(dateValue).diff(\r\n        moment(this.handleMin()),\r\n        'weeks',\r\n        true\r\n      );\r\n      if (type === 'end') {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(\r\n          moment(this.handleMin()),\r\n          'weeks',\r\n          true\r\n        );\r\n        this.filterEndFunction =\r\n          weekDiffPlus1 % moment.duration(this.step).asWeeks() === 0;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        this.filterBeginFunction =\r\n          weekDiff % moment.duration(this.step).asWeeks() === 0;\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\r\n      const dayDiff = moment(dateValue).diff(\r\n        moment(this.handleMin()),\r\n        'days',\r\n        true\r\n      );\r\n      if (type === 'end') {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(\r\n          moment(this.handleMin()),\r\n          'days',\r\n          true\r\n        );\r\n        const _mod = dayDiffPlus1 % moment.duration(this.step).asDays();\r\n        this.filterEndFunction =\r\n          (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0; // 1 millisecond = 1.1574074074074076e-8\r\n        return;\r\n      } else if (type === 'begin') {\r\n        const _mod = (dayDiff % moment.duration(this.step).asDays()) + 1;\r\n        this.filterBeginFunction =\r\n          (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1; // 1 millisecond = 1.1574074074074076e-8\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\r\n      if (type === 'end') {\r\n        const hourDiff = moment(dateValue).diff(\r\n          moment(this.handleMin()),\r\n          'hours',\r\n          true\r\n        );\r\n        this.filterEndFunction =\r\n          hourDiff % moment.duration(this.step).asHours() === 0;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        const hourDiff = moment(dateValue).diff(\r\n          moment(this.handleMin()),\r\n          'hours',\r\n          true\r\n        );\r\n        this.filterBeginFunction =\r\n          hourDiff % moment.duration(this.step).asHours() === 0;\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\r\n      if (type === 'end') {\r\n        this.filterEndFunction = true;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        this.filterBeginFunction = true;\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.filterEndFunction = diff % this.stepMilliseconds === 0;\r\n    this.filterBeginFunction = diff % this.stepMilliseconds === 0;\r\n    return;\r\n  }\r\n\r\n  getDateTime(date, pos) {\r\n    const valuetmp = new Date(date);\r\n    let valuetmp2;\r\n    if (!this.sliderMode) {\r\n      switch (pos) {\r\n        case 1: {\r\n          if (this.currentFilter.calendarModeYear) {\r\n            valuetmp2 = valuetmp.setHours(0, 0);\r\n            break;\r\n          } else {\r\n            valuetmp2 = valuetmp.setHours(\r\n              this.beginHourFormControl.value,\r\n              this.beginMinuteFormControl.value\r\n            );\r\n            break;\r\n          }\r\n        }\r\n        case 2: {\r\n          if (this.currentFilter.calendarModeYear) {\r\n            valuetmp2 = valuetmp.setHours(0, 0);\r\n            break;\r\n          } else {\r\n            valuetmp2 = valuetmp.setHours(\r\n              this.endHourFormControl.value,\r\n              this.endMinuteFormControl.value\r\n            );\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\r\n  }\r\n\r\n  handleMinuteIncrement() {\r\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\r\n      if (this.stepMilliseconds < 3600000) {\r\n        return this.stepMilliseconds / 1000 === 60\r\n          ? 1\r\n          : this.stepMilliseconds / 1000;\r\n      } else {\r\n        return (this.stepMilliseconds % 3600000) / 60;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\r\n      return 60;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  handleHourIncrement() {\r\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\r\n      return this.stepMilliseconds / 1000 / 60 / 60;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  fullBeginHoursArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.beginHours = Array.from(\r\n        {\r\n          length:\r\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\r\n        },\r\n        (_, i) => 0 + i * this.handleHourIncrement()\r\n      );\r\n    } else {\r\n      this.beginHours = Array.from(\r\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleHourIncrement()\r\n      );\r\n    }\r\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\r\n  }\r\n\r\n  fullEndHoursArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.endHours = Array.from(\r\n        {\r\n          length:\r\n            (23 - this.beginHourFormControl.value) /\r\n              this.handleHourIncrement() +\r\n            1\r\n        },\r\n        (_, i) =>\r\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\r\n      );\r\n    } else {\r\n      this.endHours = Array.from(\r\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleHourIncrement()\r\n      );\r\n    }\r\n    this.endHourFormControl.setValue(this.endValue.getHours());\r\n  }\r\n\r\n  fullBeginMinutesArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.beginMinutes = Array.from(\r\n        {\r\n          length:\r\n            (this.endMinuteFormControl.value - 0) /\r\n              this.handleMinuteIncrement() +\r\n            1\r\n        },\r\n        (_, i) => 0 + i * this.handleMinuteIncrement()\r\n      );\r\n    } else {\r\n      this.beginMinutes = Array.from(\r\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleMinuteIncrement()\r\n      );\r\n    }\r\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\r\n  }\r\n\r\n  fullEndMinutesArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.endMinutes = Array.from(\r\n        {\r\n          length:\r\n            (59 - this.beginMinuteFormControl.value) /\r\n              this.handleMinuteIncrement() +\r\n            1\r\n        },\r\n        (_, i) =>\r\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\r\n      );\r\n    } else {\r\n      this.endMinutes = Array.from(\r\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleMinuteIncrement()\r\n      );\r\n    }\r\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\r\n  }\r\n\r\n  updateHoursMinutesArray() {\r\n    const beginTmp = new Date(this.beginValue);\r\n    const endTmp = new Date(this.endValue);\r\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\r\n      this.fullBeginHoursArray(true);\r\n      this.fullEndHoursArray(true);\r\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\r\n        this.fullBeginMinutesArray(true);\r\n        this.fullEndMinutesArray(true);\r\n      }\r\n    } else {\r\n      this.fullBeginHoursArray();\r\n      this.fullEndHoursArray();\r\n      this.fullBeginMinutesArray();\r\n      this.fullEndMinutesArray();\r\n    }\r\n  }\r\n\r\n  private updateValues() {\r\n    this.changeTemporalProperty(this.beginValue, 1, false);\r\n    this.changeTemporalProperty(this.endValue, 2, true);\r\n  }\r\n\r\n  public restrictedToStep(): boolean {\r\n    return this.currentFilter.restrictToStep\r\n      ? this.currentFilter.restrictToStep\r\n      : false;\r\n  }\r\n\r\n  public handleMin() {\r\n    return this.currentFilter.begin\r\n      ? this.currentFilter.begin\r\n      : this.datasource.options.minDate\r\n      ? this.datasource.options.minDate\r\n      : this._defaultMin;\r\n  }\r\n\r\n  public handleMax() {\r\n    return this.currentFilter.end\r\n      ? this.currentFilter.end\r\n      : this.datasource.options.maxDate\r\n      ? this.datasource.options.maxDate\r\n      : this._defaultMax;\r\n  }\r\n\r\n  changePropertyByPass(event) {\r\n    this.changeProperty.next(event);\r\n  }\r\n\r\n  modeChange(event) {\r\n    if (!event.checked) {\r\n      this.updateValues();\r\n    }\r\n  }\r\n\r\n  setFilterStateDisable() {\r\n    if (this.currentFilter) {\r\n      this.filterStateDisable = !this.currentFilter.active;\r\n    } else {\r\n      this.filterStateDisable = false;\r\n    }\r\n    if (this.calendarType() === 'datetime') {\r\n      if (this.filterStateDisable === true) {\r\n        this.beginHourFormControl.disable();\r\n        this.beginMinuteFormControl.disable();\r\n        this.endHourFormControl.disable();\r\n        this.endMinuteFormControl.disable();\r\n      } else {\r\n        this.beginHourFormControl.enable();\r\n        this.beginMinuteFormControl.enable();\r\n        this.endHourFormControl.enable();\r\n        this.endMinuteFormControl.enable();\r\n      }\r\n    }\r\n  }\r\n  getDateFromStringWithoutTime(stringDate: string): Date {\r\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\r\n    // exemple:\r\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de lEst nord-amricain)\r\n    // to create same date as string, add time 00 in the creation\r\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de lEst nord-amricain)\r\n    let year;\r\n    let month = '01';\r\n    let day = '01';\r\n    if (stringDate.length === 10) {\r\n      const dateItems = stringDate.split('-');\r\n      if (dateItems.length !== 3) {\r\n        throw new Error(\r\n          'Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY'\r\n        );\r\n      } else {\r\n        year = dateItems[0];\r\n        month = dateItems[1];\r\n        day = dateItems[2];\r\n      }\r\n    } else if (stringDate.length === 4) {\r\n      year = stringDate;\r\n    } else {\r\n      return new Date(stringDate);\r\n    }\r\n    return new Date(`${year}-${month}-${day} 00:00:00`);\r\n  }\r\n\r\n  resetFilter() {\r\n    let filterOriginConfig = this.datasource.options.ogcFilters\r\n      .filters as OgcFilterDuringOptions;\r\n\r\n    let minDefaultDate;\r\n    let maxDefaultDate;\r\n    let minDefaultISOString;\r\n    let maxDefaultISOString;\r\n\r\n    if (this.calendarTypeYear) {\r\n      if (filterOriginConfig.end === 'today') {\r\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\r\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0, 4)}-01-01`;\r\n      } else {\r\n        maxDefaultISOString = `${filterOriginConfig.end.substring(0, 4)}-01-01`;\r\n      }\r\n      minDefaultISOString = `${filterOriginConfig.begin.substring(0, 4)}-01-01`;\r\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\r\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\r\n    } else {\r\n      minDefaultDate = this.parseFilter(filterOriginConfig.begin);\r\n      maxDefaultDate = this.parseFilter(filterOriginConfig.end);\r\n      minDefaultISOString = minDefaultDate.toISOString();\r\n      maxDefaultISOString = maxDefaultDate.toISOString();\r\n    }\r\n\r\n    if (\r\n      this.currentFilter.begin !== minDefaultISOString ||\r\n      this.currentFilter.end !== maxDefaultISOString\r\n    ) {\r\n      this.beginValue = minDefaultDate;\r\n      this.endValue = maxDefaultDate;\r\n      this.updateValues();\r\n    }\r\n  }\r\n\r\n  toggleFilterState() {\r\n    if (this.currentFilter.active === true) {\r\n      this.currentFilter.active = false;\r\n    } else {\r\n      this.currentFilter.active = true;\r\n    }\r\n    this.setFilterStateDisable();\r\n    this.updateValues();\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ViewChild,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\r\n\r\nimport { default as moment } from 'moment';\r\nimport { MatSlider } from '@angular/material/slider';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-time-slider',\r\n  templateUrl: './ogc-filter-time-slider.component.html',\r\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\r\n})\r\nexport class OgcFilterTimeSliderComponent implements OnInit {\r\n  @Input() currentFilter: any;\r\n  @Input() begin: any;\r\n  @Input() max: any;\r\n  @Input() datasource: any;\r\n  @Output() changeProperty: EventEmitter<{\r\n    value: any;\r\n    pos: number;\r\n    refreshFilter: boolean;\r\n  }> = new EventEmitter<any>();\r\n  @ViewChild(MatSlider) slider: MatSlider;\r\n\r\n  interval;\r\n  sliderValue: number = 1;\r\n  calculatedStep: number = 0;\r\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\r\n  readonly _defaultSliderInterval: number = 2000;\r\n  public playIcon = 'play-circle';\r\n  public resetIcon = 'replay';\r\n\r\n  get sliderInterval(): number {\r\n    return this.currentFilter.sliderInterval === undefined\r\n      ? this._defaultSliderInterval\r\n      : this.currentFilter.sliderInterval;\r\n  }\r\n\r\n  get displayFormat(): string {\r\n    if (this.currentFilter.sliderOptions?.displayFormat) {\r\n      return this.currentFilter.sliderOptions.displayFormat;\r\n    }\r\n    if (this.currentFilter.displayFormat) {\r\n      return this.currentFilter.displayFormat;\r\n    }\r\n    return this._defaultDisplayFormat;\r\n  }\r\n\r\n  get beginMillisecond(): number {\r\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\r\n  }\r\n\r\n  get maxMillisecond(): number {\r\n    return this.ogcFilterTimeService.dateToNumber(this.max);\r\n  }\r\n\r\n  get stepMillisecond(): number {\r\n    return this.ogcFilterTimeService.stepMillisecond(\r\n      this.datasource,\r\n      this.currentFilter\r\n    );\r\n  }\r\n\r\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\r\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.calculateStep();\r\n    this.handleSliderInput({ value: 1 });\r\n  }\r\n\r\n  sliderDisplayWith(value) {\r\n    let dateTmp = new Date(\r\n      this.beginMillisecond + (value - 1) * this.stepMillisecond\r\n    );\r\n\r\n    if (\r\n      this.ogcFilterTimeService.stepIsYearDuration(\r\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n      )\r\n    ) {\r\n      const toAdd = moment\r\n        .duration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n        .years();\r\n      dateTmp = moment(this.beginMillisecond)\r\n        .add((value - 1) * toAdd, 'year')\r\n        .toDate();\r\n    } else if (\r\n      this.ogcFilterTimeService.stepIsMonthDuration(\r\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n      )\r\n    ) {\r\n      const toAdd = moment\r\n        .duration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n        .months();\r\n      dateTmp = moment(this.beginMillisecond)\r\n        .add((value - 1) * toAdd, 'month')\r\n        .toDate();\r\n    }\r\n\r\n    return moment(dateTmp).format(this.displayFormat);\r\n  }\r\n\r\n  playFilter(event: any) {\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        (that) => {\r\n          if (this.slider.step < this.calculatedStep) {\r\n            const _increment = '_increment';\r\n            const _emitInputEvent = '_emitInputEvent';\r\n            this.slider[_increment](1);\r\n            this.slider[_emitInputEvent]();\r\n          } else {\r\n            this.stopFilter();\r\n          }\r\n        },\r\n        this.sliderInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  stopFilter() {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n  }\r\n\r\n  resetFilter(event: any) {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n    this.slider.step = 1;\r\n    const _increment = '_increment';\r\n    const _emitInputEvent = '_emitInputEvent';\r\n    this.slider[_emitInputEvent]();\r\n  }\r\n\r\n  handleSliderInput(matSliderChange) {\r\n    if (matSliderChange) {\r\n      if (\r\n        this.ogcFilterTimeService.stepIsYearDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n      ) {\r\n        const toAdd = moment\r\n          .duration(\r\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n          )\r\n          .years();\r\n        const dateBeginTmp = moment(this.beginMillisecond)\r\n          .add((matSliderChange.value - 1) * toAdd, 'year')\r\n          .toDate();\r\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\r\n        this.changeProperty.next({\r\n          value: moment(dateBeginTmp).toDate().toISOString(),\r\n          pos: 1,\r\n          refreshFilter: false\r\n        });\r\n        this.changeProperty.next({\r\n          value: moment(dateEndTmp).toDate().toISOString(),\r\n          pos: 2,\r\n          refreshFilter: true\r\n        });\r\n      } else if (\r\n        this.ogcFilterTimeService.stepIsMonthDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n      ) {\r\n        const toAdd = moment\r\n          .duration(\r\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n          )\r\n          .months();\r\n        const dateBeginTmp = moment(this.beginMillisecond)\r\n          .add((matSliderChange.value - 1) * toAdd, 'month')\r\n          .toDate();\r\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\r\n        this.changeProperty.next({\r\n          value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\r\n          pos: 1,\r\n          refreshFilter: false\r\n        });\r\n        this.changeProperty.next({\r\n          value: moment(dateEndTmp).toDate().toISOString(),\r\n          pos: 2,\r\n          refreshFilter: true\r\n        });\r\n      } else if (\r\n        this.ogcFilterTimeService.stepIsDayDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        ) ||\r\n        this.ogcFilterTimeService.stepIsHourDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        ) ||\r\n        this.ogcFilterTimeService.stepIsMinuteDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n      ) {\r\n        const dateTmp = new Date(\r\n          this.beginMillisecond +\r\n            this.stepMillisecond * (matSliderChange.value - 1)\r\n        );\r\n        this.changeProperty.next({\r\n          value: dateTmp.toISOString(),\r\n          pos: 1,\r\n          refreshFilter: false\r\n        });\r\n        this.changeProperty.next({\r\n          value: new Date(\r\n            this.ogcFilterTimeService.addStep(\r\n              dateTmp.toISOString(),\r\n              this.stepMillisecond\r\n            )\r\n          ).toISOString(),\r\n          pos: 2,\r\n          refreshFilter: true\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  calculateStep() {\r\n    for (\r\n      let i = 1;\r\n      this.maxMillisecond -\r\n        (this.beginMillisecond + i * this.stepMillisecond) >=\r\n      -1;\r\n      i++\r\n    ) {\r\n      this.calculatedStep = i;\r\n    }\r\n  }\r\n}\r\n","<div class=\"slider-container\">\r\n  <mat-slider\r\n    id=\"time-slider\"\r\n    [step]=\"1\"\r\n    [min]=\"1\"\r\n    [max]=\"calculatedStep\"\r\n    [(ngModel)]=\"sliderValue\"\r\n    [displayWith]=\"sliderDisplayWith\"\r\n    thumbLabel\r\n    #ngSlider\r\n    ><input\r\n      matSliderThumb\r\n      (input)=\"\r\n        handleSliderInput({\r\n          source: ngSliderThumb,\r\n          parent: ngSlider,\r\n          value: ngSliderThumb.value\r\n        })\r\n      \"\r\n      #ngSliderThumb=\"matSliderThumb\"\r\n    />\r\n  </mat-slider>\r\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\r\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\r\n  </button>\r\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\r\n    <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\r\n  </button>\r\n</div>\r\n","import { DrawControlOptions } from './../shared/controls/draw';\r\nimport {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  Optional,\r\n  Self,\r\n  ChangeDetectorRef,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport * as OlStyle from 'ol/style';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlGeometry from 'ol/geom/Geometry';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport * as olproj from 'ol/proj';\r\nimport Point from 'ol/geom/Point';\r\n\r\nimport { IgoMap } from '../../map/shared';\r\nimport {\r\n  MeasureLengthUnit,\r\n  updateOlGeometryMidpoints,\r\n  formatMeasure,\r\n  measureOlGeometry\r\n} from '../../measure';\r\nimport {\r\n  DrawControl,\r\n  ModifyControl,\r\n  ModifyControlOptions\r\n} from '../shared/controls';\r\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\r\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\n\r\ninterface HasRadius {\r\n  getRadius: () => number;\r\n  setRadius: (radius: number) => void;\r\n}\r\n\r\n/**\r\n * This input allows a user to draw a new geometry or to edit\r\n * an existing one on a map. A text input is also displayed in the\r\n * form with some instructions.\r\n * This is still WIP.\r\n */\r\n@Component({\r\n  selector: 'igo-geometry-form-field-input',\r\n  templateUrl: './geometry-form-field-input.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class GeometryFormFieldInputComponent\r\n  implements OnInit, OnDestroy, ControlValueAccessor\r\n{\r\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\r\n  private olGeoJSON = new OlGeoJSON();\r\n  private ready = false;\r\n\r\n  private drawControl: DrawControl;\r\n  private modifyControl: ModifyControl;\r\n  private defaultDrawStyleRadius: number;\r\n  private olGeometryEnds$$: Subscription;\r\n  private olGeometryChanges$$: Subscription;\r\n  private olTooltip = this.createMeasureTooltip();\r\n\r\n  /**\r\n   * Active control\r\n   * @internal\r\n   */\r\n  public activeControl: DrawControl | ModifyControl;\r\n\r\n  /**\r\n   * The map to draw the geometry on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The geometry type\r\n   */\r\n  @Input()\r\n  set geometryType(value: Type) {\r\n    this._geometryType = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateControl();\r\n    this.createDrawControl();\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n    this.toggleControl();\r\n  }\r\n  get geometryType(): Type {\r\n    return this._geometryType;\r\n  }\r\n  private _geometryType: Type;\r\n\r\n  /**\r\n   * The drawGuide around the mouse pointer to help drawing\r\n   */\r\n  @Input() drawGuide: number = null;\r\n\r\n  /**\r\n   * Whether a measure tooltip should be displayed\r\n   */\r\n  @Input() measure: boolean = false;\r\n\r\n  /**\r\n   * Whether draw control should be active or not\r\n   */\r\n  @Input()\r\n  get drawControlIsActive(): boolean {\r\n    return this._drawControlIsActive;\r\n  }\r\n  set drawControlIsActive(value: boolean) {\r\n    this._drawControlIsActive = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n    this.deactivateControl();\r\n    if (!this._drawControlIsActive) {\r\n      return;\r\n    } else {\r\n      this.toggleControl();\r\n    }\r\n  }\r\n  private _drawControlIsActive: boolean = true;\r\n\r\n  /**\r\n   * Whether freehand draw control should be active or not\r\n   */\r\n  @Input()\r\n  get freehandDrawIsActive(): boolean {\r\n    return this._freehandDrawIsActive;\r\n  }\r\n  set freehandDrawIsActive(value: boolean) {\r\n    this._freehandDrawIsActive = value;\r\n    this.deactivateControl();\r\n\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    if (!this.drawControlIsActive) {\r\n      return;\r\n    }\r\n    this.toggleControl();\r\n  }\r\n  private _freehandDrawIsActive: boolean;\r\n\r\n  /**\r\n   * Whether freehand draw control should be active or not\r\n   */\r\n  @Input()\r\n  get predefinedRadius(): boolean {\r\n    return this._predefinedRadius;\r\n  }\r\n  set predefinedRadius(value: boolean) {\r\n    this._predefinedRadius = value;\r\n    this.drawControl.ispredefinedRadius$.next(value);\r\n  }\r\n  private _predefinedRadius: boolean;\r\n\r\n  /**\r\n   * Control options\r\n   */\r\n  @Input() controlOptions: { [key: string]: any } = {};\r\n\r\n  /**\r\n   * Style for the draw control (applies while the geometry is being drawn)\r\n   */\r\n  @Input()\r\n  set drawStyle(value: OlStyleLike | OlStyle.RegularShape) {\r\n    if (value === undefined) {\r\n      value = createDrawInteractionStyle();\r\n    }\r\n    this._drawStyle = value;\r\n\r\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value);\r\n    if (olGuideStyle !== undefined) {\r\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\r\n    } else {\r\n      this.defaultDrawStyleRadius = null;\r\n    }\r\n\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateControl();\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n    this.toggleControl();\r\n  }\r\n  get drawStyle(): OlStyleLike | OlStyle.RegularShape {\r\n    return this._drawStyle;\r\n  }\r\n  private _drawStyle: OlStyleLike | OlStyle.RegularShape;\r\n\r\n  /**\r\n   * Style for the overlay layer (applies once the geometry is added to the map)\r\n   * If not specified, drawStyle applies\r\n   */\r\n  @Input()\r\n  set overlayStyle(value: OlStyleLike | OlStyle.RegularShape) {\r\n    this._overlayStyle = value;\r\n  }\r\n  get overlayStyle(): OlStyleLike | OlStyle.RegularShape {\r\n    return this._overlayStyle;\r\n  }\r\n  private _overlayStyle: OlStyleLike | OlStyle.RegularShape;\r\n\r\n  /**\r\n   * The geometry value (GeoJSON)\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  @Input()\r\n  set value(value: GeoJSONGeometry) {\r\n    this._value = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    if (value) {\r\n      this.addGeoJSONToOverlay(value);\r\n    } else {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n    this.onChange(value);\r\n    this.toggleControl();\r\n    this.cdRef.detectChanges();\r\n  }\r\n  get value(): GeoJSONGeometry {\r\n    return this._value;\r\n  }\r\n  private _value: GeoJSONGeometry;\r\n\r\n  /**\r\n   * The vector source to add the geometry to\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  @Input()\r\n  set radius(value: any) {\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n    if (this.modifyControl.getSource()) {\r\n      this.modifyControl.getSource().refresh();\r\n    }\r\n    if (this.freehandDrawIsActive) {\r\n      let olModify;\r\n      setTimeout(() => {\r\n        olModify = this.modifyControl.olModifyInteraction;\r\n        if (olModify) {\r\n          if (olModify.features_) {\r\n            olModify.features_.clear();\r\n            this.addGeoJSONToOverlay(this.value);\r\n          }\r\n        }\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    @Optional() @Self() public ngControl: NgControl\r\n  ) {\r\n    if (this.ngControl !== undefined) {\r\n      // Setting the value accessor directly (instead of using\r\n      // the providers) to avoid running into a circular import.\r\n      this.ngControl.valueAccessor = this;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create an overlay layer, add the initial geometry to it (if any)\r\n   * and toggle the right interaction.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    if (this.drawStyle === undefined) {\r\n      this.drawStyle = createDrawInteractionStyle();\r\n    }\r\n\r\n    if (this.overlayStyle === undefined) {\r\n      this.overlayStyle = this.drawStyle;\r\n    }\r\n\r\n    this.addOlOverlayLayer();\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    if (this.value) {\r\n      this.addGeoJSONToOverlay(this.value);\r\n    }\r\n    this.toggleControl();\r\n\r\n    this.ready = true;\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer and any interaction added by this component.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    // This is mandatory when the form control is reused after\r\n    // this component has been destroyed. It seems like the control\r\n    // keeps a reference to this component even after it's destroyed\r\n    // and it attempts to set it's value\r\n    this.ready = false;\r\n\r\n    this.deactivateControl();\r\n    this.olOverlaySource.clear();\r\n    this.map.ol.removeLayer(this.olOverlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  registerOnChange(fn: Function) {\r\n    this.onChange = fn;\r\n  }\r\n  private onChange: any = () => {};\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  registerOnTouched(fn: Function) {\r\n    this.onTouched = fn;\r\n  }\r\n  private onTouched: any = () => {};\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  writeValue(value: GeoJSONGeometry) {\r\n    this.value = value;\r\n  }\r\n\r\n  /**\r\n   * Add an overlay layer to the map\r\n   */\r\n  private addOlOverlayLayer() {\r\n    this.olOverlayLayer = new OlVectorLayer({\r\n      source: new OlVectorSource(),\r\n      zIndex: 500,\r\n      style: null\r\n    });\r\n    this.map.ol.addLayer(this.olOverlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Create a draw control and subscribe to it's geometry\r\n   */\r\n  private createDrawControl() {\r\n    const controlOptions = Object.assign({}, this.controlOptions, {\r\n      geometryType: this.geometryType || 'Point',\r\n      drawingLayer: this.olOverlayLayer,\r\n      interactionStyle:\r\n        typeof this.drawStyle === 'function'\r\n          ? this.drawStyle\r\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\r\n              const style = this.drawStyle;\r\n              this.updateDrawStyleWithDrawGuide(style, resolution);\r\n              return style;\r\n            }\r\n    }) as DrawControlOptions;\r\n    this.drawControl = new DrawControl(controlOptions);\r\n  }\r\n\r\n  /**\r\n   * Create a modify control and subscribe to it's geometry\r\n   */\r\n  private createModifyControl() {\r\n    const controlOptions = Object.assign({}, this.controlOptions, {\r\n      layer: this.olOverlayLayer,\r\n      drawStyle:\r\n        typeof this.drawStyle === 'function'\r\n          ? this.drawStyle\r\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\r\n              const style = this.drawStyle;\r\n              this.updateDrawStyleWithDrawGuide(style, resolution);\r\n              return style;\r\n            }\r\n    }) as ModifyControlOptions;\r\n    this.modifyControl = new ModifyControl(controlOptions);\r\n  }\r\n\r\n  /**\r\n   * Toggle the proper control (draw or modify)\r\n   */\r\n  private toggleControl() {\r\n    let activate;\r\n    if (!this.value && this.geometryType) {\r\n      activate = this.drawControl;\r\n    } else {\r\n      activate = this.modifyControl;\r\n    }\r\n\r\n    // If the control that should be activated\r\n    // is not the same as the current active control,\r\n    // deactivate the current control and activate the new one\r\n    // Otherwise, do nothing and keep the current control active\r\n    if (activate !== this.activeControl) {\r\n      this.deactivateControl();\r\n      this.activateControl(activate);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param control Control\r\n   */\r\n  private activateControl(control: DrawControl | ModifyControl) {\r\n    this.activeControl = control;\r\n    this.olGeometryEnds$$ = control.end$.subscribe((olGeometry: OlGeometry) =>\r\n      this.onOlGeometryEnds(olGeometry)\r\n    );\r\n    if (this.measure === true && control === this.drawControl) {\r\n      this.olGeometryChanges$$ = control.changes$.subscribe(\r\n        (olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) =>\r\n          this.onOlGeometryChanges(olGeometry)\r\n      );\r\n    }\r\n    control.setOlMap(this.map.ol, false);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active control\r\n   */\r\n  private deactivateControl() {\r\n    this.removeMeasureTooltip();\r\n    if (this.activeControl !== undefined) {\r\n      this.activeControl.setOlMap(undefined);\r\n    }\r\n    if (this.olGeometryEnds$$ !== undefined) {\r\n      this.olGeometryEnds$$.unsubscribe();\r\n    }\r\n    if (this.olGeometryChanges$$ !== undefined) {\r\n      this.olGeometryChanges$$.unsubscribe();\r\n    }\r\n    this.activeControl = undefined;\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\r\n    this.removeMeasureTooltip();\r\n    this.setOlGeometry(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onOlGeometryChanges(\r\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\r\n  ) {\r\n    if (olGeometry.getType() !== 'Point') {\r\n      this.updateMeasureTooltip(olGeometry);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When drawing ends, convert the output value to GeoJSON and keep it.\r\n   * Restore the double click interaction.\r\n   * @param olGeometry OL geometry\r\n   */\r\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\r\n    let value;\r\n    if (olGeometry === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (olGeometry.getType() === 'Circle') {\r\n      // Because Circle doesn't exist as a GeoJSON object\r\n      olGeometry = this.circleToPoint(olGeometry);\r\n    }\r\n\r\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\r\n      featureProjection: this.map.projection,\r\n      dataProjection: 'EPSG:4326'\r\n    });\r\n    if (olGeometry.get('radius')) {\r\n      value.radius = olGeometry.get('radius');\r\n      olGeometry.set('radius', value.radius);\r\n    }\r\n    this.writeValue(value);\r\n  }\r\n\r\n  private circleToPoint(olGeometry) {\r\n    const center = olGeometry.getCenter();\r\n    const coordinates = olproj.transform(\r\n      center,\r\n      this.map.projection,\r\n      'EPSG:4326'\r\n    );\r\n    const radius = Math.round(\r\n      olGeometry.getRadius() * Math.cos((Math.PI / 180) * coordinates[1])\r\n    );\r\n\r\n    // Convert it to a point object\r\n    olGeometry = new Point(center);\r\n    olGeometry.set('radius', radius, true);\r\n    return olGeometry;\r\n  }\r\n\r\n  /**\r\n   * Add a GeoJSON geometry to the overlay\r\n   * @param geometry GeoJSON geometry\r\n   */\r\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\r\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: this.map.projection\r\n    });\r\n    const olFeature = new OlFeature({\r\n      geometry: olGeometry\r\n    });\r\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\r\n    this.olOverlaySource.clear();\r\n    this.olOverlaySource.addFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Create the measure tooltip\r\n   */\r\n  private createMeasureTooltip() {\r\n    return new OlOverlay({\r\n      element: document.createElement('div'),\r\n      offset: [-30, -10],\r\n      className: ['igo-map-tooltip', 'igo-map-tooltip-measure'].join(' '),\r\n      stopEvent: false\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update the measure tooltip of an OL geometry\r\n   * @param olGeometry OL Geometry\r\n   */\r\n  private updateMeasureTooltip(\r\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\r\n  ) {\r\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\r\n    const lengths = measure.lengths;\r\n    const lastIndex =\r\n      olGeometry.getType() === 'Polygon'\r\n        ? lengths.length - 2\r\n        : lengths.length - 1;\r\n    const lastLength = lengths[lastIndex];\r\n\r\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n    const olLastMidpoint = olMidpoints[lastIndex];\r\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\r\n      this.removeMeasureTooltip();\r\n      return;\r\n    }\r\n\r\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\r\n\r\n    const innerHtml = formatMeasure(lastLength, {\r\n      decimal: 1,\r\n      unit: MeasureLengthUnit.Meters,\r\n      unitAbbr: true,\r\n      locale: 'fr'\r\n    });\r\n    this.olTooltip.getElement().innerHTML = innerHtml;\r\n    if (this.olTooltip.getMap() === undefined) {\r\n      this.map.ol.addOverlay(this.olTooltip);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the measure tooltip from the map\r\n   */\r\n  private removeMeasureTooltip() {\r\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\r\n      this.map.ol.removeOverlay(this.olTooltip);\r\n      this.olTooltip.setMap(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adjust the draw style with the specified draw guide distance, if possible\r\n   * @param olStyle Draw style to update\r\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\r\n   */\r\n  private updateDrawStyleWithDrawGuide(\r\n    olStyle: OlStyleLike | OlStyle.RegularShape,\r\n    resolution: number\r\n  ) {\r\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle);\r\n    if (olGuideStyle === undefined) {\r\n      return;\r\n    }\r\n    const drawGuide = this.drawGuide;\r\n    let radius;\r\n    if (!drawGuide || drawGuide < 0) {\r\n      radius = this.defaultDrawStyleRadius;\r\n    } else {\r\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\r\n    }\r\n    olGuideStyle.setRadius(radius);\r\n  }\r\n\r\n  /**\r\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\r\n   * @param olStyle The style on which to perform the check\r\n   */\r\n  private getGuideStyleFromDrawStyle(\r\n    olStyle: OlStyleLike | OlStyle.RegularShape\r\n  ): HasRadius | undefined {\r\n    let baseStyle: unknown;\r\n    if (Array.isArray(olStyle)) {\r\n      baseStyle = olStyle[0];\r\n    } else {\r\n      baseStyle = olStyle;\r\n    }\r\n\r\n    if (typeof (baseStyle as any).getImage === 'function') {\r\n      baseStyle = (baseStyle as any).getImage() as OlStyle.Image;\r\n    }\r\n\r\n    let guideStyle: HasRadius;\r\n    if (typeof (baseStyle as any).setRadius === 'function') {\r\n      guideStyle = baseStyle as HasRadius;\r\n    }\r\n\r\n    return guideStyle;\r\n  }\r\n}\r\n","<ng-template></ng-template>\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatNativeDateModule, MAT_DATE_LOCALE } from '@angular/material/core';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDatepickerModule } from '@angular/material/datepicker';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatSliderModule } from '@angular/material/slider';\r\nimport { MatTableModule } from '@angular/material/table';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatTreeModule } from '@angular/material/tree';\r\n\r\nimport {\r\n  MatDatetimepickerModule,\r\n  MatNativeDatetimeModule\r\n} from '@mat-datetimepicker/core';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoListModule,\r\n  IgoKeyValueModule,\r\n  IgoEntityModule,\r\n  IgoDOMModule\r\n} from '@igo2/common';\r\nimport { IgoGeometryModule } from './../geometry/geometry.module';\r\n\r\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\r\nimport { IgoLayerModule } from '../layer/layer.module';\r\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\r\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\r\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\r\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\r\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\r\nimport { TimeFilterService } from './shared/time-filter.service';\r\n\r\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\r\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\r\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\r\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\r\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\r\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\r\nimport { OGCFilterService } from './shared/ogc-filter.service';\r\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\r\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\r\n\r\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\r\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\r\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\r\nimport { SpatialFilterService } from './shared/spatial-filter.service';\r\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\r\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatAutocompleteModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTabsModule,\r\n    MatRadioModule,\r\n    MatMenuModule,\r\n    MatTableModule,\r\n    MatTreeModule,\r\n    MatButtonToggleModule,\r\n    MatCheckboxModule,\r\n    MatSliderModule,\r\n    MatSlideToggleModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    MatDatepickerModule,\r\n    MatNativeDateModule,\r\n    MatDatetimepickerModule,\r\n    MatNativeDatetimeModule,\r\n    IgoLanguageModule,\r\n    IgoLayerModule,\r\n    IgoCollapsibleModule,\r\n    IgoListModule,\r\n    IgoEntityModule,\r\n    IgoDOMModule,\r\n    IgoKeyValueModule,\r\n    IgoGeometryModule,\r\n    MatBadgeModule\r\n  ],\r\n  exports: [\r\n    FilterableDataSourcePipe,\r\n    TimeFilterButtonComponent,\r\n    TimeFilterFormComponent,\r\n    TimeFilterItemComponent,\r\n    TimeFilterListComponent,\r\n    TimeFilterListBindingDirective,\r\n    OgcFilterFormComponent,\r\n    OgcFilterButtonComponent,\r\n    OgcFilterSelectionComponent,\r\n    OgcFilterableFormComponent,\r\n    OgcFilterableItemComponent,\r\n    OgcFilterableListComponent,\r\n    OgcFilterableListBindingDirective,\r\n    SpatialFilterTypeComponent,\r\n    SpatialFilterListComponent,\r\n    SpatialFilterItemComponent,\r\n    OgcFilterTimeComponent,\r\n    OgcFilterTimeSliderComponent\r\n  ],\r\n  declarations: [\r\n    FilterableDataSourcePipe,\r\n    TimeFilterButtonComponent,\r\n    TimeFilterFormComponent,\r\n    TimeFilterItemComponent,\r\n    TimeFilterListComponent,\r\n    TimeFilterListBindingDirective,\r\n    OgcFilterFormComponent,\r\n    OgcFilterButtonComponent,\r\n    OgcFilterSelectionComponent,\r\n    OgcFilterableFormComponent,\r\n    OgcFilterableItemComponent,\r\n    OgcFilterableListComponent,\r\n    OgcFilterableListBindingDirective,\r\n    SpatialFilterTypeComponent,\r\n    SpatialFilterListComponent,\r\n    SpatialFilterItemComponent,\r\n    OgcFilterTimeComponent,\r\n    OgcFilterTimeSliderComponent\r\n  ],\r\n  providers: [\r\n    TimeFilterService,\r\n    OGCFilterService,\r\n    OGCFilterTimeService,\r\n    SpatialFilterService\r\n  ]\r\n})\r\nexport class IgoFilterModule {\r\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\r\n    return {\r\n      ngModule: IgoFilterModule,\r\n      providers: [\r\n        {\r\n          provide: MAT_DATE_LOCALE,\r\n          useValue: 'fr-FR'\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoKeyValueModule,\r\n  IgoDrapDropModule,\r\n  IgoSpinnerModule,\r\n  IgoCustomHtmlModule\r\n} from '@igo2/common';\r\n\r\nimport { ExportButtonComponent } from './export-button/export-button.component';\r\nimport { ImportExportComponent } from './import-export/import-export.component';\r\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\r\n\r\n@NgModule({\r\n  imports: [\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatTabsModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule,\r\n    IgoSpinnerModule,\r\n    IgoKeyValueModule,\r\n    IgoDrapDropModule,\r\n    IgoCustomHtmlModule\r\n  ],\r\n  exports: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent],\r\n  declarations: [\r\n    ImportExportComponent,\r\n    DropGeoFileDirective,\r\n    ExportButtonComponent\r\n  ]\r\n})\r\nexport class IgoImportExportModule {\r\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\r\n    return {\r\n      ngModule: IgoImportExportModule\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule } from '@igo2/common';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { WakeLockButtonComponent } from './wake-lock-button/wake-lock-button.component';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\nimport { InfoSectionComponent } from './info-section/info-section.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule\n  ],\n  exports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ],\n  declarations: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ]\n})\nexport class IgoMapModule {}\n","<mat-form-field class=\"measure-field\" floatLabel=\"always\">\r\n  <mat-label>{{ placeholder }}</mat-label>\r\n  <input\r\n    matInput\r\n    [disabled]=\"true\"\r\n    [readonly]=\"true\"\r\n    [value]=\"(measure$ | async) || 0 | measureFormat: measureUnit\"\r\n  />\r\n</mat-form-field>\r\n<mat-form-field class=\"unit-field\">\r\n  <mat-select\r\n    [value]=\"measureUnit\"\r\n    [disabled]=\"auto\"\r\n    (selectionChange)=\"onMeasureUnitChange($event.value)\"\r\n  >\r\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\r\n      {{ 'igo.geo.measure.' + measureUnit | translate }}\r\n    </mat-option>\r\n  </mat-select>\r\n</mat-form-field>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport {\r\n  MeasureType,\r\n  MeasureAreaUnit,\r\n  MeasureLengthUnit\r\n} from '../shared/measure.enum';\r\nimport {\r\n  computeBestAreaUnit,\r\n  computeBestLengthUnit\r\n} from '../shared/measure.utils';\r\n\r\n/**\r\n * Measurer item\r\n */\r\n@Component({\r\n  selector: 'igo-measurer-item',\r\n  templateUrl: './measurer-item.component.html',\r\n  styleUrls: ['./measurer-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerItemComponent implements OnDestroy {\r\n  /**\r\n   * Measure observable\r\n   * @internal\r\n   */\r\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Subscription to the measure observable when the auto mode is on\r\n   * @internal\r\n   */\r\n  public measure$$: Subscription;\r\n\r\n  /**\r\n   * Measure type\r\n   */\r\n  @Input() measureType: MeasureType;\r\n\r\n  /**\r\n   * Measure unit\r\n   */\r\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\r\n\r\n  /**\r\n   * Measure\r\n   */\r\n  @Input()\r\n  set measure(value: number) {\r\n    this.measure$.next(value);\r\n  }\r\n  get measure(): number {\r\n    return this.measure$.value;\r\n  }\r\n\r\n  /**\r\n   * Whther measure units should be automatically determined\r\n   */\r\n  @Input()\r\n  set auto(value: boolean) {\r\n    this.toggleAutoUnit(value);\r\n  }\r\n  get auto(): boolean {\r\n    return this._auto;\r\n  }\r\n  private _auto: boolean = false;\r\n\r\n  /**\r\n   * Placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Event emitted when the measure unit changes\r\n   */\r\n  @Output() measureUnitChange = new EventEmitter<\r\n    MeasureAreaUnit | MeasureLengthUnit\r\n  >();\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    if (this.measureType === MeasureType.Area) {\r\n      return Object.values(MeasureAreaUnit);\r\n    }\r\n    return Object.values(MeasureLengthUnit);\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Toggle the auto unit off\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.toggleAutoUnit(false);\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\r\n    this.measureUnit = unit;\r\n    this.measureUnitChange.emit(unit);\r\n  }\r\n\r\n  private toggleAutoUnit(toggle: boolean) {\r\n    if (this.measure$$ !== undefined) {\r\n      this.measure$$.unsubscribe();\r\n    }\r\n    if (toggle === true) {\r\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\r\n        this.computeBestMeasureUnit(measure);\r\n      });\r\n    }\r\n    this._auto = toggle;\r\n  }\r\n\r\n  private computeBestMeasureUnit(measure: number) {\r\n    let measureUnit = this.measureUnit;\r\n    if (this.measureType === MeasureType.Area) {\r\n      measureUnit = computeBestAreaUnit(measure);\r\n    } else if (this.measureType === MeasureType.Length) {\r\n      measureUnit = computeBestLengthUnit(measure);\r\n    }\r\n    if (measureUnit !== this.measureUnit) {\r\n      this.onMeasureUnitChange(measureUnit);\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoEntityTableModule } from '@igo2/common';\r\n\r\nimport { MeasureFormatPipe } from './measure-format.pipe';\r\nimport { MeasurerItemComponent } from './measurer-item.component';\r\nimport { MeasurerComponent } from './measurer.component';\r\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatDialogModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    MatDividerModule,\r\n    IgoLanguageModule,\r\n    IgoEntityTableModule\r\n  ],\r\n  declarations: [\r\n    MeasureFormatPipe,\r\n    MeasurerItemComponent,\r\n    MeasurerComponent,\r\n    MeasurerDialogComponent\r\n  ],\r\n  exports: [MeasureFormatPipe, MeasurerComponent]\r\n})\r\nexport class IgoMeasurerModule {}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMeasurerModule } from './measurer/measurer.module';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: [IgoMeasurerModule]\r\n})\r\nexport class IgoMeasureModule {}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule } from '@igo2/common';\n\nimport { PrintComponent } from './print/print.component';\nimport { PrintFormComponent } from './print-form/print-form.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatInputModule,\n    MatFormFieldModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoKeyValueModule\n  ],\n  exports: [PrintComponent, PrintFormComponent],\n  declarations: [PrintComponent, PrintFormComponent]\n})\nexport class IgoPrintModule {}\n","import { ConfigService } from '@igo2/core';\n\nimport { SearchSource } from '../../search/shared/sources/source';\n\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule, IgoMessageModule } from '@igo2/core';\n\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\n\n@NgModule({\n  imports: [CommonModule, IgoLanguageModule, IgoMessageModule],\n  exports: [QueryDirective],\n  declarations: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { Observable } from 'rxjs';\r\n\r\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\r\n\r\nexport abstract class DirectionsSource {\r\n  abstract enabled: boolean;\r\n  abstract getName(): string;\r\n  abstract route(\r\n    coordinates: [number, number][],\r\n    directionsOptions: DirectionOptions\r\n  ): Observable<Direction[]>;\r\n}\r\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\r\nimport { DragDropModule } from '@angular/cdk/drag-drop';\r\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\r\nimport { DirectionsComponent } from './directions.component';\r\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\r\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    DragDropModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatListModule,\r\n    MatDividerModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    MatAutocompleteModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [\r\n    DirectionsComponent,\r\n    DirectionsInputsComponent,\r\n    DirectionsButtonsComponent,\r\n    DirectionsResultsComponent\r\n  ],\r\n  declarations: [\r\n    DirectionsComponent,\r\n    DirectionsInputsComponent,\r\n    DirectionsButtonsComponent,\r\n    DirectionsResultsComponent\r\n  ],\r\n  providers: [provideDirectionsSourceService()]\r\n})\r\nexport class IgoDirectionsModule {\r\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\r\n    return {\r\n      ngModule: IgoDirectionsModule\r\n    };\r\n  }\r\n}\r\n","import { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { SearchSource } from './sources/source';\r\nimport { SearchResult } from './search.interfaces';\r\n\r\n/**\r\n * Function that checks whether a search source implements TextSearch\r\n * @param source Search source\r\n * @returns True if the search source implements TextSearch\r\n */\r\nexport function sourceCanSearch(source: SearchSource): boolean {\r\n  return (source as any).search !== undefined;\r\n}\r\n\r\n/**\r\n * Function that checks whether a search source implements ReverseSearch\r\n * @param source Search source\r\n * @returns True if the search source implements ReverseSearch\r\n */\r\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\r\n  return (source as any).reverseSearch !== undefined;\r\n}\r\n\r\n/**\r\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\r\n * @param source Search source\r\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\r\n */\r\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\r\n  return (\r\n    (source as any).reverseSearch !== undefined &&\r\n    source.showInPointerSummary === true\r\n  );\r\n}\r\n\r\n/**\r\n * Return a search result out of an Feature. This is used to adapt\r\n * the IGO query module to the new Feature/SearchResult interfaces\r\n * @param feature feature\r\n * @param source Search source\r\n * @returns SearchResult\r\n */\r\nexport function featureToSearchResult(\r\n  feature: Feature,\r\n  source: SearchSource\r\n): SearchResult<Feature> {\r\n  if (feature.properties) {\r\n    delete feature.properties.geometry;\r\n    delete feature.properties.GEOMETRIE;\r\n    delete feature.properties.boundedBy;\r\n    delete feature.properties.shape;\r\n    delete feature.properties.SHAPE;\r\n    delete feature.properties.SHAPE_S;\r\n    delete feature.properties.SHAPE_L;\r\n    delete feature.properties.SHAPE_P;\r\n    delete feature.properties.the_geom;\r\n    delete feature.properties.geom;\r\n    delete feature.properties.geom32198;\r\n  }\r\n  feature.sourceId = source.getId();\r\n  return {\r\n    source,\r\n    data: feature,\r\n    meta: {\r\n      dataType: FEATURE,\r\n      id: feature.meta.id as string,\r\n      title: feature.meta.title,\r\n      icon: feature.meta.icon || 'map-marker'\r\n    }\r\n  };\r\n}\r\n\r\nexport function findDiff(str1: string, str2: string) {\r\n  let diff = '';\r\n  str2.split('').forEach((val, i) => {\r\n    if (val !== str1.charAt(i)) {\r\n      diff += val;\r\n    }\r\n  });\r\n  return diff;\r\n}\r\n\r\n/**\r\n * Return a score calculation based on \"from\" term with the \"to\" term,\r\n * where the perfect match is 100 and a total difference is 0 or under.\r\n * @param from string\r\n * @param to string\r\n * @param caseSensitive boolean\r\n * @returns number\r\n */\r\nexport function computeTermSimilarity(\r\n  from,\r\n  to,\r\n  caseSensitive: boolean = false\r\n): number {\r\n  if (!from || !to) {\r\n    return 0;\r\n  }\r\n  const termFrom = caseSensitive ? from : from.toString().toLowerCase();\r\n  const termTo = caseSensitive ? to : to.toString().toLowerCase();\r\n  const fromToDiff = findDiff(termFrom, termTo);\r\n  const toFromDiff = findDiff(termTo, termFrom);\r\n  const totalDiff = fromToDiff + toFromDiff;\r\n\r\n  let delta = 0;\r\n  if (totalDiff.length) {\r\n    delta = (totalDiff.length / termFrom.length) * 100;\r\n  }\r\n\r\n  return 100 - Math.floor(delta);\r\n}\r\n","import { Workspace } from '@igo2/common';\r\nimport { SearchSource } from './sources/source';\r\nimport { SearchSourceSettings } from './sources/source.interfaces';\r\n\r\n/**\r\n * Service where all available search sources are registered.\r\n */\r\nexport class SearchSourceService {\r\n  constructor(private sources: SearchSource[]) {}\r\n\r\n  /**\r\n   * Return available search sources\r\n   * @returns Search sources\r\n   */\r\n  getSources(): SearchSource[] {\r\n    return this.sources;\r\n  }\r\n\r\n  /**\r\n   * Return enabled search sources\r\n   * @returns Search sources\r\n   */\r\n  getEnabledSources(): SearchSource[] {\r\n    return this.getSources().filter(\r\n      (source: SearchSource) => source.enabled === true\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Enable search sources of given type\r\n   * @param type Search type\r\n   * @todo It would be better to track the enabled search sources\r\n   *  without updating their 'enabled' property.\r\n   */\r\n  enableSourcesByType(type: string) {\r\n    this.getSources().forEach((source: SearchSource) => {\r\n      if ((source.constructor as typeof SearchSource).type === type) {\r\n        source.enabled = true;\r\n      } else {\r\n        source.enabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set Param from the selected settings\r\n   * @param source search-source\r\n   * @param setting settings\r\n   */\r\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\r\n    source.setParamFromSetting(setting);\r\n  }\r\n\r\n  /**\r\n   * Set Param from the selected settings\r\n   * @param source search-source\r\n   * @param setting settings\r\n   */\r\n  setWorkspaces(source: SearchSource, workspaces: Workspace[]) {\r\n    source.setWorkspaces(workspaces);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { stringToLonLat } from '../../map/shared';\r\nimport { MapService } from '../../map/shared/map.service';\r\n\r\nimport { SearchSource } from './sources/source';\r\nimport {\r\n  TextSearchOptions,\r\n  ReverseSearchOptions\r\n} from './sources/source.interfaces';\r\nimport { SearchSourceService } from './search-source.service';\r\nimport { Research, TextSearch, ReverseSearch } from './search.interfaces';\r\nimport {\r\n  sourceCanSearch,\r\n  sourceCanReverseSearch,\r\n  sourceCanReverseSearchAsSummary\r\n} from './search.utils';\r\nimport { StorageService } from '@igo2/core';\r\n\r\n/**\r\n * This service perform researches in all the search sources enabled.\r\n * It returns Research objects who's 'request' property needs to be\r\n * subscribed to in order to trigger the research. This services has\r\n * keeps internal state of the researches it performed\r\n * and the results they yielded.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SearchService {\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private mapService: MapService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  /**\r\n   * Perform a research by text\r\n   * @param term Any text\r\n   * @returns Researches\r\n   */\r\n  search(term: string, options: TextSearchOptions = {}): Research[] {\r\n    if (!this.termIsValid(term)) {\r\n      return [];\r\n    }\r\n\r\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\r\n    const response = stringToLonLat(term, proj, {\r\n      forceNA: options.forceNA\r\n    });\r\n    if (response.lonLat) {\r\n      return this.reverseSearch(response.lonLat, {\r\n        distance: response.radius,\r\n        conf: response.conf\r\n      });\r\n    } else if (response.message) {\r\n      console.log(response.message);\r\n    }\r\n\r\n    options.extent = this.mapService\r\n      .getMap()\r\n      ?.viewController.getExtent('EPSG:4326');\r\n\r\n    let sources;\r\n\r\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\r\n      sources = this.searchSourceService.getEnabledSources();\r\n    } else {\r\n      sources = this.searchSourceService.getSources();\r\n    }\r\n\r\n    if (options.sourceId) {\r\n      sources = sources.filter((source) => source.getId() === options.sourceId);\r\n    } else if (options.searchType) {\r\n      sources = sources.filter(\r\n        (source) => source.getType() === options.searchType\r\n      );\r\n    }\r\n\r\n    sources = sources.filter(sourceCanSearch);\r\n    return this.searchSources(sources, term, options);\r\n  }\r\n\r\n  /**\r\n   * Perform a research by lon/lat\r\n   * @param lonLat Any lon/lat coordinates\r\n   * @returns Researches\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions,\r\n    asPointerSummary: boolean = false\r\n  ) {\r\n    const reverseSourceFonction = asPointerSummary\r\n      ? sourceCanReverseSearchAsSummary\r\n      : sourceCanReverseSearch;\r\n    const sources = this.searchSourceService\r\n      .getEnabledSources()\r\n      .filter(reverseSourceFonction);\r\n    const reverseSearchCoordsFormat =\r\n      (this.storageService.get(\r\n        'reverseSearchCoordsFormatEnabled'\r\n      ) as boolean) || false;\r\n\r\n    return this.reverseSearchSources(\r\n      sources,\r\n      lonLat,\r\n      options || {},\r\n      reverseSearchCoordsFormat\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a text research out of all given search sources\r\n   * @param sources Search sources that implement TextSearch\r\n   * @param term Search term\r\n   * @returns Observable of Researches\r\n   */\r\n  private searchSources(\r\n    sources: SearchSource[],\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): Research[] {\r\n    return sources.map((source: SearchSource) => {\r\n      return {\r\n        request: (source as any as TextSearch).search(term, options),\r\n        reverse: false,\r\n        source\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a reverse research out of all given search sources\r\n   * @param sources Search sources that implement ReverseSearch\r\n   * @param lonLat Any lon/lat coordinates\r\n   * @returns Observable of Researches\r\n   */\r\n  private reverseSearchSources(\r\n    sources: SearchSource[],\r\n    lonLat: [number, number],\r\n    options: ReverseSearchOptions,\r\n    reverseSearchCoordsFormat: boolean\r\n  ): Research[] {\r\n    return sources.map((source: SearchSource) => {\r\n      return {\r\n        request: (source as any as ReverseSearch).reverseSearch(\r\n          lonLat,\r\n          options,\r\n          reverseSearchCoordsFormat\r\n        ),\r\n        reverse: true,\r\n        source\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validate that a search term is valid\r\n   * @param term Search term\r\n   * @returns True if the search term is valid\r\n   */\r\n  private termIsValid(term: string): boolean {\r\n    return typeof term === 'string' && term !== '';\r\n  }\r\n}\r\n","import { SearchSource } from './sources/source';\nimport { SearchSourceService } from './search-source.service';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\r\nimport {\r\n  HttpClient,\r\n  HttpParams,\r\n  HttpParameterCodec\r\n} from '@angular/common/http';\r\n\r\nimport { Observable, of, BehaviorSubject } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\r\n\r\nimport pointOnFeature from '@turf/point-on-feature';\r\n\r\nimport { FEATURE, Feature } from '../../../feature';\r\nimport { GoogleLinks } from './../../../utils/googleLinks';\r\n\r\nimport { SearchResult, TextSearch, ReverseSearch } from '../search.interfaces';\r\nimport { SearchSource } from './source';\r\nimport {\r\n  SearchSourceOptions,\r\n  TextSearchOptions,\r\n  ReverseSearchOptions,\r\n  SearchSourceSettings\r\n} from './source.interfaces';\r\nimport {\r\n  IChercheData,\r\n  IChercheResponse,\r\n  IChercheReverseData,\r\n  IChercheReverseResponse\r\n} from './icherche.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\n@Injectable()\r\nexport class IChercheSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\r\n    return result;\r\n  }\r\n}\r\n\r\n// Fix the \"+\" is replaced with space \" \" in a query string\r\n// https://github.com/angular/angular/issues/11058\r\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\r\n  encodeKey(key: string): string {\r\n    return encodeURIComponent(key);\r\n  }\r\n\r\n  encodeValue(value: string): string {\r\n    return encodeURIComponent(value);\r\n  }\r\n\r\n  decodeKey(key: string): string {\r\n    return decodeURIComponent(key);\r\n  }\r\n\r\n  decodeValue(value: string): string {\r\n    return decodeURIComponent(value);\r\n  }\r\n}\r\n\r\n/**\r\n * ICherche search source\r\n */\r\n@Injectable()\r\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'icherche';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  private hashtagsLieuxToKeep = [];\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    @Inject(IChercheSearchResultFormatter)\r\n    private formatter: IChercheSearchResultFormatter,\r\n    injector: Injector\r\n  ) {\r\n    super(options, storageService);\r\n\r\n    const authService = injector.get(AuthService);\r\n    if (this.settings.length) {\r\n      if (!authService) {\r\n        this.getAllowedTypes();\r\n      } else {\r\n        authService.authenticate$.subscribe(() => {\r\n          this.getAllowedTypes();\r\n        });\r\n      }\r\n    }\r\n\r\n    this.languageService.language$.subscribe(() => {\r\n      this.title$.next(\r\n        this.languageService.translate.instant(this.options.title)\r\n      );\r\n    });\r\n  }\r\n\r\n  getId(): string {\r\n    return IChercheSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return IChercheSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const limit =\r\n      this.options.params && this.options.params.limit\r\n        ? Number(this.options.params.limit)\r\n        : undefined;\r\n    const ecmax =\r\n      this.options.params && this.options.params.ecmax\r\n        ? Number(this.options.params.ecmax)\r\n        : undefined;\r\n\r\n    const types = this.options.params?.type\r\n      ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\r\n      : [\r\n          'adresses',\r\n          'codes-postaux',\r\n          'routes',\r\n          'intersections',\r\n          'municipalites',\r\n          'mrc',\r\n          'regadmin',\r\n          'lieux'\r\n        ];\r\n\r\n    const showAdvancedParams = this.options.showAdvancedSettings ?? true;\r\n\r\n    return {\r\n      title: 'igo.geo.search.icherche.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.type.address',\r\n              value: 'adresses',\r\n              enabled: types.indexOf('adresses') !== -1,\r\n              hashtags: ['adresse']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.oldAddress',\r\n              value: 'anciennes-adresses',\r\n              enabled: types.indexOf('anciennes-adresses') !== -1,\r\n              hashtags: ['anciennes-adresses']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.oldCity',\r\n              value: 'anciennes-municipalites',\r\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\r\n              hashtags: ['anciennes-municipalites']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cn',\r\n              value: 'bornes-cn',\r\n              enabled: types.indexOf('bornes-cn') !== -1,\r\n              hashtags: ['borne', 'bornes', 'cn']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.sumi',\r\n              value: 'bornes-sumi',\r\n              enabled: types.indexOf('bornes-sumi') !== -1,\r\n              hashtags: ['borne', 'bornes', 'sumi']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cadastre',\r\n              value: 'cadastre',\r\n              enabled: types.indexOf('cadastre') !== -1,\r\n              hashtags: ['cadastre']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.postalCode',\r\n              value: 'codes-postaux',\r\n              enabled: types.indexOf('codes-postaux') !== -1,\r\n              hashtags: ['code-postal']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.entreprise',\r\n              value: 'entreprises',\r\n              enabled: types.indexOf('entreprises') !== -1,\r\n              available: false,\r\n              hashtags: ['entreprise']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cycleStop',\r\n              value: 'haltes_cyclables',\r\n              enabled: types.indexOf('haltes_cyclables') !== -1,\r\n              hashtags: ['haltevelo', 'haltes_cyclables']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.restArea',\r\n              value: 'haltes_routieres',\r\n              enabled: types.indexOf('haltes_routieres') !== -1,\r\n              hashtags: ['halteroute', 'haltes_routieres']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.hq',\r\n              value: 'hq',\r\n              enabled: types.indexOf('hq') !== -1,\r\n              hashtags: ['hq']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.intersection',\r\n              value: 'intersections',\r\n              enabled: types.indexOf('intersections') !== -1,\r\n              hashtags: ['intersection', '+']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.place',\r\n              value: 'lieux',\r\n              enabled: types.indexOf('lieux') !== -1,\r\n              hashtags: ['lieu']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.mrc',\r\n              value: 'mrc',\r\n              enabled: types.indexOf('mrc') !== -1,\r\n              hashtags: ['mrc']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.city',\r\n              value: 'municipalites',\r\n              enabled: types.indexOf('municipalites') !== -1,\r\n              hashtags: ['municipalit', 'mun']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.regadmin',\r\n              value: 'regadmin',\r\n              enabled: types.indexOf('regadmin') !== -1,\r\n              hashtags: ['rgion-administrative', 'regadmin']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.gcc',\r\n              value: 'bornes-gcc',\r\n              enabled: types.indexOf('bornes-gcc') !== -1,\r\n              hashtags: ['borne', 'bornes', 'repre', 'gcc', 'ccg']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.km',\r\n              value: 'bornes-km',\r\n              enabled: types.indexOf('bornes-km') !== -1,\r\n              hashtags: ['borne', 'bornes', 'repre', 'km']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.road',\r\n              value: 'routes',\r\n              enabled: types.indexOf('routes') !== -1,\r\n              hashtags: ['route']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.exit',\r\n              value: 'sorties-autoroute',\r\n              enabled: types.indexOf('sorties-autoroute') !== -1,\r\n              hashtags: ['sortie', 'sorties', 'exit']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cultpatri',\r\n              value: 'culture',\r\n              enabled: types.indexOf('culture') !== -1,\r\n              hashtags: ['grille', 'culture']\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '1',\r\n              value: 1,\r\n              enabled: limit === 1\r\n            },\r\n            {\r\n              title: '5',\r\n              value: 5,\r\n              enabled: limit === 5 || !limit\r\n            },\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: limit === 10\r\n            },\r\n            {\r\n              title: '25',\r\n              value: 25,\r\n              enabled: limit === 25\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: limit === 50\r\n            }\r\n          ]\r\n        },\r\n        showAdvancedParams && {\r\n          type: 'radiobutton',\r\n          title: 'ecmax',\r\n          name: 'ecmax',\r\n          values: [\r\n            {\r\n              title: '10 %',\r\n              value: 10,\r\n              enabled: ecmax === 10\r\n            },\r\n            {\r\n              title: '30 %',\r\n              value: 30,\r\n              enabled: ecmax === 30 || !ecmax\r\n            },\r\n            {\r\n              title: '50 %',\r\n              value: 50,\r\n              enabled: ecmax === 50\r\n            },\r\n            {\r\n              title: '75 %',\r\n              value: 75,\r\n              enabled: ecmax === 75\r\n            },\r\n            {\r\n              title: '100 %',\r\n              value: 100,\r\n              enabled: ecmax === 100\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'restrictExtent',\r\n          name: 'loc',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.restrictExtent.map',\r\n              value: 'true',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\r\n              value: 'false',\r\n              enabled: true\r\n            }\r\n          ]\r\n        }\r\n      ].filter(Boolean) as SearchSourceSettings[]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(term, options || {});\r\n    if (!params.get('type').length) {\r\n      return of([]);\r\n    }\r\n    this.options.params.page = params.get('page') || '1';\r\n\r\n    return this.getSearch(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getSearch(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\r\n      map((response: IChercheResponse) => this.extractResults(response, term)),\r\n      catchError((err) => {\r\n        err.error.toDisplay = true;\r\n        err.error.title = this.languageService.translate.instant(\r\n          this.getDefaultOptions().title\r\n        );\r\n        throw err;\r\n      })\r\n    );\r\n  }\r\n  private getAllowedTypes() {\r\n    return this.http\r\n      .get(`${this.searchUrl}/types`)\r\n      .subscribe((types: string[]) => {\r\n        const typeSetting = this.settings.find((s) => s.name === 'type');\r\n        typeSetting.values.forEach((v) => {\r\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\r\n          const typesMatched = types.filter((value) => regex.test(value));\r\n          v.available = typesMatched.length > 0;\r\n          if (v.value === 'lieux') {\r\n            this.hashtagsLieuxToKeep = [\r\n              ...(new Set(\r\n                typesMatched\r\n                  .map((t) => t.split('.'))\r\n                  .reduce((a, b) => a.concat(b))\r\n                  .filter((t) => t !== 'lieux')\r\n              ) as any)\r\n            ];\r\n          }\r\n        });\r\n        this.setParamFromSetting(typeSetting, false);\r\n      });\r\n  }\r\n\r\n  private computeRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    const queryParams: any = Object.assign(\r\n      {\r\n        geometry: true,\r\n        bbox: true,\r\n        icon: true,\r\n        type: 'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\r\n      },\r\n      this.params,\r\n      this.computeOptionsParam(term, options || {}).params,\r\n      {\r\n        q: this.computeTerm(term),\r\n        page: options.page\r\n      }\r\n    );\r\n\r\n    if (queryParams.loc === 'true') {\r\n      const [xMin, yMin, xMax, yMax] = options.extent;\r\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\r\n    } else if (queryParams.loc === 'false') {\r\n      delete queryParams.loc;\r\n    }\r\n\r\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\r\n      queryParams.type = 'lieux';\r\n    }\r\n\r\n    return new HttpParams({\r\n      fromObject: ObjectUtils.removeUndefined(queryParams),\r\n      encoder: new IgoHttpParameterCodec()\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: IChercheResponse,\r\n    term: string\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: IChercheData) => {\r\n      return this.formatter.formatResult(\r\n        this.dataToResult(data, term, response)\r\n      );\r\n    });\r\n  }\r\n\r\n  private dataToResult(\r\n    data: IChercheData,\r\n    term: string,\r\n    response?: IChercheResponse\r\n  ): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, properties.code].join('.');\r\n\r\n    const titleHtml = data.highlight.title || data.properties.nom;\r\n    const subtitleHtml = data.highlight.title2\r\n      ? ' <small> ' + data.highlight.title2 + '</small>'\r\n      : '';\r\n    const subtitleHtml2 = data.highlight.title3\r\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\r\n      : '';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        extent: data.bbox,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties.nom\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.nom,\r\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\r\n        icon: data.icon || 'map-marker',\r\n        score:\r\n          data.score || computeTermSimilarity(term.trim(), data.properties.nom),\r\n        nextPage:\r\n          response.features.length % +this.options.params.limit === 0 &&\r\n          +this.options.params.page < 10\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: IChercheData): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      IChercheSearchSource.propertiesBlacklist\r\n    );\r\n\r\n    if (!data.geometry) {\r\n      return Object.assign({ type: data.index }, properties);\r\n    }\r\n\r\n    const googleLinksProperties: {\r\n      GoogleMaps: string;\r\n      GoogleStreetView?: string;\r\n    } = {\r\n      GoogleMaps: ''\r\n    };\r\n\r\n    let googleMaps;\r\n    if (data.geometry.type === 'Point') {\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        data.geometry.coordinates[0],\r\n        data.geometry.coordinates[1]\r\n      );\r\n    } else {\r\n      const point = pointOnFeature(data.geometry);\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        point.geometry.coordinates[0],\r\n        point.geometry.coordinates[1]\r\n      );\r\n    }\r\n\r\n    let googleMapsNom;\r\n    if (data.index === 'routes') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom + ', ' + data.properties.municipalite\r\n      );\r\n    } else if (data.index === 'municipalites') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom + ', ' + 'ville'\r\n      );\r\n    } else if (data.index === 'mrc') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        'mrc+' + data.properties.nom\r\n      );\r\n    } else if (data.index === 'regadmin') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom + ',+QC'\r\n      );\r\n    } else {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom || data.highlight.title\r\n      );\r\n    }\r\n\r\n    googleLinksProperties.GoogleMaps =\r\n      '<a href=' +\r\n      googleMaps +\r\n      ' target=\"_blank\">' +\r\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\r\n      '</a> <br /> <a href=' +\r\n      googleMapsNom +\r\n      ' target=\"_blank\">' +\r\n      this.languageService.translate.instant('igo.geo.searchByName') +\r\n      '</a>';\r\n\r\n    if (data.geometry.type === 'Point') {\r\n      googleLinksProperties.GoogleStreetView =\r\n        GoogleLinks.getGoogleStreetViewLink(\r\n          data.geometry.coordinates[0],\r\n          data.geometry.coordinates[1]\r\n        );\r\n    }\r\n\r\n    const routing: {\r\n      Route: string;\r\n    } = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n\r\n    return Object.assign(\r\n      { type: data.index },\r\n      properties,\r\n      googleLinksProperties,\r\n      routing\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove hashtag from query\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTerm(term: string): string {\r\n    // Keep hashtags for \"lieux\"\r\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\r\n    let keep = false;\r\n    keep = hashtags.some((hashtag) => {\r\n      const hashtagKey = hashtag.substring(1);\r\n      return this.hashtagsLieuxToKeep.some(\r\n        (h) =>\r\n          h\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '') ===\r\n          hashtagKey\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n      );\r\n    });\r\n\r\n    if (!keep) {\r\n      term = term.replace(/(#[A-Za-z]+)/g, '');\r\n    }\r\n\r\n    return term.replace(/[^\\w- !\\-\\+\\(\\)\\.\\/,'#]+/g, '');\r\n  }\r\n\r\n  /**\r\n   * Add hashtag to param if valid\r\n   * @param term Query with hashtag\r\n   * @param options TextSearchOptions\r\n   */\r\n  private computeOptionsParam(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): TextSearchOptions {\r\n    const hashtags = super.getHashtagsValid(term, 'type');\r\n    if (hashtags) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        type: hashtags.join(',')\r\n      });\r\n    }\r\n\r\n    return options;\r\n  }\r\n}\r\n\r\n/**\r\n * IChercheReverse search source\r\n */\r\n@Injectable()\r\nexport class IChercheReverseSearchSource\r\n  extends SearchSource\r\n  implements ReverseSearch\r\n{\r\n  static id = 'icherchereverse';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    injector: Injector\r\n  ) {\r\n    super(options, storageService);\r\n\r\n    this.languageService.language$.subscribe(() => {\r\n      this.title$.next(\r\n        this.languageService.translate.instant(this.options.title)\r\n      );\r\n    });\r\n\r\n    const authService = injector.get(AuthService);\r\n    if (this.settings.length) {\r\n      if (!authService) {\r\n        this.getAllowedTypes();\r\n      } else {\r\n        authService.authenticate$.subscribe(() => {\r\n          this.getAllowedTypes();\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  getId(): string {\r\n    return IChercheReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return IChercheReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const types =\r\n      this.options.params && this.options.params.type\r\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\r\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\r\n\r\n    return {\r\n      title: 'igo.geo.search.ichercheReverse.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.type.address',\r\n              value: 'adresses',\r\n              enabled: types.indexOf('adresses') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.road',\r\n              value: 'routes',\r\n              enabled: types.indexOf('routes') !== -1,\r\n              available: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.district',\r\n              value: 'arrondissements',\r\n              enabled: types.indexOf('arrondissements') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.city',\r\n              value: 'municipalites',\r\n              enabled: types.indexOf('municipalites') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.mrc',\r\n              value: 'mrc',\r\n              enabled: types.indexOf('mrc') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.regadmin',\r\n              value: 'regadmin',\r\n              enabled: types.indexOf('regadmin') !== -1\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'radius',\r\n          name: 'bufferInput',\r\n          values: [\r\n            {\r\n              title: '100 m',\r\n              value: 100,\r\n              enabled: !this.options.distance || this.options.distance === 100\r\n            },\r\n            {\r\n              title: '500 m',\r\n              value: 500,\r\n              enabled: this.options.distance === 500\r\n            },\r\n            {\r\n              title: '1 km',\r\n              value: 1000,\r\n              enabled: this.options.distance === 1000\r\n            },\r\n            {\r\n              title: '2 km',\r\n              value: 2000,\r\n              enabled: this.options.distance === 2000\r\n            },\r\n            {\r\n              title: '5 km',\r\n              value: 5000,\r\n              enabled: this.options.distance === 5000\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param distance Search raidus around lonLat\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(lonLat, options || {});\r\n    if (!params.get('type').length) {\r\n      return of([]);\r\n    }\r\n    return this.getReverseSearch(params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getReverseSearch(\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\r\n      map((response: IChercheReverseResponse) => {\r\n        return this.extractResults(response);\r\n      })\r\n    );\r\n  }\r\n\r\n  private getAllowedTypes() {\r\n    return this.http\r\n      .get(`${this.searchUrl}/types`)\r\n      .subscribe((types: string[]) => {\r\n        const typeSetting = this.settings.find((s) => s.name === 'type');\r\n        typeSetting.values.forEach((v) => {\r\n          v.available = types.indexOf(v.value as string) > -1;\r\n        });\r\n        this.setParamFromSetting(typeSetting, false);\r\n      });\r\n  }\r\n\r\n  private computeRequestParams(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): HttpParams {\r\n    if (options.distance || this.options.distance) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        bufferInput: options.distance || this.options.distance\r\n      });\r\n    }\r\n\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          loc: lonLat.join(','),\r\n          sort: 'distance',\r\n          geometry: true,\r\n          icon: true\r\n        },\r\n        options.params || {},\r\n        this.params\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: IChercheReverseResponse\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: IChercheReverseData) => {\r\n      return this.dataToResult(data);\r\n    });\r\n  }\r\n\r\n  private getSubtitle(data: IChercheReverseData) {\r\n    if (!this.settings.length) {\r\n      return '';\r\n    }\r\n    let subtitle = '';\r\n    switch (data.properties.type) {\r\n      case 'arrondissements':\r\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\r\n        break;\r\n      default:\r\n        const typeSetting = this.settings.find((s) => s.name === 'type');\r\n        const type = typeSetting.values.find(\r\n          (t) => t.value === data.properties.type\r\n        );\r\n        if (type) {\r\n          subtitle = this.languageService.translate.instant(type.title);\r\n        }\r\n    }\r\n    return subtitle;\r\n  }\r\n\r\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const extent = this.computeExtent(data);\r\n    const id = [this.getId(), properties.type, properties.code].join('.');\r\n\r\n    const titleHtml = data.properties.nom;\r\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties.nom\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.nom,\r\n        titleHtml: titleHtml + subtitleHtml,\r\n        icon: data.icon || 'map-marker',\r\n        pointerSummaryTitle: this.getSubtitle(data) + ': ' + data.properties.nom\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      IChercheReverseSearchSource.propertiesBlacklist\r\n    );\r\n\r\n    const routing: {\r\n      Route: string;\r\n    } = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n\r\n    return Object.assign(properties, routing);\r\n  }\r\n\r\n  private computeExtent(\r\n    data: IChercheReverseData\r\n  ): [number, number, number, number] | undefined {\r\n    return data.bbox\r\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\r\n      : undefined;\r\n  }\r\n}\r\n","import { Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  IChercheSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheReverseSearchSource\n} from './icherche';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter() {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\nimport * as olproj from 'ol/proj';\r\nimport { fromCircle } from 'ol/geom/Polygon';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport * as olformat from 'ol/format';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\n\r\nimport { SearchResult, ReverseSearch } from '../search.interfaces';\r\nimport { SearchSource } from './source';\r\nimport { SearchSourceOptions, ReverseSearchOptions } from './source.interfaces';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { GoogleLinks } from '../../../utils/googleLinks';\r\nimport { Projection } from '../../../map/shared/projection.interfaces';\r\nimport {\r\n  lonLatConversion,\r\n  roundCoordTo,\r\n  convertDDToDMS\r\n} from '../../../map/shared/map.utils';\r\nimport { OsmLinks } from '../../../utils';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\n@Injectable()\r\nexport class CoordinatesSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\r\n    return result;\r\n  }\r\n}\r\n/**\r\n * CoordinatesReverse search source\r\n */\r\n@Injectable()\r\nexport class CoordinatesReverseSearchSource\r\n  extends SearchSource\r\n  implements ReverseSearch\r\n{\r\n  static id = 'coordinatesreverse';\r\n  static type = FEATURE;\r\n\r\n  private projections;\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    @Inject('options') options: SearchSourceOptions,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('projections') projections: Projection[]\r\n  ) {\r\n    super(options, storageService);\r\n    this.projections = projections;\r\n    this.languageService.language$.subscribe(() => {\r\n      this.title$.next(\r\n        this.languageService.translate.instant(this.options.title)\r\n      );\r\n    });\r\n  }\r\n\r\n  getId(): string {\r\n    return CoordinatesReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return CoordinatesReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'igo.geo.search.coordinates.name',\r\n      order: 1,\r\n      showInSettings: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions,\r\n    reverseSearchCoordsFormatEnabled?: boolean\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return of([\r\n      this.dataToResult(lonLat, options, reverseSearchCoordsFormatEnabled)\r\n    ]);\r\n  }\r\n\r\n  private dataToResult(\r\n    data: [number, number],\r\n    options: ReverseSearchOptions,\r\n    reverseSearchCoordsFormatEnabled: boolean\r\n  ): SearchResult<Feature> {\r\n    const dataDMS = convertDDToDMS(data);\r\n    const convertedCoord = lonLatConversion(data, this.projections);\r\n    const coords = convertedCoord.reduce(\r\n      (obj, item) => ((obj[item.alias] = item.igo2CoordFormat), obj),\r\n      {}\r\n    );\r\n\r\n    const roundedCoordString = !reverseSearchCoordsFormatEnabled\r\n      ? roundCoordTo(data, 6).join(', ')\r\n      : roundCoordTo(data, 6).reverse().join(', ');\r\n\r\n    const roundedCoordStringDMS = !reverseSearchCoordsFormatEnabled\r\n      ? dataDMS.join(', ')\r\n      : dataDMS.reverse().join(', ');\r\n\r\n    let geometry: FeatureGeometry = {\r\n      type: 'Point',\r\n      coordinates: [data[0], data[1]]\r\n    };\r\n\r\n    const properties = {};\r\n    let subtitleHtml = '';\r\n    if (options.distance) {\r\n      const radiusKey = this.languageService.translate.instant(\r\n        'igo.geo.search.coordinates.radius'\r\n      );\r\n      properties[radiusKey] = options.distance;\r\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\r\n\r\n      // Create polygon\r\n      const center = olproj.transform(\r\n        [data[0], data[1]],\r\n        'EPSG:4326',\r\n        'EPSG:3857'\r\n      );\r\n      const circleGeometry = new OlCircle(center, options.distance);\r\n      const polygonGeometry = fromCircle(circleGeometry);\r\n      const writer = new olformat.GeoJSON();\r\n      geometry = JSON.parse(\r\n        writer.writeGeometry(\r\n          polygonGeometry.transform('EPSG:3857', 'EPSG:4326')\r\n        )\r\n      );\r\n    }\r\n\r\n    if (options.conf) {\r\n      const confKey = this.languageService.translate.instant(\r\n        'igo.geo.search.coordinates.conf'\r\n      );\r\n      properties[confKey] = options.conf;\r\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\r\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\r\n    }\r\n\r\n    const coordKey = !reverseSearchCoordsFormatEnabled\r\n      ? this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.coord'\r\n        )\r\n      : this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.reversedCoord'\r\n        );\r\n    properties[coordKey] = roundedCoordString;\r\n\r\n    const coordKeyDMS = !reverseSearchCoordsFormatEnabled\r\n      ? this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.coordDMS'\r\n        )\r\n      : this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.reversedCoordDMS'\r\n        );\r\n    properties[coordKeyDMS] = roundedCoordStringDMS;\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        extent: undefined,\r\n        properties: Object.assign(properties, coords, {\r\n          GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\r\n          GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\r\n            data[0],\r\n            data[1]\r\n          ),\r\n          OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\r\n          Route:\r\n            '<span class=\"routing\"> <u>' +\r\n            this.languageService.translate.instant('igo.geo.seeRouting') +\r\n            '</u> </span>'\r\n        }),\r\n        meta: {\r\n          id: data[0].toString() + ',' + data[1].toString(),\r\n          title: roundedCoordString\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id: data[0].toString() + ',' + data[1].toString(),\r\n        title: roundedCoordString,\r\n        titleHtml: roundedCoordString + subtitleHtml,\r\n        icon: 'map-marker',\r\n        score: 100 // every coord exists\r\n      }\r\n    };\r\n  }\r\n}\r\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\n\n/**\n * Coordinate search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the Coordinates search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the Coordinate search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\r\nimport { Subscription, combineLatest } from 'rxjs';\r\n\r\nimport { RouteService } from '@igo2/core';\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { LayerListComponent } from './layer-list.component';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { map, debounceTime } from 'rxjs/operators';\r\n\r\n@Directive({\r\n  selector: '[igoLayerListBinding]'\r\n})\r\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\r\n  private component: LayerListComponent;\r\n  private layersOrResolutionChange$$: Subscription;\r\n  layersVisibility$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: LayerListComponent,\r\n    private mapService: MapService,\r\n    @Optional() private route: RouteService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    // this.component.layers = [];\r\n    this.layersOrResolutionChange$$ = combineLatest([\r\n      this.mapService.getMap().layers$,\r\n      this.mapService.getMap().viewController.resolution$\r\n    ])\r\n      .pipe(debounceTime(10))\r\n      .subscribe((bunch: [Layer[], number]) => {\r\n        const shownLayers = bunch[0].filter((layer: Layer) => {\r\n          return layer.showInLayerList === true;\r\n        });\r\n        this.component.layers = shownLayers;\r\n        this.setLayersVisibilityStatus(\r\n          shownLayers,\r\n          this.component.excludeBaseLayers\r\n        );\r\n      });\r\n  }\r\n\r\n  private setLayersVisibilityStatus(\r\n    layers: Layer[],\r\n    excludeBaseLayers: boolean\r\n  ) {\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n    this.layersVisibility$$ = combineLatest(\r\n      layers\r\n        .filter((layer) => layer.baseLayer !== excludeBaseLayers)\r\n        .map((layer: Layer) => layer.visible$)\r\n    )\r\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\r\n      .subscribe(\r\n        (allLayersAreVisible: boolean) =>\r\n          (this.component.layersAreAllVisible = allLayersAreVisible)\r\n      );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layersOrResolutionChange$$.unsubscribe();\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n  }\r\n}\r\n","<button\r\n  *ngIf=\"options.trackFeature\"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\r\n  [color]=\"color\"\r\n  (click)=\"toggleTrackFeature()\"\r\n>\r\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\r\n</button>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { VectorLayer } from '../shared/layers';\r\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\r\n\r\n@Component({\r\n  selector: 'igo-track-feature-button',\r\n  templateUrl: './track-feature-button.component.html',\r\n  styleUrls: ['./track-feature-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TrackFeatureButtonComponent implements OnInit {\r\n  @Input() layer: VectorLayer;\r\n\r\n  @Input() trackFeature = false;\r\n\r\n  get options(): VectorLayerOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.options;\r\n  }\r\n\r\n  public color: string = 'primary';\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.color = this.trackFeature ? 'primary' : 'basic';\r\n  }\r\n\r\n  toggleTrackFeature() {\r\n    if (this.trackFeature) {\r\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\r\n      this.color = 'basic';\r\n    } else {\r\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\r\n      this.color = 'primary';\r\n    }\r\n    this.trackFeature = !this.trackFeature;\r\n  }\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { customCacheHasher, ObjectUtils } from '@igo2/utils';\r\n\r\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\r\nimport { LAYER } from '../../../layer';\r\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\r\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\r\n\r\nimport { SearchResult, TextSearch } from '../search.interfaces';\r\nimport { SearchSource } from './source';\r\nimport { TextSearchOptions } from './source.interfaces';\r\nimport {\r\n  ILayerSearchSourceOptions,\r\n  ILayerData,\r\n  ILayerItemResponse,\r\n  ILayerServiceResponse,\r\n  ILayerDataSource\r\n} from './ilayer.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\n@Injectable()\r\nexport class ILayerSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(data: ILayerData): ILayerData {\r\n    const allowedKey = [\r\n      'title',\r\n      'abstract',\r\n      'groupTitle',\r\n      'metadataUrl',\r\n      'downloadUrl',\r\n      'urlInfo',\r\n      'name'\r\n    ];\r\n\r\n    const property = Object.entries(data.properties)\r\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\r\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\r\n        const [key, value] = entries;\r\n        let newKey;\r\n        try {\r\n          newKey = this.languageService.translate.instant(\r\n            'igo.geo.search.ilayer.properties.' + key\r\n          );\r\n        } catch (e) {\r\n          newKey = key;\r\n        }\r\n        out[newKey] = value ? value : '';\r\n        return out;\r\n      }, {});\r\n\r\n    const dataR = Object.assign({}, data);\r\n    dataR.properties = property as ILayerDataSource;\r\n\r\n    return dataR;\r\n  }\r\n}\r\n\r\n/**\r\n * ILayer search source\r\n */\r\n@Injectable()\r\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'ilayer';\r\n  static type = LAYER;\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: ILayerSearchSourceOptions,\r\n    @Inject(ILayerSearchResultFormatter)\r\n    private formatter: ILayerSearchResultFormatter\r\n  ) {\r\n    super(options, storageService);\r\n    this.languageService.language$.subscribe(() => {\r\n      this.title$.next(\r\n        this.languageService.translate.instant(this.options.title)\r\n      );\r\n    });\r\n  }\r\n\r\n  getId(): string {\r\n    return ILayerSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return ILayerSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\r\n    const limit =\r\n      this.options.params && this.options.params.limit\r\n        ? Number(this.options.params.limit)\r\n        : undefined;\r\n    const ecmax =\r\n      this.options.params && this.options.params.ecmax\r\n        ? Number(this.options.params.ecmax)\r\n        : undefined;\r\n    return {\r\n      title: 'igo.geo.search.ilayer.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.ilayer.type.layer',\r\n              value: 'layer',\r\n              enabled: true,\r\n              hashtags: ['layer', 'layers', 'couche', 'couches']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.ilayer.type.groupLayer',\r\n              value: 'group',\r\n              enabled: false,\r\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '1',\r\n              value: 1,\r\n              enabled: limit === 1\r\n            },\r\n            {\r\n              title: '5',\r\n              value: 5,\r\n              enabled: limit === 5 || !limit\r\n            },\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: limit === 10\r\n            },\r\n            {\r\n              title: '25',\r\n              value: 25,\r\n              enabled: limit === 25\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: limit === 50\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'ecmax',\r\n          name: 'ecmax',\r\n          values: [\r\n            {\r\n              title: '10 %',\r\n              value: 10,\r\n              enabled: ecmax === 10\r\n            },\r\n            {\r\n              title: '30 %',\r\n              value: 30,\r\n              enabled: ecmax === 30\r\n            },\r\n            {\r\n              title: '50 %',\r\n              value: 50,\r\n              enabled: ecmax === 50 || !ecmax\r\n            },\r\n            {\r\n              title: '75 %',\r\n              value: 75,\r\n              enabled: ecmax === 75\r\n            },\r\n            {\r\n              title: '100 %',\r\n              value: 100,\r\n              enabled: ecmax === 100\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a layer by name or keyword\r\n   * @param term Layer name or keyword\r\n   * @returns Observable of <SearchResult<LayerOptions>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('q') || !params.get('type')) {\r\n      return of([]);\r\n    }\r\n    this.options.params.page = params.get('page') || '1';\r\n    return this.getSearch(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getSearch(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\r\n    return this.http\r\n      .get(this.searchUrl, { params })\r\n      .pipe(\r\n        map((response: ILayerServiceResponse) =>\r\n          this.extractResults(response, term)\r\n        )\r\n      );\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: ObjectUtils.removeUndefined(\r\n        Object.assign(\r\n          {\r\n            q: this.computeTerm(term)\r\n          },\r\n          this.params,\r\n          this.computeOptionsParam(term, options || {}).params,\r\n          {\r\n            page: options.page\r\n          }\r\n        )\r\n      )\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove hashtag from query\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTerm(term: string): string {\r\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\w- !\\-\\(\\),'#]+/g, '');\r\n  }\r\n\r\n  /**\r\n   * Add hashtag to param if valid\r\n   * @param term Query with hashtag\r\n   * @param options TextSearchOptions\r\n   */\r\n  private computeOptionsParam(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): TextSearchOptions {\r\n    const hashtags = super.getHashtagsValid(term, 'type');\r\n    if (hashtags) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        type: hashtags.join(',')\r\n      });\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  private extractResults(\r\n    response: ILayerServiceResponse,\r\n    term: string\r\n  ): SearchResult<ILayerItemResponse>[] {\r\n    return response.items.map((data: ILayerData) =>\r\n      this.dataToResult(data, term, response)\r\n    );\r\n  }\r\n\r\n  private dataToResult(\r\n    data: ILayerData,\r\n    term: string,\r\n    response?: ILayerServiceResponse\r\n  ): SearchResult<ILayerItemResponse> {\r\n    const layerOptions = this.computeLayerOptions(data);\r\n\r\n    const titleHtml = data.highlight.title || data.properties.title;\r\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\r\n    const subtitleHtml = groupTitle\r\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\r\n      : '';\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: LAYER,\r\n        id: [this.getId(), data.properties.id].join('.'),\r\n        title: data.properties.title,\r\n        titleHtml: titleHtml + subtitleHtml,\r\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\r\n        score:\r\n          data.score ||\r\n          computeTermSimilarity(term.trim(), data.properties.name),\r\n        nextPage:\r\n          response.items.length % +this.options.params.limit === 0 &&\r\n          +this.options.params.page < 10\r\n      },\r\n      data: layerOptions\r\n    };\r\n  }\r\n\r\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\r\n    const url = data.properties.url;\r\n    const queryParams: QueryableDataSourceOptions =\r\n      this.extractQueryParamsFromSourceUrl(url);\r\n    return ObjectUtils.removeUndefined({\r\n      sourceOptions: {\r\n        id: data.properties.id,\r\n        type: data.properties.format,\r\n        url,\r\n        queryFormat: queryParams.queryFormat,\r\n        queryHtmlTarget: queryParams.queryHtmlTarget,\r\n        params:\r\n          data.properties.format === 'wms'\r\n            ? { LAYERS: data.properties.name }\r\n            : undefined,\r\n        layer:\r\n          data.properties.format === 'wms' ? undefined : data.properties.name,\r\n        optionsFromCapabilities: true,\r\n        crossOrigin: 'anonymous'\r\n      },\r\n      title: data.properties.title,\r\n      maxResolution: getResolutionFromScale(\r\n        Number(data.properties.maxScaleDenom)\r\n      ),\r\n      minResolution: getResolutionFromScale(\r\n        Number(data.properties.minScaleDenom)\r\n      ),\r\n      metadata: {\r\n        url: data.properties.metadataUrl,\r\n        extern: data.properties.metadataUrl ? true : undefined,\r\n        abstract: data.properties.abstract || undefined\r\n      },\r\n      properties: this.formatter.formatResult(data).properties\r\n    });\r\n  }\r\n\r\n  private extractQueryParamsFromSourceUrl(url: string): {\r\n    queryFormat: QueryFormat;\r\n    queryHtmlTarget: QueryHtmlTarget;\r\n  } {\r\n    let queryFormat;\r\n    let queryHtmlTarget;\r\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\r\n    if (formatOpt) {\r\n      for (const key of Object.keys(formatOpt)) {\r\n        const value = formatOpt[key];\r\n        if (value === '*') {\r\n          queryFormat = QueryFormat[key.toUpperCase()];\r\n          break;\r\n        }\r\n\r\n        const urls = (value as any as { urls: string[] }).urls;\r\n        if (Array.isArray(urls)) {\r\n          urls.forEach((urlOpt) => {\r\n            if (url.indexOf(urlOpt) !== -1) {\r\n              queryFormat = QueryFormat[key.toUpperCase()];\r\n            }\r\n          });\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (\r\n        queryFormat === QueryFormat.HTML ||\r\n        queryFormat === QueryFormat.HTMLGML2\r\n      ) {\r\n        queryHtmlTarget = 'iframe';\r\n      }\r\n    }\r\n\r\n    return {\r\n      queryFormat,\r\n      queryHtmlTarget\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\r\n\r\n/**\r\n * ILayer search result formatter factory\r\n * @ignore\r\n */\r\nexport function ilayerSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new ILayerSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ILayer search result formatter\r\n */\r\nexport function provideILayerSearchResultFormatter() {\r\n  return {\r\n    provide: ILayerSearchResultFormatter,\r\n    useFactory: ilayerSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * ILayer search source factory\r\n * @ignore\r\n */\r\nexport function ilayerSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService,\r\n  formatter: ILayerSearchResultFormatter\r\n) {\r\n  return new ILayerSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\r\n    formatter\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ILayer search source\r\n */\r\nexport function provideILayerSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ilayerSearchSourceFactory,\r\n    multi: true,\r\n    deps: [\r\n      HttpClient,\r\n      LanguageService,\r\n      StorageService,\r\n      ConfigService,\r\n      ILayerSearchResultFormatter\r\n    ]\r\n  };\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatTabsModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSelectorComponent],\n  declarations: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { SearchSettingsComponent } from './search-settings.component';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  declarations: [SearchSettingsComponent],\r\n  imports: [\r\n    CommonModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatCheckboxModule,\r\n    MatDividerModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [SearchSettingsComponent]\r\n})\r\nexport class IgoSearchSettingsModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\r\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\r\nimport { SearchBarComponent } from './search-bar.component';\r\nimport { SearchUrlParamDirective } from './search-url-param.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatDividerModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    IgoLanguageModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchSettingsModule\r\n  ],\r\n  exports: [SearchBarComponent],\r\n  declarations: [SearchBarComponent, SearchUrlParamDirective]\r\n})\r\nexport class IgoSearchBarModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\n\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoListModule,\r\n  IgoMatBadgeIconModule,\r\n  IgoStopPropagationModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\r\nimport { SearchResultsComponent } from './search-results.component';\r\nimport { SearchResultsItemComponent } from './search-results-item.component';\r\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\r\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoCollapsibleModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoMetadataModule,\r\n    IgoStopPropagationModule,\r\n    MatAutocompleteModule,\r\n    MatBadgeModule,\r\n    MatButtonModule,\r\n    MatDialogModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatInputModule,\r\n    MatListModule,\r\n    MatSelectModule,\r\n    MatTabsModule,\r\n    MatTooltipModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  exports: [SearchResultsComponent, SearchResultAddButtonComponent],\r\n  declarations: [\r\n    SearchResultsComponent,\r\n    SearchResultsItemComponent,\r\n    SearchResultAddButtonComponent,\r\n    SaveFeatureDialogComponent\r\n  ]\r\n})\r\nexport class IgoSearchResultsModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { SearchService } from './shared/search.service';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  declarations: [SearchPointerSummaryDirective]\n})\nexport class IgoSearchModule {\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\r\n\r\nimport { Layer } from '../../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../../map/shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter',\r\n  templateUrl: './ogc-filter.component.html',\r\n  styleUrls: ['./ogc-filter.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\r\n  @Input() layer: Layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Event emitted on complete\r\n   */\r\n  @Output() complete = new EventEmitter<void>();\r\n\r\n  /**\r\n   * Event emitted on cancel\r\n   */\r\n  @Output() cancel = new EventEmitter<void>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Implemented as part of OnUpdateInputs\r\n   */\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * On close, emit the cancel event\r\n   */\r\n  onClose() {\r\n    this.cancel.emit();\r\n  }\r\n}\r\n","<igo-ogc-filterable-item\r\n  igoListItem\r\n  [layer]=\"layer\"\r\n  [header]=\"false\"\r\n  [map]=\"map\"\r\n>\r\n</igo-ogc-filterable-item>\r\n","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoFilterModule } from '../../../filter/filter.module';\r\nimport { OgcFilterComponent } from './ogc-filter.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, MatButtonModule, IgoLanguageModule, IgoFilterModule],\r\n  exports: [OgcFilterComponent],\r\n  declarations: [OgcFilterComponent]\r\n})\r\nexport class IgoOgcFilterModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [WorkspaceSelectorDirective],\r\n  declarations: [WorkspaceSelectorDirective]\r\n})\r\nexport class IgoWorkspaceSelectorModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [WorkspaceUpdatorDirective],\r\n  declarations: [WorkspaceUpdatorDirective]\r\n})\r\nexport class IgoWorkspaceUpdatorModule {}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ConfirmationPopupComponent } from './confirmation-popup.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatButtonToggleModule\n  ],\n  exports: [ConfirmationPopupComponent],\n  declarations: [ConfirmationPopupComponent]\n})\nexport class IgoConfirmationPopupModule {}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { IgoWidgetModule } from '@igo2/common';\r\n\r\nimport { provideOgcFilterWidget } from './widgets/widgets';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\r\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\r\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\r\nimport { IgoConfirmationPopupModule } from './confirmation-popup/confirmation-popup.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoLanguageModule,\r\n    IgoWidgetModule,\r\n    IgoWorkspaceSelectorModule,\r\n    IgoWorkspaceUpdatorModule,\r\n    IgoOgcFilterModule,\r\n    MatDialogModule\r\n  ],\r\n  exports: [\r\n    IgoWorkspaceSelectorModule,\r\n    IgoWorkspaceUpdatorModule,\r\n    IgoOgcFilterModule,\r\n    IgoConfirmationPopupModule\r\n  ],\r\n  declarations: [],\r\n  providers: [provideOgcFilterWidget()]\r\n})\r\nexport class IgoGeoWorkspaceModule {}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpBackend, HttpClient } from '@angular/common/http';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { StyleListOptions } from './style-list.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StyleListService {\r\n  private styleList: object = {};\r\n  private httpClient: HttpClient;\r\n\r\n  constructor(handler: HttpBackend) {\r\n    this.httpClient = new HttpClient(handler);\r\n  }\r\n\r\n  /**\r\n   * Use to get the data found in styleList file\r\n   */\r\n  public getStyleList(key: string): any {\r\n    return ObjectUtils.resolve(this.styleList, key);\r\n  }\r\n\r\n  /**\r\n   * This method loads \"[path]\" to get all styleList's variables\r\n   */\r\n  public load(options: StyleListOptions) {\r\n    const baseStyleList = options.default || {};\r\n    if (!options.path) {\r\n      this.styleList = baseStyleList;\r\n      return true;\r\n    }\r\n\r\n    return new Promise((resolve, _reject) => {\r\n      this.httpClient\r\n        .get(options.path)\r\n        .pipe(\r\n          catchError((error: any): any => {\r\n            console.log(`StyleList file ${options.path} could not be read`);\r\n            resolve(true);\r\n            return throwError(error.error || 'Server error');\r\n          })\r\n        )\r\n        .subscribe((styleListResponse: object) => {\r\n          this.styleList = ObjectUtils.mergeDeep(\r\n            baseStyleList,\r\n            styleListResponse\r\n          );\r\n          resolve(true);\r\n        });\r\n    });\r\n  }\r\n}\r\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\r\n\r\nimport { StyleListService } from './style-list.service';\r\nimport { StyleListOptions } from './style-list.interface';\r\n\r\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>(\r\n  'styleListOptions'\r\n);\r\n\r\nexport function provideStyleListOptions(options: StyleListOptions) {\r\n  return {\r\n    provide: STYLELIST_OPTIONS,\r\n    useValue: options\r\n  };\r\n}\r\n\r\nexport function styleListFactory(\r\n  styleListService: StyleListService,\r\n  options: StyleListOptions\r\n) {\r\n  return () => styleListService.load(options);\r\n}\r\n\r\nexport function provideStyleListLoader() {\r\n  return {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: styleListFactory,\r\n    multi: true,\r\n    deps: [StyleListService, STYLELIST_OPTIONS]\r\n  };\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport {\r\n  provideStyleListOptions,\r\n  provideStyleListLoader\r\n} from './style-list.provider';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoStyleListModule {\r\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\r\n    return {\r\n      ngModule: IgoStyleListModule,\r\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\r\n    };\r\n  }\r\n}\r\n","export enum FontType {\r\n  Arial = 'Arial',\r\n  ArialBlack = 'Arial Black',\r\n  Verdana = 'Verdana',\r\n  Tahoma = 'Tahoma',\r\n  TrebuchetMS = 'Trebuchet MS',\r\n  Impact = 'Impact',\r\n  TimesNewRoman = 'Times New Roman',\r\n  Georgia = 'Georgia',\r\n  AmericanTypewriter = 'American Typewriter',\r\n  Courier = 'Courier',\r\n  LucidaConsole = 'Lucida Console',\r\n  BrushScriptMT = 'Brush Script MT',\r\n  ComicSansMS = 'Comic Sans MS'\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport * as OlStyle from 'ol/style';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport { ProjectionLike, transform } from 'ol/proj';\r\nimport { FontType } from '../shared/font.enum';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DrawStyleService {\r\n  private fillColor = 'rgba(255,255,255,0.4)';\r\n  private strokeColor = 'rgba(143,7,7,1)';\r\n  private strokeWidth: number = 1;\r\n  private labelsAreShown = true;\r\n  private icon: string;\r\n  private fontSize: string = '15';\r\n  private fontStyle: string = FontType.Arial.toString();\r\n  private offsetX: number = 0;\r\n  private offsetY: number = 0;\r\n\r\n  constructor() {}\r\n\r\n  getFillColor(): string {\r\n    return this.fillColor;\r\n  }\r\n\r\n  setFillColor(fillColor: string) {\r\n    this.fillColor = fillColor;\r\n  }\r\n\r\n  getStrokeColor(): string {\r\n    return this.strokeColor;\r\n  }\r\n\r\n  setStrokeColor(strokeColor: string) {\r\n    this.strokeColor = strokeColor;\r\n  }\r\n\r\n  getStrokeWidth(): number {\r\n    return this.strokeWidth;\r\n  }\r\n\r\n  getLabelsAreShown() {\r\n    return this.labelsAreShown;\r\n  }\r\n\r\n  toggleLabelsAreShown() {\r\n    this.labelsAreShown = !this.labelsAreShown;\r\n  }\r\n\r\n  setIcon(icon: string) {\r\n    this.icon = icon;\r\n  }\r\n\r\n  getIcon() {\r\n    return this.icon;\r\n  }\r\n\r\n  // To edit the label of drawing\r\n  getFontSize() {\r\n    return this.fontSize;\r\n  }\r\n\r\n  setFontSize(fontSize: string) {\r\n    this.fontSize = fontSize;\r\n  }\r\n\r\n  getFontStyle() {\r\n    return this.fontStyle;\r\n  }\r\n\r\n  setFontStyle(fontStyle: string) {\r\n    this.fontStyle = fontStyle;\r\n  }\r\n\r\n  getOffsetX(): number {\r\n    return this.offsetX;\r\n  }\r\n\r\n  setOffsetX(offsetX: number) {\r\n    this.offsetX = offsetX;\r\n  }\r\n\r\n  getOffsetY(): number {\r\n    return this.offsetY;\r\n  }\r\n\r\n  setOffsetY(offsetY: number) {\r\n    this.offsetY = offsetY;\r\n  }\r\n\r\n  createIndividualElementStyle(\r\n    feature,\r\n    resolution,\r\n    labelsAreShown: boolean,\r\n    fontSizeAndStyle: string,\r\n    fillColor: string,\r\n    strokeColor: string,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    proj: ProjectionLike,\r\n    icon?: string\r\n  ): OlStyle.Style {\r\n    let style;\r\n    let labelsAreOffset: boolean = false;\r\n    const geom = feature.getGeometry();\r\n\r\n    if (geom instanceof OlPoint) {\r\n      labelsAreOffset = !labelsAreOffset;\r\n    }\r\n    const textToShow = labelsAreShown ? feature.get('draw') : '';\r\n    feature.set('_mapTitle', textToShow);\r\n    const textIgoStyleObject = {\r\n      text: textToShow,\r\n      stroke: {\r\n        color: 'white',\r\n        width: 0.75\r\n      },\r\n      fill: { color: 'black' },\r\n      font: fontSizeAndStyle,\r\n      overflow: true,\r\n      offsetX: offsetX,\r\n      offsetY: offsetY\r\n    };\r\n\r\n    let igoStyleObject;\r\n\r\n    // if feature is a circle\r\n    if (feature.get('rad')) {\r\n      const coordinates = transform(\r\n        feature.getGeometry().flatCoordinates,\r\n        proj,\r\n        'EPSG:4326'\r\n      );\r\n      const radius =\r\n        feature.get('rad') /\r\n        Math.cos((Math.PI / 180) * coordinates[1]) /\r\n        resolution;\r\n      igoStyleObject = {\r\n        text: textIgoStyleObject,\r\n        circle: {\r\n          radius,\r\n          stroke: {\r\n            color: strokeColor ? strokeColor : this.strokeColor,\r\n            width: this.strokeWidth\r\n          },\r\n          fill: {\r\n            color: fillColor\r\n          }\r\n        }\r\n      };\r\n      feature.set('_style', igoStyleObject);\r\n\r\n      style = new OlStyle.Style({\r\n        text: new OlStyle.Text({\r\n          text: textToShow,\r\n          stroke: new OlStyle.Stroke({\r\n            color: 'white',\r\n            width: 0.75\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'black'\r\n          }),\r\n\r\n          font: fontSizeAndStyle,\r\n          overflow: true,\r\n          offsetX: offsetX,\r\n          offsetY: offsetY\r\n        }),\r\n\r\n        image: new OlStyle.Circle({\r\n          radius,\r\n          stroke: new OlStyle.Stroke({\r\n            color: strokeColor ? strokeColor : this.strokeColor,\r\n            width: this.strokeWidth\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: fillColor\r\n          })\r\n        })\r\n      });\r\n      return style;\r\n\r\n      // if feature is an icon\r\n    } else if (icon) {\r\n      this.offsetY = -26;\r\n      textIgoStyleObject.offsetY = this.offsetY;\r\n      const igoStyleObject = {\r\n        text: textIgoStyleObject,\r\n        stroke: {\r\n          color: strokeColor,\r\n          width: this.strokeWidth\r\n        },\r\n        fill: {\r\n          color: fillColor\r\n        },\r\n        icon: {\r\n          src: icon\r\n        }\r\n      };\r\n      feature.set('_style', igoStyleObject);\r\n\r\n      style = new OlStyle.Style({\r\n        text: new OlStyle.Text({\r\n          text: labelsAreShown ? feature.get('draw') : '',\r\n          stroke: new OlStyle.Stroke({\r\n            color: 'white',\r\n            width: 0.75\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'black'\r\n          }),\r\n          font: fontSizeAndStyle,\r\n          overflow: true,\r\n          offsetX: offsetX,\r\n          offsetY: offsetY\r\n        }),\r\n\r\n        stroke: new OlStyle.Stroke({\r\n          color: strokeColor,\r\n          width: this.strokeWidth\r\n        }),\r\n\r\n        fill: new OlStyle.Fill({\r\n          color: fillColor\r\n        }),\r\n\r\n        image: new OlStyle.Icon({\r\n          src: icon\r\n        })\r\n      });\r\n      return style;\r\n\r\n      // if feature is a point, a linestring or a polygon\r\n    } else {\r\n      this.offsetY = labelsAreOffset ? -15 : 0;\r\n\r\n      textIgoStyleObject.offsetY = this.offsetY;\r\n      const igoStyleObject = {\r\n        text: textIgoStyleObject,\r\n        stroke: {\r\n          color: strokeColor,\r\n          width: this.strokeWidth\r\n        },\r\n        fill: {\r\n          color: fillColor\r\n        },\r\n        circle: {\r\n          radius: 5,\r\n          stroke: {\r\n            color: strokeColor,\r\n            width: this.strokeWidth\r\n          },\r\n          fill: {\r\n            color: fillColor\r\n          }\r\n        }\r\n      };\r\n      feature.set('_style', igoStyleObject);\r\n\r\n      style = new OlStyle.Style({\r\n        text: new OlStyle.Text({\r\n          text: labelsAreShown ? feature.get('draw') : '',\r\n          stroke: new OlStyle.Stroke({\r\n            color: 'white',\r\n            width: 0.75\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'black'\r\n          }),\r\n          font: fontSizeAndStyle,\r\n          overflow: true,\r\n\r\n          offsetX: offsetX,\r\n          offsetY: offsetY\r\n        }),\r\n\r\n        stroke: new OlStyle.Stroke({\r\n          color: strokeColor,\r\n          width: this.strokeWidth\r\n        }),\r\n\r\n        fill: new OlStyle.Fill({\r\n          color: fillColor\r\n        }),\r\n\r\n        image: new OlStyle.Circle({\r\n          radius: 5,\r\n          stroke: new OlStyle.Stroke({\r\n            color: strokeColor,\r\n            width: this.strokeWidth\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: fillColor\r\n          })\r\n        })\r\n      });\r\n      return style;\r\n    }\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoStyleListModule } from './style-list/style-list.module';\r\nimport { StyleModalDrawingComponent } from './style-modal/drawing/style-modal-drawing.component';\r\nimport { StyleModalLayerComponent } from './style-modal/layer/style-modal-layer.component';\r\nimport { StyleModalLayerButtonComponent } from './style-modal/layer-button/style-modal-layer-button.component';\r\nimport { DrawStyleService } from './style-service/draw-style.service';\r\nimport { StyleService } from './style-service/style.service';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { ColorPickerFormFieldModule } from '@igo2/common';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IgoLanguageModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatDialogModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    ReactiveFormsModule,\r\n    ColorPickerFormFieldModule,\r\n    IgoStyleListModule.forRoot()\r\n  ],\r\n  exports: [\r\n    IgoStyleListModule,\r\n    StyleModalDrawingComponent,\r\n    StyleModalLayerComponent,\r\n    StyleModalLayerButtonComponent\r\n  ],\r\n  declarations: [\r\n    StyleModalDrawingComponent,\r\n    StyleModalLayerComponent,\r\n    StyleModalLayerButtonComponent\r\n  ]\r\n})\r\nexport class IgoStyleModule {\r\n  static forRoot(): ModuleWithProviders<IgoStyleModule> {\r\n    return {\r\n      ngModule: IgoStyleModule,\r\n      providers: [StyleService, DrawStyleService]\r\n    };\r\n  }\r\n}\r\n","import {\r\n  OnInit,\r\n  Directive,\r\n  Self,\r\n  HostListener,\r\n  ElementRef,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { FeatureDetailsComponent } from './feature-details.component';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Directive({\r\n  // This directive allow to view the route between the user coordinates and the feature\r\n  selector: '[igoFeatureDetailsDirective]'\r\n})\r\nexport class FeatureDetailsDirective implements OnInit {\r\n  private component: FeatureDetailsComponent;\r\n\r\n  get feature() {\r\n    return this.component.feature;\r\n  }\r\n  feature$ = new BehaviorSubject(undefined);\r\n\r\n  @Output() routingEvent = new EventEmitter<void>();\r\n\r\n  @HostListener('selectFeature')\r\n  setFeature() {\r\n    this.feature$.next(this.feature);\r\n  }\r\n\r\n  constructor(\r\n    @Self() component: FeatureDetailsComponent,\r\n    private el: ElementRef\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.feature$.subscribe(() => {\r\n      if (this.feature.geometry) {\r\n        this.bindClicking();\r\n      }\r\n    });\r\n  }\r\n\r\n  bindClicking() {\r\n    setTimeout(() => {\r\n      const routeElement = this.el.nativeElement.querySelector('span.routing');\r\n      if (routeElement) {\r\n        routeElement.addEventListener('click', () => {\r\n          this.routingEvent.emit();\r\n        });\r\n      }\r\n    }, 1);\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { OverlayDirective } from './shared/overlay.directive';\n\n@NgModule({\n  imports: [],\n  exports: [OverlayDirective],\n  declarations: [OverlayDirective]\n})\nexport class IgoOverlayModule {\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\n    return {\n      ngModule: IgoOverlayModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport olProjection from 'ol/proj/Projection';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { MessageService } from '@igo2/core';\r\n\r\nimport { Layer } from '../../layer/shared';\r\nimport {\r\n  OgcFilterWriter,\r\n  OgcFilterableDataSourceOptions\r\n} from '../../filter/shared';\r\n\r\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DownloadService {\r\n  constructor(private messageService: MessageService) {}\r\n\r\n  open(layer: Layer) {\r\n    this.messageService.success(\r\n      'igo.geo.download.start',\r\n      'igo.geo.download.title'\r\n    );\r\n\r\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\r\n    if (Object.keys(DSOptions.download).length > 0) {\r\n      if (\r\n        DSOptions.download.dynamicUrl &&\r\n        DSOptions.download.url === undefined\r\n      ) {\r\n        let wfsOptions;\r\n        let currentProj = new olProjection({ code: layer.map.projection });\r\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\r\n        if (paramsWFS && Object.keys(paramsWFS).length > 0) {\r\n          currentProj = paramsWFS.srsName\r\n            ? new olProjection({ code: paramsWFS.srsName })\r\n            : currentProj;\r\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\r\n        } else {\r\n          wfsOptions = (layer.dataSource.options as any).params;\r\n        }\r\n\r\n        const currentExtent = olproj.transformExtent(\r\n          layer.map.viewController.getExtent(),\r\n          new olProjection({ code: layer.map.projection }),\r\n          currentProj\r\n        );\r\n        const outputFormatDownload =\r\n          wfsOptions.outputFormatDownload === undefined\r\n            ? wfsOptions.outputFormat === undefined\r\n              ? ''\r\n              : 'outputformat=' + wfsOptions.outputFormat\r\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\r\n\r\n        const baseurl = DSOptions.download.dynamicUrl\r\n          .replace(/&?outputformat=[^&]*/gi, '')\r\n          .replace(/&?filter=[^&]*/gi, '')\r\n          .replace(/&?bbox=[^&]*/gi, '');\r\n\r\n        const ogcFilters = (\r\n          layer.dataSource.options as OgcFilterableDataSourceOptions\r\n        ).ogcFilters;\r\n\r\n        let filterQueryString;\r\n        filterQueryString = new OgcFilterWriter().handleOgcFiltersAppliedValue(\r\n          layer.dataSource.options,\r\n          ogcFilters.geometryName,\r\n          currentExtent as [number, number, number, number],\r\n          currentProj\r\n        );\r\n        if (!filterQueryString) {\r\n          // Prevent getting all the features for empty filter\r\n          filterQueryString = new OgcFilterWriter().buildFilter(\r\n            undefined,\r\n            currentExtent as [number, number, number, number],\r\n            currentProj,\r\n            ogcFilters.geometryName\r\n          );\r\n        } else {\r\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\r\n        }\r\n        window.open(\r\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\r\n          '_blank'\r\n        );\r\n      } else if (DSOptions.download) {\r\n        window.open(DSOptions.download.url, '_blank');\r\n      }\r\n    }\r\n  }\r\n}\r\n","<button\r\n  *ngIf=\"\r\n    options &&\r\n    options.download &&\r\n    (options.download['dynamicUrl'] || options.download['url'])\r\n  \"\r\n  mat-icon-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\r\n  [color]=\"color\"\r\n  (click)=\"openDownload(layer)\"\r\n>\r\n  <mat-icon svgIcon=\"download\"></mat-icon>\r\n</button>\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","export enum GeometryType {\r\n  Point = 'Point',\r\n  LineString = 'LineString',\r\n  Polygon = 'Polygon',\r\n  Circle = 'Circle'\r\n}\r\n\r\nexport enum LabelType {\r\n  Coordinates = 'Coordinates',\r\n  Length = 'Length',\r\n  Area = 'Area',\r\n  Predefined = 'Predefined',\r\n  Custom = 'Custom'\r\n}\r\n\r\nexport enum CoordinatesUnit {\r\n  DecimalDegree = 'DD',\r\n  DegreesMinutesSeconds = 'DMS'\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DrawIconService {\r\n  protected icons: Array<string>;\r\n\r\n  constructor(protected config: ConfigService) {\r\n    this.getIconsList();\r\n  }\r\n\r\n  getIcons() {\r\n    return this.icons;\r\n  }\r\n\r\n  getPath(): any {\r\n    return this.config.getConfig('drawingTool.icons') || [];\r\n  }\r\n\r\n  getIconsList() {\r\n    this.icons = this.getPath();\r\n  }\r\n}\r\n","import * as Olstyle from 'ol/style';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport {\r\n  updateOlGeometryMidpoints,\r\n  updateOlGeometryCenter\r\n} from '../../measure/shared/measure.utils';\r\nimport { CoordinatesUnit } from './draw.enum';\r\nimport { convertDDToDMS, roundCoordToString } from '../../map/shared/map.utils';\r\n\r\n/**\r\n * Create a default style\r\n * @param fillColor the fill color\r\n * @param strokeColor the stroke color\r\n * @param strokeWidth the stroke width\r\n * @param label a label\r\n * @returns OL style\r\n */\r\nexport function createInteractionStyle(\r\n  fillColor?: string,\r\n  strokeColor?: string,\r\n  strokeWidth?: number,\r\n  label?: string\r\n): Olstyle.Style {\r\n  return new Olstyle.Style({\r\n    stroke: new Olstyle.Stroke({\r\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\r\n      width: strokeWidth ? strokeWidth : 1\r\n    }),\r\n    fill: new Olstyle.Fill({\r\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\r\n    }),\r\n    image: new Olstyle.Circle({\r\n      radius: 5,\r\n      stroke: new Olstyle.Stroke({\r\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\r\n        width: strokeWidth ? strokeWidth : 1\r\n      }),\r\n      fill: new Olstyle.Fill({\r\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\r\n      })\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Add an OL overlay at each midpoint and return an array of those overlays\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function updateOlTooltipsDrawAtMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay[] {\r\n  let olMidpoints;\r\n  if (olGeometry instanceof OlPoint) {\r\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\r\n    olMidpoints = new Array(1);\r\n    olMidpoints[0] = olMidpointPoint;\r\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\r\n  } else if (olGeometry instanceof OlCircle) {\r\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\r\n    olMidpoints = new Array(1);\r\n    olMidpoints[0] = olMidpointPoint;\r\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\r\n  } else {\r\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n  }\r\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\r\n    let olTooltip = olMidpoint.get('_tooltip');\r\n    if (olTooltip === undefined) {\r\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\r\n    } else {\r\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\r\n    }\r\n    return olTooltip;\r\n  });\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Add an OL overlay at the center of a geometry and return that overlay\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlay\r\n */\r\nexport function updateOlTooltipDrawAtCenter(\r\n  olGeometry: OlLineString | OlPolygon\r\n): OlOverlay {\r\n  const olCenter = updateOlGeometryCenter(olGeometry);\r\n  let olTooltip = olCenter.get('_tooltip');\r\n  if (olTooltip === undefined) {\r\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\r\n  } else {\r\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\r\n  }\r\n  return olTooltip;\r\n}\r\n\r\n/**\r\n * Create an OL overlay at a point and bind the overlay to the point\r\n * @param olPoint OL Point\r\n * @returns OL overlay\r\n */\r\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\r\n  const olTooltip = new OlOverlay({\r\n    element: document.createElement('div'),\r\n    offset: [-30, -10],\r\n    className: ['igo-map-tooltip', 'igo-map-tooltip-draw'].join(' '),\r\n    stopEvent: false\r\n  });\r\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\r\n  olPoint.set('_tooltip', olTooltip);\r\n\r\n  return olTooltip;\r\n}\r\n\r\nexport function DDtoDMS(\r\n  value: [number, number],\r\n  unit: CoordinatesUnit\r\n): string[] | undefined {\r\n  const conversionMapper = new Map([\r\n    [\r\n      CoordinatesUnit.DecimalDegree,\r\n      (val: [number, number]) => {\r\n        if (typeof val[0] === 'number') {\r\n          return roundCoordToString(val, 5) as string[];\r\n        } else {\r\n          const numVal: [number, number] = [Number(val[0]), Number(val[1])];\r\n          return roundCoordToString(numVal, 5) as string[];\r\n        }\r\n      }\r\n    ],\r\n    [\r\n      CoordinatesUnit.DegreesMinutesSeconds,\r\n      (val: [number, number]) => convertDDToDMS(val, 2)\r\n    ]\r\n  ]);\r\n  let conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n","<h2 mat-dialog-title>\r\n  {{ 'igo.geo.draw.popupTitle' | translate }}\r\n</h2>\r\n\r\n<ng-container *ngIf=\"labelFlag !== labelType.Custom\">\r\n  <div mat-dialog-content class=\"geometry-type-toggle\">\r\n    <div class=\"button-toggle-container\">\r\n      <mat-button-toggle-group\r\n        (change)=\"onLabelTypeChange($event.value)\"\r\n        [value]=\"customOrPredefined\"\r\n      >\r\n        <mat-button-toggle [value]=\"labelType.Custom\">\r\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\r\n        </mat-button-toggle>\r\n        <mat-button-toggle [value]=\"labelType.Predefined\">\r\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\r\n        </mat-button-toggle>\r\n      </mat-button-toggle-group>\r\n    </div>\r\n    <div>\r\n      <p>\r\n        {{ 'igo.geo.draw.builtInInstructions' | translate }}\r\n      </p>\r\n      <mat-radio-group *ngIf=\"olGeometryType !== 'Polygon'\">\r\n        <mat-radio-button\r\n          *ngFor=\"let option of arrayBuiltInType\"\r\n          [value]=\"option.value\"\r\n          [disabled]=\"optionAvailable(option.value)\"\r\n          (change)=\"onLabelTypeChange($event.value)\"\r\n          [checked]=\"option.checked\"\r\n        >\r\n          {{ getProperLengthLabel(option.value) }}\r\n        </mat-radio-button>\r\n      </mat-radio-group>\r\n      <ng-container *ngIf=\"olGeometryType === 'Polygon'\">\r\n        <mat-checkbox\r\n          *ngFor=\"let option of arrayBuiltInType\"\r\n          class=\"mat-typography\"\r\n          [value]=\"option.value\"\r\n          [disabled]=\"optionAvailable(option.value)\"\r\n          (change)=\"onLabelTypeChange($event.source.value, $event.checked)\"\r\n          [checked]=\"option.checked\"\r\n        >\r\n          {{ getProperLengthLabel(option.value) }}\r\n        </mat-checkbox>\r\n      </ng-container>\r\n      <div *ngIf=\"labelFlag === labelType.Coordinates\" class=\"fields-container\">\r\n        <mat-form-field class=\"readOnly-Input\">\r\n          <mat-label>(Latitude, Longitude)</mat-label>\r\n          <input\r\n            #input\r\n            matInput\r\n            placeholder=\"(Latitude, Longitude)\"\r\n            value=\"{{ currentCoordinates }}\"\r\n            readonly\r\n          />\r\n        </mat-form-field>\r\n        <mat-form-field class=\"unit-field\">\r\n          <mat-select\r\n            [value]=\"coordinatesMeasureUnit\"\r\n            (selectionChange)=\"onChangeCoordinateUnit($event.value)\"\r\n          >\r\n            <mat-option *ngFor=\"let unit of allCoordinatesUnits\" [value]=\"unit\">\r\n              {{ unit }}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <div\r\n        *ngIf=\"labelFlag === labelType.Length || polygonCheck === 2\"\r\n        class=\"fields-container\"\r\n      >\r\n        <mat-form-field class=\"readOnly-Input\">\r\n          <mat-label>{{ lengthLabelT }}</mat-label>\r\n          <input\r\n            #input\r\n            matInput\r\n            placeholder=\"{{ lengthLabelT }}\"\r\n            value=\"{{ currentLength }}\"\r\n            readonly\r\n          />\r\n        </mat-form-field>\r\n        <mat-form-field class=\"unit-field\">\r\n          <mat-select\r\n            [value]=\"lengthMeasureUnit\"\r\n            (selectionChange)=\"onChangeLengthUnit($event.value)\"\r\n          >\r\n            <mat-option *ngFor=\"let unit of allLengthUnits\" [value]=\"unit\">\r\n              {{ getLengthUnitEnum(unit) }}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n      <div\r\n        *ngIf=\"labelFlag === labelType.Area || polygonCheck === 2\"\r\n        class=\"fields-container\"\r\n      >\r\n        <mat-form-field class=\"readOnly-Input\">\r\n          <mat-label>{{ 'igo.geo.draw.labelType.Area' | translate }}</mat-label>\r\n          <input\r\n            #input\r\n            matInput\r\n            placeholder=\"{{ 'igo.geo.draw.labelType.Area' | translate }}\"\r\n            value=\"{{ currentArea }}\"\r\n            readonly\r\n          />\r\n        </mat-form-field>\r\n        <mat-form-field class=\"unit-field\">\r\n          <mat-select\r\n            [value]=\"areaMeasureUnit\"\r\n            (selectionChange)=\"onChangeAreaUnit($event.value)\"\r\n          >\r\n            <mat-option *ngFor=\"let unit of allAreaUnits\" [value]=\"unit\">\r\n              {{ getAreaUnitEnum(unit) }}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <div mat-dialog-actions>\r\n    <button mat-raised-button (click)=\"cancelDrawing()\">\r\n      {{ 'igo.geo.draw.cancel' | translate }}\r\n    </button>\r\n    <button mat-raised-button color=\"primary\" (click)=\"confirm()\">\r\n      {{ noLabelButton() }}\r\n    </button>\r\n  </div>\r\n</ng-container>\r\n\r\n<ng-container *ngIf=\"labelFlag === labelType.Custom\">\r\n  <div mat-dialog-content class=\"geometry-type-toggle\">\r\n    <div class=\"button-toggle-container\">\r\n      <mat-button-toggle-group\r\n        (change)=\"onLabelTypeChange($event.value)\"\r\n        [value]=\"customOrPredefined\"\r\n      >\r\n        <mat-button-toggle [value]=\"labelType.Custom\">\r\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\r\n        </mat-button-toggle>\r\n        <mat-button-toggle [value]=\"labelType.Predefined\">\r\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\r\n        </mat-button-toggle>\r\n      </mat-button-toggle-group>\r\n    </div>\r\n    <p>\r\n      {{ 'igo.geo.draw.dialogInstruction' | translate }}\r\n    </p>\r\n    <mat-form-field class=\"input\">\r\n      <mat-label>{{ 'igo.geo.draw.dialogTitle' | translate }}</mat-label>\r\n      <input\r\n        #input\r\n        matInput\r\n        (select)=\"(true)\"\r\n        (input)=\"getLabelLength($event.target.value)\"\r\n        placeholder=\"{{ 'igo.geo.draw.dialogTitle' | translate }}\"\r\n        value=\"{{ currentLabel }}\"\r\n        cdkFocusInitial\r\n      />\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div mat-dialog-actions>\r\n    <button mat-raised-button (click)=\"cancelDrawing()\">\r\n      {{ 'igo.geo.draw.cancel' | translate }}\r\n    </button>\r\n    <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\r\n      {{ noLabelButton() }}\r\n    </button>\r\n  </div>\r\n</ng-container>\r\n","import { Component, Inject, Input } from '@angular/core';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\r\nimport { transform } from 'ol/proj';\r\nimport { IgoMap, roundCoordTo } from '../../map/shared';\r\nimport OlFeature from 'ol/Feature';\r\nimport {\r\n  measureOlGeometryLength,\r\n  measureOlGeometryArea,\r\n  metersToUnit,\r\n  squareMetersToUnit\r\n} from '../../measure/shared/measure.utils';\r\nimport {\r\n  MeasureLengthUnit,\r\n  MeasureLengthUnitAbbreviation,\r\n  MeasureAreaUnit,\r\n  MeasureAreaUnitAbbreviation\r\n} from '../../measure/shared/measure.enum';\r\n\r\nimport { fromCircle } from 'ol/geom/Polygon';\r\nimport { getLength } from 'ol/sphere';\r\nimport Circle from 'ol/geom/Circle';\r\nimport { DDtoDMS } from '../shared/draw.utils';\r\n\r\n@Component({\r\n  selector: 'igo-draw-popup-component',\r\n  templateUrl: './draw-popup.component.html',\r\n  styleUrls: ['./draw-popup.component.scss']\r\n})\r\nexport class DrawPopupComponent {\r\n  @Input() confirmFlag: boolean = false;\r\n  @Input() labelFlag: LabelType | [LabelType, LabelType] = LabelType.Custom;\r\n  @Input() coordinatesMeasureUnit: CoordinatesUnit;\r\n  @Input() lengthMeasureUnit: MeasureLengthUnit;\r\n  @Input() areaMeasureUnit: MeasureAreaUnit;\r\n\r\n  public geometryType = GeometryType;\r\n  public labelType = LabelType;\r\n  public arrayBuiltInType: any[] = [];\r\n\r\n  public currentLabel: string;\r\n  public currentCoordinates: string;\r\n  public currentArea: string;\r\n  public currentLength: string;\r\n\r\n  public olGeometryType: GeometryType = undefined;\r\n  public lengthInMeters: string;\r\n  public areaInMetersSquare: string;\r\n  public coordinatesInDD: string;\r\n  public currentCoordinatesUnit: string;\r\n\r\n  private longlatDD: [number, number];\r\n  private labelLength: number;\r\n\r\n  public polygonCheck = 0; // Count for polygon label types checkboxes\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    public dialogRef: MatDialogRef<DrawPopupComponent>,\r\n    @Inject(MAT_DIALOG_DATA) public data: { olGeometry: any; map: IgoMap }\r\n  ) {\r\n    this.currentLabel = this.data.olGeometry.get('draw');\r\n    this.labelLength = this.currentLabel ? this.currentLabel.length : 0;\r\n    let olGeometry;\r\n\r\n    const projection = this.data.map.ol.getView().getProjection();\r\n\r\n    if (this.data.olGeometry instanceof OlFeature) {\r\n      if (this.data.olGeometry.get('rad')) {\r\n        const longitudeLatitude = [\r\n          this.data.olGeometry.get('longitude'),\r\n          this.data.olGeometry.get('latitude')\r\n        ];\r\n        this.olGeometryType = GeometryType.Circle;\r\n        olGeometry = new Circle(\r\n          longitudeLatitude,\r\n          this.data.olGeometry.get('rad')\r\n        );\r\n      } else {\r\n        this.olGeometryType = this.data.olGeometry.getGeometry().getType();\r\n        olGeometry = this.data.olGeometry.get('geometry');\r\n      }\r\n    } else {\r\n      this.olGeometryType = this.data.olGeometry.getType();\r\n      olGeometry = this.data.olGeometry;\r\n    }\r\n\r\n    if (\r\n      this.olGeometryType === GeometryType.Point ||\r\n      this.olGeometryType === GeometryType.Circle\r\n    ) {\r\n      if (this.data.olGeometry instanceof OlFeature) {\r\n        let longitude = this.data.olGeometry.get('longitude');\r\n        let latitude = this.data.olGeometry.get('latitude');\r\n        this.longlatDD = roundCoordTo([longitude, latitude], 5);\r\n        this.coordinatesInDD = '(' + latitude + ', ' + longitude + ')';\r\n      } else {\r\n        let point4326 = transform(\r\n          this.data.olGeometry.getFlatCoordinates(),\r\n          projection,\r\n          'EPSG:4326'\r\n        );\r\n        this.longlatDD = roundCoordTo([point4326[0], point4326[1]], 5);\r\n        this.coordinatesInDD =\r\n          '(' + this.longlatDD[1] + ', ' + this.longlatDD[0] + ')';\r\n      }\r\n      this.currentCoordinates = this.coordinatesInDD;\r\n    }\r\n    if (this.olGeometryType === GeometryType.LineString) {\r\n      this.lengthInMeters = measureOlGeometryLength(\r\n        olGeometry,\r\n        projection.getCode()\r\n      ).toFixed(2);\r\n      this.currentLength = this.lengthInMeters;\r\n    } else if (this.olGeometryType === GeometryType.Polygon) {\r\n      this.lengthInMeters = measureOlGeometryLength(\r\n        olGeometry,\r\n        projection.getCode()\r\n      ).toFixed(2);\r\n      this.currentLength = this.lengthInMeters;\r\n      this.areaInMetersSquare = measureOlGeometryArea(\r\n        olGeometry,\r\n        projection.getCode()\r\n      ).toFixed(2);\r\n      this.currentArea = this.areaInMetersSquare;\r\n    } else if (this.olGeometryType === GeometryType.Circle) {\r\n      let circularPolygon = fromCircle(olGeometry, 10000);\r\n      const radius = this.getRadius(circularPolygon);\r\n      this.lengthInMeters = radius.toFixed(2);\r\n      this.currentLength = this.lengthInMeters;\r\n      this.areaInMetersSquare = measureOlGeometryArea(\r\n        circularPolygon,\r\n        projection.getCode()\r\n      ).toFixed(2);\r\n      this.currentArea = this.areaInMetersSquare;\r\n    }\r\n\r\n    if (data.olGeometry.get('labelType') === LabelType.Coordinates) {\r\n      this.onLabelTypeChange(LabelType.Predefined);\r\n      this.onLabelTypeChange(LabelType.Coordinates, true);\r\n      this.coordinatesMeasureUnit = data.olGeometry.get('measureUnit');\r\n    } else if (data.olGeometry.get('labelType') === LabelType.Length) {\r\n      this.onLabelTypeChange(LabelType.Predefined);\r\n      this.onLabelTypeChange(LabelType.Length, true);\r\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit');\r\n    } else if (data.olGeometry.get('labelType') === LabelType.Area) {\r\n      this.onLabelTypeChange(LabelType.Predefined);\r\n      this.onLabelTypeChange(LabelType.Area, true);\r\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit');\r\n    } else if (data.olGeometry.get('labelType')?.length === 2) {\r\n      this.onLabelTypeChange(LabelType.Predefined);\r\n      this.onLabelTypeChange(LabelType.Length, true);\r\n      this.onLabelTypeChange(LabelType.Area, true);\r\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit')[0];\r\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit')[1];\r\n    }\r\n    this.buildArrayType();\r\n  }\r\n\r\n  /**\r\n   * HTML Interactions\r\n   */\r\n\r\n  cancelDrawing() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  confirm(input?: string) {\r\n    this.confirmFlag = true;\r\n    if (this.labelFlag === LabelType.Predefined) {\r\n      this.dialogRef.close();\r\n    } else if (this.labelFlag === LabelType.Custom) {\r\n      this.dialogRef.close({\r\n        label: input\r\n      });\r\n    } else if (this.labelFlag === LabelType.Coordinates) {\r\n      this.dialogRef.close({\r\n        label: this.currentCoordinates,\r\n        measureUnit: this.coordinatesMeasureUnit\r\n      });\r\n    } else if (this.olGeometryType === GeometryType.Polygon) {\r\n      if (this.polygonCheck === 2) {\r\n        this.labelFlag = [LabelType.Length, LabelType.Area];\r\n        this.dialogRef.close({\r\n          label:\r\n            'P: ' +\r\n            this.currentLength +\r\n            ' ' +\r\n            MeasureLengthUnitAbbreviation[MeasureLengthUnit.Meters] +\r\n            '\\n' +\r\n            this.languageService.translate.instant('igo.geo.draw.labelType.A') +\r\n            this.currentArea +\r\n            ' ' +\r\n            MeasureAreaUnitAbbreviation[MeasureAreaUnit.SquareMeters],\r\n          measureUnit: [this.lengthMeasureUnit, this.areaMeasureUnit]\r\n        });\r\n      } else {\r\n        this.labelFlag === LabelType.Length\r\n          ? this.dialogRef.close({\r\n              label:\r\n                'P: ' +\r\n                this.currentLength +\r\n                ' ' +\r\n                MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\r\n              measureUnit: this.lengthMeasureUnit\r\n            })\r\n          : this.dialogRef.close({\r\n              label:\r\n                this.currentArea +\r\n                ' ' +\r\n                MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\r\n              measureUnit: this.areaMeasureUnit\r\n            });\r\n      }\r\n    } else if (this.labelFlag === LabelType.Length) {\r\n      if (this.olGeometryType === GeometryType.Circle) {\r\n        this.dialogRef.close({\r\n          label:\r\n            'R: ' +\r\n            this.currentLength +\r\n            ' ' +\r\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\r\n          measureUnit: this.lengthMeasureUnit\r\n        });\r\n      } else if (this.olGeometryType === GeometryType.LineString) {\r\n        this.dialogRef.close({\r\n          label:\r\n            this.currentLength +\r\n            ' ' +\r\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\r\n          measureUnit: this.lengthMeasureUnit\r\n        });\r\n      }\r\n    } else if (this.labelFlag === LabelType.Area) {\r\n      this.dialogRef.close({\r\n        label:\r\n          this.currentArea +\r\n          ' ' +\r\n          MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\r\n        measureUnit: this.areaMeasureUnit\r\n      });\r\n    }\r\n  }\r\n\r\n  onLabelTypeChange(labelType: LabelType, checked?: boolean) {\r\n    if (\r\n      labelType !== LabelType.Predefined &&\r\n      labelType !== LabelType.Custom &&\r\n      this.olGeometryType === GeometryType.Polygon\r\n    ) {\r\n      this.arrayBuiltInType.find((type) => type.value === labelType)\r\n        ? (this.arrayBuiltInType.find(\r\n            (type) => type.value === labelType\r\n          ).checked = checked)\r\n        : (this.labelFlag = undefined);\r\n      checked\r\n        ? (this.labelFlag = labelType)\r\n        : (this.labelFlag = this.arrayBuiltInType.find((type) => type.checked)\r\n            ?.value);\r\n    } else {\r\n      this.labelFlag = labelType;\r\n    }\r\n\r\n    if (labelType === LabelType.Predefined) {\r\n      if (this.olGeometryType === GeometryType.Point) {\r\n        this.labelFlag = LabelType.Coordinates;\r\n        this.currentCoordinates = this.coordinatesInDD;\r\n        this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\r\n      } else if (this.olGeometryType === GeometryType.LineString) {\r\n        this.labelFlag = LabelType.Length;\r\n        this.currentLength = this.lengthInMeters;\r\n        this.lengthMeasureUnit = MeasureLengthUnit.Meters;\r\n      }\r\n    } else if (labelType === LabelType.Area) {\r\n      this.currentArea = this.areaInMetersSquare;\r\n      this.areaMeasureUnit = MeasureAreaUnit.SquareMeters;\r\n    } else if (labelType === LabelType.Length) {\r\n      this.currentLength = this.lengthInMeters;\r\n      this.lengthMeasureUnit = MeasureLengthUnit.Meters;\r\n    } else if (this.labelFlag === LabelType.Coordinates) {\r\n      this.currentCoordinates = this.coordinatesInDD;\r\n      this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\r\n    }\r\n\r\n    const labeltypes = [this.labelType.Length, this.labelType.Area];\r\n    if (\r\n      this.olGeometryType === GeometryType.Polygon &&\r\n      labeltypes.includes(labelType)\r\n    ) {\r\n      checked ? (this.polygonCheck += 1) : (this.polygonCheck -= 1);\r\n    } else {\r\n      this.polygonCheck = 0;\r\n    }\r\n  }\r\n\r\n  onChangeLengthUnit(lengthUnit: MeasureLengthUnit) {\r\n    this.lengthMeasureUnit = lengthUnit;\r\n    this.currentLength = metersToUnit(\r\n      Number(this.lengthInMeters),\r\n      lengthUnit\r\n    ).toFixed(2);\r\n  }\r\n\r\n  onChangeAreaUnit(areaUnit: MeasureAreaUnit) {\r\n    this.areaMeasureUnit = areaUnit;\r\n    this.currentArea = squareMetersToUnit(\r\n      Number(this.areaInMetersSquare),\r\n      areaUnit\r\n    ).toFixed(2);\r\n  }\r\n\r\n  onChangeCoordinateUnit(coordinatesUnit: CoordinatesUnit) {\r\n    this.coordinatesMeasureUnit = coordinatesUnit;\r\n    let coordinates = DDtoDMS(this.longlatDD, coordinatesUnit);\r\n    this.currentCoordinates =\r\n      '(' + coordinates[1] + ', ' + coordinates[0] + ')';\r\n  }\r\n\r\n  buildArrayType() {\r\n    for (const labelType of Object.values(LabelType)) {\r\n      if (\r\n        labelType !== LabelType.Custom &&\r\n        labelType !== LabelType.Predefined\r\n      ) {\r\n        this.arrayBuiltInType.push({\r\n          value: labelType,\r\n          checked:\r\n            this.selectOptions(labelType) ||\r\n            this.labelFlag === labelType ||\r\n            (this.polygonCheck === 2 && labelType !== LabelType.Coordinates)\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  noLabelButton() {\r\n    if (\r\n      this.labelFlag === LabelType.Predefined ||\r\n      (this.labelFlag === LabelType.Custom && this.labelLength === 0)\r\n    ) {\r\n      return this.languageService.translate.instant('igo.geo.draw.noLabel');\r\n    }\r\n\r\n    return 'OK';\r\n  }\r\n\r\n  get customOrPredefined() {\r\n    if (this.labelFlag === LabelType.Custom) {\r\n      return LabelType.Custom;\r\n    }\r\n    return LabelType.Predefined;\r\n  }\r\n\r\n  optionAvailable(currentOption: LabelType) {\r\n    switch (this.olGeometryType) {\r\n      case GeometryType.Point:\r\n        if (currentOption === LabelType.Coordinates) {\r\n          return false;\r\n        }\r\n        return true;\r\n      case GeometryType.LineString:\r\n        if (currentOption === LabelType.Length) {\r\n          return false;\r\n        }\r\n        return true;\r\n      case GeometryType.Polygon:\r\n        if (currentOption === LabelType.Coordinates) {\r\n          return true;\r\n        }\r\n        return false;\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  get allLengthUnits(): string[] {\r\n    return Object.values(MeasureLengthUnit);\r\n  }\r\n\r\n  getLengthUnitEnum(lengthUnit: MeasureLengthUnit) {\r\n    return MeasureLengthUnitAbbreviation[lengthUnit];\r\n  }\r\n\r\n  get allAreaUnits(): string[] {\r\n    return Object.values(MeasureAreaUnit);\r\n  }\r\n\r\n  get allCoordinatesUnits(): string[] {\r\n    return Object.values(CoordinatesUnit);\r\n  }\r\n\r\n  getAreaUnitEnum(areaUnit: MeasureAreaUnit) {\r\n    return MeasureAreaUnitAbbreviation[areaUnit];\r\n  }\r\n\r\n  private getRadius(olGeometry): number {\r\n    const length = getLength(olGeometry);\r\n    return Number(length / (2 * Math.PI));\r\n  }\r\n\r\n  get lengthLabelT() {\r\n    if (this.olGeometryType === GeometryType.Polygon) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.measure.perimeter'\r\n      );\r\n    }\r\n    if (this.olGeometryType === GeometryType.Circle) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.search.coordinates.radius'\r\n      );\r\n    }\r\n    return this.languageService.translate.instant(\r\n      'igo.geo.draw.labelType.Length'\r\n    );\r\n  }\r\n\r\n  getLabelLength(event?) {\r\n    this.labelLength = event.length;\r\n  }\r\n\r\n  selectOptions(option) {\r\n    if (this.olGeometryType === GeometryType.Point) {\r\n      return option === LabelType.Coordinates;\r\n    } else if (this.olGeometryType === GeometryType.LineString) {\r\n      return option === LabelType.Length;\r\n    }\r\n  }\r\n\r\n  getProperLengthLabel(option) {\r\n    if (option === LabelType.Length) {\r\n      if (this.olGeometryType === GeometryType.Polygon) {\r\n        return this.languageService.translate.instant(\r\n          'igo.geo.measure.perimeter'\r\n        );\r\n      }\r\n      if (this.olGeometryType === GeometryType.Circle) {\r\n        return this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.radius'\r\n        );\r\n      }\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.draw.labelType.Length'\r\n      );\r\n    }\r\n    return this.languageService.translate.instant(\r\n      'igo.geo.draw.labelType.' + option\r\n    );\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'igo-draw-shorcuts',\r\n  templateUrl: './draw-shorcuts.component.html',\r\n  styleUrls: ['./draw-shorcuts.component.scss']\r\n})\r\nexport class DrawShorcutsComponent {}\r\n","<mat-dialog-content>\r\n  <div>\r\n    <span class=\"shortcut mat-typography\">\r\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon\r\n      >{{ 'igo.geo.draw.finish' | translate }}</span\r\n    >\r\n  </div>\r\n  <div>\r\n    <span class=\"shortcut mat-typography\">\r\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon\r\n      >{{ 'igo.geo.draw.undo' | translate }}</span\r\n    >\r\n  </div>\r\n  <div>\r\n    <span class=\"shortcut mat-typography\">\r\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon\r\n      >{{ 'igo.geo.draw.abort' | translate }}</span\r\n    >\r\n  </div>\r\n  <div>\r\n    <span class=\"shortcut mat-typography\">\r\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon\r\n      >{{ 'igo.geo.draw.move' | translate }}</span\r\n    >\r\n  </div>\r\n</mat-dialog-content>\r\n<mat-dialog-actions class=\"shortcuts-close\">\r\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\r\n</mat-dialog-actions>\r\n","<h2 mat-dialog-title>\r\n  {{ 'igo.geo.style.styleModal' | translate }}\r\n</h2>\r\n<div\r\n  class=\"edition-drawing\"\r\n  mat-dialog-content\r\n  [hidden]=\"data.features.length === 0\"\r\n>\r\n  <form class=\"igo-form\" [formGroup]=\"form\">\r\n    <div class=\"color-picker\">\r\n      <ng-container *ngIf=\"linestringOnly !== true\">\r\n        <span>\r\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\r\n          {{ 'igo.geo.style.fill' | translate }}\r\n        </span>\r\n        <igo-color-picker-form-field\r\n          formControlName=\"fill\"\r\n          outputFormat=\"rgba\"\r\n          setAlpha=\".4\"\r\n          (open)=\"openPicker()\"\r\n          (close)=\"closePicker()\"\r\n          [color]=\"getFeatureFillColor()\"\r\n        ></igo-color-picker-form-field>\r\n      </ng-container>\r\n\r\n      <span>\r\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\">\r\n        </mat-icon>\r\n        {{ 'igo.geo.style.stroke' | translate }}\r\n      </span>\r\n\r\n      <igo-color-picker-form-field\r\n        formControlName=\"stroke\"\r\n        outputFormat=\"rgba\"\r\n        setAlpha=\"1\"\r\n        (open)=\"openPicker()\"\r\n        (close)=\"closePicker()\"\r\n        [color]=\"getFeatureStrokeColor()\"\r\n      ></igo-color-picker-form-field>\r\n    </div>\r\n\r\n    <div class=\"igo-input-container\">\r\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.style.fontSize' | translate }}</mat-label>\r\n        <input\r\n          matInput\r\n          #testFontSize\r\n          type=\"number\"\r\n          placeholder=\"10\"\r\n          min=\"10\"\r\n          onkeydown=\"return event.keyCode !== 69\"\r\n          [value]=\"getFeatureFontSize()\"\r\n          (input)=\"styleModalData.fontSize = $event.target.value\"\r\n        />\r\n        <span matTextSuffix>px</span>\r\n      </mat-form-field>\r\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.style.fontStyle' | translate }}</mat-label>\r\n        <mat-select\r\n          #testFontStyle\r\n          [value]=\"getFeatureFontStyle()\"\r\n          (selectionChange)=\"styleModalData.fontStyle = $event.value\"\r\n        >\r\n          <mat-option\r\n            *ngFor=\"let fontSelect of allFontStyles\"\r\n            [value]=\"fontSelect\"\r\n          >\r\n            {{ fontSelect }}\r\n          </mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.style.offsetX' | translate }}</mat-label>\r\n        <input\r\n          matInput\r\n          #offsetXInput\r\n          type=\"number\"\r\n          onkeydown=\"return event.keyCode !== 69\"\r\n          [value]=\"getFeatureOffsetX()\"\r\n          (input)=\"styleModalData.offsetX = $event.target.value\"\r\n        />\r\n      </mat-form-field>\r\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.style.offsetY' | translate }}</mat-label>\r\n        <input\r\n          matInput\r\n          #offsetYInput\r\n          type=\"number\"\r\n          onkeydown=\"return event.keyCode !== 69\"\r\n          [value]=\"getFeatureOffsetY()\"\r\n          (input)=\"styleModalData.offsetY = $event.target.value\"\r\n        />\r\n      </mat-form-field>\r\n    </div>\r\n  </form>\r\n</div>\r\n<div mat-dialog-actions>\r\n  <button mat-raised-button (click)=\"cancelDrawing()\">\r\n    {{ 'igo.geo.style.cancel' | translate }}\r\n  </button>\r\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\r\n</div>\r\n","import { Component, Inject, Input, OnInit } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { UntypedFormGroup, UntypedFormBuilder } from '@angular/forms';\r\n\r\nimport { DrawStyleService } from '../../style-service/draw-style.service';\r\nimport { FontType } from '../../shared/font.enum';\r\nimport {\r\n  DrawingMatDialogData,\r\n  StyleModalData\r\n} from '../shared/style-modal.interface';\r\n\r\n@Component({\r\n  selector: 'igo-style-modal-drawing',\r\n  templateUrl: './style-modal-drawing.component.html',\r\n  styleUrls: ['./style-modal-drawing.component.scss']\r\n})\r\nexport class StyleModalDrawingComponent implements OnInit {\r\n  @Input() confirmFlag: boolean = false;\r\n\r\n  public form: UntypedFormGroup;\r\n\r\n  public styleModalData: StyleModalData;\r\n  public linestringOnly: boolean;\r\n\r\n  constructor(\r\n    public dialogRef: MatDialogRef<StyleModalDrawingComponent>,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private drawStyleService: DrawStyleService,\r\n    @Inject(MAT_DIALOG_DATA) public data: DrawingMatDialogData\r\n  ) {\r\n    this.buildForm();\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.linestringOnly = true;\r\n    for (const feature of this.data.features) {\r\n      if (feature.geometry.type !== 'LineString') {\r\n        this.linestringOnly = false;\r\n      }\r\n    }\r\n    this.buildStyleData();\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      fill: [''],\r\n      stroke: ['']\r\n    });\r\n  }\r\n\r\n  private buildStyleData() {\r\n    this.styleModalData = {\r\n      fillColor:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.drawingStyle.fill\r\n          : 'rgba(255,255,255,0.4)',\r\n      strokeColor:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.drawingStyle.stroke\r\n          : 'rgba(143,7,7,1)',\r\n      fontSize:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.fontStyle\r\n              .split(' ')[0]\r\n              .replace('px', '')\r\n          : '20',\r\n      fontStyle:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.fontStyle.substring(\r\n              this.data.features[0].properties.fontStyle.indexOf(' ') + 1\r\n            )\r\n          : FontType.Arial,\r\n      offsetX:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.offsetX\r\n          : this.drawStyleService.getOffsetX(),\r\n      offsetY:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.offsetY\r\n          : this.drawStyleService.getOffsetY()\r\n    };\r\n  }\r\n\r\n  get allFontStyles(): string[] {\r\n    return Object.values(FontType);\r\n  }\r\n\r\n  getFeatureFontSize(): string {\r\n    if (!this.styleModalData.fontSize) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.fontStyle\r\n            .split(' ')[0]\r\n            .replace('px', '')\r\n        : '20';\r\n    } else {\r\n      return this.styleModalData.fontSize;\r\n    }\r\n  }\r\n\r\n  getFeatureFontStyle() {\r\n    if (!this.styleModalData.fontStyle) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.fontStyle.substring(\r\n            this.data.features[0].properties.fontStyle.indexOf(' ') + 1\r\n          )\r\n        : FontType.Arial;\r\n    } else {\r\n      return this.styleModalData.fontStyle;\r\n    }\r\n  }\r\n\r\n  getFeatureFillColor() {\r\n    if (!this.styleModalData.fillColor) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.drawingStyle.fill\r\n        : 'rgba(255,255,255,0.4)';\r\n    } else {\r\n      return this.styleModalData.fillColor;\r\n    }\r\n  }\r\n\r\n  getFeatureStrokeColor() {\r\n    if (!this.styleModalData.strokeColor) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.drawingStyle.stroke\r\n        : 'rgba(143,7,7,1)';\r\n    } else {\r\n      return this.styleModalData.strokeColor;\r\n    }\r\n  }\r\n\r\n  getFeatureOffsetX() {\r\n    if (!this.styleModalData.offsetX) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.offsetX\r\n        : this.drawStyleService.getOffsetX();\r\n    } else {\r\n      return this.styleModalData.offsetX;\r\n    }\r\n  }\r\n\r\n  getFeatureOffsetY() {\r\n    if (!this.styleModalData.offsetY) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.offsetY\r\n        : this.drawStyleService.getOffsetY();\r\n    } else {\r\n      return this.styleModalData.offsetY;\r\n    }\r\n  }\r\n\r\n  cancelDrawing() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  confirm() {\r\n    this.confirmFlag = true;\r\n    if (this.form.get('fill').value) {\r\n      this.styleModalData.fillColor = this.form.get('fill').value;\r\n    }\r\n\r\n    if (this.form.get('stroke').value) {\r\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\r\n    }\r\n    this.dialogRef.close(this.styleModalData);\r\n  }\r\n\r\n  openPicker() {\r\n    this.dialogRef.disableClose = true;\r\n  }\r\n\r\n  closePicker() {\r\n    this.dialogRef.disableClose = false;\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\n\r\nexport interface DialogData {\r\n  label: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'igo-draw-popup-component',\r\n  templateUrl: './draw-layer-popup.component.html',\r\n  styleUrls: ['./draw-layer-popup.component.scss']\r\n})\r\nexport class DrawLayerPopupComponent {\r\n  @Input() confirmFlag: boolean = false;\r\n\r\n  constructor(public dialogRef: MatDialogRef<DrawLayerPopupComponent>) {}\r\n\r\n  cancelDrawing() {\r\n    this.dialogRef.close();\r\n  }\r\n  confirm(labelString: string) {\r\n    this.confirmFlag = true;\r\n    this.dialogRef.close(labelString);\r\n  }\r\n}\r\n","<div mat-dialog-content>\r\n  <p class=\"mat-typography\">\r\n    {{ 'igo.geo.draw.layer.layerDialogInstruction' | translate }}\r\n  </p>\r\n  <mat-form-field class=\"example-full-width\">\r\n    <input\r\n      #input\r\n      matInput\r\n      placeholder=\"{{ 'igo.geo.draw.layer.title' | translate }}\"\r\n    />\r\n  </mat-form-field>\r\n</div>\r\n<div mat-dialog-actions>\r\n  <button mat-raised-button (click)=\"cancelDrawing()\">\r\n    {{ 'igo.geo.draw.cancel' | translate }}\r\n  </button>\r\n  <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\r\n    OK\r\n  </button>\r\n</div>\r\n","<div>\r\n  <div class=\"geometry-type-toggle mat-typography\">\r\n    <mat-button-toggle-group\r\n      (change)=\"onGeometryTypeChange($event.value)\"\r\n      [value]=\"geometryType.Point\"\r\n    >\r\n      <mat-button-toggle [value]=\"geometryType.Point\">\r\n        {{ 'igo.geo.draw.' + geometryType.Point | translate }}\r\n      </mat-button-toggle>\r\n\r\n      <mat-button-toggle [value]=\"geometryType.LineString\">\r\n        {{ 'igo.geo.draw.' + geometryType.LineString | translate }}\r\n      </mat-button-toggle>\r\n\r\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\r\n        {{ 'igo.geo.draw.' + geometryType.Polygon | translate }}\r\n      </mat-button-toggle>\r\n\r\n      <mat-button-toggle [value]=\"geometryType.Circle\">\r\n        {{ 'igo.geo.draw.' + geometryType.Circle | translate }}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class=\"draw-options mat-typography\">\r\n    <mat-slide-toggle\r\n      [disabled]=\"drawControlIsDisabled\"\r\n      [checked]=\"drawControlIsActive\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDrawControl($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.draw.drawControl' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]=\"labelsAreShown\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleLabels()\"\r\n    >\r\n      {{ 'igo.geo.draw.toggleMapTooltips' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      *ngIf=\"!isPoint()\"\r\n      [checked]=\"freehandMode\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleFreehandMode($event)\"\r\n    >\r\n      {{ 'igo.geo.draw.freehandMode' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <div class=\"radius-unit\" *ngIf=\"isCircle()\">\r\n      <form class=\"radius-form\">\r\n        <mat-form-field class=\"radius\">\r\n          <input\r\n            matInput\r\n            type=\"number\"\r\n            min=\"0\"\r\n            placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\r\n            [formControl]=\"radiusFormControl\"\r\n            [readonly]=\"this.freehandMode\"\r\n          />\r\n        </mat-form-field>\r\n      </form>\r\n\r\n      <mat-form-field class=\"unit-field\">\r\n        <mat-select\r\n          [value]=\"measureUnit\"\r\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\r\n        >\r\n          <mat-option\r\n            *ngFor=\"let measureUnit of measureUnits\"\r\n            [value]=\"measureUnit\"\r\n          >\r\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\r\n          </mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n\r\n  <mat-divider></mat-divider>\r\n\r\n  <div class=\"layer-select-container\">\r\n    <mat-form-field class=\"layer-select\" subscriptSizing=\"dynamic\">\r\n      <mat-label>{{ 'igo.geo.draw.layer.title' | translate }}</mat-label>\r\n      <mat-select\r\n        #selectedLayer\r\n        (selectionChange)=\"onLayerChange(selectedLayer.value)\"\r\n        [value]=\"updateActiveLayer()\"\r\n      >\r\n        <mat-option *ngFor=\"let layer of allLayers\" [value]=\"layer\">\r\n          {{ layer.title }}\r\n        </mat-option>\r\n        <mat-option id=\"createNewLayer\">\r\n          {{ 'igo.geo.draw.layer.createNewLayer' | translate }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n    <button\r\n      *ngIf=\"activeDrawingLayer\"\r\n      mat-icon-button\r\n      [color]=\"activeDrawingLayer.visible ? 'primary' : 'default'\"\r\n      collapsibleButton\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"\r\n        activeDrawingLayer.visible\r\n          ? ('igo.geo.layer.hideLayer' | translate)\r\n          : ('igo.geo.layer.showLayer' | translate)\r\n      \"\r\n      (click)=\"activeDrawingLayer.visible = !activeDrawingLayer.visible\"\r\n    >\r\n      <mat-icon [svgIcon]=\"activeDrawingLayer.visible ? 'eye' : 'eye-off'\">\r\n      </mat-icon>\r\n    </button>\r\n  </div>\r\n  <mat-divider></mat-divider>\r\n  <div>\r\n    <button\r\n      *ngIf=\"activeStore.count$.getValue() > 0\"\r\n      class=\"deleteBtn\"\r\n      mat-icon-button\r\n      color=\"warn\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\r\n      (click)=\"deleteDrawings()\"\r\n    >\r\n      <mat-icon svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n\r\n    <div>\r\n      <igo-entity-table\r\n        #table\r\n        class=\"table-compact\"\r\n        [store]=\"activeStore\"\r\n        [template]=\"tableTemplate\"\r\n      >\r\n      </igo-entity-table>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"icon-options\">\r\n    <mat-form-field *ngIf=\"icons.length >= 1\">\r\n      <mat-label>{{ 'igo.geo.draw.icon' | translate }}</mat-label>\r\n      <mat-select>\r\n        <mat-select-trigger>\r\n          <div *ngIf=\"icon\" class=\"box\">\r\n            <img src=\"{{ icon }}\" />\r\n          </div>\r\n        </mat-select-trigger>\r\n        <mat-option value=\"\" (click)=\"onIconChange()\">{{\r\n          'igo.geo.draw.noIcon' | translate\r\n        }}</mat-option>\r\n        <mat-option\r\n          *ngFor=\"let icon_html of icons\"\r\n          [value]=\"icon_html\"\r\n          (click)=\"onIconChange(icon_html)\"\r\n        >\r\n          <div class=\"box\">\r\n            <img src=\"{{ icon_html }}\" />\r\n          </div>\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"actions-container\">\r\n    <button\r\n      mat-icon-button\r\n      color=\"accent\"\r\n      disableRipple=\"true\"\r\n      (click)=\"openShorcutsDialog()\"\r\n    >\r\n      <mat-icon\r\n        class=\"shortcuts-icon\"\r\n        svgIcon=\"keyboard-outline\"\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\"\r\n      >\r\n      </mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      *ngIf=\"selectedFeatures$.value.length\"\r\n      mat-raised-button\r\n      color=\"primary\"\r\n      (click)=\"openStyleModalDialog()\"\r\n      [matTooltip]=\"'igo.geo.style.styleModalTooltipSelected' | translate\"\r\n    >\r\n      {{ 'igo.geo.style.styleModal' | translate }}\r\n      <mat-icon\r\n        aria-hidden=\"false\"\r\n        iconPositionEnd\r\n        class=\"style-icon\"\r\n        svgIcon=\"palette\"\r\n        [matBadge]=\"selectedFeatures$.value.length\"\r\n        matBadgeColor=\"warn\"\r\n        matBadgeSize=\"medium\"\r\n      >\r\n      </mat-icon>\r\n    </button>\r\n  </div>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter,\r\n  ViewChild\r\n} from '@angular/core';\r\n\r\nimport {\r\n  FEATURE,\r\n  FeatureStore,\r\n  FeatureStoreSelectionStrategy,\r\n  tryAddLoadingStrategy,\r\n  tryAddSelectionStrategy,\r\n  FeatureMotion,\r\n  FeatureStoreLoadingStrategy,\r\n  featureToOl\r\n} from '../../feature';\r\n\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\r\nimport { FontType } from '../../style/shared/font.enum';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\r\nimport {\r\n  UntypedFormGroup,\r\n  UntypedFormBuilder,\r\n  UntypedFormControl\r\n} from '@angular/forms';\r\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { DrawControl } from '../../geometry/shared/controls/draw';\r\nimport {\r\n  EntityRecord,\r\n  EntityTableButton,\r\n  EntityTableColumnRenderer,\r\n  EntityTableTemplate\r\n} from '@igo2/common';\r\n\r\nimport * as OlStyle from 'ol/style';\r\nimport * as olproj from 'ol/proj';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { getDistance, getLength } from 'ol/sphere';\r\nimport { DrawStyleService } from '../../style/style-service/draw-style.service';\r\nimport { first, skip } from 'rxjs/operators';\r\nimport { DrawPopupComponent } from './draw-popup.component';\r\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\r\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\r\nimport { createInteractionStyle, DDtoDMS } from '../shared/draw.utils';\r\nimport { transform } from 'ol/proj';\r\nimport { DrawIconService } from '../shared/draw-icon.service';\r\nimport { StyleModalDrawingComponent } from '../../style/style-modal/drawing/style-modal-drawing.component';\r\nimport { StyleModalData } from '../../style/style-modal/shared/style-modal.interface';\r\n\r\nimport {\r\n  trigger,\r\n  state,\r\n  style,\r\n  animate,\r\n  transition\r\n} from '@angular/animations';\r\n\r\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\r\n\r\nimport {\r\n  measureOlGeometryLength,\r\n  measureOlGeometryArea,\r\n  metersToUnit,\r\n  squareMetersToUnit\r\n} from '../../measure/shared/measure.utils';\r\n\r\nimport {\r\n  MeasureLengthUnit,\r\n  MeasureLengthUnitAbbreviation,\r\n  MeasureAreaUnit,\r\n  MeasureAreaUnitAbbreviation\r\n} from '../../measure/shared/measure.enum';\r\nimport Polygon, { fromCircle } from 'ol/geom/Polygon';\r\n\r\n@Component({\r\n  selector: 'igo-draw',\r\n  animations: [\r\n    trigger('openClose', [\r\n      state(\r\n        'open',\r\n        style({\r\n          opacity: 1\r\n        })\r\n      ),\r\n      state(\r\n        'closed',\r\n        style({\r\n          opacity: 0\r\n        })\r\n      ),\r\n      transition('open => closed', [animate('600ms ease')]),\r\n      transition('closed => open', [animate('800ms ease')])\r\n    ])\r\n  ],\r\n  templateUrl: './draw.component.html',\r\n  styleUrls: ['./draw.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class DrawComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Table template\r\n   * @internal\r\n   */\r\n  public tableTemplate: EntityTableTemplate;\r\n\r\n  public geometryType = GeometryType; // Reference to the GeometryType enum\r\n  @Input() map: IgoMap; // Map to draw on\r\n\r\n  @Input()\r\n  get stores(): FeatureStore<FeatureWithDraw>[] {\r\n    return this._stores;\r\n  }\r\n  set stores(value: FeatureStore<FeatureWithDraw>[]) {\r\n    this._stores = value;\r\n  }\r\n  private _stores: FeatureStore<FeatureWithDraw>[] = [];\r\n\r\n  @Input()\r\n  get drawControls(): [string, DrawControl][] {\r\n    return this._drawControls;\r\n  }\r\n  set drawControls(value: [string, DrawControl][]) {\r\n    this._drawControls = value;\r\n  }\r\n  private _drawControls = [];\r\n\r\n  @Input()\r\n  get activeDrawingLayer(): VectorLayer {\r\n    return this._activeDrawingLayer;\r\n  }\r\n  set activeDrawingLayer(value: VectorLayer) {\r\n    this._activeDrawingLayer = value;\r\n  }\r\n  private _activeDrawingLayer: VectorLayer;\r\n\r\n  @Output() activeLayerChange = new EventEmitter<VectorLayer>();\r\n  @Output() drawControlsEvent = new EventEmitter<[string, DrawControl][]>();\r\n  @Output() layersIDEvent = new EventEmitter<string>();\r\n\r\n  @Output() fillColor: string;\r\n  @Output() strokeColor: string;\r\n  @Output() strokeWidth: number;\r\n\r\n  @Output() fontSize: string;\r\n  @Output() fontStyle: string;\r\n\r\n  public activeStore: FeatureStore<FeatureWithDraw>;\r\n  private layerCounterID: number = 0;\r\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\r\n  private activeDrawingLayerSource = new OlVectorSource();\r\n  private activeDrawControl: DrawControl;\r\n  private drawEnd$$: Subscription;\r\n  private drawSelect$$: Subscription;\r\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> =\r\n    new BehaviorSubject([]);\r\n  public fillForm: string;\r\n  public strokeForm: string;\r\n  public drawControlIsDisabled: boolean = true;\r\n  public drawControlIsActive: boolean = false;\r\n  public labelsAreShown: boolean;\r\n  public freehandMode = false;\r\n  private subscriptions$$: Subscription[] = [];\r\n\r\n  public position: string = 'bottom';\r\n  public form: UntypedFormGroup;\r\n  public icons: Array<string>;\r\n  public icon: string;\r\n\r\n  public radiusFormControl = new UntypedFormControl(1000);\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n  public radiusFormControlChange$$: Subscription = new Subscription();\r\n  public predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  public radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\r\n  }\r\n  private numberOfDrawings: number;\r\n  public isCreatingNewLayer: boolean = false;\r\n  private currGeometryType = this.geometryType.Point as any;\r\n\r\n  @ViewChild('selectedLayer') select;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private drawStyleService: DrawStyleService,\r\n    private dialog: MatDialog,\r\n    private drawIconService: DrawIconService\r\n  ) {\r\n    this.tableTemplate = {\r\n      selection: true,\r\n      selectMany: true,\r\n      selectionCheckbox: true,\r\n      sort: true,\r\n      fixedHeader: true,\r\n      tableHeight: 'auto',\r\n      columns: [\r\n        {\r\n          name: 'Drawing',\r\n          title: this.languageService.translate.instant('igo.geo.draw.labels'),\r\n          valueAccessor: (feature: FeatureWithDraw) => {\r\n            return feature.properties.draw;\r\n          }\r\n        },\r\n        {\r\n          name: 'Edition',\r\n          title: '',\r\n          sort: false,\r\n          valueAccessor: (feature: FeatureWithDraw) => {\r\n            return [\r\n              {\r\n                editMode: false,\r\n                icon: 'pencil',\r\n                color: 'primary',\r\n                click: () => {\r\n                  this.editLabelDrawing(feature);\r\n                },\r\n                style: 'mat-icon-button'\r\n              }\r\n            ] as EntityTableButton[];\r\n          },\r\n          renderer: EntityTableColumnRenderer.ButtonGroup\r\n        }\r\n      ]\r\n    };\r\n    this.buildForm();\r\n    this.fillColor = this.drawStyleService.getFillColor();\r\n    this.strokeColor = this.drawStyleService.getStrokeColor();\r\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\r\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\r\n    this.icons = this.drawIconService.getIcons();\r\n    this.icon = this.drawStyleService.getIcon();\r\n\r\n    this.fontSize = this.drawStyleService.getFontSize();\r\n    this.fontStyle = this.drawStyleService.getFontStyle();\r\n  }\r\n\r\n  // Initialize the store that will contain the entities and create the Draw control\r\n  ngOnInit() {\r\n    if (!this.stores.length) {\r\n      this.activeStore = new FeatureStore<FeatureWithDraw>([], {\r\n        map: this.map\r\n      });\r\n      this.initStore();\r\n      this.activeDrawControl = this.createDrawControl(\r\n        this.fillColor,\r\n        this.strokeColor,\r\n        this.strokeWidth\r\n      );\r\n      this.activeDrawControl.setGeometryType(this.geometryType.Point as any);\r\n      this.toggleDrawControl();\r\n      this.stores.push(this.activeStore);\r\n      this.drawControls.push([\r\n        this.activeDrawingLayer.id,\r\n        this.activeDrawControl\r\n      ]);\r\n      this.drawControlsEvent.emit(this.drawControls);\r\n      this.layersIDEvent.emit(this.activeDrawingLayer.id);\r\n      this.onLayerChange(this.activeDrawingLayer);\r\n    } else {\r\n      this.activeStore = this.stores.find(\r\n        (store) => store.layer.id === this.activeDrawingLayer.id\r\n      );\r\n      this.activeDrawControl = this.drawControls.find(\r\n        (dc) => dc[0] === this.activeDrawingLayer.id\r\n      )[1];\r\n      this.deactivateDrawControl();\r\n      this.allLayers.forEach((layer) => {\r\n        if (layer.id !== this.activeDrawingLayer.id) {\r\n          layer.opacity = 0;\r\n        }\r\n        let store = this.stores.find((s) => s.layer.id === layer.id);\r\n\r\n        this.subscriptions$$.push(\r\n          store.stateView\r\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\r\n              return record.state.selected === true;\r\n            })\r\n            .pipe(first())\r\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\r\n              records.forEach((record) => {\r\n                record.state.selected = false;\r\n              });\r\n            })\r\n        );\r\n\r\n        this.subscriptions$$.push(\r\n          store.stateView\r\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\r\n              return record.state.selected === true;\r\n            })\r\n            .pipe(\r\n              skip(1) // Skip initial emission\r\n            )\r\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\r\n              this.selectedFeatures$.next(\r\n                records.map((record) => record.entity)\r\n              );\r\n            })\r\n        );\r\n\r\n        this.subscriptions$$.push(\r\n          store.count$.subscribe((cnt) => {\r\n            cnt >= 1\r\n              ? (this.activeStore.layer.options.showInLayerList = true)\r\n              : (this.activeStore.layer.options.showInLayerList = false);\r\n          })\r\n        );\r\n      });\r\n      this.onLayerChange(this.activeDrawingLayer);\r\n    }\r\n\r\n    this.radiusFormControlChange$$ =\r\n      this.radiusFormControl.valueChanges.subscribe((value) => {\r\n        if (this.activeDrawControl.ispredefinedRadius$.getValue()) {\r\n          this.changeRadius(value);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Remove the drawing layer and the interactions\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.allLayers.forEach((layer) => (layer.opacity = 1));\r\n    this.activeStore.state.updateAll({ selected: false });\r\n    this.deactivateDrawControl();\r\n    this.subscriptions$$.map((s) => s.unsubscribe());\r\n    this.radiusFormControlChange$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Create a Draw Control\r\n   * @param fillColor the fill color\r\n   * @param strokeColor the stroke color\r\n   * @param strokeWidth the stroke width\r\n   * @returns a Draw Control\r\n   */\r\n  createDrawControl(\r\n    fillColor?: string,\r\n    strokeColor?: string,\r\n    strokeWidth?: number\r\n  ) {\r\n    const activeDrawControl = new DrawControl({\r\n      geometryType: undefined,\r\n      drawingLayerSource: this.activeDrawingLayerSource,\r\n      drawingLayerStyle: new OlStyle.Style({}),\r\n      interactionStyle: createInteractionStyle(\r\n        fillColor,\r\n        strokeColor,\r\n        strokeWidth\r\n      )\r\n    });\r\n    return activeDrawControl;\r\n  }\r\n\r\n  /**\r\n   * Store initialization, including drawing layer creation\r\n   */\r\n\r\n  private initStore(newTitle?: string, isNewLayer?: boolean) {\r\n    this.createLayer(newTitle, isNewLayer);\r\n    this.subscriptions$$.push(\r\n      this.activeStore.stateView\r\n        .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\r\n          return record.state.selected === true;\r\n        })\r\n        .pipe(\r\n          skip(1) // Skip initial emission\r\n        )\r\n        .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\r\n          this.selectedFeatures$.next(records.map((record) => record.entity));\r\n        })\r\n    );\r\n\r\n    this.subscriptions$$.push(\r\n      this.activeStore.count$.subscribe((cnt) => {\r\n        cnt >= 1\r\n          ? (this.activeStore.layer.options.showInLayerList = true)\r\n          : (this.activeStore.layer.options.showInLayerList = false);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Open the style modal dialog box\r\n   */\r\n  openStyleModalDialog() {\r\n    setTimeout(() => {\r\n      // open the dialog box used to style features\r\n      const dialogRef = this.dialog.open(StyleModalDrawingComponent, {\r\n        disableClose: false,\r\n        data: {\r\n          features: this.selectedFeatures$.getValue(),\r\n          icons: this.icons,\r\n          icon: this.icon\r\n        },\r\n        autoFocus: false\r\n      });\r\n\r\n      // when dialog box is closed, get label and set it to geometry\r\n      dialogRef.afterClosed().subscribe((data: StyleModalData) => {\r\n        // checks if the user clicked ok\r\n        if (dialogRef.componentInstance.confirmFlag) {\r\n          this.onFontChange(this.labelsAreShown, data.fontSize, data.fontStyle);\r\n          this.onColorChange(\r\n            this.labelsAreShown,\r\n            this.icon ? true : false,\r\n            data.fillColor,\r\n            data.strokeColor\r\n          );\r\n          this.onOffsetLabelChange(\r\n            this.labelsAreShown,\r\n            data.offsetX,\r\n            data.offsetY\r\n          );\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  /**\r\n   * Open a dialog box to enter label and do something\r\n   * @param olGeometry geometry at draw end or selected geometry\r\n   * @param drawEnd event fired at drawEnd?\r\n   */\r\n  private openDrawDialog(olGeometry, isDrawEnd: boolean) {\r\n    setTimeout(() => {\r\n      // open the dialog box used to enter label\r\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\r\n        disableClose: false,\r\n        data: { olGeometry: olGeometry, map: this.map }\r\n      });\r\n\r\n      // when dialog box is closed, get label and set it to geometry\r\n      dialogRef.afterClosed().subscribe((result) => {\r\n        // checks if the user clicked ok\r\n        if (dialogRef.componentInstance.confirmFlag) {\r\n          this.updateLabelOfOlGeometry(olGeometry, result.label);\r\n          this.updateLabelType(\r\n            olGeometry,\r\n            dialogRef.componentInstance.labelFlag\r\n          );\r\n          this.updateMeasureUnit(olGeometry, result.measureUnit);\r\n\r\n          if (!(olGeometry instanceof OlFeature)) {\r\n            this.updateFontSizeAndStyle(olGeometry, '15', FontType.Arial);\r\n            this.updateFillAndStrokeColor(\r\n              olGeometry,\r\n              'rgba(255,255,255,0.4)',\r\n              'rgba(143,7,7,1)'\r\n            );\r\n            this.updateOffset(\r\n              olGeometry,\r\n              0,\r\n              olGeometry instanceof OlPoint ? -15 : 0\r\n            );\r\n          }\r\n\r\n          isDrawEnd\r\n            ? this.onDrawEnd(olGeometry)\r\n            : this.onSelectDraw(olGeometry, result.label, [\r\n                dialogRef.componentInstance.labelFlag,\r\n                result.measureUnit\r\n              ]);\r\n          this.updateHeightTable();\r\n        }\r\n        // deletes the feature\r\n        else {\r\n          this.activeDrawingLayerSource\r\n            .getFeatures()\r\n            .forEach((drawingLayerFeature) => {\r\n              const geometry = drawingLayerFeature.getGeometry() as any;\r\n              if (olGeometry === geometry) {\r\n                this.activeDrawingLayerSource.removeFeature(\r\n                  drawingLayerFeature\r\n                );\r\n              }\r\n            });\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\r\n    this.addFeatureToStore(olGeometry, radius);\r\n    this.clearLabelsOfOlGeometry(olGeometry);\r\n    this.activeStore.layer.ol.getSource().refresh();\r\n  }\r\n\r\n  private onModifyDraw(olGeometry) {\r\n    const entities = this.activeStore.all();\r\n\r\n    entities.forEach((entity) => {\r\n      const entityId = entity.properties.id;\r\n      const olGeometryId = olGeometry.ol_uid;\r\n\r\n      if (entityId === olGeometryId) {\r\n        if (entity.properties.labelType === LabelType.Coordinates) {\r\n          let longLat = DDtoDMS(\r\n            [entity.properties.longitude, entity.properties.latitude],\r\n            entity.properties.measureUnit as CoordinatesUnit\r\n          );\r\n          this.updateLabelOfOlGeometry(\r\n            olGeometry,\r\n            '(' + longLat[1] + ', ' + longLat[0] + ')'\r\n          );\r\n        } else if (entity.properties.labelType === LabelType.Length) {\r\n          if (olGeometry instanceof OlCircle) {\r\n            let circularPolygon = fromCircle(olGeometry, 10000);\r\n            const radius = metersToUnit(\r\n              this.getRadius(circularPolygon),\r\n              entity.properties.measureUnit as MeasureLengthUnit\r\n            );\r\n            const unit =\r\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\r\n            const radiusLabel =\r\n              'R: ' + radius.toFixed(2).toString() + ' ' + unit;\r\n            this.updateLabelOfOlGeometry(olGeometry, radiusLabel);\r\n          } else {\r\n            let olGeometryLength = measureOlGeometryLength(\r\n              olGeometry,\r\n              this.map.ol.getView().getProjection().getCode()\r\n            );\r\n            let measureUnit: any;\r\n            const temp: MeasureLengthUnit = entity.properties\r\n              .measureUnit as MeasureLengthUnit;\r\n            measureUnit =\r\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\r\n            olGeometryLength = metersToUnit(olGeometryLength, temp);\r\n            let lengthLabel =\r\n              olGeometry instanceof Polygon\r\n                ? 'P: ' +\r\n                  olGeometryLength.toFixed(2).toString() +\r\n                  ' ' +\r\n                  measureUnit\r\n                : olGeometryLength.toFixed(2).toString() + ' ' + measureUnit;\r\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\r\n          }\r\n        } else if (entity.properties.labelType === LabelType.Area) {\r\n          if (olGeometry instanceof OlCircle) {\r\n            let circularPolygon = fromCircle(olGeometry, 10000);\r\n            let circleArea = measureOlGeometryArea(\r\n              circularPolygon,\r\n              this.map.ol.getView().getProjection().getCode()\r\n            );\r\n            const unit =\r\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\r\n            const temp: MeasureAreaUnit = entity.properties\r\n              .measureUnit as MeasureAreaUnit;\r\n            circleArea = squareMetersToUnit(circleArea, temp);\r\n            const areaLabel = circleArea.toFixed(2).toString() + ' ' + unit;\r\n            this.updateLabelOfOlGeometry(olGeometry, areaLabel);\r\n          } else {\r\n            let olGeometryArea = measureOlGeometryArea(\r\n              olGeometry,\r\n              this.map.ol.getView().getProjection().getCode()\r\n            );\r\n            let measureUnit: any;\r\n            const temp: MeasureAreaUnit = entity.properties\r\n              .measureUnit as MeasureAreaUnit;\r\n            measureUnit =\r\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\r\n            olGeometryArea = squareMetersToUnit(olGeometryArea, temp);\r\n            const lengthLabel =\r\n              olGeometryArea.toFixed(2).toString() + ' ' + measureUnit;\r\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\r\n          }\r\n        } else {\r\n          this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\r\n        }\r\n\r\n        this.updateLabelType(olGeometry, entity.properties.labelType);\r\n        this.updateMeasureUnit(olGeometry, entity.properties.measureUnit);\r\n        this.updateFontSizeAndStyle(\r\n          olGeometry,\r\n          entity.properties.fontStyle.split(' ')[0].replace('px', ''),\r\n          entity.properties.fontStyle.substring(\r\n            entity.properties.fontStyle.indexOf(' ') + 1\r\n          )\r\n        );\r\n        this.updateFillAndStrokeColor(\r\n          olGeometry,\r\n          entity.properties.drawingStyle.fill,\r\n          entity.properties.drawingStyle.stroke\r\n        );\r\n        this.updateOffset(\r\n          olGeometry,\r\n          entity.properties.offsetX,\r\n          entity.properties.offsetY\r\n        );\r\n        this.replaceFeatureInStore(entity, olGeometry);\r\n      }\r\n    });\r\n  }\r\n\r\n  private onSelectDraw(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    label: string,\r\n    labelTypeAndUnit?\r\n  ) {\r\n    const entities = this.activeStore.all();\r\n\r\n    const olGeometry = olFeature.getGeometry() as any;\r\n    olGeometry.ol_uid = olFeature.get('id');\r\n\r\n    const olGeometryCoordinates = JSON.stringify(\r\n      olGeometry.getCoordinates()[0]\r\n    );\r\n\r\n    entities.forEach((entity) => {\r\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\r\n      if (olGeometryCoordinates === entityCoordinates) {\r\n        const fontSize = olFeature\r\n          .get('fontStyle')\r\n          .split(' ')[0]\r\n          .replace('px', '');\r\n        const fontStyle = olFeature\r\n          .get('fontStyle')\r\n          .substring(olFeature.get('fontStyle').indexOf(' ') + 1);\r\n\r\n        const fillColor = olFeature.get('drawingStyle').fill;\r\n        const strokeColor = olFeature.get('drawingStyle').stroke;\r\n\r\n        const offsetX = olFeature.get('offsetX');\r\n        const offsetY = olFeature.get('offsetY');\r\n\r\n        const rad: number = entity.properties.rad\r\n          ? entity.properties.rad\r\n          : undefined;\r\n        this.updateLabelOfOlGeometry(olGeometry, label);\r\n        this.updateFontSizeAndStyle(olGeometry, fontSize, fontStyle);\r\n        this.updateFillAndStrokeColor(olGeometry, fillColor, strokeColor);\r\n        this.updateOffset(olGeometry, offsetX, offsetY);\r\n        this.updateLabelType(olGeometry, labelTypeAndUnit[0]);\r\n        this.updateMeasureUnit(olGeometry, labelTypeAndUnit[1]);\r\n        this.replaceFeatureInStore(entity, olGeometry, rad);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add a feature with draw label to the store. The loading stragegy of the store\r\n   * will trigger and add the feature to the map.\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(\r\n    olGeometry,\r\n    radius?: number,\r\n    feature?: FeatureWithDraw\r\n  ) {\r\n    let rad: number;\r\n    let center4326: Array<number>;\r\n    let point4326: Array<number>;\r\n    let lon4326: number;\r\n    let lat4326: number;\r\n\r\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\r\n    const projection = this.map.ol.getView().getProjection();\r\n\r\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\r\n      featureProjection: projection,\r\n      dataProjection: projection\r\n    }) as any;\r\n\r\n    if (olGeometry instanceof OlCircle || radius) {\r\n      if (radius) {\r\n        rad = radius;\r\n      } else {\r\n        geometry.type = 'Point';\r\n        geometry.coordinates = olGeometry.getCenter();\r\n        const extent4326 = transform(\r\n          [\r\n            olGeometry.getFlatCoordinates()[2],\r\n            olGeometry.getFlatCoordinates()[3]\r\n          ],\r\n          projection,\r\n          'EPSG:4326'\r\n        );\r\n        center4326 = transform(\r\n          [\r\n            olGeometry.getFlatCoordinates()[0],\r\n            olGeometry.getFlatCoordinates()[1]\r\n          ],\r\n          projection,\r\n          'EPSG:4326'\r\n        );\r\n        lon4326 = center4326[0];\r\n        lat4326 = center4326[1];\r\n        rad = getDistance(center4326, extent4326);\r\n        this.radiusFormControl.setValue(Math.round(rad));\r\n      }\r\n    }\r\n    if (this.activeDrawControl.radiusDrawEnd$.getValue()) {\r\n      rad = this.activeDrawControl.radiusDrawEnd$.getValue();\r\n    }\r\n\r\n    if (olGeometry instanceof OlPoint) {\r\n      point4326 = transform(\r\n        olGeometry.getFlatCoordinates(),\r\n        projection,\r\n        'EPSG:4326'\r\n      );\r\n      lon4326 = point4326[0];\r\n      lat4326 = point4326[1];\r\n    }\r\n\r\n    this.activeStore.update({\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: projection.getCode(),\r\n      properties: {\r\n        id: featureId,\r\n        draw: olGeometry.get('_label'),\r\n        longitude: lon4326 ? lon4326 : null,\r\n        latitude: lat4326 ? lat4326 : null,\r\n        rad: rad ? rad : null,\r\n        fontStyle: olGeometry.get('fontStyle_'),\r\n        drawingStyle: {\r\n          fill: olGeometry.get('fillColor_'),\r\n          stroke: olGeometry.get('strokeColor_')\r\n        },\r\n        offsetX: olGeometry.get('offsetX_'),\r\n        offsetY: olGeometry.get('offsetY_'),\r\n        labelType: olGeometry.get('labelType_'),\r\n        measureUnit: olGeometry.get('measureUnit_')\r\n      },\r\n      meta: {\r\n        id: featureId\r\n      }\r\n    });\r\n    this.activeStore.setLayerExtent();\r\n    this.activeDrawControl.predefinedRadius$.next(undefined);\r\n    this.activeDrawControl.radiusDrawEnd$.next(undefined);\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      fill: [''],\r\n      stroke: ['']\r\n    });\r\n  }\r\n\r\n  public setupLayer(isNewLayer?: boolean) {\r\n    setTimeout(() => {\r\n      const dialogRef = this.dialog.open(DrawLayerPopupComponent, {\r\n        disableClose: false\r\n      });\r\n      dialogRef.afterClosed().subscribe((label: string) => {\r\n        if (dialogRef.componentInstance.confirmFlag) {\r\n          this.activeStore.state.updateAll({ selected: false });\r\n          this.activeStore = new FeatureStore<FeatureWithDraw>([], {\r\n            map: this.map\r\n          });\r\n          this.activeDrawingLayerSource = new OlVectorSource();\r\n          this.activeDrawingLayer.opacity = 0;\r\n          this.deactivateDrawControl();\r\n          this.initStore(label, isNewLayer);\r\n          this.activeDrawControl = this.createDrawControl(\r\n            this.fillColor,\r\n            this.strokeColor,\r\n            this.strokeWidth\r\n          );\r\n          this.activeDrawControl.setGeometryType(this.currGeometryType);\r\n          this.toggleDrawControl();\r\n          this.stores.push(this.activeStore);\r\n          this.drawControls.push([\r\n            this.activeDrawingLayer.id,\r\n            this.activeDrawControl\r\n          ]);\r\n          this.drawControlsEvent.emit(this.drawControls);\r\n          this.layersIDEvent.emit(this.activeDrawingLayer.id);\r\n          this.isCreatingNewLayer = false;\r\n          if (!this.labelsAreShown) {\r\n            this.onToggleLabels();\r\n          }\r\n          this.activeLayerChange.emit(this.activeDrawingLayer);\r\n        } else {\r\n          this.select.value = this.activeDrawingLayer;\r\n          this.select.selectionChange.emit(this.activeDrawingLayer);\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  // HTML user interactions\r\n\r\n  /**\r\n   * Called when the user double-clicks the selected drawing\r\n   */\r\n  editLabelDrawing(feature) {\r\n    const olGeometryFeature = featureToOl(\r\n      feature,\r\n      this.map.ol.getView().getProjection().getCode()\r\n    );\r\n    this.openDrawDialog(olGeometryFeature, false);\r\n  }\r\n\r\n  openShorcutsDialog() {\r\n    this.dialog.open(DrawShorcutsComponent);\r\n  }\r\n\r\n  deleteDrawings() {\r\n    this.activeStore.deleteMany(this.selectedFeatures$.value);\r\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\r\n      this.activeDrawingLayerSource\r\n        .getFeatures()\r\n        .forEach((drawingLayerFeature) => {\r\n          const geometry = drawingLayerFeature.getGeometry() as any;\r\n          if (selectedFeature.properties.id === geometry.ol_uid) {\r\n            this.activeDrawingLayerSource.removeFeature(drawingLayerFeature);\r\n          }\r\n        });\r\n    });\r\n    this.updateHeightTable();\r\n    this.activeStore.setLayerExtent();\r\n  }\r\n\r\n  /**\r\n   * Called when the user toggles the labels toggle\r\n   */\r\n  onToggleLabels() {\r\n    this.drawStyleService.toggleLabelsAreShown();\r\n    this.labelsAreShown = !this.labelsAreShown;\r\n    this.icon\r\n      ? this.elementStyle(this.labelsAreShown, true)\r\n      : this.elementStyle(this.labelsAreShown, false);\r\n    this.createDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Called when the user toggles the Draw control is toggled\r\n   * @internal\r\n   */\r\n  onToggleDrawControl(toggleIsChecked: boolean) {\r\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\r\n  }\r\n\r\n  onToggleFreehandMode(event: any) {\r\n    if (this.isCircle() && !event.checked) {\r\n      this.activeDrawControl.ispredefinedRadius$.next(true);\r\n      this.changeRadius(this.radiusFormControl.value);\r\n    } else {\r\n      this.activeDrawControl.setOlInteractionStyle(\r\n        createInteractionStyle(\r\n          this.fillColor,\r\n          this.strokeColor,\r\n          this.strokeWidth\r\n        )\r\n      );\r\n      this.activeDrawControl.ispredefinedRadius$.next(false);\r\n    }\r\n    this.freehandMode = event.checked;\r\n    this.activeDrawControl.freehand$.next(event.checked);\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  // User changes properties of a drawing element\r\n\r\n  /**\r\n   * Display the current layer with the current store and the current layerSource\r\n   */\r\n\r\n  public onLayerChange(currLayer?: VectorLayer) {\r\n    if (currLayer) {\r\n      this.activeStore.state.updateAll({ selected: false });\r\n      this.isCreatingNewLayer = false;\r\n      this.activeDrawingLayer.opacity = 0;\r\n      this.activeDrawingLayer = currLayer;\r\n      this.activeDrawingLayer.opacity = 1;\r\n      this.deactivateDrawControl();\r\n      if (!this.labelsAreShown) {\r\n        this.onToggleLabels();\r\n      }\r\n      this.activeStore = this.stores.find(\r\n        (store) => store.layer.id === this.activeDrawingLayer.id\r\n      );\r\n      this.activeDrawControl = this.drawControls.find(\r\n        (dc) => dc[0] === this.activeDrawingLayer.id\r\n      )[1];\r\n      this.activeDrawingLayerSource =\r\n        this.activeDrawControl.olDrawingLayerSource;\r\n      this.activeDrawControl.setGeometryType(this.currGeometryType);\r\n      this.toggleDrawControl();\r\n    } else {\r\n      this.setupLayer(true);\r\n    }\r\n    this.activeLayerChange.emit(this.activeDrawingLayer);\r\n  }\r\n\r\n  public createLayer(newTitle?, isNewLayer?) {\r\n    for (const layer of this.allLayers) {\r\n      let numberId = Number(layer.id.replace('igo-draw-layer', ''));\r\n      this.layerCounterID = Math.max(numberId, this.layerCounterID);\r\n    }\r\n    this.activeDrawingLayer = new VectorLayer({\r\n      isIgoInternalLayer: true,\r\n      id: 'igo-draw-layer' + ++this.layerCounterID,\r\n      title: isNewLayer\r\n        ? newTitle\r\n        : this.languageService.translate.instant('igo.geo.draw.drawing'),\r\n      zIndex: 200,\r\n      source: new FeatureDataSource(),\r\n      style: (feature, resolution) => {\r\n        return this.drawStyleService.createIndividualElementStyle(\r\n          feature,\r\n          resolution,\r\n          this.labelsAreShown,\r\n          feature.get('fontStyle'),\r\n          feature.get('drawingStyle').fill,\r\n          feature.get('drawingStyle').stroke,\r\n          feature.get('offsetX'),\r\n          feature.get('offsetY'),\r\n          this.map.projection,\r\n          this.icon\r\n        );\r\n      },\r\n      showInLayerList: true,\r\n      exportable: true,\r\n      browsable: false,\r\n      workspace: {\r\n        enabled: false\r\n      }\r\n    });\r\n\r\n    tryBindStoreLayer(this.activeStore, this.activeDrawingLayer);\r\n\r\n    tryAddLoadingStrategy(\r\n      this.activeStore,\r\n      new FeatureStoreLoadingStrategy({\r\n        motion: FeatureMotion.None\r\n      })\r\n    );\r\n\r\n    tryAddSelectionStrategy(\r\n      this.activeStore,\r\n      new FeatureStoreSelectionStrategy({\r\n        map: this.map,\r\n        motion: FeatureMotion.None,\r\n        many: true\r\n      })\r\n    );\r\n    this.activeStore.layer.visible = true;\r\n    this.activeStore.source.ol.on(\r\n      'removefeature',\r\n      (event: OlVectorSourceEvent<OlGeometry>) => {\r\n        const olGeometry = event.feature.getGeometry();\r\n        this.clearLabelsOfOlGeometry(olGeometry);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Called when the user changes the color in a color picker\r\n   * @param labelsAreShown wheter the labels are shown or not\r\n   * @param isAnIcon wheter the feature is an icon or not\r\n   * @param fillColor which is the filling color\r\n   * @param strokeColor which is the stroke color\r\n   */\r\n  onColorChange(\r\n    labelsAreShown: boolean,\r\n    isAnIcon: boolean,\r\n    fillColor: string,\r\n    strokeColor: string\r\n  ) {\r\n    if (this.selectedFeatures$.value.length > 0 && !isAnIcon) {\r\n      this.selectedFeatures$.value.forEach((feature) => {\r\n        let olFeature = featureToOl(\r\n          feature,\r\n          this.map.ol.getView().getProjection().getCode()\r\n        );\r\n        this.updateFillAndStrokeColor(olFeature, fillColor, strokeColor);\r\n\r\n        const entity = this.activeStore\r\n          .all()\r\n          .find((e) => e.meta.id === olFeature.getId());\r\n        entity.properties.drawingStyle.fill = olFeature.get('fillColor_');\r\n        entity.properties.drawingStyle.stroke = olFeature.get('strokeColor_');\r\n        this.activeStore.update(entity);\r\n      });\r\n    }\r\n\r\n    this.elementStyle(labelsAreShown, isAnIcon);\r\n    this.createDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Called when the user changes the font size or/and style\r\n   * @param labelsAreShown wheter the labels are shown or not\r\n   * @param size the size of the font\r\n   * @param style the style of the font\r\n   */\r\n\r\n  onFontChange(labelsAreShown: boolean, size: string, style: FontType) {\r\n    if (this.selectedFeatures$.value.length > 0) {\r\n      this.selectedFeatures$.value.forEach((feature) => {\r\n        let olFeature = featureToOl(\r\n          feature,\r\n          this.map.ol.getView().getProjection().getCode()\r\n        );\r\n        this.updateFontSizeAndStyle(olFeature, size, style);\r\n        const entity = this.activeStore\r\n          .all()\r\n          .find((e) => e.meta.id === olFeature.getId());\r\n        entity.properties.fontStyle = olFeature.get('fontStyle_');\r\n        this.activeStore.update(entity);\r\n        olFeature = this.activeStore.layer.ol\r\n          .getSource()\r\n          .getFeatures()\r\n          .find((f) => f.getId() === entity.meta.id);\r\n        olFeature.setProperties({ fontStyle: entity.properties.fontStyle });\r\n        olFeature.changed();\r\n      });\r\n\r\n      this.fontSize = size;\r\n      this.fontStyle = style;\r\n\r\n      this.drawStyleService.setFontSize(size);\r\n      this.drawStyleService.setFontStyle(style);\r\n\r\n      this.elementStyle(labelsAreShown);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Called when the user changes the value of the horizontal/vertical offset\r\n   * @param labelsAreShown wheter the labels are shown or not\r\n   * @param offsetX horizontal offset of the label\r\n   * @param offsetY vertical offset of the label\r\n   */\r\n\r\n  onOffsetLabelChange(\r\n    labelsAreShown: boolean,\r\n    offsetX: number,\r\n    offsetY: number\r\n  ) {\r\n    if (this.selectedFeatures$.value.length > 0) {\r\n      this.selectedFeatures$.value.forEach((feature) => {\r\n        let olFeature = featureToOl(\r\n          feature,\r\n          this.map.ol.getView().getProjection().getCode()\r\n        );\r\n        this.updateOffset(olFeature, offsetX, offsetY);\r\n        const entity = this.activeStore\r\n          .all()\r\n          .find((e) => e.meta.id === olFeature.getId());\r\n        entity.properties.offsetX = olFeature.get('offsetX_');\r\n        entity.properties.offsetY = olFeature.get('offsetY_');\r\n        this.activeStore.update(entity);\r\n        olFeature = this.activeStore.layer.ol\r\n          .getSource()\r\n          .getFeatures()\r\n          .find((f) => f.getId() === entity.meta.id);\r\n        olFeature.setProperties({\r\n          offsetX: entity.properties.offsetX,\r\n          offsetY: entity.properties.offsetY\r\n        });\r\n        olFeature.changed();\r\n      });\r\n      this.elementStyle(labelsAreShown);\r\n    }\r\n  }\r\n\r\n  onIconChange(event?) {\r\n    this.icon = event;\r\n    this.drawStyleService.setIcon(this.icon);\r\n    this.elementStyle(true, this.icon);\r\n  }\r\n\r\n  /**\r\n   * Called when the user selects a new geometry type\r\n   * @param geometryType the geometry type selected by the user\r\n   */\r\n  onGeometryTypeChange(geometryType: Type) {\r\n    this.currGeometryType = geometryType;\r\n    this.activeDrawControl.setGeometryType(geometryType);\r\n    this.freehandMode\r\n      ? this.onToggleFreehandMode({ checked: true })\r\n      : this.onToggleFreehandMode({ checked: false });\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  // Updates the properties of olFeature inputted\r\n\r\n  /**\r\n   * Update the label of a geometry when a label is entered in a dialog box\r\n   * @param OlFeature the feature\r\n   * @param label the label\r\n   */\r\n  private updateLabelOfOlGeometry(OlFeature, label: string) {\r\n    OlFeature.setProperties(\r\n      {\r\n        _label: label\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateFontSizeAndStyle(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    fontSize: string,\r\n    fontStyle: string\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        fontStyle_: `${fontSize}px ${fontStyle}`\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateFillAndStrokeColor(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    fillColor: string,\r\n    strokeColor: string\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        fillColor_: fillColor,\r\n        strokeColor_: strokeColor\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateOffset(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    offsetX: number,\r\n    offsetY: number\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        offsetX_: offsetX,\r\n        offsetY_: offsetY\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateLabelType(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    typeOfLabel: LabelType | [LabelType, LabelType]\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        labelType_: typeOfLabel\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateMeasureUnit(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    measureUnit: MeasureLengthUnit | MeasureAreaUnit | CoordinatesUnit | []\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        measureUnit_: measureUnit\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  // Updates values of the selected element on the HTML view\r\n\r\n  getFeatureFontSize(): string {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.fontStyle\r\n          .split(' ')[0]\r\n          .replace('px', '')\r\n      : '15';\r\n  }\r\n\r\n  getFeatureFontStyle() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.fontStyle.substring(\r\n          this.selectedFeatures$.value[0].properties.fontStyle.indexOf(' ') + 1\r\n        )\r\n      : FontType.Arial;\r\n  }\r\n\r\n  getFeatureFillColor() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.fill\r\n      : 'rgba(255,255,255,0.4)';\r\n  }\r\n\r\n  getFeatureStrokeColor() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.stroke\r\n      : 'rgba(143,7,7,1)';\r\n  }\r\n\r\n  getFeatureOffsetX() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.offsetX\r\n      : this.drawStyleService.getOffsetX();\r\n  }\r\n\r\n  getFeatureOffsetY() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.offsetY\r\n      : '0';\r\n  }\r\n\r\n  get allFontStyles(): string[] {\r\n    return Object.values(FontType);\r\n  }\r\n\r\n  get allLayers() {\r\n    return this.map.layers.filter((layer) =>\r\n      String(layer.id).includes('igo-draw-layer')\r\n    );\r\n  }\r\n\r\n  updateHeightTable() {\r\n    // Check the amount of rows as a possible alternative\r\n    this.numberOfDrawings = this.activeStore.count$.getValue();\r\n    this.numberOfDrawings > 10\r\n      ? (this.tableTemplate.tableHeight = '35vh')\r\n      : (this.tableTemplate.tableHeight = 'auto');\r\n  }\r\n\r\n  updateActiveLayer() {\r\n    let currLayer = this.allLayers.find(\r\n      (layer) => layer.title === this.activeDrawingLayer.title\r\n    );\r\n    return currLayer ? currLayer : this.allLayers[0];\r\n  }\r\n\r\n  // Helper methods\r\n\r\n  /**\r\n   * Activate the correct control\r\n   */\r\n  private toggleDrawControl() {\r\n    this.deactivateDrawControl();\r\n    this.activateDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Clear the tooltips of an OL geometry\r\n   * @param olGeometry OL geometry with tooltips\r\n   */\r\n  private clearLabelsOfOlGeometry(olGeometry) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach(\r\n      (olTooltip: OlOverlay | undefined) => {\r\n        if (olTooltip && olTooltip.getMap()) {\r\n          this.map.ol.removeOverlay(olTooltip);\r\n        }\r\n      }\r\n    );\r\n  }\r\n  /**\r\n   * Replace the feature in the store\r\n   * @param entity the entity to replace\r\n   * @param olGeometry the new geometry to insert in the store\r\n   */\r\n  private replaceFeatureInStore(\r\n    entity,\r\n    olGeometry: OlGeometry,\r\n    radius?: number\r\n  ) {\r\n    this.activeStore.delete(entity);\r\n    this.onDrawEnd(olGeometry, radius);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active draw control\r\n   */\r\n  private deactivateDrawControl() {\r\n    if (!this.activeDrawControl) {\r\n      return;\r\n    }\r\n\r\n    if (this.drawEnd$$) {\r\n      this.drawEnd$$.unsubscribe();\r\n    }\r\n\r\n    this.activeDrawControl.setOlMap(undefined);\r\n    this.drawControlIsActive = false;\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   */\r\n  private activateDrawControl() {\r\n    this.drawControlIsDisabled = false;\r\n    this.drawControlIsActive = true;\r\n    this.drawEnd$$ = this.activeDrawControl.end$.subscribe(\r\n      (olGeometry: OlGeometry) => {\r\n        this.openDrawDialog(olGeometry, true);\r\n      }\r\n    );\r\n\r\n    this.activeDrawControl.modify$.subscribe((olGeometry: OlGeometry) => {\r\n      this.onModifyDraw(olGeometry);\r\n    });\r\n\r\n    if (!this.drawSelect$$) {\r\n      this.drawSelect$$ = this.activeDrawControl.select$.subscribe(\r\n        (olFeature: OlFeature<OlGeometry>) => {\r\n          this.openDrawDialog(olFeature, false);\r\n        }\r\n      );\r\n    }\r\n    this.activeDrawControl.setOlMap(this.map.ol, true);\r\n  }\r\n\r\n  /**\r\n   * get the geometry of design\r\n   *\r\n   */\r\n\r\n  isPoint() {\r\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Point;\r\n  }\r\n\r\n  isLineString() {\r\n    return (\r\n      this.activeDrawControl.getGeometryType() === this.geometryType.LineString\r\n    );\r\n  }\r\n\r\n  isPolygon() {\r\n    return (\r\n      this.activeDrawControl.getGeometryType() === this.geometryType.Polygon\r\n    );\r\n  }\r\n\r\n  isCircle() {\r\n    return (\r\n      this.activeDrawControl.getGeometryType() === this.geometryType.Circle\r\n    );\r\n  }\r\n\r\n  /**\r\n   * The fonction to predefine the radius of the user\r\n   *\r\n   */\r\n\r\n  changeRadius(radius: number) {\r\n    let radiusMeters: number;\r\n\r\n    if (radius) {\r\n      this.measureUnit === MeasureLengthUnit.Meters\r\n        ? (radiusMeters = radius)\r\n        : (radiusMeters = radius * 1000);\r\n    } else {\r\n      radiusMeters = undefined;\r\n    }\r\n\r\n    const pointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\r\n      const geom = feature.getGeometry() as OlPoint;\r\n      const coordinates = olproj.transform(\r\n        geom.getCoordinates(),\r\n        this.map.projection,\r\n        'EPSG:4326'\r\n      );\r\n\r\n      const radius =\r\n        radiusMeters / Math.cos((Math.PI / 180) * coordinates[1]) / resolution;\r\n      this.activeDrawControl.predefinedRadius$.next(radiusMeters);\r\n      return new OlStyle.Style({\r\n        image: new OlStyle.Circle({\r\n          radius: radius,\r\n          stroke: new OlStyle.Stroke({\r\n            width: 1,\r\n            color: 'rgba(143,7,7,1)'\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'rgba(255,255,255,0.4)'\r\n          })\r\n        })\r\n      });\r\n    };\r\n\r\n    this.activeDrawControl.setOlInteractionStyle(pointStyle);\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  onMeasureUnitChange(selectedMeasureUnit: MeasureLengthUnit) {\r\n    if (selectedMeasureUnit === this.measureUnit) {\r\n      return;\r\n    } else {\r\n      this.measureUnit = selectedMeasureUnit;\r\n      this.measureUnit === MeasureLengthUnit.Meters\r\n        ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\r\n        : this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recreates the style of the feature stored\r\n   */\r\n  private elementStyle(labelsAreShown: boolean, isAnIcon?) {\r\n    if (isAnIcon) {\r\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\r\n        return this.drawStyleService.createIndividualElementStyle(\r\n          feature,\r\n          resolution,\r\n          labelsAreShown,\r\n          feature.get('fontStyle'),\r\n          feature.get('drawingStyle').fill,\r\n          feature.get('drawingStyle').stroke,\r\n          feature.get('offsetX'),\r\n          feature.get('offsetY'),\r\n          this.map.projection,\r\n          this.icon\r\n        );\r\n      });\r\n    } else {\r\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\r\n        return this.drawStyleService.createIndividualElementStyle(\r\n          feature,\r\n          resolution,\r\n          labelsAreShown,\r\n          feature.get('fontStyle'),\r\n          feature.get('drawingStyle').fill,\r\n          feature.get('drawingStyle').stroke,\r\n          feature.get('offsetX'),\r\n          feature.get('offsetY'),\r\n          this.map.projection\r\n        );\r\n      });\r\n    }\r\n  }\r\n\r\n  private getRadius(olGeometry): number {\r\n    const length = getLength(olGeometry);\r\n    return Number(length / (2 * Math.PI));\r\n  }\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { OgcFilterableListComponent } from './ogc-filterable-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoOgcFilterableListBinding]'\r\n})\r\nexport class OgcFilterableListBindingDirective implements OnInit, OnDestroy {\r\n  private component: OgcFilterableListComponent;\r\n  private layers$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: OgcFilterableListComponent,\r\n    private mapService: MapService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    this.component.layers = [];\r\n\r\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\r\n      this.component.layers = layers.filter((layer) => layer.showInLayerList);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n}\r\n","<igo-geometry-form-field-input\r\n  [formControl]=\"formControl\"\r\n  [map]=\"map\"\r\n  [geometryType]=\"geometryType$ | async\"\r\n  [drawGuide]=\"drawGuide$ | async\"\r\n  [measure]=\"measure\"\r\n  [drawControlIsActive]=\"drawControlIsActive\"\r\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\r\n  [controlOptions]=\"controlOptions\"\r\n  [drawStyle]=\"drawStyle\"\r\n  [overlayStyle]=\"overlayStyle\"\r\n>\r\n</igo-geometry-form-field-input>\r\n\r\n<div *ngIf=\"geometryTypeField\" class=\"geometry-type-toggle\">\r\n  <mat-button-toggle-group\r\n    [disabled]=\"(value$ | async) !== undefined\"\r\n    [(ngModel)]=\"geometryType\"\r\n  >\r\n    <mat-button-toggle\r\n      value=\"Point\"\r\n      [disabled]=\"geometryTypes.indexOf('Point') < 0\"\r\n    >\r\n      {{ 'igo.geo.geometry.point' | translate }}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value=\"LineString\"\r\n      [disabled]=\"geometryTypes.indexOf('LineString') < 0\"\r\n    >\r\n      {{ 'igo.geo.geometry.line' | translate }}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value=\"Polygon\"\r\n      [disabled]=\"geometryTypes.indexOf('Polygon') < 0\"\r\n    >\r\n      {{ 'igo.geo.geometry.polygon' | translate }}\r\n    </mat-button-toggle>\r\n  </mat-button-toggle-group>\r\n</div>\r\n\r\n<mat-form-field *ngIf=\"drawGuideField\" class=\"draw-guide-field\">\r\n  <input\r\n    matInput\r\n    type=\"number\"\r\n    [placeholder]=\"drawGuidePlaceholder\"\r\n    [(ngModel)]=\"drawGuide\"\r\n  />\r\n  <mat-icon matPrefix [color]=\"'primary'\" svgIcon=\"adjust\"> </mat-icon>\r\n  <span matSuffix class=\"draw-guide-units\">{{\r\n    'igo.geo.measure.meters' | translate\r\n  }}</span>\r\n</mat-form-field>\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { UntypedFormControl } from '@angular/forms';\r\nimport { IgoFormFieldComponent } from '@igo2/common';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\r\n\r\n/**\r\n * This input allows a user to draw a new geometry or to edit\r\n * an existing one on a map.\r\n */\r\n@IgoFormFieldComponent('geometry')\r\n@Component({\r\n  selector: 'igo-geometry-form-field',\r\n  templateUrl: './geometry-form-field.component.html',\r\n  styleUrls: ['./geometry-form-field.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class GeometryFormFieldComponent implements OnInit, OnDestroy {\r\n  readonly value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  private value$$: Subscription;\r\n\r\n  set drawControlIsActive(value: boolean) {\r\n    this._drawControlIsActive = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  get drawControlIsActive(): boolean {\r\n    return this._drawControlIsActive;\r\n  }\r\n  private _drawControlIsActive = true;\r\n\r\n  set freehandDrawIsActive(value: boolean) {\r\n    this._freehandDrawIsActive = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  get freehandDrawIsActive(): boolean {\r\n    return this._freehandDrawIsActive;\r\n  }\r\n  private _freehandDrawIsActive = false;\r\n\r\n  /**\r\n   * The field's form control\r\n   */\r\n  @Input() formControl: UntypedFormControl;\r\n\r\n  /**\r\n   * The map to draw the geometry on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  set geometryType(value: Type) {\r\n    this.geometryType$.next(value);\r\n  }\r\n  get geometryType(): Type {\r\n    return this.geometryType$.value;\r\n  }\r\n  readonly geometryType$: BehaviorSubject<Type> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Whether a geometry type toggle should be displayed\r\n   */\r\n  @Input() geometryTypeField: boolean = false;\r\n\r\n  /**\r\n   * Available geometry types\r\n   */\r\n  @Input() geometryTypes: string[] = ['Point', 'LineString', 'Polygon'];\r\n\r\n  /**\r\n   * Whether a draw guide field should be displayed\r\n   */\r\n  @Input() drawGuideField: boolean = false;\r\n\r\n  /**\r\n   * The drawGuide around the mouse pointer to help drawing\r\n   */\r\n  @Input()\r\n  set drawGuide(value: number) {\r\n    this.drawGuide$.next(value);\r\n  }\r\n  get drawGuide(): number {\r\n    return this.drawGuide$.value;\r\n  }\r\n  readonly drawGuide$: BehaviorSubject<number> = new BehaviorSubject(0);\r\n\r\n  /**\r\n   * Draw guide placeholder\r\n   */\r\n  @Input() drawGuidePlaceholder: string = '';\r\n\r\n  /**\r\n   * Whether a measure tooltip should be displayed\r\n   */\r\n  @Input() measure: boolean = false;\r\n\r\n  /**\r\n   * Control options\r\n   */\r\n  @Input() controlOptions: { [key: string]: any } = {};\r\n\r\n  /**\r\n   * Style for the draw control (applies while the geometry is being drawn)\r\n   */\r\n  @Input() drawStyle: OlStyleLike;\r\n\r\n  /**\r\n   * Style for the overlay layer (applies once the geometry is added to the map)\r\n   * If not specified, drawStyle applies\r\n   */\r\n  @Input() overlayStyle: OlStyleLike;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Set up a value stream\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.value$.next(\r\n      this.formControl.value ? this.formControl.value : undefined\r\n    );\r\n    this.value$$ = this.formControl.valueChanges.subscribe(\r\n      (value: GeoJSONGeometry) => {\r\n        this.value$.next(value ? value : undefined);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the value stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.value$$.unsubscribe();\r\n  }\r\n}\r\n","export class ImportError extends Error {}\r\n\r\nexport class ImportInvalidFileError extends ImportError {\r\n  constructor() {\r\n    super('Invalid file');\r\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportUnreadableFileError extends ImportError {\r\n  constructor() {\r\n    super('Failed to read file');\r\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportNothingToImportError extends ImportError {\r\n  constructor() {\r\n    super('Nothing to import');\r\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSizeError extends ImportError {\r\n  constructor() {\r\n    super('File is too large');\r\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSRSError extends ImportError {\r\n  constructor() {\r\n    super('Invalid SRS definition');\r\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportOgreServerError extends ImportError {\r\n  constructor() {\r\n    super('Error 500 with OGRE');\r\n    Object.setPrototypeOf(this, ImportOgreServerError.prototype);\r\n  }\r\n}\r\n","import { MessageService } from '@igo2/core';\r\n\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport {\r\n  featureToOl,\r\n  moveToOlFeatures,\r\n  computeOlFeaturesExtent\r\n} from '../../feature/shared/feature.utils';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\r\nimport { StyleListService } from '../../style/style-list/style-list.service';\r\nimport { ClusterParam } from '../../layer/shared/clusterParam';\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\r\nimport { uuid } from '@igo2/utils';\r\nimport {\r\n  featureRandomStyle,\r\n  featureRandomStyleFunction\r\n} from '../../style/shared/feature/feature-style';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { ConfirmDialogService } from '@igo2/common';\r\nimport { first, of } from 'rxjs';\r\n\r\nexport function addLayerAndFeaturesToMap(\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  contextUri: string,\r\n  layerTitle: string,\r\n  layerService: LayerService,\r\n  storeToIdb: boolean = false\r\n): VectorLayer {\r\n  const olFeatures = features.map((feature: Feature) =>\r\n    featureToOl(feature, map.projection)\r\n  );\r\n\r\n  const id = uuid();\r\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n    id,\r\n    type: 'vector',\r\n    queryable: true\r\n  };\r\n  const source = new FeatureDataSource(sourceOptions);\r\n  source.ol.addFeatures(olFeatures);\r\n  let randomStyle;\r\n  let editable: boolean = false;\r\n  if (\r\n    olFeatures[0].getKeys().includes('_style') ||\r\n    olFeatures[0].getKeys().includes('_mapTitle')\r\n  ) {\r\n    randomStyle = featureRandomStyleFunction();\r\n  } else {\r\n    randomStyle = featureRandomStyle();\r\n    editable = true;\r\n  }\r\n  const layer = layerService.createLayer({\r\n    id,\r\n    title: layerTitle,\r\n    workspace: { enabled: true, searchIndexEnabled: true },\r\n    isIgoInternalLayer: true,\r\n    source,\r\n    igoStyle: { editable },\r\n    idbInfo: { firstLoad: true, storeToIdb, contextUri: contextUri || '*' },\r\n    style: randomStyle\r\n  }) as VectorLayer;\r\n  layer.setExtent(computeOlFeaturesExtent(olFeatures, map.viewProjection));\r\n  map.addLayer(layer);\r\n  moveToOlFeatures(map.viewController, olFeatures);\r\n\r\n  return layer;\r\n}\r\n\r\nexport function addLayerAndFeaturesStyledToMap(\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  layerTitle: string,\r\n  styleListService: StyleListService,\r\n  styleService: StyleService,\r\n  layerId?: string,\r\n  imposedSourceOptions?,\r\n  imposedLayerOptions?,\r\n  zoomTo: boolean = true\r\n): VectorLayer {\r\n  const olFeatures = features.map((feature: Feature) =>\r\n    featureToOl(feature, map.projection)\r\n  );\r\n  let style;\r\n  let distance: number;\r\n\r\n  if (\r\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\r\n  ) {\r\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\r\n      layerTitle.toString() + '.styleByAttribute'\r\n    );\r\n\r\n    style = (feature, resolution) => {\r\n      return styleService.createStyleByAttribute(\r\n        feature,\r\n        styleByAttribute,\r\n        resolution\r\n      );\r\n    };\r\n  } else if (\r\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\r\n  ) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(\r\n      layerTitle.toString() + '.clusterParam'\r\n    );\r\n    distance = styleListService.getStyleList(\r\n      layerTitle.toString() + '.distance'\r\n    );\r\n\r\n    style = (feature, resolution) => {\r\n      const baseStyle = styleService.createStyle(\r\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'),\r\n        feature,\r\n        resolution\r\n      );\r\n      return styleService.createClusterStyle(\r\n        feature,\r\n        resolution,\r\n        clusterParam,\r\n        baseStyle\r\n      );\r\n    };\r\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\r\n    style = (feature, resolution) =>\r\n      styleService.createStyle(\r\n        styleListService.getStyleList(layerTitle.toString() + '.style'),\r\n        feature,\r\n        resolution\r\n      );\r\n  } else if (\r\n    styleListService.getStyleList('default.clusterStyle') &&\r\n    features[0].geometry.type === 'Point'\r\n  ) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(\r\n      'default.clusterParam'\r\n    );\r\n    distance = styleListService.getStyleList('default.distance');\r\n\r\n    style = (feature, resolution) => {\r\n      const baseStyle = styleService.createStyle(\r\n        styleListService.getStyleList('default.clusterStyle'),\r\n        feature,\r\n        resolution\r\n      );\r\n      return styleService.createClusterStyle(\r\n        feature,\r\n        resolution,\r\n        clusterParam,\r\n        baseStyle\r\n      );\r\n    };\r\n  } else {\r\n    style = (feature, resolution) =>\r\n      styleService.createStyle(\r\n        styleListService.getStyleList('default.style'),\r\n        feature,\r\n        resolution\r\n      );\r\n  }\r\n\r\n  let source;\r\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\r\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        distance,\r\n        type: 'cluster',\r\n        queryable: true\r\n      };\r\n    source = new ClusterDataSource(\r\n      Object.assign(sourceOptions, imposedSourceOptions)\r\n    );\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        type: 'vector',\r\n        queryable: true\r\n      };\r\n    source = new FeatureDataSource(\r\n      Object.assign(sourceOptions, imposedSourceOptions)\r\n    );\r\n    source.ol.addFeatures(olFeatures);\r\n  } else if (\r\n    styleListService.getStyleList('default.clusterStyle') &&\r\n    features[0].geometry.type === 'Point'\r\n  ) {\r\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        distance,\r\n        type: 'cluster',\r\n        queryable: true\r\n      };\r\n    source = new ClusterDataSource(\r\n      Object.assign(sourceOptions, imposedSourceOptions)\r\n    );\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        type: 'vector',\r\n        queryable: true\r\n      };\r\n    source = new FeatureDataSource(\r\n      Object.assign(sourceOptions, imposedSourceOptions)\r\n    );\r\n    source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  const layer = new VectorLayer(\r\n    Object.assign(\r\n      {\r\n        title: layerTitle,\r\n        id: layerId || uuid(),\r\n        isIgoInternalLayer: true,\r\n        source,\r\n        style\r\n      },\r\n      imposedLayerOptions\r\n    )\r\n  );\r\n  map.addLayer(layer);\r\n  if (zoomTo) {\r\n    moveToOlFeatures(map.viewController, olFeatures);\r\n  }\r\n  return layer;\r\n}\r\n\r\nfunction padTo2Digits(num) {\r\n  return num.toString().padStart(2, '0');\r\n}\r\n\r\nexport function handleFileImportSuccess(\r\n  file: File,\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  contextUri: string,\r\n  messageService: MessageService,\r\n  layerService: LayerService,\r\n  confirmDialogService?: ConfirmDialogService,\r\n  styleListService?: StyleListService,\r\n  styleService?: StyleService\r\n) {\r\n  if (features.length === 0) {\r\n    handleNothingToImportError(file, messageService);\r\n    return;\r\n  }\r\n\r\n  let layerTitle = computeLayerTitleFromFile(file);\r\n\r\n  const obs$ = confirmDialogService\r\n    ? confirmDialogService.open('igo.geo.import.promptStoreToIdb')\r\n    : of(false);\r\n\r\n  obs$.pipe(first()).subscribe((confirm) => {\r\n    const d = new Date();\r\n    const dformat =\r\n      [\r\n        d.getFullYear(),\r\n        padTo2Digits(d.getMonth() + 1),\r\n        padTo2Digits(d.getDate())\r\n      ].join('/') +\r\n      ' ' +\r\n      [padTo2Digits(d.getHours()), padTo2Digits(d.getMinutes())].join(':');\r\n\r\n    layerTitle = confirm ? `${layerTitle} (${dformat})` : layerTitle;\r\n    if (!styleListService) {\r\n      addLayerAndFeaturesToMap(\r\n        features,\r\n        map,\r\n        contextUri,\r\n        layerTitle,\r\n        layerService,\r\n        confirm\r\n      );\r\n    } else {\r\n      addLayerAndFeaturesStyledToMap(\r\n        features,\r\n        map,\r\n        layerTitle,\r\n        styleListService,\r\n        styleService\r\n      );\r\n    }\r\n\r\n    messageService.success(\r\n      'igo.geo.dropGeoFile.success.text',\r\n      'igo.geo.dropGeoFile.success.title',\r\n      undefined,\r\n      { value: layerTitle }\r\n    );\r\n  });\r\n}\r\n\r\nexport function handleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  sizeMb?: number\r\n) {\r\n  sizeMb = sizeMb ? sizeMb : 30;\r\n  const errMapping = {\r\n    'Invalid file': handleInvalidFileImportError,\r\n    'File is too large': handleSizeFileImportError,\r\n    'Failed to read file': handleUnreadbleFileImportError,\r\n    'Invalid SRS definition': handleSRSImportError,\r\n    'Error 500 with OGRE': handleOgreServerImportError\r\n  };\r\n  errMapping[error.message](file, error, messageService, sizeMb);\r\n}\r\n\r\nexport function handleInvalidFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.invalid.text',\r\n    'igo.geo.dropGeoFile.invalid.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      mimeType: file.type\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleUnreadbleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.unreadable.text',\r\n    'igo.geo.dropGeoFile.unreadable.title',\r\n    undefined,\r\n    { value: file.name }\r\n  );\r\n}\r\n\r\nexport function handleSizeFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  sizeMb: number\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.tooLarge.text',\r\n    'igo.geo.dropGeoFile.tooLarge.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      size: sizeMb\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleNothingToImportError(\r\n  file: File,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.empty.text',\r\n    'igo.geo.dropGeoFile.empty.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      mimeType: file.type\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleSRSImportError(\r\n  file: File,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.invalidSRS.text',\r\n    'igo.geo.dropGeoFile.invalidSRS.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      mimeType: file.type\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleOgreServerImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.ogreServer.text',\r\n    'igo.geo.dropGeoFile.ogreServer.title'\r\n  );\r\n}\r\n\r\nexport function getFileExtension(file: File): string {\r\n  return file.name.split('.').pop().toLowerCase();\r\n}\r\n\r\nexport function computeLayerTitleFromFile(file: File): string {\r\n  return file.name.substr(0, file.name.lastIndexOf('.'));\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport {\r\n  ImportInvalidFileError,\r\n  ImportUnreadableFileError,\r\n  ImportSizeError,\r\n  ImportSRSError,\r\n  ImportOgreServerError\r\n} from './import.errors';\r\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\r\nimport { ImportExportServiceOptions } from './import.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ImportService {\r\n  static formatExtensionAssociation = {\r\n    GeoJSON: 'geojson',\r\n    GML: 'gml',\r\n    GPX: 'gpx',\r\n    KML: 'kml',\r\n    Shapefile: 'zip'\r\n  };\r\n\r\n  static allowedMimeTypes = [\r\n    'application/gml+xml',\r\n    'application/vnd.google-earth.kml+xml',\r\n    'application/gpx+xml',\r\n    'application/json'\r\n  ];\r\n\r\n  static allowedZipMimeTypes = [\r\n    'application/zip',\r\n    'application/x-zip-compressed',\r\n    'application/x-zip'\r\n  ];\r\n\r\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml', 'zip'];\r\n\r\n  private ogreUrl: string;\r\n  private clientSideFileSizeMax: number;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService\r\n  ) {\r\n    const importConfig = this.config.getConfig(\r\n      'importExport'\r\n    ) as ImportExportServiceOptions;\r\n    this.ogreUrl = importConfig.url;\r\n    const configFileSizeMb = importConfig.clientSideFileSizeMaxMb;\r\n    this.clientSideFileSizeMax =\r\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\r\n    if (importConfig.formats) {\r\n      ImportService.allowedExtensions = importConfig.formats\r\n        .map((format) => ImportService.formatExtensionAssociation[format])\r\n        .filter((e) => e);\r\n      if (ImportService.allowedExtensions.includes('geojson')) {\r\n        ImportService.allowedExtensions.push('json');\r\n      }\r\n    }\r\n  }\r\n\r\n  import(\r\n    file: File,\r\n    projectionIn = 'EPSG:4326',\r\n    projectionOut = 'EPSG:4326'\r\n  ): Observable<Feature[]> {\r\n    return this.importAsync(file, projectionIn, projectionOut);\r\n  }\r\n\r\n  private getFileImporter(\r\n    file: File\r\n  ): (\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) => void {\r\n    const extension = getFileExtension(file);\r\n    const allowedExtensions = ImportService.allowedExtensions;\r\n    let zipMimeTypes = [];\r\n    if (allowedExtensions.includes('zip')) {\r\n      zipMimeTypes = ImportService.allowedZipMimeTypes;\r\n    }\r\n    const mimeType = file.type;\r\n    const allowedMimeTypes = [\r\n      ...ImportService.allowedMimeTypes,\r\n      ...zipMimeTypes\r\n    ];\r\n\r\n    if (\r\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\r\n      allowedExtensions.indexOf(extension) < 0\r\n    ) {\r\n      return undefined;\r\n    } else if (\r\n      mimeType === 'application/json' ||\r\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\r\n    ) {\r\n      return this.importFile;\r\n    } else if (this.ogreUrl !== undefined) {\r\n      return this.importFileWithOgre;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  private importAsync(\r\n    file: File,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Observable<Feature[]> {\r\n    const doImport = (observer: Observer<Feature[]>) => {\r\n      if (file.size >= this.clientSideFileSizeMax) {\r\n        observer.error(new ImportSizeError());\r\n        return;\r\n      }\r\n      const importer = this.getFileImporter(file);\r\n      if (importer === undefined) {\r\n        observer.error(new ImportInvalidFileError());\r\n        return;\r\n      }\r\n\r\n      importer.call(this, file, observer, projectionIn, projectionOut);\r\n    };\r\n\r\n    return new Observable(doImport);\r\n  }\r\n\r\n  private importFile(\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = (event: any) => {\r\n      try {\r\n        const features = this.parseFeaturesFromFile(\r\n          file,\r\n          event.target.result,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n        observer.next(features);\r\n      } catch (e) {\r\n        observer.error(new ImportUnreadableFileError());\r\n      }\r\n\r\n      observer.complete();\r\n    };\r\n\r\n    reader.onerror = (evt) => {\r\n      observer.error(new ImportUnreadableFileError());\r\n    };\r\n\r\n    reader.readAsText(file, 'UTF-8');\r\n  }\r\n\r\n  private importFileWithOgre(\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const url = `${this.ogreUrl}/convert`;\r\n    const formData = new FormData();\r\n    formData.append('upload', file);\r\n    formData.append('sourceSrs', projectionIn);\r\n    formData.append('targetSrs', projectionOut);\r\n    formData.append('formatOutput', 'GEOJSON');\r\n    formData.append('skipFailures', '');\r\n\r\n    this.http.post(url, formData, { headers: new HttpHeaders() }).subscribe(\r\n      (response: { errors?: string[] } | object | null) => {\r\n        if (response === null) {\r\n          observer.error(new ImportUnreadableFileError());\r\n          return;\r\n        }\r\n\r\n        const errors = (response as any).errors || [];\r\n        if (errors.length > 0) {\r\n          observer.error(new ImportUnreadableFileError());\r\n        } else {\r\n          const features = this.parseFeaturesFromGeoJSON(\r\n            file,\r\n            response,\r\n            projectionOut\r\n          );\r\n          observer.next(features);\r\n          observer.complete();\r\n        }\r\n      },\r\n      (error: any) => {\r\n        error.error.caught = true;\r\n        const errMsg = error.error.msg || '';\r\n        if (errMsg === 'No valid files found') {\r\n          observer.error(new ImportInvalidFileError());\r\n        } else if (\r\n          errMsg &&\r\n          errMsg.startWith('ERROR 1: Failed to process SRS definition')\r\n        ) {\r\n          observer.error(new ImportSRSError());\r\n        } else if (error.status === 500) {\r\n          observer.error(new ImportOgreServerError());\r\n        } else {\r\n          observer.error(new ImportUnreadableFileError());\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  private parseFeaturesFromFile(\r\n    file: File,\r\n    data: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Feature[] {\r\n    const extension = getFileExtension(file);\r\n    const mimeType = file.type;\r\n\r\n    const GeoJSON = new olformat.GeoJSON();\r\n\r\n    let format;\r\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\r\n      format = new olformat.KML();\r\n    } else if (mimeType === 'application/gml+xml') {\r\n      format = new olformat.GML();\r\n    } else if (mimeType === 'application/gpx+xml') {\r\n      format = new olformat.GPX();\r\n    } else {\r\n      switch (extension) {\r\n        case 'kml':\r\n          format = new olformat.KML();\r\n          break;\r\n        case 'gpx':\r\n          format = new olformat.GPX();\r\n          break;\r\n        case 'gml':\r\n          format = new olformat.GML();\r\n          break;\r\n        default:\r\n          format = GeoJSON;\r\n          break;\r\n      }\r\n    }\r\n\r\n    const olFeatures = format.readFeatures(data, {\r\n      dataProjection: projectionIn,\r\n      featureProjection: projectionOut\r\n    });\r\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\r\n        projection: projectionOut,\r\n        meta: {\r\n          id: uuid(),\r\n          title: computeLayerTitleFromFile(file)\r\n        }\r\n      });\r\n    });\r\n\r\n    return features;\r\n  }\r\n\r\n  private parseFeaturesFromGeoJSON(\r\n    file: File,\r\n    data: object,\r\n    projectionOut: string\r\n  ): Feature[] {\r\n    const olFormat = new olformat.GeoJSON();\r\n    const olFeatures = olFormat.readFeatures(data);\r\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\r\n        projection: projectionOut,\r\n        meta: {\r\n          id: uuid(),\r\n          title: computeLayerTitleFromFile(file)\r\n        }\r\n      });\r\n    });\r\n\r\n    return features as Feature[];\r\n  }\r\n}\r\n","import { strEnum } from '@igo2/utils';\r\n\r\nexport const ExportFormat = strEnum([\r\n  'URL',\r\n  'GeoJSON',\r\n  'GML',\r\n  'GPX',\r\n  'KML',\r\n  'Shapefile',\r\n  'CSVcomma',\r\n  'CSVsemicolon'\r\n]);\r\nexport type ExportFormat = keyof typeof ExportFormat;\r\n\r\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\r\nexport type EncodingFormat = keyof typeof EncodingFormat;\r\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { encode } from 'windows-1252';\r\n\r\nimport { ExportFormat, EncodingFormat } from './export.type';\r\n\r\nimport {\r\n  ExportInvalidFileError,\r\n  ExportNothingToExportError\r\n} from './export.errors';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ExportService {\r\n  static ogreFormats = {\r\n    GML: 'gml',\r\n    GPX: 'gpx',\r\n    KML: 'kml',\r\n    Shapefile: 'ESRI Shapefile',\r\n    CSVcomma: 'CSVcomma',\r\n    CSVsemicolon: 'CSVsemicolon'\r\n  };\r\n\r\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\r\n\r\n  private ogreUrl: string;\r\n  private aggregateInComment: boolean = true;\r\n\r\n  constructor(private config: ConfigService) {\r\n    this.ogreUrl = this.config.getConfig('importExport.url');\r\n    const gpxAggregateInComment = this.config.getConfig(\r\n      'importExport.gpxAggregateInComment'\r\n    );\r\n    if (gpxAggregateInComment !== undefined) {\r\n      this.aggregateInComment = gpxAggregateInComment;\r\n    }\r\n  }\r\n\r\n  export(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: ExportFormat,\r\n    title: string,\r\n    encoding: EncodingFormat,\r\n    projectionIn = 'EPSG:4326',\r\n    projectionOut = 'EPSG:4326'\r\n  ): Observable<void> {\r\n    const exportOlFeatures = this.generateFeature(\r\n      olFeatures,\r\n      format,\r\n      '_featureStore'\r\n    );\r\n\r\n    return this.exportAsync(\r\n      exportOlFeatures,\r\n      format,\r\n      title,\r\n      encoding,\r\n      projectionIn,\r\n      projectionOut\r\n    );\r\n  }\r\n\r\n  public generateFeature(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: ExportFormat,\r\n    excludePrefix: string = '_'\r\n  ): OlFeature<OlGeometry>[] {\r\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\r\n      return this.generateAggregatedFeature(olFeatures);\r\n    }\r\n\r\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      const keys = olFeature\r\n        .getKeys()\r\n        .filter((key: string) => !key.startsWith(excludePrefix));\r\n      const properties = keys.reduce(\r\n        (acc: object, key: string) => {\r\n          acc[key] = olFeature.get(key);\r\n          return acc;\r\n        },\r\n        { geometry: olFeature.getGeometry() }\r\n      );\r\n      return new OlFeature(properties);\r\n    });\r\n  }\r\n\r\n  private generateAggregatedFeature(\r\n    olFeatures: OlFeature<OlGeometry>[]\r\n  ): OlFeature<OlGeometry>[] {\r\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      const keys = olFeature\r\n        .getKeys()\r\n        .filter((key: string) => !key.startsWith('_'));\r\n      let comment: string = '';\r\n      const properties = keys.reduce(\r\n        (acc: object, key: string) => {\r\n          if (key && key !== 'geometry') {\r\n            key === 'id' && olFeature.get('draw')\r\n              ? (comment += key + ':' + olFeature.get('draw') + '   \\r\\n')\r\n              : (comment += key + ':' + olFeature.get(key) + '   \\r\\n');\r\n          }\r\n          acc[key] = olFeature.get(key);\r\n          return acc;\r\n        },\r\n        {\r\n          geometry: olFeature.getGeometry()\r\n        }\r\n      );\r\n      const newFeature = new OlFeature(properties);\r\n      newFeature.set('name', olFeature.getId());\r\n      newFeature.set('cmt', comment);\r\n\r\n      return newFeature;\r\n    });\r\n  }\r\n\r\n  private exportAsync(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: ExportFormat,\r\n    title: string,\r\n    encoding: EncodingFormat,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Observable<void> {\r\n    const doExport = (observer: Observer<void>) => {\r\n      const nothingToExport = this.nothingToExport(olFeatures, format);\r\n      if (nothingToExport) {\r\n        observer.error(new ExportNothingToExportError());\r\n        return;\r\n      }\r\n\r\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n      if (ogreFormats.indexOf(format) >= 0) {\r\n        if (!this.ogreUrl) {\r\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\r\n            this.exportToFile(\r\n              olFeatures,\r\n              observer,\r\n              format,\r\n              title,\r\n              projectionIn,\r\n              projectionOut\r\n            );\r\n          } else {\r\n            observer.error(new ExportInvalidFileError());\r\n          }\r\n          return;\r\n        }\r\n        this.exportWithOgre(\r\n          olFeatures,\r\n          observer,\r\n          format,\r\n          title,\r\n          encoding,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n      } else {\r\n        this.exportToFile(\r\n          olFeatures,\r\n          observer,\r\n          format,\r\n          title,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n      }\r\n    };\r\n\r\n    return new Observable(doExport);\r\n  }\r\n\r\n  protected exportToFile(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    observer: Observer<void>,\r\n    format: ExportFormat,\r\n    title: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const olFormat = new olformat[format]();\r\n    const featuresText = olFormat.writeFeatures(olFeatures, {\r\n      dataProjection: projectionOut,\r\n      featureProjection: projectionIn,\r\n      featureType: 'feature',\r\n      featureNS: 'http://example.com/feature'\r\n    });\r\n\r\n    const fileName = `${title}.${format.toLowerCase()}`;\r\n\r\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\r\n    observer.complete();\r\n  }\r\n\r\n  private exportWithOgre(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    observer: Observer<void>,\r\n    format: string,\r\n    title: string,\r\n    encodingType: EncodingFormat,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    let featuresText: string = new olformat.GeoJSON().writeFeatures(\r\n      olFeatures,\r\n      {\r\n        dataProjection: projectionOut,\r\n        featureProjection: projectionIn\r\n      }\r\n    );\r\n\r\n    const url = `${this.ogreUrl}/convertJson`;\r\n    const form = document.createElement('form');\r\n    form.style.display = 'none';\r\n    document.body.appendChild(form);\r\n    form.setAttribute('method', 'post');\r\n    form.setAttribute('target', '_blank');\r\n    form.setAttribute('action', url);\r\n\r\n    if (encodingType === EncodingFormat.UTF8) {\r\n      form.acceptCharset = 'UTF-8';\r\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\r\n    } else if (encodingType === EncodingFormat.LATIN1) {\r\n      const enctype = 'ISO-8859-1';\r\n      const featuresJson = JSON.parse(featuresText);\r\n      featuresJson.features.map((f) => {\r\n        const encodedProperties = String.fromCharCode.apply(\r\n          null,\r\n          encode(JSON.stringify(f.properties), { mode: 'replacement' })\r\n        );\r\n        f.properties = JSON.parse(encodedProperties);\r\n      });\r\n      featuresText = JSON.stringify(featuresJson);\r\n      const encoding = document.createElement('input');\r\n      encoding.setAttribute('type', 'hidden');\r\n      encoding.setAttribute('name', 'encoding');\r\n      encoding.setAttribute('value', enctype);\r\n      form.appendChild(encoding);\r\n    }\r\n\r\n    if (format === 'CSVsemicolon') {\r\n      const options = document.createElement('input');\r\n      options.setAttribute('type', 'hidden');\r\n      options.setAttribute('name', 'lco');\r\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\r\n      form.appendChild(options);\r\n    }\r\n\r\n    const geojsonField = document.createElement('input');\r\n    geojsonField.setAttribute('type', 'hidden');\r\n    geojsonField.setAttribute('name', 'json');\r\n    geojsonField.setAttribute('value', featuresText);\r\n    form.appendChild(geojsonField);\r\n\r\n    const outputNameField = document.createElement('input');\r\n    let outputName =\r\n      format === 'Shapefile'\r\n        ? `${title}.zip`\r\n        : `${title}.${format.toLowerCase()}`;\r\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\r\n      outputName = `${title}.csv`;\r\n    }\r\n    outputName = outputName.replace(' ', '_');\r\n    outputName = outputName\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(//g, \"'\");\r\n    outputNameField.setAttribute('type', 'hidden');\r\n    outputNameField.setAttribute('name', 'outputName');\r\n    outputNameField.setAttribute('value', outputName);\r\n    form.appendChild(outputNameField);\r\n\r\n    let ogreFormat = ExportService.ogreFormats[format];\r\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\r\n      ogreFormat = 'CSV';\r\n    }\r\n    const outputFormatField = document.createElement('input');\r\n    outputFormatField.setAttribute('type', 'hidden');\r\n    outputFormatField.setAttribute('name', 'format');\r\n    outputFormatField.setAttribute('value', ogreFormat);\r\n    form.appendChild(outputFormatField);\r\n\r\n    form.submit();\r\n    document.body.removeChild(form);\r\n\r\n    observer.complete();\r\n  }\r\n\r\n  private nothingToExport(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: string\r\n  ): boolean {\r\n    if (olFeatures.length === 0) {\r\n      return true;\r\n    }\r\n    if (format === 'GPX') {\r\n      const pointOrLine = olFeatures.find((olFeature) => {\r\n        return (\r\n          ['Point', 'LineString', 'MultiLineString'].indexOf(\r\n            olFeature.getGeometry().getType()\r\n          ) >= 0\r\n        );\r\n      });\r\n      return pointOrLine === undefined;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-custom-html',\n  templateUrl: './custom-html.component.html',\n  styleUrls: ['./custom-html.component.scss']\n})\nexport class CustomHtmlComponent {\n  @Input()\n  get html(): string {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = value;\n  }\n  private _html = '';\n\n  constructor() {}\n}\n","<div class=\"custom-html\" [innerHTML]=\"html | sanitizeHtml\"></div>\n","<div class=\"import-export-toggle mat-typography\">\r\n  <mat-button-toggle-group\r\n    [value]=\"selectedMode\"\r\n    (change)=\"onImportExportChange($event)\"\r\n  >\r\n    <mat-button-toggle [value]=\"'import'\">\r\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle [value]=\"'export'\">\r\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\r\n    </mat-button-toggle>\r\n  </mat-button-toggle-group>\r\n</div>\r\n\r\n<form\r\n  class=\"igo-form\"\r\n  [formGroup]=\"importForm\"\r\n  *ngIf=\"selectedMode === 'import'\"\r\n>\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{\r\n        'igo.geo.importExportForm.importProjPlaceholder' | translate\r\n      }}</mat-label>\r\n      <mat-select [(value)]=\"inputProj\">\r\n        <mat-option\r\n          *ngFor=\"let projection of projections$ | async\"\r\n          [value]=\"projection\"\r\n          (click)=\"$event.stopPropagation()\"\r\n        >\r\n          <p matListItemTitle *ngIf=\"projection.translateKey\">\r\n            {{\r\n              'igo.geo.importExportForm.projections.' + projection.translateKey\r\n                | translate: projection\r\n            }}\r\n          </p>\r\n          <p matListItemTitle *ngIf=\"!projection.translateKey\">\r\n            {{ projection.alias }}\r\n          </p>\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"\r\n      importForm.invalid\r\n        ? ('igo.geo.importExportForm.projections.choose' | translate)\r\n        : ('igo.geo.importExportForm.importButton' | translate)\r\n    \"\r\n    class=\"igo-form-button-group\"\r\n  >\r\n    <button\r\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\r\n      mat-raised-button\r\n      type=\"button\"\r\n      (click)=\"fileInput.click()\"\r\n    >\r\n      {{ 'igo.geo.importExportForm.importButton' | translate }}\r\n    </button>\r\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\r\n    <input\r\n      hidden\r\n      #fileInput\r\n      type=\"file\"\r\n      [style.display]=\"'none'\"\r\n      (click)=\"fileInput.value = null\"\r\n      (change)=\"importFiles($event.target.files)\"\r\n    />\r\n  </div>\r\n</form>\r\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\r\n  <div *ngIf=\"importHtmlClarifications === ''\">\r\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\r\n    <ul>\r\n      <li>\r\n        {{\r\n          'igo.geo.importExportForm.importSizeMax'\r\n            | translate: { size: fileSizeMb }\r\n        }}\r\n      </li>\r\n      <li>\r\n        {{ 'igo.geo.importExportForm.importFormatAuthorized' | translate }}\r\n      </li>\r\n      <li>{{ 'igo.geo.importExportForm.importShpZip' | translate }}</li>\r\n    </ul>\r\n  </div>\r\n  <igo-custom-html\r\n    *ngIf=\"importHtmlClarifications !== ''\"\r\n    class=\"mat-typography\"\r\n    [html]=\"importHtmlClarifications\"\r\n  >\r\n  </igo-custom-html>\r\n</section>\r\n\r\n<section\r\n  class=\"mat-typography\"\r\n  *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\"\r\n>\r\n  <h4>{{ 'igo.geo.importExportForm.exportNoLayersExportable' | translate }}</h4>\r\n</section>\r\n\r\n<form\r\n  class=\"igo-form\"\r\n  [formGroup]=\"form\"\r\n  *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\"\r\n>\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{\r\n        'igo.geo.importExportForm.exportLayerPlaceholder' | translate\r\n      }}</mat-label>\r\n      <mat-select [(value)]=\"layers\" multiple>\r\n        <mat-select-trigger>\r\n          {{ layers.length ? getLayerTitleById(layers[0]) : '' }}\r\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\r\n            (+{{ layers.length - 1 }}\r\n            {{\r\n              (layers?.length === 2\r\n                ? 'igo.geo.importExportForm.other'\r\n                : 'igo.geo.importExportForm.others'\r\n              ) | translate\r\n            }})\r\n          </span>\r\n        </mat-select-trigger>\r\n        <mat-option\r\n          *ngFor=\"let layer of exportableLayers$ | async\"\r\n          [ngClass]=\"{\r\n            'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)\r\n          }\"\r\n          [value]=\"layer.id\"\r\n          (click)=\"$event.stopPropagation()\"\r\n        >\r\n          <p matListItemTitle>{{ layer.title }}</p>\r\n          <p matListItemTitle>\r\n            <mat-slide-toggle\r\n              *ngIf=\"layerHasSelectedFeatures(layer)\"\r\n              (click)=\"onlySelectedClick($event, layer.id)\"\r\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\r\n              (change)=\"onlySelected($event, layer.id)\"\r\n            >\r\n              <small>{{\r\n                'igo.geo.importExportForm.exportSelectedFeature' | translate\r\n              }}</small>\r\n            </mat-slide-toggle>\r\n          </p>\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{\r\n        'igo.geo.importExportForm.exportFormatPlaceholder' | translate\r\n      }}</mat-label>\r\n      <mat-select formControlName=\"format\">\r\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\r\n          <mat-option\r\n            *ngFor=\"let format of formats$ | async | keyvalue\"\r\n            [value]=\"format.key\"\r\n          >\r\n            {{ 'igo.geo.export.format.' + format.value | translate }}\r\n          </mat-option>\r\n        </ng-container>\r\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\r\n          {{ 'igo.geo.export.noFormat.title' | translate }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div\r\n    class=\"igo-input-container\"\r\n    *ngIf=\"forceNaming && form.value.format !== 'URL'\"\r\n  >\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName=\"name\"\r\n        placeholder=\"{{\r\n          'igo.geo.importExportForm.exportFileNamePlaceholder' | translate\r\n        }}\"\r\n      />\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div\r\n    class=\"igo-input-container\"\r\n    *ngIf=\"\r\n      form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\r\n    \"\r\n  >\r\n    <mat-form-field>\r\n      <mat-label>{{\r\n        'igo.geo.importExportForm.encodingPlaceholder' | translate\r\n      }}</mat-label>\r\n      <mat-select formControlName=\"encoding\">\r\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\r\n          <mat-option\r\n            *ngFor=\"let encoding of encodings$ | async | keyvalue\"\r\n            [value]=\"encoding.key\"\r\n          >\r\n            {{ 'igo.geo.export.encoding.' + encoding.value | translate }}\r\n          </mat-option>\r\n        </ng-container>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div\r\n    class=\"export-combine-layers mat-typography\"\r\n    *ngIf=\"\r\n      layers.length > 1 &&\r\n      (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\r\n    \"\r\n  >\r\n    <mat-slide-toggle\r\n      formControlName=\"combineLayers\"\r\n      [labelPosition]=\"'before'\"\r\n    >\r\n      {{ 'igo.geo.importExportForm.exportCombineResults' | translate }}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <div\r\n    class=\"export-separator mat-typography\"\r\n    *ngIf=\"\r\n      layers.length > 1 &&\r\n      (form.value.format === 'CSVcomma' ||\r\n        form.value.format === 'CSVsemicolon') &&\r\n      form.value.combineLayers\r\n    \"\r\n  >\r\n    <mat-slide-toggle formControlName=\"separator\" [labelPosition]=\"'before'\">\r\n      {{ 'igo.geo.importExportForm.exportSeparator' | translate }}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <div\r\n    class=\"export-options mat-typography\"\r\n    *ngIf=\"form.value.format !== 'URL'\"\r\n  >\r\n    <mat-slide-toggle\r\n      formControlName=\"featureInMapExtent\"\r\n      [labelPosition]=\"'before'\"\r\n    >\r\n      {{ 'igo.geo.importExportForm.exportFeatureInExtent' | translate }}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <div class=\"igo-form-button-group\">\r\n    <button\r\n      mat-raised-button\r\n      type=\"button\"\r\n      [disabled]=\"!form.valid || (loading$ | async)\"\r\n      (click)=\"handleExportFormSubmit(form.value)\"\r\n    >\r\n      {{\r\n        form.value.format !== 'URL'\r\n          ? ('igo.geo.importExportForm.exportButton' | translate)\r\n          : form.value.layers.length > 1\r\n          ? ('igo.geo.importExportForm.exportButtonLinks' | translate)\r\n          : ('igo.geo.importExportForm.exportButtonLink' | translate)\r\n      }}\r\n    </button>\r\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\r\n  </div>\r\n\r\n  <igo-custom-html\r\n    *ngIf=\"exportHtmlClarifications !== ''\"\r\n    class=\"mat-typography\"\r\n    [html]=\"exportHtmlClarifications\"\r\n  >\r\n  </igo-custom-html>\r\n</form>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport {\r\n  UntypedFormGroup,\r\n  UntypedFormBuilder,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport {\r\n  MessageService,\r\n  LanguageService,\r\n  ConfigService,\r\n  StorageService\r\n} from '@igo2/core';\r\nimport { strEnum } from '@igo2/utils';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\r\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\r\nimport olPoint from 'ol/geom/Point';\r\nimport { circular } from 'ol/geom/Polygon';\r\n\r\nimport {\r\n  handleFileExportError,\r\n  handleFileExportSuccess\r\n} from '../shared/export.utils';\r\nimport { ExportOptions } from '../shared/export.interface';\r\nimport { ExportFormat, EncodingFormat } from '../shared/export.type';\r\nimport { ExportService } from '../shared/export.service';\r\nimport { ImportService } from '../shared/import.service';\r\nimport {\r\n  handleFileImportSuccess,\r\n  handleFileImportError\r\n} from '../shared/import.utils';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { StyleListService } from '../../style/style-list/style-list.service';\r\nimport { skipWhile } from 'rxjs/operators';\r\nimport { ConfirmDialogService, EntityRecord, Workspace } from '@igo2/common';\r\nimport type { WorkspaceStore } from '@igo2/common';\r\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\r\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\r\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\r\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\r\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\r\nimport { DownloadService } from '../../download/shared/download.service';\r\nimport { computeProjectionsConstraints } from '../../map/shared';\r\n\r\nimport olVectorSource from 'ol/source/Vector';\r\nimport olClusterSource from 'ol/source/Cluster';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { ImportExportServiceOptions } from '../shared/import.interface';\r\n\r\n@Component({\r\n  selector: 'igo-import-export',\r\n  templateUrl: './import-export.component.html',\r\n  styleUrls: ['./import-export.component.scss']\r\n})\r\nexport class ImportExportComponent implements OnDestroy, OnInit {\r\n  public form: UntypedFormGroup;\r\n  public importForm: UntypedFormGroup;\r\n  public formats$ = new BehaviorSubject(undefined);\r\n  public encodings$ = new BehaviorSubject(undefined);\r\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\r\n    []\r\n  );\r\n  public loading$ = new BehaviorSubject(false);\r\n  public forceNaming = false;\r\n  public controlFormat = 'format';\r\n\r\n  private layers$$: Subscription;\r\n  private exportableLayers$$: Subscription;\r\n  private formats$$: Subscription;\r\n  private encodings$$: Subscription;\r\n  private formLayer$$: Subscription;\r\n  private exportOptions$$: Subscription;\r\n\r\n  public importHtmlClarifications: string;\r\n  public exportHtmlClarifications: string;\r\n\r\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\r\n  private clientSideFileSizeMax: number;\r\n  public fileSizeMb: number;\r\n\r\n  public projections$: BehaviorSubject<InputProjections[]> =\r\n    new BehaviorSubject([]);\r\n  private projectionsConstraints: ProjectionsLimitationsOptions;\r\n\r\n  public popupChecked: boolean = false;\r\n\r\n  private previousLayerSpecs$: BehaviorSubject<\r\n    {\r\n      id: string;\r\n      visible: boolean;\r\n      opacity: number;\r\n      queryable: boolean;\r\n    }[]\r\n  > = new BehaviorSubject(undefined);\r\n\r\n  @Input() selectFirstProj: boolean = false;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() contextUri: string;\r\n\r\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\r\n  @Input()\r\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\r\n    this._projectionsLimitations = value;\r\n    this.computeProjections();\r\n  }\r\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\r\n    return this._projectionsLimitations || {};\r\n  }\r\n\r\n  /**\r\n   * Store that holds the available workspaces.\r\n   */\r\n  @Input() store: WorkspaceStore;\r\n\r\n  @Input() selectedMode = 'import';\r\n\r\n  @Output() selectMode = new EventEmitter<string>();\r\n\r\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\r\n\r\n  get layers() {\r\n    return this.form.get('layers').value;\r\n  }\r\n  set layers(value) {\r\n    this.form.patchValue({ layers: value });\r\n  }\r\n\r\n  get inputProj() {\r\n    return this.importForm.get('inputProj').value;\r\n  }\r\n  set inputProj(value) {\r\n    this.importForm.patchValue({ inputProj: value });\r\n  }\r\n\r\n  get popupAllowed(): boolean {\r\n    return (\r\n      (this.storageService.get('importExportPopupAllowed') as boolean) || false\r\n    );\r\n  }\r\n\r\n  set popupAllowed(value: boolean) {\r\n    this.storageService.set('importExportPopupAllowed', value);\r\n  }\r\n\r\n  constructor(\r\n    private importService: ImportService,\r\n    private exportService: ExportService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private styleListService: StyleListService,\r\n    private styleService: StyleService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private config: ConfigService,\r\n    private cdRef: ChangeDetectorRef,\r\n    private storageService: StorageService,\r\n    private downloadService: DownloadService,\r\n    private layerService: LayerService,\r\n    private confirmDialogService: ConfirmDialogService\r\n  ) {\r\n    this.loadConfig();\r\n    this.buildForm();\r\n    this.computeProjections();\r\n    this.importHtmlClarifications = this.languageService.translate.instant(\r\n      'igo.geo.importExportForm.importHtmlClarifications'\r\n    );\r\n    this.exportHtmlClarifications = this.languageService.translate.instant(\r\n      'igo.geo.importExportForm.exportHtmlClarifications'\r\n    );\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\r\n      this.exportableLayers$.next(\r\n        layers.filter((layer: Layer) => {\r\n          return (\r\n            (layer instanceof VectorLayer && layer.exportable === true) ||\r\n            (layer.dataSource.options.download &&\r\n              layer.dataSource.options.download.url)\r\n          );\r\n        }) as AnyLayer[]\r\n      );\r\n    });\r\n    const configFileSizeMb = this.config.getConfig(\r\n      'importExport.clientSideFileSizeMaxMb'\r\n    );\r\n    this.clientSideFileSizeMax =\r\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\r\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\r\n\r\n    this.exportOptions$$ = this.exportOptions$\r\n      .pipe(skipWhile((exportOptions) => !exportOptions))\r\n      .subscribe((exportOptions) => {\r\n        this.form.patchValue(exportOptions, { emitEvent: true });\r\n        if (exportOptions.layers) {\r\n          this.computeFormats(\r\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\r\n          );\r\n        }\r\n      });\r\n    this.formLayer$$ = this.form\r\n      .get('format')\r\n      .valueChanges.subscribe((format) => {\r\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n        if (\r\n          !this.popupChecked &&\r\n          this.form.get('layers').value?.length > 1 &&\r\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)\r\n        ) {\r\n          if (!this.handlePopup(true)) {\r\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\r\n          }\r\n        }\r\n      });\r\n\r\n    this.formLayer$$ = this.form\r\n      .get('layers')\r\n      .valueChanges.subscribe((layersId) => {\r\n        this.handlePreviousLayerSpecs();\r\n        const selectedLayers =\r\n          layersId instanceof Array ? layersId : [layersId];\r\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\r\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\r\n        this.computeFormats(layers);\r\n\r\n        if (\r\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\r\n          -1\r\n        ) {\r\n          this.form.patchValue({ format: undefined });\r\n        }\r\n\r\n        this.loading$.next(true);\r\n        const previousSpecs: {\r\n          id: string;\r\n          visible: boolean;\r\n          opacity: number;\r\n          queryable: boolean;\r\n        }[] = [];\r\n        layers.forEach((layer) => {\r\n          if (\r\n            layer instanceof VectorLayer &&\r\n            layer.dataSource.ol.getFeatures().length === 0\r\n          ) {\r\n            previousSpecs.push({\r\n              id: layer.id,\r\n              visible: layer.visible,\r\n              opacity: layer.opacity,\r\n              queryable: (layer as any).queryable\r\n            });\r\n            layer.opacity = 0;\r\n            layer.visible = true;\r\n          }\r\n        });\r\n\r\n        this.previousLayerSpecs$.next(previousSpecs);\r\n        setTimeout(() => {\r\n          this.loading$.next(false);\r\n        }, 500);\r\n      });\r\n\r\n    this.formats$$ = this.formats$\r\n      .pipe(skipWhile((formats) => !formats))\r\n      .subscribe((formats) => {\r\n        if (Object.keys(formats).length === 1) {\r\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\r\n        }\r\n      });\r\n\r\n    this.encodings$$ = this.encodings$\r\n      .pipe(skipWhile((encodings) => !encodings))\r\n      .subscribe((encodings) => {\r\n        if (Object.keys(encodings).length === 1) {\r\n          this.form.patchValue({\r\n            encoding: encodings[Object.keys(encodings)[0]]\r\n          });\r\n        }\r\n      });\r\n\r\n    this.exportableLayers$$ = this.exportableLayers$\r\n      .pipe(skipWhile((layers) => !layers))\r\n      .subscribe((layers) => {\r\n        if (layers.length === 1) {\r\n          this.form.patchValue({ layers: layers[0].id });\r\n        }\r\n      });\r\n\r\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\r\n      if (\r\n        format === ExportFormat.CSVcomma ||\r\n        format === ExportFormat.CSVsemicolon\r\n      ) {\r\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\r\n      } else {\r\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\r\n      }\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    if (this.selectFirstProj) {\r\n      if (this.projections$.value.length === 0) {\r\n        this.importForm.patchValue({\r\n          inputProj: {\r\n            translateKey: 'nad83',\r\n            alias: 'NAD83',\r\n            code: 'EPSG:4326',\r\n            zone: ''\r\n          }\r\n        });\r\n      } else {\r\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\r\n      }\r\n    } else {\r\n      this.importForm.patchValue({ inputProj: undefined });\r\n    }\r\n  }\r\n\r\n  private computeProjections() {\r\n    this.projectionsConstraints = computeProjectionsConstraints(\r\n      this.projectionsLimitations\r\n    );\r\n    const projections: InputProjections[] = [];\r\n\r\n    if (this.projectionsConstraints.nad83) {\r\n      projections.push({\r\n        translateKey: 'nad83',\r\n        alias: 'NAD83',\r\n        code: 'EPSG:4269',\r\n        zone: ''\r\n      });\r\n    }\r\n    if (this.projectionsConstraints.wgs84) {\r\n      projections.push({\r\n        translateKey: 'wgs84',\r\n        alias: 'WGS84',\r\n        code: 'EPSG:4326',\r\n        zone: ''\r\n      });\r\n    }\r\n    if (this.projectionsConstraints.webMercator) {\r\n      projections.push({\r\n        translateKey: 'webMercator',\r\n        alias: 'Web Mercator',\r\n        code: 'EPSG:3857',\r\n        zone: ''\r\n      });\r\n    }\r\n\r\n    if (this.projectionsConstraints.mtm) {\r\n      // all mtm zones\r\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\r\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\r\n\r\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\r\n        const code =\r\n          mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n        projections.push({\r\n          translateKey: 'mtm',\r\n          alias: `MTM ${mtmZone}`,\r\n          code,\r\n          zone: `${mtmZone}`\r\n        });\r\n      }\r\n    }\r\n\r\n    if (this.projectionsConstraints.utm) {\r\n      // all utm zones\r\n      const minZone = this.projectionsConstraints.utmZone.minZone;\r\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\r\n\r\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\r\n        const code =\r\n          utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n        projections.push({\r\n          translateKey: 'utm',\r\n          alias: `UTM ${utmZone}`,\r\n          code,\r\n          zone: `${utmZone}`\r\n        });\r\n      }\r\n    }\r\n\r\n    let configProjection = [];\r\n    if (this.projectionsConstraints.projFromConfig) {\r\n      configProjection = this.config.getConfig('projections') || [];\r\n    }\r\n\r\n    this.projections$.next(configProjection.concat(projections));\r\n  }\r\n\r\n  private getWorkspaceByLayerId(id: string): Workspace {\r\n    const wksFromLayerId = this.store\r\n      .all()\r\n      .find(\r\n        (workspace) =>\r\n          (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace)\r\n            .layer.id === id\r\n      );\r\n    if (wksFromLayerId) {\r\n      return wksFromLayerId;\r\n    }\r\n    return;\r\n  }\r\n\r\n  public getLayerTitleById(id): string {\r\n    return this.map.getLayerById(id)?.title;\r\n  }\r\n\r\n  layerHasSelectedFeatures(layer: Layer): boolean {\r\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\r\n    if (wksFromLayer) {\r\n      const recs = wksFromLayer.entityStore.stateView.firstBy(\r\n        (record: EntityRecord<Feature>) => {\r\n          return record.state.selected === true;\r\n        }\r\n      );\r\n      return recs ? true : false;\r\n    }\r\n  }\r\n\r\n  public onlySelected(event: MatSlideToggleChange, id: string) {\r\n    let layersWithSelection = this.form.value.layersWithSelection;\r\n    if (event.checked) {\r\n      layersWithSelection.push(id);\r\n    } else {\r\n      layersWithSelection = layersWithSelection.filter(\r\n        (layerId) => layerId !== id\r\n      );\r\n    }\r\n    this.form.patchValue({ layersWithSelection });\r\n  }\r\n\r\n  public onlySelectedClick(event, id: string) {\r\n    if (this.form.value.layers.find((layerId) => layerId === id)) {\r\n      event.stopPropagation();\r\n    }\r\n  }\r\n\r\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\r\n    return this.form.value.layersWithSelection.find(\r\n      (layerId) => layerId === layer.id\r\n    )\r\n      ? true\r\n      : false;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n    this.exportableLayers$$.unsubscribe();\r\n    this.formats$$.unsubscribe();\r\n    this.encodings$$.unsubscribe();\r\n    this.formLayer$$.unsubscribe();\r\n    if (this.exportOptions$$) {\r\n      this.exportOptions$$.unsubscribe();\r\n    }\r\n    this.exportOptionsChange.emit(this.form.value);\r\n    this.handlePreviousLayerSpecs();\r\n  }\r\n\r\n  private handlePreviousLayerSpecs() {\r\n    const previousSpecs = this.previousLayerSpecs$.value;\r\n    if (previousSpecs && previousSpecs.length) {\r\n      previousSpecs.forEach((specs) => {\r\n        const previousLayer = this.map.getLayerById(specs.id);\r\n        previousLayer.visible = specs.visible;\r\n        previousLayer.opacity = specs.opacity;\r\n        (previousLayer as any).queryable = specs.queryable;\r\n      });\r\n    }\r\n    this.previousLayerSpecs$.next(undefined);\r\n  }\r\n\r\n  importFiles(files: File[]) {\r\n    let inputProj = this.inputProj.code;\r\n    if (this.espgCodeRegex.test(inputProj)) {\r\n      inputProj = `EPSG:${inputProj}`;\r\n    }\r\n\r\n    this.loading$.next(true);\r\n    for (const file of files) {\r\n      this.importService.import(file, inputProj).subscribe(\r\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\r\n        (error: Error) => this.onFileImportError(file, error),\r\n        () => {\r\n          this.loading$.next(false);\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  handlePopup(preCheck: boolean = true): boolean {\r\n    const p1 = window.open('', 'popup', 'width=1, height=1');\r\n    p1.close();\r\n    const p2 = window.open('', 'popup', 'width=1, height=1');\r\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\r\n      this.onPopupBlockedError(preCheck);\r\n      this.popupAllowed = false;\r\n    } else {\r\n      p2.close();\r\n      this.popupAllowed = true;\r\n      this.popupChecked = true;\r\n    }\r\n    return this.popupAllowed;\r\n  }\r\n\r\n  handleExportFormSubmit(data: ExportOptions) {\r\n    this.loading$.next(true);\r\n\r\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n    if (\r\n      !this.popupChecked &&\r\n      data.layers.length > 1 &&\r\n      (ogreFormats.indexOf(data.format) >= 0 ||\r\n        data.format === ExportFormat.URL) &&\r\n      !this.popupAllowed\r\n    ) {\r\n      this.handlePopup();\r\n    }\r\n\r\n    let geomTypesCSV: { geometryType: string; features: any[] }[] = [];\r\n    let featuresCSV: any[] = [];\r\n    let filename: string = '';\r\n\r\n    for (const [layerIndex, layer] of data.layers.entries()) {\r\n      const lay = this.map.getLayerById(layer);\r\n      if (\r\n        !(\r\n          data.format === ExportFormat.CSVsemicolon ||\r\n          data.format === ExportFormat.CSVcomma\r\n        ) ||\r\n        !data.combineLayers ||\r\n        data.layers.length === 1\r\n      ) {\r\n        filename = lay.title;\r\n        if (data.name) {\r\n          filename = data.name;\r\n        }\r\n      } else {\r\n        filename = this.languageService.translate.instant(\r\n          'igo.geo.export.combinedLayers'\r\n        );\r\n      }\r\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\r\n      if (\r\n        data.format === ExportFormat.URL &&\r\n        dSOptions.download &&\r\n        (dSOptions.download.url || dSOptions.download.dynamicUrl)\r\n      ) {\r\n        setTimeout(() => {\r\n          // better look an feel\r\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\r\n          url.match(/service=wfs/gi)\r\n            ? this.downloadService.open(lay)\r\n            : window.open(url, '_blank');\r\n          this.loading$.next(false);\r\n        }, 500);\r\n        return;\r\n      }\r\n      const wks = this.getWorkspaceByLayerId(layer);\r\n      let olFeatures;\r\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\r\n        if (\r\n          data.layersWithSelection.indexOf(layer) !== -1 &&\r\n          data.featureInMapExtent\r\n        ) {\r\n          // Only export selected feature && into map extent\r\n          olFeatures = wks.entityStore.stateView\r\n            .all()\r\n            .filter(\r\n              (e: EntityRecord<object>) =>\r\n                e.state.inMapExtent && e.state.selected\r\n            )\r\n            .map((e) => (e.entity as Feature).ol);\r\n        } else if (\r\n          data.layersWithSelection.indexOf(layer) !== -1 &&\r\n          !data.featureInMapExtent\r\n        ) {\r\n          // Only export selected feature &&  (into map extent OR not)\r\n          olFeatures = wks.entityStore.stateView\r\n            .all()\r\n            .filter((e: EntityRecord<object>) => e.state.selected)\r\n            .map((e) => (e.entity as Feature).ol);\r\n        } else if (data.featureInMapExtent) {\r\n          // Only into map extent\r\n          olFeatures = wks.entityStore.stateView\r\n            .all()\r\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent)\r\n            .map((e) => (e.entity as Feature).ol);\r\n        } else {\r\n          // All features\r\n          olFeatures = wks.entityStore.stateView\r\n            .all()\r\n            .map((e) => (e.entity as Feature).ol);\r\n        }\r\n      } else {\r\n        const ol = lay.dataSource.ol as\r\n          | olVectorSource<OlGeometry>\r\n          | olClusterSource;\r\n        if (data.featureInMapExtent) {\r\n          olFeatures = ol.getFeaturesInExtent(\r\n            lay.map.viewController.getExtent()\r\n          );\r\n        } else {\r\n          olFeatures = ol.getFeatures();\r\n        }\r\n        if (lay.dataSource instanceof ClusterDataSource) {\r\n          olFeatures = olFeatures.flatMap((cluster: any) =>\r\n            cluster.get('features')\r\n          );\r\n        }\r\n      }\r\n\r\n      let geomTypes: { geometryType: string; features: any[] }[] = [];\r\n      if (\r\n        data.format === ExportFormat.Shapefile ||\r\n        data.format === ExportFormat.GPX\r\n      ) {\r\n        olFeatures.forEach((olFeature) => {\r\n          const featureGeomType = olFeature.getGeometry().getType();\r\n          const currentGeomType = geomTypes.find(\r\n            (geomType) => geomType.geometryType === featureGeomType\r\n          );\r\n          if (currentGeomType) {\r\n            currentGeomType.features.push(olFeature);\r\n          } else {\r\n            geomTypes.push({\r\n              geometryType: featureGeomType,\r\n              features: [olFeature]\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        geomTypes = [{ geometryType: '', features: olFeatures }];\r\n      }\r\n\r\n      geomTypes.forEach((geomType) => {\r\n        geomType.features.forEach((feature) => {\r\n          const radius: number = feature.get('rad');\r\n          if (radius) {\r\n            const center4326: Array<number> = [\r\n              feature.get('longitude'),\r\n              feature.get('latitude')\r\n            ];\r\n            const circle = circular(center4326, radius, 500);\r\n            circle.transform('EPSG:4326', feature.get('_projection'));\r\n            feature.setGeometry(circle);\r\n          }\r\n        });\r\n      });\r\n\r\n      if (data.format === ExportFormat.GPX) {\r\n        const gpxFeatureCnt = geomTypes.length;\r\n        geomTypes = geomTypes.filter((geomType) =>\r\n          ['LineString', 'Point'].includes(geomType.geometryType)\r\n        );\r\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\r\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\r\n          this.messageService.error(\r\n            'igo.geo.export.gpx.error.poly.text',\r\n            'igo.geo.export.gpx.error.poly.title',\r\n            { timeOut: 20000 }\r\n          );\r\n        }\r\n      } else if (\r\n        (data.format === ExportFormat.CSVsemicolon ||\r\n          data.format === ExportFormat.CSVcomma) &&\r\n        data.combineLayers\r\n      ) {\r\n        geomTypes.forEach((geomType) => geomTypesCSV.push(geomType));\r\n\r\n        if (layerIndex !== data.layers.length - 1) {\r\n          continue;\r\n        } else {\r\n          let previousFeature = undefined;\r\n          geomTypesCSV.forEach((geomType) => {\r\n            geomType.features.forEach((currentFeature) => {\r\n              if (data.separator) {\r\n                if (previousFeature) {\r\n                  if (\r\n                    currentFeature.get('_featureStore').layer.options.title !==\r\n                    previousFeature.get('_featureStore').layer.options.title\r\n                  ) {\r\n                    const titleEmptyRows = this.createTitleEmptyRows(\r\n                      previousFeature,\r\n                      currentFeature\r\n                    );\r\n                    featuresCSV.push(titleEmptyRows[2]);\r\n                    featuresCSV.push(titleEmptyRows[0]);\r\n                    featuresCSV.push(titleEmptyRows[1]);\r\n                  }\r\n                } else {\r\n                  const titleEmptyRows = this.createTitleEmptyRows(\r\n                    currentFeature,\r\n                    currentFeature\r\n                  );\r\n                  featuresCSV.push(titleEmptyRows[0]);\r\n                }\r\n              }\r\n              featuresCSV.push(currentFeature);\r\n              previousFeature = currentFeature;\r\n            });\r\n          });\r\n        }\r\n      }\r\n\r\n      if (geomTypes.length === 0) {\r\n        this.loading$.next(false);\r\n        this.messageService.error(\r\n          'igo.geo.export.nothing.text',\r\n          'igo.geo.export.nothing.title',\r\n          { timeOut: 20000 }\r\n        );\r\n      } else {\r\n        if (\r\n          !(\r\n            data.format === ExportFormat.CSVsemicolon ||\r\n            data.format === ExportFormat.CSVcomma\r\n          ) ||\r\n          !data.combineLayers\r\n        ) {\r\n          geomTypes.map((geomType) =>\r\n            this.exportService\r\n              .export(\r\n                geomType.features,\r\n                data.format,\r\n                filename + geomType.geometryType,\r\n                data.encoding,\r\n                this.map.projection\r\n              )\r\n              .subscribe(\r\n                () => {},\r\n                (error: Error) => this.onFileExportError(error),\r\n                () => {\r\n                  this.onFileExportSuccess();\r\n\r\n                  geomType.features.forEach((feature) => {\r\n                    this.circleToPoint(feature);\r\n                  });\r\n\r\n                  this.loading$.next(false);\r\n                }\r\n              )\r\n          );\r\n        }\r\n      }\r\n    }\r\n    if (\r\n      (data.format === ExportFormat.CSVsemicolon ||\r\n        data.format === ExportFormat.CSVcomma) &&\r\n      data.combineLayers\r\n    ) {\r\n      this.exportService\r\n        .export(\r\n          featuresCSV,\r\n          data.format,\r\n          filename,\r\n          data.encoding,\r\n          this.map.projection\r\n        )\r\n        .subscribe(\r\n          () => {},\r\n          (error: Error) => this.onFileExportError(error),\r\n          () => {\r\n            this.onFileExportSuccess();\r\n\r\n            featuresCSV.forEach((feature) => {\r\n              this.circleToPoint(feature);\r\n            });\r\n\r\n            this.loading$.next(false);\r\n          }\r\n        );\r\n    }\r\n  }\r\n\r\n  private createTitleEmptyRows(previousFeature, currentFeature) {\r\n    const titleRow = currentFeature.clone();\r\n    const headerRow = currentFeature.clone();\r\n    const emptyRow = currentFeature.clone();\r\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\r\n    let firstKeyPrevious: string = '';\r\n    for (const key in previousFeatureKeys) {\r\n      if (previousFeatureKeys[key] !== 'geometry') {\r\n        firstKeyPrevious = previousFeatureKeys[key];\r\n        break;\r\n      }\r\n    }\r\n\r\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\r\n    let firstKeyCurrent: string = '';\r\n    for (const key in currentFeatureKeys) {\r\n      if (currentFeatureKeys[key] !== 'geometry') {\r\n        firstKeyCurrent = currentFeatureKeys[key];\r\n        break;\r\n      }\r\n    }\r\n    const allKeys: Array<string> = currentFeature.getKeys();\r\n    previousFeatureKeys.forEach((previousKey) => {\r\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\r\n        allKeys.push(previousKey);\r\n      }\r\n    });\r\n    allKeys.unshift(firstKeyPrevious);\r\n\r\n    let firstKeyAll: string = '';\r\n    for (const key in allKeys) {\r\n      if (allKeys[key] !== 'geometry') {\r\n        firstKeyAll = allKeys[key];\r\n        break;\r\n      }\r\n    }\r\n    allKeys.forEach((key) => {\r\n      const sameKeys: boolean =\r\n        previousFeatureKeys.length === currentFeatureKeys.length &&\r\n        previousFeatureKeys.every(\r\n          (value, index) => value === currentFeatureKeys[index]\r\n        );\r\n      if (key === firstKeyAll && !sameKeys) {\r\n        titleRow.set(\r\n          key,\r\n          currentFeature.get('_featureStore').layer.options.title +\r\n            ' ===============>',\r\n          true\r\n        );\r\n        headerRow.set(key, key, true);\r\n        emptyRow.unset(key, true);\r\n      } else if (key === firstKeyAll && sameKeys) {\r\n        titleRow.set(\r\n          key,\r\n          currentFeature.get('_featureStore').layer.options.title,\r\n          true\r\n        );\r\n        headerRow.set(key, key, true);\r\n        emptyRow.unset(key, true);\r\n      } else if (key === firstKeyCurrent) {\r\n        titleRow.set(\r\n          key,\r\n          currentFeature.get('_featureStore').layer.options.title,\r\n          true\r\n        );\r\n        headerRow.set(key, key, true);\r\n        emptyRow.unset(key, true);\r\n      } else if (key !== 'geometry') {\r\n        titleRow.unset(key, true);\r\n        headerRow.set(key, key, true);\r\n        emptyRow.unset(key, true);\r\n      } else {\r\n        titleRow.unset(key, true);\r\n        emptyRow.unset(key, true);\r\n      }\r\n\r\n      if (!currentFeatureKeys.includes(key)) {\r\n        headerRow.unset(key, true);\r\n      }\r\n    });\r\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\r\n    return titleEmptyRows;\r\n  }\r\n\r\n  private circleToPoint(feature) {\r\n    const radius: number = feature.get('rad');\r\n\r\n    if (radius) {\r\n      const point = new olPoint([\r\n        feature.get('longitude'),\r\n        feature.get('latitude')\r\n      ]);\r\n      point.transform('EPSG:4326', feature.get('_projection'));\r\n      feature.setGeometry(point);\r\n    }\r\n  }\r\n\r\n  private buildForm() {\r\n    this.importForm = this.formBuilder.group({\r\n      inputProj: ['', [Validators.required]]\r\n    });\r\n\r\n    if (this.forceNaming) {\r\n      this.form = this.formBuilder.group({\r\n        format: ['', [Validators.required]],\r\n        layers: [[], [Validators.required]],\r\n        layersWithSelection: [[]],\r\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\r\n        combineLayers: [true, [Validators.required]],\r\n        separator: [false, [Validators.required]],\r\n        featureInMapExtent: [false, [Validators.required]],\r\n        name: ['', [Validators.required]]\r\n      });\r\n    } else {\r\n      this.form = this.formBuilder.group({\r\n        format: ['', [Validators.required]],\r\n        layers: [[], [Validators.required]],\r\n        layersWithSelection: [[]],\r\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\r\n        combineLayers: [true, [Validators.required]],\r\n        separator: [false, [Validators.required]],\r\n        featureInMapExtent: [false, [Validators.required]]\r\n      });\r\n    }\r\n  }\r\n\r\n  private onFileImportSuccess(file: File, features: Feature[]) {\r\n    const importExportOptions = this.config.getConfig(\r\n      'importExport'\r\n    ) as ImportExportServiceOptions;\r\n    const confirmDialogService = importExportOptions?.allowToStoreLayer\r\n      ? this.confirmDialogService\r\n      : undefined;\r\n    const importWithStyle =\r\n      importExportOptions?.importWithStyle ||\r\n      this.config.getConfig('importWithStyle');\r\n    if (this.config.getConfig('importWithStyle')) {\r\n      console.warn(`\r\n      The location of this config importWithStyle is deprecated.\r\n      Please move this property within importExport configuration.\r\n      Ex: importWithStyle: true/false must be transfered to importExport: { importWithStyle: true/false }\r\n      Refer to environnement.ts OR config/config.json\r\n      This legacy conversion will be deleted in 2024.\r\n      `);\r\n    }\r\n    if (!importWithStyle) {\r\n      handleFileImportSuccess(\r\n        file,\r\n        features,\r\n        this.map,\r\n        this.contextUri,\r\n        this.messageService,\r\n        this.layerService,\r\n        confirmDialogService\r\n      );\r\n    } else {\r\n      handleFileImportSuccess(\r\n        file,\r\n        features,\r\n        this.map,\r\n        this.contextUri,\r\n        this.messageService,\r\n        this.layerService,\r\n        confirmDialogService,\r\n        this.styleListService,\r\n        this.styleService\r\n      );\r\n    }\r\n  }\r\n\r\n  private onFileImportError(file: File, error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\r\n  }\r\n\r\n  private onPopupBlockedError(preCheck: boolean = true) {\r\n    this.loading$.next(false);\r\n    const extraMessage = preCheck\r\n      ? 'igo.geo.export.popupBlocked.selectAgain'\r\n      : 'igo.geo.export.popupBlocked.retry';\r\n    this.messageService.error(\r\n      'igo.geo.export.popupBlocked.text',\r\n      'igo.geo.export.popupBlocked.title',\r\n      { timeOut: 20000 },\r\n      { extraMessage }\r\n    );\r\n  }\r\n\r\n  private onFileExportError(error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileExportError(error, this.messageService);\r\n  }\r\n\r\n  private loadConfig() {\r\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\r\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\r\n    }\r\n    this.computeFormats();\r\n    this.loadEncodings();\r\n  }\r\n\r\n  public encodingDefaultValue(format: ExportFormat) {\r\n    if (\r\n      format === ExportFormat.CSVcomma ||\r\n      format === ExportFormat.CSVsemicolon\r\n    ) {\r\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\r\n      return EncodingFormat.LATIN1;\r\n    } else {\r\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\r\n      return EncodingFormat.UTF8;\r\n    }\r\n  }\r\n\r\n  private loadEncodings() {\r\n    this.encodings$.next(EncodingFormat);\r\n  }\r\n\r\n  private computeFormats(layers?: AnyLayer[]) {\r\n    let appliedformats: string[] = Object.keys(ExportFormat);\r\n    const formatsType = {\r\n      onlyUrl: false,\r\n      onlyVector: false,\r\n      vectorAndUrl: false,\r\n      customList: false\r\n    };\r\n    const customList = [];\r\n    if (layers && layers.length) {\r\n      layers.forEach((layer) => {\r\n        if (!layer) {\r\n          return;\r\n        }\r\n        if (layer.dataSource.options.download?.allowedFormats) {\r\n          formatsType.customList = true;\r\n          customList.push({\r\n            layer: layer.title,\r\n            formats: this.validateListFormat(\r\n              layer.dataSource.options.download.allowedFormats\r\n            )\r\n          });\r\n        } else if (\r\n          !(layer instanceof VectorLayer) &&\r\n          layer.dataSource.options.download &&\r\n          layer.dataSource.options.download.url\r\n        ) {\r\n          formatsType.onlyUrl = true;\r\n        } else if (\r\n          layer.dataSource.options.download &&\r\n          (layer.dataSource.options.download.url ||\r\n            layer.dataSource.options.download.dynamicUrl)\r\n        ) {\r\n          formatsType.vectorAndUrl = true;\r\n        } else if (layer instanceof VectorLayer) {\r\n          formatsType.onlyVector = true;\r\n        }\r\n      });\r\n\r\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\r\n        appliedformats = ['URL'];\r\n      } else if (\r\n        formatsType.onlyVector === true &&\r\n        formatsType.onlyUrl === false\r\n      ) {\r\n        this.computeFormats(); // reset\r\n        if (ExportFormat.URL in this.formats$.value) {\r\n          const keys = Object.keys(this.formats$.value).filter(\r\n            (key) => key !== 'URL'\r\n          );\r\n          appliedformats = keys;\r\n        }\r\n      } else if (\r\n        formatsType.vectorAndUrl === true &&\r\n        formatsType.onlyUrl === false &&\r\n        formatsType.onlyVector === false\r\n      ) {\r\n        this.computeFormats(); // reset\r\n        if (!(ExportFormat.URL in this.formats$.value)) {\r\n          const keys = Object.keys(this.formats$.value);\r\n          keys.push('URL');\r\n          appliedformats = keys;\r\n        }\r\n      }\r\n    }\r\n    const configImportExportFormats = this.config.getConfig(\r\n      'importExport.formats'\r\n    );\r\n    if (configImportExportFormats) {\r\n      const validatedListFormat = this.validateListFormat(\r\n        configImportExportFormats\r\n      );\r\n      appliedformats = appliedformats.filter((af) =>\r\n        validatedListFormat.includes(af)\r\n      );\r\n    }\r\n    if (formatsType.customList) {\r\n      let commonFormats;\r\n      const layersWithCustomFormats = [];\r\n      let previousCustomListFormats = customList[0].formats;\r\n      customList.map((list) => {\r\n        layersWithCustomFormats.push(list.layer);\r\n        commonFormats = list.formats.filter((value) =>\r\n          previousCustomListFormats.includes(value)\r\n        );\r\n        previousCustomListFormats = list.formats;\r\n      });\r\n      const finalFormats = commonFormats.filter((value) =>\r\n        appliedformats.includes(value)\r\n      );\r\n      if (finalFormats.length > 0) {\r\n        this.formats$.next(strEnum(finalFormats));\r\n\r\n        if (layers && layers.length) {\r\n          if (layers.length > 1) {\r\n            this.messageService.alert(\r\n              'igo.geo.export.customList.text',\r\n              'igo.geo.export.customList.title',\r\n              undefined,\r\n              { value: layersWithCustomFormats.join() }\r\n            );\r\n          }\r\n        }\r\n      } else {\r\n        this.formats$.next([]);\r\n        this.messageService.alert(\r\n          'igo.geo.export.noFormat.text',\r\n          'igo.geo.export.noFormat.title'\r\n        );\r\n      }\r\n      return;\r\n    } else {\r\n      this.formats$.next(strEnum(appliedformats));\r\n    }\r\n  }\r\n\r\n  private validateListFormat(formats: string[]): string[] {\r\n    return formats\r\n      .filter((format) => {\r\n        if (\r\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\r\n        ) {\r\n          return format;\r\n        }\r\n      })\r\n      .map((format) => {\r\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\r\n          format = ExportFormat.CSVcomma;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\r\n          format = ExportFormat.CSVsemicolon;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\r\n          format = ExportFormat.GML;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\r\n          format = ExportFormat.GPX;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\r\n          format = ExportFormat.GeoJSON;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\r\n          format = ExportFormat.KML;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\r\n          format = ExportFormat.Shapefile;\r\n          return format;\r\n        }\r\n\r\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\r\n          format = ExportFormat.URL;\r\n          return format;\r\n        }\r\n      });\r\n  }\r\n\r\n  public modeChanged(mode) {\r\n    this.selectMode.emit(mode);\r\n  }\r\n\r\n  private onFileExportSuccess() {\r\n    handleFileExportSuccess(this.messageService);\r\n  }\r\n\r\n  onImportExportChange(event) {\r\n    this.selectedMode = event.value;\r\n  }\r\n}\r\n","import {\r\n  getEntityProperty,\r\n  EntityTableColumn,\r\n  EntityTableColumnRenderer\r\n} from '@igo2/common';\r\nimport { MessageService } from '@igo2/core';\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport { ExportNothingToExportError } from './export.errors';\r\n\r\nexport function handleFileExportError(\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  if (error instanceof ExportNothingToExportError) {\r\n    handleNothingToExportError(messageService);\r\n    return;\r\n  }\r\n  messageService.error(\r\n    'igo.geo.export.failed.text',\r\n    'igo.geo.export.failed.title'\r\n  );\r\n}\r\n\r\nexport function handleFileExportSuccess(messageService: MessageService) {\r\n  messageService.success(\r\n    'igo.geo.export.success.text',\r\n    'igo.geo.export.success.title'\r\n  );\r\n}\r\n\r\nexport function handleNothingToExportError(messageService: MessageService) {\r\n  messageService.error(\r\n    'igo.geo.export.nothing.text',\r\n    'igo.geo.export.nothing.title'\r\n  );\r\n}\r\n\r\n/**\r\n * Export array to CSV\r\n *\r\n * @param rows Array of arrays to export as CSV\r\n * @param separator Cell separator\r\n */\r\nexport function exportToCSV(\r\n  rows: any[][],\r\n  fileName: string,\r\n  separator: string = ';'\r\n) {\r\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\r\n  const csvContent = lines.join('\\n');\r\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\r\n}\r\n\r\n/**\r\n * Return an array of values from an array of entities.\r\n *\r\n * @param entities Array of entities\r\n * @param scolumns Columns definition of the output data\r\n */\r\nexport function entitiesToRowData(\r\n  entities: object[],\r\n  columns: EntityTableColumn[]\r\n) {\r\n  return entities.map((entity: object) => {\r\n    return columns.map((column: EntityTableColumn) => {\r\n      let valueAccessor;\r\n      if (\r\n        column.renderer === undefined ||\r\n        column.renderer === EntityTableColumnRenderer.Default\r\n      ) {\r\n        valueAccessor = column.valueAccessor;\r\n      }\r\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\r\n      return valueAccessor(entity, column.name);\r\n    });\r\n  });\r\n}\r\n","<button\r\n  *ngIf=\"layerIsExportable()\"\r\n  mat-icon-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\r\n  [color]=\"color\"\r\n>\r\n  <!-- (click)=\"openDownload(layer)\"> -->\r\n  <mat-icon svgIcon=\"file-export\"></mat-icon>\r\n</button>\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { DataSourceOptions } from '../../datasource';\r\n\r\n@Component({\r\n  selector: 'igo-export-button',\r\n  templateUrl: './export-button.component.html',\r\n  styleUrls: ['./export-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ExportButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor() {}\r\n\r\n  get options(): DataSourceOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.dataSource.options;\r\n  }\r\n\r\n  layerIsExportable(): boolean {\r\n    if (\r\n      (this.layer instanceof VectorLayer && this.layer.exportable === true) ||\r\n      (this.layer.dataSource.options.download &&\r\n        this.layer.dataSource.options.download.url) ||\r\n      (this.layer.options.workspace?.enabled &&\r\n        this.layer.options.workspace?.workspaceId !== this.layer.id)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-zoom-button',\r\n  templateUrl: './zoom-button.component.html',\r\n  styleUrls: ['./zoom-button.component.scss']\r\n})\r\nexport class ZoomButtonComponent {\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string;\r\n\r\n  get zoom(): number {\r\n    return this.map.viewController.getZoom();\r\n  }\r\n\r\n  get minZoom(): number {\r\n    return this.map.viewController.olView.getMinZoom() || 1;\r\n  }\r\n\r\n  get maxZoom(): number {\r\n    return this.map.viewController.olView.getMaxZoom();\r\n  }\r\n\r\n  constructor() {}\r\n}\r\n","<div class=\"igo-zoom-button-container\">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: { zoom: zoom + 1 }\"\r\n    matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    [disabled]=\"zoom >= maxZoom\"\r\n    (click)=\"map.viewController.zoomIn()\"\r\n  >\r\n    <mat-icon svgIcon=\"plus\"></mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: { zoom: zoom - 1 }\"\r\n    matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    [disabled]=\"zoom <= minZoom\"\r\n    (click)=\"map.viewController.zoomOut()\"\r\n  >\r\n    <mat-icon svgIcon=\"minus\"></mat-icon>\r\n  </button>\r\n</div>\r\n","<div class=\"igo-geolocate-button-container\" *ngIf=\"map.geolocationController\">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]=\"\r\n      map.geolocationController.tracking\r\n        ? ('igo.geo.mapButtons.geolocateInactive' | translate)\r\n        : ('igo.geo.mapButtons.geolocate' | translate)\r\n    \"\r\n    matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    (click)=\"onGeolocationClick()\"\r\n  >\r\n    <mat-icon svgIcon=\"{{ icon$ | async }}\"></mat-icon>\r\n  </button>\r\n</div>\r\n","import { AfterContentInit, Component, Input, OnDestroy } from '@angular/core';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-geolocate-button',\r\n  templateUrl: './geolocate-button.component.html',\r\n  styleUrls: ['./geolocate-button.component.scss']\r\n})\r\nexport class GeolocateButtonComponent implements AfterContentInit, OnDestroy {\r\n  private tracking$$: Subscription;\r\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'crosshairs-gps'\r\n  );\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get color(): string {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color: string;\r\n\r\n  constructor(private configService: ConfigService) {}\r\n  ngAfterContentInit(): void {\r\n    this.map.ol.once('rendercomplete', () => {\r\n      this.tracking$$ = this.map.geolocationController.tracking$.subscribe(\r\n        (tracking) => {\r\n          if (tracking) {\r\n            this.icon$.next('crosshairs-gps');\r\n          } else {\r\n            this.configService.getConfig('geolocate.basic')\r\n              ? this.icon$.next('crosshairs-gps')\r\n              : this.icon$.next('crosshairs');\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.tracking$$) {\r\n      this.tracking$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  onGeolocationClick() {\r\n    const tracking = this.map.geolocationController.tracking;\r\n    this.map.geolocationController.tracking = tracking ? false : true;\r\n  }\r\n}\r\n","import { ConfigService } from '@igo2/core';\r\nimport { Component, Input } from '@angular/core';\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapExtent } from '../shared/map.interface';\r\nimport * as olproj from 'ol/proj';\r\n/*\r\nButton to center the map to the home extent\r\n*/\r\n@Component({\r\n  selector: 'igo-home-extent-button',\r\n  templateUrl: './home-extent-button.component.html',\r\n  styleUrls: ['./home-extent-button.component.scss']\r\n})\r\nexport class HomeExtentButtonComponent {\r\n  @Input() map: IgoMap;\r\n  @Input() color: string;\r\n  @Input() extentOverride?: MapExtent;\r\n  @Input() centerOverride?: [number, number];\r\n  @Input() zoomOverride?: number;\r\n\r\n  private homeExtentButtonExtent;\r\n  private homeExtentButtonCenter;\r\n  private homeExtentButtonZoom;\r\n\r\n  constructor(public configService: ConfigService) {\r\n    this.computeHomeExtent();\r\n  }\r\n\r\n  computeHomeExtent() {\r\n    this.homeExtentButtonExtent =\r\n      this.extentOverride ||\r\n      this.configService.getConfig('homeExtentButton.homeExtButtonExtent');\r\n    this.homeExtentButtonCenter =\r\n      this.centerOverride ||\r\n      this.configService.getConfig('homeExtentButton.homeExtButtonCenter');\r\n    this.homeExtentButtonZoom =\r\n      this.zoomOverride ||\r\n      this.configService.getConfig('homeExtentButton.homeExtButtonZoom');\r\n\r\n    // priority over extent if these 2 properties are defined;\r\n    if (this.centerOverride && this.zoomOverride) {\r\n      this.homeExtentButtonExtent = undefined;\r\n    }\r\n  }\r\n\r\n  onToggleClick() {\r\n    this.computeHomeExtent();\r\n    if (this.homeExtentButtonExtent) {\r\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\r\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\r\n      const center = olproj.fromLonLat(\r\n        this.homeExtentButtonCenter,\r\n        this.map.viewController.olView.getProjection().getCode()\r\n      );\r\n      this.map.viewController.olView.setCenter(center);\r\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\r\n    }\r\n  }\r\n}\r\n","<div class=\"igo-home-extent-button-container\">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\r\n    matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    (click)=\"onToggleClick()\"\r\n  >\r\n    <mat-icon svgIcon=\"home-map-marker\"></mat-icon>\r\n  </button>\r\n</div>\r\n","import { Component, Input } from '@angular/core';\r\nimport { StorageService } from '@igo2/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport NoSleep from 'nosleep.js';\r\nimport { userAgent } from '@igo2/utils';\r\n\r\n@Component({\r\n  selector: 'igo-wake-lock-button',\r\n  templateUrl: './wake-lock-button.component.html',\r\n  styleUrls: ['./wake-lock-button.component.scss']\r\n})\r\n\r\n/**\r\n * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\r\n * On iOS, the Wake Lock API is not supported\r\n * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\r\n * On not supported browser, a fake video is used to keep the screen open.\r\n *\r\n * TODO: When the API will be supported by every browser, We should remove the NoSleep.js dependency\r\n * and replace it by a WakeLock API implementation.\r\n */\r\nexport class WakeLockButtonComponent {\r\n  @Input() color: string = 'primary';\r\n  @Input()\r\n  get enabled(): boolean {\r\n    return this.storageService.get('wakeLockEnabled') as boolean;\r\n  }\r\n  set enabled(value: boolean) {\r\n    this.storageService.set('wakeLockEnabled', value);\r\n  }\r\n\r\n  private noSleep: NoSleep;\r\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('sleep');\r\n  public visible = false;\r\n\r\n  constructor(private storageService: StorageService) {\r\n    this.noSleep = new NoSleep();\r\n    const nonWakeLockApiBrowser = userAgent.satisfies({\r\n      ie: '>0',\r\n      edge: '<84',\r\n      chrome: '<84',\r\n      firefox: '>0',\r\n      opera: '<70',\r\n      safari: '>0'\r\n    });\r\n    if (nonWakeLockApiBrowser) {\r\n      this.disableWakeLock();\r\n      this.enabled = false;\r\n      window.addEventListener('blur', () => {\r\n        this.disableWakeLock();\r\n        this.enabled = false;\r\n      });\r\n    }\r\n    this.enabled ? this.enableWakeLock() : this.disableWakeLock();\r\n  }\r\n\r\n  /**\r\n   * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\r\n   * On iOS, the Wake Lock API is not supported\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\r\n   * On not supported browser, a fake video is used to keep the screen open.\r\n   */\r\n  private enableWakeLock() {\r\n    this.noSleep.enable();\r\n    this.enabled = true;\r\n    this.icon$.next('sleep-off');\r\n  }\r\n  /**\r\n   * Let display sleep\r\n   */\r\n  private disableWakeLock() {\r\n    this.noSleep.disable();\r\n    this.enabled = false;\r\n    this.icon$.next('sleep');\r\n  }\r\n\r\n  toggleWakeLock() {\r\n    if (this.enabled) {\r\n      this.disableWakeLock();\r\n    } else {\r\n      this.enableWakeLock();\r\n    }\r\n  }\r\n}\r\n","<div class=\"igo-wake-lock-button-container\">\r\n  <button\r\n    [color]=\"color\"\r\n    mat-icon-button\r\n    [matTooltip]=\"\r\n      enabled\r\n        ? ('igo.geo.mapButtons.preventScreenLock' | translate)\r\n        : ('igo.geo.mapButtons.letScreenLock' | translate)\r\n    \"\r\n    matTooltipPosition=\"left\"\r\n    (click)=\"toggleWakeLock()\"\r\n  >\r\n    <mat-icon svgIcon=\"{{ icon$ | async }}\"></mat-icon>\r\n  </button>\r\n</div>\r\n","<div\r\n  *ngIf=\"((rotated$ | async) && !showIfNoRotation) || showIfNoRotation\"\r\n  class=\"igo-rotation-button-container\"\r\n  [matTooltip]=\"\r\n    (rotated$ | async)\r\n      ? ('igo.geo.mapButtons.resetRotation'\r\n        | translate: { azimuth: azimuthRounded, rotation: rotationRounded })\r\n      : ('igo.geo.mapButtons.tipRotation' | translate)\r\n  \"\r\n  matTooltipPosition=\"left\"\r\n>\r\n  <button\r\n    mat-icon-button\r\n    matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    [disabled]=\"(rotated$ | async) === false\"\r\n    (click)=\"map.viewController.resetRotation()\"\r\n  >\r\n    <mat-icon [ngStyle]=\"currentStyle$ | async\" svgIcon=\"navigation\">\r\n    </mat-icon>\r\n  </button>\r\n</div>\r\n","import { AfterContentInit, Component, Input } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { bearingToAzimuth } from '@turf/helpers';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-rotation-button',\r\n  templateUrl: './rotation-button.component.html',\r\n  styleUrls: ['./rotation-button.component.scss']\r\n})\r\nexport class RotationButtonComponent implements AfterContentInit {\r\n  readonly rotated$ = new BehaviorSubject<boolean>(false);\r\n  public azimuthRounded: number = 0;\r\n  public rotationRounded: number = 0;\r\n  readonly currentStyle$ = new BehaviorSubject<{}>({\r\n    transform: 'rotate(0rad)'\r\n  });\r\n\r\n  @Input() map: IgoMap;\r\n  @Input() showIfNoRotation: boolean;\r\n  @Input() color: string;\r\n\r\n  constructor() {}\r\n\r\n  ngAfterContentInit() {\r\n    this.map.viewController.rotation$.subscribe((r) => {\r\n      const radians = r || 0;\r\n      const deg = (radians * 180) / Math.PI;\r\n      this.rotationRounded = Math.round(deg);\r\n      this.azimuthRounded = Math.round(bearingToAzimuth(deg * -1));\r\n      this.currentStyle$.next({\r\n        transform: 'rotate(' + radians + 'rad)'\r\n      });\r\n      this.rotated$.next(radians !== 0);\r\n    });\r\n  }\r\n}\r\n","export enum OverlayAction {\r\n  None,\r\n  Move,\r\n  Zoom,\r\n  ZoomIfOutMapExtent\r\n}\r\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\n\r\nimport { OverlayService } from '../shared/overlay.service';\r\nimport { OverlayAction } from '../shared/overlay.enum';\r\n\r\n@Directive({\r\n  selector: '[igoOverlay]'\r\n})\r\nexport class OverlayDirective implements OnInit, OnDestroy {\r\n  private features$$: Subscription;\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private overlayService: OverlayService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.features$$ = this.overlayService.features$.subscribe((res) =>\r\n      this.handleFeatures(res[0], res[1])\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.features$$.unsubscribe();\r\n  }\r\n\r\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2016-2017 Dan \"Ducky\" Little\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport default function jsGeoPdfPlugin(jsPDFAPI) {\r\n  const setGeoArea = function (pdfExt, geoExt) {\r\n    const bbox = pdfExt.join(' ');\r\n    // the ordering may seem odd here but PDF\r\n    //  flips the Y axis upside down and this accounts for that\r\n    //  change.\r\n    const minx = geoExt[0];\r\n    const maxx = geoExt[2];\r\n    const maxy = geoExt[1];\r\n    const miny = geoExt[3];\r\n    const bounds = [miny, minx, maxy, minx, maxy, maxx, miny, maxx].join(' ');\r\n    const bbox_obj = this.internal.newAdditionalObject();\r\n    const bounds_obj = this.internal.newAdditionalObject();\r\n    const proj_obj = this.internal.newAdditionalObject();\r\n\r\n    proj_obj.content =\r\n      '<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS[\"WGS_1984_Web_Mercator_Auxiliary_Sphere\"' +\r\n      ',GEOGCS[\"GCS_WGS_1984\",DATUM[\"D_WGS_1984\",SPHEROID[\"WGS_1984\",6378137.0,298.257223563]],PRIMEM[\"Greenwich\",0.0]' +\r\n      ',UNIT[\"Degree\",0.017453292519943295]],PROJECTION[\"Mercator_Auxiliary_Sphere\"],PARAMETER[\"False_Easting\",0.0]' +\r\n      ',PARAMETER[\"False_Northing\",0.0],PARAMETER[\"Central_Meridian\",0.0],PARAMETER[\"Standard_Parallel_1\",0.0]' +\r\n      ',PARAMETER[\"Auxiliary_Sphere_Type\",0.0],UNIT[\"Meter\",1.0]]) >>';\r\n\r\n    bounds_obj.content =\r\n      '<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS ' +\r\n      proj_obj.objId +\r\n      ' 0 R /GPTS [ ' +\r\n      bounds +\r\n      ' ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>';\r\n\r\n    bbox_obj.content =\r\n      '<< /BBox [ ' +\r\n      bbox +\r\n      ' ] /Measure ' +\r\n      bounds_obj.objId +\r\n      ' 0 R /Name (Layer) /Type /Viewport >>';\r\n\r\n    const title_obj = this.internal.newAdditionalObject();\r\n    const date = new Date().toLocaleDateString('en-CA');\r\n    title_obj.content = '<< /Name IGO2 /Type /OCG /Date ' + date + ' >>';\r\n\r\n    return bbox_obj.objId;\r\n  };\r\n\r\n  jsPDFAPI.setGeoArea = function (pdfExt, geoExt) {\r\n    this.internal.events.subscribe('putPage', function () {\r\n      const bbox_id = setGeoArea.call(this, pdfExt, geoExt);\r\n      this.internal.write('/VP [ ' + bbox_id + ' 0 R ]');\r\n    });\r\n  };\r\n}\r\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\nexport type PrintResolution = keyof typeof PrintResolution;\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { Observable, Subject, forkJoin } from 'rxjs';\r\nimport { map as rxMap } from 'rxjs/operators';\r\n\r\nimport { saveAs } from 'file-saver';\r\nimport jsPDF from 'jspdf';\r\nimport html2canvas from 'html2canvas';\r\nimport { default as JSZip } from 'jszip';\r\n\r\nimport { SubjectStatus } from '@igo2/utils';\r\nimport { SecureImagePipe } from '@igo2/common';\r\nimport {\r\n  MessageService,\r\n  ActivityService,\r\n  LanguageService,\r\n  ConfigService\r\n} from '@igo2/core';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { formatScale } from '../../map/shared/map.utils';\r\nimport { LegendMapViewOptions } from '../../layer/shared/layers/legend.interface';\r\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\r\n\r\nimport { PrintOptions, TextPdfSizeAndMargin } from './print.interface';\r\nimport GeoPdfPlugin from './geopdf';\r\nimport {\r\n  PrintLegendPosition,\r\n  PrintPaperFormat,\r\n  PrintResolution\r\n} from './print.type';\r\n\r\ndeclare global {\r\n  interface Navigator {\r\n    msSaveBlob?: (blob: any, defaultName?: string) => boolean;\r\n  }\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PrintService {\r\n  zipFile: JSZip;\r\n  nbFileToProcess: number;\r\n  activityId: string;\r\n  imgSizeAdded: Array<number>;\r\n\r\n  TEXTPDFFONT = {\r\n    titleFont: 'Times',\r\n    titleFontStyle: 'bold',\r\n    subtitleFont: 'Times',\r\n    subtitleFontStyle: 'bold',\r\n    commentFont: 'courier',\r\n    commentFontStyle: 'normal',\r\n    commentFontSize: 12\r\n  };\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private messageService: MessageService,\r\n    private activityService: ActivityService,\r\n    private languageService: LanguageService,\r\n    private configService: ConfigService\r\n  ) {}\r\n\r\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\r\n    const status$ = new Subject();\r\n    const paperFormat: string = options.paperFormat;\r\n    const resolution = +options.resolution; // Default is 96\r\n    const orientation = options.orientation;\r\n    const legendPostion = options.legendPosition;\r\n    this.activityId = this.activityService.register();\r\n\r\n    GeoPdfPlugin(jsPDF.API);\r\n\r\n    const doc = new jsPDF({\r\n      orientation,\r\n      format: paperFormat.toLowerCase(),\r\n      unit: 'mm' // default\r\n    });\r\n\r\n    const dimensions = [\r\n      doc.internal.pageSize.width,\r\n      doc.internal.pageSize.height\r\n    ];\r\n\r\n    const margins = [10, 10, 10, 10];\r\n    const width = dimensions[0] - margins[3] - margins[1];\r\n    const height = dimensions[1] - margins[0] - margins[2];\r\n    const size: [number, number] = [width, height];\r\n    let titleSizes: TextPdfSizeAndMargin;\r\n    let subtitleSizes: TextPdfSizeAndMargin;\r\n\r\n    // if paper format A1 or A0 add margin top\r\n    if (\r\n      (options.title !== '' || options.subtitle !== '') &&\r\n      (paperFormat === PrintPaperFormat.A1 ||\r\n        paperFormat === PrintPaperFormat.A0)\r\n    ) {\r\n      margins[0] += 10;\r\n    }\r\n    // PDF title\r\n    const fontSizeInPt = Math.round(2 * (height + 145) * 0.05) / 2; //calculate the fontSize title from the page height.\r\n    if (options.title !== undefined && options.title !== '') {\r\n      titleSizes = this.getTextPdfObjectSizeAndMarg(\r\n        options.title,\r\n        margins,\r\n        this.TEXTPDFFONT.titleFont,\r\n        fontSizeInPt,\r\n        this.TEXTPDFFONT.titleFontStyle,\r\n        doc\r\n      );\r\n\r\n      this.addTextInPdfDoc(\r\n        doc,\r\n        options.title,\r\n        this.TEXTPDFFONT.titleFont,\r\n        this.TEXTPDFFONT.titleFontStyle,\r\n        titleSizes.fontSize,\r\n        titleSizes.marginLeft + margins[3],\r\n        margins[0]\r\n      );\r\n\r\n      margins[0] = titleSizes.height + margins[0]; // cumulative margin top for next elem to place in pdf doc\r\n    }\r\n\r\n    // PDF subtitle\r\n    if (options.subtitle !== undefined && options.subtitle !== '') {\r\n      subtitleSizes = this.getTextPdfObjectSizeAndMarg(\r\n        options.subtitle,\r\n        margins,\r\n        this.TEXTPDFFONT.subtitleFont,\r\n        options.title !== '' ? titleSizes.fontSize * 0.7 : fontSizeInPt * 0.7, // 70% size of title\r\n        this.TEXTPDFFONT.subtitleFontStyle,\r\n        doc\r\n      );\r\n\r\n      this.addTextInPdfDoc(\r\n        doc,\r\n        options.subtitle,\r\n        this.TEXTPDFFONT.subtitleFont,\r\n        this.TEXTPDFFONT.subtitleFontStyle,\r\n        subtitleSizes.fontSize,\r\n        subtitleSizes.marginLeft + margins[3],\r\n        margins[0]\r\n      );\r\n\r\n      margins[0] += 5; // cumulative marg top for next elem to place in pdf doc. 5 is a fix it could be adjust\r\n    }\r\n\r\n    if (options.showProjection === true || options.showScale === true) {\r\n      this.addProjScale(\r\n        doc,\r\n        map,\r\n        resolution,\r\n        options.showProjection,\r\n        options.showScale\r\n      );\r\n    }\r\n    if (options.comment !== undefined && options.comment !== '') {\r\n      this.addComment(doc, options.comment);\r\n    }\r\n\r\n    this.addMap(doc, map, resolution, size, margins, legendPostion).subscribe(\r\n      async (status: SubjectStatus) => {\r\n        if (status === SubjectStatus.Done) {\r\n          await this.handleMeasureLayer(doc, map, margins);\r\n\r\n          const width = this.imgSizeAdded[0];\r\n          const height = this.imgSizeAdded[1];\r\n          const res = 1;\r\n          this.addGeoRef(doc, map, width, height, res, margins);\r\n\r\n          if (options.legendPosition !== 'none') {\r\n            if (\r\n              ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\r\n                options.legendPosition\r\n              ) > -1\r\n            ) {\r\n              await this.addLegendSamePage(\r\n                doc,\r\n                map,\r\n                margins,\r\n                resolution,\r\n                options.legendPosition\r\n              );\r\n            } else if (options.legendPosition === 'newpage') {\r\n              await this.addLegend(doc, map, margins, resolution);\r\n            }\r\n          } else {\r\n            await this.saveDoc(doc);\r\n          }\r\n        }\r\n\r\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\r\n          this.activityService.unregister(this.activityId);\r\n          status$.next(SubjectStatus.Done);\r\n        }\r\n      }\r\n    );\r\n\r\n    return status$;\r\n  }\r\n  // ref GeoMoose https://github.com/geomoose/gm3/tree/main/src/gm3/components/print\r\n  addGeoRef(doc, map, width, height, resolution, margins) {\r\n    const unit = 'mm';\r\n    const docHeight = doc.internal.pageSize.getHeight();\r\n\r\n    // x,y = margin left-bottom corner for img in pdf doc\r\n    const x = margins[3];\r\n    const y = docHeight - margins[0] - height;\r\n\r\n    let pdf_extents = [x, y, x + width, y + height];\r\n    for (let i = 0; i < pdf_extents.length; i++) {\r\n      pdf_extents[i] = this.pdf_units2points(pdf_extents[i], unit);\r\n    }\r\n\r\n    const mapExtent = map.viewController.getExtent('EPSG:3857');\r\n    doc.setGeoArea(pdf_extents, mapExtent);\r\n  }\r\n\r\n  /**\r\n   * Add measure overlay on the map on the document when the measure layer is present\r\n   * @param  doc - Pdf document where measure tooltip will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private async handleMeasureLayer(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    margins: Array<number>\r\n  ) {\r\n    if (\r\n      map.layers.find(\r\n        (layer) => layer.visible && layer.id.startsWith('igo-measures-')\r\n      )\r\n    ) {\r\n      let canvasOverlayHTMLMeasures;\r\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\r\n      await html2canvas(mapOverlayMeasuresHTML, {\r\n        scale: 1,\r\n        backgroundColor: null\r\n      }).then((e) => {\r\n        canvasOverlayHTMLMeasures = e;\r\n      });\r\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get html code for all layers legend\r\n   * @param  map IgoMap\r\n   * @param  width The width that the legend need to be\r\n   * @return Html code for the legend\r\n   */\r\n  getLayersLegendHtml(\r\n    map: IgoMap,\r\n    width: number,\r\n    resolution: number\r\n  ): Observable<string> {\r\n    return new Observable((observer) => {\r\n      let html = '';\r\n      const legends = getLayersLegends(map.layers, {\r\n        resolution: map.viewController.getResolution(),\r\n        extent: map.viewController.getExtent(),\r\n        projection: map.viewController.getOlProjection().getCode(),\r\n        // scale: map.viewController.getScale(resolution),\r\n        size: map.ol.getSize()\r\n      } as LegendMapViewOptions);\r\n\r\n      if (legends.filter((l) => l.display === true).length === 0) {\r\n        observer.next(html);\r\n        observer.complete();\r\n        return;\r\n      }\r\n      // Define important style to be sure that all container is convert\r\n      // to image not just visible part\r\n      html += '<style media=\"screen\" type=\"text/css\">';\r\n      html +=\r\n        '.html2canvas-container { width: ' +\r\n        width +\r\n        'mm !important; height: 2000px !important; }';\r\n      html += 'table.tableLegend {table-layout: auto;}';\r\n      html +=\r\n        'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\r\n      html += '</style>';\r\n      // The font size will also be lowered afterwards (globally along the legend size)\r\n      // this allows having a good relative font size here and to keep ajusting the legend size\r\n      // while keeping good relative font size\r\n      html += '<font size=\"3\" face=\"Times\" >';\r\n      html += '<div class=\"styleLegend\">';\r\n      html += '<table class=\"tableLegend\" >';\r\n\r\n      // For each legend, define an html table cell\r\n      const images$ = legends\r\n        .filter((l) => l.display && l.isInResolutionsRange === true)\r\n        .map((legend) =>\r\n          this.getDataImage(legend.url).pipe(\r\n            rxMap((dataImage) => {\r\n              let htmlImg =\r\n                '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\r\n              htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\r\n              return htmlImg;\r\n            })\r\n          )\r\n        );\r\n      forkJoin(images$).subscribe((dataImages) => {\r\n        html = dataImages.reduce((acc, current) => (acc += current), html);\r\n        html += '</table>';\r\n        html += '</div>';\r\n        observer.next(html);\r\n        observer.complete();\r\n      });\r\n    });\r\n  }\r\n\r\n  getDataImage(url: string): Observable<string> {\r\n    const secureIMG = new SecureImagePipe(this.http, this.configService);\r\n    return secureIMG.transform(url);\r\n  }\r\n\r\n  /**\r\n   * Get all the legend in a single image\r\n   * * @param  format - Image format. default value to \"png\"\r\n   * @return The image of the legend\r\n   */\r\n  async getLayersLegendImage(\r\n    map,\r\n    format: string = 'png',\r\n    doZipFile: boolean,\r\n    resolution: number\r\n  ) {\r\n    const status$ = new Subject();\r\n    // Get html code for the legend\r\n    const width = 200; // milimeters unit, originally define for document pdf\r\n    let html = await this.getLayersLegendHtml(\r\n      map,\r\n      width,\r\n      resolution\r\n    ).toPromise();\r\n    format = format.toLowerCase();\r\n\r\n    // If no legend show No LEGEND in an image\r\n    if (html.length === 0) {\r\n      html = '<font size=\"12\" face=\"Courier New\" >';\r\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n    div.style.zIndex = '-1';\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n\r\n    await this.timeout(1);\r\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\r\n      console.log(e);\r\n    });\r\n    this.removeHtmlElement(div);\r\n    if (canvas) {\r\n      let status = SubjectStatus.Done;\r\n      try {\r\n        if (!doZipFile) {\r\n          // Save the canvas as file\r\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\r\n        }\r\n      } catch (err) {\r\n        status = SubjectStatus.Error;\r\n      }\r\n      status$.next(status);\r\n    }\r\n\r\n    return status$;\r\n  }\r\n\r\n  private removeHtmlElement(element: HTMLElement) {\r\n    element.parentNode.removeChild(element);\r\n  }\r\n\r\n  getTextPdfObjectSizeAndMarg(\r\n    text: string,\r\n    margins,\r\n    font: string,\r\n    fontSizeInPt: number,\r\n    fontStyle: string,\r\n    doc: jsPDF\r\n  ): TextPdfSizeAndMargin {\r\n    const pdfResolution = 96;\r\n    const docWidth = doc.internal.pageSize.getWidth();\r\n    const pageWidth = docWidth - margins[1] - margins[3];\r\n\r\n    // important to set it first, the textDimension change when font change!\r\n    doc.setFont(font, fontStyle);\r\n    doc.setFontSize(fontSizeInPt);\r\n\r\n    let textDimensions = doc.getTextDimensions(text);\r\n    let textMarginLeft: number;\r\n\r\n    if (textDimensions.w > pageWidth) {\r\n      // if the text is to long, reduce fontSize 70% and the overflow with be cut in print...\r\n      textMarginLeft = 0;\r\n      fontSizeInPt = fontSizeInPt * 0.7;\r\n      doc.setFontSize(fontSizeInPt);\r\n      textDimensions = doc.getTextDimensions(text);\r\n    } else {\r\n      textMarginLeft = (pageWidth - textDimensions.w) / 2;\r\n    }\r\n\r\n    return {\r\n      fontSize: fontSizeInPt,\r\n      marginLeft: textMarginLeft,\r\n      height: textDimensions.h\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add comment to the document\r\n   * * @param  doc - pdf document\r\n   * * @param  comment - Comment to add in the document\r\n   */\r\n  private addComment(doc: jsPDF, comment: string) {\r\n    const commentMarginLeft = 10; //margin left and bottom is fix\r\n    const commentMarginBottom = 10;\r\n    const marginTop = doc.internal.pageSize.height - commentMarginBottom;\r\n    this.addTextInPdfDoc(\r\n      doc,\r\n      comment,\r\n      this.TEXTPDFFONT.commentFont,\r\n      this.TEXTPDFFONT.commentFontStyle,\r\n      this.TEXTPDFFONT.commentFontSize,\r\n      commentMarginLeft,\r\n      marginTop,\r\n      true\r\n    );\r\n  }\r\n\r\n  private addTextInPdfDoc(\r\n    doc: jsPDF,\r\n    textToAdd: string,\r\n    textFont: string,\r\n    textFontStyle: string,\r\n    textFontSize: number,\r\n    textMarginLeft: number,\r\n    textMarginTop: number,\r\n    isComment: boolean = false\r\n  ) {\r\n    doc.setFont(textFont, textFontStyle);\r\n    doc.setFontSize(textFontSize);\r\n\r\n    if (isComment) {\r\n      textToAdd = doc.splitTextToSize(\r\n        textToAdd,\r\n        doc.internal.pageSize.getWidth() - textMarginLeft * 3\r\n      );\r\n    }\r\n    doc.text(textToAdd, textMarginLeft, textMarginTop);\r\n  }\r\n\r\n  /**\r\n   * Add projection and/or scale to the document\r\n   * @param  doc - pdf document\r\n   * @param  map - Map of the app\r\n   * @param  dpi - DPI resolution of the document\r\n   * @param  projection - Bool to indicate if projection need to be added\r\n   * @param  scale - Bool to indicate if scale need to be added\r\n   */\r\n  private addProjScale(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    dpi: number,\r\n    projection: boolean,\r\n    scale: boolean\r\n  ) {\r\n    const translate = this.languageService.translate;\r\n    const projScaleSize = 12;\r\n    const projScaleMarginLeft = 10;\r\n    const marginBottom = 15;\r\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\r\n\r\n    let textProjScale: string = '';\r\n    if (projection === true) {\r\n      const projText = translate.instant('igo.geo.printForm.projection');\r\n      textProjScale += projText + ': ' + map.projection;\r\n    }\r\n    if (scale === true) {\r\n      if (projection === true) {\r\n        textProjScale += '   ';\r\n      }\r\n      const scaleText = translate.instant('igo.geo.printForm.scale');\r\n      const mapScale = map.viewController.getScale(dpi);\r\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\r\n    }\r\n    doc.setFont('courier');\r\n    doc.setFontSize(projScaleSize);\r\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\r\n  }\r\n\r\n  /**\r\n   * Add the legend to the document\r\n   * @param  doc - Pdf document where legend will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private async addLegend(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    margins: Array<number>,\r\n    resolution: number\r\n  ) {\r\n    // Get html code for the legend\r\n    const width = doc.internal.pageSize.width;\r\n    const html = await this.getLayersLegendHtml(\r\n      map,\r\n      width,\r\n      resolution\r\n    ).toPromise();\r\n    // If no legend, save the map directly\r\n    if (html === '') {\r\n      await this.saveDoc(doc);\r\n      return true;\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n    div.style.zIndex = '-1';\r\n\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n\r\n    await this.timeout(1);\r\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\r\n      console.log(e);\r\n    });\r\n    this.removeHtmlElement(div);\r\n    if (canvas) {\r\n      const pourcentageReduction = 0.85;\r\n      const imageSize = [\r\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\r\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\r\n      ];\r\n      let imgData;\r\n      doc.addPage();\r\n      imgData = canvas.toDataURL('image/png');\r\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\r\n    }\r\n\r\n    await this.saveDoc(doc);\r\n  }\r\n\r\n  /**\r\n   * Add the legend to the document\r\n   * @param  doc - Pdf document where legend will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private async addLegendSamePage(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    margins: Array<number>,\r\n    resolution: number,\r\n    legendPosition: string\r\n  ) {\r\n    // Get html code for the legend\r\n    const width = doc.internal.pageSize.width;\r\n    const html = await this.getLayersLegendHtml(\r\n      map,\r\n      width,\r\n      resolution\r\n    ).toPromise();\r\n    // If no legend, save the map directly\r\n    if (html === '') {\r\n      await this.saveDoc(doc);\r\n      return true;\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n    div.style.zIndex = '-1';\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n    await this.timeout(1);\r\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\r\n      console.log(e);\r\n    });\r\n    this.removeHtmlElement(div);\r\n    let marginsLegend;\r\n    if (canvas) {\r\n      const pourcentageReduction = 0.85;\r\n      const imageSize = [\r\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\r\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\r\n      ];\r\n      // Move the legend to the correct position on the page\r\n      if (legendPosition === 'bottomright') {\r\n        marginsLegend = [\r\n          doc.internal.pageSize.height - margins[2] - imageSize[1],\r\n          margins[1],\r\n          margins[2],\r\n          doc.internal.pageSize.width - margins[1] - imageSize[0]\r\n        ];\r\n      } else if (legendPosition === 'topright') {\r\n        marginsLegend = [\r\n          margins[0],\r\n          margins[1],\r\n          doc.internal.pageSize.height - margins[0] - imageSize[1],\r\n          doc.internal.pageSize.width - margins[1] - imageSize[0]\r\n        ];\r\n      } else if (legendPosition === 'bottomleft') {\r\n        // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\r\n        marginsLegend = [\r\n          doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\r\n          doc.internal.pageSize.width - margins[3] - imageSize[0],\r\n          margins[2] + 15,\r\n          margins[3]\r\n        ];\r\n      } else if (legendPosition === 'topleft') {\r\n        marginsLegend = [\r\n          margins[0],\r\n          doc.internal.pageSize.width - margins[3] - imageSize[0],\r\n          doc.internal.pageSize.height - margins[0] - imageSize[1],\r\n          margins[3]\r\n        ];\r\n      }\r\n      this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\r\n      await this.saveDoc(doc);\r\n    }\r\n  }\r\n\r\n  defineNbFileToProcess(nbFileToProcess) {\r\n    this.nbFileToProcess = nbFileToProcess;\r\n  }\r\n\r\n  private timeout(ms) {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  private addCanvas(\r\n    doc: jsPDF,\r\n    canvas: HTMLCanvasElement,\r\n    margins: Array<number>\r\n  ) {\r\n    let image;\r\n    if (canvas) {\r\n      image = canvas.toDataURL('image/png');\r\n    }\r\n\r\n    if (image !== undefined) {\r\n      if (image.length < 20) {\r\n        console.log('Warning: An image cannot be print in pdf file');\r\n        return;\r\n      }\r\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\r\n      doc.addImage(\r\n        image,\r\n        'PNG',\r\n        margins[3],\r\n        margins[0],\r\n        imageSize[0],\r\n        imageSize[1]\r\n      );\r\n\r\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\r\n\r\n      this.imgSizeAdded = imageSize; // keep img size for georef later\r\n    }\r\n  }\r\n\r\n  // TODO fix printing with image resolution\r\n  addMap(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    resolution: number,\r\n    docSize: [number, number],\r\n    margins: Array<number>,\r\n    legendPostion: PrintLegendPosition\r\n  ) {\r\n    const mapSize = map.ol.getSize() as [number, number];\r\n    const viewResolution = map.ol.getView().getResolution();\r\n    const dimensionPixels = this.setMapResolution(\r\n      map,\r\n      docSize,\r\n      resolution,\r\n      viewResolution\r\n    );\r\n    const status$ = new Subject();\r\n\r\n    let timeout;\r\n    map.ol.once('rendercomplete', async (event: any) => {\r\n      const mapCanvas = event.target\r\n        .getViewport()\r\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\r\n      const mapResultCanvas = await this.drawMap(dimensionPixels, mapCanvas);\r\n\r\n      this.resetOriginalMapSize(map, mapSize, viewResolution);\r\n\r\n      await this.drawMapControls(map, mapResultCanvas, legendPostion);\r\n\r\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\r\n        clearTimeout(timeout);\r\n        if (mapStatus !== SubjectStatus.Done) {\r\n          return;\r\n        }\r\n        mapStatus$$.unsubscribe();\r\n        let status = SubjectStatus.Done;\r\n        try {\r\n          if (mapResultCanvas.width !== 0) {\r\n            this.addCanvas(doc, mapResultCanvas, margins);\r\n          }\r\n        } catch (err) {\r\n          status = SubjectStatus.Error;\r\n          this.messageService.error(\r\n            'igo.geo.printForm.corsErrorMessageBody',\r\n            'igo.geo.printForm.corsErrorMessageHeader'\r\n          );\r\n        }\r\n        status$.next(status);\r\n      });\r\n\r\n      // If no loading as started after 200ms, then probably no loading\r\n      // is required.\r\n      timeout = window.setTimeout(() => {\r\n        mapStatus$$.unsubscribe();\r\n\r\n        let status = SubjectStatus.Done;\r\n        try {\r\n          if (mapResultCanvas.width !== 0) {\r\n            this.addCanvas(doc, mapResultCanvas, margins);\r\n          }\r\n        } catch (err) {\r\n          status = SubjectStatus.Error;\r\n          this.messageService.error(\r\n            'igo.geo.printForm.corsErrorMessageBody',\r\n            'igo.geo.printForm.corsErrorMessageHeader'\r\n          );\r\n        }\r\n        this.resetOriginalMapSize(map, mapSize, viewResolution);\r\n        status$.next(status);\r\n      }, 200);\r\n    });\r\n\r\n    return status$;\r\n  }\r\n\r\n  private setMapResolution(\r\n    map: IgoMap,\r\n    initialSize: [number, number],\r\n    resolution: number,\r\n    viewResolution: number\r\n  ): [number, number] {\r\n    const mapSize = map.ol.getSize();\r\n    const widthPixels = Math.round((initialSize[0] * resolution) / 25.4);\r\n    const heightPixels = Math.round((initialSize[1] * resolution) / 25.4);\r\n\r\n    // Set print size\r\n    const printSize = [widthPixels, heightPixels];\r\n    map.ol.setSize(printSize);\r\n    const scaling = Math.min(\r\n      widthPixels / mapSize[0],\r\n      heightPixels / mapSize[1]\r\n    );\r\n    map.ol.getView().setResolution(viewResolution / scaling);\r\n\r\n    return [widthPixels, heightPixels];\r\n  }\r\n\r\n  private resetOriginalMapSize(\r\n    map: IgoMap,\r\n    initialSize: [number, number],\r\n    viewResolution: number\r\n  ) {\r\n    map.ol.setSize(initialSize);\r\n    map.ol.getView().setResolution(viewResolution);\r\n    map.ol.updateSize();\r\n    map.ol.renderSync();\r\n  }\r\n\r\n  async drawMap(\r\n    size: Array<number>,\r\n    mapCanvas: HTMLCollectionOf<HTMLCanvasElement>\r\n  ): Promise<HTMLCanvasElement> {\r\n    const mapResultCanvas = document.createElement('canvas');\r\n    mapResultCanvas.width = size[0];\r\n    mapResultCanvas.height = size[1];\r\n\r\n    for (let index = 0; index < mapCanvas.length; index++) {\r\n      const canvas = mapCanvas[index];\r\n      if (canvas.width > 0) {\r\n        this.handleCanvas(canvas, mapResultCanvas);\r\n      }\r\n    }\r\n    return mapResultCanvas;\r\n  }\r\n\r\n  private handleCanvas(\r\n    canvas: HTMLCanvasElement,\r\n    mapResultCanvas: HTMLCanvasElement\r\n  ) {\r\n    const mapContextResult = mapResultCanvas.getContext('2d');\r\n    const opacity = canvas.parentElement.style.opacity || canvas.style.opacity;\r\n    mapContextResult.globalAlpha = opacity === '' ? 1 : Number(opacity);\r\n    const transform = canvas.style.transform;\r\n    let matrix: number[];\r\n    if (transform) {\r\n      // Get the transform parameters from the style's transform matrix\r\n      matrix = transform\r\n        .match(/^matrix\\(([^\\(]*)\\)$/)[1]\r\n        .split(',')\r\n        .map(Number);\r\n    } else {\r\n      matrix = [\r\n        parseFloat(canvas.style.width) / canvas.width,\r\n        0,\r\n        0,\r\n        parseFloat(canvas.style.height) / canvas.height,\r\n        0,\r\n        0\r\n      ];\r\n    }\r\n    CanvasRenderingContext2D.prototype.setTransform.apply(\r\n      mapContextResult,\r\n      matrix\r\n    );\r\n    const backgroundColor = canvas.parentElement.style.backgroundColor;\r\n    if (backgroundColor) {\r\n      mapContextResult.fillStyle = backgroundColor;\r\n      mapContextResult.fillRect(0, 0, canvas.width, canvas.height);\r\n    }\r\n    mapContextResult.drawImage(canvas, 0, 0);\r\n    mapContextResult.globalAlpha = 1;\r\n    // reset canvas transform to initial\r\n    mapContextResult.setTransform(1, 0, 0, 1, 0, 0);\r\n  }\r\n\r\n  async drawMapControls(\r\n    map: IgoMap,\r\n    canvas: HTMLCanvasElement,\r\n    position: PrintLegendPosition\r\n  ): Promise<void> {\r\n    const context = canvas.getContext('2d');\r\n    // Get the scale and attribution\r\n    // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\r\n    const mapOverlayHTML = map.ol\r\n      .getOverlayContainerStopEvent()\r\n      .cloneNode(true) as HTMLElement;\r\n    // add North Direction to mapOverly\r\n    await this.addNorthDirection(mapOverlayHTML, position);\r\n    // add map Attribution designe to print\r\n    await this.addAttribution(mapOverlayHTML);\r\n\r\n    // set 'OverlayContainer' size to print size\r\n    mapOverlayHTML.style.width = canvas.width + 'px';\r\n    mapOverlayHTML.style.height = canvas.height + 'px';\r\n    // we add zindex -1 to not show modification to the user\r\n    mapOverlayHTML.style.zIndex = '-1';\r\n    // and make sure html2canvas to render the image correctly\r\n    document\r\n      .getElementsByClassName('ol-viewport')[0]\r\n      .appendChild(mapOverlayHTML);\r\n    // Change the styles of hyperlink in the printed version\r\n    // Transform the Overlay into a canvas\r\n    // scale is necessary to make it in google chrome\r\n    // background as null because otherwise it is white and cover the map\r\n    // allowtaint is to allow rendering images in the attributions\r\n    // useCORS: true pour permettre de renderer les images (ne marche pas en local)\r\n    const canvasOverlayHTML = await html2canvas(mapOverlayHTML, {\r\n      scale: 1,\r\n      backgroundColor: null,\r\n      allowTaint: true,\r\n      useCORS: true\r\n    });\r\n\r\n    context.drawImage(canvasOverlayHTML, 0, 0);\r\n    // remove 'mapOverlayHTML' after generating canvas\r\n    mapOverlayHTML.remove();\r\n  }\r\n\r\n  private async addNorthDirection(\r\n    mapOverlayHTML: HTMLElement,\r\n    position: PrintLegendPosition\r\n  ): Promise<void> {\r\n    const northDirection = document\r\n      .getElementsByTagName('igo-rotation-button')[0]\r\n      .cloneNode(true) as HTMLElement;\r\n    const HTMLButton = northDirection.getElementsByTagName(\r\n      'button'\r\n    )[0] as HTMLElement;\r\n    if (!HTMLButton) {\r\n      return null;\r\n    }\r\n    // in case legend position is topright\r\n    // we change rotate btn to topleft\r\n    if (position === 'topright') {\r\n      northDirection.style.width = 'inherit';\r\n      northDirection.style.left = '10px';\r\n    }\r\n    HTMLButton.parentElement.style.background = 'transparent';\r\n    HTMLButton.style.color = '#000';\r\n    mapOverlayHTML.appendChild(northDirection);\r\n  }\r\n\r\n  private async addAttribution(mapOverlayHTML: HTMLElement): Promise<void> {\r\n    const HTMLattribution =\r\n      mapOverlayHTML.getElementsByClassName('ol-attribution')[0];\r\n    const HTMLButton = HTMLattribution.getElementsByTagName('button')[0];\r\n    if (!HTMLButton) {\r\n      return null;\r\n    }\r\n    HTMLButton.setAttribute('data-html2canvas-ignore', 'true');\r\n    const olCollapsed: boolean =\r\n      HTMLattribution.classList.contains('ol-collapsed');\r\n    if (olCollapsed) {\r\n      HTMLattribution.classList.remove('ol-collapsed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Download an image of the map with addition of informations\r\n   * @param  map - Map of the app\r\n   * @param  format - Image format. default value to \"png\"\r\n   * @param  projection - Indicate if projection need to be add. Default to false\r\n   * @param  scale - Indicate if scale need to be add. Default to false\r\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\r\n   * @param  title - Title to add for the map - Default to blank\r\n   * @param  subtitle - Subtitle to add for the map - Default to blank\r\n   * @param  comment - Comment to add for the map - Default to blank\r\n   * @param  doZipFile - Indicate if we do a zip with the file\r\n   * @return Image file of the map with extension format given as parameter\r\n   */\r\n  downloadMapImage(\r\n    map: IgoMap,\r\n    printResolution: PrintResolution,\r\n    format = 'png',\r\n    projection = false,\r\n    scale = false,\r\n    title = '',\r\n    subtitle = '',\r\n    comment = '',\r\n    doZipFile = true,\r\n    legendPosition: PrintLegendPosition\r\n  ) {\r\n    const status$ = new Subject();\r\n    this.activityId = this.activityService.register();\r\n    const translate = this.languageService.translate;\r\n    format = format.toLowerCase();\r\n    const resolution = +printResolution;\r\n    const initialMapSize = map.ol.getSize() as [number, number];\r\n    const viewResolution = map.ol.getView().getResolution();\r\n\r\n    map.ol.once('rendercomplete', async (event: any) => {\r\n      const size = map.ol.getSize();\r\n      const mapCanvas = event.target\r\n        .getViewport()\r\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\r\n      const mapResultCanvas = await this.drawMap(size, mapCanvas);\r\n\r\n      this.resetOriginalMapSize(map, initialMapSize, viewResolution);\r\n\r\n      await this.drawMapControls(map, mapResultCanvas, legendPosition);\r\n      // Check the legendPosition\r\n      if (legendPosition !== 'none') {\r\n        if (\r\n          ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\r\n            legendPosition\r\n          ) > -1\r\n        ) {\r\n          await this.addLegendToImage(\r\n            mapResultCanvas,\r\n            map,\r\n            resolution,\r\n            legendPosition,\r\n            format\r\n          );\r\n        } else if (legendPosition === 'newpage') {\r\n          await this.getLayersLegendImage(map, format, doZipFile, resolution);\r\n        }\r\n      }\r\n      // add other information to final canvas before exporting\r\n      const newCanvas = document.createElement('canvas');\r\n      const newContext = newCanvas.getContext('2d');\r\n      // Postion in height to set the canvas in new canvas\r\n      let positionHCanvas = 0;\r\n      // Get height/width of map canvas\r\n      const width = mapResultCanvas.width;\r\n      let height = mapResultCanvas.height;\r\n      // Set Font to calculate comment width\r\n      newContext.font = '20px Calibri';\r\n      const commentWidth = newContext.measureText(comment).width;\r\n      // Add height for title if defined\r\n      height = title !== '' ? height + 30 : height;\r\n      // Add height for title if defined\r\n      height = subtitle !== '' ? height + 30 : height;\r\n      // Add height for projection or scale (same line) if defined\r\n      height = projection !== false || scale !== false ? height + 30 : height;\r\n      const positionHProjScale = height - 10;\r\n      // Define number of line depending of the comment length\r\n      const commentNbLine = Math.ceil(commentWidth / width);\r\n      // Add height for multiline comment if defined\r\n      height = comment !== '' ? height + commentNbLine * 30 : height;\r\n      let positionHComment = height - commentNbLine * 20 + 5;\r\n      // Set the new canvas with the new calculated size\r\n      newCanvas.width = width;\r\n      newCanvas.height = height;\r\n\r\n      if (['bmp', 'gif', 'jpeg', 'png', 'tiff'].indexOf(format) > -1) {\r\n        // Patch Jpeg default black background to white\r\n        if (\r\n          format === 'jpeg' ||\r\n          title !== '' ||\r\n          subtitle !== '' ||\r\n          comment !== '' ||\r\n          projection !== false ||\r\n          scale !== false\r\n        ) {\r\n          newContext.fillStyle = '#ffffff';\r\n          newContext.fillRect(0, 0, width, height);\r\n          newContext.fillStyle = '#000000';\r\n        }\r\n      }\r\n      // If a title need to be added to canvas\r\n      if (title !== '') {\r\n        // Set font for title\r\n        // Adjust according to title length\r\n        newContext.font = '26px Calibri';\r\n        positionHCanvas = 30;\r\n        newContext.textAlign = 'center';\r\n        newContext.fillText(title, width / 2, 20, width * 0.9);\r\n      }\r\n\r\n      if (subtitle !== '') {\r\n        // Set font for subtitle\r\n        // Adjust according to title length\r\n        newContext.font = '26px Calibri';\r\n        positionHCanvas = 60;\r\n        newContext.textAlign = 'center';\r\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\r\n      }\r\n\r\n      // Set font for next section\r\n      newContext.font = '20px Calibri';\r\n      // If projection or/end scale need to be added to canvas\r\n      if (projection !== false || scale !== false) {\r\n        let projectionScaleText = '';\r\n        if (projection !== false) {\r\n          const projText = translate.instant('igo.geo.printForm.projection');\r\n          projectionScaleText = projText + ': ' + map.projection + '         ';\r\n        }\r\n\r\n        if (scale !== false) {\r\n          const scaleText = translate.instant('igo.geo.printForm.scale');\r\n          const mapScale = map.viewController.getScale(resolution);\r\n          projectionScaleText += scaleText + ': ~ 1 / ' + formatScale(mapScale);\r\n        }\r\n        newContext.textAlign = 'center';\r\n        newContext.fillText(\r\n          projectionScaleText,\r\n          width / 2,\r\n          positionHProjScale,\r\n          width * 0.9\r\n        );\r\n      }\r\n\r\n      // If a comment need to be added to canvas\r\n      if (comment !== '') {\r\n        newContext.textAlign = 'center';\r\n        // If only one line, no need to multiline the comment\r\n        if (commentNbLine === 1) {\r\n          newContext.fillText(comment, width / 2, positionHComment);\r\n        } else {\r\n          // Separate the setenses to be approx. the same length\r\n          const nbCommentChar = comment.length;\r\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\r\n          let commentCurrentLine = '';\r\n          let positionFirstCutChar = 0;\r\n          let positionLastBlank;\r\n          // Loop for the number of line calculated\r\n          for (let i = 0; i < commentNbLine; i++) {\r\n            // For all line except last\r\n            if (commentNbLine - 1 > i) {\r\n              // Get comment current line to find the right place tu cut comment\r\n              commentCurrentLine = comment.substr(\r\n                positionFirstCutChar,\r\n                CommentLengthToCut\r\n              );\r\n              // Cut the setence at blank\r\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\r\n              newContext.fillText(\r\n                commentCurrentLine.substr(0, positionLastBlank),\r\n                width / 2,\r\n                positionHComment\r\n              );\r\n              positionFirstCutChar += positionLastBlank;\r\n              // Go to next line for insertion\r\n              positionHComment += 20;\r\n            } else {\r\n              // Don't cut last part\r\n              newContext.fillText(\r\n                comment.substr(positionFirstCutChar),\r\n                width / 2,\r\n                positionHComment\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      newContext.drawImage(mapResultCanvas, 0, positionHCanvas);\r\n\r\n      let status = SubjectStatus.Done;\r\n      let fileNameWithExt = 'map.' + format;\r\n      if (format.toLowerCase() === 'tiff') {\r\n        fileNameWithExt =\r\n          'map' + map.projection.replace(':', '_') + '.' + format;\r\n      }\r\n\r\n      try {\r\n        // Save the canvas as file\r\n        if (!doZipFile) {\r\n          this.saveCanvasImageAsFile(newCanvas, fileNameWithExt, format);\r\n        } else if (format.toLowerCase() === 'tiff') {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\r\n        }\r\n      } catch (err) {\r\n        status = SubjectStatus.Error;\r\n      }\r\n      status$.next(status);\r\n\r\n      if (format.toLowerCase() === 'tiff') {\r\n        const tfwFileNameWithExt =\r\n          fileNameWithExt.substring(\r\n            0,\r\n            fileNameWithExt.toLowerCase().indexOf('.tiff')\r\n          ) + '.tfw';\r\n        const tiwContent = this.getWorldFileInformation(map);\r\n        const blob = new Blob([tiwContent], {\r\n          type: 'text/plain;charset=utf-8'\r\n        });\r\n        if (!doZipFile) {\r\n          // saveAs automaticly replace ':' for '_'\r\n          saveAs(blob, tfwFileNameWithExt);\r\n          this.saveFileProcessing();\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.addFileToZip(tfwFileNameWithExt, blob);\r\n        }\r\n      }\r\n    });\r\n\r\n    this.setMapImageResolution(map, initialMapSize, resolution, viewResolution);\r\n\r\n    return status$;\r\n  }\r\n\r\n  private setMapImageResolution(\r\n    map: IgoMap,\r\n    initialMapSize: [number, number],\r\n    resolution: number,\r\n    viewResolution: number\r\n  ): void {\r\n    const scaleFactor = resolution / 96;\r\n    const newMapSize = [\r\n      Math.round(initialMapSize[0] * scaleFactor), // width\r\n      Math.round(initialMapSize[1] * scaleFactor) // height\r\n    ];\r\n    map.ol.setSize(newMapSize);\r\n    const scaling = Math.min(\r\n      newMapSize[0] / initialMapSize[0],\r\n      newMapSize[1] / initialMapSize[1]\r\n    );\r\n    const view = map.ol.getView();\r\n    view.setResolution(viewResolution / scaling);\r\n    map.ol.renderSync();\r\n  }\r\n\r\n  /**\r\n   * Create and Add Legend to the map canvas\r\n   * @param  canvas Canvas of the map\r\n   * @param  map Map of the app\r\n   * @param  resolution Resolution of map\r\n   * @param  legendPosition Legend position\r\n   * @param  format Image format\r\n   */\r\n  private async addLegendToImage(\r\n    canvas: HTMLCanvasElement,\r\n    map: IgoMap,\r\n    resolution: number,\r\n    legendPosition: string,\r\n    format: string\r\n  ) {\r\n    const fileNameWithExt = 'map.' + format;\r\n    const context = canvas.getContext('2d');\r\n\r\n    // Get html code for the legend\r\n    const html = await this.getLayersLegendHtml(\r\n      map,\r\n      canvas.width,\r\n      resolution\r\n    ).toPromise();\r\n    // If no legend, save the map directly\r\n    if (html === '') {\r\n      await this.saveCanvasImageAsFile(canvas, fileNameWithExt, format);\r\n      return true;\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n    div.style.zIndex = '-1';\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n    await this.timeout(1);\r\n    const canvasLegend = await html2canvas(div, { useCORS: true }).catch(\r\n      (e) => {\r\n        console.log(e);\r\n      }\r\n    );\r\n\r\n    if (canvasLegend) {\r\n      const canvasHeight = canvas.height;\r\n      const canvasWidth = canvas.width;\r\n      const legendHeight = canvasLegend.height;\r\n      const legendWidth = canvasLegend.width;\r\n      // Move the legend to the correct position on the page\r\n      const offset = canvasHeight * 0.01;\r\n      let legendX: number;\r\n      let legendY: number;\r\n\r\n      if (legendPosition === 'bottomright') {\r\n        legendX = canvasWidth - legendWidth - offset;\r\n        legendY = canvasHeight - legendHeight - offset;\r\n      } else if (legendPosition === 'topright') {\r\n        legendX = canvasWidth - legendWidth - offset;\r\n        legendY = offset;\r\n      } else if (legendPosition === 'bottomleft') {\r\n        legendX = offset;\r\n        legendY = canvasHeight - legendHeight - offset - 15;\r\n      } else if (legendPosition === 'topleft') {\r\n        legendX = offset;\r\n        legendY = offset;\r\n      }\r\n\r\n      context.drawImage(\r\n        canvasLegend,\r\n        legendX,\r\n        legendY,\r\n        legendWidth,\r\n        legendHeight\r\n      );\r\n      context.strokeRect(legendX, legendY, legendWidth, legendHeight);\r\n      this.removeHtmlElement(div);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  private renderMap(map, size, extent) {\r\n    map.ol.updateSize();\r\n    map.ol.renderSync();\r\n  }\r\n\r\n  /**\r\n   * Save document\r\n   * @param  doc - Document to save\r\n   */\r\n  protected async saveDoc(doc: jsPDF) {\r\n    await doc.save('map_georef.pdf', { returnPromise: true });\r\n  }\r\n\r\n  /**\r\n   * Calculate the best Image size to fit in pdf\r\n   * @param doc - Pdf Document\r\n   * @param canvas - Canvas of image\r\n   * @param margins - Page margins\r\n   */\r\n  getImageSizeToFitPdf(doc, canvas, margins) {\r\n    // Define variable to calculate best size to fit in one page\r\n    const pageHeight =\r\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2] + 10);\r\n    const pageWidth =\r\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\r\n    const canHeight = this.pdf_units2points(canvas.height, 'mm');\r\n    const canWidth = this.pdf_units2points(canvas.width, 'mm');\r\n\r\n    const heightRatio = canHeight / pageHeight;\r\n    const widthRatio = canWidth / pageWidth;\r\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\r\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\r\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\r\n    return [imgWidth, imgHeigh];\r\n  }\r\n\r\n  /**\r\n   * Get a world file information for tiff\r\n   * @param  map - Map of the app\r\n   */\r\n  private getWorldFileInformation(map) {\r\n    const currentResolution = map.viewController.getResolution();\r\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\r\n    return [\r\n      currentResolution,\r\n      0,\r\n      0,\r\n      -currentResolution,\r\n      currentExtent[0] + currentResolution / 0.5,\r\n      currentExtent[3] - currentResolution / 0.5\r\n    ].join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Save canvas image as file\r\n   * @param canvas - Canvas to save\r\n   * @param name - Name of the file\r\n   * @param format - file format\r\n   */\r\n  private saveCanvasImageAsFile(canvas, nameWithExt, format) {\r\n    const blobFormat = 'image/' + format;\r\n    const that = this;\r\n\r\n    try {\r\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\r\n      canvas.toBlob((blob) => {\r\n        // download image\r\n        saveAs(blob, nameWithExt);\r\n        that.saveFileProcessing();\r\n      }, blobFormat);\r\n    } catch (err) {\r\n      this.messageService.error(\r\n        'igo.geo.printForm.corsErrorMessageBody',\r\n        'igo.geo.printForm.corsErrorMessageHeader'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add file to a zip\r\n   * @param canvas - File to add to the zip\r\n   * @param  name -Name of the fileoverview\r\n   */\r\n  private generateCanvaFileToZip(canvas, name) {\r\n    const blobFormat = 'image/' + 'jpeg';\r\n    const that = this;\r\n    if (\r\n      !this.hasOwnProperty('zipFile') ||\r\n      typeof this.zipFile === 'undefined'\r\n    ) {\r\n      this.zipFile = new JSZip();\r\n    }\r\n\r\n    try {\r\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\r\n      if (navigator.msSaveBlob) {\r\n        this.addFileToZip(name, canvas.msToBlob());\r\n      } else {\r\n        canvas.toBlob((blob) => {\r\n          that.addFileToZip(name, blob);\r\n        }, blobFormat);\r\n      }\r\n    } catch (err) {\r\n      this.messageService.error(\r\n        'igo.geo.printForm.corsErrorMessageBody',\r\n        'igo.geo.printForm.corsErrorMessageHeader'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add file to zip, if all file are zipped, download\r\n   * @param name - Name of the files\r\n   * @param blob - Contain of file\r\n   */\r\n  private addFileToZip(name, blob) {\r\n    // add file to zip\r\n    this.zipFile.file(name, blob);\r\n    this.nbFileToProcess--;\r\n\r\n    // If all files are proccessed\r\n    if (this.nbFileToProcess === 0) {\r\n      // Download zip file\r\n      this.getZipFile();\r\n      // Stop loading\r\n      this.activityService.unregister(this.activityId);\r\n    }\r\n  }\r\n\r\n  private saveFileProcessing() {\r\n    this.nbFileToProcess--;\r\n\r\n    // If all files are proccessed\r\n    if (this.nbFileToProcess === 0) {\r\n      // Stop loading\r\n      this.activityService.unregister(this.activityId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the zipped file\r\n   * @return Retun a zip file\r\n   */\r\n  private getZipFile() {\r\n    const that = this;\r\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\r\n      // 1) generate the zip file\r\n      saveAs(blob, 'map.zip');\r\n      delete that.zipFile;\r\n    });\r\n  }\r\n\r\n  private pdf_units2points(n, unit): number {\r\n    let k = 1;\r\n\r\n    // this code is borrowed from jsPDF\r\n    //  as it does not expose a public API\r\n    //  for converting units to points.\r\n    switch (unit) {\r\n      case 'pt':\r\n        k = 1;\r\n        break;\r\n      case 'mm':\r\n        k = 72 / 25.4;\r\n        break;\r\n      case 'cm':\r\n        k = 72 / 2.54;\r\n        break;\r\n      case 'in':\r\n        k = 72;\r\n        break;\r\n      case 'px':\r\n        k = 96 / 72;\r\n        break;\r\n      case 'pc':\r\n        k = 12;\r\n        break;\r\n      case 'em':\r\n        k = 12;\r\n        break;\r\n      case 'ex':\r\n        k = 6;\r\n        break;\r\n      default:\r\n        throw new Error('Invalid unit: ' + unit);\r\n    }\r\n\r\n    return n * k;\r\n  }\r\n}\r\n","import { Layer } from '../shared/layers/layer';\r\nimport {\r\n  LegendMapViewOptions,\r\n  OutputLayerLegend\r\n} from '../shared/layers/legend.interface';\r\n\r\n/**\r\n * Get all the layers legend\r\n * @return Array of legend\r\n */\r\nexport function getLayersLegends(\r\n  layers: Layer[],\r\n  view?: LegendMapViewOptions\r\n): OutputLayerLegend[] {\r\n  const legends = [];\r\n\r\n  for (const layer of layers) {\r\n    const legendOptions = layer.options.legendOptions;\r\n    if (layer.visible === false) {\r\n      continue;\r\n    }\r\n\r\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\r\n    for (const legendUrl of legendUrls) {\r\n      if (legendUrl.url === undefined) {\r\n        continue;\r\n      }\r\n\r\n      // Add legend info to the list\r\n      legends.push({\r\n        title: layer.title || '',\r\n        url: legendUrl.url,\r\n        display:\r\n          legendOptions?.display === undefined ? true : legendOptions.display,\r\n        isInResolutionsRange: layer.isInResolutionsRange\r\n      });\r\n    }\r\n  }\r\n\r\n  return legends;\r\n}\r\n","<form class=\"igo-form\" [formGroup]=\"form\">\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{ 'igo.geo.printForm.title' | translate }}</mat-label>\r\n      <input\r\n        matInput\r\n        formControlName=\"title\"\r\n        placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\r\n      />\r\n      <mat-error *ngIf=\"titleField.errors?.maxlength\">{{\r\n        'igo.geo.formValidation.maxLength'\r\n          | translate\r\n            : {\r\n                column: 'igo.geo.printForm.title' | translate,\r\n                value: 130\r\n              }\r\n      }}</mat-error>\r\n    </mat-form-field>\r\n  </div>\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{ 'igo.geo.printForm.subtitle' | translate }}</mat-label>\r\n      <input\r\n        matInput\r\n        formControlName=\"subtitle\"\r\n        placeholder=\"{{ 'igo.geo.printForm.subtitle' | translate }}\"\r\n      />\r\n      <mat-error *ngIf=\"subtitleField.errors?.maxlength\">{{\r\n        'igo.geo.formValidation.maxLength'\r\n          | translate\r\n            : {\r\n                column: 'igo.geo.printForm.subtitle' | translate,\r\n                value: 120\r\n              }\r\n      }}</mat-error>\r\n    </mat-form-field>\r\n  </div>\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{ 'igo.geo.printForm.comment' | translate }}</mat-label>\r\n      <input\r\n        matInput\r\n        formControlName=\"comment\"\r\n        placeholder=\"{{ 'igo.geo.printForm.comment' | translate }}\"\r\n      />\r\n      <mat-error *ngIf=\"commentField.errors?.maxlength\">{{\r\n        'igo.geo.formValidation.maxLength'\r\n          | translate\r\n            : {\r\n                column: 'igo.geo.printForm.comment' | translate,\r\n                value: maxLength\r\n              }\r\n      }}</mat-error>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container slide-toggle-container\">\r\n    <div class=\"print-slide-toggle-container\">\r\n      <mat-slide-toggle\r\n        class=\"print-option\"\r\n        formControlName=\"showProjection\"\r\n        [labelPosition]=\"'before'\"\r\n      >\r\n        {{ 'igo.geo.printForm.showProjection' | translate }}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class=\"print-option\"\r\n        formControlName=\"showScale\"\r\n        [labelPosition]=\"'before'\"\r\n      >\r\n        {{ 'igo.geo.printForm.showScale' | translate }}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class=\"print-option\"\r\n        formControlName=\"doZipFile\"\r\n        [labelPosition]=\"'before'\"\r\n        [style.display]=\"isPrintService ? 'none' : ''\"\r\n      >\r\n        {{ 'igo.geo.printForm.doZipFile' | translate }}\r\n      </mat-slide-toggle>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{\r\n        'igo.geo.printForm.legendPosition' | translate\r\n      }}</mat-label>\r\n      <mat-select\r\n        formControlName=\"legendPosition\"\r\n        placeholder=\"{{ 'igo.geo.printForm.legendPosition' | translate }}\"\r\n      >\r\n        <mat-option\r\n          *ngFor=\"let legendPosition of legendPositions | keyvalue\"\r\n          [value]=\"legendPosition.key\"\r\n        >\r\n          <ng-container\r\n            *ngIf=\"!['newpage', 'newimage'].includes(legendPosition.value)\"\r\n          >\r\n            {{\r\n              'igo.geo.printForm.legendPositions.' + legendPosition.value\r\n                | translate\r\n            }}\r\n          </ng-container>\r\n\r\n          <ng-container\r\n            *ngIf=\"['newpage', 'newimage'].includes(legendPosition.value)\"\r\n          >\r\n            {{\r\n              (outputFormat === 'Pdf'\r\n                ? 'igo.geo.printForm.legendPositions.newpage'\r\n                : 'igo.geo.printForm.legendPositions.newimage'\r\n              ) | translate\r\n            }}\r\n          </ng-container>\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{ 'igo.geo.printForm.outputFormat' | translate }}</mat-label>\r\n      <mat-select\r\n        (selectionChange)=\"toggleImageSaveProp()\"\r\n        formControlName=\"outputFormat\"\r\n        placeholder=\"{{ 'igo.geo.printForm.outputFormat' | translate }}\"\r\n      >\r\n        <mat-option\r\n          *ngFor=\"let outputFormat of outputFormats | keyvalue\"\r\n          [value]=\"outputFormat.key\"\r\n        >\r\n          {{ outputFormat.value }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div\r\n    class=\"igo-input-container\"\r\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\r\n  >\r\n    <mat-form-field>\r\n      <mat-label>{{ 'igo.geo.printForm.paperFormat' | translate }}</mat-label>\r\n      <mat-select\r\n        (selectionChange)=\"changeCommentLength()\"\r\n        formControlName=\"paperFormat\"\r\n        placeholder=\"{{ 'igo.geo.printForm.paperFormat' | translate }}\"\r\n      >\r\n        <mat-option\r\n          *ngFor=\"let paperFormat of paperFormats | keyvalue\"\r\n          [value]=\"paperFormat.key\"\r\n        >\r\n          {{\r\n            'igo.geo.printForm.paperFormats.' + paperFormat.value | translate\r\n          }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div\r\n    class=\"igo-input-container\"\r\n    [style.display]=\"isPrintService ? 'none' : 'block'\"\r\n  >\r\n    <mat-form-field>\r\n      <mat-label>{{ 'igo.geo.printForm.imageFormat' | translate }}</mat-label>\r\n      <mat-select\r\n        formControlName=\"imageFormat\"\r\n        placeholder=\"{{ 'igo.geo.printForm.imageFormat' | translate }}\"\r\n      >\r\n        <mat-option\r\n          *ngFor=\"let imageFormat of imageFormats | keyvalue\"\r\n          [value]=\"imageFormat.key\"\r\n        >\r\n          {{ imageFormat.value }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{ 'igo.geo.printForm.resolution' | translate }}</mat-label>\r\n      <mat-select\r\n        formControlName=\"resolution\"\r\n        placeholder=\"{{ 'igo.geo.printForm.resolution' | translate }}\"\r\n      >\r\n        <mat-option\r\n          *ngFor=\"let resolution of resolutions | keyvalue\"\r\n          [value]=\"resolution.key\"\r\n        >\r\n          {{ resolution.value + ' PPI' }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div\r\n    class=\"igo-input-container\"\r\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\r\n  >\r\n    <mat-form-field>\r\n      <mat-label>{{ 'igo.geo.printForm.orientation' | translate }}</mat-label>\r\n      <mat-select\r\n        (selectionChange)=\"changeCommentLength()\"\r\n        formControlName=\"orientation\"\r\n        placeholder=\"{{ 'igo.geo.printForm.orientation' | translate }}\"\r\n      >\r\n        <mat-option\r\n          *ngFor=\"let orientation of orientations | keyvalue\"\r\n          [value]=\"orientation.key\"\r\n        >\r\n          {{ 'igo.geo.printForm.' + orientation.value | translate }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-form-button-group print-button-top-padding\">\r\n    <button\r\n      mat-raised-button\r\n      type=\"button\"\r\n      [disabled]=\"!form.valid || (disabled$ | async)\"\r\n      (click)=\"handleFormSubmit(form.value, form.valid)\"\r\n    >\r\n      {{ 'igo.geo.printForm.saveBtn' | translate }}\r\n    </button>\r\n  </div>\r\n</form>\r\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\r\nimport {\r\n  UntypedFormGroup,\r\n  UntypedFormBuilder,\r\n  UntypedFormControl,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { PrintOptions } from '../shared/print.interface';\r\n\r\nimport {\r\n  PrintOutputFormat,\r\n  PrintPaperFormat,\r\n  PrintOrientation,\r\n  PrintResolution,\r\n  PrintSaveImageFormat,\r\n  PrintLegendPosition\r\n} from '../shared/print.type';\r\n\r\n@Component({\r\n  selector: 'igo-print-form',\r\n  templateUrl: './print-form.component.html',\r\n  styleUrls: ['./print-form.component.scss']\r\n})\r\nexport class PrintFormComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n  public outputFormats = PrintOutputFormat;\r\n  public paperFormats = PrintPaperFormat;\r\n  public orientations = PrintOrientation;\r\n  public resolutions = PrintResolution;\r\n  public imageFormats = PrintSaveImageFormat;\r\n  public legendPositions = PrintLegendPosition;\r\n  public isPrintService = true;\r\n\r\n  @Input() disabled$: BehaviorSubject<boolean>;\r\n\r\n  @Input()\r\n  get imageFormat(): PrintSaveImageFormat {\r\n    return this.imageFormatField.value;\r\n  }\r\n  set imageFormat(value: PrintSaveImageFormat) {\r\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get outputFormat(): PrintOutputFormat {\r\n    return this.outputFormatField.value;\r\n  }\r\n  set outputFormat(value: PrintOutputFormat) {\r\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get paperFormat(): PrintPaperFormat {\r\n    return this.paperFormatField.value;\r\n  }\r\n  set paperFormat(value: PrintPaperFormat) {\r\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get orientation(): PrintOrientation {\r\n    return this.orientationField.value;\r\n  }\r\n  set orientation(value: PrintOrientation) {\r\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get resolution(): PrintResolution {\r\n    return this.resolutionField.value;\r\n  }\r\n  set resolution(value: PrintResolution) {\r\n    this.resolutionField.setValue(value || PrintResolution['96'], {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get legendPosition(): PrintLegendPosition {\r\n    return this.legendPositionField.value;\r\n  }\r\n  set legendPosition(value: PrintLegendPosition) {\r\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get title(): string {\r\n    return this.titleField.value;\r\n  }\r\n  set title(value: string) {\r\n    this.titleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get subtitle(): string {\r\n    return this.subtitleField.value;\r\n  }\r\n  set subtitle(value: string) {\r\n    this.subtitleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get comment(): string {\r\n    return this.commentField.value;\r\n  }\r\n  set comment(value: string) {\r\n    this.commentField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showProjection(): boolean {\r\n    return this.showProjectionField.value;\r\n  }\r\n  set showProjection(value: boolean) {\r\n    this.showProjectionField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showScale(): boolean {\r\n    return this.showScaleField.value;\r\n  }\r\n  set showScale(value: boolean) {\r\n    this.showScaleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showLegend(): boolean {\r\n    return this.showLegendField.value;\r\n  }\r\n  set showLegend(value: boolean) {\r\n    this.showLegendField.setValue(value, { onlySelf: true });\r\n  }\r\n\r\n  @Input()\r\n  get doZipFile(): boolean {\r\n    return this.doZipFileField.value;\r\n  }\r\n  set doZipFile(value: boolean) {\r\n    this.doZipFileField.setValue(value, { onlySelf: true });\r\n  }\r\n\r\n  get outputFormatField() {\r\n    return (this.form.controls as any).outputFormat as UntypedFormControl;\r\n  }\r\n\r\n  get paperFormatField() {\r\n    return (this.form.controls as any).paperFormat as UntypedFormControl;\r\n  }\r\n\r\n  get imageFormatField() {\r\n    return (this.form.controls as any).imageFormat as UntypedFormControl;\r\n  }\r\n\r\n  get orientationField() {\r\n    return (this.form.controls as any).orientation as UntypedFormControl;\r\n  }\r\n\r\n  get resolutionField() {\r\n    return (this.form.controls as any).resolution as UntypedFormControl;\r\n  }\r\n\r\n  get commentField() {\r\n    return (this.form.controls as any).comment as UntypedFormControl;\r\n  }\r\n\r\n  get showProjectionField() {\r\n    return (this.form.controls as any).showProjection as UntypedFormControl;\r\n  }\r\n\r\n  get showScaleField() {\r\n    return (this.form.controls as any).showScale as UntypedFormControl;\r\n  }\r\n\r\n  get showLegendField() {\r\n    return (this.form.controls as any).showLegend as UntypedFormControl;\r\n  }\r\n\r\n  get doZipFileField() {\r\n    return (this.form.controls as any).doZipFile as UntypedFormControl;\r\n  }\r\n\r\n  get titleField() {\r\n    return (this.form.controls as any).title as UntypedFormControl;\r\n  }\r\n\r\n  get subtitleField() {\r\n    return (this.form.controls as any).subtitle as UntypedFormControl;\r\n  }\r\n\r\n  get legendPositionField() {\r\n    return (this.form.controls as any).legendPosition as UntypedFormControl;\r\n  }\r\n\r\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\r\n\r\n  maxLength: number = 180;\r\n\r\n  constructor(private formBuilder: UntypedFormBuilder) {\r\n    this.form = this.formBuilder.group({\r\n      title: ['', [Validators.minLength(0), Validators.maxLength(130)]],\r\n      subtitle: ['', [Validators.minLength(0), Validators.maxLength(120)]],\r\n      comment: [\r\n        '',\r\n        [Validators.minLength(0), Validators.maxLength(this.maxLength)]\r\n      ],\r\n      outputFormat: ['', [Validators.required]],\r\n      paperFormat: ['', [Validators.required]],\r\n      imageFormat: ['', [Validators.required]],\r\n      resolution: ['', [Validators.required]],\r\n      orientation: ['', [Validators.required]],\r\n      legendPosition: ['', [Validators.required]],\r\n      showProjection: false,\r\n      showScale: false,\r\n      showLegend: false,\r\n      doZipFile: [{ hidden: this.isPrintService }]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.doZipFileField.setValue(false);\r\n  }\r\n\r\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\r\n    data.isPrintService = this.isPrintService;\r\n    if (isValid) {\r\n      this.submit.emit(data);\r\n    }\r\n  }\r\n\r\n  toggleImageSaveProp() {\r\n    if (this.outputFormatField.value === 'Image') {\r\n      this.isPrintService = false;\r\n      this.commentField.clearValidators();\r\n      this.commentField.updateValueAndValidity();\r\n    } else {\r\n      this.isPrintService = true;\r\n    }\r\n  }\r\n\r\n  changeCommentLength() {\r\n    switch (this.paperFormat) {\r\n      case PrintPaperFormat.A0:\r\n        // A0, landscape, length 900 | A0, portrait, comment length:  600\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 900 : 600;\r\n        break;\r\n      case PrintPaperFormat.A1:\r\n        // A1, landscape, length 600 | A1, portrait, length 400;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 600 : 400;\r\n        break;\r\n      case PrintPaperFormat.A2:\r\n        // A2, landscape, length 400 | A2, portrait, length 300;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 400 : 300;\r\n        break;\r\n      case PrintPaperFormat.A3:\r\n        // A3, landscape, length 300 | A3, portrait, length 200;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 300 : 200;\r\n        break;\r\n      case PrintPaperFormat.A4:\r\n        // A4, landscape length 200 | A4, portrait length 120;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 200 : 100;\r\n        break;\r\n      case PrintPaperFormat.A5:\r\n        // A5, landscape length 120 | A5, portrait length 80;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 120 : 80;\r\n        break;\r\n      case PrintPaperFormat.Letter:\r\n        // lettre, landscape, 180 | lettre, portrait, 140\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 180 : 140;\r\n        break;\r\n      default:\r\n        // legal, landscape, 200 | legal, portrait, 140\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 200 : 140;\r\n        break;\r\n    }\r\n\r\n    this.commentField.setValidators([Validators.maxLength(this.maxLength)]);\r\n    this.commentField.updateValueAndValidity();\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { PrintOptions } from '../shared/print.interface';\r\n\r\nimport {\r\n  PrintOutputFormat,\r\n  PrintPaperFormat,\r\n  PrintOrientation,\r\n  PrintResolution,\r\n  PrintSaveImageFormat,\r\n  PrintLegendPosition\r\n} from '../shared/print.type';\r\n\r\nimport { PrintService } from '../shared/print.service';\r\n\r\n@Component({\r\n  selector: 'igo-print',\r\n  templateUrl: './print.component.html'\r\n})\r\nexport class PrintComponent {\r\n  public disabled$ = new BehaviorSubject(false);\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get outputFormat(): PrintOutputFormat {\r\n    return this._outputFormat;\r\n  }\r\n  set outputFormat(value: PrintOutputFormat) {\r\n    this._outputFormat = value;\r\n  }\r\n  private _outputFormat: PrintOutputFormat;\r\n\r\n  @Input()\r\n  get paperFormat(): PrintPaperFormat {\r\n    return this._paperFormat;\r\n  }\r\n  set paperFormat(value: PrintPaperFormat) {\r\n    this._paperFormat = value;\r\n  }\r\n  private _paperFormat: PrintPaperFormat;\r\n\r\n  @Input()\r\n  get orientation(): PrintOrientation {\r\n    return this._orientation;\r\n  }\r\n  set orientation(value: PrintOrientation) {\r\n    this._orientation = value;\r\n  }\r\n  private _orientation: PrintOrientation;\r\n\r\n  @Input()\r\n  get imageFormat(): PrintSaveImageFormat {\r\n    return this._imageFormat;\r\n  }\r\n  set imageFormat(value: PrintSaveImageFormat) {\r\n    this._imageFormat = value;\r\n  }\r\n  private _imageFormat: PrintSaveImageFormat;\r\n\r\n  @Input()\r\n  get legendPosition(): PrintLegendPosition {\r\n    return this._legendPosition;\r\n  }\r\n  set legendPosition(value: PrintLegendPosition) {\r\n    this._legendPosition = value;\r\n  }\r\n  private _legendPosition: PrintLegendPosition;\r\n\r\n  @Input()\r\n  get resolution(): PrintResolution {\r\n    return this._resolution;\r\n  }\r\n  set resolution(value: PrintResolution) {\r\n    this._resolution = value;\r\n  }\r\n  private _resolution: PrintResolution;\r\n\r\n  constructor(private printService: PrintService) {}\r\n\r\n  handleFormSubmit(data: PrintOptions) {\r\n    this.disabled$.next(true);\r\n\r\n    if (data.isPrintService === true) {\r\n      this.printService\r\n        .print(this.map, data)\r\n        .pipe(take(1))\r\n        .subscribe(() => {\r\n          this.disabled$.next(false);\r\n        });\r\n    } else {\r\n      let nbFileToProcess = 1;\r\n\r\n      if (data.showLegend) {\r\n        nbFileToProcess++;\r\n      }\r\n      if (data.imageFormat.toLowerCase() === 'tiff') {\r\n        nbFileToProcess++;\r\n      }\r\n\r\n      if (data.legendPosition === 'newpage') {\r\n        nbFileToProcess++;\r\n      }\r\n\r\n      this.printService.defineNbFileToProcess(nbFileToProcess);\r\n\r\n      this.printService\r\n        .downloadMapImage(\r\n          this.map,\r\n          data.resolution,\r\n          data.imageFormat,\r\n          data.showProjection,\r\n          data.showScale,\r\n          data.title,\r\n          data.subtitle,\r\n          data.comment,\r\n          data.doZipFile,\r\n          data.legendPosition\r\n        )\r\n        .pipe(take(1))\r\n        .subscribe(() => {\r\n          this.disabled$.next(false);\r\n        });\r\n    }\r\n  }\r\n}\r\n","<igo-print-form\r\n  [outputFormat]=\"outputFormat\"\r\n  [paperFormat]=\"paperFormat\"\r\n  [orientation]=\"orientation\"\r\n  [imageFormat]=\"imageFormat\"\r\n  [resolution]=\"resolution\"\r\n  [legendPosition]=\"legendPosition\"\r\n  [disabled$]=\"disabled$\"\r\n  (submit)=\"handleFormSubmit($event)\"\r\n>\r\n</igo-print-form>\r\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import olFeature from 'ol/Feature';\r\nimport * as olStyle from 'ol/style';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olGeom from 'ol/geom';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport * as olProj from 'ol/proj';\r\n\r\nimport { uuid, NumberUtils } from '@igo2/utils';\r\n\r\nimport {\r\n  Direction,\r\n  FeatureWithDirection,\r\n  FeatureWithStop,\r\n  Stop\r\n} from './directions.interface';\r\nimport { createOverlayMarkerStyle } from '../../style/shared/overlay/overlay-marker-style.utils';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\r\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\r\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\r\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\r\nimport {\r\n  DirectionRelativePositionType,\r\n  DirectionType\r\n} from './directions.enum';\r\nimport {\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsFeatureStore,\r\n  StopsStore\r\n} from './store';\r\n\r\n/**\r\n * Function that updat the sort of the list base on the provided field.\r\n * @param source stop store\r\n * @param direction asc / desc sort order\r\n * @param field the field to use to sort the view\r\n */\r\nexport function updateStoreSorting(\r\n  stopsStore: StopsStore,\r\n  direction: 'asc' | 'desc' = 'asc',\r\n  field = 'position'\r\n) {\r\n  stopsStore.view.sort({\r\n    direction,\r\n    valueAccessor: (entity: Stop) => entity[field]\r\n  });\r\n}\r\n\r\nexport function computeRelativePosition(\r\n  index: number,\r\n  totalLength\r\n): DirectionRelativePositionType {\r\n  let relativePosition = DirectionRelativePositionType.Intermediate;\r\n  if (index === 0) {\r\n    relativePosition = DirectionRelativePositionType.Start;\r\n  } else if (index === totalLength - 1) {\r\n    relativePosition = DirectionRelativePositionType.End;\r\n  }\r\n  return relativePosition;\r\n}\r\n\r\nexport function computeStopsPosition(stopsStore: StopsStore) {\r\n  const stopsToComputePosition = [...stopsStore.all()];\r\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\r\n  stopsToComputePosition.map((stop, i) => {\r\n    stop.position = i;\r\n    stop.relativePosition = computeRelativePosition(\r\n      stop.position,\r\n      stopsToComputePosition.length\r\n    );\r\n  });\r\n  if (stopsToComputePosition) {\r\n    stopsStore.updateMany(stopsToComputePosition);\r\n  }\r\n}\r\n\r\n/**\r\n * Function that add a stop to the stop store. Stop are always added before the last stop.\r\n * @param stopsStore stop store as an EntityStore\r\n */\r\nexport function addStopToStore(stopsStore: StopsStore): Stop {\r\n  const id = uuid();\r\n  const stops = stopsStore.all();\r\n  let positions: number[];\r\n  if (stopsStore.count === 0) {\r\n    positions = [0];\r\n  } else {\r\n    positions = stops.map((stop) => stop.position);\r\n  }\r\n  const maxPosition: number = Math.max(...positions);\r\n  const insertPosition: number = maxPosition;\r\n  const lastPosition: number = maxPosition + 1;\r\n\r\n  const stopToUpdate = stopsStore\r\n    .all()\r\n    .find((stop) => stop.position === maxPosition);\r\n  if (stopToUpdate) {\r\n    stopToUpdate.position = lastPosition;\r\n    stopToUpdate.relativePosition = computeRelativePosition(\r\n      lastPosition,\r\n      stopsStore.count + 1\r\n    );\r\n  }\r\n\r\n  stopsStore.insert({\r\n    id,\r\n    position: insertPosition,\r\n    relativePosition: computeRelativePosition(\r\n      insertPosition,\r\n      stopsStore.count + 1\r\n    )\r\n  });\r\n\r\n  updateStoreSorting(stopsStore);\r\n  return stopsStore.get(id);\r\n}\r\n\r\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\r\n  stopsStore.delete(stop);\r\n  computeStopsPosition(stopsStore);\r\n}\r\n\r\n/**\r\n * Create a style for the directions stops and routes\r\n * @param feature OlFeature\r\n * @returns OL style function\r\n */\r\nexport function directionsStyle(\r\n  feature: olFeature<OlGeometry>,\r\n  resolution: number\r\n): olStyle.Style | olStyle.Style[] {\r\n  const vertexStyle = [\r\n    new olStyle.Style({\r\n      geometry: feature.getGeometry(),\r\n      image: new olStyle.Circle({\r\n        radius: 7,\r\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\r\n      })\r\n    })\r\n  ];\r\n\r\n  const stopStyle = createOverlayMarkerStyle({\r\n    text: feature.get('stopText'),\r\n    opacity: feature.get('stopOpacity'),\r\n    markerColor: feature.get('stopColor'),\r\n    markerOutlineColor: [255, 255, 255]\r\n  });\r\n\r\n  const routeStyle = [\r\n    new olStyle.Style({\r\n      stroke: new olStyle.Stroke({\r\n        color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`,\r\n        width: 10\r\n      })\r\n    }),\r\n    new olStyle.Style({\r\n      stroke: new olStyle.Stroke({\r\n        color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`,\r\n        width: 6\r\n      })\r\n    })\r\n  ];\r\n\r\n  if (feature.get('type') === DirectionType.Stop) {\r\n    return stopStyle;\r\n  }\r\n  if (feature.get('type') === 'vertex') {\r\n    return vertexStyle;\r\n  }\r\n  if (feature.get('type') === DirectionType.Route) {\r\n    return routeStyle;\r\n  }\r\n}\r\n\r\nexport function initStopsFeatureStore(\r\n  stopsFeatureStore: StopsFeatureStore,\r\n  languageService: LanguageService\r\n) {\r\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\r\n    motion: FeatureMotion.None\r\n  });\r\n\r\n  const stopsLayer = new VectorLayer({\r\n    isIgoInternalLayer: true,\r\n    id: 'igo-direction-stops-layer',\r\n    title: languageService.translate.instant(\r\n      'igo.geo.directionsForm.stopLayer'\r\n    ),\r\n    zIndex: 911,\r\n    source: new FeatureDataSource(),\r\n    showInLayerList: true,\r\n    workspace: {\r\n      enabled: false\r\n    },\r\n    linkedLayers: {\r\n      linkId: 'igo-direction-stops-layer',\r\n      links: [\r\n        {\r\n          syncedDelete: true,\r\n          linkedIds: ['igo-direction-route-layer'],\r\n          properties: []\r\n        }\r\n      ]\r\n    },\r\n    exportable: true,\r\n    browsable: false,\r\n    style: directionsStyle\r\n  });\r\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\r\n  stopsFeatureStore.layer.visible = true;\r\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\r\n}\r\n\r\nexport function initRoutesFeatureStore(\r\n  routesFeatureStore: RoutesFeatureStore,\r\n  languageService: LanguageService\r\n) {\r\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\r\n    motion: FeatureMotion.None\r\n  });\r\n\r\n  const routeLayer = new VectorLayer({\r\n    isIgoInternalLayer: true,\r\n    id: 'igo-direction-route-layer',\r\n    title: languageService.translate.instant(\r\n      'igo.geo.directionsForm.routeLayer'\r\n    ),\r\n    zIndex: 910,\r\n    source: new FeatureDataSource(),\r\n    showInLayerList: true,\r\n    workspace: {\r\n      enabled: false\r\n    },\r\n    linkedLayers: {\r\n      linkId: 'igo-direction-route-layer'\r\n    },\r\n    exportable: true,\r\n    browsable: false,\r\n    style: directionsStyle\r\n  });\r\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\r\n  routesFeatureStore.layer.visible = true;\r\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\r\n}\r\n\r\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\r\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\r\n    motion: FeatureMotion.None\r\n  });\r\n\r\n  const stepLayer = new VectorLayer({\r\n    isIgoInternalLayer: true,\r\n    id: 'igo-direction-step-layer',\r\n    title: '',\r\n    zIndex: 910,\r\n    source: new FeatureDataSource(),\r\n    showInLayerList: false,\r\n    workspace: {\r\n      enabled: false\r\n    },\r\n    linkedLayers: {\r\n      linkId: 'igo-direction-route-layer'\r\n    },\r\n    exportable: false,\r\n    browsable: false,\r\n    style: directionsStyle\r\n  });\r\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\r\n  stepFeatureStore.layer.visible = true;\r\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\r\n}\r\n\r\nexport function addStopToStopsFeatureStore(\r\n  stop: Stop,\r\n  stopsStore: StopsStore,\r\n  stopsFeatureStore: StopsFeatureStore,\r\n  projection: string,\r\n  languageService: LanguageService\r\n) {\r\n  let stopColor;\r\n  let stopText;\r\n\r\n  switch (stop.relativePosition) {\r\n    case DirectionRelativePositionType.Start:\r\n      stopColor = '#008000';\r\n      stopText = languageService.translate.instant(\r\n        'igo.geo.directionsForm.start'\r\n      );\r\n      break;\r\n    case DirectionRelativePositionType.End:\r\n      stopColor = '#f64139';\r\n      stopText = languageService.translate.instant(\r\n        'igo.geo.directionsForm.end'\r\n      );\r\n      break;\r\n    default:\r\n      stopColor = '#ffd700';\r\n      stopText =\r\n        languageService.translate.instant(\r\n          'igo.geo.directionsForm.intermediate'\r\n        ) +\r\n        ' #' +\r\n        stop.position;\r\n      break;\r\n  }\r\n\r\n  const geometry = new olGeom.Point(\r\n    olProj.transform(\r\n      stop.coordinates,\r\n      projection,\r\n      stopsFeatureStore.map.projection\r\n    )\r\n  );\r\n\r\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n    featureProjection: stopsFeatureStore.map.projection,\r\n    dataProjection: stopsFeatureStore.map.projection\r\n  }) as FeatureGeometry;\r\n\r\n  const previousStop = stopsFeatureStore.get(stop.id);\r\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\r\n\r\n  const stopFeatureStore: FeatureWithStop = {\r\n    type: FEATURE,\r\n    geometry: geojsonGeom,\r\n    projection: stopsFeatureStore.map.projection,\r\n    properties: {\r\n      id: stop.id,\r\n      type: DirectionType.Stop,\r\n      stopText,\r\n      stopColor,\r\n      stopOpacity: 1,\r\n      stop\r\n    },\r\n    meta: {\r\n      id: stop.id,\r\n      revision: previousStopRevision + 1\r\n    },\r\n    ol: new olFeature({ geometry })\r\n  };\r\n  stopsFeatureStore.update(stopFeatureStore);\r\n}\r\n\r\nexport function addDirectionToRoutesFeatureStore(\r\n  routesFeatureStore: RoutesFeatureStore,\r\n  direction: Direction,\r\n  projection: string,\r\n  active: boolean = false,\r\n  moveToExtent = false\r\n) {\r\n  const geom = direction.geometry.coordinates;\r\n  const geometry4326 = new olGeom.LineString(geom);\r\n  const geometry = geometry4326.transform(\r\n    projection,\r\n    routesFeatureStore.map.projection\r\n  );\r\n\r\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n    featureProjection: routesFeatureStore.map.projection,\r\n    dataProjection: routesFeatureStore.map.projection\r\n  }) as FeatureGeometry;\r\n\r\n  const previousRoute = routesFeatureStore.get(direction.id);\r\n  const previousRouteRevision = previousRoute ? previousRoute.meta.revision : 0;\r\n\r\n  const routeFeatureStore: FeatureWithDirection = {\r\n    type: FEATURE,\r\n    geometry: geojsonGeom,\r\n    projection: routesFeatureStore.map.projection,\r\n    properties: {\r\n      id: direction.id,\r\n      type: DirectionType.Route,\r\n      active,\r\n      direction\r\n    },\r\n    meta: {\r\n      id: direction.id,\r\n      revision: previousRouteRevision + 1\r\n    },\r\n    ol: new olFeature({ geometry })\r\n  };\r\n  routesFeatureStore.update(routeFeatureStore);\r\n}\r\n\r\nexport function formatDistance(distance: number): string {\r\n  if (distance === 0) {\r\n    return;\r\n  }\r\n  if (distance >= 100000) {\r\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\r\n  }\r\n  if (distance >= 10000) {\r\n    return (\r\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\r\n    );\r\n  }\r\n  if (distance >= 1000) {\r\n    return (\r\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\r\n    );\r\n  }\r\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\r\n}\r\n\r\nexport function formatDuration(duration: number): string {\r\n  if (duration >= 3600) {\r\n    const hour = Math.floor(duration / 3600);\r\n    const minute = Math.round((duration / 3600 - hour) * 60);\r\n    if (minute === 60) {\r\n      return hour + 1 + ' h';\r\n    }\r\n    return hour + ' h ' + minute + ' min';\r\n  }\r\n\r\n  if (duration >= 60) {\r\n    return Math.round(duration / 60) + ' min';\r\n  }\r\n  return duration + ' s';\r\n}\r\n\r\nexport function formatInstruction(\r\n  type,\r\n  modifier,\r\n  route,\r\n  direction,\r\n  stepPosition,\r\n  exit,\r\n  languageService: LanguageService,\r\n  lastStep = false\r\n) {\r\n  const translate = languageService.translate;\r\n  let directive;\r\n  let image = 'forward';\r\n  let cssClass = 'rotate-270';\r\n  const translatedDirection = translateBearing(direction, languageService);\r\n  const translatedModifier = translateModifier(modifier, languageService);\r\n  const prefix =\r\n    modifier === 'straight'\r\n      ? ''\r\n      : translate.instant('igo.geo.directions.modifier.prefix');\r\n\r\n  let aggregatedDirection = prefix + translatedModifier;\r\n\r\n  if (modifier?.search('slight') >= 0) {\r\n    aggregatedDirection = translatedModifier;\r\n  }\r\n\r\n  if (modifier === 'uturn') {\r\n    image = 'forward';\r\n    cssClass = 'rotate-90';\r\n  } else if (modifier === 'sharp right') {\r\n    image = 'subdirectory-arrow-right';\r\n    cssClass = 'icon-flipped';\r\n  } else if (modifier === 'right') {\r\n    image = 'subdirectory-arrow-right';\r\n    cssClass = 'icon-flipped';\r\n  } else if (modifier === 'slight right') {\r\n    image = 'forward';\r\n    cssClass = 'rotate-290';\r\n  } else if (modifier === 'straight') {\r\n    image = 'forward';\r\n  } else if (modifier === 'slight left') {\r\n    image = 'forward';\r\n    cssClass = 'rotate-250';\r\n  } else if (modifier === 'left') {\r\n    image = 'subdirectory-arrow-left';\r\n    cssClass = 'icon-flipped';\r\n  } else if (modifier === 'sharp left') {\r\n    image = 'subdirectory-arrow-left';\r\n    cssClass = 'icon-flipped';\r\n  }\r\n\r\n  if (type === 'turn') {\r\n    if (modifier === 'straight') {\r\n      directive = translate.instant('igo.geo.directions.turn.straight', {\r\n        route\r\n      });\r\n    } else if (modifier === 'uturn') {\r\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\r\n    } else {\r\n      directive = translate.instant('igo.geo.directions.turn.else', {\r\n        route,\r\n        aggregatedDirection,\r\n        translatedModifier\r\n      });\r\n    }\r\n  } else if (type === 'new name') {\r\n    directive = translate.instant('igo.geo.directions.new name', {\r\n      route,\r\n      translatedDirection\r\n    });\r\n    image = 'compass';\r\n    cssClass = '';\r\n  } else if (type === 'depart') {\r\n    directive = translate.instant('igo.geo.directions.depart', {\r\n      route,\r\n      translatedDirection\r\n    });\r\n    image = 'compass';\r\n    cssClass = '';\r\n  } else if (type === 'arrive') {\r\n    if (lastStep) {\r\n      const coma = !translatedModifier ? '' : ', ';\r\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\r\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', {\r\n        coma,\r\n        aggregatedDirection\r\n      });\r\n    } else {\r\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', {\r\n        route\r\n      });\r\n      image = 'map-marker';\r\n      cssClass = '';\r\n    }\r\n  } else if (type === 'merge') {\r\n    directive = translate.instant('igo.geo.directions.merge', { route });\r\n    image = 'forward';\r\n    cssClass = 'rotate-270';\r\n  } else if (type === 'on ramp') {\r\n    directive = translate.instant('igo.geo.directions.on ramp', {\r\n      aggregatedDirection\r\n    });\r\n  } else if (type === 'off ramp') {\r\n    directive = translate.instant('igo.geo.directions.off ramp', {\r\n      aggregatedDirection\r\n    });\r\n  } else if (type === 'fork') {\r\n    if (modifier.search('left') >= 0) {\r\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\r\n    } else if (modifier.search('right') >= 0) {\r\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\r\n    } else {\r\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\r\n    }\r\n  } else if (type === 'end of road') {\r\n    directive = translate.instant('igo.geo.directions.end of road', {\r\n      translatedModifier,\r\n      route\r\n    });\r\n  } else if (type === 'use lane') {\r\n    directive = translate.instant('igo.geo.directions.use lane');\r\n  } else if (type === 'continue' && modifier !== 'uturn') {\r\n    directive = translate.instant('igo.geo.directions.continue.notUturn', {\r\n      route\r\n    });\r\n    image = 'forward';\r\n    cssClass = 'rotate-270';\r\n  } else if (type === 'roundabout') {\r\n    const cntSuffix =\r\n      exit === 1\r\n        ? translate.instant('igo.geo.directions.cntSuffix.first')\r\n        : translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\r\n    directive = translate.instant('igo.geo.directions.roundabout', {\r\n      exit,\r\n      cntSuffix,\r\n      route\r\n    });\r\n    image = 'chart-donut';\r\n    cssClass = '';\r\n  } else if (type === 'rotary') {\r\n    directive = translate.instant('igo.geo.directions.rotary');\r\n    image = 'chart-donut';\r\n    cssClass = '';\r\n  } else if (type === 'roundabout turn') {\r\n    directive = translate.instant('igo.geo.directions.roundabout turn');\r\n    image = 'chart-donut';\r\n    cssClass = '';\r\n  } else if (type === 'exit roundabout') {\r\n    directive = translate.instant('igo.geo.directions.exit roundabout', {\r\n      route\r\n    });\r\n    image = 'forward';\r\n    cssClass = 'rotate-270';\r\n  } else if (type === 'notification') {\r\n    directive = translate.instant('igo.geo.directions.notification');\r\n  } else if (modifier === 'uturn') {\r\n    directive = translate.instant('igo.geo.directions.uturnText', {\r\n      translatedDirection,\r\n      route\r\n    });\r\n  } else {\r\n    directive = translate.instant('igo.geo.directions.unknown');\r\n  }\r\n\r\n  image = lastStep ? 'flag-variant' : image;\r\n  cssClass = lastStep ? '' : cssClass;\r\n  image = stepPosition === 0 ? 'compass' : image;\r\n  cssClass = stepPosition === 0 ? '' : cssClass;\r\n\r\n  return { instruction: directive, image, cssClass };\r\n}\r\n\r\nexport function translateModifier(modifier, languageService: LanguageService) {\r\n  const translate = languageService.translate;\r\n  if (modifier === 'uturn') {\r\n    return translate.instant('igo.geo.directions.uturn');\r\n  } else if (modifier === 'sharp right') {\r\n    return translate.instant('igo.geo.directions.sharp right');\r\n  } else if (modifier === 'right') {\r\n    return translate.instant('igo.geo.directions.right');\r\n  } else if (modifier === 'slight right') {\r\n    return translate.instant('igo.geo.directions.slight right');\r\n  } else if (modifier === 'sharp left') {\r\n    return languageService.translate.instant('igo.geo.directions.sharp left');\r\n  } else if (modifier === 'left') {\r\n    return languageService.translate.instant('igo.geo.directions.left');\r\n  } else if (modifier === 'slight left') {\r\n    return languageService.translate.instant('igo.geo.directions.slight left');\r\n  } else if (modifier === 'straight') {\r\n    return languageService.translate.instant('igo.geo.directions.straight');\r\n  } else {\r\n    return modifier;\r\n  }\r\n}\r\n\r\nexport function translateBearing(\r\n  bearing: number,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  if (bearing >= 337 || bearing < 23) {\r\n    return translate.instant('igo.geo.cardinalPoints.n');\r\n  } else if (bearing < 67) {\r\n    return translate.instant('igo.geo.cardinalPoints.ne');\r\n  } else if (bearing < 113) {\r\n    return translate.instant('igo.geo.cardinalPoints.e');\r\n  } else if (bearing < 157) {\r\n    return translate.instant('igo.geo.cardinalPoints.se');\r\n  } else if (bearing < 203) {\r\n    return translate.instant('igo.geo.cardinalPoints.s');\r\n  } else if (bearing < 247) {\r\n    return translate.instant('igo.geo.cardinalPoints.sw');\r\n  } else if (bearing < 293) {\r\n    return translate.instant('igo.geo.cardinalPoints.w');\r\n  } else if (bearing < 337) {\r\n    return translate.instant('igo.geo.cardinalPoints.nw');\r\n  } else {\r\n    return;\r\n  }\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\r\nimport { DirectionsSource } from '../directions-sources/directions-source';\r\nimport { DirectionsSourceService } from './directions-source.service';\r\nimport { SubjectStatus } from '@igo2/utils';\r\nimport jsPDF from 'jspdf';\r\nimport 'jspdf-autotable';\r\nimport { IgoMap } from '../../map';\r\nimport { PrintLegendPosition, PrintService } from '../../print';\r\nimport {\r\n  formatDistance,\r\n  formatDuration,\r\n  formatInstruction\r\n} from './directions.utils';\r\nimport moment from 'moment';\r\nimport { ActivityService, ConfigService, LanguageService } from '@igo2/core';\r\nimport html2canvas from 'html2canvas';\r\nimport { DOCUMENT } from '@angular/common';\r\nimport { UserOptions } from 'jspdf-autotable';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DirectionsService {\r\n  constructor(\r\n    private directionsSourceService: DirectionsSourceService,\r\n    private configService: ConfigService,\r\n    private languageService: LanguageService,\r\n    private printService: PrintService,\r\n    @Inject(DOCUMENT) private document: Document,\r\n    private activityService: ActivityService\r\n  ) {}\r\n\r\n  route(\r\n    coordinates: [number, number][],\r\n    directionsOptions: DirectionOptions = {}\r\n  ): Observable<Direction[]>[] {\r\n    if (coordinates.length === 0) {\r\n      return;\r\n    }\r\n    return this.directionsSourceService.sources\r\n      .filter((source: DirectionsSource) => source.enabled)\r\n      .map((source: DirectionsSource) =>\r\n        this.routeSource(source, coordinates, directionsOptions)\r\n      );\r\n  }\r\n\r\n  routeSource(\r\n    source: DirectionsSource,\r\n    coordinates: [number, number][],\r\n    directionsOptions: DirectionOptions = {}\r\n  ): Observable<Direction[]> {\r\n    const request = source.route(coordinates, directionsOptions);\r\n    return request;\r\n  }\r\n\r\n  downloadDirection(\r\n    map: IgoMap,\r\n    direction: Direction\r\n  ): Observable<SubjectStatus> {\r\n    const activityId = this.activityService.register();\r\n    const status$ = new Subject<SubjectStatus>();\r\n\r\n    const doc: jsPDF = new jsPDF({\r\n      orientation: 'p',\r\n      format: 'Letter',\r\n      unit: 'mm' // default\r\n    });\r\n    const dimensions = [\r\n      doc.internal.pageSize.width,\r\n      doc.internal.pageSize.height\r\n    ];\r\n    const margins = [10, 10, 10, 10];\r\n    const width = dimensions[0];\r\n    const height = dimensions[1] - margins[0] - margins[2];\r\n    const size: [number, number] = [width, height];\r\n\r\n    const title = `${direction.title} (${formatDistance(\r\n      direction.distance\r\n    )}, ${formatDuration(direction.duration)})`;\r\n    const titlePosition = 25;\r\n\r\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\r\n      align: 'center'\r\n    });\r\n\r\n    margins[0] += 20;\r\n    const resolution = 96; // Default is 96\r\n    this.printService\r\n      .addMap(doc, map, resolution, size, margins, PrintLegendPosition.none)\r\n      .subscribe(async (status: SubjectStatus) => {\r\n        if (status === SubjectStatus.Done) {\r\n          await this.addInstructions(doc, direction, title);\r\n          this.setPageHeaderFooter(doc);\r\n          await doc.save(`${title}.pdf`, { returnPromise: true });\r\n        }\r\n\r\n        this.activityService.unregister(activityId);\r\n        status$.next(status);\r\n      });\r\n\r\n    return status$;\r\n  }\r\n\r\n  private async setHTMLTableContent(\r\n    direction: Direction\r\n  ): Promise<HTMLTableElement> {\r\n    const data = await this.directionsInstruction(direction);\r\n    const table = document.createElement('table');\r\n    const tblBody = document.createElement('tbody');\r\n    for (let index = 0; index < data.length; index++) {\r\n      const element = data[index];\r\n      var row = document.createElement('tr');\r\n      var cellImage = document.createElement('td');\r\n      var cellText = document.createElement('td');\r\n      // icon\r\n      const img = document.createElement('img') as HTMLImageElement;\r\n      img.src = element.icon;\r\n      // instruction text\r\n      const span = document.createElement('span') as HTMLElement;\r\n      span.innerHTML = element.instruction;\r\n      cellImage.appendChild(img);\r\n      cellText.appendChild(span);\r\n      if (element.distance) {\r\n        const spanDistance = document.createElement('span') as HTMLElement;\r\n        spanDistance.style.verticalAlign = 'middle';\r\n        spanDistance.innerHTML =\r\n          '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + element.distance;\r\n        cellText.appendChild(spanDistance);\r\n      }\r\n      row.append(cellImage);\r\n      row.append(cellText);\r\n      tblBody.appendChild(row);\r\n    }\r\n    table.appendChild(tblBody);\r\n    return table;\r\n  }\r\n\r\n  private async directionsInstruction(\r\n    direction: Direction\r\n  ): Promise<Array<{ instruction: string; icon: string; distance: string }>> {\r\n    const matListItems = this.document\r\n      .getElementsByTagName('igo-directions-results')[0]\r\n      .getElementsByTagName('mat-list')[0];\r\n    const matListItem = matListItems.getElementsByTagName('mat-list-item');\r\n    // convert icon list to base64\r\n    let iconsArray: Array<{ name: string; icon: string }> = [];\r\n    for (let index = 0; index < matListItem.length; index++) {\r\n      const element = matListItem[index];\r\n      const icon = element.getElementsByTagName('mat-icon')[0] as HTMLElement;\r\n      const iconName = icon.getAttribute('data-mat-icon-name') as string;\r\n      const found = iconsArray.some((el) => el.name === iconName);\r\n      if (!found) {\r\n        const iconCanvas = await html2canvas(icon, { scale: 3 });\r\n        iconsArray.push({ name: iconName, icon: iconCanvas.toDataURL() });\r\n      }\r\n    }\r\n\r\n    let formattedDirection: Array<{\r\n      instruction: string;\r\n      icon: string;\r\n      distance: string;\r\n    }> = [];\r\n    for (let i = 0; i < direction.steps.length; i++) {\r\n      const step = direction.steps[i];\r\n      const instruction = formatInstruction(\r\n        step.maneuver.type,\r\n        step.maneuver.modifier,\r\n        step.name,\r\n        step.maneuver.bearing_after,\r\n        i,\r\n        (step.maneuver as any).exit,\r\n        this.languageService,\r\n        i === direction.steps.length - 1\r\n      );\r\n\r\n      const distance = formatDistance(step.distance);\r\n      formattedDirection.push({\r\n        instruction: i + 1 + '. ' + instruction.instruction,\r\n        icon: iconsArray.find((icon) => icon.name === instruction.image).icon,\r\n        distance: distance ? '(' + distance + ')' : undefined\r\n      });\r\n    }\r\n    return formattedDirection;\r\n  }\r\n\r\n  private async addInstructions(\r\n    doc: jsPDF,\r\n    direction: Direction,\r\n    title: string\r\n  ) {\r\n    doc.addPage();\r\n    const titlePosition = 25;\r\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\r\n      align: 'center'\r\n    });\r\n    const HTMLtable = await this.setHTMLTableContent(direction);\r\n    const tablePos = titlePosition + 5;\r\n    (doc as any).autoTable({\r\n      html: HTMLtable,\r\n      startY: tablePos,\r\n      margin: { top: 20, bottom: 20 },\r\n      columnStyles: {\r\n        0: { cellWidth: 10 }\r\n      },\r\n      theme: 'plain',\r\n      styles: {\r\n        fontSize: 12\r\n      },\r\n      didDrawCell: function (data) {\r\n        if (data.column.index === 0 && data.cell.section === 'body') {\r\n          data.row.height = 10;\r\n          const td = data.cell.raw as HTMLElement;\r\n          const img = td.getElementsByTagName('img')[0];\r\n          doc.addImage(img.src, data.cell.x, data.cell.y, 8, 8);\r\n        }\r\n      }\r\n    } satisfies UserOptions);\r\n  }\r\n\r\n  private setPageHeaderFooter(doc: jsPDF) {\r\n    const pageCount = doc.getNumberOfPages();\r\n    const date = moment(Date.now()).format('DD/MM/YYYY hh:mm').toString();\r\n\r\n    const logo = this.configService.getConfig('directionsSources.logo')\r\n      ? this.configService.getConfig('directionsSources.logo')\r\n      : 'assets/logo.png';\r\n\r\n    for (let index = 0; index < pageCount; index++) {\r\n      doc.setPage(index);\r\n      doc.setFontSize(8);\r\n      const pageSize = doc.internal.pageSize;\r\n      const pageHeight = pageSize.height\r\n        ? pageSize.height\r\n        : pageSize.getHeight();\r\n      const width = pageSize.width ? pageSize.width : pageSize.getWidth();\r\n      doc.text(date, 10, 10, { baseline: 'top' });\r\n      doc.addImage(logo, 'PNG', width - 20, 5, 10, 10);\r\n      doc.text(date, 10, pageHeight - 10);\r\n      doc.text(\r\n        'Page ' + doc.getCurrentPageInfo().pageNumber + ' / ' + pageCount,\r\n        width - 20,\r\n        pageHeight - 10\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { EntityStore } from '@igo2/common';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport {\r\n  FeatureWithDirection,\r\n  FeatureWithStep,\r\n  FeatureWithStop,\r\n  Stop\r\n} from './directions.interface';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * stops.\r\n */\r\nexport class StopsStore extends EntityStore<Stop> {\r\n  public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n\r\n  public clearStops() {\r\n    this.storeInitialized$.next(false);\r\n    this.clear();\r\n  }\r\n}\r\n\r\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {}\r\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {}\r\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {}\r\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div\n    touchleave\n    (touchenter)=\"onStopEnter(stop)\"\n    (touchleave)=\"onStopLeave()\"\n    (mouseover)=\"onStopEnter(stop)\"\n    (mouseleave)=\"onStopLeave()\"\n    (cdkDragStarted)=\"stopIsDragged = true\"\n    (cdkDragEnded)=\"stopIsDragged = false\"\n    cdkDragLockAxis=\"y\"\n    class=\"stop-box\"\n    *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index\"\n    cdkDrag\n  >\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <mat-label>{{ getPlaceholder(stop) }}</mat-label>\n        <input\n          id=\"{{ stop.id }}\"\n          type=\"text\"\n          [placeholder]=\"getPlaceholder(stop)\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"stop.text\"\n          aria-label=\"Number\"\n          matInput\n          (focus)=\"onInputFocus(stop)\"\n          [(ngModel)]=\"stop.text\"\n          (keyup)=\"setStopText($event, stop)\"\n          (keydown.enter)=\"$event.preventDefault()\"\n          [matAutocomplete]=\"auto\"\n        />\n        <button\n          *ngIf=\"\n            (stop.text || stop.coordinates) &&\n            stopWithHover &&\n            stop.id === stopWithHover.id\n          \"\n          mat-icon-button\n          matSuffix\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n          color=\"warn\"\n          aria-label=\"Clear\"\n          (click)=\"clearStop(stop)\"\n        >\n          <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n\n        <mat-autocomplete\n          [displayWith]=\"getOptionText\"\n          #auto=\"matAutocomplete\"\n          (optionSelected)=\"chooseProposal($event, stop)\"\n        >\n          <mat-optgroup\n            *ngFor=\"let source of stop.searchProposals\"\n            [label]=\"source.source.title\"\n            [disabled]=\"source.source.enabled === false\"\n          >\n            <mat-option\n              *ngFor=\"let result of source.results\"\n              [value]=\"result\"\n              matTooltipShowDelay=\"500\"\n              [matTooltip]=\"result.meta ? result.meta.title : ''\"\n            >\n              {{ result.meta ? result.meta.title : '' }}\n            </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n    <div\n      *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\"\n      class=\"igo-form-button-group\"\n    >\n      <button\n        class=\"swipe-vertical\"\n        cdkDragHandle\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\"\n        color=\"primary\"\n      >\n        <mat-icon svgIcon=\"gesture-swipe-vertical\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"(stopsStore.count$ | async) > 2\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\"\n        color=\"warn\"\n        (click)=\"removeStop(stop)\"\n      >\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n  </div>\n</div>\n","import {\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  Output\r\n} from '@angular/core';\r\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\r\n\r\nimport * as olProj from 'ol/proj';\r\nimport * as olObservable from 'ol/Observable';\r\n\r\nimport { Stop } from '../shared/directions.interface';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport pointOnFeature from '@turf/point-on-feature';\r\nimport {\r\n  computeRelativePosition,\r\n  removeStopFromStore,\r\n  updateStoreSorting\r\n} from '../shared/directions.utils';\r\nimport { MatAutocomplete } from '@angular/material/autocomplete';\r\nimport { MatOption } from '@angular/material/core';\r\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\r\nimport { roundCoordTo } from '../../map/shared/map.utils';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\r\n\r\n@Component({\r\n  selector: 'igo-directions-inputs',\r\n  templateUrl: './directions-inputs.component.html',\r\n  styleUrls: ['./directions-inputs.component.scss']\r\n})\r\nexport class DirectionsInputsComponent implements OnDestroy {\r\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\r\n  private onMapClickEventKeys = [];\r\n  public stopWithHover: Stop;\r\n  public stopIsDragged: boolean = false;\r\n  @Input() stopsStore: StopsStore;\r\n  @Input() stopsFeatureStore: StopsFeatureStore;\r\n  @Input() projection: string;\r\n  @Input() coordRoundedDecimals: number = 6;\r\n\r\n  @Input() debounce: number = 200;\r\n  @Input() length: number = 2;\r\n\r\n  @Output() stopInputHasFocus: EventEmitter<boolean> =\r\n    new EventEmitter<boolean>(false);\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnDestroy(): void {\r\n    this.unlistenMapSingleClick();\r\n  }\r\n  onStopEnter(stop: Stop) {\r\n    this.stopWithHover = stop;\r\n  }\r\n  onStopLeave() {\r\n    this.stopWithHover = undefined;\r\n  }\r\n\r\n  getOptionText(option) {\r\n    if (option instanceof Object) {\r\n      return option?.meta ? option.meta.title : '';\r\n    }\r\n    return option;\r\n  }\r\n\r\n  chooseProposal(\r\n    event: { source: MatAutocomplete; option: MatOption },\r\n    stop: Stop\r\n  ) {\r\n    const result: Feature = event.option.value;\r\n    if (result) {\r\n      let geomCoord;\r\n      const geom = result.geometry;\r\n      if (geom.type === 'Point') {\r\n        geomCoord = geom.coordinates;\r\n      } else {\r\n        const point = pointOnFeature(result.geometry);\r\n        geomCoord = [\r\n          point.geometry.coordinates[0],\r\n          point.geometry.coordinates[1]\r\n        ];\r\n      }\r\n      if (geomCoord) {\r\n        stop.coordinates = geomCoord;\r\n        stop.text = result.meta.title;\r\n        this.stopsStore.update(stop);\r\n      }\r\n    }\r\n  }\r\n\r\n  setStopText(event: KeyboardEvent, stop: Stop) {\r\n    this.unlistenMapSingleClick();\r\n    const term = (event.target as HTMLInputElement).value;\r\n    if (term.length === 0) {\r\n      this.clearStop(stop);\r\n    } else if (this.validateTerm(term)) {\r\n      stop.text = term;\r\n      this.stopsStore.update(stop);\r\n    }\r\n  }\r\n\r\n  validateTerm(term: string) {\r\n    if (\r\n      this.keyIsValid(term) &&\r\n      (term.length >= this.length || term.length === 0)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private keyIsValid(key: string) {\r\n    return this.invalidKeys.find((value) => value === key) === undefined;\r\n  }\r\n\r\n  getNgClass(stop: Stop): string {\r\n    if (!this.stopWithHover) {\r\n      return 'igo-input-container';\r\n    } else if (stop.id === this.stopWithHover.id) {\r\n      return 'igo-input-container reduce';\r\n    } else {\r\n      return 'igo-input-container';\r\n    }\r\n  }\r\n\r\n  getPlaceholder(stop: Stop): string {\r\n    let extra = '';\r\n    if (stop.relativePosition) {\r\n      if (\r\n        stop.relativePosition === DirectionRelativePositionType.Intermediate\r\n      ) {\r\n        extra = ' #' + stop.position;\r\n      }\r\n      return (\r\n        this.languageService.translate.instant(\r\n          'igo.geo.directionsForm.' + stop.relativePosition\r\n        ) + extra\r\n      );\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  removeStop(stop: Stop) {\r\n    removeStopFromStore(this.stopsStore, stop);\r\n  }\r\n\r\n  clearStop(stop: Stop) {\r\n    this.stopsStore.update({\r\n      id: stop.id,\r\n      relativePosition: stop.relativePosition,\r\n      position: stop.position\r\n    });\r\n  }\r\n\r\n  drop(event: CdkDragDrop<string[]>) {\r\n    this.moveStops(event.previousIndex, event.currentIndex);\r\n  }\r\n\r\n  private moveStops(fromIndex, toIndex) {\r\n    if (fromIndex !== toIndex) {\r\n      const stops = [...this.stopsStore.view.all()];\r\n      moveItemInArray(stops, fromIndex, toIndex);\r\n      stops.map((stop, i) => {\r\n        stop.relativePosition = computeRelativePosition(i, stops.length);\r\n        stop.position = i;\r\n      });\r\n      this.stopsStore.updateMany(stops);\r\n      updateStoreSorting(this.stopsStore);\r\n    }\r\n  }\r\n\r\n  onInputFocus(stop: Stop) {\r\n    if (!stop.text || stop.text?.length === 0) {\r\n      this.unlistenMapSingleClick();\r\n      this.stopInputHasFocus.emit(true);\r\n      this.listenMapSingleClick(stop);\r\n    }\r\n  }\r\n\r\n  private listenMapSingleClick(stop: Stop) {\r\n    const key = this.stopsFeatureStore.layer.map.ol.once(\r\n      'singleclick',\r\n      (event) => {\r\n        const clickCoordinates = olProj.transform(\r\n          event.coordinate,\r\n          this.stopsFeatureStore.layer.map.projection,\r\n          this.projection\r\n        );\r\n        const roundedCoord = roundCoordTo(\r\n          clickCoordinates as [number, number],\r\n          this.coordRoundedDecimals\r\n        );\r\n        stop.text = roundedCoord.join(',');\r\n        stop.coordinates = roundedCoord;\r\n        this.stopsStore.update(stop);\r\n        setTimeout(() => {\r\n          this.stopInputHasFocus.emit(false);\r\n        }, 500);\r\n      }\r\n    );\r\n    this.onMapClickEventKeys.push(key);\r\n  }\r\n\r\n  private unlistenMapSingleClick() {\r\n    this.onMapClickEventKeys.map((key) => {\r\n      olObservable.unByKey(key);\r\n    });\r\n    this.onMapClickEventKeys = [];\r\n  }\r\n}\r\n","<div class=\"igo-form-button-group\">\r\n  <button\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\"\r\n    color=\"primary\"\r\n    (click)=\"addStop()\"\r\n  >\r\n    <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\r\n  </button>\r\n  <button\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    *ngIf=\"\r\n      (routesFeatureStore.count$ | async) >= 1 ||\r\n      (stopsStore.count$ | async) >= 1\r\n    \"\r\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\"\r\n    color=\"warn\"\r\n    (click)=\"resetStops()\"\r\n  >\r\n    <mat-icon svgIcon=\"file-restore\"></mat-icon>\r\n  </button>\r\n  <button\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\r\n    (click)=\"zoomRoute()\"\r\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\"\r\n    color=\"primary\"\r\n  >\r\n    <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\r\n  </button>\r\n  <button\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\r\n    (click)=\"copyDirectionsToClipboard()\"\r\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\"\r\n    color=\"primary\"\r\n  >\r\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n  </button>\r\n  <button\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\r\n    (click)=\"copyLinkToClipboard()\"\r\n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\"\r\n    color=\"primary\"\r\n  >\r\n    <mat-icon svgIcon=\"link\"></mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\r\n    (click)=\"printDirections()\"\r\n    [disabled]=\"disabled$ | async\"\r\n    [matTooltip]=\"'igo.geo.directionsForm.print' | translate\"\r\n    color=\"primary\"\r\n  >\r\n    <mat-icon svgIcon=\"printer\"></mat-icon>\r\n  </button>\r\n</div>\r\n","import { Component, Input, Optional } from '@angular/core';\r\nimport { LanguageService, MessageService, RouteService } from '@igo2/core';\r\nimport { Clipboard } from '@igo2/utils';\r\nimport { Subject, BehaviorSubject } from 'rxjs';\r\nimport { roundCoordTo } from '../../map/shared/map.utils';\r\nimport { FeatureWithDirection } from '../shared/directions.interface';\r\n\r\nimport {\r\n  addStopToStore,\r\n  formatDistance,\r\n  formatDuration,\r\n  formatInstruction\r\n} from '../shared/directions.utils';\r\nimport {\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsStore\r\n} from '../shared/store';\r\nimport { DirectionsService } from '../shared';\r\n\r\n@Component({\r\n  selector: 'igo-directions-buttons',\r\n  templateUrl: './directions-buttons.component.html',\r\n  styleUrls: ['./directions-buttons.component.scss']\r\n})\r\nexport class DirectionsButtonsComponent {\r\n  get activeRoute() {\r\n    return this.routesFeatureStore\r\n      .all()\r\n      .find((route) => route.properties.active);\r\n  }\r\n  @Input() contextUri: string;\r\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\r\n  @Input() stopsStore: StopsStore;\r\n  @Input() routesFeatureStore: RoutesFeatureStore;\r\n  @Input() stepFeatureStore: StepFeatureStore;\r\n\r\n  public disabled$ = new BehaviorSubject(false);\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    @Optional() private route: RouteService,\r\n    private directionsService: DirectionsService\r\n  ) {}\r\n\r\n  resetStops() {\r\n    this.stopsStore.clearStops();\r\n  }\r\n\r\n  // stop are always added before the last stop.\r\n  addStop(): void {\r\n    addStopToStore(this.stopsStore);\r\n  }\r\n\r\n  copyLinkToClipboard() {\r\n    const successful = Clipboard.copy(this.getUrl());\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.geo.directionsForm.dialog.copyMsgLink',\r\n        'igo.geo.directionsForm.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  zoomRoute() {\r\n    this.zoomToActiveRoute$.next();\r\n  }\r\n\r\n  copyDirectionsToClipboard() {\r\n    const directionsBody = this.directionsToText();\r\n    const successful = Clipboard.copy(directionsBody);\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.geo.directionsForm.dialog.copyMsg',\r\n        'igo.geo.directionsForm.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  private directionsToText() {\r\n    const indent = '\\t';\r\n    let activeRouteDirective =\r\n      this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.instructions'\r\n      ) + ':\\n';\r\n    let wayPointList = '';\r\n    const summary =\r\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\r\n      ': \\n' +\r\n      indent +\r\n      this.activeRoute.properties.direction.title +\r\n      '\\n' +\r\n      indent +\r\n      formatDistance(this.activeRoute.properties.direction.distance) +\r\n      '\\n' +\r\n      indent +\r\n      formatDuration(this.activeRoute.properties.direction.duration) +\r\n      '\\n\\n' +\r\n      this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.stopsList'\r\n      ) +\r\n      ':\\n';\r\n\r\n    const url =\r\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\r\n      ':\\n' +\r\n      indent +\r\n      this.getUrl();\r\n\r\n    let wayPointsCnt = 1;\r\n    this.stopsStore.view.all().forEach((stop) => {\r\n      let coord = '';\r\n      let stopText = '';\r\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\r\n        stopText = stop.text;\r\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\r\n      } else {\r\n        stopText = roundCoordTo(stop.coordinates).join(',');\r\n      }\r\n\r\n      wayPointList =\r\n        wayPointList +\r\n        indent +\r\n        wayPointsCnt.toLocaleString() +\r\n        '. ' +\r\n        stopText +\r\n        coord +\r\n        '\\n';\r\n      wayPointsCnt++;\r\n    });\r\n\r\n    let localCnt = 0;\r\n    this.activeRoute.properties.direction.steps.forEach((step) => {\r\n      const instruction = this.formatStep(step, localCnt).instruction;\r\n      const distance =\r\n        formatDistance(step.distance) === undefined\r\n          ? ''\r\n          : ' (' + formatDistance(step.distance) + ')';\r\n      activeRouteDirective =\r\n        activeRouteDirective +\r\n        indent +\r\n        (localCnt + 1).toLocaleString() +\r\n        '. ' +\r\n        instruction +\r\n        distance +\r\n        '\\n';\r\n      localCnt++;\r\n    });\r\n\r\n    const directionsBody =\r\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\r\n\r\n    return directionsBody;\r\n  }\r\n\r\n  formatStep(step, cnt) {\r\n    return formatInstruction(\r\n      step.maneuver.type,\r\n      step.maneuver.modifier,\r\n      step.name,\r\n      step.maneuver.bearing_after,\r\n      cnt,\r\n      step.maneuver.exit,\r\n      this.languageService,\r\n      cnt === this.activeRoute.properties.direction.steps.length - 1\r\n    );\r\n  }\r\n\r\n  private getUrl() {\r\n    if (!this.route) {\r\n      return;\r\n    }\r\n    let context = '';\r\n    if (this.contextUri) {\r\n      context = `context=${this.contextUri}&`;\r\n    }\r\n\r\n    const pos = this.routesFeatureStore\r\n      .all()\r\n      .map((direction: FeatureWithDirection) => direction.properties.id)\r\n      .indexOf(this.activeRoute.properties.id);\r\n    let routingOptions = '';\r\n    if (pos !== 0) {\r\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\r\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\r\n    }\r\n    const directionsKey = this.route.options.directionsCoordKey;\r\n    const stopsCoordinates = this.stopsStore.view\r\n      .all()\r\n      .map((stop) => roundCoordTo(stop.coordinates, 6));\r\n    let directionsUrl = '';\r\n    if (stopsCoordinates.length >= 2) {\r\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\r\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\r\n    }\r\n    return;\r\n  }\r\n\r\n  printDirections() {\r\n    this.stepFeatureStore.clear();\r\n    this.disabled$.next(true);\r\n    this.directionsService\r\n      .downloadDirection(\r\n        this.routesFeatureStore.map,\r\n        this.activeRoute.properties.direction\r\n      )\r\n      .subscribe(() => {\r\n        this.disabled$.next(false);\r\n      });\r\n  }\r\n}\r\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\r\n  <mat-form-field *ngIf=\"directions && directions.length > 1\">\r\n    <mat-label>{{\r\n      'igo.geo.directionsForm.drivingOptions' | translate\r\n    }}</mat-label>\r\n    <mat-select\r\n      placeholder=\"{{ 'igo.geo.directionsForm.drivingOptions' | translate }}\"\r\n      (selectionChange)=\"changeRoute()\"\r\n      [(ngModel)]=\"activeDirection\"\r\n    >\r\n      <mat-option\r\n        *ngFor=\"let direction of directions; let cnt = index\"\r\n        [value]=\"direction\"\r\n      >\r\n        Option {{ cnt + 1 }} : {{ formatDistance(direction.distance) }} ({{\r\n          formatDuration(direction.duration)\r\n        }})\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n\r\n  <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\r\n\r\n  <mat-list (mouseleave)=\"onStepsListBlur()\">\r\n    <h2 mat-header class=\"igo-route-title\">{{ activeDirection.title }}</h2>\r\n    <span class=\"mat-caption\">\r\n      {{ formatDistance(activeDirection.distance) }},\r\n      {{ formatDuration(activeDirection.duration) }}\r\n    </span>\r\n    <mat-list-item\r\n      class=\"igo-steps\"\r\n      (mouseenter)=\"showSegment(step)\"\r\n      (click)=\"showSegment(step, true)\"\r\n      *ngFor=\"let step of activeDirection.steps; let cnt = index\"\r\n      igoListItem\r\n    >\r\n      <mat-icon\r\n        [ngClass]=\"formatStep(step, cnt).cssClass\"\r\n        matListItemIcon\r\n        svgIcon=\"{{ formatStep(step, cnt).image }}\"\r\n      >\r\n      </mat-icon>\r\n\r\n      <span class=\"igo-step-text\">\r\n        {{ cnt + 1 }}. {{ formatStep(step, cnt).instruction }}\r\n      </span>\r\n      <span matListItemMeta>\r\n        {{ formatDistance(step.distance) }}\r\n      </span>\r\n    </mat-list-item>\r\n\r\n    <mat-divider></mat-divider>\r\n  </mat-list>\r\n</div>\r\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport {\r\n  Direction,\r\n  FeatureWithStep,\r\n  IgoStep\r\n} from '../shared/directions.interface';\r\nimport {\r\n  formatDistance,\r\n  formatDuration,\r\n  formatInstruction\r\n} from '../shared/directions.utils';\r\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport * as olGeom from 'ol/geom';\r\n\r\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\r\nimport { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { DirectionType } from '../shared/directions.enum';\r\n\r\n@Component({\r\n  selector: 'igo-directions-results',\r\n  templateUrl: './directions-results.component.html',\r\n  styleUrls: ['./directions-results.component.scss']\r\n})\r\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\r\n  public activeDirection: Direction;\r\n  public directions: Direction[];\r\n\r\n  private entities$$: Subscription;\r\n\r\n  @Input() routesFeatureStore: RoutesFeatureStore;\r\n  @Input() stepFeatureStore: StepFeatureStore;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.entities$$ = this.routesFeatureStore.entities$\r\n      .pipe(debounceTime(200))\r\n      .subscribe((entities) => {\r\n        const activeFeatureWithDirection = entities.find(\r\n          (entity) => entity.properties.active\r\n        );\r\n        this.directions = entities.map((entity) => entity.properties.direction);\r\n        if (activeFeatureWithDirection) {\r\n          this.activeDirection =\r\n            activeFeatureWithDirection.properties.direction;\r\n        } else {\r\n          this.activeDirection = undefined;\r\n        }\r\n        this.cdRef.detectChanges();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.entities$$.unsubscribe();\r\n  }\r\n\r\n  changeRoute() {\r\n    this.routesFeatureStore.entities$.value.map(\r\n      (entity) => (entity.properties.active = !entity.properties.active)\r\n    );\r\n    this.routesFeatureStore.layer.ol\r\n      .getSource()\r\n      .getFeatures()\r\n      .map((feature) => feature.set('active', !feature.get('active')));\r\n  }\r\n\r\n  formatDistance(distance: number): string {\r\n    return formatDistance(distance);\r\n  }\r\n\r\n  formatDuration(duration: number): string {\r\n    return formatDuration(duration);\r\n  }\r\n\r\n  formatStep(step, cnt) {\r\n    return formatInstruction(\r\n      step.maneuver.type,\r\n      step.maneuver.modifier,\r\n      step.name,\r\n      step.maneuver.bearing_after,\r\n      cnt,\r\n      step.maneuver.exit,\r\n      this.languageService,\r\n      cnt === this.activeDirection.steps.length - 1\r\n    );\r\n  }\r\n\r\n  onStepsListBlur() {\r\n    this.stepFeatureStore.clear();\r\n  }\r\n\r\n  showSegment(step: IgoStep, zoomToExtent = false) {\r\n    this.showRouteSegmentGeometry(step, zoomToExtent);\r\n  }\r\n\r\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\r\n    const coordinates = step.geometry.coordinates;\r\n    const vertexId = 'vertex';\r\n    const geometry4326 = new olGeom.LineString(coordinates);\r\n    const geometryMapProjection = geometry4326.transform(\r\n      'EPSG:4326',\r\n      this.stepFeatureStore.layer.map.projection\r\n    );\r\n    const routeSegmentCoordinates = (\r\n      geometryMapProjection as any\r\n    ).getCoordinates();\r\n    const lastPoint = routeSegmentCoordinates[0];\r\n\r\n    const geometry = new olGeom.Point(lastPoint);\r\n    const feature = new olFeature({ geometry });\r\n\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.stepFeatureStore.layer.map.projection,\r\n      dataProjection: this.stepFeatureStore.layer.map.projection\r\n    }) as FeatureGeometry;\r\n\r\n    const previousVertex = this.stepFeatureStore.get(vertexId);\r\n    const previousVertexRevision = previousVertex\r\n      ? previousVertex.meta.revision\r\n      : 0;\r\n\r\n    const stepFeature: FeatureWithStep = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.stepFeatureStore.layer.map.projection,\r\n      properties: {\r\n        id: vertexId,\r\n        step,\r\n        type: DirectionType.Vertex\r\n      },\r\n      meta: {\r\n        id: vertexId,\r\n        revision: previousVertexRevision + 1\r\n      },\r\n      ol: feature\r\n    };\r\n    this.stepFeatureStore.update(stepFeature);\r\n    if (zoomToExtent) {\r\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(\r\n        feature.getGeometry().getExtent() as [number, number, number, number]\r\n      );\r\n    }\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { EntityStoreWatcher } from '@igo2/common';\r\n\r\nimport * as olCondition from 'ol/events/condition';\r\nimport * as olInteraction from 'ol/interaction';\r\nimport * as olProj from 'ol/proj';\r\nimport { TranslateEvent } from 'ol/interaction/Translate';\r\nimport Collection from 'ol/Collection';\r\nimport { SelectEvent } from 'ol/interaction/Select';\r\n\r\nimport {\r\n  DirectionOptions,\r\n  FeatureWithStopProperties,\r\n  Stop\r\n} from './shared/directions.interface';\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport {\r\n  addDirectionToRoutesFeatureStore,\r\n  addStopToStopsFeatureStore,\r\n  addStopToStore,\r\n  initRoutesFeatureStore,\r\n  initStepFeatureStore,\r\n  initStopsFeatureStore,\r\n  updateStoreSorting\r\n} from './shared/directions.utils';\r\nimport { Feature } from '../feature/shared/feature.interfaces';\r\nimport { DirectionsService } from './shared/directions.service';\r\nimport { DirectionType, ProposalType } from './shared/directions.enum';\r\nimport { roundCoordTo, stringToLonLat } from '../map';\r\nimport { SearchService } from '../search/shared/search.service';\r\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\r\nimport {\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsFeatureStore,\r\n  StopsStore\r\n} from './shared/store';\r\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\r\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\r\nimport { QueryService } from '../query/shared/query.service';\r\n\r\n@Component({\r\n  selector: 'igo-directions',\r\n  templateUrl: './directions.component.html',\r\n  styleUrls: ['./directions.component.scss']\r\n})\r\nexport class DirectionsComponent implements OnInit, OnDestroy {\r\n  private watcher: EntityStoreWatcher<Stop>;\r\n\r\n  public projection: string = 'EPSG:4326';\r\n\r\n  private zoomRoute$$: Subscription;\r\n  private storeEmpty$$: Subscription;\r\n  private storeChange$$: Subscription;\r\n  private routesQueries$$: Subscription[] = [];\r\n\r\n  private selectStopInteraction: olInteraction.Select;\r\n  private translateStop: olInteraction.Translate;\r\n  private selectedRoute;\r\n  private focusOnStop: boolean = false;\r\n  private isTranslating: boolean = false;\r\n\r\n  public previousStops: Stop[] = [];\r\n\r\n  private searchs$$: Subscription[] = [];\r\n\r\n  @Input() contextUri: string;\r\n  @Input() stopsStore: StopsStore;\r\n  @Input() stopsFeatureStore: StopsFeatureStore;\r\n  @Input() routesFeatureStore: RoutesFeatureStore;\r\n  @Input() stepFeatureStore: StepFeatureStore;\r\n  @Input() debounce: number = 200;\r\n  @Input() length: number = 2;\r\n  @Input() coordRoundedDecimals: number = 6;\r\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private languageService: LanguageService,\r\n    private directionsService: DirectionsService,\r\n    private searchService: SearchService,\r\n    private queryService: QueryService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.queryService.queryEnabled = false;\r\n    this.initEntityStores();\r\n    setTimeout(() => {\r\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\r\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\r\n      initStepFeatureStore(this.stepFeatureStore);\r\n      this.initOlInteraction();\r\n    }, 1);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.queryService.queryEnabled = true;\r\n    this.storeEmpty$$.unsubscribe();\r\n    this.storeChange$$.unsubscribe();\r\n    this.routesQueries$$.map((u) => u.unsubscribe());\r\n    this.zoomRoute$$.unsubscribe();\r\n    this.freezeStores();\r\n  }\r\n\r\n  private freezeStores() {\r\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(\r\n      this.selectStopInteraction\r\n    );\r\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.translateStop);\r\n    this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute);\r\n    this.stopsFeatureStore.deactivateStrategyOfType(\r\n      FeatureStoreLoadingStrategy\r\n    );\r\n    this.routesFeatureStore.deactivateStrategyOfType(\r\n      FeatureStoreLoadingStrategy\r\n    );\r\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n  }\r\n\r\n  private initEntityStores() {\r\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\r\n    this.monitorEmptyEntityStore();\r\n    this.monitorEntityStoreChange();\r\n    this.monitorActiveRouteZoom();\r\n  }\r\n\r\n  private monitorActiveRouteZoom() {\r\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\r\n      if (this.routesFeatureStore.count >= 1) {\r\n        const activeRoute = this.routesFeatureStore\r\n          .all()\r\n          .find((route) => route.properties.active);\r\n\r\n        if (activeRoute) {\r\n          activeRoute.ol.getGeometry();\r\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\r\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(\r\n            routeExtent as [number, number, number, number]\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private initOlInteraction() {\r\n    this.selectStopInteraction = new olInteraction.Select({\r\n      layers: [this.stopsFeatureStore.layer.ol],\r\n      hitTolerance: 7,\r\n      condition: (event) => {\r\n        return event.type === 'pointermove' && !event.dragging;\r\n      }\r\n    });\r\n\r\n    this.translateStop = new olInteraction.Translate({\r\n      features: this.selectStopInteraction.getFeatures()\r\n    });\r\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\r\n      this.isTranslating = true;\r\n      this.executeStopTranslation(evt.features);\r\n    });\r\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\r\n      this.isTranslating = false;\r\n      this.executeStopTranslation(evt.features);\r\n    });\r\n\r\n    this.selectedRoute = new olInteraction.Select({\r\n      layers: [this.routesFeatureStore.layer.ol],\r\n      condition: olCondition.click,\r\n      hitTolerance: 7,\r\n      filter: (feature) => {\r\n        return (\r\n          feature.get('type') === DirectionType.Route &&\r\n          feature.get('active') &&\r\n          !this.isTranslating\r\n        );\r\n      }\r\n    });\r\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\r\n      if (this.focusOnStop === false) {\r\n        const selectCoordinates = roundCoordTo(\r\n          olProj.transform(\r\n            (evt as any).mapBrowserEvent.coordinate,\r\n            this.routesFeatureStore.layer.map.projection,\r\n            this.projection\r\n          ) as [number, number],\r\n          this.coordRoundedDecimals\r\n        );\r\n        const addedStop = addStopToStore(this.stopsStore);\r\n        addedStop.text = selectCoordinates.join(',');\r\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\r\n      }\r\n    });\r\n\r\n    this.stopsFeatureStore.layer.map.ol.addInteraction(\r\n      this.selectStopInteraction\r\n    );\r\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.translateStop);\r\n    this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\r\n  }\r\n\r\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\r\n    stopInputHasFocus\r\n      ? this.routesFeatureStore.layer.map.ol.removeInteraction(\r\n          this.selectedRoute\r\n        )\r\n      : this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\r\n  }\r\n\r\n  private executeStopTranslation(features: Collection<any>) {\r\n    if (features.getLength() === 0) {\r\n      return;\r\n    }\r\n    const firstFeature = features.getArray()[0];\r\n    const translatedStopId = firstFeature.getId();\r\n\r\n    const translationCoordinates = olProj.transform(\r\n      firstFeature.getGeometry().getCoordinates(),\r\n      this.stopsFeatureStore.layer.map.projection,\r\n      this.projection\r\n    );\r\n    const translatedStop = this.stopsStore.get(translatedStopId);\r\n    const roundedCoord = roundCoordTo(\r\n      translationCoordinates as [number, number],\r\n      this.coordRoundedDecimals\r\n    );\r\n    translatedStop.coordinates = roundedCoord;\r\n    translatedStop.text = roundedCoord.join(',');\r\n    this.stopsStore.update(translatedStop);\r\n  }\r\n\r\n  private monitorEmptyEntityStore() {\r\n    // Watch if the store is empty to reset it\r\n    this.storeEmpty$$ = this.stopsStore.count$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((count) => {\r\n        if (count < 2) {\r\n          addStopToStore(this.stopsStore);\r\n          if (this.stopsStore.count === 2) {\r\n            this.stopsStore.storeInitialized$.next(true);\r\n            return;\r\n          }\r\n          this.stopsStore.storeInitialized$.next(false);\r\n        }\r\n        this.routesQueries$$.map((u) => u.unsubscribe());\r\n      });\r\n  }\r\n\r\n  private monitorEntityStoreChange() {\r\n    this.storeChange$$ = this.stopsStore.entities$\r\n      .pipe(debounceTime(this.debounce))\r\n      .subscribe((stops: Stop[]) => {\r\n        this.handleStopDiff(stops);\r\n        updateStoreSorting(this.stopsStore);\r\n        this.handleStopsFeature();\r\n        this.getRoutes(this.isTranslating);\r\n      });\r\n  }\r\n\r\n  cancelSearch() {\r\n    this.searchs$$.map((s) => s.unsubscribe());\r\n  }\r\n\r\n  private handleStopDiff(stops: Stop[]) {\r\n    const simplifiedStops = stops.map((stop: Stop) => {\r\n      return ObjectUtils.removeUndefined({\r\n        ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates }\r\n      });\r\n    });\r\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, [\r\n      'coordinates'\r\n    ]);\r\n    const stopIdToProcess = diff.added.concat(diff.modified);\r\n    if (stopIdToProcess) {\r\n      stopIdToProcess.map((change) => {\r\n        const changedStop = change.newValue as Stop;\r\n        if (changedStop) {\r\n          const stop: Stop = this.stopsStore.get(changedStop.id);\r\n          const term = stop.text;\r\n          if (!term || term.length === 0) {\r\n            return;\r\n          }\r\n          const response = stringToLonLat(\r\n            term,\r\n            this.stopsFeatureStore.layer.map.projection\r\n          );\r\n          let researches: Research[];\r\n          let isCoord = false;\r\n          if (response.lonLat) {\r\n            isCoord = true;\r\n          }\r\n          researches = this.searchService.search(term, {\r\n            searchType: 'Feature'\r\n          });\r\n          this.cancelSearch();\r\n          const requests$ = researches.map((res) =>\r\n            res.request.pipe(\r\n              map((results: SearchResult[]) =>\r\n                results.filter((r) =>\r\n                  isCoord\r\n                    ? r.data.geometry.type === 'Point' && r.data.geometry\r\n                    : r.data.geometry\r\n                )\r\n              )\r\n            )\r\n          );\r\n          this.searchs$$ = requests$.map((request) => {\r\n            return request\r\n              .pipe(\r\n                map((results: SearchResult[]) =>\r\n                  results.filter((r) =>\r\n                    isCoord\r\n                      ? r.data.geometry.type === 'Point' && r.data.geometry\r\n                      : r.data.geometry\r\n                  )\r\n                )\r\n              )\r\n              .subscribe((res: SearchResult[]) => {\r\n                if (res.length > 0) {\r\n                  const source = res[0].source;\r\n                  const meta = res[0].meta;\r\n                  const results = res.map((r) => r.data);\r\n                  if (!stop.searchProposals) {\r\n                    stop.searchProposals = [];\r\n                  }\r\n                  stop.searchProposals = stop.searchProposals.filter(\r\n                    (sp) =>\r\n                      sp.type ===\r\n                      (isCoord ? ProposalType.Coord : ProposalType.Text)\r\n                  );\r\n                  let storedSource = stop.searchProposals.find(\r\n                    (sp) => sp.source === source\r\n                  );\r\n                  if (storedSource) {\r\n                    storedSource.results = results;\r\n                  } else {\r\n                    stop.searchProposals.push({\r\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\r\n                      source,\r\n                      meta,\r\n                      results\r\n                    });\r\n                  }\r\n                }\r\n                this.cdRef.detectChanges();\r\n              });\r\n          });\r\n        }\r\n      });\r\n    }\r\n    this.previousStops = simplifiedStops;\r\n  }\r\n\r\n  private handleStopsFeature() {\r\n    const stops = this.stopsStore.all();\r\n    const stopsWithCoordinates = stops.filter((stop) => stop.coordinates);\r\n    stopsWithCoordinates.map((stop) => this.addStopOverlay(stop));\r\n    this.stopsFeatureStore\r\n      .all()\r\n      .map((stopFeature: Feature<FeatureWithStopProperties>) => {\r\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\r\n          this.stopsFeatureStore.delete(stopFeature);\r\n        }\r\n      });\r\n    const stopsWithoutCoordinates = stops.filter((stop) => !stop.coordinates);\r\n    stopsWithoutCoordinates.map((stop) => {\r\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\r\n      if (stopFeature) {\r\n        this.stopsFeatureStore.delete(stopFeature);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getRoutes(isOverview: boolean = false) {\r\n    const stopsWithCoordinates = this.stopsStore.view\r\n      .all()\r\n      .filter((stop) => stop.coordinates);\r\n    if (stopsWithCoordinates.length < 2) {\r\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\r\n      return;\r\n    }\r\n\r\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\r\n      const roundedCoord = roundCoordTo(\r\n        stop.coordinates,\r\n        this.coordRoundedDecimals\r\n      );\r\n      return roundedCoord;\r\n    });\r\n    const overviewDirectionsOptions: DirectionOptions = {\r\n      overview: true,\r\n      steps: false,\r\n      alternatives: false,\r\n      continue_straight: false\r\n    };\r\n    this.routesQueries$$.map((u) => u.unsubscribe());\r\n    const routeResponse = this.directionsService.route(\r\n      roundedCoordinates,\r\n      isOverview ? overviewDirectionsOptions : undefined\r\n    );\r\n    if (routeResponse) {\r\n      routeResponse.map((res) =>\r\n        this.routesQueries$$.push(\r\n          res.subscribe((directions) => {\r\n            this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\r\n            directions.map((direction) =>\r\n              addDirectionToRoutesFeatureStore(\r\n                this.routesFeatureStore,\r\n                direction,\r\n                this.projection,\r\n                direction === directions[0] ? true : false\r\n              )\r\n            );\r\n          })\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  public addStopOverlay(stop: Stop) {\r\n    addStopToStopsFeatureStore(\r\n      stop,\r\n      this.stopsStore,\r\n      this.stopsFeatureStore,\r\n      this.projection,\r\n      this.languageService\r\n    );\r\n  }\r\n}\r\n","<igo-directions-buttons\r\n  [stepFeatureStore]=\"stepFeatureStore\"\r\n  [contextUri]=\"contextUri\"\r\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\r\n  [routesFeatureStore]=\"routesFeatureStore\"\r\n  [stopsStore]=\"stopsStore\"\r\n></igo-directions-buttons>\r\n\r\n<igo-directions-inputs\r\n  (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\"\r\n  [coordRoundedDecimals]=\"coordRoundedDecimals\"\r\n  [projection]=\"projection\"\r\n  [stopsFeatureStore]=\"stopsFeatureStore\"\r\n  [stopsStore]=\"stopsStore\"\r\n  [debounce]=\"debounce\"\r\n  [length]=\"length\"\r\n></igo-directions-inputs>\r\n\r\n<igo-directions-results\r\n  [stepFeatureStore]=\"stepFeatureStore\"\r\n  [routesFeatureStore]=\"routesFeatureStore\"\r\n></igo-directions-results>\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport { customCacheHasher, uuid } from '@igo2/utils';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\r\nimport {\r\n  DirectionsFormat,\r\n  SourceDirectionsType\r\n} from '../shared/directions.enum';\r\n\r\nimport { DirectionsSource } from './directions-source';\r\nimport { DirectionsSourceOptions } from './directions-source.interface';\r\n\r\n@Injectable()\r\nexport class OsrmDirectionsSource extends DirectionsSource {\r\n  get enabled(): boolean {\r\n    return this.options.enabled !== false;\r\n  }\r\n  set enabled(value: boolean) {\r\n    this.options.enabled = value;\r\n  }\r\n  static _name = 'OSRM Qubec';\r\n  private directionsUrl =\r\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\r\n  private options: DirectionsSourceOptions;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService\r\n  ) {\r\n    super();\r\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\r\n    this.directionsUrl = this.options.url || this.directionsUrl;\r\n  }\r\n\r\n  getName(): string {\r\n    return OsrmDirectionsSource._name;\r\n  }\r\n\r\n  route(\r\n    coordinates: [number, number][],\r\n    directionsOptions: DirectionOptions = {}\r\n  ): Observable<Direction[]> {\r\n    const directionsParams = this.getRouteParams(directionsOptions);\r\n    return this.getRoute(coordinates, directionsParams);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getRoute(\r\n    coordinates: [number, number][],\r\n    params: HttpParams\r\n  ): Observable<Direction[]> {\r\n    return this.http\r\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\r\n        params\r\n      })\r\n      .pipe(map((res) => this.extractRoutesData(res)));\r\n  }\r\n\r\n  private extractRoutesData(response): Direction[] {\r\n    const routeResponse = [];\r\n    response.routes.forEach((route) => {\r\n      routeResponse.push(this.formatRoute(route, response.waypoints));\r\n    });\r\n    return routeResponse;\r\n  }\r\n\r\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\r\n    directionsOptions.alternatives =\r\n      directionsOptions.alternatives !== undefined\r\n        ? directionsOptions.alternatives\r\n        : true;\r\n    directionsOptions.steps =\r\n      directionsOptions.steps !== undefined ? directionsOptions.steps : true;\r\n    directionsOptions.geometries =\r\n      directionsOptions.geometries !== undefined\r\n        ? directionsOptions.geometries\r\n        : 'geojson';\r\n    directionsOptions.overview =\r\n      directionsOptions.overview !== undefined\r\n        ? directionsOptions.overview\r\n        : false;\r\n    directionsOptions.continue_straight =\r\n      directionsOptions.continue_straight !== undefined\r\n        ? directionsOptions.continue_straight\r\n        : false;\r\n\r\n    return new HttpParams({\r\n      fromObject: {\r\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\r\n        overview: directionsOptions.overview ? 'simplified' : 'full',\r\n        steps: directionsOptions.steps ? 'true' : 'false',\r\n        geometries: directionsOptions.geometries\r\n          ? directionsOptions.geometries\r\n          : 'geojson',\r\n        continue_straight: directionsOptions.continue_straight\r\n          ? 'true'\r\n          : 'false'\r\n      }\r\n    });\r\n  }\r\n\r\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\r\n    const stepsUI = [];\r\n    roadNetworkRoute.legs.forEach((leg) => {\r\n      leg.steps.forEach((step) => {\r\n        stepsUI.push(step);\r\n      });\r\n    });\r\n    return {\r\n      id: uuid(),\r\n      title: roadNetworkRoute.legs[0].summary,\r\n      source: OsrmDirectionsSource._name,\r\n      sourceType: SourceDirectionsType.Route,\r\n      order: 1,\r\n      format: DirectionsFormat.GeoJSON,\r\n      icon: 'directions',\r\n      projection: 'EPSG:4326',\r\n      waypoints,\r\n      distance: roadNetworkRoute.distance,\r\n      duration: roadNetworkRoute.duration,\r\n      geometry: roadNetworkRoute.geometry,\r\n      legs: roadNetworkRoute.legs,\r\n      steps: stepsUI,\r\n      weight: roadNetworkRoute.weight,\r\n      weight_name: roadNetworkRoute.weight_name\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { DirectionsSource } from './directions-source';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import { FEATURE } from '../../feature';\nimport { LAYER } from '../../layer/shared';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","import { FeatureGeometry } from './../../feature/shared/feature.interfaces';\r\nimport {\r\n  Directive,\r\n  Input,\r\n  OnDestroy,\r\n  Self,\r\n  OnInit,\r\n  AfterContentChecked,\r\n  HostListener\r\n} from '@angular/core';\r\n\r\nimport { Subscription, first } from 'rxjs';\r\n\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { SearchService } from './search.service';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport { transform } from 'ol/proj';\r\nimport * as olgeom from 'ol/geom';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\n\r\nimport { SearchResult, Research } from './search.interfaces';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\r\nimport { SearchSourceService } from './search-source.service';\r\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\r\nimport { MediaService } from '@igo2/core';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { pointerPositionSummaryMarkerStyle } from '../../style/shared/feature/feature-style';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\n/**\r\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\r\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\r\n * By default, no search sources. Config in config file must be defined.\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoSearchPointerSummary]'\r\n})\r\nexport class SearchPointerSummaryDirective\r\n  implements OnInit, OnDestroy, AfterContentChecked\r\n{\r\n  public store: FeatureStore<Feature>;\r\n  private lonLat: [number, number];\r\n  private pointerSearchStore: EntityStore<SearchResult> =\r\n    new EntityStore<SearchResult>([]);\r\n  private lastTimeoutRequest;\r\n  private store$$: Subscription;\r\n  private layers$$: Subscription;\r\n  private reverseSearch$$: Subscription[] = [];\r\n  private hasPointerReverseSearchSource: boolean = false;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener;\r\n\r\n  private searchPointerSummaryFeatureId: string =\r\n    'searchPointerSummaryFeatureId';\r\n  /**\r\n   * The delay where the mouse must be motionless before trigger the reverse search\r\n   */\r\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\r\n\r\n  /**\r\n   * If the user has enabled or not the directive\r\n   */\r\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\r\n\r\n  @HostListener('mouseleave')\r\n  mouseleave() {\r\n    clearTimeout(this.lastTimeoutRequest);\r\n    this.clearLayer();\r\n  }\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private searchService: SearchService,\r\n    private searchSourceService: SearchSourceService,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.listenToMapPointerMove();\r\n    this.subscribeToPointerStore();\r\n\r\n    this.map.status$\r\n      .pipe(first((status) => status === SubjectStatus.Done))\r\n      .subscribe(() => {\r\n        this.store = new FeatureStore<Feature>([], { map: this.map });\r\n        this.initStore();\r\n      });\r\n\r\n    // To handle context change without using the contextService.\r\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\r\n      if (\r\n        this.store &&\r\n        !layers.find((l) => l.id === 'searchPointerSummaryId')\r\n      ) {\r\n        this.initStore();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize the pointer position store\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      isIgoInternalLayer: true,\r\n      id: 'searchPointerSummaryId',\r\n      title: 'searchPointerSummary',\r\n      zIndex: 900,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      style: pointerPositionSummaryMarkerStyle\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n  }\r\n\r\n  ngAfterContentChecked(): void {\r\n    if (\r\n      !this.searchSourceService\r\n        .getEnabledSources()\r\n        .filter(sourceCanReverseSearchAsSummary).length\r\n    ) {\r\n      this.hasPointerReverseSearchSource = false;\r\n    } else {\r\n      this.hasPointerReverseSearchSource = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unsubscribeToPointerStore();\r\n    this.unsubscribeReverseSearch();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to pointermove result store\r\n   * @internal\r\n   */\r\n  subscribeToPointerStore() {\r\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(\r\n      (resultsUnderPointerPosition) => {\r\n        this.entitiesToPointerOverlay(resultsUnderPointerPosition);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Build an object based on the closest feature by type (base on type and distance properties )\r\n   * @param results SearchResult[]\r\n   * @returns OL style function\r\n   */\r\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\r\n    const closestResultByType = {};\r\n\r\n    results.map((result) => {\r\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\r\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\r\n          const prevDistance =\r\n            closestResultByType[result.data.properties.type].distance;\r\n          if (result.data.properties.distance < prevDistance) {\r\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\r\n            closestResultByType[result.data.properties.type] = {\r\n              distance: result.data.properties.distance,\r\n              title\r\n            };\r\n          }\r\n        } else {\r\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\r\n          closestResultByType[result.data.properties.type] = {\r\n            distance: result.data.properties.distance,\r\n            title\r\n          };\r\n        }\r\n      }\r\n    });\r\n\r\n    return closestResultByType;\r\n  }\r\n\r\n  /**\r\n   * convert store entities to a pointer position overlay with label summary on.\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private entitiesToPointerOverlay(\r\n    resultsUnderPointerPosition: SearchResult[]\r\n  ) {\r\n    const closestResultByType = this.computeSummaryClosestFeature(\r\n      resultsUnderPointerPosition\r\n    );\r\n    const summarizedClosestType = Object.keys(closestResultByType);\r\n    const processedSummarizedClosestType = [];\r\n    const summary = [];\r\n    resultsUnderPointerPosition.map((result) => {\r\n      const typeIndex = summarizedClosestType.indexOf(\r\n        result.data.properties.type\r\n      );\r\n      if (typeIndex !== -1) {\r\n        summary.push(closestResultByType[result.data.properties.type].title);\r\n        summarizedClosestType.splice(typeIndex, 1);\r\n        processedSummarizedClosestType.push(result.data.properties.type);\r\n      } else {\r\n        if (\r\n          processedSummarizedClosestType.indexOf(\r\n            result.data.properties.type\r\n          ) === -1\r\n        ) {\r\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\r\n        }\r\n      }\r\n    });\r\n    if (summary.length) {\r\n      this.addPointerOverlay(summary.join('\\n'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to pointer store.\r\n   * @internal\r\n   */\r\n  unsubscribeToPointerStore() {\r\n    this.store$$.unsubscribe();\r\n  }\r\n  /**\r\n   * Unsubscribe to reverse seatch store.\r\n   * @internal\r\n   */\r\n  unsubscribeReverseSearch() {\r\n    this.reverseSearch$$.map((s) => s.unsubscribe());\r\n    this.reverseSearch$$ = [];\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   * @internal\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    unByKey(this.pointerMoveListener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\r\n    if (\r\n      event.dragging ||\r\n      !this.igoSearchPointerSummaryEnabled ||\r\n      !this.hasPointerReverseSearchSource ||\r\n      this.mediaService.isTouchScreen()\r\n    ) {\r\n      this.clearLayer();\r\n      return;\r\n    }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n      this.clearLayer();\r\n      this.unsubscribeReverseSearch();\r\n    }\r\n\r\n    this.lonLat = transform(\r\n      event.coordinate,\r\n      this.mapProjection,\r\n      'EPSG:4326'\r\n    ) as [number, number];\r\n\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      this.onSearchCoordinate();\r\n    }, this.igoSearchPointerSummaryDelay);\r\n  }\r\n\r\n  /**\r\n   * Sort the results by display order.\r\n   * @param r1 First result\r\n   * @param r2 Second result\r\n   */\r\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\r\n    return r1.source.displayOrder - r2.source.displayOrder;\r\n  }\r\n\r\n  private onSearchCoordinate() {\r\n    this.pointerSearchStore.clear();\r\n    const results = this.searchService.reverseSearch(\r\n      this.lonLat,\r\n      { params: { geometry: 'false', icon: 'false' } },\r\n      true\r\n    );\r\n\r\n    for (const i in results) {\r\n      if (results.length > 0) {\r\n        this.reverseSearch$$.push(\r\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\r\n            this.onSearch({ research: results[i], results: _results });\r\n          })\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\r\n    const results = event.results;\r\n    const newResults = this.pointerSearchStore\r\n      .all()\r\n      .filter((result: SearchResult) => result.source !== event.research.source)\r\n      .concat(results);\r\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the pointer store\r\n   * @param text string\r\n   */\r\n  private addPointerOverlay(text: string) {\r\n    this.clearLayer();\r\n\r\n    const geometry = new olgeom.Point(\r\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\r\n    );\r\n    const feature = new olFeature({ geometry });\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.mapProjection,\r\n      dataProjection: this.mapProjection\r\n    }) as FeatureGeometry;\r\n\r\n    const f: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.mapProjection,\r\n      properties: {\r\n        id: this.searchPointerSummaryFeatureId,\r\n        pointerSummary: text\r\n      },\r\n      meta: {\r\n        id: this.searchPointerSummaryFeatureId\r\n      },\r\n      ol: feature\r\n    };\r\n    this.store.setLayerFeatures([f], FeatureMotion.None);\r\n  }\r\n\r\n  /**\r\n   * Clear the pointer store features\r\n   */\r\n  private clearLayer() {\r\n    if (this.store) {\r\n      this.store.clearLayer();\r\n    }\r\n  }\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport olWKT from 'ol/format/WKT';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\n\r\nimport { SearchResult, TextSearch } from '../search.interfaces';\r\nimport { SearchSource } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { Cacheable } from 'ts-cacheable';\r\nimport { GeoJsonGeometryTypes } from 'geojson';\r\nimport { customCacheHasher } from '@igo2/utils';\r\n\r\n/**\r\n * Cadastre search source\r\n */\r\n@Injectable()\r\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'cadastre';\r\n  static type = FEATURE;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n  }\r\n\r\n  getId(): string {\r\n    return CadastreSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return CadastreSearchSource.type;\r\n  }\r\n\r\n  /*\r\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Cadastre (Qubec)',\r\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a place by name\r\n   * @param term Place name\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\r\n    term = term.startsWith(',') ? term.substr(1) : term;\r\n    term = term.replace(/ /g, '');\r\n\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\r\n      return of([]);\r\n    }\r\n    return this.getCadastre(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getCadastre(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return this.http\r\n      .get(this.searchUrl, { params, responseType: 'text' })\r\n      .pipe(map((response: string) => this.extractResults(response, term)));\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          numero: term,\r\n          epsg: '4326'\r\n        },\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: string,\r\n    term: string\r\n  ): SearchResult<Feature>[] {\r\n    return response\r\n      .split('<br />')\r\n      .filter((lot: string) => lot.length > 0)\r\n      .map((lot: string) => this.dataToResult(lot, term));\r\n  }\r\n\r\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\r\n    const lot = data.split(';');\r\n    const numero = lot[0];\r\n    const wkt = lot[7];\r\n    const geometry = this.computeGeometry(wkt);\r\n\r\n    const properties = {\r\n      NoLot: numero,\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n    const id = [this.getId(), 'cadastre', numero].join('.');\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: numero,\r\n        score: computeTermSimilarity(term.trim(), numero),\r\n        icon: 'map-marker'\r\n      },\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: numero\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeGeometry(wkt: string): FeatureGeometry {\r\n    const feature = new olWKT().readFeature(wkt, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: 'EPSG:4326'\r\n    });\r\n    return {\r\n      type: feature.getGeometry().getType() as GeoJsonGeometryTypes,\r\n      coordinates: (feature.getGeometry() as any).getCoordinates()\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport { CadastreSearchSource } from './cadastre';\r\n\r\n/**\r\n * Cadastre search source factory\r\n * @ignore\r\n */\r\nexport function cadastreSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService\r\n) {\r\n  return new CadastreSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Cadastre search source\r\n */\r\nexport function provideCadastreSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: cadastreSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\n\r\nimport { StorageService } from '@igo2/core';\r\nimport { SearchResult, TextSearch } from '../search.interfaces';\r\nimport { SearchSource } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\nimport { NominatimData } from './nominatim.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { Cacheable } from 'ts-cacheable';\r\nimport { customCacheHasher } from '@igo2/utils';\r\n\r\n/**\r\n * Nominatim search source\r\n */\r\n@Injectable()\r\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'nominatim';\r\n  static type = FEATURE;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    storageService: StorageService\r\n  ) {\r\n    super(options, storageService);\r\n  }\r\n\r\n  getId(): string {\r\n    return NominatimSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return NominatimSearchSource.type;\r\n  }\r\n\r\n  /*\r\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Nominatim (OSM)',\r\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'amenity',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.food',\r\n              value:\r\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.health',\r\n              value:\r\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.entertainment',\r\n              value:\r\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\r\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.finance',\r\n              value: 'atm,bank,bureau_de_change',\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: true\r\n            },\r\n            {\r\n              title: '20',\r\n              value: 20,\r\n              enabled: false\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'restrictExtent',\r\n          name: 'countrycodes',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.nominatim.country.canada',\r\n              value: 'CA',\r\n              enabled: true\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.country.all',\r\n              value: null,\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'multiple object',\r\n          name: 'dedupe',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.searchSources.settings.true',\r\n              value: 0,\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.searchSources.settings.false',\r\n              value: 1,\r\n              enabled: true\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a place by name\r\n   * @param term Place name\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('q')) {\r\n      return of([]);\r\n    }\r\n    return this.getSearch(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getSearch(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return this.http\r\n      .get(this.searchUrl, { params })\r\n      .pipe(\r\n        map((response: NominatimData[]) => this.extractResults(response, term))\r\n      );\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          q: this.computeTerm(term),\r\n          format: 'json'\r\n        },\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: NominatimData[],\r\n    term: string\r\n  ): SearchResult<Feature>[] {\r\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\r\n  }\r\n\r\n  private dataToResult(\r\n    data: NominatimData,\r\n    term: string\r\n  ): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const geometry = this.computeGeometry(data);\r\n    const extent = this.computeExtent(data);\r\n    const id = [this.getId(), 'place', data.place_id].join('.');\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.display_name,\r\n        icon: 'map-marker',\r\n        score: computeTermSimilarity(term.trim(), data.display_name)\r\n      },\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.display_name\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: NominatimData): { [key: string]: any } {\r\n    return {\r\n      display_name: data.display_name,\r\n      place_id: data.place_id,\r\n      osm_type: data.osm_type,\r\n      class: data.class,\r\n      type: data.type\r\n    };\r\n  }\r\n\r\n  private computeGeometry(data: NominatimData): FeatureGeometry {\r\n    return {\r\n      type: 'Point',\r\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\r\n    };\r\n  }\r\n\r\n  private computeExtent(data: NominatimData): [number, number, number, number] {\r\n    return [\r\n      parseFloat(data.boundingbox[2]),\r\n      parseFloat(data.boundingbox[0]),\r\n      parseFloat(data.boundingbox[3]),\r\n      parseFloat(data.boundingbox[1])\r\n    ];\r\n  }\r\n\r\n  private computeTerm(term: string): string {\r\n    return this.computeTermTags(term);\r\n  }\r\n\r\n  /**\r\n   * Add hashtag from query in Nominatim's format (+[])\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTermTags(term: string): string {\r\n    const hashtags = super.getHashtagsValid(term, 'amenity');\r\n    if (!hashtags) {\r\n      return this.computeTermSettings(term);\r\n    }\r\n\r\n    if (!hashtags.length) {\r\n      return null;\r\n    }\r\n\r\n    term = term.replace(/(#[^\\s]*)/g, '');\r\n    hashtags.forEach((tag) => {\r\n      term += '+[' + tag + ']';\r\n    });\r\n\r\n    return term;\r\n  }\r\n\r\n  /**\r\n   * Add hashtag from settings in Nominatim's format (+[])\r\n   * @param term Query\r\n   */\r\n  private computeTermSettings(term: string): string {\r\n    this.options.settings.forEach((settings) => {\r\n      if (settings.name === 'amenity') {\r\n        settings.values.forEach((conf) => {\r\n          if (conf.enabled && typeof conf.value === 'string') {\r\n            const splitted = conf.value.split(',');\r\n            splitted.forEach((value) => {\r\n              term += '+[' + value + ']';\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n    return term;\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { NominatimSearchSource } from './nominatim';\n\n/**\n * Nominatim search source factory\n * @ignore\n */\nexport function nominatimSearchSourceFactory(\n  http: HttpClient,\n  config: ConfigService,\n  storageService: StorageService\n) {\n  return new NominatimSearchSource(\n    http,\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\n    storageService\n  );\n}\n\n/**\n * Function that returns a provider for the Nominatim search source\n */\nexport function provideNominatimSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: nominatimSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService, StorageService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\r\nimport { FEATURE, Feature } from '../../../feature';\r\n\r\nimport { SearchResult, TextSearch, ReverseSearch } from '../search.interfaces';\r\nimport { SearchSource } from './source';\r\nimport {\r\n  SearchSourceOptions,\r\n  TextSearchOptions,\r\n  ReverseSearchOptions\r\n} from './source.interfaces';\r\nimport {\r\n  StoredQueriesData,\r\n  StoredQueriesResponse,\r\n  StoredQueriesReverseData,\r\n  StoredQueriesReverseResponse,\r\n  StoredQueriesSearchSourceOptions,\r\n  StoredQueriesFields,\r\n  StoredQueriesReverseSearchSourceOptions\r\n} from './storedqueries.interfaces';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\n/**\r\n * StoredQueries search source\r\n */\r\n@Injectable()\r\nexport class StoredQueriesSearchSource\r\n  extends SearchSource\r\n  implements TextSearch\r\n{\r\n  static id = 'storedqueries';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [\r\n    'boundedBy',\r\n    'id',\r\n    'coord_x',\r\n    'coord_y'\r\n  ];\r\n  public resultTitle: 'title';\r\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\r\n  public multipleFieldsQuery: boolean;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\r\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\r\n      return;\r\n    }\r\n\r\n    const defaultStoredqueryId = 'rtss';\r\n    const defaultFieldSplitter: StoredQueriesFields[] = [\r\n      { name: 'rtss', defaultValue: '-99' },\r\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\r\n    ];\r\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\r\n    const defaultSrsname = 'EPSG:4326';\r\n    const defaultResultTitle = 'title';\r\n\r\n    if (!this.storedQueriesOptions) {\r\n      console.log(\r\n        ' No configuration for this search source (storedqueries). You will use the default values'\r\n      );\r\n      this.storedQueriesOptions = {\r\n        storedquery_id: defaultStoredqueryId,\r\n        fields: defaultFieldSplitter,\r\n        outputformat: defaultOutputformat,\r\n        srsname: defaultSrsname,\r\n        resultTitle: defaultResultTitle\r\n      };\r\n      this.resultTitle = defaultResultTitle;\r\n      console.log('Default values', this.storedQueriesOptions);\r\n    }\r\n\r\n    if (!this.storedQueriesOptions.storedquery_id) {\r\n      const err =\r\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\r\n      throw new Error(err);\r\n    }\r\n    if (!this.storedQueriesOptions.fields) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\r\n      );\r\n    }\r\n\r\n    this.storedQueriesOptions.outputformat =\r\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\r\n    this.storedQueriesOptions.srsname =\r\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\r\n\r\n    const storedQueryId =\r\n      this.storedQueriesOptions.storedquery_id.toLowerCase();\r\n    if (\r\n      storedQueryId.includes('getfeaturebyid') &&\r\n      this.storedQueriesOptions.outputformat\r\n        .toLowerCase()\r\n        .includes('getfeaturebyid')\r\n    ) {\r\n      let err =\r\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\r\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\r\n      throw new Error(err);\r\n    }\r\n\r\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\r\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\r\n    }\r\n\r\n    this.multipleFieldsQuery =\r\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\r\n\r\n    this.storedQueriesOptions.fields.forEach((field, index) => {\r\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\r\n        throw new Error(\r\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\r\n        );\r\n      }\r\n      if (!field.defaultValue) {\r\n        throw new Error(\r\n          'Stored Queries :You must set a field default value into your field definition'\r\n        );\r\n      }\r\n    });\r\n\r\n    this.storedQueriesOptions.resultTitle =\r\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\r\n  }\r\n\r\n  getId(): string {\r\n    return StoredQueriesSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return StoredQueriesSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Stored Queries',\r\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\r\n    };\r\n  }\r\n\r\n  // URL CALL EXAMPLES:\r\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\r\n  /* eslint-disable max-len */\r\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\r\n  //  Custom StoredQuery\r\n  /* eslint-disable max-len */\r\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const storedqueriesParams = this.termSplitter(\r\n      term,\r\n      this.storedQueriesOptions.fields\r\n    );\r\n    const params = this.computeRequestParams(\r\n      options || {},\r\n      storedqueriesParams\r\n    );\r\n    this.options.params = this.options.params ? this.options.params : {};\r\n    this.options.params.page = options.page ? String(options.page) : '1';\r\n\r\n    return this.getSearch(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getSearch(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return new RegExp('.*?gml.*?', 'i').test(\r\n      this.storedQueriesOptions.outputformat\r\n    )\r\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' }).pipe(\r\n          map((response) => {\r\n            let resultArray = this.extractResults(\r\n              this.extractWFSData(response),\r\n              term\r\n            );\r\n            resultArray.sort((a, b) =>\r\n              a.meta.score > b.meta.score\r\n                ? 1\r\n                : a.meta.score === b.meta.score\r\n                ? a.meta.titleHtml < b.meta.titleHtml\r\n                  ? 1\r\n                  : -1\r\n                : -1\r\n            );\r\n            resultArray.reverse();\r\n            if (resultArray.length > Number(this.options.params.limit)) {\r\n              const idxEnd =\r\n                Number(this.options.params.limit) *\r\n                Number(this.options.params.page);\r\n              const resultTotLenght = resultArray.length;\r\n              resultArray = resultArray.slice(0, idxEnd);\r\n              if (idxEnd < resultTotLenght) {\r\n                resultArray[resultArray.length - 1].meta.nextPage = true;\r\n              } else {\r\n                resultArray[resultArray.length - 1].meta.nextPage = false;\r\n              }\r\n            }\r\n            return resultArray;\r\n          })\r\n        )\r\n      : this.http.get(this.searchUrl, { params }).pipe(\r\n          map((response) => {\r\n            return this.extractResults(this.extractWFSData(response), term);\r\n          })\r\n        );\r\n  }\r\n\r\n  private getFormatFromOptions() {\r\n    let olFormatCls;\r\n\r\n    const outputFormat = this.storedQueriesOptions.outputformat;\r\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\r\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\r\n\r\n    if (patternGeojson.test(outputFormat)) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    }\r\n    if (patternGml3.test(outputFormat)) {\r\n      olFormatCls = olformat.WFS;\r\n    }\r\n\r\n    return new olFormatCls();\r\n  }\r\n\r\n  private extractWFSData(res) {\r\n    const olFormat = this.getFormatFromOptions();\r\n    const geojson = olformat.GeoJSON;\r\n    const wfsfeatures = olFormat.readFeatures(res);\r\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\r\n    return features;\r\n  }\r\n\r\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\r\n    const splittedTerm = {};\r\n    let remainingTerm = term;\r\n    let cnt = 0;\r\n\r\n    // Used to build the default values\r\n    fields.forEach((field) => {\r\n      splittedTerm[field.name] = field.defaultValue;\r\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\r\n      if (splitterRegex.test(remainingTerm)) {\r\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\r\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\r\n      }\r\n    });\r\n    if (cnt === 0) {\r\n      splittedTerm[fields[0].name] = term;\r\n      return splittedTerm;\r\n    }\r\n    remainingTerm = term;\r\n    const localFields = [...fields].reverse();\r\n    localFields.forEach((field) => {\r\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\r\n      if (remainingTerm || remainingTerm !== '') {\r\n        const values = remainingTerm.split(splitterRegex);\r\n        remainingTerm = values[0];\r\n        if (values[1]) {\r\n          splittedTerm[field.name] = values[1].trim();\r\n        }\r\n      }\r\n    });\r\n    return splittedTerm;\r\n  }\r\n\r\n  private computeRequestParams(\r\n    options: TextSearchOptions,\r\n    queryParams\r\n  ): HttpParams {\r\n    const wfsversion = this.storedQueriesOptions.storedquery_id\r\n      .toLowerCase()\r\n      .includes('getfeaturebyid')\r\n      ? '2.0.0'\r\n      : '1.1.0';\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          service: 'wfs',\r\n          version: wfsversion,\r\n          request: 'GetFeature',\r\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\r\n          srsname: this.storedQueriesOptions.srsname,\r\n          outputformat: this.storedQueriesOptions.outputformat\r\n        },\r\n        queryParams,\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: StoredQueriesResponse,\r\n    term: string\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: StoredQueriesData) => {\r\n      return this.dataToResult(data, term);\r\n    });\r\n  }\r\n\r\n  private dataToResult(\r\n    data: StoredQueriesData,\r\n    term: string\r\n  ): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.id].join('.');\r\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\r\n      ? this.storedQueriesOptions.resultTitle\r\n      : this.resultTitle;\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        // extent: data.bbox,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties[title]\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.title,\r\n        titleHtml: data.properties[title],\r\n        icon: 'map-marker',\r\n        score: data.properties.title\r\n          ? computeTermSimilarity(term.trim(), data.properties.title)\r\n          : computeTermSimilarity(term.trim(), data.properties[title])\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\r\n    const properties = Object.assign(\r\n      {},\r\n      ObjectUtils.removeKeys(\r\n        data.properties,\r\n        StoredQueriesSearchSource.propertiesBlacklist\r\n      ),\r\n      {\r\n        Route:\r\n          '<span class=\"routing\"> <u>' +\r\n          this.languageService.translate.instant('igo.geo.seeRouting') +\r\n          '</u> </span>'\r\n      }\r\n    );\r\n    return properties;\r\n  }\r\n}\r\n\r\n/**\r\n * StoredQueriesReverse search source\r\n */\r\n\r\n// EXAMPLE CALLS\r\n/* eslint-disable max-len */\r\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\r\n//\r\n\r\n@Injectable()\r\nexport class StoredQueriesReverseSearchSource\r\n  extends SearchSource\r\n  implements ReverseSearch\r\n{\r\n  static id = 'storedqueriesreverse';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n  public resultTitle: 'title';\r\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\r\n  public multipleFieldsQuery: boolean;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n    this.storedQueriesOptions =\r\n      options as StoredQueriesReverseSearchSourceOptions;\r\n\r\n    if (\r\n      !this.storedQueriesOptions ||\r\n      (this.storedQueriesOptions && !this.storedQueriesOptions.available)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (!this.storedQueriesOptions.storedquery_id) {\r\n      const err =\r\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\r\n      throw new Error(err);\r\n    }\r\n    if (!this.storedQueriesOptions.longField) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\r\n      );\r\n    }\r\n    if (!this.storedQueriesOptions.latField) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\r\n      );\r\n    }\r\n\r\n    this.storedQueriesOptions.outputformat =\r\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\r\n    this.storedQueriesOptions.srsname =\r\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\r\n    this.storedQueriesOptions.resultTitle =\r\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\r\n  }\r\n\r\n  getId(): string {\r\n    return StoredQueriesReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return StoredQueriesReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Stored Queries (reverse)',\r\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param distance Search raidus around lonLat\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(lonLat, options || {});\r\n    return this.getReverseSearch(params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getReverseSearch(\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const isGml = new RegExp('.*?gml.*?', 'i').test(\r\n      this.storedQueriesOptions.outputformat\r\n    );\r\n    const request$ = isGml\r\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' })\r\n      : this.http.get(this.searchUrl, { params });\r\n    return request$.pipe(\r\n      map((response) => {\r\n        return this.extractResults(this.extractWFSData(response));\r\n      })\r\n    );\r\n  }\r\n\r\n  private getFormatFromOptions() {\r\n    let olFormatCls;\r\n\r\n    const outputFormat = this.storedQueriesOptions.outputformat;\r\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\r\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\r\n\r\n    if (patternGeojson.test(outputFormat)) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    }\r\n    if (patternGml3.test(outputFormat)) {\r\n      olFormatCls = olformat.WFS;\r\n    }\r\n\r\n    return new olFormatCls();\r\n  }\r\n\r\n  private extractWFSData(res) {\r\n    const olFormat = this.getFormatFromOptions();\r\n    const geojson = olformat.GeoJSON;\r\n    const wfsfeatures = olFormat.readFeatures(res);\r\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\r\n    return features;\r\n  }\r\n\r\n  private computeRequestParams(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): HttpParams {\r\n    const longLatParams = {};\r\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\r\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\r\n\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          service: 'WFS',\r\n          version: '1.1.0',\r\n          request: 'GetFeature',\r\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\r\n          srsname: this.storedQueriesOptions.srsname,\r\n          outputformat: this.storedQueriesOptions.outputformat\r\n        },\r\n        longLatParams,\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: StoredQueriesReverseResponse\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: StoredQueriesReverseData) => {\r\n      return this.dataToResult(data);\r\n    });\r\n  }\r\n\r\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.id].join('.');\r\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\r\n      ? this.storedQueriesOptions.resultTitle\r\n      : this.resultTitle;\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties[title]\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties[title],\r\n        icon: 'map-marker'\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: StoredQueriesReverseData): {\r\n    [key: string]: any;\r\n  } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      StoredQueriesReverseSearchSource.propertiesBlacklist\r\n    );\r\n    const routing = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n    return Object.assign(\r\n      properties,\r\n      { type: data.properties.doc_type },\r\n      routing\r\n    );\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  StoredQueriesSearchSource,\n  StoredQueriesReverseSearchSource\n} from './storedqueries';\n\n/**\n * StoredQueries search source factory\n * @ignore\n */\nexport function storedqueriesSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueries search source\n */\nexport function provideStoredQueriesSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n\n/**\n * StoredQueriesReverse search source factory\n * @ignore\n */\n\nexport function storedqueriesReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueriesReverse search source\n */\nexport function provideStoredQueriesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\r\n\r\nimport { Observable, of, BehaviorSubject } from 'rxjs';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { FEATURE, Feature } from '../../../feature';\r\n\r\nimport { SearchResult, TextSearch } from '../search.interfaces';\r\nimport { SearchSource } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { SimpleDocumentSearchResultSetUnit } from 'flexsearch';\r\nimport { GoogleLinks } from '../../../utils/googleLinks';\r\nimport pointOnFeature from '@turf/point-on-feature';\r\nimport { Layer } from '../../../layer/shared/layers/layer';\r\nimport { WorkspaceData } from './workspace.interfaces';\r\n\r\n/**\r\n * Workspace search source\r\n */\r\n@Injectable()\r\nexport class WorkspaceSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'workspace';\r\n  static type = FEATURE;\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe((title) => this.title$.next(title));\r\n  }\r\n\r\n  getId(): string {\r\n    return WorkspaceSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return WorkspaceSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const limit: Number = 5;\r\n\r\n    return {\r\n      title: 'igo.geo.search.workspace.name',\r\n      searchUrl: undefined,\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'datasets',\r\n          name: 'datasets',\r\n          values: []\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            { title: '1', value: 1, enabled: limit === 1 },\r\n            { title: '5', value: 5, enabled: limit === 5 || !limit },\r\n            { title: '10', value: 10, enabled: limit === 10 },\r\n            { title: '25', value: 25, enabled: limit === 25 },\r\n            { title: '50', value: 50, enabled: limit === 50 }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const limitSetting = this.settings.find((s) => s.name === 'limit');\r\n    const limitValue =\r\n      (limitSetting.values.find((v) => v.enabled).value as number) || 5;\r\n    this.options.params.limit = limitValue.toLocaleString();\r\n    const results: WorkspaceData[] = [];\r\n    this.options.params.page = (options.page || 1).toLocaleString();\r\n    const page = options.page || 1;\r\n    const datasets = this.options.params.datasets.split(',');\r\n    this.featureStoresWithIndex\r\n      .filter(\r\n        (fswi) => fswi.searchDocument && datasets.includes(fswi.layer.title)\r\n      )\r\n      .map((fswi) => {\r\n        const termToUse = term;\r\n        fswi.searchDocument\r\n          .search(termToUse, { limit: page * limitValue })\r\n          .map((i) => {\r\n            const foundIn: SimpleDocumentSearchResultSetUnit = i;\r\n            const field = foundIn.field;\r\n            foundIn.result.map((index) => {\r\n              const feature = fswi.index.get(index);\r\n              const score = computeTermSimilarity(\r\n                termToUse.trim(),\r\n                feature.properties[field]\r\n              );\r\n              results.push({ index, feature, layer: fswi.layer, field, score });\r\n            });\r\n          });\r\n      });\r\n\r\n    results.sort((a, b) => (a.score > b.score ? -1 : 1));\r\n    const gettedIndex = [];\r\n    const sortedResultToProcess: WorkspaceData[] = [];\r\n    results.map((r) => {\r\n      if (!gettedIndex.includes(r.index)) {\r\n        gettedIndex.push(r.index);\r\n        sortedResultToProcess.push(r);\r\n      }\r\n    });\r\n\r\n    return of(\r\n      this.extractResults(\r\n        sortedResultToProcess\r\n          .sort((a, b) => (a.score > b.score ? -1 : 1))\r\n          .slice(0, page * limitValue)\r\n      )\r\n    );\r\n  }\r\n\r\n  private extractResults(results: WorkspaceData[]): SearchResult<Feature>[] {\r\n    return results.map((result) => this.dataToResult(result, results.length));\r\n  }\r\n\r\n  private dataToResult(\r\n    data: WorkspaceData,\r\n    resultsCnt: number\r\n  ): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.index].join('.');\r\n    const titleHtml = data.feature.properties[data.field];\r\n    const subtitleHtml2 = '<br><small> ' + data.layer.title + '</small>';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.feature.geometry,\r\n        extent: data.feature.extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.feature.properties[data.field],\r\n          alias: this.getAllowedFieldsAndAlias(data.layer)\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.feature.meta.title,\r\n        titleHtml: titleHtml + subtitleHtml2,\r\n        icon: 'map-marker',\r\n        score: data.score,\r\n        nextPage:\r\n          resultsCnt % +this.options.params.limit === 0 &&\r\n          +this.options.params.page < 10\r\n      }\r\n    } as SearchResult<Feature>;\r\n  }\r\n\r\n  private getAllowedFieldsAndAlias(layer: Layer) {\r\n    let allowedFieldsAndAlias;\r\n    if (\r\n      layer.options?.source?.options?.sourceFields &&\r\n      layer.options.source.options.sourceFields.length >= 1\r\n    ) {\r\n      allowedFieldsAndAlias = {};\r\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\r\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\r\n        allowedFieldsAndAlias[sourceField.name] = alias;\r\n      });\r\n    }\r\n    return allowedFieldsAndAlias;\r\n  }\r\n\r\n  private computeProperties(data: WorkspaceData): { [key: string]: any } {\r\n    if (!data.feature.geometry) {\r\n      return Object.assign(\r\n        { type: data.layer.title + '.' + data.field },\r\n        data.feature.properties\r\n      );\r\n    }\r\n    const googleLinksProperties: {\r\n      GoogleMaps: string;\r\n      GoogleStreetView?: string;\r\n    } = {\r\n      GoogleMaps: ''\r\n    };\r\n    let googleMaps;\r\n    if (data.feature.geometry.type === 'Point') {\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        data.feature.geometry.coordinates[0],\r\n        data.feature.geometry.coordinates[1]\r\n      );\r\n    } else {\r\n      const point = pointOnFeature(data.feature.geometry);\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        point.geometry.coordinates[0],\r\n        point.geometry.coordinates[1]\r\n      );\r\n    }\r\n    googleLinksProperties.GoogleMaps =\r\n      '<a href=' +\r\n      googleMaps +\r\n      ' target=\"_blank\">' +\r\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\r\n      '</a>';\r\n    if (data.feature.geometry.type === 'Point') {\r\n      googleLinksProperties.GoogleStreetView =\r\n        GoogleLinks.getGoogleStreetViewLink(\r\n          data.feature.geometry.coordinates[0],\r\n          data.feature.geometry.coordinates[1]\r\n        );\r\n    }\r\n    const routing: {\r\n      Route: string;\r\n    } = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n    return Object.assign(\r\n      { type: data.feature.sourceId },\r\n      data.feature.properties,\r\n      googleLinksProperties,\r\n      routing\r\n    );\r\n  }\r\n}\r\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\nimport { SearchSource } from './source';\r\nimport { WorkspaceSearchSource } from './workspace';\r\n\r\n/**\r\n * Workspace search source factory\r\n * @ignore\r\n */\r\nexport function workspaceSearchSourceFactory(\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService\r\n) {\r\n  return new WorkspaceSearchSource(\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${WorkspaceSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Workspace search source\r\n */\r\nexport function provideWorkspaceSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: workspaceSearchSourceFactory,\r\n    multi: true,\r\n    deps: [LanguageService, StorageService, ConfigService]\r\n  };\r\n}\r\n","<div class=\"igo-search-selector\">\r\n  <button\r\n    mat-icon-button\r\n    class=\"igo-search-selector-button\"\r\n    color=\"primary\"\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\r\n    [matMenuTriggerFor]=\"searchSelectorMenu\"\r\n  >\r\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\r\n  </button>\r\n\r\n  <mat-menu\r\n    #searchSelectorMenu=\"matMenu\"\r\n    class=\"no-border-radius\"\r\n    xPosition=\"before\"\r\n    yPosition=\"above\"\r\n  >\r\n    <mat-radio-group\r\n      class=\"igo-search-selector-radio-group\"\r\n      [value]=\"searchType$ | async\"\r\n      (change)=\"onSearchTypeChange($event.value)\"\r\n    >\r\n      <mat-radio-button\r\n        *ngFor=\"let searchType of searchTypes\"\r\n        [value]=\"searchType\"\r\n      >\r\n        {{ getSearchTypeTitle(searchType) | translate }}\r\n      </mat-radio-button>\r\n    </mat-radio-group>\r\n  </mat-menu>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { SEARCH_TYPES } from '../shared/search.enums';\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\n\r\n/**\r\n * This component allows a user to select a search type yo enable. In it's\r\n * current version, only one search type can be selected at once (radio). If\r\n * this component were to support more than one search source enabled (checkbox),\r\n * the searchbar component would require a small change to it's\r\n * placeholder getter. The search source service already supports having\r\n * more than one search source enabled.\r\n */\r\n@Component({\r\n  selector: 'igo-search-selector',\r\n  templateUrl: './search-selector.component.html',\r\n  styleUrls: ['./search-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Subscription to the search type\r\n   */\r\n  private searchType$$: Subscription;\r\n\r\n  /**\r\n   * List of available search types\r\n   */\r\n  @Input() searchTypes: string[] = SEARCH_TYPES;\r\n\r\n  /**\r\n   * The search type enabled\r\n   */\r\n  @Input()\r\n  set searchType(value: string) {\r\n    this.setSearchType(value);\r\n  }\r\n  get searchType(): string {\r\n    return this.searchType$.value;\r\n  }\r\n\r\n  /**\r\n   * Event emitted when the enabled search type changes\r\n   */\r\n  @Output() searchTypeChange = new EventEmitter<string>();\r\n\r\n  constructor(private searchSourceService: SearchSourceService) {}\r\n\r\n  ngOnInit() {\r\n    this.searchType$$ = this.searchType$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.searchType$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Enable the selected search type\r\n   * @param searchType Search type\r\n   * @internal\r\n   */\r\n  onSearchTypeChange(searchType: string) {\r\n    this.setSearchType(searchType);\r\n  }\r\n\r\n  /**\r\n   * Get a search type's title. The title\r\n   * for all availables search typers needs to be defined in the locale\r\n   * files or an error will be thrown.\r\n   * @param searchType Search type\r\n   * @internal\r\n   */\r\n  getSearchTypeTitle(searchType: string) {\r\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\r\n  }\r\n\r\n  /**\r\n   * Emit an event and enable the search sources of the given type.\r\n   * @param searchType Search type\r\n   */\r\n  private setSearchType(searchType: string | undefined) {\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  private onSetSearchType(searchType: string) {\r\n    if (searchType === undefined || searchType === null) {\r\n      return;\r\n    }\r\n\r\n    this.searchSourceService.enableSourcesByType(searchType);\r\n    this.searchTypeChange.emit(searchType);\r\n  }\r\n}\r\n","<div class=\"igo-search-settings\">\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\"\n  >\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n  </button>\n  <mat-menu #searchSettingsMenu=\"matMenu\" class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length > 4\">\n      <button mat-raised-button (click)=\"checkUncheckAllSources($event)\">\n        {{\n          !searchSourcesAllEnabled\n            ? ('igo.geo.search.searchSources.unselectAll' | translate)\n            : ('igo.geo.search.searchSources.selectAll' | translate)\n        }}\n      </button>\n    </div>\n    <ng-container *ngFor=\"let source of getSearchSources()\">\n      <span class=\"igo-search-settings-search-source\">\n        <mat-checkbox\n          class=\"igo-search-settings-checkbox\"\n          [checked]=\"source.enabled\"\n          [value]=\"source\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"onCheckSearchSource($event, source)\"\n        >\n        </mat-checkbox>\n        <button\n          *ngIf=\"source.settings.length > 0\"\n          [matMenuTriggerFor]=\"sub_menu\"\n          mat-menu-item\n        >\n          {{ source.title }}\n        </button>\n        <button mat-menu-item *ngIf=\"source.settings.length === 0\">\n          {{ source.title }}\n        </button>\n      </span>\n      <mat-menu #sub_menu=\"matMenu\">\n        <ng-container *ngFor=\"let setting of source.settings\">\n          <button mat-menu-item [matMenuTriggerFor]=\"test_sub_menu\">\n            {{\n              'igo.geo.search.searchSources.settings.' + setting.title\n                | translate\n            }}\n          </button>\n          <mat-menu\n            #test_sub_menu=\"matMenu\"\n            [ngSwitch]=\"setting.type\"\n            yPosition=\"above\"\n          >\n            <span *ngSwitchCase=\"'radiobutton'\">\n              <mat-radio-group\n                class=\"igo-search-settings-radio-group\"\n                [value]=\"setting\"\n              >\n                <mat-radio-button\n                  *ngFor=\"let settingValue of setting.values\"\n                  class=\"mat-typography\"\n                  [value]=\"settingValue\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  [checked]=\"settingValue.enabled\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedRadioButton(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-radio-button>\n              </mat-radio-group>\n            </span>\n            <span *ngSwitchCase=\"'checkbox'\">\n              <div class=\"checkAllButton\" *ngIf=\"setting.values.length > 3\">\n                <button\n                  mat-raised-button\n                  (click)=\"checkUncheckAll($event, source, setting)\"\n                >\n                  {{\n                    setting.allEnabled || setting.allEnabled === undefined\n                      ? ('igo.geo.search.searchSources.settings.unselectAll'\n                        | translate)\n                      : ('igo.geo.search.searchSources.settings.selectAll'\n                        | translate)\n                  }}\n                </button>\n              </div>\n              <div mat-menu-item>\n                <mat-checkbox\n                  *ngFor=\"let settingValue of getAvailableValues(setting)\"\n                  [style.display]=\"displayBlock\"\n                  [checked]=\"settingValue.enabled\"\n                  [value]=\"setting\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedCheckbox(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-checkbox>\n              </div>\n            </span>\n          </mat-menu>\n        </ng-container>\n      </mat-menu>\n    </ng-container>\n    <mat-divider></mat-divider>\n    <span class=\"pointer-summary-slide-toggle-container\">\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changePointerReverseSearch($event)\"\n          tooltip-position=\"below\"\n          *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.pointerSearchSummary.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"pointerSummaryEnabled\"\n        >\n          {{ 'igo.geo.search.pointerSearchSummary.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changeSearchResultsGeometry($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.searchResultsGeometry.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"searchResultsGeometryEnabled\"\n        >\n          {{ 'igo.geo.search.searchResultsGeometry.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"reverseSearchCoordsFormat($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            reverseSearchCoordsFormatEnabled\n              ? ('igo.geo.search.reverseCoordFormat.tooltipLatLon' | translate)\n              : ('igo.geo.search.reverseCoordFormat.tooltipLonLat' | translate)\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"reverseSearchCoordsFormatEnabled\"\n        >\n          {{ 'igo.geo.search.reverseCoordFormat.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n    </span>\n  </mat-menu>\n</div>\n","import { MatCheckboxChange } from '@angular/material/checkbox';\r\nimport { MatRadioChange } from '@angular/material/radio';\r\n\r\nimport {\r\n  Component,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  HostListener,\r\n  Input\r\n} from '@angular/core';\r\n\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\nimport { SearchSource } from '../shared/sources/source';\r\nimport {\r\n  SearchSourceSettings,\r\n  SettingOptions\r\n} from '../shared/sources/source.interfaces';\r\nimport {\r\n  sourceCanReverseSearchAsSummary,\r\n  sourceCanSearch,\r\n  sourceCanReverseSearch\r\n} from '../shared/search.utils';\r\nimport { MediaService, StorageService } from '@igo2/core';\r\n\r\n/**\r\n * This component allows a user to select a search type yo enable. In it's\r\n * current version, only one search type can be selected at once (radio). If\r\n * this component were to support more than one search source enabled (checkbox),\r\n * the searchbar component would require a small change to it's\r\n * placeholder getter. The search source service already supports having\r\n * more than one search source enabled.\r\n */\r\n@Component({\r\n  selector: 'igo-search-settings',\r\n  templateUrl: './search-settings.component.html',\r\n  styleUrls: ['./search-settings.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchSettingsComponent implements OnInit {\r\n  public hasPointerReverseSearchSource: boolean = false;\r\n  public searchSourcesAllEnabled: boolean = false;\r\n\r\n  public buffer = [];\r\n  public lastKeyTime = Date.now();\r\n\r\n  public displayBlock = 'block';\r\n\r\n  get isTouchScreen(): boolean {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  @Input() pointerSummaryEnabled: boolean = false;\r\n  @Input() searchResultsGeometryEnabled: boolean = false;\r\n  @Input() reverseSearchCoordsFormatEnabled: boolean = false;\r\n\r\n  /**\r\n   * Event emitted when the enabled search source changes\r\n   */\r\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\r\n\r\n  /**\r\n   * Event emitted when the pointer summary is activated\r\n   */\r\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the show geometry summary is changed\r\n   */\r\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the coords format is changed\r\n   */\r\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\r\n\r\n  @HostListener('document:keydown', ['$event'])\r\n  handleKeyboardEvent(event: KeyboardEvent) {\r\n    if (event.key === 'F2') {\r\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\r\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private mediaService: MediaService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.hasPointerReverseSearchSource =\r\n      this.hasReverseSearchSourcesForPointerSummary();\r\n  }\r\n\r\n  /**\r\n   * Get all search sources\r\n   * @internal\r\n   */\r\n  getSearchSources(): SearchSource[] {\r\n    const textSearchSources = this.searchSourceService\r\n      .getSources()\r\n      .filter(sourceCanSearch)\r\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\r\n\r\n    const reverseSearchSources = this.searchSourceService\r\n      .getSources()\r\n      .filter(sourceCanReverseSearch)\r\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\r\n    const sources = textSearchSources.concat(reverseSearchSources);\r\n    this.computeSourcesCheckAllBehavior(sources);\r\n    return sources;\r\n  }\r\n\r\n  /**\r\n   * Get all search sources usable for pointer summary\r\n   * @internal\r\n   */\r\n  hasReverseSearchSourcesForPointerSummary(): boolean {\r\n    if (\r\n      this.searchSourceService\r\n        .getEnabledSources()\r\n        .filter(sourceCanReverseSearchAsSummary).length\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Triggered when a setting is checked (checkbox style)\r\n   * @internal\r\n   */\r\n  settingsValueCheckedCheckbox(\r\n    event: MatCheckboxChange,\r\n    source: SearchSource,\r\n    setting: SearchSourceSettings,\r\n    settingValue: SettingOptions\r\n  ) {\r\n    settingValue.enabled = event.checked;\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  /**\r\n   * Defining the action to do for check/uncheck checkboxes (settings)\r\n   * return true if all checkbox must be checked\r\n   * return false if all checkbox must be unchecked\r\n   * @internal\r\n   */\r\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\r\n    if (setting.allEnabled === undefined) {\r\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\r\n        setting.allEnabled = false;\r\n      } else {\r\n        setting.allEnabled = true;\r\n      }\r\n    } else {\r\n      setting.allEnabled = !setting.allEnabled;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Defining the action to do for check/uncheck checkboxes (sources)\r\n   * return true if all checkbox must be checked\r\n   * return false if all checkbox must be unchecked\r\n   * @internal\r\n   */\r\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\r\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\r\n    const disabledSourcesCnt = sources.filter(\r\n      (source) => !source.enabled\r\n    ).length;\r\n    this.searchSourcesAllEnabled =\r\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\r\n  }\r\n\r\n  /**\r\n   * Triggered when the check all / uncheck all type is clicked,\r\n   * @internal\r\n   */\r\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\r\n    event.stopPropagation();\r\n    this.computeSettingCheckAllBehavior(setting);\r\n    setting.values.forEach((settingValue) => {\r\n      settingValue.enabled = setting.allEnabled;\r\n    });\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  /**\r\n   * Triggered when the check all / uncheck all type is clicked,\r\n   * @internal\r\n   */\r\n  checkUncheckAllSources(event) {\r\n    event.stopPropagation();\r\n    this.getSearchSources().map((source) => {\r\n      source.enabled = this.searchSourcesAllEnabled;\r\n      this.searchSourceChange.emit(source);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Triggered when a setting is checked (radiobutton style)\r\n   * @internal\r\n   */\r\n  settingsValueCheckedRadioButton(\r\n    event: MatRadioChange,\r\n    source: SearchSource,\r\n    setting: SearchSourceSettings,\r\n    settingValue: SettingOptions\r\n  ) {\r\n    setting.values.forEach((conf) => {\r\n      if (conf.value !== settingValue.value) {\r\n        conf.enabled = !event.source.checked;\r\n      } else {\r\n        conf.enabled = event.source.checked;\r\n      }\r\n    });\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\r\n    source.enabled = event.checked;\r\n    const storage = (this.storageService.get(source.getId() + '.options') ||\r\n      {}) as SettingOptions;\r\n    storage.enabled = source.enabled;\r\n    this.storageService.set(source.getId() + '.options', storage);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  getAvailableValues(setting: SearchSourceSettings) {\r\n    return setting.values.filter((s) => s.available !== false);\r\n  }\r\n\r\n  getAvailableHashtagsValues(setting: SettingOptions) {\r\n    if (setting.hashtags) {\r\n      return setting.hashtags.map((h) => '#' + h).join(', ');\r\n    }\r\n    return;\r\n  }\r\n\r\n  stopPropagation(event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  changePointerReverseSearch(event) {\r\n    this.pointerSummaryEnabled = event.checked;\r\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\r\n  }\r\n\r\n  changeSearchResultsGeometry(event) {\r\n    this.searchResultsGeometryEnabled = event.checked;\r\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\r\n  }\r\n\r\n  reverseSearchCoordsFormat(event) {\r\n    this.reverseSearchCoordsFormatEnabled = event.checked;\r\n    this.reverseSearchCoordsFormatStatus.emit(\r\n      this.reverseSearchCoordsFormatEnabled\r\n    );\r\n  }\r\n}\r\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{ empty: empty$ | async }\">\r\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\r\n    <mat-label *ngIf=\"label\">{{ label }}</mat-label>\r\n    <input\r\n      #input\r\n      matInput\r\n      autocomplete=\"off\"\r\n      [ngClass]=\"{ hasSearchIcon: showSearchButton }\"\r\n      [disabled]=\"disabled$ | async\"\r\n      [placeholder]=\"\r\n        placeholder\r\n          ? placeholder\r\n          : (placeholder$ | async)\r\n          ? (placeholder$.value | translate)\r\n          : undefined\r\n      \"\r\n      [value]=\"term$ | async\"\r\n      (keyup)=\"onKeyup($event)\"\r\n      (touchend)=\"onKeyup($event)\"\r\n    />\r\n    <button\r\n      *ngIf=\"(empty$ | async) === false\"\r\n      mat-icon-button\r\n      matSuffix\r\n      [color]=\"color\"\r\n      (click)=\"onClearButtonClick()\"\r\n      [matTooltip]=\"'igo.geo.search.clearSearch' | translate\"\r\n    >\r\n      <mat-icon svgIcon=\"close\"></mat-icon>\r\n    </button>\r\n  </mat-form-field>\r\n\r\n  <mat-divider *ngIf=\"withDivider\" [vertical]=\"true\"></mat-divider>\r\n\r\n  <div class=\"search-bar-buttons\">\r\n    <button *ngIf=\"showSearchButton\" mat-icon-button [color]=\"color\">\r\n      <mat-icon svgIcon=\"magnify\"></mat-icon>\r\n    </button>\r\n\r\n    <igo-search-selector\r\n      *ngIf=\"searchSelector\"\r\n      [searchTypes]=\"searchTypes\"\r\n      [searchType]=\"searchType$ | async\"\r\n      (searchTypeChange)=\"onSearchTypeChange($event)\"\r\n    >\r\n    </igo-search-selector>\r\n\r\n    <igo-search-settings\r\n      *ngIf=\"searchSettings\"\r\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\r\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\r\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\r\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\r\n      [reverseSearchCoordsFormatEnabled]=\"reverseSearchCoordsFormatEnabled\"\r\n      (reverseSearchCoordsFormatStatus)=\"\r\n        reverseSearchCoordsFormatStatus.emit($event)\r\n      \"\r\n      (searchSourceChange)=\"onSearchSettingsChange()\"\r\n    >\r\n    </igo-search-settings>\r\n  </div>\r\n</div>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ViewChild,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport {\r\n  FloatLabelType,\r\n  MatFormFieldAppearance\r\n} from '@angular/material/form-field';\r\nimport { BehaviorSubject, Subscription, timer } from 'rxjs';\r\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { EntityStore } from '@igo2/common';\r\n\r\nimport { SEARCH_TYPES } from '../shared/search.enums';\r\nimport { SearchResult, Research } from '../shared/search.interfaces';\r\nimport { SearchService } from '../shared/search.service';\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\n\r\n/**\r\n * Searchbar that triggers a research in all search sources enabled.\r\n * If the store input is defined, the search results will be loaded\r\n * into that store. An event is always emitted when a research is completed.\r\n */\r\n@Component({\r\n  selector: 'igo-search-bar',\r\n  templateUrl: './search-bar.component.html',\r\n  styleUrls: ['./search-bar.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchBarComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Invalid keys\r\n   */\r\n  static invalidKeys = [\r\n    'Control',\r\n    'Shift',\r\n    'Alt',\r\n    'ArrowDown',\r\n    'ArrowUp',\r\n    'ArrowRight',\r\n    'ArrowLeft'\r\n  ];\r\n\r\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'igo.geo.search.placeholder'\r\n  );\r\n\r\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  /**\r\n   * Subscription to the ssearch bar term\r\n   */\r\n  private term$$: Subscription;\r\n\r\n  /**\r\n   * Search term stream\r\n   */\r\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n  /**\r\n   * Subscription to the search term stream\r\n   */\r\n  private stream$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the search type\r\n   */\r\n  private searchType$$: Subscription;\r\n\r\n  private researches$$: Subscription[];\r\n\r\n  /**\r\n   * whether to show search button or not\r\n   */\r\n\r\n  public showSearchButton: boolean = false;\r\n\r\n  /**\r\n   * List of available search types\r\n   */\r\n  @Input() searchTypes: string[] = SEARCH_TYPES;\r\n\r\n  @Input() withDivider: boolean;\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  set searchType(value: string) {\r\n    this.setSearchType(value);\r\n  }\r\n  get searchType(): string {\r\n    return this.searchType$.value;\r\n  }\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Event emitted when the pointer summary is activated by the searchbar setting\r\n   */\r\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the show geometry setting is changed\r\n   */\r\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the coords format setting is changed\r\n   */\r\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  set term(value: string) {\r\n    this.setTerm(value);\r\n  }\r\n  get term(): string {\r\n    return this.term$.value;\r\n  }\r\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n  /**\r\n   * Whether this component is disabled\r\n   */\r\n  @Input()\r\n  set disabled(value: boolean) {\r\n    this.disabled$.next(value);\r\n  }\r\n  get disabled(): boolean {\r\n    return this.disabled$.value;\r\n  }\r\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  @Input() pointerSummaryEnabled: boolean = false;\r\n  @Input() searchResultsGeometryEnabled: boolean = false;\r\n\r\n  /**\r\n   * When reverse coordinates status change\r\n   */\r\n  @Input()\r\n  get reverseSearchCoordsFormatEnabled(): boolean {\r\n    return this._reverseSearchCoordsFormatEnabled;\r\n  }\r\n  set reverseSearchCoordsFormatEnabled(value: boolean) {\r\n    this._reverseSearchCoordsFormatEnabled = value;\r\n    this.setTerm(this.term, true);\r\n  }\r\n  private _reverseSearchCoordsFormatEnabled = false;\r\n\r\n  /**\r\n   * Whether a float label should be displayed\r\n   */\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input() appearance: MatFormFieldAppearance = 'fill';\r\n\r\n  @Input() placeholder: string;\r\n\r\n  @Input() label: string;\r\n\r\n  /**\r\n   * Icons color (search and clear)\r\n   */\r\n  @Input() color = 'primary';\r\n\r\n  @Input() termSplitter: string = '|';\r\n\r\n  /**\r\n   * Debounce time between each keystroke\r\n   */\r\n  @Input() debounce = 200;\r\n\r\n  /**\r\n   * Minimum term length required to trigger a research\r\n   */\r\n  @Input() minLength = 2;\r\n\r\n  /**\r\n   * Search Selector\r\n   */\r\n  @Input() searchSelector = false;\r\n\r\n  /**\r\n   * Search Settings\r\n   */\r\n  @Input() searchSettings = false;\r\n\r\n  /**\r\n   * Force coordinates in north america\r\n   */\r\n  @Input() forceNA = false;\r\n\r\n  /**\r\n   * Search results store\r\n   */\r\n  @Input() store: EntityStore<SearchResult>;\r\n\r\n  /**\r\n   * Event emitted when the search term changes\r\n   */\r\n  @Output() searchTermChange = new EventEmitter<string>();\r\n\r\n  /**\r\n   * Event emitted when a research is completed\r\n   */\r\n  @Output() search = new EventEmitter<{\r\n    research: Research;\r\n    results: SearchResult[];\r\n  }>();\r\n\r\n  /**\r\n   * Event emitted when the search type changes\r\n   */\r\n  @Output() searchTypeChange = new EventEmitter<string>();\r\n\r\n  /**\r\n   * Event emitted when the search type changes\r\n   */\r\n  @Output() clearFeature = new EventEmitter();\r\n\r\n  /**\r\n   * Event emitted when the search settings changes\r\n   */\r\n  @Output() searchSettingsChange = new EventEmitter();\r\n\r\n  /**\r\n   * Input element\r\n   * @internal\r\n   */\r\n  @ViewChild('input', { static: true }) input: ElementRef;\r\n\r\n  /**\r\n   * Whether the search bar is empty\r\n   * @internal\r\n   */\r\n  get empty(): boolean {\r\n    return this.term.length === 0;\r\n  }\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    private searchService: SearchService,\r\n    private searchSourceService: SearchSourceService\r\n  ) {}\r\n\r\n  /**\r\n   * Subscribe to the search term stream and trigger researches\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.term$$ = this.term$.subscribe((term: string) => {\r\n      this.empty$.next(term === undefined || term.length === 0);\r\n    });\r\n\r\n    this.stream$$ = this.stream$\r\n      .pipe(debounce(() => timer(this.debounce)))\r\n      .subscribe((term: string) => this.onSetTerm(term));\r\n\r\n    this.handlePlaceholder();\r\n\r\n    this.searchType$$ = this.searchType$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\r\n\r\n    const configValue = this.configService.getConfig(\r\n      'searchBar.showSearchButton'\r\n    );\r\n    this.showSearchButton = configValue !== undefined ? configValue : false;\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the search term stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.term$$.unsubscribe();\r\n    this.stream$$.unsubscribe();\r\n    this.searchType$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * When a user types, validates the key and send it into the\r\n   * stream if it's valid\r\n   * @param event Keyboard event\r\n   * @internal\r\n   */\r\n  onKeyup(event: KeyboardEvent) {\r\n    const key = event.key;\r\n    if (!this.keyIsValid(key)) {\r\n      return;\r\n    }\r\n    const term = (event.target as HTMLInputElement).value;\r\n    this.setTerm(term);\r\n  }\r\n\r\n  /**\r\n   * Clear the stream and the input\r\n   * @internal\r\n   */\r\n  onClearButtonClick() {\r\n    this.clear();\r\n    this.clearFeature.emit();\r\n  }\r\n\r\n  /**\r\n   * Update search type\r\n   * @param searchType Enabled search type\r\n   * @internal\r\n   */\r\n  onSearchTypeChange(searchType: string) {\r\n    this.setSearchType(searchType);\r\n  }\r\n\r\n  /**\r\n   * Update the placeholder with the enabled search type. The placeholder\r\n   * for all availables search typers needs to be defined in the locale\r\n   * files or an error will be thrown.\r\n   * @param searchType Enabled search type\r\n   * @internal\r\n   */\r\n  setSearchType(searchType: string) {\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  onSearchSettingsChange() {\r\n    this.doSearch(this.term);\r\n    this.searchSettingsChange.emit();\r\n    this.handlePlaceholder();\r\n  }\r\n\r\n  /**\r\n   * Send the term into the stream only if this component is not disabled\r\n   * @param term Search term\r\n   */\r\n  setTerm(term: string, reverseCoordEvent?: boolean) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    term = term || '';\r\n\r\n    if (term !== this.term && !reverseCoordEvent) {\r\n      this.term$.next(term);\r\n    }\r\n\r\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\r\n    if (slug.length >= this.minLength || slug.length === 0) {\r\n      this.stream$.next(term);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the stream and the input\r\n   */\r\n  private clear() {\r\n    this.term$.next('');\r\n    this.stream$.next('');\r\n    this.input.nativeElement.focus();\r\n  }\r\n\r\n  /**\r\n   * Validate if a given key stroke is a valid input\r\n   */\r\n  private keyIsValid(key: string) {\r\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\r\n  }\r\n\r\n  /**\r\n   * When the search term changes, emit an event and trigger a\r\n   * research in every enabled search sources.\r\n   * @param term Search term\r\n   */\r\n  private onSetTerm(term: string | undefined) {\r\n    this.searchTermChange.emit(term);\r\n    this.doSearch(term);\r\n  }\r\n\r\n  private handlePlaceholder() {\r\n    const searchTypes = [\r\n      ...new Set(\r\n        this.searchSourceService\r\n          .getEnabledSources()\r\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\r\n          .map((ss) => ss.getType())\r\n      )\r\n    ];\r\n\r\n    let placeholder = `igo.geo.search.placeholder`;\r\n    if (searchTypes.length === 1) {\r\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\r\n    } else if (searchTypes.length === 0) {\r\n      placeholder = `igo.geo.search.emptyType.placeholder`;\r\n    }\r\n    this.placeholder$.next(placeholder);\r\n  }\r\n\r\n  private onSetSearchType(searchType: string) {\r\n    if (searchType === undefined || searchType === null) {\r\n      return;\r\n    }\r\n\r\n    this.searchTypeChange.emit(searchType);\r\n\r\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\r\n    this.placeholder$.next(placeholder);\r\n\r\n    this.setTerm(this.term);\r\n  }\r\n\r\n  /**\r\n   * Execute the search\r\n   * @param term Search term\r\n   */\r\n  private doSearch(rawTerm: string | undefined) {\r\n    if (this.researches$$) {\r\n      this.researches$$.map((research) => research.unsubscribe());\r\n      this.researches$$ = undefined;\r\n    }\r\n\r\n    let terms;\r\n    if (\r\n      this.termSplitter &&\r\n      rawTerm.match(new RegExp(this.termSplitter, 'g'))\r\n    ) {\r\n      terms = rawTerm\r\n        .split(this.termSplitter)\r\n        .filter((t) => t.length >= this.minLength);\r\n      if (this.store) {\r\n        this.store.clear();\r\n      }\r\n    } else {\r\n      terms = [rawTerm];\r\n    }\r\n\r\n    let researches: Research[] = [];\r\n    terms.map((term: string) => {\r\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\r\n      if (slug === '') {\r\n        if (this.store !== undefined) {\r\n          this.store.clear();\r\n        }\r\n        return;\r\n      }\r\n\r\n      researches = researches.concat(\r\n        this.searchService.search(term, {\r\n          forceNA: this.forceNA\r\n        })\r\n      );\r\n    });\r\n    this.researches$$ = researches.map((research) => {\r\n      return research.request.subscribe((results: SearchResult[]) => {\r\n        this.onResearchCompleted(research, results);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * When a research  is completed, emit an event and update\r\n   * the store's items.\r\n   * @param research Research\r\n   * @param results Research results\r\n   */\r\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\r\n    this.search.emit({ research, results });\r\n\r\n    if (this.store !== undefined) {\r\n      const newResults = this.store\r\n        .all()\r\n        .filter((result) => result.source !== research.source)\r\n        .concat(results);\r\n      this.store.updateMany(newResults);\r\n    }\r\n  }\r\n}\r\n","<mat-list-item\r\n  (mouseenter)=\"onMouseEvent($event)\"\r\n  (mouseleave)=\"onMouseEvent($event)\"\r\n>\r\n  <mat-icon\r\n    *ngIf=\"icon\"\r\n    matListItemIcon\r\n    [svgIcon]=\"showIcons ? icon : 'blank'\"\r\n  ></mat-icon>\r\n\r\n  <div\r\n    matListItemTitle\r\n    *ngIf=\"titleHtml; else normalTitle\"\r\n    [innerHtml]=\"titleHtml\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"tooltipHtml\"\r\n    matTooltipClass=\"search-result-tooltip\"\r\n  ></div>\r\n  <ng-template #normalTitle>\r\n    <span\r\n      matListItemTitle\r\n      *ngIf=\"!titleHtml\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"title\"\r\n      >{{ title }}</span\r\n    >\r\n  </ng-template>\r\n\r\n  <div matListItemMeta>\r\n    <button\r\n      *ngIf=\"withZoomButton\"\r\n      igoStopPropagation\r\n      mat-icon-button\r\n      (click)=\"onZoomHandler()\"\r\n    >\r\n      <mat-icon svgIcon=\"magnify\"></mat-icon>\r\n    </button>\r\n\r\n    <ng-content select=\"[igoSearchItemToolbar]\"> </ng-content>\r\n  </div>\r\n</mat-list-item>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  EventEmitter,\r\n  Output\r\n} from '@angular/core';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\n\r\nimport {\r\n  getEntityTitle,\r\n  getEntityTitleHtml,\r\n  getEntityIcon\r\n} from '@igo2/common';\r\n\r\nimport { SearchResult } from '../shared/search.interfaces';\r\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\n/**\r\n * Search results list item\r\n */\r\n@Component({\r\n  selector: 'igo-search-results-item',\r\n  templateUrl: './search-results-item.component.html',\r\n  styleUrls: ['./search-results-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsItemComponent {\r\n  /**\r\n   * Search result item\r\n   */\r\n  @Input() result: SearchResult;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Search result title\r\n   * @internal\r\n   */\r\n\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean;\r\n\r\n  /**\r\n   * Whether there should be a zoom button\r\n   */\r\n  @Input() withZoomButton = false;\r\n\r\n  @Output() zoomEvent = new EventEmitter<boolean>();\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get title(): string {\r\n    return getEntityTitle(this.result);\r\n  }\r\n\r\n  /**\r\n   * Search result HTML title\r\n   * @internal\r\n   */\r\n  get titleHtml(): string {\r\n    return getEntityTitleHtml(this.result);\r\n  }\r\n\r\n  /**\r\n   * Search result tooltip\r\n   * @internal\r\n   */\r\n  get tooltipHtml(): string {\r\n    return this.titleHtml\r\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\r\n      .replace(/<\\/?[^>]+(>|$)/g, '');\r\n  }\r\n\r\n  /**\r\n   * Search result icon\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.result);\r\n  }\r\n\r\n  onZoomHandler() {\r\n    const olFeature = this.format.readFeature(this.result.data, {\r\n      dataProjection: this.result.data.projection,\r\n      featureProjection: this.map.projection\r\n    });\r\n    moveToOlFeatures(\r\n      this.map.viewController,\r\n      [olFeature],\r\n      FeatureMotion.Default\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    const element = event.target;\r\n    const type = event.type;\r\n    switch (type) {\r\n      case 'mouseenter':\r\n        const hideBtn = element.querySelector('#hide-save-search-result-btn');\r\n        hideBtn\r\n          ? hideBtn.setAttribute('id', 'show-save-search-result-btn')\r\n          : null;\r\n        break;\r\n      case 'mouseleave':\r\n        const showBtn = element.querySelector('#show-save-search-result-btn');\r\n        showBtn\r\n          ? showBtn.setAttribute('id', 'hide-save-search-result-btn')\r\n          : null;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n}\r\n","<h1 mat-dialog-title class=\"mat-typography\">\r\n  {{ 'igo.geo.layer.saveFeatureInLayer' | translate }}\r\n</h1>\r\n\r\n<div mat-dialog-content class=\"mat-typography\">\r\n  <form class=\"igo-form\" [formGroup]=\"form\">\r\n    <igo-list [navigation]=\"false\" [selection]=\"false\">\r\n      <igo-search-results-item\r\n        igoListItem\r\n        color=\"accent\"\r\n        [result]=\"feature\"\r\n        showIcons=\"true\"\r\n      >\r\n      </igo-search-results-item>\r\n    </igo-list>\r\n\r\n    <div class=\"igo-input-container\">\r\n      <mat-form-field>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"{{ 'igo.geo.layer.chooseOrSet' | translate }}\"\r\n          matInput\r\n          [matAutocomplete]=\"auto\"\r\n          formControlName=\"layerName\"\r\n        />\r\n        <mat-autocomplete [displayWith]=\"displayFn\" #auto=\"matAutocomplete\">\r\n          <mat-option\r\n            *ngFor=\"let layer of filteredLayers$ | async\"\r\n            [value]=\"layer\"\r\n          >\r\n            <p matListItemTitle>{{ layer.title }}</p>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n      </mat-form-field>\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<div mat-dialog-actions style=\"justify-content: center\">\r\n  <div class=\"igo-form-button-group create-layer-button-top-padding\">\r\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\r\n      {{ 'igo.geo.layer.cancelBtn' | translate }}\r\n    </button>\r\n    <button\r\n      id=\"createLayerBtnDialog\"\r\n      mat-raised-button\r\n      type=\"button\"\r\n      color=\"primary\"\r\n      (click)=\"save()\"\r\n    >\r\n      {{ 'igo.geo.layer.saveBtn' | translate }}\r\n    </button>\r\n  </div>\r\n</div>\r\n","import { LanguageService } from '@igo2/core';\r\nimport { Component, OnInit, Optional, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { Layer } from '../../layer/shared';\r\nimport { SearchResult } from '../shared';\r\nimport { Observable } from 'rxjs';\r\nimport { map, startWith } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'igo-save-feature-dialog',\r\n  templateUrl: './save-feature-dialog.component.html',\r\n  styleUrls: ['./save-feature-dialog.component.scss']\r\n})\r\nexport class SaveFeatureDialogComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n  feature: SearchResult;\r\n  layers: Layer[] = [];\r\n  filteredLayers$: Observable<Layer[]>;\r\n\r\n  constructor(\r\n    private formBuilder: UntypedFormBuilder,\r\n    public languageService: LanguageService,\r\n    public dialogRef: MatDialogRef<SaveFeatureDialogComponent>,\r\n    @Optional()\r\n    @Inject(MAT_DIALOG_DATA)\r\n    public data: { feature: SearchResult; layers: Layer[] }\r\n  ) {\r\n    this.form = this.formBuilder.group({\r\n      layerName: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.feature = this.data.feature;\r\n    this.layers = this.data.layers;\r\n    this.filteredLayers$ = this.form.controls['layerName'].valueChanges.pipe(\r\n      startWith(''),\r\n      map((val) => this.filter(val))\r\n    );\r\n  }\r\n\r\n  private filter(val): Layer[] {\r\n    if (typeof val !== 'string') {\r\n      return;\r\n    }\r\n    return this.layers\r\n      .map((l) => l)\r\n      .filter(\r\n        (layer) => layer?.title?.toLowerCase().includes(val.toLowerCase())\r\n      );\r\n  }\r\n\r\n  displayFn(layer: Layer): string {\r\n    return layer && layer.title ? layer.title : '';\r\n  }\r\n\r\n  save() {\r\n    const data: { layer: string | Layer; feature: SearchResult } = {\r\n      layer: this.form.value.layerName,\r\n      feature: this.feature\r\n    };\r\n    this.dialogRef.close(data);\r\n  }\r\n\r\n  cancel() {\r\n    this.dialogRef.close();\r\n  }\r\n}\r\n","<button\r\n  igoStopPropagation\r\n  (mouseenter)=\"onMouseEvent($event)\"\r\n  (mouseleave)=\"onMouseEvent($event)\"\r\n  *ngIf=\"layer.meta.dataType === 'Layer'\"\r\n  mat-icon-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"computeTooltip() | translate\"\r\n  [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\r\n  (click)=\"onToggleClick($event)\"\r\n>\r\n  <mat-icon\r\n    aria-hidden=\"false\"\r\n    matBadge=\"icon\"\r\n    [igoMatBadgeIcon]=\"getBadgeIcon()\"\r\n    igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\r\n    igoMatBadgeBackgroundColor=\"none\"\r\n    igoMatBadgeInverseColor=\"true\"\r\n    [matBadgeHidden]=\"\r\n      ((inRange$ | async) && (isVisible$ | async) === true) ||\r\n      ((inRange$ | async) && !added) ||\r\n      ((inRange$ | async) && (isPreview$ | async))\r\n    \"\r\n    [matBadgeDisabled]=\"(inRange$ | async) === false\"\r\n    matBadgeSize=\"small\"\r\n    matBadgePosition=\"after\"\r\n    [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\"\r\n  >\r\n  </mat-icon>\r\n</button>\r\n\r\n<button\r\n  [id]=\"!isMobile ? 'hide-save-search-result-btn' : ''\"\r\n  igoStopPropagation\r\n  *ngIf=\"layer.meta.dataType === 'Feature' && saveSearchResultInLayer\"\r\n  mat-icon-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"addFeatureToLayerTooltip$ | async | translate\"\r\n  (click)=\"addFeatureToLayer()\"\r\n>\r\n  <mat-icon\r\n    aria-hidden=\"false\"\r\n    matBadge=\"icon\"\r\n    igoMatBadgeIcon=\"eye-off\"\r\n    igoMatBadgeInverseColor=\"true\"\r\n    [matBadgeHidden]=\"inRange$ | async\"\r\n    matBadgeDisabled=\"true\"\r\n    matBadgeSize=\"small\"\r\n    matBadgePosition=\"after\"\r\n    svgIcon=\"file-plus-outline\"\r\n  >\r\n  </mat-icon>\r\n</button>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { SearchResult } from '../shared/search.interfaces';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { LAYER } from '../../layer/shared/layer.enums';\r\nimport { Subscription, BehaviorSubject, take } from 'rxjs';\r\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { DataSourceService, FeatureDataSource } from '../../datasource';\r\nimport {\r\n  Feature,\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  tryAddLoadingStrategy,\r\n  tryAddSelectionStrategy,\r\n  tryBindStoreLayer\r\n} from '../../feature';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { getTooltipsOfOlGeometry } from '../../measure';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport Stroke from 'ol/style/Stroke';\r\nimport Fill from 'ol/style/Fill';\r\nimport Style from 'ol/style/Style';\r\nimport Circle from 'ol/style/Circle';\r\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\r\nimport { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { QueryableDataSourceOptions } from '../../query/shared';\r\nimport { Media, MediaService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-search-add-button',\r\n  templateUrl: './search-results-add-button.component.html',\r\n  styleUrls: ['./search-results-add-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\r\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'igo.geo.catalog.layer.addToMap'\r\n  );\r\n\r\n  public addFeatureToLayerTooltip$: BehaviorSubject<string> =\r\n    new BehaviorSubject('igo.geo.search.addToLayer');\r\n\r\n  private resolution$$: Subscription;\r\n  private layers$$: Subscription;\r\n\r\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private layersSubcriptions = [];\r\n\r\n  private lastTimeoutRequest;\r\n\r\n  private mouseInsideAdd: boolean = false;\r\n\r\n  @Input() layer: SearchResult;\r\n\r\n  @Input() store: EntityStore<SearchResult>;\r\n\r\n  /**\r\n   * Whether the layer is already added to the map\r\n   */\r\n  @Input() added: boolean;\r\n\r\n  /**\r\n   * The map to add the search result layer to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * show hide save search result in layer button\r\n   */\r\n  @Input() saveSearchResultInLayer: boolean = false;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  @Input() stores: FeatureStore<Feature>[] = [];\r\n\r\n  get allLayers() {\r\n    return this.map.layers.filter((layer) =>\r\n      String(layer.id).includes('igo-search-layer')\r\n    );\r\n  }\r\n  private mediaService$$: Subscription;\r\n  public isMobile: boolean = false;\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private dialog: MatDialog,\r\n    private dataSourceService: DataSourceService,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    // check the view if is mobile or not\r\n    this.mediaService$$ = this.mediaService.media$.subscribe((media: Media) => {\r\n      if (media === Media.Mobile) {\r\n        this.isMobile = true;\r\n      }\r\n    });\r\n    if (this.layer.meta.dataType === 'Layer') {\r\n      this.added =\r\n        this.map.layers.findIndex(\r\n          (lay) => lay.id === this.layer.data.sourceOptions.id\r\n        ) !== -1;\r\n    }\r\n    this.layers$$ = this.map.layers$.subscribe(() => {\r\n      this.isVisible();\r\n    });\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\r\n      (value) => {\r\n        this.isInResolutionsRange(value);\r\n        this.isVisible();\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n    if (this.mediaService$$) {\r\n      this.mediaService$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    this.onToggleClick(event);\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(currEvent: Event) {\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n    const event = currEvent ? currEvent : ({} as Event);\r\n\r\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'click':\r\n        if (!this.isPreview$.value) {\r\n          if (this.added) {\r\n            this.remove();\r\n          } else {\r\n            this.add(event);\r\n          }\r\n        }\r\n        this.isPreview$.next(false);\r\n        break;\r\n      case 'mouseenter':\r\n        if (!this.isPreview$.value && !this.added) {\r\n          this.lastTimeoutRequest = setTimeout(() => {\r\n            this.add(event);\r\n            this.isPreview$.next(true);\r\n          }, 500);\r\n        }\r\n        this.mouseInsideAdd = true;\r\n        break;\r\n      case 'mouseleave':\r\n        if (this.isPreview$.value) {\r\n          this.remove();\r\n          this.isPreview$.next(false);\r\n        }\r\n        this.mouseInsideAdd = false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  private add(event: Event) {\r\n    if (!this.added) {\r\n      this.added = true;\r\n      this.addLayerToMap(event);\r\n    }\r\n  }\r\n\r\n  private remove() {\r\n    if (this.added) {\r\n      this.added = false;\r\n      this.removeLayerFromMap();\r\n      this.layersSubcriptions.map((s) => s.unsubscribe());\r\n      this.layersSubcriptions = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private addLayerToMap(event?: Event) {\r\n    if (this.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.layer.meta.dataType !== LAYER) {\r\n      return undefined;\r\n    }\r\n\r\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\r\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\r\n      layerOptions.sourceOptions.optionsFromApi = true;\r\n    }\r\n    this.layersSubcriptions.push(\r\n      this.layerService.createAsyncLayer(layerOptions).subscribe((layer) => {\r\n        if (event.type === 'click') {\r\n          this.map.layersAddedByClick$.next([layer]);\r\n        }\r\n        this.map.addLayer(layer);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = false\r\n   */\r\n  private removeLayerFromMap() {\r\n    if (this.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.layer.meta.dataType !== LAYER) {\r\n      return undefined;\r\n    }\r\n\r\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\r\n    this.map.removeLayer(oLayer);\r\n  }\r\n\r\n  isInResolutionsRange(resolution: number) {\r\n    const minResolution = this.layer.data.minResolution || 0;\r\n    const maxResolution = this.layer.data.maxResolution || Infinity;\r\n    this.inRange$.next(\r\n      resolution >= minResolution && resolution <= maxResolution\r\n    );\r\n  }\r\n\r\n  isVisible() {\r\n    if (this.layer?.data?.sourceOptions?.id) {\r\n      const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\r\n      oLayer\r\n        ? this.isVisible$.next(oLayer.visible)\r\n        : this.isVisible$.next(false);\r\n    }\r\n  }\r\n\r\n  getBadgeIcon() {\r\n    if (this.inRange$.value) {\r\n      return this.isVisible$.value ? '' : 'eye-off';\r\n    } else {\r\n      return 'eye-off';\r\n    }\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    if (this.added) {\r\n      if (this.isPreview$.value) {\r\n        return 'igo.geo.catalog.layer.addToMap';\r\n      } else if (this.inRange$.value) {\r\n        return this.isVisible$.value\r\n          ? 'igo.geo.catalog.layer.removeFromMap'\r\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\r\n      } else {\r\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\r\n      }\r\n    } else {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : 'igo.geo.catalog.layer.addToMapOutRange';\r\n    }\r\n  }\r\n\r\n  addFeatureToLayer() {\r\n    if (this.layer.meta.dataType !== 'Feature') {\r\n      return;\r\n    }\r\n\r\n    const selectedFeature = this.layer;\r\n    const dialogRef = this.dialog.open(SaveFeatureDialogComponent, {\r\n      width: '700px',\r\n      data: {\r\n        feature: selectedFeature,\r\n        layers: this.allLayers\r\n      }\r\n    });\r\n\r\n    dialogRef\r\n      .afterClosed()\r\n      .subscribe((data: { layer: string | any; feature: SearchResult }) => {\r\n        if (data) {\r\n          if (this.stores.length > 0) {\r\n            this.stores.map((store) => {\r\n              store.state.updateAll({ selected: false });\r\n              if (store?.layer) {\r\n                store.layer.visible = false;\r\n              }\r\n              return store;\r\n            });\r\n          }\r\n          // check if is new layer\r\n          if (typeof data.layer === 'string') {\r\n            this.createLayer(data.layer, data.feature);\r\n          } else {\r\n            const activeStore = this.stores.find(\r\n              (store) => store.layer.id === data.layer.id\r\n            );\r\n            activeStore.layer.visible = true;\r\n            activeStore.layer.opacity = 1;\r\n            this.addFeature(data.feature, activeStore);\r\n          }\r\n        }\r\n      });\r\n  }\r\n\r\n  createLayer(layerTitle: string, selectedFeature: SearchResult) {\r\n    const activeStore: FeatureStore<Feature> = new FeatureStore<Feature>([], {\r\n      map: this.map\r\n    });\r\n\r\n    const styles = [\r\n      new Style({\r\n        image: new Circle({\r\n          radius: 5,\r\n          stroke: new Stroke({\r\n            width: 1,\r\n            color: 'rgba(143,7,7,1)'\r\n          }),\r\n          fill: new Fill({\r\n            color: 'rgba(143,7,7,1)'\r\n          })\r\n        })\r\n      }),\r\n      new Style({\r\n        stroke: new Stroke({\r\n          width: 1,\r\n          color: 'rgba(143,7,7,1)'\r\n        }),\r\n        fill: new Fill({\r\n          color: 'rgba(0, 0, 255, 0.1)'\r\n        })\r\n      })\r\n    ];\r\n\r\n    // set layer id\r\n    let layerCounterID: number = 0;\r\n    for (const layer of this.allLayers) {\r\n      let numberId = Number(layer.id.replace('igo-search-layer', ''));\r\n      layerCounterID = Math.max(numberId, layerCounterID);\r\n    }\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'vector',\r\n        queryable: true\r\n      } as QueryableDataSourceOptions)\r\n      .pipe(take(1))\r\n      .subscribe((dataSource: FeatureDataSource) => {\r\n        let searchLayer: VectorLayer = new VectorLayer({\r\n          isIgoInternalLayer: true,\r\n          id: 'igo-search-layer' + ++layerCounterID,\r\n          title: layerTitle,\r\n          source: dataSource,\r\n          igoStyle: {\r\n            editable: false,\r\n            igoStyleObject: {\r\n              fill: { color: 'rgba(255,255,255,0.4)' },\r\n              stroke: { color: 'rgba(143,7,7,1)', width: 1 },\r\n              circle: {\r\n                fill: { color: 'rgba(255,255,255,0.4)' },\r\n                stroke: { color: 'rgba(143,7,7,1)', width: 1 },\r\n                radius: 5\r\n              }\r\n            }\r\n          },\r\n          style: styles,\r\n          showInLayerList: true,\r\n          exportable: true,\r\n          workspace: {\r\n            enabled: true\r\n          }\r\n        });\r\n\r\n        tryBindStoreLayer(activeStore, searchLayer);\r\n        tryAddLoadingStrategy(\r\n          activeStore,\r\n          new FeatureStoreLoadingStrategy({\r\n            motion: FeatureMotion.None\r\n          })\r\n        );\r\n\r\n        tryAddSelectionStrategy(\r\n          activeStore,\r\n          new FeatureStoreSelectionStrategy({\r\n            map: this.map,\r\n            motion: FeatureMotion.None,\r\n            many: true\r\n          })\r\n        );\r\n\r\n        activeStore.layer.visible = true;\r\n        activeStore.source.ol.on(\r\n          'removefeature',\r\n          (event: OlVectorSourceEvent<OlGeometry>) => {\r\n            const olGeometry = event.feature.getGeometry();\r\n            this.clearLabelsOfOlGeometry(olGeometry);\r\n          }\r\n        );\r\n\r\n        this.addFeature(selectedFeature, activeStore);\r\n        this.stores.push(activeStore);\r\n      });\r\n  }\r\n\r\n  addFeature(feature: SearchResult, activeStore: FeatureStore<Feature>) {\r\n    const newFeature = {\r\n      type: feature.data.type,\r\n      geometry: {\r\n        coordinates: feature.data.geometry.coordinates,\r\n        type: feature.data.geometry.type\r\n      },\r\n      projection: feature.data.projection,\r\n      properties: feature.data.properties,\r\n      meta: {\r\n        id: feature.meta.id\r\n      }\r\n    };\r\n    delete newFeature.properties.Route;\r\n    activeStore.update(newFeature);\r\n    activeStore.setLayerExtent();\r\n    activeStore.layer.ol.getSource().refresh();\r\n  }\r\n\r\n  private clearLabelsOfOlGeometry(olGeometry) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach(\r\n      (olTooltip: OlOverlay | undefined) => {\r\n        if (olTooltip && olTooltip.getMap()) {\r\n          this.map.ol.removeOverlay(olTooltip);\r\n        }\r\n      }\r\n    );\r\n  }\r\n}\r\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\n@Component({\n  selector: 'igo-collapsible',\n  templateUrl: './collapsible.component.html',\n  styleUrls: ['./collapsible.component.scss']\n})\nexport class CollapsibleComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title = '';\n\n  @Input()\n  get collapsed() {\n    return this._collapsed;\n  }\n  set collapsed(value: boolean) {\n    this._collapsed = value;\n    this.toggle.emit(value);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n}\n","<mat-list-item>\r\n  <mat-icon\r\n    svgIcon=\"chevron-up\"\r\n    class=\"igo-chevron\"\r\n    matListItemIcon\r\n    igoCollapse\r\n    [target]=\"content\"\r\n    [collapsed]=\"collapsed\"\r\n    (toggle)=\"collapsed = $event\"\r\n  >\r\n  </mat-icon>\r\n  <span matListItemTitle>{{ title }}</span>\r\n</mat-list-item>\r\n\r\n<div #content>\r\n  <ng-content></ng-content>\r\n</div>\r\n","<igo-list [navigation]=\"true\" *ngIf=\"tabsMode === false\">\r\n  <ng-template #groupTemplate ngFor let-group [ngForOf]=\"results$ | async\">\r\n    <igo-collapsible\r\n      [class]=\"group.source.getId()\"\r\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\r\n      [title]=\"computeGroupTitle(group)\"\r\n      [collapsed]=\"collapsed[group.source.title]\"\r\n      (toggle)=\"collapsed[group.source.title] = $event\"\r\n    >\r\n      <ng-container\r\n        *ngTemplateOutlet=\"\r\n          storeItemTemplate;\r\n          context: { results: group.results }\r\n        \"\r\n      ></ng-container>\r\n    </igo-collapsible>\r\n\r\n    <ng-template #flatTemplate>\r\n      <ng-container\r\n        *ngTemplateOutlet=\"\r\n          storeItemTemplate;\r\n          context: { results: group.results }\r\n        \"\r\n      ></ng-container>\r\n    </ng-template>\r\n\r\n    <ng-template #storeItemTemplate let-results=\"results\">\r\n      <ng-template ngFor let-result [ngForOf]=\"results\">\r\n        <igo-search-results-item\r\n          igoListItem\r\n          color=\"accent\"\r\n          [map]=\"map\"\r\n          [result]=\"result\"\r\n          [showIcons]=\"showIcons\"\r\n          [withZoomButton]=\"withZoomButton\"\r\n          [focused]=\"store.state.get(result).focused\"\r\n          [selected]=\"store.state.get(result).selected\"\r\n          (focus)=\"resultFocus.emit(result)\"\r\n          (unfocus)=\"resultUnfocus.emit(result)\"\r\n          (select)=\"onResultSelect(result)\"\r\n          (mouseenter)=\"resultFocus.emit(result)\"\r\n          (mouseleave)=\"resultUnfocus.emit(result)\"\r\n        >\r\n          <ng-container\r\n            igoSearchItemToolbar\r\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\r\n            [ngTemplateOutletContext]=\"{ result: result }\"\r\n          >\r\n          </ng-container>\r\n        </igo-search-results-item>\r\n      </ng-template>\r\n      <span\r\n        class=\"moreResults mat-typography\"\r\n        *ngIf=\"isMoreResults(group)\"\r\n        (click)=\"displayMoreResults(group)\"\r\n      >\r\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\r\n      </span>\r\n    </ng-template>\r\n  </ng-template>\r\n</igo-list>\r\n\r\n<igo-list [navigation]=\"true\" *ngIf=\"tabsMode\">\r\n  <ng-container\r\n    *ngIf=\"\r\n      mode === searchResultMode.Grouped;\r\n      then tabsTemplate;\r\n      else flatTemplate\r\n    \"\r\n  ></ng-container>\r\n\r\n  <ng-template #tabsTemplate>\r\n    <mat-tab-group class=\"custom-tabs-view\" dynamicHeight>\r\n      <mat-tab\r\n        *ngFor=\"let group of results$ | async\"\r\n        [label]=\"computeGroupTitle(group)\"\r\n      >\r\n        <ng-container\r\n          *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\r\n        ></ng-container>\r\n      </mat-tab>\r\n    </mat-tab-group>\r\n  </ng-template>\r\n\r\n  <ng-template #flatTemplate>\r\n    <ng-template ngFor let-group [ngForOf]=\"results$ | async\">\r\n      <ng-container\r\n        *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\r\n      ></ng-container>\r\n    </ng-template>\r\n  </ng-template>\r\n\r\n  <ng-template #storeItemTemplate let-group=\"group\">\r\n    <ng-template ngFor let-result [ngForOf]=\"group.results\">\r\n      <igo-search-results-item\r\n        igoListItem\r\n        color=\"accent\"\r\n        [map]=\"map\"\r\n        [result]=\"result\"\r\n        [showIcons]=\"showIcons\"\r\n        [withZoomButton]=\"withZoomButton\"\r\n        [focused]=\"store.state.get(result).focused\"\r\n        [selected]=\"store.state.get(result).selected\"\r\n        (focus)=\"resultFocus.emit(result)\"\r\n        (unfocus)=\"resultUnfocus.emit(result)\"\r\n        (select)=\"onResultSelect(result)\"\r\n        (mouseenter)=\"resultFocus.emit(result)\"\r\n        (mouseleave)=\"resultUnfocus.emit(result)\"\r\n      >\r\n        <ng-container\r\n          igoSearchItemToolbar\r\n          [ngTemplateOutlet]=\"templateSearchToolbar\"\r\n          [ngTemplateOutletContext]=\"{ result: result }\"\r\n        >\r\n        </ng-container>\r\n      </igo-search-results-item>\r\n    </ng-template>\r\n    <span\r\n      class=\"moreResults mat-typography\"\r\n      *ngIf=\"isMoreResults(group)\"\r\n      (click)=\"displayMoreResults(group)\"\r\n    >\r\n      <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\r\n    </span>\r\n  </ng-template>\r\n</igo-list>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ContentChild,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport type { TemplateRef } from '@angular/core';\r\n\r\nimport { Observable, EMPTY, timer, BehaviorSubject, Subscription } from 'rxjs';\r\nimport { debounce, map } from 'rxjs/operators';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport {\r\n  EntityState,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreWatcher,\r\n  EntityStoreWithStrategy\r\n} from '@igo2/common';\r\n\r\nimport { IgoMap } from '../../map/shared';\r\n\r\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\r\nimport { SearchService } from '../shared/search.service';\r\nimport { SearchResult, Research } from '../shared/search.interfaces';\r\nimport { SearchSource } from '../shared/sources/source';\r\n\r\nexport enum SearchResultMode {\r\n  Grouped = 'grouped',\r\n  Flat = 'flat'\r\n}\r\n\r\n/**\r\n * List of search results with focus and selection capabilities.\r\n * This component is dumb and only emits events.\r\n */\r\n@Component({\r\n  selector: 'igo-search-results',\r\n  templateUrl: './search-results.component.html',\r\n  styleUrls: ['./search-results.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsComponent implements OnInit, OnDestroy {\r\n  private showResultsCount: boolean = true;\r\n\r\n  /**\r\n   * Reference to the SearchResultMode enum\r\n   * @internal\r\n   */\r\n  public searchResultMode = SearchResultMode;\r\n\r\n  /**\r\n   * Search results store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<SearchResult>;\r\n\r\n  private settingsChange$$: Subscription;\r\n\r\n  public pageIterator: { sourceId: string }[] = [];\r\n\r\n  public collapsed: { sourceId: string }[] = [];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Search results store\r\n   */\r\n  @Input() store: EntityStoreWithStrategy<SearchResult>;\r\n\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean;\r\n\r\n  /**\r\n   * Search results display mode\r\n   */\r\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\r\n\r\n  /**\r\n   * Whether there should be a zoom button\r\n   */\r\n  @Input() withZoomButton = false;\r\n\r\n  /**\r\n   * To check if the view for tabsMode for search-result-tools\r\n   */\r\n  @Input() tabsMode: boolean = false;\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  get term(): string {\r\n    return this._term;\r\n  }\r\n  set term(value: string) {\r\n    this._term = value;\r\n    this.pageIterator = [];\r\n  }\r\n  public _term: string;\r\n\r\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  @Input() termSplitter: string = '|';\r\n\r\n  /**\r\n   * Event emitted when a result is focused\r\n   */\r\n  @Output() resultFocus = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a result is unfocused\r\n   */\r\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a result is selected\r\n   */\r\n  @Output() resultSelect = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a research is completed after displaying more results is clicked\r\n   */\r\n  @Output() moreResults = new EventEmitter<{\r\n    research: Research;\r\n    results: SearchResult[];\r\n  }>();\r\n\r\n  /**\r\n   * Events emitted when a result is focus or unfocus by mouse event\r\n   */\r\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\r\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\r\n\r\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {})\r\n  templateSearchToolbar: TemplateRef<any>;\r\n\r\n  get results$(): Observable<\r\n    { source: SearchSource; results: SearchResult[] }[]\r\n  > {\r\n    if (this._results$ === undefined) {\r\n      this._results$ = this.liftResults();\r\n    }\r\n    return this._results$;\r\n  }\r\n  private _results$: Observable<\r\n    { source: SearchSource; results: SearchResult[] }[]\r\n  >;\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private searchService: SearchService,\r\n    private configService: ConfigService\r\n  ) {}\r\n\r\n  /**\r\n   * Bind the search results store to the watcher\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n\r\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\r\n      this.pageIterator = [];\r\n    });\r\n\r\n    if (\r\n      this.configService.getConfig('searchSources.showResultsCount') === false\r\n    ) {\r\n      this.showResultsCount = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind the search results store from the watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n    this.settingsChange$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Compute a group title\r\n   * @param group Search results group\r\n   * @returns Group title\r\n   * @internal\r\n   */\r\n  computeGroupTitle(group: {\r\n    source: SearchSource;\r\n    results: SearchResult[];\r\n  }): string {\r\n    const parts = [group.source.title];\r\n    const count = group.results.length;\r\n    if (count > 1 && this.showResultsCount) {\r\n      parts.push(`(${count})`);\r\n    }\r\n    return parts.join(' ');\r\n  }\r\n\r\n  /**\r\n   * When a result is selected, update it's state in the store and emit\r\n   * an event. A selected result is also considered focused\r\n   * @param result Search result\r\n   * @internal\r\n   */\r\n  onResultSelect(result: SearchResult) {\r\n    if (this.store.state.get(result)) {\r\n      if (this.store.state.get(result).selected === true) {\r\n        return;\r\n      }\r\n    }\r\n    this.store.state.update(result, { focused: true, selected: true }, true);\r\n    this.resultSelect.emit(result);\r\n  }\r\n\r\n  /**\r\n   * Return an observable of the search results, grouped by search source\r\n   * @returns Observable of grouped search results\r\n   * @internal\r\n   */\r\n  private liftResults(): Observable<\r\n    { source: SearchSource; results: SearchResult[] }[]\r\n  > {\r\n    return this.store.stateView.all$().pipe(\r\n      debounce((results: { entity: SearchResult; state: EntityState }[]) => {\r\n        return results.length === 0 ? EMPTY : timer(200);\r\n      }),\r\n      map((results: { entity: SearchResult; state: EntityState }[]) => {\r\n        return this.groupResults(\r\n          results.map((r) => r.entity).sort(this.sortByOrder)\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Sort the results by display order.\r\n   * @param r1 First result\r\n   * @param r2 Second result\r\n   */\r\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\r\n    return r1.source.displayOrder - r2.source.displayOrder;\r\n  }\r\n\r\n  /**\r\n   * Group results by search source\r\n   * @param results Search results from all sources\r\n   * @returns Search results grouped by source\r\n   */\r\n  private groupResults(\r\n    results: SearchResult[]\r\n  ): { source: SearchSource; results: SearchResult[] }[] {\r\n    const grouped = new Map<SearchSource, SearchResult[]>();\r\n    results.forEach((result: SearchResult) => {\r\n      const source = result.source;\r\n      let sourceResults = grouped.get(source);\r\n      if (sourceResults === undefined) {\r\n        sourceResults = [];\r\n        grouped.set(source, sourceResults);\r\n      }\r\n      sourceResults.push(result);\r\n    });\r\n\r\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\r\n      if (this.pageIterator[source.getId()] === undefined) {\r\n        this.pageIterator[source.getId()] = 1;\r\n      }\r\n      return { source, results: grouped.get(source) };\r\n    });\r\n  }\r\n\r\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\r\n    const stategy = this.store.getStrategyOfType(\r\n      EntityStoreFilterCustomFuncStrategy\r\n    );\r\n    const active = stategy?.active || false;\r\n    if (!active) {\r\n      return (\r\n        group.results &&\r\n        group.results[group.results.length - 1].meta.nextPage === true\r\n      );\r\n    } else {\r\n      return (\r\n        group.results?.length % +group.source.params.limit === 0 &&\r\n        +group.source.params.page < 30\r\n      );\r\n    }\r\n  }\r\n\r\n  displayMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\r\n    const options: TextSearchOptions = {\r\n      sourceId: group.source.getId(),\r\n      page: ++this.pageIterator[group.source.getId()]\r\n    };\r\n\r\n    let terms;\r\n    if (\r\n      this.termSplitter &&\r\n      this.term.match(new RegExp(this.termSplitter, 'g'))\r\n    ) {\r\n      terms = this.term.split(this.termSplitter);\r\n    } else {\r\n      terms = [this.term];\r\n    }\r\n\r\n    let researches: Research[] = [];\r\n    terms.map((term: string) => {\r\n      researches = researches.concat(this.searchService.search(term, options));\r\n    });\r\n\r\n    researches.map((research) => {\r\n      research.request.subscribe((results: SearchResult[]) => {\r\n        const newResults = group.results.concat(results);\r\n        if (!results.length) {\r\n          newResults[newResults.length - 1].meta.nextPage = false;\r\n        }\r\n        this.moreResults.emit({ research, results: newResults });\r\n      });\r\n    });\r\n    return;\r\n  }\r\n}\r\n","import { Workspace, WorkspaceOptions } from '@igo2/common';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\r\n  layer: VectorLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class WfsWorkspace extends Workspace {\r\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    true\r\n  );\r\n\r\n  get layer(): VectorLayer {\r\n    return this.options.layer;\r\n  }\r\n\r\n  get map(): IgoMap {\r\n    return this.options.map;\r\n  }\r\n\r\n  constructor(protected options: WfsWorkspaceOptions) {\r\n    super(options);\r\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\r\n      if (\r\n        mapResolution > this.layer.minResolution &&\r\n        mapResolution < this.layer.maxResolution\r\n      ) {\r\n        this.inResolutionRange$.next(true);\r\n      } else {\r\n        this.inResolutionRange$.next(false);\r\n      }\r\n    });\r\n  }\r\n\r\n  public getLayerWksOptionTabQuery(): boolean {\r\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\r\n      return this.layer.options.workspace.queryOptions.tabQuery;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getLayerWksOptionMapQuery(): boolean {\r\n    if (\r\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\r\n    ) {\r\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private getInResolutionRange(): boolean {\r\n    return this.inResolutionRange$.value;\r\n  }\r\n}\r\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olStyle from 'ol/style';\r\nimport olFeature from 'ol/Feature';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\n\r\nimport { Feature } from '../../../feature/shared/feature.interfaces';\r\nimport { FeatureCommonVectorStyleOptions } from './vector-style.interface';\r\n\r\nimport { createOverlayDefaultStyle } from '../overlay/overlay-style.utils';\r\nimport { createOverlayMarkerStyle } from '../overlay/overlay-marker-style.utils';\r\n\r\n/**\r\n * Generate a style for selected features\r\n * @param feature The feature to generate the style\r\n * @returns A olStyle\r\n */\r\nexport function getCommonVectorSelectedStyle({\r\n  feature,\r\n  markerColor = [0, 161, 222],\r\n  markerOpacity = 1,\r\n  markerOutlineColor = [0, 255, 255],\r\n  fillColor,\r\n  fillOpacity = 0.15,\r\n  strokeColor = [0, 255, 255],\r\n  strokeOpacity = 0.5,\r\n  strokeWidth = 4\r\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\r\n  return getCommonVectorStyle({\r\n    feature,\r\n    markerColor,\r\n    markerOpacity,\r\n    markerOutlineColor,\r\n    fillColor,\r\n    fillOpacity,\r\n    strokeColor,\r\n    strokeOpacity,\r\n    strokeWidth\r\n  });\r\n}\r\n\r\n/**\r\n * Generate a basic style for features\r\n * @param feature The feature to generate the style\r\n * @returns A olStyle\r\n */\r\nexport function getCommonVectorStyle({\r\n  feature,\r\n  markerColor = [0, 161, 222],\r\n  markerOpacity = 0.5,\r\n  markerOutlineColor,\r\n  fillColor = [0, 161, 222],\r\n  fillOpacity = 0.15,\r\n  strokeColor = [0, 161, 222],\r\n  strokeOpacity = 0.5,\r\n  strokeWidth = 2\r\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\r\n  const isOlFeature = feature instanceof olFeature;\r\n  let geometry;\r\n  let text;\r\n  if (isOlFeature) {\r\n    feature = feature as olFeature<OlGeometry>;\r\n    geometry = feature.getGeometry();\r\n  } else {\r\n    feature = feature as Feature;\r\n    geometry = feature.geometry;\r\n    text = feature.meta.mapTitle;\r\n  }\r\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\r\n\r\n  if (!geometry || geometryType === 'Point') {\r\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\r\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\r\n\r\n    if (\r\n      markerColorAsArray.length === 4 &&\r\n      (typeof markerColor !== 'string' ||\r\n        /^#[0-9A-F]{8}$/i.test(markerColor as string))\r\n    ) {\r\n      markerOpacity = markerColorAsArray[3];\r\n    }\r\n\r\n    return createOverlayMarkerStyle({\r\n      text,\r\n      opacity: markerOpacity,\r\n      markerOutlineColor,\r\n      markerColor: markerColorRGB\r\n    });\r\n  } else {\r\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\r\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\r\n\r\n    if (\r\n      !(\r\n        fillWithOpacity.length === 4 &&\r\n        (typeof fillColor !== 'string' ||\r\n          /^#[0-9A-F]{8}$/i.test(fillColor as string))\r\n      )\r\n    ) {\r\n      fillWithOpacity[3] = fillOpacity;\r\n    }\r\n\r\n    if (\r\n      !(\r\n        strokeWithOpacity.length === 4 &&\r\n        (typeof strokeColor !== 'string' ||\r\n          /^#[0-9A-F]{8}$/i.test(strokeColor as string))\r\n      )\r\n    ) {\r\n      strokeWithOpacity[3] = strokeOpacity;\r\n    }\r\n\r\n    return createOverlayDefaultStyle({\r\n      text,\r\n      strokeWidth,\r\n      strokeColor: strokeWithOpacity,\r\n      fillColor: fillWithOpacity\r\n    });\r\n  }\r\n}\r\n","import { WfsWorkspace } from './wfs-workspace';\r\nimport { FeatureWorkspace } from './feature-workspace';\r\nimport { Observable } from 'rxjs';\r\nimport {\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityRecord,\r\n  EntityTableColumnRenderer,\r\n  EntityTableButton,\r\n  EntityStoreStrategyFuncOptions,\r\n  EntityTableTemplate,\r\n  Workspace\r\n} from '@igo2/common';\r\nimport { map, skipWhile, take } from 'rxjs/operators';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { StorageScope } from '@igo2/core';\r\nimport { EntityTableColumn } from '@igo2/common';\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { generateIdFromSourceOptions } from '../../utils/id-generator';\r\nimport { LayerService, VectorLayer } from '../../layer';\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport {\r\n  RelationOptions,\r\n  SourceFieldsOptionsParams\r\n} from '../../datasource/shared/datasources/datasource.interface';\r\n\r\nexport function getRowsInMapExtent(layerId, storageService): boolean {\r\n  return (\r\n    (storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean) ||\r\n    true\r\n  );\r\n}\r\n\r\nexport function setRowsInMapExtent(value, layerId, storageService) {\r\n  storageService.set(\r\n    `workspace.rowsInMapExtent.${layerId}`,\r\n    value,\r\n    StorageScope.SESSION\r\n  );\r\n}\r\n\r\nexport function getSelectedOnly(layerId, storageService): boolean {\r\n  return (\r\n    (storageService.get(`workspace.selectedOnly.${layerId}`) as boolean) ||\r\n    false\r\n  );\r\n}\r\n\r\nexport function setSelectedOnly(value, layerId, storageService) {\r\n  storageService.set(\r\n    `workspace.selectedOnly.${layerId}`,\r\n    value,\r\n    StorageScope.SESSION\r\n  );\r\n}\r\n\r\nexport function mapExtentStrategyActiveToolTip(\r\n  ws: Workspace\r\n): Observable<string> {\r\n  return ws.entityStore\r\n    .getStrategyOfType(EntityStoreFilterCustomFuncStrategy)\r\n    .active$.pipe(\r\n      map((active: boolean) =>\r\n        active\r\n          ? 'igo.geo.workspace.inMapExtent.active.tooltip'\r\n          : 'igo.geo.workspace.inMapExtent.inactive.tooltip'\r\n      )\r\n    );\r\n}\r\n\r\nexport function noElementSelected(ws: Workspace): Observable<boolean> {\r\n  return ws.entityStore.stateView\r\n    .manyBy$((record: EntityRecord<Feature>) => {\r\n      return record.state.selected === true;\r\n    })\r\n    .pipe(map((entities: EntityRecord<Feature>[]) => entities.length >= 1));\r\n}\r\n\r\nexport function addOrRemoveLayer(\r\n  action: 'add' | 'remove',\r\n  map: IgoMap,\r\n  url: string,\r\n  type: string,\r\n  layerName: string,\r\n  layerService: LayerService\r\n) {\r\n  const so = ObjectUtils.removeUndefined({\r\n    sourceOptions: {\r\n      type: type,\r\n      url,\r\n      optionsFromCapabilities: true,\r\n      optionsFromApi: true,\r\n      params: {\r\n        LAYERS: type === 'wms' ? layerName : undefined,\r\n        LAYER: type === 'wms' ? undefined : layerName\r\n      }\r\n    }\r\n  });\r\n  if (action === 'add') {\r\n    layerService.createAsyncLayer(so).subscribe((layer) => {\r\n      map.layersAddedByClick$.next([layer]);\r\n      map.addLayer(layer);\r\n    });\r\n  } else if (action === 'remove') {\r\n    const addedLayerId = generateIdFromSourceOptions(so.sourceOptions);\r\n    map.removeLayer(map.layers.find((l) => l.id === addedLayerId));\r\n  }\r\n}\r\n\r\nexport function getGeoServiceAction(\r\n  workspace: FeatureWorkspace | WfsWorkspace,\r\n  layerService: LayerService\r\n) {\r\n  const geoServiceAction = [\r\n    {\r\n      name: 'geoServiceAction',\r\n      title: undefined,\r\n      tooltip: '',\r\n      renderer: EntityTableColumnRenderer.ButtonGroup,\r\n      valueAccessor: (entity: Feature, record: EntityRecord<Feature>) => {\r\n        let geoServiceProperties = record.state.geoService;\r\n        if (\r\n          geoServiceProperties &&\r\n          geoServiceProperties.haveGeoServiceProperties &&\r\n          geoServiceProperties.url &&\r\n          geoServiceProperties.layerName\r\n        ) {\r\n          if (geoServiceProperties.added) {\r\n            return [\r\n              {\r\n                icon: 'delete',\r\n                color: 'warn',\r\n                click: (row, record) => {\r\n                  addOrRemoveLayer(\r\n                    'remove',\r\n                    workspace.map,\r\n                    record.state.geoService.url,\r\n                    record.state.geoService.type,\r\n                    record.state.geoService.layerName,\r\n                    layerService\r\n                  );\r\n                  geoServiceProperties.added = false;\r\n                }\r\n              }\r\n            ] as EntityTableButton[];\r\n          } else {\r\n            return [\r\n              {\r\n                icon: 'plus',\r\n                color: 'primary',\r\n                click: (row, record) => {\r\n                  addOrRemoveLayer(\r\n                    'add',\r\n                    workspace.map,\r\n                    record.state.geoService.url,\r\n                    record.state.geoService.type,\r\n                    record.state.geoService.layerName,\r\n                    layerService\r\n                  );\r\n                  geoServiceProperties.added = true;\r\n                }\r\n              }\r\n            ] as EntityTableButton[];\r\n          }\r\n        } else {\r\n          return [];\r\n        }\r\n      }\r\n    }\r\n  ];\r\n  return geoServiceAction;\r\n}\r\n\r\nexport function createTableTemplate(\r\n  workspace: FeatureWorkspace | WfsWorkspace,\r\n  layer: VectorLayer,\r\n  layerService: LayerService,\r\n  ws$\r\n) {\r\n  const geoServiceAction = getGeoServiceAction(workspace, layerService);\r\n  const fields = layer.dataSource.options.sourceFields || [];\r\n\r\n  const relations = layer.dataSource.options.relations || [];\r\n\r\n  if (fields.length === 0) {\r\n    workspace.entityStore.entities$\r\n      .pipe(\r\n        skipWhile((val) => val.length === 0),\r\n        take(1)\r\n      )\r\n      .subscribe((entities) => {\r\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\r\n        const columnsFromFeatures = ol\r\n          .getKeys()\r\n          .filter(\r\n            (col) =>\r\n              !col.startsWith('_') &&\r\n              col !== 'geometry' &&\r\n              col !== ol.getGeometryName() &&\r\n              !col.match(/boundedby/gi)\r\n          )\r\n          .map((key) => {\r\n            return {\r\n              name: `properties.${key}`,\r\n              title: key,\r\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n            };\r\n          });\r\n        columnsFromFeatures.unshift(...geoServiceAction);\r\n        workspace.meta.tableTemplate = {\r\n          selection: true,\r\n          sort: true,\r\n          columns: columnsFromFeatures,\r\n          tableHeight: '100%'\r\n        } as EntityTableTemplate;\r\n      });\r\n    return;\r\n  }\r\n  const columns = fields.map((field: SourceFieldsOptionsParams) => {\r\n    return {\r\n      name: `properties.${field.name}`,\r\n      title: field.alias ? field.alias : field.name,\r\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML,\r\n      tooltip: field.tooltip,\r\n      cellClassFunc: () => {\r\n        const cellClass = {};\r\n        if (field.type) {\r\n          cellClass[`class_${field.type}`] = true;\r\n          return cellClass;\r\n        }\r\n      }\r\n    } as EntityTableColumn;\r\n  });\r\n\r\n  const relationsColumn = relations.map((relation: RelationOptions) => {\r\n    return {\r\n      name: `properties.${relation.name}`,\r\n      title: relation.alias ? relation.alias : relation.name,\r\n      renderer: EntityTableColumnRenderer.Icon,\r\n      icon: relation.icon,\r\n      parent: relation.parent,\r\n      type: 'relation',\r\n      tooltip: relation.tooltip,\r\n      onClick: () => {\r\n        ws$.next(relation.title);\r\n      },\r\n      cellClassFunc: () => {\r\n        return { class_icon: true };\r\n      }\r\n    };\r\n  });\r\n\r\n  columns.push(...relationsColumn);\r\n  columns.unshift(...geoServiceAction);\r\n  workspace.meta.tableTemplate = {\r\n    selection: true,\r\n    sort: true,\r\n    columns,\r\n    tableHeight: '100%'\r\n  };\r\n}\r\n\r\nexport function createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\r\n  const filterClauseFunc = (record: EntityRecord<object>) => {\r\n    return (\r\n      record.state.inMapExtent === true && record.state.inMapResolution === true\r\n    );\r\n  };\r\n  return new EntityStoreFilterCustomFuncStrategy({\r\n    filterClauseFunc\r\n  } as EntityStoreStrategyFuncOptions);\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { ActionStore, EntityStoreFilterSelectionStrategy } from '@igo2/common';\r\n\r\nimport {\r\n  FeatureStore,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  FeatureStoreInMapExtentStrategy,\r\n  FeatureMotion,\r\n  FeatureStoreInMapResolutionStrategy,\r\n  GeoPropertiesStrategy\r\n} from '../../feature';\r\nimport { LayerService, VectorLayer } from '../../layer/shared';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { CapabilitiesService, FeatureDataSource } from '../../datasource';\r\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\r\n\r\nimport { WfsWorkspace } from './wfs-workspace';\r\nimport { StorageService, ConfigService } from '@igo2/core';\r\nimport {\r\n  createFilterInMapExtentOrResolutionStrategy,\r\n  createTableTemplate\r\n} from './workspace.utils';\r\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector';\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WfsWorkspaceService {\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  public ws$ = new BehaviorSubject<string>(undefined);\r\n\r\n  constructor(\r\n    private storageService: StorageService,\r\n    private configService: ConfigService,\r\n    private layerService: LayerService,\r\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {}\r\n\r\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\r\n    if (\r\n      layer.options.workspace?.enabled === false ||\r\n      layer.dataSource.options.edition\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\r\n      srcId: layer.id,\r\n      workspaceId: layer.id,\r\n      enabled: true\r\n    } as GeoWorkspaceOptions);\r\n\r\n    const wks = new WfsWorkspace({\r\n      id: layer.id,\r\n      title: layer.title,\r\n      layer,\r\n      map,\r\n      entityStore: this.createFeatureStore(layer, map),\r\n      actionStore: new ActionStore([]),\r\n      meta: {\r\n        tableTemplate: undefined\r\n      }\r\n    });\r\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\r\n    return wks;\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], { map });\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\r\n      { map },\r\n      this.propertyTypeDetectorService,\r\n      this.capabilitiesService\r\n    );\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const confQueryOverlayStyle =\r\n      this.configService.getConfig('queryOverlayStyle');\r\n\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: (feature) => {\r\n          return getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature },\r\n              confQueryOverlayStyle?.selection || {}\r\n            )\r\n          );\r\n        },\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(geoPropertiesStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n}\r\n","import { Workspace, WorkspaceOptions } from '@igo2/common';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\r\n  layer: VectorLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class FeatureWorkspace extends Workspace {\r\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    true\r\n  );\r\n\r\n  get layer(): VectorLayer {\r\n    return this.options.layer;\r\n  }\r\n\r\n  get map(): IgoMap {\r\n    return this.options.map;\r\n  }\r\n\r\n  constructor(protected options: FeatureWorkspaceOptions) {\r\n    super(options);\r\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\r\n      if (\r\n        mapResolution > this.layer.minResolution &&\r\n        mapResolution < this.layer.maxResolution\r\n      ) {\r\n        this.inResolutionRange$.next(true);\r\n      } else {\r\n        this.inResolutionRange$.next(false);\r\n      }\r\n    });\r\n  }\r\n\r\n  public getLayerWksOptionTabQuery(): boolean {\r\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\r\n      return this.layer.options.workspace.queryOptions.tabQuery;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getLayerWksOptionMapQuery(): boolean {\r\n    if (\r\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\r\n    ) {\r\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private getInResolutionRange(): boolean {\r\n    return this.inResolutionRange$.value;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { ActionStore, EntityStoreFilterSelectionStrategy } from '@igo2/common';\r\n\r\nimport {\r\n  FeatureStore,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  FeatureStoreInMapExtentStrategy,\r\n  FeatureMotion,\r\n  FeatureStoreInMapResolutionStrategy,\r\n  FeatureStoreSearchIndexStrategy,\r\n  GeoPropertiesStrategy\r\n} from '../../feature';\r\nimport { LayerService, VectorLayer } from '../../layer/shared';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { CapabilitiesService, FeatureDataSource } from '../../datasource';\r\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\r\n\r\nimport { FeatureWorkspace } from './feature-workspace';\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\n\r\nimport {\r\n  createFilterInMapExtentOrResolutionStrategy,\r\n  createTableTemplate\r\n} from './workspace.utils';\r\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FeatureWorkspaceService {\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  public ws$ = new BehaviorSubject<string>(undefined);\r\n\r\n  constructor(\r\n    private storageService: StorageService,\r\n    private configService: ConfigService,\r\n    private layerService: LayerService,\r\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {}\r\n\r\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\r\n    if (\r\n      layer.options.workspace?.enabled === false ||\r\n      layer.dataSource.options.edition\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\r\n      srcId: layer.id,\r\n      workspaceId: layer.id,\r\n      enabled: true\r\n    } as GeoWorkspaceOptions);\r\n\r\n    const wks = new FeatureWorkspace({\r\n      id: layer.id,\r\n      title: layer.title,\r\n      layer,\r\n      map,\r\n      entityStore: this.createFeatureStore(layer, map),\r\n      actionStore: new ActionStore([]),\r\n      meta: {\r\n        tableTemplate: undefined\r\n      }\r\n    });\r\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\r\n    return wks;\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], { map });\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const searchStrategy = new FeatureStoreSearchIndexStrategy({\r\n      percentDistinctValueRatio: 2,\r\n      sourceFields: layer.dataSource.options.sourceFields\r\n    });\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\r\n      { map },\r\n      this.propertyTypeDetectorService,\r\n      this.capabilitiesService\r\n    );\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const confQueryOverlayStyle =\r\n      this.configService.getConfig('queryOverlayStyle');\r\n\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: (feature) => {\r\n          return getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature },\r\n              confQueryOverlayStyle?.selection || {}\r\n            )\r\n          );\r\n        },\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    if (layer.options.workspace?.searchIndexEnabled) {\r\n      store.addStrategy(searchStrategy, true);\r\n    }\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(geoPropertiesStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n}\r\n","import { LanguageService } from '@igo2/core';\r\nimport { Component, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\n\r\nexport interface DialogData {\r\n  type: string;\r\n  cancel: boolean;\r\n}\r\n\r\n@Component({\r\n  selector: 'igo-confirmation-popup-component',\r\n  templateUrl: './confirmation-popup.component.html',\r\n  styleUrls: ['./confirmation-popup.component.scss']\r\n})\r\nexport class ConfirmationPopupComponent {\r\n  constructor(\r\n    public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\r\n    public languageService: LanguageService,\r\n    @Inject(MAT_DIALOG_DATA) public data: { type: string; cancel: boolean }\r\n  ) {}\r\n\r\n  cancelAction() {\r\n    this.data.cancel = true;\r\n    this.dialogRef.close(this.data.cancel);\r\n  }\r\n\r\n  confirmedAction() {\r\n    this.data.cancel = false;\r\n    this.dialogRef.close(this.data.cancel);\r\n  }\r\n}\r\n","<div mat-dialog-content>\r\n  <p class=\"mat-typography\">\r\n    {{\r\n      data.type === 'add'\r\n        ? languageService.translate.instant('igo.geo.workspace.addConfirmation')\r\n        : languageService.translate.instant(\r\n            'igo.geo.workspace.deleteConfirmation'\r\n          )\r\n    }}\r\n  </p>\r\n</div>\r\n<div mat-dialog-actions>\r\n  <button mat-raised-button color=\"primary\" (click)=\"confirmedAction()\">\r\n    Ok\r\n  </button>\r\n  <button mat-raised-button (click)=\"cancelAction()\">\r\n    {{ languageService.translate.instant('igo.geo.workspace.cancel') }}\r\n  </button>\r\n</div>\r\n","import { MatDialog } from '@angular/material/dialog';\r\nimport { Workspace, WorkspaceOptions, EntityRecord } from '@igo2/common';\r\nimport { ConfigService } from '@igo2/core';\r\nimport { BehaviorSubject, Subscription, Observable } from 'rxjs';\r\n\r\nimport { ImageLayer, VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\r\nimport { DrawControl } from '../../geometry';\r\nimport { createInteractionStyle, GeometryType } from '../../draw';\r\nimport { featureToOl } from '../../feature';\r\n\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport * as OlStyle from 'ol/style';\r\nimport OlModify from 'ol/interaction/Modify';\r\nimport Collection from 'ol/Collection';\r\nimport OlFeature from 'ol/Feature';\r\nimport { FeatureDataSource, RelationOptions } from '../../datasource/shared';\r\n\r\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\r\n  layer: ImageLayer | VectorLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class EditionWorkspace extends Workspace {\r\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    true\r\n  );\r\n\r\n  get layer(): ImageLayer | VectorLayer {\r\n    return this.options.layer;\r\n  }\r\n\r\n  get map(): IgoMap {\r\n    return this.options.map;\r\n  }\r\n\r\n  private drawControl: DrawControl;\r\n  private drawEnd$$: Subscription;\r\n  private olDrawingLayerSource = new OlVectorSource();\r\n  private olDrawingLayer: VectorLayer;\r\n  public geometryType = GeometryType; // Reference to the GeometryType enum\r\n  public modify; // Reference to the ol interaction\r\n\r\n  public modifyStyle = new OlStyle.Style({\r\n    stroke: new OlStyle.Stroke({\r\n      color: 'rgba(255,255,255,1)',\r\n      width: 1\r\n    }),\r\n    fill: new OlStyle.Fill({\r\n      color: 'rgba(0,161,222,1)'\r\n    }),\r\n    image: new OlStyle.Circle({\r\n      radius: 7,\r\n      stroke: new OlStyle.Stroke({\r\n        color: 'rgba(255,255,255,1)',\r\n        width: 1\r\n      }),\r\n      fill: new OlStyle.Fill({\r\n        color: 'rgba(0,161,222,1)'\r\n      })\r\n    })\r\n  });\r\n\r\n  private newFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\r\n    return record.state.newFeature === true;\r\n  };\r\n\r\n  private editFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\r\n    return record.state.edit === true;\r\n  };\r\n\r\n  public fillColor: string;\r\n  public strokeColor: string;\r\n  public strokeWidth: number;\r\n\r\n  constructor(\r\n    private dialog: MatDialog,\r\n    private configService: ConfigService,\r\n    private adding$: BehaviorSubject<boolean>,\r\n    private _deleteFeature: (workspace: EditionWorkspace, url: string) => void,\r\n    private getDomainValues: (relation: RelationOptions) => Observable<any>,\r\n    protected options: EditionWorkspaceOptions\r\n  ) {\r\n    super(options);\r\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\r\n      if (\r\n        mapResolution > this.layer.minResolution &&\r\n        mapResolution < this.layer.maxResolution\r\n      ) {\r\n        this.inResolutionRange$.next(true);\r\n      } else {\r\n        this.inResolutionRange$.next(false);\r\n      }\r\n    });\r\n\r\n    this.drawControl = this.createDrawControl();\r\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\r\n\r\n    this.map.removeLayer(this.olDrawingLayer);\r\n\r\n    this.olDrawingLayer = new VectorLayer({\r\n      id: 'igo-draw-layer',\r\n      title: 'edition',\r\n      zIndex: 300,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      workspace: {\r\n        enabled: false\r\n      }\r\n    });\r\n  }\r\n\r\n  private getInResolutionRange(): boolean {\r\n    return this.inResolutionRange$.value;\r\n  }\r\n\r\n  deleteFeature(feature, workspace) {\r\n    setTimeout(() => {\r\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\r\n        disableClose: false,\r\n        data: { type: 'delete' }\r\n      });\r\n\r\n      dialogRef.afterClosed().subscribe((result) => {\r\n        if (result === false) {\r\n          let id, url;\r\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\r\n          const deleteUrl =\r\n            workspace.layer.dataSource.options.edition.deleteUrl;\r\n          if (baseUrl.length) {\r\n            url = this.configService.getConfig('edition.url')\r\n              ? this.configService.getConfig('edition.url') +\r\n                baseUrl +\r\n                '?' +\r\n                deleteUrl\r\n              : baseUrl + '?' + deleteUrl;\r\n          } else {\r\n            url = this.configService.getConfig('edition.url')\r\n              ? this.configService.getConfig('edition.url') + deleteUrl\r\n              : deleteUrl;\r\n          }\r\n\r\n          for (const column of workspace.meta.tableTemplate.columns) {\r\n            for (const property in feature.properties) {\r\n              let columnName = column.name;\r\n              if (columnName.includes('properties.')) {\r\n                columnName = columnName.split('.')[1];\r\n              }\r\n              if (columnName === property && column.primary === true) {\r\n                id = feature.properties[property];\r\n              }\r\n            }\r\n          }\r\n          if (url) {\r\n            url += id;\r\n            this.deleteFeature(workspace, url);\r\n          }\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  editFeature(feature, workspace: EditionWorkspace) {\r\n    feature.edition = true;\r\n    let id;\r\n    let find = false;\r\n    const editionOpt = workspace.layer.dataSource.options.edition;\r\n    for (const column of workspace.meta.tableTemplate.columns) {\r\n      // Update domain list\r\n      if (column.type === 'list' || column.type === 'autocomplete') {\r\n        this.getDomainValues(column.relation).subscribe((result) => {\r\n          column.domainValues = result;\r\n        });\r\n      }\r\n      if (find === false) {\r\n        for (const property in feature.properties) {\r\n          let columnName = column.name;\r\n          if (columnName.includes('properties.')) {\r\n            columnName = columnName.split('.')[1];\r\n          }\r\n          if (columnName === property && column.primary === true) {\r\n            id = feature.properties[property];\r\n            find = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (id) {\r\n      feature.original_properties = JSON.parse(\r\n        JSON.stringify(feature.properties)\r\n      );\r\n      feature.original_geometry = feature.geometry;\r\n      feature.idkey = id;\r\n      workspace.entityStore.state.updateAll({ edit: false });\r\n      workspace.entityStore.stateView.filter(this.editFeaturefilterClauseFunc);\r\n      this.addFeatureToStore(feature, workspace);\r\n    } else {\r\n      // Only for edition with it's own geometry\r\n      if (!feature.newFeature && editionOpt.geomType) {\r\n        feature.newFeature = true;\r\n        this.adding$.next(true);\r\n        workspace.entityStore.state.updateAll({ newFeature: false });\r\n        workspace.entityStore.stateView.filter(this.newFeaturefilterClauseFunc);\r\n        if (editionOpt.addWithDraw) {\r\n          const geometryType = editionOpt.geomType;\r\n          this.onGeometryTypeChange(geometryType, feature, workspace);\r\n        } else {\r\n          workspace.entityStore.insert(feature);\r\n          workspace.entityStore.state.update(\r\n            feature,\r\n            { newFeature: true },\r\n            true\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a Draw Control\r\n   * @param fillColor the fill color\r\n   * @param strokeColor the stroke color\r\n   * @param strokeWidth the stroke width\r\n   * @returns a Draw Control\r\n   */\r\n  createDrawControl(\r\n    fillColor?: string,\r\n    strokeColor?: string,\r\n    strokeWidth?: number\r\n  ) {\r\n    const drawControl = new DrawControl({\r\n      geometryType: undefined,\r\n      drawingLayerSource: this.olDrawingLayerSource,\r\n      drawingLayerStyle: new OlStyle.Style({}),\r\n      interactionStyle: createInteractionStyle(\r\n        fillColor,\r\n        strokeColor,\r\n        strokeWidth\r\n      )\r\n    });\r\n\r\n    return drawControl;\r\n  }\r\n\r\n  /**\r\n   * Called when the user selects a new geometry type\r\n   * @param geometryType the geometry type selected by the user\r\n   */\r\n  onGeometryTypeChange(\r\n    geometryType: Type,\r\n    feature,\r\n    workspace: EditionWorkspace\r\n  ) {\r\n    this.drawControl.setGeometryType(geometryType);\r\n    this.toggleDrawControl(feature, workspace);\r\n  }\r\n\r\n  /**\r\n   * Activate the correct control\r\n   */\r\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\r\n    this.deactivateDrawControl();\r\n    this.activateDrawControl(feature, workspace);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active draw control\r\n   */\r\n  public deactivateDrawControl() {\r\n    if (!this.drawControl) {\r\n      return;\r\n    }\r\n\r\n    if (this.drawEnd$$) {\r\n      this.drawEnd$$.unsubscribe();\r\n    }\r\n\r\n    this.drawControl.setOlMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   */\r\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\r\n    this.drawEnd$$ = this.drawControl.end$.subscribe(\r\n      (olGeometry: OlGeometry) => {\r\n        this.addFeatureToStore(feature, workspace, olGeometry);\r\n      }\r\n    );\r\n\r\n    this.drawControl.setOlMap(this.map.ol, true);\r\n  }\r\n\r\n  /**\r\n   * Add a feature to layer. The loading strategy of the layer\r\n   * will trigger and add the feature to the workspace store.\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(\r\n    feature,\r\n    workspace: EditionWorkspace,\r\n    olGeometry?: OlGeometry\r\n  ) {\r\n    const projection = this.map.ol.getView().getProjection();\r\n    let geometry = feature.geometry;\r\n\r\n    // If an olGeometry is passed, it means that it is a new feature\r\n    if (olGeometry) {\r\n      workspace.entityStore.insert(feature);\r\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\r\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\r\n        featureProjection: projection,\r\n        dataProjection: 'EPSG:4326'\r\n      }) as any;\r\n\r\n      feature.geometry = geometry;\r\n    } else {\r\n      workspace.entityStore.state.update(feature, { edit: true }, true);\r\n    }\r\n\r\n    feature.projection = 'EPSG:4326';\r\n\r\n    const featureOl = featureToOl(feature, projection.getCode());\r\n\r\n    this.olDrawingLayer.dataSource.ol.clear();\r\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\r\n    this.map.addLayer(this.olDrawingLayer);\r\n\r\n    this.deactivateDrawControl();\r\n    this.createModifyInteraction(featureOl, feature, workspace);\r\n  }\r\n\r\n  /**\r\n   * Delete drawings layer and source from the map AND feature from the entity store.\r\n   * Layer refresh will automatically add the new feature into the store.\r\n   */\r\n  deleteDrawings() {\r\n    this.map.removeLayer(this.olDrawingLayer);\r\n    this.olDrawingLayerSource.clear();\r\n    this.map.ol.removeInteraction(this.modify);\r\n  }\r\n\r\n  /**\r\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\r\n   */\r\n  createModifyInteraction(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    feature,\r\n    workspace: EditionWorkspace\r\n  ) {\r\n    this.map.ol.removeInteraction(this.modify);\r\n    const olCollection = new Collection([olFeature], { unique: true });\r\n    this.modify = new OlModify({\r\n      features: olCollection\r\n    });\r\n\r\n    this.map.ol.addInteraction(this.modify);\r\n    olCollection.forEach((feature) => {\r\n      feature.setStyle(this.modifyStyle);\r\n    });\r\n\r\n    this.modify.on('modifyend', (event) => {\r\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\r\n      if (olGeometry) {\r\n        this.addFeatureToStore(feature, workspace, olGeometry);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpClient,\r\n  HttpErrorResponse,\r\n  HttpHeaders\r\n} from '@angular/common/http';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport {\r\n  ActionStore,\r\n  EntityStoreFilterSelectionStrategy,\r\n  EntityTableColumnRenderer,\r\n  EntityTableTemplate,\r\n  EntityTableButton\r\n} from '@igo2/common';\r\nimport { ConfigService, MessageService, StorageService } from '@igo2/core';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\r\nimport {\r\n  RelationOptions,\r\n  SourceFieldsOptionsParams,\r\n  WMSDataSource\r\n} from '../../datasource';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport {\r\n  Feature,\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreInMapExtentStrategy,\r\n  FeatureStoreInMapResolutionStrategy,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy\r\n} from '../../feature';\r\n\r\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\r\nimport {\r\n  ImageLayer,\r\n  LayerService,\r\n  LayersLinkProperties,\r\n  LinkedProperties,\r\n  VectorLayer\r\n} from '../../layer/shared';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { MapBase, IgoMap } from '../../map/shared';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport { EditionWorkspace } from './edition-workspace';\r\n\r\nimport WKT from 'ol/format/WKT';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport olFeature from 'ol/Feature';\r\nimport olSourceImageWMS from 'ol/source/ImageWMS';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\r\nimport { createFilterInMapExtentOrResolutionStrategy } from './workspace.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class EditionWorkspaceService {\r\n  public ws$ = new BehaviorSubject<string>(undefined);\r\n  public adding$ = new BehaviorSubject<boolean>(false);\r\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(\r\n    undefined\r\n  );\r\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\r\n  public loading = false;\r\n  public wktFormat = new WKT();\r\n  public geoJsonFormat = new GeoJSON();\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private storageService: StorageService,\r\n    private configService: ConfigService,\r\n    private messageService: MessageService,\r\n    private http: HttpClient,\r\n    private dialog: MatDialog,\r\n    private styleService: StyleService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {}\r\n\r\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\r\n    if (\r\n      layer.options.workspace?.enabled !== true ||\r\n      layer.dataSource.options.edition.enabled !== true\r\n    ) {\r\n      return;\r\n    }\r\n    let wksConfig;\r\n    if (layer.options.workspace) {\r\n      wksConfig = layer.options.workspace;\r\n    } else {\r\n      wksConfig = {};\r\n    }\r\n    wksConfig.srcId = layer.id;\r\n    wksConfig.workspaceId = layer.id;\r\n    wksConfig.enabled = true;\r\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\r\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\r\n\r\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\r\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\r\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\r\n    if (!layer.options.linkedLayers) {\r\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\r\n    }\r\n    const linkProperties = {\r\n      syncedDelete: true,\r\n      linkedIds: [wfsLinkId],\r\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\r\n    } as LayersLinkProperties;\r\n\r\n    if (!layer.options.workspace?.minResolution) {\r\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\r\n    }\r\n    let hasOgcFilters = false;\r\n    if (\r\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\r\n    ) {\r\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\r\n      hasOgcFilters = true;\r\n    }\r\n    if (!layer.options.workspace?.maxResolution) {\r\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\r\n    }\r\n\r\n    let clonedLinks: LayersLinkProperties[] = [];\r\n    if (layer.options.linkedLayers.links) {\r\n      clonedLinks = JSON.parse(\r\n        JSON.stringify(layer.options.linkedLayers.links)\r\n      );\r\n    }\r\n    clonedLinks.push(linkProperties);\r\n\r\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\r\n      ? layer.options.linkedLayers.linkId\r\n      : wmsLinkId),\r\n      (layer.options.linkedLayers.links = clonedLinks);\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n    let wks;\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        id: wfsLinkId,\r\n        linkedLayers: {\r\n          linkId: wfsLinkId\r\n        },\r\n        workspace: {\r\n          srcId: layer.id,\r\n          workspaceId: undefined,\r\n          enabled: false,\r\n          queryOptions: {\r\n            mapQueryOnOpenTab:\r\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\r\n            tabQuery: false\r\n          },\r\n          pageSize: layer.options.workspace?.pageSize,\r\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\r\n        },\r\n        showInLayerList: false,\r\n        opacity: 0,\r\n        title: layer.title,\r\n        minResolution:\r\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\r\n        maxResolution:\r\n          layer.options.workspace?.maxResolution ||\r\n          layer.maxResolution ||\r\n          Infinity,\r\n        style: this.styleService.createStyle({\r\n          fill: {\r\n            color: 'rgba(255, 255, 255, 0.01)'\r\n          },\r\n          stroke: {\r\n            color: 'rgba(255, 255, 255, 0.01)'\r\n          },\r\n          circle: {\r\n            fill: {\r\n              color: 'rgba(255, 255, 255, 0.01)'\r\n            },\r\n            stroke: {\r\n              color: 'rgba(255, 255, 255, 0.01)'\r\n            },\r\n            radius: 5\r\n          }\r\n        }),\r\n        sourceOptions: {\r\n          download: dataSource.options.download,\r\n          type: 'wfs',\r\n          url: dataSource.options.urlWfs || dataSource.options.url,\r\n          queryable: true,\r\n          relations: dataSource.options.relations,\r\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\r\n            .queryTitle,\r\n          params: dataSource.options.paramsWFS,\r\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\r\n            enabled: hasOgcFilters\r\n          }),\r\n          sourceFields: dataSource.options.sourceFields || undefined,\r\n          edition: dataSource.options.edition\r\n        } as WFSoptions\r\n      })\r\n      .subscribe((workspaceLayer: VectorLayer) => {\r\n        map.addLayer(workspaceLayer);\r\n        layer.ol.setProperties(\r\n          {\r\n            linkedLayers: {\r\n              linkId: layer.options.linkedLayers.linkId,\r\n              links: clonedLinks\r\n            }\r\n          },\r\n          false\r\n        );\r\n        workspaceLayer.dataSource.ol.refresh();\r\n\r\n        wks = new EditionWorkspace(\r\n          this.dialog,\r\n          this.configService,\r\n          this.adding$,\r\n          this.deleteFeature,\r\n          this.getDomainValues,\r\n          {\r\n            id: layer.id,\r\n            title: layer.title,\r\n            layer: workspaceLayer,\r\n            map,\r\n            entityStore: this.createFeatureStore(workspaceLayer, map),\r\n            actionStore: new ActionStore([]),\r\n            meta: {\r\n              tableTemplate: undefined\r\n            }\r\n          }\r\n        );\r\n        this.createTableTemplate(wks, workspaceLayer);\r\n\r\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\r\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\r\n          wksConfig\r\n        } as GeoWorkspaceOptions);\r\n\r\n        delete dataSource.options.download;\r\n        return wks;\r\n      });\r\n\r\n    return wks;\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], { map });\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: undefined,\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n\r\n  private createTableTemplate(\r\n    workspace: EditionWorkspace,\r\n    layer: VectorLayer\r\n  ): EntityTableTemplate {\r\n    const fields = layer.dataSource.options.sourceFields || [];\r\n\r\n    const relations = layer.dataSource.options.relations || [];\r\n\r\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\r\n    let buttons = [];\r\n    let columns = [];\r\n    let relationsColumn = [];\r\n\r\n    buttons = [\r\n      {\r\n        name: 'edition',\r\n        title: undefined,\r\n        renderer: EntityTableColumnRenderer.ButtonGroup,\r\n        primary: false,\r\n        valueAccessor: () => {\r\n          return [\r\n            {\r\n              editMode: false,\r\n              icon: 'pencil',\r\n              color: 'primary',\r\n              disabled:\r\n                layer.dataSource.options.edition.modifyButton === false\r\n                  ? true\r\n                  : false,\r\n              click: (feature) => {\r\n                workspace.editFeature(feature, workspace);\r\n              }\r\n            },\r\n            {\r\n              editMode: false,\r\n              icon: 'delete',\r\n              color: 'warn',\r\n              disabled:\r\n                layer.dataSource.options.edition.deleteButton === false\r\n                  ? true\r\n                  : false,\r\n              click: (feature) => {\r\n                workspace.deleteFeature(feature, workspace);\r\n              }\r\n            },\r\n            {\r\n              editMode: true,\r\n              icon: 'check',\r\n              color: 'primary',\r\n              disabled: this.loading,\r\n              click: (feature) => {\r\n                this.saveFeature(feature, workspace);\r\n              }\r\n            },\r\n            {\r\n              editMode: true,\r\n              icon: 'alpha-x',\r\n              color: 'primary',\r\n              disabled: this.loading,\r\n              click: (feature) => {\r\n                this.cancelEdit(workspace, feature);\r\n              }\r\n            }\r\n          ] as EntityTableButton[];\r\n        }\r\n      }\r\n    ];\r\n\r\n    if (fields.length === 0) {\r\n      workspace.entityStore.entities$\r\n        .pipe(\r\n          skipWhile((val) => val.length === 0),\r\n          take(1)\r\n        )\r\n        .subscribe((entities) => {\r\n          const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\r\n          const columnsFromFeatures = ol\r\n            .getKeys()\r\n            .filter(\r\n              (col) =>\r\n                !col.startsWith('_') &&\r\n                col !== 'geometry' &&\r\n                col !== ol.getGeometryName() &&\r\n                !col.match(/boundedby/gi)\r\n            )\r\n            .map((key) => {\r\n              return {\r\n                name: `properties.${key}`,\r\n                title: key,\r\n                renderer: rendererType\r\n              };\r\n            });\r\n          workspace.meta.tableTemplate = {\r\n            selection: false,\r\n            sort: true,\r\n            columns: columnsFromFeatures\r\n          };\r\n        });\r\n      return;\r\n    }\r\n\r\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\r\n      let column = {\r\n        name: `properties.${field.name}`,\r\n        title: field.alias ? field.alias : field.name,\r\n        renderer: rendererType,\r\n        valueAccessor: undefined,\r\n        cellClassFunc: () => {\r\n          const cellClass = {};\r\n          if (field.type) {\r\n            cellClass[`class_${field.type}`] = true;\r\n            return cellClass;\r\n          }\r\n        },\r\n        primary: field.primary === true ? true : false,\r\n        visible: field.visible,\r\n        validation: field.validation,\r\n        linkColumnForce: field.linkColumnForce,\r\n        type: field.type,\r\n        domainValues: undefined,\r\n        relation: undefined,\r\n        multiple: field.multiple,\r\n        step: field.step,\r\n        tooltip: field.tooltip\r\n      };\r\n\r\n      if (field.type === 'list' || field.type === 'autocomplete') {\r\n        this.getDomainValues(field.relation).subscribe((result) => {\r\n          column.domainValues = result;\r\n          column.relation = field.relation;\r\n        });\r\n      }\r\n      return column;\r\n    });\r\n\r\n    relationsColumn = relations.map((relation: RelationOptions) => {\r\n      return {\r\n        name: `properties.${relation.name}`,\r\n        title: relation.alias ? relation.alias : relation.name,\r\n        renderer: EntityTableColumnRenderer.Icon,\r\n        icon: relation.icon,\r\n        parent: relation.parent,\r\n        type: 'relation',\r\n        tooltip: relation.tooltip,\r\n        onClick: () => {\r\n          if (this.adding$.getValue() === false) {\r\n            this.ws$.next(relation.title);\r\n          }\r\n        },\r\n        cellClassFunc: () => {\r\n          return { class_icon: true };\r\n        }\r\n      };\r\n    });\r\n\r\n    columns.push(...relationsColumn);\r\n    columns.push(...buttons);\r\n\r\n    workspace.meta.tableTemplate = {\r\n      selection: false,\r\n      sort: true,\r\n      columns\r\n    };\r\n  }\r\n\r\n  public saveFeature(feature, workspace: EditionWorkspace) {\r\n    if (!this.validateFeature(feature, workspace)) {\r\n      return false;\r\n    }\r\n\r\n    this.sanitizeParameter(feature, workspace);\r\n\r\n    const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\r\n    let url = this.configService.getConfig('edition.url');\r\n\r\n    if (!url) {\r\n      url = baseUrl;\r\n    } else {\r\n      url += baseUrl ? baseUrl : '';\r\n    }\r\n\r\n    if (feature.newFeature) {\r\n      url += workspace.layer.dataSource.options.edition.addUrl;\r\n\r\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\r\n      const headers = new HttpHeaders(addHeaders);\r\n\r\n      this.addFeature(feature, workspace, url, headers);\r\n    } else {\r\n      if (\r\n        workspace.layer.dataSource.options.edition.modifyProtocol !== 'post'\r\n      ) {\r\n        url +=\r\n          '?' +\r\n          workspace.layer.dataSource.options.edition.modifyUrl +\r\n          feature.idkey;\r\n      } else {\r\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\r\n      }\r\n\r\n      const protocole =\r\n        workspace.layer.dataSource.options.edition.modifyProtocol;\r\n      const modifyHeaders =\r\n        workspace.layer.dataSource.options.edition.modifyHeaders;\r\n      const headers = new HttpHeaders(modifyHeaders);\r\n\r\n      this.modifyFeature(feature, workspace, url, headers, protocole);\r\n    }\r\n  }\r\n\r\n  public addFeature(\r\n    feature,\r\n    workspace: EditionWorkspace,\r\n    url: string,\r\n    headers: { [key: string]: any }\r\n  ) {\r\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\r\n      const projDest =\r\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\r\n      feature.properties[\r\n        workspace.layer.dataSource.options.params.fieldNameGeometry\r\n      ] =\r\n        'SRID=' +\r\n        projDest.replace('EPSG:', '') +\r\n        ';' +\r\n        this.wktFormat.writeGeometry(\r\n          this.geoJsonFormat\r\n            .readFeature(feature.geometry)\r\n            .getGeometry()\r\n            .transform('EPSG:4326', projDest),\r\n          { dataProjection: projDest }\r\n        );\r\n    }\r\n\r\n    for (const property in feature.properties) {\r\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\r\n        if (\r\n          (sf.name === property && sf.validation?.readonly) ||\r\n          (sf.name === property && sf.validation?.send === false)\r\n        ) {\r\n          delete feature.properties[property];\r\n        }\r\n      }\r\n    }\r\n\r\n    this.loading = true;\r\n    this.http\r\n      .post(`${url}`, feature.properties, { headers: headers })\r\n      .subscribe(\r\n        () => {\r\n          this.loading = false;\r\n          workspace.entityStore.stateView.clear();\r\n          workspace.deleteDrawings();\r\n          workspace.entityStore.delete(feature);\r\n\r\n          this.messageService.success('igo.geo.workspace.addSuccess');\r\n\r\n          this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\r\n          this.adding$.next(false);\r\n          this.rowsInMapExtentCheckCondition$.next(true);\r\n        },\r\n        (error) => {\r\n          this.loading = false;\r\n          error.error.caught = true;\r\n          const messages = workspace.layer.dataSource.options.edition.messages;\r\n          if (messages) {\r\n            let text;\r\n            messages.forEach((message) => {\r\n              const key = Object.keys(message)[0];\r\n              if (error.error.message.includes(key)) {\r\n                text = message[key];\r\n                this.messageService.error(text);\r\n              }\r\n            });\r\n            if (!text) {\r\n              this.messageService.error('igo.geo.workspace.addError');\r\n            }\r\n          } else {\r\n            this.messageService.error('igo.geo.workspace.addError');\r\n          }\r\n        }\r\n      );\r\n  }\r\n\r\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\r\n    this.loading = true;\r\n    this.http.delete(`${url}`, {}).subscribe(\r\n      () => {\r\n        this.loading = false;\r\n        this.messageService.success('igo.geo.workspace.deleteSuccess');\r\n\r\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\r\n        for (const relation of workspace.layer.options.sourceOptions\r\n          .relations) {\r\n          workspace.map.layers.forEach((layer) => {\r\n            if (layer.title === relation.title) {\r\n              layer.dataSource.ol.refresh();\r\n            }\r\n          });\r\n        }\r\n      },\r\n      (error) => {\r\n        this.loading = false;\r\n        error.error.caught = true;\r\n        const messages = workspace.layer.dataSource.options.edition.messages;\r\n        if (messages) {\r\n          let text;\r\n          messages.forEach((message) => {\r\n            const key = Object.keys(message)[0];\r\n            if (error.error.message.includes(key)) {\r\n              text = message[key];\r\n              this.messageService.error(text);\r\n            }\r\n          });\r\n          if (!text) {\r\n            this.messageService.error('igo.geo.workspace.addError');\r\n          }\r\n        } else {\r\n          this.messageService.error('igo.geo.workspace.addError');\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  public modifyFeature(\r\n    feature,\r\n    workspace: EditionWorkspace,\r\n    url: string,\r\n    headers: { [key: string]: any },\r\n    protocole = 'patch'\r\n  ) {\r\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\r\n      const projDest =\r\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\r\n      // Remove 3e dimension\r\n      feature.geometry.coordinates = removeZ(feature.geometry.coordinates);\r\n      feature.properties[\r\n        workspace.layer.dataSource.options.params.fieldNameGeometry\r\n      ] =\r\n        'SRID=' +\r\n        projDest.replace('EPSG:', '') +\r\n        ';' +\r\n        this.wktFormat.writeGeometry(\r\n          this.geoJsonFormat\r\n            .readFeature(feature.geometry)\r\n            .getGeometry()\r\n            .transform('EPSG:4326', projDest),\r\n          { dataProjection: projDest }\r\n        );\r\n    }\r\n\r\n    for (const property in feature.properties) {\r\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\r\n        if (\r\n          (sf.name === property && sf.validation?.readonly) ||\r\n          (sf.name === property && sf.validation?.send === false) ||\r\n          property === 'boundedBy'\r\n        ) {\r\n          delete feature.properties[property];\r\n        }\r\n      }\r\n    }\r\n\r\n    this.loading = true;\r\n    this.http[protocole](`${url}`, feature.properties, {\r\n      headers: headers\r\n    }).subscribe(\r\n      () => {\r\n        this.loading = false;\r\n        this.cancelEdit(workspace, feature, true);\r\n\r\n        this.messageService.success('igo.geo.workspace.modifySuccess');\r\n\r\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\r\n\r\n        let relationLayers = [];\r\n        for (const relation of workspace.layer.options.sourceOptions\r\n          .relations) {\r\n          workspace.map.layers.forEach((layer) => {\r\n            if (layer.title === relation.title) {\r\n              relationLayers.push(layer);\r\n              layer.dataSource.ol.refresh();\r\n            }\r\n          });\r\n        }\r\n        this.relationLayers$.next(relationLayers);\r\n      },\r\n      (error) => {\r\n        this.loading = false;\r\n        error.error.caught = true;\r\n        const messages = workspace.layer.dataSource.options.edition.messages;\r\n        if (messages) {\r\n          let text;\r\n          messages.forEach((message) => {\r\n            const key = Object.keys(message)[0];\r\n            if (error.error.message.includes(key)) {\r\n              text = message[key];\r\n              this.messageService.error(text);\r\n            }\r\n          });\r\n          if (!text) {\r\n            this.messageService.error('igo.geo.workspace.addError');\r\n          }\r\n        } else {\r\n          this.messageService.error('igo.geo.workspace.addError');\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\r\n    feature.edition = false;\r\n    this.adding$.next(false);\r\n    workspace.deleteDrawings();\r\n    workspace.entityStore.stateView.clear();\r\n\r\n    if (feature.newFeature) {\r\n      workspace.entityStore.delete(feature);\r\n      workspace.deactivateDrawControl();\r\n\r\n      this.rowsInMapExtentCheckCondition$.next(true);\r\n    } else {\r\n      if (!fromSave) {\r\n        feature.properties = feature.original_properties;\r\n        feature.geometry = feature.original_geometry;\r\n      }\r\n      delete feature.original_properties;\r\n      delete feature.original_geometry;\r\n    }\r\n  }\r\n\r\n  getDomainValues(relation: RelationOptions): Observable<any> {\r\n    let url = relation.url;\r\n    if (!url) {\r\n      url = this.configService.getConfig('edition.url')\r\n        ? this.configService.getConfig('edition.url') + relation.table\r\n        : relation.table;\r\n    }\r\n\r\n    return this.http.get<any>(url).pipe(\r\n      map((result) => {\r\n        return result;\r\n      }),\r\n      catchError((err: HttpErrorResponse) => {\r\n        err.error.caught = true;\r\n        return throwError(err);\r\n      })\r\n    );\r\n  }\r\n\r\n  /*\r\n   * Refresh both wms and wfs layer\r\n   * A new wfs loader is used to ensure cache is not retrieving old data\r\n   * WMS params are updated to ensure layer is correctly refreshed\r\n   */\r\n  refreshMap(layer: VectorLayer, map: MapBase) {\r\n    const wfsOlLayer = layer.dataSource.ol;\r\n    const loader = (extent, resolution, proj, success, failure) => {\r\n      layer.customWFSLoader(\r\n        layer.ol.getSource(),\r\n        layer.options.sourceOptions,\r\n        this.authInterceptor,\r\n        extent,\r\n        resolution,\r\n        proj,\r\n        success,\r\n        failure,\r\n        true\r\n      );\r\n    };\r\n    wfsOlLayer.setLoader(loader);\r\n    wfsOlLayer.refresh();\r\n\r\n    for (const lay of map.layers) {\r\n      if (\r\n        lay.id !== layer.id &&\r\n        lay.options.linkedLayers?.linkId.includes(\r\n          layer.id.substr(0, layer.id.indexOf('.') - 1)\r\n        ) &&\r\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\r\n      ) {\r\n        const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\r\n        let params = wmsOlLayer.getParams();\r\n        params._t = new Date().getTime();\r\n        wmsOlLayer.updateParams(params);\r\n      }\r\n    }\r\n  }\r\n\r\n  validateFeature(feature, workspace: EditionWorkspace) {\r\n    let message;\r\n    let key;\r\n    let valid = true;\r\n    workspace.meta.tableTemplate.columns.forEach((column) => {\r\n      if (column.hasOwnProperty('validation') && column.validation) {\r\n        key = getColumnKeyWithoutPropertiesTag(column.name);\r\n        Object.keys(column.validation).forEach((type) => {\r\n          switch (type) {\r\n            case 'mandatory': {\r\n              if (\r\n                column.validation[type] &&\r\n                (!feature.properties.hasOwnProperty(key) ||\r\n                  !feature.properties[key])\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.mandatory',\r\n                  undefined,\r\n                  undefined,\r\n                  { column: column.title }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n            case 'minValue': {\r\n              if (\r\n                feature.properties.hasOwnProperty(key) &&\r\n                feature.properties[key] &&\r\n                feature.properties[key] < column.validation[type]\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.minValue',\r\n                  undefined,\r\n                  undefined,\r\n                  {\r\n                    column: column.title,\r\n                    value: column.validation[type]\r\n                  }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n            case 'maxValue': {\r\n              if (\r\n                feature.properties.hasOwnProperty(key) &&\r\n                feature.properties[key] &&\r\n                feature.properties[key] > column.validation[type]\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.maxValue',\r\n                  undefined,\r\n                  undefined,\r\n                  {\r\n                    column: column.title,\r\n                    value: column.validation[type]\r\n                  }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n            case 'minLength': {\r\n              if (\r\n                feature.properties.hasOwnProperty(key) &&\r\n                feature.properties[key] &&\r\n                feature.properties[key].length < column.validation[type]\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.minLength',\r\n                  undefined,\r\n                  undefined,\r\n                  {\r\n                    column: column.title,\r\n                    value: column.validation[type]\r\n                  }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n            case 'maxLength': {\r\n              if (\r\n                feature.properties.hasOwnProperty(key) &&\r\n                feature.properties[key] &&\r\n                feature.properties[key].length > column.validation[type]\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.maxLength',\r\n                  undefined,\r\n                  undefined,\r\n                  {\r\n                    column: column.title,\r\n                    value: column.validation[type]\r\n                  }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n          }\r\n        });\r\n      }\r\n    });\r\n    return valid;\r\n  }\r\n\r\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\r\n    workspace.meta.tableTemplate.columns.forEach((column) => {\r\n      if (\r\n        column.type === 'list' &&\r\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]\r\n      ) {\r\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\r\n          feature.properties[\r\n            getColumnKeyWithoutPropertiesTag(column.name)\r\n          ].toString();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\r\n  if (column.includes('properties.')) {\r\n    return column.split('.')[1];\r\n  }\r\n  return column;\r\n}\r\n\r\nfunction removeZ(coords: any) {\r\n  if (coords.length === 0) return coords;\r\n  if (typeof coords[0] === 'number') return coords.slice(0, 2);\r\n  return coords.map(removeZ);\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ActionStore, EntityStoreFilterSelectionStrategy } from '@igo2/common';\r\nimport { StorageService, ConfigService } from '@igo2/core';\r\nimport { CapabilitiesService, WMSDataSource } from '../../datasource';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport {\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreInMapExtentStrategy,\r\n  FeatureStoreInMapResolutionStrategy,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  GeoPropertiesStrategy\r\n} from '../../feature';\r\n\r\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\r\nimport {\r\n  ImageLayer,\r\n  LayerService,\r\n  LayersLinkProperties,\r\n  LinkedProperties,\r\n  VectorLayer\r\n} from '../../layer/shared';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport { WfsWorkspace } from './wfs-workspace';\r\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\r\n\r\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\r\nimport { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';\r\nimport {\r\n  createFilterInMapExtentOrResolutionStrategy,\r\n  createTableTemplate\r\n} from './workspace.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WmsWorkspaceService {\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  public ws$ = new BehaviorSubject<string>(undefined);\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private storageService: StorageService,\r\n    private capabilitiesService: CapabilitiesService,\r\n    private styleService: StyleService,\r\n    private configService: ConfigService,\r\n    private propertyTypeDetectorService: PropertyTypeDetectorService\r\n  ) {}\r\n\r\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\r\n    if (\r\n      !layer.options.workspace ||\r\n      map.layers.find(\r\n        (lay) => lay.id === layer.id + '.WfsWorkspaceTableDest'\r\n      ) ||\r\n      layer.dataSource.options.edition\r\n    ) {\r\n      return;\r\n    }\r\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\r\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\r\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\r\n    if (!layer.options.linkedLayers) {\r\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\r\n    }\r\n    const linkProperties = {\r\n      syncedDelete: true,\r\n      linkedIds: [wfsLinkId],\r\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\r\n    } as LayersLinkProperties;\r\n\r\n    if (!layer.options.workspace?.minResolution) {\r\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\r\n    }\r\n    let hasOgcFilters = false;\r\n    if (\r\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\r\n    ) {\r\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\r\n      hasOgcFilters = true;\r\n    }\r\n    if (!layer.options.workspace?.maxResolution) {\r\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\r\n    }\r\n\r\n    let clonedLinks: LayersLinkProperties[] = [];\r\n    if (layer.options.linkedLayers.links) {\r\n      clonedLinks = JSON.parse(\r\n        JSON.stringify(layer.options.linkedLayers.links)\r\n      );\r\n    }\r\n    clonedLinks.push(linkProperties);\r\n\r\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\r\n      ? layer.options.linkedLayers.linkId\r\n      : wmsLinkId),\r\n      (layer.options.linkedLayers.links = clonedLinks);\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    let wks;\r\n    let wksLayerOption: GeoWorkspaceOptions = {\r\n      printable: layer.options.workspace?.printable,\r\n      srcId: layer.id,\r\n      workspaceId: undefined,\r\n      enabled: false,\r\n      queryOptions: {\r\n        mapQueryOnOpenTab:\r\n          layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\r\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\r\n      },\r\n      pageSize: layer.options.workspace?.pageSize,\r\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\r\n    };\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        isIgoInternalLayer: true,\r\n        id: wfsLinkId,\r\n        linkedLayers: {\r\n          linkId: wfsLinkId\r\n        },\r\n        workspace: wksLayerOption,\r\n        showInLayerList: false,\r\n        opacity: 0,\r\n        title: layer.title,\r\n        minResolution:\r\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\r\n        maxResolution:\r\n          layer.options.workspace?.maxResolution ||\r\n          layer.maxResolution ||\r\n          Infinity,\r\n        style: this.styleService.createStyle({\r\n          fill: {\r\n            color: 'rgba(255, 255, 255, 0.01)'\r\n          },\r\n          stroke: {\r\n            color: 'rgba(255, 255, 255, 0.01)'\r\n          },\r\n          circle: {\r\n            fill: {\r\n              color: 'rgba(255, 255, 255, 0.01)'\r\n            },\r\n            stroke: {\r\n              color: 'rgba(255, 255, 255, 0.01)'\r\n            },\r\n            radius: 5\r\n          }\r\n        }),\r\n        sourceOptions: {\r\n          download: dataSource.options.download,\r\n          type: 'wfs',\r\n          url: dataSource.options.urlWfs || dataSource.options.url,\r\n          queryable: true,\r\n          relations: dataSource.options.relations,\r\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\r\n            .queryTitle,\r\n          queryFormatAsWms: layer.options.workspace?.enabled\r\n            ? (dataSource.options as QueryableDataSourceOptions)\r\n                .queryFormatAsWms\r\n            : true,\r\n          params: dataSource.options.paramsWFS,\r\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\r\n            enabled: hasOgcFilters\r\n          }),\r\n          sourceFields: dataSource.options.sourceFields || undefined\r\n        } as WFSoptions\r\n      })\r\n      .subscribe((workspaceLayer: VectorLayer) => {\r\n        map.addLayer(workspaceLayer);\r\n        layer.ol.setProperties(\r\n          {\r\n            linkedLayers: {\r\n              linkId: layer.options.linkedLayers.linkId,\r\n              links: clonedLinks\r\n            }\r\n          },\r\n          false\r\n        );\r\n        workspaceLayer.dataSource.ol.refresh();\r\n\r\n        if (!layer.options.workspace?.enabled) {\r\n          return;\r\n        }\r\n        wks = new WfsWorkspace({\r\n          id: layer.id,\r\n          title: layer.title,\r\n          layer: workspaceLayer,\r\n          map,\r\n          entityStore: this.createFeatureStore(workspaceLayer, map),\r\n          actionStore: new ActionStore([]),\r\n          meta: {\r\n            tableTemplate: undefined\r\n          }\r\n        });\r\n        createTableTemplate(wks, workspaceLayer, this.layerService, this.ws$);\r\n\r\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\r\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\r\n          enabled: true,\r\n          srcId: layer.id,\r\n          workspaceId: workspaceLayer.id,\r\n          queryOptions: {\r\n            mapQueryOnOpenTab:\r\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\r\n            tabQuery: layer.options.workspace?.queryOptions?.tabQuery\r\n          },\r\n          pageSize: layer.options.workspace?.pageSize,\r\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\r\n        } as GeoWorkspaceOptions);\r\n\r\n        delete dataSource.options.download;\r\n        return wks;\r\n      });\r\n\r\n    return wks;\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], { map });\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\r\n      { map },\r\n      this.propertyTypeDetectorService,\r\n      this.capabilitiesService\r\n    );\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const confQueryOverlayStyle =\r\n      this.configService.getConfig('queryOverlayStyle');\r\n\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: (feature) => {\r\n          return getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature },\r\n              confQueryOverlayStyle?.selection || {}\r\n            )\r\n          );\r\n        },\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(geoPropertiesStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport {\r\n  Workspace,\r\n  WorkspaceStore,\r\n  WorkspaceSelectorComponent\r\n} from '@igo2/common';\r\n\r\nimport { Layer, ImageLayer, VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\nimport {\r\n  WFSDataSource,\r\n  WMSDataSource,\r\n  FeatureDataSource\r\n} from '../../datasource';\r\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared';\r\n\r\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\r\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\r\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\r\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\r\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\n\r\n@Directive({\r\n  selector: '[igoWorkspaceSelector]'\r\n})\r\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\r\n  private layers$$: Subscription;\r\n  private entities$$: Subscription[] = [];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Output() changeWorkspace = new EventEmitter<string>();\r\n  @Output() disableSwitch = new EventEmitter<boolean>();\r\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\r\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\r\n\r\n  get workspaceStore(): WorkspaceStore {\r\n    return this.component.store;\r\n  }\r\n\r\n  constructor(\r\n    private component: WorkspaceSelectorComponent,\r\n    private wfsWorkspaceService: WfsWorkspaceService,\r\n    private wmsWorkspaceService: WmsWorkspaceService,\r\n    private editionWorkspaceService: EditionWorkspaceService,\r\n    private featureWorkspaceService: FeatureWorkspaceService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.layers$$ = this.map.layers$\r\n      .pipe(debounceTime(50))\r\n      .subscribe((layers: Layer[]) => this.onLayersChange(layers));\r\n\r\n    this.featureWorkspaceService.ws$.subscribe((ws) => {\r\n      this.changeWorkspace.emit(ws);\r\n    });\r\n    this.wmsWorkspaceService.ws$.subscribe((ws) => {\r\n      this.changeWorkspace.emit(ws);\r\n    });\r\n    this.wfsWorkspaceService.ws$.subscribe((ws) => {\r\n      this.changeWorkspace.emit(ws);\r\n    });\r\n    this.editionWorkspaceService.ws$.subscribe((ws) => {\r\n      this.changeWorkspace.emit(ws);\r\n    });\r\n    this.editionWorkspaceService.adding$.subscribe((adding) => {\r\n      this.disableSwitch.emit(adding);\r\n    });\r\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => {\r\n      this.relationLayers.emit(layers);\r\n    });\r\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(\r\n      (condition) => {\r\n        this.rowsInMapExtentCheckCondition.emit(condition);\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n    this.entities$$.map((entities) => entities.unsubscribe());\r\n  }\r\n\r\n  private onLayersChange(layers: Layer[]) {\r\n    const editableLayers = layers.filter((layer: Layer) =>\r\n      this.layerIsEditable(layer)\r\n    );\r\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\r\n\r\n    const workspacesToAdd = editableLayers\r\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\r\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\r\n\r\n    const workspacesToRemove = this.workspaceStore\r\n      .all()\r\n      .filter((workspace: Workspace) => {\r\n        return editableLayersIds.indexOf(workspace.id) < 0;\r\n      });\r\n\r\n    if (workspacesToRemove.length > 0) {\r\n      workspacesToRemove.forEach((workspace: Workspace) => {\r\n        workspace.entityStore.deactivateStrategyOfType(\r\n          FeatureStoreInMapExtentStrategy\r\n        );\r\n        workspace.deactivate();\r\n      });\r\n      this.workspaceStore.state.updateMany(workspacesToRemove, {\r\n        active: false,\r\n        selected: false\r\n      });\r\n      this.workspaceStore.deleteMany(workspacesToRemove);\r\n    }\r\n\r\n    if (workspacesToAdd.length > 0) {\r\n      this.workspaceStore.insertMany(workspacesToAdd);\r\n    }\r\n  }\r\n\r\n  private getOrCreateWorkspace(\r\n    layer: VectorLayer | ImageLayer\r\n  ): Workspace | undefined {\r\n    const workspace = this.workspaceStore.get(layer.id);\r\n    if (workspace !== undefined) {\r\n      return;\r\n    }\r\n    if (\r\n      layer.dataSource instanceof WFSDataSource &&\r\n      layer.dataSource.options.edition?.enabled !== true\r\n    ) {\r\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(\r\n        layer as VectorLayer,\r\n        this.map\r\n      );\r\n      return wfsWks;\r\n    } else if (\r\n      layer.dataSource instanceof WMSDataSource &&\r\n      layer.dataSource.options.edition?.enabled !== true\r\n    ) {\r\n      if (!layer.dataSource.options.paramsWFS) {\r\n        return;\r\n      }\r\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(\r\n        layer as ImageLayer,\r\n        this.map\r\n      );\r\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\r\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable =\r\n          !inResolutionRange;\r\n        (\r\n          wmsWks.layer.dataSource.options as QueryableDataSourceOptions\r\n        ).queryable = inResolutionRange;\r\n      });\r\n      return wmsWks;\r\n    } else if (\r\n      layer.dataSource instanceof FeatureDataSource &&\r\n      (layer as VectorLayer).exportable === true &&\r\n      layer.dataSource.options.edition?.enabled !== true\r\n    ) {\r\n      const featureWks = this.featureWorkspaceService.createWorkspace(\r\n        layer as VectorLayer,\r\n        this.map\r\n      );\r\n      return featureWks;\r\n    } else if (\r\n      layer.dataSource instanceof WMSDataSource &&\r\n      layer.dataSource.options.edition?.enabled === true\r\n    ) {\r\n      const editionWks = this.editionWorkspaceService.createWorkspace(\r\n        layer as ImageLayer,\r\n        this.map\r\n      );\r\n      return editionWks;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  private layerIsEditable(layer: Layer): boolean {\r\n    const dataSource = layer.dataSource;\r\n    if (dataSource instanceof WFSDataSource) {\r\n      return true;\r\n    }\r\n    if (dataSource instanceof FeatureDataSource) {\r\n      return true;\r\n    }\r\n    if (dataSource instanceof WMSDataSource) {\r\n      const dataSourceOptions = (dataSource.options ||\r\n        {}) as OgcFilterableDataSourceOptions;\r\n      return (\r\n        dataSourceOptions.ogcFilters?.enabled ||\r\n        dataSource.options.paramsWFS?.featureTypes !== undefined\r\n      );\r\n    }\r\n\r\n    return false;\r\n  }\r\n}\r\n","<h2 mat-dialog-title class=\"mat-typography\">\r\n  {{ 'igo.geo.style.styleModal' | translate }}\r\n</h2>\r\n<div mat-dialog-content>\r\n  <div class=\"edition-drawing mat-typography\">\r\n    <form class=\"igo-form\" [formGroup]=\"form\">\r\n      <div\r\n        class=\"fill-color-picker mat-typography\"\r\n        *ngIf=\"linestringOnly !== true\"\r\n      >\r\n        <span>\r\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\r\n          {{ 'igo.geo.style.fill' | translate }}\r\n        </span>\r\n        <igo-color-picker-form-field\r\n          formControlName=\"fill\"\r\n          outputFormat=\"rgba\"\r\n          setAlpha=\".4\"\r\n          (open)=\"openPicker()\"\r\n          (close)=\"closePicker()\"\r\n          [color]=\"getLayerFillColor()\"\r\n        ></igo-color-picker-form-field>\r\n      </div>\r\n\r\n      <div class=\"stroke-color-picker mat-typography\">\r\n        <span>\r\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\">\r\n          </mat-icon>\r\n          {{ 'igo.geo.style.stroke' | translate }}\r\n        </span>\r\n        <igo-color-picker-form-field\r\n          formControlName=\"stroke\"\r\n          outputFormat=\"rgba\"\r\n          setAlpha=\"1\"\r\n          (open)=\"openPicker()\"\r\n          (close)=\"closePicker()\"\r\n          [color]=\"getLayerStrokeColor()\"\r\n        ></igo-color-picker-form-field>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</div>\r\n<div mat-dialog-actions>\r\n  <button mat-raised-button (click)=\"cancel()\">\r\n    {{ 'igo.geo.style.cancel' | translate }}\r\n  </button>\r\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\r\n</div>\r\n","import { Component, Inject, Input, OnInit } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { UntypedFormGroup, UntypedFormBuilder } from '@angular/forms';\r\n\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\nimport olStyle from 'ol/style/Style';\r\nimport {\r\n  LayerMatDialogData,\r\n  StyleModalData\r\n} from '../shared/style-modal.interface';\r\n\r\n@Component({\r\n  selector: 'igo-style-modal-layer',\r\n  templateUrl: './style-modal-layer.component.html',\r\n  styleUrls: ['./style-modal-layer.component.scss']\r\n})\r\nexport class StyleModalLayerComponent implements OnInit {\r\n  @Input() confirmFlag: boolean = false;\r\n\r\n  public form: UntypedFormGroup;\r\n\r\n  public styleModalData: StyleModalData;\r\n  public linestringOnly: boolean;\r\n\r\n  private initialValues: StyleModalData;\r\n\r\n  private defaultValues: StyleModalData = {\r\n    fillColor: 'rgba(255,255,255,0.4)',\r\n    strokeColor: 'rgba(143,7,7,1)'\r\n  };\r\n\r\n  get layerOlStyle(): olStyle {\r\n    const style = this.data.layer.ol.getStyle();\r\n    return style instanceof Function ? undefined : (style as olStyle).clone();\r\n  }\r\n\r\n  constructor(\r\n    public dialogRef: MatDialogRef<StyleModalLayerComponent>,\r\n    private formBuilder: UntypedFormBuilder,\r\n    @Inject(MAT_DIALOG_DATA) public data: LayerMatDialogData\r\n  ) {\r\n    this.buildForm();\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.linestringOnly = true;\r\n    for (const feature of this.data.layer.ol.getSource().getFeatures()) {\r\n      if (feature.getGeometry().getType() !== 'LineString') {\r\n        this.linestringOnly = false;\r\n      }\r\n    }\r\n    this.buildStyleData();\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      fill: [''],\r\n      stroke: ['']\r\n    });\r\n  }\r\n\r\n  private buildStyleData() {\r\n    this.styleModalData = {\r\n      fillColor: this.getLayerFillColor(),\r\n      strokeColor: this.getLayerStrokeColor()\r\n    };\r\n    this.initialValues = {\r\n      fillColor: this.getLayerFillColor(),\r\n      strokeColor: this.getLayerStrokeColor()\r\n    };\r\n  }\r\n\r\n  getLayerFillColor() {\r\n    let fillColor = this.defaultValues.fillColor;\r\n    const style = this.layerOlStyle;\r\n    if (style?.getFill()?.getColor()) {\r\n      const arrayColor = style.getFill().getColor();\r\n      fillColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\r\n        arrayColor[3] || 0.4\r\n      })`;\r\n    }\r\n    return fillColor;\r\n  }\r\n\r\n  getLayerStrokeColor() {\r\n    let strokeColor = this.defaultValues.strokeColor;\r\n    const style = this.layerOlStyle;\r\n    if (style?.getStroke()?.getColor()) {\r\n      const arrayColor = style.getStroke().getColor();\r\n      strokeColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\r\n        arrayColor[3] || 1\r\n      })`;\r\n    }\r\n    return strokeColor;\r\n  }\r\n\r\n  setLayerFillColor(event) {\r\n    const cAA = ColorAsArray(event);\r\n    const s = this.layerOlStyle.clone();\r\n    (s.getImage() as any).getFill().setColor(cAA);\r\n    s.getFill().setColor(cAA);\r\n    this.data.layer.ol.setStyle(s);\r\n    this.styleModalData.fillColor = event;\r\n  }\r\n\r\n  setLayerStrokeColor(event) {\r\n    const cAA = ColorAsArray(event);\r\n    const s = this.layerOlStyle.clone();\r\n    (s.getImage() as any).getStroke().setColor(cAA);\r\n    s.getStroke().setColor(cAA);\r\n    this.data.layer.ol.setStyle(s);\r\n    this.styleModalData.strokeColor = event;\r\n  }\r\n\r\n  cancel() {\r\n    this.dialogRef.close();\r\n    this.setLayerFillColor(this.initialValues.fillColor);\r\n    this.setLayerStrokeColor(this.initialValues.strokeColor);\r\n  }\r\n\r\n  confirm() {\r\n    this.confirmFlag = true;\r\n    if (this.form.get('fill').value) {\r\n      this.styleModalData.fillColor = this.form.get('fill').value;\r\n    }\r\n\r\n    if (this.form.get('stroke').value) {\r\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\r\n    }\r\n    this.dialogRef.close(this.styleModalData);\r\n  }\r\n\r\n  openPicker() {\r\n    this.dialogRef.disableClose = true;\r\n  }\r\n\r\n  closePicker() {\r\n    this.dialogRef.disableClose = false;\r\n  }\r\n}\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\r\n\r\nimport { StyleModalLayerComponent } from '../layer/style-modal-layer.component';\r\nimport { LayerMatDialogData } from '../shared/style-modal.interface';\r\n\r\n@Component({\r\n  selector: 'igo-style-modal-layer-button',\r\n  templateUrl: './style-modal-layer-button.component.html',\r\n  styleUrls: ['./style-modal-layer-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class StyleModalLayerButtonComponent {\r\n  @Input() layer: VectorLayer;\r\n  constructor(private dialog: MatDialog) {}\r\n\r\n  /**\r\n   * Open the style modal dialog box\r\n   */\r\n  openStyleModalDialog() {\r\n    setTimeout(() => {\r\n      // open the dialog box used to style features\r\n      const data: LayerMatDialogData = { layer: this.layer };\r\n      const dialogRef = this.dialog.open(StyleModalLayerComponent, {\r\n        disableClose: false,\r\n        data,\r\n        autoFocus: false\r\n      });\r\n    }, 250);\r\n  }\r\n}\r\n","<button\r\n  mat-icon-button\r\n  color=\"primary\"\r\n  (click)=\"openStyleModalDialog()\"\r\n  [matTooltip]=\"'igo.geo.style.styleModalTooltipLayer' | translate\"\r\n>\r\n  <mat-icon class=\"style-icon\" svgIcon=\"palette\"> </mat-icon>\r\n</button>\r\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\r\n  <pre>{{ infoContent }}</pre>\r\n</div>\r\n","import { Component, Input } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'igo-info-section',\r\n  templateUrl: './info-section.component.html',\r\n  styleUrls: ['./info-section.component.scss']\r\n})\r\nexport class InfoSectionComponent {\r\n  @Input() infoContent: string = '';\r\n\r\n  constructor() {}\r\n}\r\n","<app-doc-viewer\n  title=\"Simple Map\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/simple-map\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoPointerPosition\n      [pointerPositionDelay]=\"pointerCoordDelay\"\n      (pointerPositionCoord)=\"onPointerMove($event)\"\n    >\n      <igo-info-section [infoContent]=\"pointerCoord\"></igo-info-section>\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n      <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n      <igo-home-extent-button\n        [map]=\"map\"\n        color=\"primary\"\n      ></igo-home-extent-button>\n      <igo-rotation-button\n        [map]=\"map\"\n        [showIfNoRotation]=\"true\"\n        color=\"primary\"\n      ></igo-rotation-button>\n      <igo-wake-lock-button></igo-wake-lock-button>\n    </igo-map-browser>\n    <p *ngIf=\"!isTouchScreen\">{{ pointerCoord }}</p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppSimpleMapComponent } from './simple-map.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'simple-map',\r\n    component: AppSimpleMapComponent\r\n  }\r\n];\r\n\r\nexport const AppSimpleMapRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-simple-map',\r\n  templateUrl: './simple-map.component.html',\r\n  styleUrls: ['./simple-map.component.scss']\r\n})\r\nexport class AppSimpleMapComponent {\r\n  public pointerCoord;\r\n  public pointerCoordDelay: number = 0;\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6,\r\n    rotation: 0.75\r\n  };\r\n\r\n  get media() {\r\n    return this.mediaService.getMedia();\r\n  }\r\n\r\n  get isTouchScreen() {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mediaService: MediaService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  onPointerMove(event) {\r\n    this.pointerCoord = event;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppSimpleMapComponent } from './simple-map.component';\nimport { AppSimpleMapRoutingModule } from './simple-map-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppSimpleMapComponent],\n  imports: [\n    SharedModule,\n    AppSimpleMapRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppSimpleMapComponent]\n})\nexport class AppSimpleMapModule {}\n","<app-doc-viewer\n  title=\"Layer\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/layer\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-layer-list\n              [map]=\"map\"\n              [layers]=\"map.layers\"\n              [expandLegendOfVisibleLayers]=\"false\"\n              floatLabel=\"never\"\n              [queryBadge]=\"true\"\n            >\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n                <igo-download-button [layer]=\"layer\"></igo-download-button>\n                <igo-ogc-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-ogc-filter-button>\n                <igo-time-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-time-filter-button>\n                <igo-track-feature-button\n                  [layer]=\"layer\"\n                  [trackFeature]=\"true\"\n                ></igo-track-feature-button>\n              </ng-template>\n            </igo-layer-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppLayerComponent } from './layer.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'layer',\r\n    component: AppLayerComponent\r\n  }\r\n];\r\n\r\nexport const AppLayerRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  WMSDataSourceOptions,\r\n  LayerOptions,\r\n  WFSDataSourceOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  MetadataLayerOptions\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-layer',\r\n  templateUrl: './layer.component.html',\r\n  styleUrls: ['./layer.component.scss']\r\n})\r\nexport class AppLayerComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            visible: true,\r\n            baseLayer: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const wfsDatasource: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        filters: {\r\n          operator: 'PropertyIsEqualTo',\r\n          propertyName: 'code_municipalite',\r\n          expression: '10043'\r\n        }\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasource)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptions = {\r\n          title: 'WFS ',\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    const wfsDatasourceCustomEPSG: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: 'geojson_utf8',\r\n        srsName: 'EPSG:32198',\r\n        outputFormatDownload: 'shp'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        filters: {\r\n          operator: 'PropertyIsEqualTo',\r\n          propertyName: 'code_municipalite',\r\n          expression: '12072'\r\n        }\r\n      },\r\n      formatOptions: {\r\n        dataProjection: 'EPSG:32198'\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptions = {\r\n          title: 'WFS (Custom EPSG)',\r\n          visible: true,\r\n          source: dataSource,\r\n          removable: false\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'parc_routier',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Rseau routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'lieu habit',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'lieuhabite',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'sh_dis_eco',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'sh_dis_eco',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'nurc:Arc_Sample_Parent',\r\n        visible: false,\r\n        legendOptions: {\r\n          // collapsed: false,\r\n          display: true,\r\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\r\n          stylesAvailable: [\r\n            { name: 'rain', title: 'Pluie' },\r\n            { name: 'raster', title: 'Dfaut' }\r\n          ] //\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Avertissements routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'evenements',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    const datasource: WMSDataSourceOptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      refreshIntervalSec: 15,\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n        VERSION: '1.3.0'\r\n      }\r\n    };\r\n\r\n    interface LayerOptionsWithMetadata\r\n      extends LayerOptions,\r\n        MetadataLayerOptions {}\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasource)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptionsWithMetadata = {\r\n          title: 'Embcle',\r\n          source: dataSource,\r\n          metadata: {\r\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\r\n            extern: true\r\n          }\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLayerComponent } from './layer.component';\nimport { AppLayerRoutingModule } from './layer-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppLayerComponent],\n  imports: [\n    SharedModule,\n    AppLayerRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLayerComponent]\n})\nexport class AppLayerModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppLegendComponent } from './legend.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'legend',\r\n    component: AppLegendComponent\r\n  }\r\n];\r\n\r\nexport const AppLegendRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  WMSDataSourceOptions,\r\n  LayerOptions,\r\n  WFSDataSourceOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  MetadataLayerOptions\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-legend',\r\n  templateUrl: './legend.component.html',\r\n  styleUrls: ['./legend.component.scss']\r\n})\r\nexport class AppLegendComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            visible: true,\r\n            baseLayer: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const wfsDatasource: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        filters: {\r\n          operator: 'PropertyIsEqualTo',\r\n          propertyName: 'code_municipalite',\r\n          expression: '10043'\r\n        }\r\n      }\r\n    };\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'legend with display:false',\r\n        visible: true,\r\n        legendOptions: {\r\n          display: false,\r\n          html: 'test html'\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'sh_dis_eco',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'legend in html',\r\n        visible: true,\r\n        legendOptions: {\r\n          display: true,\r\n          html: '<h2 style=\"background-color: blue;\">HTML lgende</h2>'\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n          optionsFromCapabilities: false,\r\n          params: {\r\n            LAYERS: 'sh_sreg_eco',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'legend with url param',\r\n        visible: true,\r\n        legendOptions: {\r\n          url: `data:image/jpeg;base64,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`\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'sh_reg_eco',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasource)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptions = {\r\n          title: 'WFS ',\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Commission scolaire anglophone',\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\r\n          params: {\r\n            LAYERS: 'WMS_MEQ_CS_ANGLO',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Rseau routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'lieu habit',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'lieuhabite',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Avertissements routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'evenements',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    const datasource: WMSDataSourceOptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      refreshIntervalSec: 15,\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n        VERSION: '1.3.0'\r\n      }\r\n    };\r\n\r\n    interface LayerOptionsWithMetadata\r\n      extends LayerOptions,\r\n        MetadataLayerOptions {}\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasource)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptionsWithMetadata = {\r\n          title: 'Embcle',\r\n          visible: true,\r\n          source: dataSource,\r\n          metadata: {\r\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\r\n            extern: true\r\n          }\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\r\n  title=\"Simple Map with a legend list\"\r\n  subtitle=\"Geo\"\r\n  [dependencies]=\"['LanguageService']\"\r\n>\r\n  <app-example-viewer codeFolder=\"geo/legend\">\r\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    </igo-map-browser>\r\n\r\n    <igo-panel title=\"Legends\">\r\n      <igo-layer-legend-list\r\n        [layers]=\"map.layers\"\r\n        [excludeBaseLayers]=\"true\"\r\n        [allowShowAllLegends]=\"true\"\r\n        [updateLegendOnResolutionChange]=\"false\"\r\n        [showAllLegendsValue]=\"false\"\r\n      >\r\n      </igo-layer-legend-list>\r\n    </igo-panel>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLegendComponent } from './legend.component';\nimport { AppLegendRoutingModule } from './legend-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppLegendComponent],\n  imports: [\n    SharedModule,\n    AppLegendRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLegendComponent]\n})\nexport class AppLegendModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppOverlayComponent } from './overlay.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'overlay',\r\n    component: AppOverlayComponent\r\n  }\r\n];\r\n\r\nexport const AppOverlayRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit, AfterViewInit } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  FEATURE,\r\n  Feature,\r\n  FeatureMotion\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-overlay',\r\n  templateUrl: './overlay.component.html',\r\n  styleUrls: ['./overlay.component.scss']\r\n})\r\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\r\n  public map = new IgoMap({\r\n    overlay: true,\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    const feature1: Feature = {\r\n      type: FEATURE,\r\n      projection: 'EPSG:4326',\r\n      meta: {\r\n        id: 1\r\n      },\r\n      properties: {},\r\n      geometry: {\r\n        type: 'Point',\r\n        coordinates: [-73, 46.6]\r\n      }\r\n    };\r\n\r\n    const feature2: Feature = {\r\n      type: FEATURE,\r\n      projection: 'EPSG:4326',\r\n      meta: {\r\n        id: 2\r\n      },\r\n      properties: {},\r\n      geometry: {\r\n        type: 'LineString',\r\n        coordinates: [\r\n          [-72, 47.8],\r\n          [-73.5, 47.4],\r\n          [-72.4, 48.6]\r\n        ]\r\n      }\r\n    };\r\n\r\n    const feature3: Feature = {\r\n      type: FEATURE,\r\n      projection: 'EPSG:4326',\r\n      meta: {\r\n        id: 3\r\n      },\r\n      properties: {},\r\n      geometry: {\r\n        type: 'Polygon',\r\n        coordinates: [\r\n          [\r\n            [-71, 46.8],\r\n            [-73, 47],\r\n            [-71.2, 46.6]\r\n          ]\r\n        ]\r\n      }\r\n    };\r\n\r\n    this.map.overlay.setFeatures(\r\n      [feature1, feature2, feature3],\r\n      FeatureMotion.None\r\n    );\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Overlay\" subtitle=\"Geo\">\r\n  <app-example-viewer codeFolder=\"geo/overlay\">\r\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    </igo-map-browser>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoMapModule, IgoOverlayModule } from '@igo2/geo';\n\nimport { AppOverlayComponent } from './overlay.component';\nimport { AppOverlayRoutingModule } from './overlay-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppOverlayComponent],\n  imports: [\n    SharedModule,\n    AppOverlayRoutingModule,\n    IgoMapModule,\n    IgoOverlayModule\n  ],\n  exports: [AppOverlayComponent]\n})\nexport class AppOverlayModule {}\n","<app-doc-viewer title=\"Geometry Form\" subtitle=\"Geo\">\r\n  <app-example-viewer codeFolder=\"geo/geometry\">\r\n    <div class=\"container\">\r\n      <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n        <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n      </igo-map-browser>\r\n\r\n      <igo-form\r\n        *ngIf=\"form$ | async as form\"\r\n        [form]=\"form\"\r\n        [formData]=\"data$ | async\"\r\n        (submitForm)=\"onSubmit($event)\"\r\n      >\r\n        <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\r\n\r\n        <div formButtons class=\"actions-container\">\r\n          <button\r\n            mat-stroked-button\r\n            type=\"button\"\r\n            color=\"primary\"\r\n            (click)=\"fillForm()\"\r\n          >\r\n            Fill Form\r\n          </button>\r\n          <button\r\n            mat-stroked-button\r\n            type=\"button\"\r\n            color=\"primary\"\r\n            (click)=\"clearForm()\"\r\n          >\r\n            Clear Form\r\n          </button>\r\n          <button\r\n            mat-flat-button\r\n            type=\"submit\"\r\n            color=\"primary\"\r\n            [disabled]=\"submitDisabled\"\r\n          >\r\n            Submit\r\n          </button>\r\n        </div>\r\n      </igo-form>\r\n    </div>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppGeometryComponent } from './geometry.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'geometry',\r\n    component: AppGeometryComponent\r\n  }\r\n];\r\n\r\nexport const AppGeometryRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { Validators } from '@angular/forms';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { Form, FormService } from '@igo2/common';\r\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-geometry',\r\n  templateUrl: './geometry.component.html',\r\n  styleUrls: ['./geometry.component.scss']\r\n})\r\nexport class AppGeometryComponent implements OnInit, OnDestroy {\r\n  map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  view = {\r\n    center: [-73, 47.2],\r\n    zoom: 15\r\n  };\r\n\r\n  form$ = new BehaviorSubject<Form>(undefined);\r\n\r\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\r\n\r\n  submitDisabled = true;\r\n\r\n  private valueChanges$$: Subscription;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private formService: FormService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    const fieldConfigs = [\r\n      {\r\n        name: 'geometry',\r\n        title: 'Geometry',\r\n        options: {\r\n          validator: Validators.required\r\n        },\r\n        type: 'geometry',\r\n        inputs: {\r\n          map: this.map,\r\n          geometryTypeField: true,\r\n          geometryType: 'Polygon',\r\n          drawGuideField: true,\r\n          drawGuide: 50,\r\n          drawGuidePlaceholder: 'Draw Guide',\r\n          drawStyle: new olstyle.Style({\r\n            stroke: new olstyle.Stroke({\r\n              color: [255, 0, 0, 1],\r\n              width: 2\r\n            }),\r\n            fill: new olstyle.Fill({\r\n              color: [255, 0, 0, 0.2]\r\n            }),\r\n            image: new olstyle.Circle({\r\n              radius: 8,\r\n              stroke: new olstyle.Stroke({\r\n                color: [255, 0, 0, 1]\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: [255, 0, 0, 0.2]\r\n              })\r\n            })\r\n          })\r\n        }\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name',\r\n        options: {\r\n          validator: Validators.required\r\n        }\r\n      }\r\n    ];\r\n\r\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\r\n    const form = this.formService.form(\r\n      [],\r\n      [this.formService.group({ name: 'info' }, fields)]\r\n    );\r\n\r\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\r\n      this.submitDisabled = !form.control.valid;\r\n    });\r\n\r\n    this.form$.next(form);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.valueChanges$$.unsubscribe();\r\n  }\r\n\r\n  fillForm() {\r\n    this.data$.next({\r\n      name: 'Place',\r\n      geometry: JSON.stringify({\r\n        type: 'Polygon',\r\n        coordinates: [\r\n          [\r\n            [-106, 42],\r\n            [-107, 31],\r\n            [-81, 32],\r\n            [-82, 42],\r\n            [-106, 42]\r\n          ]\r\n        ]\r\n      })\r\n    });\r\n  }\r\n\r\n  clearForm() {\r\n    this.form$.value.control.reset();\r\n  }\r\n\r\n  onSubmit(data: { [key: string]: any }) {\r\n    alert(JSON.stringify(data));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoFormModule } from '@igo2/common';\nimport { IgoGeometryModule, IgoMapModule } from '@igo2/geo';\n\nimport { AppGeometryComponent } from './geometry.component';\nimport { AppGeometryRoutingModule } from './geometry-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppGeometryComponent],\n  imports: [\n    SharedModule,\n    AppGeometryRoutingModule,\n    IgoFormModule,\n    IgoGeometryModule,\n    IgoMapModule\n  ],\n  exports: [AppGeometryComponent]\n})\nexport class AppGeometryModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppFeatureComponent } from './feature.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'feature',\r\n    component: AppFeatureComponent\r\n  }\r\n];\r\n\r\nexport const AppFeatureRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  VectorLayer,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  FeatureMotion\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-feature',\r\n  templateUrl: './feature.component.html',\r\n  styleUrls: ['./feature.component.scss']\r\n})\r\nexport class AppFeatureComponent implements OnInit, OnDestroy {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  public tableTemplate = {\r\n    selection: true,\r\n    selectMany: true,\r\n    sort: true,\r\n    columns: [\r\n      {\r\n        name: 'properties.id',\r\n        title: 'ID'\r\n      },\r\n      {\r\n        name: 'properties.name',\r\n        title: 'Name'\r\n      },\r\n      {\r\n        name: 'properties.description',\r\n        title: 'Description'\r\n      }\r\n    ]\r\n  };\r\n\r\n  public store = new FeatureStore([], { map: this.map });\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    const loadingStrategy = new FeatureStoreLoadingStrategy({});\r\n    this.store.addStrategy(loadingStrategy);\r\n\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      map: this.map,\r\n      motion: FeatureMotion.Default\r\n    });\r\n    this.store.addStrategy(selectionStrategy);\r\n\r\n    this.store.load([\r\n      {\r\n        meta: { id: 1 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [-72, 47.8]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 1,\r\n          name: 'Name 1',\r\n          description: 'Description 1'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 4 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [-71, 46.8]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 4,\r\n          name: 'Name 4',\r\n          description: 'Description 4'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 5 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [-73, 45.8]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 5,\r\n          name: 'Name 5',\r\n          description: 'Description 5'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 2 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'LineString',\r\n          coordinates: [\r\n            [-72, 47.8],\r\n            [-73.5, 47.4],\r\n            [-72.4, 48.6]\r\n          ]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 2,\r\n          name: 'Name 2',\r\n          description: 'Description 2'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 3 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Polygon',\r\n          coordinates: [\r\n            [\r\n              [-71, 46.8],\r\n              [-73, 47],\r\n              [-71.2, 46.6]\r\n            ]\r\n          ]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 3,\r\n          name: 'Name 3',\r\n          description: 'Description 3'\r\n        }\r\n      }\r\n    ]);\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'MVT test',\r\n        visible: true,\r\n        sourceOptions: {\r\n          type: 'mvt',\r\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\r\n          queryable: true\r\n        },\r\n        igoStyle: {\r\n          mapboxStyle: {\r\n            url: 'assets/mapboxStyleExample-vectortile.json',\r\n            source: 'ahocevar'\r\n          }\r\n        }\r\n      } as any)\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'vector'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        const layer = this.layerService.createLayer({\r\n          title: 'Vector Layer',\r\n          source: dataSource,\r\n          animation: {\r\n            duration: 2000\r\n          },\r\n          igoStyle: {\r\n            mapboxStyle: {\r\n              url: 'assets/mapboxStyleExample-feature.json',\r\n              source: 'source_nameX'\r\n            }\r\n          }\r\n        }) as VectorLayer;\r\n        this.map.addLayer(layer);\r\n        this.store.bindLayer(layer);\r\n        loadingStrategy.activate();\r\n        selectionStrategy.activate();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Overlay\" subtitle=\"Feature\">\r\n  <app-example-viewer codeFolder=\"geo/feature\">\r\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    </igo-map-browser>\r\n\r\n    <igo-entity-table [store]=\"store\" [template]=\"tableTemplate\">\r\n    </igo-entity-table>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoPanelModule, IgoEntityTableModule } from '@igo2/common';\nimport { IgoMapModule, IgoFeatureModule } from '@igo2/geo';\n\nimport { AppFeatureComponent } from './feature.component';\nimport { AppFeatureRoutingModule } from './feature-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppFeatureComponent],\n  imports: [\n    SharedModule,\n    AppFeatureRoutingModule,\n    IgoPanelModule,\n    IgoEntityTableModule,\n    IgoMapModule,\n    IgoFeatureModule\n  ],\n  exports: [AppFeatureComponent]\n})\nexport class AppFeatureModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\nimport { AppHoverComponent } from './hover.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'hover',\r\n    component: AppHoverComponent\r\n  }\r\n];\r\n\r\nexport const AppHoverRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  WFSDataSourceOptions,\r\n  VectorLayerOptions,\r\n  WFSDataSource\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-hover',\r\n  templateUrl: './hover.component.html',\r\n  styleUrls: ['./hover.component.scss']\r\n})\r\nexport class AppHoverComponent {\r\n  public selected;\r\n  public pointerCoord;\r\n  public pointerCoordDelay: number = 0;\r\n  public pointerHoverFeatureDelay: number = 0;\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 8,\r\n    projection: 'EPSG:3857'\r\n  };\r\n\r\n  get media() {\r\n    return this.mediaService.getMedia();\r\n  }\r\n\r\n  get isTouchScreen() {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mediaService: MediaService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wmts',\r\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\r\n        layer: 'carte_gouv_qc_public',\r\n        matrixSet: 'EPSG_3857',\r\n        version: '1.3.0'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Quebec',\r\n            visible: true,\r\n            baseLayer: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSDataOptions extends WFSDataSourceOptions {}\r\n\r\n    const wfsDatasourcePolygon: WFSDataOptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'adn_bassin_n1_public_v',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '3.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasourcePolygon)\r\n      .subscribe((dataSource: WFSDataSource) => {\r\n        const layer: VectorLayerOptions = {\r\n          title: 'WFS (polygon)',\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    const wfsDatasourcePoint: WFSDataOptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\r\n      params: {\r\n        featureTypes: 'MSP_CASERNE_PUBLIC',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasourcePoint)\r\n      .subscribe((dataSource: WFSDataSource) => {\r\n        const layer: VectorLayerOptions = {\r\n          title: 'WFS (point)',\r\n          visible: true,\r\n          source: dataSource,\r\n          igoStyle: {\r\n            styleByAttribute: {\r\n              attribute: 'en_caserne',\r\n              data: ['true', 'false'],\r\n              stroke: ['red', 'blue'],\r\n              fill: ['#ffffff', '#ffffff'],\r\n              radius: [7, 7],\r\n              width: [2, 2]\r\n            },\r\n            hoverStyle: {\r\n              label: {\r\n                attribute: 'Caserne: ${no_caserne}\\n Mun: ${nom_ssi}',\r\n                style: {\r\n                  textAlign: 'left',\r\n                  textBaseline: 'top',\r\n                  font: '12px Calibri,sans-serif',\r\n                  fill: { color: '#000' },\r\n                  backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\r\n                  backgroundStroke: {\r\n                    color: 'rgba(200, 200, 200, 0.75)',\r\n                    width: 2\r\n                  },\r\n                  stroke: { color: '#fff', width: 3 },\r\n                  overflow: true,\r\n                  offsetX: 20,\r\n                  offsetY: 10,\r\n                  padding: [2.5, 2.5, 2.5, 2.5]\r\n                }\r\n              },\r\n              baseStyle: {\r\n                circle: {\r\n                  stroke: {\r\n                    color: 'orange',\r\n                    width: 5\r\n                  },\r\n                  width: [5],\r\n                  radius: 15\r\n                }\r\n              }\r\n            }\r\n          }\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\r\n  title=\"Hover\"\r\n  subtitle=\"Geo\"\r\n  [dependencies]=\"['LanguageService']\"\r\n>\r\n  <app-example-viewer codeFolder=\"geo/hover\">\r\n    <igo-map-browser\r\n      [map]=\"map\"\r\n      [view]=\"view\"\r\n      igoHoverFeature\r\n      [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\r\n      [igoHoverFeatureEnabled]=\"true\"\r\n    >\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n      <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\r\n      <igo-home-extent-button\r\n        [map]=\"map\"\r\n        color=\"primary\"\r\n      ></igo-home-extent-button>\r\n      <igo-rotation-button\r\n        [map]=\"map\"\r\n        [showIfNoRotation]=\"true\"\r\n        color=\"primary\"\r\n      ></igo-rotation-button>\r\n    </igo-map-browser>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMapModule } from '@igo2/geo';\r\n\r\nimport { AppHoverComponent } from './hover.component';\r\nimport { AppHoverRoutingModule } from './hover-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppHoverComponent],\r\n  imports: [SharedModule, AppHoverRoutingModule, IgoMapModule],\r\n  exports: [AppHoverComponent]\r\n})\r\nexport class AppHoverModule {}\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppMeasureComponent } from './measure.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'measure',\r\n    component: AppMeasureComponent\r\n  }\r\n];\r\n\r\nexport const AppMeasureRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  FeatureStore,\r\n  FeatureWithMeasure\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-measure',\r\n  templateUrl: './measure.component.html',\r\n  styleUrls: ['./measure.component.scss']\r\n})\r\nexport class AppMeasureComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6,\r\n    projection: 'EPSG:3857'\r\n  };\r\n\r\n  public store = new FeatureStore<FeatureWithMeasure>([], { map: this.map });\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\r\n  title=\"Measure\"\r\n  subtitle=\"Geo\"\r\n  [dependencies]=\"['LanguageService']\"\r\n>\r\n  <app-example-viewer codeFolder=\"geo/measure\">\r\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    </igo-map-browser>\r\n\r\n    <igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoMapModule, IgoMeasureModule } from '@igo2/geo';\n\nimport { AppMeasureComponent } from './measure.component';\nimport { AppMeasureRoutingModule } from './measure-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppMeasureComponent],\n  imports: [\n    AppMeasureRoutingModule,\n    SharedModule,\n    IgoMapModule,\n    IgoMeasureModule\n  ],\n  exports: [AppMeasureComponent]\n})\nexport class AppMeasureModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppDrawComponent } from './draw.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'draw',\r\n    component: AppDrawComponent\r\n  }\r\n];\r\n\r\nexport const AppDrawRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  FeatureStore,\r\n  FeatureWithDraw,\r\n  MapService\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-draw',\r\n  templateUrl: './draw.component.html',\r\n  styleUrls: ['./draw.component.scss']\r\n})\r\nexport class AppDrawComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6,\r\n    projection: 'EPSG:3857'\r\n  };\r\n\r\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mapService: MapService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\r\n  title=\"Draw\"\r\n  subtitle=\"Geo\"\r\n  [dependencies]=\"['LanguageService']\"\r\n>\r\n  <app-example-viewer codeFolder=\"geo/draw\">\r\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    </igo-map-browser>\r\n\r\n    <igo-draw [stores]=\"stores\" [map]=\"map\"></igo-draw>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMapModule, IgoDrawModule } from '@igo2/geo';\r\n\r\nimport { AppDrawComponent } from './draw.component';\r\nimport { AppDrawRoutingModule } from './draw-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppDrawComponent],\r\n  imports: [AppDrawRoutingModule, SharedModule, IgoMapModule, IgoDrawModule],\r\n  exports: [AppDrawComponent]\r\n})\r\nexport class AppDrawModule {}\r\n","<app-doc-viewer title=\"Query\" subtitle=\"Geo\" [dependencies]=\"[]\">\r\n  <app-example-viewer codeFolder=\"geo/query\">\r\n    <igo-map-browser\r\n      [map]=\"map\"\r\n      [view]=\"view\"\r\n      igoOverlay\r\n      igoQuery\r\n      [queryFeatures]=\"true\"\r\n      (query)=\"handleQueryResults($event)\"\r\n    >\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    </igo-map-browser>\r\n\r\n    <igo-panel title=\"Details\">\r\n      <ng-container *ngIf=\"features$ | async as features\">\r\n        <div *ngFor=\"let feature of features\">\r\n          <h1>\r\n            Query Title :\r\n            <span style=\"background-color: #e0e0e0\">{{\r\n              getTitle(feature)\r\n            }}</span>\r\n          </h1>\r\n          <igo-feature-details [feature]=\"feature\"></igo-feature-details>\r\n        </div>\r\n      </ng-container>\r\n    </igo-panel>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppQueryComponent } from './query.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'query',\r\n    component: AppQueryComponent\r\n  }\r\n];\r\n\r\nexport const AppQueryRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport olPoint from 'ol/geom/Point';\r\nimport olPolygon from 'ol/geom/Polygon';\r\nimport olLineString from 'ol/geom/LineString';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport {\r\n  IgoMap,\r\n  FeatureDataSource,\r\n  DataSourceService,\r\n  LayerService,\r\n  Feature,\r\n  QueryableDataSourceOptions,\r\n  QueryFormat,\r\n  QueryHtmlTarget,\r\n  SearchResult,\r\n  FeatureMotion\r\n} from '@igo2/geo';\r\n\r\nimport { getEntityTitle } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-query',\r\n  templateUrl: './query.component.html',\r\n  styleUrls: ['./query.component.scss']\r\n})\r\nexport class AppQueryComponent {\r\n  public features$ = new BehaviorSubject<Feature[]>([]);\r\n\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  constructor(\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wms',\r\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n        queryable: true,\r\n        queryTitle: 'num_rts',\r\n        params: {\r\n          layers: 'bgr_v_sous_route_res_sup_act',\r\n          version: '1.3.0'\r\n        }\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'WMS',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n      });\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wms',\r\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n        queryable: true,\r\n        queryFormat: QueryFormat.HTMLGML2,\r\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\r\n        params: {\r\n          layers: 'bgr_v_sous_route_res_sup_act',\r\n          version: '1.3.0'\r\n        }\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'WMS html with a pre call in GML',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Query url test',\r\n        visible: true,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\r\n          queryable: true,\r\n          queryUrls: [\r\n            {\r\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application/geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'\r\n            }\r\n          ],\r\n          queryLayerFeatures: false,\r\n          queryFormat: 'geojson',\r\n          params: {\r\n            layers: 'SDA_MUNIC_S_20K',\r\n            version: '1.3.0'\r\n          }\r\n        }\r\n      } as any)\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'vector',\r\n        queryable: true,\r\n        queryTitle: 'So beautiful ${name}',\r\n        sourceFields: [\r\n          { name: 'name', alias: 'Alias name' },\r\n          { name: 'description', alias: 'Alias description' }\r\n        ]\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Vector Layer',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n        this.addFeatures(dataSource as FeatureDataSource);\r\n      });\r\n  }\r\n\r\n  addFeatures(dataSource: FeatureDataSource) {\r\n    const feature1 = new olFeature({\r\n      name: 'feature1',\r\n      geometry: new olLineString([\r\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\r\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\r\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\r\n      ])\r\n    });\r\n\r\n    const feature2 = new olFeature({\r\n      name: 'feature2',\r\n      geometry: new olPoint(\r\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\r\n      )\r\n    });\r\n\r\n    const feature3 = new olFeature({\r\n      name: 'feature3',\r\n      geometry: new olPolygon([\r\n        [\r\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\r\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\r\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\r\n        ]\r\n      ])\r\n    });\r\n\r\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Vector tile with custom getfeatureinfo url',\r\n        visible: true,\r\n        sourceOptions: {\r\n          type: 'mvt',\r\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\r\n          queryable: true,\r\n          queryUrls: [\r\n            {\r\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application%2Fgeojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'\r\n            }\r\n          ],\r\n          queryLayerFeatures: false\r\n          // queryFormat: 'geojson'\r\n        },\r\n        mapboxStyle: {\r\n          url: 'assets/mapboxStyleExample-vectortile.json',\r\n          source: 'ahocevar'\r\n        }\r\n      } as any)\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wms',\r\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi',\r\n        queryable: true,\r\n        queryUrls: [\r\n          {\r\n            url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&INFO_FORMAT=geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}',\r\n            // minScale: 20000,\r\n            // maxScale: 9000000,\r\n            minResolution: 0,\r\n            maxResolution: 400\r\n          }\r\n        ],\r\n        queryFormat: 'geojson',\r\n        params: {\r\n          version: '1.3.0',\r\n          layers: 'MSP_CASERNE_PUBLIC'\r\n        }\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'WMS with custom getfeatureinfo url',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  handleQueryResults(results) {\r\n    const features: Feature[] = results.features;\r\n    if (features.length && features[0]) {\r\n      this.features$.next(features);\r\n      this.map.queryResultsOverlay.setFeatures(features, FeatureMotion.None);\r\n    }\r\n  }\r\n\r\n  getTitle(result: SearchResult) {\r\n    return getEntityTitle(result);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\n\nimport { AppQueryComponent } from './query.component';\nimport { AppQueryRoutingModule } from './query-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppQueryComponent],\n  imports: [\n    AppQueryRoutingModule,\n    SharedModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule\n  ],\n  exports: [AppQueryComponent]\n})\nexport class AppQueryModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppCatalogComponent } from './catalog.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'catalog',\r\n    component: AppCatalogComponent\r\n  }\r\n];\r\n\r\nexport const AppCatalogRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\nimport { LanguageService, ConfigService, StorageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  LayerService,\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogService,\r\n  MapService\r\n} from '@igo2/geo';\r\nimport { EntityRecord, EntityStore } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-catalog',\r\n  templateUrl: './catalog.component.html',\r\n  styleUrls: ['./catalog.component.scss']\r\n})\r\nexport class AppCatalogComponent implements OnInit {\r\n  catalog: Catalog;\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  public catalogStore = new EntityStore<Catalog>([]);\r\n\r\n  public catalogItemStore = new EntityStore<CatalogItem>([]);\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService,\r\n    private catalogService: CatalogService,\r\n    private storageService: StorageService,\r\n    private mapService: MapService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe((layer) => this.map.addLayer(layer));\r\n\r\n    this.loadCatalogs();\r\n\r\n    this.mapService.setMap(this.map);\r\n    this.catalogStore.stateView\r\n      .firstBy$(\r\n        (record: EntityRecord<Catalog>) => record.state.selected === true\r\n      )\r\n      .subscribe((record: EntityRecord<Catalog>) => {\r\n        if (record && record.entity) {\r\n          const catalog = record.entity;\r\n          this.catalog = catalog;\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\r\n   * @internal\r\n   * @param event Select event\r\n   */\r\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }) {\r\n    this.loadCatalogItems(event.catalog);\r\n  }\r\n\r\n  /**\r\n   * Get all the available catalogs from the CatalogService and\r\n   * load them into the store.\r\n   */\r\n  private loadCatalogs() {\r\n    this.catalogService.loadCatalogs().subscribe((catalogs: Catalog[]) => {\r\n      this.catalogStore.clear();\r\n      this.catalogStore.load(\r\n        catalogs.concat(\r\n          (this.storageService.get('addedCatalogs') || []) as Catalog[]\r\n        )\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the selected catalog's items from the CatalogService and\r\n   * load them into the store.\r\n   * @param catalog Selected catalog\r\n   */\r\n  private loadCatalogItems(catalog: Catalog) {\r\n    this.catalogService\r\n      .loadCatalogItems(catalog)\r\n      .subscribe((items: CatalogItem[]) => {\r\n        this.catalogItemStore.clear();\r\n        this.catalogItemStore.load(items);\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\r\n  title=\"Catalog\"\r\n  subtitle=\"Geo\"\r\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\r\n>\r\n  <app-example-viewer codeFolder=\"geo/catalog\">\r\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    </igo-map-browser>\r\n\r\n    <igo-panel title=\"Catalog Library\">\r\n      <igo-catalog-library\r\n        [store]=\"catalogStore\"\r\n        (catalogSelectChange)=\"onCatalogSelectChange($event)\"\r\n      >\r\n      </igo-catalog-library>\r\n    </igo-panel>\r\n\r\n    <igo-panel title=\"Catalog Browser\">\r\n      <igo-catalog-browser\r\n        [catalog]=\"catalog\"\r\n        [store]=\"catalogItemStore\"\r\n        [map]=\"map\"\r\n      >\r\n      </igo-catalog-browser>\r\n    </igo-panel>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoCatalogModule } from '@igo2/geo';\n\nimport { environment } from '../../../environments/environment';\nimport { AppCatalogComponent } from './catalog.component';\nimport { AppCatalogRoutingModule } from './catalog-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppCatalogComponent],\n  imports: [\n    SharedModule,\n    AppCatalogRoutingModule,\n    IgoConfigModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoCatalogModule\n  ],\n  exports: [AppCatalogComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppCatalogModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { ContextImportExportComponent } from './context-import-export/context-import-export.component';\r\nimport { IgoSpinnerModule } from '@igo2/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\n@NgModule({\r\n  imports: [\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatDividerModule,\r\n    MatTabsModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule,\r\n    IgoSpinnerModule,\r\n    MatTooltipModule\r\n  ],\r\n  exports: [ContextImportExportComponent],\r\n  declarations: [ContextImportExportComponent]\r\n})\r\nexport class IgoContextImportExportModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextImportExportModule> {\r\n    return {\r\n      ngModule: IgoContextImportExportModule\r\n    };\r\n  }\r\n}\r\n","export enum TypePermission {\n  null,\n  read,\n  write\n}\n\nexport enum Scope {\n  public,\n  protected,\n  private\n}\n","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\n\r\nimport { BehaviorSubject, Observable, of, Subject } from 'rxjs';\r\nimport {\r\n  map,\r\n  tap,\r\n  catchError,\r\n  debounceTime,\r\n  mergeMap,\r\n  first,\r\n  skip\r\n} from 'rxjs/operators';\r\n\r\nimport olPoint from 'ol/geom/Point';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport Cluster from 'ol/source/Cluster';\r\nimport olVectorSource from 'ol/source/Vector';\r\n\r\nimport { Tool } from '@igo2/common';\r\nimport { uuid, ObjectUtils } from '@igo2/utils';\r\nimport {\r\n  ConfigService,\r\n  RouteService,\r\n  Message,\r\n  MessageService,\r\n  LanguageService,\r\n  StorageService\r\n} from '@igo2/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport type {\r\n  IgoMap,\r\n  Layer,\r\n  LayerOptions,\r\n  VectorLayerOptions,\r\n  VectorTileLayerOptions\r\n} from '@igo2/geo';\r\nimport { ExportService } from '@igo2/geo';\r\n\r\nimport { TypePermission } from './context.enum';\r\nimport {\r\n  ContextsList,\r\n  ContextServiceOptions,\r\n  Context,\r\n  DetailedContext,\r\n  ContextMapView,\r\n  ContextPermission,\r\n  ContextProfils,\r\n  ExtraFeatures\r\n} from './context.interface';\r\nimport { Geometry } from 'ol/geom';\r\nimport { Feature } from 'ol';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ContextService {\r\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\r\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\r\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\r\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\r\n  public importedContext: Array<DetailedContext> = [];\r\n  public toolsChanged$ = new Subject<DetailedContext>();\r\n  private mapViewFromRoute: ContextMapView = {};\r\n  private options: ContextServiceOptions;\r\n  private baseUrl: string;\r\n\r\n  // Until the ContextService is completely refactored, this is needed\r\n  // to track the current tools\r\n  private tools: Tool[];\r\n  private toolbar: string[];\r\n\r\n  get defaultContextUri(): string {\r\n    return (\r\n      (this.storageService.get('favorite.context.uri') as string) ||\r\n      this._defaultContextUri ||\r\n      this.options.defaultContextUri\r\n    );\r\n  }\r\n  set defaultContextUri(uri: string) {\r\n    this._defaultContextUri = uri;\r\n  }\r\n  private _defaultContextUri: string;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private authService: AuthService,\r\n    private languageService: LanguageService,\r\n    private config: ConfigService,\r\n    private messageService: MessageService,\r\n    private storageService: StorageService,\r\n    private exportService: ExportService,\r\n    @Optional() private route: RouteService\r\n  ) {\r\n    this.options = Object.assign(\r\n      {\r\n        basePath: 'contexts',\r\n        contextListFile: '_contexts.json',\r\n        defaultContextUri: '_default'\r\n      },\r\n      this.config.getConfig('context')\r\n    );\r\n\r\n    this.baseUrl = this.options.url ?? '';\r\n\r\n    this.readParamsFromRoute();\r\n\r\n    if (this.authService.hasAuthService) {\r\n      this.authService.logged$.subscribe((logged) => {\r\n        if (logged) {\r\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\r\n            this.handleContextsChange();\r\n          });\r\n          this.loadContexts();\r\n        }\r\n      });\r\n    } else {\r\n      this.loadContexts();\r\n      this.handleContextsChange(false);\r\n    }\r\n  }\r\n\r\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\r\n    let url = this.baseUrl + '/contexts';\r\n    if (permissions && this.authService.authenticated) {\r\n      url += '?permission=' + permissions.join();\r\n      if (hidden) {\r\n        url += '&hidden=true';\r\n      }\r\n    }\r\n    return this.http.get<ContextsList>(url);\r\n  }\r\n\r\n  getById(id: string): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts/' + id;\r\n    return this.http.get<Context>(url);\r\n  }\r\n\r\n  getDetails(id: string): Observable<DetailedContext> {\r\n    const url = `${this.baseUrl}/contexts/${id}/details`;\r\n    return this.http.get<DetailedContext>(url).pipe(\r\n      catchError((res) => {\r\n        this.handleError(res, id);\r\n        throw res;\r\n      })\r\n    );\r\n  }\r\n\r\n  getDefault(): Observable<DetailedContext> {\r\n    if (this.authService.authenticated) {\r\n      const url = this.baseUrl + '/contexts/default';\r\n      return this.http.get<DetailedContext>(url).pipe(\r\n        tap((context) => {\r\n          this.defaultContextId$.next(context.id);\r\n        })\r\n      );\r\n    } else {\r\n      const uri = this.storageService.get('favorite.context.uri') as string;\r\n      this.defaultContextId$.next(uri);\r\n      return this.getContextByUri(uri);\r\n    }\r\n  }\r\n\r\n  getProfilByUser(): Observable<ContextProfils[]> {\r\n    if (this.baseUrl) {\r\n      const url = this.baseUrl + '/profils?';\r\n      return this.http.get<ContextProfils[]>(url);\r\n    }\r\n    return of([]);\r\n  }\r\n\r\n  setDefault(id: string): Observable<any> {\r\n    if (this.authService.authenticated) {\r\n      const url = this.baseUrl + '/contexts/default';\r\n      return this.http.post(url, { defaultContextId: id });\r\n    } else {\r\n      this.storageService.set('favorite.context.uri', id);\r\n      return of(undefined);\r\n    }\r\n  }\r\n\r\n  hideContext(id: string) {\r\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\r\n    return this.http.post(url, {});\r\n  }\r\n\r\n  showContext(id: string) {\r\n    const url = this.baseUrl + '/contexts/' + id + '/show';\r\n    return this.http.post(url, {});\r\n  }\r\n\r\n  delete(id: string, imported = false): Observable<void> {\r\n    const contexts: ContextsList = { ours: [] };\r\n    Object.keys(this.contexts$.value).forEach(\r\n      (key) =>\r\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\r\n    );\r\n\r\n    if (imported) {\r\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\r\n      return of(this.contexts$.next(contexts));\r\n    }\r\n\r\n    const url = this.baseUrl + '/contexts/' + id;\r\n    return this.http.delete<void>(url).pipe(\r\n      tap((res) => {\r\n        this.contexts$.next(contexts);\r\n      })\r\n    );\r\n  }\r\n\r\n  create(context: DetailedContext): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts';\r\n    return this.http.post<Context>(url, context).pipe(\r\n      map((contextCreated) => {\r\n        if (this.authService.authenticated) {\r\n          contextCreated.permission = TypePermission[TypePermission.write];\r\n        } else {\r\n          contextCreated.permission = TypePermission[TypePermission.read];\r\n        }\r\n        this.contexts$.value.ours.unshift(contextCreated);\r\n        this.contexts$.next(this.contexts$.value);\r\n        return contextCreated;\r\n      })\r\n    );\r\n  }\r\n\r\n  clone(id: string, properties = {}): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\r\n    return this.http.post<Context>(url, properties).pipe(\r\n      map((contextCloned) => {\r\n        contextCloned.permission = TypePermission[TypePermission.write];\r\n        this.contexts$.value.ours.unshift(contextCloned);\r\n        this.contexts$.next(this.contexts$.value);\r\n        return contextCloned;\r\n      })\r\n    );\r\n  }\r\n\r\n  update(id: string, context: Context): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts/' + id;\r\n    return this.http.patch<Context>(url, context);\r\n  }\r\n\r\n  // =================================================================\r\n\r\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\r\n    const association = {\r\n      toolId\r\n    };\r\n    return this.http.post<void>(url, association);\r\n  }\r\n\r\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\r\n    return this.http.delete(url);\r\n  }\r\n\r\n  getPermissions(id: string): Observable<ContextPermission[]> {\r\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\r\n    return this.http.get<ContextPermission[]>(url);\r\n  }\r\n\r\n  addPermissionAssociation(\r\n    contextId: string,\r\n    profil: string,\r\n    type: TypePermission\r\n  ): Observable<ContextPermission[]> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\r\n    const association = {\r\n      profil,\r\n      typePermission: type\r\n    };\r\n\r\n    return this.http.post<ContextPermission[]>(url, association).pipe(\r\n      catchError((res) => {\r\n        this.handleError(res, undefined, true);\r\n        throw [res]; // TODO Not sure about this.\r\n      })\r\n    );\r\n  }\r\n\r\n  deletePermissionAssociation(\r\n    contextId: string,\r\n    permissionId: string\r\n  ): Observable<void> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\r\n    return this.http.delete<void>(url);\r\n  }\r\n\r\n  // ======================================================================\r\n\r\n  getLocalContexts(): Observable<ContextsList> {\r\n    const url = this.getPath(this.options.contextListFile);\r\n    return this.http.get<ContextsList>(url).pipe(\r\n      map((res: any) => {\r\n        return { ours: res };\r\n      })\r\n    );\r\n  }\r\n\r\n  getLocalContext(uri: string): Observable<DetailedContext> {\r\n    const url = this.getPath(`${uri}.json`);\r\n    return this.http.get<DetailedContext>(url).pipe(\r\n      mergeMap((res) => {\r\n        if (!res.base) {\r\n          return of(res);\r\n        }\r\n        const urlBase = this.getPath(`${res.base}.json`);\r\n        return this.http.get<DetailedContext>(urlBase).pipe(\r\n          map((resBase: DetailedContext) => {\r\n            const resMerge = res;\r\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\r\n            resMerge.layers = (resBase.layers || [])\r\n              .concat(res.layers || [])\r\n              .reverse()\r\n              .filter(\r\n                (l, index, self) =>\r\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\r\n              )\r\n              .reverse();\r\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\r\n            resMerge.message = res.message || resBase.message;\r\n            resMerge.messages = res.messages || resBase.messages;\r\n            resMerge.tools = (res.tools || [])\r\n              .concat(resBase.tools || [])\r\n              .filter(\r\n                (t, index, self) =>\r\n                  self.findIndex((t2) => t2.name === t.name) === index\r\n              );\r\n            return resMerge;\r\n          }),\r\n          catchError((err) => {\r\n            this.handleError(err, uri);\r\n            throw err;\r\n          })\r\n        );\r\n      }),\r\n      catchError((err2) => {\r\n        this.handleError(err2, uri);\r\n        throw err2;\r\n      })\r\n    );\r\n  }\r\n\r\n  loadContexts(permissions?: string[], hidden?: boolean) {\r\n    let request;\r\n    if (this.baseUrl) {\r\n      request = this.get(permissions, hidden);\r\n    } else {\r\n      request = this.getLocalContexts();\r\n    }\r\n    request.subscribe((contexts) => {\r\n      contexts.ours = this.importedContext.concat(contexts.ours);\r\n      this.contexts$.next(contexts);\r\n    });\r\n  }\r\n\r\n  loadDefaultContext() {\r\n    const loadFct = (direct = false) => {\r\n      if (!direct && this.baseUrl && this.authService.authenticated) {\r\n        this.getDefault().subscribe(\r\n          (_context: DetailedContext) => {\r\n            this.defaultContextUri = _context.uri;\r\n            this.addContextToList(_context);\r\n            this.setContext(_context);\r\n          },\r\n          () => {\r\n            this.defaultContextId$.next(undefined);\r\n            this.loadContext(this.defaultContextUri);\r\n          }\r\n        );\r\n      } else {\r\n        this.loadContext(this.defaultContextUri);\r\n      }\r\n    };\r\n\r\n    if (this.route && this.route.options.contextKey) {\r\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\r\n        const contextParam = params[this.route.options.contextKey as string];\r\n        let direct = false;\r\n        if (contextParam) {\r\n          this.defaultContextUri = contextParam;\r\n          direct = true;\r\n        }\r\n        loadFct(direct);\r\n      });\r\n    } else {\r\n      loadFct();\r\n    }\r\n  }\r\n\r\n  loadContext(uri: string) {\r\n    const context = this.context$.value;\r\n\r\n    if (context && context.uri === uri) {\r\n      return;\r\n    }\r\n\r\n    this.getContextByUri(uri)\r\n      .pipe(first())\r\n      .subscribe(\r\n        (_context: DetailedContext) => {\r\n          this.addContextToList(_context);\r\n          this.setContext(_context);\r\n        },\r\n        (err) => {\r\n          if (uri !== this.options.defaultContextUri) {\r\n            this.loadContext(this.options.defaultContextUri);\r\n          }\r\n        }\r\n      );\r\n  }\r\n\r\n  setContext(context: DetailedContext) {\r\n    this.handleContextMessage(context);\r\n    const currentContext = this.context$.value;\r\n    if (currentContext && context && context.id === currentContext.id) {\r\n      if (context.map.view.keepCurrentView === undefined) {\r\n        context.map.view.keepCurrentView = true;\r\n      }\r\n      this.context$.next(context);\r\n      return;\r\n    }\r\n\r\n    if (!context.map) {\r\n      context.map = { view: {} };\r\n    }\r\n\r\n    Object.assign(context.map.view, this.mapViewFromRoute);\r\n\r\n    this.context$.next(context);\r\n  }\r\n\r\n  loadEditedContext(uri: string) {\r\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\r\n      this.setEditedContext(_context);\r\n    });\r\n  }\r\n\r\n  setEditedContext(context: DetailedContext) {\r\n    this.editedContext$.next(context);\r\n  }\r\n\r\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\r\n    const view = igoMap.ol.getView();\r\n    const proj = view.getProjection().getCode();\r\n    const center: any = new olPoint(view.getCenter()).transform(\r\n      proj,\r\n      'EPSG:4326'\r\n    );\r\n\r\n    const context = {\r\n      uri: uuid(),\r\n      title: '',\r\n      scope: 'private',\r\n      map: {\r\n        view: {\r\n          center: center.getCoordinates(),\r\n          zoom: view.getZoom(),\r\n          projection: proj,\r\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\r\n        }\r\n      },\r\n      layers: [],\r\n      tools: []\r\n    };\r\n\r\n    let layers = [];\r\n    if (empty === true) {\r\n      layers = igoMap.layers$\r\n        .getValue()\r\n        .filter(\r\n          (lay) =>\r\n            lay.baseLayer === true ||\r\n            lay.options.id === 'searchPointerSummaryId'\r\n        )\r\n        .sort((a, b) => a.zIndex - b.zIndex);\r\n    } else {\r\n      layers = igoMap.layers$\r\n        .getValue()\r\n        .filter((lay) => !lay.id.includes('WfsWorkspaceTableDest'))\r\n        .sort((a, b) => a.zIndex - b.zIndex);\r\n    }\r\n\r\n    let i = 0;\r\n    for (const l of layers) {\r\n      const layer: any = l;\r\n      const opts = {\r\n        id: layer.options.id ? String(layer.options.id) : undefined,\r\n        layerOptions: {\r\n          title: layer.options.title,\r\n          zIndex: ++i,\r\n          visible: layer.visible,\r\n          security: layer.security\r\n        } as LayerOptions,\r\n        sourceOptions: {\r\n          type: layer.dataSource.options.type,\r\n          params: layer.dataSource.options.params,\r\n          url: layer.dataSource.options.url,\r\n          queryable: layer.queryable\r\n        }\r\n      };\r\n      if (opts.sourceOptions.type) {\r\n        context.layers.push(opts);\r\n      }\r\n    }\r\n\r\n    context.tools = this.tools.map((tool) => {\r\n      return { id: String(tool.id), global: tool.global };\r\n    });\r\n\r\n    return context;\r\n  }\r\n\r\n  getContextFromLayers(\r\n    igoMap: IgoMap,\r\n    layers: Layer[],\r\n    name: string,\r\n    keepCurrentView?: boolean\r\n  ): DetailedContext {\r\n    const currentContext = this.context$.getValue();\r\n    const view = igoMap.ol.getView();\r\n    const proj = view.getProjection().getCode();\r\n    const center: any = new olPoint(view.getCenter()).transform(\r\n      proj,\r\n      'EPSG:4326'\r\n    );\r\n\r\n    const context: DetailedContext = {\r\n      uri: name,\r\n      title: name,\r\n      map: {\r\n        view: {\r\n          center: center.getCoordinates(),\r\n          zoom: view.getZoom(),\r\n          projection: proj,\r\n          keepCurrentView\r\n        }\r\n      },\r\n      layers: [],\r\n      toolbar: [],\r\n      tools: [],\r\n      extraFeatures: []\r\n    };\r\n\r\n    const currentLayers = igoMap.layers$.getValue();\r\n    context.layers = currentLayers\r\n      .filter((l) => l.baseLayer)\r\n      .map((l) => {\r\n        return {\r\n          baseLayer: true,\r\n          sourceOptions: l.options.sourceOptions,\r\n          title: l.options.title,\r\n          visible: l.visible\r\n        };\r\n      });\r\n\r\n    layers.forEach((layer) => {\r\n      // Do not seem to work properly. layerFound is always undefined.\r\n      const layerFound = currentContext.layers.find((contextLayer) => {\r\n        const source = contextLayer.source;\r\n        return source && layer.id === source.id && !contextLayer.baseLayer;\r\n      });\r\n      if (layerFound) {\r\n        let layerFoundAs = layerFound as\r\n          | VectorLayerOptions\r\n          | VectorTileLayerOptions;\r\n        let layerStyle = layerFoundAs.style;\r\n        if (layerFoundAs.igoStyle?.styleByAttribute) {\r\n          layerStyle = undefined;\r\n        } else if (layerFoundAs.igoStyle?.clusterBaseStyle) {\r\n          layerStyle = undefined;\r\n          delete layerFound.sourceOptions[`source`];\r\n          delete layerFound.sourceOptions[`format`];\r\n        }\r\n        const opts = {\r\n          baseLayer: layerFound.baseLayer,\r\n          title: layer.options.title,\r\n          zIndex: layer.zIndex,\r\n          igoStyle: {\r\n            styleByAttribute: layerFoundAs.igoStyle?.styleByAttribute,\r\n            clusterBaseStyle: layerFoundAs.igoStyle?.clusterBaseStyle\r\n          },\r\n          style: layerStyle,\r\n          clusterParam: layerFound[`clusterParam`],\r\n          visible: layer.visible,\r\n          opacity: layer.opacity,\r\n          sourceOptions: layerFound.sourceOptions\r\n        };\r\n        context.layers.push(opts);\r\n      } else {\r\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\r\n          const catalogLayer = layer.options;\r\n          catalogLayer.zIndex = layer.zIndex;\r\n          (catalogLayer.visible = layer.visible),\r\n            (catalogLayer.opacity = layer.opacity);\r\n          delete catalogLayer.source;\r\n          context.layers.push(catalogLayer);\r\n        } else {\r\n          const extraFeatures = this.getExtraFeatures(layer);\r\n          extraFeatures.name = layer.options.title;\r\n          extraFeatures.opacity = layer.opacity;\r\n          extraFeatures.visible = layer.visible;\r\n          context.extraFeatures.push(extraFeatures);\r\n        }\r\n      }\r\n    });\r\n\r\n    context.toolbar = this.toolbar;\r\n    context.tools = this.tools;\r\n\r\n    return context;\r\n  }\r\n\r\n  private getExtraFeatures(layer: Layer): ExtraFeatures {\r\n    const writer = new GeoJSON();\r\n    let olFeatures: Feature<Geometry>[];\r\n    if (layer.ol.getSource() instanceof Cluster) {\r\n      const clusterSource = layer.ol.getSource() as Cluster;\r\n      olFeatures = clusterSource.getFeatures();\r\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\r\n        cluster.get('features')\r\n      );\r\n    } else {\r\n      const source = layer.ol.getSource() as olVectorSource;\r\n      olFeatures = source.getFeatures();\r\n    }\r\n    const cleanedOlFeatures = this.exportService.generateFeature(\r\n      olFeatures,\r\n      'GeoJSON',\r\n      '_featureStore'\r\n    );\r\n    const features = writer.writeFeatures(cleanedOlFeatures, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: 'EPSG:3857'\r\n    });\r\n    return JSON.parse(features);\r\n  }\r\n\r\n  setTools(tools: Tool[]) {\r\n    this.tools = tools;\r\n  }\r\n\r\n  setToolbar(toolbar: string[]) {\r\n    this.toolbar = toolbar;\r\n  }\r\n\r\n  private handleContextMessage(context: DetailedContext) {\r\n    if (\r\n      this.context$.value &&\r\n      context.uri &&\r\n      this.context$.value.uri !== context.uri\r\n    ) {\r\n      this.messageService.removeAllAreNotError();\r\n    }\r\n\r\n    context.messages = context.messages ? context.messages : [];\r\n    context.messages.push(context.message);\r\n    context.messages.map((message) => {\r\n      if (message) {\r\n        this.messageService.message(message as Message);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getContextByUri(uri: string): Observable<DetailedContext> {\r\n    if (this.baseUrl) {\r\n      let contextToLoad;\r\n      for (const key of Object.keys(this.contexts$.value)) {\r\n        contextToLoad = this.contexts$.value[key].find((c) => {\r\n          return c.uri === uri;\r\n        });\r\n        if (contextToLoad) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (contextToLoad && contextToLoad.imported) {\r\n        return of(contextToLoad);\r\n      }\r\n\r\n      // TODO : use always id or uri\r\n      const id = contextToLoad ? contextToLoad.id : uri;\r\n      return this.getDetails(id);\r\n    }\r\n\r\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\r\n      return currentContext.uri === uri && currentContext.imported === true;\r\n    });\r\n\r\n    if (importedContext) {\r\n      return of(importedContext);\r\n    } else {\r\n      return this.getLocalContext(uri);\r\n    }\r\n  }\r\n\r\n  getContextLayers(igoMap: IgoMap) {\r\n    const layers: Layer[] = [];\r\n    const mapLayers = igoMap.layers$.getValue();\r\n    mapLayers.forEach((layer) => {\r\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\r\n        layers.push(layer);\r\n      }\r\n    });\r\n    return layers;\r\n  }\r\n\r\n  private readParamsFromRoute() {\r\n    if (!this.route) {\r\n      return;\r\n    }\r\n\r\n    this.route.queryParams.subscribe((params) => {\r\n      const centerKey = this.route.options.centerKey;\r\n      if (centerKey && params[centerKey as string]) {\r\n        const centerParams = params[centerKey as string];\r\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\r\n      }\r\n\r\n      const projectionKey = this.route.options.projectionKey;\r\n      if (projectionKey && params[projectionKey as string]) {\r\n        const projectionParam = params[projectionKey as string];\r\n        this.mapViewFromRoute.projection = projectionParam;\r\n      }\r\n\r\n      const zoomKey = this.route.options.zoomKey;\r\n      if (zoomKey && params[zoomKey as string]) {\r\n        const zoomParam = params[zoomKey as string];\r\n        this.mapViewFromRoute.zoom = Number(zoomParam);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getPath(file: string) {\r\n    const basePath = this.options.basePath.replace(/\\/$/, '');\r\n\r\n    return `${basePath}/${file}`;\r\n  }\r\n\r\n  private handleError(\r\n    error: HttpErrorResponse,\r\n    uri: string,\r\n    permissionError?: boolean\r\n  ) {\r\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\r\n    const titleContext = context ? context.title : uri;\r\n    error.error.title = this.languageService.translate.instant(\r\n      'igo.context.contextManager.invalid.title'\r\n    );\r\n\r\n    error.error.message = this.languageService.translate.instant(\r\n      'igo.context.contextManager.invalid.text',\r\n      { value: titleContext }\r\n    );\r\n\r\n    error.error.toDisplay = true;\r\n\r\n    if (permissionError) {\r\n      error.error.title = this.languageService.translate.instant(\r\n        'igo.context.contextManager.errors.addPermissionTitle'\r\n      );\r\n      error.error.message = this.languageService.translate.instant(\r\n        'igo.context.contextManager.errors.addPermission'\r\n      );\r\n    }\r\n    this.messageService.error(\r\n      'igo.context.contextManager.errors.addPermission',\r\n      'igo.context.contextManager.errors.addPermissionTitle'\r\n    );\r\n  }\r\n\r\n  private handleContextsChange(keepCurrentContext = true) {\r\n    const context = this.context$.value;\r\n    const editedContext = this.editedContext$.value;\r\n    if (!context || context.uri === this.options.defaultContextUri) {\r\n      keepCurrentContext = false;\r\n    }\r\n    if (!keepCurrentContext || !this.findContext(context)) {\r\n      this.defaultContextUri = undefined;\r\n      this.loadDefaultContext();\r\n    } else {\r\n      this.getContextByUri(context.uri)\r\n        .pipe(first())\r\n        .subscribe((newContext: DetailedContext) => {\r\n          this.toolsChanged$.next(newContext);\r\n        });\r\n\r\n      if (this.baseUrl && this.authService.authenticated) {\r\n        this.getDefault().subscribe();\r\n      }\r\n    }\r\n    const editedFound = this.findContext(editedContext);\r\n    if (!editedFound || editedFound.permission !== 'write') {\r\n      this.setEditedContext(undefined);\r\n    }\r\n  }\r\n\r\n  private addContextToList(context: Context) {\r\n    const contextFound = this.findContext(context);\r\n    if (!contextFound) {\r\n      const contextSimplifie = {\r\n        id: context.id,\r\n        uri: context.uri,\r\n        title: context.title,\r\n        scope: context.scope,\r\n        permission: TypePermission[TypePermission.read]\r\n      };\r\n\r\n      if (this.contexts$.value && this.contexts$.value.public) {\r\n        this.contexts$.value.public.push(contextSimplifie);\r\n        this.contexts$.next(this.contexts$.value);\r\n      }\r\n    }\r\n  }\r\n\r\n  private findContext(context: Context) {\r\n    if (!context) {\r\n      return false;\r\n    }\r\n\r\n    const contexts = this.contexts$.value;\r\n    let found;\r\n    for (const key of Object.keys(contexts)) {\r\n      const value = contexts[key];\r\n      found = value.find(\r\n        (c) =>\r\n          (context.id && c.id === context.id) ||\r\n          (context.uri && c.uri === context.uri)\r\n      );\r\n      if (found) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n}\r\n","import { Directive, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { filter } from 'rxjs/operators';\r\n\r\nimport {\r\n  MapViewOptions,\r\n  MapBrowserComponent,\r\n  MapControlsOptions,\r\n  MapScaleLineOptions\r\n} from '@igo2/geo';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { ContextService } from './context.service';\r\nimport { DetailedContext, ContextMapView } from './context.interface';\r\nimport { MediaService } from '@igo2/core';\r\n\r\n@Directive({\r\n  selector: '[igoMapContext]'\r\n})\r\nexport class MapContextDirective implements OnInit, OnDestroy {\r\n  private component: MapBrowserComponent;\r\n  private context$$: Subscription;\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    component: MapBrowserComponent,\r\n    private contextService: ContextService,\r\n    private mediaService: MediaService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.context$$ = this.contextService.context$\r\n      .pipe(filter((context) => context !== undefined))\r\n      .subscribe((context) => this.handleContextChange(context));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.context$$.unsubscribe();\r\n  }\r\n\r\n  private handleContextChange(context: DetailedContext) {\r\n    if (context.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    // This creates a new ol.Map when the context changes. Doing that\r\n    // allows the print tool to work properly even when the map's canvas\r\n    // has been tainted (CORS) with the layers of another context. This could\r\n    // have some side effects such as unbinding all listeners on the first map.\r\n    // A better solution would be to create a new map (preview) before\r\n    // printing and avoid the tainted canvas issue. This will come later so\r\n    // this snippet of code is kept here in case it takes too long becomes\r\n    // an issue\r\n\r\n    // const target = this.component.map.ol.getTarget();\r\n    // this.component.map.ol.setTarget(undefined);\r\n    // this.component.map.init();\r\n    // this.component.map.ol.setTarget(target);\r\n\r\n    const viewContext: ContextMapView = context.map.view;\r\n    if (\r\n      !this.component.view ||\r\n      viewContext.keepCurrentView !== true ||\r\n      context.map.view.projection !== this.map.projection\r\n    ) {\r\n      this.component.view = viewContext as MapViewOptions;\r\n    }\r\n    if (this.component.map.geolocationController) {\r\n      this.component.map.geolocationController.updateGeolocationOptions(\r\n        viewContext\r\n      );\r\n    }\r\n\r\n    const controlsContext: MapControlsOptions = context.map.controls;\r\n    if (!this.component.controls && controlsContext) {\r\n      if (this.mediaService.isMobile()) {\r\n        if (typeof controlsContext.scaleLine !== 'boolean') {\r\n          const scaleLineOption =\r\n            controlsContext.scaleLine as MapScaleLineOptions;\r\n          if (!scaleLineOption.minWidth) {\r\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\r\n            controlsContext.scaleLine = scaleLineOption;\r\n          }\r\n        }\r\n      }\r\n      this.component.controls = controlsContext;\r\n    }\r\n  }\r\n}\r\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport {\r\n  FeatureDataSource,\r\n  FeatureDataSourceOptions,\r\n  IgoMap,\r\n  VectorLayer,\r\n  QueryableDataSourceOptions,\r\n  StyleService,\r\n  StyleListService,\r\n  StyleByAttribute,\r\n  ClusterParam,\r\n  ClusterDataSourceOptions,\r\n  ClusterDataSource,\r\n  featureRandomStyle,\r\n  featureRandomStyleFunction\r\n} from '@igo2/geo';\r\nimport { MessageService } from '@igo2/core';\r\nimport {\r\n  DetailedContext,\r\n  ExtraFeatures\r\n} from '../../context-manager/shared/context.interface';\r\nimport { ContextService } from '../../context-manager/shared/context.service';\r\nimport OlFeature from 'ol/Feature';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\n\r\nexport function handleFileImportSuccess(\r\n  file: File,\r\n  context: DetailedContext,\r\n  messageService: MessageService,\r\n  contextService: ContextService\r\n) {\r\n  if (Object.keys(context).length <= 0) {\r\n    handleNothingToImportError(file, messageService);\r\n    return;\r\n  }\r\n\r\n  const contextTitle = computeLayerTitleFromFile(file);\r\n\r\n  addContextToContextList(context, contextTitle, contextService);\r\n\r\n  messageService.success(\r\n    'igo.context.contextImportExport.import.success.text',\r\n    'igo.context.contextImportExport.import.success.title',\r\n    undefined,\r\n    {\r\n      value: contextTitle\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  sizeMb?: number\r\n) {\r\n  sizeMb = sizeMb ? sizeMb : 30;\r\n  const errMapping = {\r\n    'Invalid file': handleInvalidFileImportError,\r\n    'File is too large': handleSizeFileImportError,\r\n    'Failed to read file': handleUnreadbleFileImportError\r\n  };\r\n  errMapping[error.message](file, error, messageService, sizeMb);\r\n}\r\n\r\nexport function handleInvalidFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.import.invalid.text',\r\n    'igo.context.contextImportExport.import.invalid.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      mimeType: file.type\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleSizeFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  sizeMb: number\r\n) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.import.tooLarge.text',\r\n    'igo.context.contextImportExport.import.tooLarge.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      size: sizeMb\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleUnreadbleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.import.unreadable.text',\r\n    'igo.context.contextImportExport.import.unreadable.title',\r\n    undefined,\r\n    {\r\n      value: file.name\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleNothingToImportError(\r\n  file: File,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.import.empty.text',\r\n    'igo.context.contextImportExport.import.empty.title',\r\n    undefined,\r\n    { value: file.name }\r\n  );\r\n}\r\n\r\nexport function addContextToContextList(\r\n  context: DetailedContext,\r\n  contextTitle: string,\r\n  contextService: ContextService\r\n) {\r\n  context.title = contextTitle;\r\n  context.imported = true;\r\n  contextService.contexts$.value.ours.unshift(context);\r\n  contextService.contexts$.next(contextService.contexts$.value);\r\n  contextService.importedContext.unshift(context);\r\n  contextService.loadContext(context.uri);\r\n}\r\n\r\nexport function getFileExtension(file: File): string {\r\n  return file.name.split('.').pop().toLowerCase();\r\n}\r\n\r\nexport function computeLayerTitleFromFile(file: File): string {\r\n  return file.name.substr(0, file.name.lastIndexOf('.'));\r\n}\r\n\r\nexport function addImportedFeaturesToMap(\r\n  extraFeatures: ExtraFeatures,\r\n  map: IgoMap\r\n): VectorLayer {\r\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n    type: 'vector',\r\n    queryable: true\r\n  };\r\n\r\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\r\n  const source = new FeatureDataSource(sourceOptions);\r\n  source.ol.addFeatures(olFeatures);\r\n\r\n  let randomStyle;\r\n  let editable: boolean = false;\r\n  const featureKeys = olFeatures[0]?.getKeys() ?? [];\r\n  if (featureKeys.includes('_style') || featureKeys.includes('_mapTitle')) {\r\n    randomStyle = featureRandomStyleFunction();\r\n  } else {\r\n    randomStyle = featureRandomStyle();\r\n    editable = true;\r\n  }\r\n  const layer = new VectorLayer({\r\n    title: extraFeatures.name,\r\n    isIgoInternalLayer: true,\r\n    source,\r\n    igoStyle: { editable },\r\n    style: randomStyle,\r\n    visible: extraFeatures.visible,\r\n    opacity: extraFeatures.opacity\r\n  });\r\n  map.addLayer(layer);\r\n\r\n  return layer;\r\n}\r\n\r\nexport function addImportedFeaturesStyledToMap(\r\n  extraFeatures: ExtraFeatures,\r\n  map: IgoMap,\r\n  styleListService: StyleListService,\r\n  styleService: StyleService\r\n): VectorLayer {\r\n  let style;\r\n  let distance: number;\r\n\r\n  if (styleListService.getStyleList(extraFeatures.name + '.styleByAttribute')) {\r\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\r\n      extraFeatures.name + '.styleByAttribute'\r\n    );\r\n\r\n    style = (feature, resolution) => {\r\n      return styleService.createStyleByAttribute(\r\n        feature,\r\n        styleByAttribute,\r\n        resolution\r\n      );\r\n    };\r\n  } else if (\r\n    styleListService.getStyleList(extraFeatures.name + '.clusterStyle')\r\n  ) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(\r\n      extraFeatures.name + '.clusterParam'\r\n    );\r\n    distance = styleListService.getStyleList(extraFeatures.name + '.distance');\r\n\r\n    style = (feature, resolution) => {\r\n      const baseStyle = styleService.createStyle(\r\n        styleListService.getStyleList(extraFeatures.name + '.clusterStyle'),\r\n        feature,\r\n        resolution\r\n      );\r\n      return styleService.createClusterStyle(\r\n        feature,\r\n        resolution,\r\n        clusterParam,\r\n        baseStyle\r\n      );\r\n    };\r\n  } else if (styleListService.getStyleList(extraFeatures.name + '.style')) {\r\n    style = (feature, resolution) =>\r\n      styleService.createStyle(\r\n        styleListService.getStyleList(extraFeatures.name + '.style'),\r\n        feature,\r\n        resolution\r\n      );\r\n  } else {\r\n    style = (feature, resolution) =>\r\n      styleService.createStyle(\r\n        styleListService.getStyleList('default.style'),\r\n        feature,\r\n        resolution\r\n      );\r\n  }\r\n  let source;\r\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\r\n  if (styleListService.getStyleList(extraFeatures.name + '.clusterStyle')) {\r\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        distance,\r\n        type: 'cluster',\r\n        queryable: true\r\n      };\r\n    source = new ClusterDataSource(sourceOptions);\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        type: 'vector',\r\n        queryable: true\r\n      };\r\n    source = new FeatureDataSource(sourceOptions);\r\n    source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  const layer = new VectorLayer({\r\n    title: extraFeatures.name,\r\n    isIgoInternalLayer: true,\r\n    source,\r\n    style,\r\n    opacity: extraFeatures.opacity,\r\n    visible: extraFeatures.visible\r\n  });\r\n  map.addLayer(layer);\r\n\r\n  return layer;\r\n}\r\n\r\nfunction collectFeaturesFromExtraFeatures(\r\n  featureCollection: ExtraFeatures\r\n): OlFeature<OlGeometry>[] {\r\n  const format = new GeoJSON();\r\n  const features = format.readFeatures(featureCollection, {\r\n    dataProjection: 'EPSG:4326',\r\n    featureProjection: 'EPSG:3857'\r\n  });\r\n  return features;\r\n}\r\n","import { Directive, OnInit, OnDestroy, Optional, Input } from '@angular/core';\r\n\r\nimport { Subscription, merge } from 'rxjs';\r\nimport { buffer, debounceTime, filter, first } from 'rxjs/operators';\r\n\r\nimport { RouteService, ConfigService } from '@igo2/core';\r\nimport {\r\n  MapBrowserComponent,\r\n  Layer,\r\n  LayerService,\r\n  LayerOptions,\r\n  StyleListService,\r\n  StyleService\r\n} from '@igo2/geo';\r\nimport type { IgoMap } from '@igo2/geo';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { ContextService } from './context.service';\r\nimport { DetailedContext } from './context.interface';\r\nimport {\r\n  addImportedFeaturesToMap,\r\n  addImportedFeaturesStyledToMap\r\n} from '../../context-import-export/shared/context-import.utils';\r\n\r\n@Directive({\r\n  selector: '[igoLayerContext]'\r\n})\r\nexport class LayerContextDirective implements OnInit, OnDestroy {\r\n  private context$$: Subscription;\r\n  private queryParams: any;\r\n\r\n  private contextLayers: Layer[] = [];\r\n\r\n  @Input() removeLayersOnContextChange: boolean = true;\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    private component: MapBrowserComponent,\r\n    private contextService: ContextService,\r\n    private layerService: LayerService,\r\n    private configService: ConfigService,\r\n    private styleListService: StyleListService,\r\n    private styleService: StyleService,\r\n    @Optional() private route: RouteService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.context$$ = this.contextService.context$\r\n      .pipe(filter((context) => context !== undefined))\r\n      .subscribe((context) => this.handleContextChange(context));\r\n\r\n    if (\r\n      this.route &&\r\n      this.route.options.visibleOnLayersKey &&\r\n      this.route.options.visibleOffLayersKey &&\r\n      this.route.options.contextKey\r\n    ) {\r\n      this.route.queryParams\r\n        .pipe(first((params) => !ObjectUtils.isEmpty(params)))\r\n        .subscribe((params) => {\r\n          this.queryParams = params;\r\n        });\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.context$$.unsubscribe();\r\n  }\r\n\r\n  private handleContextChange(context: DetailedContext) {\r\n    if (context.layers === undefined) {\r\n      return;\r\n    }\r\n    if (this.removeLayersOnContextChange === true) {\r\n      this.map.removeAllLayers();\r\n    } else {\r\n      this.map.removeLayers(this.contextLayers);\r\n    }\r\n    this.contextLayers = [];\r\n\r\n    const layersAndIndex$ = merge(\r\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\r\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\r\n      })\r\n    );\r\n\r\n    layersAndIndex$\r\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\r\n      .subscribe((layers: Layer[]) => {\r\n        this.handleAddLayers(layers);\r\n\r\n        if (context.extraFeatures) {\r\n          context.extraFeatures.forEach((featureCollection) => {\r\n            const importExportOptions =\r\n              this.configService.getConfig('importExport');\r\n            const importWithStyle =\r\n              importExportOptions?.importWithStyle ||\r\n              this.configService.getConfig('importWithStyle');\r\n            if (this.configService.getConfig('importWithStyle')) {\r\n              console.warn(`\r\n              The location of this config importWithStyle is deprecated.\r\n              Please move this property within importExport configuration.\r\n              Ex: importWithStyle: true/false must be transfered to importExport: { importWithStyle: true/false }\r\n              Refer to environnement.ts OR config/config.json\r\n              This legacy conversion will be deleted in 2024.\r\n              `);\r\n            }\r\n            if (!importWithStyle) {\r\n              addImportedFeaturesToMap(featureCollection, this.map);\r\n            } else {\r\n              console.log('importWithStyle', importWithStyle);\r\n              addImportedFeaturesStyledToMap(\r\n                featureCollection,\r\n                this.map,\r\n                this.styleListService,\r\n                this.styleService\r\n              );\r\n            }\r\n          });\r\n        }\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncIdbLayers(context.uri)\r\n      .pipe(debounceTime(500))\r\n      .subscribe((layers: Layer[]) => this.handleAddLayers(layers));\r\n  }\r\n\r\n  private handleAddLayers(layers: Layer[]) {\r\n    layers = layers\r\n      .filter((layer: Layer) => layer !== undefined)\r\n      .map((layer) => {\r\n        layer.visible = this.computeLayerVisibilityFromUrl(layer);\r\n        layer.zIndex = layer.zIndex;\r\n\r\n        return layer;\r\n      });\r\n    this.contextLayers.concat(layers);\r\n    this.map.addLayers(layers);\r\n  }\r\n\r\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\r\n    const params = this.queryParams;\r\n    const currentContext = this.contextService.context$.value.uri;\r\n    const currentLayerid: string = layer.id;\r\n\r\n    let visible = layer.visible;\r\n    if (!params || !currentLayerid) {\r\n      return visible;\r\n    }\r\n\r\n    const contextParams = params[this.route.options.contextKey as string];\r\n    if (contextParams === currentContext || !contextParams) {\r\n      let visibleOnLayersParams = '';\r\n      let visibleOffLayersParams = '';\r\n      let visiblelayers: string[] = [];\r\n      let invisiblelayers: string[] = [];\r\n\r\n      if (\r\n        this.route.options.visibleOnLayersKey &&\r\n        params[this.route.options.visibleOnLayersKey as string]\r\n      ) {\r\n        visibleOnLayersParams =\r\n          params[this.route.options.visibleOnLayersKey as string];\r\n      }\r\n      if (\r\n        this.route.options.visibleOffLayersKey &&\r\n        params[this.route.options.visibleOffLayersKey as string]\r\n      ) {\r\n        visibleOffLayersParams =\r\n          params[this.route.options.visibleOffLayersKey as string];\r\n      }\r\n\r\n      /* This order is important because to control whichever\r\n       the order of * param. First whe open and close everything.*/\r\n      if (visibleOnLayersParams === '*') {\r\n        visible = true;\r\n      }\r\n      if (visibleOffLayersParams === '*') {\r\n        visible = false;\r\n      }\r\n\r\n      // After, managing named layer by id (context.json OR id from datasource)\r\n      visiblelayers = visibleOnLayersParams.split(',');\r\n      invisiblelayers = visibleOffLayersParams.split(',');\r\n      if (\r\n        visiblelayers.indexOf(currentLayerid) > -1 ||\r\n        visiblelayers.indexOf(currentLayerid.toString()) > -1\r\n      ) {\r\n        visible = true;\r\n      }\r\n      if (\r\n        invisiblelayers.indexOf(currentLayerid) > -1 ||\r\n        invisiblelayers.indexOf(currentLayerid.toString()) > -1\r\n      ) {\r\n        visible = false;\r\n      }\r\n    }\r\n\r\n    return visible;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, EMPTY } from 'rxjs';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { Poi } from './poi.interface';\r\n\r\n@Injectable()\r\nexport class PoiService {\r\n  private baseUrl: string;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService\r\n  ) {\r\n    this.baseUrl = this.config.getConfig('context.url');\r\n  }\r\n\r\n  get(): Observable<Poi[]> {\r\n    if (!this.baseUrl) {\r\n      return EMPTY;\r\n    }\r\n\r\n    const url = this.baseUrl + '/pois';\r\n    return this.http.get<Poi[]>(url);\r\n  }\r\n\r\n  delete(id: string): Observable<void> {\r\n    const url = this.baseUrl + '/pois/' + id;\r\n    return this.http.delete<void>(url);\r\n  }\r\n\r\n  create(context: Poi): Observable<Poi> {\r\n    const url = this.baseUrl + '/pois';\r\n    return this.http.post<Poi>(url, context);\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoConfirmDialogModule, IgoStopPropagationModule } from '@igo2/common';\r\nimport { IgoAuthModule } from '@igo2/auth';\r\n\r\nimport { BookmarkButtonComponent } from './bookmark-button/bookmark-button.component';\r\nimport { BookmarkDialogComponent } from './bookmark-button/bookmark-dialog.component';\r\nimport { PoiButtonComponent } from './poi-button/poi-button.component';\r\nimport { PoiDialogComponent } from './poi-button/poi-dialog.component';\r\nimport { PoiService } from './poi-button/shared/poi.service';\r\nimport { UserDialogComponent } from './user-button/user-dialog.component';\r\nimport { UserButtonComponent } from './user-button/user-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IgoAuthModule,\r\n    IgoConfirmDialogModule,\r\n    IgoLanguageModule,\r\n    IgoStopPropagationModule,\r\n    MatButtonModule,\r\n    MatDialogModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatTooltipModule\r\n  ],\r\n  exports: [\r\n    BookmarkButtonComponent,\r\n    PoiButtonComponent,\r\n    UserButtonComponent,\r\n    BookmarkDialogComponent\r\n  ],\r\n  declarations: [\r\n    BookmarkButtonComponent,\r\n    BookmarkDialogComponent,\r\n    PoiButtonComponent,\r\n    PoiDialogComponent,\r\n    UserButtonComponent,\r\n    UserDialogComponent\r\n  ],\r\n  providers: [PoiService]\r\n})\r\nexport class IgoContextMapButtonModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextMapButtonModule> {\r\n    return {\r\n      ngModule: IgoContextMapButtonModule\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoAuthModule } from '@igo2/auth';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoListModule,\r\n  IgoKeyValueModule,\r\n  IgoCollapsibleModule,\r\n  IgoStopPropagationModule,\r\n  IgoActionbarModule\r\n} from '@igo2/common';\r\n\r\nimport { MapContextDirective } from './shared/map-context.directive';\r\nimport { LayerContextDirective } from './shared/layer-context.directive';\r\nimport { ContextListComponent } from './context-list/context-list.component';\r\nimport { ContextListBindingDirective } from './context-list/context-list-binding.directive';\r\nimport { ContextItemComponent } from './context-item/context-item.component';\r\nimport { ContextFormComponent } from './context-form/context-form.component';\r\nimport { ContextEditComponent } from './context-edit/context-edit.component';\r\nimport { ContextEditBindingDirective } from './context-edit/context-edit-binding.directive';\r\nimport { ContextPermissionsComponent } from './context-permissions/context-permissions.component';\r\nimport { ContextPermissionsBindingDirective } from './context-permissions/context-permissions-binding.directive';\r\nimport { IgoContextMapButtonModule } from '../context-map-button/context-map-button.module';\r\nimport { IgoContextImportExportModule } from '../context-import-export/context-import-export.module';\r\n\r\nconst CONTEXT_DIRECTIVES = [MapContextDirective, LayerContextDirective];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    MatListModule,\r\n    MatCheckboxModule,\r\n    MatRadioModule,\r\n    MatDialogModule,\r\n    MatMenuModule,\r\n    MatOptionModule,\r\n    MatAutocompleteModule,\r\n    IgoAuthModule,\r\n    IgoListModule,\r\n    IgoKeyValueModule,\r\n    IgoCollapsibleModule,\r\n    IgoStopPropagationModule,\r\n    IgoLanguageModule,\r\n    IgoContextImportExportModule,\r\n    IgoContextMapButtonModule,\r\n    IgoActionbarModule\r\n  ],\r\n  exports: [\r\n    ContextListComponent,\r\n    ContextListBindingDirective,\r\n    ContextItemComponent,\r\n    ContextFormComponent,\r\n    ContextEditComponent,\r\n    ContextEditBindingDirective,\r\n    ContextPermissionsComponent,\r\n    ContextPermissionsBindingDirective,\r\n\r\n    ...CONTEXT_DIRECTIVES\r\n  ],\r\n  declarations: [\r\n    ContextListComponent,\r\n    ContextListBindingDirective,\r\n    ContextItemComponent,\r\n    ContextFormComponent,\r\n    ContextEditComponent,\r\n    ContextEditBindingDirective,\r\n    ContextPermissionsComponent,\r\n    ContextPermissionsBindingDirective,\r\n\r\n    ...CONTEXT_DIRECTIVES\r\n  ]\r\n})\r\nexport class IgoContextManagerModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextManagerModule> {\r\n    return {\r\n      ngModule: IgoContextManagerModule\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ShareMapComponent } from './share-map/share-map.component';\nimport { ShareMapUrlComponent } from './share-map/share-map-url.component';\nimport { ShareMapApiComponent } from './share-map/share-map-api.component';\nimport { IgoCustomHtmlModule } from '@igo2/common';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatTabsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoCustomHtmlModule\n  ],\n  exports: [ShareMapComponent, ShareMapUrlComponent, ShareMapApiComponent],\n  declarations: [ShareMapComponent, ShareMapUrlComponent, ShareMapApiComponent]\n})\nexport class IgoShareMapModule {\n  static forRoot(): ModuleWithProviders<IgoShareMapModule> {\n    return {\n      ngModule: IgoShareMapModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoPanelModule, IgoFlexibleModule } from '@igo2/common';\nimport { IgoFeatureModule } from '@igo2/geo';\n\nimport { IgoContextManagerModule } from '../context-manager/context-manager.module';\nimport { SidenavComponent } from './sidenav.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSidenavModule,\n    MatTooltipModule,\n    IgoLanguageModule,\n    IgoPanelModule,\n    IgoFlexibleModule,\n    IgoFeatureModule,\n    IgoContextManagerModule\n  ],\n  exports: [SidenavComponent],\n  declarations: [SidenavComponent]\n})\nexport class IgoSidenavModule {\n  static forRoot(): ModuleWithProviders<IgoSidenavModule> {\n    return {\n      ngModule: IgoSidenavModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\n\nimport { IgoContextImportExportModule } from './context-import-export/context-import-export.module';\nimport { IgoContextManagerModule } from './context-manager/context-manager.module';\nimport { IgoContextMapButtonModule } from './context-map-button/context-map-button.module';\nimport { IgoShareMapModule } from './share-map/share-map.module';\nimport { IgoSidenavModule } from './sidenav/sidenav.module';\n\n@NgModule({\n  imports: [MatInputModule, MatFormFieldModule, MatMenuModule],\n  declarations: [],\n  exports: [\n    IgoContextImportExportModule,\n    IgoContextManagerModule,\n    IgoContextMapButtonModule,\n    IgoShareMapModule,\n    IgoSidenavModule\n  ]\n})\nexport class IgoContextModule {\n  static forRoot(): ModuleWithProviders<IgoContextModule> {\n    return {\n      ngModule: IgoContextModule,\n      providers: []\n    };\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid context');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\r\nimport { ExportNothingToExportError } from './context-export.errors';\r\nimport { Observer, Observable } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ContextExportService {\r\n  export(res: DetailedContext): Observable<void> {\r\n    return this.exportAsync(res);\r\n  }\r\n\r\n  protected exportAsync(res: DetailedContext): Observable<void> {\r\n    const doExport = (observer: Observer<void>) => {\r\n      const nothingToExport = this.nothingToExport(res);\r\n      if (nothingToExport === true) {\r\n        observer.error(new ExportNothingToExportError());\r\n        return;\r\n      }\r\n      const contextJSON = JSON.stringify(res);\r\n      downloadContent(\r\n        contextJSON,\r\n        'text/json;charset=utf-8',\r\n        `${res.uri}.json`\r\n      );\r\n      observer.complete();\r\n    };\r\n    return new Observable(doExport);\r\n  }\r\n\r\n  protected nothingToExport(res: DetailedContext): boolean {\r\n    if (res.map === undefined) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","export class ImportError extends Error {}\r\n\r\nexport class ImportInvalidFileError extends ImportError {\r\n  constructor() {\r\n    super('Invalid file');\r\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportUnreadableFileError extends ImportError {\r\n  constructor() {\r\n    super('Failed to read file');\r\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportNothingToImportError extends ImportError {\r\n  constructor() {\r\n    super('Nothing to import');\r\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSizeError extends ImportError {\r\n  constructor() {\r\n    super('File is too large');\r\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSRSError extends ImportError {\r\n  constructor() {\r\n    super('Invalid SRS definition');\r\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\nimport { Observable, Observer } from 'rxjs';\nimport { ConfigService } from '@igo2/core';\n\nimport {\n  ImportInvalidFileError,\n  ImportUnreadableFileError,\n  ImportSizeError\n} from './context-import.errors';\nimport { getFileExtension } from './context-import.utils';\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextImportService {\n  static allowedMimeTypes = ['application/json'];\n\n  static allowedExtensions = 'json';\n\n  private clientSideFileSizeMax: number;\n\n  constructor(private config: ConfigService) {\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n  }\n\n  import(file: File): Observable<DetailedContext> {\n    return this.importAsync(file);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<DetailedContext>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n    const allowedMimeTypes = [...ContextImportService.allowedMimeTypes];\n    const allowedExtensions = ContextImportService.allowedExtensions;\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      extension === ContextImportService.allowedExtensions\n    ) {\n      return this.importFile;\n    }\n    return undefined;\n  }\n\n  private importAsync(file: File): Observable<DetailedContext> {\n    const doImport = (observer: Observer<DetailedContext>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(file: File, observer: Observer<DetailedContext>) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const context = this.parseContextFromFile(file, event.target.result);\n        observer.next(context);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = (evt) => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private parseContextFromFile(file: File, data: string): DetailedContext {\n    const context: DetailedContext = JSON.parse(data);\n    return context;\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\r\n  <mat-button-toggle-group\r\n    [value]=\"activeImportExport\"\r\n    (change)=\"onImportExportChange($event)\"\r\n  >\r\n    <mat-button-toggle [value]=\"'import'\">\r\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle [value]=\"'export'\">\r\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\r\n    </mat-button-toggle>\r\n  </mat-button-toggle-group>\r\n</div>\r\n\r\n<div *ngIf=\"activeImportExport === 'import'\">\r\n  <form class=\"igo-form\">\r\n    <div class=\"igo-form-button-group\">\r\n      <button\r\n        mat-raised-button\r\n        type=\"button\"\r\n        (click)=\"fileInput.click()\"\r\n        [disabled]=\"loading$ | async\"\r\n      >\r\n        {{ 'igo.geo.importExportForm.importButton' | translate }}\r\n      </button>\r\n      <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\r\n      <input\r\n        #fileInput\r\n        type=\"file\"\r\n        [style.display]=\"'none'\"\r\n        (click)=\"fileInput.value = null\"\r\n        (change)=\"importFiles($event.target.files)\"\r\n      />\r\n    </div>\r\n  </form>\r\n  <section class=\"mat-typography\">\r\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\r\n    <ul>\r\n      <li>\r\n        {{\r\n          'igo.geo.importExportForm.importSizeMax'\r\n            | translate: { size: fileSizeMb }\r\n        }}\r\n      </li>\r\n    </ul>\r\n  </section>\r\n</div>\r\n\r\n<form\r\n  class=\"igo-form\"\r\n  *ngIf=\"activeImportExport === 'export'\"\r\n  [formGroup]=\"form\"\r\n>\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field class=\"example-full-width\">\r\n      <mat-label>{{\r\n        'igo.context.contextImportExport.export.exportContextName' | translate\r\n      }}</mat-label>\r\n      <input formControlName=\"name\" matInput [value]=\"\" />\r\n    </mat-form-field>\r\n  </div>\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <mat-label>{{\r\n        'igo.context.contextImportExport.export.exportPlaceHolder' | translate\r\n      }}</mat-label>\r\n      <mat-select formControlName=\"layers\" multiple>\r\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\r\n          {{\r\n            'igo.context.contextImportExport.export.exportSelectAll' | translate\r\n          }}\r\n        </mat-option>\r\n        <mat-divider></mat-divider>\r\n        <mat-option\r\n          *ngFor=\"let layer of userControlledLayerList\"\r\n          [value]=\"layer\"\r\n          >{{ layer.title }}</mat-option\r\n        >\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n  <div class=\"igo-form-button-group\">\r\n    <button\r\n      mat-raised-button\r\n      type=\"button\"\r\n      [disabled]=\"!form.valid || (loading$ | async)\"\r\n      (click)=\"handleExportFormSubmit(form.value)\"\r\n    >\r\n      {{ 'igo.geo.importExportForm.exportButton' | translate }}\r\n    </button>\r\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\r\n  </div>\r\n</form>\r\n","import { Component, Input, OnInit, OnDestroy } from '@angular/core';\r\nimport {\r\n  UntypedFormGroup,\r\n  UntypedFormBuilder,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { MessageService, ConfigService } from '@igo2/core';\r\nimport { Layer, VectorLayer } from '@igo2/geo';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { handleFileExportError } from '../shared/context-export.utils';\r\nimport {\r\n  handleFileImportSuccess,\r\n  handleFileImportError\r\n} from '../shared/context-import.utils';\r\nimport { handleFileExportSuccess } from '../shared/context-export.utils';\r\nimport { ContextService } from '../../context-manager/shared/context.service';\r\nimport { ContextImportService } from '../shared/context-import.service';\r\nimport { ContextExportService } from '../shared/context-export.service';\r\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\r\n\r\n@Component({\r\n  selector: 'igo-context-import-export',\r\n  templateUrl: './context-import-export.component.html',\r\n  styleUrls: ['./context-import-export.component.scss']\r\n})\r\nexport class ContextImportExportComponent implements OnInit, OnDestroy {\r\n  public form: UntypedFormGroup;\r\n  public layers: VectorLayer[];\r\n  public inputProj: string = 'EPSG:4326';\r\n  public loading$ = new BehaviorSubject(false);\r\n  public forceNaming = false;\r\n  public layerList: Layer[];\r\n  public userControlledLayerList: Layer[];\r\n  public res: DetailedContext;\r\n  private clientSideFileSizeMax: number;\r\n  public fileSizeMb: number;\r\n  public activeImportExport: string = 'import';\r\n\r\n  private layers$$: Subscription;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  constructor(\r\n    private contextImportService: ContextImportService,\r\n    private contextExportService: ContextExportService,\r\n    private messageService: MessageService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private config: ConfigService,\r\n    private contextService: ContextService\r\n  ) {\r\n    this.buildForm();\r\n  }\r\n\r\n  ngOnInit() {\r\n    const configFileSizeMb = this.config.getConfig(\r\n      'importExport.clientSideFileSizeMaxMb'\r\n    );\r\n    this.clientSideFileSizeMax =\r\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\r\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\r\n    this.layers$$ = this.map.layers$.subscribe(() => {\r\n      this.layerList = this.contextService.getContextLayers(this.map);\r\n      this.userControlledLayerList = this.layerList.filter(\r\n        (layer) => layer.showInLayerList\r\n      );\r\n    });\r\n  }\r\n\r\n  importFiles(files: File[]) {\r\n    this.loading$.next(true);\r\n    for (const file of files) {\r\n      this.contextImportService\r\n        .import(file)\r\n        .pipe(take(1))\r\n        .subscribe(\r\n          (context: DetailedContext) => this.onFileImportSuccess(file, context),\r\n          (error: Error) => this.onFileImportError(file, error),\r\n          () => {\r\n            this.loading$.next(false);\r\n          }\r\n        );\r\n    }\r\n  }\r\n\r\n  handleExportFormSubmit(contextOptions) {\r\n    this.loading$.next(true);\r\n    this.res = this.contextService.getContextFromLayers(\r\n      this.map,\r\n      contextOptions.layers,\r\n      contextOptions.name,\r\n      false\r\n    );\r\n    this.res.imported = true;\r\n    this.contextExportService\r\n      .export(this.res)\r\n      .pipe(take(1))\r\n      .subscribe(\r\n        () => {},\r\n        (error: Error) => this.onFileExportError(error),\r\n        () => {\r\n          this.onFileExportSuccess();\r\n          this.loading$.next(false);\r\n        }\r\n      );\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      layers: ['', [Validators.required]],\r\n      name: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  private onFileImportSuccess(file: File, context: DetailedContext) {\r\n    handleFileImportSuccess(\r\n      file,\r\n      context,\r\n      this.messageService,\r\n      this.contextService\r\n    );\r\n  }\r\n\r\n  private onFileImportError(file: File, error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\r\n  }\r\n\r\n  private onFileExportError(error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileExportError(error, this.messageService);\r\n  }\r\n\r\n  private onFileExportSuccess() {\r\n    handleFileExportSuccess(this.messageService);\r\n  }\r\n\r\n  selectAll(e) {\r\n    if (e._selected) {\r\n      this.form.controls.layers.setValue(this.userControlledLayerList);\r\n      e._selected = true;\r\n    }\r\n    if (e._selected === false) {\r\n      this.form.controls.layers.setValue([]);\r\n    }\r\n  }\r\n\r\n  onImportExportChange(event) {\r\n    this.activeImportExport = event.value;\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n}\r\n","import { MessageService } from '@igo2/core';\r\nimport { ExportNothingToExportError } from './context-export.errors';\r\n\r\nexport function handleFileExportError(\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  if (error instanceof ExportNothingToExportError) {\r\n    this.handleNothingToExportError(messageService);\r\n    return;\r\n  }\r\n  messageService.error(\r\n    'igo.context.contextImportExport.export.failed.text',\r\n    'igo.context.contextImportExport.export.failed.title'\r\n  );\r\n}\r\n\r\nexport function handleFileExportSuccess(messageService: MessageService) {\r\n  messageService.success(\r\n    'igo.context.contextImportExport.export.success.text',\r\n    'igo.context.contextImportExport.export.success.title'\r\n  );\r\n}\r\n\r\nexport function handleNothingToExportError(messageService: MessageService) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.export.nothing.text',\r\n    'igo.context.contextImportExport.export.nothing.title'\r\n  );\r\n}\r\n","export enum ContextListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-bookmark-dialog',\n  templateUrl: './bookmark-dialog.component.html'\n})\nexport class BookmarkDialogComponent {\n  public title: string;\n\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\r\n  {{ 'igo.context.bookmarkButton.dialog.title' | translate }}\r\n</h1>\r\n<div mat-dialog-content class=\"mat-typography\">\r\n  <mat-form-field>\r\n    <input\r\n      matInput\r\n      required\r\n      autocomplete=\"off\"\r\n      maxlength=\"128\"\r\n      [placeholder]=\"\r\n        'igo.context.bookmarkButton.dialog.placeholder' | translate\r\n      \"\r\n      [(ngModel)]=\"title\"\r\n    />\r\n  </mat-form-field>\r\n</div>\r\n<div mat-dialog-actions>\r\n  <button\r\n    mat-button\r\n    color=\"primary\"\r\n    [disabled]=\"!title\"\r\n    (click)=\"dialogRef.close(title)\"\r\n  >\r\n    {{ 'igo.common.confirmDialog.confirmBtn' | translate }}\r\n  </button>\r\n  <button mat-button (click)=\"dialogRef.close(false)\">\r\n    {{ 'igo.common.confirmDialog.cancelBtn' | translate }}\r\n  </button>\r\n</div>\r\n","<mat-list-item\n  class=\"mat-list-item\"\n  [ngClass]=\"{ 'mat-list-item-light': hidden }\"\n>\n  <button\n    *ngIf=\"auth.authenticated\"\n    matListItemAvatar\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"\n      auth.authenticated\n        ? ('igo.context.contextManager.favorite' | translate)\n        : ''\n    \"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon\n      *ngIf=\"!context.iconImage\"\n      svgIcon=\"{{\n        context.icon\n          ? context.icon\n          : context.scope === 'public'\n          ? 'earth'\n          : 'star'\n      }}\"\n    ></mat-icon>\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\" />\n  </button>\n  <button\n    matListItemAvatar\n    *ngIf=\"!auth.authenticated && showFavorite\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"'igo.context.contextManager.favorite' | translate\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon svgIcon=\"star\"></mat-icon>\n  </button>\n  <span matListItemTitle>{{ context.title }}</span>\n\n  <div\n    *ngIf=\"auth.authenticated\"\n    matListItemMeta\n    igoStopPropagation\n    class=\"igo-actions-container\"\n  >\n    <button\n      *ngIf=\"\n        collapsed &&\n        selected &&\n        (context.permission === typePermission[typePermission.write] ||\n          context.imported)\n      \"\n      class=\"save-button\"\n      mat-icon-button\n      [matTooltip]=\"'igo.context.contextManager.save' | translate\"\n      matTooltipShowDelay=\"500\"\n      [color]=\"color\"\n      (click)=\"save.emit(context)\"\n    >\n      <mat-icon svgIcon=\"content-save\"></mat-icon>\n    </button>\n\n    <div #actions class=\"igo-actions-expand-container\">\n      <button\n        *ngIf=\"canShare && !context.imported\"\n        mat-icon-button\n        [matTooltip]=\"\n          'igo.context.contextManager.managePermissions' | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"managePermissions.emit(context)\"\n      >\n        <mat-icon svgIcon=\"account-arrow-right\"></mat-icon>\n      </button>\n\n      <!--button\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.manageTools' | translate\"\n        [color]=\"color\"\n        (click)=\"manageTools.emit(context)\">\n        <mat-icon svgIcon=\"widgets\"></mat-icon>\n      </button-->\n\n      <button\n        *ngIf=\"!context.imported\"\n        class=\"clone-button\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"clone.emit(context)\"\n      >\n        <mat-icon svgIcon=\"content-copy\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] &&\n          !context.imported\n        \"\n        class=\"edit-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"edit.emit(context)\"\n      >\n        <mat-icon svgIcon=\"pencil\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"!context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"hide.emit(context)\"\n      >\n        <mat-icon svgIcon=\"eye\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"show.emit(context)\"\n      >\n        <mat-icon svgIcon=\"eye-off\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] ||\n          context.imported\n        \"\n        class=\"delete-button\"\n        mat-icon-button\n        color=\"warn\"\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"delete.emit(context)\"\n      >\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n\n    <button\n      class=\"actions-button\"\n      mat-icon-button\n      igoCollapse\n      [color]=\"color\"\n      [target]=\"actions\"\n      [collapsed]=\"collapsed\"\n      (click)=\"collapsed = !collapsed\"\n    >\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { TypePermission } from '../shared/context.enum';\nimport { DetailedContext } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-item',\n  templateUrl: './context-item.component.html',\n  styleUrls: ['./context-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextItemComponent {\n  public typePermission = TypePermission;\n  public color = 'primary';\n  public collapsed = true;\n\n  @Input() showFavorite: boolean = true;\n  @Input() context: DetailedContext;\n  @Input() default: boolean;\n  @Input() selected: boolean;\n\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n\n  get hidden(): boolean {\n    return this.context.hidden;\n  }\n\n  get canShare(): boolean {\n    return this.storageService.get('canShare') === true;\n  }\n\n  constructor(\n    public auth: AuthService,\n    private storageService: StorageService\n  ) {}\n\n  favoriteClick(context: DetailedContext) {\n    this.favorite.emit(context);\n  }\n}\n","<igo-list [navigation]=\"true\">\r\n  <div class=\"context-filter-container\">\r\n    <mat-form-field *ngIf=\"showFilter()\" floatLabel=\"always\">\r\n      <mat-label>{{\r\n        'igo.context.contextManager.filterPlaceHolder' | translate\r\n      }}</mat-label>\r\n      <input\r\n        matInput\r\n        type=\"text\"\r\n        [placeholder]=\"\r\n          'igo.context.contextManager.filterPlaceHolder' | translate\r\n        \"\r\n        [(ngModel)]=\"term\"\r\n      />\r\n      <button\r\n        mat-icon-button\r\n        matSuffix\r\n        class=\"clear-button\"\r\n        *ngIf=\"term.length\"\r\n        aria-label=\"Clear\"\r\n        color=\"warn\"\r\n        (click)=\"clearFilter()\"\r\n      >\r\n        <mat-icon svgIcon=\"close\"></mat-icon>\r\n      </button>\r\n    </mat-form-field>\r\n\r\n    <div class=\"actions-container\">\r\n      <button\r\n        *ngIf=\"!sortedAlpha\"\r\n        class=\"sort-alpha\"\r\n        mat-icon-button\r\n        [matTooltip]=\"\r\n          'igo.context.contextManager.sortAlphabetically' | translate\r\n        \"\r\n        matTooltipShowDelay=\"500\"\r\n        (click)=\"toggleSort(true)\"\r\n      >\r\n        <mat-icon\r\n          color=\"primary\"\r\n          svgIcon=\"sort-alphabetical-variant\"\r\n        ></mat-icon>\r\n      </button>\r\n      <button\r\n        *ngIf=\"sortedAlpha\"\r\n        class=\"sort-alpha\"\r\n        mat-icon-button\r\n        [matTooltip]=\"'igo.context.contextManager.sortContextOrder' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        (click)=\"toggleSort(false)\"\r\n      >\r\n        <mat-icon color=\"warn\" svgIcon=\"sort-variant-remove\"></mat-icon>\r\n      </button>\r\n\r\n      <igo-actionbar\r\n        *ngIf=\"auth.authenticated && configService.getConfig('context')\"\r\n        class=\"add-context-button\"\r\n        [iconColor]=\"color\"\r\n        [store]=\"actionStore\"\r\n        [withIcon]=\"true\"\r\n        icon=\"plus\"\r\n        [withTitle]=\"actionbarMode === 'overlay'\"\r\n        [horizontal]=\"false\"\r\n        [mode]=\"actionbarMode\"\r\n      >\r\n      </igo-actionbar>\r\n\r\n      <button\r\n        *ngIf=\"auth.authenticated && configService.getConfig('context')\"\r\n        class=\"users-filter\"\r\n        mat-icon-button\r\n        [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matMenuTriggerFor]=\"accountMenu\"\r\n      >\r\n        <mat-icon color=\"primary\" svgIcon=\"filter-menu\"></mat-icon>\r\n      </button>\r\n      <mat-menu #accountMenu=\"matMenu\">\r\n        <ng-container *ngFor=\"let user of users\">\r\n          <span class=\"profilsMenu\">\r\n            <div mat-menu-item>\r\n              <mat-checkbox\r\n                [checked]=\"getPermission(user).checked\"\r\n                [indeterminate]=\"getPermission(user).indeterminate\"\r\n                (click)=\"$event.stopPropagation()\"\r\n                (change)=\"userSelection(user)\"\r\n              >\r\n              </mat-checkbox>\r\n            </div>\r\n            <button\r\n              *ngIf=\"user.childs\"\r\n              [matMenuTriggerFor]=\"subAccountMenu\"\r\n              mat-menu-item\r\n            >\r\n              {{ user.title }}\r\n            </button>\r\n            <button mat-menu-item *ngIf=\"!user.childs\">\r\n              {{ user.title }}\r\n            </button>\r\n          </span>\r\n\r\n          <mat-menu #subAccountMenu=\"matMenu\">\r\n            <div mat-menu-item>\r\n              <mat-checkbox\r\n                *ngFor=\"let child of user.childs\"\r\n                [checked]=\"getPermission(child).checked\"\r\n                (click)=\"$event.stopPropagation()\"\r\n                (change)=\"userSelection(child, user)\"\r\n              >\r\n                {{ child.title }}\r\n              </mat-checkbox>\r\n            </div>\r\n          </mat-menu>\r\n        </ng-container>\r\n\r\n        <span class=\"profilsMenu\">\r\n          <div mat-menu-item>\r\n            <mat-checkbox\r\n              [checked]=\"showHidden\"\r\n              (click)=\"$event.stopPropagation()\"\r\n              (change)=\"showHiddenContexts.emit()\"\r\n            >\r\n            </mat-checkbox>\r\n          </div>\r\n          <button mat-menu-item>\r\n            {{ 'igo.context.contextManager.showHidden' | translate }}\r\n          </button>\r\n        </span>\r\n      </mat-menu>\r\n    </div>\r\n  </div>\r\n\r\n  <ng-template ngFor let-groupContexts [ngForOf]=\"contexts$ | async | keyvalue\">\r\n    <igo-collapsible\r\n      *ngIf=\"groupContexts.value.length && auth.authenticated\"\r\n      [title]=\"titleMapping[groupContexts.key] | translate\"\r\n      [collapsed]=\"collapsed[titleMapping[groupContexts.key]]\"\r\n      (toggle)=\"collapsed[titleMapping[groupContexts.key]] = $event\"\r\n    >\r\n      <ng-template ngFor let-context [ngForOf]=\"groupContexts.value\">\r\n        <igo-context-item\r\n          igoListItem\r\n          color=\"accent\"\r\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\r\n          [context]=\"context\"\r\n          [default]=\"\r\n            context.id &&\r\n            this.defaultContextId &&\r\n            this.defaultContextId === context.id\r\n          \"\r\n          (edit)=\"edit.emit(context)\"\r\n          (delete)=\"delete.emit(context)\"\r\n          (clone)=\"clone.emit(context)\"\r\n          (save)=\"save.emit(context)\"\r\n          (hide)=\"hideContext(context)\"\r\n          (show)=\"showContext(context)\"\r\n          (favorite)=\"favorite.emit(context)\"\r\n          (manageTools)=\"manageTools.emit(context)\"\r\n          (managePermissions)=\"managePermissions.emit(context)\"\r\n          (select)=\"select.emit(context)\"\r\n          (unselect)=\"unselect.emit(context)\"\r\n        >\r\n        </igo-context-item>\r\n      </ng-template>\r\n    </igo-collapsible>\r\n\r\n    <ng-template\r\n      *ngIf=\"groupContexts.value.length && !auth.authenticated\"\r\n      ngFor\r\n      let-context\r\n      [ngForOf]=\"groupContexts.value\"\r\n    >\r\n      <igo-context-item\r\n        igoListItem\r\n        color=\"accent\"\r\n        [showFavorite]=\"\r\n          configService.getConfig('favoriteContext4NonAuthenticated')\r\n        \"\r\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\r\n        [context]=\"context\"\r\n        [default]=\"\r\n          configService.getConfig('context')\r\n            ? defaultContextId === context.id\r\n            : defaultContextId === context.uri\r\n        \"\r\n        (favorite)=\"favorite.emit(context)\"\r\n        (select)=\"select.emit(context)\"\r\n        (unselect)=\"unselect.emit(context)\"\r\n      >\r\n      </igo-context-item>\r\n    </ng-template>\r\n  </ng-template>\r\n</igo-list>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  ChangeDetectionStrategy,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport {\r\n  DetailedContext,\r\n  ContextsList,\r\n  ContextUserPermission,\r\n  ContextProfils\r\n} from '../shared/context.interface';\r\nimport { ContextListControlsEnum } from './context-list.enum';\r\nimport {\r\n  Subscription,\r\n  BehaviorSubject,\r\n  ReplaySubject,\r\n  EMPTY,\r\n  timer\r\n} from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\r\nimport { debounce } from 'rxjs/operators';\r\nimport { ActionStore, ActionbarMode } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'igo-context-list',\r\n  templateUrl: './context-list.component.html',\r\n  styleUrls: ['./context-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContextListComponent implements OnInit, OnDestroy {\r\n  private contextsInitial: ContextsList = { ours: [] };\r\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\r\n    this.contextsInitial\r\n  );\r\n\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  private change$$: Subscription;\r\n\r\n  @Input()\r\n  get contexts(): ContextsList {\r\n    return this._contexts;\r\n  }\r\n  set contexts(value: ContextsList) {\r\n    this._contexts = value;\r\n    this.cdRef.detectChanges();\r\n    this.next();\r\n  }\r\n  private _contexts: ContextsList = { ours: [] };\r\n\r\n  @Input()\r\n  get selectedContext(): DetailedContext {\r\n    return this._selectedContext;\r\n  }\r\n  set selectedContext(value: DetailedContext) {\r\n    this._selectedContext = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n  private _selectedContext: DetailedContext;\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get defaultContextId(): string {\r\n    return this.configService.getConfig('context')\r\n      ? this._defaultContextId\r\n      : (this.storageService.get('favorite.context.uri') as string) ||\r\n          this._defaultContextId;\r\n  }\r\n  set defaultContextId(value: string) {\r\n    this._defaultContextId = value;\r\n  }\r\n  private _defaultContextId: string;\r\n\r\n  public collapsed: { contextScope }[] = [];\r\n\r\n  @Output() select = new EventEmitter<DetailedContext>();\r\n  @Output() unselect = new EventEmitter<DetailedContext>();\r\n  @Output() edit = new EventEmitter<DetailedContext>();\r\n  @Output() delete = new EventEmitter<DetailedContext>();\r\n  @Output() save = new EventEmitter<DetailedContext>();\r\n  @Output() clone = new EventEmitter<DetailedContext>();\r\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\r\n  @Output() hide = new EventEmitter<DetailedContext>();\r\n  @Output() show = new EventEmitter<DetailedContext>();\r\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\r\n  @Output() favorite = new EventEmitter<DetailedContext>();\r\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\r\n  @Output() manageTools = new EventEmitter<DetailedContext>();\r\n  @Output() filterPermissionsChanged = new EventEmitter<\r\n    ContextUserPermission[]\r\n  >();\r\n\r\n  public titleMapping = {\r\n    ours: 'igo.context.contextManager.ourContexts',\r\n    shared: 'igo.context.contextManager.sharedContexts',\r\n    public: 'igo.context.contextManager.publicContexts'\r\n  };\r\n\r\n  public users: ContextProfils[];\r\n  public permissions: ContextUserPermission[] = [];\r\n\r\n  public actionStore = new ActionStore([]);\r\n  public actionbarMode = ActionbarMode.Overlay;\r\n\r\n  public color = 'primary';\r\n\r\n  public showHidden = false;\r\n\r\n  /**\r\n   * Context filter term\r\n   */\r\n  @Input()\r\n  set term(value: string) {\r\n    this._term = value;\r\n    this.next();\r\n  }\r\n  get term(): string {\r\n    return this._term;\r\n  }\r\n  public _term: string = '';\r\n\r\n  get sortedAlpha(): boolean {\r\n    return this._sortedAlpha;\r\n  }\r\n  set sortedAlpha(value: boolean) {\r\n    this._sortedAlpha = value;\r\n    this.next();\r\n  }\r\n  private _sortedAlpha: boolean = undefined;\r\n\r\n  public showContextFilter = ContextListControlsEnum.always;\r\n\r\n  public thresholdToFilter = 5;\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    public configService: ConfigService,\r\n    public auth: AuthService,\r\n    private dialog: MatDialog,\r\n    private languageService: LanguageService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.change$$ = this.change$\r\n      .pipe(\r\n        debounce(() => {\r\n          return this.contexts.ours.length === 0 &&\r\n            this.contexts.public?.length === 0 &&\r\n            this.contexts.shared?.length === 0\r\n            ? EMPTY\r\n            : timer(50);\r\n        })\r\n      )\r\n      .subscribe(() => {\r\n        this.contexts$.next(this.filterContextsList(this.contexts));\r\n      });\r\n\r\n    this.actionStore.load([\r\n      {\r\n        id: 'emptyContext',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContext'\r\n        ),\r\n        icon: 'map-outline',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContextTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(true);\r\n        }\r\n      },\r\n      {\r\n        id: 'contextFromMap',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMap'\r\n        ),\r\n        icon: 'map-check',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMapTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(false);\r\n        }\r\n      }\r\n    ]);\r\n  }\r\n\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n  private filterContextsList(contexts: ContextsList) {\r\n    if (this.term === '') {\r\n      if (this.sortedAlpha) {\r\n        contexts = this.sortContextsList(contexts);\r\n      }\r\n      return contexts;\r\n    } else {\r\n      const ours = contexts.ours.filter((context) => {\r\n        const filterNormalized = this.term\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const contextTitleNormalized = context.title\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        return contextTitleNormalized.includes(filterNormalized);\r\n      });\r\n\r\n      let updateContexts: ContextsList = {\r\n        ours\r\n      };\r\n\r\n      if (this.contexts.public) {\r\n        const publics = contexts.public.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.public = publics;\r\n      }\r\n\r\n      if (this.contexts.shared) {\r\n        const shared = contexts.shared.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.shared = shared;\r\n      }\r\n\r\n      if (this.sortedAlpha) {\r\n        updateContexts = this.sortContextsList(updateContexts);\r\n      }\r\n      return updateContexts;\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n\r\n  public showFilter() {\r\n    switch (this.showContextFilter) {\r\n      case ContextListControlsEnum.always:\r\n        return true;\r\n      case ContextListControlsEnum.never:\r\n        return false;\r\n      default:\r\n        let totalLength = this.contexts.ours.length;\r\n        this.contexts.public\r\n          ? (totalLength += this.contexts.public.length)\r\n          : (totalLength += 0);\r\n        this.contexts.shared\r\n          ? (totalLength += this.contexts.shared.length)\r\n          : (totalLength += 0);\r\n        if (totalLength >= this.thresholdToFilter) {\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  }\r\n\r\n  sortContextsList(contexts: ContextsList) {\r\n    if (contexts) {\r\n      const contextsList = JSON.parse(JSON.stringify(contexts));\r\n      contextsList.ours.sort((a, b) => {\r\n        if (this.normalize(a.title) < this.normalize(b.title)) {\r\n          return -1;\r\n        }\r\n        if (this.normalize(a.title) > this.normalize(b.title)) {\r\n          return 1;\r\n        }\r\n        return 0;\r\n      });\r\n\r\n      if (contextsList.shared) {\r\n        contextsList.shared.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      } else if (contextsList.public) {\r\n        contextsList.public.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      }\r\n      return contextsList;\r\n    }\r\n  }\r\n\r\n  normalize(str: string) {\r\n    return str\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .toLowerCase();\r\n  }\r\n\r\n  toggleSort(sortAlpha: boolean) {\r\n    this.sortedAlpha = sortAlpha;\r\n  }\r\n\r\n  clearFilter() {\r\n    this.term = '';\r\n  }\r\n\r\n  createContext(empty?: boolean) {\r\n    this.dialog\r\n      .open(BookmarkDialogComponent, { disableClose: false })\r\n      .afterClosed()\r\n      .pipe(take(1))\r\n      .subscribe((title: string) => {\r\n        if (title) {\r\n          this.create.emit({ title, empty });\r\n        }\r\n      });\r\n  }\r\n\r\n  getPermission(user?): ContextUserPermission {\r\n    if (user) {\r\n      const permission = this.permissions.find((p) => p.name === user.name);\r\n      return permission;\r\n    }\r\n  }\r\n\r\n  userSelection(user, parent?) {\r\n    const permission = this.getPermission(user);\r\n    if (permission) {\r\n      permission.checked = !permission.checked;\r\n      this.storageService.set(\r\n        'contexts.permissions.' + permission.name,\r\n        permission.checked\r\n      );\r\n      permission.indeterminate = false;\r\n    }\r\n\r\n    if (parent) {\r\n      let indeterminate = false;\r\n\r\n      for (const c of parent.childs) {\r\n        const cPermission = this.getPermission(c);\r\n        if (cPermission.checked !== permission.checked) {\r\n          indeterminate = true;\r\n          break;\r\n        }\r\n      }\r\n      const parentPermission = this.getPermission(parent);\r\n      if (parentPermission) {\r\n        parentPermission.checked = permission.checked;\r\n        this.storageService.set(\r\n          'contexts.permissions.' + parentPermission.name,\r\n          permission.checked\r\n        );\r\n        parentPermission.indeterminate = indeterminate;\r\n      }\r\n    }\r\n\r\n    if (user.childs) {\r\n      for (const c of user.childs) {\r\n        const childrenPermission = this.getPermission(c);\r\n        if (\r\n          childrenPermission &&\r\n          childrenPermission.checked !== permission.checked\r\n        ) {\r\n          childrenPermission.checked = permission.checked;\r\n          this.storageService.set(\r\n            'contexts.permissions.' + childrenPermission.name,\r\n            permission.checked\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    this.filterPermissionsChanged.emit(this.permissions);\r\n  }\r\n\r\n  hideContext(context: DetailedContext) {\r\n    context.hidden = true;\r\n    if (!this.showHidden) {\r\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\r\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\r\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\r\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\r\n      this.contexts = contexts;\r\n    }\r\n    this.hide.emit(context);\r\n  }\r\n\r\n  showContext(context: DetailedContext) {\r\n    context.hidden = false;\r\n    this.show.emit(context);\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Self,\r\n  OnInit,\r\n  OnDestroy,\r\n  HostListener,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { MessageService, LanguageService, StorageService } from '@igo2/core';\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ConfirmDialogService } from '@igo2/common';\r\nimport { MapService } from '@igo2/geo';\r\n\r\nimport {\r\n  Context,\r\n  DetailedContext,\r\n  ContextsList,\r\n  ContextUserPermission\r\n} from '../shared/context.interface';\r\nimport { ContextService } from '../shared/context.service';\r\nimport { ContextListComponent } from './context-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoContextListBinding]'\r\n})\r\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\r\n  private component: ContextListComponent;\r\n  private contexts$$: Subscription;\r\n  private selectedContext$$: Subscription;\r\n  private defaultContextId$$: Subscription;\r\n  private previousMessageId;\r\n\r\n  @HostListener('select', ['$event'])\r\n  onSelect(context: Context) {\r\n    this.contextService.loadContext(context.uri);\r\n  }\r\n\r\n  @HostListener('edit', ['$event'])\r\n  onEdit(context: Context) {\r\n    this.contextService.loadEditedContext(context.uri);\r\n  }\r\n\r\n  @HostListener('save', ['$event'])\r\n  onSave(context: Context) {\r\n    const map = this.mapService.getMap();\r\n    const contextFromMap = this.contextService.getContextFromMap(map);\r\n\r\n    const msgSuccess = () => {\r\n      this.messageService.success(\r\n        'igo.context.contextManager.dialog.saveMsg',\r\n        'igo.context.contextManager.dialog.saveTitle',\r\n        undefined,\r\n        {\r\n          value: context.title\r\n        }\r\n      );\r\n    };\r\n\r\n    if (context.imported) {\r\n      contextFromMap.title = context.title;\r\n      this.contextService.delete(context.id, true);\r\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\r\n        this.contextService.loadContext(contextCreated.uri);\r\n        msgSuccess();\r\n      });\r\n      return;\r\n    }\r\n\r\n    const changes: any = {\r\n      layers: contextFromMap.layers,\r\n      map: {\r\n        view: contextFromMap.map.view\r\n      }\r\n    };\r\n\r\n    this.contextService.update(context.id, changes).subscribe(() => {\r\n      msgSuccess();\r\n    });\r\n  }\r\n\r\n  @HostListener('favorite', ['$event'])\r\n  onFavorite(context: Context) {\r\n    if (!context.id) {\r\n      context.id = context.uri;\r\n    }\r\n    this.contextService.setDefault(context.id).subscribe(() => {\r\n      if (this.previousMessageId) {\r\n        this.messageService.remove(this.previousMessageId);\r\n      }\r\n      this.contextService.defaultContextId$.next(context.id);\r\n      const messageObj = this.messageService.success(\r\n        'igo.context.contextManager.dialog.favoriteMsg',\r\n        'igo.context.contextManager.dialog.favoriteTitle',\r\n        undefined,\r\n        {\r\n          value: context.title\r\n        }\r\n      );\r\n      this.previousMessageId = messageObj.toastId;\r\n      this.cdRef.detectChanges();\r\n    });\r\n  }\r\n\r\n  @HostListener('manageTools', ['$event'])\r\n  onManageTools(context: Context) {\r\n    this.contextService.loadEditedContext(context.uri);\r\n  }\r\n\r\n  @HostListener('managePermissions', ['$event'])\r\n  onManagePermissions(context: Context) {\r\n    this.contextService.loadEditedContext(context.uri);\r\n  }\r\n\r\n  @HostListener('delete', ['$event'])\r\n  onDelete(context: Context) {\r\n    const translate = this.languageService.translate;\r\n    this.confirmDialogService\r\n      .open(\r\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\r\n      )\r\n      .subscribe((confirm) => {\r\n        if (confirm) {\r\n          this.contextService\r\n            .delete(context.id, context.imported)\r\n            .subscribe(() => {\r\n              this.messageService.info(\r\n                'igo.context.contextManager.dialog.deleteMsg',\r\n                'igo.context.contextManager.dialog.deleteTitle',\r\n                undefined,\r\n                { value: context.title }\r\n              );\r\n            });\r\n        }\r\n      });\r\n  }\r\n\r\n  @HostListener('clone', ['$event'])\r\n  onClone(context: DetailedContext) {\r\n    const properties = {\r\n      title: context.title + '-copy',\r\n      uri: context.uri + '-copy'\r\n    };\r\n    this.contextService.clone(context.id, properties).subscribe(() => {\r\n      this.messageService.success(\r\n        'igo.context.contextManager.dialog.cloneMsg',\r\n        'igo.context.contextManager.dialog.cloneTitle',\r\n        undefined,\r\n        { value: context.title }\r\n      );\r\n    });\r\n  }\r\n\r\n  @HostListener('create', ['$event'])\r\n  onCreate(opts: { title: string; empty: boolean }) {\r\n    const { title, empty } = opts;\r\n    const context = this.contextService.getContextFromMap(\r\n      this.component.map,\r\n      empty\r\n    );\r\n    context.title = title;\r\n    this.contextService.create(context).subscribe(() => {\r\n      this.messageService.success(\r\n        'igo.context.bookmarkButton.dialog.createMsg',\r\n        'igo.context.bookmarkButton.dialog.createTitle',\r\n        undefined,\r\n        { value: context.title }\r\n      );\r\n      this.contextService.loadContext(context.uri);\r\n    });\r\n  }\r\n\r\n  @HostListener('filterPermissionsChanged')\r\n  loadContexts() {\r\n    const permissions = ['none'];\r\n    for (const p of this.component.permissions) {\r\n      if (p.checked === true || p.indeterminate === true) {\r\n        permissions.push(p.name);\r\n      }\r\n    }\r\n    this.component.showHidden\r\n      ? this.contextService.loadContexts(permissions, true)\r\n      : this.contextService.loadContexts(permissions, false);\r\n  }\r\n\r\n  @HostListener('showHiddenContexts')\r\n  showHiddenContexts() {\r\n    this.component.showHidden = !this.component.showHidden;\r\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\r\n    this.loadContexts();\r\n  }\r\n\r\n  @HostListener('show', ['$event'])\r\n  onShowContext(context: DetailedContext) {\r\n    this.contextService.showContext(context.id).subscribe();\r\n  }\r\n\r\n  @HostListener('hide', ['$event'])\r\n  onHideContext(context: DetailedContext) {\r\n    this.contextService.hideContext(context.id).subscribe();\r\n  }\r\n\r\n  constructor(\r\n    @Self() component: ContextListComponent,\r\n    private contextService: ContextService,\r\n    private mapService: MapService,\r\n    private languageService: LanguageService,\r\n    private confirmDialogService: ConfirmDialogService,\r\n    private messageService: MessageService,\r\n    private auth: AuthService,\r\n    private storageService: StorageService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input contexts\r\n    this.component.contexts = { ours: [] };\r\n    this.component.showHidden = this.storageService.get(\r\n      'contexts.showHidden'\r\n    ) as boolean;\r\n\r\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\r\n      this.handleContextsChange(contexts)\r\n    );\r\n\r\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\r\n      (id) => {\r\n        this.component.defaultContextId = id;\r\n      }\r\n    );\r\n    const storedContextUri = this.storageService.get(\r\n      'favorite.context.uri'\r\n    ) as string;\r\n    if (storedContextUri && !this.auth.authenticated) {\r\n      this.contextService.defaultContextId$.next(storedContextUri);\r\n    }\r\n\r\n    // See feature-list.component for an explanation about the debounce time\r\n    this.selectedContext$$ = this.contextService.context$\r\n      .pipe(debounceTime(100))\r\n      .subscribe((context) => (this.component.selectedContext = context));\r\n\r\n    this.auth.authenticate$.subscribe((authenticate) => {\r\n      if (authenticate) {\r\n        this.contextService.getProfilByUser().subscribe((profils) => {\r\n          this.component.users = profils;\r\n          this.component.permissions = [];\r\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\r\n            acc = acc.concat(cur);\r\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\r\n            return acc;\r\n          }, []);\r\n\r\n          for (const user of profilsAcc) {\r\n            const permission: ContextUserPermission = {\r\n              name: user.name,\r\n              checked: this.storageService.get(\r\n                'contexts.permissions.' + user.name\r\n              ) as boolean\r\n            };\r\n            if (permission.checked === null) {\r\n              permission.checked = true;\r\n            }\r\n            this.component.permissions.push(permission);\r\n          }\r\n\r\n          const permissions = ['none'];\r\n          for (const p of this.component.permissions) {\r\n            if (p.checked === true || p.indeterminate === true) {\r\n              permissions.push(p.name);\r\n            }\r\n          }\r\n\r\n          this.component.showHidden\r\n            ? this.contextService.loadContexts(permissions, true)\r\n            : this.contextService.loadContexts(permissions, false);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.contexts$$.unsubscribe();\r\n    this.selectedContext$$.unsubscribe();\r\n    this.defaultContextId$$.unsubscribe();\r\n  }\r\n\r\n  private handleContextsChange(contexts: ContextsList) {\r\n    this.component.contexts = contexts;\r\n  }\r\n}\r\n","<form\r\n  class=\"igo-form\"\r\n  [formGroup]=\"form\"\r\n  (ngSubmit)=\"handleFormSubmit(form.value)\"\r\n>\r\n  <mat-form-field class=\"full-width\">\r\n    <input\r\n      matInput\r\n      required\r\n      maxlength=\"128\"\r\n      [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\r\n      formControlName=\"title\"\r\n    />\r\n    <mat-error>\r\n      {{ 'igo.context.contextManager.form.titleRequired' | translate }}\r\n    </mat-error>\r\n  </mat-form-field>\r\n\r\n  <mat-form-field id=\"uriInput\" class=\"full-width\">\r\n    <span *ngIf=\"prefix\" class=\"prefix\">{{ prefix }}-</span>\r\n    <span class=\"fieldWrapper\">\r\n      <input\r\n        matInput\r\n        maxlength=\"64\"\r\n        floatLabel=\"always\"\r\n        [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\r\n        formControlName=\"uri\"\r\n      />\r\n    </span>\r\n  </mat-form-field>\r\n\r\n  <button\r\n    id=\"copyButton\"\r\n    type=\"button\"\r\n    mat-icon-button\r\n    tooltip-position=\"below\"\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.context.contextManager.form.copy' | translate\"\r\n    color=\"primary\"\r\n    (click)=\"copyTextToClipboard()\"\r\n  >\r\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n  </button>\r\n\r\n  <div class=\"igo-form-button-group\">\r\n    <button\r\n      mat-raised-button\r\n      type=\"submit\"\r\n      [disabled]=\"!form.valid || disabled\"\r\n    >\r\n      {{ 'igo.context.contextManager.form.edit' | translate }}\r\n    </button>\r\n  </div>\r\n</form>\r\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\r\nimport { UntypedFormBuilder, UntypedFormGroup } from '@angular/forms';\r\n\r\nimport { ObjectUtils, Clipboard } from '@igo2/utils';\r\nimport { MessageService } from '@igo2/core';\r\nimport { Context } from '../shared/context.interface';\r\n\r\n@Component({\r\n  selector: 'igo-context-form',\r\n  templateUrl: './context-form.component.html',\r\n  styleUrls: ['./context-form.component.scss']\r\n})\r\nexport class ContextFormComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n  public prefix: string;\r\n\r\n  @Input()\r\n  get btnSubmitText(): string {\r\n    return this._btnSubmitText;\r\n  }\r\n  set btnSubmitText(value: string) {\r\n    this._btnSubmitText = value;\r\n  }\r\n  private _btnSubmitText: string;\r\n\r\n  @Input()\r\n  get context(): Context {\r\n    return this._context;\r\n  }\r\n  set context(value: Context) {\r\n    this._context = value;\r\n    this.buildForm();\r\n  }\r\n  private _context: Context;\r\n\r\n  @Input()\r\n  get disabled(): boolean {\r\n    return this._disabled;\r\n  }\r\n  set disabled(value: boolean) {\r\n    this._disabled = value;\r\n  }\r\n  private _disabled = false;\r\n\r\n  // TODO: replace any by ContextOptions or Context\r\n  @Output() submitForm: EventEmitter<any> = new EventEmitter();\r\n  @Output() clone: EventEmitter<any> = new EventEmitter();\r\n  @Output() delete: EventEmitter<any> = new EventEmitter();\r\n\r\n  constructor(\r\n    private formBuilder: UntypedFormBuilder,\r\n    private messageService: MessageService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.buildForm();\r\n  }\r\n\r\n  public handleFormSubmit(value) {\r\n    let inputs = Object.assign({}, value);\r\n    inputs = ObjectUtils.removeNull(inputs);\r\n    inputs.uri = inputs.uri.replace(' ', '');\r\n    if (inputs.uri) {\r\n      inputs.uri = this.prefix + '-' + inputs.uri;\r\n    } else {\r\n      inputs.uri = this.prefix;\r\n    }\r\n    this.submitForm.emit(inputs);\r\n  }\r\n\r\n  public copyTextToClipboard() {\r\n    const text = this.prefix + '-' + this.form.value.uri.replace(' ', '');\r\n    const successful = Clipboard.copy(text);\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.context.contextManager.dialog.copyMsg',\r\n        'igo.context.contextManager.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  private buildForm(): void {\r\n    const context: any = this.context || {};\r\n\r\n    const uriSplit = context.uri.split('-');\r\n    this.prefix = uriSplit.shift();\r\n    const uri = uriSplit.join('-');\r\n\r\n    this.form = this.formBuilder.group({\r\n      title: [context.title],\r\n      uri: [uri || ' ']\r\n    });\r\n  }\r\n}\r\n","<igo-context-form\r\n  *ngIf=\"context\"\r\n  [btnSubmitText]=\"'igo.context.contextManager.save' | translate\"\r\n  [context]=\"context\"\r\n  (submitForm)=\"submitForm.emit($event)\"\r\n>\r\n</igo-context-form>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { Context } from '../shared/context.interface';\r\n\r\n@Component({\r\n  selector: 'igo-context-edit',\r\n  templateUrl: './context-edit.component.html'\r\n})\r\nexport class ContextEditComponent {\r\n  @Input()\r\n  get context(): Context {\r\n    return this._context;\r\n  }\r\n  set context(value: Context) {\r\n    this._context = value;\r\n    this.refresh();\r\n  }\r\n  private _context: Context;\r\n\r\n  @Output() submitForm: EventEmitter<Context> = new EventEmitter();\r\n\r\n  constructor(private cd: ChangeDetectorRef) {}\r\n\r\n  refresh() {\r\n    this.cd.detectChanges();\r\n  }\r\n}\r\n","import {\r\n  Output,\r\n  EventEmitter,\r\n  Directive,\r\n  Self,\r\n  OnInit,\r\n  OnDestroy,\r\n  HostListener\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MessageService } from '@igo2/core';\r\n\r\nimport { Context, DetailedContext } from '../shared/context.interface';\r\nimport { ContextService } from '../shared/context.service';\r\nimport { ContextEditComponent } from './context-edit.component';\r\n\r\n@Directive({\r\n  selector: '[igoContextEditBinding]'\r\n})\r\nexport class ContextEditBindingDirective implements OnInit, OnDestroy {\r\n  private component: ContextEditComponent;\r\n  private editedContext$$: Subscription;\r\n\r\n  @Output() submitSuccessed: EventEmitter<Context> = new EventEmitter();\r\n\r\n  @HostListener('submitForm', ['$event'])\r\n  onEdit(context: Context) {\r\n    const id = this.component.context.id;\r\n    this.contextService.update(id, context).subscribe(() => {\r\n      this.messageService.success(\r\n        'igo.context.contextManager.dialog.saveMsg',\r\n        'igo.context.contextManager.dialog.saveTitle',\r\n        undefined,\r\n        {\r\n          value: context.title || this.component.context.title\r\n        }\r\n      );\r\n      this.contextService.setEditedContext(undefined);\r\n      this.submitSuccessed.emit(context);\r\n    });\r\n  }\r\n\r\n  constructor(\r\n    @Self() component: ContextEditComponent,\r\n    private contextService: ContextService,\r\n    private messageService: MessageService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\r\n      (context) => this.handleEditedContextChange(context)\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.editedContext$$.unsubscribe();\r\n  }\r\n\r\n  private handleEditedContextChange(context: DetailedContext) {\r\n    this.component.context = context;\r\n  }\r\n}\r\n","<div *ngIf=\"context\">\r\n  <div *ngIf=\"!canWrite\" class=\"scopeForm\">\r\n    <h4>{{ 'igo.context.permission.readOnlyTitle' | translate }}</h4>\r\n    <p>{{ 'igo.context.permission.readOnlyMsg' | translate }}</p>\r\n  </div>\r\n\r\n  <div *ngIf=\"canWrite\" class=\"scopeForm\">\r\n    <mat-radio-group\r\n      [(ngModel)]=\"context.scope\"\r\n      (change)=\"scopeChanged.emit(context)\"\r\n    >\r\n      <mat-radio-button value=\"private\">\r\n        {{ 'igo.context.permission.scope.private' | translate }}\r\n      </mat-radio-button>\r\n      <mat-radio-button value=\"protected\">\r\n        {{ 'igo.context.permission.scope.shared' | translate }}\r\n      </mat-radio-button>\r\n      <mat-radio-button *ngIf=\"authService.isAdmin\" value=\"public\">\r\n        {{ 'igo.context.permission.scope.public' | translate }}\r\n      </mat-radio-button>\r\n    </mat-radio-group>\r\n  </div>\r\n\r\n  <form\r\n    *ngIf=\"context.scope !== 'private' && canWrite\"\r\n    [formGroup]=\"form\"\r\n    (ngSubmit)=\"handleFormSubmit(form.value)\"\r\n  >\r\n    <mat-form-field class=\"full-width\">\r\n      <input\r\n        matInput\r\n        required\r\n        [placeholder]=\"'igo.context.permission.user' | translate\"\r\n        [formControl]=\"formControl\"\r\n        [matAutocomplete]=\"auto\"\r\n      />\r\n      <mat-autocomplete\r\n        #auto=\"matAutocomplete\"\r\n        (optionSelected)=\"onProfilSelected($event.option.value)\"\r\n        [displayWith]=\"displayFn\"\r\n      >\r\n        <mat-option *ngFor=\"let profil of this.profils\" [value]=\"profil\">\r\n          {{ profil.title }}<br />\r\n          <small class=\"mat-typography\">{{ profil.name }}</small>\r\n        </mat-option>\r\n      </mat-autocomplete>\r\n      <mat-error>\r\n        {{ 'igo.context.permission.profilRequired' | translate }}\r\n      </mat-error>\r\n    </mat-form-field>\r\n\r\n    <mat-radio-group formControlName=\"typePermission\">\r\n      <mat-radio-button value=\"read\">\r\n        {{ 'igo.context.permission.read' | translate }}\r\n      </mat-radio-button>\r\n      <mat-radio-button value=\"write\">\r\n        {{ 'igo.context.permission.write' | translate }}\r\n      </mat-radio-button>\r\n    </mat-radio-group>\r\n\r\n    <div class=\"igo-form-button-group\">\r\n      <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid\">\r\n        {{ 'igo.context.permission.addBtn' | translate }}\r\n      </button>\r\n    </div>\r\n  </form>\r\n\r\n  <igo-list *ngIf=\"permissions && context.scope !== 'private'\">\r\n    <ng-template ngFor let-groupPermissions [ngForOf]=\"permissions | keyvalue\">\r\n      <igo-collapsible\r\n        *ngIf=\"groupPermissions.value.length\"\r\n        [title]=\"'igo.context.permission.' + groupPermissions.key | translate\"\r\n      >\r\n        <ng-template ngFor let-permission [ngForOf]=\"groupPermissions.value\">\r\n          <mat-list-item>\r\n            <mat-icon matListItemIcon svgIcon=\"account-outline\"></mat-icon>\r\n            <h4 matListItemTitle>\r\n              {{ permission.profilTitle }}\r\n              <small class=\"mat-typography\">{{ permission.profil }}</small>\r\n            </h4>\r\n\r\n            <div igoStopPropagation class=\"igo-actions-container\">\r\n              <button\r\n                *ngIf=\"\r\n                  canWrite ||\r\n                  permission.profil === authService.decodeToken().user.sourceId\r\n                \"\r\n                mat-icon-button\r\n                [matTooltip]=\"'igo.context.permission.delete' | translate\"\r\n                matTooltipShowDelay=\"500\"\r\n                color=\"warn\"\r\n                (click)=\"removePermission.emit(permission)\"\r\n              >\r\n                <mat-icon svgIcon=\"delete\"></mat-icon>\r\n              </button>\r\n            </div>\r\n          </mat-list-item>\r\n        </ng-template>\r\n      </igo-collapsible>\r\n    </ng-template>\r\n  </igo-list>\r\n</div>\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  UntypedFormControl\r\n} from '@angular/forms';\r\n\r\nimport {\r\n  Context,\r\n  ContextPermission,\r\n  ContextPermissionsList,\r\n  ContextProfils\r\n} from '../shared/context.interface';\r\nimport { TypePermission } from '../shared/context.enum';\r\n\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-context-permissions',\r\n  templateUrl: './context-permissions.component.html',\r\n  styleUrls: ['./context-permissions.component.scss']\r\n})\r\nexport class ContextPermissionsComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n\r\n  @Input()\r\n  get context(): Context {\r\n    return this._context;\r\n  }\r\n  set context(value: Context) {\r\n    this._context = value;\r\n    this.cd.detectChanges();\r\n  }\r\n  private _context: Context;\r\n\r\n  @Input()\r\n  get permissions(): ContextPermissionsList {\r\n    return this._permissions;\r\n  }\r\n  set permissions(value: ContextPermissionsList) {\r\n    this._permissions = value;\r\n    this.cd.detectChanges();\r\n  }\r\n  private _permissions: ContextPermissionsList;\r\n\r\n  get profils(): ContextProfils[] {\r\n    return this._profils;\r\n  }\r\n  set profils(value: ContextProfils[]) {\r\n    this._profils = value;\r\n    this.cd.detectChanges();\r\n  }\r\n  private _profils: ContextProfils[] = [];\r\n\r\n  get canWrite(): boolean {\r\n    return this.context.permission === TypePermission[TypePermission.write];\r\n  }\r\n\r\n  private baseUrlProfils;\r\n\r\n  public formControl = new UntypedFormControl();\r\n  formValueChanges$$: Subscription;\r\n\r\n  @Output() addPermission: EventEmitter<ContextPermission> = new EventEmitter();\r\n  @Output() removePermission: EventEmitter<ContextPermission> =\r\n    new EventEmitter();\r\n  @Output() scopeChanged: EventEmitter<Context> = new EventEmitter();\r\n\r\n  constructor(\r\n    private formBuilder: UntypedFormBuilder,\r\n    private cd: ChangeDetectorRef,\r\n    private http: HttpClient,\r\n    public authService: AuthService,\r\n    private config: ConfigService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.buildForm();\r\n\r\n    this.baseUrlProfils =\r\n      this.config.getConfig('context.url') + '/profils-users?';\r\n\r\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\r\n      (value) => {\r\n        if (value.length) {\r\n          this.http\r\n            .get(this.baseUrlProfils + 'q=' + value)\r\n            .subscribe((profils) => {\r\n              this.profils = profils as ContextProfils[];\r\n            });\r\n          this.profils.filter((profil) => {\r\n            const filterNormalized = value\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            const profilTitleNormalized = profil.title\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            const profilNameNormalized = profil.name\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            const profilNormalized =\r\n              profilNameNormalized + profilTitleNormalized;\r\n            return profilNormalized.includes(filterNormalized);\r\n          });\r\n        } else {\r\n          this.profils = [];\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  displayFn(profil?: ContextProfils): string | undefined {\r\n    return profil ? profil.title : undefined;\r\n  }\r\n\r\n  public handleFormSubmit(value) {\r\n    this.addPermission.emit(value);\r\n  }\r\n\r\n  private buildForm(): void {\r\n    this.form = this.formBuilder.group({\r\n      profil: [],\r\n      typePermission: ['read']\r\n    });\r\n  }\r\n\r\n  onProfilSelected(value) {\r\n    this.form.setValue({\r\n      profil: value.name,\r\n      typePermission: this.form.value.typePermission\r\n    });\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Self,\r\n  OnInit,\r\n  OnDestroy,\r\n  HostListener,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\n\r\nimport {\r\n  Context,\r\n  ContextPermission,\r\n  DetailedContext\r\n} from '../shared/context.interface';\r\nimport { ContextService } from '../shared/context.service';\r\nimport { ContextPermissionsComponent } from './context-permissions.component';\r\n\r\n@Directive({\r\n  selector: '[igoContextPermissionsBinding]'\r\n})\r\nexport class ContextPermissionsBindingDirective implements OnInit, OnDestroy {\r\n  private component: ContextPermissionsComponent;\r\n  private editedContext$$: Subscription;\r\n\r\n  @HostListener('addPermission', ['$event'])\r\n  onAddPermission(permission: ContextPermission) {\r\n    if (!permission.profil) {\r\n      this.messageService.error(\r\n        'igo.context.contextManager.errors.addPermissionEmpty',\r\n        'igo.context.contextManager.errors.addPermissionTitle'\r\n      );\r\n      return;\r\n    }\r\n    const contextId = this.component.context.id;\r\n    this.contextService\r\n      .addPermissionAssociation(\r\n        contextId,\r\n        permission.profil,\r\n        permission.typePermission\r\n      )\r\n      .subscribe((profils) => {\r\n        for (const p of profils) {\r\n          this.component.permissions[permission.typePermission].push(p);\r\n        }\r\n        const profil = permission.profil;\r\n        this.messageService.success(\r\n          'igo.context.permission.dialog.addMsg',\r\n          'igo.context.permission.dialog.addTitle',\r\n          undefined,\r\n          { value: profil }\r\n        );\r\n        this.cd.detectChanges();\r\n      });\r\n  }\r\n\r\n  @HostListener('removePermission', ['$event'])\r\n  onRemovePermission(permission: ContextPermission) {\r\n    const contextId = this.component.context.id;\r\n    this.contextService\r\n      .deletePermissionAssociation(contextId, permission.id)\r\n      .subscribe(() => {\r\n        const index = this.component.permissions[\r\n          permission.typePermission\r\n        ].findIndex((p) => {\r\n          return p.id === permission.id;\r\n        });\r\n        this.component.permissions[permission.typePermission].splice(index, 1);\r\n\r\n        const profil = permission.profil;\r\n        this.messageService.success(\r\n          'igo.context.permission.dialog.deleteMsg',\r\n          'igo.context.permission.dialog.deleteTitle',\r\n          undefined,\r\n          { value: profil }\r\n        );\r\n        this.cd.detectChanges();\r\n      });\r\n  }\r\n\r\n  @HostListener('scopeChanged', ['$event'])\r\n  onScopeChanged(context: Context) {\r\n    const scope = context.scope;\r\n    this.contextService.update(context.id, { scope }).subscribe(() => {\r\n      this.messageService.success(\r\n        'igo.context.permission.dialog.scopeChangedMsg',\r\n        'igo.context.permission.dialog.scopeChangedTitle',\r\n        undefined,\r\n        { value: 'igo.context.permission.scope.' + scope }\r\n      );\r\n    });\r\n  }\r\n\r\n  constructor(\r\n    @Self() component: ContextPermissionsComponent,\r\n    private contextService: ContextService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private cd: ChangeDetectorRef\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\r\n      (context) => this.handleEditedContextChange(context)\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.editedContext$$.unsubscribe();\r\n    this.contextService.editedContext$.next(undefined);\r\n  }\r\n\r\n  private handleEditedContextChange(context: DetailedContext) {\r\n    this.component.context = context;\r\n\r\n    if (context) {\r\n      this.contextService\r\n        .getPermissions(context.id)\r\n        .subscribe((permissionsArray) => {\r\n          permissionsArray = permissionsArray || [];\r\n          const permissions = {\r\n            read: permissionsArray.filter((p) => {\r\n              return p.typePermission.toString() === 'read';\r\n            }),\r\n            write: permissionsArray.filter((p) => {\r\n              return p.typePermission.toString() === 'write';\r\n            })\r\n          };\r\n          return (this.component.permissions = permissions);\r\n        });\r\n    }\r\n  }\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\n\r\nimport { RouteService } from '@igo2/core';\r\nimport { Layer, WMSDataSourceOptions } from '@igo2/geo';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\r\nimport { ContextService } from '../../context-manager/shared/context.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ShareMapService {\r\n  private language = '';\r\n\r\n  constructor(\r\n    private contextService: ContextService,\r\n    @Optional() private route: RouteService\r\n  ) {\r\n    this.route.queryParams.subscribe((params) => {\r\n      if (params['lang']) {\r\n        this.language = params['lang'];\r\n      }\r\n    });\r\n  }\r\n\r\n  getUrlWithApi(formValues) {\r\n    return this.language\r\n      ? `${location.origin + location.pathname}?context=${\r\n          formValues.uri\r\n        }&lang=${this.language}`\r\n      : `${location.origin + location.pathname}?context=${formValues.uri}`;\r\n  }\r\n\r\n  createContextShared(map: IgoMap, formValues) {\r\n    const context = this.contextService.getContextFromMap(map);\r\n    context.scope = 'public';\r\n    context.title = formValues.title;\r\n    context.uri = formValues.uri;\r\n    return this.contextService.create(context);\r\n  }\r\n\r\n  updateContextShared(map: IgoMap, formValues, id: string) {\r\n    const context = this.contextService.getContextFromMap(map);\r\n    return this.contextService.update(id, {\r\n      title: formValues.title,\r\n      map: context.map\r\n    } as DetailedContext);\r\n  }\r\n\r\n  getUrlWithoutApi(map: IgoMap, publicShareOption) {\r\n    if (\r\n      !this.route ||\r\n      !this.route.options.visibleOnLayersKey ||\r\n      !this.route.options.visibleOffLayersKey ||\r\n      !map.viewController.getZoom()\r\n    ) {\r\n      return;\r\n    }\r\n    const llc = publicShareOption.layerlistControls.querystring;\r\n\r\n    let visibleKey = this.route.options.visibleOnLayersKey;\r\n    let invisibleKey = this.route.options.visibleOffLayersKey;\r\n    const layers = map.layers;\r\n\r\n    const visibleLayers = layers.filter(\r\n      (lay) => lay.visible && !lay.isIgoInternalLayer\r\n    );\r\n    const invisibleLayers = layers.filter(\r\n      (lay) => !lay.visible && !lay.isIgoInternalLayer\r\n    );\r\n\r\n    if (visibleLayers.length === 0) {\r\n      visibleKey = '';\r\n    }\r\n    if (invisibleLayers.length === 0) {\r\n      invisibleKey = '';\r\n    }\r\n\r\n    let layersUrl = '';\r\n    let layersToLoop = [];\r\n    if (visibleLayers.length > invisibleLayers.length) {\r\n      layersUrl = `${visibleKey}=*&${invisibleKey}=`;\r\n      layersToLoop = invisibleLayers;\r\n    } else {\r\n      layersUrl = `${invisibleKey}=*&${visibleKey}=`;\r\n      layersToLoop = visibleLayers;\r\n    }\r\n\r\n    for (const layer of layersToLoop) {\r\n      if (layer.id) {\r\n        layersUrl += layer.id + ',';\r\n      }\r\n    }\r\n    const contextLayersID = [];\r\n    const contextLayers = this.contextService.context$.value.layers;\r\n    for (const contextLayer of contextLayers) {\r\n      if (\r\n        typeof contextLayer.id !== 'undefined' ||\r\n        typeof contextLayer.source !== 'undefined'\r\n      ) {\r\n        contextLayersID.push(contextLayer.id || contextLayer.source.id);\r\n      }\r\n    }\r\n\r\n    const addedLayersQueryParamsWms = this.makeLayersByService(\r\n      layers,\r\n      contextLayersID,\r\n      'wms'\r\n    );\r\n    const addedLayersQueryParamsWmts = this.makeLayersByService(\r\n      layers,\r\n      contextLayersID,\r\n      'wmts'\r\n    );\r\n    const addedLayersQueryParamsArcgisRest = this.makeLayersByService(\r\n      layers,\r\n      contextLayersID,\r\n      'arcgisrest'\r\n    );\r\n    const addedLayersQueryParamsImageArcgisRest = this.makeLayersByService(\r\n      layers,\r\n      contextLayersID,\r\n      'imagearcgisrest'\r\n    );\r\n    const addedLayersQueryParamsTileArcgisRest = this.makeLayersByService(\r\n      layers,\r\n      contextLayersID,\r\n      'tilearcgisrest'\r\n    );\r\n\r\n    layersUrl = layersUrl.substr(0, layersUrl.length - 1);\r\n\r\n    const zoomKey = this.route.options.zoomKey;\r\n    const centerKey = this.route.options.centerKey;\r\n    const contextKey = this.route.options.contextKey;\r\n\r\n    const zoom = `${zoomKey}=${map.viewController.getZoom()}`;\r\n    const arrayCenter = map.viewController.getCenter('EPSG:4326') || [];\r\n    const long = arrayCenter[0].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\r\n    const lat = arrayCenter[1].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\r\n    const center = `${centerKey}=${long},${lat}`.replace(/.00000/g, '');\r\n    let context = '';\r\n    if (this.contextService.context$.value) {\r\n      context = `${contextKey}=${this.contextService.context$.value.uri}`;\r\n    }\r\n\r\n    let url = this.language\r\n      ? `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}&lang=${this.language}`\r\n      : `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}`;\r\n    for (let i = 0; i < 5; i++) {\r\n      url = url.replace(/&&/g, '&');\r\n      url = url.endsWith('&') ? url.slice(0, -1) : url;\r\n    }\r\n    url = url.endsWith('&') ? url.slice(0, -1) : url;\r\n    url = url.replace('?&wm', '&wm');\r\n    url = url.replace('?&', '?');\r\n\r\n    return url;\r\n  }\r\n\r\n  private makeLayersByService(\r\n    layers: Layer[],\r\n    contextLayersID: any[],\r\n    typeService: string\r\n  ): string {\r\n    const addedLayersByService = [];\r\n    for (const layer of layers.filter(\r\n      (l) => l.dataSource.options?.type === typeService\r\n    )) {\r\n      if (contextLayersID.indexOf(layer.id) === -1) {\r\n        let linkUrl = encodeURIComponent((layer.dataSource.options as any).url);\r\n        let addedLayer = '';\r\n        let layerVersion: string;\r\n        switch (layer.dataSource.options.type.toLowerCase()) {\r\n          case 'wms':\r\n            const datasourceOptions = layer.dataSource\r\n              .options as WMSDataSourceOptions;\r\n            addedLayer = encodeURIComponent(datasourceOptions.params.LAYERS);\r\n            layerVersion =\r\n              datasourceOptions.params.VERSION === '1.3.0'\r\n                ? layerVersion\r\n                : datasourceOptions.params.VERSION;\r\n            break;\r\n          case 'wmts':\r\n          case 'arcgisrest':\r\n          case 'imagearcgisrest':\r\n          case 'tilearcgisrest':\r\n            addedLayer = encodeURIComponent(\r\n              (layer.dataSource.options as any).layer\r\n            );\r\n            break;\r\n        }\r\n        const addedLayerPosition = `${addedLayer}:igoz${layer.zIndex}`;\r\n\r\n        let version = '';\r\n        if (layerVersion) {\r\n          const operator =\r\n            (layer.dataSource.options as any).url.indexOf('?') === -1\r\n              ? '?'\r\n              : '&';\r\n          version = encodeURIComponent(`${operator}VERSION=${layerVersion}`);\r\n        }\r\n        linkUrl = `${linkUrl}${version}`;\r\n\r\n        if (\r\n          !addedLayersByService.find((definedUrl) => definedUrl.url === linkUrl)\r\n        ) {\r\n          addedLayersByService.push({\r\n            url: linkUrl,\r\n            layers: [addedLayerPosition]\r\n          });\r\n        } else {\r\n          addedLayersByService.forEach((service) => {\r\n            if (service.url === linkUrl) {\r\n              service.layers.push(addedLayerPosition);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    let addedLayersQueryParams = '';\r\n    if (addedLayersByService.length >= 1) {\r\n      let linkUrlKey;\r\n      let layersKey;\r\n      /*\r\n      const linkUrlKey = (typeService === 'wms') ? this.route.options.wmsUrlKey :\r\n        (typeService === 'wmts') ? this.route.options.wmtsUrlKey : '' ;\r\n      const layersKey = (typeService === 'wms') ? this.route.options.wmsLayersKey :\r\n        (typeService === 'wmts') ? this.route.options.wmtsLayersKey : '' ;\r\n*/\r\n      switch (typeService.toLowerCase()) {\r\n        case 'wms':\r\n          linkUrlKey = this.route.options.wmsUrlKey;\r\n          layersKey = this.route.options.wmsLayersKey;\r\n          break;\r\n        case 'wmts':\r\n          linkUrlKey = this.route.options.wmtsUrlKey;\r\n          layersKey = this.route.options.wmtsLayersKey;\r\n          break;\r\n        case 'arcgisrest':\r\n          linkUrlKey = this.route.options.arcgisUrlKey;\r\n          layersKey = this.route.options.arcgisLayersKey;\r\n          break;\r\n        case 'imagearcgisrest':\r\n          linkUrlKey = this.route.options.iarcgisUrlKey;\r\n          layersKey = this.route.options.iarcgisLayersKey;\r\n          break;\r\n        case 'tilearcgisrest':\r\n          linkUrlKey = this.route.options.tarcgisUrlKey;\r\n          layersKey = this.route.options.tarcgisLayersKey;\r\n          break;\r\n        default:\r\n          linkUrlKey = '';\r\n          layersKey = '';\r\n      }\r\n\r\n      let linkUrlQueryParams = '';\r\n      let layersQueryParams = '';\r\n      addedLayersByService.forEach((service) => {\r\n        linkUrlQueryParams += `${service.url},`;\r\n        layersQueryParams += `(${service.layers.join(',')}),`;\r\n      });\r\n      linkUrlQueryParams = linkUrlQueryParams.endsWith(',')\r\n        ? linkUrlQueryParams.slice(0, -1)\r\n        : linkUrlQueryParams;\r\n      layersQueryParams = layersQueryParams.endsWith(',')\r\n        ? layersQueryParams.slice(0, -1)\r\n        : layersQueryParams;\r\n      addedLayersQueryParams = `${linkUrlKey}=${linkUrlQueryParams}&${layersKey}=${layersQueryParams}`;\r\n    }\r\n\r\n    return addedLayersQueryParams;\r\n  }\r\n}\r\n","<div class=\"igo-input-container linkToShare\">\r\n  <mat-form-field>\r\n    <textarea\r\n      #textArea\r\n      matInput\r\n      readonly\r\n      rows=\"3\"\r\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\r\n      [value]=\"url\"\r\n    ></textarea>\r\n  </mat-form-field>\r\n\r\n  <div class=\"igo-form-button-group\">\r\n    <button mat-raised-button (click)=\"copyTextToClipboard(textArea)\">\r\n      <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n      {{ 'igo.context.shareMap.copy' | translate }}\r\n    </button>\r\n  </div>\r\n  <div>\r\n    <br />\r\n    <section class=\"mat-typography\">\r\n      <div\r\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) === ''\"\r\n      >\r\n        <h4 *ngIf=\"('igo.context.shareMap.included' | translate) !== ''\">\r\n          {{ 'igo.context.shareMap.included' | translate }}\r\n        </h4>\r\n        <ul>\r\n          <li *ngIf=\"('igo.context.shareMap.context' | translate) !== ''\">\r\n            {{ 'igo.context.shareMap.context' | translate }}\r\n          </li>\r\n          <li *ngIf=\"('igo.context.shareMap.center' | translate) !== ''\">\r\n            {{ 'igo.context.shareMap.center' | translate }}\r\n          </li>\r\n          <li *ngIf=\"('igo.context.shareMap.zoom' | translate) !== ''\">\r\n            {{ 'igo.context.shareMap.zoom' | translate }}\r\n          </li>\r\n          <li *ngIf=\"('igo.context.shareMap.addedLayers' | translate) !== ''\">\r\n            {{ 'igo.context.shareMap.addedLayers' | translate }}\r\n          </li>\r\n          <li\r\n            *ngIf=\"('igo.context.shareMap.visibleInvisible' | translate) !== ''\"\r\n          >\r\n            {{ 'igo.context.shareMap.visibleInvisible' | translate }}\r\n          </li>\r\n        </ul>\r\n\r\n        <h4 *ngIf=\"('igo.context.shareMap.excluded' | translate) !== ''\">\r\n          {{ 'igo.context.shareMap.excluded' | translate }}\r\n        </h4>\r\n        <ul>\r\n          <li *ngIf=\"('igo.context.shareMap.order' | translate) !== ''\">\r\n            {{ 'igo.context.shareMap.order' | translate }}\r\n          </li>\r\n          <li *ngIf=\"('igo.context.shareMap.opacity' | translate) !== ''\">\r\n            {{ 'igo.context.shareMap.opacity' | translate }}\r\n          </li>\r\n          <li *ngIf=\"('igo.context.shareMap.filterOgc' | translate) !== ''\">\r\n            {{ 'igo.context.shareMap.filterOgc' | translate }}\r\n          </li>\r\n          <li *ngIf=\"('igo.context.shareMap.filterTime' | translate) !== ''\">\r\n            {{ 'igo.context.shareMap.filterTime' | translate }}\r\n          </li>\r\n        </ul>\r\n      </div>\r\n      <igo-custom-html\r\n        class=\"shareCustomPadding\"\r\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) !== ''\"\r\n        class=\"mat-typography\"\r\n        [html]=\"'igo.context.shareMap.htmlClarifications' | translate\"\r\n      >\r\n      </igo-custom-html>\r\n    </section>\r\n  </div>\r\n</div>\r\n","import {\r\n  AfterViewInit,\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  ChangeDetectorRef,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { Clipboard } from '@igo2/utils';\r\nimport { MessageService } from '@igo2/core';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { ShareMapService } from '../shared/share-map.service';\r\nimport { combineLatest, Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-share-map-url',\r\n  templateUrl: './share-map-url.component.html',\r\n  styleUrls: ['./share-map-url.component.scss']\r\n})\r\nexport class ShareMapUrlComponent implements AfterViewInit, OnInit, OnDestroy {\r\n  private mapState$$: Subscription;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  public url: string;\r\n  public publicShareOption = {\r\n    layerlistControls: { querystring: '' }\r\n  };\r\n\r\n  constructor(\r\n    private messageService: MessageService,\r\n    private shareMapService: ShareMapService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.resetUrl();\r\n    this.mapState$$ = combineLatest([\r\n      this.map.viewController.state$,\r\n      this.map.status$\r\n    ]).subscribe((c) => {\r\n      this.resetUrl();\r\n      this.cdRef.detectChanges();\r\n    });\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.resetUrl();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.mapState$$.unsubscribe();\r\n  }\r\n\r\n  resetUrl(values: any = {}) {\r\n    this.url = this.shareMapService.getUrlWithoutApi(\r\n      this.map,\r\n      this.publicShareOption\r\n    );\r\n  }\r\n\r\n  copyTextToClipboard(textArea) {\r\n    const successful = Clipboard.copy(textArea);\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.context.shareMap.dialog.copyMsg',\r\n        'igo.context.shareMap.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n}\r\n","<form class=\"igo-form\" [formGroup]=\"form\" (ngSubmit)=\"createUrl(form.value)\">\r\n  <div class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        required\r\n        [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\r\n        formControlName=\"title\"\r\n      />\r\n      <mat-error>\r\n        {{ 'igo.context.contextManager.form.titleRequired' | translate }}\r\n      </mat-error>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div id=\"uriInput\" class=\"igo-input-container\">\r\n    <mat-form-field>\r\n      <span *ngIf=\"userId\" class=\"prefix\">{{ userId }}-</span>\r\n      <span class=\"fieldWrapper\">\r\n        <input\r\n          matInput\r\n          required\r\n          [readonly]=\"!userId\"\r\n          [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\r\n          formControlName=\"uri\"\r\n        />\r\n      </span>\r\n      <mat-error>\r\n        {{ 'igo.context.contextManager.form.uriRequired' | translate }}\r\n      </mat-error>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"igo-form-button-group\">\r\n    <button\r\n      *ngIf=\"!url\"\r\n      mat-raised-button\r\n      type=\"submit\"\r\n      [disabled]=\"!form.valid\"\r\n    >\r\n      {{ 'igo.context.shareMap.button' | translate }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"url\"\r\n      mat-raised-button\r\n      type=\"button\"\r\n      (click)=\"updateContextShared(form.value)\"\r\n    >\r\n      {{ 'igo.context.shareMap.refreshBtn' | translate }}\r\n    </button>\r\n  </div>\r\n</form>\r\n\r\n<div *ngIf=\"url\" class=\"igo-input-container linkToShare\">\r\n  <mat-form-field>\r\n    <textarea\r\n      #textArea\r\n      matInput\r\n      readonly\r\n      rows=\"3\"\r\n      class=\"textAreaWithButton\"\r\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\r\n      [value]=\"url\"\r\n    ></textarea>\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.context.shareMap.copy' | translate\"\r\n      color=\"primary\"\r\n      (click)=\"copyTextToClipboard(textArea)\"\r\n    >\r\n      <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n    </button>\r\n  </mat-form-field>\r\n  <div></div>\r\n</div>\r\n","import { Component, Input, OnInit } from '@angular/core';\r\nimport { UntypedFormBuilder, UntypedFormGroup } from '@angular/forms';\r\n\r\nimport { uuid, Clipboard } from '@igo2/utils';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\nimport { AuthService } from '@igo2/auth';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { ShareMapService } from '../shared/share-map.service';\r\n\r\n@Component({\r\n  selector: 'igo-share-map-api',\r\n  templateUrl: './share-map-api.component.html',\r\n  styleUrls: ['./share-map-api.component.scss']\r\n})\r\nexport class ShareMapApiComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  public url: string;\r\n  public userId: string;\r\n  public idContextShared: string;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private auth: AuthService,\r\n    private shareMapService: ShareMapService,\r\n    private formBuilder: UntypedFormBuilder\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.auth.authenticate$.subscribe((auth) => {\r\n      const decodeToken = this.auth.decodeToken();\r\n      this.userId = decodeToken.user ? decodeToken.user.id : undefined;\r\n      this.buildForm();\r\n    });\r\n  }\r\n\r\n  createUrl(values: any = {}) {\r\n    const inputs = Object.assign({}, values);\r\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\r\n    this.url = this.shareMapService.getUrlWithApi(inputs);\r\n    this.shareMapService.createContextShared(this.map, inputs).subscribe(\r\n      (rep) => {\r\n        this.idContextShared = rep.id;\r\n        this.messageService.success(\r\n          'igo.context.contextManager.dialog.saveMsg',\r\n          'igo.context.contextManager.dialog.saveTitle',\r\n          undefined,\r\n          { value: inputs.title }\r\n        );\r\n      },\r\n      (err) => {\r\n        err.error.title = this.languageService.translate.instant(\r\n          'igo.context.shareMap.errorTitle'\r\n        );\r\n        this.messageService.showError(err);\r\n      }\r\n    );\r\n  }\r\n\r\n  updateContextShared(values: any = {}) {\r\n    const inputs = Object.assign({}, values);\r\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\r\n    this.shareMapService\r\n      .updateContextShared(this.map, inputs, this.idContextShared)\r\n      .subscribe(\r\n        (rep) => {\r\n          this.messageService.success(\r\n            'igo.context.contextManager.dialog.saveMsg',\r\n            'igo.context.contextManager.dialog.saveTitle',\r\n            undefined,\r\n            { value: inputs.title }\r\n          );\r\n        },\r\n        (err) => {\r\n          err.error.title = this.languageService.translate.instant(\r\n            'igo.context.shareMap.errorTitle'\r\n          );\r\n          this.messageService.showError(err);\r\n        }\r\n      );\r\n  }\r\n\r\n  copyTextToClipboard(textArea) {\r\n    const successful = Clipboard.copy(textArea);\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.context.shareMap.dialog.copyMsg',\r\n        'igo.context.shareMap.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  buildForm(): void {\r\n    this.url = undefined;\r\n    const id = uuid();\r\n    let title = 'Partage ';\r\n    title += this.userId ? `(${this.userId}-${id})` : `(${id})`;\r\n    this.form = this.formBuilder.group({\r\n      title: [title],\r\n      uri: [id]\r\n    });\r\n  }\r\n}\r\n","<mat-tab-group *ngIf=\"hasApi\">\r\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithApi' | translate\">\r\n    <igo-share-map-api [map]=\"map\"></igo-share-map-api>\r\n  </mat-tab>\r\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithUrl' | translate\">\r\n    <igo-share-map-url [map]=\"map\"></igo-share-map-url>\r\n  </mat-tab>\r\n</mat-tab-group>\r\n\r\n<igo-share-map-url *ngIf=\"!hasApi\" [map]=\"map\"></igo-share-map-url>\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'igo-share-map',\r\n  templateUrl: './share-map.component.html',\r\n  styleUrls: ['./share-map.component.scss']\r\n})\r\nexport class ShareMapComponent {\r\n  @Input() map: IgoMap;\r\n\r\n  public hasApi = false;\r\n\r\n  constructor(private config: ConfigService) {\r\n    this.hasApi = this.config.getConfig('context.url') ? true : false;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoSearchModule } from '@igo2/geo';\r\n\r\nimport { SearchBarBindingDirective } from './search-bar-binding.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [IgoSearchModule],\r\n  declarations: [SearchBarBindingDirective],\r\n  exports: [SearchBarBindingDirective]\r\n})\r\nexport class IgoAppSearchBarModule {}\r\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoFlexibleModule,\r\n  IgoCustomHtmlModule,\r\n  IgoPanelModule\r\n} from '@igo2/common';\r\nimport {\r\n  IgoFeatureModule,\r\n  IgoSearchModule,\r\n  IgoFeatureDetailsModule\r\n} from '@igo2/geo';\r\n\r\nimport { SearchResultsToolComponent } from './search-results-tool.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatBadgeModule,\r\n    MatTooltipModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule,\r\n    IgoFeatureModule,\r\n    IgoSearchModule,\r\n    IgoFlexibleModule,\r\n    IgoPanelModule,\r\n    IgoFeatureDetailsModule,\r\n    IgoCustomHtmlModule\r\n  ],\r\n  declarations: [SearchResultsToolComponent],\r\n  exports: [SearchResultsToolComponent],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class IgoAppSearchResultsToolModule {}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoAppSearchBarModule } from './search-bar/search-bar.module';\r\nimport { IgoAppSearchResultsToolModule } from './search-results-tool/search-results-tool.module';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: [IgoAppSearchBarModule, IgoAppSearchResultsToolModule]\r\n})\r\nexport class IgoAppSearchModule {}\r\n","<p></p>\r\n<igo-interactive-tour\r\n  mat-raised-button\r\n  tourToStart=\"global\"\r\n  menuIsOpen=\"true\"\r\n  styleButton=\"raised\"\r\n  [discoverTitleInLocale$]=\"discoverTitleInLocale$\"\r\n>\r\n</igo-interactive-tour>\r\n\r\n<button\r\n  *ngIf=\"\r\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length === 1\r\n  \"\r\n  class=\"training-guide-button\"\r\n  mat-raised-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [disabled]=\"loading\"\r\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\r\n  (click)=\"openGuide()\"\r\n>\r\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\r\n  <mat-icon svgIcon=\"file-document\"></mat-icon>\r\n</button>\r\n\r\n<button\r\n  *ngIf=\"\r\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length > 1\r\n  \"\r\n  class=\"training-guide-button\"\r\n  mat-raised-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [disabled]=\"loading\"\r\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\r\n  [matMenuTriggerFor]=\"menu\"\r\n>\r\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\r\n  <mat-icon svgIcon=\"file-document\"></mat-icon>\r\n</button>\r\n\r\n<mat-menu #menu=\"matMenu\">\r\n  <button\r\n    *ngFor=\"let guide of trainingGuideURLs\"\r\n    mat-menu-item\r\n    (click)=\"openGuide(guide)\"\r\n  >\r\n    {{ formatFileName(guide) }}\r\n  </button>\r\n</mat-menu>\r\n\r\n<igo-custom-html\r\n  *ngIf=\"headerHtml !== ''\"\r\n  class=\"mat-typography\"\r\n  [html]=\"headerHtml | translate\"\r\n>\r\n</igo-custom-html>\r\n\r\n<igo-custom-html\r\n  class=\"mat-typography\"\r\n  [html]=\"html | translate: { version: version }\"\r\n>\r\n</igo-custom-html>\r\n","import { ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { ConfigService, LanguageService, Version } from '@igo2/core';\r\nimport { of } from 'rxjs';\r\nimport type { Observable } from 'rxjs';\r\nimport { AuthService } from '@igo2/auth';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\n@ToolComponent({\r\n  name: 'about',\r\n  title: 'igo.integration.tools.about',\r\n  icon: 'help-circle'\r\n})\r\n@Component({\r\n  selector: 'igo-about-tool',\r\n  templateUrl: './about-tool.component.html',\r\n  styleUrls: ['./about-tool.component.scss']\r\n})\r\nexport class AboutToolComponent implements OnInit {\r\n  @Input()\r\n  get headerHtml() {\r\n    return this._headerHtml;\r\n  }\r\n  set headerHtml(value: string) {\r\n    this._headerHtml = Array.isArray(value) ? value.join('\\n') : value;\r\n  }\r\n\r\n  @Input()\r\n  get html() {\r\n    return this._html;\r\n  }\r\n  set html(value: string) {\r\n    this._html = Array.isArray(value) ? value.join('\\n') : value;\r\n  }\r\n  private _discoverTitleInLocale: string = 'IGO';\r\n  public discoverTitleInLocale$: Observable<string> = of(\r\n    this._discoverTitleInLocale\r\n  );\r\n\r\n  @Input()\r\n  get discoverTitleInLocale() {\r\n    return this._discoverTitleInLocale;\r\n  }\r\n  set discoverTitleInLocale(value: string) {\r\n    this._discoverTitleInLocale = value;\r\n    this.discoverTitleInLocale$ = of(value);\r\n  }\r\n\r\n  @Input() trainingGuideURLs;\r\n\r\n  public version: Version;\r\n  private _html: string = 'igo.integration.aboutTool.html';\r\n  private _headerHtml: string;\r\n\r\n  private baseUrlProfil;\r\n  private baseUrlGuide;\r\n\r\n  public loading = false;\r\n\r\n  constructor(\r\n    public configService: ConfigService,\r\n    public auth: AuthService,\r\n    private http: HttpClient,\r\n    private cdRef: ChangeDetectorRef,\r\n    private languageService: LanguageService\r\n  ) {\r\n    this.headerHtml = this.languageService.translate.instant(\r\n      'igo.integration.aboutTool.headerHtml'\r\n    );\r\n    this.version = configService.getConfig('version');\r\n    this.baseUrlProfil = configService.getConfig('storage.url');\r\n    this.baseUrlGuide =\r\n      configService.getConfig('depot.url') +\r\n      configService.getConfig('depot.guideUrl');\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (\r\n      this.auth.authenticated &&\r\n      this.configService.getConfig('context.url')\r\n    ) {\r\n      this.http.get(this.baseUrlProfil).subscribe((profil) => {\r\n        const recast = profil as any;\r\n        this.trainingGuideURLs = recast.guides;\r\n        this.cdRef.detectChanges();\r\n      });\r\n    } else if (\r\n      this.auth.authenticated &&\r\n      !this.configService.getConfig('context.url') &&\r\n      this.configService.getConfig('depot.trainingGuides')\r\n    ) {\r\n      this.trainingGuideURLs = this.configService.getConfig(\r\n        'depot.trainingGuides'\r\n      );\r\n    }\r\n  }\r\n\r\n  openGuide(guide?) {\r\n    this.loading = true;\r\n    const url = guide\r\n      ? this.baseUrlGuide + guide + '?'\r\n      : this.baseUrlGuide + this.trainingGuideURLs[0] + '?';\r\n    this.http\r\n      .get(url, {\r\n        responseType: 'blob'\r\n      })\r\n      .subscribe(() => {\r\n        this.loading = false;\r\n        window.open(url, '_blank');\r\n        this.cdRef.detectChanges();\r\n      });\r\n  }\r\n\r\n  formatFileName(name: string) {\r\n    name = name.split('_').join(' ');\r\n    const index = name.indexOf('.');\r\n    name = name.slice(0, index);\r\n    return name;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { ExportOptions } from '@igo2/geo';\r\n\r\nexport enum ImportExportType {\r\n  layer = 'layer',\r\n  context = 'context'\r\n}\r\n\r\nexport enum ImportExportMode {\r\n  import = 'import',\r\n  export = 'export'\r\n}\r\n\r\n/**\r\n * Service that holds the state of the importExport module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ImportExportState {\r\n  readonly importExportType$: BehaviorSubject<ImportExportType> =\r\n    new BehaviorSubject(ImportExportType.layer);\r\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> =\r\n    new BehaviorSubject(ImportExportMode.import);\r\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  setImportExportType(type: ImportExportType) {\r\n    this.importExportType$.next(type);\r\n  }\r\n\r\n  setMode(mode: ImportExportMode) {\r\n    this.selectedMode$.next(mode);\r\n  }\r\n\r\n  setsExportOptions(exportOptions: ExportOptions) {\r\n    this.exportOptions$.next(exportOptions);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { Toolbox, ToolService } from '@igo2/common';\r\n\r\nimport { ExportOptions } from '@igo2/geo';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from '../import-export/import-export.state';\r\n\r\n/**\r\n * Service that holds the state of the search module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ToolState {\r\n  get toolbox(): Toolbox {\r\n    return this.toolService.toolbox;\r\n  }\r\n\r\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  constructor(\r\n    private toolService: ToolService,\r\n    private importExportState: ImportExportState\r\n  ) {}\r\n\r\n  toolToActivateFromOptions(toolToActivate: {\r\n    tool: string;\r\n    options: { [key: string]: any };\r\n  }) {\r\n    if (!toolToActivate) {\r\n      return;\r\n    }\r\n    if (toolToActivate.tool === 'importExport') {\r\n      let exportOptions: ExportOptions =\r\n        this.importExportState.exportOptions$.value;\r\n      if (!exportOptions) {\r\n        exportOptions = {\r\n          layers: toolToActivate.options.layers,\r\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\r\n        };\r\n      } else {\r\n        exportOptions.layers = toolToActivate.options.layers;\r\n        exportOptions.featureInMapExtent =\r\n          toolToActivate.options.featureInMapExtent;\r\n      }\r\n      this.importExportState.setsExportOptions(exportOptions);\r\n      this.importExportState.setMode(ImportExportMode.export);\r\n    }\r\n\r\n    if (this.toolbox.getTool(toolToActivate.tool)) {\r\n      this.toolbox.activateTool(toolToActivate.tool);\r\n      this.openSidenav$.next(true);\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { Tool, ToolService } from '@igo2/common';\nimport { ContextService, DetailedContext } from '@igo2/context';\n\nimport { ToolState } from '../tool/tool.state';\n\n/**\n * Service that holds the state of the context module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextState {\n  /**\n   * Observable of the active context\n   */\n  context$: BehaviorSubject<DetailedContext> = new BehaviorSubject(undefined);\n\n  constructor(\n    private contextService: ContextService,\n    private toolService: ToolService,\n    private toolState: ToolState,\n    private languageService: LanguageService\n  ) {\n    this.contextService.context$.subscribe((context: DetailedContext) => {\n      this.onContextChange(context);\n    });\n    this.contextService.toolsChanged$.subscribe((context: DetailedContext) => {\n      this.updateTools(context);\n    });\n  }\n\n  /**\n   * Set the active context\n   * @param context Detailed context\n   */\n  private setContext(context: DetailedContext) {\n    this.updateTools(context);\n    this.context$.next(context);\n  }\n\n  /**\n   * Update the tool state with the context's tools\n   * @param context Detailed context\n   */\n  private updateTools(context: DetailedContext) {\n    const toolbox = this.toolState.toolbox;\n\n    const tools = [];\n    const contextTools = context.tools || [];\n    contextTools.forEach((contextTool: Tool) => {\n      const baseTool = this.toolService.getTool(contextTool.name);\n      if (baseTool === undefined) {\n        return;\n      }\n\n      const options = Object.assign(\n        {},\n        baseTool.options || {},\n        contextTool.options || {}\n      );\n      const tool = Object.assign({}, baseTool, contextTool, { options });\n      tools.push(tool);\n    });\n\n    tools.forEach((tool) => {\n      if (tool.parent) {\n        const parentIndex = tools.findIndex((el) => el.name === tool.parent);\n        if (parentIndex !== -1) {\n          tools[parentIndex].children = [];\n          tools[parentIndex].children.push(tool.name);\n        }\n      }\n    });\n\n    toolbox.setTools(tools);\n    toolbox.setToolbar(context.toolbar || []);\n\n    // TODO: This is a patch so the context service can work without\n    // injecting the ToolState or without being completely refactored\n    this.contextService.setTools([].concat(tools));\n    this.contextService.setToolbar(context.toolbar || []);\n  }\n\n  /**\n   * Set a new context and update the tool state\n   * @param context Detailed context\n   */\n  private onContextChange(context: DetailedContext) {\n    if (context === undefined) {\n      return;\n    }\n    this.setContext(context);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\n\n/**\n * Service that holds the state of storage service\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageState {\n  get storageService(): StorageService {\n    return this.igoStorageService;\n  }\n\n  constructor(private igoStorageService: StorageService) {}\n}\n","import {\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreFilterSelectionStrategy,\r\n  Widget,\r\n  Action\r\n} from '@igo2/common';\r\nimport { LanguageService, MediaService, StorageService } from '@igo2/core';\r\nimport {\r\n  FeatureMotion,\r\n  FeatureStoreSelectionStrategy,\r\n  FeatureWorkspace,\r\n  WfsWorkspace,\r\n  EditionWorkspace,\r\n  mapExtentStrategyActiveToolTip,\r\n  noElementSelected,\r\n  ExportOptions,\r\n  OgcFilterableDataSource\r\n} from '@igo2/geo';\r\nimport { BehaviorSubject, map } from 'rxjs';\r\n\r\nimport * as jsPDF from 'jspdf';\r\nimport 'jspdf-autotable';\r\nimport { ToolState } from '../../tool';\r\nimport { DatePipe } from '@angular/common';\r\n\r\nexport function handleZoomAuto(\r\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\r\n  storageService\r\n) {\r\n  const zoomStrategy = workspace.entityStore.getStrategyOfType(\r\n    FeatureStoreSelectionStrategy\r\n  ) as FeatureStoreSelectionStrategy;\r\n  zoomStrategy.setMotion(\r\n    (storageService.get('zoomAuto') as boolean)\r\n      ? FeatureMotion.Default\r\n      : FeatureMotion.None\r\n  );\r\n}\r\n\r\nexport function getWorkspaceActions(\r\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\r\n  rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n  selectOnlyCheckCondition$: BehaviorSubject<boolean>,\r\n  ogcFilterWidget: Widget,\r\n  zoomAuto$: BehaviorSubject<boolean>,\r\n  maximize$: BehaviorSubject<boolean>,\r\n  storageService: StorageService,\r\n  languageService: LanguageService,\r\n  mediaService: MediaService,\r\n  toolState: ToolState,\r\n  datePipe: DatePipe\r\n): Action[] {\r\n  const actions = [\r\n    {\r\n      id: 'zoomAuto',\r\n      checkbox: true,\r\n      title: 'igo.integration.workspace.zoomAuto.title',\r\n      tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\r\n      checkCondition: zoomAuto$,\r\n      handler: () => {\r\n        handleZoomAuto(workspace, storageService);\r\n        storageService.set(\r\n          'zoomAuto',\r\n          !storageService.get('zoomAuto') as boolean\r\n        );\r\n      }\r\n    },\r\n    {\r\n      id: 'filterInMapExtent',\r\n      checkbox: true,\r\n      title: 'igo.integration.workspace.inMapExtent.title',\r\n      tooltip: mapExtentStrategyActiveToolTip(workspace),\r\n      checkCondition: rowsInMapExtentCheckCondition$,\r\n      handler: () =>\r\n        rowsInMapExtentCheckCondition$.next(\r\n          !rowsInMapExtentCheckCondition$.value\r\n        )\r\n    },\r\n    {\r\n      id: 'selectedOnly',\r\n      checkbox: true,\r\n      title: 'igo.integration.workspace.selected.title',\r\n      tooltip: 'igo.integration.workspace.selected.tooltip',\r\n      checkCondition: selectOnlyCheckCondition$,\r\n      handler: () =>\r\n        selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\r\n    },\r\n    {\r\n      id: 'clearselection',\r\n      icon: 'select-off',\r\n      title: 'igo.integration.workspace.clearSelection.title',\r\n      tooltip: 'igo.integration.workspace.clearSelection.tooltip',\r\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\r\n        ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\r\n          selected: false\r\n        });\r\n      },\r\n      args: [workspace],\r\n      availability: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) =>\r\n        noElementSelected(ws)\r\n    },\r\n    {\r\n      id: 'featureDownload',\r\n      icon: 'file-export',\r\n      title: 'igo.integration.workspace.download.title',\r\n      tooltip: 'igo.integration.workspace.download.tooltip',\r\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\r\n        const filterStrategy = ws.entityStore.getStrategyOfType(\r\n          EntityStoreFilterCustomFuncStrategy\r\n        );\r\n        const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\r\n          EntityStoreFilterSelectionStrategy\r\n        );\r\n        const layersWithSelection = filterSelectionStrategy.active\r\n          ? [ws.layer.id]\r\n          : [];\r\n        toolState.toolToActivateFromOptions({\r\n          tool: 'importExport',\r\n          options: {\r\n            layers: [ws.layer.id],\r\n            featureInMapExtent: filterStrategy.active,\r\n            layersWithSelection\r\n          } as ExportOptions\r\n        });\r\n      },\r\n      args: [workspace]\r\n    },\r\n    {\r\n      id: 'ogcFilter',\r\n      icon: 'filter',\r\n      title: 'igo.integration.workspace.ogcFilter.title',\r\n      tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\r\n      handler: (\r\n        widget: Widget,\r\n        ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace\r\n      ) => {\r\n        ws.activateWidget(widget, {\r\n          map: ws.map,\r\n          layer: ws.layer\r\n        });\r\n      },\r\n      args: [ogcFilterWidget, workspace]\r\n    },\r\n    {\r\n      id: 'maximize',\r\n      title: languageService.translate.instant(\r\n        'igo.integration.workspace.maximize'\r\n      ),\r\n      tooltip: languageService.translate.instant(\r\n        'igo.integration.workspace.maximizeTooltip'\r\n      ),\r\n      icon: 'resize',\r\n      display: () => {\r\n        return maximize$.pipe(map((v) => !v && !mediaService.isMobile()));\r\n      },\r\n      handler: () => {\r\n        if (!mediaService.isMobile()) {\r\n          maximize$.next(true);\r\n        }\r\n      }\r\n    },\r\n    {\r\n      id: 'standardExtent',\r\n      title: languageService.translate.instant(\r\n        'igo.integration.workspace.standardExtent'\r\n      ),\r\n      tooltip: languageService.translate.instant(\r\n        'igo.integration.workspace.standardExtentTooltip'\r\n      ),\r\n      icon: 'resize',\r\n      display: () => {\r\n        return maximize$.pipe(map((v) => v && !mediaService.isMobile()));\r\n      },\r\n      handler: () => {\r\n        maximize$.next(false);\r\n      }\r\n    },\r\n    {\r\n      id: 'print',\r\n      icon: 'printer',\r\n      title: 'igo.integration.workspace.print.title',\r\n      tooltip: 'igo.integration.workspace.print.tooltip',\r\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\r\n        const title = `${ws.layer.title} (${datePipe.transform(\r\n          Date.now(),\r\n          'YYYY-MM-dd-H_mm'\r\n        )})`;\r\n        const doc: any = new jsPDF.default('landscape');\r\n        const totalPagesExp = '{total_pages_count_string}';\r\n        doc.text(title, 14, 20);\r\n        doc.autoTable({\r\n          startY: 25,\r\n          tableWidth: 'wrap',\r\n          html: '#currentWorkspaceTable',\r\n          horizontalPageBreak: true,\r\n          styles: { cellPadding: 0.5, minCellWidth: 20, fontSize: 6 },\r\n          didDrawPage: (data) => {\r\n            let str = 'Page ' + doc.internal.getNumberOfPages();\r\n            if (typeof doc.putTotalPages === 'function') {\r\n              str = str + ' / ' + totalPagesExp;\r\n            }\r\n            doc.setFontSize(6);\r\n            const pageSize = doc.internal.pageSize;\r\n            const pageHeight = pageSize.height\r\n              ? pageSize.height\r\n              : pageSize.getHeight();\r\n            doc.text(str, data.settings.margin.left, pageHeight - 10);\r\n          }\r\n        });\r\n        if (typeof doc.putTotalPages === 'function') {\r\n          doc.putTotalPages(totalPagesExp);\r\n        }\r\n        doc.save(`${title}.pdf`);\r\n      },\r\n      args: [workspace]\r\n    }\r\n  ];\r\n  let returnActions = (workspace.layer.dataSource as OgcFilterableDataSource)\r\n    .options.ogcFilters?.enabled\r\n    ? actions\r\n    : actions.filter((action) => action.id !== 'ogcFilter');\r\n  returnActions =\r\n    workspace.layer.options.workspace.printable !== false\r\n      ? actions\r\n      : actions.filter((action) => action.id !== 'print');\r\n  return returnActions;\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport { Action } from '@igo2/common';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { FeatureWorkspace } from '@igo2/geo';\r\nimport {\r\n  StorageService,\r\n  StorageServiceEvent,\r\n  StorageServiceEventEnum,\r\n  LanguageService,\r\n  MediaService\r\n} from '@igo2/core';\r\nimport { StorageState } from '../../storage/storage.state';\r\nimport { skipWhile } from 'rxjs/operators';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\r\nimport { DatePipe } from '@angular/common';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FeatureActionsService implements OnDestroy {\r\n  public maximize$: BehaviorSubject<boolean>;\r\n\r\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private storageChange$$: Subscription;\r\n\r\n  get storageService(): StorageService {\r\n    return this.storageState.storageService;\r\n  }\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    private storageState: StorageState,\r\n    public languageService: LanguageService,\r\n    private toolState: ToolState,\r\n    private mediaService: MediaService,\r\n    private datePipe: DatePipe\r\n  ) {\r\n    this.maximize$ = new BehaviorSubject(\r\n      this.storageService.get('workspaceMaximize') as boolean\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.storageChange$$) {\r\n      this.storageChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  loadActions(\r\n    workspace: FeatureWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ) {\r\n    const actions = this.buildActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$\r\n    );\r\n    workspace.actionStore.load(actions);\r\n  }\r\n\r\n  buildActions(\r\n    workspace: FeatureWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ): Action[] {\r\n    this.zoomAuto$.next(this.zoomAuto);\r\n    this.storageChange$$ = this.storageService.storageChange$\r\n      .pipe(\r\n        skipWhile(\r\n          (storageChange: StorageServiceEvent) =>\r\n            storageChange?.key !== 'zoomAuto' ||\r\n            storageChange?.event === StorageServiceEventEnum.CLEARED\r\n        )\r\n      )\r\n      .subscribe(() => {\r\n        this.zoomAuto$.next(this.zoomAuto);\r\n        handleZoomAuto(workspace, this.storageService);\r\n      });\r\n    return getWorkspaceActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$,\r\n      undefined,\r\n      this.zoomAuto$,\r\n      this.maximize$,\r\n      this.storageService,\r\n      this.languageService,\r\n      this.mediaService,\r\n      this.toolState,\r\n      this.datePipe\r\n    );\r\n  }\r\n}\r\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport { Action, Widget } from '@igo2/common';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { WfsWorkspace, OgcFilterWidget } from '@igo2/geo';\r\nimport {\r\n  StorageService,\r\n  StorageServiceEvent,\r\n  StorageServiceEventEnum,\r\n  LanguageService,\r\n  MediaService\r\n} from '@igo2/core';\r\nimport { StorageState } from '../../storage/storage.state';\r\nimport { skipWhile } from 'rxjs/operators';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\r\nimport { DatePipe } from '@angular/common';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WfsActionsService implements OnDestroy {\r\n  public maximize$: BehaviorSubject<boolean>;\r\n\r\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private storageChange$$: Subscription;\r\n\r\n  get storageService(): StorageService {\r\n    return this.storageState.storageService;\r\n  }\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\r\n    private storageState: StorageState,\r\n    public languageService: LanguageService,\r\n    private mediaService: MediaService,\r\n    private toolState: ToolState,\r\n    private datePipe: DatePipe\r\n  ) {\r\n    this.maximize$ = new BehaviorSubject(\r\n      this.storageService.get('workspaceMaximize') as boolean\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.storageChange$$) {\r\n      this.storageChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  loadActions(\r\n    workspace: WfsWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ) {\r\n    const actions = this.buildActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$\r\n    );\r\n    workspace.actionStore.load(actions);\r\n  }\r\n\r\n  buildActions(\r\n    workspace: WfsWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ): Action[] {\r\n    this.zoomAuto$.next(this.zoomAuto);\r\n    this.storageChange$$ = this.storageService.storageChange$\r\n      .pipe(\r\n        skipWhile(\r\n          (storageChange: StorageServiceEvent) =>\r\n            storageChange?.key !== 'zoomAuto' ||\r\n            storageChange?.event === StorageServiceEventEnum.CLEARED\r\n        )\r\n      )\r\n      .subscribe(() => {\r\n        this.zoomAuto$.next(this.zoomAuto);\r\n        handleZoomAuto(workspace, this.storageService);\r\n      });\r\n    return getWorkspaceActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$,\r\n      this.ogcFilterWidget,\r\n      this.zoomAuto$,\r\n      this.maximize$,\r\n      this.storageService,\r\n      this.languageService,\r\n      this.mediaService,\r\n      this.toolState,\r\n      this.datePipe\r\n    );\r\n  }\r\n}\r\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport { Action, Widget } from '@igo2/common';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { EditionWorkspace, OgcFilterWidget } from '@igo2/geo';\r\nimport {\r\n  StorageService,\r\n  StorageServiceEvent,\r\n  StorageServiceEventEnum,\r\n  LanguageService,\r\n  MediaService\r\n} from '@igo2/core';\r\nimport { StorageState } from '../../storage/storage.state';\r\nimport { skipWhile } from 'rxjs/operators';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\r\nimport { DatePipe } from '@angular/common';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class EditionActionsService implements OnDestroy {\r\n  public maximize$: BehaviorSubject<boolean>;\r\n\r\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private storageChange$$: Subscription;\r\n\r\n  get storageService(): StorageService {\r\n    return this.storageState.storageService;\r\n  }\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\r\n    private storageState: StorageState,\r\n    public languageService: LanguageService,\r\n    private mediaService: MediaService,\r\n    private toolState: ToolState,\r\n    private datePipe: DatePipe\r\n  ) {\r\n    this.maximize$ = new BehaviorSubject(\r\n      this.storageService.get('workspaceMaximize') as boolean\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.storageChange$$) {\r\n      this.storageChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  loadActions(\r\n    workspace: EditionWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ) {\r\n    const actions = this.buildActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$\r\n    );\r\n    workspace.actionStore.load(actions);\r\n  }\r\n\r\n  buildActions(\r\n    workspace: EditionWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ): Action[] {\r\n    this.zoomAuto$.next(this.zoomAuto);\r\n    this.storageChange$$ = this.storageService.storageChange$\r\n      .pipe(\r\n        skipWhile(\r\n          (storageChange: StorageServiceEvent) =>\r\n            storageChange?.key !== 'zoomAuto' ||\r\n            storageChange?.event === StorageServiceEventEnum.CLEARED\r\n        )\r\n      )\r\n      .subscribe(() => {\r\n        this.zoomAuto$.next(this.zoomAuto);\r\n        handleZoomAuto(workspace, this.storageService);\r\n      });\r\n    return getWorkspaceActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$,\r\n      this.ogcFilterWidget,\r\n      this.zoomAuto$,\r\n      this.maximize$,\r\n      this.storageService,\r\n      this.languageService,\r\n      this.mediaService,\r\n      this.toolState,\r\n      this.datePipe\r\n    );\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription, Observable, of } from 'rxjs';\r\n\r\nimport {\r\n  EntityRecord,\r\n  Workspace,\r\n  WorkspaceStore,\r\n  Widget,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreFilterSelectionStrategy,\r\n  EntityState\r\n} from '@igo2/common';\r\nimport { WfsWorkspace, FeatureWorkspace, EditionWorkspace } from '@igo2/geo';\r\nimport { FeatureActionsService } from './shared/feature-actions.service';\r\nimport { WfsActionsService } from './shared/wfs-actions.service';\r\nimport { StorageService } from '@igo2/core';\r\nimport { EditionActionsService } from './shared/edition-actions.service';\r\n\r\n/**\r\n * Service that holds the state of the workspace module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WorkspaceState implements OnDestroy {\r\n  public workspacePanelExpanded: boolean = false;\r\n\r\n  readonly workspaceEnabled$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(false);\r\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(true);\r\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(false);\r\n\r\n  readonly workspaceMaximize$: BehaviorSubject<boolean>;\r\n  private actionMaximize$$: Subscription[] = [];\r\n\r\n  private rowsInMapExtentCheckCondition$$: Subscription;\r\n  private selectOnlyCheckCondition$$: Subscription;\r\n\r\n  /** Subscription to the active workspace */\r\n  private activeWorkspace$$: Subscription;\r\n\r\n  /** Subscription to the active workspace widget */\r\n  private activeWorkspaceWidget$$: Subscription;\r\n\r\n  /** Active widget observable. Only one may be active for all available workspaces */\r\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> =\r\n    new BehaviorSubject<Widget>(undefined);\r\n\r\n  /**\r\n   * Observable of the active workspace\r\n   */\r\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\r\n\r\n  /**\r\n   * Store that holds all the available workspaces\r\n   */\r\n  get store(): WorkspaceStore {\r\n    return this._store;\r\n  }\r\n  private _store: WorkspaceStore;\r\n\r\n  get workspaceSelection() {\r\n    if (this.workspace$.value) {\r\n      return this.workspace$.value?.entityStore.stateView.manyBy(\r\n        (r) => r.state.selected === true\r\n      );\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  get workspaceSelection$(): Observable<EntityRecord<object, EntityState>[]> {\r\n    if (this.workspace$.value) {\r\n      return this.workspace$.value?.entityStore?.stateView.manyBy$(\r\n        (r) => r.state.selected === true\r\n      );\r\n    } else {\r\n      return of([]);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private featureActionsService: FeatureActionsService,\r\n    private wfsActionsService: WfsActionsService,\r\n    private editionActionsService: EditionActionsService,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.workspaceMaximize$ = new BehaviorSubject(\r\n      this.storageService.get('workspaceMaximize') as boolean\r\n    );\r\n    this.initWorkspaces();\r\n  }\r\n\r\n  /**\r\n   * Initialize the workspace store. Each time a workspace is activated,\r\n   * subscribe to it's active widget. Tracking the active widget is useful\r\n   * to make sure only one widget is active at a time.\r\n   */\r\n  private initWorkspaces() {\r\n    this._store = new WorkspaceStore([]);\r\n    this._store.stateView\r\n      .firstBy$(\r\n        (record: EntityRecord<Workspace>) => record.state.active === true\r\n      )\r\n      .subscribe((record: EntityRecord<Workspace>) => {\r\n        const workspace = record ? record.entity : undefined;\r\n        this.workspace$.next(workspace);\r\n      });\r\n\r\n    this._store.stateView\r\n      .all$()\r\n      .subscribe((workspaces: EntityRecord<Workspace>[]) => {\r\n        workspaces.map((wks: EntityRecord<Workspace>) => {\r\n          if (wks.entity.actionStore.empty) {\r\n            if (wks.entity instanceof WfsWorkspace) {\r\n              this.wfsActionsService.loadActions(\r\n                wks.entity,\r\n                this.rowsInMapExtentCheckCondition$,\r\n                this.selectOnlyCheckCondition$\r\n              );\r\n            } else if (wks.entity instanceof FeatureWorkspace) {\r\n              this.featureActionsService.loadActions(\r\n                wks.entity,\r\n                this.rowsInMapExtentCheckCondition$,\r\n                this.selectOnlyCheckCondition$\r\n              );\r\n            } else if (wks.entity instanceof EditionWorkspace) {\r\n              this.editionActionsService.loadActions(\r\n                wks.entity,\r\n                this.rowsInMapExtentCheckCondition$,\r\n                this.selectOnlyCheckCondition$\r\n              );\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n    this.actionMaximize$$.push(\r\n      this.featureActionsService.maximize$.subscribe((maximized) => {\r\n        this.setWorkspaceIsMaximized(maximized);\r\n      })\r\n    );\r\n\r\n    this.actionMaximize$$.push(\r\n      this.wfsActionsService.maximize$.subscribe((maximized) => {\r\n        this.setWorkspaceIsMaximized(maximized);\r\n      })\r\n    );\r\n\r\n    this.actionMaximize$$.push(\r\n      this.editionActionsService.maximize$.subscribe((maximized) => {\r\n        this.setWorkspaceIsMaximized(maximized);\r\n      })\r\n    );\r\n\r\n    this.activeWorkspace$$ = this.workspace$.subscribe(\r\n      (workspace: Workspace) => {\r\n        if (this.activeWorkspaceWidget$$ !== undefined) {\r\n          this.activeWorkspaceWidget$$.unsubscribe();\r\n          this.activeWorkspaceWidget$$ = undefined;\r\n        }\r\n\r\n        if (workspace !== undefined) {\r\n          this.activeWorkspaceWidget$$ = workspace.widget$.subscribe(\r\n            (widget: Widget) => this.activeWorkspaceWidget$.next(widget)\r\n          );\r\n        }\r\n      }\r\n    );\r\n\r\n    this.rowsInMapExtentCheckCondition$$ =\r\n      this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\r\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\r\n          if (!wks.entity.actionStore.empty) {\r\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\r\n              EntityStoreFilterCustomFuncStrategy\r\n            );\r\n            if (filterStrategy) {\r\n              if (rowsInMapExtent) {\r\n                filterStrategy.activate();\r\n              } else {\r\n                filterStrategy.deactivate();\r\n              }\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe(\r\n      (selectOnly) => {\r\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\r\n          if (!wks.entity.actionStore.empty) {\r\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\r\n              EntityStoreFilterSelectionStrategy\r\n            );\r\n            if (filterStrategy) {\r\n              if (selectOnly) {\r\n                filterStrategy.activate();\r\n              } else {\r\n                filterStrategy.deactivate();\r\n              }\r\n            }\r\n          }\r\n        });\r\n      }\r\n    );\r\n  }\r\n\r\n  private setWorkspaceIsMaximized(maximized: boolean) {\r\n    this.storageService.set('workspaceMaximize', maximized);\r\n    this.workspaceMaximize$.next(maximized);\r\n  }\r\n\r\n  public setActiveWorkspaceById(id: string) {\r\n    const wksFromId = this.store.all().find((workspace) => workspace.id === id);\r\n    if (wksFromId) {\r\n      this.store.activateWorkspace(wksFromId);\r\n    }\r\n  }\r\n\r\n  public setActiveWorkspaceByTitle(title: string) {\r\n    const wksFromTitle = this.store\r\n      .all()\r\n      .find((workspace) => workspace.title === title);\r\n    if (wksFromTitle) {\r\n      this.store.activateWorkspace(wksFromTitle);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Teardown all the workspaces\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.teardownWorkspaces();\r\n    this.actionMaximize$$.map((a) => a.unsubscribe());\r\n    if (this.rowsInMapExtentCheckCondition$$) {\r\n      this.selectOnlyCheckCondition$$.unsubscribe();\r\n    }\r\n    if (this.selectOnlyCheckCondition$$) {\r\n      this.selectOnlyCheckCondition$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Teardown the workspace store and any subscribers\r\n   */\r\n  private teardownWorkspaces() {\r\n    this.store.clear();\r\n    if (this.activeWorkspaceWidget$$ !== undefined) {\r\n      this.activeWorkspaceWidget$$.unsubscribe();\r\n    }\r\n    if (this.activeWorkspace$$ !== undefined) {\r\n      this.activeWorkspace$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { StorageService, ConfigService } from '@igo2/core';\r\n\r\nimport { IgoMap, MapService, ProjectionService } from '@igo2/geo';\r\n// import { BehaviorSubject } from 'rxjs';\r\n\r\n/**\r\n * Service that holds the state of the map module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapState {\r\n  // public mapCenter$ = new BehaviorSubject<boolean>(false);\r\n  get showAllLegendsValue(): boolean {\r\n    return this._legendToolShowAll;\r\n  }\r\n\r\n  set showAllLegendsValue(value) {\r\n    this._legendToolShowAll = value;\r\n  }\r\n  private _legendToolShowAll: boolean;\r\n\r\n  /**\r\n   * Active map\r\n   */\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  constructor(\r\n    private mapService: MapService,\r\n    private projectionService: ProjectionService, // Don't remove this or it'll never be injected,\r\n    private storageService: StorageService,\r\n    private configService: ConfigService\r\n  ) {\r\n    this._map = new IgoMap(\r\n      {\r\n        controls: {\r\n          scaleLine: true,\r\n          attribution: {\r\n            collapsed: true\r\n          }\r\n        }\r\n      },\r\n      this.storageService,\r\n      this.configService\r\n    );\r\n\r\n    this.mapService.setMap(this.map);\r\n  }\r\n}\r\n","<div\r\n  *ngIf=\"userControlledLayerList.length; else noLayersBlock\"\r\n  class=\"igo-swipe-select-container\"\r\n>\r\n  <form class=\"igo-form\" [formGroup]=\"form\">\r\n    <mat-form-field>\r\n      <mat-label>{{\r\n        'igo.integration.advanced-map-tool.advanced-swipe.swipe-select'\r\n          | translate\r\n      }}</mat-label>\r\n      <mat-select formControlName=\"layers\" multiple>\r\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\r\n          {{\r\n            'igo.integration.advanced-map-tool.advanced-swipe.selectAll'\r\n              | translate\r\n          }}\r\n        </mat-option>\r\n        <mat-divider></mat-divider>\r\n        <mat-option\r\n          *ngFor=\"let layer of userControlledLayerList\"\r\n          [value]=\"layer\"\r\n          (click)=\"applyNewLayers(e)\"\r\n          >{{ layer.title }}</mat-option\r\n        >\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </form>\r\n\r\n  <mat-slide-toggle\r\n    class=\"swipe-toggle mat-typography\"\r\n    [checked]=\"swipe\"\r\n    [labelPosition]=\"'before'\"\r\n    (change)=\"startSwipe($event.checked)\"\r\n  >\r\n    {{ 'igo.integration.advanced-map-tool.advanced-swipe.swipe' | translate }}\r\n  </mat-slide-toggle>\r\n</div>\r\n\r\n<ng-template #noLayersBlock>\r\n  <mat-list>\r\n    <p class=\"map-empty mat-typography\">\r\n      {{ 'igo.integration.advanced-map-tool.advanced-swipe.empty' | translate }}\r\n    </p>\r\n    <p class=\"map-empty mat-typography\">\r\n      {{\r\n        'igo.integration.advanced-map-tool.advanced-swipe.customize' | translate\r\n      }}\r\n    </p>\r\n    <mat-list-item>\r\n      <mat-icon matListItemIcon svgIcon=\"magnify\"></mat-icon>\r\n      <span\r\n        matListItemTitle\r\n        class=\"search-tool mat-typography\"\r\n        (click)=\"searchEmit()\"\r\n      >\r\n        {{\r\n          'igo.integration.advanced-map-tool.advanced-swipe.search-tool'\r\n            | translate\r\n        }}\r\n      </span>\r\n    </mat-list-item>\r\n    <mat-list-item>\r\n      <mat-icon matListItemIcon svgIcon=\"layers-plus\"></mat-icon>\r\n      <span\r\n        matListItemTitle\r\n        class=\"catalog-tool mat-typography\"\r\n        (click)=\"catalogEmit()\"\r\n      >\r\n        {{\r\n          'igo.integration.advanced-map-tool.advanced-swipe.catalog-tool'\r\n            | translate\r\n        }}\r\n      </span>\r\n    </mat-list-item>\r\n    <mat-list-item>\r\n      <mat-icon matListItemIcon svgIcon=\"star\"></mat-icon>\r\n      <span\r\n        matListItemTitle\r\n        class=\"context-tool mat-typography\"\r\n        (click)=\"contextEmit()\"\r\n      >\r\n        {{\r\n          'igo.integration.advanced-map-tool.advanced-swipe.context-tool'\r\n            | translate\r\n        }}\r\n      </span>\r\n    </mat-list-item>\r\n  </mat-list>\r\n</ng-template>\r\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport {\r\n  UntypedFormGroup,\r\n  UntypedFormBuilder,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { ContextService, DetailedContext } from '@igo2/context';\r\nimport { IgoMap, Layer, VectorLayer } from '@igo2/geo';\r\nimport { MapState } from '../../map.state';\r\nimport { ToolState } from '../../../tool/tool.state';\r\n\r\n@Component({\r\n  selector: 'igo-advanced-swipe',\r\n  templateUrl: './advanced-swipe.component.html',\r\n  styleUrls: ['./advanced-swipe.component.scss']\r\n})\r\nexport class AdvancedSwipeComponent implements OnInit, OnDestroy {\r\n  public swipe: boolean = false;\r\n  public layerList: Layer[];\r\n  public userControlledLayerList: Layer[];\r\n  public form: UntypedFormGroup;\r\n  public layers: VectorLayer[];\r\n  public res: DetailedContext;\r\n  public listForSwipe: Layer[];\r\n\r\n  /**\r\n   * Get an active map state\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    public mapState: MapState,\r\n    private contextService: ContextService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private toolState: ToolState\r\n  ) {\r\n    this.buildForm();\r\n  }\r\n\r\n  /**\r\n   * Get the list of layers for swipe\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.map.layers$.subscribe(\r\n      (ll) =>\r\n        (this.userControlledLayerList = ll.filter(\r\n          (layer) =>\r\n            !layer.baseLayer && layer.showInLayerList && layer.displayed\r\n        ))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Desactivate the swipe\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.swipe = false;\r\n    this.map.swipeEnabled$.next(this.swipe);\r\n  }\r\n\r\n  /**\r\n   * Build a form for choise of the layers\r\n   */\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      layers: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate the swipe, send a list of layers for a swipe-tool\r\n   */\r\n  startSwipe(toggle: boolean) {\r\n    this.swipe = toggle;\r\n    this.map.swipeEnabled$.next(toggle);\r\n    this.listForSwipe = [];\r\n    for (const layer of this.form.value.layers) {\r\n      this.listForSwipe.push(layer);\r\n    }\r\n    this.map.selectedFeatures$.next(this.listForSwipe);\r\n  }\r\n\r\n  /**\r\n   * Restart a swipe for a new layers-list\r\n   */\r\n  applyNewLayers(e) {\r\n    this.startSwipe(false); // l'approche KISS\r\n    this.startSwipe(true);\r\n    if (e._selected) {\r\n      e._selected = false;\r\n    }\r\n    const allLayers = this.userControlledLayerList.length;\r\n    const selectedLayers = this.form.controls.layers.value.length;\r\n    if (selectedLayers === allLayers) {\r\n      e._selected = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Select all list of layers and restart a tool\r\n   */\r\n  selectAll(e) {\r\n    if (e._selected) {\r\n      this.form.controls.layers.setValue(this.userControlledLayerList);\r\n      e._selected = true;\r\n    } else {\r\n      this.form.controls.layers.setValue([]);\r\n    }\r\n    this.startSwipe(false);\r\n    this.startSwipe(true);\r\n  }\r\n\r\n  /**\r\n   * Open search tool\r\n   */\r\n  searchEmit() {\r\n    this.toolState.toolbox.activateTool('searchResults');\r\n  }\r\n\r\n  /**\r\n   * Open catalog\r\n   */\r\n  catalogEmit() {\r\n    this.toolState.toolbox.activateTool('catalog');\r\n  }\r\n\r\n  /**\r\n   * Open context manager\r\n   */\r\n  contextEmit() {\r\n    this.toolState.toolbox.activateTool('contextManager');\r\n  }\r\n}\r\n","<div class=\"advanced-coordinates__coordinates-container\">\r\n  <div class=\"advanced-coordinates__coordinates-container__inner\">\r\n    <mat-form-field *ngIf=\"units; else elseBlock\" class=\"coordinates\">\r\n      <mat-label>{{\r\n        'igo.integration.advanced-map-tool.advanced-coordinates.lon' | translate\r\n      }}</mat-label>\r\n      <textarea\r\n        #textArea\r\n        matInput\r\n        readonly\r\n        rows=\"1\"\r\n        [placeholder]=\"\r\n          'igo.integration.advanced-map-tool.advanced-coordinates.lon'\r\n            | translate\r\n        \"\r\n        [value]=\"coordinates[0]\"\r\n      ></textarea>\r\n    </mat-form-field>\r\n    <ng-template #elseBlock>\r\n      <mat-form-field class=\"coordinates\">\r\n        <textarea\r\n          #textArea\r\n          matInput\r\n          readonly\r\n          rows=\"1\"\r\n          [placeholder]=\"\r\n            'igo.integration.advanced-map-tool.advanced-coordinates.est'\r\n              | translate\r\n          \"\r\n          [value]=\"coordinates[0]\"\r\n        ></textarea>\r\n      </mat-form-field>\r\n    </ng-template>\r\n\r\n    <mat-form-field *ngIf=\"units; else elseBlock2\" class=\"coordinates2\">\r\n      <mat-label>{{\r\n        'igo.integration.advanced-map-tool.advanced-coordinates.lat' | translate\r\n      }}</mat-label>\r\n      <textarea\r\n        #textArea\r\n        matInput\r\n        readonly\r\n        rows=\"1\"\r\n        [placeholder]=\"\r\n          'igo.integration.advanced-map-tool.advanced-coordinates.lat'\r\n            | translate\r\n        \"\r\n        [value]=\"coordinates[1]\"\r\n      ></textarea>\r\n    </mat-form-field>\r\n    <ng-template #elseBlock2>\r\n      <mat-form-field class=\"coordinates2\">\r\n        <textarea\r\n          #textArea\r\n          matInput\r\n          readonly\r\n          rows=\"1\"\r\n          [placeholder]=\"\r\n            'igo.integration.advanced-map-tool.advanced-coordinates.nord'\r\n              | translate\r\n          \"\r\n          [value]=\"coordinates[1]\"\r\n        ></textarea>\r\n      </mat-form-field>\r\n    </ng-template>\r\n  </div>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [attr.aria-label]=\"\r\n      'igo.integration.advanced-map-tool.advanced-coordinates.copy' | translate\r\n    \"\r\n    class=\"igo-form-button-group advanced-coordinates__copy-coordinates\"\r\n    (click)=\"copyTextToClipboard()\"\r\n  >\r\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n  </button>\r\n</div>\r\n<form class=\"igo-form advanced-coordinates__form\" [formGroup]=\"form\">\r\n  <mat-form-field class=\"igo-input-container\">\r\n    <mat-label>{{\r\n      'igo.integration.advanced-map-tool.advanced-coordinates.coordSystem'\r\n        | translate\r\n    }}</mat-label>\r\n    <mat-select [(value)]=\"inputProj\">\r\n      <mat-option\r\n        matTooltipShowDelay=\"500\"\r\n        *ngFor=\"let projection of projections$ | async\"\r\n        [value]=\"projection\"\r\n        (click)=\"$event.stopPropagation()\"\r\n      >\r\n        {{ projection.translatedValue || projection.alias }}\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n  <mat-slide-toggle\r\n    class=\"center-toggle mat-typography\"\r\n    [checked]=\"center\"\r\n    [labelPosition]=\"'before'\"\r\n    (change)=\"displayCenter($event.checked)\"\r\n  >\r\n    {{\r\n      'igo.integration.advanced-map-tool.advanced-coordinates.center'\r\n        | translate\r\n    }}\r\n  </mat-slide-toggle>\r\n</form>\r\n\r\n<p class=\"igo-zoom mat-typography\">\r\n  {{\r\n    'igo.integration.advanced-map-tool.advanced-coordinates.zoom' | translate\r\n  }}\r\n  {{ map.viewController.getZoom() }}\r\n</p>\r\n<p class=\"igo-zoom mat-typography\">\r\n  {{\r\n    'igo.integration.advanced-map-tool.advanced-coordinates.scale' | translate\r\n  }}\r\n  {{ formattedScale$ | async }}\r\n</p>\r\n<p class=\"igo-zoom mat-typography\">\r\n  {{\r\n    'igo.integration.advanced-map-tool.advanced-coordinates.resolution'\r\n      | translate\r\n  }}\r\n  {{ map.viewController.getResolution() | number: '1.0-0' }}\r\n</p>\r\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  OnDestroy,\r\n  OnInit,\r\n  Input\r\n} from '@angular/core';\r\nimport {\r\n  formatScale,\r\n  IgoMap,\r\n  InputProjections,\r\n  ProjectionsLimitationsOptions\r\n} from '@igo2/geo';\r\nimport { MapState } from '../../map.state';\r\nimport { Clipboard } from '@igo2/utils';\r\nimport {\r\n  MessageService,\r\n  LanguageService,\r\n  StorageService,\r\n  StorageScope,\r\n  ConfigService\r\n} from '@igo2/core';\r\nimport { BehaviorSubject, combineLatest, Subscription } from 'rxjs';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { zoneMtm, zoneUtm, computeProjectionsConstraints } from '@igo2/geo';\r\nimport * as olproj from 'ol/proj';\r\n/**\r\n * Tool to display the coordinates and a cursor of the center of the map\r\n */\r\n@Component({\r\n  selector: 'igo-advanced-coordinates',\r\n  templateUrl: './advanced-coordinates.component.html',\r\n  styleUrls: ['./advanced-coordinates.component.scss']\r\n})\r\nexport class AdvancedCoordinatesComponent implements OnInit, OnDestroy {\r\n  public formattedScale$: BehaviorSubject<string> = new BehaviorSubject('');\r\n  public projections$: BehaviorSubject<InputProjections[]> =\r\n    new BehaviorSubject([]);\r\n  public form: UntypedFormGroup;\r\n  public coordinates: string[];\r\n  private currentCenterDefaultProj: [number, number];\r\n  public center: boolean;\r\n  private inMtmZone: boolean = true;\r\n  private inLambert2 = { 32198: true, 3798: true };\r\n  private mapState$$: Subscription;\r\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\r\n  private projectionsConstraints: ProjectionsLimitationsOptions;\r\n  private defaultProj: InputProjections;\r\n  private currentZones = { utm: undefined, mtm: undefined };\r\n  public units: boolean = true;\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get inputProj(): InputProjections {\r\n    return this.form.get('inputProj').value;\r\n  }\r\n  set inputProj(value: InputProjections) {\r\n    this.form.patchValue({ inputProj: value });\r\n  }\r\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\r\n    return this._projectionsLimitations || {};\r\n  }\r\n\r\n  @Input()\r\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\r\n    this._projectionsLimitations = value;\r\n  }\r\n\r\n  constructor(\r\n    public mapState: MapState,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private cdRef: ChangeDetectorRef,\r\n    private storageService: StorageService,\r\n    private config: ConfigService,\r\n    private formBuilder: UntypedFormBuilder\r\n  ) {\r\n    this.defaultProj = {\r\n      translatedValue: this.languageService.translate.instant(\r\n        'igo.geo.importExportForm.projections.wgs84',\r\n        { code: 'EPSG:4326' }\r\n      ),\r\n      translateKey: 'wgs84',\r\n      alias: 'WGS84',\r\n      code: 'EPSG:4326',\r\n      zone: ''\r\n    };\r\n    this.center = this.storageService.get('centerToggle') as boolean;\r\n    this.computeProjections();\r\n    this.buildForm();\r\n  }\r\n\r\n  /**\r\n   * Listen a state of the map, a state of a form, update the coordinates\r\n   */\r\n  ngOnInit(): void {\r\n    this.mapState$$ = combineLatest([\r\n      this.map.viewController.state$.pipe(debounceTime(50)),\r\n      this.form.valueChanges\r\n    ]).subscribe(() => {\r\n      this.setScaleValue(this.map);\r\n      this.currentCenterDefaultProj = this.map.viewController.getCenter(\r\n        this.defaultProj.code\r\n      );\r\n      const currentMtmZone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n      const currentUtmZone = zoneUtm(this.currentCenterDefaultProj[0]);\r\n      if (!this.inMtmZone && currentMtmZone !== this.currentZones.mtm) {\r\n        this.back2quebec();\r\n      }\r\n      let zoneChange = false;\r\n      if (currentMtmZone !== this.currentZones.mtm) {\r\n        this.currentZones.mtm = currentMtmZone;\r\n        zoneChange = true;\r\n      }\r\n      if (currentUtmZone !== this.currentZones.utm) {\r\n        this.currentZones.utm = currentUtmZone;\r\n        zoneChange = true;\r\n      }\r\n      if (zoneChange) {\r\n        this.updateProjectionsZoneChange();\r\n      }\r\n      this.checkLambert(this.currentCenterDefaultProj);\r\n      this.coordinates = this.getCoordinates();\r\n      this.cdRef.detectChanges();\r\n      this.storageService.set(\r\n        'currentProjection',\r\n        this.inputProj,\r\n        StorageScope.SESSION\r\n      );\r\n    });\r\n\r\n    const tempInputProj = this.storageService.get(\r\n      'currentProjection'\r\n    ) as InputProjections;\r\n    this.inputProj = this.projections$.value[0];\r\n    if (tempInputProj !== null) {\r\n      const pos = this.positionInList(tempInputProj);\r\n      this.inputProj = this.projections$.value[pos];\r\n      this.updateZoneMtmUtm();\r\n    }\r\n    this.map.mapCenter$.next(this.center);\r\n    this.coordinates = this.getCoordinates();\r\n    this.currentCenterDefaultProj = this.map.viewController.getCenter(\r\n      this.defaultProj.code\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.map.mapCenter$.next(false);\r\n    this.mapState$$.unsubscribe();\r\n  }\r\n\r\n  setScaleValue(map: IgoMap) {\r\n    this.formattedScale$.next(\r\n      ': ~ 1 / ' + formatScale(map.viewController.getScale())\r\n    );\r\n  }\r\n  /**\r\n   * Coordinates of the center of the map on the appropriate systeme of coordinates\r\n   * @returns Array of two numbers\r\n   */\r\n  getCoordinates(): string[] {\r\n    this.currentZones.mtm = zoneMtm(this.currentCenterDefaultProj[0]);\r\n    this.currentZones.utm = zoneUtm(this.currentCenterDefaultProj[0]);\r\n    let coord;\r\n    const code = this.inputProj.code;\r\n    let decimal = 2;\r\n    if (code.includes('EPSG:4326') || code.includes('EPSG:4269')) {\r\n      decimal = 5;\r\n    }\r\n    this.units = code === 'EPSG:4326' || code === 'EPSG:4269';\r\n    coord = this.map.viewController\r\n      .getCenter(code)\r\n      .map((c) => c.toFixed(decimal));\r\n    return coord;\r\n  }\r\n\r\n  /**\r\n   * Copy the coordinates to a clipboard\r\n   */\r\n  copyTextToClipboard(): void {\r\n    const successful = Clipboard.copy(this.coordinates.toString());\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyMsg',\r\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Display a cursor on the center of the map\r\n   */\r\n  displayCenter(toggle: boolean): void {\r\n    this.center = toggle;\r\n    this.map.mapCenter$.next(toggle);\r\n    this.storageService.set('centerToggle', toggle, StorageScope.SESSION);\r\n  }\r\n\r\n  /**\r\n   * Builder of the form\r\n   */\r\n  private buildForm(): void {\r\n    this.form = this.formBuilder.group({\r\n      inputProj: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update list of projections after changing of the state of the map\r\n   */\r\n  private updateProjectionsZoneChange(): void {\r\n    let modifiedProj = this.projections$.value;\r\n    const translate = this.languageService.translate;\r\n    modifiedProj.map((p) => {\r\n      if (p.translateKey === 'mtm') {\r\n        const zone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n        if (zone) {\r\n          const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\r\n          p.alias = `MTM ${zone}`;\r\n          p.code = code;\r\n          p.zone = `${zone}`;\r\n          p.translatedValue = translate.instant(\r\n            'igo.geo.importExportForm.projections.mtm',\r\n            p\r\n          );\r\n        } else {\r\n          p.alias = '';\r\n          this.inMtmZone = false;\r\n          if (this.inputProj.translateKey === 'mtm') {\r\n            this.inputProj = this.projections$.value[0];\r\n          }\r\n        }\r\n      }\r\n      if (p.translateKey === 'utm') {\r\n        const zone = zoneUtm(this.currentCenterDefaultProj[0]);\r\n        const code = `EPSG:326${zone}`;\r\n        p.alias = `UTM ${zone}`;\r\n        p.code = code;\r\n        p.zone = `${zone}`;\r\n        p.translatedValue = translate.instant(\r\n          'igo.geo.importExportForm.projections.utm',\r\n          p\r\n        );\r\n      }\r\n    });\r\n    modifiedProj = modifiedProj.filter((p) => p.alias !== '');\r\n    this.projections$.next(modifiedProj);\r\n  }\r\n\r\n  /**\r\n   * Create a list of currents projections\r\n   */\r\n  private computeProjections(): void {\r\n    this.projectionsConstraints = computeProjectionsConstraints(\r\n      this.projectionsLimitations\r\n    );\r\n    const projections: InputProjections[] = [];\r\n\r\n    if (!this.currentCenterDefaultProj) {\r\n      this.currentCenterDefaultProj = this.map.viewController.getCenter(\r\n        this.defaultProj.code\r\n      );\r\n    }\r\n\r\n    const translate = this.languageService.translate;\r\n    if (this.projectionsConstraints.wgs84) {\r\n      projections.push({\r\n        translatedValue: translate.instant(\r\n          'igo.geo.importExportForm.projections.wgs84',\r\n          { code: 'EPSG:4326' }\r\n        ),\r\n        translateKey: 'wgs84',\r\n        alias: 'WGS84',\r\n        code: 'EPSG:4326',\r\n        zone: ''\r\n      });\r\n    }\r\n\r\n    if (this.projectionsConstraints.nad83) {\r\n      projections.push({\r\n        translatedValue: translate.instant(\r\n          'igo.geo.importExportForm.projections.nad83',\r\n          { code: 'EPSG:4269' }\r\n        ),\r\n        translateKey: 'nad83',\r\n        alias: 'NAD83',\r\n        code: 'EPSG:4269',\r\n        zone: ''\r\n      });\r\n    }\r\n\r\n    if (this.projectionsConstraints.webMercator) {\r\n      projections.push({\r\n        translatedValue: translate.instant(\r\n          'igo.geo.importExportForm.projections.webMercator',\r\n          { code: 'EPSG:3857' }\r\n        ),\r\n        translateKey: 'webMercator',\r\n        alias: 'Web Mercator',\r\n        code: 'EPSG:3857',\r\n        zone: ''\r\n      });\r\n    }\r\n    if (this.projectionsConstraints.mtm) {\r\n      // Quebec\r\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n      if (zone) {\r\n        this.inMtmZone = true;\r\n        const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\r\n        projections.splice(3, 0, {\r\n          translatedValue: this.languageService.translate.instant(\r\n            'igo.geo.importExportForm.projections.mtm',\r\n            { code, zone }\r\n          ),\r\n          translateKey: 'mtm',\r\n          alias: `MTM ${zone}`,\r\n          code,\r\n          zone: `${zone}`\r\n        });\r\n      } else {\r\n        this.inMtmZone = false;\r\n      }\r\n    }\r\n    if (this.projectionsConstraints.utm) {\r\n      const order = this.inMtmZone ? 4 : 3;\r\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\r\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\r\n      projections.splice(order, 0, {\r\n        translatedValue: this.languageService.translate.instant(\r\n          'igo.geo.importExportForm.projections.utm',\r\n          { code, zone }\r\n        ),\r\n        translateKey: 'utm',\r\n        alias: `UTM ${zone}`,\r\n        code,\r\n        zone: `${zone}`\r\n      });\r\n    }\r\n    let configProjection = [];\r\n    if (this.projectionsConstraints.projFromConfig) {\r\n      configProjection = this.config.getConfig('projections') || [];\r\n    }\r\n    this.projections$.next(projections.concat(configProjection));\r\n  }\r\n\r\n  /**\r\n   * Push the MTM in the array of systeme of coordinates\r\n   * @param projections Array of the InputProjections\r\n   */\r\n  private pushMtm(projections: Array<InputProjections>): void {\r\n    if (this.projectionsConstraints.mtm) {\r\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\r\n      projections.splice(3, 0, {\r\n        translatedValue: this.languageService.translate.instant(\r\n          'igo.geo.importExportForm.projections.mtm',\r\n          { code, zone }\r\n        ),\r\n        translateKey: 'mtm',\r\n        alias: `MTM ${zone}`,\r\n        code,\r\n        zone: `${zone}`\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the list of systems of coordinates for territory of Quebec\r\n   * push MTM and UTM in the Array\r\n   */\r\n  private back2quebec(): void {\r\n    const projections = this.projections$.value;\r\n    this.pushMtm(projections);\r\n    this.inMtmZone = true;\r\n  }\r\n\r\n  /**\r\n   * Update the numbers of the zones when application is restarted\r\n   */\r\n  private updateZoneMtmUtm() {\r\n    if (this.inputProj.translateKey === 'mtm') {\r\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n      this.inputProj.alias = `MTM ${zone}`;\r\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\r\n      this.inputProj.code = code;\r\n      this.inputProj.zone = `${zone}`;\r\n      this.inputProj.translatedValue = this.languageService.translate.instant(\r\n        'igo.geo.importExportForm.projections.mtm',\r\n        { code, zone }\r\n      );\r\n    }\r\n    if (this.inputProj.translateKey === 'utm') {\r\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\r\n      this.inputProj.alias = `UTM ${zone}`;\r\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\r\n      this.inputProj.code = code;\r\n      this.inputProj.zone = `${zone}`;\r\n      this.inputProj.translatedValue = this.languageService.translate.instant(\r\n        'igo.geo.importExportForm.projections.utm',\r\n        { code, zone }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compute the position of a current projection in a list. 0 if the projection is not in the list\r\n   * @param translateKey string, translate key of a projection\r\n   * @returns numeric, position of an element in the array\r\n   */\r\n  positionInList(tempInputProj: InputProjections): number {\r\n    const tk = tempInputProj.translateKey;\r\n    const alias = tempInputProj.alias;\r\n    let position; // = undefined;\r\n    let iter = 0;\r\n    this.projections$.value.map((projection) => {\r\n      if (tk) {\r\n        if (tk === projection.translateKey) {\r\n          position = iter;\r\n        }\r\n      } else if (alias === projection.alias) {\r\n        position = iter;\r\n      }\r\n      iter++;\r\n    });\r\n    position = position ? position : 0;\r\n    return position;\r\n  }\r\n\r\n  /**\r\n   * Change the list of projections depending on the projections of Lambert\r\n   * @param coordinates An array of numbers, longitude and latitude\r\n   */\r\n  checkLambert(coordinates: [number, number]) {\r\n    const lambertProjections = this.config.getConfig('projections');\r\n    lambertProjections.forEach((projection) => {\r\n      let modifiedProj = this.projections$.value;\r\n      const extent = projection.extent;\r\n      const code = projection.code.match(/\\d+/);\r\n      const currentExtentWGS = olproj.transformExtent(\r\n        extent,\r\n        projection.code,\r\n        this.defaultProj.code\r\n      );\r\n      if (\r\n        coordinates[0] < currentExtentWGS[0] ||\r\n        coordinates[0] > currentExtentWGS[2] ||\r\n        coordinates[1] < currentExtentWGS[1] ||\r\n        coordinates[1] > currentExtentWGS[3]\r\n      ) {\r\n        this.inLambert2[code] = false;\r\n        if (this.inputProj.alias === projection.alias) {\r\n          this.inputProj = this.projections$.value[0];\r\n        }\r\n        modifiedProj = modifiedProj.filter((p) => p.alias !== projection.alias);\r\n        this.projections$.next(modifiedProj);\r\n      } else {\r\n        if (!this.inLambert2[code]) {\r\n          this.projections$.next(modifiedProj.concat(projection));\r\n          this.inLambert2[code] = true;\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { MapState } from '../map.state';\r\n\r\n@ToolComponent({\r\n  name: 'advancedMap',\r\n  title: 'igo.integration.tools.advancedMap',\r\n  icon: 'toolbox'\r\n})\r\n/**\r\n * Tool to handle the advanced map tools\r\n */\r\n@Component({\r\n  selector: 'igo-advanced-map-tool',\r\n  templateUrl: './advanced-map-tool.component.html',\r\n  styleUrls: ['./advanced-map-tool.component.scss']\r\n})\r\nexport class AdvancedMapToolComponent {\r\n  get tracking$() {\r\n    return this.mapState.map.geolocationController.tracking$;\r\n  }\r\n  get followPosition$() {\r\n    return this.mapState.map.geolocationController.followPosition$;\r\n  }\r\n\r\n  constructor(public mapState: MapState) {}\r\n\r\n  toggleTracking(value) {\r\n    this.mapState.map.geolocationController.tracking = value;\r\n  }\r\n\r\n  toggleFollow(value) {\r\n    this.mapState.map.geolocationController.followPosition = value;\r\n  }\r\n}\r\n","<h4 class=\"nameOfTool\">\r\n  {{\r\n    'igo.integration.advanced-map-tool.advanced-swipe.swipe-tool' | translate\r\n  }}\r\n</h4>\r\n<igo-advanced-swipe></igo-advanced-swipe>\r\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\r\n<h4 class=\"nameOfTool\">\r\n  {{\r\n    'igo.integration.advanced-map-tool.advanced-coordinates.coordinates'\r\n      | translate\r\n  }}\r\n</h4>\r\n<igo-advanced-coordinates></igo-advanced-coordinates>\r\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\r\n\r\n<h4 class=\"nameOfTool\">\r\n  {{ 'igo.integration.advanced-map-tool.geolocation.title' | translate }}\r\n</h4>\r\n\r\n<div class=\"igo-input-container\">\r\n  <div class=\"geolocation-slide-toggle-container mat-typography\">\r\n    <mat-slide-toggle\r\n      class=\"geolocation-option mat-typography\"\r\n      [checked]=\"tracking$ | async\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"toggleTracking($event.checked)\"\r\n    >\r\n      {{ 'igo.integration.advanced-map-tool.geolocation.tracking' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      class=\"geolocation-option mat-typography\"\r\n      [disabled]=\"(tracking$ | async) !== true\"\r\n      [labelPosition]=\"'before'\"\r\n      [checked]=\"followPosition$ | async\"\r\n      (change)=\"toggleFollow($event.checked)\"\r\n    >\r\n      {{ 'igo.integration.advanced-map-tool.geolocation.follow' | translate }}\r\n    </mat-slide-toggle>\r\n  </div>\r\n</div>\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  FeatureStore,\r\n  Feature,\r\n  IgoMap,\r\n  featureFromOl,\r\n  measureOlGeometryLength,\r\n  Layer,\r\n  QueryableDataSourceOptions,\r\n  FEATURE,\r\n  roundCoordTo,\r\n  QueryableDataSource,\r\n  MapGeolocationState\r\n} from '@igo2/geo';\r\nimport { BehaviorSubject, combineLatest, interval, Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { MapState } from '../map/map.state';\r\n\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport olLayerVector from 'ol/layer/Vector';\r\nimport olVectorSource from 'ol/source/Vector';\r\nimport Geometry from 'ol/geom/Geometry';\r\nimport olLineString from 'ol/geom/LineString';\r\nimport * as olProj from 'ol/proj';\r\nimport { StorageService } from '@igo2/core';\r\n/**\r\n * Service that holds the state of the direction module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapProximityState {\r\n  private defaultProximityRadiusValue: number = 30;\r\n\r\n  public enabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\r\n    false\r\n  );\r\n  public proximityRadiusValue$: BehaviorSubject<number>;\r\n  public proximitylocationType$: BehaviorSubject<string> =\r\n    new BehaviorSubject<string>('geolocation');\r\n  public proximityFeatureStore: FeatureStore<Feature>;\r\n  private subs$$: Subscription[] = [];\r\n  public currentPositionCoordinate$: BehaviorSubject<[number, number]> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.proximityFeatureStore = new FeatureStore<Feature>([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.proximityRadiusValue$ = new BehaviorSubject<number>(\r\n      (this.storageService.get('mapProximityRadius') as number) ||\r\n        this.defaultProximityRadiusValue\r\n    );\r\n\r\n    this.mapState.map.ol.once('rendercomplete', () => {\r\n      this.subscribeProximityMonitor();\r\n    });\r\n  }\r\n\r\n  subscribeProximityMonitor() {\r\n    this.subs$$.push(\r\n      combineLatest([\r\n        this.enabled$,\r\n        this.proximitylocationType$,\r\n        this.proximityRadiusValue$,\r\n        interval(5000),\r\n        this.map.geolocationController.position$\r\n      ])\r\n        .pipe(debounceTime(750))\r\n        .subscribe(\r\n          (bunch: [boolean, string, number, number, MapGeolocationState]) => {\r\n            this.proximityFeatureStore.clear();\r\n            const enabled = bunch[0];\r\n            const layers = this.map.layers;\r\n            const currentPos = this.map.geolocationController.position$.value;\r\n            const locationType = bunch[1];\r\n            const proximityRadiusValue = bunch[2];\r\n            this.storageService.set(\r\n              'mapProximityRadius',\r\n              proximityRadiusValue || this.defaultProximityRadiusValue\r\n            );\r\n\r\n            if (!enabled) {\r\n              return;\r\n            }\r\n\r\n            let coord: number[];\r\n            if (locationType === 'geolocation') {\r\n              if (!currentPos || !currentPos.position) {\r\n                return;\r\n              }\r\n\r\n              coord = olProj.transform(\r\n                currentPos.position,\r\n                currentPos.projection,\r\n                this.map.projection\r\n              );\r\n              this.map.mapCenter$.next(false);\r\n            } else {\r\n              coord = this.map.viewController.getCenter();\r\n              this.map.mapCenter$.next(true);\r\n            }\r\n\r\n            const coordLonLat = olProj.transform(\r\n              coord,\r\n              this.map.projection,\r\n              'EPSG:4269'\r\n            );\r\n            const roundedCoordLonLat = roundCoordTo(\r\n              coordLonLat as [number, number],\r\n              6\r\n            );\r\n            this.currentPositionCoordinate$.next(roundedCoordLonLat);\r\n\r\n            const layersToMonitor = layers.filter(\r\n              (layer) =>\r\n                layer.ol instanceof olLayerVector &&\r\n                (layer.dataSource as QueryableDataSource).options.queryable &&\r\n                layer.visible &&\r\n                layer.isInResolutionsRange\r\n            );\r\n\r\n            layersToMonitor.map((layerToMonitor) => {\r\n              const layerSource =\r\n                layerToMonitor.ol.getSource() as olVectorSource<Geometry>;\r\n\r\n              // Mostly for polygon features.\r\n              const olFeaturesAtCoordinate =\r\n                layerSource.getFeaturesAtCoordinate(coord);\r\n              if (olFeaturesAtCoordinate && olFeaturesAtCoordinate.length) {\r\n                olFeaturesAtCoordinate.map((olFeatureAtCoordinate) => {\r\n                  const featureAtThisPosition = featureFromOl(\r\n                    olFeatureAtCoordinate,\r\n                    this.map.projection\r\n                  );\r\n                  let title = this.getQueryTitle(\r\n                    featureAtThisPosition,\r\n                    layerToMonitor\r\n                  );\r\n                  // todo handle imported layers without querytitle? prompt title or detect first column?\r\n                  this.addFeatureToStore(\r\n                    layerToMonitor,\r\n                    coord,\r\n                    featureAtThisPosition,\r\n                    title,\r\n                    0\r\n                  );\r\n                });\r\n              } else {\r\n                // compute proximity for remaining sources\r\n                const closestOlFeature =\r\n                  layerSource.getClosestFeatureToCoordinate(coord);\r\n                if (closestOlFeature) {\r\n                  const closestOlGeom = closestOlFeature.getGeometry();\r\n                  const closestFeature = featureFromOl(\r\n                    closestOlFeature,\r\n                    this.map.projection\r\n                  );\r\n                  const geometryClosestPoint =\r\n                    closestOlGeom.getClosestPoint(coord);\r\n                  const linebetween = new olLineString([\r\n                    coord,\r\n                    geometryClosestPoint\r\n                  ]);\r\n                  const lineLength = measureOlGeometryLength(\r\n                    linebetween,\r\n                    'EPSG:3857'\r\n                  );\r\n                  if (lineLength <= proximityRadiusValue) {\r\n                    let title = this.getQueryTitle(\r\n                      closestFeature,\r\n                      layerToMonitor\r\n                    );\r\n                    // todo handle imported layers without querytitle? prompt title or detect first column?\r\n                    this.addFeatureToStore(\r\n                      layerToMonitor,\r\n                      coord,\r\n                      closestFeature,\r\n                      title,\r\n                      lineLength\r\n                    );\r\n                  }\r\n                }\r\n              }\r\n            });\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Add a feature with proximity properties to the store\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(\r\n    layer: Layer,\r\n    coordFromCalculatedDistance,\r\n    feature: Feature,\r\n    title,\r\n    distance\r\n  ) {\r\n    const featureId = uuid();\r\n    const projection = this.map.ol.getView().getProjection();\r\n    const olGeometry = feature.ol.getGeometry() as Geometry;\r\n    const geometry = new GeoJSON().writeGeometryObject(olGeometry, {\r\n      featureProjection: projection,\r\n      dataProjection: projection\r\n    }) as any;\r\n    this.proximityFeatureStore.update({\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: projection.getCode(),\r\n      properties: {\r\n        ...feature.properties,\r\n        ...{\r\n          id: featureId,\r\n          element: title,\r\n          distance,\r\n          coordFromCalculatedDistance,\r\n          layerSrcId: layer.id,\r\n          layerSrcTitle: layer.title\r\n        }\r\n      },\r\n      meta: {\r\n        id: featureId\r\n      }\r\n    });\r\n  }\r\n\r\n  getQueryTitle(feature: Feature, layer: Layer): string {\r\n    let title;\r\n    if (layer.options?.source?.options) {\r\n      const dataSourceOptions = layer.options.source\r\n        .options as QueryableDataSourceOptions;\r\n      if (dataSourceOptions.queryTitle) {\r\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\r\n      }\r\n    }\r\n    return title;\r\n  }\r\n\r\n  getLabelMatch(feature: Feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach((v) => {\r\n      label = label.replace(v[0], feature.properties[v[1]]);\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.properties[labelMatch] || labelMatch;\r\n    }\r\n    return label;\r\n  }\r\n}\r\n","<igo-entity-table\r\n  #table\r\n  class=\"table-compact\"\r\n  [store]=\"mapProximityState.proximityFeatureStore\"\r\n  [template]=\"tableTemplate\"\r\n></igo-entity-table>\r\n<br />\r\n<mat-form-field\r\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord\"\r\n  class=\"coordinates\"\r\n>\r\n  <textarea\r\n    #textArea\r\n    matInput\r\n    readonly\r\n    rows=\"1\"\r\n    [placeholder]=\"'igo.integration.map-proximity-tool.lon' | translate\"\r\n    [value]=\"coord[0]\"\r\n  ></textarea>\r\n</mat-form-field>\r\n<mat-form-field\r\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord2\"\r\n  class=\"coordinates2\"\r\n>\r\n  <textarea\r\n    #textArea\r\n    matInput\r\n    readonly\r\n    rows=\"1\"\r\n    [placeholder]=\"'igo.integration.map-proximity-tool.lat' | translate\"\r\n    [value]=\"coord2[1]\"\r\n  ></textarea>\r\n</mat-form-field>\r\n\r\n<button\r\n  *ngIf=\"\r\n    (mapProximityState.currentPositionCoordinate$ | async) &&\r\n    (mapProximityState.currentPositionCoordinate$ | async).length\r\n  \"\r\n  mat-icon-button\r\n  (click)=\"copyTextToClipboard()\"\r\n>\r\n  <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n</button>\r\n<div class=\"title-container\">\r\n  <mat-label class=\"title mat-typography\">{{\r\n    'igo.integration.map-proximity-tool.method' | translate\r\n  }}</mat-label>\r\n</div>\r\n<div class=\"igo-input-container mat-typography\">\r\n  <mat-radio-group (change)=\"onLocationTypeChange($event)\">\r\n    <mat-radio-button\r\n      [checked]=\"\r\n        (mapProximityState.proximitylocationType$ | async) === 'geolocation'\r\n      \"\r\n      value=\"geolocation\"\r\n      >{{\r\n        'igo.integration.map-proximity-tool.geolocation' | translate\r\n      }}</mat-radio-button\r\n    >\r\n    <mat-radio-button\r\n      [checked]=\"\r\n        (mapProximityState.proximitylocationType$ | async) === 'mapCenter'\r\n      \"\r\n      value=\"mapCenter\"\r\n      >{{\r\n        'igo.integration.map-proximity-tool.mapCenter' | translate\r\n      }}</mat-radio-button\r\n    >\r\n  </mat-radio-group>\r\n</div>\r\n\r\n<div class=\"radius-unit\">\r\n  <mat-form-field class=\"radius-field\" floatLabel=\"always\">\r\n    <mat-label>{{\r\n      'igo.integration.map-proximity-tool.radiusM' | translate\r\n    }}</mat-label>\r\n    <input\r\n      type=\"number\"\r\n      pattern=\"[0-9]*\"\r\n      [(ngModel)]=\"maxDistance\"\r\n      matInput\r\n      placeholder=\"{{\r\n        'igo.integration.map-proximity-tool.radiusM' | translate\r\n      }}\"\r\n    />\r\n  </mat-form-field>\r\n</div>\r\n","import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\r\nimport { MatRadioChange } from '@angular/material/radio';\r\nimport {\r\n  EntityTableComponent,\r\n  EntityTableTemplate,\r\n  ToolComponent\r\n} from '@igo2/common';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { Feature, IgoMap } from '@igo2/geo';\r\nimport { NumberUtils, Clipboard } from '@igo2/utils';\r\nimport { Subscription } from 'rxjs';\r\nimport { MapProximityState } from '../map-proximity.state';\r\nimport { MapState } from '../map.state';\r\n@ToolComponent({\r\n  name: 'map-proximity',\r\n  title: 'igo.integration.tools.closestFeature',\r\n  icon: 'radius'\r\n})\r\n/**\r\n * Tool to handle the advanced map tools\r\n */\r\n@Component({\r\n  selector: 'igo-map-proximity-tool',\r\n  templateUrl: './map-proximity-tool.component.html',\r\n  styleUrls: ['./map-proximity-tool.component.scss']\r\n})\r\nexport class MapProximityToolComponent implements OnInit, OnDestroy {\r\n  private subs$$: Subscription[] = [];\r\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\r\n\r\n  get maxDistance() {\r\n    return this.mapProximityState.proximityRadiusValue$.value;\r\n  }\r\n  set maxDistance(value: number) {\r\n    this.mapProximityState.proximityRadiusValue$.next(value);\r\n  }\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n  public userDefinedMapCenter: boolean;\r\n  public userDefinedFollowPosition: boolean;\r\n  /**\r\n   * Table template\r\n   * @internal\r\n   */\r\n  public tableTemplate: EntityTableTemplate;\r\n\r\n  constructor(\r\n    public mapState: MapState,\r\n    public mapProximityState: MapProximityState,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService\r\n  ) {\r\n    this.tableTemplate = {\r\n      selection: true,\r\n      selectMany: false,\r\n      selectionCheckbox: false,\r\n      sort: true,\r\n      columns: [\r\n        {\r\n          name: 'element',\r\n          title: this.languageService.translate.instant(\r\n            'igo.integration.map-proximity-tool.feature'\r\n          ),\r\n          valueAccessor: (localFeature: Feature) => {\r\n            return localFeature.properties.element;\r\n          }\r\n        },\r\n        {\r\n          name: 'distance',\r\n          title: this.languageService.translate.instant(\r\n            'igo.integration.map-proximity-tool.distance'\r\n          ),\r\n          valueAccessor: (localFeature: Feature) => {\r\n            return `${NumberUtils.roundToNDecimal(\r\n              localFeature.properties.distance,\r\n              1\r\n            )}m`;\r\n          }\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.mapProximityState.enabled$.next(true);\r\n    this.userDefinedFollowPosition =\r\n      this.map.geolocationController.followPosition === true;\r\n    this.userDefinedMapCenter = this.map.mapCenter$.value === true;\r\n\r\n    this.subs$$.push(\r\n      this.mapProximityState.proximitylocationType$.subscribe((v) => {\r\n        this.map.mapCenter$.next(v !== 'geolocation');\r\n        if (v === 'geolocation') {\r\n          this.map.geolocationController.followPosition = true;\r\n        } else {\r\n          this.map.geolocationController.followPosition = false;\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.mapProximityState.enabled$.next(false);\r\n    this.map.mapCenter$.next(this.userDefinedMapCenter);\r\n    this.subs$$.map((s) => s.unsubscribe());\r\n    this.map.geolocationController.followPosition =\r\n      this.userDefinedFollowPosition;\r\n  }\r\n\r\n  onLocationTypeChange(e: MatRadioChange) {\r\n    this.mapProximityState.proximitylocationType$.next(e.value);\r\n  }\r\n\r\n  /**\r\n   * Copy the coordinates to a clipboard\r\n   */\r\n  copyTextToClipboard(): void {\r\n    const successful = Clipboard.copy(\r\n      this.mapProximityState.currentPositionCoordinate$?.value.toString()\r\n    );\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.integration.map-proximity-tool.copyMsg',\r\n        'igo.integration.map-proximity-tool.copyTitle'\r\n      );\r\n    }\r\n  }\r\n}\r\n","<button\r\n  *ngIf=\"hasWorkspace$ | async\"\r\n  mat-icon-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.integration.workspace.toggleWorkspace' | translate\"\r\n  [color]=\"color\"\r\n  (click)=\"activateWorkspace()\"\r\n>\r\n  <mat-icon svgIcon=\"table\"></mat-icon>\r\n</button>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport type { Layer } from '@igo2/geo';\r\nimport { WorkspaceState } from '../workspace.state';\r\nimport { BehaviorSubject, combineLatest, Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-workspace-button',\r\n  templateUrl: './workspace-button.component.html',\r\n  styleUrls: ['./workspace-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WorkspaceButtonComponent implements OnInit, OnDestroy {\r\n  public hasWorkspace$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private hasWorkspace$$: Subscription;\r\n\r\n  private _layer: Layer;\r\n  private layer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\r\n  @Input()\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    this.layer$.next(this._layer);\r\n  }\r\n\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  constructor(private workspaceState: WorkspaceState) {}\r\n\r\n  ngOnInit(): void {\r\n    this.hasWorkspace$$ = combineLatest([\r\n      this.workspaceState.workspaceEnabled$,\r\n      this.layer$\r\n    ]).subscribe((bunch) =>\r\n      this.hasWorkspace$.next(bunch[0] && bunch[1]?.options.workspace?.enabled)\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.hasWorkspace$$.unsubscribe();\r\n  }\r\n\r\n  activateWorkspace() {\r\n    if (\r\n      this.workspaceState.workspace$.value &&\r\n      (this.workspaceState.workspace$.value as any).layer.id ===\r\n        this.layer.id &&\r\n      this.workspaceState.workspacePanelExpanded\r\n    ) {\r\n      this.workspaceState.workspacePanelExpanded = false;\r\n    } else {\r\n      this.workspaceState.workspacePanelExpanded = true;\r\n      this.workspaceState.setActiveWorkspaceById(this.layer.id);\r\n    }\r\n  }\r\n}\r\n","<igo-layer-list\r\n  class=\"mapDetailsList\"\r\n  *ngIf=\"(layers$ | async).length; else empty\"\r\n  [map]=\"map\"\r\n  igoLayerListBinding\r\n  [excludeBaseLayers]=\"excludeBaseLayers\"\r\n  [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\r\n  [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\r\n  [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\r\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\r\n  floatLabel=\"never\"\r\n  [queryBadge]=\"queryBadge\"\r\n>\r\n  <ng-template #igoLayerItemToolbar let-layer=\"layer\">\r\n    <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\r\n    <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\r\n    <igo-export-button\r\n      [layer]=\"layer\"\r\n      (click)=\"activateExport(layer)\"\r\n    ></igo-export-button>\r\n    <igo-ogc-filter-button\r\n      [header]=\"ogcButton\"\r\n      [layer]=\"layer\"\r\n    ></igo-ogc-filter-button>\r\n    <igo-time-filter-button\r\n      [header]=\"timeButton\"\r\n      [layer]=\"layer\"\r\n    ></igo-time-filter-button>\r\n    <igo-track-feature-button\r\n      [trackFeature]=\"true\"\r\n      [layer]=\"layer\"\r\n    ></igo-track-feature-button>\r\n    <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\r\n  </ng-template>\r\n</igo-layer-list>\r\n\r\n<ng-template #empty>\r\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\r\n    <p class=\"map-empty mat-typography\">\r\n      {{ 'igo.integration.mapTool.empty' | translate }}\r\n    </p>\r\n    <p\r\n      *ngIf=\"\r\n        layerAdditionAllowed &&\r\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\r\n      \"\r\n      class=\"map-empty mat-typography\"\r\n    >\r\n      {{ 'igo.integration.mapTool.customize' | translate }}\r\n    </p>\r\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\r\n      <mat-icon matListItemIcon>\r\n        <svg\r\n          viewBox=\"0 0 24 24\"\r\n          fit=\"\"\r\n          height=\"100%\"\r\n          width=\"100%\"\r\n          preserveAspectRatio=\"xMidYMid meet\"\r\n          focusable=\"false\"\r\n        >\r\n          <path\r\n            d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\r\n          ></path></svg\r\n      ></mat-icon>\r\n      <span\r\n        matListItemTitle\r\n        class=\"search-tool mat-typography\"\r\n        (click)=\"searchEmit()\"\r\n      >\r\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\r\n      </span>\r\n    </mat-list-item>\r\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\r\n      <mat-icon matListItemIcon>\r\n        <svg\r\n          viewBox=\"0 0 24 24\"\r\n          fit=\"\"\r\n          height=\"100%\"\r\n          width=\"100%\"\r\n          preserveAspectRatio=\"xMidYMid meet\"\r\n          focusable=\"false\"\r\n        >\r\n          <path\r\n            d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\r\n          ></path></svg\r\n      ></mat-icon>\r\n      <span\r\n        matListItemTitle\r\n        class=\"catalog-tool mat-typography\"\r\n        (click)=\"catalogEmit()\"\r\n      >\r\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\r\n      </span>\r\n    </mat-list-item>\r\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\r\n      <mat-icon matListItemIcon>\r\n        <svg\r\n          viewBox=\"0 0 24 24\"\r\n          fit=\"\"\r\n          height=\"100%\"\r\n          width=\"100%\"\r\n          preserveAspectRatio=\"xMidYMid meet\"\r\n          focusable=\"false\"\r\n        >\r\n          <path\r\n            d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\r\n          ></path></svg\r\n      ></mat-icon>\r\n      <span\r\n        matListItemTitle\r\n        class=\"context-tool mat-typography\"\r\n        (click)=\"contextEmit()\"\r\n      >\r\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\r\n      </span>\r\n    </mat-list-item>\r\n  </mat-list>\r\n</ng-template>\r\n","import { Component, Input, OnInit, ChangeDetectorRef } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  LayerListControlsEnum,\r\n  Layer,\r\n  IgoMap,\r\n  LayerListControlsOptions,\r\n  SearchSourceService,\r\n  sourceCanSearch,\r\n  ExportOptions\r\n} from '@igo2/geo';\r\n\r\nimport { ToolState } from './../../tool/tool.state';\r\nimport { MapState } from './../map.state';\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from '../../import-export/import-export.state';\r\n\r\n@ToolComponent({\r\n  name: 'mapDetails',\r\n  title: 'igo.integration.tools.map',\r\n  icon: 'map'\r\n})\r\n@Component({\r\n  selector: 'igo-map-details-tool',\r\n  templateUrl: './map-details-tool.component.html',\r\n  styleUrls: ['./map-details-tool.component.scss']\r\n})\r\nexport class MapDetailsToolComponent implements OnInit {\r\n  public delayedShowEmptyMapContent: boolean = false;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input() layerListControls: LayerListControlsOptions = {};\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Input() layerAdditionAllowed: boolean = true;\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layers$(): Observable<Layer[]> {\r\n    return this.map.layers$.pipe(\r\n      map((layers) =>\r\n        layers.filter(\r\n          (layer) =>\r\n            layer.showInLayerList !== false &&\r\n            (!this.excludeBaseLayers || !layer.baseLayer)\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  get excludeBaseLayers(): boolean {\r\n    return this.layerListControls.excludeBaseLayers || false;\r\n  }\r\n\r\n  get layerFilterAndSortOptions(): any {\r\n    const filterSortOptions = Object.assign(\r\n      {\r\n        showToolbar: LayerListControlsEnum.default\r\n      },\r\n      this.layerListControls\r\n    );\r\n\r\n    switch (this.layerListControls.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\r\n        break;\r\n      case LayerListControlsEnum.never:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return filterSortOptions;\r\n  }\r\n\r\n  get searchToolInToolbar(): boolean {\r\n    return (\r\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\r\n      this.searchSourceService\r\n        .getSources()\r\n        .filter(sourceCanSearch)\r\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\r\n    );\r\n  }\r\n\r\n  get catalogToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\r\n  }\r\n\r\n  get contextToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private toolState: ToolState,\r\n    private searchSourceService: SearchSourceService,\r\n    private cdRef: ChangeDetectorRef,\r\n    private importExportState: ImportExportState\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    // prevent message to be shown too quickly. Waiting for layers\r\n    setTimeout(() => {\r\n      this.delayedShowEmptyMapContent = true;\r\n      this.cdRef.detectChanges();\r\n    }, 250);\r\n  }\r\n\r\n  searchEmit() {\r\n    this.toolState.toolbox.activateTool('searchResults');\r\n  }\r\n\r\n  catalogEmit() {\r\n    this.toolState.toolbox.activateTool('catalog');\r\n  }\r\n\r\n  contextEmit() {\r\n    this.toolState.toolbox.activateTool('contextManager');\r\n  }\r\n\r\n  activateExport(layer: Layer) {\r\n    let id = layer.id;\r\n    if (layer.options.workspace?.workspaceId) {\r\n      id =\r\n        layer.options.workspace.workspaceId !== layer.id\r\n          ? layer.options.workspace.workspaceId\r\n          : layer.id;\r\n    }\r\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\r\n    this.importExportState.setMode(ImportExportMode.export);\r\n    this.toolState.toolbox.activateTool('importExport');\r\n  }\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subscription, combineLatest } from 'rxjs';\r\n\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { LayerLegendListComponent } from './layer-legend-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoLayerLegendListBinding]'\r\n})\r\nexport class LayerLegendListBindingDirective implements OnInit, OnDestroy {\r\n  private component: LayerLegendListComponent;\r\n  private layersOrResolutionChange$$: Subscription;\r\n  layersVisibility$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: LayerLegendListComponent,\r\n    private mapService: MapService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    this.component.layers = [];\r\n    this.layersOrResolutionChange$$ = combineLatest([\r\n      this.mapService.getMap().layers$,\r\n      this.mapService.getMap().viewController.resolution$\r\n    ])\r\n      .pipe(debounceTime(10))\r\n      .subscribe((bunch: [Layer[], number]) => {\r\n        const shownLayers = bunch[0].filter((layer: Layer) => {\r\n          return layer.showInLayerList === true;\r\n        });\r\n        this.component.layers = shownLayers;\r\n\r\n        this.layersVisibility$$ = combineLatest(\r\n          shownLayers.map((layer: Layer) => layer.visible$)\r\n        ).subscribe((r) => {\r\n          this.component.change$.next();\r\n        });\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layersOrResolutionChange$$.unsubscribe();\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n  }\r\n}\r\n","<igo-layer-legend-list\r\n  *ngIf=\"showAllLegend()\"\r\n  igoLayerLegendListBinding\r\n  [excludeBaseLayers]=\"excludeBaseLayers\"\r\n  [allowShowAllLegends]=\"allowShowAllLegends\"\r\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\r\n  [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\r\n  (allLegendsShown)=\"onShowAllLegends($event)\"\r\n>\r\n</igo-layer-legend-list>\r\n<ng-template\r\n  *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\r\n></ng-template>\r\n\r\n<p\r\n  class=\"map-empty mat-typography\"\r\n  *ngIf=\"\r\n    !allowShowAllLegends &&\r\n    (layers$ | async).length !== 0 &&\r\n    (visibleOrInRangeLayers$ | async).length === 0\r\n  \"\r\n>\r\n  {{\r\n    (visibleLayers$ | async).length\r\n      ? ('igo.integration.mapTool.noLayersInRange' | translate)\r\n      : ('igo.integration.mapTool.noLayersVisible' | translate)\r\n  }}\r\n</p>\r\n\r\n<ng-template #emptyLayers>\r\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\r\n    <p class=\"map-empty mat-typography\">\r\n      {{ 'igo.integration.mapTool.empty' | translate }}\r\n    </p>\r\n    <p\r\n      *ngIf=\"\r\n        layerAdditionAllowed &&\r\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\r\n      \"\r\n      class=\"map-empty mat-typography\"\r\n    >\r\n      {{ 'igo.integration.mapTool.customize' | translate }}\r\n    </p>\r\n\r\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\r\n      <mat-icon matListItemIcon>\r\n        <svg\r\n          viewBox=\"0 0 24 24\"\r\n          fit=\"\"\r\n          height=\"100%\"\r\n          width=\"100%\"\r\n          preserveAspectRatio=\"xMidYMid meet\"\r\n          focusable=\"false\"\r\n        >\r\n          <path\r\n            d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\r\n          ></path></svg\r\n      ></mat-icon>\r\n      <span\r\n        matListItemTitle\r\n        class=\"search-tool mat-typography\"\r\n        (click)=\"searchEmit()\"\r\n      >\r\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\r\n      </span>\r\n    </mat-list-item>\r\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\r\n      <mat-icon matListItemIcon>\r\n        <svg\r\n          viewBox=\"0 0 24 24\"\r\n          fit=\"\"\r\n          height=\"100%\"\r\n          width=\"100%\"\r\n          preserveAspectRatio=\"xMidYMid meet\"\r\n          focusable=\"false\"\r\n        >\r\n          <path\r\n            d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\r\n          ></path></svg\r\n      ></mat-icon>\r\n      <span\r\n        matListItemTitle\r\n        class=\"catalog-tool mat-typography\"\r\n        (click)=\"catalogEmit()\"\r\n      >\r\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\r\n      </span>\r\n    </mat-list-item>\r\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\r\n      <mat-icon matListItemIcon>\r\n        <svg\r\n          viewBox=\"0 0 24 24\"\r\n          fit=\"\"\r\n          height=\"100%\"\r\n          width=\"100%\"\r\n          preserveAspectRatio=\"xMidYMid meet\"\r\n          focusable=\"false\"\r\n        >\r\n          <path\r\n            d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\r\n          ></path></svg\r\n      ></mat-icon>\r\n      <span\r\n        matListItemTitle\r\n        class=\"context-tool mat-typography\"\r\n        (click)=\"contextEmit()\"\r\n      >\r\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\r\n      </span>\r\n    </mat-list-item>\r\n  </mat-list>\r\n</ng-template>\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport {\r\n  Observable,\r\n  Subscription,\r\n  BehaviorSubject,\r\n  ReplaySubject,\r\n  combineLatest\r\n} from 'rxjs';\r\nimport { map, debounceTime } from 'rxjs/operators';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  Layer,\r\n  IgoMap,\r\n  LayerListControlsOptions,\r\n  SearchSourceService,\r\n  sourceCanSearch\r\n} from '@igo2/geo';\r\n\r\nimport { ToolState } from './../../tool/tool.state';\r\nimport { MapState } from './../map.state';\r\n\r\n@ToolComponent({\r\n  name: 'mapLegend',\r\n  title: 'igo.integration.tools.legend',\r\n  icon: 'format-list-bulleted-type'\r\n})\r\n@Component({\r\n  selector: 'igo-map-legend-tool',\r\n  templateUrl: './map-legend-tool.component.html',\r\n  styleUrls: ['./map-legend-tool.component.scss']\r\n})\r\nexport class MapLegendToolComponent implements OnInit, OnDestroy {\r\n  public delayedShowEmptyMapContent: boolean = false;\r\n\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  private resolution$$: Subscription;\r\n  private visibleOrInRangeLayers$$: Subscription;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() layerAdditionAllowed: boolean = true;\r\n\r\n  @Input() allowShowAllLegends: boolean = false;\r\n\r\n  @Input() showAllLegendsValue: boolean = false;\r\n\r\n  @Input() layerListControls: LayerListControlsOptions = {};\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\r\n    return this.layers$.pipe(\r\n      map((layers) =>\r\n        layers.filter(\r\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  get visibleLayers$(): Observable<Layer[]> {\r\n    return this.layers$.pipe(\r\n      map((layers) => layers.filter((layer) => layer.visible$.value))\r\n    );\r\n  }\r\n\r\n  get excludeBaseLayers(): boolean {\r\n    return this.layerListControls.excludeBaseLayers || false;\r\n  }\r\n\r\n  get searchToolInToolbar(): boolean {\r\n    return (\r\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\r\n      this.searchSourceService\r\n        .getSources()\r\n        .filter(sourceCanSearch)\r\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\r\n    );\r\n  }\r\n\r\n  get catalogToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\r\n  }\r\n\r\n  get contextToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\r\n  }\r\n  constructor(\r\n    private mapState: MapState,\r\n    private toolState: ToolState,\r\n    private searchSourceService: SearchSourceService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.resolution$$ = combineLatest([\r\n      this.map.layers$,\r\n      this.map.viewController.resolution$\r\n    ])\r\n      .pipe(debounceTime(10))\r\n      .subscribe((bunch: [Layer[], number]) => {\r\n        this.layers$.next(\r\n          bunch[0].filter(\r\n            (layer) =>\r\n              layer.showInLayerList !== false &&\r\n              (!this.excludeBaseLayers || !layer.baseLayer)\r\n          )\r\n        );\r\n      });\r\n\r\n    if (this.allowShowAllLegends) {\r\n      this.mapState.showAllLegendsValue =\r\n        this.mapState.showAllLegendsValue !== undefined\r\n          ? this.mapState.showAllLegendsValue\r\n          : this.showAllLegendsValue || false;\r\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\r\n    } else {\r\n      this.showAllLegendsValue$.next(false);\r\n    }\r\n\r\n    // prevent message to be shown too quickly. Waiting for layers\r\n    setTimeout(() => {\r\n      this.delayedShowEmptyMapContent = true;\r\n      this.cdRef.detectChanges();\r\n    }, 250);\r\n  }\r\n\r\n  onShowAllLegends(event) {\r\n    this.mapState.showAllLegendsValue = event;\r\n    this.showAllLegendsValue$.next(event);\r\n  }\r\n\r\n  showAllLegend() {\r\n    if (this.layers$.getValue().length === 0) {\r\n      return false;\r\n    } else if (\r\n      this.layers$.getValue().length !== 0 &&\r\n      this.allowShowAllLegends === false\r\n    ) {\r\n      let visibleOrInRangeLayers;\r\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\r\n        (value) => {\r\n          value.length === 0\r\n            ? (visibleOrInRangeLayers = false)\r\n            : (visibleOrInRangeLayers = true);\r\n        }\r\n      );\r\n\r\n      if (visibleOrInRangeLayers === false) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.resolution$$.unsubscribe();\r\n    if (this.visibleOrInRangeLayers$$) {\r\n      this.visibleOrInRangeLayers$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  searchEmit() {\r\n    this.toolState.toolbox.activateTool('searchResults');\r\n  }\r\n\r\n  catalogEmit() {\r\n    this.toolState.toolbox.activateTool('catalog');\r\n  }\r\n\r\n  contextEmit() {\r\n    this.toolState.toolbox.activateTool('contextManager');\r\n  }\r\n}\r\n","<mat-tab-group>\r\n  <mat-tab [label]=\"'igo.integration.tools.map' | translate\">\r\n    <igo-layer-list\r\n      [map]=\"map\"\r\n      igoLayerListBinding\r\n      [excludeBaseLayers]=\"excludeBaseLayers\"\r\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\r\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\r\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\r\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\r\n      [floatLabel]=\"false\"\r\n      [queryBadge]=\"queryBadge\"\r\n    >\r\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\r\n        <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\r\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\r\n        <igo-export-button\r\n          [layer]=\"layer\"\r\n          (click)=\"activateExport(layer)\"\r\n        ></igo-export-button>\r\n        <igo-ogc-filter-button\r\n          [header]=\"ogcButton\"\r\n          [layer]=\"layer\"\r\n        ></igo-ogc-filter-button>\r\n        <igo-time-filter-button\r\n          [header]=\"timeButton\"\r\n          [layer]=\"layer\"\r\n        ></igo-time-filter-button>\r\n        <igo-track-feature-button\r\n          [trackFeature]=\"true\"\r\n          [layer]=\"layer\"\r\n        ></igo-track-feature-button>\r\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\r\n      </ng-template>\r\n    </igo-layer-list>\r\n  </mat-tab>\r\n\r\n  <mat-tab [label]=\"'igo.integration.tools.contexts' | translate\">\r\n    <igo-context-list igoContextListBinding></igo-context-list>\r\n  </mat-tab>\r\n</mat-tab-group>\r\n","import { Component, ChangeDetectionStrategy, Input } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  LayerListControlsEnum,\r\n  LayerListControlsOptions,\r\n  IgoMap,\r\n  ExportOptions,\r\n  Layer\r\n} from '@igo2/geo';\r\nimport { MapState } from './../map.state';\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from '../../import-export/import-export.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\n\r\n/**\r\n * Tool to browse a map's layers or to choose a different map\r\n */\r\n@ToolComponent({\r\n  name: 'map',\r\n  title: 'igo.integration.tools.map',\r\n  icon: 'map'\r\n})\r\n@Component({\r\n  selector: 'igo-map-tool',\r\n  templateUrl: './map-tool.component.html',\r\n  styleUrls: ['./map-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MapToolComponent {\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input() layerListControls: LayerListControlsOptions = {};\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get excludeBaseLayers(): boolean {\r\n    return this.layerListControls.excludeBaseLayers || false;\r\n  }\r\n\r\n  get layerFilterAndSortOptions(): any {\r\n    const filterSortOptions = Object.assign(\r\n      {\r\n        showToolbar: LayerListControlsEnum.default\r\n      },\r\n      this.layerListControls\r\n    );\r\n\r\n    switch (this.layerListControls.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\r\n        break;\r\n      case LayerListControlsEnum.never:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return filterSortOptions;\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private toolState: ToolState,\r\n    private importExportState: ImportExportState\r\n  ) {}\r\n\r\n  activateExport(layer: Layer) {\r\n    let id = layer.id;\r\n    if (layer.options.workspace?.workspaceId) {\r\n      id =\r\n        layer.options.workspace.workspaceId !== layer.id\r\n          ? layer.options.workspace.workspaceId\r\n          : layer.id;\r\n    }\r\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\r\n    this.importExportState.setMode(ImportExportMode.export);\r\n    this.toolState.toolbox.activateTool('importExport');\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { LayerListControlsOptions } from '@igo2/geo';\r\n\r\n/**\r\n * Service that holds the state of layer list tool values\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerListToolState {\r\n  readonly keyword$: BehaviorSubject<string> = new BehaviorSubject('');\r\n  readonly sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  readonly onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  readonly selectedTab$: BehaviorSubject<number> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  setKeyword(keyword: string) {\r\n    this.keyword$.next(keyword);\r\n  }\r\n\r\n  setSortAlpha(sort: boolean) {\r\n    this.sortAlpha$.next(sort);\r\n  }\r\n\r\n  setOnlyVisible(onlyVisible: boolean) {\r\n    this.onlyVisible$.next(onlyVisible);\r\n  }\r\n\r\n  setSelectedTab(tab: number) {\r\n    this.selectedTab$.next(tab);\r\n  }\r\n\r\n  getLayerListControls(): LayerListControlsOptions {\r\n    return {\r\n      keyword: this.keyword$.value,\r\n      onlyVisible: this.onlyVisible$.value,\r\n      sortAlpha: this.sortAlpha$.value\r\n    };\r\n  }\r\n}\r\n","<mat-tab-group\r\n  #tabGroup\r\n  [selectedIndex]=\"layerListToolState.selectedTab$ | async\"\r\n  (selectedTabChange)=\"tabChanged($event)\"\r\n>\r\n  <mat-tab [label]=\"'igo.integration.tools.layers' | translate\">\r\n    <igo-layer-list\r\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\r\n      igoLayerListBinding\r\n      [excludeBaseLayers]=\"excludeBaseLayers\"\r\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\r\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\r\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\r\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\r\n      [floatLabel]=\"false\"\r\n      [queryBadge]=\"queryBadge\"\r\n      [map]=\"map\"\r\n      (appliedFilterAndSort)=\"onLayerListChange($event)\"\r\n    >\r\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\r\n        <igo-style-modal-layer-button\r\n          *ngIf=\"isStyleEditButton(layer)\"\r\n          [layer]=\"layer\"\r\n        ></igo-style-modal-layer-button>\r\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\r\n        <igo-track-feature-button\r\n          [trackFeature]=\"true\"\r\n          [layer]=\"layer\"\r\n        ></igo-track-feature-button>\r\n        <igo-time-filter-button\r\n          *ngIf=\"isTimeFilterButton(layer)\"\r\n          [header]=\"timeButton\"\r\n          [layer]=\"layer\"\r\n          (click)=\"activateTimeFilter()\"\r\n        ></igo-time-filter-button>\r\n        <igo-ogc-filter-button\r\n          *ngIf=\"isOGCFilterButton(layer)\"\r\n          [header]=\"ogcButton\"\r\n          [layer]=\"layer\"\r\n          (click)=\"activateOgcFilter()\"\r\n        ></igo-ogc-filter-button>\r\n        <igo-export-button\r\n          *ngIf=\"isExportButton(layer)\"\r\n          [layer]=\"layer\"\r\n          (click)=\"activateExport(layer)\"\r\n        ></igo-export-button>\r\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\r\n      </ng-template>\r\n    </igo-layer-list>\r\n  </mat-tab>\r\n\r\n  <mat-tab [label]=\"'igo.integration.tools.legend' | translate\">\r\n    <igo-layer-legend-list\r\n      *ngIf=\"showAllLegend()\"\r\n      igoLayerLegendListBinding\r\n      [allowShowAllLegends]=\"allowShowAllLegends\"\r\n      [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\r\n      (allLegendsShown)=\"onShowAllLegends($event)\"\r\n      [excludeBaseLayers]=\"excludeBaseLayers\"\r\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\r\n    >\r\n    </igo-layer-legend-list>\r\n    <ng-template\r\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\r\n    ></ng-template>\r\n\r\n    <p\r\n      class=\"map-empty mat-typography\"\r\n      *ngIf=\"\r\n        !allowShowAllLegends &&\r\n        (layers$ | async).length !== 0 &&\r\n        (visibleOrInRangeLayers$ | async).length === 0\r\n      \"\r\n    >\r\n      {{\r\n        (visibleLayers$ | async).length\r\n          ? ('igo.integration.mapTool.noLayersInRange' | translate)\r\n          : ('igo.integration.mapTool.noLayersVisible' | translate)\r\n      }}\r\n    </p>\r\n  </mat-tab>\r\n\r\n  <ng-template #emptyLayers>\r\n    <mat-list *ngIf=\"delayedShowEmptyMapContent\">\r\n      <p class=\"map-empty mat-typography\">\r\n        {{ 'igo.integration.mapTool.empty' | translate }}\r\n      </p>\r\n      <p\r\n        *ngIf=\"\r\n          layerAdditionAllowed &&\r\n          (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\r\n        \"\r\n        class=\"map-empty mat-typography\"\r\n      >\r\n        {{ 'igo.integration.mapTool.customize' | translate }}\r\n      </p>\r\n\r\n      <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\r\n        <mat-icon matListItemIcon>\r\n          <svg\r\n            viewBox=\"0 0 24 24\"\r\n            fit=\"\"\r\n            height=\"100%\"\r\n            width=\"100%\"\r\n            preserveAspectRatio=\"xMidYMid meet\"\r\n            focusable=\"false\"\r\n          >\r\n            <path\r\n              d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\r\n            ></path></svg\r\n        ></mat-icon>\r\n        <span\r\n          matListItemTitle\r\n          class=\"search-tool mat-typography\"\r\n          (click)=\"searchEmit()\"\r\n        >\r\n          {{ 'igo.integration.mapTool.search-tool' | translate }}\r\n        </span>\r\n      </mat-list-item>\r\n      <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\r\n        <mat-icon matListItemIcon>\r\n          <svg\r\n            viewBox=\"0 0 24 24\"\r\n            fit=\"\"\r\n            height=\"100%\"\r\n            width=\"100%\"\r\n            preserveAspectRatio=\"xMidYMid meet\"\r\n            focusable=\"false\"\r\n          >\r\n            <path\r\n              d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\r\n            ></path></svg\r\n        ></mat-icon>\r\n        <span\r\n          matListItemTitle\r\n          class=\"catalog-tool mat-typography\"\r\n          (click)=\"catalogEmit()\"\r\n        >\r\n          {{ 'igo.integration.mapTool.catalog-tool' | translate }}\r\n        </span>\r\n      </mat-list-item>\r\n      <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\r\n        <mat-icon matListItemIcon>\r\n          <svg\r\n            viewBox=\"0 0 24 24\"\r\n            fit=\"\"\r\n            height=\"100%\"\r\n            width=\"100%\"\r\n            preserveAspectRatio=\"xMidYMid meet\"\r\n            focusable=\"false\"\r\n          >\r\n            <path\r\n              d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\r\n            ></path></svg\r\n        ></mat-icon>\r\n        <span\r\n          matListItemTitle\r\n          class=\"context-tool mat-typography\"\r\n          (click)=\"contextEmit()\"\r\n        >\r\n          {{ 'igo.integration.mapTool.context-tool' | translate }}\r\n        </span>\r\n      </mat-list-item>\r\n    </mat-list>\r\n  </ng-template>\r\n</mat-tab-group>\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  Input,\r\n  OnInit,\r\n  ViewChild,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  LayerListControlsEnum,\r\n  LayerListControlsOptions,\r\n  IgoMap,\r\n  SearchSourceService,\r\n  sourceCanSearch,\r\n  Layer,\r\n  ExportOptions,\r\n  VectorLayer\r\n} from '@igo2/geo';\r\n\r\nimport { LayerListToolState } from '../layer-list-tool.state';\r\nimport { MatTabChangeEvent } from '@angular/material/tabs';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { MapState } from '../map.state';\r\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\r\nimport { map, debounceTime } from 'rxjs/operators';\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from '../../import-export/import-export.state';\r\n/**\r\n * Tool to browse a map's layers or to choose a different map\r\n */\r\n@ToolComponent({\r\n  name: 'mapTools',\r\n  title: 'igo.integration.tools.map',\r\n  icon: 'map'\r\n})\r\n@Component({\r\n  selector: 'igo-map-tools',\r\n  templateUrl: './map-tools.component.html',\r\n  styleUrls: ['./map-tools.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MapToolsComponent implements OnInit, OnDestroy {\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private resolution$$: Subscription;\r\n  private visibleOrInRangeLayers$$: Subscription;\r\n  public delayedShowEmptyMapContent: boolean = false;\r\n\r\n  @Input() allowShowAllLegends: boolean = false;\r\n\r\n  @Input() showAllLegendsValue: boolean = false;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() selectedTabAtOpening: string;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input() layerAdditionAllowed: boolean = true;\r\n\r\n  @Input()\r\n  get layerListControls(): LayerListControlsOptions {\r\n    return this._layerListControls;\r\n  }\r\n  set layerListControls(value: LayerListControlsOptions) {\r\n    const stateOptions = this.layerListToolState.getLayerListControls();\r\n    const stateKeyword = stateOptions.keyword;\r\n    const stateOnlyVisible = stateOptions.onlyVisible;\r\n    const stateSortAlpha = stateOptions.sortAlpha;\r\n\r\n    value.keyword = stateKeyword !== '' ? stateKeyword : value.keyword;\r\n    value.onlyVisible =\r\n      stateOnlyVisible !== undefined ? stateOnlyVisible : value.onlyVisible;\r\n    value.sortAlpha =\r\n      stateSortAlpha !== undefined ? stateSortAlpha : value.sortAlpha;\r\n\r\n    value.onlyVisible =\r\n      value.onlyVisible === undefined ? false : value.onlyVisible;\r\n    value.sortAlpha = value.sortAlpha === undefined ? false : value.sortAlpha;\r\n\r\n    this._layerListControls = value;\r\n  }\r\n  private _layerListControls = {};\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\r\n    return this.layers$.pipe(\r\n      map((layers) =>\r\n        layers.filter(\r\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  get visibleLayers$(): Observable<Layer[]> {\r\n    return this.layers$.pipe(\r\n      map((layers) => layers.filter((layer) => layer.visible$.value))\r\n    );\r\n  }\r\n\r\n  get excludeBaseLayers(): boolean {\r\n    return this.layerListControls.excludeBaseLayers || false;\r\n  }\r\n\r\n  get layerFilterAndSortOptions(): LayerListControlsOptions {\r\n    const filterSortOptions = Object.assign(\r\n      {\r\n        showToolbar: LayerListControlsEnum.default\r\n      },\r\n      this.layerListControls\r\n    );\r\n\r\n    switch (this.layerListControls.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\r\n        break;\r\n      case LayerListControlsEnum.never:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return filterSortOptions;\r\n  }\r\n\r\n  @ViewChild('tabGroup', { static: true }) tabGroup;\r\n\r\n  get searchToolInToolbar(): boolean {\r\n    return (\r\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\r\n      this.searchSourceService\r\n        .getSources()\r\n        .filter(sourceCanSearch)\r\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\r\n    );\r\n  }\r\n\r\n  get catalogToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\r\n  }\r\n\r\n  get contextToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\r\n  }\r\n\r\n  constructor(\r\n    public layerListToolState: LayerListToolState,\r\n    private toolState: ToolState,\r\n    public mapState: MapState,\r\n    private searchSourceService: SearchSourceService,\r\n    private importExportState: ImportExportState\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.selectedTab();\r\n    this.resolution$$ = combineLatest([\r\n      this.map.layers$,\r\n      this.map.viewController.resolution$\r\n    ])\r\n      .pipe(debounceTime(10))\r\n      .subscribe((bunch: [Layer[], number]) => {\r\n        this.layers$.next(\r\n          bunch[0].filter(\r\n            (layer) =>\r\n              layer.showInLayerList !== false &&\r\n              (!this.excludeBaseLayers || !layer.baseLayer)\r\n          )\r\n        );\r\n      });\r\n\r\n    if (this.allowShowAllLegends) {\r\n      this.mapState.showAllLegendsValue =\r\n        this.mapState.showAllLegendsValue !== undefined\r\n          ? this.mapState.showAllLegendsValue\r\n          : this.showAllLegendsValue || false;\r\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\r\n    } else {\r\n      this.showAllLegendsValue$.next(false);\r\n    }\r\n\r\n    // prevent message to be shown too quickly. Waiting for layers\r\n    setTimeout(() => (this.delayedShowEmptyMapContent = true), 250);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.resolution$$.unsubscribe();\r\n    if (this.visibleOrInRangeLayers$$) {\r\n      this.visibleOrInRangeLayers$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  onShowAllLegends(event) {\r\n    this.mapState.showAllLegendsValue = event;\r\n    this.showAllLegendsValue$.next(event);\r\n  }\r\n\r\n  private selectedTab() {\r\n    const userSelectedTab = this.layerListToolState.selectedTab$.value;\r\n    if (userSelectedTab !== undefined) {\r\n      this.layerListToolState.setSelectedTab(userSelectedTab);\r\n    } else {\r\n      if (this.selectedTabAtOpening === 'legend') {\r\n        this.layerListToolState.setSelectedTab(1);\r\n      } else {\r\n        this.layerListToolState.setSelectedTab(0);\r\n      }\r\n    }\r\n  }\r\n\r\n  public tabChanged(tab: MatTabChangeEvent) {\r\n    this.layerListToolState.setSelectedTab(tab.index);\r\n    this.layers$.next(\r\n      this.map.layers.filter(\r\n        (layer) =>\r\n          layer.showInLayerList !== false &&\r\n          (!this.excludeBaseLayers || !layer.baseLayer)\r\n      )\r\n    );\r\n  }\r\n\r\n  onLayerListChange(appliedFilters: LayerListControlsOptions) {\r\n    this.layerListToolState.setKeyword(appliedFilters.keyword);\r\n    this.layerListToolState.setSortAlpha(appliedFilters.sortAlpha);\r\n    this.layerListToolState.setOnlyVisible(appliedFilters.onlyVisible);\r\n  }\r\n\r\n  showAllLegend() {\r\n    if (this.layers$.getValue().length === 0) {\r\n      return false;\r\n    } else if (\r\n      this.layers$.getValue().length !== 0 &&\r\n      this.allowShowAllLegends === false\r\n    ) {\r\n      let visibleOrInRangeLayers;\r\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\r\n        (value) => {\r\n          value.length === 0\r\n            ? (visibleOrInRangeLayers = false)\r\n            : (visibleOrInRangeLayers = true);\r\n        }\r\n      );\r\n\r\n      if (visibleOrInRangeLayers === false) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  activateExport(layer: Layer) {\r\n    let id = layer.id;\r\n    if (layer.options.workspace?.workspaceId) {\r\n      id =\r\n        layer.options.workspace.workspaceId !== layer.id\r\n          ? layer.options.workspace.workspaceId\r\n          : layer.id;\r\n    }\r\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\r\n    this.importExportState.setMode(ImportExportMode.export);\r\n    this.toolState.toolbox.activateTool('importExport');\r\n  }\r\n\r\n  activateTimeFilter() {\r\n    this.toolState.toolbox.activateTool('activeTimeFilter');\r\n  }\r\n\r\n  activateOgcFilter() {\r\n    this.toolState.toolbox.activateTool('activeOgcFilter');\r\n  }\r\n\r\n  searchEmit() {\r\n    this.toolState.toolbox.activateTool('searchResults');\r\n  }\r\n\r\n  catalogEmit() {\r\n    this.toolState.toolbox.activateTool('catalog');\r\n  }\r\n\r\n  contextEmit() {\r\n    this.toolState.toolbox.activateTool('contextManager');\r\n  }\r\n\r\n  isTimeFilterButton(layer): boolean {\r\n    const options = layer.dataSource.options;\r\n    return this.timeButton && options.timeFilterable && options.timeFilter;\r\n  }\r\n\r\n  isOGCFilterButton(layer): boolean {\r\n    const options = layer.dataSource.options;\r\n    return (\r\n      this.ogcButton &&\r\n      options.ogcFilters &&\r\n      options.ogcFilters.enabled &&\r\n      (options.ogcFilters.pushButtons ||\r\n        options.ogcFilters.checkboxes ||\r\n        options.ogcFilters.radioButtons ||\r\n        options.ogcFilters.select ||\r\n        options.ogcFilters.autocomplete ||\r\n        options.ogcFilters.editable)\r\n    );\r\n  }\r\n\r\n  isExportButton(layer: Layer): boolean {\r\n    if (\r\n      (layer instanceof VectorLayer && layer.exportable === true) ||\r\n      (layer.dataSource.options.download &&\r\n        layer.dataSource.options.download.url) ||\r\n      (layer.options.workspace?.enabled &&\r\n        layer.options.workspace?.workspaceId !== layer.id)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  isStyleEditButton(layer: Layer): boolean {\r\n    if (layer instanceof VectorLayer) {\r\n      if ((layer as VectorLayer).options?.igoStyle?.editable) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  EntityRecord,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreStrategyFuncOptions,\r\n  EntityStoreWithStrategy\r\n} from '@igo2/common';\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\nimport {\r\n  SearchResult,\r\n  SearchSourceService,\r\n  SearchSource,\r\n  CommonVectorStyleOptions,\r\n  FeatureWorkspace,\r\n  FeatureStore,\r\n  Feature\r\n} from '@igo2/geo';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { WorkspaceState } from '../workspace/workspace.state';\r\nimport { MapState } from '../map';\r\n\r\n/**\r\n * Service that holds the state of the search module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SearchState {\r\n  public searchLayerStores: FeatureStore<Feature>[] = [];\r\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\r\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\r\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\r\n\r\n  public focusedOrResolution$$: Subscription;\r\n  public selectedOrResolution$$: Subscription;\r\n\r\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject(\r\n    '|'\r\n  );\r\n\r\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n\r\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject(false);\r\n\r\n  readonly searchSettingsChange$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Store that holds the search results\r\n   */\r\n  readonly store = new EntityStoreWithStrategy<SearchResult>([]);\r\n\r\n  /**\r\n   * Search types currently enabled in the search source service\r\n   */\r\n  get searchTypes(): string[] {\r\n    return this.searchSourceService\r\n      .getEnabledSources()\r\n      .map((source: SearchSource) => (source.constructor as any).type);\r\n  }\r\n\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private storageService: StorageService,\r\n    private workspaceState: WorkspaceState,\r\n    private configService: ConfigService,\r\n    private mapState: MapState\r\n  ) {\r\n    const searchOverlayStyle = this.configService.getConfig(\r\n      'searchOverlayStyle'\r\n    ) as {\r\n      base?: CommonVectorStyleOptions;\r\n      selection?: CommonVectorStyleOptions;\r\n      focus?: CommonVectorStyleOptions;\r\n    };\r\n    if (searchOverlayStyle) {\r\n      this.searchOverlayStyle = searchOverlayStyle.base;\r\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\r\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\r\n    }\r\n\r\n    const searchResultsGeometryEnabled = this.storageService.get(\r\n      'searchResultsGeometryEnabled'\r\n    ) as boolean;\r\n    if (searchResultsGeometryEnabled) {\r\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\r\n    }\r\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\r\n\r\n    const wksSource = this.searchSourceService\r\n      .getSources()\r\n      .find((source) => source.getId() === 'workspace');\r\n    this.workspaceState.store.entities$.subscribe((e) => {\r\n      const searchableWks = e.filter(\r\n        (fw) =>\r\n          fw instanceof FeatureWorkspace &&\r\n          fw.layer.options.workspace.searchIndexEnabled\r\n      );\r\n      this.searchSourceService.setWorkspaces(wksSource, searchableWks);\r\n    });\r\n    this.monitorLayerDeletion();\r\n  }\r\n\r\n  private monitorLayerDeletion() {\r\n    this.mapState.map.layers$.subscribe((layers) => {\r\n      this.searchLayerStores.forEach((store) => {\r\n        let layer = layers.find((l) => l.id === store.layer.id);\r\n        if (!layer) {\r\n          const index = this.searchLayerStores.indexOf(store);\r\n          this.searchLayerStores.splice(index, 1);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\r\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\r\n      return record.entity.meta.score === 100;\r\n    };\r\n    return new EntityStoreFilterCustomFuncStrategy({\r\n      filterClauseFunc\r\n    } as EntityStoreStrategyFuncOptions);\r\n  }\r\n\r\n  /**\r\n   * Activate custom strategy\r\n   *\r\n   */\r\n  activateCustomFilterTermStrategy() {\r\n    const strategy = this.store.getStrategyOfType(\r\n      EntityStoreFilterCustomFuncStrategy\r\n    );\r\n    if (strategy !== undefined) {\r\n      strategy.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate custom strategy\r\n   *\r\n   */\r\n  deactivateCustomFilterTermStrategy() {\r\n    const strategy = this.store.getStrategyOfType(\r\n      EntityStoreFilterCustomFuncStrategy\r\n    );\r\n    if (strategy !== undefined) {\r\n      strategy.deactivate();\r\n    }\r\n  }\r\n\r\n  enableSearch() {\r\n    this.searchDisabled$.next(false);\r\n  }\r\n\r\n  disableSearch() {\r\n    this.searchDisabled$.next(true);\r\n  }\r\n\r\n  setSearchTerm(searchTerm: string) {\r\n    this.searchTerm$.next(searchTerm);\r\n  }\r\n\r\n  setSearchType(searchType: string) {\r\n    this.searchSourceService.enableSourcesByType(searchType);\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  setSearchSettingsChange() {\r\n    this.searchSettingsChange$.next(true);\r\n  }\r\n\r\n  setSelectedResult(result: SearchResult) {\r\n    this.selectedResult$.next(result);\r\n  }\r\n\r\n  setSearchResultsGeometryStatus(value) {\r\n    this.storageService.set('searchResultsGeometryEnabled', value);\r\n    this.searchResultsGeometryEnabled$.next(value);\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\n\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { MapState } from '../../map/map.state';\r\nimport { IgoMap } from '@igo2/geo';\r\n\r\n@ToolComponent({\r\n  name: 'contextManager',\r\n  title: 'igo.integration.tools.contexts',\r\n  icon: 'star'\r\n})\r\n@Component({\r\n  selector: 'igo-context-manager-tool',\r\n  templateUrl: './context-manager-tool.component.html'\r\n})\r\nexport class ContextManagerToolComponent {\r\n  @Input() toolToOpenOnContextChange: string = 'mapTools';\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    private toolState: ToolState,\r\n    private mapState: MapState\r\n  ) {}\r\n\r\n  editContext() {\r\n    this.toolState.toolbox.activateTool('contextEditor');\r\n  }\r\n\r\n  managePermissions() {\r\n    this.toolState.toolbox.activateTool('contextPermissionManager');\r\n  }\r\n}\r\n","<igo-context-list\r\n  igoContextListBinding\r\n  [map]=\"map\"\r\n  (edit)=\"editContext()\"\r\n  (managePermissions)=\"managePermissions()\"\r\n>\r\n</igo-context-list>\r\n","import { Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { ToolState } from '../../tool/tool.state';\r\n\r\n@ToolComponent({\r\n  name: 'contextEditor',\r\n  title: 'igo.integration.tools.contexts',\r\n  icon: 'star',\r\n  parent: 'contextManager'\r\n})\r\n@Component({\r\n  selector: 'igo-context-editor-tool',\r\n  templateUrl: './context-editor-tool.component.html'\r\n})\r\nexport class ContextEditorToolComponent {\r\n  constructor(private toolState: ToolState) {}\r\n\r\n  submitSuccessed() {\r\n    this.toolState.toolbox.activatePreviousTool();\r\n  }\r\n}\r\n","<igo-context-edit\n  igoContextEditBinding\n  (submitSuccessed)=\"submitSuccessed()\"\n></igo-context-edit>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\n@ToolComponent({\n  name: 'contextPermissionManager',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star',\n  parent: 'contextManager'\n})\n@Component({\n  selector: 'igo-context-permission-manager-tool',\n  templateUrl: './context-permission-manager-tool.component.html'\n})\nexport class ContextPermissionManagerToolComponent {}\n","<igo-context-permissions igoContextPermissionsBinding></igo-context-permissions>\n","import { Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { IgoMap, LayerListControlsOptions } from '@igo2/geo';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport { LayerListToolState } from '../../map/layer-list-tool.state';\r\n\r\n@ToolComponent({\r\n  name: 'shareMap',\r\n  title: 'igo.integration.tools.shareMap',\r\n  icon: 'share-variant'\r\n})\r\n@Component({\r\n  selector: 'igo-context-share-tool',\r\n  templateUrl: './context-share-tool.component.html'\r\n})\r\nexport class ContextShareToolComponent {\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layerListControls(): LayerListControlsOptions {\r\n    return this.layerListToolState.getLayerListControls();\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private layerListToolState: LayerListToolState\r\n  ) {}\r\n}\r\n","<igo-share-map [map]=\"map\"></igo-share-map>\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { Catalog, CatalogItem } from '@igo2/geo';\r\n\r\n/**\r\n * Service that holds the state of the catalog module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CatalogState {\r\n  /**\r\n   * Store that contains all the catalogs\r\n   */\r\n  get catalogStore(): EntityStore<Catalog> {\r\n    return this._catalogStore;\r\n  }\r\n  private _catalogStore: EntityStore<Catalog>;\r\n\r\n  /**\r\n   * Catalog -> Catalog items store mapping\r\n   */\r\n  private catalogItemsStores = new Map<string, EntityStore<CatalogItem>>();\r\n\r\n  constructor(authService: AuthService) {\r\n    this._catalogStore = new EntityStore([]);\r\n\r\n    authService.authenticate$.subscribe(() => {\r\n      this.clearCatalogItemsStores();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get a catalog's items store\r\n   * @param catalog Catalog\r\n   * @returns Store that contains the catalog items\r\n   */\r\n  getCatalogItemsStore(catalog: Catalog): EntityStore<CatalogItem> {\r\n    return this.catalogItemsStores.get(catalog.id as string);\r\n  }\r\n\r\n  /**\r\n   * Bind a catalog items store to a catalog\r\n   * @param catalog Catalog\r\n   * @param store Catalog items store\r\n   */\r\n  setCatalogItemsStore(catalog: Catalog, store: EntityStore<CatalogItem>) {\r\n    this.catalogItemsStores.set(catalog.id as string, store);\r\n  }\r\n\r\n  /**\r\n   * Clear all catalog items stores\r\n   */\r\n  clearCatalogItemsStores() {\r\n    this.catalogItemsStores.clear();\r\n  }\r\n}\r\n","<igo-catalog-browser\r\n  *ngIf=\"store$ | async as store\"\r\n  [catalog]=\"catalog\"\r\n  [store]=\"store\"\r\n  [map]=\"map\"\r\n  [toggleCollapsedGroup]=\"toggleCollapsedGroup\"\r\n>\r\n</igo-catalog-browser>\r\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { EntityRecord, EntityStore, ToolComponent } from '@igo2/common';\nimport { AuthService } from '@igo2/auth';\n\nimport {\n  IgoMap,\n  Catalog,\n  CatalogItem,\n  CatalogItemState,\n  CatalogService\n} from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { CatalogState } from '../catalog.state';\n\n/**\n * Tool to browse a catalog's groups and layers and display them to a map.\n */\n@ToolComponent({\n  name: 'catalogBrowser',\n  title: 'igo.integration.tools.catalog',\n  icon: 'photo-browser',\n  parent: 'catalog'\n})\n@Component({\n  selector: 'igo-catalog-browser-tool',\n  templateUrl: './catalog-browser-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserToolComponent implements OnInit, OnDestroy {\n  catalog: Catalog;\n\n  /**\n   * Store that contains the catalog items\n   * @internal\n   */\n  store$ = new BehaviorSubject<EntityStore<CatalogItem, CatalogItemState>>(\n    undefined\n  );\n\n  /**\n   * Subscription to the selected catalog\n   */\n  private catalog$$: Subscription;\n\n  /**\n   * Subscription for authentication\n   */\n  private authenticate$$: Subscription;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  /**\n   * Map to add layers to\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private catalogService: CatalogService,\n    private catalogState: CatalogState,\n    private mapState: MapState,\n    private authService: AuthService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const catalogStore = this.catalogState.catalogStore;\n    this.catalog$$ = catalogStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Catalog>) => record.state.selected === true\n      )\n      .subscribe((record: EntityRecord<Catalog>) => {\n        if (record && record.entity) {\n          const catalog = record.entity;\n          this.catalog = catalog;\n        }\n      });\n\n    this.authenticate$$ = this.authService.authenticate$.subscribe(() => {\n      this.loadCatalogItems(this.catalog);\n    });\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.catalog$$.unsubscribe();\n    this.authenticate$$.unsubscribe();\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog) {\n    let store = this.catalogState.getCatalogItemsStore(catalog);\n    if (store !== undefined) {\n      this.store$.next(store);\n      return;\n    }\n\n    store = new EntityStore<CatalogItem>([]);\n    this.catalogState.setCatalogItemsStore(catalog, store);\n    this.catalogService\n      .loadCatalogItems(catalog)\n      .pipe(take(1))\n      .subscribe((items: CatalogItem[]) => {\n        store.load(items);\n        this.store$.next(store);\n      });\n  }\n}\n","import {\r\n  Component,\r\n  OnInit,\r\n  ChangeDetectionStrategy,\r\n  Input\r\n} from '@angular/core';\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { Catalog, CatalogService } from '@igo2/geo';\r\nimport { StorageService } from '@igo2/core';\r\n\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { CatalogState } from '../catalog.state';\r\n\r\n/**\r\n * Tool to browse the list of available catalogs.\r\n */\r\n@ToolComponent({\r\n  name: 'catalog',\r\n  title: 'igo.integration.tools.catalog',\r\n  icon: 'layers-plus'\r\n})\r\n@Component({\r\n  selector: 'igo-catalog-library-tool',\r\n  templateUrl: './catalog-library-tool.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibraryToolComponent implements OnInit {\r\n  /**\r\n   * Store that contains the catalogs\r\n   * @internal\r\n   */\r\n  get store(): EntityStore<Catalog> {\r\n    return this.catalogState.catalogStore;\r\n  }\r\n\r\n  /**\r\n   * Determine if the form to add a catalog is allowed\r\n   */\r\n  @Input() addCatalogAllowed: boolean = false;\r\n\r\n  /**\r\n   * List of predefined catalogs\r\n   */\r\n  @Input() predefinedCatalogs: Catalog[] = [];\r\n\r\n  constructor(\r\n    private catalogService: CatalogService,\r\n    private catalogState: CatalogState,\r\n    private toolState: ToolState,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    if (this.store.count === 0) {\r\n      this.loadCatalogs();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\r\n   * @internal\r\n   * @param event Select event\r\n   */\r\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }) {\r\n    if (event.selected === false) {\r\n      return;\r\n    }\r\n    this.toolState.toolbox.activateTool('catalogBrowser');\r\n  }\r\n\r\n  /**\r\n   * Get all the available catalogs from the CatalogService and\r\n   * load them into the store.\r\n   */\r\n  private loadCatalogs() {\r\n    this.catalogService\r\n      .loadCatalogs()\r\n      .pipe(take(1))\r\n      .subscribe((catalogs: Catalog[]) => {\r\n        this.store.clear();\r\n        this.store.load(\r\n          catalogs.concat(\r\n            (this.storageService.get('addedCatalogs') || []) as Catalog[]\r\n          )\r\n        );\r\n      });\r\n  }\r\n}\r\n","<igo-catalog-library\r\n  [predefinedCatalogs]=\"predefinedCatalogs\"\r\n  [addCatalogAllowed]=\"addCatalogAllowed\"\r\n  [store]=\"store\"\r\n  (catalogSelectChange)=\"onCatalogSelectChange($event)\"\r\n>\r\n</igo-catalog-library>\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  AnyLayerOptions,\r\n  StopsStore,\r\n  StopsFeatureStore,\r\n  RoutesFeatureStore,\r\n  StepFeatureStore\r\n} from '@igo2/geo';\r\nimport { Subject } from 'rxjs';\r\nimport { MapState } from '../map/map.state';\r\n\r\n/**\r\n * Service that holds the state of the direction module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DirectionState {\r\n  public zoomToActiveRoute$: Subject<void> = new Subject();\r\n\r\n  /**\r\n   * Store that holds the stop\r\n   */\r\n  public stopsStore: StopsStore = new StopsStore([]);\r\n\r\n  /**\r\n   * Store that holds the driving stops as feature\r\n   */\r\n  public stopsFeatureStore: StopsFeatureStore;\r\n\r\n  /**\r\n   * Store that holds the driving route as feature\r\n   */\r\n  public routesFeatureStore: RoutesFeatureStore;\r\n\r\n  public stepFeatureStore: StepFeatureStore;\r\n\r\n  public debounceTime: number = 200;\r\n\r\n  constructor(private mapState: MapState) {\r\n    this.stopsFeatureStore = new StopsFeatureStore([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.routesFeatureStore = new RoutesFeatureStore([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.stepFeatureStore = new StepFeatureStore([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.mapState.map.ol.once('rendercomplete', () => {\r\n      this.stopsFeatureStore.empty$.subscribe((empty) => {\r\n        if (this.stopsFeatureStore.layer?.options) {\r\n          (\r\n            this.stopsFeatureStore.layer.options as AnyLayerOptions\r\n          ).showInLayerList = !empty;\r\n        }\r\n      });\r\n      this.routesFeatureStore.empty$.subscribe((empty) => {\r\n        if (this.routesFeatureStore.layer?.options) {\r\n          (\r\n            this.routesFeatureStore.layer.options as AnyLayerOptions\r\n          ).showInLayerList = !empty;\r\n        }\r\n      });\r\n    });\r\n\r\n    this.mapState.map.layers$.subscribe(() => {\r\n      if (!this.mapState.map.getLayerById('igo-direction-stops-layer')) {\r\n        this.stopsStore.deleteMany(this.stopsStore.all());\r\n        this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all()); // not necessary\r\n      }\r\n      if (!this.mapState.map.getLayerById('igo-direction-route-layer')) {\r\n        this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { AuthService } from '@igo2/auth';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  LanguageService,\r\n  MessageService,\r\n  StorageScope,\r\n  StorageService\r\n} from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  RoutesFeatureStore,\r\n  StopsFeatureStore,\r\n  StopsStore,\r\n  StepFeatureStore\r\n} from '@igo2/geo';\r\nimport { Subject } from 'rxjs';\r\nimport { ContextState } from '../../context/context.state';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport { DirectionState } from '../directions.state';\r\n\r\n@ToolComponent({\r\n  name: 'directions',\r\n  title: 'igo.integration.tools.directions',\r\n  icon: 'directions'\r\n})\r\n@Component({\r\n  selector: 'igo-directions-tool',\r\n  templateUrl: './directions-tool.component.html'\r\n})\r\nexport class DirectionsToolComponent implements OnInit {\r\n  public currentContextUri: string;\r\n  /**\r\n   * stops\r\n   * @internal\r\n   */\r\n  get stopsStore(): StopsStore {\r\n    return this.directionState.stopsStore;\r\n  }\r\n\r\n  get debounceTime(): number {\r\n    return this.directionState.debounceTime;\r\n  }\r\n\r\n  /**\r\n   * stops\r\n   * @internal\r\n   */\r\n  get stopsFeatureStore(): StopsFeatureStore {\r\n    return this.directionState.stopsFeatureStore;\r\n  }\r\n\r\n  /**\r\n   * routes\r\n   * @internal\r\n   */\r\n  get routesFeatureStore(): RoutesFeatureStore {\r\n    return this.directionState.routesFeatureStore;\r\n  }\r\n\r\n  /**\r\n   * step store\r\n   * @internal\r\n   */\r\n  get stepFeatureStore(): StepFeatureStore {\r\n    return this.directionState.stepFeatureStore;\r\n  }\r\n\r\n  /**\r\n   * step store\r\n   * @internal\r\n   */\r\n  get zoomToActiveRoute$(): Subject<void> {\r\n    return this.directionState.zoomToActiveRoute$;\r\n  }\r\n\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    private directionState: DirectionState,\r\n    private mapState: MapState,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private storageService: StorageService,\r\n    public contextState: ContextState,\r\n    private authService: AuthService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    const warningShown = this.storageService.get(\r\n      'direction.warning.shown'\r\n    ) as boolean;\r\n    if (!warningShown) {\r\n      this.messageService.info(\r\n        'igo.integration.directions.warning.message',\r\n        'igo.integration.directions.warning.title',\r\n        { timeOut: 20000 }\r\n      );\r\n      this.storageService.set(\r\n        'direction.warning.shown',\r\n        true,\r\n        StorageScope.SESSION\r\n      );\r\n    }\r\n    this.contextState.context$.subscribe((c) => {\r\n      if (!this.authService.authenticated) {\r\n        this.currentContextUri = c.uri;\r\n      }\r\n    });\r\n  }\r\n}\r\n","<igo-directions\r\n  [contextUri]=\"currentContextUri\"\r\n  [debounceTime]=\"debounceTime\"\r\n  [stopsStore]=\"stopsStore\"\r\n  [stopsFeatureStore]=\"stopsFeatureStore\"\r\n  [stepFeatureStore]=\"stepFeatureStore\"\r\n  [routesFeatureStore]=\"routesFeatureStore\"\r\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\r\n>\r\n</igo-directions>\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  DrawControl,\r\n  FeatureStore,\r\n  FeatureWithDraw,\r\n  VectorLayer\r\n} from '@igo2/geo';\r\nimport { MapState } from '../map/map.state';\r\n\r\n/**\r\n * Service that holds the state of the measure module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DrawState {\r\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\r\n  public layersID: string[] = [];\r\n  public drawControls: [string, DrawControl][] = [];\r\n  public activeDrawingLayer: VectorLayer;\r\n\r\n  constructor(private mapState: MapState) {\r\n    this.mapState.map.layers$.subscribe(() => {\r\n      this.layersID.forEach((layerId) => {\r\n        if (!this.mapState.map.getLayerById(layerId)) {\r\n          let deletedStore = this.stores.find(\r\n            (store) => store.layer.id === layerId\r\n          );\r\n          deletedStore.deleteMany(deletedStore.all());\r\n          this.stores.splice(this.stores.indexOf(deletedStore, 0), 1);\r\n          this.layersID.splice(this.layersID.indexOf(layerId, 0), 1);\r\n          let drawControlIndex = this.drawControls.findIndex(\r\n            (dc) => dc[0] === layerId\r\n          );\r\n          this.drawControls.splice(drawControlIndex, 1);\r\n        }\r\n      });\r\n    });\r\n    for (let store of this.stores) {\r\n      store = new FeatureStore<FeatureWithDraw>([], { map: this.mapState.map });\r\n    }\r\n  }\r\n}\r\n","import { Component, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  FeatureStore,\r\n  IgoMap,\r\n  DrawControl,\r\n  FeatureWithDraw,\r\n  VectorLayer\r\n} from '@igo2/geo';\r\nimport { MapState } from '../../map/map.state';\r\nimport { DrawState } from '../draw.state';\r\n\r\n/**\r\n * Tool to measure lengths and areas\r\n */\r\n@ToolComponent({\r\n  name: 'draw',\r\n  title: 'igo.integration.tools.draw',\r\n  icon: 'draw'\r\n})\r\n@Component({\r\n  selector: 'igo-drawing-tool',\r\n  templateUrl: './drawing-tool.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class DrawingToolComponent {\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get stores(): FeatureStore<FeatureWithDraw>[] {\r\n    return this.drawState.stores;\r\n  }\r\n\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layersID(): string[] {\r\n    return this.drawState.layersID;\r\n  }\r\n\r\n  get drawControls(): [string, DrawControl][] {\r\n    return this.drawState.drawControls;\r\n  }\r\n  set drawControls(dc: [string, DrawControl][]) {\r\n    this.drawState.drawControls = dc;\r\n  }\r\n\r\n  get activeDrawingLayer(): VectorLayer {\r\n    return this.drawState.activeDrawingLayer;\r\n  }\r\n  set activeDrawingLayer(value: VectorLayer) {\r\n    this.drawState.activeDrawingLayer = value;\r\n  }\r\n\r\n  public addLayersID(layerID: string) {\r\n    this.layersID.push(layerID);\r\n  }\r\n\r\n  public addDrawControls(dc: [string, DrawControl][]) {\r\n    this.drawControls = dc;\r\n  }\r\n\r\n  constructor(\r\n    private drawState: DrawState,\r\n    private mapState: MapState\r\n  ) {}\r\n}\r\n","<igo-draw\r\n  [stores]=\"stores\"\r\n  [map]=\"map\"\r\n  (layersIDEvent)=\"addLayersID($event)\"\r\n  [activeDrawingLayer]=\"activeDrawingLayer\"\r\n  [drawControls]=\"drawControls\"\r\n  (drawControlsEvent)=\"addDrawControls($event)\"\r\n  (activeLayerChange)=\"activeDrawingLayer = $event\"\r\n>\r\n</igo-draw>\r\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\n@ToolComponent({\n  name: 'ogcFilter',\n  title: 'igo.integration.tools.ogcFilter',\n  icon: 'filter'\n})\n@Component({\n  selector: 'igo-ogc-filter-tool',\n  templateUrl: './ogc-filter-tool.component.html'\n})\nexport class OgcFilterToolComponent {\n  constructor() {}\n}\n","<igo-ogc-filterable-list igoOgcFilterableListBinding></igo-ogc-filterable-list>\r\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translateX(100%)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","import { Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { MapState } from '../../map/map.state';\r\nimport { Layer, IgoMap } from '@igo2/geo';\r\n\r\nimport { toolSlideInOut } from './active-ogc-filter-tool.animation';\r\n\r\n@ToolComponent({\r\n  name: 'activeOgcFilter',\r\n  title: 'igo.integration.tools.ogcFilter',\r\n  icon: 'filter',\r\n  parent: 'mapTools'\r\n})\r\n@Component({\r\n  selector: 'igo-active-ogc-filter-tool',\r\n  templateUrl: './active-ogc-filter-tool.component.html',\r\n  animations: [toolSlideInOut()]\r\n})\r\nexport class ActiveOgcFilterToolComponent {\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layer(): Layer {\r\n    for (const lay of this.map.layers) {\r\n      if (lay.options.active === true) {\r\n        return lay;\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  public animate = 'enter';\r\n\r\n  constructor(public mapState: MapState) {}\r\n}\r\n","<igo-ogc-filterable-item\r\n  [map]=\"map\"\r\n  [layer]=\"layer\"\r\n  [header]=\"false\"\r\n  [@toolSlideInOut]=\"animate\"\r\n>\r\n</igo-ogc-filterable-item>\r\n","<igo-panel>\r\n  <igo-spatial-filter-type\r\n    [store]=\"spatialListStore\"\r\n    [selectedQueryType]=\"queryType\"\r\n    [zone]=\"zone\"\r\n    [layers]=\"activeLayers\"\r\n    (eventType)=\"getOutputType($event)\"\r\n    (eventQueryType)=\"getOutputQueryType($event)\"\r\n    (zoneChange)=\"onZoneChange($event)\"\r\n    (zoneWithBufferChange)=\"onZoneChange($event, true)\"\r\n    (bufferChange)=\"buffer = $event\"\r\n    (measureUnitChange)=\"measureUnit = $event\"\r\n  >\r\n  </igo-spatial-filter-type>\r\n\r\n  <igo-spatial-filter-item\r\n    [type]=\"type\"\r\n    [queryType]=\"queryType\"\r\n    [map]=\"map\"\r\n    [zone]=\"zone\"\r\n    [loading]=\"loading\"\r\n    [store]=\"store\"\r\n    [layers]=\"activeLayers\"\r\n    [allLayers]=\"layers\"\r\n    [thematicLength]=\"thematicLength\"\r\n    (radiusEvent)=\"buffer = $event\"\r\n    (bufferEvent)=\"buffer = $event\"\r\n    (measureUnitChange)=\"measureUnit = $event\"\r\n    (freehandControl)=\"freehandDrawIsActive = $event\"\r\n    (drawZoneEvent)=\"zone = $event\"\r\n    (zoneWithBufferChange)=\"onZoneChange($event, true)\"\r\n    (itemTypeChange)=\"itemType = $event\"\r\n    (thematicChange)=\"thematics = $event\"\r\n    (toggleSearch)=\"getOutputToggleSearch()\"\r\n    (clearButtonEvent)=\"clearMap()\"\r\n    (clearSearchEvent)=\"getOutputClearSearch()\"\r\n    (export)=\"activateExportTool()\"\r\n    (openWorkspace)=\"activateWorkspace()\"\r\n    (entityChange)=\"activateWorkspace($event)\"\r\n  >\r\n  </igo-spatial-filter-item>\r\n</igo-panel>\r\n\r\n<igo-panel>\r\n  <ng-container *ngIf=\"selectedFeature$ | async as feature\">\r\n    <igo-feature-details [feature]=\"feature\"></igo-feature-details>\r\n  </ng-container>\r\n</igo-panel>\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\nimport { Observable, forkJoin, Subject } from 'rxjs';\r\nimport { tap, take, takeUntil } from 'rxjs/operators';\r\n\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  Feature,\r\n  moveToOlFeatures,\r\n  FeatureMotion,\r\n  ClusterDataSource,\r\n  featureToOl,\r\n  DataSource,\r\n  QueryableDataSourceOptions,\r\n  SpatialFilterService,\r\n  SpatialFilterType,\r\n  SpatialFilterItemType,\r\n  SpatialFilterQueryType,\r\n  SpatialFilterThematic,\r\n  Layer,\r\n  VectorLayer,\r\n  createOverlayMarkerStyle,\r\n  ExportOptions,\r\n  MeasureLengthUnit\r\n} from '@igo2/geo';\r\nimport {\r\n  EntityStore,\r\n  EntityStoreWithStrategy,\r\n  ToolComponent\r\n} from '@igo2/common';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport olSourceVector from 'ol/source/Vector';\r\nimport olSourceCluster from 'ol/source/Cluster';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { MapState } from '../../map/map.state';\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from './../../import-export/import-export.state';\r\nimport * as olstyle from 'ol/style';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { WorkspaceState } from '../../workspace/workspace.state';\r\nimport { EventsKey } from 'ol/events';\r\n\r\n/**\r\n * Tool to apply spatial filter\r\n */\r\n@ToolComponent({\r\n  name: 'spatialFilter',\r\n  title: 'igo.integration.tools.spatialFilter',\r\n  icon: 'selection-marker'\r\n})\r\n/**\r\n * Spatial Filter Type\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-tool',\r\n  templateUrl: './spatial-filter-tool.component.html',\r\n  styleUrls: ['./spatial-filter-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterToolComponent implements OnInit, OnDestroy {\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  @Input() type: SpatialFilterType;\r\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\r\n  @Input() freehandDrawIsActive: boolean;\r\n\r\n  public layers: Layer[] = [];\r\n  public activeLayers: Layer[] = [];\r\n\r\n  public queryType: SpatialFilterQueryType;\r\n  public thematics: SpatialFilterThematic[];\r\n  public zone: Feature;\r\n  public zoneWithBuffer: Feature;\r\n  public buffer = 0;\r\n\r\n  public iterator = 1;\r\n\r\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  public store: EntityStoreWithStrategy<Feature> =\r\n    new EntityStoreWithStrategy<Feature>([]); // Store to print results at the end\r\n\r\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\r\n\r\n  public loading = false;\r\n\r\n  public thematicLength = 0;\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n  private unsubscribe$ = new Subject<void>();\r\n\r\n  private moveendKey: EventsKey;\r\n\r\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\r\n\r\n  constructor(\r\n    private matIconRegistry: MatIconRegistry,\r\n    private spatialFilterService: SpatialFilterService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mapState: MapState,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService,\r\n    private importExportState: ImportExportState,\r\n    private toolState: ToolState,\r\n    private workspaceState: WorkspaceState,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    for (const layer of this.map.layers) {\r\n      if (\r\n        layer.title &&\r\n        layer.title.includes(\r\n          this.languageService.translate.instant(\r\n            'igo.geo.spatialFilter.spatialFilter'\r\n          )\r\n        )\r\n      ) {\r\n        this.layers.push(layer);\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribe$.next();\r\n    this.unsubscribe$.complete();\r\n  }\r\n\r\n  getOutputType(event: SpatialFilterType) {\r\n    this.type = event;\r\n    this.queryType = undefined;\r\n  }\r\n\r\n  getOutputQueryType(event: SpatialFilterQueryType) {\r\n    this.queryType = event;\r\n    if (this.queryType) {\r\n      this.loadFilterList();\r\n    }\r\n  }\r\n\r\n  activateExportTool() {\r\n    const ids = [];\r\n    const re = new RegExp('^Zone \\\\d+');\r\n    for (const layer of this.layers) {\r\n      if (!layer.title.match(re)) {\r\n        ids.push(layer.id);\r\n      }\r\n    }\r\n    this.importExportState.setMode(ImportExportMode.export);\r\n    this.importExportState.setsExportOptions({ layers: ids } as ExportOptions);\r\n    this.toolState.toolbox.activateTool('importExport');\r\n  }\r\n\r\n  activateWorkspace(record?) {\r\n    let layerToOpenWks;\r\n    this.workspaceState.store.entities$\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe(() => {\r\n        if (\r\n          !record &&\r\n          this.activeLayers.length &&\r\n          this.workspaceState.store.all().length > 1\r\n        ) {\r\n          if (this.itemType === SpatialFilterItemType.Thematics) {\r\n            for (const thematic of this.thematics) {\r\n              if (!thematic.zeroResults) {\r\n                layerToOpenWks = this.activeLayers.find((layer) =>\r\n                  layer.title.includes(\r\n                    thematic.name + ' ' + this.iterator.toString()\r\n                  )\r\n                );\r\n                break;\r\n              }\r\n            }\r\n          } else {\r\n            const title = 'Adresses ' + this.iterator.toString();\r\n            this.activeLayers.forEach((layer) => {\r\n              if (layer.title.includes(title)) {\r\n                layerToOpenWks = layer;\r\n              }\r\n            });\r\n          }\r\n\r\n          if (layerToOpenWks) {\r\n            this.workspaceState.workspacePanelExpanded = true;\r\n            this.workspaceState.setActiveWorkspaceById(layerToOpenWks.id);\r\n          }\r\n        } else if (\r\n          record &&\r\n          this.activeLayers.length &&\r\n          this.workspaceState.store.all().length > 1\r\n        ) {\r\n          this.selectWorkspaceEntity(record);\r\n          this.moveendKey = this.map.ol.on('moveend', () => {\r\n            this.selectWorkspaceEntity(record);\r\n          });\r\n        }\r\n      });\r\n  }\r\n\r\n  private selectWorkspaceEntity(record) {\r\n    this.workspaceState.store.all().forEach((workspace) => {\r\n      workspace.entityStore.state.updateAll({ selected: false });\r\n      if (workspace.title.includes(record.added[0].meta.title)) {\r\n        this.workspaceState.setActiveWorkspaceById(workspace.id);\r\n        workspace.entityStore.state.updateMany(record.added, {\r\n          selected: true\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  private loadFilterList() {\r\n    this.spatialFilterService\r\n      .loadFilterList(this.queryType)\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe((features: Feature[]) => {\r\n        features.sort((a, b) => {\r\n          if (a.properties.nom < b.properties.nom) {\r\n            return -1;\r\n          }\r\n          if (a.properties.nom > b.properties.nom) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n        this.spatialListStore.clear();\r\n        this.spatialListStore.load(features);\r\n      });\r\n  }\r\n\r\n  getOutputToggleSearch() {\r\n    this.loadThematics();\r\n  }\r\n\r\n  getOutputClearSearch() {\r\n    this.zone = undefined;\r\n    this.queryType = undefined;\r\n  }\r\n\r\n  clearMap() {\r\n    this.map.removeLayers(this.layers);\r\n    this.layers = [];\r\n    this.activeLayers = [];\r\n    this.thematicLength = 0;\r\n    this.iterator = 1;\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      this.zone = undefined;\r\n      this.queryType = undefined;\r\n    }\r\n  }\r\n\r\n  private loadThematics() {\r\n    this.loading = true;\r\n    let zeroResults = true;\r\n    let thematics;\r\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\r\n      this.tryAddFeaturesToMap([this.zone]);\r\n    }\r\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\r\n      const theme: SpatialFilterThematic = {\r\n        name: ''\r\n      };\r\n      thematics = [theme];\r\n    } else {\r\n      thematics = this.thematics;\r\n    }\r\n    if (\r\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n      this.type !== SpatialFilterType.Point\r\n    ) {\r\n      this.buffer = this.buffer * 1000;\r\n    }\r\n    if (this.type === SpatialFilterType.Polygon) {\r\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\r\n    }\r\n\r\n    const observables$: Observable<Feature[]>[] = [];\r\n    thematics.forEach((thematic) => {\r\n      observables$.push(\r\n        this.spatialFilterService\r\n          .loadFilterItem(\r\n            this.zone,\r\n            this.itemType,\r\n            this.queryType,\r\n            thematic,\r\n            this.buffer\r\n          )\r\n          .pipe(\r\n            tap((features: Feature[]) => {\r\n              this.store.insertMany(features);\r\n              const featuresPoint: Feature[] = [];\r\n              const featuresLinePoly: Feature[] = [];\r\n              let idPoint;\r\n              let idLinePoly;\r\n              features.forEach((feature) => {\r\n                if (feature.geometry.type === 'Point') {\r\n                  feature.properties.longitude =\r\n                    feature.geometry.coordinates[0];\r\n                  feature.properties.latitude = feature.geometry.coordinates[1];\r\n                  featuresPoint.push(feature);\r\n                  idPoint = feature.meta.id;\r\n                } else {\r\n                  featuresLinePoly.push(feature);\r\n                  idLinePoly = feature.meta.id;\r\n                }\r\n              });\r\n\r\n              this.tryAddPointToMap(featuresPoint, idPoint);\r\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\r\n              if (features.length) {\r\n                zeroResults = false;\r\n                this.thematicLength += 1;\r\n                thematic.zeroResults = false;\r\n                this.cdRef.detectChanges();\r\n              } else {\r\n                thematic.zeroResults = true;\r\n              }\r\n\r\n              if (features.length >= 10000) {\r\n                this.messageService.alert(\r\n                  'igo.geo.spatialFilter.maxSizeAlert',\r\n                  'igo.geo.spatialFilter.warning',\r\n                  { timeOut: 10000 }\r\n                );\r\n              }\r\n            })\r\n          )\r\n      );\r\n    });\r\n\r\n    forkJoin(observables$)\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe(() => {\r\n        this.loading = false;\r\n        if (zeroResults) {\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.zeroResults',\r\n            'igo.geo.spatialFilter.warning',\r\n            { timeOut: 10000 }\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  onZoneChange(feature: Feature, buffer?: boolean) {\r\n    this.zone = feature;\r\n    if (feature) {\r\n      buffer\r\n        ? this.tryAddFeaturesToMap([feature], true)\r\n        : this.tryAddFeaturesToMap([feature]);\r\n      this.zoomToFeatureExtent(feature);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add zone feature to the map overlay\r\n   */\r\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\r\n    let i = 1;\r\n    for (const feature of features) {\r\n      if (this.type === SpatialFilterType.Predefined) {\r\n        for (const layer of this.layers) {\r\n          if (\r\n            layer.options._internal &&\r\n            layer.options._internal.code === feature.properties.code &&\r\n            !buffer\r\n          ) {\r\n            if (!layer.title?.startsWith('Zone')) {\r\n              const index = this.layers.indexOf(layer);\r\n              this.layers.splice(index, 1);\r\n            }\r\n            return;\r\n          }\r\n          if (layer.title?.startsWith('Zone')) {\r\n            this.activeLayers = [];\r\n            const index = this.layers.indexOf(layer);\r\n            this.layers.splice(index, 1);\r\n            this.map.removeLayer(layer);\r\n          }\r\n        }\r\n      } else {\r\n        if (buffer) {\r\n          for (const layer of this.activeLayers) {\r\n            if (\r\n              this.activeLayers.length === 1 &&\r\n              layer.title?.startsWith('Zone')\r\n            ) {\r\n              const index = this.layers.indexOf(layer);\r\n              this.layers.splice(index, 1);\r\n              this.map.removeLayer(layer);\r\n            }\r\n          }\r\n        }\r\n        this.activeLayers = [];\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith('Zone')) {\r\n          i++;\r\n        }\r\n      }\r\n      this.defaultStyle = (_feature, resolution) => {\r\n        const coordinates = (features[0] as any).coordinates;\r\n        return new olstyle.Style({\r\n          image: new olstyle.Circle({\r\n            radius: coordinates\r\n              ? this.buffer /\r\n                Math.cos((Math.PI / 180) * coordinates[1]) /\r\n                resolution\r\n              : undefined,\r\n            fill: new olstyle.Fill({\r\n              color: 'rgba(200, 200, 20, 0.2)'\r\n            }),\r\n            stroke: new olstyle.Stroke({\r\n              width: 1,\r\n              color: 'orange'\r\n            })\r\n          }),\r\n          stroke: new olstyle.Stroke({\r\n            width: 1,\r\n            color: 'orange'\r\n          }),\r\n          fill: new olstyle.Fill({\r\n            color: 'rgba(200, 200, 20, 0.2)'\r\n          })\r\n        });\r\n      };\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: ('Zone ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            workspace: { enabled: true },\r\n            _internal: {\r\n              code:\r\n                this.type === SpatialFilterType.Predefined\r\n                  ? feature.properties.code\r\n                  : undefined\r\n            },\r\n            source: dataSource,\r\n            visible: true\r\n          }) as VectorLayer;\r\n          const featuresOl = features.map((f) => {\r\n            return featureToOl(f, this.map.projection);\r\n          });\r\n          if (this.type !== SpatialFilterType.Predefined) {\r\n            const type =\r\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\r\n            featuresOl[0].set('nom', 'Zone', true);\r\n            featuresOl[0].set('type', type, true);\r\n          }\r\n          const ol = dataSource.ol as\r\n            | olSourceVector<OlGeometry>\r\n            | olSourceCluster;\r\n          ol.addFeatures(featuresOl);\r\n          olLayer.ol.setStyle(this.defaultStyle);\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.activeLayers.push(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add point features to the map\r\n   * Necessary to create clusters\r\n   */\r\n  private tryAddPointToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'cluster',\r\n          id,\r\n          queryable: true,\r\n          distance: 120,\r\n          meta: {\r\n            title: 'Cluster'\r\n          }\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: ClusterDataSource) => {\r\n          const icon = features[0].meta.icon;\r\n          let style: olstyle.Style;\r\n          if (!icon) {\r\n            style = createOverlayMarkerStyle();\r\n          } else {\r\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\r\n          }\r\n\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            source: dataSource,\r\n            visible: true,\r\n            style\r\n          });\r\n\r\n          const featuresOl = features.map((feature) => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceCluster;\r\n          ol.getSource().addFeatures(featuresOl);\r\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.layers.find((layer) => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.iterator = i;\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.pushLayer(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  private createSvgIcon(icon): olstyle.Style {\r\n    let style: olstyle.Style;\r\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe((svgObj) => {\r\n      const xmlSerializer = new XMLSerializer();\r\n      svgObj.setAttribute('width', '30');\r\n      svgObj.setAttribute('height', '30');\r\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\r\n      svgObj.setAttribute('stroke', 'white');\r\n      const svg = xmlSerializer.serializeToString(svgObj);\r\n      style = new olstyle.Style({\r\n        image: new olstyle.Icon({\r\n          src: 'data:image/svg+xml;utf8,' + svg\r\n        })\r\n      });\r\n    });\r\n    return style;\r\n  }\r\n  /**\r\n   * Try to add line or polygon features to the map\r\n   */\r\n  private tryAddLayerToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          id,\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            source: dataSource,\r\n            visible: true\r\n          });\r\n          const featuresOl = features.map((feature) => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceVector<OlGeometry>;\r\n          ol.addFeatures(featuresOl);\r\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.layers.find((layer) => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.pushLayer(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  zoomToFeatureExtent(feature) {\r\n    if (feature) {\r\n      const olFeature = this.format.readFeature(feature, {\r\n        dataProjection: feature.projection,\r\n        featureProjection: this.map.projection\r\n      });\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        [olFeature],\r\n        FeatureMotion.Zoom\r\n      );\r\n    }\r\n  }\r\n\r\n  pushLayer(layer) {\r\n    for (const lay of this.activeLayers) {\r\n      if (lay.id === layer.id) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.activeLayers.push(layer);\r\n  }\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { TimeFilterListComponent } from './time-filter-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoTimeFilterListBinding]'\r\n})\r\nexport class TimeFilterListBindingDirective implements OnInit, OnDestroy {\r\n  private component: TimeFilterListComponent;\r\n  private layers$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: TimeFilterListComponent,\r\n    private mapService: MapService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    this.component.layers = [];\r\n\r\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\r\n      this.component.layers = layers;\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\n@ToolComponent({\n  name: 'timeFilter',\n  title: 'igo.integration.tools.timeFilter',\n  icon: 'history'\n})\n@Component({\n  selector: 'igo-time-filter-tool',\n  templateUrl: './time-filter-tool.component.html'\n})\nexport class TimeFilterToolComponent {\n  constructor() {}\n}\n","<igo-time-filter-list igoTimeFilterListBinding></igo-time-filter-list>\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translateX(100%)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","import { Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { MapState } from '../../map/map.state';\r\nimport { IgoMap, Layer } from '@igo2/geo';\r\nimport { toolSlideInOut } from './active-time-filter-tool.animation';\r\n\r\n@ToolComponent({\r\n  name: 'activeTimeFilter',\r\n  title: 'igo.integration.tools.timeFilter',\r\n  icon: 'history',\r\n  parent: 'mapTools'\r\n})\r\n@Component({\r\n  selector: 'igo-active-time-filter-tool',\r\n  templateUrl: './active-time-filter-tool.component.html',\r\n  animations: [toolSlideInOut()]\r\n})\r\nexport class ActiveTimeFilterToolComponent {\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layer(): Layer {\r\n    for (const lay of this.map.layers) {\r\n      if (lay.options.active === true) {\r\n        return lay;\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  public animate = 'enter';\r\n\r\n  constructor(public mapState: MapState) {}\r\n}\r\n","<igo-time-filter-item\r\n  [map]=\"map\"\r\n  [layer]=\"layer\"\r\n  [header]=\"false\"\r\n  [@toolSlideInOut]=\"animate\"\r\n>\r\n</igo-time-filter-item>\r\n","<mat-tab-group *ngIf=\"importExportShowBothType\">\r\n  <mat-tab\r\n    [label]=\"'igo.integration.importExportTool.importExportData' | translate\"\r\n  >\r\n    <igo-import-export\r\n      [contextUri]=\"(contextState.context$ | async).uri\"\r\n      [map]=\"map\"\r\n      [selectFirstProj]=\"selectFirstProj\"\r\n      [projectionsLimitations]=\"projectionsLimitations\"\r\n      [store]=\"workspaceStore\"\r\n      [selectedMode]=\"importExportState.selectedMode$ | async\"\r\n      (selectMode)=\"modeChanged($event)\"\r\n      [exportOptions$]=\"importExportState.exportOptions$\"\r\n      (exportOptionsChange)=\"exportOptionsChange($event)\"\r\n    >\r\n    </igo-import-export>\r\n  </mat-tab>\r\n  <mat-tab\r\n    [label]=\"'igo.integration.importExportTool.importExportContext' | translate\"\r\n  >\r\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\r\n  </mat-tab>\r\n</mat-tab-group>\r\n\r\n<igo-import-export\r\n  *ngIf=\"!importExportShowBothType && importExportType === 'layer'\"\r\n  [contextUri]=\"(contextState.context$ | async).uri\"\r\n  [map]=\"map\"\r\n  [store]=\"workspaceStore\"\r\n  [selectedMode]=\"importExportState.selectedMode$ | async\"\r\n  (selectMode)=\"modeChanged($event)\"\r\n  [exportOptions$]=\"importExportState.exportOptions$\"\r\n  (exportOptionsChange)=\"exportOptionsChange($event)\"\r\n>\r\n</igo-import-export>\r\n\r\n<igo-context-import-export\r\n  *ngIf=\"!importExportShowBothType && importExportType === 'context'\"\r\n  [map]=\"map\"\r\n>\r\n</igo-context-import-export>\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  Input\r\n} from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport type { WorkspaceStore } from '@igo2/common';\r\nimport {\r\n  IgoMap,\r\n  ExportOptions,\r\n  ProjectionsLimitationsOptions\r\n} from '@igo2/geo';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState,\r\n  ImportExportType\r\n} from '../import-export.state';\r\nimport { WorkspaceState } from '../../workspace/workspace.state';\r\nimport { ContextState } from '../../context/context.state';\r\n\r\n@ToolComponent({\r\n  name: 'importExport',\r\n  title: 'igo.integration.tools.importExport',\r\n  icon: 'file-move'\r\n})\r\n@Component({\r\n  selector: 'igo-import-export-tool',\r\n  templateUrl: './import-export-tool.component.html',\r\n  styleUrls: ['./import-export-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ImportExportToolComponent implements OnInit {\r\n  @Input() projectionsLimitations: ProjectionsLimitationsOptions;\r\n\r\n  @Input() selectFirstProj: boolean = false;\r\n\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get workspaceStore(): WorkspaceStore {\r\n    return this.workspaceState.store;\r\n  }\r\n\r\n  @Input() importExportType: ImportExportType = ImportExportType.layer;\r\n  @Input() importExportShowBothType: boolean = true;\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    public importExportState: ImportExportState,\r\n    private workspaceState: WorkspaceState,\r\n    public contextState: ContextState\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.selectType();\r\n    this.selectMode();\r\n  }\r\n\r\n  private selectType() {\r\n    if (this.importExportType) {\r\n      this.importExportState.importExportType$.next(this.importExportType);\r\n    }\r\n    const userSelectedType = this.importExportState.importExportType$.value;\r\n    if (userSelectedType !== undefined) {\r\n      this.importExportState.setImportExportType(userSelectedType);\r\n    } else {\r\n      this.importExportState.setImportExportType(ImportExportType.layer);\r\n    }\r\n  }\r\n\r\n  private selectMode() {\r\n    const userSelectedMode = this.importExportState.selectedMode$.value;\r\n    if (userSelectedMode !== undefined) {\r\n      this.importExportState.setMode(userSelectedMode);\r\n    } else {\r\n      this.importExportState.setMode(ImportExportMode.import);\r\n    }\r\n  }\r\n\r\n  public modeChanged(mode: ImportExportMode) {\r\n    this.importExportState.setMode(mode);\r\n  }\r\n\r\n  public exportOptionsChange(exportOptions: ExportOptions) {\r\n    this.importExportState.setsExportOptions(exportOptions);\r\n  }\r\n\r\n  importExportTypeChange(event) {\r\n    this.importExportType = event.value;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { FeatureStore, FeatureWithMeasure } from '@igo2/geo';\r\nimport { MapState } from '../map/map.state';\r\n\r\n/**\r\n * Service that holds the state of the measure module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MeasureState {\r\n  /**\r\n   * Store that holds the measures\r\n   */\r\n  public store: FeatureStore<FeatureWithMeasure>;\r\n\r\n  constructor(private mapState: MapState) {\r\n    this.store = new FeatureStore<FeatureWithMeasure>([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.mapState.map.layers$.subscribe((layers) => {\r\n      if (\r\n        layers.filter((l) => l.id?.startsWith('igo-measures-')).length === 0\r\n      ) {\r\n        this.store.deleteMany(this.store.all());\r\n        this.mapState.map.ol\r\n          .getOverlays()\r\n          .getArray()\r\n          .filter((overlay) =>\r\n            (overlay as any).options.className.includes('igo-map-tooltip')\r\n          )\r\n          .map((overlay) => this.mapState.map.ol.removeOverlay(overlay));\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Component, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { FeatureStore, FeatureWithMeasure, IgoMap } from '@igo2/geo';\r\nimport { MapState } from '../../map/map.state';\r\nimport { MeasureState } from '../measure.state';\r\n\r\n/**\r\n * Tool to measure lengths and areas\r\n */\r\n@ToolComponent({\r\n  name: 'measurer',\r\n  title: 'igo.integration.tools.measurer',\r\n  icon: 'ruler'\r\n})\r\n@Component({\r\n  selector: 'igo-measurer-tool',\r\n  templateUrl: './measurer-tool.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerToolComponent {\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get store(): FeatureStore<FeatureWithMeasure> {\r\n    return this.measureState.store;\r\n  }\r\n\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    private measureState: MeasureState,\r\n    private mapState: MapState\r\n  ) {}\r\n}\r\n","<igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport { IgoMap } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\n\n@ToolComponent({\n  name: 'print',\n  title: 'igo.integration.tools.print',\n  icon: 'printer'\n})\n@Component({\n  selector: 'igo-print-tool',\n  templateUrl: './print-tool.component.html'\n})\nexport class PrintToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(private mapState: MapState) {}\n}\n","<igo-print [map]=\"map\"></igo-print>\n","<div\r\n  *ngIf=\"(!store || store.stateView.empty) && (debouncedEmpty$ | async)\"\r\n  style=\"margin: 10px\"\r\n>\r\n  <section class=\"mat-typography\">\r\n    <h4>\r\n      <strong>{{\r\n        'igo.integration.searchResultsTool.noResults' | translate\r\n      }}</strong>\r\n    </h4>\r\n    <p>\r\n      <strong>{{\r\n        'igo.integration.searchResultsTool.doSearch' | translate\r\n      }}</strong>\r\n    </p>\r\n    <div\r\n      [innerHTML]=\"\r\n        'igo.integration.searchResultsTool.examples' | translate | sanitizeHtml\r\n      \"\r\n    ></div>\r\n  </section>\r\n</div>\r\n\r\n<igo-flexible\r\n  *ngIf=\"(debouncedEmpty$ | async) === false\"\r\n  #topPanel\r\n  initial=\"100%\"\r\n  initialMobile=\"100%\"\r\n  collapsed=\"calc(100% - 58px)\"\r\n  collapsedMobile=\"calc(100% - 58px)\"\r\n  expanded=\"60%\"\r\n  expandedMobile=\"60%\"\r\n  [state]=\"(feature$ | async) ? topPanelState : 'initial'\"\r\n>\r\n  <div class=\"igo-content\">\r\n    <igo-search-results\r\n      [store]=\"store\"\r\n      [showIcons]=\"showIcons\"\r\n      [term]=\"term\"\r\n      [termSplitter]=\"termSplitter\"\r\n      [settingsChange$]=\"settingsChange$\"\r\n      placeholder=\"false\"\r\n      (resultFocus)=\"onResultFocus($event)\"\r\n      (resultSelect)=\"onResultSelect($event)\"\r\n      (resultUnfocus)=\"onResultUnfocus($event)\"\r\n      (resultMouseenter)=\"onResultFocus($event)\"\r\n      (resultMouseleave)=\"onResultUnfocus($event)\"\r\n      (moreResults)=\"onSearch($event)\"\r\n      [map]=\"map\"\r\n    >\r\n      <ng-template #igoSearchItemToolbar let-result=\"result\">\r\n        <igo-search-add-button\r\n          [map]=\"map\"\r\n          [store]=\"store\"\r\n          [stores]=\"stores\"\r\n          [layer]=\"result\"\r\n          [saveSearchResultInLayer]=\"saveSearchResultInLayer\"\r\n        >\r\n        </igo-search-add-button>\r\n      </ng-template>\r\n    </igo-search-results>\r\n  </div>\r\n\r\n  <div igoFlexibleFill class=\"igo-content\">\r\n    <igo-panel\r\n      [title]=\"featureTitle\"\r\n      *ngIf=\"feature$ | async\"\r\n      (click)=\"toggleTopPanel($event)\"\r\n      [cursorPointer]=\"true\"\r\n    >\r\n      <button\r\n        mat-icon-button\r\n        panelLeftButton\r\n        class=\"igo-icon-button\"\r\n        (click)=\"toggleTopPanel()\"\r\n      >\r\n        <mat-icon\r\n          [svgIcon]=\"\r\n            (topPanelState$ | async) === 'collapsed' ? 'arrow-up' : 'arrow-down'\r\n          \"\r\n        ></mat-icon>\r\n      </button>\r\n\r\n      <button\r\n        *ngIf=\"feature.geometry\"\r\n        mat-icon-button\r\n        panelRightButton\r\n        class=\"igo-icon-button\"\r\n        [matTooltip]=\"\r\n          ((isSelectedResultOutOfView$ | async)\r\n            ? 'igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView'\r\n            : 'igo.integration.searchResultsTool.zoomOnFeatureTooltip'\r\n          ) | translate\r\n        \"\r\n        matTooltipShowDelay=\"500\"\r\n        (click)=\"zoomToFeatureExtent()\"\r\n      >\r\n        <mat-icon\r\n          aria-hidden=\"false\"\r\n          [matBadge]=\"(isSelectedResultOutOfView$ | async) ? '!' : ''\"\r\n          matBadgeColor=\"accent\"\r\n          matBadgeSize=\"small\"\r\n          [matBadgeHidden]=\"(isSelectedResultOutOfView$ | async) === false\"\r\n          svgIcon=\"magnify-plus-outline\"\r\n        ></mat-icon>\r\n      </button>\r\n\r\n      <igo-feature-details\r\n        igoFeatureDetailsDirective\r\n        [feature]=\"feature$ | async\"\r\n        [map]=\"map\"\r\n        [toolbox]=\"toolState.toolbox\"\r\n        (routingEvent)=\"getRoute()\"\r\n      >\r\n      </igo-feature-details>\r\n    </igo-panel>\r\n  </div>\r\n</igo-flexible>\r\n","import {\r\n  Component,\r\n  ChangeDetectionStrategy,\r\n  Input,\r\n  OnInit,\r\n  ElementRef,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { Observable, BehaviorSubject, Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime, map } from 'rxjs/operators';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport olFeature from 'ol/Feature';\r\nimport olPoint from 'ol/geom/Point';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport pointOnFeature from '@turf/point-on-feature';\r\nimport * as olProj from 'ol/proj';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport {\r\n  EntityStore,\r\n  ToolComponent,\r\n  FlexibleState,\r\n  getEntityTitle,\r\n  FlexibleComponent,\r\n  EntityState\r\n} from '@igo2/common';\r\n\r\nimport {\r\n  FEATURE,\r\n  Feature,\r\n  FeatureMotion,\r\n  SearchResult,\r\n  IgoMap,\r\n  moveToOlFeatures,\r\n  Research,\r\n  featuresAreTooDeepInView,\r\n  featureToOl,\r\n  featureFromOl,\r\n  getCommonVectorStyle,\r\n  getCommonVectorSelectedStyle,\r\n  computeOlFeaturesExtent,\r\n  featuresAreOutOfView,\r\n  roundCoordTo,\r\n  FeatureStore\r\n} from '@igo2/geo';\r\n\r\nimport { MapState } from '../../map/map.state';\r\n\r\nimport { SearchState } from '../search.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { DirectionState } from '../../directions/directions.state';\r\n\r\n/**\r\n * Tool to browse the search results\r\n */\r\n@ToolComponent({\r\n  name: 'searchResults',\r\n  title: 'igo.integration.tools.searchResults',\r\n  icon: 'magnify'\r\n})\r\n@Component({\r\n  selector: 'igo-search-results-tool',\r\n  templateUrl: './search-results-tool.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsToolComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean = true;\r\n\r\n  /**\r\n   * Determine the top panel default state\r\n   */\r\n  @Input() topPanelStateDefault: string = 'expanded';\r\n\r\n  private hasFeatureEmphasisOnSelection: boolean = false;\r\n  public saveSearchResultInLayer: boolean = false;\r\n\r\n  private showResultsGeometries$$: Subscription;\r\n  private getRoute$$: Subscription;\r\n  private shownResultsGeometries: Feature[] = [];\r\n  private shownResultsEmphasisGeometries: Feature[] = [];\r\n  private focusedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  public isSelectedResultOutOfView$ = new BehaviorSubject(false);\r\n  private isSelectedResultOutOfView$$: Subscription;\r\n  private abstractFocusedResult: Feature;\r\n  private abstractSelectedResult: Feature;\r\n\r\n  public debouncedEmpty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  private debouncedEmpty$$: Subscription;\r\n\r\n  /**\r\n   * Store holding the search results\r\n   * @internal\r\n   */\r\n  get store(): EntityStore<SearchResult> {\r\n    return this.searchState.store;\r\n  }\r\n\r\n  /**\r\n   * Map to display the results on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get featureTitle(): string {\r\n    return this.feature ? getEntityTitle(this.feature) : undefined;\r\n  }\r\n\r\n  get feature$(): Observable<Feature> {\r\n    return this.store.stateView\r\n      .firstBy$((e) => e.state.focused)\r\n      .pipe(\r\n        map(\r\n          (element) =>\r\n            (this.feature = element\r\n              ? (element.entity.data as Feature)\r\n              : undefined)\r\n        )\r\n      );\r\n  }\r\n\r\n  public feature: Feature;\r\n\r\n  public term = '';\r\n  private searchTerm$$: Subscription;\r\n\r\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  public topPanelState$ = new BehaviorSubject<FlexibleState>('initial');\r\n  private topPanelState$$: Subscription;\r\n\r\n  @Input()\r\n  set topPanelState(value: FlexibleState) {\r\n    this.topPanelState$.next(value);\r\n  }\r\n  get topPanelState(): FlexibleState {\r\n    return this.topPanelState$.value;\r\n  }\r\n\r\n  get termSplitter(): string {\r\n    return this.searchState.searchTermSplitter$.value;\r\n  }\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get stores(): FeatureStore<Feature>[] {\r\n    return this.searchState.searchLayerStores;\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private searchState: SearchState,\r\n    private elRef: ElementRef,\r\n    public toolState: ToolState,\r\n    private directionState: DirectionState,\r\n    configService: ConfigService\r\n  ) {\r\n    this.hasFeatureEmphasisOnSelection = configService.getConfig(\r\n      'hasFeatureEmphasisOnSelection'\r\n    );\r\n    this.saveSearchResultInLayer = configService.getConfig(\r\n      'saveSearchResultInLayer'\r\n    );\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.searchTerm$$ = this.searchState.searchTerm$.subscribe(\r\n      (searchTerm: string) => {\r\n        if (\r\n          searchTerm !== undefined &&\r\n          searchTerm !== null &&\r\n          searchTerm !== ''\r\n        ) {\r\n          this.term = searchTerm;\r\n          this.debouncedEmpty$.next(false);\r\n        } else if (searchTerm === '') {\r\n          this.debouncedEmpty$.next(true);\r\n        }\r\n      }\r\n    );\r\n\r\n    for (const res of this.store.stateView.all$().value) {\r\n      if (this.store.state.get(res.entity).selected === true) {\r\n        this.topPanelState = 'expanded';\r\n      }\r\n    }\r\n\r\n    this.searchState.searchSettingsChange$.subscribe(() => {\r\n      this.settingsChange$.next(true);\r\n    });\r\n\r\n    this.topPanelState$$ = this.topPanelState$.subscribe(() => {\r\n      const igoList = this.computeElementRef()[0];\r\n      const selected = this.computeElementRef()[1];\r\n      if (selected) {\r\n        setTimeout(() => {\r\n          // To be sure the flexible component has been displayed yet\r\n          if (!this.isScrolledIntoView(igoList, selected)) {\r\n            this.adjustTopPanel(igoList, selected);\r\n          }\r\n        }, FlexibleComponent.transitionTime + 50);\r\n      }\r\n    });\r\n\r\n    if (this.hasFeatureEmphasisOnSelection) {\r\n      if (!this.searchState.focusedOrResolution$$) {\r\n        this.searchState.focusedOrResolution$$ = combineLatest([\r\n          this.focusedResult$,\r\n          this.map.viewController.resolution$\r\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\r\n          this.buildResultEmphasis(bunch[0], 'focused')\r\n        );\r\n      }\r\n\r\n      if (!this.searchState.selectedOrResolution$$) {\r\n        this.searchState.selectedOrResolution$$ = combineLatest([\r\n          this.searchState.selectedResult$,\r\n          this.map.viewController.resolution$\r\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\r\n          this.buildResultEmphasis(bunch[0], 'selected')\r\n        );\r\n      }\r\n    }\r\n    this.monitorResultOutOfView();\r\n\r\n    this.showResultsGeometries$$ = combineLatest([\r\n      this.searchState.searchResultsGeometryEnabled$,\r\n      this.store.stateView.all$(),\r\n      this.focusedResult$,\r\n      this.searchState.selectedResult$,\r\n      this.searchState.searchTerm$,\r\n      this.map.viewController.resolution$\r\n    ]).subscribe(\r\n      (\r\n        bunch: [\r\n          boolean,\r\n          { entity: SearchResult; state: EntityState }[],\r\n          SearchResult,\r\n          SearchResult,\r\n          string,\r\n          number\r\n        ]\r\n      ) => {\r\n        const searchResultsGeometryEnabled = bunch[0];\r\n        const searchResults = bunch[1];\r\n\r\n        if (this.hasFeatureEmphasisOnSelection) {\r\n          this.clearFeatureEmphasis('shown');\r\n        }\r\n        this.shownResultsGeometries.map((result) =>\r\n          this.map.queryResultsOverlay.removeFeature(result)\r\n        );\r\n        const featureToHandleGeom = searchResults.filter(\r\n          (result) =>\r\n            result.entity.meta.dataType === FEATURE &&\r\n            result.entity.data.geometry &&\r\n            !result.state.selected &&\r\n            !result.state.focused\r\n        );\r\n\r\n        featureToHandleGeom.map((result) => {\r\n          if (searchResultsGeometryEnabled) {\r\n            result.entity.data.meta.style = getCommonVectorStyle(\r\n              Object.assign(\r\n                {},\r\n                {\r\n                  feature: result.entity.data as Feature | olFeature<OlGeometry>\r\n                },\r\n                this.searchState.searchOverlayStyle,\r\n                result.entity.style?.base ? result.entity.style.base : {}\r\n              )\r\n            );\r\n            this.shownResultsGeometries.push(result.entity.data as Feature);\r\n            this.map.queryResultsOverlay.addFeature(\r\n              result.entity.data as Feature,\r\n              FeatureMotion.None\r\n            );\r\n            if (this.hasFeatureEmphasisOnSelection) {\r\n              this.buildResultEmphasis(\r\n                result.entity as SearchResult<Feature>,\r\n                'shown'\r\n              );\r\n            }\r\n          }\r\n        });\r\n      }\r\n    );\r\n\r\n    this.debouncedEmpty$$ = this.store.stateView.empty$\r\n      .pipe(debounceTime(1500))\r\n      .subscribe((empty) => this.debouncedEmpty$.next(empty));\r\n  }\r\n\r\n  private monitorResultOutOfView() {\r\n    this.isSelectedResultOutOfView$$ = combineLatest([\r\n      this.map.viewController.state$,\r\n      this.searchState.selectedResult$\r\n    ])\r\n      .pipe(debounceTime(100))\r\n      .subscribe((bunch) => {\r\n        const selectedResult = bunch[1] as SearchResult<Feature>;\r\n        if (!selectedResult) {\r\n          this.isSelectedResultOutOfView$.next(false);\r\n          return;\r\n        }\r\n        if (selectedResult.data.geometry) {\r\n          const selectedOlFeature = featureToOl(\r\n            selectedResult.data,\r\n            this.map.projection\r\n          );\r\n          const selectedOlFeatureExtent = computeOlFeaturesExtent(\r\n            [selectedOlFeature],\r\n            this.map.viewController.getOlProjection()\r\n          );\r\n          this.isSelectedResultOutOfView$.next(\r\n            featuresAreOutOfView(this.map.getExtent(), selectedOlFeatureExtent)\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  private buildResultEmphasis(\r\n    result: SearchResult<Feature>,\r\n    trigger: 'selected' | 'focused' | 'shown' | undefined\r\n  ) {\r\n    if (trigger !== 'shown') {\r\n      this.clearFeatureEmphasis(trigger);\r\n    }\r\n    if (!result || !result.data.geometry) {\r\n      return;\r\n    }\r\n    const myOlFeature = featureToOl(result.data, this.map.projection);\r\n    const olGeometry = myOlFeature.getGeometry();\r\n    if (\r\n      featuresAreTooDeepInView(\r\n        this.map.viewController,\r\n        olGeometry.getExtent() as [number, number, number, number],\r\n        0.0025\r\n      )\r\n    ) {\r\n      const extent = olGeometry.getExtent();\r\n      const x = extent[0] + (extent[2] - extent[0]) / 2;\r\n      const y = extent[1] + (extent[3] - extent[1]) / 2;\r\n      const feature1 = new olFeature({\r\n        name: `${trigger}AbstractResult'`,\r\n        geometry: new olPoint([x, y])\r\n      });\r\n      const abstractResult = featureFromOl(feature1, this.map.projection);\r\n\r\n      let computedStyle;\r\n      let zIndexOffset = 0;\r\n\r\n      switch (trigger) {\r\n        case 'focused':\r\n          computedStyle = getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature: abstractResult },\r\n              this.searchState.searchOverlayStyleFocus,\r\n              result.style?.focus ? result.style.focus : {}\r\n            )\r\n          );\r\n          zIndexOffset = 2;\r\n          break;\r\n        case 'shown':\r\n          computedStyle = getCommonVectorStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature: abstractResult },\r\n              this.searchState.searchOverlayStyle,\r\n              result.style?.base ? result.style.base : {}\r\n            )\r\n          );\r\n          break;\r\n        case 'selected':\r\n          computedStyle = getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature: abstractResult },\r\n              this.searchState.searchOverlayStyleSelection,\r\n              result.style?.selection ? result.style.selection : {}\r\n            )\r\n          );\r\n          zIndexOffset = 1;\r\n          break;\r\n      }\r\n      abstractResult.meta.style = computedStyle;\r\n      abstractResult.meta.style.setZIndex(2000 + zIndexOffset);\r\n      this.map.searchResultsOverlay.addFeature(\r\n        abstractResult,\r\n        FeatureMotion.None\r\n      );\r\n      if (trigger === 'focused') {\r\n        this.abstractFocusedResult = abstractResult;\r\n      }\r\n      if (trigger === 'selected') {\r\n        this.abstractSelectedResult = abstractResult;\r\n      }\r\n      if (trigger === 'shown') {\r\n        this.shownResultsEmphasisGeometries.push(abstractResult);\r\n      }\r\n    } else {\r\n      this.clearFeatureEmphasis(trigger);\r\n    }\r\n  }\r\n\r\n  private clearFeatureEmphasis(trigger: 'selected' | 'focused' | 'shown') {\r\n    if (trigger === 'focused' && this.abstractFocusedResult) {\r\n      this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult);\r\n      this.abstractFocusedResult = undefined;\r\n    }\r\n    if (trigger === 'selected' && this.abstractSelectedResult) {\r\n      this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult);\r\n      this.abstractSelectedResult = undefined;\r\n    }\r\n    if (trigger === 'shown') {\r\n      this.shownResultsEmphasisGeometries.map((shownResult) =>\r\n        this.map.searchResultsOverlay.removeFeature(shownResult)\r\n      );\r\n      this.shownResultsEmphasisGeometries = [];\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.topPanelState$$.unsubscribe();\r\n    this.searchTerm$$.unsubscribe();\r\n    if (this.isSelectedResultOutOfView$$) {\r\n      this.isSelectedResultOutOfView$$.unsubscribe();\r\n    }\r\n    if (this.showResultsGeometries$$) {\r\n      this.showResultsGeometries$$.unsubscribe();\r\n    }\r\n    if (this.getRoute$$) {\r\n      this.getRoute$$.unsubscribe();\r\n    }\r\n    if (this.debouncedEmpty$$) {\r\n      this.debouncedEmpty$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map when it's being focused\r\n   * @internal\r\n   * @param result A search result that could be a feature\r\n   */\r\n  onResultFocus(result: SearchResult) {\r\n    this.focusedResult$.next(result);\r\n    if (result.meta.dataType === FEATURE && result.data.geometry) {\r\n      result.data.meta.style = getCommonVectorSelectedStyle(\r\n        Object.assign(\r\n          {},\r\n          { feature: result.data as Feature | olFeature<OlGeometry> },\r\n          this.searchState.searchOverlayStyleFocus,\r\n          result.style?.focus ? result.style.focus : {}\r\n        )\r\n      );\r\n\r\n      const feature =\r\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\r\n          result.meta.id\r\n        );\r\n      if (feature) {\r\n        feature.setStyle(result.data.meta.style);\r\n        return;\r\n      }\r\n      this.map.searchResultsOverlay.addFeature(\r\n        result.data as Feature,\r\n        FeatureMotion.None\r\n      );\r\n    }\r\n  }\r\n\r\n  onResultUnfocus(result: SearchResult) {\r\n    this.focusedResult$.next(undefined);\r\n    if (result.meta.dataType !== FEATURE) {\r\n      return;\r\n    }\r\n\r\n    if (this.store.state.get(result).selected === true) {\r\n      const feature =\r\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\r\n          result.meta.id\r\n        );\r\n      if (feature) {\r\n        const style = getCommonVectorSelectedStyle(\r\n          Object.assign(\r\n            {},\r\n            { feature: result.data as Feature | olFeature<OlGeometry> },\r\n            this.searchState.searchOverlayStyleFocus,\r\n            result.style?.focus ? result.style.focus : {}\r\n          )\r\n        );\r\n        feature.setStyle(style);\r\n      }\r\n      return;\r\n    }\r\n    this.map.searchResultsOverlay.removeFeature(result.data as Feature);\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map when it's being selected\r\n   * @internal\r\n   * @param result A search result that could be a feature or some layer options\r\n   */\r\n  onResultSelect(result: SearchResult) {\r\n    this.map.searchResultsOverlay.dataSource.ol.clear();\r\n    this.tryAddFeatureToMap(result);\r\n    this.searchState.setSelectedResult(result);\r\n\r\n    if (this.topPanelState === 'initial') {\r\n      if (this.topPanelStateDefault !== 'collapsed') {\r\n        this.topPanelState = 'expanded';\r\n      } else {\r\n        this.topPanelState = 'collapsed';\r\n      }\r\n    }\r\n\r\n    if (this.topPanelState === 'expanded') {\r\n      const igoList = this.computeElementRef()[0];\r\n      const selected = this.computeElementRef()[1];\r\n      if (!this.isScrolledIntoView(igoList, selected)) {\r\n        this.adjustTopPanel(igoList, selected);\r\n      }\r\n    }\r\n  }\r\n\r\n  onSearch(event: { research: Research; results: SearchResult[] }) {\r\n    const results = event.results;\r\n    const newResults = this.store.entities$.value\r\n      .filter((result: SearchResult) => result.source !== event.research.source)\r\n      .concat(results);\r\n\r\n    this.store.load(newResults);\r\n\r\n    for (const res of this.store.all()) {\r\n      if (\r\n        this.store.state.get(res).focused === true &&\r\n        this.store.state.get(res).selected !== true\r\n      ) {\r\n        this.store.state.update(res, { focused: false }, true);\r\n      }\r\n    }\r\n\r\n    setTimeout(() => {\r\n      const igoList = this.elRef.nativeElement.querySelector('igo-list');\r\n      let moreResults;\r\n      event.research.request.subscribe((source) => {\r\n        if (!source[0] || !source[0].source) {\r\n          moreResults = null;\r\n        } else if (source[0].source.getId() === 'icherche') {\r\n          moreResults = igoList.querySelector('.icherche .moreResults');\r\n        } else if (source[0].source.getId() === 'ilayer') {\r\n          moreResults = igoList.querySelector('.ilayer .moreResults');\r\n        } else if (source[0].source.getId() === 'nominatim') {\r\n          moreResults = igoList.querySelector('.nominatim .moreResults');\r\n        } else {\r\n          moreResults = igoList.querySelector(\r\n            '.' + source[0].source.getId() + ' .moreResults'\r\n          );\r\n        }\r\n\r\n        if (\r\n          moreResults !== null &&\r\n          !this.isScrolledIntoView(igoList, moreResults)\r\n        ) {\r\n          igoList.scrollTop =\r\n            moreResults.offsetTop +\r\n            moreResults.offsetHeight -\r\n            igoList.clientHeight;\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  computeElementRef() {\r\n    const items = document.getElementsByTagName('igo-search-results-item');\r\n    const igoList =\r\n      this.elRef.nativeElement.getElementsByTagName('igo-list')[0];\r\n    let selectedItem;\r\n    // eslint-disable-next-line\r\n    for (let i = 0; i < items.length; i++) {\r\n      if (items[i].className.includes('igo-list-item-selected')) {\r\n        selectedItem = items[i];\r\n      }\r\n    }\r\n    return [igoList, selectedItem];\r\n  }\r\n\r\n  adjustTopPanel(elemSource, elem) {\r\n    if (!this.isScrolledIntoView(elemSource, elem)) {\r\n      elemSource.scrollTop =\r\n        elem.offsetTop +\r\n        elem.children[0].offsetHeight -\r\n        elemSource.clientHeight;\r\n    }\r\n  }\r\n\r\n  toggleTopPanel(event?: MouseEvent) {\r\n    if (event && (event.target as any)?.className !== 'igo-panel-title') {\r\n      return;\r\n    } else {\r\n      if (this.topPanelState === 'expanded') {\r\n        this.topPanelState = 'collapsed';\r\n      } else {\r\n        this.topPanelState = 'expanded';\r\n      }\r\n    }\r\n  }\r\n\r\n  zoomToFeatureExtent() {\r\n    if (this.feature.geometry) {\r\n      const localOlFeature = this.format.readFeature(this.feature, {\r\n        dataProjection: this.feature.projection,\r\n        featureProjection: this.map.projectionCode\r\n      });\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        [localOlFeature],\r\n        FeatureMotion.Zoom\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map overlay\r\n   * @param result A search result that could be a feature\r\n   */\r\n  private tryAddFeatureToMap(result: SearchResult) {\r\n    if (result.meta.dataType !== FEATURE) {\r\n      return undefined;\r\n    }\r\n    const feature = (result as SearchResult<Feature>).data;\r\n\r\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\r\n    if (!feature.geometry) {\r\n      return;\r\n    }\r\n\r\n    feature.meta.style = getCommonVectorSelectedStyle(\r\n      Object.assign(\r\n        {},\r\n        { feature },\r\n        this.searchState.searchOverlayStyleSelection,\r\n        result.style?.selection ? result.style.selection : {}\r\n      )\r\n    );\r\n\r\n    this.map.searchResultsOverlay.addFeature(feature);\r\n  }\r\n\r\n  isScrolledIntoView(elemSource, elem) {\r\n    const padding = 6;\r\n    const docViewTop = elemSource.scrollTop;\r\n    const docViewBottom = docViewTop + elemSource.clientHeight;\r\n\r\n    const elemTop = elem.offsetTop;\r\n    const elemBottom = elemTop + elem.clientHeight + padding;\r\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\r\n  }\r\n\r\n  getRoute() {\r\n    this.toolState.toolbox.activateTool('directions');\r\n    this.directionState.stopsStore.clearStops();\r\n    setTimeout(() => {\r\n      let routingCoordLoaded = false;\r\n      if (this.getRoute$$) {\r\n        this.getRoute$$.unsubscribe();\r\n      }\r\n      this.getRoute$$ =\r\n        this.directionState.stopsStore.storeInitialized$.subscribe(\r\n          (init: boolean) => {\r\n            if (\r\n              this.directionState.stopsStore.storeInitialized$.value &&\r\n              !routingCoordLoaded\r\n            ) {\r\n              routingCoordLoaded = true;\r\n              const stop = this.directionState.stopsStore\r\n                .all()\r\n                .find((e) => e.position === 1);\r\n              let coord;\r\n              if (this.feature.geometry) {\r\n                if (this.feature.geometry.type === 'Point') {\r\n                  coord = [\r\n                    this.feature.geometry.coordinates[0],\r\n                    this.feature.geometry.coordinates[1]\r\n                  ];\r\n                } else {\r\n                  const point = pointOnFeature(this.feature.geometry);\r\n                  coord = [\r\n                    point.geometry.coordinates[0],\r\n                    point.geometry.coordinates[1]\r\n                  ];\r\n                }\r\n              }\r\n              stop.text = this.featureTitle;\r\n              stop.coordinates = coord;\r\n              this.directionState.stopsStore.update(stop);\r\n              if (this.map.geolocationController.position$.value) {\r\n                const currentPos =\r\n                  this.map.geolocationController.position$.value;\r\n                const stop = this.directionState.stopsStore\r\n                  .all()\r\n                  .find((e) => e.position === 0);\r\n                const currentCoord = olProj.transform(\r\n                  currentPos.position,\r\n                  currentPos.projection,\r\n                  'EPSG:4326'\r\n                );\r\n                const coord: [number, number] = roundCoordTo(\r\n                  [currentCoord[0], currentCoord[1]],\r\n                  6\r\n                );\r\n                stop.text = coord.join(',');\r\n                stop.coordinates = coord;\r\n                this.directionState.stopsStore.update(stop);\r\n              }\r\n            }\r\n          }\r\n        );\r\n    }, 250);\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  ElementRef,\r\n  EventEmitter,\r\n  HostListener,\r\n  Input,\r\n  Output,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\nimport type { TemplateRef } from '@angular/core';\r\n\r\nimport { TemplatePortal } from '@angular/cdk/portal';\r\nimport { fromEvent, Subscription } from 'rxjs';\r\nimport { filter, take } from 'rxjs/operators';\r\nimport { Overlay, OverlayRef } from '@angular/cdk/overlay';\r\n\r\n@Directive({\r\n  selector: '[igoContextMenu]'\r\n})\r\nexport class ContextMenuDirective {\r\n  private overlayRef: OverlayRef | null;\r\n  private sub: Subscription;\r\n\r\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\r\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\r\n\r\n  constructor(\r\n    public overlay: Overlay,\r\n    public viewContainerRef: ViewContainerRef,\r\n    private elementRef: ElementRef\r\n  ) {}\r\n\r\n  @HostListener('longpress', ['$event'])\r\n  @HostListener('contextmenu', ['$event'])\r\n  public onContextMenu(e: MouseEvent | TouchEvent): void {\r\n    let x;\r\n    let y;\r\n    if (e instanceof TouchEvent) {\r\n      x = e.touches[0].pageX;\r\n      y = e.touches[0].pageY;\r\n    } else if (e instanceof MouseEvent) {\r\n      x = e.x;\r\n      y = e.y;\r\n    }\r\n    if (!x || !y) {\r\n      return;\r\n    }\r\n\r\n    this.close();\r\n    e.preventDefault();\r\n    this.menuPosition.emit({ x, y });\r\n    this.overlayRef = null;\r\n    const positionStrategy = this.overlay\r\n      .position()\r\n      .flexibleConnectedTo({ x, y })\r\n      .withPositions([\r\n        {\r\n          originX: 'end',\r\n          originY: 'bottom',\r\n          overlayX: 'start',\r\n          overlayY: 'top'\r\n        }\r\n      ]);\r\n    this.overlayRef = this.overlay.create({\r\n      positionStrategy,\r\n      scrollStrategy: this.overlay.scrollStrategies.close()\r\n    });\r\n    this.overlayRef.attach(\r\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\r\n        $implicit: undefined\r\n      })\r\n    );\r\n\r\n    this.sub = fromEvent<MouseEvent>(document, 'click')\r\n      .pipe(\r\n        filter((event) => {\r\n          const clickTarget = event.target as HTMLElement;\r\n          this.close();\r\n          return (\r\n            !!this.overlayRef &&\r\n            !this.overlayRef.overlayElement.contains(clickTarget)\r\n          );\r\n        }),\r\n        take(1)\r\n      )\r\n      .subscribe(() => this.close());\r\n\r\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\r\n      .pipe(\r\n        filter((event) => {\r\n          const clickTarget = event.target as HTMLElement;\r\n          if (\r\n            clickTarget &&\r\n            !this.elementRef.nativeElement.contains(clickTarget) &&\r\n            !this.overlayRef.overlayElement.contains(clickTarget)\r\n          ) {\r\n            return true;\r\n          } else {\r\n            event.preventDefault();\r\n          }\r\n        }),\r\n        take(1)\r\n      )\r\n      .subscribe(() => this.close());\r\n  }\r\n\r\n  close() {\r\n    if (this.overlayRef) {\r\n      this.overlayRef.dispose();\r\n      this.overlayRef = null;\r\n    }\r\n    if (this.sub) {\r\n      this.sub.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Search\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/search\" configFolder=\"environments\">\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\n      F2 activate/deactivate the pointer location.\n    </span>\n    <igo-map-browser\n      #mapBrowser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoOverlay\n      [igoContextMenu]=\"actionbarMenu\"\n      igoLongPress\n      igoSearchPointerSummary\n      [igoSearchPointerSummaryDelay]=\"500\"\n      [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\n      (menuPosition)=\"onContextMenuOpen($event)\"\n    >\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-panel title=\"Search\">\n      <igo-search-bar\n        [term]=\"term\"\n        (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\n        [searchSettings]=\"true\"\n        [store]=\"searchStore\"\n        [termSplitter]=\"termSplitter\"\n        (searchTermChange)=\"onSearchTermChange($event)\"\n        (search)=\"onSearch($event)\"\n        (clearFeature)=\"removeFeatureFromMap()\"\n        (searchSettingsChange)=\"onSearchSettingsChange()\"\n        [reverseSearchCoordsFormatEnabled]=\"igoReverseSearchCoordsFormatEnabled\"\n        (reverseSearchCoordsFormatStatus)=\"\n          onReverseCoordsFormatStatusChange($event)\n        \"\n      >\n      </igo-search-bar>\n\n      <igo-search-results\n        [store]=\"searchStore\"\n        [term]=\"term\"\n        [termSplitter]=\"termSplitter\"\n        placeholder=\"false\"\n        [settingsChange$]=\"settingsChange$\"\n        (resultFocus)=\"onResultFocus($event)\"\n        (resultSelect)=\"onResultFocus($event)\"\n        (moreResults)=\"onSearch($event)\"\n      >\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\n          <igo-search-add-button [map]=\"map\" [layer]=\"result\">\n          </igo-search-add-button>\n        </ng-template>\n      </igo-search-results>\n    </igo-panel>\n\n    <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\n      <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\n    </igo-panel>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"false\"\n        [horizontal]=\"true\"\n        [mode]=\"'context'\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppSearchComponent } from './search.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'search',\r\n    component: AppSearchComponent\r\n  }\r\n];\r\n\r\nexport const AppSearchRoutingModule = RouterModule.forChild(routes);\r\n","import { BehaviorSubject } from 'rxjs';\r\nimport {\r\n  Component,\r\n  ElementRef,\r\n  OnDestroy,\r\n  OnInit,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport * as proj from 'ol/proj';\r\n\r\nimport { LanguageService, MediaService, StorageService } from '@igo2/core';\r\nimport { EntityStore, ActionStore } from '@igo2/common';\r\nimport {\r\n  FEATURE,\r\n  Feature,\r\n  FeatureMotion,\r\n  GoogleLinks,\r\n  IgoMap,\r\n  LayerService,\r\n  MapService,\r\n  Layer,\r\n  ProjectionService,\r\n  Research,\r\n  SearchResult\r\n} from '@igo2/geo';\r\n\r\nimport { SearchState } from '@igo2/integration';\r\n\r\n@Component({\r\n  selector: 'app-search',\r\n  templateUrl: './search.component.html',\r\n  styleUrls: ['./search.component.scss']\r\n})\r\nexport class AppSearchComponent implements OnInit, OnDestroy {\r\n  public store = new ActionStore([]);\r\n\r\n  public igoSearchPointerSummaryEnabled: boolean = false;\r\n\r\n  public termSplitter: string = '|';\r\n\r\n  public map = new IgoMap({\r\n    overlay: true,\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  public osmLayer: Layer;\r\n\r\n  @ViewChild('mapBrowser', { read: ElementRef, static: true })\r\n  mapBrowser: ElementRef;\r\n\r\n  public lonlat;\r\n  public mapProjection: string;\r\n  public term: string;\r\n\r\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  get searchStore(): EntityStore<SearchResult> {\r\n    return this.searchState.store;\r\n  }\r\n\r\n  get isTouchScreen(): boolean {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  public selectedFeature: Feature;\r\n  public igoReverseSearchCoordsFormatEnabled: boolean;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private projectionService: ProjectionService,\r\n    private mapService: MapService,\r\n    private layerService: LayerService,\r\n    private searchState: SearchState,\r\n    private mediaService: MediaService,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe((layer) => {\r\n        this.osmLayer = layer;\r\n        this.map.addLayer(layer);\r\n      });\r\n\r\n    this.igoReverseSearchCoordsFormatEnabled =\r\n      (this.storageService.get(\r\n        'reverseSearchCoordsFormatEnabled'\r\n      ) as boolean) || false;\r\n  }\r\n\r\n  onPointerSummaryStatusChange(value) {\r\n    this.igoSearchPointerSummaryEnabled = value;\r\n  }\r\n\r\n  onSearchTermChange(term?: string) {\r\n    this.term = term;\r\n    this.searchState.setSearchTerm(term);\r\n    const termWithoutHashtag = term.replace(/(#[^\\s]*)/g, '').trim();\r\n    if (termWithoutHashtag.length < 2) {\r\n      this.searchStore.clear();\r\n      this.selectedFeature = undefined;\r\n    }\r\n  }\r\n\r\n  onSearch(event: { research: Research; results: SearchResult[] }) {\r\n    const results = event.results;\r\n    this.searchStore.state.updateAll({ focused: false, selected: false });\r\n    const newResults = this.searchStore.entities$.value\r\n      .filter((result: SearchResult) => result.source !== event.research.source)\r\n      .concat(results);\r\n    this.searchStore.updateMany(newResults);\r\n  }\r\n\r\n  onReverseCoordsFormatStatusChange(value) {\r\n    this.storageService.set('reverseSearchCoordsFormatEnabled', value);\r\n    this.igoReverseSearchCoordsFormatEnabled = value;\r\n  }\r\n\r\n  onSearchSettingsChange() {\r\n    this.settingsChange$.next(true);\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map when it's being focused\r\n   * @internal\r\n   * @param result A search result that could be a feature\r\n   */\r\n  onResultFocus(result: SearchResult) {\r\n    this.tryAddFeatureToMap(result);\r\n    this.selectedFeature = (result as SearchResult<Feature>).data;\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map overlay\r\n   * @param layer A search result that could be a feature\r\n   */\r\n  private tryAddFeatureToMap(layer: SearchResult) {\r\n    if (layer.meta.dataType !== FEATURE) {\r\n      return undefined;\r\n    }\r\n\r\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\r\n    if (layer.data.geometry === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.map.searchResultsOverlay.setFeatures(\r\n      [layer.data] as Feature[],\r\n      FeatureMotion.Default\r\n    );\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.store.load([\r\n      {\r\n        id: 'coordinates',\r\n        title: 'coordinates',\r\n        handler: () => this.searchCoordinate(this.lonlat)\r\n      },\r\n      {\r\n        id: 'googleMaps',\r\n        title: 'googleMap',\r\n        handler: () => this.openGoogleMaps(this.lonlat)\r\n      },\r\n      {\r\n        id: 'googleStreetView',\r\n        title: 'googleStreetView',\r\n        handler: () => this.openGoogleStreetView(this.lonlat)\r\n      }\r\n    ]);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  /*\r\n   * Remove a feature to the map overlay\r\n   */\r\n  removeFeatureFromMap() {\r\n    this.map.searchResultsOverlay.clear();\r\n  }\r\n\r\n  onContextMenuOpen(event: { x: number; y: number }) {\r\n    const position = this.mapPosition(event);\r\n    const coord = this.mapService.getMap().ol.getCoordinateFromPixel(position);\r\n    this.mapProjection = this.mapService.getMap().projection;\r\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\r\n  }\r\n\r\n  mapPosition(event: { x: number; y: number }) {\r\n    const contextmenuPoint = event;\r\n    contextmenuPoint.y =\r\n      contextmenuPoint.y -\r\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\r\n      window.scrollY;\r\n    contextmenuPoint.x =\r\n      contextmenuPoint.x -\r\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\r\n      window.scrollX;\r\n    const position = [contextmenuPoint.x, contextmenuPoint.y];\r\n    return position;\r\n  }\r\n\r\n  searchCoordinate(lonlat) {\r\n    this.searchStore.clear();\r\n    this.term = !this.igoReverseSearchCoordsFormatEnabled\r\n      ? lonlat.map((c) => c.toFixed(6)).join(', ')\r\n      : lonlat\r\n          .reverse()\r\n          .map((c) => c.toFixed(6))\r\n          .join(', ');\r\n  }\r\n\r\n  openGoogleMaps(lonlat) {\r\n    window.open(GoogleLinks.getGoogleMapsCoordLink(lonlat[0], lonlat[1]));\r\n  }\r\n\r\n  openGoogleStreetView(lonlat) {\r\n    window.open(GoogleLinks.getGoogleStreetViewLink(lonlat[0], lonlat[1]));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport {\n  IgoPanelModule,\n  IgoActionbarModule,\n  IgoContextMenuModule\n} from '@igo2/common';\n\nimport {\n  IgoFeatureModule,\n  IgoMapModule,\n  IgoSearchModule,\n  provideIChercheSearchSource,\n  provideWorkspaceSearchSource,\n  provideILayerSearchSource,\n  provideNominatimSearchSource,\n  provideIChercheReverseSearchSource,\n  provideCoordinatesReverseSearchSource,\n  provideCadastreSearchSource,\n  provideStoredQueriesSearchSource,\n  provideStoredQueriesReverseSearchSource\n} from '@igo2/geo';\n\nimport { IgoAppSearchModule } from '@igo2/integration';\n\nimport { AppSearchComponent } from './search.component';\nimport { AppSearchRoutingModule } from './search-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppSearchComponent],\n  imports: [\n    SharedModule,\n    AppSearchRoutingModule,\n    IgoMessageModule.forRoot(),\n    IgoPanelModule,\n    IgoMapModule,\n    IgoSearchModule.forRoot(),\n    IgoAppSearchModule,\n    IgoActionbarModule,\n    IgoContextMenuModule,\n    IgoFeatureModule\n  ],\n  exports: [AppSearchComponent],\n  providers: [\n    provideCoordinatesReverseSearchSource(),\n    provideCadastreSearchSource(),\n    provideIChercheSearchSource(),\n    provideWorkspaceSearchSource(),\n    provideILayerSearchSource(),\n    provideNominatimSearchSource(),\n    provideIChercheReverseSearchSource(),\n    provideStoredQueriesSearchSource(),\n    provideStoredQueriesReverseSearchSource()\n  ]\n})\nexport class AppSearchModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppPrintComponent } from './print.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'print',\r\n    component: AppPrintComponent\r\n  }\r\n];\r\n\r\nexport const AppPrintRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { IgoMap, LayerService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-print',\r\n  templateUrl: './print.component.html',\r\n  styleUrls: ['./print.component.scss']\r\n})\r\nexport class AppPrintComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: false\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 9\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Quebec Base Map',\r\n        sourceOptions: {\r\n          type: 'wmts',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\r\n          layer: 'carte_gouv_qc_ro',\r\n          matrixSet: 'EPSG_3857',\r\n          version: '1.3.0',\r\n          crossOrigin: 'anonymous',\r\n          attributions:\r\n            \" <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Qubec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>\"\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'School board',\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n          params: {\r\n            LAYERS: 'MELS_CS_ANGLO_S',\r\n            VERSION: '1.3.0'\r\n          },\r\n          crossOrigin: 'anonymous'\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n    //\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Embacle',\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n          params: {\r\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n            VERSION: '1.3.0'\r\n          },\r\n          crossOrigin: 'anonymous'\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    // this.layerService\r\n    //   .createAsyncLayer({\r\n    //     title: 'Geomet',\r\n    //     sourceOptions: {\r\n    //       type: 'wms',\r\n    //       url: 'http://geo.weather.gc.ca/geomet/?lang=fr',\r\n    //       params: {\r\n    //         LAYERS: 'RADAR_1KM_RDBR',\r\n    //         VERSION: '1.3.0'\r\n    //       },\r\n    //       crossOrigin: 'anonymous'\r\n    //     }\r\n    //   })\r\n    //   .subscribe(l => this.map.addLayer(l));\r\n\r\n    /*\r\n        //CORS error if activate (for test)\r\n        this.layerService\r\n          .createAsyncLayer({\r\n            title: 'Geomet',\r\n            sourceOptions: {\r\n              type: 'wms',\r\n              url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wms',\r\n              params: {\r\n                layers: 'swtq',\r\n                version: '1.3.0',\r\n              }\r\n            }\r\n          })\r\n          .subscribe(l => this.map.addLayer(l));\r\n    */\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Print\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/print\">\n    <mat-grid-list cols=\"2\" rowHeight=\"800px\" gutterSize=\"16px\">\n      <mat-grid-tile\n        ><igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n          <igo-geolocate-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-geolocate-button>\n          <igo-home-extent-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-home-extent-button>\n          <igo-rotation-button\n            [map]=\"map\"\n            [showIfNoRotation]=\"false\"\n            color=\"primary\"\n          ></igo-rotation-button> </igo-map-browser\n      ></mat-grid-tile>\n      <mat-grid-tile> <igo-print [map]=\"map\"></igo-print></mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport { IgoMapModule, IgoPrintModule } from '@igo2/geo';\n\nimport { AppPrintComponent } from './print.component';\nimport { AppPrintRoutingModule } from './print-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppPrintComponent],\n  imports: [\n    SharedModule,\n    AppPrintRoutingModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoPrintModule\n  ],\n  exports: [AppPrintComponent]\n})\nexport class AppPrintModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppImportExportComponent } from './import-export.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'import-export',\r\n    component: AppImportExportComponent\r\n  }\r\n];\r\n\r\nexport const AppImportExportRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { IgoMap, LayerService } from '@igo2/geo';\r\nimport { WorkspaceStore } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-import-export',\r\n  templateUrl: './import-export.component.html',\r\n  styleUrls: ['./import-export.component.scss']\r\n})\r\nexport class AppImportExportComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 9\r\n  };\r\n\r\n  public store = new WorkspaceStore([]);\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Import / Export\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/import-export\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-import-export\n            class=\"w-100\"\n            [store]=\"store\"\n            [map]=\"map\"\n          ></igo-import-export>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoImportExportModule,\n  provideStyleListOptions,\n  IgoStyleModule\n} from '@igo2/geo';\n\nimport { AppImportExportComponent } from './import-export.component';\nimport { AppImportExportRoutingModule } from './import-export-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppImportExportComponent],\n  imports: [\n    AppImportExportRoutingModule,\n    SharedModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoStyleModule,\n    IgoImportExportModule\n  ],\n  exports: [AppImportExportComponent],\n  providers: [\n    provideStyleListOptions({\n      path: './assets/import-style.json'\n    })\n  ]\n})\nexport class AppImportExport {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppDirectionsComponent } from './directions.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'directions',\r\n    component: AppDirectionsComponent\r\n  }\r\n];\r\n\r\nexport const AppDirectionsRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  LayerService,\r\n  MapService,\r\n  ProjectionService,\r\n  StopsStore,\r\n  StopsFeatureStore,\r\n  RoutesFeatureStore,\r\n  StepFeatureStore\r\n} from '@igo2/geo';\r\nimport { Subject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-directions',\r\n  templateUrl: './directions.component.html',\r\n  styleUrls: ['./directions.component.scss']\r\n})\r\nexport class AppDirectionsComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 9,\r\n    geolocate: false\r\n  };\r\n\r\n  public stopsStore: StopsStore = new StopsStore([]);\r\n  public stopsFeatureStore: StopsFeatureStore = new StopsFeatureStore([], {\r\n    map: this.map\r\n  });\r\n  public stepFeatureStore: StepFeatureStore = new StepFeatureStore([], {\r\n    map: this.map\r\n  });\r\n  public routesFeatureStore: RoutesFeatureStore = new RoutesFeatureStore([], {\r\n    map: this.map\r\n  });\r\n  public zoomToActiveRoute$: Subject<void> = new Subject();\r\n\r\n  constructor(\r\n    private projectionService: ProjectionService,\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService,\r\n    private mapService: MapService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Directions\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/directions\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n          <igo-geolocate-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-geolocate-button>\n          <igo-home-extent-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-home-extent-button>\n          <igo-rotation-button\n            [map]=\"map\"\n            [showIfNoRotation]=\"false\"\n            color=\"primary\"\n          ></igo-rotation-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-directions\n            class=\"w-100\"\n            [stopsStore]=\"stopsStore\"\n            [stopsFeatureStore]=\"stopsFeatureStore\"\n            [stepFeatureStore]=\"stepFeatureStore\"\n            [routesFeatureStore]=\"routesFeatureStore\"\n            [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n          >\n          </igo-directions>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoDirectionsModule,\n  provideOsrmDirectionsSource\n} from '@igo2/geo';\n\nimport { AppDirectionsComponent } from './directions.component';\nimport { AppDirectionsRoutingModule } from './directions-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppDirectionsComponent],\n  imports: [\n    AppDirectionsRoutingModule,\n    SharedModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoDirectionsModule\n  ],\n  exports: [AppDirectionsComponent],\n  providers: [provideOsrmDirectionsSource()]\n})\nexport class AppDirectionsModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppTimeFilterComponent } from './time-filter.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'time-filter',\r\n    component: AppTimeFilterComponent\r\n  }\r\n];\r\n\r\nexport const AppTimeFilterRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  TimeFilterableDataSourceOptions,\r\n  TimeFilterType,\r\n  TimeFilterStyle\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-time-filter',\r\n  templateUrl: './time-filter.component.html',\r\n  styleUrls: ['./time-filter.component.scss']\r\n})\r\nexport class AppTimeFilterComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    // const datasource: TimeFilterableDataSourceOptions = {\r\n    //   type: 'wms',\r\n    //   url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\r\n    //   params: {\r\n    //     layers: 'vg_observation_v_inondation_embacle_wmst',\r\n    //     version: '1.3.0'\r\n    //   },\r\n    //   timeFilterable: true,\r\n    //   timeFilter: {\r\n    //     min: '2017-01-01',\r\n    //     max: '2018-01-01',\r\n    //     range: true,\r\n    //     type: TimeFilterType.DATETIME,\r\n    //     style: TimeFilterStyle.SLIDER,\r\n    //     step: 86400000,\r\n    //     timeInterval: 2000\r\n    //   }\r\n    // };\r\n\r\n    const datasourceYear: TimeFilterableDataSourceOptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n        VERSION: '1.3.0'\r\n      },\r\n      timeFilterable: true,\r\n      timeFilter: {\r\n        min: '2013',\r\n        max: '2019',\r\n        range: false,\r\n        type: TimeFilterType.YEAR,\r\n        style: TimeFilterStyle.SLIDER,\r\n        step: 1,\r\n        timeInterval: 2000\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceYear)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle YEAR',\r\n            visible: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Time filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/time-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppTimeFilterComponent } from './time-filter.component';\nimport { AppTimeFilterRoutingModule } from './time-filter-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppTimeFilterComponent],\n  imports: [\n    AppTimeFilterRoutingModule,\n    SharedModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppTimeFilterComponent]\n})\nexport class AppTimeFilterModule {}\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppOgcFilterComponent } from './ogc-filter.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'ogc-filter',\r\n    component: AppOgcFilterComponent\r\n  }\r\n];\r\n\r\nexport const AppOgcFilterRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  WMSDataSourceOptions,\r\n  WFSDataSourceOptions,\r\n  WFSDataSourceOptionsParams,\r\n  OgcFilterableDataSourceOptions,\r\n  AnyBaseOgcFilterOptions,\r\n  OgcFilterOperatorType,\r\n  OgcFilterDuringOptions\r\n} from '@igo2/geo';\r\n\r\nimport { Fill, Stroke, Circle, Style } from 'ol/style';\r\n\r\n@Component({\r\n  selector: 'app-ogc-filter',\r\n  templateUrl: './ogc-filter.component.html',\r\n  styleUrls: ['./ogc-filter.component.scss']\r\n})\r\nexport class AppOgcFilterComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const datasource: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        { name: 'code_municipalite', alias: '# de la municipalite' },\r\n        { name: 'date_observation', excludeFromOgcFilters: true },\r\n        { name: 'urgence', values: ['immdiate', 'inconnue'] }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          logical: 'Or',\r\n          filters: [\r\n            {\r\n              operator: 'PropertyIsEqualTo',\r\n              propertyName: 'code_municipalite',\r\n              expression: '10043'\r\n            },\r\n            {\r\n              operator: 'Intersects',\r\n              geometryName: 'the_geom',\r\n              wkt_geometry: `MULTIPOLYGON(((\r\n              -8379441.158019895 5844447.897707146,\r\n              -8379441.158019895 5936172.331649357,\r\n              -8134842.66750733 5936172.331649357,\r\n              -8134842.66750733 5844447.897707146,\r\n              -8379441.158019895 5844447.897707146\r\n            ), (\r\n              -8015003 5942074,\r\n              -8015003 5780349,\r\n              -7792364 5780349,\r\n              -7792364 5942074,\r\n              -8015003 5942074\r\n            )))`\r\n            }\r\n          ] as AnyBaseOgcFilterOptions[]\r\n        }\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasource)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (PropertyIsEqualTo OR Intersects)',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'orange',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilter: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2016-01-21T00:00:00-05:00',\r\n          end: '2016-01-26T00:00:00-05:00'\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2016-02-10T00:00:00-05:00',\r\n      stepDate: 'P2D'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilter)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: P2D)',\r\n            id: '1',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'red',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTime: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2016-01-01T04:00:00-05:00',\r\n          end: '2016-01-12T16:00:00-05:00'\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2016-02-14T20:00:00-05:00',\r\n      stepDate: 'PT4H'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTime)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: PT4H)',\r\n            id: '2',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'blue',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeMonth: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2016-01-01T00:00:00-05:00',\r\n          end: '2016-03-31T00:00:00-05:00',\r\n          displayFormat: 'MMMM'\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2018-12-31T00:00:00-05:00',\r\n      stepDate: 'P1M'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: P1M)',\r\n            id: '3',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'yellow',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeYear: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2014-01-01T00:00:00-05:00',\r\n          end: '2019-12-31T00:00:00-05:00',\r\n          sliderOptions: {\r\n            interval: 2000,\r\n            displayFormat: 'YY'\r\n          },\r\n          displayFormat: 'YYYY'\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2014-01-01T00:00:00-05:00',\r\n      maxDate: '2019-12-31T00:00:00-05:00',\r\n      stepDate: 'P1Y'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: P1Y)',\r\n            id: '4',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'green',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeInterval: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\r\n          end: 'today' // \"now\" can also be used. Instead of midnight, the current time will be used\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2025-12-31T00:00:00-05:00',\r\n      stepDate: 'P1D'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Interval from Now, Step: P1D)',\r\n            id: '5',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'black',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeRestrictedToStep: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2019-01-01 00:00:00',\r\n          restrictToStep: true\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2025-12-31T00:00:00-05:00',\r\n      stepDate: 'P1M'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, RestrictToStep, Step: P1M)',\r\n            id: '6',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'black'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'red',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const wmsOgcFilterOptions: WMSoptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      optionsFromCapabilities: true,\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation23avril2017_wmst',\r\n        VERSION: '1.3.0'\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation'\r\n        } as OgcFilterDuringOptions,\r\n        allowedOperatorsType: OgcFilterOperatorType.Time\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wmsOgcFilterOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Inondation (During, optionsFromCapabilities)',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WMSoptions\r\n      extends WMSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const filterableWMSwithPushButtons: WMSoptions = {\r\n      type: 'wms',\r\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n      params: {\r\n        LAYERS: 'radars_photos',\r\n        VERSION: '1.3.0'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        pushButtons: {\r\n          selectorType: 'pushButton',\r\n          order: 2,\r\n          groups: [\r\n            { title: 'Nom du group1 - push', name: '1 - push', ids: ['id1'] }\r\n          ],\r\n          bundles: [\r\n            {\r\n              id: 'id1',\r\n              title: 'Rgions',\r\n              logical: 'Or',\r\n              vertical: true,\r\n              selectors: [\r\n                {\r\n                  title: 'Montral & Laval',\r\n                  enabled: false,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    logical: 'Or',\r\n                    filters: [\r\n                      {\r\n                        operator: 'PropertyIsEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Montral'\r\n                      },\r\n                      {\r\n                        operator: 'PropertyIsEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Laval'\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Outside Montral & Laval',\r\n                  enabled: false,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    logical: 'And',\r\n                    filters: [\r\n                      {\r\n                        operator: 'PropertyIsNotEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Montral'\r\n                      },\r\n                      {\r\n                        operator: 'PropertyIsNotEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Laval'\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        },\r\n        checkboxes: {\r\n          selectorType: 'checkbox',\r\n          order: 1,\r\n          groups: [\r\n            {\r\n              title: 'Nom du group1 - checkbox',\r\n              name: '1 - checkbox',\r\n              ids: ['id1']\r\n            }\r\n          ],\r\n          bundles: [\r\n            {\r\n              id: 'id1',\r\n              title: 'Type de radar photo',\r\n              logical: 'Or',\r\n              selectors: [\r\n                {\r\n                  title: 'Radar photo fixe',\r\n                  enabled: true,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Radar photo fixe'\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Radar photo mobile',\r\n                  enabled: false,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Radar photo mobile'\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Radar photo fixe + feu rouge',\r\n                  enabled: false,\r\n                  color: '0,200,0',\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Radar feu rouge',\r\n                  enabled: false,\r\n                  color: '255,0,0',\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Appareil de surveillance au feu rouge'\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        },\r\n        allowedOperatorsType: OgcFilterOperatorType.Basic\r\n      },\r\n      paramsWFS: {\r\n        featureTypes: 'radars_photos',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '1.1.0',\r\n        outputFormat: 'geojson',\r\n        outputFormatDownload: 'shp'\r\n      } as WFSDataSourceOptionsParams\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(filterableWMSwithPushButtons)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title:\r\n              'Filterable WMS layers with predefined filters (push buttons)',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    // const datasourceWmsWith2Layers: WMSoptions = {\r\n    //   type: 'wms',\r\n    //   url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n    //   urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n    //   params: {\r\n    //     layers: 'stations_meteoroutieres,histo_stations_meteoroutieres',\r\n    //     version: '1.3.0'\r\n    //   },\r\n    //   ogcFilters: {\r\n    //     enabled: true,\r\n    //     editable: true\r\n    //   },\r\n    //   paramsWFS: {\r\n    //     featureTypes: 'histo_stations_meteoroutieres',\r\n    //     fieldNameGeometry: 'geometry',\r\n    //     maxFeatures: 10000,\r\n    //     version: '1.1.0',\r\n    //     outputFormat: 'geojson',\r\n    //     outputFormatDownload: 'shp'\r\n    //   } as WFSDataSourceOptionsParams\r\n    // };\r\n    //\r\n    // this.dataSourceService\r\n    //   .createAsyncDataSource(datasourceWmsWith2Layers)\r\n    //   .subscribe(dataSource => {\r\n    //     this.map.addLayer(\r\n    //       this.layerService.createLayer({\r\n    //         title: 'Layer build from 2 WMS layers',\r\n    //         source: dataSource\r\n    //       })\r\n    //     );\r\n    //   });\r\n\r\n    // const datasourceWms: WMSoptions = {\r\n    //   type: 'wms',\r\n    //   url: '/geoserver/wms',\r\n    //   urlWfs: '/geoserver/wfs',\r\n    //   params: {\r\n    //     LAYERS: 'water_areas',\r\n    //     VERSION: '1.3.0'\r\n    //   },\r\n    //   ogcFilters: {\r\n    //     enabled: true,\r\n    //     editable: true,\r\n    //     filters: {\r\n    //       operator: 'PropertyIsEqualTo',\r\n    //       propertyName: 'waterway',\r\n    //       expression: 'riverbank'\r\n    //     }\r\n    //   },\r\n    //   sourceFields: [\r\n    //     { name: 'waterway', alias: 'Chemin d eau' },\r\n    //     { name: 'osm_id' },\r\n    //     { name: 'landuse', values: ['yes', 'no'] }\r\n    //   ],\r\n    //   paramsWFS: {\r\n    //     featureTypes: 'water_areas',\r\n    //     fieldNameGeometry: 'the_geom',\r\n    //     maxFeatures: 10000,\r\n    //     version: '1.1.0',\r\n    //     outputFormat: 'application/json',\r\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\r\n    //   } as WFSDataSourceOptionsParams\r\n    // };\r\n    //\r\n    // this.dataSourceService\r\n    //   .createAsyncDataSource(datasourceWms)\r\n    //   .subscribe(dataSource => {\r\n    //     this.map.addLayer(\r\n    //       this.layerService.createLayer({\r\n    //         title: 'Geoserver water_areas',\r\n    //         source: dataSource\r\n    //       })\r\n    //     );\r\n    //   });\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Ogc filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/ogc-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-panel title=\"Layers\">\n            <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\n            </igo-ogc-filterable-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\nimport { AppOgcFilterRoutingModule } from './ogc-filter-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppOgcFilterComponent],\n  imports: [\n    AppOgcFilterRoutingModule,\n    SharedModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppOgcFilterComponent]\n})\nexport class AppOgcFilterModule {}\n","<app-doc-viewer\r\n  title=\"Spatial Filter\"\r\n  subtitle=\"Geo\"\r\n  [dependencies]=\"['LanguageService']\"\r\n>\r\n  <app-example-viewer codeFolder=\"geo/spatial-filter\">\r\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\r\n      <mat-grid-tile>\r\n        <igo-map-browser\r\n          [map]=\"map\"\r\n          [view]=\"view\"\r\n          igoOverlay\r\n          igoQuery\r\n          [queryFeatures]=\"true\"\r\n        >\r\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n        </igo-map-browser>\r\n      </mat-grid-tile>\r\n      <mat-grid-tile>\r\n        <div class=\"flex flex-col align-start h-100 w-100 overflow-y-auto\">\r\n          <igo-panel class=\"w-100\">\r\n            <igo-spatial-filter-type\r\n              [store]=\"spatialListStore\"\r\n              [selectedQueryType]=\"queryType\"\r\n              [zone]=\"zone\"\r\n              [layers]=\"activeLayers\"\r\n              (eventType)=\"getOutputType($event)\"\r\n              (eventQueryType)=\"getOutputQueryType($event)\"\r\n              (zoneChange)=\"onZoneChange($event)\"\r\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\r\n              (bufferChange)=\"buffer = $event\"\r\n              (measureUnitChange)=\"measureUnit = $event\"\r\n            >\r\n            </igo-spatial-filter-type>\r\n\r\n            <igo-spatial-filter-item\r\n              [type]=\"type\"\r\n              [queryType]=\"queryType\"\r\n              [map]=\"map\"\r\n              [zone]=\"zone\"\r\n              [loading]=\"loading\"\r\n              [store]=\"store\"\r\n              [layers]=\"activeLayers\"\r\n              [allLayers]=\"layers\"\r\n              [thematicLength]=\"thematicLength\"\r\n              (radiusEvent)=\"buffer = $event\"\r\n              (bufferEvent)=\"buffer = $event\"\r\n              (measureUnitChange)=\"measureUnit = $event\"\r\n              (freehandControl)=\"freehandDrawIsActive = $event\"\r\n              (drawZoneEvent)=\"zone = $event\"\r\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\r\n              (itemTypeChange)=\"itemType = $event\"\r\n              (thematicChange)=\"thematics = $event\"\r\n              (toggleSearch)=\"getOutputToggleSearch()\"\r\n              (clearButtonEvent)=\"clearMap()\"\r\n              (clearSearchEvent)=\"getOutputClearSearch()\"\r\n            >\r\n            </igo-spatial-filter-item>\r\n          </igo-panel>\r\n\r\n          <igo-panel class=\"w-100\">\r\n            <ng-container *ngIf=\"selectedFeature$ | async as feature\">\r\n              <igo-feature-details [feature]=\"feature\"></igo-feature-details>\r\n            </ng-container>\r\n          </igo-panel>\r\n        </div>\r\n      </mat-grid-tile>\r\n    </mat-grid-list>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'spatial-filter',\r\n    component: AppSpatialFilterComponent\r\n  }\r\n];\r\n\r\nexport const AppSpatialFilterRoutingModule = RouterModule.forChild(routes);\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\nimport { Observable, forkJoin, Subject } from 'rxjs';\r\nimport { tap, take, takeUntil } from 'rxjs/operators';\r\n\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  Feature,\r\n  moveToOlFeatures,\r\n  FeatureMotion,\r\n  ClusterDataSource,\r\n  featureToOl,\r\n  DataSource,\r\n  QueryableDataSourceOptions,\r\n  SpatialFilterService,\r\n  SpatialFilterType,\r\n  SpatialFilterItemType,\r\n  SpatialFilterQueryType,\r\n  SpatialFilterThematic,\r\n  Layer,\r\n  VectorLayer,\r\n  createOverlayMarkerStyle,\r\n  MeasureLengthUnit\r\n} from '@igo2/geo';\r\nimport { EntityStore, EntityStoreWithStrategy } from '@igo2/common';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport olSourceVector from 'ol/source/Vector';\r\nimport olSourceCluster from 'ol/source/Cluster';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport * as olstyle from 'ol/style';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\n\r\n/**\r\n * Spatial Filter Type\r\n */\r\n@Component({\r\n  selector: 'app-spatial-filter',\r\n  templateUrl: './spatial-filter.component.html',\r\n  styleUrls: ['./spatial-filter.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSpatialFilterComponent implements OnInit, OnDestroy {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  @Input() type: SpatialFilterType;\r\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\r\n  @Input() freehandDrawIsActive: boolean;\r\n\r\n  public layers: Layer[] = [];\r\n  public activeLayers: Layer[] = [];\r\n\r\n  public queryType: SpatialFilterQueryType;\r\n  public thematics: SpatialFilterThematic[];\r\n  public zone: Feature;\r\n  public zoneWithBuffer: Feature;\r\n  public buffer = 0;\r\n\r\n  public iterator = 1;\r\n\r\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  public store = new EntityStoreWithStrategy<Feature>([]); // Store to print results at the end\r\n\r\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\r\n\r\n  public loading = false;\r\n\r\n  public thematicLength = 0;\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n  private unsubscribe$ = new Subject<void>();\r\n\r\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\r\n\r\n  constructor(\r\n    private matIconRegistry: MatIconRegistry,\r\n    private spatialFilterService: SpatialFilterService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  ngOnInit() {\r\n    for (const layer of this.map.layers) {\r\n      if (\r\n        layer.title &&\r\n        layer.title.includes(\r\n          this.languageService.translate.instant(\r\n            'igo.geo.spatialFilter.spatialFilter'\r\n          )\r\n        )\r\n      ) {\r\n        this.layers.push(layer);\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribe$.next();\r\n    this.unsubscribe$.complete();\r\n  }\r\n\r\n  getOutputType(event: SpatialFilterType) {\r\n    this.type = event;\r\n    this.queryType = undefined;\r\n  }\r\n\r\n  getOutputQueryType(event: SpatialFilterQueryType) {\r\n    this.queryType = event;\r\n    if (this.queryType) {\r\n      this.loadFilterList();\r\n    }\r\n  }\r\n\r\n  private loadFilterList() {\r\n    this.spatialFilterService\r\n      .loadFilterList(this.queryType)\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe((features: Feature[]) => {\r\n        features.sort((a, b) => {\r\n          if (a.properties.nom < b.properties.nom) {\r\n            return -1;\r\n          }\r\n          if (a.properties.nom > b.properties.nom) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n        this.spatialListStore.clear();\r\n        this.spatialListStore.load(features);\r\n      });\r\n  }\r\n\r\n  getOutputToggleSearch() {\r\n    this.loadThematics();\r\n  }\r\n\r\n  getOutputClearSearch() {\r\n    this.zone = undefined;\r\n    this.queryType = undefined;\r\n  }\r\n\r\n  clearMap() {\r\n    this.map.removeLayers(this.layers);\r\n    this.layers = [];\r\n    this.activeLayers = [];\r\n    this.thematicLength = 0;\r\n    this.iterator = 1;\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      this.zone = undefined;\r\n      this.queryType = undefined;\r\n    }\r\n  }\r\n\r\n  private loadThematics() {\r\n    this.loading = true;\r\n    let zeroResults = true;\r\n    let thematics;\r\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\r\n      this.tryAddFeaturesToMap([this.zone]);\r\n    }\r\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\r\n      const theme: SpatialFilterThematic = {\r\n        name: ''\r\n      };\r\n      thematics = [theme];\r\n    } else {\r\n      thematics = this.thematics;\r\n    }\r\n    if (\r\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n      this.type !== SpatialFilterType.Point\r\n    ) {\r\n      this.buffer = this.buffer * 1000;\r\n    }\r\n    if (this.type === SpatialFilterType.Polygon) {\r\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\r\n    }\r\n\r\n    const observables$: Observable<Feature[]>[] = [];\r\n    thematics.forEach((thematic) => {\r\n      observables$.push(\r\n        this.spatialFilterService\r\n          .loadFilterItem(\r\n            this.zone,\r\n            this.itemType,\r\n            this.queryType,\r\n            thematic,\r\n            this.buffer\r\n          )\r\n          .pipe(\r\n            tap((features: Feature[]) => {\r\n              this.store.insertMany(features);\r\n              const featuresPoint: Feature[] = [];\r\n              const featuresLinePoly: Feature[] = [];\r\n              let idPoint;\r\n              let idLinePoly;\r\n              features.forEach((feature) => {\r\n                if (feature.geometry.type === 'Point') {\r\n                  feature.properties.longitude =\r\n                    feature.geometry.coordinates[0];\r\n                  feature.properties.latitude = feature.geometry.coordinates[1];\r\n                  featuresPoint.push(feature);\r\n                  idPoint = feature.meta.id;\r\n                } else {\r\n                  featuresLinePoly.push(feature);\r\n                  idLinePoly = feature.meta.id;\r\n                }\r\n              });\r\n\r\n              this.tryAddPointToMap(featuresPoint, idPoint);\r\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\r\n              if (features.length) {\r\n                zeroResults = false;\r\n                this.thematicLength += 1;\r\n                thematic.zeroResults = false;\r\n                this.cdRef.detectChanges();\r\n              } else {\r\n                thematic.zeroResults = true;\r\n              }\r\n\r\n              if (features.length >= 10000) {\r\n                this.messageService.alert(\r\n                  'igo.geo.spatialFilter.maxSizeAlert',\r\n                  'igo.geo.spatialFilter.warning',\r\n                  { timeOut: 10000 }\r\n                );\r\n              }\r\n            })\r\n          )\r\n      );\r\n    });\r\n\r\n    forkJoin(observables$)\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe(() => {\r\n        this.loading = false;\r\n        if (zeroResults) {\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.zeroResults',\r\n            'igo.geo.spatialFilter.warning',\r\n            { timeOut: 10000 }\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  onZoneChange(feature: Feature, buffer?: boolean) {\r\n    this.zone = feature;\r\n    if (feature) {\r\n      buffer\r\n        ? this.tryAddFeaturesToMap([feature], true)\r\n        : this.tryAddFeaturesToMap([feature]);\r\n      this.zoomToFeatureExtent(feature);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add zone feature to the map overlay\r\n   */\r\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\r\n    let i = 1;\r\n    for (const feature of features) {\r\n      if (this.type === SpatialFilterType.Predefined) {\r\n        for (const layer of this.layers) {\r\n          if (\r\n            layer.options._internal &&\r\n            layer.options._internal.code === feature.properties.code &&\r\n            !buffer\r\n          ) {\r\n            if (!layer.title?.startsWith('Zone')) {\r\n              const index = this.layers.indexOf(layer);\r\n              this.layers.splice(index, 1);\r\n            }\r\n            return;\r\n          }\r\n          if (layer.title?.startsWith('Zone')) {\r\n            this.activeLayers = [];\r\n            const index = this.layers.indexOf(layer);\r\n            this.layers.splice(index, 1);\r\n            this.map.removeLayer(layer);\r\n          }\r\n        }\r\n      } else {\r\n        if (buffer) {\r\n          for (const layer of this.activeLayers) {\r\n            if (\r\n              this.activeLayers.length === 1 &&\r\n              layer.title?.startsWith('Zone')\r\n            ) {\r\n              const index = this.layers.indexOf(layer);\r\n              this.layers.splice(index, 1);\r\n              this.map.removeLayer(layer);\r\n            }\r\n          }\r\n        }\r\n        this.activeLayers = [];\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith('Zone')) {\r\n          i++;\r\n        }\r\n      }\r\n      this.defaultStyle = (_feature, resolution) => {\r\n        const coordinates = (features[0] as any).coordinates;\r\n        return new olstyle.Style({\r\n          image: new olstyle.Circle({\r\n            radius: coordinates\r\n              ? this.buffer /\r\n                Math.cos((Math.PI / 180) * coordinates[1]) /\r\n                resolution\r\n              : undefined,\r\n            fill: new olstyle.Fill({\r\n              color: 'rgba(200, 200, 20, 0.2)'\r\n            }),\r\n            stroke: new olstyle.Stroke({\r\n              width: 1,\r\n              color: 'orange'\r\n            })\r\n          }),\r\n          stroke: new olstyle.Stroke({\r\n            width: 1,\r\n            color: 'orange'\r\n          }),\r\n          fill: new olstyle.Fill({\r\n            color: 'rgba(200, 200, 20, 0.2)'\r\n          })\r\n        });\r\n      };\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: ('Zone ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            workspace: { enabled: true },\r\n            _internal: {\r\n              code:\r\n                this.type === SpatialFilterType.Predefined\r\n                  ? feature.properties.code\r\n                  : undefined\r\n            },\r\n            source: dataSource,\r\n            visible: true\r\n          }) as VectorLayer;\r\n          const featuresOl = features.map((f) => {\r\n            return featureToOl(f, this.map.projection);\r\n          });\r\n          if (this.type !== SpatialFilterType.Predefined) {\r\n            const type =\r\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\r\n            featuresOl[0].set('nom', 'Zone', true);\r\n            featuresOl[0].set('type', type, true);\r\n          }\r\n          const ol = dataSource.ol as\r\n            | olSourceVector<OlGeometry>\r\n            | olSourceCluster;\r\n          ol.addFeatures(featuresOl);\r\n          olLayer.ol.setStyle(this.defaultStyle);\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.activeLayers.push(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add point features to the map\r\n   * Necessary to create clusters\r\n   */\r\n  private tryAddPointToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'cluster',\r\n          id,\r\n          queryable: true,\r\n          distance: 120,\r\n          meta: {\r\n            title: 'Cluster'\r\n          }\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: ClusterDataSource) => {\r\n          const icon = features[0].meta.icon;\r\n          let style: olstyle.Style;\r\n          if (!icon) {\r\n            style = createOverlayMarkerStyle();\r\n          } else {\r\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\r\n          }\r\n\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            source: dataSource,\r\n            visible: true,\r\n            style\r\n          });\r\n\r\n          const featuresOl = features.map((feature) => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceCluster;\r\n          ol.getSource().addFeatures(featuresOl);\r\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.layers.find((layer) => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.iterator = i;\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.pushLayer(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  private createSvgIcon(icon): olstyle.Style {\r\n    let style: olstyle.Style;\r\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe((svgObj) => {\r\n      const xmlSerializer = new XMLSerializer();\r\n      svgObj.setAttribute('width', '30');\r\n      svgObj.setAttribute('height', '30');\r\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\r\n      svgObj.setAttribute('stroke', 'white');\r\n      const svg = xmlSerializer.serializeToString(svgObj);\r\n      style = new olstyle.Style({\r\n        image: new olstyle.Icon({\r\n          src: 'data:image/svg+xml;utf8,' + svg\r\n        })\r\n      });\r\n    });\r\n    return style;\r\n  }\r\n  /**\r\n   * Try to add line or polygon features to the map\r\n   */\r\n  private tryAddLayerToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          id,\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            source: dataSource,\r\n            visible: true\r\n          });\r\n          const featuresOl = features.map((feature) => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceVector<OlGeometry>;\r\n          ol.addFeatures(featuresOl);\r\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.layers.find((layer) => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.pushLayer(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  zoomToFeatureExtent(feature) {\r\n    if (feature) {\r\n      const olFeature = this.format.readFeature(feature, {\r\n        dataProjection: feature.projection,\r\n        featureProjection: this.map.projection\r\n      });\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        [olFeature],\r\n        FeatureMotion.Zoom\r\n      );\r\n    }\r\n  }\r\n\r\n  pushLayer(layer) {\r\n    for (const lay of this.activeLayers) {\r\n      if (lay.id === layer.id) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.activeLayers.push(layer);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoPanelModule, IgoFormModule } from '@igo2/common';\r\nimport {\r\n  IgoMapModule,\r\n  IgoFilterModule,\r\n  IgoQueryModule,\r\n  IgoFeatureModule,\r\n  IgoFeatureDetailsModule\r\n} from '@igo2/geo';\r\nimport { IgoMessageModule } from '@igo2/core';\r\n\r\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\r\nimport { AppSpatialFilterRoutingModule } from './spatial-filter-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppSpatialFilterComponent],\r\n  imports: [\r\n    AppSpatialFilterRoutingModule,\r\n    SharedModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoMessageModule,\r\n    IgoQueryModule,\r\n    IgoFeatureModule,\r\n    IgoFeatureDetailsModule,\r\n    IgoFilterModule,\r\n    IgoFormModule\r\n  ],\r\n  exports: [AppSpatialFilterComponent]\r\n})\r\nexport class AppSpatialFilterModule {}\r\n","<app-doc-viewer title=\"Workspace\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/workspace\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\" class=\"m-b-16\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-workspace-selector\n      igoWorkspaceSelector\n      [store]=\"workspaceStore\"\n      [map]=\"map\"\n    >\n    </igo-workspace-selector>\n\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n      <igo-entity-table-paginator\n        *ngIf=\"workspace.inResolutionRange$ | async\"\n        [store]=\"workspace.entityStore\"\n        [paginatorOptions]=\"paginatorOptions\"\n        [entitySortChange$]=\"entitySortChange$\"\n        (paginatorChange)=\"paginatorChange($event)\"\n      >\n      </igo-entity-table-paginator>\n    </ng-container>\n\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n      <igo-actionbar\n        *ngIf=\"workspace.actionStore\"\n        [store]=\"workspace.actionStore\"\n        [horizontal]=\"true\"\n        [withToggleButton]=\"true\"\n        [withTitle]=\"true\"\n        [mode]=\"actionbarMode\"\n      >\n      </igo-actionbar>\n\n      <igo-entity-table\n        *ngIf=\"\n          workspace.entityStore &&\n          workspace.meta &&\n          workspace.meta.tableTemplate &&\n          (workspace.inResolutionRange$ | async)\n        \"\n        class=\"table-compact table-centered\"\n        [paginator]=\"workspacePaginator\"\n        [scrollBehavior]=\"scrollBehavior\"\n        [store]=\"workspace.entityStore\"\n        [template]=\"workspace.meta.tableTemplate\"\n      >\n      </igo-entity-table>\n      <mat-card-content\n        *ngIf=\"(workspace.inResolutionRange$ | async) === false\"\n      >\n        No data available at this scale. Please zoom in.\n      </mat-card-content>\n\n      <igo-workspace-widget-outlet\n        [workspace]=\"workspace\"\n      ></igo-workspace-widget-outlet>\n    </ng-container>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppWorkspaceComponent } from './workspace.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'workspace',\r\n    component: AppWorkspaceComponent\r\n  }\r\n];\r\n\r\nexport const AppWorkspaceRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\nimport { Observable, BehaviorSubject } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  ActionbarMode,\r\n  EntityRecord,\r\n  EntityTableScrollBehavior,\r\n  Workspace,\r\n  WorkspaceStore,\r\n  EntityTablePaginatorOptions\r\n} from '@igo2/common';\r\nimport {\r\n  IgoMap,\r\n  DataSourceService,\r\n  LayerService,\r\n  WFSDataSourceOptions\r\n} from '@igo2/geo';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { WorkspaceState } from '@igo2/integration';\r\n\r\n@Component({\r\n  selector: 'app-workspace',\r\n  templateUrl: './workspace.component.html',\r\n  styleUrls: ['./workspace.component.scss']\r\n})\r\nexport class AppWorkspaceComponent implements OnInit {\r\n  public workspacePaginator: MatPaginator;\r\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public paginatorOptions: EntityTablePaginatorOptions = {\r\n    pageSize: 5, // Number of items to display on a page.\r\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\r\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\r\n  };\r\n\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-72, 47.2],\r\n    zoom: 5\r\n  };\r\n\r\n  get workspaceStore(): WorkspaceStore {\r\n    return this.workspaceState.store;\r\n  }\r\n\r\n  public selectedWorkspace$: Observable<Workspace>;\r\n\r\n  public actionbarMode = ActionbarMode.Overlay;\r\n\r\n  public scrollBehavior = EntityTableScrollBehavior.Instant;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    public workspaceState: WorkspaceState\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.selectedWorkspace$ = this.workspaceStore.stateView\r\n      .firstBy$(\r\n        (record: EntityRecord<Workspace>) => record.state.selected === true\r\n      )\r\n      .pipe(\r\n        map((record: EntityRecord<Workspace>) => {\r\n          const entity = record === undefined ? undefined : record.entity;\r\n          if (entity) {\r\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\r\n            // The reason why it's has been remove is that this button trigger a tool (importExport)\r\n            // and this tool is not available in the igo2-lib demo.\r\n            // This is why it's has been removed frome the actions's list.\r\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\r\n            entity.actionStore.view.filter((action) => {\r\n              return action.id !== 'wfsDownload';\r\n            });\r\n          }\r\n          return entity;\r\n        })\r\n      );\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\r\n      type: 'wfs',\r\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n      params: {\r\n        featureTypes: 'etablissement_mtq',\r\n        fieldNameGeometry: 'geometry',\r\n        version: '2.0.0',\r\n        outputFormat: 'geojson'\r\n      },\r\n      sourceFields: [\r\n        { name: 'idetablis', alias: 'ID' },\r\n        { name: 'nometablis', alias: 'Name' },\r\n        { name: 'typetablis', alias: 'Type' }\r\n      ]\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        const layer = {\r\n          title: 'Simple WFS ',\r\n          maxResolution: 3000,\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n\r\n  paginatorChange(event: MatPaginator) {\r\n    this.workspacePaginator = event;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport {\r\n  IgoActionModule,\r\n  IgoEntityModule,\r\n  IgoWorkspaceModule,\r\n  IgoPanelModule\r\n} from '@igo2/common';\r\nimport { IgoMapModule, IgoGeoWorkspaceModule } from '@igo2/geo';\r\n\r\nimport { AppWorkspaceComponent } from './workspace.component';\r\nimport { AppWorkspaceRoutingModule } from './workspace-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppWorkspaceComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppWorkspaceRoutingModule,\r\n    IgoActionModule,\r\n    IgoEntityModule,\r\n    IgoWorkspaceModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoGeoWorkspaceModule\r\n  ],\r\n  exports: [AppWorkspaceComponent]\r\n})\r\nexport class AppWorkspaceModule {}\r\n","<app-doc-viewer\r\n  title=\"Context\"\r\n  subtitle=\"Context\"\r\n  [dependencies]=\"['LanguageService', 'mapService']\"\r\n>\r\n  <app-example-viewer codeFolder=\"context/context\" configFolder=\"contexts\">\r\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\r\n      <mat-grid-tile>\r\n        <igo-map-browser\r\n          igoMapContext\r\n          igoLayerContext\r\n          [map]=\"map\"\r\n          [view]=\"view\"\r\n        >\r\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n          <igo-geolocate-button\r\n            [map]=\"map\"\r\n            color=\"primary\"\r\n          ></igo-geolocate-button>\r\n          <igo-home-extent-button\r\n            [map]=\"map\"\r\n            color=\"primary\"\r\n          ></igo-home-extent-button>\r\n          <igo-rotation-button\r\n            [map]=\"map\"\r\n            [showIfNoRotation]=\"true\"\r\n            color=\"primary\"\r\n          ></igo-rotation-button>\r\n        </igo-map-browser>\r\n      </mat-grid-tile>\r\n      <mat-grid-tile>\r\n        <div class=\"flex flex-col align-start h-100 w-100\">\r\n          <igo-panel title=\"Contexts list\" class=\"h-100 w-100\">\r\n            <igo-context-list\r\n              igoContextListBinding\r\n              [map]=\"map\"\r\n            ></igo-context-list>\r\n          </igo-panel>\r\n\r\n          <igo-panel title=\"Layers\" class=\"h-100 w-100\">\r\n            <igo-layer-list igoLayerListBinding [map]=\"map\">\r\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\r\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\r\n              </ng-template>\r\n            </igo-layer-list>\r\n          </igo-panel>\r\n        </div>\r\n      </mat-grid-tile>\r\n    </mat-grid-list>\r\n  </app-example-viewer>\r\n\r\n  <app-example-viewer\r\n    title=\"Import/Export context\"\r\n    codeFolder=\"context/context\"\r\n    configFolder=\"contexts\"\r\n  >\r\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AppContextComponent } from './context.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'context',\r\n    component: AppContextComponent\r\n  }\r\n];\r\n\r\nexport const AppContextRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\nimport { ContextService } from '@igo2/context';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { IgoMap, MapService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-context',\r\n  templateUrl: './context.component.html',\r\n  styleUrls: ['./context.component.scss']\r\n})\r\nexport class AppContextComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private mapService: MapService,\r\n    private contextService: ContextService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n    this.contextService.loadDefaultContext();\r\n    this.contextService.loadContexts();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { HttpClientJsonpModule } from '@angular/common/http';\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoMetadataModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\nimport { IgoContextModule } from '@igo2/context';\n\nimport { AppContextComponent } from './context.component';\nimport { AppContextRoutingModule } from './context-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppContextComponent],\n  imports: [\n    HttpClientJsonpModule,\n    AppContextRoutingModule,\n    SharedModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoMetadataModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoContextModule\n  ],\n  exports: [AppContextComponent]\n})\nexport class AppContextModule {}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nconst routes: Routes = [\n  { path: '', redirectTo: '/home', pathMatch: 'full' },\n  { path: '**', redirectTo: '/home' }\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes, { useHash: true })],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule {}\n","import { MediaMatcher } from '@angular/cdk/layout';\r\nimport {\r\n  OnInit,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Inject,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { userAgent, DomUtils } from '@igo2/utils';\r\nimport { version } from '@igo2/core';\r\nimport { NavigationEnd, Router } from '@angular/router';\r\nimport { delay, first } from 'rxjs';\r\nimport { DOCUMENT } from '@angular/common';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss']\r\n})\r\nexport class AppComponent implements OnInit, OnDestroy {\r\n  mobileQuery: MediaQueryList;\r\n\r\n  public title = 'IGO';\r\n  public version = version;\r\n  private _mobileQueryListener: () => void;\r\n\r\n  constructor(\r\n    @Inject(DOCUMENT) private document: Document,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n    private media: MediaMatcher,\r\n    private router: Router\r\n  ) {\r\n    this.mobileQuery = this.media.matchMedia('(max-width: 600px)');\r\n    this._mobileQueryListener = () => this.changeDetectorRef.detectChanges();\r\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\r\n\r\n    this.detectOldBrowser();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.handleSplashScreen();\r\n  }\r\n\r\n  private handleSplashScreen(): void {\r\n    this.router.events\r\n      .pipe(\r\n        first((events) => events instanceof NavigationEnd),\r\n        delay(300)\r\n      )\r\n      .subscribe(() => {\r\n        this._removeSplashScreen();\r\n      });\r\n  }\r\n\r\n  private _removeSplashScreen(): void {\r\n    const intro = this.document.getElementById('splash-screen');\r\n    if (!intro) {\r\n      return;\r\n    }\r\n    intro.classList.add('is-destroying');\r\n\r\n    const destroyingAnimationTime = 300;\r\n    const stylesheet = this.document.getElementById('splash-screen-stylesheet');\r\n\r\n    setTimeout(() => {\r\n      DomUtils.remove(intro);\r\n      DomUtils.remove(stylesheet);\r\n    }, destroyingAnimationTime);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\r\n  }\r\n\r\n  private detectOldBrowser() {\r\n    const oldBrowser = userAgent.satisfies({\r\n      ie: '<=11',\r\n      chrome: '<64',\r\n      firefox: '<60'\r\n    });\r\n\r\n    if (oldBrowser) {\r\n      console.log('Very old browser ! ', userAgent.getBrowser());\r\n    }\r\n  }\r\n}\r\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\r\n  <mat-toolbar color=\"primary\" class=\"example-toolbar mat-elevation-z6\">\r\n    <button mat-icon-button (click)=\"snav.toggle()\">\r\n      <mat-icon svgIcon=\"menu\"></mat-icon>\r\n    </button>\r\n    <h1>{{ title }}</h1>\r\n    <h5 class=\"mat-subtitle-1 m-b-0\">{{ version.lib }}</h5>\r\n  </mat-toolbar>\r\n\r\n  <mat-sidenav-container\r\n    class=\"example-sidenav-container\"\r\n    [style.marginTop.px]=\"mobileQuery.matches ? 56 : 0\"\r\n  >\r\n    <mat-sidenav\r\n      #snav\r\n      opened=\"true\"\r\n      [mode]=\"mobileQuery.matches ? 'over' : 'side'\"\r\n      [fixedInViewport]=\"mobileQuery.matches\"\r\n      fixedTopGap=\"56\"\r\n    >\r\n      <mat-nav-list>\r\n        <a mat-list-item routerLink=\".\">Home</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"activity\">Activity</a>\r\n        <a mat-list-item routerLink=\"config\">Config</a>\r\n        <a mat-list-item routerLink=\"language\">Language</a>\r\n        <a mat-list-item routerLink=\"media\">Media</a>\r\n        <a mat-list-item routerLink=\"message\">Message</a>\r\n        <a mat-list-item routerLink=\"request\">Request</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"auth-form\">Authentification</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"action\">Action</a>\r\n        <a mat-list-item routerLink=\"dynamic-component\">Dynamic Component</a>\r\n        <a mat-list-item routerLink=\"entity-table\">Entity Table</a>\r\n        <a mat-list-item routerLink=\"entity-selector\">Entity Selector</a>\r\n        <a mat-list-item routerLink=\"form\">Form</a>\r\n        <a mat-list-item routerLink=\"table\">Table</a>\r\n        <a mat-list-item routerLink=\"tool\">Tool</a>\r\n        <a mat-list-item routerLink=\"widget\">Widget</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"simple-map\">Simple map</a>\r\n        <a mat-list-item routerLink=\"layer\">Layer</a>\r\n        <a mat-list-item routerLink=\"legend\">Legend</a>\r\n        <a mat-list-item routerLink=\"overlay\">Overlay</a>\r\n        <a mat-list-item routerLink=\"geometry\">Geometry</a>\r\n        <a mat-list-item routerLink=\"feature\">Feature</a>\r\n        <a mat-list-item routerLink=\"hover\">Hover</a>\r\n        <a mat-list-item routerLink=\"measure\">Measure</a>\r\n        <a mat-list-item routerLink=\"draw\">Draw</a>\r\n        <a mat-list-item routerLink=\"query\">Query</a>\r\n        <a mat-list-item routerLink=\"catalog\">Catalog</a>\r\n        <a mat-list-item routerLink=\"search\">Search</a>\r\n        <a mat-list-item routerLink=\"print\">Print</a>\r\n        <a mat-list-item routerLink=\"import-export\">Import/Export</a>\r\n        <a mat-list-item routerLink=\"directions\">Directions</a>\r\n        <a mat-list-item routerLink=\"time-filter\">Time filter</a>\r\n        <a mat-list-item routerLink=\"ogc-filter\">OGC filter</a>\r\n        <a mat-list-item routerLink=\"spatial-filter\">Spatial filter</a>\r\n        <a mat-list-item routerLink=\"workspace\">Workspace</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"context\">Context</a>\r\n      </mat-nav-list>\r\n    </mat-sidenav>\r\n\r\n    <mat-sidenav-content>\r\n      <router-outlet></router-outlet>\r\n    </mat-sidenav-content>\r\n  </mat-sidenav-container>\r\n</div>\r\n","import { BrowserModule, DomSanitizer } from '@angular/platform-browser';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\nimport {\r\n  APP_INITIALIZER,\r\n  ApplicationRef,\r\n  Injector,\r\n  NgModule\r\n} from '@angular/core';\r\nimport { HammerModule } from '@angular/platform-browser';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconRegistry, MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSidenavModule } from '@angular/material/sidenav';\r\nimport { MatToolbarModule } from '@angular/material/toolbar';\r\nimport { AppHomeModule } from './core/home/home.module';\r\nimport { AppActivityModule } from './core/activity/activity.module';\r\nimport { AppConfigModule } from './core/config/config.module';\r\nimport { AppLanguageModule } from './core/language/language.module';\r\nimport { AppMediaModule } from './core/media/media.module';\r\nimport { AppMessageModule } from './core/message/message.module';\r\nimport { AppRequestModule } from './core/request/request.module';\r\n\r\nimport { AppActionModule } from './common/action/action.module';\r\nimport { AppDynamicComponentModule } from './common/dynamic-component/dynamic-component.module';\r\nimport { AppEntityTableModule } from './common/entity-table/entity-table.module';\r\nimport { AppEntitySelectorModule } from './common/entity-selector/entity-selector.module';\r\nimport { AppFormModule } from './common/form/form.module';\r\nimport { AppTableModule } from './common/table/table.module';\r\nimport { AppToolModule } from './common/tool/tool.module';\r\nimport { AppWidgetModule } from './common/widget/widget.module';\r\n\r\nimport { AppAuthFormModule } from './auth/auth-form/auth-form.module';\r\n\r\nimport { AppSimpleMapModule } from './geo/simple-map/simple-map.module';\r\nimport { AppLayerModule } from './geo/layer/layer.module';\r\nimport { AppLegendModule } from './geo/legend/legend.module';\r\nimport { AppOverlayModule } from './geo/overlay/overlay.module';\r\nimport { AppGeometryModule } from './geo/geometry/geometry.module';\r\nimport { AppFeatureModule } from './geo/feature/feature.module';\r\nimport { AppHoverModule } from './geo/hover/hover.module';\r\nimport { AppMeasureModule } from './geo/measure/measure.module';\r\nimport { AppDrawModule } from './geo/draw/draw.module';\r\nimport { AppQueryModule } from './geo/query/query.module';\r\nimport { AppCatalogModule } from './geo/catalog/catalog.module';\r\nimport { AppSearchModule } from './geo/search/search.module';\r\nimport { AppPrintModule } from './geo/print/print.module';\r\nimport { AppImportExport } from './geo/import-export/import-export.module';\r\nimport { AppDirectionsModule } from './geo/directions/directions.module';\r\nimport { AppTimeFilterModule } from './geo/time-filter/time-filter.module';\r\nimport { AppOgcFilterModule } from './geo/ogc-filter/ogc-filter.module';\r\nimport { AppSpatialFilterModule } from './geo/spatial-filter/spatial-filter.module';\r\nimport { AppWorkspaceModule } from './geo/workspace/workspace.module';\r\n\r\nimport { AppContextModule } from './context/context/context.module';\r\n\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { AppComponent } from './app.component';\r\nimport { IgoCoreModule, LanguageService } from '@igo2/core';\r\nimport {\r\n  MatTooltipDefaultOptions,\r\n  MAT_TOOLTIP_DEFAULT_OPTIONS\r\n} from '@angular/material/tooltip';\r\nimport { concatMap, first } from 'rxjs';\r\nimport { DatePipe } from '@angular/common';\r\nimport { MAT_FORM_FIELD_DEFAULT_OPTIONS } from '@angular/material/form-field';\r\n\r\nexport const defaultTooltipOptions: MatTooltipDefaultOptions = {\r\n  showDelay: 500,\r\n  hideDelay: 0,\r\n  touchendHideDelay: 0,\r\n  disableTooltipInteractivity: true\r\n};\r\n\r\n@NgModule({\r\n  declarations: [AppComponent],\r\n  imports: [\r\n    IgoCoreModule,\r\n    BrowserModule,\r\n    BrowserAnimationsModule,\r\n    MatSidenavModule,\r\n    MatToolbarModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n\r\n    AppHomeModule,\r\n    AppActivityModule,\r\n    AppConfigModule,\r\n    AppLanguageModule,\r\n    AppMediaModule,\r\n    AppMessageModule,\r\n    AppRequestModule,\r\n\r\n    AppActionModule,\r\n    AppDynamicComponentModule,\r\n    AppEntityTableModule,\r\n    AppEntitySelectorModule,\r\n    AppFormModule,\r\n    AppTableModule,\r\n    AppToolModule,\r\n    AppWidgetModule,\r\n\r\n    AppAuthFormModule,\r\n\r\n    AppSimpleMapModule,\r\n    AppLayerModule,\r\n    AppLegendModule,\r\n    AppOverlayModule,\r\n    AppGeometryModule,\r\n    AppFeatureModule,\r\n    AppHoverModule,\r\n    AppMeasureModule,\r\n    AppDrawModule,\r\n    AppQueryModule,\r\n    AppCatalogModule,\r\n    AppSearchModule,\r\n    AppPrintModule,\r\n    AppImportExport,\r\n    AppDirectionsModule,\r\n    AppTimeFilterModule,\r\n    AppOgcFilterModule,\r\n    AppSpatialFilterModule,\r\n    AppWorkspaceModule,\r\n\r\n    AppContextModule,\r\n    AppRoutingModule,\r\n\r\n    HammerModule\r\n  ],\r\n  providers: [\r\n    {\r\n      provide: MAT_FORM_FIELD_DEFAULT_OPTIONS,\r\n      useValue: { appearance: 'outline' }\r\n    },\r\n    {\r\n      provide: APP_INITIALIZER,\r\n      useFactory: appInitializerFactory,\r\n      deps: [Injector, ApplicationRef],\r\n      multi: true\r\n    },\r\n    { provide: MAT_TOOLTIP_DEFAULT_OPTIONS, useValue: defaultTooltipOptions },\r\n    DatePipe\r\n  ],\r\n  bootstrap: [AppComponent]\r\n})\r\nexport class AppModule {\r\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\r\n    matIconRegistry.addSvgIconSet(\r\n      domSanitizer.bypassSecurityTrustResourceUrl(\r\n        './assets/igo2/core/icons/mdi.svg'\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\nexport function appInitializerFactory(\r\n  injector: Injector,\r\n  applicationRef: ApplicationRef\r\n) {\r\n  return () =>\r\n    new Promise<any>((resolve: any) => {\r\n      applicationRef.isStable\r\n        .pipe(\r\n          first((isStable) => isStable === true),\r\n          concatMap(() => {\r\n            const languageService = injector.get(LanguageService);\r\n            const lang = languageService.getLanguage();\r\n            return languageService.translate.getTranslation(lang);\r\n          })\r\n        )\r\n        .subscribe((translations) => {\r\n          const languageService = injector.get(LanguageService);\r\n          const lang = languageService.getLanguage();\r\n          languageService.translate.setTranslation(lang, translations);\r\n          resolve();\r\n        });\r\n    });\r\n}\r\n","import { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\n\r\nimport 'hammerjs';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nplatformBrowserDynamic()\r\n  .bootstrapModule(AppModule)\r\n  .catch((err) => console.log(err));\r\n","var map = {\n\t\"./af\": 35528,\n\t\"./af.js\": 35528,\n\t\"./ar\": 1036,\n\t\"./ar-dz\": 17579,\n\t\"./ar-dz.js\": 17579,\n\t\"./ar-kw\": 69588,\n\t\"./ar-kw.js\": 69588,\n\t\"./ar-ly\": 11650,\n\t\"./ar-ly.js\": 11650,\n\t\"./ar-ma\": 93258,\n\t\"./ar-ma.js\": 93258,\n\t\"./ar-sa\": 54085,\n\t\"./ar-sa.js\": 54085,\n\t\"./ar-tn\": 90287,\n\t\"./ar-tn.js\": 90287,\n\t\"./ar.js\": 1036,\n\t\"./az\": 89757,\n\t\"./az.js\": 89757,\n\t\"./be\": 59620,\n\t\"./be.js\": 59620,\n\t\"./bg\": 31139,\n\t\"./bg.js\": 31139,\n\t\"./bm\": 4042,\n\t\"./bm.js\": 4042,\n\t\"./bn\": 19641,\n\t\"./bn-bd\": 19126,\n\t\"./bn-bd.js\": 19126,\n\t\"./bn.js\": 19641,\n\t\"./bo\": 494,\n\t\"./bo.js\": 494,\n\t\"./br\": 20934,\n\t\"./br.js\": 20934,\n\t\"./bs\": 26274,\n\t\"./bs.js\": 26274,\n\t\"./ca\": 45831,\n\t\"./ca.js\": 45831,\n\t\"./cs\": 92354,\n\t\"./cs.js\": 92354,\n\t\"./cv\": 79692,\n\t\"./cv.js\": 79692,\n\t\"./cy\": 58774,\n\t\"./cy.js\": 58774,\n\t\"./da\": 38955,\n\t\"./da.js\": 38955,\n\t\"./de\": 21557,\n\t\"./de-at\": 24954,\n\t\"./de-at.js\": 24954,\n\t\"./de-ch\": 81881,\n\t\"./de-ch.js\": 81881,\n\t\"./de.js\": 21557,\n\t\"./dv\": 16475,\n\t\"./dv.js\": 16475,\n\t\"./el\": 38877,\n\t\"./el.js\": 38877,\n\t\"./en-au\": 70454,\n\t\"./en-au.js\": 70454,\n\t\"./en-ca\": 67356,\n\t\"./en-ca.js\": 67356,\n\t\"./en-gb\": 10456,\n\t\"./en-gb.js\": 10456,\n\t\"./en-ie\": 28789,\n\t\"./en-ie.js\": 28789,\n\t\"./en-il\": 85471,\n\t\"./en-il.js\": 85471,\n\t\"./en-in\": 39664,\n\t\"./en-in.js\": 39664,\n\t\"./en-nz\": 97672,\n\t\"./en-nz.js\": 97672,\n\t\"./en-sg\": 80805,\n\t\"./en-sg.js\": 80805,\n\t\"./eo\": 87390,\n\t\"./eo.js\": 87390,\n\t\"./es\": 1564,\n\t\"./es-do\": 51473,\n\t\"./es-do.js\": 51473,\n\t\"./es-mx\": 92089,\n\t\"./es-mx.js\": 92089,\n\t\"./es-us\": 84156,\n\t\"./es-us.js\": 84156,\n\t\"./es.js\": 1564,\n\t\"./et\": 6513,\n\t\"./et.js\": 6513,\n\t\"./eu\": 7856,\n\t\"./eu.js\": 7856,\n\t\"./fa\": 2378,\n\t\"./fa.js\": 2378,\n\t\"./fi\": 22687,\n\t\"./fi.js\": 22687,\n\t\"./fil\": 80032,\n\t\"./fil.js\": 80032,\n\t\"./fo\": 46845,\n\t\"./fo.js\": 46845,\n\t\"./fr\": 8875,\n\t\"./fr-ca\": 56425,\n\t\"./fr-ca.js\": 56425,\n\t\"./fr-ch\": 41746,\n\t\"./fr-ch.js\": 41746,\n\t\"./fr.js\": 8875,\n\t\"./fy\": 67037,\n\t\"./fy.js\": 67037,\n\t\"./ga\": 11217,\n\t\"./ga.js\": 11217,\n\t\"./gd\": 37010,\n\t\"./gd.js\": 37010,\n\t\"./gl\": 51931,\n\t\"./gl.js\": 51931,\n\t\"./gom-deva\": 64488,\n\t\"./gom-deva.js\": 64488,\n\t\"./gom-latn\": 8032,\n\t\"./gom-latn.js\": 8032,\n\t\"./gu\": 34984,\n\t\"./gu.js\": 34984,\n\t\"./he\": 69090,\n\t\"./he.js\": 69090,\n\t\"./hi\": 42085,\n\t\"./hi.js\": 42085,\n\t\"./hr\": 38787,\n\t\"./hr.js\": 38787,\n\t\"./hu\": 2901,\n\t\"./hu.js\": 2901,\n\t\"./hy-am\": 59819,\n\t\"./hy-am.js\": 59819,\n\t\"./id\": 44074,\n\t\"./id.js\": 44074,\n\t\"./is\": 70715,\n\t\"./is.js\": 70715,\n\t\"./it\": 31746,\n\t\"./it-ch\": 77040,\n\t\"./it-ch.js\": 77040,\n\t\"./it.js\": 31746,\n\t\"./ja\": 3180,\n\t\"./ja.js\": 3180,\n\t\"./jv\": 34346,\n\t\"./jv.js\": 34346,\n\t\"./ka\": 65538,\n\t\"./ka.js\": 65538,\n\t\"./kk\": 79772,\n\t\"./kk.js\": 79772,\n\t\"./km\": 87905,\n\t\"./km.js\": 87905,\n\t\"./kn\": 79125,\n\t\"./kn.js\": 79125,\n\t\"./ko\": 69140,\n\t\"./ko.js\": 69140,\n\t\"./ku\": 2354,\n\t\"./ku.js\": 2354,\n\t\"./ky\": 63768,\n\t\"./ky.js\": 63768,\n\t\"./lb\": 14016,\n\t\"./lb.js\": 14016,\n\t\"./lo\": 83169,\n\t\"./lo.js\": 83169,\n\t\"./lt\": 62353,\n\t\"./lt.js\": 62353,\n\t\"./lv\": 83243,\n\t\"./lv.js\": 83243,\n\t\"./me\": 52338,\n\t\"./me.js\": 52338,\n\t\"./mi\": 35555,\n\t\"./mi.js\": 35555,\n\t\"./mk\": 85794,\n\t\"./mk.js\": 85794,\n\t\"./ml\": 53151,\n\t\"./ml.js\": 53151,\n\t\"./mn\": 46458,\n\t\"./mn.js\": 46458,\n\t\"./mr\": 69165,\n\t\"./mr.js\": 69165,\n\t\"./ms\": 8680,\n\t\"./ms-my\": 87477,\n\t\"./ms-my.js\": 87477,\n\t\"./ms.js\": 8680,\n\t\"./mt\": 79684,\n\t\"./mt.js\": 79684,\n\t\"./my\": 40285,\n\t\"./my.js\": 40285,\n\t\"./nb\": 45922,\n\t\"./nb.js\": 45922,\n\t\"./ne\": 29040,\n\t\"./ne.js\": 29040,\n\t\"./nl\": 5066,\n\t\"./nl-be\": 74460,\n\t\"./nl-be.js\": 74460,\n\t\"./nl.js\": 5066,\n\t\"./nn\": 53693,\n\t\"./nn.js\": 53693,\n\t\"./oc-lnc\": 88676,\n\t\"./oc-lnc.js\": 88676,\n\t\"./pa-in\": 92341,\n\t\"./pa-in.js\": 92341,\n\t\"./pl\": 57416,\n\t\"./pl.js\": 57416,\n\t\"./pt\": 84344,\n\t\"./pt-br\": 30113,\n\t\"./pt-br.js\": 30113,\n\t\"./pt.js\": 84344,\n\t\"./ro\": 72643,\n\t\"./ro.js\": 72643,\n\t\"./ru\": 61305,\n\t\"./ru.js\": 61305,\n\t\"./sd\": 96095,\n\t\"./sd.js\": 96095,\n\t\"./se\": 74486,\n\t\"./se.js\": 74486,\n\t\"./si\": 58742,\n\t\"./si.js\": 58742,\n\t\"./sk\": 96722,\n\t\"./sk.js\": 96722,\n\t\"./sl\": 3345,\n\t\"./sl.js\": 3345,\n\t\"./sq\": 52416,\n\t\"./sq.js\": 52416,\n\t\"./sr\": 39450,\n\t\"./sr-cyrl\": 50501,\n\t\"./sr-cyrl.js\": 50501,\n\t\"./sr.js\": 39450,\n\t\"./ss\": 32222,\n\t\"./ss.js\": 32222,\n\t\"./sv\": 9454,\n\t\"./sv.js\": 9454,\n\t\"./sw\": 19638,\n\t\"./sw.js\": 19638,\n\t\"./ta\": 96494,\n\t\"./ta.js\": 96494,\n\t\"./te\": 94435,\n\t\"./te.js\": 94435,\n\t\"./tet\": 25003,\n\t\"./tet.js\": 25003,\n\t\"./tg\": 13706,\n\t\"./tg.js\": 13706,\n\t\"./th\": 16025,\n\t\"./th.js\": 16025,\n\t\"./tk\": 59780,\n\t\"./tk.js\": 59780,\n\t\"./tl-ph\": 22068,\n\t\"./tl-ph.js\": 22068,\n\t\"./tlh\": 39167,\n\t\"./tlh.js\": 39167,\n\t\"./tr\": 32494,\n\t\"./tr.js\": 32494,\n\t\"./tzl\": 58707,\n\t\"./tzl.js\": 58707,\n\t\"./tzm\": 91296,\n\t\"./tzm-latn\": 34532,\n\t\"./tzm-latn.js\": 34532,\n\t\"./tzm.js\": 91296,\n\t\"./ug-cn\": 12086,\n\t\"./ug-cn.js\": 12086,\n\t\"./uk\": 85069,\n\t\"./uk.js\": 85069,\n\t\"./ur\": 29304,\n\t\"./ur.js\": 29304,\n\t\"./uz\": 95115,\n\t\"./uz-latn\": 97609,\n\t\"./uz-latn.js\": 97609,\n\t\"./uz.js\": 95115,\n\t\"./vi\": 34802,\n\t\"./vi.js\": 34802,\n\t\"./x-pseudo\": 65605,\n\t\"./x-pseudo.js\": 65605,\n\t\"./yo\": 88456,\n\t\"./yo.js\": 88456,\n\t\"./zh-cn\": 23272,\n\t\"./zh-cn.js\": 23272,\n\t\"./zh-hk\": 9402,\n\t\"./zh-hk.js\": 9402,\n\t\"./zh-mo\": 48101,\n\t\"./zh-mo.js\": 48101,\n\t\"./zh-tw\": 40262,\n\t\"./zh-tw.js\": 40262\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;"],"x_google_ignoreList":[812]}