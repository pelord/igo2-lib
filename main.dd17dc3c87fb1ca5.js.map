{"version":3,"file":"main.dd17dc3c87fb1ca5.js","mappings":"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mB,GACAxnO,GAEAyuP,gBAkBSR,CAAS,KAUhB,SAAUG,GACdl8P,EACAw8P,GAEA,MAAO,IACL,IAAIrhQ,QAAcnK,IAChBwrQ,EAAeC,SACZ9lQ,QACC0K,MAAOo7P,IAA0B,IAAbA,IAAiB,EACrCvpL,MAAU,KACR,MAAMjzE,EAAkBD,EAAS/H,IAAImH,GAC/B7C,EAAO0D,EAAgBR,cAC7B,OAAOQ,EAAgBZ,UAAU/C,eAAeC,EAAI,IAGvDhG,UAAWoG,IACV,MAAMsD,EAAkBD,EAAS/H,IAAImH,GAC/B7C,EAAO0D,EAAgBR,cAC7BQ,EAAgBZ,UAAUq9P,eAAengQ,EAAMI,GAC/C3L,GAAO,EACR,EAET,CCvKI4kP,GAAYC,eACd8mB,SAGFC,QACGC,gBAAgBd,IAChBpiP,MAAOjH,GAAQ9X,QAAQU,IAAIoX,uBCd9B,IAAA9qB,GAAA,CACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,mBACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,YACA,eACA,YACA,eACA,YACA,eACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,sBACA,kBACA,qBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,gBACA,mBACA,eACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,cACA,iBACA,aACA,gBACA,cACA,iBACA,cACA,mBACA,sBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,eACA,kBACA,gBACA,mBACA,gBACA,oBAIA,SAAAk1Q,EAAAhlQ,GACA,IAAAxJ,EAAAyuQ,GAAAjlQ,GACA,OAAAklQ,EAAA1uQ,EACA,CACA,SAAAyuQ,GAAAjlQ,GACA,IAAAklQ,EAAA9wQ,EAAAtE,GAAAkQ,GAAA,CACA,IAAAs0B,EAAA,IAAAx2B,MAAA,uBAAAkC,EAAA,KACA,MAAAs0B,EAAAkvD,KAAA,mBACAlvD,CACA,CACA,OAAAxkC,GAAAkQ,EACA,CACAglQ,EAAA3tQ,KAAA,WACA,OAAAE,OAAAF,KAAAvH,GACA,EACAk1Q,EAAA9rQ,QAAA+rQ,GACAE,GAAAC,QAAAJ,EACAA,EAAAxuQ,GAAA","names":["Base64","static","getByte","s","i","charCodeAt","getByte64","this","ALPHA","indexOf","charAt","decode","b10","pads","imax","length","x","String","PADCHAR","push","fromCharCode","join","encode","customCacheHasher","parameters","map","param","HttpParams","toString","undefined","JSON","parse","stringify","userAgent","Bowser","window","navigator","Clipboard","copy","element","successful","textArea","createTextArea","selectText","copyTextToClipboard","destroyTextArea","text","document","createElement","value","body","appendChild","removeChild","getOSName","oldContentEditable","contentEditable","oldReadOnly","readOnly","range","createRange","selection","getSelection","contenteditable","readonly","selectNodeContents","removeAllRanges","addRange","setSelectionRange","select","compareVersion","execCommand","ChangeType","ADDED","DELETED","MODIFIED","StringUtils","diff","s1","s2","p","changeData","getChanges","nextS","slice","mtc","ins","sbs","nextThis","del","result","getMatchingSubstring","l","m","match","slen","o","fis","isThisLonger","longer","shorter","bi","split","len","cd","fil","sub","rc","rotateArray","array","n","res","Array","isValidNumber","isNaN","Number","isOctalNumber","startsWith","ChangeUtils","findChanges","obj1","obj2","ignoreKeys","items","added","deleted","modified","obj1Clone","obj2Clone","fromItem","index","findIndex","id","change","type","toItem","splice","fromItemClone","toItemClone","keysChanged","compareObject","oldValue","newValue","itemAdded","baseKey","keys","Set","Object","forEach","key","keyString","isArray","concat","DomUtils","create","doc","tagName","options","el","remove","node","parentNode","downloadContent","content","mimeType","fileName","downloadFromUri","uri","setAttribute","style","display","click","encodeURIComponent","ObjectUtils","resolve","obj","keysArray","replace","current","shift","isObject","item","Date","mergeDeep","target","source","ignoreUndefined","output","assign","filter","copyDeep","src","prop","hasOwnProperty","removeDuplicateCaseInsensitive","summaryCapitalizeObject","capitalizeObject","upperCaseCount","property","upperCaseProperty","toUpperCase","count","capitalizedProperty","capitalizedPropertyObject","singlePossibility","paramClosestToLowercase","f","toLowerCase","reduce","prev","y","removeUndefined","removeNull","naturalCompare","a","b","direction","nullsFirst","nullScore","ax","bx","_","$1","$2","Infinity","an","bn","nn","localeCompare","objectsAreEquivalent","obj1Props","getOwnPropertyNames","obj2Props","removeKeys","_obj","isEmpty","NumberUtils","roundToNDecimal","num","decimal","roundFactor","Math","pow","round","strEnum","S4","random","substring","uuid","SubjectStatus","Error","Done","Working","Waiting","Watcher","status$","Subject","status$$","status","_status","next","subscribe","callback","scope","watch","pipe","distinctUntilChanged","handleStatusChange","call","unsubscribe","unwatch","ActivityService","counter$","BehaviorSubject","ids","constructor","register","unregister","factory","fac","providedIn","ActivityInterceptor","activityService","intercept","req","activity","headers","get","actReq","clone","delete","handle","finalize","i0","i1","IgoActivityModule","forRoot","ngModule","providers","provide","HTTP_INTERCEPTORS","useClass","multi","CONFIG_DEPRECATED","showMenuButton","alternativeKey","mayBeRemoveIn","menuButtonReverseColor","importWithStyle","hasGeolocateButton","ALTERNATE_CONFIG_FROM_DEPRECATION","Map","entries","deprecatedKey","version","lib","releaseDate","ConfigService","config","httpClient","configDeprecated","handler","HttpClient","getConfigs","from","handleDeprecatedConfig","getConfig","defaultValue","handleDeprecationPossibility","message","console","error","warn","load","baseConfig","default","path","Promise","_reject","catchError","log","throwError","configResponse","CONFIG_OPTIONS","InjectionToken","provideConfigOptions","useValue","configFactory","configService","IgoConfigModule","APP_INITIALIZER","useFactory","deps","LanguageLoader","prefix","suffix","getTranslation","lang","igoLocale$","appLocale$","forkJoin","translations","acc","defaultLanguageLoader","http","provideDefaultLanguageLoader","loader","TranslateLoader","HttpBackend","IgoMissingTranslationHandler","params","translateService","langs","substr","IgoLanguageModule","TranslateModule","missingTranslationHandler","MissingTranslationHandler","IgoMessageModule","CommonModule","ToastrModule","positionClass","timeOut","extendedTimeOut","titleClass","messageClass","closeButton","progressBar","enableHtml","tapToDismiss","maxOpened","preventDuplicates","resetTimeoutOnDuplicate","countDuplicates","includeTitleDuplicates","MessageType","ERROR","ALERT","WARNING","INFO","SUCCESS","SHOW","LanguageService","translate","language","language$","getBrowserLang","getLanguage","setDefaultLang","setLanguage","combineLatest","use","reloadLang","MessageService","injector","languageService","messages$","activeMessageTranslations","debounceTime","r","toastr","toasts","toast","activeMessageTranslation","find","amt","toastId","translatedTextInterpolateParams","textInterpolateParams","translatedTitleInterpolateParams","titleInterpolateParams","k","instant","textKey","titleKey","first","toastRef","componentInstance","title","ToastrService","showError","httpError","caught","messageType","toastrConfig","iconClasses","currentDate","to","showIcon","handleTemplate","messageShown","success","info","show","alert","handleNgxToastr","translatedTitlenterpolateParams","translatedTitle","activeToast","warning","removeAllAreNotError","mess","template","html","Injector","i2","ErrorInterceptor","messageService","originalReq","interceptError","errorContainer","handleError","toDisplay","handleCaughtError","handleUncaughtError","HttpErrorResponse","errorObj","statusText","url","IgoErrorModule","parentModule","dbConfig","name","objectStoresMeta","store","storeConfig","keyPath","autoIncrement","storeSchema","keypath","unique","IgoCoreModule","matIconRegistry","domSanitizer","addSvgIconSet","bypassSecurityTrustResourceUrl","HttpClientModule","NgxIndexedDBModule","ROUTE_SERVICE_OPTIONS","RouteService","router","route","centerKey","zoomKey","projectionKey","contextKey","searchKey","visibleOnLayersKey","visibleOffLayersKey","directionsCoordKey","directionsOptionsKey","toolKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","vectorKey","queryParams","decodeURIComponent","location","search","includes","pair","navigate","Media","Mobile","Tablet","Desktop","MediaOrientation","Portrait","Landscape","MediaService","media$","orientation$","breakpointObserver","observe","Breakpoints","HandsetLandscape","matches","HandsetPortrait","TabletLandscape","TabletPortrait","WebLandscape","WebPortrait","getMedia","getOrientation","isTouchScreen","documentElement","isMobile","isDesktop","StorageScope","SESSION","LOCAL","StorageServiceEventEnum","REMOVED","CLEARED","BaseStorage","storageChange$","sessionStorage","getItem","localStorage","set","previousValue","setItem","currentValue","event","removeItem","clear","StorageService","super","getNumber","v","endposition","CompressionService","base64Index","indexBase64","generateBase64Index","compressBlob","blob","Observable","observer","reader","FileReader","readAsDataURL","onload","base64","valueOf","text64","compressed","compressStringBase64","object","decompressBlob","compressedData","decompressed","decompressStringBase64","byteCharacters","atob","byteNumbers","byteArray","Uint8Array","Blob","out","bits","chr","rem","c","j","NetworkService","stateChangeEventEmitter","EventEmitter","onlineSubscription","offlineSubscription","previousMessageId","state","connection","onLine","checkNetworkState","fromEvent","messageObj","emitEvent","emit","ngOnDestroy","currentState","reportState","startWith","RegexService","getAll","routes","redirectTo","pathMatch","AppRoutingModule","RouterModule","useHash","AppComponent","changeDetectorRef","media","mobileQuery","_mobileQueryListener","matchMedia","detectChanges","addEventListener","detectOldBrowser","ngOnInit","handleSplashScreen","events","NavigationEnd","delay","_removeSplashScreen","intro","getElementById","classList","add","stylesheet","setTimeout","removeEventListener","satisfies","ie","chrome","firefox","getBrowser","DOCUMENT","selectors","decls","vars","consts","rf","ctx","_r1","_r0","toggle","TokenService","tokenKey","token","jwtDecode","isExpired","jwt","currentTime","getTime","exp","AuthService","tokenService","authenticate$","logged$","redirectUrl","languageForce","anonymous","authOptions","hasAuthService","authenticated","globalCacheBusterNotifier","login","username","password","myHeader","HttpHeaders","encodePassword","loginCall","loginWithToken","infosUser","typeConnection","loginAnonymous","of","refresh","post","tap","data","err","logout","isAuthenticated","getToken","decodeToken","goToRedirectUrl","loginRoute","navigateByUrl","homeRoute","getUserInfo","getProfils","updateUser","user","patch","logged","isAnonymous","isAdmin","tokenDecoded","locale","i3","i4","AuthGoogleComponent","authService","appRef","apiKey","clientId","loadSDKGoogle","loadPlatform","handleSignInClick","gapi","auth2","getAuthInstance","signIn","handleSignOutClick","signOut","handleClientLoad","initClient","client","init","discoveryDocs","then","updateTextButton","isSignedIn","listen","rep","updateSigninStatus","loginGoogle","access_token","btn","querySelector","innerHTML","tick","fjs","getElementsByTagName","js","insertBefore","outputs","_r3","ctx_r2","ctx_r0","loading","ctx_r1","AuthInternComponent","auth","allowAnonymous","_allowAnonymous","form","fb","group","Validators","required","loginUser","values","errorMsg","inputs","AuthInternComponent_button_18_Template","AuthInternComponent_div_19_Template","AuthFacebookComponent","appId","loadSDKFacebook","subscribeEvents","FB","Event","statusChangeCallback","response","loginFacebook","authResponse","accessToken","AuthMicrosoftComponent","msalService","msalGuardConfig","_destroying$","broadcastService","instance","PublicClientApplication","cache","cacheLocation","MsalBroadcastService","inProgress$","InteractionStatus","None","takeUntil","checkAccount","loginMicrosoft","loginPopup","getConf","authRequest","setActiveAccount","account","_this","acquireTokenSilent","tokenId","idToken","catch","_ref","_asyncToGenerator","InteractionRequiredAuthError","acquireTokenPopup","_x","apply","arguments","conf","MSAL_GUARD_CONFIG","MsalServiceb2c","redirectHash","logger","hash","pop","initializeWrapperLibrary","WrapperSKU","Angular","initialize","request","acquireTokenRedirect","silentRequest","handleRedirectObservable","handleRedirectPromise","loginRedirect","logoutRequest","logoutRedirect","logoutPopup","ssoSilent","getLogger","setLogger","MSAL_INSTANCE","MsalBroadcastServiceb2c","msalInstance","_msalSubject","msalSubject$","_inProgress","asObservable","Startup","addEventCallback","EventMessageUtils","getInteractionStatusFromEvent","verbose","eventType","AuthMicrosoftb2cComponent","browserAuthOptions","loginMicrosoftb2c","_r11","ctx_r10","onLogin","_r13","ctx_r12","_r15","ctx_r14","_r17","ctx_r16","_r19","ctx_r18","ctx_r9","AuthFormComponent_div_0_div_2_igo_auth_google_4_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoft_5_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoftb2c_6_Template","AuthFormComponent_div_0_div_2_igo_auth_facebook_7_Template","AuthFormComponent_div_0_div_2_igo_auth_intern_8_Template","google","enabled","microsoft","microsoftb2c","facebook","intern","_r21","ctx_r20","ctx_r3","_r24","ctx_r23","home","AuthFormComponent_div_0_div_4_button_4_Template","ctx_r4","AuthFormComponent_div_0_div_1_Template","AuthFormComponent_div_0_div_2_Template","AuthFormComponent_div_0_div_3_Template","AuthFormComponent_div_0_div_4_Template","backgroundDisable","showLoginDiv","showAlreadyConnectedDiv","showLogoutDiv","AuthFormComponent","isLogoutRoute","_backgroundDisable","hasAlreadyConnectedDiv","_hasAlreadyConnectedDiv","hasLogoutDiv","_hasLogoutDiv","_showAlreadyConnectedDiv","_showLogoutDiv","visible","isLoginRoute","analyzeRoute","getName","logoutRoute","firstName","sourceId","NavigationStart","changeEvent","currentRoute","AuthFormComponent_div_0_Template","AuthInterceptor","refreshInProgress","trustHosts","hostsWithCredentials","hostsWithAuthByKey","hostname","hostsByKey","withCredentials","handleHostsWithCredentials","hostWithKey","handleHostsAuthByKey","refreshToken","href","host","authReq","hashUser","Md5","hashStr","interceptXhr","xhr","setRequestHeader","alterUrlWithKeyAuth","urlDecomposed","urlWithKeyAdded","paramsToKeep","reqUrl","hostWithCredentials","RegExp","domainRegFilters","test","hostWithAuthByKey","keyProperty","keyValue","MSALConfigFactory","msConf","redirectUri","authority","MSALConfigFactoryb2c","MSALAngularConfigFactory","interactionType","InteractionType","Popup","scopes","loginHint","MSALAngularConfigFactoryb2c","provideAuthMicrosoft","MsalService","AuthStorageService","userIgo","preference","mergePreference","IgoAuthModule","ReactiveFormsModule","MatFormFieldModule","MatInputModule","MatIconModule","MatButtonModule","MsalModule","DocViewerModule","MatCardModule","ExampleModule","MatDividerModule","MatTooltipModule","SharedModule","MatGridListModule","codeUrl","configUrl","SRC_PATH","ExampleViewerComponent","codeFolder","configFolder","ngContentSelectors","_c0","ExampleViewerComponent_a_5_Template","ExampleViewerComponent_a_6_Template","dep_r2","DocViewerComponent_ng_container_5_li_4_Template","dependencies","DocViewerComponent","subtitle","DocViewerComponent_ng_container_5_Template","AppAuthFormRoutingModule","forChild","component","AppAuthFormComponent","idsActivity","AppAuthFormModule","IgoActionbarModule","MatMenuModule","MatListModule","MatCheckboxModule","IgoActionModule","IgoMatBadgeIconModule","MatBadgeModule","IgoCollapsibleModule","ConfirmDialogComponent","dialogRef","confirmMessage","close","ConfirmDialogService","dialog","open","disableClose","afterClosed","IgoConfirmDialogModule","imports","MatDialogModule","IgoContextMenuModule","IgoCustomHtmlModule","DOMService","getDom","dom","toPromise","IgoDOMModule","IgoDrapDropModule","IgoDynamicOutletModule","DynamicComponent","componentFactory","componentRef","subscriptions","inputs$$","subscribers","setTarget","createComponent","updateInputs","updateSubscribers","destroy","unobserveAllInputs","unsubscribeAll","propName","unobserveInput","inputValue","observeInput","setInputValue","onUpdateInputs","prototype","getPrototypeOf","descriptor","getOwnPropertyDescriptor","emitter","subscriber","_subscriber","observable","DynamicComponentService","resolver","componentCls","resolveComponentFactory","IgoDynamicComponentModule","IgoFlexibleModule","IgoFormFieldModule","FormsModule","MatSelectModule","IgoFormGroupModule","IgoFormFormModule","FormFieldService","fields","getFieldByType","FormService","formBuilder","groups","control","field","addControl","validator","validators","getValidators","setValidators","disabled","extendFieldConfig","partial","validatorOption","validatorStr","getValidator","IgoFormModule","IgoEntitySelectorModule","IgoEntityTablePaginatorModule","MatPaginatorModule","IgoImageModule","IgoStopPropagationModule","IgoEntityTableModule","MatTableModule","MatAutocompleteModule","MatSortModule","MatDatepickerModule","IgoEntityModule","InteractiveTourLoader","jsonURL","allToursOptions","getPathToConfigFile","loadConfigTour","getJSON","e","getTourOptionData","toolName","nameInConfigFile","InteractiveTourService","mediaService","interactiveTourLoader","shepherdService","previousStep","nextIndex","isAppHaveTour","haveTour","isToolHaveTourConfig","disabledTourButton","stepConfig","conditions","condition","isTourDisplayInMobile","showInMobile","getButtons","buttonKind","classes","getAction","actionName","addProgress","self","nbTry","checkExist","setInterval","getCurrentStep","attachTo","cancel","clearInterval","currentStepElement","getElement","querySelectorAll","header","stepsArray","steps","progress","className","innerText","checkNext","tour","service","complete","nextStep","_setupModal","executeAction","step","actionConfig","action","executeActionPromise","waitFor","maxTry","maxWait","getShepherdSteps","shepherdSteps","on","position","floatingUIOptions","middleware","offset","mainAxis","beforeShowPromise","all","beforeChange","beforeShow","buttons","noBackButton","class","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","hide","onHide","startTour","defaultStepOptions","cancelIcon","modal","confirmCancel","addSteps","tourObject","start","IgoInteractiveTourModule","IgoKeyValueModule","IgoClickoutModule","IgoListModule","IgoPanelModule","IgoSpinnerModule","MatProgressSpinnerModule","IgoTableModule","CdkTableModule","EntityTableColumnRenderer","Default","HTML","UnsanitizedHTML","Editable","Icon","ButtonGroup","EntityTableScrollBehavior","Auto","Instant","Smooth","EntityTableSelectionState","All","Some","getEntityProperty","entity","t","safeObject","getEntityId","meta","idProperty","getEntityTitle","titleProperty","getEntityIcon","icon","iconProperty","EntityStateManager","change$","ReplaySubject","getKey","size","setMany","entities","setAll","update","changes","exclusive","updateMany","updateManyExclusive","reverse","reverseMany","reversedChanges","reverseChanges","updateAll","allKeys","getAllKeys","some","changeKey","bunch","storeKeys","EntityView","source$","values$","values$$","lifted","joins","filter$","filters$","filterIndex","sort$","getKey$","count$","empty$","empty","_index","all$","firstBy","clause","firstBy$","manyBy","manyBy$","sort","createIndex","addFilter","removeFilter","lift","observables$","liftJoinedSource","liftSource","skip","_values","filters","processValues","setValues","sources$","joinData","computeJoinedValue","joinIndex","filterValues","sortValues","clauses","every","v1","v2","valueAccessor","generateIndex","EntityStore","entities$","view","stateView","getProperty","pristine","_pristine","createStateManager","createDataView","createStateView","softClear","updateCount","insert","insertMany","deleteMany","currentRecord","statesAreTheSame","revision","ref","record","newState","currentStateIsEmpty","newStateIsEmpty","EntityStoreWithStrategy","strategies","addStrategy","strategy","activate","_strategy","bindStore","removeStrategy","unbindStore","getStrategyOfType","activateStrategyOfType","deactivateStrategyOfType","deactivate","EntityStoreWatcher","cdRef","innerStateIndex","entities$$","state$$","setChangeDetector","setStore","teardownObservers","setupObservers","onEntitiesChange","onStateChange","changesDetected","storeIndex","innerIndex","storeValue","innerValue","EntityStoreStrategy","stores","active","active$","doDeactivate","doActivate","EntityStoreFilterCustomFuncStrategy","filterStore","unfilterStore","filterAll","unfilterAll","filterClauseFunc","filterId","EntityStoreFilterSelectionStrategy","has","selected","emptyValue","emptyText","multiSelectValue","multiText$","record_r3","titleAccessor","EntitySelectorComponent","selected$","selected$$","watcher","multiAllText","multiNoneText","placeholder","selectedChange","records","onSelectFromStore","onSelectionChange","multiSelect","_value","updateMultiToggleWithEntities","$event","EntitySelectorComponent_mat_option_3_Template","EntitySelectorComponent_mat_option_4_Template","EntitySelectorComponent_ng_template_5_Template","StopPropagationDirective","onClick","stopPropagation","hostBindings","EntityTablePaginatorComponent","hidePageSize","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","count$$","entitySortChange$$","paginationLabelTranslation$$","entitySortChange$","paginatorOptions","page","paginatorChange","paginator","ngOnChanges","emitPaginator","firstPage","initPaginatorOptions","translateLabels","label","_intl","firstPageLabel","getRangeLabel","rangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","startIndex","max","min","viewQuery","MatPaginator","ImageErrorDirective","errorImageUrl","hideError","onError","nativeElement","EntityTableRowDirective","renderer","selectOnClick","highlightSelection","_selected","toggleSelected","scroll","scrollBehavior","addCls","selectedCls","highlightedCls","removeCls","scrollIntoView","scrollMode","behavior","block","inline","cls","addClass","removeClass","SanitizeHtmlPipe","_sanitizer","transform","bypassSecurityTrustHtml","pure","SecureImagePipe","activityInterceptor","regexDepot","responseType","switchMap","onloadend","_r10","onToggleRows","checked","selectionState_r8","ctx_r7","entityTableSelectionState","EntityTableComponent_th_3_ng_container_1_ng_container_1_Template","ctx_r6","selectionState$","EntityTableComponent_th_3_ng_container_1_Template","selectMany","shiftKey","preventDefault","row_r11","_r14","$implicit","ctx_r13","onShiftToggleRow","rowIsSelected","ctx_r15","onToggleRow","column_r16","tooltip","EntityTableComponent_ng_container_5_ng_container_1_th_1_Template","EntityTableComponent_ng_container_5_ng_container_2_th_1_Template","row_r31","cellData","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_ng_template_3_Template","isImg","_r38","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_Template","isUrl","_r33","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_Template","row_r47","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_ng_template_3_Template","_r54","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_Template","_r49","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_Template","_r79","row_r63","ctx_r77","onDateChange","_r76","_r85","onFocus","onChange","onBlur","_r93","ctx_r91","onValueChange","ctx_r69","getValidationAttributeValue","_r99","ctx_r97","ctx_r70","_r105","ctx_r103","onBooleanValueChange","option_r110","_r113","ctx_r111","onSelectValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_mat_option_1_Template","ctx_r72","multiple","domainValues","ctx_r73","_r74","option_r119","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_div_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_checkbox_5_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_7_Template","_r122","ctx_r120","onAutocompleteValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_option_10_Template","ctx_r64","formGroup","filteredOptions","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_ng_template_3_Template","_r132","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_td_0_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_Template","_r127","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_Template","ctx_r62","isEdition","_r65","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_Template","_r147","row_r142","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_Template","_r162","button_r156","row_r154","ctx_r160","onButtonClick","color","_r167","ctx_r165","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_Template","ctx_r155","editMode","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_Template","columnRenderer_r24","ctx_r19","entityTableColumnRenderer","EntityTableComponent_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_Template","columnIsSortable","getColumnRenderer","getHeaderClass","row_r173","_r175","ctx_r174","onRowSelect","ctx_r176","onRowClick","getRowClass","_r178","ctx_r177","ctx_r5","__decorate","Cacheable","maxCacheCount","tslib_es6","w6","Function","EntityTableComponent","_focusMonitor","_elementRef","ngControl","_parentForm","_controlName","_defaultErrorStateMatcher","dateAdapter","UntypedFormGroup","selection$$","dataSource$$","lastRecordCheckedKey","_paginator","dataSource","sortNullsFirst","withPaginator","entityClick","entitySelectChange","entitySortChange","columns","column","selectionCheckbox","MatTableDataSource","fixedHeader","tableHeight","setLocale","handleDatasource","getColumnKeyWithoutPropertiesTag","properties","controls","setValue","option","viewValue","moment","format","enableEdit","validation","mandatory","setControl","parseInt","valueChanges","filterNormalized","normalize","formControlValue","linkColumnForce","date","utc","newKey","disable","unsubscribeStore","firstSelected","firstSelectedStateviewPosition","pageMax","pageToReach","floor","computeSelectionState","getValue","getCellClass","getTrackByFunction","onSort","selectNode","stopImmediatePropagation","recordIndex","lastRecordChecked","indexes","_record","selectedRecords","selectionCount","sortable","list_id","list_option","edition","validationType","getTableClass","func","headerClassFunc","rowClassFunc","tableFunc","cellClassFunc","columnFunc","clickFunc","features","MatFormFieldControl","useExisting","EntityTableComponent_th_3_Template","EntityTableComponent_td_4_Template","EntityTableComponent_ng_container_5_Template","EntityTableComponent_tr_6_Template","EntityTableComponent_tr_7_Template","EntityTableComponent_igo_entity_table_paginator_8_Template","Toolbox","activeTool$","toolbar$","activeTool$$","activeToolHistory","tool","tools$","setToolbar","toolbar","initStore","getTool","getTools","setTools","tools","getToolbar","activateTool","activatePreviousTool","deactivateTool","previous","clearActiveToolHistory","setActiveTool","ToolService","toolbox","IgoToolboxModule","IgoToolModule","WidgetService","dynamicComponentService","widgetCls","IgoWidgetOutletModule","IgoWidgetModule","IgoWorkspaceSelectorModule","IgoWorkspaceWidgetOutletModule","IgoWorkspaceModule","ColorPickerFormFieldModule","OverlayModule","ColorChromeModule","ActionbarMode","Dock","Overlay","Context","ActionStore","icon$","ActionbarItemComponent_mat_list_item_0_button_4_mat_icon_2_Template","disabled$","withIcon","_r6","ActionbarItemComponent_mat_list_item_0_button_4_Template","ActionbarItemComponent_mat_list_item_0_span_5_Template","withTooltip","tooltip$","ngClass$","withTitle","_r9","ctx_r8","checkCondition$","ActionbarItemComponent_mat_list_item_1_mat_checkbox_4_Template","ActionbarItemComponent","noDisplay$","ngClass$$","disabled$$","availability$$","icon$$","checkCondition$$","tooltip$$","noDisplay$$","display$$","noDisplay","trigger","args","ngClass","updateNgClass","isObservable","updateIcon","checkCondition","updateCheckCondition","updateTooltip","availability","available","ActionbarItemComponent_mat_list_item_0_Template","ActionbarItemComponent_mat_list_item_1_Template","checkbox","_r8","scrollUp","onTriggerAction","toggleCollapseAction","action_r13","ActionbarComponent_mat_list_0_3_ng_template_0_Template","scrollDown","ActionbarComponent_mat_list_0_div_1_Template","ActionbarComponent_mat_list_0_igo_actionbar_item_2_Template","ActionbarComponent_mat_list_0_3_Template","ActionbarComponent_mat_list_0_div_4_Template","heightCondition","positionConditionTop","withToggleButton","collapsed","positionConditionLow","action_r20","_r22","ctx_r21","ActionbarComponent_div_1_ng_template_7_Template","_r18","iconColor","overlayClass","xPosition","yPosition","action_r24","_r26","ctx_r25","ActionbarComponent_mat_card_2_ng_template_2_Template","ActionbarComponent","overlay","elRef","actionbarMode","heightCondition$","positionConditionTop$","positionConditionLow$","mode","horizontal","scrollActive","_overlayClass","isCollapsed","withTitleClass","withIconClass","horizontalClass","clientHeight","scrollHeight","scrollTop","scrollBy","hostVars","ActionbarComponent_mat_list_0_Template","ActionbarComponent_div_1_Template","ActionbarComponent_mat_card_2_Template","LongPressDirective","touchTimeout","touchDuration","onlyIOS","longpress","touchstart","touches","touchEnd","touchend","clearTimeout","DynamicOutletComponent","dynamicComponent","eq","inputsAreEquivalents","subscribersAreEquivalents","renderComponent","ViewContainerRef","DynamicOutletComponent_ng_template_0_Template","IgoFormFieldComponent","compType","formControlIsRequired","getControlErrorMessage","messages","errorMessages","errors","getFieldComponent","getFieldInputs","getFieldSubscribers","FormFieldComponent","formFieldService","fieldInputs","fieldSubscribers","fieldOptions","disableSwitch","formControl","FormFieldComponent_ng_container_0_Template","getFieldNgClass","field_r3","FormGroupComponent_div_0_div_1_Template","getErrorMessage","FormGroupComponent","getFieldColSpan","colSpan","cols","FormGroupComponent_div_0_Template","FormGroupComponent_mat_error_3_Template","onDisableSwitchClick","FormFieldTextComponent","toggleDisabled","enable","FormFieldTextComponent_mat_icon_2_Template","FormFieldTextComponent_mat_error_3_Template","choice_r3","_r5","FormFieldSelectComponent","choices","choices$","FormFieldSelectComponent_mat_option_2_Template","FormFieldSelectComponent_mat_icon_4_Template","FormFieldSelectComponent_mat_error_5_Template","FormFieldTextareaComponent","FormFieldTextareaComponent_mat_icon_3_Template","FormFieldTextareaComponent_mat_error_4_Template","FormComponent","formData","autocomplete","submitForm","hasButtons","children","setData","onSubmit","getData","getAllFormFields","updateDataWithFormField","reset","_c2","FlexibleComponent","main","initial","_initial","_collapsed","expanded","_expanded","initialMobile","_initialMobile","collapsedMobile","_collapsedMobile","expandedMobile","_expandedMobile","_direction","_state","sizes","setSize","transitionTime","mediaService$$","height","width","startInteractiveTour","getClass","_r7","discoverTitleInLocale$","InteractiveTourComponent_ng_container_0_button_1_Template","InteractiveTourComponent_ng_container_0_ng_template_2_Template","styleButton","_r2","InteractiveTourComponent","interactiveTourService","toolService","tourToStart","getTourToStart","activeToolName","isActiveTool","isToolHaveTour","showTourButton","inMobileAndShow","InteractiveTourComponent_ng_container_0_Template","SpinnerComponent","shown$","shown","SpinnerActivityDirective","spinner","counter$$","TableActionColor","primary","accent","TableDataSource","DataSource","_database","_model","_sort","_filterChange","connect","merge","dataChange","sortChange","getFilteredData","getSortedData","disconnect","filterable","propertyA","propertyB","masterToggle","hasValue","isAllSelected","row_r12","isSelected","TableComponent_ng_container_8_ng_container_1_th_1_Template","TableComponent_ng_container_8_ng_container_2_th_1_Template","ctx_r26","model","row_r27","_c1","TableComponent_ng_container_8_ng_container_3_td_1_Template","ctx_r29","row_r30","TableComponent_ng_container_8_ng_template_4_td_0_Template","TableComponent_ng_container_8_ng_container_1_Template","TableComponent_ng_container_8_ng_container_2_Template","TableComponent_ng_container_8_ng_container_3_Template","TableComponent_ng_container_8_ng_template_4_Template","_r20","action_r34","_r36","row_r32","ctx_r35","handleClickAction","ctx_r33","getActionColor","TableComponent_td_11_button_1_Template","actions","row_r38","_r40","ctx_r39","TableComponent","database","hasFilterInput","_hasFIlterInput","displayedColumns","SelectionModel","displayed","unshift","changed","ngAfterViewInit","colorId","row","MatSort","TableComponent_div_1_Template","TableComponent_th_6_Template","TableComponent_td_7_Template","TableComponent_ng_container_8_Template","TableComponent_th_10_Template","TableComponent_td_11_Template","TableComponent_tr_12_Template","TableComponent_tr_13_Template","TableDatabase","copiedData","ToolComponent","ToolboxColor","White","Grey","Primary","toolSlideInOut","speed","transition","animate","actionStore","toolbarWithTitle$","_r4","onAnimationStart","onAnimationComplete","animation$","tool_r2","getToolInputs","ToolboxComponent","isActive","toolbar$$","animating$","animating$$","classColorGrey","classColorPrimary","onToolbarChange","onActiveToolChange","onAnimate","_tool","_toolbox","activeTool","toolActivated","childrenToolActivated","parent","unAnimate","animation","ToolboxComponent_igo_actionbar_0_Template","ToolboxComponent_div_2_Template","changeDetection","widget","getEffectiveSubscribers","WidgetOutletComponent","baseSubscribers","onCancel","onComplete","destroyWidget","baseSubscriber","WidgetOutletComponent_igo_dynamic_outlet_0_Template","WorkspaceStore","activeWorkspace$","activateWorkspace","workspace","deactivateWorkspace","Workspace","widget$","widgetInputs$","widgetSubscribers$","entityStore","hasWidget","deactivateWidget","activateWidget","WorkspaceSelectorComponent","getWorkspaceTitle","onSelectedChange","widget_r1","ngIf","onWidgetCancel","onWidgetComplete","WorkspaceWidgetOutletComponent","WorkspaceWidgetOutletComponent_ng_container_0_Template","handleChange","handleClick","colorPicker","ColorPickerFormFieldComponent","isOpen","formatColor","onTouch","outputFormat","writeValue","registerOnChange","fn","registerOnTouched","rgb","tinycolor","toHexString","toRgbString","toHsvString","NG_VALUE_ACCESSOR","forwardRef","ColorPickerFormFieldComponent_ng_template_5_Template","AppActionRoutingModule","AppActionComponent","added$","AppActionModule","AppSalutationComponent","AppExplanationComponent","AppDynamicComponentRoutingModule","AppDynamicComponentComponent","toggleComponent","AppDynamicComponentModule","selected_r1","description","AppEntitySelectorRoutingModule","AppEntitySelectorComponent","getTitle","AppEntitySelectorComponent_div_3_Template","AppEntitySelectorModule","AppEntityTableRoutingModule","AppEntityTableComponent","image","AppEntityTableModule","fillForm","clearForm","form_r1","data$","submitDisabled","AppFormRoutingModule","AppFormComponent","formService","form$","valueChanges$$","valid","AppFormComponent_igo_form_2_Template","AppFormModule","AppTableRoutingModule","AppTableComponent","showName","handleSelect","rows","AppTableModule","cursorPointer","PanelComponent","withHeader","_withHeader","PanelComponent_div_0_Template","AppSalutationToolComponent","ChangeDetectorRef","AppAboutToolComponent","AppToolRoutingModule","AppToolComponent","panelTitle","activateSalutationTool","AppToolComponent_button_3_Template","AppToolComponent_button_5_Template","AppToolModule","AppSalutationWidgetComponent","AppWidgetRoutingModule","AppWidgetComponent","widgetService","AppWidgetModule","IgoContextImportExportModule","MatButtonToggleModule","MatTabsModule","MatOptionModule","PoiService","baseUrl","EMPTY","context","IgoContextMapButtonModule","stringToLonLat","str","mapProjection","opts","lonLat","coordStr","negativeLon","degreesLon","minutesLon","secondsLon","directionLon","decimalLon","negativeLat","degreesLat","minutesLat","secondsLat","directionLat","decimalLat","zone","radius","lon","lat","projectionStr","projectionRegex","lonlatCoord","lonLatPattern","lonLatRegex","dmsCoord","dmsCoordPattern","dmsRegex","patternUtm","utmRegex","patternMtm","mtmRegex","ddCoord","patternDd","ddRegex","dmdCoord","patternDmd","dmdRegex","patternBELL","bellRegex","mmCoord","mmPattern","mmRegex","isXYCoords","toLocaleUpperCase","trim","parseFloat","convertDMSToDD","epsgUtm","olproj","epsgMtm","forceNA","dest","abs","degrees","minutes","seconds","neg","dd","convertDDToDMS","lonLatDD","lonLatDMS","ceil","int","toFixed","formatScale","scale","getResolutionFromScale","dpi","inchesPerMeter","ctrlKeyDown","originalEvent","altKey","MAC","metaKey","ctrlKey","roundCoordTo","coord","roundCoordToString","createOverlayMarkerStyle","opacity","markerColor","markerOutlineColor","svgIconColor","svgOutlineColor","svg","newColor","ColorAsArray","newOutlineColor","olstyle","anchor","font","fill","stroke","overflow","StyleService","createStyle","feature","resolution","olStyle","parsedStyle","parseStyle","getText","labelMinResolution","labelMaxResolution","labelMinResolutionFromScale","minScaleDenom","labelMaxResolutionFromScale","maxScaleDenom","minResolution","maxResolution","attribute","setText","getLabel","styleOptions","olCls","getOlCls","_key","olKey","getOlKey","createStyleByAttribute","styleByAttribute","guessTypeFeature","labelStyle","baseStyle","val","getStyle","OlFeature","createClusterStyle","clusterParam","layerStyle","clusterRanges","minRadius","maxRadius","showRange","dynamicRadius","clusterRadius","radiusMin","getRadius","image_","setRadius","radiusCalc","labelMatch","labelToGet","matchAll","getGeometry","getType","layerIsQueryable","layer","queryable","olLayerFeatureIsQueryable","olLayer","layerFeatureIsQueryable","queryLayerFeatures","Layer","authInterceptor","geoDBService","layerDBService","legend","legendCollapsed","firstLoadComponent","ol","olLoadingProblem","hasBeenVisible$","hasBeenVisible$$","resolution$$","isIgoInternalLayer","alias","zIndex","getZIndex","setZIndex","baseLayer","setOpacity","isInResolutionsRange","isInResolutionsRange$","setMaxResolution","updateInResolutionsRange","getMaxResolution","setMinResolution","getMinResolution","setVisible","visible$","showOnEachLayerVisibility","showMessage","displayed$","showInLayerList","createOlLayer","legendOptions","setLegend","setMap","unobserveResolution","observeResolution","viewController","resolution$","getResolution","LinkedProperties","OPACITY","VISIBLE","OGCFILTERS","MINRESOLUTION","MAXRESOLUTION","ZINDEX","TIMEFILTER","TooltipType","TITLE","ABSTRACT","CUSTOM","ImageWatcher","loaded","handleLoadStart","handleLoadEnd","handleLoadError","un","__watchers__","watcherIndex","params_","LAYERS","TileWatcher","tile","generateIdFromSourceOptions","wms","generateWMSIdFromSourceOptions","wmts","generateWMTSIdFromSourceOptions","xyz","generateXYZIdFromSourceOptions","generateFeatureIdFromSourceOptions","wfs","generateWfsIdFromSourceOptions","arcgisrest","generateArcgisRestIdFromSourceOptions","imagearcgisrest","tilearcgisrest","osm","_options","tiledebug","generateId","layers","chain","standardizeUrl","featureTypes","origin","urlStandardized","dataService","createOlSource","getLegend","FeatureDataSource","sourceOptions","getSourceFormatFromOptions","olSourceVector","olFormatCls","formatType","olformat","formatOptions","onUnwatch","queryTitle","ClusterDataSource","olSourceCluster","VectorWatcher","olSource","getUrl","ImageLayer","valStatus","olOptions","olLayerImage","getSource","setImageLoadFunction","customLoader","interceptor","XMLHttpRequest","alteredUrlWithKeyAuth","abort","getImage","arrayBufferView","TextDecoder","imageUrl","URL","createObjectURL","send","TileLayer","tileLayer","olLayerTile","tileSource","setTileLoadFunction","modifiedUrl","OgcFilterOperatorType","BasicNumericOperator","Basic","BasicAndSpatial","Spatial","Time","OgcFilterOperator","BBOX","PropertyIsBetween","Contains","During","PropertyIsEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","Intersects","PropertyIsNull","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsLike","PropertyIsNotEqualTo","Within","And","Or","Not","OgcFilterWriter","filterSequence","operators","spatial","fieldRestrict","defineOgcFiltersDefaultOptions","ogcFiltersOptions","fieldNameGeometry","srcType","ogcFiltersDefaultValue","editable","geometryName","advancedOgcFilters","pushButtons","checkboxes","radioButtons","buildFilter","extent","proj","ourBboxFilter","enableBbox","filterAssembly","olfilter","getCode","checkIgoFiltersProperties","bundleFilter","wfsOptions","srsName","featureNS","featurePrefix","query","olFormatWFS","writeGetFeature","XMLSerializer","serializeToString","filterObject","logicalArray","createFilter","operator","logical","filterOptions","wfsPropertyName","propertyName","wfsPattern","pattern","wfsMatchCase","matchCase","wfsWildCard","wildCard","wfsSingleChar","singleChar","wfsEscapeChar","escapeChar","wfsLowerBoundary","lowerBoundary","wfsUpperBoundary","upperBoundary","wfsGeometryName","wfsExtent","wfsWktGeometry","wkt_geometry","wfsSrsName","wfsBegin","parseFilterOptionDate","begin","minDate","wfsEnd","end","maxDate","wfsExpression","expression","geometry","olFormatWKT","readGeometry","dataProjection","featureProjection","defineInterfaceFilterSequence","level","addInterfaceFilter","computeAllowedOperators","defaultOperatorsType","allowedOperators","fieldsHasSpatialOperator","includeContains","effectiveOperators","srcField","allowedOperatorsType","igoOgcFilterObject","parentLogical","filterid","sliderOptions","igoSpatialSelector","igoSNRC","filterArray","addFilterProperties","rebuiltIgoOgcFilterObjectFromSequence","sequence","nextElement","lastProcessedFilter","lastParentLogical","uiFilter","computeIgoSelector","computedSelectors","selector","bundles","bundle","selectorType","selectorGroup","handleOgcFiltersAppliedValue","ogcFilters","filterQueryStringSelector","filterQueryStringAdvancedFilters","pushConditions","formatGroupAndFilter","checkboxConditions","selectorsCorr","verifyMultipleEnableds","radioConditions","selectConditions","filterQueryString","formatProcessedOgcFilter","enableds","list","selectorBundle","g","bundleCondition","selectorsType","ogcselector","enabledSelector","processedFilter","layersOrTypenames","appliedFilter","layerOrTypenames","isValid","defaultEpsg","defaultMaxFeatures","defaultFieldNameGeometry","gmlRegex","formatWFSQueryString","dataSourceOptions","epsg","forceDefaultOutputFormat","versionWfs200","urlWfs","paramsWFS","effectiveCount","effectiveStartIndex","epsgCode","paramMaxFeatures","cnt","maxFeatures","srs","valueReference","sourceFields","fieldsNames","sourcefield","separator","getFeature","getpropertyvalue","checkWfsParams","wfsDataSourceOptions","getFormatFromOptions","OlFormat","gmlFormat","olFormatGML2","olFormatGML32","olFormatGML3","olFormatOSMXML","FEATURE","FeatureMotion","Move","Zoom","featureToOl","projectionOut","getId","olFeature","OlFormatGeoJSON","readFeature","projection","setId","mapTitle","getEntityRevision","featureFromOl","projectionIn","exclude","excludeOffline","idColumn","olFormat","getKeys","writeGeometryObject","excludeAttribute","excludeAttributeOffline","getRevision","computeOlFeaturesExtent","olFeatures","olextent","featureExtent","computeOlFeatureExtent","olExtent","olFeatureExtent","olFeatureProjection","olGeometry","getExtent","scaleExtent","featuresAreOutOfView","featuresExtent","edgeRatio","edgesRatio","viewExtent","featuresAreTooDeepInView","areaRatio","mapExtent","mapExtentArea","featuresExtentArea","getZoom","moveToOlFeatures","motion","getOlProjection","zoomToExtent","moveToExtent","hideOlFeature","setStyle","OSMDataSource","olSourceOSM","XYZDataSource","olSourceXYZ","WFSDataSource","wfsService","ogcFilterWriter","sf","getSourceFieldsFromWFS","setOgcFilters","OlLoadingStrategy","triggerEvent","notify","DataService","WFSService","defineFieldAndValuefromWFS","getfeatureSourceField","wfsGetFeature","nb","d","fieldList","fieldListWoGeom","fieldListWoGeomStr","olFormats","effectiveOlFormats","gmlDataSourceOptions","sourceFieldsToRetrieveValues","concatMap","allowGml","firstFeature","readFeatures","getGeometryName","processingArray","chunkSize","results","mfeatures","loopFeatures","built_properties_value","kv","getProperties","boundedBy","fieldType","featureProperties","QueryFormat","GML2","GML3","GEOJSON","GEOJSON2","ESRIJSON","TEXT","HTMLGML2","QueryFormatMimeType","QueryHtmlTarget","IFRAME","BLANK","WMSDataSource","mapLabel","queryHtmlTarget","timeFilter","timeFilter$","sourceParams","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","wfsCheckup","download","dynamicUrl","buildDynamicDownloadUrlFromParamsWFS","sourceField","initOgcFilters","calendarModeYear","FILTER","updateParams","timeFilterableDataSourceOptions","timeFilterable","setTimeFilter","igoRefresh","asWFSDataSourceOptions","olSourceImageWMS","ratio","projParam","contentDependent","contentDependentLegend","VERSION","currentStyle","createDefaultTileGrid","projectionExtent","extentGetWidth","resolutions","matrixIds","z","olTileGridWMTS","extentGetTopLeft","WMTSDataSource","tileGrid","olSourceWMTS","CartoDataSource","crossOrigin","olSourceCarto","htmlString","layerOptions","types","oneType","cartocss","colors","layer_name","ArcGISRestDataSource","esrijsonFormat","olFormatEsriJSON","attributions","overlaps","time","customParams","bind","olloadingstrategy","legendInfo","legendElement","htmlImgSrc","contentType","imageData","uniqueValueInfos","symbol","createSVG","strokeWidth","outlineColor","outline","ImageArcGISRestDataSource","renderingRule","ImageArcGISRest","layerId","TileArcGISRestDataSource","olSourceTileArcGISRest","TileDebugDataSource","baseOptions","TileGrid","TileDebug","WebSocketDataSource","ws","createWebSocket","WebSocket","onmessage","onMessage","onclose","onClose","onerror","onopen","onOpen","featureAdded","featureToRemove","getFeatureById","removeFeature","addFeature","MVTDataSource","mvtFormat","featureClass","olFormatMVT","olSourceVectorTile","ProjectionService","code","registerProjection","utmZone","def","mtmZone","lon0","proj4","defs","olproj4","setExtent","TimeFilterType","DATE","TIME","DATETIME","YEAR","TimeFilterStyle","CALENDAR","SLIDER","EsriStyleGenerator","_converters","_renderers","esriPMS","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","_convertPointToPixel","point","_transformColor","_getResolutionForScale","units","mpu","rotation","_transformAngle","angle","weight","family","textBaseline","verticalAlignment","textAlign","horizontalAlignment","offsetX","xoffset","offsetY","yoffset","_convertOutline","lineDash","ol3Rad","PI","points","radius2","_convertLabelingInfo","labelingInfo","mapUnits","styles","ii","labelExpression","maxScale","minScale","defaultSymbol","defaultStyle","classBreakInfos","classBreakInfo","classMinValue","minValue","classMaxValue","field1","infos","me","generateStyle","layerInfo","drawingInfo","styleFunctions","drawingInfoStyle","labelingInfoStyleFunctions","MapService","getMap","TypeCapabilities","CapabilitiesService","mapService","parsers","WMSCapabilities","WMTSCapabilities","esriJSON","EsriJSON","getWMSOptions","getCapabilities","capabilities","parseWMSOptions","getWMTSOptions","parseWMTSOptions","getCartoOptions","jsonp","mapId","cartoOptions","parseCartoOptions","getArcgisOptions","serviceCapabilities","arcgisOptions","parseArcgisOptions","getImageArcgisOptions","legendUrl","parseTileOrImageArcgisOptions","getTileArcgisOptions","fromObject","_i","read","findDataSourceInCapabilities","Capability","metadata","DataURL","abstract","Abstract","keywordList","KeywordList","getTimeFilter","Style","isExtentInGeographic","EX_GeographicBoundingBox","queryFormat","queryFormatMimeTypePriority","Request","GetFeatureInfo","Format","keyEnum","_layerOptionsFromSource","Title","MaxScaleDenominator","MinScaleDenominator","OnlineResource","extern","stepDate","Contents","Identifier","optionsFromCapabilities","ouputOptions","layer_definition","olAttribution","copyrightText","timeExtent","timeInfo","setTime","toUTCString","serviceDescription","displayField","layerName","layerArray","Name","dimension","Dimension","minMaxDim","stylesAvailable","OptionsService","DataSourceService","capabilitiesService","optionsService","wfsDataSourceService","projectionService","datasources$","createAsyncDataSource","detailedContextUri","createOSMDataSource","createFeatureDataSource","createWFSDataSource","wmsContext","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","observables","optionsFromApi","optionsMerged","getArcgisRestOptions","i5","i6","tryBindStoreLayer","VectorLayer","bindLayer","addLayer","FeatureStore","searchDocument","_searchDocument","setLayerFeatures","viewScale","checkLayer","setLayerOlFeatures","setStoreOlFeatures","clearLayer","computeOlFeaturesDiff","olFeaturesMap","olFeaturesToRemove","newOlFeature","olFeaturesToAddIds","getFeatures","removeOlFeaturesFromLayer","addOlFeaturesToLayer","setLayerExtent","viewProjection","addFeatures","FeatureStoreInMapExtentStrategy","stores$$","states$$","empty$$","watchStore","skipWhile","updateEntitiesInExtent","unwatchStore","unwatchAll","state$","inMapExtent","entitiesInMapExtent","getFeaturesInExtent","FeatureStoreInMapResolutionStrategy","updateEntitiesInResolution","mapResolution","inMapResolution","GeoPropertiesStrategy","propertyTypeDetectorService","updateEntitiesPropertiesState","layers$","pairwise","prevLayers","currentLayers","prevLayersId","layersId","geoService","firstN","distinctValues","containGeoServices","entry","valuedAreGeoservices","isGeoService","geoServiceAssociations","getGeoService","propertiesForLayerName","propertyForLayerName","urlProperty","layerNameProperty","geoServiceStates","geoServiceAssociation","arcgisLayerName","appliedLayerName","potentialLayerId","LAYER","haveGeoServiceProperties","geoServiceState","urlValue","layerNameValue","entitiesToProcess","FeatureStoreLoadingStrategy","setMotion","subscription","onFeaturesChange","selectMotion","getFeatureId","FeatureStoreLoadingLayerStrategy","onSourceChanges","flatMap","cluster","OlDragSelectInteraction","OlDragBoxInteraction","FeatureStoreSelectionStrategy","mapClickListener","olDragSelectInteraction","olDragSelectInteractionEndKey","overlayStore","_overlayStore","createOverlayStore","unselectAll","deactivateSelection","unlistenToMapClick","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","removeOverlayLayer","stores$","onMapClick","unByKey","getFeaturesAtPixel","pixel","hitTolerance","layerFilter","onSelectFromMap","olInteractions","getInteractions","getArray","olInteraction","addInteraction","onDragBoxEnd","removeInteraction","mapBrowserEvent","overlayFeaturesKeys","featuresKeys","doMotion","groupedFeatures","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","overlayLayer","createOverlayLayer","exportable","browsable","removeLayer","FeatureStoreSearchIndexStrategy","initStoreSearchIndex","Document","tokenize","onEntitiesChanges","percentDistinctValueRatio","featuresProperties","fp","igoSearchID","toIndex","columnsToNotIndex","contentToIndex","searchIndex","sf2","columnsToIndex","propertiesToIndex","tryAddLoadingStrategy","tryAddSelectionStrategy","createOverlayLayerStyle","createOverlayDefaultStyle","markerStyle","createBufferStyle","strokeRGBA","fillRGBA","bufferRadius","customStyle","fillColor","strokeColor","fillWithOpacity","strokeWithOpacity","overlayDataSource","setFeatures","removeOlFeature","addOlFeatures","addOlFeature","removeFeatures","LayerWatcher","propertyChange$","unwatchLayer","setPropertyChange","watchLayer","evt","layer$$","MapController","olMap","observerKeys","getOlMap","setOlMap","GeolocationOverlayType","Position","PositionDirection","Accuracy","Buffer","MapGeolocationController","storageService","arrowRotation","subscriptions$$","geolocationOverlay","positionFeatureStyle","accuracyFeatureStyle","bufferStyle","buffer","bufferStroke","bufferFill","showBufferRadius","arrowStyle","displacement","rotateWithView","geolocation","emissionIntervalSeconds$","position$","tracking$","followPosition$","lastPosition","_buffer","handleFeatureCreation","accuracyThreshold","_accuracyThreshold","olGeolocation","tracking","getTracking","setTracking","followPosition","_followPosition","deleteGeolocationFeatures","deleteFeatureByType","onPositionChange","trackingOptions","enableHighAccuracy","maximumAge","timeout","interval","updateArrowFeatureOrientation","position4326","coordinates","dateTime","arrowFeature","getFeatureByType","isMoving","distanceBetweenPoints","accuracy","theta","atan2","coord1","coord2","olSphere","addOnChangedListener","listener","deleteChangedListener","updateGeolocationOptions","geolocate","alwaysTracking","storedTracking","storedFollowPosition","zoomTo","geolocateProperties","getProjection","altitude","altitudeAccuracy","heading","timestamp","handleViewFromFeatures","featureById","positionGeometry","Point","accuracyGeometry","fromCircle","OlCircle","positionFeature","positionFeatureArrow","accuracyFeature","positionFeatureExists","positionFeatureArrowExists","accuracyFeatureExists","setGeometry","bufferFeature","bufferFeatureExists","bufferGeometry","edgeRatios","areOutOfView","MapViewAction","MapViewController","rotation$","padding","maxZoomOnExtent","maxLayerZoomExtent","extent$","extent$$","states","stateIndex","stateHistory","olView","getView","setPadding","top","right","bottom","left","onMoveEnd","monitorRotation","getRotation","getCenter","center","calculateExtent","getSize","getScale","getScaleFromResolution","unit","getUnits","zoomIn","zoomOut","zoom","cancelAnimations","duration","easing","oleasing","resetRotation","hasPreviousState","hasNextState","previousState","setStateIndex","nextState","clearStateHistory","setInitialState","fromCenter","toCenter","distCenter","sqrt","fromExtent","fromSize","xSize","maxZoom","fit","isFinished","setState","viewStatesAreEqual","state1","state2","tolerance","trunc","getLinkedLayersOptions","linkedLayers","getIgoLayerByLinkId","linkId","getRootParentByProperty","layerToUse","parentLayer","hasParentLayer","getDirectParentLayerByProperty","layerHasLinkWithProperty","hasLinkWithProperty","layerLLOptions","links","currentLinkId","parents","pl","linkedIds","getDirectChildLayersByProperty","link","lid","getAllChildLayersByProperty","knownChildLayers","childLayers","cl","getDirectParentLayerByDeletion","syncedDelete","getDirectChildLayersByDeletion","getAllChildLayersByDeletion","initLayerSyncFromRootParentLayers","rootLayersByProperty","plbp","IgoMap","forcedOffline$","layersAddedByClick$","queryResultsOverlay","searchResultsOverlay","geolocationController","swipeEnabled$","mapCenter$","selectedFeatures$","bufferDataSource","layerWatcher","mapViewOptions","defaultOptions","attribution","projectionCode","olControlAttribution","scaleLine","olControlScaleLine","interactions","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","olinteraction","setView","once","pc","handleLayerPropertyChange","propertyChange","initiatorIgoLayer","isLayerProperty","isDatasourceProperty","rootParentByProperty","clbp","resolutionPropertyHasChanged","initiatorIgoLayerSourceType","initiatorIgoLayerOgcFilterableDataSourceOptions","getUid","lLayerType","appliedOgcFilter","getParams","appliedTimeFilter","updateView","viewOptions","constrainResolution","updateControls","getControls","removeControl","changeBaseLayer","bl","getBaseLayers","setMinZoom","minZoom","setMaxZoom","getLayerById","getLayerByAlias","getLayerByOlUId","olUId","getLayerByOlLayer","addLayers","offsetZIndex","offsetBaseLayerZIndex","addedLayers","doAddLayer","setLayers","removeLayers","newLayers","layersToRemove","removeLayerFromIDB","handleLinkedLayersDeletion","linkedLayer","linkedIndex","doRemoveLayer","srcLayer","rootParentByDeletion","getRootParentByDeletion","layerHasLinkDeletion","hasLinkWithSyncedDelete","clbd","removeAllLayers","raiseLayer","getLayerIndex","moveLayer","raiseLayers","lowerLayer","lowerLayers","reverseLayers","layerTo","zIndexFrom","existingLayer","maxZIndex","sortLayersByZIndex","layer1","layer2","_layer","MapBrowserComponent","activityId","_view","_controls","PointerPositionDirective","lastTimeoutRequest","pointerMoveListener","pointerPositionDelay","pointerPositionCoord","listenToMapPointerMove","unlistenToMapPointerMove","onPointerEvent","dragging","lonlat","coordinate","featureRandomStyleFunction","circle","cos","featureRandomStyle","hoverFeatureMarkerStyle","olStyles","backgroundFill","backgroundStroke","pointerPositionSummaryMarkerStyle","HoverFeatureDirective","styleService","pointerHoverFeatureStore","store$$","layers$$","selectionLayer","selectionMVT","mvtStyleOptions","singleClickMapListener","hoverFeatureId","igoHoverFeatureDelay","igoHoverFeatureEnabled","mouseout","subscribeToPointerStore","olLayerVectorTile","renderMode","declutter","olVectorTileSource","createHoverStyle","hoverStyle","localHoverStyle","hasLabelStyle","unsubscribeToPointerStore","unlistenToMapSingleClick","resultsUnderPointerPosition","addFeatureOverlay","onMapEvent","onMapSingleClickEvent","topMostOlLayer","maximumZindex","getPixelFromCoordinate","forEachFeatureAtPixel","mapFeature","layerOL","igoLayer","ol_uid","canProcessHover","olLayerVector","myLayerVector","localOlFeature","handleRenderFeature","setLayerStyleFromOptions","featuresToLoad","myLabelOlFeature","setProperties","labelGeom","OlGeom","myLayerVectorTile","igoStyle","setSource","mvtFeatures","localFeature","RenderFeature","hoverEntity","hoverSummary","getHoverSummary","summary","geom","getOrientedFlatCoordinates","coords","flatCoords","idx","zoneMtm","lonMin","deltaLon","zoneUtm","computeProjectionsConstraints","projectionsLimitations","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","InsertSourceInsertDBEnum","System","User","geoNetworkService","previousLoadExtent","previousLoadResolution","previousOgcFilters","xhrAccumulator","trackFeatureListenerId","initialOpacityValue","initialVisibleValue","initialMinResValue","initialMaxResValue","so","preload","bypassResolution","bypassVisible","flash","idbInfo","storeToIdb","firstLoad","maintainFeaturesInIdb","trackFeature","enableTrackFeature","vector","vectorSource","failure","customWFSLoader","setLoader","idbLoader","customIDBLoader","maintainOptionsInIdb","zip","deleteByKey","igoStyleObject","olStyleToBasicIgoStyle","layerOlStyle","getFill","getColor","getStroke","layerData","contextUri","insertEvent","dsFeatures","geojsonObject","writeFeatures","listenerKey","vectorContext","getVectorContext","frameState","flashGeom","elapsed","elapsedRatio","easeOut","getStyleFunction","style2","styleClone","setColor","setWidth","getWidth","drawGeometry","render","stopAnimation","centerMapOnFeature","feat","setCenter","getCoordinates","disableTrackFeature","randomParam","wfsProj","olProjection","currentExtent","removeLoadedExtent","buildUrl","queryStringValues","igoFilters","filterOrBox","filterOrPush","xmlFilter","alteredUrl","nbOfFeature","responseText","getFormat","DOMParser","parseFromString","responseXML","layerID","readProjection","VectorTileLayer","vectorTile","vectorTileSource","onLoad","check","layerCheck","toggleVisibility","eyeTooltip","queryBadgeHidden$","inResolutionRange$","toggleLayerTool","updateLegendOnResolutionChange","LayerItemComponent","networkService","focusedCls","activeLayer","_activeLayer","selectionMode","layerTool$","showLegend$","tooltipText","selectAll","_selectAll","network$$","toggleLegendOnVisibilityChange","expandLegendIfVisible","orderable","lowerDisabled","raiseDisabled","queryBadge","toggleLegend","updateQueryBadge","onResolutionChange","computeTooltip","toggleLegendOnClick","layerTooltip","layerMetadata","inResolutionRange","hidden","LayerItemComponent_mat_checkbox_1_Template","LayerItemComponent_button_5_Template","LayerItemComponent_button_6_Template","LayerItemComponent_button_7_Template","LayerItemComponent_igo_layer_legend_10_Template","LayerLegendItemComponent","toggleShowAllLegends","showAllLegendsValue","layer_r9","ctx_r11","LayerLegendListComponent_ng_template_6_igo_layer_legend_item_0_Template","excludeBaseLayers","LayerLegendListComponent","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","showAllLegend","change$$","_layers","allowShowAllLegends","allLegendsShown","debounce","timer","computeShownLayers","shownLayers","sortLayersByZindex","LayerLegendListComponent_mat_slide_toggle_1_Template","LayerLegendListComponent_mat_divider_3_Template","LayerLegendListComponent_ng_template_6_Template","LayerLegendListComponent_p_8_Template","LayerLegendListComponent_p_12_Template","LayerLegendListComponent_p_16_Template","LayerLegendListComponent_p_20_Template","CollapseDirective","_target","collapseTarget","expandTarget","item_r6","toggleLegendItem","computeItemTitle","style_r18","onChangeStyle","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_mat_option_4_Template","_r29","ctx_r27","onLoadImage","imgGraphValue","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_img_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_small_2_Template","ctx_r22","imagesHeight","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_2_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_mat_list_item_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_Template","items_r1","LayerLegendComponent_ng_container_0_ng_container_1_Template","LayerLegendComponent_ng_container_0_ng_template_2_Template","LayerLegendComponent","legendItems$","renderedLegends","lastlLegend","listStyles","STYLES","onViewControllerStateChange","getLegendGraphic","obsLegGraph","leg","transfertToggleLegendItem","newLegends","outLegends","lastLegends","layerLegend","localLayerOptions","wmsDataSourceOptions","updateLegend","legendItems","sA","sa","elemRef","renderedLegend","LayerLegendComponent_ng_container_0_Template","IgoBadgeIconDirective","igoMatBadgeIcon","getNamedSvgIcon","svgObj","updateSvg","matBadgeHidden","updateHidden","matBadgeDisabled","updateDisabled","igoMatBadgeInverseColor","inverseColor","updateColor","igoMatBadgeInheritColor","inheritColor","igoMatBadgeColor","igoMatBadgeBackgroundColor","backgroundColor","badge","originalColor","alignItems","justifyContent","background","getComputedStyle","getPropertyValue","clearTerm","LayerListToolComponent","onlyVisible$","sortAlpha$","term$","onlyVisible$$","sortAlpha$$","term$$","layersAreAllVisible","floatLabel","onlyVisible","sortAlpha","term","appliedFilterAndSort","keyword","toggleSortAlpha","toggleOnlyVisible","toggleSelectionMode","LayerListToolComponent_button_4_Template","LayerListToolService","onlyInRange","keywordInitialized","sortedAlphaInitialized","onlyVisibleInitialized","onlyInRangeInitialized","LayerListControlsEnum","always","never","LayerListSelectVisibleEnum","ALL_VISIBLE","ALL_HIDDEN","MIXED","NULL","LayerListDisplacement","Raise","Lower","onAppliedFilterAndSortChange","layerFilterAndSortOptions","selectAllCheck","layersChecked","layersCheck","layer_r11","getLowerLayer","getUpperLayer","expandLegendOfVisibleLayers","layerItemChangeDetection$","LayerListComponent_ng_template_6_igo_layer_item_0_Template","zoomLayerExtents","LayerListComponent_igo_panel_8_button_2_Template","_r28","moveActiveLayer","layerListDisplacement","ctx_r31","changeOpacity","LayerListComponent_igo_panel_8_button_21_Template","isLayerRemovable","badgeOpacity","activeLayerExtentIsValid","templateLayerToolbar","checkOpacity","_r39","ctx_r38","zoomLayersExtents","_r41","ctx_r40","ctx_r42","ctx_r43","ctx_r44","LayerListComponent_igo_panel_9_mat_slider_25_Template","LayerListComponent_igo_panel_9_button_26_Template","isAllLayersRemovable","statusSelectedLayersCheck","lowerDisabledSelection","raiseDisabledSelection","_r32","activeLayersExtentAreValid","LayerListComponent","thresholdToFilterAndSort","showToolbar$","layerTool","hideSelectedLayers","activeLayer$","ogcButton","timeButton","_map","removeProblemLayerInList","_keyword","_onlyVisible","_sortedAlpha","isUpperBaselayer","isLowerBaselayer","raisableLayers","lowerableLayers","layersCheckedOpacity","toggleOpacity","selectAllCheck$","selectAllCheck$$","computeShowToolbar","computeLayers","checks","lay","showButtonZoomToExtent","layerExtent","layersExtent","clearKeyword","actiontype","fromUi","sortedLayersToMove","layersToMove","base","mapIndex","currentLayer","previousLayer","raisableLayer","layersToRaise","checkItems","getElementsByClassName","itemFocused","targetToScroll","nextLayer","lowerableLayer","layersToLower","layersOut","filterLayers","sortLayersByTitle","onKeywordChange","showToolbar","keepLayerIds","layerKeywords","kw","localKeyword","layerTitle","dataSourceType","keywordRegex","keywordInList","removable","statusSelectedLayers","findTrue","findFalse","eventMapIndex","isScrolledIntoView","elemSource","elem","docViewTop","elemTop","offsetTop","layersList","contentQueries","dirIndex","LayerListComponent_igo_layer_list_tool_0_Template","LayerListComponent_div_2_Template","LayerListComponent_ng_template_6_Template","LayerListComponent_igo_panel_8_Template","LayerListComponent_igo_panel_9_Template","GeoDBService","ngxIndexedDBService","compression","dbName","collisionsMap","_newData","regionID","insertSource","compress","subject","geoDBData","object$","getByID","dbObject","currentRegionID","collisions","customUpdate","deleteRequest","isDeleted","getRegionCountByID","getRegionByID","datas","IDBKey","IDBKeyRange","only","getAllByIndex","deleteByRegionID","dbRequest","openCursor","keyRange","lowerBound","DBMode","openCursorByIndex","resetCounters","resetCollisionsMap","revertCollisions","getByKey","take","newData","GeoNetworkService","networkOnline","simpleGetOptions","getOnline","getOffline","isOnline","computeMVTOptionsOnHover","vectorTileLayerOptions","LayerDBService","layerDBData","LayerService","dataSourceService","createLayer","createTileLayer","createVectorLayer","createImageLayer","_layerOptions","createVectorTileLayer","createAsyncLayer","handleLegacyStyles","serviceStyle","clusterBaseStyle","layerOptionsOl","applyMapboxStyle","legacyStyleOptions","legacyOption","mapboxStyle","getStuff","sprite","getAbsoluteUrl","res2","stylefunction","createAsyncIdbLayers","layersOptions","idbl","i7","ListItemDirective","_color","focused","_focused","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","_disabled","beforeDisable","beforeEnable","toggleDisabledClass","getOffsetTop","disabledCls","ClickoutDirective","clickout","handleMouseClick","contains","ListComponent","navigation","_navigation","_selection","selectedItem","_selectedItem","focusedItem","_focusedItem","navigationEnabled","listItems$$","listItems","handleKeyboardEvent","enableNavigation","focusNext","toArray","igoList","getFocusedIndex","offsetHeight","focusPrevious","disableNavigation","scrollToItem","findSelectedItem","findFocusedItem","item2","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","IgoLayerModule","MatSlideToggleModule","MatSliderModule","i8","i9","i10","i11","i12","i13","i14","i15","i16","IgoMetadataModule","QueryService","queryEnabled","defaultFeatureCount","featureCount","previousMessageIds","queryLayer","getQueryUrl","urlGml","mergeMap","gmlRes","mergedGML","mergeGML","imposedGeom","imposedProperties","extractData","urlGmls","checkScaleAndResolution","requestDataForHTMLGML2","checkScale","checkResolution","olmline","olgeom","pts","ptsArray","firstFeatureType","olmpoly","nbFeatures","bbox","getQueryParams","bboxExtent","titleContent","queryTileField","olmpts","returnGeometry","queryTitleContent","featureGeometryCoordinates","featureGeometryType","appendLineString","appendPolygon","convexHull","cross","lower","upper","imposedGeometry","queryDataSource","allowedFieldsAndAlias","getAllowedFieldsAndAlias","extractGML3Data","extractGeoJSONData","extractEsriJSONData","extractTextData","extractHtmlData","extractGML2Data","geomToAdd","createGeometryFromUrlClick","wmsDatasource","FEATURE_COUNT","getQueryTitle","sourceTitle","order","searchParams","bboxRaw","threshold","clickx","clicky","clickx1","clicky1","wktPoly","wmsParser","featureToResult","parser","htmlTarget","crs","bodyTagStart","bodyTagEnd","lastIndexOf","striptags","queryString","pairs","featureOL","featureGeometry","GEOMETRIE","shape","SHAPE","SHAPE_S","SHAPE_L","SHAPE_P","the_geom","geom32198","datasource","forceGML2","queryUrls","getCustomQueryUrl","WMSGetFeatureInfoOptions","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","getFeatureInfoUrl","sql","queryPrecision","tileArcGISRestDatasource","deltaX","deltaY","mime","getLabelMatch","QueryDirective","queryService","queries$$","queryFeatures","queryFeaturesHitTolerance","queryFeaturesCondition","waitForAllQueries","cancelOngoingQueries","queries$","doQueryFeatures","queryLayers","query$","clickedFeatures","values_","queryFormatAsWms","newFeature","nom","id_","_icon","OlRenderFeature","renderFeatureFromOl","olRenderFeature","geometryType","ends","getEnds","OlPolygon","getFlatCoordinates","OlPoint","OlLineString","dragExtent","forEachFeatureIntersectingExtent","olDragSelectInteractionOnQuery","SearchSource","getDefaultOptions","showInPointerSummary","showInSettings","searchUrl","settings","featureStoresWithIndex","storesWithIndex","_featureStoresWithIndex","setWorkspaces","workspaces","fw","datasets","setParamFromSetting","setting","saveInStorage","confValue","displayOrder","storageOptions","getHashtagsValid","settingsName","hashtags","searchSourceSetting","getSettingsValues","hashtagsValid","hashtag","hashtagKey","QuerySearchSource","GoogleLinks","getGoogleMapsCoordLink","getGoogleStreetViewLink","getGoogleMapsNameLink","encodeURI","OsmLinks","getOpenStreetMapLink","getOpenStreetCamLink","PropertyTypeDetectorService","regexService","geoServiceRegexes","getGeoServiceRegexes","getPropertyType","geoServiceRegex","availableProperties","matchingGeoservice","CatalogItemType","Group","TypeCatalog","baselayers","composite","Catalog","externalProvider","forcedProperties","matrixSet","requestEncoding","regFilters","groupImpose","groupSeparator","tooltipType","sortDirection","setCrossOriginAnonymous","showLegend","profils","WMSCatalog","_collectCatlogItems","collectCatalogItems","WMTSCatalog","BaselayersCatalog","ArcGISRestCatalog","TileOrImageArcGISRestCatalog","typeCatalog","CompositeCatalog","CatalogService","loadCatalogs","contextConfig","catalogConfig","apiUrl","catalogsFromConfig","sources","baseLayersCatalog","catalogsFromApi$","catalogs","_response","loadCatalogItems","catalog","newCatalog","CatalogFactory","createInstanceCatalog","loadCatalogBaseLayerItems","getCatalogBaseLayersOptions","loadCatalogWMSLayerItems","getCatalogCapabilities","Service","finalLayers","flattenWmsCapabilities","capabilitiesCapabilityLayer","includeRecursiveItems","modifiedParent","modifiedLayer","ff","loadCatalogWMTSLayerItems","getWMTSItems","loadCatalogArcGISRestItems","getArcGISRESTItems","loadCatalogCompositeLayerItems","compositeCatalog","catalogsFromInstance","request1$","request2$","flatDeepLayer","arr","pushImposeGroup","outGroupImpose","address","flatLayer","obs","request3$","recursiveGroupByLayerAddress","keyFn","outItem","indicesMatchTitle","indicesMatchNewMetadataUrl","bInd","nPosition","newMetadataUrl","groupByGroupId","groupId","ind","ix","computeForcedProperties","layerNameFromCatalog","returnProperty","metadataUrl","metadataAbstract","metadataAbstractAll","metadataUrlAll","forcedPropertiesForAllLayers","forcedProperty","prepareCatalogItemLayer","idParent","layersQueryFormat","configuredQueryFormat","retrieveLayerInfoFormat","baseSourceOptions","propertiesToForce","baseAbstract","layerOnlineResource","layerPrepare","prepareCatalogItemGroup","itemListIn","regexes","idGroup","groupItem","testLayerRegexes","layerItem","itemsPrepare","loopLevel","findCatalogInfoFormat","ServiceIdentification","regex","currentLayerInfoFormat","baseInfoFormat","configuredInfoFormat","specific","catalogService","MetadataService","openMetadata","MetadataButtonComponent","metadataService","MetadataAbstractComponent","MetadataButtonComponent_button_0_Template","MAT_DIALOG_DATA","MetadataAbstractComponent_mat_dialog_content_4_Template","MetadataAbstractComponent_mat_dialog_content_5_Template","igoLayer$","CatalogBrowserLayerComponent","layerService","inRange$","isPreview$","isVisible$","isPreview$$","layerLegendShown$","mouseInsideAdd","catalogAllowLegend","addedChange","addedLayerIsPreview","isVisible","computeTitleTooltip","onMouseEvent","onToggleClick","askForLegend","haveGroup","oLayer","getBadgeIcon","CatalogBrowserLayerComponent_mat_icon_1_Template","CatalogBrowserLayerComponent_button_5_Template","CatalogBrowserLayerComponent_igo_layer_legend_20_Template","CatalogBrowserGroupComponent_button_5_mat_icon_1_Template","_r16","onLayerPreview","ctx_r17","onLayerAddedChange","item_r12","CatalogBrowserGroupComponent_ng_template_13_ng_container_0_Template","CatalogBrowserGroupComponent_ng_template_13_ng_container_1_Template","isGroup","isLayer","CatalogBrowserGroupComponent","preview$","toggleCollapsed","layerAddedChange","evaluateAdded","evaluateDisabled","onToggleCollapsed","tryToggleGroup","onTitleClick","CatalogBrowserGroupComponent_button_5_Template","CatalogBrowserGroupComponent_ng_container_6_Template","CatalogBrowserGroupComponent_ng_template_9_Template","CatalogBrowserGroupComponent_ng_template_13_Template","onGroupAddedChange","item_r1","toggleCollapsedGroup","CatalogBrowserComponent_ng_template_1_ng_container_0_Template","CatalogBrowserComponent_ng_template_1_ng_container_1_Template","CatalogBrowserComponent","currentItems","addLayerToMap","removeLayerFromMap","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","security","currLayer","sortCatalogItemsByTitle","returnItem","titleA","titleB","CatalogBrowserComponent_ng_template_1_Template","IgoCatalogBrowserModule","removeCatalogFromLibrary","CatalogLibaryItemComponent","catalogRemove","CatalogLibaryItemComponent_mat_icon_4_Template","CatalogLibaryItemComponent_button_5_Template","CatalogLibaryItemComponent_button_6_Template","predefinedCatalog_r7","predefinedCatalog_r8","type_r9","addedCatalog","emailAddress","AddCatalogDialogComponent","defaultAddedCatalogType","addedCatalogType$$","predefinedCatalogsList$","typeCapabilities","predefinedCatalogs","storeViewAll$$","updateValueAndValidity","computePredefinedCatalogList","changeUrlOrTitle","patchValue","addCatalog","AddCatalogDialogComponent_mat_option_11_Template","AddCatalogDialogComponent_mat_option_18_Template","AddCatalogDialogComponent_mat_option_23_Template","AddCatalogDialogComponent_span_24_Template","AddCatalogDialogComponent_span_25_Template","catalog_r2","onCatalogRemove","onCatalogSelect","addCatalogDialog","CatalogLibaryComponent","addCatalogAllowed","catalogSelectChange","addingCatalog$$","addedCatalogs","getCatalogs","unsubscribeAddingCatalog","predefinedCatalog","mapName","ServiceType","catalogToAdd","newCatalogs","CatalogLibaryComponent_ng_template_1_Template","CatalogLibaryComponent_div_3_Template","IgoCatalogLibraryModule","IgoCatalogModule","DirectionsSource","DirectionsSourceService","directionsSourceServiceFactory","provideDirectionsSourceService","IgoDirectionsModule","DragDropModule","IgoDownloadModule","IgoDrawModule","BrowserModule","BrowserAnimationsModule","MatRadioModule","IgoFeatureDetailsModule","IgoFeatureFormModule","IgoFeatureModule","IgoGeometryFormFieldModule","IgoGeometryModule","OgcFilterButtonComponent_div_1_igo_ogc_filterable_item_2_Template","ogcFilterCollapse","OgcFilterButtonComponent","currentPushButtonGroup","gr","cntPushButtons","cb","button","currentCheckboxGroup","cntCheckboxes","currentRadioButtonsGroup","cntRadioButtons","radio","currentSelectGroup","cntSelect","currentAutocompleteGroup","cntAutocomplete","interfaceOgcFilters","filterActiveValue","OgcFilterButtonComponent_button_0_Template","OgcFilterButtonComponent_div_1_Template","WktService","wktToFeature","wkt","wktProj","featureProj","olWKT","extentToWkt","epsgTO","extentProj","roundCoordinateArray","wktLine","wktMultiPoints","coordinateArray","roundArray","snrcToWkt","snrc","ew","sn","snrc250kIndex","snrc50kIndex","snrc1m","snrc250k","snrc50k","ar1m","part1m","part250k","part50k","partEW","partSN","unit1mEW","unit1mSN","unit250kEW","unit250kSN","unit50kEW","unit50kSN","index250kEW","index250kSN","index50kEW","index50kSN","increment250kEW","increment250kSN","increment50kEW","increment50kSN","unitPerTypeEW","unitPerTypeSN","ul","lr","ur","ll","field_r12","clearSelectedField","currentFilter","inputClearable","updateFieldsList","changeField","OgcFilterFormComponent_mat_form_field_14_mat_option_10_Template","OgcFilterFormComponent_mat_form_field_14_button_12_Template","selectedField$","filteredFields$","operator_r20","igoSpatialSelector_r22","changeSpatialSelector","OgcFilterFormComponent_mat_form_field_28_mat_option_2_Template","igoSpatialSelectors","value_r28","_r30","clearProperty","ctx_r34","updateValuesList","changeProperty","OgcFilterFormComponent_mat_form_field_30_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_30_button_7_Template","_r25","detectProperty","filteredValues$","isClearable","ctx_r37","ctx_r36","ctx_r41","changeSNRC","OgcFilterFormComponent_mat_form_field_35_button_3_Template","_r45","changeMapExtentGeometry","OgcFilterFormComponent_ng_container_37_button_1_Template","value_r49","_r51","ctx_r50","ctx_r48","_r53","ctx_r52","ctx_r54","ctx_r55","ctx_r56","changeNumericProperty","OgcFilterFormComponent_mat_form_field_40_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_40_button_7_Template","_r46","value_r60","_r62","ctx_r61","ctx_r59","_r64","ctx_r63","ctx_r65","ctx_r66","ctx_r67","OgcFilterFormComponent_mat_form_field_41_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_41_button_7_Template","_r57","_r69","ctx_r68","ctx_r71","pos","OgcFilterFormComponent","wktService","ogcFilterOperator","allOgcFilterOperators","ogcFilterOperators$","inputOperator","fields$","currentFilterIsSpatial$","defaultStepMillisecond","refreshFilters","_snrc","activeFilters","sFields","excludeFromOgcFilters","sfs","currentFilterIsSpatial","_filterFields","_filterValues","detectedProperty","toggleFilterState","deleteFilter","changeLogical","changeOperator","changeCaseSensitive","refreshFilter","changeSNRCGeometry","isSpatial","isTemporalOperator","OgcFilterFormComponent_mat_form_field_14_Template","OgcFilterFormComponent_mat_option_25_Template","OgcFilterFormComponent_mat_form_field_28_Template","OgcFilterFormComponent_mat_form_field_30_Template","OgcFilterFormComponent_mat_form_field_35_Template","OgcFilterFormComponent_ng_container_37_Template","OgcFilterFormComponent_mat_form_field_40_Template","OgcFilterFormComponent_mat_form_field_41_Template","OgcFilterFormComponent_igo_ogc_filter_time_42_Template","_c3","_c4","OGCFilterService","filterByOgc","filterString","setOgcWFSFiltersOptions","wfsDatasource","setOgcWMSFiltersOptions","filtered","selectorGroup_r11","currentPushButtonsGroup","OgcFilterSelectionComponent_div_1_div_1_div_2_mat_option_4_Template","getPushButtonsGroups","ogcPushButton_r16","selector_r2","getToolTip","getButtonColor","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_mat_button_toggle_4_Template","bundle_r14","bundleIsVertical","OgcFilterSelectionComponent_div_1_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_Template","selectorGroup_r23","ctx_r24","currentCheckboxesGroup","OgcFilterSelectionComponent_div_1_div_2_div_2_mat_option_4_Template","getCheckboxesGroups","ogcCheckbox_r29","_r31","ctx_r30","displayLessResults","displayMoreResults","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_1_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_2_Template","ctx_r28","isLessResults","bundle_r26","isMoreResults","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_Template","OgcFilterSelectionComponent_div_1_div_2_div_2_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_Template","selectorGroup_r43","OgcFilterSelectionComponent_div_1_div_3_div_2_mat_option_4_Template","getRadioButtonsGroups","emptyRadioButtons","ogcRadioButton_r52","ctx_r53","_r59","ctx_r58","_r61","ctx_r60","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_1_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_2_Template","ctx_r49","bundle_r46","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_4_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_5_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_Template","unfiltered","OgcFilterSelectionComponent_div_1_div_3_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_Template","selectorGroup_r66","_r68","OgcFilterSelectionComponent_div_1_div_4_div_2_mat_option_4_Template","getSelectGroups","_r75","ctx_r74","emptySelect","_r80","ctx_r79","selectAllSelected","ctx_r81","toggleAllSelection","bundle_r69","ctx_r83","selectOptionClick","ctx_r78","ogcSelect_r82","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_option_5_Template","_r91","ctx_r89","ctx_r87","ogcSelect_r88","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_mat_option_1_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_Template","_r72","OgcFilterSelectionComponent_div_1_div_4_div_2_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_Template","autocompleteGroup_r96","_r98","OgcFilterSelectionComponent_div_1_div_5_div_2_mat_option_4_Template","ctx_r93","getAutocompleteGroups","_r103","ctx_r102","emptyAutocomplete","ogcAutocomplete_r108","_r110","ctx_r109","autocompleteOptionClick","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_mat_option_6_Template","bundle_r99","ctx_r101","displayFn","filteredOgcAutocomplete","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_Template","ctx_r94","OgcFilterSelectionComponent_div_1_div_5_div_2_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_Template","OgcFilterSelectionComponent_div_1_div_1_Template","OgcFilterSelectionComponent_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_Template","OgcFilterSelectionComponent_div_1_div_4_Template","OgcFilterSelectionComponent_div_1_div_5_Template","ctx_r113","OgcFilterSelectionComponent_div_2_h3_2_Template","OgcFilterSelectionComponent_div_2_h3_3_Template","_r115","ctx_r114","ctx_r116","ctx_r117","OgcFilterSelectionComponent","ogcFilterService","domService","sel","checkboxesIndex","radioButtonsIndex","baseIndex","_currentFilter","selectEnabled$","selectEnableds$","autocompleteEnabled$","applyFiltersTimeout","ogcFiltersSelectors","ogcSelector","pushButtonsGroup","checkboxesGroup","radioButtonsGroup","selectGroup","autocompleteGroup","selectEnabled","compSelect","applyFilters","selectEnableds","autocompleteEnabled","buildForm","selectMulti","getSelectEnabled","getSelectDomValues","getAutocompleteEnabled","getAutocompleteDomValues","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","onAutocompleteChangeGroup","toolTip","_this2","domSelectors","domValues","domSelector","filterDOM","domOptions","newBundle","comp","_this3","pushButton","vertical","currentOgcSelection","markAsUntouched","deselect","newStatus","isUserInput","currentGroups","currentGroup","selectorsLength","OgcFilterSelectionComponent_div_1_Template","OgcFilterSelectionComponent_div_2_Template","OGCFilterTimeService","stepMillisecond","asMilliseconds","stepIsYearDuration","year","years","months","weeks","days","hours","stepIsMonthDuration","month","stepIsWeekDuration","week","stepIsDayDuration","day","stepIsHourDuration","hour","stepIsMinuteDuration","dateToNumber","newDate","addStep","toDate","subtractStep","subtract","OgcFilterTimeSliderComponent","ogcFilterTimeService","slider","sliderValue","calculatedStep","_defaultDisplayFormat","_defaultSliderInterval","playIcon","resetIcon","sliderInterval","displayFormat","beginMillisecond","maxMillisecond","sliderDisplayWith","calculateStep","handleSliderInput","dateTmp","toAdd","playFilter","stopFilter","that","_emitInputEvent","resetFilter","matSliderChange","dateBeginTmp","dateEndTmp","toISOString","startOf","MatSlider","sliderMode","modeChange","changePropertyByPass","beginValue","restrictedToStep","endValue","yearOnlyInputChange","yearSelected","_r12","onlyYearBegin","filterStateDisable","calendarView","handleDate","onlyYearEnd","hour_r27","minute_r28","changeTemporalProperty","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_12_Template","beginHourFormControl","beginHours","beginMinuteFormControl","beginMinutes","hour_r37","minute_r38","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_12_Template","endHourFormControl","endHours","endMinuteFormControl","endMinutes","_r43","ctx_r45","monthSelected","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_Template","filterEndFunction","calendarType","_r47","ctx_r46","OgcFilterTimeComponent_div_3_div_2_div_10_Template","OgcFilterTimeComponent_div_3_div_2_div_11_Template","ctx_r51","filterBeginFunction","OgcFilterTimeComponent_div_3_div_1_Template","OgcFilterTimeComponent_div_3_div_2_Template","calendarTypeYear","OgcFilterTimeComponent","UntypedFormControl","_beginValue","_endValue","_defaultMin","_defaultMax","_defaultSliderModeEnabled","endDatepickerTime","beginDatepickerTime","beginTime","endTime","stepMilliseconds","parseFilter","handleMin","handleMax","getUTCFullYear","isCalendarYearMode","setFilterStateDisable","updateHoursMinutesArray","updateValues","dateFilter","intervalInt","_now","endOf","getDateFromStringWithoutTime","valueTmp","getDateTime","dateStringFromYearNotime","getFullYear","datePicker","dateValue","monthDiff","dateValuePlus1","monthDiffPlus1","asYears","asMonths","weekDiff","weekDiffPlus1","asWeeks","dayDiff","_mod","asDays","hourDiff","asHours","valuetmp","valuetmp2","setHours","handleMinuteIncrement","handleHourIncrement","fullBeginHoursArray","checkEndValue","getHours","fullEndHoursArray","fullBeginMinutesArray","getMinutes","fullEndMinutesArray","beginTmp","endTmp","restrictToStep","stringDate","dateItems","minDefaultDate","maxDefaultDate","minDefaultISOString","maxDefaultISOString","filterOriginConfig","toLocaleDateString","OgcFilterTimeComponent_mat_slide_toggle_1_Template","OgcFilterTimeComponent_div_2_Template","OgcFilterTimeComponent_div_3_Template","refreshFunc","currentFilter_r3","OgcFilterableFormComponent_1_ng_template_0_Template","OgcFilterableFormComponent","MAT_SELECT_CONFIG","overlayPanelClass","MAT_AUTOCOMPLETE_DEFAULT_OPTIONS","OgcFilterableFormComponent_igo_ogc_filter_selection_0_Template","OgcFilterableFormComponent_1_Template","toggleFiltersCollapsed","filtersCollapsed","addFilterToSequence","addFilterDisabled","OgcFilterableItemComponent_div_9_igo_layer_legend_2_Template","changeOgcFilterType","OgcFilterableItemComponent","lastRunOgcFilter","defaultLogicalParent","hasActiveSpatialFilter","filtersAreEditable","hasSelector","lastLevel","firstFieldName","includedFields","datasourceOptions","firstOperatorName","force","af","rebuildFilter","ogcDataSource","ogcLayer","isAdvancedOgcFilters","changeOgcFiltersAdvancedOgcFilters","OgcFilterableItemComponent_mat_icon_2_Template","OgcFilterableItemComponent_span_3_Template","OgcFilterableItemComponent_button_5_Template","OgcFilterableItemComponent_button_6_Template","OgcFilterableItemComponent_div_9_Template","OgcFilterableItemComponent_section_11_Template","layer_r2","OgcFilterableListComponent","OgcFilterableListComponent_div_1_Template","OgcFilterableListComponent_ng_template_3_Template","FilterableDataSourcePipe","arg","isTimeFilterable","isOgcFilterable","SpatialFilterType","Predefined","Polygon","SpatialFilterItemType","Address","Thematics","SpatialFilterService","urlFilterList","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","getKeyByValue","loadFilterList","featureCollection","loadThematicsList","loadFilterItem","itemType","thematic","urlItem","bufferInput","simplified","loc","loadItemById","featureType","featureCode","loadBufferGeometry","filterType","bufferOutput","TimeFilterService","filterByDate","newdateform","newdateformStart","newdateformEnd","dates","reformatDateTime","filterByYear","getMonth","getUTCDate","getUTCHours","minute","getUTCMinutes","KeyValuePipe","keyValues","property_r3","openSecureUrl","getEmbeddedLinkText","FeatureDetailsComponent_table_0_tr_2_td_1_Template","FeatureDetailsComponent_table_0_tr_2_td_2_Template","FeatureDetailsComponent_table_0_tr_2_td_3_Template","FeatureDetailsComponent_table_0_tr_2_td_4_Template","FeatureDetailsComponent_table_0_tr_2_td_5_Template","FeatureDetailsComponent_table_0_tr_2_td_6_Template","FeatureDetailsComponent_table_0_tr_2_td_7_Template","FeatureDetailsComponent_table_0_tr_2_td_8_Template","isEmbeddedLink","isDoc","FeatureDetailsComponent_table_0_tr_2_Template","filterFeatureProperties","htmlSanitizer","urlSanitizer","FeatureDetailsComponent","sanitizer","unsubscribe$","ready","_source","_feature","selectFeature","routeEvent","htmlDisplayEvent","isHtmlDisplay","docOrImage","fileUrl","div","getAttribute","offlineButtonState","Route","FeatureDetailsComponent_table_0_Template","FeatureDetailsComponent_iframe_1_Template","MeasureType","Length","Area","MeasureLengthUnit","Meters","Kilometers","Miles","Feet","MeasureLengthUnitAbbreviation","MeasureAreaUnit","SquareMeters","SquareKilometers","SquareMiles","SquareFeet","Hectares","Acres","MeasureAreaUnitAbbreviation","metersToKilometers","metersToFeet","metersToMiles","squareMetersToSquareKilometers","squareMetersToSquareMiles","squareMetersToSquareFeet","squareMetersToHectares","squareMetersToAcres","metersToUnit","conversion","squareMetersToUnit","formatMeasure","measure","parts","toLocaleString","minimumFractionDigits","maximumFractionDigits","unitAbbr","createMeasureInteractionStyle","measureOlGeometryLength","olGetLength","measureOlGeometryArea","olGetArea","measureOlGeometry","area","lengths","coordinatesLength","olSegment","updateOlGeometryMidpoints","olMidpoints","olMidpointPoint","getOlGeometryMidpoints","midpointsLength","midpointCoordinate","getCoordinateAt","olMidpoint","setCoordinates","expectedNumber","clearOlMidpointTooltip","olTooltip","removeOverlay","getTooltipsOfOlGeometry","olTooltips","getOlTooltipsAtMidpoints","olCenterTooltip","getOlTooltipAtCenter","olCenter","createOlTooltipAtPoint","olPoint","srcGeomType","OlOverlay","stopEvent","setPosition","createDrawInteractionStyle","createDrawHoleInteractionStyle","getMousePositionFromOlGeometryEvent","olEvent","DrawControl","start$","end$","changes$","modify$","select$","abort$","freehand$","ispredefinedRadius$","predefinedRadius$","radiusDrawEnd$","keyDown$$","olGeometryType","olInteractionStyle","olDrawingLayer","olDrawInteraction","olSelectInteraction","olModifyInteraction","onDrawStartKey","onDrawEndKey","onDrawAbortKey","onDrawKey","mousePosition","radiusVal","radiusValData","radiusCercle","olDrawingLayerSource","drawingLayer","createOlInnerOverlayLayer","interactionStyle","activateModifyAndSelect","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","setOlInteractionStyle","setGeometryType","getGeometryType","OlVectorLayer","drawingLayerSource","OlVectorSource","drawingLayerStyle","OlDraw","maxPoints","freehand","stopClick","freehandCondition","onDrawStart","onDrawEnd","OlModify","OlSelect","doubleClick","onSelect","unsubscribeKeyDown","olGeometryEvent","subscribeKeyDown","removeLastPoint","finishDrawing","abortDrawing","ModifyControl","olOverlayLayer","onModifyStartKey","onModifyEndKey","onModifyKey","olModifyInteractionIsActive","olTranslateInteraction","onTranslateStartKey","onTranslateEndKey","onTranslateKey","olTranslateInteractionIsActive","olDrawInteractionIsActive","drawKeyUp$$","drawKeyDown$$","removedOlInteractions","olLinearRingsLayer","olOuterGeometry","olOverlaySource","olLinearRingsSource","modify","createOlLinearRingsLayer","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","setOlGeometry","addOlLinearRingsLayer","removeOlLinearRingsLayer","clearOlLinearRingsSource","drawStyle","deactivateModifyInteraction","onModifyStart","onModifyEnd","subscribeToKeyDown","unsubscribeToKeyDown","OlTranslate","deactivateTranslateInteraction","onTranslateStart","onTranslateEnd","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","unsubscribeToDrawKeyUp","deactivateDrawInteraction","linearRingCoordinates","getLinearRing","addLinearRingToOlGeometry","_linearRingCoordinates","updateLinearRingOfOlGeometry","addLinearRingToOlPolygon","olPolygon","olLinearRing","appendLinearRing","OlLinearRing","newCoordinates","getLinearRings","measureLengthUnit","measureAreaUnit","perimeter","MeasurerDialogComponent","onNoClick","MeasurerDialogComponent_table_4_Template","MeasurerDialogComponent_table_5_Template","onToggleDisplayLines","displayLines","onToggleDisplayDistance","displayDistance","onToggleDisplayAreas","displayAreas","onLengthUnitChange","measureType","measure_r17","measureUnitsAuto","activeMeasureType","onAreaUnitChange","MeasurerComponent_ng_container_29_igo_measurer_item_1_Template","MeasurerComponent_ng_container_29_igo_measurer_item_2_Template","_r27","onCalculateClick","onDeleteClick","MeasurerComponent","tableTemplate","hasLine$","hasArea$","measure$","showTooltips","drawControlIsDisabled","drawLineControl","drawPolygonControl","modifyControl","activeOlGeometry","activeLengthUnit","activeAreaUnit","onFeatureAddedKey","onFeatureRemovedKey","activeDrawControl","drawStart$$","drawEnd$$","drawChanges$$","modifyStart$$","modifyEnd$$","modifyChanges$$","selectedFeatures$$","olDrawSource","setActiveMeasureType","_activeMeasureType","minSegmentLength","table","drawControlIsActive","createDrawLineControl","createDrawPolygonControl","createModifyControl","toggleDrawControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","onMeasureTypeChange","onToggleDrawControl","deactivateDrawControl","onToggleMeasureUnitsAuto","onDisplayDistance","onDisplayLines","onDisplayAreas","updateTooltipsOfOlGeometry","sum","openDialog","selectedFeature","drawingLayerFeature","onModifyClick","_olFeature","activateModifyControl","clearTooltipsOfOlGeometry","many","updateMeasureOfOlGeometry","objectsExists","objectExist","OlStyle","activateDrawControl","drawControl","onDrawChanges","clearMeasures","clearTooltipsOfOlSource","finalizeMeasureOfOlGeometry","addFeatureToStore","onModifyChanges","_measure","featureId","OlGeoJSON","olMidpointsTooltips","updateOlTooltipsAtMidpoints","typeGeom","updateOlTooltip","updateOlTooltipAtCenter","updateOlGeometryCenter","centerCoordinate","olGetCenter","showTooltipsOfOlGeometry","shouldShowTooltip","addOverlay","forEachFeature","showTooltipsOfOlSource","_unit","_type","computeTooltipInnerHTML","MeasurerComponent_mat_divider_13_Template","MeasurerComponent_mat_slide_toggle_15_Template","MeasurerComponent_mat_divider_17_Template","MeasurerComponent_mat_slide_toggle_20_Template","MeasurerComponent_mat_slide_toggle_22_Template","MeasurerComponent_mat_divider_24_Template","MeasurerComponent_ng_container_29_Template","MeasurerComponent_mat_divider_31_Template","MeasurerComponent_button_35_Template","MeasurerComponent_button_38_Template","MeasureFormatPipe","onDrawControlChange","onfreehandControlChange","freehandDrawIsActive","measureUnit_r15","onMeasureUnitChange","SpatialFilterItemComponent_div_7_mat_option_7_Template","bufferFormControl","measureUnit","measureUnits","measureUnit_r19","SpatialFilterItemComponent_div_8_mat_option_7_Template","radiusFormControl","onItemTypeChange","item_r23","ctx_r32","selectedThematics","node_r35","onToggleChange","node_r39","childrensToggle","treeControl","isExpanded","hasChildrenSelected","SpatialFilterItemComponent_div_14_mat_header_cell_3_Template","SpatialFilterItemComponent_div_14_mat_header_cell_5_Template","SpatialFilterItemComponent_div_14_mat_header_row_6_Template","SpatialFilterItemComponent_div_14_mat_row_7_Template","SpatialFilterItemComponent_div_14_mat_tree_node_9_Template","SpatialFilterItemComponent_div_14_mat_nested_tree_node_10_Template","hasChild","_r44","clearSearch","disabledClearSearch","clearDrawZone","_r48","ctx_r47","toggleVisibleList","SpatialFilterItemComponent_div_28_button_1_Template","entityChange","listIsVisible","SpatialFilterItemComponent","spatialFilterService","geometryTypes","drawGuide$","drawStyle$","PointStyle","overlayStyle","PolyStyle","overlayStyle$","queryType","_store","allLayers","thematicLength","_thematicLength","toggleSearch","itemTypeChange","thematicChange","drawZoneEvent","bufferEvent","zoneWithBufferChange","measureUnitChange","radiusEvent","freehandControl","predefinedRadius","clearButtonEvent","clearSearchEvent","export","openWorkspace","selectedItemType","selectedSourceAddress","NestedTreeControl","childrens","thematics","MatTreeNestedDataSource","value$","value$$","radiusChanges$$","bufferChanges$$","geometryTypeField","drawGuideField","drawGuide","drawGuidePlaceholder","drawZone","zoneWithBuffer","limits","child","featureGeom","selectedRecordStrategy","selectionStrategy","detach","isPolygon","isPoint","isPredefined","collapse","expand","numSelected","numNodes","bool","selectedThematicsName","nodeSelected","toggleSearchButton","createTableTemplate","clearButton","disableSearchButton","formValue","typeColumn","nameColumn","SpatialFilterItemComponent_mat_slide_toggle_5_Template","SpatialFilterItemComponent_mat_slide_toggle_6_Template","SpatialFilterItemComponent_div_7_Template","SpatialFilterItemComponent_div_8_Template","SpatialFilterItemComponent_mat_radio_button_13_Template","SpatialFilterItemComponent_div_14_Template","SpatialFilterItemComponent_button_16_Template","SpatialFilterItemComponent_button_17_Template","SpatialFilterItemComponent_button_27_Template","SpatialFilterItemComponent_div_28_Template","entities_r4","measureUnit_r5","SpatialFilterListComponent","_queryType","_zone","selectedZone","zoneChange","bufferChange","formValueChanges$$","bufferValueChanges$$","onZoneChange","SpatialFilterListComponent_mat_option_10_Template","SpatialFilterListComponent_mat_option_22_Template","queryType_r1","SpatialFilterTypeComponent","selectedTypeIndex","spatialType","activeDrawType","selectedQueryType","eventQueryType","onTypeChange","onDrawTypeChange","SpatialFilterTypeComponent_mat_option_8_Template","TimeFilterButtonComponent_div_1_igo_time_filter_item_2_Template","timeFilterCollapse","TimeFilterButtonComponent","TimeFilterButtonComponent_button_0_Template","TimeFilterButtonComponent_div_1_Template","handleDateChange","startDate","endDate","getRangeMaxDate","getRangeMinDate","TimeFilterFormComponent_div_0_div_1_Template","TimeFilterFormComponent_div_0_div_2_Template","isRange","year_r21","_r23","handleYearChange","TimeFilterFormComponent_div_1_div_1_mat_option_4_Template","listYears","startYear_r27","endYear_r28","startYear","TimeFilterFormComponent_div_1_div_2_mat_option_5_Template","endYear","TimeFilterFormComponent_div_1_div_2_mat_option_10_Template","startListYears","endListYears","TimeFilterFormComponent_div_1_div_1_Template","TimeFilterFormComponent_div_1_div_2_Template","_r35","_r34","handleSliderYearChange","TimeFilterFormComponent_div_3_p_9_Template","playYear","handleSliderValue","handleSliderDateChange","handleSliderTooltip","TimeFilterFormComponent","initStartYear","initEndYear","valueArray","yearChange","mySlider","getStepDefinition","timeInterval","getTimezoneOffset","is","checkFilterValue","storeCurrentFilterValue","timeFromWms","newStartListYears","newEndListYears","setupDateOutput","applyTypeChange","handleListYearChange","handleListYearStartChange","setSliderThumbLabel","thumbLabel","findThumbLabel","childNodes","textContent","newMinDateNumber","maxDateNumber","getRoundedDate","toDateString","toTimeString","setSeconds","setMinutes","getDay","selectedHour","selectedMinute","atMinute","coeff","TimeFilterFormComponent_div_0_Template","TimeFilterFormComponent_div_1_Template","TimeFilterFormComponent_div_3_Template","TimeFilterFormComponent_div_4_Template","TimeFilterItemComponent_mat_list_item_0_button_4_Template","TimeFilterItemComponent","timeFilterService","TimeFilterItemComponent_mat_list_item_0_Template","TimeFilterItemComponent_igo_layer_legend_5_Template","layer_r1","TimeFilterListComponent","TimeFilterListComponent_ng_template_1_Template","GeometryFormFieldInputComponent","olGeoJSON","defaultDrawStyleRadius","olGeometryEnds$$","olGeometryChanges$$","createMeasureTooltip","activeControl","_geometryType","deactivateControl","createDrawControl","toggleControl","_drawControlIsActive","_freehandDrawIsActive","_predefinedRadius","controlOptions","_drawStyle","olGuideStyle","getGuideStyleFromDrawStyle","_overlayStyle","addGeoJSONToOverlay","olModify","features_","addOlOverlayLayer","onTouched","updateDrawStyleWithDrawGuide","activateControl","onOlGeometryEnds","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","lastIndex","lastLength","olLastMidpoint","innerHtml","guideStyle","GeometryFormFieldInputComponent_ng_template_0_Template","IgoFilterModule","MAT_DATE_LOCALE","MatTreeModule","MatNativeDateModule","MatDatetimepickerModule","MatNativeDatetimeModule","i17","i18","i19","i20","i21","i22","i23","i24","i25","i26","i27","i28","i29","IgoImportExportModule","IgoMapModule","measureUnit_r1","MeasurerItemComponent","measure$$","auto","toggleAutoUnit","_auto","computeBestMeasureUnit","computeBestAreaUnit","converted","possibleUnits","computeBestLengthUnit","MeasurerItemComponent_mat_option_8_Template","IgoMeasurerModule","IgoMeasureModule","IgoPrintModule","querySearchSourceFactory","IgoQueryModule","IgoSearchSelectorModule","IgoSearchSettingsModule","IgoSearchBarModule","IgoSearchResultsModule","SearchSourceService","getSources","getEnabledSources","enableSourcesByType","searchSourceServiceFactory","sourceCanSearch","sourceCanReverseSearch","reverseSearch","sourceCanReverseSearchAsSummary","findDiff","str1","str2","computeTermSimilarity","caseSensitive","termFrom","termTo","totalDiff","delta","SearchService","searchSourceService","termIsValid","distance","getEnabledOnly","searchType","searchSources","asPointerSummary","reverseSourceFonction","reverseSearchCoordsFormat","reverseSearchSources","CoordinatesSearchResultFormatter","formatResult","CoordinatesReverseSearchSource","projections","title$","reverseSearchCoordsFormatEnabled","dataToResult","dataDMS","lonLatConversion","rawCoord3857","convertedLonLat","igo2CoordFormat","utmZoneFromLonLat","utmName","rawCoordUtm","mtmZoneFromLonLat","long","mtmName","rawCoordMtm","rawCoord","numericEpsgCode","roundedCoordString","roundedCoordStringDMS","subtitleHtml","circleGeometry","polygonGeometry","writer","writeGeometry","GoogleMaps","GoogleStreetView","OpenStreetMap","dataType","titleHtml","score","defaultCoordinatesSearchResultFormatterFactory","CoordinatesReverseSearchSourceFactory","_projectionService","provideCoordinatesReverseSearchSource","Boolean","IChercheSearchResultFormatter","IgoHttpParameterCodec","encodeKey","encodeValue","decodeKey","decodeValue","IChercheSearchSource","formatter","hashtagsLieuxToKeep","getAllowedTypes","limit","ecmax","showAdvancedParams","showAdvancedSettings","computeRequestParams","getSearch","extractResults","typeSetting","typesMatched","computeOptionsParam","q","computeTerm","xMin","yMin","xMax","yMax","encoder","computeProperties","highlight","title2","title3","nextPage","propertiesBlacklist","googleLinksProperties","googleMaps","googleMapsNom","pointOnFeature","municipalite","routing","keep","h","cacheHasher","IChercheReverseSearchSource","getReverseSearch","getSubtitle","computeExtent","pointerSummaryTitle","defaultIChercheSearchResultFormatterFactory","ichercheSearchSourceFactory","provideIChercheSearchSource","ichercheReverseSearchSourceFactory","provideIChercheReverseSearchSource","LayerListBindingDirective","layersOrResolutionChange$$","layersVisibility$$","setLayersVisibilityStatus","visibles","allLayersAreVisible","toggleTrackFeature","TrackFeatureButtonComponent","TrackFeatureButtonComponent_button_0_Template","ILayerSearchResultFormatter","allowedKey","dataR","ILayerSearchSource","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","formatOpt","urls","urlOpt","ilayerSearchResultFormatterFactory","ilayerSearchSourceFactory","provideILayerSearchSource","IgoSearchModule","StyleListService","styleList","getStyleList","baseStyleList","styleListResponse","STYLELIST_OPTIONS","provideStyleListOptions","styleListFactory","styleListService","IgoStyleListModule","FontType","Arial","ArialBlack","Verdana","Tahoma","TrebuchetMS","Impact","TimesNewRoman","Georgia","AmericanTypewriter","Courier","LucidaConsole","BrushScriptMT","ComicSansMS","DrawStyleService","labelsAreShown","fontSize","fontStyle","getFillColor","setFillColor","getStrokeColor","setStrokeColor","getStrokeWidth","getLabelsAreShown","toggleLabelsAreShown","setIcon","getIcon","getFontSize","setFontSize","getFontStyle","setFontStyle","getOffsetX","setOffsetX","getOffsetY","setOffsetY","createIndividualElementStyle","fontSizeAndStyle","labelsAreOffset","textToShow","textIgoStyleObject","flatCoordinates","IgoStyleModule","IgoConfirmationPopupModule","IgoOgcFilterModule","OgcFilterComponent","OgcFilterWidget","ogcFilterWidgetFactory","provideOgcFilterWidget","IgoWorkspaceUpdatorModule","IgoGeoWorkspaceModule","FeatureDetailsDirective","feature$","routingEvent","setFeature","bindClicking","routeElement","IgoOverlayModule","DownloadService","DSOptions","currentProj","outputFormatDownload","baseurl","openDownload","DownloadButtonComponent","downloadService","DownloadButtonComponent_button_0_Template","GeometryType","LineString","Circle","LabelType","Coordinates","Custom","CoordinatesUnit","DecimalDegree","DegreesMinutesSeconds","DrawIconService","icons","getIconsList","getIcons","getPath","createInteractionStyle","Olstyle","DDtoDMS","fontSelect_r6","StyleModalDrawingComponent","drawStyleService","confirmFlag","styleModalData","linestringOnly","buildStyleData","getFeatureFillColor","getFeatureStrokeColor","drawingStyle","allFontStyles","getFeatureFontSize","getFeatureFontStyle","getFeatureOffsetX","getFeatureOffsetY","cancelDrawing","confirm","openPicker","closePicker","StyleModalDrawingComponent_ng_container_6_Template","StyleModalDrawingComponent_mat_option_27_Template","DrawLayerPopupComponent","labelString","onLabelTypeChange","option_r8","optionAvailable","getProperLengthLabel","DrawPopupComponent_ng_container_3_mat_radio_group_14_mat_radio_button_1_Template","arrayBuiltInType","option_r12","DrawPopupComponent_ng_container_3_ng_container_15_mat_checkbox_1_Template","unit_r17","onChangeCoordinateUnit","DrawPopupComponent_ng_container_3_div_16_mat_option_8_Template","currentCoordinates","coordinatesMeasureUnit","allCoordinatesUnits","unit_r22","getLengthUnitEnum","onChangeLengthUnit","DrawPopupComponent_ng_container_3_div_17_mat_option_8_Template","lengthLabelT","currentLength","lengthMeasureUnit","allLengthUnits","unit_r27","getAreaUnitEnum","onChangeAreaUnit","DrawPopupComponent_ng_container_3_div_18_mat_option_10_Template","currentArea","areaMeasureUnit","allAreaUnits","DrawPopupComponent_ng_container_3_mat_radio_group_14_Template","DrawPopupComponent_ng_container_3_ng_container_15_Template","DrawPopupComponent_ng_container_3_div_16_Template","DrawPopupComponent_ng_container_3_div_17_Template","DrawPopupComponent_ng_container_3_div_18_Template","customOrPredefined","labelType","labelFlag","polygonCheck","noLabelButton","getLabelLength","currentLabel","DrawPopupComponent","lengthInMeters","areaInMetersSquare","coordinatesInDD","currentCoordinatesUnit","longlatDD","labelLength","longitudeLatitude","longitude","latitude","point4326","circularPolygon","buildArrayType","input","lengthUnit","areaUnit","coordinatesUnit","selectOptions","currentOption","getLength","DrawPopupComponent_ng_container_3_Template","DrawPopupComponent_ng_container_4_Template","DrawShorcutsComponent","onToggleFreehandMode","freehandMode","measureUnit_r12","DrawComponent_div_23_mat_option_7_Template","layer_r15","activeDrawingLayer","deleteDrawings","icon_html_r22","onIconChange","DrawComponent_mat_form_field_44_div_6_Template","DrawComponent_mat_form_field_44_mat_option_10_Template","openStyleModalDialog","DrawComponent","drawIconService","_stores","drawControls","_drawControls","_activeDrawingLayer","activeLayerChange","drawControlsEvent","layersIDEvent","activeStore","layerCounterID","draw$","activeDrawingLayerSource","drawSelect$$","strokeForm","radiusFormControlChange$$","Subscription","numberOfDrawings","isCreatingNewLayer","currGeometryType","draw","editLabelDrawing","dc","onLayerChange","changeRadius","newTitle","isNewLayer","autoFocus","onFontChange","onColorChange","onOffsetLabelChange","openDrawDialog","isDrawEnd","updateLabelOfOlGeometry","updateLabelType","updateMeasureUnit","updateFontSizeAndStyle","updateFillAndStrokeColor","updateOffset","onSelectDraw","updateHeightTable","clearLabelsOfOlGeometry","onModifyDraw","longLat","radiusLabel","olGeometryLength","lengthLabel","circleArea","areaLabel","olGeometryArea","replaceFeatureInStore","labelTypeAndUnit","olGeometryCoordinates","entityCoordinates","rad","center4326","lon4326","lat4326","extent4326","getDistance","setupLayer","onToggleLabels","selectionChange","olGeometryFeature","openShorcutsDialog","elementStyle","toggleIsChecked","isCircle","numberId","isAnIcon","onGeometryTypeChange","_label","fontStyle_","fillColor_","strokeColor_","offsetX_","offsetY_","typeOfLabel","labelType_","measureUnit_","updateActiveLayer","isLineString","radiusMeters","pointStyle","selectedMeasureUnit","DrawComponent_mat_slide_toggle_22_Template","DrawComponent_div_23_Template","DrawComponent_mat_option_32_Template","DrawComponent_button_36_Template","DrawComponent_button_39_Template","DrawComponent_mat_form_field_44_Template","DrawComponent_button_49_Template","OgcFilterableListBindingDirective","GeometryFormFieldComponent","geometryType$","GeometryFormFieldComponent_div_3_Template","GeometryFormFieldComponent_mat_form_field_4_Template","padTo2Digits","padStart","handleFileImportSuccess","file","confirmDialogService","handleNothingToImportError","computeLayerTitleFromFile","dformat","getDate","addLayerAndFeaturesStyledToMap","imposedSourceOptions","imposedLayerOptions","addLayerAndFeaturesToMap","randomStyle","searchIndexEnabled","handleInvalidFileImportError","handleUnreadbleFileImportError","handleSizeFileImportError","sizeMb","handleSRSImportError","handleOgreServerImportError","getFileExtension","ImportError","ImportInvalidFileError","setPrototypeOf","ImportUnreadableFileError","ImportNothingToImportError","ImportSizeError","ImportSRSError","ImportOgreServerError","ImportService","GeoJSON","GML","GPX","KML","Shapefile","ogreUrl","clientSideFileSizeMax","importConfig","clientSideFileSizeMaxMb","formats","allowedExtensions","formatExtensionAssociation","import","importAsync","getFileImporter","extension","zipMimeTypes","allowedZipMimeTypes","allowedMimeTypes","importFile","importFileWithOgre","importer","parseFeaturesFromFile","readAsText","FormData","append","parseFeaturesFromGeoJSON","errMsg","msg","writeFeatureObject","ExportError","ExportInvalidFileError","ExportNothingToExportError","ExportFormat","EncodingFormat","ExportService","CSVcomma","CSVsemicolon","aggregateInComment","gpxAggregateInComment","encoding","exportOlFeatures","generateFeature","exportAsync","excludePrefix","generateAggregatedFeature","comment","nothingToExport","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","encodingType","featuresText","UTF8","acceptCharset","enctype","LATIN1","featuresJson","encodedProperties","geojsonField","outputNameField","outputName","ogreFormat","outputFormatField","submit","CustomHtmlComponent","_html","projection_r6","translateKey","ImportExportComponent_form_8_mat_option_7_p_1_Template","ImportExportComponent_form_8_mat_option_7_p_2_Template","inputProj","ImportExportComponent_form_8_mat_option_7_Template","importFiles","files","importForm","projections$","invalid","loading$","fileSizeMb","importHtmlClarifications","ImportExportComponent_section_9_div_1_Template","ImportExportComponent_section_9_igo_custom_html_2_Template","layer_r29","onlySelectedClick","inLayersIdToExportSelectionOnly","onlySelected","ImportExportComponent_form_12_mat_option_10_mat_slide_toggle_4_Template","layerHasSelectedFeatures","format_r40","ImportExportComponent_form_12_ng_container_18_mat_option_1_Template","formats$","encoding_r43","ImportExportComponent_form_12_div_23_ng_container_6_mat_option_1_Template","encodings$","ImportExportComponent_form_12_div_23_ng_container_6_Template","exportHtmlClarifications","ImportExportComponent_form_12_span_9_Template","ImportExportComponent_form_12_mat_option_10_Template","ImportExportComponent_form_12_ng_container_18_Template","ImportExportComponent_form_12_mat_option_20_Template","ImportExportComponent_form_12_div_22_Template","ImportExportComponent_form_12_div_23_Template","ImportExportComponent_form_12_div_24_Template","ImportExportComponent_form_12_div_25_Template","ImportExportComponent_form_12_div_26_Template","handleExportFormSubmit","ImportExportComponent_form_12_igo_custom_html_36_Template","getLayerTitleById","exportableLayers$","forceNaming","combineLayers","ImportExportComponent","importService","exportService","controlFormat","exportableLayers$$","formats$$","encodings$$","formLayer$$","exportOptions$$","espgCodeRegex","projectionsConstraints","popupChecked","previousLayerSpecs$","selectFirstProj","_projectionsLimitations","computeProjections","selectedMode","selectMode","exportOptions$","exportOptionsChange","popupAllowed","loadConfig","configFileSizeMb","exportOptions","computeFormats","handlePopup","handlePreviousLayerSpecs","selectedLayers","previousSpecs","encodings","configProjection","getWorkspaceByLayerId","wksFromLayerId","wksFromLayer","layersWithSelection","specs","onFileImportSuccess","onFileImportError","preCheck","p2","closed","onPopupBlockedError","geomTypesCSV","featuresCSV","filename","layerIndex","dSOptions","wks","featureInMapExtent","geomTypes","featureGeomType","currentGeomType","geomType","circular","gpxFeatureCnt","previousFeature","currentFeature","titleEmptyRows","createTitleEmptyRows","onFileExportError","onFileExportSuccess","titleRow","headerRow","emptyRow","previousFeatureKeys","firstKeyPrevious","currentFeatureKeys","firstKeyCurrent","previousKey","firstKeyAll","sameKeys","unset","importExportOptions","allowToStoreLayer","handleFileImportError","extraMessage","handleFileExportError","handleNothingToExportError","forceNamingConfig","loadEncodings","encodingDefaultValue","appliedformats","formatsType","onlyUrl","onlyVector","vectorAndUrl","customList","allowedFormats","validateListFormat","configImportExportFormats","validatedListFormat","commonFormats","layersWithCustomFormats","previousCustomListFormats","finalFormats","modeChanged","handleFileExportSuccess","onImportExportChange","ImportExportComponent_form_8_Template","ImportExportComponent_section_9_Template","ImportExportComponent_section_10_Template","ImportExportComponent_form_12_Template","ExportButtonComponent","layerIsExportable","workspaceId","ExportButtonComponent_button_0_Template","ZoomButtonComponent","getMinZoom","getMaxZoom","onGeolocationClick","GeolocateButtonComponent","tracking$$","ngAfterContentInit","GeolocateButtonComponent_div_0_Template","HomeExtentButtonComponent","extentOverride","centerOverride","zoomOverride","homeExtentButtonExtent","homeExtentButtonCenter","homeExtentButtonZoom","computeHomeExtent","homeExtentButtonOptions","homeExtButtonExtent","homeExtButtonCenter","homeExtButtonZoom","WakeLockButtonComponent","noSleep","NoSleep","edge","opera","safari","disableWakeLock","enableWakeLock","toggleWakeLock","rotated$","azimuthRounded","rotationRounded","currentStyle$","RotationButtonComponent","showIfNoRotation","radians","deg","bearingToAzimuth","RotationButtonComponent_div_0_Template","OverlayAction","ZoomIfOutMapExtent","OverlayService","features$","OverlayDirective","overlayService","features$$","olFormatGeoJSON","handleFeatures","jsGeoPdfPlugin","jsPDFAPI","setGeoArea","pdfExt","geoExt","minx","maxx","maxy","miny","bounds","bbox_obj","internal","newAdditionalObject","bounds_obj","proj_obj","objId","title_obj","bbox_id","write","PrintOutputFormat","PrintPaperFormat","PrintOrientation","PrintResolution","PrintSaveImageFormat","PrintLegendPosition","PrintService","zipFile","nbFileToProcess","imgSizeAdded","TEXTPDFFONT","titleFont","titleFontStyle","subtitleFont","subtitleFontStyle","commentFont","commentFontStyle","commentFontSize","print","paperFormat","orientation","legendPostion","legendPosition","GeoPdfPlugin","jsPDF","API","dimensions","margins","titleSizes","subtitleSizes","A1","A0","fontSizeInPt","getTextPdfObjectSizeAndMarg","addTextInPdfDoc","marginLeft","showProjection","showScale","addProjScale","addComment","addMap","handleMeasureLayer","addGeoRef","addLegendSamePage","addLegend","saveDoc","docHeight","getHeight","pdf_extents","pdf_units2points","canvasOverlayHTMLMeasures","mapOverlayMeasuresHTML","getOverlayContainer","html2canvas","addCanvas","getLayersLegendHtml","legends","getLayersLegends","legendUrls","images$","getDataImage","rxMap","dataImage","htmlImg","dataImages","getLayersLegendImage","doZipFile","canvas","useCORS","removeHtmlElement","generateCanvaFileToZip","saveCanvasImageAsFile","pageWidth","setFont","textMarginLeft","textDimensions","getTextDimensions","w","commentMarginLeft","commentMarginBottom","textToAdd","textFont","textFontStyle","textFontSize","textMarginTop","isComment","splitTextToSize","heightPixels","textProjScale","_this4","imageSize","pourcentageReduction","imgData","addPage","toDataURL","addImage","_this5","marginsLegend","defineNbFileToProcess","ms","getImageSizeToFitPdf","rect","docSize","_this6","mapSize","viewResolution","dimensionPixels","setMapResolution","_ref2","mapCanvas","getViewport","mapResultCanvas","drawMap","resetOriginalMapSize","drawMapControls","mapStatus$$","mapStatus","_x2","initialSize","widthPixels","scaling","setResolution","updateSize","renderSync","_this7","handleCanvas","mapContextResult","getContext","parentElement","globalAlpha","matrix","CanvasRenderingContext2D","setTransform","fillStyle","fillRect","drawImage","_this8","mapOverlayHTML","getOverlayContainerStopEvent","cloneNode","addNorthDirection","addAttribution","canvasOverlayHTML","allowTaint","northDirection","HTMLButton","HTMLattribution","downloadMapImage","printResolution","_this9","initialMapSize","_ref3","addLegendToImage","newCanvas","newContext","positionHCanvas","commentWidth","measureText","positionHProjScale","commentNbLine","positionHComment","fillText","projectionScaleText","CommentLengthToCut","positionLastBlank","commentCurrentLine","positionFirstCutChar","fileNameWithExt","tfwFileNameWithExt","tiwContent","getWorldFileInformation","addFileToZip","saveAs","saveFileProcessing","_x3","setMapImageResolution","scaleFactor","newMapSize","_this10","canvasLegend","canvasHeight","canvasWidth","legendHeight","legendWidth","legendX","legendY","strokeRect","renderMap","save","returnPromise","pageHeight","canHeight","canWidth","heightRatio","widthRatio","maxRatio","currentResolution","nameWithExt","blobFormat","toBlob","JSZip","msSaveBlob","msToBlob","getZipFile","generateAsync","maxLength","legendPosition_r9","PrintFormComponent_mat_option_43_ng_container_1_Template","PrintFormComponent_mat_option_43_ng_container_2_Template","outputFormat_r13","paperFormat_r14","imageFormat_r15","resolution_r16","orientation_r17","PrintFormComponent","outputFormats","paperFormats","orientations","imageFormats","legendPositions","isPrintService","imageFormat","imageFormatField","Jpeg","onlySelf","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","none","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","minLength","handleFormSubmit","toggleImageSaveProp","clearValidators","changeCommentLength","A2","A3","A4","A5","PrintFormComponent_mat_error_8_Template","PrintFormComponent_mat_error_16_Template","PrintFormComponent_mat_error_24_Template","PrintFormComponent_mat_option_43_Template","PrintFormComponent_mat_option_52_Template","PrintFormComponent_mat_option_61_Template","PrintFormComponent_mat_option_70_Template","PrintFormComponent_mat_option_79_Template","PrintFormComponent_mat_option_88_Template","maxlength","PrintComponent","printService","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","DirectionsFormat","SourceDirectionsType","Trip","ProposalType","Coord","Text","DirectionType","Stop","Vertex","DirectionRelativePositionType","Start","Intermediate","End","updateStoreSorting","stopsStore","computeRelativePosition","totalLength","relativePosition","addStopToStore","stops","positions","stop","maxPosition","insertPosition","stopToUpdate","directionsStyle","vertexStyle","stopStyle","routeStyle","formatDistance","formatDuration","formatInstruction","modifier","stepPosition","exit","lastStep","directive","cssClass","translatedDirection","translateBearing","bearing","translatedModifier","translateModifier","aggregatedDirection","coma","cntSuffix","instruction","DirectionsService","directionsSourceService","directionsOptions","routeSource","downloadDirection","align","addInstructions","setPageHeaderFooter","setHTMLTableContent","directionsInstruction","tblBody","cellImage","cellText","img","span","spanDistance","verticalAlign","matListItem","iconsArray","iconName","iconCanvas","formattedDirection","maneuver","bearing_after","HTMLtable","autoTable","startY","titlePosition","margin","columnStyles","cellWidth","theme","didDrawCell","cell","section","raw","pageCount","getNumberOfPages","now","logo","setPage","baseline","getCurrentPageInfo","pageNumber","StopsStore","storeInitialized$","clearStops","StopsFeatureStore","RoutesFeatureStore","StepFeatureStore","stop_r1","clearStop","result_r12","DirectionsInputsComponent_div_1_mat_optgroup_9_mat_option_1_Template","source_r10","removeStop","DirectionsInputsComponent_div_1_div_10_button_4_Template","onStopEnter","onStopLeave","stopIsDragged","onInputFocus","setStopText","DirectionsInputsComponent_div_1_button_6_Template","chooseProposal","DirectionsInputsComponent_div_1_mat_optgroup_9_Template","DirectionsInputsComponent_div_1_div_10_Template","getNgClass","getPlaceholder","stopWithHover","getOptionText","searchProposals","DirectionsInputsComponent","invalidKeys","onMapClickEventKeys","stopsFeatureStore","coordRoundedDecimals","stopInputHasFocus","unlistenMapSingleClick","geomCoord","validateTerm","keyIsValid","extra","removeStopFromStore","computeStopsPosition","stopsToComputePosition","drop","moveStops","previousIndex","currentIndex","fromIndex","moveItemInArray","listenMapSingleClick","roundedCoord","olProj","olObservable","DirectionsInputsComponent_div_1_Template","resetStops","zoomRoute","copyDirectionsToClipboard","copyLinkToClipboard","printDirections","DirectionsButtonsComponent","directionsService","activeRoute","routesFeatureStore","zoomToActiveRoute$","stepFeatureStore","addStop","directionsBody","directionsToText","indent","activeRouteDirective","wayPointList","wayPointsCnt","stopText","localCnt","formatStep","routingOptions","directionsKey","stopsCoordinates","directionsUrl","pathname","DirectionsButtonsComponent_button_4_Template","DirectionsButtonsComponent_button_7_Template","DirectionsButtonsComponent_button_9_Template","DirectionsButtonsComponent_button_11_Template","DirectionsButtonsComponent_button_13_Template","direction_r5","cnt_r6","changeRoute","activeDirection","DirectionsResultsComponent_div_0_mat_form_field_1_mat_option_6_Template","directions","step_r10","showSegment","cnt_r11","DirectionsResultsComponent_div_0_mat_form_field_1_Template","DirectionsResultsComponent_div_0_mat_divider_2_Template","onStepsListBlur","DirectionsResultsComponent_div_0_mat_list_item_8_Template","DirectionsResultsComponent","activeFeatureWithDirection","showRouteSegmentGeometry","vertexId","lastPoint","olGeom","geojsonGeom","previousVertex","DirectionsResultsComponent_div_0_Template","DirectionsComponent","searchService","zoomRoute$$","storeEmpty$$","storeChange$$","routesQueries$$","selectStopInteraction","translateStop","selectedRoute","focusOnStop","isTranslating","previousStops","searchs$$","directionControlIsActive","initEntityStores","initStopsFeatureStore","loadingStrategy","initRoutesFeatureStore","initStepFeatureStore","initOlInteraction","u","freezeStores","interaction","monitorEmptyEntityStore","monitorEntityStoreChange","monitorActiveRouteZoom","routeExtent","executeStopTranslation","olCondition","selectCoordinates","addedStop","onStopInputHasFocusChange","translatedStopId","translationCoordinates","translatedStop","handleStopDiff","handleStopsFeature","getRoutes","cancelSearch","simplifiedStops","stopIdToProcess","changedStop","researches","isCoord","requests$","sp","storedSource","addStopOverlay","stopFeature","isOverview","stopsWithCoordinates","roundedCoordinates","routeResponse","overview","alternatives","continue_straight","addDirectionToRoutesFeatureStore","previousRoute","routeFeatureStore","addStopToStopsFeatureStore","stopColor","previousStop","stopFeatureStore","stopOpacity","onToggleDirectionsControl","OsrmDirectionsSource","_name","directionsParams","getRouteParams","getRoute","extractRoutesData","formatRoute","waypoints","geometries","roadNetworkRoute","stepsUI","legs","sourceType","weight_name","osrmDirectionsSourcesFactory","provideOsrmDirectionsSource","SEARCH_TYPES","SearchPointerSummaryDirective","pointerSearchStore","reverseSearch$$","hasPointerReverseSearchSource","searchPointerSummaryFeatureId","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","mouseleave","ngAfterContentChecked","unsubscribeReverseSearch","entitiesToPointerOverlay","computeSummaryClosestFeature","closestResultByType","summarizedClosestType","processedSummarizedClosestType","typeIndex","addPointerOverlay","onSearchCoordinate","sortByOrder","r1","r2","_results","onSearch","research","newResults","pointerSummary","CadastreSearchSource","endsWith","getCadastre","numero","lot","computeGeometry","NoLot","cadastreSearchSourceFactory","provideCadastreSearchSource","NominatimSearchSource","place_id","display_name","osm_type","boundingbox","computeTermTags","tag","computeTermSettings","nominatimSearchSourceFactory","provideNominatimSearchSource","StoredQueriesSearchSource","resultTitle","storedQueriesOptions","multipleFieldsQuery","defaultResultTitle","storedquery_id","splitPrefix","outputformat","srsname","storedqueriesParams","termSplitter","resultArray","extractWFSData","idxEnd","resultTotLenght","patternGml3","geojson","wfsfeatures","splittedTerm","remainingTerm","splitterRegex","wfsversion","StoredQueriesReverseSearchSource","longField","latField","longLatParams","doc_type","storedqueriesSearchSourceFactory","provideStoredQueriesSearchSource","storedqueriesReverseSearchSourceFactory","provideStoredQueriesReverseSearchSource","WorkspaceSearchSource","limitValue","fswi","termToUse","gettedIndex","sortedResultToProcess","resultsCnt","subtitleHtml2","workspaceSearchSourceFactory","provideWorkspaceSearchSource","searchType_r2","getSearchTypeTitle","SearchSelectorComponent","searchType$","searchType$$","searchTypes","setSearchType","searchTypeChange","onSetSearchType","onSearchTypeChange","SearchSelectorComponent_mat_radio_button_8_Template","checkUncheckAllSources","searchSourcesAllEnabled","source_r6","settingValue_r18","setting_r13","settingsValueCheckedRadioButton","getAvailableHashtagsValues","SearchSettingsComponent_ng_container_7_ng_container_7_span_6_mat_radio_button_2_Template","checkUncheckAll","allEnabled","settingValue_r32","settingsValueCheckedCheckbox","displayBlock","SearchSettingsComponent_ng_container_7_ng_container_7_span_7_div_1_Template","SearchSettingsComponent_ng_container_7_ng_container_7_span_7_mat_checkbox_3_Template","getAvailableValues","SearchSettingsComponent_ng_container_7_ng_container_7_span_6_Template","SearchSettingsComponent_ng_container_7_ng_container_7_span_7_Template","_r42","onCheckSearchSource","SearchSettingsComponent_ng_container_7_button_3_Template","SearchSettingsComponent_ng_container_7_button_4_Template","SearchSettingsComponent_ng_container_7_ng_container_7_Template","changePointerReverseSearch","pointerSummaryEnabled","SearchSettingsComponent","lastKeyTime","searchResultsGeometryEnabled","searchSourceChange","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","hasReverseSearchSourcesForPointerSummary","getSearchSources","textSearchSources","computeSourcesCheckAllBehavior","settingValue","computeSettingCheckAllBehavior","enabledSourcesCnt","disabledSourcesCnt","storage","changeSearchResultsGeometry","SearchSettingsComponent_div_6_Template","SearchSettingsComponent_ng_container_7_Template","SearchSettingsComponent_mat_slide_toggle_11_Template","onClearButtonClick","onSearchSettingsChange","SearchBarComponent","placeholder$","stream$","stream$$","researches$$","showSearchButton","withDivider","setTerm","_reverseSearchCoordsFormatEnabled","appearance","searchSelector","searchSettings","searchTermChange","clearFeature","searchSettingsChange","onSetTerm","handlePlaceholder","configValue","onKeyup","doSearch","reverseCoordEvent","slug","ss","rawTerm","terms","onResearchCompleted","SearchBarComponent_mat_label_3_Template","SearchBarComponent_button_10_Template","SearchBarComponent_mat_divider_12_Template","SearchBarComponent_button_14_Template","SearchBarComponent_igo_search_selector_15_Template","SearchBarComponent_igo_search_settings_16_Template","showIcons","tooltipHtml","SearchResultsItemComponent_ng_template_3_span_0_Template","onZoomHandler","SearchResultsItemComponent","withZoomButton","zoomEvent","getEntityTitleHtml","titleHtmlProperty","hideBtn","showBtn","SearchResultsItemComponent_mat_icon_1_Template","SearchResultsItemComponent_div_2_Template","SearchResultsItemComponent_ng_template_3_Template","SearchResultsItemComponent_button_6_Template","SaveFeatureDialogComponent","filteredLayers$","SaveFeatureDialogComponent_mat_option_13_Template","addFeatureToLayer","addFeatureToLayerTooltip$","SearchResultAddButtonComponent","layersSubcriptions","saveSearchResultInLayer","currEvent","Stroke","Fill","searchLayer","SearchResultAddButtonComponent_button_0_Template","SearchResultAddButtonComponent_button_1_Template","CollapsibleComponent","_title","group_r4","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_ng_container_1_Template","computeGroupTitle","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_ng_container_0_Template","result_r20","resultFocus","resultUnfocus","onResultSelect","templateSearchToolbar","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_ng_template_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_span_1_Template","results_r17","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_Template","searchResultMode","Grouped","SearchResultsComponent_igo_list_0_ng_template_1_Template","results$","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_ng_container_1_Template","group_r39","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_Template","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_ng_container_0_Template","group_r42","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_Template","result_r47","_r56","group_r44","SearchResultsComponent_igo_list_1_ng_template_6_ng_template_0_Template","SearchResultsComponent_igo_list_1_ng_template_6_span_1_Template","SearchResultsComponent_igo_list_1_ng_container_1_Template","SearchResultsComponent_igo_list_1_ng_template_2_Template","SearchResultsComponent_igo_list_1_ng_template_4_Template","SearchResultsComponent_igo_list_1_ng_template_6_Template","SearchResultMode","Flat","SearchResultsComponent","showResultsCount","settingsChange$$","pageIterator","tabsMode","_term","settingsChange$","resultSelect","moreResults","resultMouseenter","resultMouseleave","_results$","liftResults","groupResults","grouped","sourceResults","SearchResultsComponent_igo_list_0_Template","SearchResultsComponent_igo_list_1_Template","WfsWorkspace","getLayerWksOptionTabQuery","queryOptions","tabQuery","getLayerWksOptionMapQuery","mapQueryOnOpenTab","getInResolutionRange","getCommonVectorSelectedStyle","markerOpacity","fillOpacity","strokeOpacity","getCommonVectorStyle","isOlFeature","markerColorAsArray","markerColorRGB","mapExtentStrategyActiveToolTip","addOrRemoveLayer","addedLayerId","ws$","geoServiceAction","getGeoServiceAction","geoServiceProperties","relations","columnsFromFeatures","col","cellClass","relationsColumn","relation","class_icon","createFilterInMapExtentOrResolutionStrategy","WfsWorkspaceService","zoomAuto","createWorkspace","srcId","createFeatureStore","inMapExtentStrategy","geoPropertiesStrategy","inMapResolutionStrategy","confQueryOverlayStyle","FeatureWorkspace","FeatureWorkspaceService","searchStrategy","ConfirmationPopupComponent","cancelAction","confirmedAction","EditionWorkspace","adding$","getDomainValues","modifyStyle","newFeaturefilterClauseFunc","editFeaturefilterClauseFunc","edit","deleteFeature","deleteUrl","columnName","editFeature","editionOpt","original_properties","original_geometry","idkey","addWithDraw","featureOl","createModifyInteraction","olCollection","Collection","EditionWorkspaceService","relationLayers$","rowsInMapExtentCheckCondition$","wktFormat","WKT","geoJsonFormat","wksConfig","wmsLinkId","wfsLinkId","linkProperties","hasOgcFilters","clonedLinks","workspaceLayer","rendererType","modifyButton","deleteButton","saveFeature","cancelEdit","validateFeature","sanitizeParameter","addUrl","addHeaders","modifyProtocol","modifyUrl","protocole","modifyHeaders","modifyFeature","hasGeometry","projDest","geomDatabaseProj","refreshMap","removeZ","relationLayers","fromSave","wfsOlLayer","wmsOlLayer","_t","WmsWorkspaceService","printable","WorkspaceSelectorDirective","wfsWorkspaceService","wmsWorkspaceService","editionWorkspaceService","featureWorkspaceService","changeWorkspace","rowsInMapExtentCheckCondition","workspaceStore","onLayersChange","adding","editableLayers","layerIsEditable","editableLayersIds","workspacesToAdd","getOrCreateWorkspace","workspacesToRemove","wmsWks","StyleModalLayerComponent","initialValues","defaultValues","getLayerFillColor","getLayerStrokeColor","arrayColor","setLayerFillColor","cAA","setLayerStrokeColor","StyleModalLayerComponent_div_6_Template","StyleModalLayerButtonComponent","collectFeaturesFromExtraFeatures","TypePermission","null","ContextService","context$","contexts$","ours","defaultContextId$","editedContext$","importedContext","toolsChanged$","mapViewFromRoute","defaultContextUri","_defaultContextUri","basePath","contextListFile","readParamsFromRoute","handleContextsChange","loadContexts","permissions","getById","getDetails","getDefault","getContextByUri","getProfilByUser","setDefault","defaultContextId","hideContext","showContext","imported","contexts","contextCreated","permission","contextCloned","addToolAssociation","contextId","toolId","deleteToolAssociation","getPermissions","addPermissionAssociation","profil","typePermission","deletePermissionAssociation","permissionId","getLocalContexts","getLocalContext","urlBase","resBase","resMerge","l2","t2","err2","loadDefaultContext","loadFct","direct","_context","addContextToList","setContext","loadContext","contextParam","handleContextMessage","currentContext","keepCurrentView","loadEditedContext","setEditedContext","getContextFromMap","igoMap","global","getContextFromLayers","extraFeatures","layerFound","contextLayer","layerFoundAs","olVectorSource","getExtraFeatures","catalogLayer","Cluster","cleanedOlFeatures","contextToLoad","getContextLayers","mapLayers","permissionError","titleContext","keepCurrentContext","editedContext","findContext","editedFound","public","found","LayerContextDirective","contextService","context$$","contextLayers","removeLayersOnContextChange","handleContextChange","layersAndIndex$","handleAddLayers","addImportedFeaturesStyledToMap","addImportedFeaturesToMap","featureKeys","computeLayerVisibilityFromUrl","currentLayerid","contextParams","visibleOnLayersParams","visibleOffLayersParams","visiblelayers","invisiblelayers","MapContextDirective","viewContext","controlsContext","scaleLineOption","minWidth","IgoContextManagerModule","IgoShareMapModule","IgoSidenavModule","MatSidenavModule","IgoContextModule","ContextExportService","ContextImportService","parseContextFromFile","ContextImportExportComponent_form_9_mat_option_18_Template","userControlledLayerList","ContextImportExportComponent","contextImportService","contextExportService","layerList","activeImportExport","contextOptions","contextTitle","addContextToContextList","ContextImportExportComponent_div_8_Template","ContextImportExportComponent_form_9_Template","BookmarkDialogComponent","ContextListControlsEnum","iconImage","favoriteClick","ContextItemComponent_button_1_mat_icon_2_Template","ContextItemComponent_button_1_img_3_Template","managePermissions","ContextItemComponent_div_5_button_1_Template","ContextItemComponent_div_5_button_4_Template","ContextItemComponent_div_5_button_5_Template","ContextItemComponent_div_5_button_6_Template","ContextItemComponent_div_5_button_7_Template","ContextItemComponent_div_5_button_8_Template","ContextItemComponent_div_5_button_9_Template","canShare","ContextItemComponent","showFavorite","favorite","manageTools","ContextItemComponent_button_1_Template","ContextItemComponent_button_2_Template","ContextItemComponent_div_5_Template","clearFilter","ContextListComponent_mat_form_field_2_button_6_Template","toggleSort","user_r17","child_r24","userSelection","getPermission","ContextListComponent_ng_container_10_button_4_Template","ContextListComponent_ng_container_10_button_5_Template","ContextListComponent_ng_container_10_mat_checkbox_9_Template","indeterminate","childs","context_r36","selectedContext","_r50","groupContexts_r32","titleMapping","ContextListComponent_ng_template_17_igo_collapsible_0_ng_template_2_Template","context_r54","ctx_r57","contextConfigs","ContextListComponent_ng_template_17_1_ng_template_0_Template","ContextListComponent_ng_template_17_igo_collapsible_0_Template","ContextListComponent_ng_template_17_1_Template","ContextListComponent","contextsInitial","_contexts","_selectedContext","_defaultContextId","showHiddenContexts","filterPermissionsChanged","shared","users","showHidden","sortedAlpha","showContextFilter","thresholdToFilter","filterContextsList","createContext","sortContextsList","updateContexts","publics","showFilter","contextsList","parentPermission","childrenPermission","ContextListComponent_mat_form_field_2_Template","ContextListComponent_button_4_Template","ContextListComponent_button_5_Template","ContextListComponent_igo_actionbar_6_Template","ContextListComponent_button_7_Template","ContextListComponent_ng_container_10_Template","ContextListComponent_ng_template_17_Template","ContextListBindingDirective","contexts$$","selectedContext$$","defaultContextId$$","onEdit","onSave","contextFromMap","msgSuccess","onFavorite","onManageTools","onManagePermissions","onDelete","onClone","onCreate","onShowContext","onHideContext","storedContextUri","authenticate","profilsAcc","cur","ContextFormComponent","btnSubmitText","_btnSubmitText","uriSplit","ContextFormComponent_span_8_Template","ContextEditComponent","ContextEditComponent_igo_context_form_0_Template","ContextEditBindingDirective","editedContext$$","submitSuccessed","handleEditedContextChange","scopeChanged","ContextPermissionsComponent_div_0_div_2_mat_radio_button_8_Template","profil_r11","onProfilSelected","ContextPermissionsComponent_div_0_form_3_mat_option_6_Template","permission_r19","removePermission","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_button_7_Template","profilTitle","canWrite","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_Template","groupPermissions_r16","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_Template","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_Template","ContextPermissionsComponent_div_0_div_1_Template","ContextPermissionsComponent_div_0_div_2_Template","ContextPermissionsComponent_div_0_form_3_Template","ContextPermissionsComponent_div_0_igo_list_4_Template","ContextPermissionsComponent","_permissions","_profils","baseUrlProfils","addPermission","profilTitleNormalized","ContextPermissionsComponent_div_0_Template","ContextPermissionsBindingDirective","onAddPermission","onRemovePermission","onScopeChanged","permissionsArray","ShareMapService","getUrlWithApi","formValues","createContextShared","updateContextShared","getUrlWithoutApi","publicShareOption","llc","layerlistControls","querystring","visibleKey","invisibleKey","visibleLayers","invisibleLayers","layersUrl","layersToLoop","contextLayersID","addedLayersQueryParamsWms","makeLayersByService","addedLayersQueryParamsWmts","addedLayersQueryParamsArcgisRest","addedLayersQueryParamsImageArcgisRest","addedLayersQueryParamsTileArcgisRest","arrayCenter","typeService","addedLayersByService","layerVersion","linkUrl","addedLayer","addedLayerPosition","definedUrl","addedLayersQueryParams","linkUrlKey","layersKey","linkUrlQueryParams","layersQueryParams","ShareMapUrlComponent_div_13_h4_1_Template","ShareMapUrlComponent_div_13_li_4_Template","ShareMapUrlComponent_div_13_li_6_Template","ShareMapUrlComponent_div_13_li_8_Template","ShareMapUrlComponent_div_13_li_10_Template","ShareMapUrlComponent_div_13_li_12_Template","ShareMapUrlComponent_div_13_h4_14_Template","ShareMapUrlComponent_div_13_li_17_Template","ShareMapUrlComponent_div_13_li_19_Template","ShareMapUrlComponent_div_13_li_21_Template","ShareMapUrlComponent_div_13_li_23_Template","ShareMapUrlComponent","shareMapService","mapState$$","resetUrl","ShareMapUrlComponent_div_13_Template","ShareMapUrlComponent_igo_custom_html_15_Template","userId","ShareMapApiComponent","idContextShared","createUrl","ShareMapApiComponent_span_10_Template","ShareMapApiComponent_button_18_Template","ShareMapApiComponent_button_19_Template","ShareMapApiComponent_div_20_Template","ShareMapComponent","hasApi","ShareMapComponent_mat_tab_group_0_Template","ShareMapComponent_igo_share_map_url_1_Template","AppContextRoutingModule","AppContextComponent","AppContextComponent_ng_template_15_Template","AppContextModule","HttpClientJsonpModule","AppActivityRoutingModule","AppActivityComponent","counter","AppActivityModule","environment","production","igo","interactiveTour","tourInMobile","activateInteractiveTour","importExport","json","storedqueriesreverse","nominatim","icherche","coordinatesreverse","icherchereverse","ilayer","AppConfigRoutingModule","AppConfigComponent","configLanguage","AppConfigModule","AppHomeRoutingModule","AppHomeComponent","AppHomeModule","AppLanguageRoutingModule","AppLanguageComponent","app","changeLanguage","AppLanguageModule","AppMediaRoutingModule","AppMediaComponent","AppMediaModule","AppMessageRoutingModule","AppMessageComponent","AppMessageModule","AppRequestRoutingModule","AppRequestComponent","callHttp","callHttpError","AppRequestModule","AppCatalogRoutingModule","AppCatalogComponent","catalogStore","catalogItemStore","onCatalogSelectChange","AppCatalogModule","AppDirectionsRoutingModule","AppDirectionsComponent","AppDirectionsModule","AppDrawRoutingModule","AppDrawComponent","AppDrawModule","AppFeatureRoutingModule","AppFeatureComponent","AppFeatureModule","AppGeometryRoutingModule","AppGeometryComponent","AppGeometryComponent_igo_form_5_Template","AppGeometryModule","AppHoverRoutingModule","AppHoverComponent","pointerCoord","pointerCoordDelay","pointerHoverFeatureDelay","AppHoverModule","AppImportExportRoutingModule","AppImportExportComponent","AppImportExport","AppLayerRoutingModule","AppLayerComponent","AppLayerComponent_ng_template_10_Template","AppLayerModule","AppLegendRoutingModule","AppLegendComponent","AppLegendModule","AppMeasureRoutingModule","AppMeasureComponent","AppMeasureModule","AppOgcFilterRoutingModule","AppOgcFilterComponent","AppOgcFilterModule","AppOverlayRoutingModule","AppOverlayComponent","AppOverlayModule","AppPrintRoutingModule","AppPrintComponent","AppPrintModule","feature_r3","AppQueryComponent_ng_container_5_div_1_Template","features_r1","AppQueryRoutingModule","AppQueryComponent","feature1","olLineString","feature2","feature3","handleQueryResults","AppQueryComponent_ng_container_5_Template","AppQueryModule","IgoAppSearchBarModule","IgoAppSearchResultsToolModule","IgoAppSearchModule","openGuide","guide_r7","formatFileName","headerHtml","AboutToolComponent","configOptions","_headerHtml","_discoverTitleInLocale","discoverTitleInLocale","trainingGuideURLs","effectiveVersion","baseUrlProfil","baseUrlGuide","configVersion","depot","guideUrl","guides","trainingGuides","guide","AboutToolComponent_button_2_Template","AboutToolComponent_button_3_Template","AboutToolComponent_button_6_Template","AboutToolComponent_igo_custom_html_7_Template","ImportExportType","ImportExportMode","ImportExportState","importExportType$","selectedMode$","setImportExportType","setMode","setsExportOptions","ToolState","importExportState","openSidenav$","toolToActivateFromOptions","toolToActivate","ContextState","toolState","onContextChange","updateTools","contextTool","baseTool","parentIndex","MapState","_legendToolShowAll","applyNewLayers","layer_r5","AdvancedSwipeComponent_div_0_mat_option_12_Template","startSwipe","swipe","searchEmit","catalogEmit","contextEmit","AdvancedSwipeComponent","mapState","listForSwipe","AdvancedSwipeComponent_div_0_Template","AdvancedSwipeComponent_ng_template_1_Template","projection_r11","translatedValue","AdvancedCoordinatesComponent","formattedScale$","currentCenterDefaultProj","inMtmZone","inLambert2","defaultProj","currentZones","setScaleValue","currentMtmZone","currentUtmZone","back2quebec","updateProjectionsZoneChange","checkLambert","tempInputProj","positionInList","updateZoneMtmUtm","displayCenter","modifiedProj","pushMtm","tk","iter","currentExtentWGS","AdvancedCoordinatesComponent_mat_form_field_2_Template","AdvancedCoordinatesComponent_ng_template_3_Template","AdvancedCoordinatesComponent_mat_form_field_5_Template","AdvancedCoordinatesComponent_ng_template_6_Template","AdvancedCoordinatesComponent_mat_option_17_Template","AdvancedMapToolComponent","toggleTracking","toggleFollow","MapProximityState","defaultProximityRadiusValue","enabled$","proximityRadiusValue$","proximitylocationType$","proximityFeatureStore","subs$$","currentPositionCoordinate$","subscribeProximityMonitor","currentPos","locationType","proximityRadiusValue","roundedCoordLonLat","layerToMonitor","layerSource","olFeaturesAtCoordinate","getFeaturesAtCoordinate","olFeatureAtCoordinate","featureAtThisPosition","closestOlFeature","getClosestFeatureToCoordinate","closestOlGeom","closestFeature","geometryClosestPoint","getClosestPoint","lineLength","coordFromCalculatedDistance","layerSrcId","layerSrcTitle","coord_r4","coord2_r6","MapProximityToolComponent","mapProximityState","maxDistance","userDefinedMapCenter","userDefinedFollowPosition","onLocationTypeChange","MapProximityToolComponent_mat_form_field_3_Template","MapProximityToolComponent_mat_form_field_5_Template","MapProximityToolComponent_button_7_Template","StorageState","igoStorageService","handleZoomAuto","getWorkspaceActions","selectOnlyCheckCondition$","ogcFilterWidget","zoomAuto$","maximize$","datePipe","noElementSelected","filterStrategy","totalPagesExp","tableWidth","horizontalPageBreak","cellPadding","minCellWidth","didDrawPage","putTotalPages","returnActions","EditionActionsService","storageState","storageChange$$","loadActions","buildActions","storageChange","FeatureActionsService","WfsActionsService","WorkspaceState","featureActionsService","wfsActionsService","editionActionsService","workspacePanelExpanded","workspaceEnabled$","workspaceMaximize$","actionMaximize$$","rowsInMapExtentCheckCondition$$","selectOnlyCheckCondition$$","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","workspace$","workspaceSelection","workspaceSelection$","initWorkspaces","maximized","setWorkspaceIsMaximized","rowsInMapExtent","selectOnly","setActiveWorkspaceById","wksFromId","setActiveWorkspaceByTitle","wksFromTitle","teardownWorkspaces","WorkspaceButtonComponent","workspaceState","hasWorkspace$","hasWorkspace$$","layer$","WorkspaceButtonComponent_button_0_Template","activateExport","MapDetailsToolComponent_igo_layer_list_0_ng_template_1_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_p_4_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_5_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_6_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_7_Template","layerAdditionAllowed","searchToolInToolbar","catalogToolInToolbar","contextToolInToolbar","MapDetailsToolComponent_ng_template_2_mat_list_0_Template","delayedShowEmptyMapContent","MapDetailsToolComponent","layerListControls","filterSortOptions","MapDetailsToolComponent_igo_layer_list_0_Template","MapDetailsToolComponent_ng_template_2_Template","LayerLegendListBindingDirective","onShowAllLegends","showAllLegendsValue$","MapLegendToolComponent_1_ng_template_0_Template","visibleLayers$","MapLegendToolComponent_ng_template_6_mat_list_0_p_4_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_5_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_6_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_7_Template","MapLegendToolComponent_ng_template_6_mat_list_0_Template","MapLegendToolComponent","visibleOrInRangeLayers$$","visibleOrInRangeLayers$","visibleOrInRangeLayers","MapLegendToolComponent_igo_layer_legend_list_0_Template","MapLegendToolComponent_1_Template","MapLegendToolComponent_p_3_Template","MapLegendToolComponent_ng_template_6_Template","MapToolComponent","MapToolComponent_ng_template_4_Template","LayerListToolState","keyword$","selectedTab$","setKeyword","setSortAlpha","setOnlyVisible","setSelectedTab","tab","getLayerListControls","activateTimeFilter","activateOgcFilter","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_style_modal_layer_button_0_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_time_filter_button_3_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_ogc_filter_button_4_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_export_button_5_Template","isStyleEditButton","isTimeFilterButton","isOGCFilterButton","isExportButton","onLayerListChange","MapToolsComponent_igo_layer_list_5_ng_template_1_Template","MapToolsComponent_10_ng_template_0_Template","MapToolsComponent_ng_template_15_mat_list_0_p_4_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_5_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_6_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_7_Template","MapToolsComponent_ng_template_15_mat_list_0_Template","MapToolsComponent","layerListToolState","selectedTabAtOpening","_layerListControls","stateOptions","stateKeyword","stateOnlyVisible","stateSortAlpha","tabGroup","selectedTab","userSelectedTab","tabChanged","appliedFilters","MapToolsComponent_igo_layer_list_5_Template","MapToolsComponent_igo_layer_legend_list_9_Template","MapToolsComponent_10_Template","MapToolsComponent_p_12_Template","MapToolsComponent_ng_template_15_Template","SearchState","searchLayerStores","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","focusedOrResolution$$","selectedOrResolution$$","searchTermSplitter$","searchTerm$","searchDisabled$","searchResultsGeometryEnabled$","searchSettingsChange$","selectedResult$","createCustomFilterTermStrategy","wksSource","searchableWks","monitorLayerDeletion","activateCustomFilterTermStrategy","deactivateCustomFilterTermStrategy","enableSearch","disableSearch","setSearchTerm","searchTerm","setSearchSettingsChange","setSelectedResult","setSearchResultsGeometryStatus","ContextManagerToolComponent","toolToOpenOnContextChange","editContext","ContextEditorToolComponent","ContextPermissionManagerToolComponent","ContextShareToolComponent","CatalogState","_catalogStore","catalogItemsStores","clearCatalogItemsStores","getCatalogItemsStore","setCatalogItemsStore","store_r1","CatalogBrowserToolComponent","catalogState","store$","catalog$$","authenticate$$","CatalogBrowserToolComponent_igo_catalog_browser_0_Template","CatalogLibraryToolComponent","DirectionState","DirectionsToolComponent","directionState","contextState","currentContextUri","DrawState","layersID","deletedStore","drawControlIndex","DrawingToolComponent","drawState","addLayersID","addDrawControls","OgcFilterToolComponent","ActiveOgcFilterToolComponent","feature_r1","SpatialFilterToolComponent","activeLayers","iterator","selectedFeature$","spatialListStore","moveendKey","getOutputType","getOutputQueryType","activateExportTool","re","layerToOpenWks","zeroResults","selectWorkspaceEntity","getOutputToggleSearch","loadThematics","getOutputClearSearch","clearMap","tryAddFeaturesToMap","featuresPoint","featuresLinePoly","idPoint","idLinePoly","tryAddPointToMap","tryAddLayerToMap","zoomToFeatureExtent","_internal","featuresOl","createSvgIcon","pushLayer","xmlSerializer","SpatialFilterToolComponent_ng_container_4_Template","MatIconRegistry","TimeFilterListBindingDirective","TimeFilterToolComponent","ActiveTimeFilterToolComponent","ImportExportToolComponent","importExportType","importExportShowBothType","selectType","userSelectedType","userSelectedMode","importExportTypeChange","ImportExportToolComponent_mat_tab_group_0_Template","ImportExportToolComponent_igo_import_export_1_Template","ImportExportToolComponent_igo_context_import_export_2_Template","MeasureState","getOverlays","MeasurerToolComponent","measureState","PrintToolComponent","result_r6","isSelectedResultOutOfView$","toggleTopPanel","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_button_4_Template","featureTitle","topPanelState$","onResultFocus","onResultUnfocus","SearchResultsToolComponent_igo_flexible_2_ng_template_5_Template","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_Template","topPanelState","SearchResultsToolComponent","searchState","topPanelStateDefault","hasFeatureEmphasisOnSelection","showResultsGeometries$$","getRoute$$","shownResultsGeometries","shownResultsEmphasisGeometries","focusedResult$","isSelectedResultOutOfView$$","abstractFocusedResult","abstractSelectedResult","debouncedEmpty$","debouncedEmpty$$","searchTerm$$","topPanelState$$","computeElementRef","adjustTopPanel","buildResultEmphasis","monitorResultOutOfView","searchResults","clearFeatureEmphasis","selectedResult","selectedOlFeatureExtent","abstractResult","computedStyle","zIndexOffset","shownResult","tryAddFeatureToMap","routingCoordLoaded","currentCoord","SearchResultsToolComponent_div_0_Template","SearchResultsToolComponent_igo_flexible_2_Template","ElementRef","ContextMenuDirective","viewContainerRef","elementRef","overlayRef","menuContext","menuPosition","onContextMenu","TouchEvent","pageX","pageY","MouseEvent","positionStrategy","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","scrollStrategy","scrollStrategies","attach","TemplatePortal","clickTarget","overlayElement","dispose","result_r7","AppSearchRoutingModule","AppSearchComponent","osmLayer","mapBrowser","searchStore","igoReverseSearchCoordsFormatEnabled","onPointerSummaryStatusChange","onSearchTermChange","onReverseCoordsFormatStatusChange","searchCoordinate","openGoogleMaps","openGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","contextmenuPoint","getBoundingClientRect","scrollY","scrollX","AppSearchComponent_span_2_Template","AppSearchComponent_ng_template_9_Template","AppSearchComponent_igo_panel_11_Template","AppSearchComponent_ng_template_12_Template","AppSearchModule","infoContent","InfoSectionComponent","InfoSectionComponent_div_0_Template","AppSimpleMapRoutingModule","AppSimpleMapComponent","onPointerMove","AppSimpleMapComponent_p_9_Template","AppSimpleMapModule","AppSpatialFilterRoutingModule","AppSpatialFilterComponent","AppSpatialFilterComponent_ng_container_12_Template","AppSpatialFilterModule","AppTimeFilterRoutingModule","AppTimeFilterComponent","AppTimeFilterModule","workspace_r2","AppWorkspaceComponent_ng_container_5_igo_entity_table_paginator_1_Template","workspace_r7","workspacePaginator","AppWorkspaceComponent_ng_container_7_igo_actionbar_1_Template","AppWorkspaceComponent_ng_container_7_igo_entity_table_2_Template","AppWorkspaceComponent_ng_container_7_mat_card_content_4_Template","AppWorkspaceRoutingModule","AppWorkspaceComponent","selectedWorkspace$","AppWorkspaceComponent_ng_container_5_Template","AppWorkspaceComponent_ng_container_7_Template","AppWorkspaceModule","defaultTooltipOptions","showDelay","hideDelay","touchendHideDelay","disableTooltipInteractivity","AppModule","bootstrap","MAT_FORM_FIELD_DEFAULT_OPTIONS","appInitializerFactory","ApplicationRef","MAT_TOOLTIP_DEFAULT_OPTIONS","DatePipe","MatToolbarModule","HammerModule","applicationRef","isStable","setTranslation","enableProdMode","__NgCli_bootstrap_1","bootstrapModule","webpackContext","webpackContextResolve","__webpack_require__","module","exports"],"sourceRoot":"webpack:///","sources":["./packages/utils/src/lib/base64.ts","./packages/utils/src/lib/cache.utils.ts","./packages/utils/src/lib/user-agent.ts","./packages/utils/src/lib/clipboard.ts","./packages/utils/src/lib/change.interface.ts","./packages/utils/src/lib/string-utils.ts","./packages/utils/src/lib/change.ts","./packages/utils/src/lib/dom.utils.ts","./packages/utils/src/lib/file.ts","./packages/utils/src/lib/object-utils.ts","./packages/utils/src/lib/number-utils.ts","./packages/utils/src/lib/strenum.ts","./packages/utils/src/lib/uuid.ts","./packages/utils/src/lib/watcher.ts","./packages/core/src/lib/activity/activity.service.ts","./packages/core/src/lib/activity/activity.interceptor.ts","./packages/core/src/lib/activity/activity.module.ts","./packages/core/src/lib/config/config-deprecated.ts","./packages/core/src/lib/config/version.ts","./packages/core/src/lib/config/config.service.ts","./packages/core/src/lib/config/config.provider.ts","./packages/core/src/lib/config/config.module.ts","./packages/core/src/lib/language/shared/language.loader.ts","./packages/core/src/lib/language/shared/language.provider.ts","./packages/core/src/lib/language/shared/missing-translation.guard.ts","./packages/core/src/lib/language/language.module.ts","./packages/core/src/lib/message/message.module.ts","./packages/core/src/lib/message/shared/message.enum.ts","./packages/core/src/lib/language/shared/language.service.ts","./packages/core/src/lib/message/shared/message.service.ts","./packages/core/src/lib/request/error.interceptor.ts","./packages/core/src/lib/request/error.module.ts","./packages/core/src/lib/core.module.ts","./packages/core/src/lib/route/route.service.ts","./packages/core/src/lib/media/media.enum.ts","./packages/core/src/lib/media/media.service.ts","./packages/core/src/lib/storage/storage.interface.ts","./packages/core/src/lib/storage/storage.ts","./packages/core/src/lib/storage/storage.service.ts","./packages/core/src/lib/compression/compression.service.ts","./packages/core/src/lib/network/network.service.ts","./packages/core/src/lib/regex/regex.service.ts","./demo/src/app/app-routing.module.ts","./demo/src/app/app.component.ts","./demo/src/app/app.component.html","./packages/auth/src/lib/shared/token.service.ts","./packages/auth/src/lib/shared/auth.service.ts","./packages/auth/src/lib/auth-form/auth-google.component.ts","./packages/auth/src/lib/auth-form/auth-google.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.html","./packages/auth/src/lib/auth-form/auth-microsoft.component.ts","./packages/auth/src/lib/auth-form/auth-microsoft.component.html","./packages/auth/src/lib/shared/auth-msalServiceb2c.service..ts","./packages/auth/src/lib/shared/auth-msalBroadcastServiceb2c.service.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.html","./packages/auth/src/lib/auth-form/auth-form.component.html","./packages/auth/src/lib/auth-form/auth-form.component.ts","./packages/auth/src/lib/shared/auth.interceptor.ts","./packages/auth/src/lib/shared/auth-microsoft.provider.ts","./packages/auth/src/lib/shared/protected.directive.ts","./packages/auth/src/lib/shared/storage.service.ts","./packages/auth/src/lib/auth.module.ts","./demo/src/app/components/doc-viewer/doc-viewer.module.ts","./demo/src/app/components/example/example.module.ts","./demo/src/app/shared/shared.module.ts","./demo/src/app/components/example/example-viewer/example-viewer.component.html","./demo/src/app/components/example/example-viewer/example-viewer.component.ts","./demo/src/app/components/doc-viewer/doc-viewer.component.html","./demo/src/app/components/doc-viewer/doc-viewer.component.ts","./demo/src/app/auth/auth-form/auth-form-routing.module.ts","./demo/src/app/auth/auth-form/auth-form.component.ts","./demo/src/app/auth/auth-form/auth-form.component.html","./demo/src/app/auth/auth-form/auth-form.module.ts","./packages/common/src/lib/action/actionbar/actionbar.module.ts","./packages/common/src/lib/action/action.module.ts","./packages/common/src/lib/badge-icon/badge-icon.module.ts","./packages/common/src/lib/collapsible/collapsible.module.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.html","./packages/common/src/lib/confirm-dialog/confirm-dialog.service.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.module.ts","./packages/common/src/lib/context-menu/context-menu.module.ts","./packages/common/src/lib/custom-html/custom-html.module.ts","./packages/common/src/lib/dom/dom.service.ts","./packages/common/src/lib/dom/dom.module.ts","./packages/common/src/lib/drag-drop/drag-drop.module.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.module.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.service.ts","./packages/common/src/lib/dynamic-component/dynamic-component.module.ts","./packages/common/src/lib/flexible/flexible.module.ts","./packages/common/src/lib/form/form-field/form-field.module.ts","./packages/common/src/lib/form/form-group/form-group.module.ts","./packages/common/src/lib/form/form/form.module.ts","./packages/common/src/lib/form/shared/form-field.service.ts","./packages/common/src/lib/form/shared/form.service.ts","./packages/common/src/lib/form/form.module.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.module.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.module.ts","./packages/common/src/lib/image/image.module.ts","./packages/common/src/lib/stop-propagation/stop-propagation.module.ts","./packages/common/src/lib/entity/entity-table/entity-table.module.ts","./packages/common/src/lib/entity/entity.module.ts","./packages/common/src/lib/interactive-tour/interactive-tour.loader.ts","./packages/common/src/lib/interactive-tour/interactive-tour.service.ts","./packages/common/src/lib/interactive-tour/interactive-tour.module.ts","./packages/common/src/lib/keyvalue/keyvalue.module.ts","./packages/common/src/lib/clickout/clickout.module.ts","./packages/common/src/lib/list/list.module.ts","./packages/common/src/lib/panel/panel.module.ts","./packages/common/src/lib/spinner/spinner.module.ts","./packages/common/src/lib/table/table.module.ts","./packages/common/src/lib/entity/shared/entity.enums.ts","./packages/common/src/lib/entity/shared/entity.utils.ts","./packages/common/src/lib/entity/shared/state.ts","./packages/common/src/lib/entity/shared/view.ts","./packages/common/src/lib/entity/shared/store.ts","./packages/common/src/lib/entity/shared/store-strategy.ts","./packages/common/src/lib/entity/shared/watcher.ts","./packages/common/src/lib/entity/shared/strategies/strategy.ts","./packages/common/src/lib/entity/shared/strategies/filter-custom-function.ts","./packages/common/src/lib/entity/shared/strategies/filter-selection.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.component.html","./packages/common/src/lib/entity/entity-selector/entity-selector.component.ts","./packages/common/src/lib/stop-propagation/stop-propagation.directive.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.html","./packages/common/src/lib/image/image-error.directive.ts","./packages/common/src/lib/entity/entity-table/entity-table-row.directive.ts","./packages/common/src/lib/custom-html/custom-html.pipe.ts","./packages/common/src/lib/image/secure-image.pipe.ts","./packages/common/src/lib/entity/entity-table/entity-table.component.html","./packages/common/src/lib/entity/entity-table/entity-table.component.ts","./packages/common/src/lib/tool/shared/toolbox.ts","./packages/common/src/lib/tool/shared/tool.service.ts","./packages/common/src/lib/tool/toolbox/toolbox.module.ts","./packages/common/src/lib/tool/tool.module.ts","./packages/common/src/lib/widget/shared/widget.service.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.module.ts","./packages/common/src/lib/widget/widget.module.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.module.ts","./packages/common/src/lib/workspace/workspace.module.ts","./packages/common/src/lib/color-picker-form-field/color-picker-form-field.module.ts","./packages/common/src/lib/action/shared/action.enums.ts","./packages/common/src/lib/action/shared/store.ts","./packages/common/src/lib/action/actionbar/actionbar-item.component.html","./packages/common/src/lib/action/actionbar/actionbar-item.component.ts","./packages/common/src/lib/action/actionbar/actionbar.component.html","./packages/common/src/lib/action/actionbar/actionbar.component.ts","./packages/common/src/lib/context-menu/long-press.directive.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.html","./packages/common/src/lib/form/shared/form-field-component.ts","./packages/common/src/lib/form/shared/form.utils.ts","./packages/common/src/lib/form/form-field/form-field.component.html","./packages/common/src/lib/form/form-field/form-field.component.ts","./packages/common/src/lib/form/form-group/form-group.component.html","./packages/common/src/lib/form/form-group/form-group.component.ts","./packages/common/src/lib/form/form-field/form-field-text.component.html","./packages/common/src/lib/form/form-field/form-field-text.component.ts","./packages/common/src/lib/form/form-field/form-field-select.component.html","./packages/common/src/lib/form/form-field/form-field-select.component.ts","./packages/common/src/lib/form/form-field/form-field-textarea.component.html","./packages/common/src/lib/form/form-field/form-field-textarea.component.ts","./packages/common/src/lib/form/form/form.component.ts","./packages/common/src/lib/form/form/form.component.html","./packages/common/src/lib/flexible/flexible.component.ts","./packages/common/src/lib/flexible/flexible.component.html","./packages/common/src/lib/interactive-tour/interactive-tour.component.html","./packages/common/src/lib/interactive-tour/interactive-tour.component.ts","./packages/common/src/lib/spinner/spinner.component.ts","./packages/common/src/lib/spinner/spinner.component.html","./packages/common/src/lib/spinner/spinner-activity.directive.ts","./packages/common/src/lib/table/table-action-color.enum.ts","./packages/common/src/lib/table/table-datasource.ts","./packages/common/src/lib/table/table.component.html","./packages/common/src/lib/table/table.component.ts","./packages/common/src/lib/table/table-database.ts","./packages/common/src/lib/tool/shared/tool-component.ts","./packages/common/src/lib/tool/shared/toolbox.enums.ts","./packages/common/src/lib/tool/toolbox/toolbox.animation.ts","./packages/common/src/lib/tool/toolbox/toolbox.component.html","./packages/common/src/lib/tool/toolbox/toolbox.component.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.html","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.ts","./packages/common/src/lib/workspace/shared/store.ts","./packages/common/src/lib/workspace/shared/workspace.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.html","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.html","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.ts","./packages/common/src/lib/color-picker-form-field/color-picker-form-field.component.html","./packages/common/src/lib/color-picker-form-field/color-picker-form-field.component.ts","./demo/src/app/common/action/action-routing.module.ts","./demo/src/app/common/action/action.component.ts","./demo/src/app/common/action/action.component.html","./demo/src/app/common/action/action.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.ts","./demo/src/app/common/dynamic-component/dynamic-component-routing.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.html","./demo/src/app/common/dynamic-component/dynamic-component.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.html","./demo/src/app/common/entity-selector/entity-selector-routing.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.ts","./demo/src/app/common/entity-selector/entity-selector.module.ts","./demo/src/app/common/entity-table/entity-table-routing.module.ts","./demo/src/app/common/entity-table/entity-table.component.ts","./demo/src/app/common/entity-table/entity-table.component.html","./demo/src/app/common/entity-table/entity-table.module.ts","./demo/src/app/common/form/form.component.html","./demo/src/app/common/form/form-routing.module.ts","./demo/src/app/common/form/form.component.ts","./demo/src/app/common/form/form.module.ts","./demo/src/app/common/table/table-routing.module.ts","./demo/src/app/common/table/table.component.ts","./demo/src/app/common/table/table.component.html","./demo/src/app/common/table/table.module.ts","./packages/common/src/lib/panel/panel.component.html","./packages/common/src/lib/panel/panel.component.ts","./demo/src/app/common/tool/tool.component.html","./demo/src/app/common/tool/tool.component.ts","./demo/src/app/common/tool/tool-routing.module.ts","./demo/src/app/common/tool/tool.module.ts","./demo/src/app/common/widget/widget.component.ts","./demo/src/app/common/widget/widget-routing.module.ts","./demo/src/app/common/widget/widget.component.html","./demo/src/app/common/widget/widget.module.ts","./packages/context/src/lib/context-import-export/context-import-export.module.ts","./packages/context/src/lib/context-map-button/poi-button/shared/poi.service.ts","./packages/context/src/lib/context-map-button/context-map-button.module.ts","./packages/geo/src/lib/map/shared/map.utils.ts","./packages/geo/src/lib/style/shared/overlay/overlay-marker-style.utils.ts","./packages/geo/src/lib/style/style-service/style.service.ts","./packages/geo/src/lib/query/shared/query.utils.ts","./packages/geo/src/lib/layer/shared/layers/layer.ts","./packages/geo/src/lib/layer/shared/layers/layer.interface.ts","./packages/geo/src/lib/layer/utils/image-watcher.ts","./packages/geo/src/lib/layer/utils/tile-watcher.ts","./packages/geo/src/lib/utils/id-generator.ts","./packages/geo/src/lib/datasource/shared/datasources/datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","./packages/geo/src/lib/layer/utils/vector-watcher.ts","./packages/geo/src/lib/layer/shared/layers/image-layer.ts","./packages/geo/src/lib/layer/shared/layers/tile-layer.ts","./packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","./packages/geo/src/lib/filter/shared/ogc-filter.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","./packages/geo/src/lib/feature/shared/feature.enums.ts","./packages/geo/src/lib/feature/shared/feature.utils.ts","./packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/data.service.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","./packages/geo/src/lib/query/shared/query.enums.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","./packages/geo/src/lib/datasource/utils/tilegrid.ts","./packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","./packages/geo/src/lib/map/shared/projection.service.ts","./packages/geo/src/lib/filter/shared/time-filter.enum.ts","./packages/geo/src/lib/style/shared/datasource/esri-style-generator.ts","./packages/geo/src/lib/map/shared/map.service.ts","./packages/geo/src/lib/datasource/shared/capabilities.service.ts","./packages/geo/src/lib/datasource/shared/options/options.service.ts","./packages/geo/src/lib/datasource/shared/datasource.service.ts","./packages/geo/src/lib/feature/shared/feature-store.utils.ts","./packages/geo/src/lib/feature/shared/store.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","./packages/geo/src/lib/feature/shared/strategies/geo-properties.ts","./packages/geo/src/lib/feature/shared/strategies/loading.ts","./packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","./packages/geo/src/lib/feature/shared/strategies/selection.ts","./packages/geo/src/lib/feature/shared/strategies/search.ts","./packages/geo/src/lib/feature/shared/strategies.utils.ts","./packages/geo/src/lib/style/shared/overlay/overlay-style.utils.ts","./packages/geo/src/lib/overlay/shared/overlay.ts","./packages/geo/src/lib/overlay/shared/overlay.utils.ts","./packages/geo/src/lib/map/utils/layer-watcher.ts","./packages/geo/src/lib/map/shared/controllers/controller.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.interface.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.ts","./packages/geo/src/lib/map/shared/map.enums.ts","./packages/geo/src/lib/map/shared/controllers/view.ts","./packages/geo/src/lib/map/shared/linkedLayers.utils.ts","./packages/geo/src/lib/map/shared/map.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.html","./packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","./packages/geo/src/lib/style/shared/feature/feature-style.ts","./packages/geo/src/lib/map/shared/hover-feature.directive.ts","./packages/geo/src/lib/map/shared/projection.utils.ts","./packages/geo/src/lib/offline/geoDB/geoDB.enums.ts","./packages/geo/src/lib/layer/shared/layers/vector-layer.ts","./packages/geo/src/lib/style/shared/vector/conversion.utils.ts","./packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","./packages/geo/src/lib/layer/layer-item/layer-item.component.html","./packages/geo/src/lib/layer/layer-item/layer-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","./packages/common/src/lib/collapsible/collapse.directive.ts","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","./packages/common/src/lib/badge-icon/badge-icon.directive.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","./packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","./packages/geo/src/lib/layer/layer-list/layer-list.component.html","./packages/geo/src/lib/layer/layer-list/layer-list.component.ts","./packages/geo/src/lib/offline/geoDB/geoDB.service.ts","./packages/geo/src/lib/offline/shared/geo-network.service.ts","./packages/geo/src/lib/layer/utils/layer.utils.ts","./packages/geo/src/lib/offline/layerDB/layerDB.service.ts","./packages/geo/src/lib/layer/shared/layer.service.ts","./packages/common/src/lib/list/list-item.directive.ts","./packages/common/src/lib/clickout/clickout.directive.ts","./packages/common/src/lib/list/list.component.ts","./packages/common/src/lib/list/list.component.html","./packages/geo/src/lib/layer/layer.module.ts","./packages/geo/src/lib/metadata/metadata.module.ts","./packages/geo/src/lib/query/shared/query.service.ts","./packages/geo/src/lib/query/shared/query.directive.ts","./packages/geo/src/lib/search/shared/sources/source.ts","./packages/geo/src/lib/query/shared/query-search-source.ts","./packages/geo/src/lib/utils/googleLinks.ts","./packages/geo/src/lib/utils/osmLinks.ts","./packages/geo/src/lib/utils/propertyTypeDetector/propertyTypeDetector.service.ts","./packages/geo/src/lib/catalog/shared/catalog.enum.ts","./packages/geo/src/lib/catalog/shared/catalog.abstract.ts","./packages/geo/src/lib/catalog/shared/catalogs.ts","./packages/geo/src/lib/catalog/shared/catalog.service.ts","./packages/geo/src/lib/metadata/shared/metadata.service.ts","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","./packages/geo/src/lib/catalog/catalog.module.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.ts","./packages/geo/src/lib/directions/shared/directions-source.service.ts","./packages/geo/src/lib/directions/directions.module.ts","./packages/geo/src/lib/download/download.module.ts","./packages/geo/src/lib/draw/draw/draw.module.ts","./packages/geo/src/lib/feature/feature-details/feature-details.module.ts","./packages/geo/src/lib/feature/feature-form/feature-form.module.ts","./packages/geo/src/lib/feature/feature.module.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","./packages/geo/src/lib/geometry/geometry.module.ts","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","./packages/geo/src/lib/wkt/shared/wkt.service.ts","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","./packages/geo/src/lib/filter/shared/ogc-filter.service.ts","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","./packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","./packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","./packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","./packages/geo/src/lib/filter/shared/spatial-filter.service.ts","./packages/geo/src/lib/filter/shared/time-filter.service.ts","./packages/common/src/lib/keyvalue/keyvalue.pipe.ts","./packages/geo/src/lib/feature/feature-details/feature-details.component.html","./packages/geo/src/lib/feature/feature-details/feature-details.component.ts","./packages/geo/src/lib/layer/shared/layer.enums.ts","./packages/geo/src/lib/measure/shared/measure.enum.ts","./packages/geo/src/lib/measure/shared/measure.utils.ts","./packages/geo/src/lib/geometry/shared/geometry.utils.ts","./packages/geo/src/lib/geometry/shared/controls/draw.ts","./packages/geo/src/lib/geometry/shared/controls/modify.ts","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","./packages/geo/src/lib/measure/measurer/measurer.component.html","./packages/geo/src/lib/measure/measurer/measurer.component.ts","./packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","./packages/geo/src/lib/filter/filter.module.ts","./packages/geo/src/lib/import-export/import-export.module.ts","./packages/geo/src/lib/map/map.module.ts","./packages/geo/src/lib/measure/measurer/measurer-item.component.html","./packages/geo/src/lib/measure/measurer/measurer-item.component.ts","./packages/geo/src/lib/measure/measurer/measurer.module.ts","./packages/geo/src/lib/measure/measure.module.ts","./packages/geo/src/lib/print/print.module.ts","./packages/geo/src/lib/query/shared/query-search-source.providers.ts","./packages/geo/src/lib/query/query.module.ts","./packages/geo/src/lib/search/search-selector/search-selector.module.ts","./packages/geo/src/lib/search/search-settings/search-settings.module.ts","./packages/geo/src/lib/search/search-bar/search-bar.module.ts","./packages/geo/src/lib/search/search-results/search-results.module.ts","./packages/geo/src/lib/search/shared/search-source.service.ts","./packages/geo/src/lib/search/shared/search-source-service.providers.ts","./packages/geo/src/lib/search/shared/search.utils.ts","./packages/geo/src/lib/search/shared/search.service.ts","./packages/geo/src/lib/search/shared/sources/coordinates.ts","./packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","./packages/geo/src/lib/search/shared/sources/icherche.ts","./packages/geo/src/lib/search/shared/sources/icherche.providers.ts","./packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","./packages/geo/src/lib/search/shared/sources/ilayer.ts","./packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","./packages/geo/src/lib/search/search.module.ts","./packages/geo/src/lib/style/style-list/style-list.service.ts","./packages/geo/src/lib/style/style-list/style-list.provider.ts","./packages/geo/src/lib/style/style-list/style-list.module.ts","./packages/geo/src/lib/style/shared/font.enum.ts","./packages/geo/src/lib/style/style-service/draw-style.service.ts","./packages/geo/src/lib/style/style.module.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.module.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","./packages/geo/src/lib/workspace/widgets/widgets.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","./packages/geo/src/lib/workspace/workspace.module.ts","./packages/geo/src/lib/feature/feature-details/feature-details.directive.ts","./packages/geo/src/lib/overlay/overlay.module.ts","./packages/geo/src/lib/download/shared/download.service.ts","./packages/geo/src/lib/download/download-button/download-button.component.html","./packages/geo/src/lib/download/download-button/download-button.component.ts","./packages/geo/src/lib/draw/shared/draw.enum.ts","./packages/geo/src/lib/draw/shared/draw-icon.service.ts","./packages/geo/src/lib/draw/shared/draw.utils.ts","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.html","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","./packages/geo/src/lib/draw/draw/draw.component.html","./packages/geo/src/lib/draw/draw/draw.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list-binding.directive.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.html","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.ts","./packages/geo/src/lib/import-export/shared/import.utils.ts","./packages/geo/src/lib/import-export/shared/import.errors.ts","./packages/geo/src/lib/import-export/shared/import.service.ts","./packages/geo/src/lib/import-export/shared/export.errors.ts","./packages/geo/src/lib/import-export/shared/export.type.ts","./packages/geo/src/lib/import-export/shared/export.service.ts","./packages/common/src/lib/custom-html/custom-html.component.ts","./packages/common/src/lib/custom-html/custom-html.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.ts","./packages/geo/src/lib/import-export/shared/export.utils.ts","./packages/geo/src/lib/import-export/export-button/export-button.component.html","./packages/geo/src/lib/import-export/export-button/export-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.ts","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","./packages/geo/src/lib/overlay/shared/overlay.enum.ts","./packages/geo/src/lib/overlay/shared/overlay.service.ts","./packages/geo/src/lib/overlay/shared/overlay.directive.ts","./packages/geo/src/lib/print/shared/geopdf.ts","./packages/geo/src/lib/print/shared/print.type.ts","./packages/geo/src/lib/print/shared/print.service.ts","./packages/geo/src/lib/layer/utils/outputLegend.ts","./packages/geo/src/lib/print/print-form/print-form.component.html","./packages/geo/src/lib/print/print-form/print-form.component.ts","./packages/geo/src/lib/print/print/print.component.ts","./packages/geo/src/lib/print/print/print.component.html","./packages/geo/src/lib/directions/shared/directions.enum.ts","./packages/geo/src/lib/directions/shared/directions.utils.ts","./packages/geo/src/lib/directions/shared/directions.service.ts","./packages/geo/src/lib/directions/shared/store.ts","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","./packages/geo/src/lib/directions/directions-results/directions-results.component.html","./packages/geo/src/lib/directions/directions-results/directions-results.component.ts","./packages/geo/src/lib/directions/directions.component.ts","./packages/geo/src/lib/directions/directions.component.html","./packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","./packages/geo/src/lib/search/shared/search.enums.ts","./packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","./packages/geo/src/lib/search/shared/sources/cadastre.ts","./packages/geo/src/lib/search/shared/sources/cadastre.providers.ts","./packages/geo/src/lib/search/shared/sources/nominatim.ts","./packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","./packages/geo/src/lib/search/shared/sources/workspace.ts","./packages/geo/src/lib/search/shared/sources/workspace.providers.ts","./packages/geo/src/lib/search/search-selector/search-selector.component.html","./packages/geo/src/lib/search/search-selector/search-selector.component.ts","./packages/geo/src/lib/search/search-settings/search-settings.component.html","./packages/geo/src/lib/search/search-settings/search-settings.component.ts","./packages/geo/src/lib/search/search-bar/search-bar.component.html","./packages/geo/src/lib/search/search-bar/search-bar.component.ts","./packages/geo/src/lib/search/search-results/search-results-item.component.html","./packages/geo/src/lib/search/search-results/search-results-item.component.ts","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.html","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.ts","./packages/geo/src/lib/search/search-results/search-results-add-button.component.html","./packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","./packages/common/src/lib/collapsible/collapsible.component.ts","./packages/common/src/lib/collapsible/collapsible.component.html","./packages/geo/src/lib/search/search-results/search-results.component.html","./packages/geo/src/lib/search/search-results/search-results.component.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.ts","./packages/geo/src/lib/style/shared/vector/commonVectorStyle.ts","./packages/geo/src/lib/workspace/shared/workspace.utils.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","./packages/geo/src/lib/workspace/shared/edition-workspace.ts","./packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","./packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.html","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.html","./packages/context/src/lib/context-import-export/shared/context-import.utils.ts","./packages/context/src/lib/context-manager/shared/context.enum.ts","./packages/context/src/lib/context-manager/shared/context.service.ts","./packages/context/src/lib/context-manager/shared/layer-context.directive.ts","./packages/context/src/lib/context-manager/shared/map-context.directive.ts","./packages/context/src/lib/context-manager/context-manager.module.ts","./packages/context/src/lib/share-map/share-map.module.ts","./packages/context/src/lib/sidenav/sidenav.module.ts","./packages/context/src/lib/context.module.ts","./packages/context/src/lib/context-import-export/shared/context-export.errors.ts","./packages/context/src/lib/context-import-export/shared/context-export.service.ts","./packages/context/src/lib/context-import-export/shared/context-import.errors.ts","./packages/context/src/lib/context-import-export/shared/context-import.service.ts","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.html","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.ts","./packages/context/src/lib/context-import-export/shared/context-export.utils.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","./packages/context/src/lib/context-manager/context-list/context-list.enum.ts","./packages/context/src/lib/context-manager/context-item/context-item.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.ts","./packages/context/src/lib/context-manager/context-list/context-list.component.html","./packages/context/src/lib/context-manager/context-list/context-list.component.ts","./packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","./packages/context/src/lib/context-manager/context-form/context-form.component.html","./packages/context/src/lib/context-manager/context-form/context-form.component.ts","./packages/context/src/lib/context-manager/context-edit/context-edit.component.html","./packages/context/src/lib/context-manager/context-edit/context-edit.component.ts","./packages/context/src/lib/context-manager/context-edit/context-edit-binding.directive.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.html","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions-binding.directive.ts","./packages/context/src/lib/share-map/shared/share-map.service.ts","./packages/context/src/lib/share-map/share-map/share-map-url.component.html","./packages/context/src/lib/share-map/share-map/share-map-url.component.ts","./packages/context/src/lib/share-map/share-map/share-map-api.component.html","./packages/context/src/lib/share-map/share-map/share-map-api.component.ts","./packages/context/src/lib/share-map/share-map/share-map.component.html","./packages/context/src/lib/share-map/share-map/share-map.component.ts","./demo/src/app/context/context/context.component.html","./demo/src/app/context/context/context-routing.module.ts","./demo/src/app/context/context/context.component.ts","./demo/src/app/context/context/context.module.ts","./demo/src/app/core/activity/activity-routing.module.ts","./demo/src/app/core/activity/activity.component.ts","./demo/src/app/core/activity/activity.component.html","./demo/src/app/core/activity/activity.module.ts","./demo/src/environments/environment.prod.ts","./demo/src/app/core/config/config-routing.module.ts","./demo/src/app/core/config/config.component.ts","./demo/src/app/core/config/config.component.html","./demo/src/app/core/config/config.module.ts","./demo/src/app/core/home/home-routing.module.ts","./demo/src/app/core/home/home.component.ts","./demo/src/app/core/home/home.component.html","./demo/src/app/core/home/home.module.ts","./demo/src/app/core/language/language-routing.module.ts","./demo/src/app/core/language/language.component.ts","./demo/src/app/core/language/language.component.html","./demo/src/app/core/language/language.module.ts","./demo/src/app/core/media/media-routing.module.ts","./demo/src/app/core/media/media.component.ts","./demo/src/app/core/media/media.component.html","./demo/src/app/core/media/media.module.ts","./demo/src/app/core/message/message-routing.module.ts","./demo/src/app/core/message/message.component.ts","./demo/src/app/core/message/message.component.html","./demo/src/app/core/message/message.module.ts","./demo/src/app/core/request/request-routing.module.ts","./demo/src/app/core/request/request.component.ts","./demo/src/app/core/request/request.component.html","./demo/src/app/core/request/request.module.ts","./demo/src/app/geo/catalog/catalog-routing.module.ts","./demo/src/app/geo/catalog/catalog.component.ts","./demo/src/app/geo/catalog/catalog.component.html","./demo/src/app/geo/catalog/catalog.module.ts","./demo/src/app/geo/directions/directions-routing.module.ts","./demo/src/app/geo/directions/directions.component.ts","./demo/src/app/geo/directions/directions.component.html","./demo/src/app/geo/directions/directions.module.ts","./demo/src/app/geo/draw/draw-routing.module.ts","./demo/src/app/geo/draw/draw.component.ts","./demo/src/app/geo/draw/draw.component.html","./demo/src/app/geo/draw/draw.module.ts","./demo/src/app/geo/feature/feature-routing.module.ts","./demo/src/app/geo/feature/feature.component.ts","./demo/src/app/geo/feature/feature.component.html","./demo/src/app/geo/feature/feature.module.ts","./demo/src/app/geo/geometry/geometry.component.html","./demo/src/app/geo/geometry/geometry-routing.module.ts","./demo/src/app/geo/geometry/geometry.component.ts","./demo/src/app/geo/geometry/geometry.module.ts","./demo/src/app/geo/hover/hover-routing.module.ts","./demo/src/app/geo/hover/hover.component.ts","./demo/src/app/geo/hover/hover.component.html","./demo/src/app/geo/hover/hover.module.ts","./demo/src/app/geo/import-export/import-export-routing.module.ts","./demo/src/app/geo/import-export/import-export.component.ts","./demo/src/app/geo/import-export/import-export.component.html","./demo/src/app/geo/import-export/import-export.module.ts","./demo/src/app/geo/layer/layer.component.html","./demo/src/app/geo/layer/layer-routing.module.ts","./demo/src/app/geo/layer/layer.component.ts","./demo/src/app/geo/layer/layer.module.ts","./demo/src/app/geo/legend/legend-routing.module.ts","./demo/src/app/geo/legend/legend.component.ts","./demo/src/app/geo/legend/legend.component.html","./demo/src/app/geo/legend/legend.module.ts","./demo/src/app/geo/measure/measure-routing.module.ts","./demo/src/app/geo/measure/measure.component.ts","./demo/src/app/geo/measure/measure.component.html","./demo/src/app/geo/measure/measure.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter-routing.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.html","./demo/src/app/geo/ogc-filter/ogc-filter.module.ts","./demo/src/app/geo/overlay/overlay-routing.module.ts","./demo/src/app/geo/overlay/overlay.component.ts","./demo/src/app/geo/overlay/overlay.component.html","./demo/src/app/geo/overlay/overlay.module.ts","./demo/src/app/geo/print/print-routing.module.ts","./demo/src/app/geo/print/print.component.ts","./demo/src/app/geo/print/print.component.html","./demo/src/app/geo/print/print.module.ts","./demo/src/app/geo/query/query.component.html","./demo/src/app/geo/query/query-routing.module.ts","./demo/src/app/geo/query/query.component.ts","./demo/src/app/geo/query/query.module.ts","./packages/integration/src/lib/search/search-bar/search-bar.module.ts","./packages/integration/src/lib/search/search-results-tool/search-results-tool.module.ts","./packages/integration/src/lib/search/search.module.ts","./packages/integration/src/lib/about/about-tool/about-tool.component.html","./packages/integration/src/lib/about/about-tool/about-tool.component.ts","./packages/integration/src/lib/import-export/import-export.state.ts","./packages/integration/src/lib/tool/tool.state.ts","./packages/integration/src/lib/context/context.state.ts","./packages/integration/src/lib/map/map.state.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.html","./packages/integration/src/lib/map/map-proximity.state.ts","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.html","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.ts","./packages/integration/src/lib/storage/storage.state.ts","./packages/integration/src/lib/workspace/shared/workspace.utils.ts","./packages/integration/src/lib/workspace/shared/edition-actions.service.ts","./packages/integration/src/lib/workspace/shared/feature-actions.service.ts","./packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","./packages/integration/src/lib/workspace/workspace.state.ts","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.html","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.ts","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.html","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.ts","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list-binding.directive.ts","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.html","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.ts","./packages/integration/src/lib/map/map-tool/map-tool.component.html","./packages/integration/src/lib/map/map-tool/map-tool.component.ts","./packages/integration/src/lib/map/layer-list-tool.state.ts","./packages/integration/src/lib/map/map-tools/map-tools.component.html","./packages/integration/src/lib/map/map-tools/map-tools.component.ts","./packages/integration/src/lib/search/search.state.ts","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.ts","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.html","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.ts","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.html","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.ts","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.html","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.ts","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.html","./packages/integration/src/lib/catalog/catalog.state.ts","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.html","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.html","./packages/integration/src/lib/directions/directions.state.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.html","./packages/integration/src/lib/draw/draw.state.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.html","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.html","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.html","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.html","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list-binding.directive.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.html","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.ts","./packages/integration/src/lib/measure/measure.state.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.html","./packages/integration/src/lib/print/print-tool/print-tool.component.ts","./packages/integration/src/lib/print/print-tool/print-tool.component.html","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.html","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.ts","./packages/common/src/lib/context-menu/context-menu.directive.ts","./demo/src/app/geo/search/search.component.html","./demo/src/app/geo/search/search-routing.module.ts","./demo/src/app/geo/search/search.component.ts","./demo/src/app/geo/search/search.module.ts","./packages/geo/src/lib/map/info-section/info-section.component.html","./packages/geo/src/lib/map/info-section/info-section.component.ts","./demo/src/app/geo/simple-map/simple-map.component.html","./demo/src/app/geo/simple-map/simple-map-routing.module.ts","./demo/src/app/geo/simple-map/simple-map.component.ts","./demo/src/app/geo/simple-map/simple-map.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.html","./demo/src/app/geo/spatial-filter/spatial-filter-routing.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.ts","./demo/src/app/geo/spatial-filter/spatial-filter.module.ts","./demo/src/app/geo/time-filter/time-filter-routing.module.ts","./demo/src/app/geo/time-filter/time-filter.component.ts","./demo/src/app/geo/time-filter/time-filter.component.html","./demo/src/app/geo/time-filter/time-filter.module.ts","./demo/src/app/geo/workspace/workspace.component.html","./demo/src/app/geo/workspace/workspace-routing.module.ts","./demo/src/app/geo/workspace/workspace.component.ts","./demo/src/app/geo/workspace/workspace.module.ts","./demo/src/app/app.module.ts","./demo/src/main.ts","./node_modules/moment/locale/ sync ^\\.\\/.*$"],"sourcesContent":["/* eslint-disable */\n\nconst ALPHA =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nexport class Base64 {\n  private static PADCHAR: string = '=';\n  private static ALPHA: string = ALPHA;\n\n  private static getByte(s: string, i: number): number {\n    const x = s.charCodeAt(i);\n    return x;\n  }\n\n  private static getByte64(s: string, i: number): number {\n    const idx = this.ALPHA.indexOf(s.charAt(i));\n    return idx;\n  }\n\n  public static decode(s: string): string {\n    let pads = 0,\n      i,\n      b10,\n      imax = s.length,\n      x = [];\n\n    s = String(s);\n\n    if (imax === 0) {\n      return s;\n    }\n\n    if (s.charAt(imax - 1) === this.PADCHAR) {\n      pads = 1;\n      if (s.charAt(imax - 2) === this.PADCHAR) {\n        pads = 2;\n      }\n      imax -= 4;\n    }\n\n    for (i = 0; i < imax; i += 4) {\n      b10 =\n        (this.getByte64(s, i) << 18) |\n        (this.getByte64(s, i + 1) << 12) |\n        (this.getByte64(s, i + 2) << 6) |\n        this.getByte64(s, i + 3);\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\n    }\n\n    switch (pads) {\n      case 1:\n        b10 =\n          (this.getByte64(s, i) << 18) |\n          (this.getByte64(s, i + 1) << 12) |\n          (this.getByte64(s, i + 2) << 6);\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\n        break;\n      case 2:\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\n        x.push(String.fromCharCode(b10 >> 16));\n        break;\n    }\n\n    return x.join('');\n  }\n\n  public static encode(s: string): string {\n    s = String(s);\n\n    let i,\n      b10,\n      x = [],\n      imax = s.length - (s.length % 3);\n\n    if (s.length === 0) {\n      return s;\n    }\n\n    for (i = 0; i < imax; i += 3) {\n      b10 =\n        (this.getByte(s, i) << 16) |\n        (this.getByte(s, i + 1) << 8) |\n        this.getByte(s, i + 2);\n      x.push(this.ALPHA.charAt(b10 >> 18));\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\n      x.push(this.ALPHA.charAt(b10 & 63));\n    }\n\n    switch (s.length - imax) {\n      case 1:\n        b10 = this.getByte(s, i) << 16;\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.PADCHAR +\n            this.PADCHAR\n        );\n        break;\n      case 2:\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.ALPHA.charAt((b10 >> 6) & 63) +\n            this.PADCHAR\n        );\n        break;\n    }\n\n    return x.join('');\n  }\n}\n","import { HttpParams } from '@angular/common/http';\n\nexport function customCacheHasher(parameters: unknown[]): unknown[] {\n  return parameters.map((param) => {\n    if (param instanceof HttpParams) {\n      return param.toString();\n    }\n    return param !== undefined ? JSON.parse(JSON.stringify(param)) : param;\n  });\n}\n","import * as Bowser from 'bowser';\n\nexport interface UserAgent extends Bowser.Parser.Parser {\n  compareVersion: (version: string) => boolean;\n}\n\nexport const userAgent = Bowser.getParser(\n  window.navigator.userAgent\n) as UserAgent;\n","import { userAgent } from './user-agent';\n\nexport class Clipboard {\n  static copy(element: HTMLTextAreaElement | string): boolean {\n    let successful = false;\n    if (typeof element === 'string') {\n      const textArea = Clipboard.createTextArea(element);\n      Clipboard.selectText(textArea);\n      successful = Clipboard.copyTextToClipboard();\n      Clipboard.destroyTextArea(textArea);\n    } else {\n      Clipboard.selectText(element);\n      successful = Clipboard.copyTextToClipboard();\n    }\n    return successful;\n  }\n\n  private static createTextArea(text: string): HTMLTextAreaElement {\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    return textArea;\n  }\n\n  private static destroyTextArea(textArea) {\n    document.body.removeChild(textArea);\n  }\n\n  private static selectText(textArea) {\n    if (userAgent.getOSName() === 'iOS') {\n      const oldContentEditable = textArea.contentEditable;\n      const oldReadOnly = textArea.readOnly;\n      const range = document.createRange();\n      const selection = window.getSelection();\n\n      textArea.contenteditable = true;\n      textArea.readonly = false;\n      range.selectNodeContents(textArea);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      textArea.setSelectionRange(0, 999999);\n      textArea.contentEditable = oldContentEditable;\n      textArea.readOnly = oldReadOnly;\n    } else {\n      textArea.select();\n    }\n  }\n\n  private static copyTextToClipboard(): boolean {\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\n      return document.execCommand('copy');\n    }\n    return false;\n  }\n}\n","export enum ChangeType {\n  ADDED = 'added',\n  DELETED = 'deleted',\n  MODIFIED = 'modified'\n}\n\nexport interface Change {\n  type: ChangeType;\n  keysChanged?: {\n    key: string;\n    newValue: any;\n    oldValue: any;\n  }[];\n}\n\nexport interface GroupingChanges {\n  added: ChangeItem[];\n  deleted: ChangeItem[];\n  modified: ChangeItem[];\n}\n\nexport interface ChangeItem {\n  change: Change;\n  value: any;\n  oldValue?: any;\n  newValue?: any;\n}\n","export class StringUtils {\n  static diff(s1: string, s2: string, p = 4): string {\n    if (!s1 && !s2) {\n      return '';\n    }\n    if (!s1) {\n      return '<span class=\"inserted\">' + s2 + '</span>';\n    }\n    if (!s2) {\n      return '<span class=\"deleted\">' + s1 + '</span>';\n    }\n    s1 = s1.toString();\n    s2 = s2.toString();\n    const changeData = StringUtils.getChanges(s1, s2, '', p);\n    const nextS = s2.slice(\n      changeData.mtc.length + changeData.ins.length + changeData.sbs.length\n    ); // remaining part of \"s\"\n    const nextThis = s1.slice(\n      changeData.mtc.length + changeData.del.length + changeData.sbs.length\n    ); // remaining part of \"this\"\n    let result = ''; // the glorious result\n    if (changeData.del.length > 0) {\n      changeData.del = '<span class=\"deleted\">' + changeData.del + '</span>';\n    }\n    if (changeData.ins.length > 0) {\n      changeData.ins = '<span class=\"inserted\">' + changeData.ins + '</span>';\n    }\n    result = changeData.mtc + changeData.del + changeData.ins + changeData.sbs;\n    result +=\n      nextThis !== '' || nextS !== ''\n        ? StringUtils.diff(nextThis, nextS, p)\n        : '';\n    return result;\n  }\n\n  private static getMatchingSubstring(s, l, m) {\n    // returns the first matching substring in-between the two strings\n    let i = 0;\n    let match = false;\n    const slen = s.length;\n    const o = { fis: slen, mtc: m, sbs: '' }; // temporary object used to construct the cd (change data) object\n\n    while (i < slen) {\n      l[i] === s[i]\n        ? match\n          ? (o.sbs += s[i]) // o.sbs holds the matching substring itsef\n          : ((match = true), (o.fis = i), (o.sbs = s[i]))\n        : match\n        ? (i = slen) // stop after the first found substring\n        : (i = i);\n      ++i;\n    }\n    return o;\n  }\n\n  private static getChanges(s1, s2, m, p) {\n    const isThisLonger = s1.length >= s1.length ? true : false;\n    let [longer, shorter] = isThisLonger ? [s1, s2] : [s2, s1]; // assignment of longer and shorter by es6 destructuring\n    let bi = 0; // base index designating the index of first mismacthing character in both strings\n\n    while (shorter[bi] === longer[bi] && bi < shorter.length) {\n      ++bi;\n    } // make bi the index of first mismatching character\n    longer = longer.split('').slice(bi); // as the longer string will be rotated it is converted into array\n    shorter = shorter.slice(bi); // shorter and longer now starts from the first mismatching character\n\n    const len = longer.length; // length of the longer string\n    let cd: any = {\n      fis: shorter.length, // the index of matching string in the shorter string\n      fil: len, // the index of matching string in the longer string\n      sbs: '', // the matching substring itself\n      mtc: m + s2.slice(0, bi)\n    }; // if exists mtc holds the matching string at the front\n    let sub: any = { sbs: '' }; // returned substring per 1 character rotation of the longer string\n\n    if (shorter !== '') {\n      for (let rc = 0; rc < len && sub.sbs.length < p; rc++) {\n        // rc -> rotate count, p -> precision factor\n        sub = StringUtils.getMatchingSubstring(\n          shorter,\n          StringUtils.rotateArray(longer, rc),\n          cd.mtc\n        ); // rotate longer string 1 char and get substring\n        sub.fil =\n          rc < len - sub.fis\n            ? sub.fis + rc // mismatch is longer than the mismatch in short\n            : sub.fis - len + rc; // mismatch is shorter than the mismatch in short\n        if (sub.sbs.length > cd.sbs.length) {\n          cd = sub; // only keep the one with the longest substring.\n        }\n      }\n    }\n    // insert the mismatching delete subsrt and insert substr to the cd object and attach the previous substring\n    [cd.del, cd.ins] = isThisLonger\n      ? [longer.slice(0, cd.fil).join(''), shorter.slice(0, cd.fis)]\n      : [shorter.slice(0, cd.fis), longer.slice(0, cd.fil).join('')];\n    return cd.del.indexOf(' ') === -1 ||\n      cd.ins.indexOf(' ') === -1 ||\n      cd.del === '' ||\n      cd.ins === '' ||\n      cd.sbs === ''\n      ? cd\n      : StringUtils.getChanges(cd.del, cd.ins, cd.mtc, p);\n  }\n\n  private static rotateArray(array, n) {\n    const len = array.length;\n    const res = new Array(array.length);\n    if (n % len === 0) {\n      return array.slice();\n    } else {\n      for (let i = 0; i < len; i++) {\n        res[i] = array[(i + (len + (n % len))) % len];\n      }\n    }\n    return res;\n  }\n\n  static isValidNumber(value: string): boolean {\n    return !isNaN(Number(value));\n  }\n\n  static isOctalNumber(value: string): boolean {\n    return (\n      StringUtils.isValidNumber(value) &&\n      value.startsWith('0') &&\n      value.length > 1\n    );\n  }\n}\n","import { ChangeType, GroupingChanges } from './change.interface';\r\nimport { StringUtils } from './string-utils';\r\n\r\nexport class ChangeUtils {\r\n  static findChanges(\r\n    obj1: any[],\r\n    obj2: any[],\r\n    ignoreKeys: string[] = []\r\n  ): GroupingChanges {\r\n    const items: GroupingChanges = {\r\n      added: [],\r\n      deleted: [],\r\n      modified: []\r\n    };\r\n\r\n    if (!obj1 || !obj2) {\r\n      return items;\r\n    }\r\n\r\n    const obj1Clone: any = [...obj1];\r\n    const obj2Clone: any = [...obj2];\r\n\r\n    for (const fromItem of obj1Clone) {\r\n      const index = obj2Clone.findIndex((s) => s.id === fromItem.id);\r\n\r\n      if (index === -1) {\r\n        items.deleted.push({\r\n          change: { type: ChangeType.DELETED },\r\n          value: fromItem\r\n        });\r\n        continue;\r\n      }\r\n\r\n      const toItem = obj2Clone.splice(index, 1)[0];\r\n      const fromItemClone = JSON.parse(JSON.stringify(fromItem));\r\n      const toItemClone = JSON.parse(JSON.stringify(toItem));\r\n\r\n      const keysChanged = ChangeUtils.compareObject(\r\n        fromItemClone,\r\n        toItemClone,\r\n        undefined,\r\n        ignoreKeys\r\n      );\r\n\r\n      if (keysChanged.length) {\r\n        items.modified.push({\r\n          change: {\r\n            type: ChangeType.MODIFIED,\r\n            keysChanged\r\n          },\r\n          value: fromItemClone,\r\n          oldValue: fromItem,\r\n          newValue: toItem\r\n        });\r\n      }\r\n    }\r\n\r\n    items.added = obj2Clone.map((itemAdded) => {\r\n      return {\r\n        change: { type: ChangeType.ADDED },\r\n        value: itemAdded\r\n      };\r\n    });\r\n\r\n    return items;\r\n  }\r\n\r\n  private static compareObject(fromItem, toItem, baseKey?, ignoreKeys = []) {\r\n    const fromItemClone = JSON.parse(JSON.stringify(fromItem));\r\n    const toItemClone = JSON.parse(JSON.stringify(toItem));\r\n\r\n    const keys: any = new Set([\r\n      ...Object.keys(fromItem),\r\n      ...Object.keys(toItem)\r\n    ]);\r\n    let keysChanged = [];\r\n    keys.forEach((key) => {\r\n      const keyString = baseKey ? `${baseKey}.${key}` : key;\r\n      if (ignoreKeys.indexOf(keyString) !== -1) {\r\n        return;\r\n      }\r\n\r\n      if (Array.isArray(fromItem[key])) {\r\n        fromItem[key] = fromItem[key].join(',<br>');\r\n      }\r\n      if (Array.isArray(toItem[key])) {\r\n        toItem[key] = toItem[key].join(',<br>');\r\n      }\r\n\r\n      if (\r\n        typeof fromItem[key] === 'object' &&\r\n        typeof toItem[key] === 'object' &&\r\n        fromItem[key] !== null &&\r\n        toItem[key] !== null\r\n      ) {\r\n        keysChanged = keysChanged.concat(\r\n          this.compareObject(fromItem[key], toItem[key], keyString)\r\n        );\r\n      } else {\r\n        if (fromItem[key] !== toItem[key]) {\r\n          keysChanged.push({\r\n            key: keyString,\r\n            oldValue: fromItemClone[key],\r\n            newValue: toItemClone[key]\r\n          });\r\n          fromItem[key] = StringUtils.diff(fromItem[key], toItem[key]);\r\n        }\r\n      }\r\n    });\r\n\r\n    return keysChanged;\r\n  }\r\n}\r\n","export class DomUtils {\n  static create<K extends keyof HTMLElementTagNameMap>(\n    doc: Document,\n    tagName: K,\n    options?: Partial<HTMLElementTagNameMap[K]>\n  ): HTMLElementTagNameMap[K] {\n    const el = doc.createElement(tagName);\n\n    for (const key in options) {\n      el[key] = options[key];\n    }\n\n    return el;\n  }\n\n  static remove(node: HTMLElement | SVGElement): void {\n    if (!node.parentNode) {\n      return;\n    }\n    node.parentNode.removeChild(node);\n  }\n}\n","/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadContent(\n  content: string,\n  mimeType: string,\n  fileName: string\n) {\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\n  downloadFromUri(uri, fileName);\n}\n\n/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadFromUri(uri: string, fileName: string) {\n  const element = document.createElement('a');\n  element.setAttribute('href', uri);\n  element.setAttribute('download', fileName);\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n","export class ObjectUtils {\r\n  static resolve(obj: object, key: string): any {\r\n    const keysArray = key.replace(/\\[/g, '.').replace(/\\]/g, '').split('.');\r\n    let current = obj;\r\n    while (keysArray.length) {\r\n      if (typeof current !== 'object') {\r\n        return undefined;\r\n      }\r\n      current = current[keysArray.shift()];\r\n    }\r\n\r\n    return current;\r\n  }\r\n\r\n  static isObject(item: object) {\r\n    return (\r\n      item &&\r\n      typeof item === 'object' &&\r\n      !Array.isArray(item) &&\r\n      item !== null &&\r\n      !(item instanceof Date)\r\n    );\r\n  }\r\n\r\n  static mergeDeep(\r\n    target: object,\r\n    source: object,\r\n    ignoreUndefined = false\r\n  ): any {\r\n    const output = Object.assign({}, target);\r\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\r\n      Object.keys(source)\r\n        .filter((key) => !ignoreUndefined || source[key] !== undefined)\r\n        .forEach((key) => {\r\n          if (ObjectUtils.isObject(source[key])) {\r\n            if (!(key in target)) {\r\n              Object.assign(output, { [key]: source[key] });\r\n            } else {\r\n              output[key] = ObjectUtils.mergeDeep(\r\n                target[key],\r\n                source[key],\r\n                ignoreUndefined\r\n              );\r\n            }\r\n          } else {\r\n            Object.assign(output, { [key]: source[key] });\r\n          }\r\n        });\r\n    }\r\n    return output;\r\n  }\r\n\r\n  static copyDeep(src): any {\r\n    const target = Array.isArray(src) ? [] : {};\r\n    for (const prop in src) {\r\n      if (src.hasOwnProperty(prop)) {\r\n        const value = src[prop];\r\n        if (value && typeof value === 'object') {\r\n          target[prop] = this.copyDeep(value);\r\n        } else {\r\n          target[prop] = value;\r\n        }\r\n      }\r\n    }\r\n    return target;\r\n  }\r\n\r\n  static removeDuplicateCaseInsensitive(obj: object) {\r\n    const summaryCapitalizeObject = {};\r\n    const capitalizeObject = {};\r\n    const upperCaseCount = [];\r\n\r\n    for (const property in obj) {\r\n      if (obj.hasOwnProperty(property)) {\r\n        const upperCaseProperty = property.toUpperCase();\r\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\r\n          summaryCapitalizeObject[upperCaseProperty] = [\r\n            { [property]: obj[property] }\r\n          ];\r\n        } else {\r\n          summaryCapitalizeObject[upperCaseProperty].push({\r\n            [property]: obj[property]\r\n          });\r\n        }\r\n        // counting the number of uppercase lettersMna\r\n        upperCaseCount.push({\r\n          key: property,\r\n          count: property.replace(/[^A-Z]/g, '').length\r\n        });\r\n      }\r\n    }\r\n    for (const capitalizedProperty in summaryCapitalizeObject) {\r\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\r\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\r\n          const capitalizedPropertyObject =\r\n            summaryCapitalizeObject[capitalizedProperty];\r\n          if (capitalizedPropertyObject.length === 1) {\r\n            // for single params (no duplicates)\r\n            const singlePossibility = capitalizedPropertyObject[0];\r\n            capitalizeObject[capitalizedProperty] =\r\n              singlePossibility[Object.keys(singlePossibility)[0]];\r\n          } else if (capitalizedPropertyObject.length > 1) {\r\n            // defining the closest to lowercase property\r\n            const paramClosestToLowercase = upperCaseCount\r\n              .filter(\r\n                (f) => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\r\n              )\r\n              .reduce((prev, current) => {\r\n                return prev.y < current.y ? prev : current;\r\n              });\r\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\r\n              obj[paramClosestToLowercase.key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    for (const property in obj) {\r\n      if (obj.hasOwnProperty(property)) {\r\n        delete obj[property];\r\n      }\r\n    }\r\n\r\n    for (const property in capitalizeObject) {\r\n      if (capitalizeObject.hasOwnProperty(property)) {\r\n        obj[property] = capitalizeObject[property];\r\n      }\r\n    }\r\n  }\r\n\r\n  static removeUndefined(obj: object): any {\r\n    const output = {};\r\n    if (ObjectUtils.isObject(obj)) {\r\n      Object.keys(obj)\r\n        .filter((key) => obj[key] !== undefined)\r\n        .forEach((key) => {\r\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\r\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\r\n          } else {\r\n            output[key] = obj[key];\r\n          }\r\n        });\r\n\r\n      return output;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n      return obj.map((o) => ObjectUtils.removeUndefined(o));\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  static removeNull(obj: object): any {\r\n    const output = {};\r\n    if (ObjectUtils.isObject(obj)) {\r\n      Object.keys(obj)\r\n        .filter((key) => obj[key] !== null)\r\n        .forEach((key) => {\r\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\r\n            output[key] = ObjectUtils.removeNull(obj[key]);\r\n          } else {\r\n            output[key] = obj[key];\r\n          }\r\n        });\r\n\r\n      return output;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n      return obj.map((o) => ObjectUtils.removeNull(o));\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\r\n    if (direction === 'desc') {\r\n      b = [a, (a = b)][0];\r\n    }\r\n\r\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\r\n    // nullsFirst = true : always first\r\n    // nullsFirst = false : always end\r\n    if (\r\n      a === null ||\r\n      a === '' ||\r\n      a === undefined ||\r\n      b === null ||\r\n      b === '' ||\r\n      b === undefined\r\n    ) {\r\n      const nullScore =\r\n        a === b\r\n          ? 0\r\n          : a === undefined\r\n          ? 3\r\n          : b === undefined\r\n          ? -3\r\n          : a === null\r\n          ? 2\r\n          : b === null\r\n          ? -2\r\n          : a === ''\r\n          ? 1\r\n          : -1;\r\n      if (direction === 'desc') {\r\n        return nullsFirst !== false ? nullScore : nullScore * -1;\r\n      }\r\n      return nullsFirst === true ? nullScore * -1 : nullScore;\r\n    }\r\n\r\n    const ax = [];\r\n    const bx = [];\r\n    a = '' + a;\r\n    b = '' + b;\r\n\r\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\r\n      ax.push([$1 || Infinity, $2 || '']);\r\n    });\r\n\r\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\r\n      bx.push([$1 || Infinity, $2 || '']);\r\n    });\r\n\r\n    while (ax.length && bx.length) {\r\n      const an = ax.shift();\r\n      const bn = bx.shift();\r\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\r\n      if (nn) {\r\n        return nn;\r\n      }\r\n    }\r\n\r\n    return ax.length - bx.length;\r\n  }\r\n\r\n  /**\r\n   * Return true if two object are equivalent.\r\n   * Objects are considered equivalent if they have the same properties and\r\n   * if all of their properties (first-level only) share the same value.\r\n   * @param obj1 First object\r\n   * @param obj2 Second object\r\n   * @returns Whether two objects arer equivalent\r\n   */\r\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\r\n    if (obj1 === obj2) {\r\n      return true;\r\n    }\r\n\r\n    const obj1Props = Object.getOwnPropertyNames(obj1);\r\n    const obj2Props = Object.getOwnPropertyNames(obj2);\r\n    if (obj1Props.length !== obj2Props.length) {\r\n      return false;\r\n    }\r\n\r\n    for (const prop of obj1Props) {\r\n      if (obj1[prop] !== obj2[prop]) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Return a new object with an array of keys removed\r\n   * @param obj Source object\r\n   * @param keys Keys to remove\r\n   * @returns A new object\r\n   */\r\n  static removeKeys(obj: object, keys: string[]): object {\r\n    const newObj = Object.keys(obj)\r\n      .filter((key) => keys.indexOf(key) < 0)\r\n      .reduce((_obj, key) => {\r\n        _obj[key] = obj[key];\r\n        return _obj;\r\n      }, {});\r\n\r\n    return newObj;\r\n  }\r\n\r\n  static isEmpty(obj: object): boolean {\r\n    return Object.keys(obj).length === 0;\r\n  }\r\n}\r\n","export class NumberUtils {\n  static roundToNDecimal(num: number, decimal: number = 3): number {\n    const roundFactor = Math.pow(10, decimal);\n    return Math.round(num * roundFactor) / roundFactor;\n  }\n}\n","/** Utility function to create a K:V from a list of strings */\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\n  return o.reduce((res, key) => {\n    res[key] = key;\n    return res;\n  }, Object.create(null));\n}\n","export function S4() {\n  // eslint-disable-next-line no-bitwise\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n\nexport function uuid() {\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\n  return id.toLowerCase();\n}\n","import { Subject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nexport enum SubjectStatus {\n  Error = 0,\n  Done = 1,\n  Working = 2,\n  Waiting = 3\n}\n\nexport abstract class Watcher {\n  public status$ = new Subject<SubjectStatus>();\n  protected status$$: Subscription;\n\n  get status(): SubjectStatus {\n    return this._status;\n  }\n  set status(value: SubjectStatus) {\n    this._status = value;\n    this.status$.next(value);\n  }\n  private _status: SubjectStatus;\n\n  protected abstract watch();\n\n  protected abstract unwatch();\n\n  subscribe(callback: Function, scope?: any) {\n    this.watch();\n\n    this.status$$ = this.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status: SubjectStatus) => {\n        this.handleStatusChange(status);\n        callback.call(scope, this);\n      });\n  }\n\n  unsubscribe() {\n    this.unwatch();\n    if (this.status$$ !== undefined) {\n      this.status$$.unsubscribe();\n      this.status$$ = undefined;\n    }\n    this.status = SubjectStatus.Waiting;\n  }\n\n  protected handleStatusChange(status: SubjectStatus) {}\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ActivityService {\r\n  public counter$ = new BehaviorSubject<number>(0);\r\n\r\n  private ids: string[] = [];\r\n\r\n  constructor() {}\r\n\r\n  register(): string {\r\n    const id = uuid();\r\n    this.ids.push(id);\r\n    this.counter$.next(this.ids.length);\r\n\r\n    return id;\r\n  }\r\n\r\n  unregister(id: string) {\r\n    const index = this.ids.indexOf(id);\r\n    if (index === -1) {\r\n      return;\r\n    }\r\n    this.ids.splice(index, 1);\r\n\r\n    this.counter$.next(this.ids.length);\r\n  }\r\n}\r\n","import {\r\n  HttpEvent,\r\n  HttpHandler,\r\n  HttpInterceptor,\r\n  HttpRequest\r\n} from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { finalize } from 'rxjs/operators';\r\n\r\nimport { ActivityService } from './activity.service';\r\n\r\n@Injectable()\r\nexport class ActivityInterceptor implements HttpInterceptor {\r\n  constructor(private activityService: ActivityService) {}\r\n\r\n  intercept(\r\n    req: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    const activity = req.headers.get('activityInterceptor');\r\n    if (activity) {\r\n      const actReq = req.clone({\r\n        headers: req.headers.delete('activityInterceptor')\r\n      });\r\n      if (activity === 'false') {\r\n        return next.handle(actReq);\r\n      }\r\n    }\r\n\r\n    const id = this.activityService.register();\r\n\r\n    return next.handle(req).pipe(\r\n      finalize(() => {\r\n        this.activityService.unregister(id);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { ActivityInterceptor } from './activity.interceptor';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoActivityModule {\r\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\r\n    return {\r\n      ngModule: IgoActivityModule,\r\n      providers: [\r\n        {\r\n          provide: HTTP_INTERCEPTORS,\r\n          useClass: ActivityInterceptor,\r\n          multi: true\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { AlternateConfigOptions, DeprecatedOptions } from './config.interface';\r\n\r\nexport const CONFIG_DEPRECATED: { [key: string]: DeprecatedOptions } = {\r\n  showMenuButton: {\r\n    alternativeKey: 'menu.button.visible',\r\n    mayBeRemoveIn: new Date('2024-06-06')\r\n  },\r\n  menuButtonReverseColor: {\r\n    alternativeKey: 'menu.button.useThemeColor',\r\n    mayBeRemoveIn: new Date('2024-06-06')\r\n  },\r\n  importWithStyle: {\r\n    alternativeKey: 'importExport.importWithStyle',\r\n    mayBeRemoveIn: new Date('2024-06-06')\r\n  },\r\n  hasGeolocateButton: {\r\n    alternativeKey: 'geolocate.button.visible',\r\n    mayBeRemoveIn: new Date('2024-06-06')\r\n  }\r\n};\r\n\r\nexport const ALTERNATE_CONFIG_FROM_DEPRECATION = new Map<\r\n  string,\r\n  AlternateConfigOptions\r\n>(\r\n  Object.entries(CONFIG_DEPRECATED)\r\n    .filter(([_, options]) => options.alternativeKey)\r\n    .map(([key, options]) => [\r\n      options.alternativeKey,\r\n      {\r\n        deprecatedKey: key\r\n      } satisfies AlternateConfigOptions\r\n    ])\r\n);\r\n","export interface Version {\r\n  app?: string;\r\n  lib?: string;\r\n  releaseDateApp?: number;\r\n  releaseDate?: number;\r\n}\r\n\r\nexport const version: Version = {\r\n  lib: '16.0.0-rc.2',\r\n  releaseDate: 1697030263684\r\n};\r\n","import { HttpBackend, HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport {\r\n  ALTERNATE_CONFIG_FROM_DEPRECATION,\r\n  CONFIG_DEPRECATED\r\n} from './config-deprecated';\r\nimport { BaseConfigOptions, ConfigOptions } from './config.interface';\r\nimport { version } from './version';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ConfigService<T = { [key: string]: any }> {\r\n  private config: BaseConfigOptions<T> | null;\r\n  private httpClient: HttpClient;\r\n  private configDeprecated = new Map(Object.entries(CONFIG_DEPRECATED));\r\n\r\n  constructor(handler: HttpBackend) {\r\n    this.httpClient = new HttpClient(handler);\r\n  }\r\n\r\n  /**\r\n   * Use to get the all config file (merge from environnement.ts and config.json)\r\n   */\r\n  public getConfigs(): any {\r\n    Array.from(this.configDeprecated.keys()).map((deprecatedKey) => {\r\n      const deprecatedValue = ObjectUtils.resolve(this.config, deprecatedKey);\r\n      if (deprecatedValue !== undefined) {\r\n        this.handleDeprecatedConfig(deprecatedKey);\r\n      }\r\n    });\r\n    return this.config;\r\n  }\r\n\r\n  /**\r\n   * Use to get the data found in config file\r\n   */\r\n  public getConfig<T = any>(key: string, defaultValue?: unknown): T {\r\n    let value = ObjectUtils.resolve(this.config, key);\r\n\r\n    const isDeprecated = this.configDeprecated.get(key);\r\n    if (isDeprecated && value !== undefined) {\r\n      this.handleDeprecatedConfig(key);\r\n    } else if (value === undefined) {\r\n      value = this.handleDeprecationPossibility(key);\r\n    }\r\n\r\n    return value ?? defaultValue;\r\n  }\r\n\r\n  private handleDeprecatedConfig(key: string): void {\r\n    const options = this.configDeprecated.get(key);\r\n\r\n    let message = `This config (${key}) is deprecated and will be removed shortly`;\r\n    if (options.alternativeKey) {\r\n      message += ` You should use this key (${options.alternativeKey}) as an alternate solution`;\r\n    }\r\n\r\n    const currentDate = new Date();\r\n    currentDate >= options.mayBeRemoveIn\r\n      ? console.error(message)\r\n      : console.warn(message);\r\n  }\r\n\r\n  private handleDeprecationPossibility(key: string): any {\r\n    const options = ALTERNATE_CONFIG_FROM_DEPRECATION.get(key);\r\n    if (!options) {\r\n      return;\r\n    }\r\n\r\n    return this.getConfig(options.deprecatedKey);\r\n  }\r\n\r\n  /**\r\n   * This method loads \"[path]\" to get all config's variables\r\n   */\r\n  public load(options: ConfigOptions<T>) {\r\n    const baseConfig = options.default;\r\n    if (!options.path) {\r\n      this.config = baseConfig;\r\n      return true;\r\n    }\r\n\r\n    return new Promise((resolve, _reject) => {\r\n      this.httpClient\r\n        .get(options.path)\r\n        .pipe(\r\n          catchError((error: any): any => {\r\n            console.log(`Configuration file ${options.path} could not be read`);\r\n            resolve(true);\r\n            return throwError(error.error || 'Server error');\r\n          })\r\n        )\r\n        .subscribe((configResponse: object) => {\r\n          this.config = ObjectUtils.mergeDeep(\r\n            ObjectUtils.mergeDeep({ version }, baseConfig),\r\n            configResponse\r\n          );\r\n          resolve(true);\r\n        });\r\n    });\r\n  }\r\n}\r\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\r\n\r\nimport { ConfigOptions } from './config.interface';\r\nimport { ConfigService } from './config.service';\r\n\r\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\r\n\r\nexport function provideConfigOptions(options: ConfigOptions) {\r\n  return {\r\n    provide: CONFIG_OPTIONS,\r\n    useValue: options\r\n  };\r\n}\r\n\r\nexport function configFactory(\r\n  configService: ConfigService,\r\n  options: ConfigOptions\r\n) {\r\n  return () => configService.load(options);\r\n}\r\n\r\nexport function provideConfigLoader() {\r\n  return {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: configFactory,\r\n    multi: true,\r\n    deps: [ConfigService, CONFIG_OPTIONS]\r\n  };\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { provideConfigLoader, provideConfigOptions } from './config.provider';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoConfigModule {\r\n  static forRoot(): ModuleWithProviders<IgoConfigModule> {\r\n    return {\r\n      ngModule: IgoConfigModule,\r\n      providers: [provideConfigOptions({}), provideConfigLoader()]\r\n    };\r\n  }\r\n}\r\n","import { HttpBackend, HttpClient } from '@angular/common/http';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { TranslateLoader } from '@ngx-translate/core';\r\nimport { forkJoin, map } from 'rxjs';\r\n\r\nimport { ConfigService } from '../../config/config.service';\r\n\r\nexport class LanguageLoader implements TranslateLoader {\r\n  private httpClient: HttpClient;\r\n\r\n  constructor(\r\n    handler: HttpBackend,\r\n    private prefix?: string | string[],\r\n    private suffix: string = '.json',\r\n    private config?: ConfigService\r\n  ) {\r\n    this.httpClient = new HttpClient(handler);\r\n  }\r\n\r\n  public getTranslation(lang: string): any {\r\n    const igoLocale$ = this.httpClient.get(`locale/libs_locale/${lang}.json`);\r\n\r\n    if (this.config && !this.prefix) {\r\n      const prefix = this.config.getConfig('language.prefix');\r\n      this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\r\n    }\r\n\r\n    if (!this.prefix || this.prefix.length === 0) {\r\n      return igoLocale$;\r\n    }\r\n\r\n    const appLocale$ = (this.prefix as string[]).map((prefix) =>\r\n      this.httpClient.get(`${prefix}${lang}${this.suffix}`)\r\n    );\r\n\r\n    const locale$ = forkJoin([igoLocale$, ...appLocale$]);\r\n\r\n    return locale$.pipe(\r\n      map((translations) => {\r\n        return translations.reduce(\r\n          (acc, current) => ObjectUtils.mergeDeep(acc, current),\r\n          {}\r\n        );\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { HttpBackend } from '@angular/common/http';\r\n\r\nimport { TranslateLoader } from '@ngx-translate/core';\r\n\r\nimport { ConfigService } from '../../config/config.service';\r\nimport { LanguageLoader } from './language.loader';\r\n\r\nexport function defaultLanguageLoader(\r\n  http: HttpBackend,\r\n  config?: ConfigService\r\n) {\r\n  return new LanguageLoader(http, undefined, undefined, config);\r\n}\r\n\r\nexport function provideLanguageLoader(loader?) {\r\n  return {\r\n    provide: TranslateLoader,\r\n    useFactory: loader || defaultLanguageLoader,\r\n    deps: [HttpBackend]\r\n  };\r\n}\r\n\r\nexport function provideDefaultLanguageLoader(loader?) {\r\n  return {\r\n    provide: TranslateLoader,\r\n    useFactory: loader || defaultLanguageLoader,\r\n    deps: [HttpBackend, ConfigService]\r\n  };\r\n}\r\n","import {\n  MissingTranslationHandler,\n  MissingTranslationHandlerParams\n} from '@ngx-translate/core';\n\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\n  handle(params: MissingTranslationHandlerParams) {\n    if (!params.translateService.langs.length) {\n      const error =\n        'Translations are not yet loaded. \\\n         Check that the LanguageService is injected.';\n      throw new Error(error);\n    }\n\n    if (params.key.substr(0, 4) === 'igo.') {\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\n    } else {\n      return params.key;\n    }\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport {\r\n  MissingTranslationHandler,\r\n  TranslateModule\r\n} from '@ngx-translate/core';\r\n\r\nimport { provideDefaultLanguageLoader } from './shared/language.provider';\r\nimport { IgoMissingTranslationHandler } from './shared/missing-translation.guard';\r\n\r\n@NgModule({\r\n  imports: [\r\n    TranslateModule.forRoot({\r\n      missingTranslationHandler: {\r\n        provide: MissingTranslationHandler,\r\n        useClass: IgoMissingTranslationHandler\r\n      }\r\n    })\r\n  ],\r\n  declarations: [],\r\n  exports: [TranslateModule]\r\n})\r\nexport class IgoLanguageModule {\r\n  static forRoot(): ModuleWithProviders<IgoLanguageModule> {\r\n    return {\r\n      ngModule: IgoLanguageModule,\r\n      providers: [provideDefaultLanguageLoader()]\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { GlobalConfig, ToastrModule } from 'ngx-toastr';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    ToastrModule.forRoot({\r\n      positionClass: 'toast-bottom-right',\r\n      timeOut: 10000,\r\n      extendedTimeOut: 10000,\r\n      titleClass: 'mat-subtitle-2',\r\n      messageClass: 'toast-message',\r\n      closeButton: true,\r\n      progressBar: true,\r\n      enableHtml: true,\r\n      tapToDismiss: true,\r\n      maxOpened: 4,\r\n      preventDuplicates: true,\r\n      resetTimeoutOnDuplicate: true,\r\n      countDuplicates: false,\r\n      includeTitleDuplicates: true\r\n    } as GlobalConfig)\r\n  ],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoMessageModule {\r\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\r\n    return {\r\n      ngModule: IgoMessageModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","export enum MessageType {\n  ERROR = 'error',\n  ALERT = 'warning', // todo delete (transition to ngx-toastr)\n  WARNING = 'warning',\n  INFO = 'info',\n  SUCCESS = 'success',\n  SHOW = 'show'\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { BehaviorSubject, combineLatest } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LanguageService {\r\n  private language: string;\r\n  readonly language$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  constructor(public translate: TranslateService) {\r\n    this.language = this.translate.getBrowserLang();\r\n    const lang = this.getLanguage();\r\n    this.translate.setDefaultLang(lang);\r\n    this.language$.next(lang);\r\n  }\r\n\r\n  public getLanguage(): string {\r\n    return this.language.match(/en|fr/) ? this.language : 'en';\r\n  }\r\n\r\n  public setLanguage(language: string) {\r\n    this.language = language.match(/en|fr/) ? language : 'en';\r\n    combineLatest([\r\n      this.translate.use(this.language),\r\n      this.translate.reloadLang(this.language)\r\n    ]).subscribe(() => {\r\n      this.language$.next(this.language);\r\n    });\r\n  }\r\n}\r\n","import { HttpErrorResponse } from '@angular/common/http';\r\nimport { Inject, Injectable, Injector } from '@angular/core';\r\n\r\nimport { ActiveToast, IndividualConfig, ToastrService } from 'ngx-toastr';\r\nimport { BehaviorSubject, forkJoin } from 'rxjs';\r\nimport { debounceTime, first } from 'rxjs/operators';\r\n\r\nimport { ConfigService } from '../../config/config.service';\r\nimport { LanguageService } from '../../language/shared/language.service';\r\nimport { MessageType } from './message.enum';\r\nimport { Message, MessageOptions } from './message.interface';\r\n\r\ninterface ActiveMessageTranslation {\r\n  id: number;\r\n  titleKey: string;\r\n  textKey: string;\r\n  textInterpolateParams?: Object;\r\n  titleInterpolateParams?: Object;\r\n}\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MessageService {\r\n  public messages$ = new BehaviorSubject<Message[]>([]);\r\n  private options?: MessageOptions;\r\n  private activeMessageTranslations: ActiveMessageTranslation[] = [];\r\n\r\n  constructor(\r\n    @Inject(Injector) private injector: Injector,\r\n    private configService: ConfigService,\r\n    private languageService: LanguageService\r\n  ) {\r\n    this.options = this.configService.getConfig('message');\r\n    this.languageService.language$.pipe(debounceTime(500)).subscribe((r) => {\r\n      if (this.toastr.toasts.length === 0) {\r\n        this.activeMessageTranslations = [];\r\n      }\r\n      this.toastr.toasts.map((toast) => {\r\n        const activeMessageTranslation = this.activeMessageTranslations.find(\r\n          (amt) => amt.id === toast.toastId\r\n        );\r\n        if (activeMessageTranslation) {\r\n          const translatedTextInterpolateParams = {\r\n            ...activeMessageTranslation.textInterpolateParams\r\n          };\r\n          const translatedTitleInterpolateParams = {\r\n            ...activeMessageTranslation.titleInterpolateParams\r\n          };\r\n\r\n          if (activeMessageTranslation.textInterpolateParams) {\r\n            Object.keys(activeMessageTranslation.textInterpolateParams).map(\r\n              (k) => {\r\n                if (k) {\r\n                  translatedTextInterpolateParams[k] =\r\n                    this.languageService.translate.instant(\r\n                      activeMessageTranslation.textInterpolateParams[k]\r\n                    );\r\n                }\r\n              }\r\n            );\r\n          }\r\n          if (activeMessageTranslation.titleInterpolateParams) {\r\n            Object.keys(activeMessageTranslation.titleInterpolateParams).map(\r\n              (k) => {\r\n                if (k) {\r\n                  translatedTitleInterpolateParams[k] =\r\n                    this.languageService.translate.instant(\r\n                      activeMessageTranslation.titleInterpolateParams[k]\r\n                    );\r\n                }\r\n              }\r\n            );\r\n          }\r\n\r\n          forkJoin([\r\n            this.languageService.translate.get(\r\n              activeMessageTranslation.textKey,\r\n              translatedTextInterpolateParams\r\n            ),\r\n            this.languageService.translate.get(\r\n              activeMessageTranslation.titleKey,\r\n              translatedTitleInterpolateParams\r\n            )\r\n          ])\r\n            .pipe(first())\r\n            .subscribe((res: [string, string]) => {\r\n              toast.toastRef.componentInstance.message = res[0];\r\n              toast.toastRef.componentInstance.title = res[1];\r\n            });\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private get toastr(): ToastrService {\r\n    return this.injector.get(ToastrService);\r\n  }\r\n\r\n  showError(httpError: HttpErrorResponse) {\r\n    httpError.error.caught = true;\r\n    return this.error(httpError.error.message, httpError.error.title);\r\n  }\r\n\r\n  message(message: Message) {\r\n    const messageType = message.type;\r\n    this.toastr.toastrConfig.iconClasses[messageType] = `toast-${messageType}`;\r\n\r\n    this.messages$.next(this.messages$.value.concat([message]));\r\n\r\n    message.options = message.options || ({} as MessageOptions);\r\n    const currentDate = new Date();\r\n\r\n    message.options.from = message.options.from\r\n      ? message.options.from\r\n      : new Date('1 jan 1900');\r\n    message.options.to = message.options.to\r\n      ? message.options.to\r\n      : new Date('1 jan 3000');\r\n    if (typeof message.options.from === 'string') {\r\n      message.options.from = new Date(\r\n        Date.parse(message.options.from.replace(/-/g, ' '))\r\n      );\r\n    }\r\n    if (typeof message.options.to === 'string') {\r\n      message.options.to = new Date(\r\n        Date.parse(message.options.to.replace(/-/g, ' '))\r\n      );\r\n    }\r\n    if (\r\n      currentDate > message.options.from &&\r\n      currentDate < message.options.to\r\n    ) {\r\n      if (message.showIcon === false) {\r\n        this.toastr.toastrConfig.iconClasses[\r\n          messageType\r\n        ] = `toast-${messageType} toast-no-icon`;\r\n      }\r\n      message = this.handleTemplate(message);\r\n\r\n      if (message.text) {\r\n        let messageShown: ActiveToast<any>;\r\n        switch (message.type) {\r\n          case MessageType.SUCCESS:\r\n            messageShown = this.success(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          case MessageType.ERROR:\r\n            messageShown = this.error(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          case MessageType.INFO:\r\n            messageShown = this.info(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          case MessageType.SHOW:\r\n            messageShown = this.show(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          case MessageType.ALERT:\r\n          case MessageType.WARNING:\r\n            messageShown = this.alert(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n          default:\r\n            messageShown = this.info(\r\n              message.text,\r\n              message.title,\r\n              message.options,\r\n              message.textInterpolateParams,\r\n              message.titleInterpolateParams\r\n            );\r\n            break;\r\n        }\r\n        message.options.id = messageShown.toastId;\r\n      }\r\n    }\r\n  }\r\n\r\n  success(\r\n    text: string,\r\n    title: string = 'igo.core.message.success',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'success',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  error(\r\n    text: string,\r\n    title: string = 'igo.core.message.error',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'error',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  info(\r\n    text: string,\r\n    title: string = 'igo.core.message.info',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'info',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  alert(\r\n    text: string,\r\n    title: string = 'igo.core.message.alert',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'alert',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  show(\r\n    text: string,\r\n    title: string = 'igo.core.message.info',\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    return this.handleNgxToastr(\r\n      'show',\r\n      text,\r\n      title,\r\n      options,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    );\r\n  }\r\n\r\n  private handleNgxToastr(\r\n    type: 'alert' | 'info' | 'error' | 'success' | 'show',\r\n    text: string,\r\n    title: string,\r\n    options: Partial<IndividualConfig> = {},\r\n    textInterpolateParams?: Object,\r\n    titleInterpolateParams?: Object\r\n  ): ActiveToast<any> {\r\n    const translatedTextInterpolateParams = { ...textInterpolateParams };\r\n    const translatedTitlenterpolateParams = { ...titleInterpolateParams };\r\n\r\n    if (textInterpolateParams) {\r\n      Object.keys(textInterpolateParams).map((k) => {\r\n        const value = textInterpolateParams[k];\r\n        if (value) {\r\n          translatedTextInterpolateParams[k] =\r\n            typeof value === 'string'\r\n              ? this.languageService.translate.instant(value)\r\n              : value;\r\n        }\r\n      });\r\n    }\r\n    if (titleInterpolateParams) {\r\n      Object.keys(titleInterpolateParams).map((k) => {\r\n        if (k) {\r\n          const value = titleInterpolateParams[k];\r\n          translatedTitlenterpolateParams[k] =\r\n            typeof value === \"string\"\r\n              ? this.languageService.translate.instant(value)\r\n              : value;\r\n        }\r\n      });\r\n    }\r\n\r\n    const message = this.languageService.translate.instant(\r\n      text,\r\n      translatedTextInterpolateParams\r\n    );\r\n    const translatedTitle = this.languageService.translate.instant(\r\n      title,\r\n      translatedTitlenterpolateParams\r\n    );\r\n\r\n    let activeToast;\r\n    switch (type) {\r\n      case 'success':\r\n        activeToast = this.toastr.success(message, translatedTitle, options);\r\n        break;\r\n      case 'error':\r\n        activeToast = this.toastr.error(message, translatedTitle, options);\r\n        break;\r\n      case 'show':\r\n      case 'info':\r\n        activeToast = this.toastr.info(message, translatedTitle, options);\r\n        break;\r\n      case 'alert':\r\n        activeToast = this.toastr.warning(message, translatedTitle, options);\r\n        break;\r\n    }\r\n    this.activeMessageTranslations.push({\r\n      id: activeToast.toastId,\r\n      titleKey: title,\r\n      textKey: text,\r\n      textInterpolateParams,\r\n      titleInterpolateParams\r\n    });\r\n    return activeToast;\r\n  }\r\n\r\n  remove(id?: number) {\r\n    this.toastr.remove(id);\r\n  }\r\n\r\n  removeAllAreNotError() {\r\n    for (const mess of this.messages$.value) {\r\n      if (mess.type !== MessageType.ERROR) {\r\n        this.remove(mess.options.id);\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleTemplate(message: Message): Message {\r\n    if (!this.options?.template || message.html) {\r\n      return message;\r\n    }\r\n\r\n    let html = this.options?.template;\r\n    html = html.replace('${text}', message.text);\r\n    html = html.replace('${title}', message.title);\r\n\r\n    message.html = undefined;\r\n    message.text = html;\r\n    message.title = undefined;\r\n    return message;\r\n  }\r\n}\r\n","import {\r\n  HttpErrorResponse,\r\n  HttpEvent,\r\n  HttpHandler,\r\n  HttpInterceptor,\r\n  HttpRequest\r\n} from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError, finalize } from 'rxjs/operators';\r\n\r\nimport { MessageService } from '../message/shared/message.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ErrorInterceptor implements HttpInterceptor {\r\n  constructor(private messageService: MessageService) {}\r\n\r\n  intercept(\r\n    originalReq: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    const interceptError = originalReq.headers.get('interceptError');\r\n    const req = originalReq.clone({\r\n      headers: originalReq.headers.delete('interceptError')\r\n    });\r\n    if (interceptError === 'false') {\r\n      return next.handle(req);\r\n    }\r\n    const errorContainer = { httpError: undefined };\r\n    return next.handle(req).pipe(\r\n      catchError((error) => this.handleError(error, errorContainer)),\r\n      finalize(() => {\r\n        const httpError = errorContainer.httpError;\r\n        if (!httpError) {\r\n          return;\r\n        }\r\n\r\n        if (httpError.error.toDisplay) {\r\n          this.handleCaughtError(httpError);\r\n        } else if (!httpError.error.caught) {\r\n          this.handleUncaughtError(httpError);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  private handleError(\r\n    httpError: HttpErrorResponse,\r\n    errorContainer: { httpError: HttpErrorResponse }\r\n  ) {\r\n    if (httpError instanceof HttpErrorResponse) {\r\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\r\n      errorObj.message = httpError.error?.message || httpError.statusText;\r\n      errorObj.caught = false;\r\n\r\n      httpError = new HttpErrorResponse({\r\n        error: errorObj,\r\n        headers: httpError.headers,\r\n        status: httpError.status,\r\n        statusText: httpError.statusText,\r\n        url: httpError.url\r\n      });\r\n    }\r\n\r\n    errorContainer.httpError = httpError;\r\n    return throwError(httpError);\r\n  }\r\n\r\n  private handleCaughtError(httpError: HttpErrorResponse) {\r\n    httpError.error.caught = true;\r\n    this.messageService.error(httpError.error.message, httpError.error.title, {\r\n      progressBar: false\r\n    });\r\n  }\r\n\r\n  private handleUncaughtError(httpError: HttpErrorResponse) {\r\n    httpError.error.caught = true;\r\n    this.messageService.error(\r\n      'igo.core.errors.uncaught.message',\r\n      'igo.core.errors.uncaught.title',\r\n      {\r\n        progressBar: false\r\n      }\r\n    );\r\n  }\r\n}\r\n","import { HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport {\r\n  ModuleWithProviders,\r\n  NgModule,\r\n  Optional,\r\n  SkipSelf\r\n} from '@angular/core';\r\n\r\nimport { ErrorInterceptor } from './error.interceptor';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoErrorModule {\r\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\r\n    return {\r\n      ngModule: IgoErrorModule,\r\n      providers: [\r\n        {\r\n          provide: HTTP_INTERCEPTORS,\r\n          useClass: ErrorInterceptor,\r\n          multi: true\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\r\n    if (parentModule) {\r\n      throw new Error(\r\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\n\r\nimport { DBConfig, NgxIndexedDBModule } from 'ngx-indexed-db';\r\n\r\nimport { IgoActivityModule } from './activity/activity.module';\r\nimport { IgoConfigModule } from './config/config.module';\r\nimport { IgoLanguageModule } from './language/language.module';\r\nimport { IgoMessageModule } from './message/message.module';\r\nimport { IgoErrorModule } from './request/error.module';\r\n\r\nconst dbConfig: DBConfig = {\r\n  name: 'igo2DB',\r\n  version: 2,\r\n  objectStoresMeta: [\r\n    {\r\n      store: 'geoData',\r\n      storeConfig: { keyPath: 'url', autoIncrement: false },\r\n      storeSchema: [\r\n        { name: 'regionID', keypath: 'regionID', options: { unique: false } }\r\n      ]\r\n    },\r\n    {\r\n      store: 'layerData',\r\n      storeConfig: { keyPath: 'layerId', autoIncrement: false },\r\n      storeSchema: [\r\n        {\r\n          name: 'layerOptions',\r\n          keypath: 'layerOptions',\r\n          options: { unique: false }\r\n        },\r\n        {\r\n          name: 'sourceOptions',\r\n          keypath: 'sourceOptions',\r\n          options: { unique: false }\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n};\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    HttpClientModule,\r\n    IgoActivityModule.forRoot(),\r\n    IgoConfigModule.forRoot(),\r\n    IgoErrorModule.forRoot(),\r\n    IgoLanguageModule.forRoot(),\r\n    IgoMessageModule.forRoot(),\r\n    NgxIndexedDBModule.forRoot(dbConfig)\r\n  ],\r\n  declarations: [],\r\n  exports: [\r\n    IgoActivityModule,\r\n    IgoConfigModule,\r\n    IgoErrorModule,\r\n    IgoLanguageModule,\r\n    IgoMessageModule\r\n  ]\r\n})\r\nexport class IgoCoreModule {\r\n  static forRoot(): ModuleWithProviders<IgoCoreModule> {\r\n    return {\r\n      ngModule: IgoCoreModule,\r\n      providers: []\r\n    };\r\n  }\r\n\r\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\r\n    matIconRegistry.addSvgIconSet(\r\n      domSanitizer.bypassSecurityTrustResourceUrl(\r\n        './assets/igo2/core/icons/mdi.svg'\r\n      )\r\n    );\r\n  }\r\n}\r\n","import { Inject, Injectable, InjectionToken, Optional } from '@angular/core';\r\nimport { ActivatedRoute, Params, Router } from '@angular/router';\r\n\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { RouteServiceOptions } from './route.interface';\r\n\r\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\r\n  'routeServiceOptions'\r\n);\r\n\r\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\r\n  return {\r\n    provide: ROUTE_SERVICE_OPTIONS,\r\n    useValue: options\r\n  };\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RouteService {\r\n  public options: RouteServiceOptions;\r\n\r\n  constructor(\r\n    private router: Router,\r\n    public route: ActivatedRoute,\r\n    @Inject(ROUTE_SERVICE_OPTIONS)\r\n    @Optional()\r\n    options: RouteServiceOptions\r\n  ) {\r\n    const defaultOptions = {\r\n      centerKey: 'center',\r\n      zoomKey: 'zoom',\r\n      projectionKey: 'projection',\r\n      contextKey: 'context',\r\n      searchKey: 'search',\r\n      visibleOnLayersKey: 'visiblelayers',\r\n      visibleOffLayersKey: 'invisiblelayers',\r\n      directionsCoordKey: 'routing',\r\n      directionsOptionsKey: 'routingOptions',\r\n      toolKey: 'tool',\r\n      wmsUrlKey: 'wmsUrl',\r\n      wmsLayersKey: 'wmsLayers',\r\n      wmtsUrlKey: 'wmtsUrl',\r\n      wmtsLayersKey: 'wmtsLayers',\r\n      arcgisUrlKey: 'arcgisUrl',\r\n      arcgisLayersKey: 'arcgisLayers',\r\n      iarcgisUrlKey: 'iarcgisUrl',\r\n      iarcgisLayersKey: 'iarcgisLayers',\r\n      tarcgisUrlKey: 'tarcgisUrl',\r\n      tarcgisLayersKey: 'tarcgisLayers',\r\n      vectorKey: 'vector'\r\n    };\r\n    this.options = Object.assign({}, defaultOptions, options);\r\n  }\r\n\r\n  get queryParams(): Observable<Params> {\r\n    let url = decodeURIComponent(location.search);\r\n    if (url.includes('er=')) {\r\n      url = url.replace('er', '&center');\r\n      const queryParams: any = url\r\n        .slice(1)\r\n        .split('&')\r\n        .map((p) => p.split('='))\r\n        .reduce((obj, pair) => {\r\n          const [key, value] = pair.map(decodeURIComponent);\r\n          obj[key] = value;\r\n          return obj;\r\n        }, {});\r\n      this.router.navigate([], { queryParams });\r\n    }\r\n    return this.route.queryParams;\r\n  }\r\n}\r\n","export enum Media {\n  Mobile = 'mobile',\n  Tablet = 'tablet',\n  Desktop = 'desktop'\n}\n\nexport enum MediaOrientation {\n  Portrait = 'portrait',\n  Landscape = 'landscape'\n}\n","import { BreakpointObserver, Breakpoints } from '@angular/cdk/layout';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Media, MediaOrientation } from './media.enum';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MediaService {\r\n  public media$ = new BehaviorSubject<Media>(undefined);\r\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\r\n\r\n  constructor(breakpointObserver: BreakpointObserver) {\r\n    breakpointObserver\r\n      .observe([Breakpoints.HandsetLandscape])\r\n      .subscribe((res) => {\r\n        if (res.matches) {\r\n          this.media$.next(Media.Mobile);\r\n          this.orientation$.next(MediaOrientation.Landscape);\r\n        }\r\n      });\r\n\r\n    breakpointObserver\r\n      .observe([Breakpoints.HandsetPortrait])\r\n      .subscribe((res) => {\r\n        if (res.matches) {\r\n          this.media$.next(Media.Mobile);\r\n          this.orientation$.next(MediaOrientation.Portrait);\r\n        }\r\n      });\r\n\r\n    breakpointObserver\r\n      .observe([Breakpoints.TabletLandscape])\r\n      .subscribe((res) => {\r\n        if (res.matches) {\r\n          this.media$.next(Media.Tablet);\r\n          this.orientation$.next(MediaOrientation.Landscape);\r\n        }\r\n      });\r\n\r\n    breakpointObserver\r\n      .observe([Breakpoints.TabletPortrait])\r\n      .subscribe((res) => {\r\n        if (res.matches) {\r\n          this.media$.next(Media.Tablet);\r\n          this.orientation$.next(MediaOrientation.Portrait);\r\n        }\r\n      });\r\n\r\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe((res) => {\r\n      if (res.matches) {\r\n        this.media$.next(Media.Desktop);\r\n        this.orientation$.next(MediaOrientation.Landscape);\r\n      }\r\n    });\r\n\r\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe((res) => {\r\n      if (res.matches) {\r\n        this.media$.next(Media.Desktop);\r\n        this.orientation$.next(MediaOrientation.Portrait);\r\n      }\r\n    });\r\n  }\r\n\r\n  getMedia(): Media {\r\n    return this.media$.value;\r\n  }\r\n\r\n  getOrientation(): MediaOrientation {\r\n    return this.orientation$.value;\r\n  }\r\n\r\n  isTouchScreen(): boolean {\r\n    return 'ontouchstart' in document.documentElement ? true : false;\r\n  }\r\n\r\n  isMobile(): boolean {\r\n    const media = this.getMedia();\r\n    return media === 'mobile';\r\n  }\r\n\r\n  isDesktop(): boolean {\r\n    const media = this.getMedia();\r\n    return media === 'desktop';\r\n  }\r\n}\r\n","export enum StorageScope {\n  SESSION = 'Session',\n  LOCAL = 'Local'\n}\n\nexport interface StorageOptions {\n  key: string;\n}\n\nexport interface StorageServiceEvent {\n  key?: string;\n  scope: StorageScope;\n  event: StorageServiceEventEnum;\n  previousValue?: any;\n  currentValue?: any;\n}\n\nexport enum StorageServiceEventEnum {\n  ADDED = 'Added',\n  MODIFIED = 'Modified',\n  REMOVED = 'Removed',\n  CLEARED = 'Cleared'\n}\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nimport { ConfigService } from '../config/config.service';\r\nimport {\r\n  StorageOptions,\r\n  StorageScope,\r\n  StorageServiceEvent,\r\n  StorageServiceEventEnum\r\n} from './storage.interface';\r\n\r\nexport abstract class BaseStorage<T extends StorageOptions = StorageOptions> {\r\n  protected options?: T;\r\n\r\n  public storageChange$: BehaviorSubject<StorageServiceEvent> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  constructor(config: ConfigService) {\r\n    this.options = config.getConfig<T>('storage') || ({ key: 'igo' } as T);\r\n  }\r\n\r\n  /**\r\n   * Use to get the data found in storage file\r\n   */\r\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\r\n    let value: any;\r\n\r\n    if (!scope || scope === StorageScope.SESSION) {\r\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\r\n    }\r\n\r\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\r\n      value = localStorage.getItem(`${this.options.key}.${key}`);\r\n    }\r\n\r\n    if (value) {\r\n      try {\r\n        value = JSON.parse(value);\r\n      } catch {\r\n        value = value;\r\n      }\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  set(\r\n    key: string,\r\n    value: string | object | boolean | number,\r\n    scope: StorageScope = StorageScope.LOCAL\r\n  ) {\r\n    const previousValue = this.get(key, scope);\r\n    if (scope === StorageScope.SESSION) {\r\n      sessionStorage.setItem(\r\n        `${this.options.key}.${key}`,\r\n        JSON.stringify(value)\r\n      );\r\n    } else {\r\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\r\n    }\r\n    const currentValue = this.get(key, scope);\r\n\r\n    if (currentValue !== previousValue) {\r\n      this.storageChange$.next({\r\n        key,\r\n        scope,\r\n        event:\r\n          previousValue !== undefined\r\n            ? StorageServiceEventEnum.MODIFIED\r\n            : StorageServiceEventEnum.ADDED,\r\n        previousValue,\r\n        currentValue\r\n      });\r\n    }\r\n  }\r\n\r\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\r\n    const previousValue = this.get(key, scope);\r\n    if (scope === StorageScope.SESSION) {\r\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\r\n    } else {\r\n      localStorage.removeItem(`${this.options.key}.${key}`);\r\n    }\r\n    this.storageChange$.next({\r\n      key,\r\n      scope,\r\n      event: StorageServiceEventEnum.REMOVED,\r\n      previousValue\r\n    });\r\n  }\r\n\r\n  clear(scope: StorageScope = StorageScope.LOCAL) {\r\n    if (scope === StorageScope.SESSION) {\r\n      sessionStorage.clear();\r\n    } else {\r\n      localStorage.clear();\r\n    }\r\n    this.storageChange$.next({ scope, event: StorageServiceEventEnum.CLEARED });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '../config/config.service';\r\nimport { BaseStorage } from './storage';\r\nimport { StorageOptions } from './storage.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StorageService extends BaseStorage<StorageOptions> {\r\n  constructor(private config: ConfigService) {\r\n    super(config);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport { CompressedData } from './compressedData.interface';\r\n\r\nfunction getNumber(v: number, endposition: number, length: number) {\r\n  /* tslint:disable:no-bitwise*/\r\n  const mask = (1 << length) - 1;\r\n  return (v >> endposition) & mask;\r\n  /* tslint:enable:no-bitwise*/\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CompressionService {\r\n  private base64Index = new Map<string, number>();\r\n  private indexBase64 = new Map<number, string>();\r\n\r\n  constructor() {\r\n    this.generateBase64Index();\r\n  }\r\n\r\n  private generateBase64Index() {\r\n    // https://fr.wikipedia.org/wiki/Base64\r\n    // A-Z => [0, 25]\r\n    for (let i = 0; i < 26; i++) {\r\n      this.base64Index.set(String.fromCharCode('A'.charCodeAt(0) + i), i);\r\n      this.indexBase64.set(i, String.fromCharCode('A'.charCodeAt(0) + i));\r\n    }\r\n    // a-z => [26, 51]\r\n    for (let i = 0; i < 26; i++) {\r\n      this.base64Index.set(String.fromCharCode('a'.charCodeAt(0) + i), i + 26);\r\n      this.indexBase64.set(i + 26, String.fromCharCode('a'.charCodeAt(0) + i));\r\n    }\r\n    // 0-9 => [52, 61]\r\n    for (let i = 0; i < 10; i++) {\r\n      this.base64Index.set(String.fromCharCode('0'.charCodeAt(0) + i), i + 52);\r\n      this.indexBase64.set(i + 52, String.fromCharCode('0'.charCodeAt(0) + i));\r\n    }\r\n    // + / => [62, 63]\r\n    this.base64Index.set('+', 62);\r\n    this.base64Index.set('/', 63);\r\n    this.indexBase64.set(62, '+');\r\n    this.indexBase64.set(63, '/');\r\n  }\r\n\r\n  compressBlob(blob: Blob): Observable<CompressedData> {\r\n    if (!blob) {\r\n      return;\r\n    }\r\n\r\n    const observable = new Observable((observer: Observer<CompressedData>) => {\r\n      const reader = new FileReader();\r\n      reader.readAsDataURL(blob);\r\n      reader.onload = () => {\r\n        const base64 = reader.result.valueOf() as string;\r\n        const text64 = base64.substr(base64.indexOf(',') + 1);\r\n        const compressed = this.compressStringBase64(text64);\r\n        const compressedData: CompressedData = {\r\n          length: text64.length,\r\n          type: blob.type,\r\n          object: compressed\r\n        };\r\n        observer.next(compressedData);\r\n      };\r\n    });\r\n    return observable;\r\n  }\r\n\r\n  decompressBlob(compressedData: CompressedData): Blob {\r\n    /* tslint:disable:no-bitwise*/\r\n    const object = compressedData.object;\r\n    const length = compressedData.length;\r\n    const decompressed: string = this.decompressStringBase64(object, length);\r\n    const byteCharacters = atob(decompressed);\r\n    const byteNumbers = new Array(byteCharacters.length);\r\n    for (let i = 0; i < byteCharacters.length; i++) {\r\n      byteNumbers[i] = byteCharacters.charCodeAt(i);\r\n    }\r\n    const byteArray = new Uint8Array(byteNumbers);\r\n    const blob = new Blob([byteArray], { type: compressedData.type });\r\n    /* tslint:enable:no-bitwise*/\r\n    return blob;\r\n  }\r\n\r\n  private compressStringBase64(s: string): string {\r\n    /* tslint:disable:no-bitwise*/\r\n    let out = '';\r\n    let bits = 16;\r\n    let chr = 0;\r\n    let rem = 0;\r\n    for (const c of s) {\r\n      const value = this.base64Index.get(c);\r\n      if (bits > 6) {\r\n        bits -= 6;\r\n        chr += value << bits;\r\n      } else {\r\n        rem = 6 - bits;\r\n        chr += value >> rem;\r\n        out += String.fromCharCode(chr);\r\n        chr = value << (16 - rem);\r\n        bits = 16 - rem;\r\n      }\r\n    }\r\n    if (s.length % 8 !== 0) {\r\n      out += String.fromCharCode(chr);\r\n    }\r\n    /* tslint:enable:no-bitwise*/\r\n    return String.fromCharCode(9731) + out;\r\n  }\r\n\r\n  private decompressStringBase64(c: string, length: number): string {\r\n    /* tslint:disable:no-bitwise*/\r\n    if (!c) {\r\n      return;\r\n    }\r\n\r\n    if (c.charCodeAt(0) !== 9731) {\r\n      return c;\r\n    }\r\n\r\n    let chr = 0;\r\n    let rem = 0;\r\n    let bits = 16;\r\n    let out = '';\r\n    let j = 1;\r\n    let value = c.charCodeAt(j);\r\n    for (let i = 0; i < length; i++) {\r\n      if (bits > 6) {\r\n        bits -= 6;\r\n        chr = getNumber(value, bits, 6);\r\n        out += this.indexBase64.get(chr);\r\n      } else {\r\n        rem = 6 - bits;\r\n        chr = getNumber(value, 0, bits) << rem;\r\n        value = c.charCodeAt(++j);\r\n        chr += getNumber(value, 16 - rem, rem);\r\n        out += this.indexBase64.get(chr);\r\n        bits = 16 - rem;\r\n      }\r\n    }\r\n    return out;\r\n    /* tslint:enable:no-bitwise*/\r\n  }\r\n}\r\n","import { EventEmitter, Injectable, Injector, OnDestroy } from '@angular/core';\r\n\r\nimport { Observable, Subscription, fromEvent } from 'rxjs';\r\nimport { debounceTime, startWith } from 'rxjs/operators';\r\n\r\nimport { MessageService } from '../message/shared/message.service';\r\nimport { ConnectionState } from './network.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NetworkService implements OnDestroy {\r\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\r\n  private onlineSubscription: Subscription;\r\n  private offlineSubscription: Subscription;\r\n  private previousMessageId;\r\n\r\n  private state: ConnectionState = {\r\n    connection: window.navigator.onLine\r\n  };\r\n\r\n  constructor(\r\n    private messageService: MessageService,\r\n    private injector: Injector\r\n  ) {\r\n    this.checkNetworkState();\r\n  }\r\n\r\n  private checkNetworkState() {\r\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\r\n      if (this.previousMessageId) {\r\n        this.messageService.remove(this.previousMessageId);\r\n      }\r\n      const messageObj = this.messageService.info(\r\n        'igo.core.network.online.message',\r\n        'igo.core.network.online.title'\r\n      );\r\n      this.previousMessageId = messageObj.toastId;\r\n      this.state.connection = true;\r\n      this.emitEvent();\r\n    });\r\n\r\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\r\n      if (this.previousMessageId) {\r\n        this.messageService.remove(this.previousMessageId);\r\n      }\r\n      const messageObj = this.messageService.info(\r\n        'igo.core.network.offline.message',\r\n        'igo.core.network.offline.title'\r\n      );\r\n      this.previousMessageId = messageObj.toastId;\r\n      this.state.connection = false;\r\n      this.emitEvent();\r\n    });\r\n  }\r\n\r\n  private emitEvent() {\r\n    this.stateChangeEventEmitter.emit(this.state);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    try {\r\n      this.offlineSubscription.unsubscribe();\r\n      this.onlineSubscription.unsubscribe();\r\n    } catch (e) {}\r\n  }\r\n\r\n  currentState(reportState = true): Observable<ConnectionState> {\r\n    return reportState\r\n      ? this.stateChangeEventEmitter.pipe(\r\n          debounceTime(300),\r\n          startWith(this.state)\r\n        )\r\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '../config/config.service';\r\nimport { RegexOptions } from './regex.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RegexService {\r\n  protected options: RegexOptions;\r\n\r\n  constructor(private config: ConfigService) {\r\n    this.options = this.config.getConfig('regex');\r\n  }\r\n\r\n  getAll() {\r\n    return this.options;\r\n  }\r\n\r\n  get(key) {\r\n    if (this.options) {\r\n      return this.options[key];\r\n    }\r\n    return;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nconst routes: Routes = [\n  { path: '', redirectTo: '/home', pathMatch: 'full' },\n  { path: '**', redirectTo: '/home' }\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes, { useHash: true })],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule {}\n","import { MediaMatcher } from '@angular/cdk/layout';\r\nimport { DOCUMENT } from '@angular/common';\r\nimport {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Inject,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { NavigationEnd, Router } from '@angular/router';\r\n\r\nimport { version } from '@igo2/core';\r\nimport { DomUtils, userAgent } from '@igo2/utils';\r\n\r\nimport { delay, first } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss']\r\n})\r\nexport class AppComponent implements OnInit, OnDestroy {\r\n  mobileQuery: MediaQueryList;\r\n\r\n  public title = 'IGO';\r\n  public version = version;\r\n  private _mobileQueryListener: () => void;\r\n\r\n  constructor(\r\n    @Inject(DOCUMENT) private document: Document,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n    private media: MediaMatcher,\r\n    private router: Router\r\n  ) {\r\n    this.mobileQuery = this.media.matchMedia('(max-width: 600px)');\r\n    this._mobileQueryListener = () => this.changeDetectorRef.detectChanges();\r\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\r\n\r\n    this.detectOldBrowser();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.handleSplashScreen();\r\n  }\r\n\r\n  private handleSplashScreen(): void {\r\n    this.router.events\r\n      .pipe(\r\n        first((events) => events instanceof NavigationEnd),\r\n        delay(300)\r\n      )\r\n      .subscribe(() => {\r\n        this._removeSplashScreen();\r\n      });\r\n  }\r\n\r\n  private _removeSplashScreen(): void {\r\n    const intro = this.document.getElementById('splash-screen');\r\n    if (!intro) {\r\n      return;\r\n    }\r\n    intro.classList.add('is-destroying');\r\n\r\n    const destroyingAnimationTime = 300;\r\n    const stylesheet = this.document.getElementById('splash-screen-stylesheet');\r\n\r\n    setTimeout(() => {\r\n      DomUtils.remove(intro);\r\n      DomUtils.remove(stylesheet);\r\n    }, destroyingAnimationTime);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\r\n  }\r\n\r\n  private detectOldBrowser() {\r\n    const oldBrowser = userAgent.satisfies({\r\n      ie: '<=11',\r\n      chrome: '<64',\r\n      firefox: '<60'\r\n    });\r\n\r\n    if (oldBrowser) {\r\n      console.log('Very old browser ! ', userAgent.getBrowser());\r\n    }\r\n  }\r\n}\r\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\r\n  <mat-toolbar color=\"primary\" class=\"example-toolbar mat-elevation-z6\">\r\n    <button mat-icon-button (click)=\"snav.toggle()\">\r\n      <mat-icon svgIcon=\"menu\"></mat-icon>\r\n    </button>\r\n    <h1>{{ title }}</h1>\r\n    <h5 class=\"mat-subtitle-1 m-b-0\">{{ version.lib }}</h5>\r\n  </mat-toolbar>\r\n\r\n  <mat-sidenav-container\r\n    class=\"example-sidenav-container\"\r\n    [style.marginTop.px]=\"mobileQuery.matches ? 56 : 0\"\r\n  >\r\n    <mat-sidenav\r\n      #snav\r\n      opened=\"true\"\r\n      [mode]=\"mobileQuery.matches ? 'over' : 'side'\"\r\n      [fixedInViewport]=\"mobileQuery.matches\"\r\n      fixedTopGap=\"56\"\r\n    >\r\n      <mat-nav-list>\r\n        <a mat-list-item routerLink=\".\">Home</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"activity\">Activity</a>\r\n        <a mat-list-item routerLink=\"config\">Config</a>\r\n        <a mat-list-item routerLink=\"language\">Language</a>\r\n        <a mat-list-item routerLink=\"media\">Media</a>\r\n        <a mat-list-item routerLink=\"message\">Message</a>\r\n        <a mat-list-item routerLink=\"request\">Request</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"auth-form\">Authentification</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"action\">Action</a>\r\n        <a mat-list-item routerLink=\"dynamic-component\">Dynamic Component</a>\r\n        <a mat-list-item routerLink=\"entity-table\">Entity Table</a>\r\n        <a mat-list-item routerLink=\"entity-selector\">Entity Selector</a>\r\n        <a mat-list-item routerLink=\"form\">Form</a>\r\n        <a mat-list-item routerLink=\"table\">Table</a>\r\n        <a mat-list-item routerLink=\"tool\">Tool</a>\r\n        <a mat-list-item routerLink=\"widget\">Widget</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"simple-map\">Simple map</a>\r\n        <a mat-list-item routerLink=\"layer\">Layer</a>\r\n        <a mat-list-item routerLink=\"legend\">Legend</a>\r\n        <a mat-list-item routerLink=\"overlay\">Overlay</a>\r\n        <a mat-list-item routerLink=\"geometry\">Geometry</a>\r\n        <a mat-list-item routerLink=\"feature\">Feature</a>\r\n        <a mat-list-item routerLink=\"hover\">Hover</a>\r\n        <a mat-list-item routerLink=\"measure\">Measure</a>\r\n        <a mat-list-item routerLink=\"draw\">Draw</a>\r\n        <a mat-list-item routerLink=\"query\">Query</a>\r\n        <a mat-list-item routerLink=\"catalog\">Catalog</a>\r\n        <a mat-list-item routerLink=\"search\">Search</a>\r\n        <a mat-list-item routerLink=\"print\">Print</a>\r\n        <a mat-list-item routerLink=\"import-export\">Import/Export</a>\r\n        <a mat-list-item routerLink=\"directions\">Directions</a>\r\n        <a mat-list-item routerLink=\"time-filter\">Time filter</a>\r\n        <a mat-list-item routerLink=\"ogc-filter\">OGC filter</a>\r\n        <a mat-list-item routerLink=\"spatial-filter\">Spatial filter</a>\r\n        <a mat-list-item routerLink=\"workspace\">Workspace</a>\r\n\r\n        <hr />\r\n\r\n        <a mat-list-item routerLink=\"context\">Context</a>\r\n      </mat-nav-list>\r\n    </mat-sidenav>\r\n\r\n    <mat-sidenav-content>\r\n      <router-outlet></router-outlet>\r\n    </mat-sidenav-content>\r\n  </mat-sidenav-container>\r\n</div>\r\n","import { Injectable, Injector } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport jwtDecode from 'jwt-decode';\r\n\r\nimport { AuthOptions } from './auth.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TokenService {\r\n  private options?: AuthOptions;\r\n  private tokenKey: string;\r\n\r\n  constructor(private injector: Injector) {\r\n    const config = this.injector.get<ConfigService>(ConfigService);\r\n    this.options = config.getConfig('auth');\r\n    this.tokenKey = this.options?.tokenKey;\r\n  }\r\n\r\n  set(token: string) {\r\n    localStorage.setItem(this.tokenKey, token);\r\n  }\r\n\r\n  remove() {\r\n    localStorage.removeItem(this.tokenKey);\r\n  }\r\n\r\n  get(): string {\r\n    return localStorage.getItem(this.tokenKey);\r\n  }\r\n\r\n  decode() {\r\n    const token = this.get();\r\n    if (!token) {\r\n      return;\r\n    }\r\n    return jwtDecode(token);\r\n  }\r\n\r\n  isExpired() {\r\n    const jwt = this.decode();\r\n    const currentTime = new Date().getTime() / 1000;\r\n    if (jwt && currentTime < jwt.exp) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n}\r\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\n\r\nimport { ConfigService, LanguageService, MessageService } from '@igo2/core';\r\nimport { Base64 } from '@igo2/utils';\r\n\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { catchError, tap } from 'rxjs/operators';\r\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\r\n\r\nimport { AuthOptions, IInfosUser, User } from './auth.interface';\r\nimport { TokenService } from './token.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\r\n  public logged$ = new BehaviorSubject<boolean>(undefined);\r\n  public redirectUrl: string;\r\n  public languageForce = false;\r\n  private anonymous = false;\r\n  private authOptions: AuthOptions;\r\n\r\n  get hasAuthService() {\r\n    return this.authOptions?.url !== undefined;\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private tokenService: TokenService,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    @Optional() private router: Router\r\n  ) {\r\n    this.authOptions = this.config.getConfig('auth');\r\n    this.authenticate$.next(this.authenticated);\r\n    this.authenticate$.subscribe((authenticated) => {\r\n      this.logged$.next(authenticated);\r\n      globalCacheBusterNotifier.next();\r\n    });\r\n  }\r\n\r\n  login(username: string, password: string): Observable<void> {\r\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n\r\n    const body = {\r\n      username,\r\n      password: this.encodePassword(password)\r\n    };\r\n\r\n    return this.loginCall(body, myHeader);\r\n  }\r\n\r\n  loginWithToken(\r\n    token: string,\r\n    type: string,\r\n    infosUser?: IInfosUser\r\n  ): Observable<void> {\r\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n\r\n    const body = {\r\n      token,\r\n      typeConnection: type,\r\n      infosUser\r\n    };\r\n\r\n    return this.loginCall(body, myHeader);\r\n  }\r\n\r\n  loginAnonymous(): Observable<boolean> {\r\n    this.anonymous = true;\r\n    this.logged$.next(true);\r\n    return of(true);\r\n  }\r\n\r\n  refresh(): Observable<void> {\r\n    return this.http.post(`${this.authOptions?.url}/refresh`, {}).pipe(\r\n      tap((data: any) => {\r\n        this.tokenService.set(data.token);\r\n      }),\r\n      catchError((err) => {\r\n        err.error.caught = true;\r\n        throw err;\r\n      })\r\n    );\r\n  }\r\n\r\n  logout(): Observable<boolean> {\r\n    this.anonymous = false;\r\n    this.tokenService.remove();\r\n    this.authenticate$.next(false);\r\n    return of(true);\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return !this.tokenService.isExpired();\r\n  }\r\n\r\n  getToken(): string {\r\n    return this.tokenService.get();\r\n  }\r\n\r\n  decodeToken() {\r\n    if (this.isAuthenticated()) {\r\n      return this.tokenService.decode();\r\n    }\r\n    return false;\r\n  }\r\n\r\n  goToRedirectUrl() {\r\n    if (!this.router) {\r\n      return;\r\n    }\r\n    const redirectUrl = this.redirectUrl || this.router.url;\r\n\r\n    if (redirectUrl === this.authOptions.loginRoute) {\r\n      const homeRoute = this.authOptions.homeRoute || '/';\r\n      this.router.navigateByUrl(homeRoute);\r\n    } else if (redirectUrl) {\r\n      this.router.navigateByUrl(redirectUrl);\r\n    }\r\n  }\r\n\r\n  getUserInfo(): Observable<User> {\r\n    const url = this.authOptions?.url + '/info';\r\n    return this.http.get<User>(url);\r\n  }\r\n\r\n  getProfils(): Observable<{ profils: string[] }> {\r\n    return this.http.get<{ profils: string[] }>(\r\n      `${this.authOptions?.url}/profils`\r\n    );\r\n  }\r\n\r\n  updateUser(user: User): Observable<User> {\r\n    return this.http.patch<User>(this.authOptions?.url, user);\r\n  }\r\n\r\n  private encodePassword(password: string) {\r\n    return Base64.encode(password);\r\n  }\r\n\r\n  // authenticated or anonymous\r\n  get logged(): boolean {\r\n    return this.authenticated || this.isAnonymous;\r\n  }\r\n\r\n  get isAnonymous(): boolean {\r\n    return this.anonymous;\r\n  }\r\n\r\n  get authenticated(): boolean {\r\n    return this.isAuthenticated();\r\n  }\r\n\r\n  get isAdmin(): boolean {\r\n    const token = this.decodeToken();\r\n    if (token && token.user && token.user.isAdmin) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private loginCall(body, headers) {\r\n    return this.http\r\n      .post(`${this.authOptions?.url}/login`, body, { headers })\r\n      .pipe(\r\n        tap((data: any) => {\r\n          this.tokenService.set(data.token);\r\n          const tokenDecoded = this.decodeToken();\r\n          if (tokenDecoded && tokenDecoded.user) {\r\n            if (tokenDecoded.user.locale && !this.languageForce) {\r\n              this.languageService.setLanguage(tokenDecoded.user.locale);\r\n            }\r\n            if (tokenDecoded.user.isExpired) {\r\n              this.messageService.alert('igo.auth.error.Password expired');\r\n            }\r\n          }\r\n          this.authenticate$.next(true);\r\n        }),\r\n        catchError((err) => {\r\n          err.error.caught = true;\r\n          throw err;\r\n        })\r\n      );\r\n  }\r\n}\r\n","import {\r\n  ApplicationRef,\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\n\r\nimport { AuthGoogleOptions } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-google',\r\n  templateUrl: './auth-google.component.html',\r\n  styleUrls: ['./auth-google.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthGoogleComponent {\r\n  private options?: AuthGoogleOptions;\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private appRef: ApplicationRef\r\n  ) {\r\n    this.options = this.config.getConfig('auth.google');\r\n\r\n    if (this.options?.apiKey && this.options?.clientId) {\r\n      this.loadSDKGoogle();\r\n      this.loadPlatform();\r\n    } else {\r\n      console.warn(\r\n        'Google authentification needs \"apiKey\" and \"clientId\" options'\r\n      );\r\n    }\r\n  }\r\n\r\n  public handleSignInClick() {\r\n    (window as any).gapi.auth2.getAuthInstance().signIn();\r\n  }\r\n\r\n  public handleSignOutClick() {\r\n    (window as any).gapi.auth2.getAuthInstance().signOut();\r\n  }\r\n\r\n  private handleClientLoad() {\r\n    (window as any).gapi.load('client:auth2', () => this.initClient());\r\n  }\r\n\r\n  private initClient() {\r\n    (window as any).gapi.client\r\n      .init({\r\n        apiKey: this.options?.apiKey,\r\n        clientId: this.options?.clientId,\r\n        discoveryDocs: [\r\n          'https://people.googleapis.com/$discovery/rest?version=v1'\r\n        ],\r\n        scope: 'profile'\r\n      })\r\n      .then(() => {\r\n        this.handleSignOutClick();\r\n        this.updateTextButton();\r\n        (window as any).gapi.auth2\r\n          .getAuthInstance()\r\n          .isSignedIn.listen((rep) => {\r\n            this.updateSigninStatus(rep);\r\n          });\r\n      });\r\n  }\r\n\r\n  private updateSigninStatus(isSignedIn) {\r\n    this.updateTextButton();\r\n    if (isSignedIn) {\r\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\r\n    }\r\n  }\r\n\r\n  private updateTextButton() {\r\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\r\n    if (btn && this.languageService.getLanguage() !== 'en') {\r\n      if (btn.innerHTML === 'Sign in with Google') {\r\n        btn.innerHTML = this.languageService.translate.instant(\r\n          'igo.auth.google.login'\r\n        );\r\n      } else if (btn.innerHTML === 'Signed in with Google') {\r\n        btn.innerHTML = this.languageService.translate.instant(\r\n          'igo.auth.google.logged'\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private loginGoogle(token) {\r\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\r\n      this.appRef.tick();\r\n      this.login.emit(true);\r\n    });\r\n  }\r\n\r\n  private loadSDKGoogle() {\r\n    const fjs = document.getElementsByTagName('script')[0];\r\n    const js = document.createElement('script');\r\n    js.id = 'google-jssdk';\r\n    js.src = 'https://apis.google.com/js/api.js';\r\n    js.onload = () => {\r\n      this.handleClientLoad();\r\n    };\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n  }\r\n\r\n  private loadPlatform() {\r\n    const fjs = document.getElementsByTagName('script')[0];\r\n    const js = document.createElement('script');\r\n    js.id = 'google-platform';\r\n    js.src = 'https://apis.google.com/js/platform.js';\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n  }\r\n}\r\n","<div\n  class=\"g-signin2 google-login-button\"\n  data-height=\"40\"\n  data-width=\"265\"\n  data-longtitle=\"true\"\n></div>\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\n  <div>\n    <mat-form-field class=\"full-width\">\n      <mat-label>{{ 'igo.auth.user' | translate }}</mat-label>\n      <input\n        matInput\n        required\n        placeholder=\"{{ 'igo.auth.user' | translate }}\"\n        formControlName=\"username\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div>\n    <mat-form-field class=\"full-width\">\n      <mat-label>{{ 'igo.auth.password' | translate }}</mat-label>\n      <input\n        matInput\n        required\n        type=\"password\"\n        placeholder=\"{{ 'igo.auth.password' | translate }}\"\n        formControlName=\"password\"\n      />\n    </mat-form-field>\n  </div>\n\n  <button mat-raised-button type=\"submit\">\n    {{ 'igo.auth.login' | translate }}\n  </button>\n  <button\n    *ngIf=\"allowAnonymous\"\n    mat-raised-button\n    class=\"anonymous\"\n    type=\"button\"\n    [disabled]=\"loading\"\n    (click)=\"loginAnonymous()\"\n  >\n    {{ 'igo.auth.accessAnonymous' | translate }}\n  </button>\n  <div *ngIf=\"error\">\n    <br />\n    <font size=\"3\" color=\"red\">{{ error }}</font>\n  </div>\n</form>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-intern',\r\n  templateUrl: './auth-intern.component.html',\r\n  styleUrls: ['./auth-intern.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.Default\r\n})\r\nexport class AuthInternComponent {\r\n  @Input()\r\n  get allowAnonymous(): boolean {\r\n    return this._allowAnonymous;\r\n  }\r\n  set allowAnonymous(value: boolean) {\r\n    this._allowAnonymous = value;\r\n  }\r\n  private _allowAnonymous = true;\r\n\r\n  public error = '';\r\n  public form: UntypedFormGroup;\r\n  public loading = false;\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  constructor(\r\n    public auth: AuthService,\r\n    private languageService: LanguageService,\r\n    fb: UntypedFormBuilder\r\n  ) {\r\n    this.form = fb.group({\r\n      username: ['', Validators.required],\r\n      password: ['', Validators.required]\r\n    });\r\n  }\r\n\r\n  loginUser(values: any) {\r\n    this.loading = true;\r\n    this.auth.login(values.username, values.password).subscribe(\r\n      () => {\r\n        this.login.emit(true);\r\n        this.loading = false;\r\n      },\r\n      (error: any) => {\r\n        try {\r\n          this.languageService.translate\r\n            .get('igo.auth.error.' + error.error.message)\r\n            .subscribe((errorMsg) => (this.error = errorMsg));\r\n        } catch (e) {\r\n          this.error = error.error.message;\r\n        }\r\n        this.loading = false;\r\n      }\r\n    );\r\n    return false;\r\n  }\r\n\r\n  loginAnonymous() {\r\n    this.auth.loginAnonymous().subscribe(() => {\r\n      this.login.emit(true);\r\n    });\r\n  }\r\n}\r\n","import {\r\n  ApplicationRef,\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { AuthFacebookOptions } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-facebook',\r\n  templateUrl: './auth-facebook.component.html',\r\n  styleUrls: ['./auth-facebook.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthFacebookComponent {\r\n  private options?: AuthFacebookOptions;\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private appRef: ApplicationRef\r\n  ) {\r\n    this.options = this.config.getConfig('auth.facebook');\r\n\r\n    if (this.options?.appId) {\r\n      this.loadSDKFacebook();\r\n    } else {\r\n      console.warn('Facebook authentification needs \"appId\" option');\r\n    }\r\n  }\r\n\r\n  private subscribeEvents() {\r\n    (window as any).FB.Event.subscribe('auth.statusChange', (rep) => {\r\n      this.statusChangeCallback(rep);\r\n    });\r\n  }\r\n\r\n  private statusChangeCallback(response) {\r\n    if (response.status === 'connected') {\r\n      const accessToken = response.authResponse.accessToken;\r\n      this.loginFacebook(accessToken);\r\n    }\r\n  }\r\n\r\n  private loginFacebook(token) {\r\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\r\n      this.appRef.tick();\r\n      this.login.emit(true);\r\n    });\r\n  }\r\n\r\n  private loadSDKFacebook() {\r\n    if (document.getElementById('facebook-jssdk')) {\r\n      return;\r\n    }\r\n\r\n    const urlSDK =\r\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\r\n\r\n    const fjs = document.getElementsByTagName('script')[0];\r\n    const js = document.createElement('script');\r\n    js.id = 'facebook-jssdk';\r\n    js.src = `${urlSDK}&appId=${this.options?.appId}`;\r\n    js.onload = () => {\r\n      this.subscribeEvents();\r\n    };\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n  }\r\n}\r\n","<div\n  scope=\"public_profile,email\"\n  class=\"fb-login-button\"\n  data-max-rows=\"1\"\n  data-size=\"large\"\n  data-button-type=\"login_with\"\n  data-show-faces=\"false\"\n  data-auto-logout-link=\"false\"\n  data-use-continue-as=\"false\"\n></div>\n","import {\r\n  ApplicationRef,\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Inject,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport {\r\n  MSAL_GUARD_CONFIG,\r\n  MsalBroadcastService,\r\n  MsalService\r\n} from '@azure/msal-angular';\r\nimport {\r\n  AuthenticationResult,\r\n  InteractionRequiredAuthError,\r\n  InteractionStatus,\r\n  PopupRequest,\r\n  PublicClientApplication,\r\n  SilentRequest\r\n} from '@azure/msal-browser';\r\nimport { Subject } from 'rxjs';\r\nimport { filter, takeUntil } from 'rxjs/operators';\r\n\r\nimport {\r\n  AuthMicrosoftOptions,\r\n  MSPMsalGuardConfiguration\r\n} from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-microsoft',\r\n  templateUrl: './auth-microsoft.component.html',\r\n  styleUrls: ['./auth-microsoft.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthMicrosoftComponent {\r\n  private options?: AuthMicrosoftOptions;\r\n  private readonly _destroying$ = new Subject<void>();\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n  private broadcastService: MsalBroadcastService;\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private appRef: ApplicationRef,\r\n    private msalService: MsalService,\r\n    @Inject(MSAL_GUARD_CONFIG)\r\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\r\n  ) {\r\n    this.options = this.config.getConfig('auth.microsoft');\r\n\r\n    this.msalService.instance = new PublicClientApplication({\r\n      auth: this.options,\r\n      cache: {\r\n        cacheLocation: 'sessionStorage'\r\n      }\r\n    });\r\n\r\n    this.broadcastService = new MsalBroadcastService(\r\n      this.msalService.instance,\r\n      this.msalService\r\n    );\r\n\r\n    if (this.options?.clientId) {\r\n      this.broadcastService.inProgress$\r\n        .pipe(\r\n          filter(\r\n            (status: InteractionStatus) => status === InteractionStatus.None\r\n          ),\r\n          takeUntil(this._destroying$)\r\n        )\r\n        .subscribe(() => {\r\n          this.checkAccount();\r\n        });\r\n    } else {\r\n      console.warn('Microsoft authentification needs \"clientId\" option');\r\n    }\r\n  }\r\n\r\n  public loginMicrosoft() {\r\n    this.msalService\r\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\r\n      .subscribe((response: AuthenticationResult) => {\r\n        this.msalService.instance.setActiveAccount(response.account);\r\n        this.checkAccount();\r\n      });\r\n  }\r\n\r\n  private checkAccount() {\r\n    this.msalService.instance\r\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\r\n      .then((response: AuthenticationResult) => {\r\n        const tokenAccess = response.accessToken;\r\n        const tokenId = response.idToken;\r\n        this.authService\r\n          .loginWithToken(tokenAccess, 'microsoft', { tokenId })\r\n          .subscribe(() => {\r\n            this.appRef.tick();\r\n            this.login.emit(true);\r\n          });\r\n      })\r\n      .catch(async (error) => {\r\n        if (error instanceof InteractionRequiredAuthError) {\r\n          // fallback to interaction when silent call fails\r\n          return this.msalService.acquireTokenPopup(\r\n            this.getConf().authRequest as SilentRequest\r\n          );\r\n        }\r\n        console.log(error);\r\n      })\r\n      .catch((error) => {\r\n        console.log('Silent token fails');\r\n      });\r\n  }\r\n\r\n  private getConf(): MSPMsalGuardConfiguration {\r\n    return this.msalGuardConfig.filter((conf) => conf.type === 'add')[0];\r\n  }\r\n}\r\n","<button\n  class=\"microsoft-login-button\"\n  mat-raised-button\n  (click)=\"loginMicrosoft()\"\n>\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{ 'igo.auth.microsoft.login' | translate }}\n</button>\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nimport { Location } from '@angular/common';\r\nimport { Inject, Injectable } from '@angular/core';\r\n\r\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\r\nimport { IMsalService } from '@azure/msal-angular';\r\nimport {\r\n  AuthenticationResult,\r\n  EndSessionPopupRequest,\r\n  EndSessionRequest,\r\n  IPublicClientApplication,\r\n  Logger,\r\n  PopupRequest,\r\n  RedirectRequest,\r\n  SilentRequest,\r\n  SsoSilentRequest,\r\n  WrapperSKU\r\n} from '@azure/msal-browser';\r\nimport { Observable, from } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class MsalServiceb2c implements IMsalService {\r\n  private redirectHash: string;\r\n  private logger: Logger;\r\n  private name = '@azure/msal-angular';\r\n  private version = '2.0.0-beta.2';\r\n  constructor(\r\n    @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\r\n    private location: Location\r\n  ) {\r\n    const hash = this.location.path(true).split('#').pop();\r\n    if (hash) {\r\n      this.redirectHash = `#${hash}`;\r\n    }\r\n    this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\r\n  }\r\n\r\n  initialize(): Observable<void> {\r\n    return from(this.instance.initialize());\r\n  }\r\n\r\n  acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\r\n    return from(this.instance.acquireTokenPopup(request));\r\n  }\r\n  acquireTokenRedirect(request: RedirectRequest): Observable<void> {\r\n    return from(this.instance.acquireTokenRedirect(request));\r\n  }\r\n  acquireTokenSilent(\r\n    silentRequest: SilentRequest\r\n  ): Observable<AuthenticationResult> {\r\n    return from(this.instance.acquireTokenSilent(silentRequest));\r\n  }\r\n  handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\r\n    return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\r\n  }\r\n  loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\r\n    return from(this.instance.loginPopup(request));\r\n  }\r\n  loginRedirect(request?: RedirectRequest): Observable<void> {\r\n    return from(this.instance.loginRedirect(request));\r\n  }\r\n  logout(logoutRequest?: EndSessionRequest): Observable<void> {\r\n    return from(this.instance.logout(logoutRequest));\r\n  }\r\n  logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\r\n    return from(this.instance.logoutRedirect(logoutRequest));\r\n  }\r\n  logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\r\n    return from(this.instance.logoutPopup(logoutRequest));\r\n  }\r\n  ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\r\n    return from(this.instance.ssoSilent(request));\r\n  }\r\n  /**\r\n   * Gets logger for msal-angular.\r\n   * If no logger set, returns logger instance created with same options as msal-browser\r\n   */\r\n  getLogger(): Logger {\r\n    if (!this.logger) {\r\n      this.logger = this.instance.getLogger().clone(this.name, this.version);\r\n    }\r\n    return this.logger;\r\n  }\r\n  // Create a logger instance for msal-angular with the same options as msal-browser\r\n  setLogger(logger: Logger): void {\r\n    this.logger = logger.clone(this.name, this.version);\r\n    this.instance.setLogger(logger);\r\n  }\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nimport { Inject, Injectable } from '@angular/core';\r\n\r\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\r\nimport {\r\n  EventMessage,\r\n  EventMessageUtils,\r\n  IPublicClientApplication,\r\n  InteractionStatus\r\n} from '@azure/msal-browser';\r\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\r\n\r\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\r\n\r\n@Injectable()\r\nexport class MsalBroadcastServiceb2c {\r\n  private _msalSubject: Subject<EventMessage>;\r\n  public msalSubject$: Observable<EventMessage>;\r\n  private _inProgress: BehaviorSubject<InteractionStatus>;\r\n  public inProgress$: Observable<InteractionStatus>;\r\n\r\n  constructor(\r\n    @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\r\n    private authService: MsalServiceb2c\r\n  ) {\r\n    this._msalSubject = new Subject<EventMessage>();\r\n    this.msalSubject$ = this._msalSubject.asObservable();\r\n\r\n    // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\r\n    this._inProgress = new BehaviorSubject<InteractionStatus>(\r\n      InteractionStatus.Startup\r\n    );\r\n    this.inProgress$ = this._inProgress.asObservable();\r\n\r\n    this.msalInstance.addEventCallback((message: EventMessage) => {\r\n      this._msalSubject.next(message);\r\n      const status = EventMessageUtils.getInteractionStatusFromEvent(message);\r\n      if (status !== null) {\r\n        this.authService\r\n          .getLogger()\r\n          .verbose(\r\n            `BroadcastService - ${message.eventType} results in setting inProgress to ${status}`\r\n          );\r\n        this._inProgress.next(status);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import {\r\n  ApplicationRef,\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Inject,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\r\nimport {\r\n  AuthenticationResult,\r\n  InteractionRequiredAuthError,\r\n  InteractionStatus,\r\n  PopupRequest,\r\n  PublicClientApplication,\r\n  SilentRequest\r\n} from '@azure/msal-browser';\r\nimport { Subject } from 'rxjs';\r\nimport { filter, takeUntil } from 'rxjs/operators';\r\n\r\nimport { MsalBroadcastServiceb2c } from '../shared/auth-msalBroadcastServiceb2c.service';\r\nimport { MsalServiceb2c } from '../shared/auth-msalServiceb2c.service.';\r\nimport {\r\n  AuthMicrosoftb2cOptions,\r\n  MSPMsalGuardConfiguration\r\n} from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-microsoftb2c',\r\n  templateUrl: './auth-microsoftb2c.component.html',\r\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AuthMicrosoftb2cComponent {\r\n  private options: AuthMicrosoftb2cOptions;\r\n  private readonly _destroying$ = new Subject<void>();\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n  private broadcastService: MsalBroadcastServiceb2c;\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private config: ConfigService,\r\n    private appRef: ApplicationRef,\r\n    private msalService: MsalServiceb2c,\r\n    @Inject(MSAL_GUARD_CONFIG)\r\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\r\n  ) {\r\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\r\n\r\n    this.msalService.instance = new PublicClientApplication({\r\n      auth: this.options.browserAuthOptions,\r\n      cache: {\r\n        cacheLocation: 'sessionStorage'\r\n      }\r\n    });\r\n\r\n    this.broadcastService = new MsalBroadcastServiceb2c(\r\n      this.msalService.instance,\r\n      this.msalService\r\n    );\r\n\r\n    if (this.options.browserAuthOptions.clientId) {\r\n      this.broadcastService.inProgress$\r\n        .pipe(\r\n          filter(\r\n            (status: InteractionStatus) => status === InteractionStatus.None\r\n          ),\r\n          takeUntil(this._destroying$)\r\n        )\r\n        .subscribe(() => {\r\n          this.checkAccount();\r\n        });\r\n    } else {\r\n      console.warn('Microsoft authentification needs \"clientId\" option');\r\n    }\r\n  }\r\n\r\n  public loginMicrosoftb2c() {\r\n    this.msalService\r\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\r\n      .subscribe((response: AuthenticationResult) => {\r\n        this.msalService.instance.setActiveAccount(response.account);\r\n        this.checkAccount();\r\n      });\r\n  }\r\n\r\n  private checkAccount() {\r\n    this.msalService.instance\r\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\r\n      .then((response: AuthenticationResult) => {\r\n        const token = response.idToken;\r\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\r\n          this.appRef.tick();\r\n          this.login.emit(true);\r\n        });\r\n      })\r\n      .catch(async (error) => {\r\n        if (error instanceof InteractionRequiredAuthError) {\r\n          // fallback to interaction when silent call fails\r\n          return this.msalService.acquireTokenPopup(\r\n            this.getConf().authRequest as SilentRequest\r\n          );\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.log('Silent token fails');\r\n      });\r\n  }\r\n\r\n  private getConf(): MSPMsalGuardConfiguration {\r\n    return this.msalGuardConfig.filter((conf) => conf.type === 'b2c')[0];\r\n  }\r\n}\r\n","<button\n  class=\"microsoft-login-button\"\n  mat-raised-button\n  (click)=\"loginMicrosoftb2c()\"\n>\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{ 'igo.auth.microsoftb2c.login' | translate }}\n</button>\n","<div *ngIf=\"visible\">\n  <div\n    *ngIf=\"!auth.logged && backgroundDisable\"\n    class=\"backgroundDisable\"\n  ></div>\n\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\n    <h1>{{ 'igo.auth.connection' | translate }}</h1>\n\n    <igo-auth-google\n      *ngIf=\"options.google && options.google.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-google>\n    <igo-auth-microsoft\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-microsoft>\n    <igo-auth-microsoftb2c\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-microsoftb2c>\n    <igo-auth-facebook\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-facebook>\n    <igo-auth-intern\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\n      [allowAnonymous]=\"options.allowAnonymous\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-intern>\n  </div>\n\n  <div\n    *ngIf=\"auth.logged && showAlreadyConnectedDiv\"\n    class=\"login center-block\"\n  >\n    <p>{{ 'igo.auth.welcome' | translate: user }}</p>\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">\n      {{ 'igo.auth.signOut' | translate }}\n    </button>\n  </div>\n\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\n    <p>{{ 'igo.auth.deconnection' | translate }}</p>\n    <button\n      *ngIf=\"options.homeRoute\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"home()\"\n    >\n      {{ 'igo.auth.home' | translate }}\n    </button>\n  </div>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnInit,\r\n  Optional,\r\n  Output\r\n} from '@angular/core';\r\nimport { NavigationStart, Router } from '@angular/router';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { filter } from 'rxjs/operators';\r\n\r\nimport { AuthOptions } from '../shared/auth.interface';\r\nimport { AuthService } from '../shared/auth.service';\r\n\r\n@Component({\r\n  selector: 'igo-auth-form',\r\n  templateUrl: './auth-form.component.html',\r\n  styleUrls: ['./auth-form.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.Default\r\n})\r\nexport class AuthFormComponent implements OnInit {\r\n  @Input()\r\n  get backgroundDisable(): boolean {\r\n    if (this.isLogoutRoute || this.isLogoutRoute) {\r\n      return false;\r\n    }\r\n    return this._backgroundDisable;\r\n  }\r\n  set backgroundDisable(value: boolean) {\r\n    this._backgroundDisable = value.toString() === 'true';\r\n  }\r\n  private _backgroundDisable = true;\r\n\r\n  @Input()\r\n  get hasAlreadyConnectedDiv(): boolean {\r\n    return this._hasAlreadyConnectedDiv;\r\n  }\r\n  set hasAlreadyConnectedDiv(value: boolean) {\r\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\r\n  }\r\n  private _hasAlreadyConnectedDiv = true;\r\n\r\n  @Input()\r\n  get hasLogoutDiv(): boolean {\r\n    return this._hasLogoutDiv;\r\n  }\r\n  set hasLogoutDiv(value: boolean) {\r\n    this._hasLogoutDiv = value.toString() === 'true';\r\n  }\r\n  private _hasLogoutDiv = true;\r\n\r\n  @Input()\r\n  get showAlreadyConnectedDiv(): boolean {\r\n    if (this.isLogoutRoute) {\r\n      return this.hasAlreadyConnectedDiv;\r\n    }\r\n    return this._showAlreadyConnectedDiv;\r\n  }\r\n  set showAlreadyConnectedDiv(value: boolean) {\r\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\r\n  }\r\n  private _showAlreadyConnectedDiv = false;\r\n\r\n  @Input()\r\n  get showLogoutDiv(): boolean {\r\n    if (this.isLogoutRoute) {\r\n      return this.hasLogoutDiv;\r\n    }\r\n    return this._showLogoutDiv;\r\n  }\r\n  set showLogoutDiv(value: boolean) {\r\n    this._showLogoutDiv = value.toString() === 'true';\r\n  }\r\n  private _showLogoutDiv = false;\r\n\r\n  get showLoginDiv(): boolean {\r\n    if (!this.isLogoutRoute) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  public options?: AuthOptions;\r\n  public user;\r\n\r\n  public visible = true;\r\n\r\n  private isLoginRoute: boolean;\r\n  private isLogoutRoute: boolean;\r\n\r\n  constructor(\r\n    public auth: AuthService,\r\n    private config: ConfigService,\r\n    @Optional() private router: Router\r\n  ) {\r\n    this.options = this.config.getConfig('auth');\r\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\r\n  }\r\n\r\n  public ngOnInit() {\r\n    this.analyzeRoute();\r\n    this.getName();\r\n  }\r\n\r\n  public onLogin() {\r\n    this.auth.goToRedirectUrl();\r\n    this.getName();\r\n    this.login.emit(true);\r\n  }\r\n\r\n  public logout() {\r\n    this.auth.logout().subscribe(() => {\r\n      this.user = undefined;\r\n      if (this.router) {\r\n        if (this.options?.logoutRoute) {\r\n          this.router.navigate([this.options?.logoutRoute]);\r\n        } else if (this.options?.homeRoute) {\r\n          this.router.navigate([this.options?.homeRoute]);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public home() {\r\n    if (this.router && this.options?.homeRoute) {\r\n      this.router.navigate([this.options?.homeRoute]);\r\n    }\r\n  }\r\n\r\n  private getName() {\r\n    const tokenDecoded = this.auth.decodeToken();\r\n    if (tokenDecoded) {\r\n      this.user = {\r\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\r\n      };\r\n    }\r\n  }\r\n\r\n  private analyzeRoute() {\r\n    if (!this.router) {\r\n      return;\r\n    }\r\n\r\n    this.router.events\r\n      .pipe(filter((event) => event instanceof NavigationStart))\r\n      .subscribe((changeEvent: any) => {\r\n        if (changeEvent.url) {\r\n          const currentRoute = changeEvent.url;\r\n          const logoutRoute = this.options?.logoutRoute;\r\n          const loginRoute = this.options?.loginRoute;\r\n\r\n          this.isLogoutRoute = currentRoute === logoutRoute;\r\n          this.isLoginRoute = currentRoute === loginRoute;\r\n\r\n          if (this.isLogoutRoute) {\r\n            this.auth.logout();\r\n          }\r\n        }\r\n      });\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport {\r\n  HttpEvent,\r\n  HttpHandler,\r\n  HttpInterceptor,\r\n  HttpRequest\r\n} from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { TokenService } from './token.service';\r\nimport {\r\n  AuthByKeyOptions,\r\n  AuthOptions,\r\n  WithCredentialsOptions\r\n} from './auth.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthInterceptor implements HttpInterceptor {\r\n  private authOptions: AuthOptions;\r\n  private refreshInProgress = false;\r\n  private trustHosts: string[];\r\n  private hostsWithCredentials: WithCredentialsOptions[];\r\n  private hostsWithAuthByKey: AuthByKeyOptions[];\r\n\r\n  constructor(\r\n    private config: ConfigService,\r\n    private tokenService: TokenService,\r\n    private http: HttpClient\r\n  ) {\r\n    this.authOptions = this.config.getConfig('auth') as AuthOptions;\r\n\r\n    this.trustHosts = this.authOptions?.trustHosts || [];\r\n    this.trustHosts.push(window.location.hostname);\r\n\r\n    this.hostsWithCredentials = this.authOptions?.hostsWithCredentials || [];\r\n    this.hostsWithAuthByKey = this.authOptions?.hostsByKey || [];\r\n  }\r\n\r\n  intercept(\r\n    originalReq: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\r\n    let req = originalReq.clone();\r\n    const hostWithKey = this.handleHostsAuthByKey(originalReq.url);\r\n    if (hostWithKey) {\r\n      req = req.clone({\r\n        params: req.params.set(hostWithKey.key, hostWithKey.value)\r\n      });\r\n    }\r\n    if (withCredentials) {\r\n      req = originalReq.clone({\r\n        withCredentials\r\n      });\r\n      return next.handle(req);\r\n    }\r\n    this.refreshToken();\r\n    const token = this.tokenService.get();\r\n    const element = document.createElement('a');\r\n    element.href = req.url;\r\n    if (element.host === '') {\r\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\r\n    }\r\n\r\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\r\n      return next.handle(req);\r\n    }\r\n\r\n    const authHeader = `Bearer ${token}`;\r\n    let authReq = req.clone({\r\n      headers: req.headers.set('Authorization', authHeader)\r\n    });\r\n\r\n    const tokenDecoded: any = this.tokenService.decode();\r\n    if (\r\n      authReq.params.get('_i') === 'true' &&\r\n      tokenDecoded &&\r\n      tokenDecoded.user &&\r\n      tokenDecoded.user.sourceId\r\n    ) {\r\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\r\n      authReq = authReq.clone({\r\n        params: authReq.params.set('_i', hashUser)\r\n      });\r\n    } else if (authReq.params.get('_i') === 'true') {\r\n      authReq = authReq.clone({\r\n        params: authReq.params.delete('_i')\r\n      });\r\n    }\r\n\r\n    return next.handle(authReq);\r\n  }\r\n\r\n  interceptXhr(xhr, url: string): boolean {\r\n    const withCredentials = this.handleHostsWithCredentials(url);\r\n    if (withCredentials) {\r\n      xhr.withCredentials = withCredentials;\r\n      return true;\r\n    }\r\n\r\n    this.refreshToken();\r\n    const element = document.createElement('a');\r\n    element.href = url;\r\n\r\n    const token = this.tokenService.get();\r\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\r\n      return false;\r\n    }\r\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\r\n    return true;\r\n  }\r\n\r\n  alterUrlWithKeyAuth(url: string): string {\r\n    const hostWithKey = this.handleHostsAuthByKey(url);\r\n    let interceptedUrl = url;\r\n    if (hostWithKey) {\r\n      const urlDecomposed = interceptedUrl.split(/[?&]/);\r\n      let urlWithKeyAdded = urlDecomposed.shift();\r\n      const paramsToKeep = urlDecomposed.filter((p) => p.length !== 0);\r\n      paramsToKeep.push(`${hostWithKey.key}=${hostWithKey.value}`);\r\n      if (paramsToKeep.length) {\r\n        urlWithKeyAdded += '?' + paramsToKeep.join('&');\r\n      }\r\n      return urlWithKeyAdded;\r\n    }\r\n    return;\r\n  }\r\n\r\n  private handleHostsWithCredentials(reqUrl: string) {\r\n    let withCredentials = false;\r\n    for (const hostWithCredentials of this.hostsWithCredentials) {\r\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\r\n      if (domainRegex.test(reqUrl)) {\r\n        withCredentials =\r\n          hostWithCredentials.withCredentials !== undefined\r\n            ? hostWithCredentials.withCredentials\r\n            : undefined;\r\n        break;\r\n      }\r\n    }\r\n    return withCredentials;\r\n  }\r\n\r\n  private handleHostsAuthByKey(reqUrl: string): { key: string; value: string } {\r\n    let hostWithKey;\r\n    for (const hostWithAuthByKey of this.hostsWithAuthByKey) {\r\n      const domainRegex = new RegExp(hostWithAuthByKey.domainRegFilters);\r\n      if (domainRegex.test(reqUrl)) {\r\n        var replace = `${hostWithAuthByKey.keyProperty}=${hostWithAuthByKey.keyValue}`;\r\n        var keyAdded = new RegExp(replace, 'gm');\r\n        if (!keyAdded.test(reqUrl)) {\r\n          hostWithKey = {\r\n            key: hostWithAuthByKey.keyProperty,\r\n            value: hostWithAuthByKey.keyValue\r\n          };\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return hostWithKey;\r\n  }\r\n\r\n  refreshToken() {\r\n    const jwt = this.tokenService.decode();\r\n    const currentTime = new Date().getTime() / 1000;\r\n\r\n    if (\r\n      !this.refreshInProgress &&\r\n      jwt &&\r\n      currentTime < jwt.exp &&\r\n      currentTime > jwt.exp - 1800\r\n    ) {\r\n      this.refreshInProgress = true;\r\n\r\n      const url = this.authOptions?.url;\r\n      return this.http.post(`${url}/refresh`, {}).subscribe(\r\n        (data: any) => {\r\n          this.tokenService.set(data.token);\r\n          this.refreshInProgress = false;\r\n        },\r\n        (err) => {\r\n          err.error.caught = true;\r\n          return err;\r\n        }\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { ConfigService } from '@igo2/core';\r\n\r\nimport {\r\n  MSAL_GUARD_CONFIG,\r\n  MSAL_INSTANCE,\r\n  MsalService\r\n} from '@azure/msal-angular';\r\nimport { InteractionType, PublicClientApplication } from '@azure/msal-browser';\r\nimport { BrowserAuthOptions } from '@azure/msal-browser';\r\n\r\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\r\nimport {\r\n  AuthMicrosoftOptions,\r\n  MSPMsalGuardConfiguration\r\n} from './auth.interface';\r\n\r\nexport function MSALConfigFactory(\r\n  config: ConfigService\r\n): PublicClientApplication {\r\n  const msConf = config.getConfig('auth.microsoft') as AuthMicrosoftOptions;\r\n\r\n  msConf.redirectUri = msConf?.redirectUri || window.location.href;\r\n  msConf.authority =\r\n    msConf?.authority || 'https://login.microsoftonline.com/organizations';\r\n\r\n  const myMsalObj = new PublicClientApplication({\r\n    auth: msConf,\r\n    cache: {\r\n      cacheLocation: 'sessionStorage'\r\n    }\r\n  });\r\n\r\n  return myMsalObj;\r\n}\r\n\r\nexport function MSALConfigFactoryb2c(\r\n  config: ConfigService\r\n): PublicClientApplication {\r\n  const msConf = config.getConfig(\r\n    'auth.microsoftb2c.browserAuthOptions'\r\n  ) as BrowserAuthOptions;\r\n  msConf.redirectUri = msConf?.redirectUri || window.location.href;\r\n  msConf.authority =\r\n    msConf?.authority || 'https://login.microsoftonline.com/organizations';\r\n\r\n  const myMsalObj = new PublicClientApplication({\r\n    auth: msConf,\r\n    cache: {\r\n      cacheLocation: 'sessionStorage'\r\n    }\r\n  });\r\n\r\n  return myMsalObj;\r\n}\r\n\r\nexport function MSALAngularConfigFactory(\r\n  config: ConfigService\r\n): MSPMsalGuardConfiguration {\r\n  const msConf = config.getConfig('auth.microsoft') as AuthMicrosoftOptions;\r\n\r\n  return {\r\n    interactionType: InteractionType.Popup,\r\n    authRequest: {\r\n      scopes: ['user.read'],\r\n      loginHint: 'todo'\r\n    },\r\n    type: 'add'\r\n  };\r\n}\r\n\r\nexport function MSALAngularConfigFactoryb2c(\r\n  config: ConfigService\r\n): MSPMsalGuardConfiguration {\r\n  const msConf = config.getConfig(\r\n    'auth.microsoftb2c.browserAuthOptions'\r\n  ) as BrowserAuthOptions;\r\n\r\n  return {\r\n    interactionType: InteractionType.Popup,\r\n    authRequest: {\r\n      scopes: [msConf?.clientId]\r\n    },\r\n    type: 'b2c'\r\n  };\r\n}\r\n\r\nexport function provideAuthMicrosoft(type?: string) {\r\n  if (type === 'b2c') {\r\n    return [\r\n      {\r\n        provide: MSAL_INSTANCE,\r\n        useFactory: MSALConfigFactoryb2c,\r\n        deps: [ConfigService]\r\n      },\r\n      {\r\n        provide: MSAL_GUARD_CONFIG,\r\n        useFactory: MSALAngularConfigFactoryb2c,\r\n        deps: [ConfigService],\r\n        multi: true\r\n      },\r\n      MsalServiceb2c\r\n    ];\r\n  } else {\r\n    return [\r\n      {\r\n        provide: MSAL_INSTANCE,\r\n        useFactory: MSALConfigFactory,\r\n        deps: [ConfigService]\r\n      },\r\n      {\r\n        provide: MSAL_GUARD_CONFIG,\r\n        useFactory: MSALAngularConfigFactory,\r\n        deps: [ConfigService],\r\n        multi: true\r\n      },\r\n      MsalService\r\n    ];\r\n  }\r\n}\r\n","import { Directive, ElementRef } from '@angular/core';\r\n\r\nimport { AuthService } from './auth.service';\r\n\r\n@Directive({\r\n  selector: '[igoProtected]'\r\n})\r\nexport class ProtectedDirective {\r\n  constructor(authentication: AuthService, el: ElementRef) {\r\n    if (!authentication.isAuthenticated()) {\r\n      el.nativeElement.parentNode.removeChild(el.nativeElement);\r\n    }\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { BaseStorage, ConfigService, StorageScope } from '@igo2/core';\r\n\r\nimport { AuthService } from './auth.service';\r\nimport { AuthStorageOptions } from './storage.interface';\r\nimport { TokenService } from './token.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthStorageService extends BaseStorage<AuthStorageOptions> {\r\n  constructor(\r\n    config: ConfigService,\r\n    private http: HttpClient,\r\n    private authService: AuthService,\r\n    private tokenService: TokenService\r\n  ) {\r\n    super(config);\r\n\r\n    this.authService.authenticate$.subscribe((isAuthenticated) => {\r\n      if (isAuthenticated && this.options.url) {\r\n        this.http\r\n          .get(this.options.url)\r\n          .subscribe((userIgo: { preference: object }) => {\r\n            if (userIgo && userIgo.preference) {\r\n              for (const key of Object.keys(userIgo.preference)) {\r\n                const value = userIgo.preference[key];\r\n                super.set(key, value);\r\n              }\r\n            }\r\n          });\r\n      }\r\n    });\r\n  }\r\n\r\n  set(\r\n    key: string,\r\n    value: string | object | boolean | number,\r\n    scope: StorageScope = StorageScope.LOCAL\r\n  ) {\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      const preference = {};\r\n      preference[key] = value;\r\n      this.http.patch(this.options.url, { preference }).subscribe();\r\n    }\r\n    super.set(key, value, scope);\r\n  }\r\n\r\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      const preference = {};\r\n      preference[key] = undefined;\r\n      this.http.patch(this.options.url, { preference }).subscribe();\r\n    }\r\n    super.remove(key, scope);\r\n  }\r\n\r\n  clear(scope: StorageScope = StorageScope.LOCAL) {\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      this.http\r\n        .patch(\r\n          this.options.url,\r\n          { preference: {} },\r\n          {\r\n            params: {\r\n              mergePreference: 'false'\r\n            }\r\n          }\r\n        )\r\n        .subscribe();\r\n    }\r\n\r\n    let token: string;\r\n    if (scope === StorageScope.LOCAL) {\r\n      token = this.tokenService.get();\r\n    }\r\n\r\n    super.clear(scope);\r\n\r\n    if (token) {\r\n      this.tokenService.set(token);\r\n    }\r\n\r\n    if (\r\n      scope === StorageScope.LOCAL &&\r\n      this.authService.authenticated &&\r\n      this.options.url\r\n    ) {\r\n      this.http\r\n        .get(this.options.url)\r\n        .subscribe((userIgo: { preference: object }) => {\r\n          if (userIgo && userIgo.preference) {\r\n            for (const key of Object.keys(userIgo.preference)) {\r\n              const value = userIgo.preference[key];\r\n              super.set(key, value);\r\n            }\r\n          }\r\n        });\r\n    }\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\n\r\nimport { IgoLanguageModule, StorageService } from '@igo2/core';\r\n\r\nimport { MsalModule } from '@azure/msal-angular';\r\n\r\nimport { AuthFacebookComponent } from './auth-form/auth-facebook.component';\r\nimport { AuthFormComponent } from './auth-form/auth-form.component';\r\nimport { AuthGoogleComponent } from './auth-form/auth-google.component';\r\nimport { AuthInternComponent } from './auth-form/auth-intern.component';\r\nimport { AuthMicrosoftComponent } from './auth-form/auth-microsoft.component';\r\nimport { AuthMicrosoftb2cComponent } from './auth-form/auth-microsoftb2c.component';\r\nimport { provideAuthMicrosoft } from './shared/auth-microsoft.provider';\r\nimport { AuthInterceptor } from './shared/auth.interceptor';\r\nimport { ProtectedDirective } from './shared/protected.directive';\r\nimport { AuthStorageService } from './shared/storage.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule,\r\n    MsalModule\r\n  ],\r\n  declarations: [\r\n    AuthFormComponent,\r\n    AuthGoogleComponent,\r\n    AuthInternComponent,\r\n    AuthFacebookComponent,\r\n    AuthMicrosoftComponent,\r\n    AuthMicrosoftb2cComponent,\r\n    ProtectedDirective\r\n  ],\r\n  exports: [AuthFormComponent, ProtectedDirective]\r\n})\r\nexport class IgoAuthModule {\r\n  static forRoot(): ModuleWithProviders<IgoAuthModule> {\r\n    return {\r\n      ngModule: IgoAuthModule,\r\n      providers: [\r\n        {\r\n          provide: HTTP_INTERCEPTORS,\r\n          useClass: AuthInterceptor,\r\n          multi: true\r\n        },\r\n        {\r\n          provide: StorageService,\r\n          useClass: AuthStorageService\r\n        },\r\n        ...provideAuthMicrosoft('add'),\r\n        ...provideAuthMicrosoft('b2c')\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { DocViewerComponent } from './doc-viewer.component';\r\n\r\n@NgModule({\r\n  declarations: [DocViewerComponent],\r\n  exports: [DocViewerComponent],\r\n  imports: [CommonModule, MatCardModule]\r\n})\r\nexport class DocViewerModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { ExampleSeeCodeComponent } from './example-see-code/example-see-code.component';\r\nimport { ExampleViewerComponent } from './example-viewer/example-viewer.component';\r\n\r\n@NgModule({\r\n  declarations: [ExampleViewerComponent, ExampleSeeCodeComponent],\r\n  exports: [ExampleViewerComponent],\r\n  imports: [\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    MatDividerModule,\r\n    MatIconModule,\r\n    MatTooltipModule\r\n  ]\r\n})\r\nexport class ExampleModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatGridListModule } from '@angular/material/grid-list';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { DocViewerModule } from '../components/doc-viewer/doc-viewer.module';\r\nimport { ExampleModule } from '../components/example/example.module';\r\n\r\n@NgModule({\r\n  declarations: [],\r\n  exports: [\r\n    CommonModule,\r\n    ExampleModule,\r\n    DocViewerModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatGridListModule,\r\n    MatIconModule,\r\n    MatInputModule,\r\n    MatTooltipModule\r\n  ],\r\n  imports: [CommonModule]\r\n})\r\nexport class SharedModule {}\r\n","<mat-card appearance=\"outlined\">\n  <mat-card-header>\n    <mat-card-subtitle>\n      {{ title }}\n    </mat-card-subtitle>\n    <div class=\"actions\">\n      <a\n        *ngIf=\"codeFolder\"\n        mat-icon-button\n        [href]=\"codeUrl\"\n        target=\"_blank\"\n        matTooltip=\"View code example\"\n      >\n        <mat-icon svgIcon=\"code-tags\"></mat-icon>\n      </a>\n      <a\n        *ngIf=\"configFolder\"\n        mat-icon-button\n        [href]=\"configUrl\"\n        target=\"_blank\"\n        matTooltip=\"View config example\"\n      >\n        <mat-icon svgIcon=\"cog\"></mat-icon>\n      </a>\n    </div>\n  </mat-card-header>\n\n  <mat-divider class=\"m-b-16\"></mat-divider>\n\n  <mat-card-content class=\"mat-body-1\">\n    <ng-content></ng-content>\n  </mat-card-content>\n</mat-card>\n","import { Component, Input } from '@angular/core';\n\nconst SRC_PATH =\n  'https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src';\n\n@Component({\n  selector: 'app-example-viewer',\n  templateUrl: './example-viewer.component.html',\n  styleUrls: ['./example-viewer.component.scss']\n})\nexport class ExampleViewerComponent {\n  @Input() title: string;\n  @Input() codeFolder: string;\n  @Input() configFolder: string;\n\n  get codeUrl() {\n    return `${SRC_PATH}/app/${this.codeFolder}`;\n  }\n\n  get configUrl() {\n    return `${SRC_PATH}/${this.configFolder}`;\n  }\n}\n","<h6 class=\"mat-subtitle-2 m-b-0\">{{ subtitle }}</h6>\n<h2>{{ title }}</h2>\n\n<div class=\"mat-body-1\">\n  <ng-container *ngIf=\"dependencies?.length\">\n    <label for=\"\">Dependencies:</label>\n    <ul>\n      <li *ngFor=\"let dep of dependencies\">{{ dep }}</li>\n    </ul>\n  </ng-container>\n  <ng-content></ng-content>\n</div>\n<!-- <mat-card appearance=\"outlined\">\n  <mat-card-header>\n    <mat-card-subtitle>{{subtitle}}</mat-card-subtitle>\n    <mat-card-title>{{title}}</mat-card-title>\n  </mat-card-header>\n  <mat-card-content>\n    <ng-container *ngIf=\"dependencies?.length\">\n        <label for=\"\">Dependencies:</label>\n        <ul>\n            <li *ngFor=\"let dep of dependencies\">{{dep}}</li>\n        </ul>\n        <br />\n    </ng-container>\n    <ng-content></ng-content>\n  </mat-card-content>\n</mat-card> -->\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'app-doc-viewer',\n  templateUrl: './doc-viewer.component.html',\n  styleUrls: ['./doc-viewer.component.scss']\n})\nexport class DocViewerComponent {\n  @Input() title: string;\n  @Input() subtitle: string;\n  @Input() dependencies: string[];\n}\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppAuthFormComponent } from './auth-form.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'auth-form',\r\n    component: AppAuthFormComponent\r\n  }\r\n];\r\n\r\nexport const AppAuthFormRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss']\n})\nexport class AppAuthFormComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private languageService: LanguageService) {}\n}\n","<app-doc-viewer\n  title=\"Authentification\"\n  subtitle=\"Auth\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"auth/auth-form\" configFolder=\"environments\">\n    The dialog opens automatically if you are not logged in\n  </app-example-viewer>\n</app-doc-viewer>\n<igo-auth-form></igo-auth-form>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoAuthModule } from '@igo2/auth';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppAuthFormRoutingModule } from './auth-form-routing.module';\r\nimport { AppAuthFormComponent } from './auth-form.component';\r\n\r\n@NgModule({\r\n  declarations: [AppAuthFormComponent],\r\n  imports: [AppAuthFormRoutingModule, SharedModule, IgoAuthModule.forRoot()],\r\n  exports: [AppAuthFormComponent]\r\n})\r\nexport class AppAuthFormModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { ActionbarItemComponent } from './actionbar-item.component';\r\nimport { ActionbarComponent } from './actionbar.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoLanguageModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatMenuModule,\r\n    MatListModule,\r\n    MatCardModule,\r\n    MatCheckboxModule\r\n  ],\r\n  exports: [ActionbarComponent],\r\n  declarations: [ActionbarComponent, ActionbarItemComponent]\r\n})\r\nexport class IgoActionbarModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoActionbarModule } from './actionbar/actionbar.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, IgoActionbarModule],\r\n  exports: [IgoActionbarModule],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoActionModule {}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoBadgeIconDirective } from './badge-icon.directive';\r\n\r\n@NgModule({\r\n  imports: [MatBadgeModule, MatIconModule],\r\n  declarations: [IgoBadgeIconDirective],\r\n  exports: [MatBadgeModule, IgoBadgeIconDirective]\r\n})\r\nexport class IgoMatBadgeIconModule {\r\n  static forRoot(): ModuleWithProviders<IgoMatBadgeIconModule> {\r\n    return {\r\n      ngModule: IgoMatBadgeIconModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\n\r\nimport { CollapseDirective } from './collapse.directive';\r\nimport { CollapsibleComponent } from './collapsible.component';\r\n\r\n@NgModule({\r\n  imports: [MatIconModule, MatListModule],\r\n  declarations: [CollapsibleComponent, CollapseDirective],\r\n  exports: [CollapsibleComponent, CollapseDirective]\r\n})\r\nexport class IgoCollapsibleModule {\r\n  static forRoot(): ModuleWithProviders<IgoCollapsibleModule> {\r\n    return {\r\n      ngModule: IgoCollapsibleModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-confirm-dialog',\n  templateUrl: './confirm-dialog.component.html',\n  styleUrls: ['./confirm-dialog.component.scss']\n})\nexport class ConfirmDialogComponent {\n  public confirmMessage: string;\n\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\n}\n","<h2 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.common.confirmDialog.title' | translate }}\n</h2>\n<div mat-dialog-content class=\"mat-typography\">{{ confirmMessage }}</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(true)\">\n    {{ 'igo.common.confirmDialog.confirmBtn' | translate }}\n  </button>\n  <button mat-button (click)=\"dialogRef.close(false)\">\n    {{ 'igo.common.confirmDialog.cancelBtn' | translate }}\n  </button>\n</div>\n","import { Injectable } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\r\n\r\n@Injectable()\r\nexport class ConfirmDialogService {\r\n  constructor(\r\n    private dialog: MatDialog,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  public open(message: string): Observable<any> {\r\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\r\n      disableClose: false\r\n    });\r\n    dialogRef.componentInstance.confirmMessage =\r\n      this.languageService.translate.instant(message);\r\n\r\n    return dialogRef.afterClosed();\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\r\nimport { ConfirmDialogService } from './confirm-dialog.service';\r\n\r\n@NgModule({\r\n  imports: [MatButtonModule, MatDialogModule, IgoLanguageModule],\r\n  declarations: [ConfirmDialogComponent],\r\n  exports: [ConfirmDialogComponent],\r\n  providers: [ConfirmDialogService]\r\n})\r\nexport class IgoConfirmDialogModule {\r\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\r\n    return {\r\n      ngModule: IgoConfirmDialogModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { ContextMenuDirective } from './context-menu.directive';\r\nimport { LongPressDirective } from './long-press.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [ContextMenuDirective, LongPressDirective],\r\n  exports: [ContextMenuDirective, LongPressDirective]\r\n})\r\nexport class IgoContextMenuModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextMenuModule> {\r\n    return {\r\n      ngModule: IgoContextMenuModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { CustomHtmlComponent } from './custom-html.component';\r\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatInputModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [SanitizeHtmlPipe, CustomHtmlComponent],\r\n  declarations: [SanitizeHtmlPipe, CustomHtmlComponent]\r\n})\r\nexport class IgoCustomHtmlModule {\r\n  static forRoot(): ModuleWithProviders<IgoCustomHtmlModule> {\r\n    return {\r\n      ngModule: IgoCustomHtmlModule\r\n    };\r\n  }\r\n}\r\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { throwError } from 'rxjs';\r\nimport { catchError, map } from 'rxjs/operators';\r\n\r\nimport { DOMOptions, DOMValue } from './dom.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DOMService {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  async getDom(dom: DOMOptions): Promise<DOMValue[]> {\r\n    const url = dom.url;\r\n    let result: DOMValue[];\r\n\r\n    await this.http\r\n      .get<any>(url)\r\n      .pipe(\r\n        map((response) => {\r\n          result = response;\r\n          return response;\r\n        }),\r\n        catchError((err: HttpErrorResponse) => {\r\n          return throwError(err);\r\n        })\r\n      )\r\n      .toPromise();\r\n\r\n    return result;\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { DOMService } from './dom.service';\n\n@NgModule({\n  providers: [DOMService]\n})\nexport class IgoDOMModule {\n  static forRoot(): ModuleWithProviders<IgoDOMModule> {\n    return {\n      ngModule: IgoDOMModule,\n      providers: [DOMService]\n    };\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { DragAndDropDirective } from './drag-drop.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [DragAndDropDirective],\r\n  exports: [DragAndDropDirective]\r\n})\r\nexport class IgoDrapDropModule {\r\n  static forRoot(): ModuleWithProviders<IgoDrapDropModule> {\r\n    return {\r\n      ngModule: IgoDrapDropModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { DynamicOutletComponent } from './dynamic-outlet.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [DynamicOutletComponent],\r\n  declarations: [DynamicOutletComponent]\r\n})\r\nexport class IgoDynamicOutletModule {}\r\n","import {\n  ComponentFactory,\n  ComponentRef,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { Observable, Subscription } from 'rxjs';\n\n/**\n * This class is used in the DynamicComponentOutlet component. It holds\n * a reference to a component factory and can render that component\n * in a target element on demand. It's also possible to set inputs\n * and to subscribe to outputs.\n */\nexport class DynamicComponent<C> {\n  /**\n   * Component reference\n   */\n  private componentRef: ComponentRef<C>;\n\n  /**\n   * Subscriptions to the component's outputs. Those need\n   * to be unsubscribed when the component is destroyed.\n   */\n  private subscriptions: Subscription[] = [];\n\n  /**\n   * Component target element\n   */\n  private target: ViewContainerRef;\n\n  /**\n   * Component inputs\n   */\n  private inputs: { [key: string]: any } = {};\n\n  /**\n   * Subscriptions to the component's async inputs\n   */\n  private inputs$$: { [key: string]: Subscription } = {};\n\n  /**\n   * Subscribers to the component's outputs\n   */\n  private subscribers: { [key: string]: (event: any) => void } = {};\n\n  constructor(private componentFactory: ComponentFactory<C>) {}\n\n  /**\n   * Render the component to a target element.\n   * Set it's inputs and subscribe to it's outputs.\n   * @param target Target element\n   */\n  setTarget(target: ViewContainerRef) {\n    this.target = target;\n    this.componentRef = target.createComponent(this.componentFactory);\n    this.updateInputs(this.inputs);\n    this.updateSubscribers(this.subscribers);\n  }\n\n  /**\n   * Destroy this component. That means, removing from it's target\n   * element and unsubscribing to it's outputs.\n   */\n  destroy() {\n    if (this.target !== undefined) {\n      this.target.clear();\n    }\n    if (this.componentRef !== undefined) {\n      this.componentRef.destroy();\n      this.componentRef = undefined;\n    }\n    this.unobserveAllInputs();\n    this.unsubscribeAll();\n  }\n\n  /**\n   * Update the component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateInputs(inputs: { [key: string]: any }) {\n    this.inputs = inputs;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedInputs = this.componentFactory.inputs;\n    allowedInputs.forEach(\n      (value: { propName: string; templateName: string }) => {\n        const key = value.propName;\n\n        this.unobserveInput(key);\n\n        const inputValue = inputs[key];\n        if (inputs.hasOwnProperty(key)) {\n          if (inputValue instanceof Observable) {\n            this.observeInput(key, inputValue);\n          } else {\n            this.setInputValue(instance, key, inputValue);\n          }\n        }\n      }\n    );\n\n    if (typeof (instance as any).onUpdateInputs === 'function') {\n      (instance as any).onUpdateInputs();\n    }\n  }\n\n  /**\n   * Set an instance's input value\n   * @param instance Component instance\n   * @param key Input key\n   * @param value Input value\n   */\n  private setInputValue(instance: C, key: string, value: any) {\n    const currentValue = instance[key];\n    if (value === currentValue) {\n      return;\n    }\n\n    const prototype = Object.getPrototypeOf(instance);\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\n    if (descriptor !== undefined && descriptor.set !== undefined) {\n      descriptor.set.call(instance, value);\n    } else {\n      instance[key] = value;\n    }\n  }\n\n  /**\n   * Update the component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateSubscribers(subscribers: { [key: string]: (event: any) => void }) {\n    this.subscribers = subscribers;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedSubscribers = this.componentFactory.outputs;\n    allowedSubscribers.forEach(\n      (value: { propName: string; templateName: string }) => {\n        const key = value.propName;\n        if (subscribers.hasOwnProperty(key)) {\n          const emitter = instance[key];\n          const subscriber = subscribers[key];\n          if (Array.isArray(subscriber)) {\n            subscriber.forEach((_subscriber) => {\n              this.subscriptions.push(emitter.subscribe(_subscriber));\n            });\n          } else {\n            this.subscriptions.push(emitter.subscribe(subscriber));\n          }\n        }\n      }\n    );\n  }\n\n  /**\n   * Subscribe to an observable input and update the component's input value\n   * accordingly\n   * @param key Input key\n   * @param observable Observable\n   */\n  private observeInput(key: string, observable: Observable<any>) {\n    this.inputs$$[key] = observable.subscribe((value: any) => {\n      const instance = this.componentRef.instance;\n      this.setInputValue(instance, key, value);\n\n      if (typeof (instance as any).onUpdateInputs === 'function') {\n        (instance as any).onUpdateInputs();\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to an observable input\n   * @param key Input key\n   */\n  private unobserveInput(key: string) {\n    if (this.inputs$$[key] !== undefined) {\n      this.inputs$$[key].unsubscribe();\n      this.inputs$$[key] = undefined;\n    }\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unobserveAllInputs() {\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\n      if (s !== undefined) {\n        s.unsubscribe();\n      }\n    });\n    this.inputs$$ = {};\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unsubscribeAll() {\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\n    this.subscriptions = [];\n  }\n}\n","import { ComponentFactoryResolver, Injectable } from '@angular/core';\n\nimport { DynamicComponent } from './dynamic-component';\n\n/**\n * Service to creates DynamicComponent instances from base component classes\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DynamicComponentService {\n  constructor(private resolver: ComponentFactoryResolver) {}\n\n  /**\n   * Creates a DynamicComponent instance from a base component class\n   * @param componentCls The component class\n   * @returns DynamicComponent instance\n   */\n  create(componentCls: any): DynamicComponent<any> {\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\n    return new DynamicComponent<typeof componentCls>(factory);\n  }\n}\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoDynamicOutletModule } from './dynamic-outlet/dynamic-outlet.module';\r\nimport { DynamicComponentService } from './shared/dynamic-component.service';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, IgoDynamicOutletModule],\r\n  exports: [IgoDynamicOutletModule],\r\n  providers: [DynamicComponentService]\r\n})\r\nexport class IgoDynamicComponentModule {}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { FlexibleComponent } from './flexible.component';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [FlexibleComponent],\r\n  exports: [FlexibleComponent]\r\n})\r\nexport class IgoFlexibleModule {\r\n  static forRoot(): ModuleWithProviders<IgoFlexibleModule> {\r\n    return {\r\n      ngModule: IgoFlexibleModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoDynamicOutletModule } from '../../dynamic-component/dynamic-outlet/dynamic-outlet.module';\r\nimport { FormFieldSelectComponent } from './form-field-select.component';\r\nimport { FormFieldTextComponent } from './form-field-text.component';\r\nimport { FormFieldTextareaComponent } from './form-field-textarea.component';\r\nimport { FormFieldComponent } from './form-field.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    IgoLanguageModule,\r\n    IgoDynamicOutletModule\r\n  ],\r\n  exports: [\r\n    FormFieldComponent,\r\n    FormFieldSelectComponent,\r\n    FormFieldTextComponent,\r\n    FormFieldTextareaComponent\r\n  ],\r\n  declarations: [\r\n    FormFieldComponent,\r\n    FormFieldSelectComponent,\r\n    FormFieldTextComponent,\r\n    FormFieldTextareaComponent\r\n  ]\r\n})\r\nexport class IgoFormFieldModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoFormFieldModule } from '../form-field/form-field.module';\r\nimport { FormGroupComponent } from './form-group.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatFormFieldModule,\r\n    IgoLanguageModule,\r\n    IgoFormFieldModule\r\n  ],\r\n  exports: [FormGroupComponent],\r\n  declarations: [FormGroupComponent]\r\n})\r\nexport class IgoFormGroupModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { FormComponent } from './form.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, FormsModule, ReactiveFormsModule],\r\n  exports: [FormComponent, FormsModule, ReactiveFormsModule],\r\n  declarations: [FormComponent]\r\n})\r\nexport class IgoFormFormModule {}\r\n","import { Injectable } from '@angular/core';\n\n/**\n * Service where all available form fields are registered.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormFieldService {\n  static fields: { [key: string]: any } = {};\n\n  static register(type: string, component: any) {\n    FormFieldService.fields[type] = component;\n  }\n\n  constructor() {}\n\n  /**\n   * Return field component by type\n   * @param type Field type\n   * @returns Field component\n   */\n  getFieldByType(type: string): any {\n    return FormFieldService.fields[type];\n  }\n}\n","import { Injectable } from '@angular/core';\r\nimport { UntypedFormBuilder, ValidatorFn, Validators } from '@angular/forms';\r\n\r\nimport {\r\n  Form,\r\n  FormField,\r\n  FormFieldConfig,\r\n  FormFieldGroup,\r\n  FormFieldGroupConfig\r\n} from './form.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FormService {\r\n  constructor(private formBuilder: UntypedFormBuilder) {}\r\n\r\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\r\n    const control = this.formBuilder.group({});\r\n    fields.forEach((field: FormField) => {\r\n      control.addControl(field.name, field.control);\r\n    });\r\n    groups.forEach((group: FormFieldGroup) => {\r\n      control.addControl(group.name, group.control);\r\n    });\r\n\r\n    return { fields, groups, control };\r\n  }\r\n\r\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\r\n    const options = config.options || {};\r\n    const control = this.formBuilder.group({});\r\n    fields.forEach((field: FormField) => {\r\n      control.addControl(field.name, field.control);\r\n    });\r\n\r\n    if (options.validator) {\r\n      const validators = this.getValidators(options.validator); // convert string to actual validator\r\n      control.setValidators(validators);\r\n    }\r\n\r\n    return Object.assign({}, config, { fields, control }) as FormFieldGroup;\r\n  }\r\n\r\n  field(config: FormFieldConfig): FormField {\r\n    const options = config.options || {};\r\n    const state = {\r\n      value: '',\r\n      disabled: options.disabled\r\n    };\r\n    const control = this.formBuilder.control(state);\r\n\r\n    if (options.validator) {\r\n      const validators = this.getValidators(options.validator); // convert string to actual validator\r\n      control.setValidators(validators);\r\n    }\r\n\r\n    return Object.assign({ type: 'text' }, config, { control }) as FormField;\r\n  }\r\n\r\n  extendFieldConfig(\r\n    config: FormFieldConfig,\r\n    partial: Partial<FormFieldConfig>\r\n  ): FormFieldConfig {\r\n    const options = Object.assign(\r\n      {},\r\n      config.options || {},\r\n      partial.options || {}\r\n    );\r\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\r\n    const subscribers = Object.assign(\r\n      {},\r\n      config.subscribers || {},\r\n      partial.subscribers || {}\r\n    );\r\n    return Object.assign({}, config, { options, inputs, subscribers });\r\n  }\r\n\r\n  private getValidators(\r\n    validatorOption: string | string[] | ValidatorFn\r\n  ): ValidatorFn | ValidatorFn[] {\r\n    if (Array.isArray(validatorOption)) {\r\n      return validatorOption.map((validatorStr) => {\r\n        return this.getValidator(validatorStr);\r\n      });\r\n    }\r\n\r\n    return this.getValidator(validatorOption);\r\n  }\r\n\r\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\r\n    if (typeof validatorStr !== 'string') {\r\n      return validatorStr;\r\n    }\r\n\r\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\r\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\r\n    const match = validatorStr.match(re);\r\n\r\n    if (!match) {\r\n      return Validators[validatorStr];\r\n    }\r\n\r\n    const name = match[1];\r\n    const args = match[2];\r\n    return Validators[name](args);\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoFormFieldModule } from './form-field/form-field.module';\r\nimport { IgoFormGroupModule } from './form-group/form-group.module';\r\nimport { IgoFormFormModule } from './form/form.module';\r\nimport { FormFieldService } from './shared/form-field.service';\r\nimport { FormService } from './shared/form.service';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoFormGroupModule, IgoFormFieldModule],\r\n  exports: [IgoFormFormModule, IgoFormGroupModule, IgoFormFieldModule],\r\n  declarations: [],\r\n  providers: [FormService, FormFieldService]\r\n})\r\nexport class IgoFormModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatSelectModule } from '@angular/material/select';\r\n\r\nimport { EntitySelectorComponent } from './entity-selector.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, FormsModule, MatSelectModule],\r\n  exports: [EntitySelectorComponent],\r\n  declarations: [EntitySelectorComponent]\r\n})\r\nexport class IgoEntitySelectorModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { MatPaginatorModule } from '@angular/material/paginator';\r\n\r\nimport { EntityTablePaginatorComponent } from './entity-table-paginator.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [MatPaginatorModule],\r\n  exports: [EntityTablePaginatorComponent],\r\n  declarations: [EntityTablePaginatorComponent]\r\n})\r\nexport class IgoEntityTablePaginatorModule {}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { ImageErrorDirective } from './image-error.directive';\r\nimport { SecureImagePipe } from './secure-image.pipe';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [SecureImagePipe, ImageErrorDirective],\r\n  exports: [SecureImagePipe, ImageErrorDirective]\r\n})\r\nexport class IgoImageModule {\r\n  static forRoot(): ModuleWithProviders<IgoImageModule> {\r\n    return {\r\n      ngModule: IgoImageModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { StopDropPropagationDirective } from './stop-drop-propagation.directive';\r\nimport { StopPropagationDirective } from './stop-propagation.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [StopDropPropagationDirective, StopPropagationDirective],\r\n  exports: [StopDropPropagationDirective, StopPropagationDirective]\r\n})\r\nexport class IgoStopPropagationModule {\r\n  static forRoot(): ModuleWithProviders<IgoStopPropagationModule> {\r\n    return {\r\n      ngModule: IgoStopPropagationModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDatepickerModule } from '@angular/material/datepicker';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatPaginatorModule } from '@angular/material/paginator';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSortModule } from '@angular/material/sort';\r\nimport { MatTableModule } from '@angular/material/table';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoCustomHtmlModule } from '../../custom-html/custom-html.module';\r\nimport { IgoImageModule } from '../../image/image.module';\r\nimport { IgoStopPropagationModule } from '../../stop-propagation/stop-propagation.module';\r\nimport { IgoEntityTablePaginatorModule } from '../entity-table-paginator/entity-table-paginator.module';\r\nimport { EntityTableRowDirective } from './entity-table-row.directive';\r\nimport { EntityTableComponent } from './entity-table.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatTableModule,\r\n    MatAutocompleteModule,\r\n    MatSortModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatCheckboxModule,\r\n    MatPaginatorModule,\r\n    MatSelectModule,\r\n    IgoStopPropagationModule,\r\n    IgoCustomHtmlModule,\r\n    IgoEntityTablePaginatorModule,\r\n    IgoImageModule,\r\n    IgoLanguageModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatInputModule,\r\n    MatDatepickerModule,\r\n    MatTooltipModule\r\n  ],\r\n  exports: [EntityTableComponent],\r\n  declarations: [EntityTableComponent, EntityTableRowDirective]\r\n})\r\nexport class IgoEntityTableModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoEntitySelectorModule } from './entity-selector/entity-selector.module';\r\nimport { IgoEntityTablePaginatorModule } from './entity-table-paginator/entity-table-paginator.module';\r\nimport { IgoEntityTableModule } from './entity-table/entity-table.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [\r\n    IgoEntitySelectorModule,\r\n    IgoEntityTableModule,\r\n    IgoEntityTablePaginatorModule\r\n  ],\r\n  declarations: []\r\n})\r\nexport class IgoEntityModule {}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport { InteractiveTourOptions } from './interactive-tour.interface';\r\n\r\n@Injectable()\r\nexport class InteractiveTourLoader {\r\n  private jsonURL: string;\r\n  private allToursOptions;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private configService: ConfigService\r\n  ) {\r\n    this.jsonURL = this.getPathToConfigFile();\r\n  }\r\n\r\n  public loadConfigTour() {\r\n    this.getJSON().subscribe(\r\n      (data) => {\r\n        this.allToursOptions = data;\r\n      },\r\n      (err) => {\r\n        throw new Error(\r\n          `Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.`\r\n        );\r\n      }\r\n    );\r\n  }\r\n\r\n  public getPathToConfigFile(): string {\r\n    return (\r\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\r\n      './config/interactiveTour.json'\r\n    );\r\n  }\r\n\r\n  public getJSON(): Observable<any> {\r\n    return this.http.get(this.jsonURL).pipe(\r\n      catchError((e) => {\r\n        e.error.caught = true;\r\n        throw e;\r\n      })\r\n    );\r\n  }\r\n\r\n  public getTourOptionData(toolName): InteractiveTourOptions {\r\n    if (this.allToursOptions === undefined) {\r\n      return undefined;\r\n    }\r\n    let nameInConfigFile = toolName;\r\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\r\n    return this.allToursOptions[nameInConfigFile];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService, LanguageService, MediaService } from '@igo2/core';\r\n\r\nimport { offset } from '@floating-ui/dom';\r\nimport { ShepherdService } from 'angular-shepherd';\r\nimport Shepherd from 'shepherd.js';\r\n\r\nimport {\r\n  InteractiveTourAction,\r\n  InteractiveTourOptions,\r\n  InteractiveTourStep\r\n} from './interactive-tour.interface';\r\nimport { InteractiveTourLoader } from './interactive-tour.loader';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class InteractiveTourService {\r\n  private previousStep: InteractiveTourStep;\r\n  private nextIndex = 1;\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    private mediaService: MediaService,\r\n    private languageService: LanguageService,\r\n    private interactiveTourLoader: InteractiveTourLoader,\r\n    private shepherdService: ShepherdService\r\n  ) {\r\n    if (this.isAppHaveTour()) {\r\n      this.interactiveTourLoader.loadConfigTour();\r\n    }\r\n  }\r\n\r\n  public isAppHaveTour() {\r\n    const haveTour = this.configService.getConfig(\r\n      'interactiveTour.activateInteractiveTour'\r\n    );\r\n    if (haveTour === undefined) {\r\n      return true;\r\n    } else {\r\n      return haveTour;\r\n    }\r\n  }\r\n\r\n  public isToolHaveTourConfig(toolName: string): boolean {\r\n    const checkTourActiveOptions =\r\n      this.interactiveTourLoader.getTourOptionData(toolName);\r\n    if (checkTourActiveOptions === undefined) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  public disabledTourButton(toolName: string): boolean {\r\n    const stepConfig: InteractiveTourOptions =\r\n      this.interactiveTourLoader.getTourOptionData(toolName);\r\n\r\n    if (stepConfig?.conditions) {\r\n      for (const condition of stepConfig?.conditions) {\r\n        if (document.querySelector(condition) === null) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public isMobile(): boolean {\r\n    return this.mediaService.isMobile();\r\n  }\r\n\r\n  public isTourDisplayInMobile(): boolean {\r\n    const showInMobile = this.configService.getConfig(\r\n      'interactiveTour.tourInMobile'\r\n    );\r\n\r\n    return showInMobile === undefined ? true : showInMobile;\r\n  }\r\n\r\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\r\n    if (buttonKind === 'noBackButton') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.nextButton'\r\n          ),\r\n          type: 'next'\r\n        }\r\n      ];\r\n    }\r\n    if (buttonKind === 'first') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-secondary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.exitButton'\r\n          ),\r\n          type: 'cancel'\r\n        },\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.nextButton'\r\n          ),\r\n          type: 'next'\r\n        }\r\n      ];\r\n    }\r\n\r\n    if (buttonKind === 'last') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-secondary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.backButton'\r\n          ),\r\n          type: 'back'\r\n        },\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.exitButton'\r\n          ),\r\n          type: 'cancel'\r\n        }\r\n      ];\r\n    }\r\n\r\n    return [\r\n      {\r\n        classes: 'shepherd-button-secondary',\r\n        text: this.languageService.translate.instant(\r\n          'igo.common.interactiveTour.backButton'\r\n        ),\r\n        type: 'back'\r\n      },\r\n      {\r\n        classes: 'shepherd-button-primary',\r\n        text: this.languageService.translate.instant(\r\n          'igo.common.interactiveTour.nextButton'\r\n        ),\r\n        type: 'next'\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getAction(actionName: string) {\r\n    const action = {\r\n      click: 'click'\r\n    };\r\n    return action[actionName.toLowerCase()];\r\n  }\r\n\r\n  private addProgress() {\r\n    const self = this as any;\r\n    let nbTry = 0;\r\n    const maxTry = 21;\r\n    const checkExist = setInterval(() => {\r\n      if (self.getCurrentStep()) {\r\n        if (\r\n          self.getCurrentStep().options.attachTo.element &&\r\n          !document.querySelector(\r\n            self.getCurrentStep().options.attachTo.element\r\n          )\r\n        ) {\r\n          self.cancel();\r\n          clearInterval(checkExist);\r\n          return;\r\n        } else {\r\n          const currentStepElement = self.getCurrentStep().getElement();\r\n          if (currentStepElement) {\r\n            const shepherdList = currentStepElement.querySelectorAll(\r\n              '.shepherd-content, .shepherd-text'\r\n            );\r\n            shepherdList.forEach((element) => {\r\n              element.classList.add('mat-typography');\r\n            });\r\n          }\r\n          const header = currentStepElement\r\n            ? currentStepElement.querySelector('.shepherd-header')\r\n            : undefined;\r\n\r\n          nbTry++;\r\n          if (header || nbTry > maxTry) {\r\n            clearInterval(checkExist);\r\n          }\r\n\r\n          if (header) {\r\n            const stepsArray = self.steps;\r\n            const progress = document.createElement('span');\r\n            progress.className = 'shepherd-progress';\r\n            progress.innerText = `${\r\n              stepsArray.indexOf(self.getCurrentStep()) + 1\r\n            }/${stepsArray.length}`;\r\n            header.insertBefore(\r\n              progress,\r\n              currentStepElement.querySelector('.shepherd-cancel-icon')\r\n            );\r\n          }\r\n        }\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  private checkNext(index, tour, service) {\r\n    if (tour.getCurrentStep()) {\r\n      if (\r\n        tour.getCurrentStep().options.attachTo.element &&\r\n        document.querySelector(tour.getCurrentStep().options.attachTo.element)\r\n      ) {\r\n        tour.complete();\r\n        return;\r\n      }\r\n\r\n      if (index.index === tour.steps.length - 1) {\r\n        tour.complete();\r\n        return;\r\n      }\r\n\r\n      tour.steps.splice(index.index, 1);\r\n      const nextStep = tour.steps[index.index];\r\n      if (\r\n        nextStep.options.attachTo.element &&\r\n        !document.querySelector(nextStep.options.attachTo.element)\r\n      ) {\r\n        service.checkNext(index, tour, service);\r\n      } else {\r\n        tour._setupModal();\r\n        tour.show(nextStep.id);\r\n      }\r\n    }\r\n  }\r\n\r\n  private executeAction(\r\n    step: InteractiveTourStep,\r\n    actionConfig: InteractiveTourAction\r\n  ) {\r\n    if (!actionConfig) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      actionConfig.condition &&\r\n      ((actionConfig.condition.charAt(0) === '!' &&\r\n        document.querySelector(actionConfig.condition.slice(1))) ||\r\n        (actionConfig.condition.charAt(0) !== '!' &&\r\n          !document.querySelector(actionConfig.condition)))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const element: HTMLElement = document.querySelector(\r\n      actionConfig.element || step.element\r\n    ) as HTMLElement;\r\n    const action = this.getAction(actionConfig.action);\r\n    if (element && action) {\r\n      element[action]();\r\n    }\r\n  }\r\n\r\n  private executeActionPromise(\r\n    step: InteractiveTourStep,\r\n    actionConfig: InteractiveTourAction\r\n  ) {\r\n    return new Promise<void>((resolve) => {\r\n      this.executeAction(step, actionConfig);\r\n      if (!actionConfig || !actionConfig.waitFor) {\r\n        resolve();\r\n        return;\r\n      }\r\n      let nbTry = 0;\r\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\r\n      const checkExist = setInterval(() => {\r\n        nbTry++;\r\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\r\n          clearInterval(checkExist);\r\n          resolve();\r\n        }\r\n      }, 100);\r\n    });\r\n  }\r\n\r\n  private getShepherdSteps(stepConfig: InteractiveTourOptions) {\r\n    const shepherdSteps: Shepherd.Step.StepOptions[] = [];\r\n\r\n    let i = 0;\r\n    for (const step of stepConfig.steps) {\r\n      shepherdSteps.push({\r\n        attachTo: {\r\n          element: step.element,\r\n          on: (step.position || stepConfig.position) as any // PopperPlacement\r\n        },\r\n        floatingUIOptions: {\r\n          middleware: [offset({ mainAxis: 15 })]\r\n        },\r\n        beforeShowPromise: () => {\r\n          return Promise.all([\r\n            this.executeActionPromise(\r\n              this.previousStep,\r\n              this.previousStep ? this.previousStep.beforeChange : undefined\r\n            ),\r\n            this.executeActionPromise(step, step.beforeShow)\r\n          ]);\r\n        },\r\n        buttons: this.getButtons(\r\n          i === 0\r\n            ? 'first'\r\n            : i + 1 === stepConfig.steps.length\r\n            ? 'last'\r\n            : stepConfig.steps[i].noBackButton\r\n            ? 'noBackButton'\r\n            : undefined\r\n        ),\r\n        classes: step.class,\r\n        highlightClass: step.highlightClass,\r\n        scrollTo: step.scrollToElement || stepConfig.scrollToElement || true,\r\n        canClickTarget: step.disableInteraction\r\n          ? !step.disableInteraction\r\n          : undefined,\r\n        title: this.languageService.translate.instant(\r\n          step.title || stepConfig.title\r\n        ),\r\n        text: [this.languageService.translate.instant(step.text)],\r\n        when: {\r\n          show: () => {\r\n            this.executeAction(step, step.onShow);\r\n          },\r\n          hide: () => {\r\n            this.previousStep = step;\r\n            this.executeAction(step, step.onHide);\r\n          }\r\n        }\r\n      } satisfies Shepherd.Step.StepOptions);\r\n      i++;\r\n    }\r\n\r\n    return shepherdSteps;\r\n  }\r\n\r\n  public startTour(toolName: string) {\r\n    const stepConfig: InteractiveTourOptions =\r\n      this.interactiveTourLoader.getTourOptionData(toolName);\r\n\r\n    this.shepherdService.defaultStepOptions = {\r\n      classes: stepConfig.class,\r\n      highlightClass: stepConfig.highlightClass,\r\n      canClickTarget: stepConfig.disableInteraction\r\n        ? !stepConfig.disableInteraction\r\n        : true,\r\n      cancelIcon: {\r\n        enabled: true\r\n      }\r\n    };\r\n\r\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\r\n\r\n    this.shepherdService.modal = true;\r\n    this.shepherdService.confirmCancel = false;\r\n    this.shepherdService.addSteps(shepherdSteps);\r\n\r\n    this.shepherdService.tourObject.on('show', this.addProgress);\r\n    this.shepherdService.tourObject.on('cancel', (index) => {\r\n      this.checkNext(index, this.shepherdService.tourObject, this);\r\n    });\r\n\r\n    this.shepherdService.start();\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { InteractiveTourComponent } from './interactive-tour.component';\r\nimport { InteractiveTourLoader } from './interactive-tour.loader';\r\nimport { InteractiveTourService } from './interactive-tour.service';\r\n\r\n@NgModule({\r\n  declarations: [InteractiveTourComponent],\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule\r\n  ],\r\n  providers: [InteractiveTourService, InteractiveTourLoader],\r\n  exports: [InteractiveTourComponent]\r\n})\r\nexport class IgoInteractiveTourModule {}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { KeyValuePipe } from './keyvalue.pipe';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [KeyValuePipe],\r\n  exports: [KeyValuePipe]\r\n})\r\nexport class IgoKeyValueModule {\r\n  static forRoot(): ModuleWithProviders<IgoKeyValueModule> {\r\n    return {\r\n      ngModule: IgoKeyValueModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { ClickoutDirective } from './clickout.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [ClickoutDirective],\r\n  exports: [ClickoutDirective]\r\n})\r\nexport class IgoClickoutModule {\r\n  static forRoot(): ModuleWithProviders<IgoClickoutModule> {\r\n    return {\r\n      ngModule: IgoClickoutModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\n\r\nimport { IgoClickoutModule } from '../clickout/clickout.module';\r\nimport { ListItemDirective } from './list-item.directive';\r\nimport { ListComponent } from './list.component';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, MatIconModule, MatListModule, IgoClickoutModule],\r\n  declarations: [ListItemDirective, ListComponent],\r\n  exports: [ListItemDirective, ListComponent]\r\n})\r\nexport class IgoListModule {\r\n  static forRoot(): ModuleWithProviders<IgoListModule> {\r\n    return {\r\n      ngModule: IgoListModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { PanelComponent } from './panel.component';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [PanelComponent],\r\n  declarations: [PanelComponent]\r\n})\r\nexport class IgoPanelModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\r\n\r\nimport { SpinnerActivityDirective } from './spinner-activity.directive';\r\nimport { SpinnerComponent } from './spinner.component';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, MatProgressSpinnerModule],\r\n  declarations: [SpinnerActivityDirective, SpinnerComponent],\r\n  exports: [SpinnerActivityDirective, SpinnerComponent]\r\n})\r\nexport class IgoSpinnerModule {}\r\n","import { CdkTableModule } from '@angular/cdk/table';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSortModule } from '@angular/material/sort';\r\nimport { MatTableModule } from '@angular/material/table';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { TableComponent } from './table.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    CdkTableModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTableModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSortModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule\r\n  ],\r\n  declarations: [TableComponent],\r\n  exports: [TableComponent]\r\n})\r\nexport class IgoTableModule {\r\n  static forRoot(): ModuleWithProviders<IgoTableModule> {\r\n    return {\r\n      ngModule: IgoTableModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","export enum EntityOperationType {\n  Insert = 'Insert',\n  Update = 'Update',\n  Delete = 'Delete'\n}\n\nexport enum EntityTableColumnRenderer {\n  Default = 'Default',\n  HTML = 'HTML',\n  UnsanitizedHTML = 'UnsanitizedHTML',\n  Editable = 'Editable',\n  Icon = 'Icon',\n  ButtonGroup = 'ButtonGroup'\n}\n\nexport enum EntityTableScrollBehavior {\n  Auto = 'auto',\n  Instant = 'instant',\n  Smooth = 'smooth'\n}\n\nexport enum EntityTableSelectionState {\n  None = 'None',\n  All = 'All',\n  Some = 'Some'\n}\n","import { t } from 'typy';\r\n\r\nimport { EntityKey } from './entity.interfaces';\r\n\r\n/**\r\n * Get an entity's named property. Nested properties are supported\r\n * with the dotted notation. (i.e 'author.name')\r\n *\r\n * Note: this method is a 'best attempt' at getting an entity's property.\r\n * It fits the most common cases but you might need to explicitely define\r\n * a property getter when using an EntityStore, for example.\r\n * @param entity Entity\r\n * @param property Property name\r\n * @returns Property value\r\n */\r\nexport function getEntityProperty(entity: object, property: string): any {\r\n  return t(entity, property).safeObject;\r\n}\r\n\r\n/**\r\n * Get an entity's id. An entity's id can be one of:\r\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\r\n *\r\n * Note: See the note in the 'getEntityProperty' documentation.\r\n * @param entity Entity\r\n * @returns Entity id\r\n */\r\nexport function getEntityId(entity: object): EntityKey {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\r\n}\r\n\r\n/**\r\n * Get an entity's title. An entity's title can be one of:\r\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\r\n * @param entity Entity\r\n * @returns Entity title\r\n */\r\nexport function getEntityTitle(entity: object): string {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.title\r\n    ? meta.title\r\n    : getEntityProperty(entity, meta.titleProperty || 'title');\r\n}\r\n\r\n/**\r\n * Get an entity's HTML title. An entity's HTML title can be one of:\r\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\r\n * @param entity Entity\r\n * @returns Entity HTML title\r\n */\r\nexport function getEntityTitleHtml(entity: object): string {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.titleHtml\r\n    ? meta.titleHtml\r\n    : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\r\n}\r\n\r\n/**\r\n * Get an entity's icon. An entity's icon can be one of:\r\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\r\n * @param entity Entity\r\n * @returns Entity icon\r\n */\r\nexport function getEntityIcon(entity: object): string {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.icon\r\n    ? meta.icon\r\n    : getEntityProperty(entity, meta.iconProperty || 'icon');\r\n}\r\n\r\n/**\r\n * Get an entity's revision.\r\n * @param entity Entity\r\n * @returns Entity revision\r\n */\r\nexport function getEntityRevision(entity: object): number {\r\n  const meta = (entity as any).meta || {};\r\n  return meta.revision || 0;\r\n}\r\n","import { ReplaySubject } from 'rxjs';\n\nimport { EntityKey, EntityState } from './entity.interfaces';\nimport { getEntityId } from './entity.utils';\n\ninterface EntityStateManagerOptions<E extends object> {\n  getKey?: (entity: object) => EntityKey;\n  index?: Map<EntityKey, E>;\n}\n\n/**\n * This class is used to track a store's entities state\n */\nexport class EntityStateManager<\n  E extends object,\n  S extends EntityState = EntityState\n> {\n  /**\n   * State index\n   */\n  readonly index = new Map<EntityKey, S>();\n\n  /**\n   * Change emitter\n   */\n  readonly change$ = new ReplaySubject<void>(1);\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  constructor(private options: EntityStateManagerOptions<E> = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n\n    this.next();\n  }\n\n  /**\n   * Clear state\n   */\n  clear() {\n    if (this.index.size > 0) {\n      this.index.clear();\n      this.next();\n    }\n  }\n\n  /**\n   * Get an entity's state\n   * @param entity Entity\n   * @returns State\n   */\n  get(entity: E): S {\n    return (this.index.get(this.getKey(entity)) || {}) as S;\n  }\n\n  /**\n   * Set an entity's state\n   * @param entity Entity\n   * @param state State\n   */\n  set(entity: E, state: S) {\n    this.setMany([entity], state);\n  }\n\n  /**\n   * Set many entitie's state\n   * @param entitie Entities\n   * @param state State\n   */\n  setMany(entities: E[], state: S) {\n    entities.forEach((entity: E) => {\n      this.index.set(this.getKey(entity), Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Set state of all entities that already have a state. This is not\n   * the same as setting the state of all the store's entities.\n   * @param state State\n   */\n  setAll(state: S) {\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\n      this.index.set(key, Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Update an entity's state\n   * @param entity Entity\n   * @param changes State changes\n   */\n  update(entity: E, changes: Partial<S>, exclusive = false) {\n    this.updateMany([entity], changes, exclusive);\n  }\n\n  /**\n   * Update many entitie's state\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\n    if (exclusive === true) {\n      return this.updateManyExclusive(entities, changes);\n    }\n\n    entities.forEach((entity: E) => {\n      const state = Object.assign({}, this.get(entity), changes);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Reversee an entity's state\n   * @param entity Entity\n   * @param keys State keys to reverse\n   */\n  reverse(entity: E, keys: string[]) {\n    this.reverseMany([entity], keys);\n  }\n\n  /**\n   * Reverse many entitie's state\n   * @param entitie Entities\n   * @param keys State keys to reverse\n   */\n  reverseMany(entities: E[], keys: string[]) {\n    entities.forEach((entity: E) => {\n      const currentState = this.get(entity);\n      const changes = keys.reduce(\n        (acc: { [key: string]: boolean }, key: string) => {\n          acc[key] = currentState[key] || false;\n          return acc;\n        },\n        {}\n      ) as Partial<S>;\n      const reversedChanges = this.reverseChanges(changes);\n      const state = Object.assign({}, currentState, reversedChanges);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Update state of all entities that already have a state. This is not\n   * the same as updating the state of all the store's entities.\n   * @param changes State\n   */\n  updateAll(changes: Partial<S>) {\n    const allKeys = this.getAllKeys();\n    Array.from(allKeys).forEach((key: EntityKey) => {\n      const state = Object.assign({}, this.index.get(key), changes);\n      this.index.set(key, state);\n    });\n    this.next();\n  }\n\n  /**\n   * When some state changes are flagged as 'exclusive', reverse\n   * the state of all other entities. Changes are reversable when\n   * they are boolean.\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\n    const reverseChanges = this.reverseChanges(changes);\n\n    const keys = entities.map((entity: E) => this.getKey(entity));\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\n    allKeys.forEach((key: EntityKey) => {\n      const state = this.index.get(key) || ({} as S);\n\n      if (keys.indexOf(key) >= 0) {\n        this.index.set(key, Object.assign({}, state, changes));\n      } else {\n        // Update only if the reverse changes would modify\n        // a key already present in the current state\n        const shouldUpdate = Object.keys(reverseChanges).some(\n          (changeKey: string) => {\n            return (\n              state[changeKey] !== undefined &&\n              state[changeKey] !== reverseChanges[changeKey]\n            );\n          }\n        );\n        if (shouldUpdate === true) {\n          this.index.set(key, Object.assign({}, state, reverseChanges));\n        }\n      }\n    });\n\n    this.next();\n  }\n\n  /**\n   * Compute a 'reversed' version of some state changes.\n   * Changes are reversable when they are boolean.\n   * @param changes State changes\n   * @returns Reversed state changes\n   */\n  private reverseChanges(changes: Partial<S>): Partial<S> {\n    return Object.entries(changes).reduce(\n      (reverseChanges: Partial<S>, bunch: [string, any]) => {\n        const [changeKey, value] = bunch;\n        if (typeof value === typeof true) {\n          (reverseChanges as object)[changeKey] = !value;\n        }\n        return reverseChanges;\n      },\n      {}\n    );\n  }\n\n  /**\n   * Return all the keys in that state and in the store it's bound to, if any.\n   * @returns Set of keys\n   */\n  private getAllKeys(): Set<EntityKey> {\n    const storeKeys = Array.from(this.options?.index?.keys() ?? []);\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\n  }\n\n  /**\n   * Emit 'change' event\n   */\n  private next() {\n    this.change$.next();\n  }\n}\n","import { ObjectUtils, uuid } from '@igo2/utils';\r\n\r\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime, map, skip } from 'rxjs/operators';\r\n\r\nimport {\r\n  EntityFilterClause,\r\n  EntityJoinClause,\r\n  EntityKey,\r\n  EntitySortClause\r\n} from './entity.interfaces';\r\n\r\n/**\r\n * An entity view streams entities from an observable source. These entities\r\n * can be filtered or sorted without affecting the source. A view can also\r\n * combine data from multiple sources, joined together.\r\n */\r\nexport class EntityView<E extends object, V extends object = E> {\r\n  /**\r\n   * Observable stream of values\r\n   */\r\n  readonly values$ = new BehaviorSubject<V[]>([]);\r\n\r\n  /**\r\n   * Subscription to the source (and joined sources) values\r\n   */\r\n  private values$$: Subscription;\r\n\r\n  /**\r\n   * Whether this view has been lifted\r\n   */\r\n  private lifted = false;\r\n\r\n  /**\r\n   * Join clauses\r\n   */\r\n  private joins: EntityJoinClause[] = [];\r\n\r\n  /**\r\n   * Observable of a filter clause\r\n   */\r\n  private filter$ = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Observable of filter clauses\r\n   */\r\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject(\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Filters index\r\n   */\r\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\r\n\r\n  /**\r\n   * Observable of a sort clause\r\n   */\r\n  private sort$ = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Method for indexing\r\n   */\r\n  get getKey(): (V) => EntityKey {\r\n    return this.getKey$.value;\r\n  }\r\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Number of entities\r\n   */\r\n  readonly count$ = new BehaviorSubject<number>(0);\r\n  get count(): number {\r\n    return this.count$.value;\r\n  }\r\n\r\n  /**\r\n   * Whether the store is empty\r\n   */\r\n  readonly empty$ = new BehaviorSubject<boolean>(true);\r\n  get empty(): boolean {\r\n    return this.empty$.value;\r\n  }\r\n\r\n  /**\r\n   * Store index\r\n   */\r\n  get index(): Map<EntityKey, V> {\r\n    return this._index;\r\n  }\r\n  private _index: Map<EntityKey, V>;\r\n\r\n  constructor(private source$: BehaviorSubject<E[]>) {}\r\n\r\n  /**\r\n   * Get a value from the view by key\r\n   * @param key Key\r\n   * @returns Value\r\n   */\r\n  get(key: EntityKey): V {\r\n    if (this._index === undefined) {\r\n      throw new Error(\r\n        'This view has no index, therefore, this method is unavailable.'\r\n      );\r\n    }\r\n    return this.index.get(key);\r\n  }\r\n\r\n  /**\r\n   * Get all the values\r\n   * @returns Array of values\r\n   */\r\n  all(): V[] {\r\n    return this.values$.value;\r\n  }\r\n\r\n  /**\r\n   * Observe all the values\r\n   * @returns Observable of values\r\n   */\r\n  all$(): BehaviorSubject<V[]> {\r\n    return this.values$;\r\n  }\r\n\r\n  /**\r\n   * Get the first value that respects a criteria\r\n   * @returns A value\r\n   */\r\n  firstBy(clause: EntityFilterClause<V>): V {\r\n    return this.values$.value.find(clause);\r\n  }\r\n\r\n  /**\r\n   * Observe the first value that respects a criteria\r\n   * @returns Observable of a value\r\n   */\r\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\r\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\r\n  }\r\n\r\n  /**\r\n   * Get all the values that respect a criteria\r\n   * @returns Array of values\r\n   */\r\n  manyBy(clause: EntityFilterClause<V>): V[] {\r\n    return this.values$.value.filter(clause);\r\n  }\r\n\r\n  /**\r\n   * Observe all the values that respect a criteria\r\n   * @returns Observable of values\r\n   */\r\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\r\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\r\n  }\r\n\r\n  /**\r\n   * Clear the filter and sort and unsubscribe from the source\r\n   */\r\n  clear() {\r\n    this.filter(undefined);\r\n    this.sort(undefined);\r\n  }\r\n\r\n  destroy() {\r\n    if (this.values$$ !== undefined) {\r\n      this.values$$.unsubscribe();\r\n    }\r\n    this.clear();\r\n  }\r\n\r\n  /**\r\n   * Create an index\r\n   * @param getKey Method to get a value's id\r\n   * @returns The view\r\n   */\r\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\r\n    this._index = new Map();\r\n    this.getKey$.next(getKey);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Join another source to the stream (chainable)\r\n   * @param clause Join clause\r\n   * @returns The view\r\n   */\r\n  join(clause: EntityJoinClause): EntityView<E, V> {\r\n    if (this.lifted === true) {\r\n      throw new Error(\r\n        'This view has already been lifted, therefore, no join is allowed.'\r\n      );\r\n    }\r\n    this.joins.push(clause);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Filter values (chainable)\r\n   * @param clause Filter clause\r\n   * @returns The view\r\n   */\r\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\r\n    this.filter$.next(clause);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param clause Filter clause\r\n   * @returns The filter id\r\n   */\r\n  addFilter(clause: EntityFilterClause<V>): string {\r\n    const id = uuid();\r\n    this.filterIndex.set(id, clause);\r\n    this.filters$.next(Array.from(this.filterIndex.values()));\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Remove a filter by id\r\n   * @param clause Filter clause\r\n   */\r\n  removeFilter(id: string) {\r\n    this.filterIndex.delete(id);\r\n    this.filters$.next(Array.from(this.filterIndex.values()));\r\n  }\r\n\r\n  /**\r\n   * Sort values (chainable)\r\n   * @param clauseSort clause\r\n   * @returns The view\r\n   */\r\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\r\n    this.sort$.next(clause);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Create the final observable\r\n   * @returns Observable\r\n   */\r\n  lift() {\r\n    this.lifted = true;\r\n    const source$ =\r\n      this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\r\n    const observables$ = [\r\n      source$,\r\n      this.filters$,\r\n      this.filter$,\r\n      this.sort$,\r\n      this.getKey$\r\n    ];\r\n\r\n    this.values$$ = combineLatest(observables$)\r\n      .pipe(skip(1), debounceTime(5))\r\n      .subscribe((bunch: any[]) => {\r\n        const [_values, filters, filter, sort, getKey] = bunch;\r\n        const values = this.processValues(_values, filters, filter, sort);\r\n        const generateIndex = getKey !== undefined;\r\n        this.setValues(values, generateIndex);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Create the source observable when no joins are defined\r\n   * @returns Observable\r\n   */\r\n  private liftSource(): Observable<V[]> {\r\n    return this.source$ as any as Observable<V[]>;\r\n  }\r\n\r\n  /**\r\n   * Create the source observable when joins are defined\r\n   * @returns Observable\r\n   */\r\n  private liftJoinedSource(): Observable<V[]> {\r\n    const sources$ = [\r\n      this.source$,\r\n      combineLatest(this.joins.map((join: EntityJoinClause) => join.source))\r\n    ];\r\n\r\n    return combineLatest(sources$).pipe(\r\n      map((bunch: [E[], any[]]) => {\r\n        const [entities, joinData] = bunch;\r\n        return entities.reduce((values: V[], entity: E) => {\r\n          const value = this.computeJoinedValue(entity, joinData);\r\n          if (value !== undefined) {\r\n            values.push(value);\r\n          }\r\n          return values;\r\n        }, []);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Apply joins to a source's entity and return the final value\r\n   * @returns Final value\r\n   */\r\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\r\n    let value = entity as Partial<V>;\r\n    let joinIndex = 0;\r\n    while (value !== undefined && joinIndex < this.joins.length) {\r\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\r\n      joinIndex += 1;\r\n    }\r\n    return value as V;\r\n  }\r\n\r\n  /**\r\n   * Filter and sort values before streaming them\r\n   * @param values Values\r\n   * @param filters Filter clauses\r\n   * @param filter Filter clause\r\n   * @param sort Sort clause\r\n   * @returns Filtered and sorted values\r\n   */\r\n  private processValues(\r\n    values: V[],\r\n    filters: EntityFilterClause[],\r\n    filter: EntityFilterClause,\r\n    sort: EntitySortClause\r\n  ): V[] {\r\n    values = values.slice(0);\r\n    values = this.filterValues(values, filters.concat([filter]));\r\n    values = this.sortValues(values, sort);\r\n    return values;\r\n  }\r\n\r\n  /**\r\n   * Filter values\r\n   * @param values Values\r\n   * @param filters Filter clauses\r\n   * @returns Filtered values\r\n   */\r\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\r\n    if (clauses.length === 0) {\r\n      return values;\r\n    }\r\n\r\n    return values.filter((value: V) => {\r\n      return clauses\r\n        .filter((clause: EntityFilterClause) => clause !== undefined)\r\n        .every((clause: EntityFilterClause) => clause(value));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sort values\r\n   * @param values Values\r\n   * @param sort Sort clause\r\n   * @returns Sorted values\r\n   */\r\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\r\n    if (clause === undefined) {\r\n      return values;\r\n    }\r\n    return values.sort((v1: V, v2: V) => {\r\n      return ObjectUtils.naturalCompare(\r\n        clause.valueAccessor(v1),\r\n        clause.valueAccessor(v2),\r\n        clause.direction,\r\n        clause.nullsFirst\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set value and optionally generate an index\r\n   * @param values Values\r\n   * @param generateIndex boolean\r\n   */\r\n  private setValues(values: V[], generateIndex: boolean) {\r\n    if (generateIndex === true) {\r\n      this._index = this.generateIndex(values);\r\n    }\r\n\r\n    this.values$.next(values);\r\n\r\n    const count = values.length;\r\n    const empty = count === 0;\r\n    this.count$.next(count);\r\n    this.empty$.next(empty);\r\n  }\r\n\r\n  /**\r\n   * Generate a complete index of all the values\r\n   * @param entities Entities\r\n   * @returns Index\r\n   */\r\n  private generateIndex(values: V[]): Map<EntityKey, V> {\r\n    const entries = values.map((value: V) => [this.getKey(value), value]);\r\n    return new Map(entries as [EntityKey, V][]);\r\n  }\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityKey, EntityRecord, EntityState } from './entity.interfaces';\r\nimport { getEntityId, getEntityProperty } from './entity.utils';\r\nimport { EntityStateManager } from './state';\r\nimport { EntityView } from './view';\r\n\r\nexport interface EntityStoreOptions {\r\n  getKey?: (entity: object) => EntityKey;\r\n  getProperty?: (entity: object, property: string) => any;\r\n}\r\n\r\n/**\r\n * An entity store class holds any number of entities\r\n * as well as their state. It can be observed, filtered and sorted and\r\n * provides methods to insert, update or delete entities.\r\n */\r\nexport class EntityStore<\r\n  E extends object = object,\r\n  S extends EntityState = EntityState\r\n> {\r\n  /**\r\n   * Observable of the raw entities\r\n   */\r\n  readonly entities$ = new BehaviorSubject<E[]>([]);\r\n\r\n  /**\r\n   * Number of entities\r\n   */\r\n  readonly count$ = new BehaviorSubject<number>(0);\r\n  get count(): number {\r\n    return this.count$.value;\r\n  }\r\n\r\n  /**\r\n   * Whether the store is empty\r\n   */\r\n  readonly empty$ = new BehaviorSubject<boolean>(true);\r\n  get empty(): boolean {\r\n    return this.empty$.value;\r\n  }\r\n\r\n  /**\r\n   * Entity store state\r\n   */\r\n  readonly state: EntityStateManager<E, S>;\r\n\r\n  /**\r\n   * View of all the entities\r\n   */\r\n  readonly view: EntityView<E>;\r\n\r\n  /**\r\n   * View of all the entities and their state\r\n   */\r\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\r\n\r\n  /**\r\n   * Method to get an entity's id\r\n   */\r\n  readonly getKey: (E) => EntityKey;\r\n\r\n  /**\r\n   * Method to get an entity's named property\r\n   */\r\n  readonly getProperty: (E, prop: string) => any;\r\n\r\n  /**\r\n   * Store index\r\n   */\r\n  get index(): Map<EntityKey, E> {\r\n    return this._index;\r\n  }\r\n  private _index: Map<EntityKey, E>;\r\n\r\n  /**\r\n   * Store index\r\n   */\r\n  get pristine(): boolean {\r\n    return this._pristine;\r\n  }\r\n  private _pristine: boolean = true;\r\n\r\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\r\n    this.getKey = options.getKey ? options.getKey : getEntityId;\r\n    this.getProperty = options.getProperty\r\n      ? options.getProperty\r\n      : getEntityProperty;\r\n\r\n    this.state = this.createStateManager();\r\n    this.view = this.createDataView();\r\n    this.stateView = this.createStateView();\r\n\r\n    this.view.lift();\r\n    this.stateView.lift();\r\n\r\n    if (entities.length > 0) {\r\n      this.load(entities);\r\n    } else {\r\n      this._index = this.generateIndex(entities);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get an entity from the store by key\r\n   * @param key Key\r\n   * @returns Entity\r\n   */\r\n  get(key: EntityKey): E {\r\n    return this.index.get(key);\r\n  }\r\n\r\n  /**\r\n   * Get all entities in the store\r\n   * @returns Array of entities\r\n   */\r\n  all(): E[] {\r\n    return this.entities$.value;\r\n  }\r\n\r\n  /**\r\n   * Set this store's entities\r\n   * @param entities Entities\r\n   */\r\n  load(entities: E[], pristine: boolean = true) {\r\n    this._index = this.generateIndex(entities);\r\n    this._pristine = pristine;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Clear the store's entities but keep the state and views intact.\r\n   * Views won't return any data but future data will be subject to the\r\n   * current views filter and sort\r\n   */\r\n  softClear() {\r\n    if (this.index && this.index.size > 0) {\r\n      this.index.clear();\r\n      this._pristine = true;\r\n      this.next();\r\n    } else if (this.index) {\r\n      this.updateCount();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the store's entities, state and views\r\n   */\r\n  clear() {\r\n    this.stateView.clear();\r\n    this.view.clear();\r\n    this.state.clear();\r\n    this.softClear();\r\n  }\r\n\r\n  destroy() {\r\n    this.stateView.destroy();\r\n    this.view.destroy();\r\n    this.clear();\r\n  }\r\n\r\n  /**\r\n   * Insert an entity into the store\r\n   * @param entity Entity\r\n   */\r\n  insert(entity: E) {\r\n    this.insertMany([entity]);\r\n  }\r\n\r\n  /**\r\n   * Insert many entities into the store\r\n   * @param entities Entities\r\n   */\r\n  insertMany(entities: E[]) {\r\n    entities.forEach((entity: E) =>\r\n      this.index.set(this.getKey(entity), entity)\r\n    );\r\n    this._pristine = false;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Update or insert an entity into the store\r\n   * @param entity Entity\r\n   */\r\n  update(entity: E) {\r\n    this.updateMany([entity]);\r\n  }\r\n\r\n  /**\r\n   * Update or insert many entities into the store\r\n   * @param entities Entities\r\n   */\r\n  updateMany(entities: E[]) {\r\n    entities.forEach((entity: E) =>\r\n      this.index.set(this.getKey(entity), entity)\r\n    );\r\n    this._pristine = false;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Delete an entity from the store\r\n   * @param entity Entity\r\n   */\r\n  delete(entity: E) {\r\n    this.deleteMany([entity]);\r\n  }\r\n\r\n  /**\r\n   * Delete many entities from the store\r\n   * @param entities Entities\r\n   */\r\n  deleteMany(entities: E[]) {\r\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\r\n    this._pristine = false;\r\n    this.next();\r\n  }\r\n\r\n  /**\r\n   * Generate a complete index of all the entities\r\n   * @param entities Entities\r\n   * @returns Index\r\n   */\r\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\r\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\r\n    return new Map(entries as [EntityKey, E][]);\r\n  }\r\n\r\n  /**\r\n   * Push the index's entities into the entities$ observable\r\n   */\r\n  private next() {\r\n    this.entities$.next(Array.from(this.index.values()));\r\n    this.updateCount();\r\n  }\r\n\r\n  /**\r\n   * Update the store's count and empty\r\n   */\r\n  private updateCount() {\r\n    const count = this.index.size;\r\n    const empty = count === 0;\r\n    this.count$.next(count);\r\n    this.empty$.next(empty);\r\n  }\r\n\r\n  /**\r\n   * Create the entity state manager\r\n   * @returns EntityStateManager\r\n   */\r\n  private createStateManager() {\r\n    return new EntityStateManager<E, S>({\r\n      getKey: this.getKey,\r\n      index: this.index\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create the data view\r\n   * @returns EntityView<E>\r\n   */\r\n  private createDataView() {\r\n    return new EntityView<E>(this.entities$);\r\n  }\r\n\r\n  /**\r\n   * Create the state view\r\n   * @returns EntityView<EntityRecord<E>>\r\n   */\r\n  private createStateView() {\r\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\r\n      .join({\r\n        source: this.state.change$,\r\n        reduce: (entity: E): EntityRecord<E, S> => {\r\n          const key = this.getKey(entity);\r\n          const state = this.state.get(entity);\r\n          const currentRecord = this.stateView.get(key);\r\n\r\n          if (\r\n            currentRecord !== undefined &&\r\n            currentRecord.entity === entity &&\r\n            this.statesAreTheSame(currentRecord.state, state)\r\n          ) {\r\n            return currentRecord;\r\n          }\r\n\r\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\r\n          const ref = `${key}-${revision}`;\r\n          return { entity, state, revision, ref };\r\n        }\r\n      })\r\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\r\n  }\r\n\r\n  private statesAreTheSame(currentState: S, newState: S): boolean {\r\n    if (currentState === newState) {\r\n      return true;\r\n    }\r\n\r\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\r\n    const newStateIsEmpty = Object.keys(newState).length === 0;\r\n    return currentStateIsEmpty && newStateIsEmpty;\r\n  }\r\n}\r\n","import { EntityState } from './entity.interfaces';\r\nimport { EntityStore, EntityStoreOptions } from './store';\r\nimport { EntityStoreStrategy } from './strategies/strategy';\r\n\r\nexport class EntityStoreWithStrategy<\r\n  E extends object = object,\r\n  S extends EntityState = EntityState\r\n> extends EntityStore<E, S> {\r\n  /**\r\n   * Strategies\r\n   */\r\n  private strategies: EntityStoreStrategy[] = [];\r\n\r\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\r\n    super(entities, options);\r\n  }\r\n\r\n  /**\r\n   * Add a strategy to this store\r\n   * @param strategy Entity store strategy\r\n   * @returns Entity store\r\n   */\r\n  addStrategy(\r\n    strategy: EntityStoreStrategy,\r\n    activate: boolean = false\r\n  ): EntityStore {\r\n    const existingStrategy = this.strategies.find(\r\n      (_strategy: EntityStoreStrategy) => {\r\n        return strategy.constructor === _strategy.constructor;\r\n      }\r\n    );\r\n    if (existingStrategy !== undefined) {\r\n      throw new Error(\r\n        'A strategy of this type already exists on that EntityStore.'\r\n      );\r\n    }\r\n\r\n    this.strategies.push(strategy);\r\n    strategy.bindStore(this);\r\n\r\n    if (activate === true) {\r\n      strategy.activate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove a strategy from this store\r\n   * @param strategy Entity store strategy\r\n   * @returns Entity store\r\n   */\r\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\r\n    const index = this.strategies.indexOf(strategy);\r\n    if (index >= 0) {\r\n      this.strategies.splice(index, 1);\r\n      strategy.unbindStore(this);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Return strategies of a given type\r\n   * @param type Entity store strategy class\r\n   * @returns Strategies\r\n   */\r\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\r\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\r\n      return strategy instanceof type;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate strategies of a given type\r\n   * @param type Entity store strategy class\r\n   */\r\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\r\n    const strategy = this.getStrategyOfType(type);\r\n    if (strategy !== undefined) {\r\n      strategy.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate strategies of a given type\r\n   * @param type Entity store strategy class\r\n   */\r\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\r\n    const strategy = this.getStrategyOfType(type);\r\n    if (strategy !== undefined) {\r\n      strategy.deactivate();\r\n    }\r\n  }\r\n}\r\n","import { ChangeDetectorRef } from '@angular/core';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { skip } from 'rxjs/operators';\r\n\r\nimport { EntityKey } from './entity.interfaces';\r\nimport { EntityStore } from './store';\r\n\r\n/**\r\n * This class is used to synchronize a component's changes\r\n * detection with an EntityStore changes. For example, it is frequent\r\n * to have a component subscribe to a store's selected entity and, at the same time,\r\n * this component provides a way to select an entity with, let's say, a click.\r\n *\r\n * This class automatically handles those case and triggers the compoent's\r\n * change detection when needed.\r\n *\r\n * Note: If the component observes the store's stateView, a workspace is\r\n * probably not required because the stateView catches any changes to the\r\n * entities and their state.\r\n */\r\nexport class EntityStoreWatcher<E extends object> {\r\n  /**\r\n   * Component change detector\r\n   */\r\n  private cdRef: ChangeDetectorRef;\r\n\r\n  /**\r\n   * Entity store\r\n   */\r\n  private store: EntityStore<E>;\r\n\r\n  /**\r\n   * Component inner state\r\n   */\r\n  private innerStateIndex = new Map<EntityKey, { [key: string]: any }>();\r\n\r\n  /**\r\n   * Subscription to the store's entities\r\n   */\r\n  private entities$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the store's state\r\n   */\r\n  private state$$: Subscription;\r\n\r\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\r\n    this.setChangeDetector(cdRef);\r\n    this.setStore(store);\r\n  }\r\n\r\n  destroy() {\r\n    this.setChangeDetector(undefined);\r\n    this.setStore(undefined);\r\n  }\r\n\r\n  /**\r\n   * Bind this workspace to a store and start watching for changes\r\n   * @param store Entity store\r\n   */\r\n  setStore(store?: EntityStore<E>) {\r\n    if (store === undefined) {\r\n      this.teardownObservers();\r\n      this.innerStateIndex.clear();\r\n      this.store = undefined;\r\n      return;\r\n    }\r\n\r\n    this.setStore(undefined);\r\n    this.store = store;\r\n    this.setupObservers();\r\n    this.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * Bind this workspace to a component's change detector\r\n   * @param cdRef Change detector\r\n   */\r\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\r\n    this.cdRef = cdRef;\r\n  }\r\n\r\n  /**\r\n   * Set up observers on a store's entities and their state\r\n   * @param store Entity store\r\n   */\r\n  private setupObservers() {\r\n    this.teardownObservers();\r\n\r\n    this.entities$$ = this.store.entities$.subscribe((entities: E[]) =>\r\n      this.onEntitiesChange(entities)\r\n    );\r\n\r\n    this.state$$ = this.store.state.change$\r\n      .pipe(skip(1))\r\n      .subscribe(() => this.onStateChange());\r\n  }\r\n\r\n  /**\r\n   * Teardown store observers\r\n   */\r\n  private teardownObservers() {\r\n    if (this.entities$$ !== undefined) {\r\n      this.entities$$.unsubscribe();\r\n    }\r\n    if (this.state$$ !== undefined) {\r\n      this.state$$.unsubscribe();\r\n    }\r\n    this.entities$$ = undefined;\r\n    this.state$$ = undefined;\r\n  }\r\n\r\n  /**\r\n   * When the entities change, always trigger the changes detection\r\n   */\r\n  private onEntitiesChange(entities: E[]) {\r\n    this.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * When the entities state change, trigger the change detection\r\n   * only if the component has not handled these changes yet. For example,\r\n   * the component might have initiated thoses changes itself.\r\n   */\r\n  private onStateChange() {\r\n    let changesDetected = false;\r\n    const storeIndex = this.store.state.index;\r\n    const innerIndex = this.innerStateIndex;\r\n\r\n    if (storeIndex.size !== innerIndex.size) {\r\n      changesDetected = this.detectChanges();\r\n    }\r\n\r\n    const storeKeys = Array.from(storeIndex.keys());\r\n    for (const key of storeKeys) {\r\n      const storeValue = storeIndex.get(key);\r\n      const innerValue = innerIndex.get(key);\r\n      if (changesDetected === false) {\r\n        if (innerValue === undefined) {\r\n          changesDetected = this.detectChanges();\r\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\r\n          changesDetected = this.detectChanges();\r\n        }\r\n      }\r\n\r\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trigger the change detection of the workspace is bound to a change detector\r\n   */\r\n  private detectChanges() {\r\n    if (this.cdRef !== undefined) {\r\n      this.cdRef.detectChanges();\r\n    }\r\n    return true;\r\n  }\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\n\n/**\n * Entity store strategies. They can do pretty much anything during a store's\n * lifetime. For example, they may act as triggers when something happens.\n * Sharing a strategy is a good idea when multiple strategies would have\n * on cancelling effect on each other.\n *\n * At creation, strategy is inactive and needs to be manually activated.\n */\nexport class EntityStoreStrategy {\n  /**\n   * Feature store\n   * @internal\n   */\n  protected stores: EntityStore[] = [];\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean {\n    return this.active$.value;\n  }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\n    this.options = options;\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  activate() {\n    if (this.active === true) {\n      this.doDeactivate();\n    }\n    this.active$.next(true);\n    this.doActivate();\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.doDeactivate();\n  }\n\n  /**\n   * Bind this strategy to a store\n   * @param store Feature store\n   */\n  bindStore(store: EntityStore) {\n    if (this.stores.indexOf(store) < 0) {\n      this.stores.push(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from store\n   * @param store Feature store\n   */\n  unbindStore(store: EntityStore) {\n    const index = this.stores.indexOf(store);\n    if (index >= 0) {\n      this.stores.splice(index, 1);\n    }\n  }\n\n  /**\n   * Do the stataegy activation\n   * @internal\n   */\n  protected doActivate() {}\n\n  /**\n   * Do the strategy deactivation\n   * @internal\n   */\n  protected doDeactivate() {}\n}\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\n    super(options);\n  }\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    this.filters.set(\n      store,\n      store.stateView.addFilter(this.options.filterClauseFunc)\n    );\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","import { EntityRecord } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    if (this.filters.has(store)) {\n      return;\n    }\n\n    const filter = (record: EntityRecord<object>) => {\n      return record.state.selected === true;\n    };\n    this.filters.set(store, store.stateView.addFilter(filter));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","<mat-form-field class=\"igo-entity-selector\" subscriptSizing=\"dynamic\">\n  <mat-select\n    [disabled]=\"disabled\"\n    [value]=\"selected$ | async\"\n    [multiple]=\"multi\"\n    [placeholder]=\"placeholder\"\n    (selectionChange)=\"onSelectionChange($event)\"\n  >\n    <mat-option\n      *ngIf=\"emptyText !== undefined && multi === false\"\n      [value]=\"emptyValue\"\n      >{{ emptyText }}</mat-option\n    >\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{\n      multiText$ | async\n    }}</mat-option>\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\n      <mat-option [value]=\"record.entity\">\n        {{ titleAccessor(record.entity) }}\n      </mat-option>\n    </ng-template>\n  </mat-select>\n</mat-form-field>\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { EntityRecord } from '../shared/entity.interfaces';\r\nimport { getEntityTitle } from '../shared/entity.utils';\r\nimport { EntityStore } from '../shared/store';\r\nimport { EntityStoreWatcher } from '../shared/watcher';\r\n\r\n@Component({\r\n  selector: 'igo-entity-selector',\r\n  templateUrl: './entity-selector.component.html',\r\n  styleUrls: ['./entity-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * The selected entity\r\n   * @internal\r\n   */\r\n  readonly selected$ = new BehaviorSubject<object>(undefined);\r\n\r\n  /**\r\n   * The current multi select option text\r\n   * @internal\r\n   */\r\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\r\n\r\n  readonly multiSelectValue = { id: 'IGO_MULTI_SELECT' };\r\n\r\n  readonly emptyValue = { id: 'IGO_EMPTY_SELECT' };\r\n\r\n  /**\r\n   * Subscription to the selected entity\r\n   */\r\n  private selected$$: Subscription;\r\n\r\n  /**\r\n   * Store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<object>;\r\n\r\n  /**\r\n   * Entity store\r\n   */\r\n  @Input() store: EntityStore<object>;\r\n\r\n  /**\r\n   * Title accessor\r\n   */\r\n  @Input() titleAccessor: (object) => string = getEntityTitle;\r\n\r\n  /**\r\n   * Text to display when nothing is selected\r\n   */\r\n  @Input() emptyText: string = undefined;\r\n\r\n  /**\r\n   * Wheter selecting many entities is allowed\r\n   */\r\n  @Input() multi: boolean = false;\r\n\r\n  /**\r\n   * Text to display for the select all option\r\n   */\r\n  @Input() multiAllText: string = 'All';\r\n\r\n  /**\r\n   * Text to display for the select none option\r\n   */\r\n  @Input() multiNoneText: string = 'None';\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Wheter the selector is disabled or not\r\n   */\r\n  @Input() disabled: boolean = false;\r\n\r\n  /**\r\n   * Event emitted when the selection changes\r\n   */\r\n  @Output() selectedChange = new EventEmitter<{\r\n    selected: boolean;\r\n    value: object | object[];\r\n  }>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Create a store watcher and subscribe to the selected entity\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n\r\n    this.selected$$ = this.store.stateView\r\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\r\n      .subscribe((records: EntityRecord<object>[]) => {\r\n        const entities = records.map(\r\n          (record: EntityRecord<object>) => record.entity\r\n        );\r\n        this.onSelectFromStore(entities);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the selected entity and destroy the store watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n    this.selected$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * On selection change, update the store's state and emit an event\r\n   * @internal\r\n   */\r\n  onSelectionChange(event: { value: object | undefined }) {\r\n    const values = event.value instanceof Array ? event.value : [event.value];\r\n\r\n    const multiSelect = values.find(\r\n      (_value: object) => _value === this.multiSelectValue\r\n    );\r\n    let entities = values.filter(\r\n      (_value: object) => _value !== this.multiSelectValue\r\n    );\r\n    if (multiSelect !== undefined) {\r\n      if (entities.length === this.store.count) {\r\n        entities = [];\r\n      } else if (entities.length < this.store.count) {\r\n        entities = this.store.all();\r\n      }\r\n    }\r\n\r\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\r\n    if (entities.length === 0) {\r\n      this.store.state.updateAll({ selected: false });\r\n    } else {\r\n      this.store.state.updateMany(entities, { selected: true }, true);\r\n    }\r\n\r\n    const value = this.multi ? entities : event.value;\r\n    this.selectedChange.emit({ selected: true, value });\r\n  }\r\n\r\n  private onSelectFromStore(entities: object[]) {\r\n    if (this.multi === true) {\r\n      this.selected$.next(entities);\r\n    } else {\r\n      const entity = entities.length > 0 ? entities[0] : undefined;\r\n      this.selected$.next(entity);\r\n    }\r\n\r\n    this.updateMultiToggleWithEntities(entities);\r\n  }\r\n\r\n  private updateMultiToggleWithEntities(entities: object[]) {\r\n    if (\r\n      entities.length === this.store.count &&\r\n      this.multiText$.value !== this.multiNoneText\r\n    ) {\r\n      this.multiText$.next(this.multiNoneText);\r\n    } else if (\r\n      entities.length < this.store.count &&\r\n      this.multiText$.value !== this.multiAllText\r\n    ) {\r\n      this.multiText$.next(this.multiAllText);\r\n    }\r\n  }\r\n}\r\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopPropagation]'\n})\nexport class StopPropagationDirective {\n  @HostListener('click', ['$event'])\n  public onClick(event: any): void {\n    event.stopPropagation();\n  }\n}\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnChanges,\r\n  OnDestroy,\r\n  Output,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { MatPaginator, PageEvent } from '@angular/material/paginator';\r\n\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { EntityStore } from '../shared';\r\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\r\n\r\n@Component({\r\n  selector: 'igo-entity-table-paginator',\r\n  templateUrl: './entity-table-paginator.component.html',\r\n  styleUrls: ['./entity-table-paginator.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\r\n  public disabled: boolean = false;\r\n  public hidePageSize: boolean = false;\r\n  public pageIndex: number = 0;\r\n  public pageSize: number = 50;\r\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\r\n  public showFirstLastButtons: boolean = true;\r\n  private count$$: Subscription;\r\n  private entitySortChange$$: Subscription;\r\n  private paginationLabelTranslation$$: Subscription[] = [];\r\n\r\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n  /**\r\n   * Entity store\r\n   */\r\n  @Input() store: EntityStore<object>;\r\n\r\n  /**\r\n   * Paginator options\r\n   */\r\n  @Input()\r\n  paginatorOptions: EntityTablePaginatorOptions;\r\n\r\n  /**\r\n   * Event emitted when the paginator changes the page size or page index.\r\n   */\r\n  @Output() page: EventEmitter<PageEvent>;\r\n\r\n  public length: number = 0;\r\n\r\n  /**\r\n   * Paginator emitted.\r\n   */\r\n  @Output() paginatorChange: EventEmitter<MatPaginator> =\r\n    new EventEmitter<MatPaginator>();\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\r\n\r\n  ngOnChanges() {\r\n    this.unsubscribeAll();\r\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\r\n      this.length = count;\r\n      this.emitPaginator();\r\n    });\r\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\r\n      if (this.paginator) {\r\n        this.paginator.firstPage();\r\n      }\r\n    });\r\n    this.initPaginatorOptions();\r\n    this.translateLabels();\r\n  }\r\n\r\n  initPaginatorOptions() {\r\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\r\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\r\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\r\n    this.pageSizeOptions =\r\n      this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\r\n    if (this.mediaService.isMobile()) {\r\n      this.showFirstLastButtons = false;\r\n      this.hidePageSize = true;\r\n    } else {\r\n      this.showFirstLastButtons =\r\n        this.paginatorOptions?.showFirstLastButtons ||\r\n        this.showFirstLastButtons;\r\n      this.hidePageSize =\r\n        this.paginatorOptions?.hidePageSize || this.hidePageSize;\r\n    }\r\n  }\r\n\r\n  translateLabels() {\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.firstPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.firstPageLabel = label;\r\n        })\r\n    );\r\n\r\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\r\n\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.itemsPerPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.itemsPerPageLabel = label;\r\n        })\r\n    );\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.lastPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.lastPageLabel = label;\r\n        })\r\n    );\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.nextPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.nextPageLabel = label;\r\n        })\r\n    );\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.previousPageLabel')\r\n        .subscribe((label: string) => {\r\n          this.paginator._intl.previousPageLabel = label;\r\n        })\r\n    );\r\n  }\r\n\r\n  rangeLabel = (page: number, pageSize: number, length: number) => {\r\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n    this.paginationLabelTranslation$$.push(\r\n      this.languageService.translate\r\n        .get('igo.common.paginator.of')\r\n        .subscribe((label: string) => {\r\n          of.next(label);\r\n        })\r\n    );\r\n    if (length === 0 || pageSize === 0) {\r\n      return `0 ${of.value} ${length}`;\r\n    }\r\n    length = Math.max(length, 0);\r\n    const startIndex = page * pageSize;\r\n    const endIndex =\r\n      startIndex < length\r\n        ? Math.min(startIndex + pageSize, length)\r\n        : startIndex + pageSize;\r\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\r\n  };\r\n\r\n  private unsubscribeAll() {\r\n    this.paginationLabelTranslation$$.map((sub) => sub.unsubscribe());\r\n    if (this.count$$) {\r\n      this.count$$.unsubscribe();\r\n    }\r\n    if (this.entitySortChange$$) {\r\n      this.entitySortChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.unsubscribeAll();\r\n  }\r\n\r\n  emitPaginator() {\r\n    this.paginatorChange.emit(this.paginator);\r\n  }\r\n}\r\n","<mat-paginator\n  [disabled]=\"disabled\"\n  [hidePageSize]=\"hidePageSize\"\n  [length]=\"length\"\n  [pageIndex]=\"pageIndex\"\n  [pageSize]=\"pageSize\"\n  [pageSizeOptions]=\"pageSizeOptions\"\n  [showFirstLastButtons]=\"showFirstLastButtons\"\n  (page)=\"emitPaginator()\"\n>\n</mat-paginator>\n","import { Directive, ElementRef, HostListener, Input } from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoImageError]'\r\n})\r\nexport class ImageErrorDirective {\r\n  @Input() errorImageUrl: string = './assets/igo2/common/images/na.png';\r\n  @Input() hideError: boolean = false;\r\n\r\n  constructor(private el: ElementRef) {}\r\n\r\n  @HostListener('error', ['$event'])\r\n  public onError(event: any): void {\r\n    if (this.hideError) {\r\n      this.el.nativeElement.style.display = 'none';\r\n    } else {\r\n      event.target.src = this.errorImageUrl;\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  ElementRef,\r\n  EventEmitter,\r\n  HostListener,\r\n  Input,\r\n  Output,\r\n  Renderer2\r\n} from '@angular/core';\r\n\r\nimport scrollIntoView from 'scroll-into-view-if-needed';\r\n\r\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\r\n\r\n/**\r\n * Directive that handles an entity table row click and selection.\r\n */\r\n@Directive({\r\n  selector: '[igoEntityTableRow]'\r\n})\r\nexport class EntityTableRowDirective {\r\n  /**\r\n   * Class added to a selected row\r\n   */\r\n  static selectedCls = 'igo-entity-table-row-selected';\r\n\r\n  /**\r\n   * Class added to a highlighted row\r\n   */\r\n  static highlightedCls = 'igo-entity-table-row-highlighted';\r\n\r\n  /**\r\n   * Whether a row supports selection\r\n   */\r\n  @Input() selection = false;\r\n\r\n  /**\r\n   * Whether clicking a row should select it (if selection is true)\r\n   */\r\n  @Input() selectOnClick: boolean = true;\r\n\r\n  /**\r\n   * Whether the selected row should be highlighted\r\n   */\r\n  @Input() highlightSelection: boolean = true;\r\n\r\n  /**\r\n   * Whether a row is selected\r\n   */\r\n  @Input()\r\n  set selected(value: boolean) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n    if (value === this._selected) {\r\n      return;\r\n    }\r\n\r\n    this.toggleSelected(value);\r\n    this.scroll();\r\n  }\r\n  get selected(): boolean {\r\n    return this._selected;\r\n  }\r\n  private _selected = false;\r\n\r\n  /**\r\n   * Scroll behavior on selection\r\n   */\r\n  @Input()\r\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\r\n\r\n  /**\r\n   * Event emitted when a row is selected\r\n   */\r\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\r\n\r\n  /**\r\n   * When a row is clicked, select it if it's supported\r\n   * @ignore\r\n   */\r\n  @HostListener('click')\r\n  onClick() {\r\n    if (this.selection === false || this.selectOnClick === false) {\r\n      return;\r\n    }\r\n\r\n    this.toggleSelected(true);\r\n    this.select.emit(this);\r\n  }\r\n\r\n  constructor(\r\n    private renderer: Renderer2,\r\n    private el: ElementRef\r\n  ) {}\r\n\r\n  /**\r\n   * Select a row and add or remove the selected class from it\r\n   * @param selected Whether the row should be selected\r\n   */\r\n  private toggleSelected(selected: boolean) {\r\n    this._selected = selected;\r\n    if (selected === true) {\r\n      this.addCls(EntityTableRowDirective.selectedCls);\r\n      if (this.highlightSelection === true) {\r\n        this.addCls(EntityTableRowDirective.highlightedCls);\r\n      }\r\n    } else {\r\n      this.removeCls(EntityTableRowDirective.selectedCls);\r\n      this.removeCls(EntityTableRowDirective.highlightedCls);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Scroll to the selected row\r\n   */\r\n  private scroll() {\r\n    if (this._selected === true) {\r\n      scrollIntoView(this.el.nativeElement, {\r\n        scrollMode: 'if-needed',\r\n        behavior: 'smooth',\r\n        block: 'end',\r\n        inline: 'nearest'\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the selected CSS class\r\n   */\r\n  private addCls(cls: string) {\r\n    this.renderer.addClass(this.el.nativeElement, cls);\r\n  }\r\n\r\n  /**\r\n   * Remove the selected CSS class\r\n   */\r\n  private removeCls(cls: string) {\r\n    this.renderer.removeClass(this.el.nativeElement, cls);\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\n@Pipe({ name: 'sanitizeHtml' })\nexport class SanitizeHtmlPipe implements PipeTransform {\n  constructor(private _sanitizer: DomSanitizer) {}\n  transform(v: string): SafeHtml {\n    return this._sanitizer.bypassSecurityTrustHtml(v);\n  }\n}\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { catchError, switchMap } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\n@Pipe({\r\n  name: 'secureImage'\r\n})\r\nexport class SecureImagePipe implements PipeTransform {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private configService?: ConfigService\r\n  ) {}\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  transform(url: string): Observable<string> {\r\n    const headers = new HttpHeaders({\r\n      'Content-Type': 'text/plain',\r\n      activityInterceptor: 'false',\r\n      interceptError: 'false'\r\n    });\r\n\r\n    const regexDepot = new RegExp(\r\n      this.configService?.getConfig('depot.url') + '.*?(?=\"|$)'\r\n    );\r\n    if (regexDepot.test(url)) {\r\n      url = url.match(regexDepot)[0];\r\n    }\r\n\r\n    return this.http\r\n      .get(url, {\r\n        headers,\r\n        responseType: 'blob'\r\n      })\r\n      .pipe(\r\n        catchError((err) => {\r\n          err.error.caught = true;\r\n          err.error.toDisplay = false;\r\n          throw err;\r\n        }),\r\n        switchMap((blob) => {\r\n          return new Observable((observer) => {\r\n            const reader = new FileReader();\r\n            reader.readAsDataURL(blob);\r\n            reader.onloadend = () => {\r\n              observer.next(reader.result);\r\n              observer.complete();\r\n            };\r\n          });\r\n        })\r\n      ) as Observable<string>;\r\n  }\r\n}\r\n","<div class=\"table-container\" [ngStyle]=\"{ height: tableHeight }\">\r\n  <table\r\n    id=\"currentWorkspaceTable\"\r\n    mat-table\r\n    matSort\r\n    [ngClass]=\"getTableClass()\"\r\n    [dataSource]=\"dataSource\"\r\n    [trackBy]=\"getTrackByFunction()\"\r\n    (matSortChange)=\"onSort($event)\"\r\n  >\r\n    <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\r\n      <th mat-header-cell *matHeaderCellDef>\r\n        <ng-container *ngIf=\"selectMany\">\r\n          <ng-container *ngIf=\"selectionState$ | async as selectionState\">\r\n            <mat-checkbox\r\n              (change)=\"onToggleRows($event.checked)\"\r\n              [checked]=\"selectionState === entityTableSelectionState.All\"\r\n              [indeterminate]=\"\r\n                selectionState === entityTableSelectionState.Some\r\n              \"\r\n            >\r\n            </mat-checkbox>\r\n          </ng-container>\r\n        </ng-container>\r\n      </th>\r\n      <td mat-cell *matCellDef=\"let row\">\r\n        <mat-checkbox\r\n          (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\"\r\n          (click)=\"\r\n            $event.shiftKey\r\n              ? onShiftToggleRow(!rowIsSelected(row.record), row.record, $event)\r\n              : $event.stopPropagation()\r\n          \"\r\n          (change)=\"onToggleRow($event.checked, row.record)\"\r\n          [checked]=\"rowIsSelected(row.record)\"\r\n        >\r\n        </mat-checkbox>\r\n      </td>\r\n    </ng-container>\r\n\r\n    <ng-container\r\n      [matColumnDef]=\"column.name\"\r\n      *ngFor=\"let column of template.columns\"\r\n    >\r\n      <ng-container *ngIf=\"columnIsSortable(column)\">\r\n        <th\r\n          mat-header-cell\r\n          *matHeaderCellDef\r\n          mat-sort-header\r\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\r\n        >\r\n          {{ column.title }}\r\n        </th>\r\n      </ng-container>\r\n\r\n      <ng-container *ngIf=\"!columnIsSortable(column)\">\r\n        <th\r\n          mat-header-cell\r\n          *matHeaderCellDef\r\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\r\n        >\r\n          {{ column.title }}\r\n        </th>\r\n      </ng-container>\r\n\r\n      <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\r\n        <ng-container\r\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\"\r\n        >\r\n          <ng-container *matCellDef=\"let row\">\r\n            <td\r\n              mat-cell\r\n              class=\"mat-cell-text\"\r\n              *ngIf=\"!row.cellData[column.name].isUrl; else isAnUrlDefault\"\r\n              [ngClass]=\"row.cellData[column.name].class\"\r\n            >\r\n              {{ row.cellData[column.name].value }}\r\n            </td>\r\n            <ng-template #isAnUrlDefault>\r\n              <td\r\n                mat-cell\r\n                class=\"mat-cell-text\"\r\n                [ngClass]=\"row.cellData[column.name].class\"\r\n              >\r\n                <a\r\n                  href=\"{{ row.cellData[column.name].value }}\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  (click)=\"$event.stopPropagation()\"\r\n                >\r\n                  <img\r\n                    igoImageError\r\n                    *ngIf=\"row.cellData[column.name].isImg; else notImg\"\r\n                    src=\"{{\r\n                      row.cellData[column.name].value | secureImage | async\r\n                    }}\"\r\n                    width=\"50\"\r\n                    heigth=\"auto\"\r\n                  />\r\n                  <ng-template #notImg\r\n                    ><span\r\n                      >{{ 'igo.common.entity-table.targetHtmlUrl' | translate }}\r\n                    </span></ng-template\r\n                  >\r\n                </a>\r\n              </td>\r\n            </ng-template>\r\n          </ng-container>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\r\n          <ng-container *matCellDef=\"let row\">\r\n            <td\r\n              mat-cell\r\n              class=\"mat-cell-text\"\r\n              *ngIf=\"!row.cellData[column.name].isUrl; else isAnUrlHTML\"\r\n              [ngClass]=\"row.cellData[column.name].class\"\r\n              [innerHTML]=\"row.cellData[column.name].value\"\r\n            ></td>\r\n            <ng-template #isAnUrlHTML>\r\n              <td\r\n                mat-cell\r\n                class=\"mat-cell-text\"\r\n                [ngClass]=\"row.cellData[column.name].class\"\r\n              >\r\n                <a\r\n                  href=\"{{ row.cellData[column.name].value }}\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  (click)=\"$event.stopPropagation()\"\r\n                >\r\n                  <img\r\n                    igoImageError\r\n                    *ngIf=\"row.cellData[column.name].isImg; else notImg\"\r\n                    src=\"{{\r\n                      row.cellData[column.name].value | secureImage | async\r\n                    }}\"\r\n                    width=\"50\"\r\n                    heigth=\"auto\"\r\n                  />\r\n                  <ng-template #notImg\r\n                    ><span\r\n                      >{{ 'igo.geo.targetHtmlUrl' | translate }}\r\n                    </span></ng-template\r\n                  >\r\n                </a>\r\n              </td>\r\n            </ng-template>\r\n          </ng-container>\r\n        </ng-container>\r\n        <ng-container\r\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\"\r\n        >\r\n          <ng-container *matCellDef=\"let row\">\r\n            <td\r\n              mat-cell\r\n              class=\"mat-cell-text edition\"\r\n              [formGroup]=\"formGroup\"\r\n              *ngIf=\"isEdition(row.record); else isUnsanitizedHTML\"\r\n              [ngClass]=\"row.cellData[column.name].class\"\r\n            >\r\n              <div class=\"date-picker\" *ngIf=\"column.type === 'date'\">\r\n                <mat-datepicker-toggle\r\n                  matSuffix\r\n                  [for]=\"picker\"\r\n                ></mat-datepicker-toggle>\r\n                <input\r\n                  matInput\r\n                  [matDatepicker]=\"picker\"\r\n                  [formControlName]=\"column.name\"\r\n                  value=\"{{ row.cellData[column.name].value }}\"\r\n                  (dateChange)=\"onDateChange(column.name, row.record, $event)\"\r\n                />\r\n                <mat-datepicker #picker></mat-datepicker>\r\n              </div>\r\n              <input\r\n                matInput\r\n                type=\"time\"\r\n                *ngIf=\"column.type === 'time'\"\r\n                [formControlName]=\"column.name\"\r\n                step=\"900\"\r\n                (focus)=\"column.onFocus($event)\"\r\n                (keypress)=\"column.onChange($event)\"\r\n                (blur)=\"column.onBlur($event)\"\r\n              />\r\n              <input\r\n                matInput\r\n                type=\"number\"\r\n                class=\"class_number_edition\"\r\n                *ngIf=\"column.type === 'number'\"\r\n                [formControlName]=\"column.name\"\r\n                step=\"{{ column.step }}\"\r\n                value=\"{{ row.cellData[column.name].value }}\"\r\n                (input)=\"onValueChange(column.name, row.record, $event)\"\r\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\r\n                required=\"{{\r\n                  getValidationAttributeValue(column, 'mandatory')\r\n                }}\"\r\n                min=\"{{ getValidationAttributeValue(column, 'minValue') }}\"\r\n                max=\"{{ getValidationAttributeValue(column, 'maxValue') }}\"\r\n              />\r\n              <input\r\n                matInput\r\n                type=\"text\"\r\n                *ngIf=\"!column.type || column.type === 'string'\"\r\n                [formControlName]=\"column.name\"\r\n                value=\"{{ row.cellData[column.name].value }}\"\r\n                (input)=\"onValueChange(column.name, row.record, $event)\"\r\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\r\n                required=\"{{\r\n                  getValidationAttributeValue(column, 'mandatory')\r\n                }}\"\r\n              />\r\n              <mat-checkbox\r\n                *ngIf=\"column.type === 'boolean'\"\r\n                [formControlName]=\"column.name\"\r\n                [checked]=\"row.cellData[column.name].value\"\r\n                (change)=\"onBooleanValueChange(column.name, row.record, $event)\"\r\n              ></mat-checkbox>\r\n              <mat-select\r\n                *ngIf=\"column.type === 'list'\"\r\n                required=\"{{\r\n                  getValidationAttributeValue(column, 'mandatory')\r\n                }}\"\r\n                [formControlName]=\"column.name\"\r\n                [multiple]=\"column.multiple\"\r\n                (selectionChange)=\"\r\n                  onSelectValueChange(column.name, row.record, $event)\r\n                \"\r\n                [value]=\"row.cellData[column.name].value\"\r\n              >\r\n                <mat-option\r\n                  *ngFor=\"let option of column.domainValues\"\r\n                  [value]=\"option.id\"\r\n                  [disabled]=\"option.disabled\"\r\n                >\r\n                  {{ option.value }}\r\n                </mat-option>\r\n              </mat-select>\r\n              <input\r\n                matInput\r\n                type=\"text\"\r\n                [formControlName]=\"column.name\"\r\n                *ngIf=\"column.type === 'autocomplete'\"\r\n                [matAutocomplete]=\"auto\"\r\n                required=\"{{\r\n                  getValidationAttributeValue(column, 'mandatory')\r\n                }}\"\r\n                value=\"{{ row.cellData[column.name].value }}\"\r\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\r\n              />\r\n              <mat-autocomplete\r\n                #auto=\"matAutocomplete\"\r\n                (optionSelected)=\"\r\n                  onAutocompleteValueChange(column, row.record, $event)\r\n                \"\r\n                panelWidth=\"430px\"\r\n              >\r\n                <mat-option\r\n                  *ngFor=\"let option of filteredOptions[column.name] | async\"\r\n                  [value]=\"option.id\"\r\n                >\r\n                  {{ option.value }}\r\n                </mat-option>\r\n              </mat-autocomplete>\r\n            </td>\r\n            <ng-template #isUnsanitizedHTML>\r\n              <td\r\n                mat-cell\r\n                class=\"mat-cell-text\"\r\n                *ngIf=\"\r\n                  !row.cellData[column.name].isUrl;\r\n                  else isAnUrlUnsanitizedHTML\r\n                \"\r\n                [ngClass]=\"row.cellData[column.name].class\"\r\n                [innerHTML]=\"row.cellData[column.name].value | sanitizeHtml\"\r\n              ></td>\r\n              <ng-template #isAnUrlUnsanitizedHTML>\r\n                <td\r\n                  mat-cell\r\n                  class=\"mat-cell-text\"\r\n                  [ngClass]=\"row.cellData[column.name].class\"\r\n                >\r\n                  <a\r\n                    href=\"{{ row.cellData[column.name].value }}\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    (click)=\"$event.stopPropagation()\"\r\n                  >\r\n                    <img\r\n                      igoImageError\r\n                      *ngIf=\"row.cellData[column.name].isImg; else notImg\"\r\n                      src=\"{{\r\n                        row.cellData[column.name].value | secureImage | async\r\n                      }}\"\r\n                      width=\"50\"\r\n                      heigth=\"auto\"\r\n                    />\r\n                    <ng-template #notImg\r\n                      ><span\r\n                        >{{ 'igo.geo.targetHtmlUrl' | translate }}\r\n                      </span></ng-template\r\n                    >\r\n                  </a>\r\n                </td>\r\n              </ng-template>\r\n            </ng-template>\r\n          </ng-container>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\r\n          <td\r\n            mat-cell\r\n            *matCellDef=\"let row\"\r\n            class=\"mat-cell-text\"\r\n            [ngClass]=\"row.cellData[column.name].class\"\r\n          >\r\n            <mat-icon\r\n              *ngIf=\"column.onClick\"\r\n              svgIcon=\"{{ row.cellData[column.name].value || column.icon }}\"\r\n              (click)=\"column.onClick($event)\"\r\n            ></mat-icon>\r\n            <mat-icon\r\n              *ngIf=\"!column.onClick\"\r\n              svgIcon=\"{{ row.cellData[column.name].value || column.icon }}\"\r\n            ></mat-icon>\r\n          </td>\r\n        </ng-container>\r\n        <ng-container\r\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\"\r\n        >\r\n          <ng-container *matCellDef=\"let row\">\r\n            <td\r\n              mat-cell\r\n              class=\"mat-cell-text\"\r\n              [ngClass]=\"row.cellData[column.name].class\"\r\n            >\r\n              <span *ngFor=\"let button of row.cellData[column.name].value\">\r\n                <ng-container\r\n                  *ngIf=\"\r\n                    isEdition(row.record) === button.editMode ||\r\n                    button.editMode === undefined\r\n                  \"\r\n                >\r\n                  <button\r\n                    *ngIf=\"button.style === 'mat-icon-button'\"\r\n                    igoStopPropagation\r\n                    mat-icon-button\r\n                    [color]=\"button.color\"\r\n                    (mousedown)=\"onButtonClick(button.click, row.record)\"\r\n                    [disabled]=\"button.disabled\"\r\n                  >\r\n                    <mat-icon svgIcon=\"{{ button.icon }}\"></mat-icon>\r\n                  </button>\r\n                  <button\r\n                    *ngIf=\"button.style !== 'mat-icon-button'\"\r\n                    igoStopPropagation\r\n                    mat-mini-fab\r\n                    [color]=\"button.color\"\r\n                    (mousedown)=\"onButtonClick(button.click, row.record)\"\r\n                    [disabled]=\"button.disabled\"\r\n                  >\r\n                    <mat-icon svgIcon=\"{{ button.icon }}\"></mat-icon>\r\n                  </button>\r\n                </ng-container>\r\n              </span>\r\n            </td>\r\n          </ng-container>\r\n        </ng-container>\r\n      </ng-container>\r\n    </ng-container>\r\n\r\n    <tr\r\n      mat-header-row\r\n      *matHeaderRowDef=\"headers; sticky: fixedHeader\"\r\n      [ngClass]=\"getHeaderClass()\"\r\n    ></tr>\r\n    <tr\r\n      mat-row\r\n      igoEntityTableRow\r\n      *matRowDef=\"let row; columns: headers\"\r\n      [scrollBehavior]=\"scrollBehavior\"\r\n      [ngClass]=\"getRowClass(row.record)\"\r\n      [selection]=\"selection\"\r\n      [selected]=\"rowIsSelected(row.record)\"\r\n      (select)=\"onRowSelect(row.record)\"\r\n      (click)=\"onRowClick(row.record)\"\r\n    ></tr>\r\n  </table>\r\n  <igo-entity-table-paginator\r\n    *ngIf=\"withPaginator\"\r\n    [store]=\"store\"\r\n    [paginatorOptions]=\"paginatorOptions\"\r\n    [entitySortChange$]=\"entitySortChange$\"\r\n    (paginatorChange)=\"paginatorChange($event)\"\r\n  >\r\n  </igo-entity-table-paginator>\r\n</div>\r\n","import { FocusMonitor } from '@angular/cdk/a11y';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ElementRef,\r\n  EventEmitter,\r\n  Input,\r\n  OnChanges,\r\n  OnDestroy,\r\n  OnInit,\r\n  Optional,\r\n  Output,\r\n  Self,\r\n  SimpleChanges\r\n} from '@angular/core';\r\nimport {\r\n  FormControlName,\r\n  NgControl,\r\n  NgForm,\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup\r\n} from '@angular/forms';\r\nimport { DateAdapter, ErrorStateMatcher } from '@angular/material/core';\r\nimport { MatFormFieldControl } from '@angular/material/form-field';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { MatTableDataSource } from '@angular/material/table';\r\n\r\nimport { StringUtils } from '@igo2/utils';\r\n\r\nimport { default as moment } from 'moment';\r\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\r\nimport { debounceTime, map } from 'rxjs/operators';\r\n\r\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\r\nimport {\r\n  EntityKey,\r\n  EntityRecord,\r\n  EntityState,\r\n  EntityStore,\r\n  EntityTableColumn,\r\n  EntityTableColumnRenderer,\r\n  EntityTableScrollBehavior,\r\n  EntityTableSelectionState,\r\n  EntityTableTemplate\r\n} from '../shared';\r\n\r\ninterface CellData {\r\n  [key: string]: {\r\n    value: any;\r\n    class: { [key: string]: boolean };\r\n    isUrl: boolean;\r\n    isImg: boolean;\r\n  };\r\n}\r\n\r\ninterface RowData {\r\n  record: EntityRecord<object, EntityState>;\r\n  cellData: CellData;\r\n}\r\n\r\n@Component({\r\n  selector: 'igo-entity-table',\r\n  templateUrl: './entity-table.component.html',\r\n  styleUrls: ['./entity-table.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  providers: [\r\n    { provide: MatFormFieldControl, useExisting: EntityTableComponent }\r\n  ]\r\n})\r\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy {\r\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public formGroup: UntypedFormGroup = new UntypedFormGroup({});\r\n\r\n  public filteredOptions = {};\r\n\r\n  /**\r\n   * Reference to the column renderer types\r\n   * @internal\r\n   */\r\n  entityTableColumnRenderer = EntityTableColumnRenderer;\r\n\r\n  /**\r\n   * Reference to the selection's state\r\n   * @internal\r\n   */\r\n  entityTableSelectionState = EntityTableSelectionState;\r\n\r\n  /**\r\n   * Observable of the selection,s state\r\n   * @internal\r\n   */\r\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Subscription to the store's selection\r\n   */\r\n  private selection$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the dataSource\r\n   */\r\n  private dataSource$$: Subscription;\r\n\r\n  /**\r\n   * The last record checked. Useful for selecting\r\n   * multiple records by holding the shift key and checking\r\n   * checkboxes.\r\n   */\r\n  private lastRecordCheckedKey: EntityKey;\r\n\r\n  /**\r\n   * Entity store\r\n   */\r\n  @Input() store: EntityStore<object>;\r\n\r\n  /**\r\n   * Table paginator\r\n   */\r\n  @Input() set paginator(value: MatPaginator) {\r\n    this._paginator = value;\r\n    this.dataSource.paginator = value;\r\n  }\r\n\r\n  get paginator(): MatPaginator {\r\n    return this._paginator;\r\n  }\r\n  private _paginator: MatPaginator;\r\n\r\n  /**\r\n   * Table template\r\n   */\r\n  @Input() template: EntityTableTemplate;\r\n\r\n  /**\r\n   * Scroll behavior on selection\r\n   */\r\n  @Input()\r\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\r\n\r\n  /**\r\n   * Whether nulls should be first when sorting\r\n   */\r\n  @Input()\r\n  sortNullsFirst: boolean = false;\r\n\r\n  /**\r\n   * Show the table paginator or not. False by default.\r\n   */\r\n  @Input()\r\n  withPaginator: boolean = false;\r\n\r\n  /**\r\n   * Paginator options\r\n   */\r\n  @Input()\r\n  paginatorOptions: EntityTablePaginatorOptions;\r\n\r\n  /**\r\n   * Event emitted when an entity (row) is clicked\r\n   */\r\n  @Output() entityClick = new EventEmitter<object>();\r\n\r\n  /**\r\n   * Event emitted when an entity (row) is selected\r\n   */\r\n  @Output() entitySelectChange = new EventEmitter<{\r\n    added: object[];\r\n  }>();\r\n\r\n  /**\r\n   * Event emitted when the table sort is changed.\r\n   */\r\n  @Output() entitySortChange: EventEmitter<{\r\n    column: EntityTableColumn;\r\n    direction: string;\r\n  }> = new EventEmitter(undefined);\r\n\r\n  /**\r\n   * Table headers\r\n   * @internal\r\n   */\r\n  get headers(): string[] {\r\n    let columns = this.template.columns\r\n      .filter((column: EntityTableColumn) => column.visible !== false)\r\n      .map((column: EntityTableColumn) => column.name);\r\n\r\n    if (this.selectionCheckbox === true) {\r\n      columns = ['selectionCheckbox'].concat(columns);\r\n    }\r\n\r\n    return columns;\r\n  }\r\n\r\n  /**\r\n   * Data source consumable by the underlying material table\r\n   * @internal\r\n   */\r\n  dataSource = new MatTableDataSource<RowData>();\r\n\r\n  /**\r\n   * Whether selection is supported\r\n   * @internal\r\n   */\r\n  get selection(): boolean {\r\n    return this.template.selection || false;\r\n  }\r\n\r\n  /**\r\n   * Whether a selection checkbox should be displayed\r\n   * @internal\r\n   */\r\n  get selectionCheckbox(): boolean {\r\n    return this.template.selectionCheckbox || false;\r\n  }\r\n\r\n  /**\r\n   * Whether selection many entities should eb supported\r\n   * @internal\r\n   */\r\n  get selectMany(): boolean {\r\n    return this.template.selectMany || false;\r\n  }\r\n\r\n  /**\r\n   * Whether selection many entities should eb supported\r\n   * @internal\r\n   */\r\n  get fixedHeader(): boolean {\r\n    return this.template.fixedHeader === undefined\r\n      ? true\r\n      : this.template.fixedHeader;\r\n  }\r\n\r\n  get tableHeight(): string {\r\n    return this.template.tableHeight ? this.template.tableHeight : 'auto';\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private formBuilder: UntypedFormBuilder,\r\n    protected _focusMonitor: FocusMonitor,\r\n    protected _elementRef: ElementRef<HTMLElement>,\r\n    @Optional() @Self() public ngControl: NgControl,\r\n    @Optional() protected _parentForm: NgForm,\r\n    @Optional() protected _controlName: FormControlName,\r\n    protected _defaultErrorStateMatcher: ErrorStateMatcher,\r\n    private dateAdapter: DateAdapter<Date>\r\n  ) {\r\n    this.dateAdapter.setLocale('fr-CA');\r\n  }\r\n\r\n  /**\r\n   * Track the selection state to properly display the selection checkboxes\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.handleDatasource();\r\n    this.dataSource.paginator = this.paginator;\r\n    this.store.state.change$.pipe(debounceTime(100)).subscribe(() => {\r\n      this.handleDatasource();\r\n      this.refresh();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const store = changes.store;\r\n    if (store && store.currentValue !== store.previousValue) {\r\n      this.handleDatasource();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process text or number value change (edition)\r\n   */\r\n  onValueChange(column: string, record: EntityRecord<any>, event) {\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\r\n    record.entity.properties[key] = event.target.value;\r\n  }\r\n\r\n  /**\r\n   * Process boolean value change (edition)\r\n   */\r\n  onBooleanValueChange(column: string, record: EntityRecord<any>, event) {\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\r\n    record.entity.properties[key] = event.checked;\r\n  }\r\n\r\n  /**\r\n   * Process select value change (edition)\r\n   */\r\n  onSelectValueChange(column: string, record: EntityRecord<any>, event) {\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\r\n    record.entity.properties[key] = event.value;\r\n  }\r\n\r\n  /**\r\n   * Process autocomplete value change (edition)\r\n   */\r\n  onAutocompleteValueChange(\r\n    column: EntityTableColumn,\r\n    record: EntityRecord<any>,\r\n    event\r\n  ) {\r\n    this.formGroup.controls[column.name].setValue(event.option.viewValue);\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column.name);\r\n    record.entity.properties[key] = event.option.value;\r\n  }\r\n\r\n  /**\r\n   * Process date value change (edition)\r\n   */\r\n  onDateChange(column: string, record: EntityRecord<any>, event) {\r\n    const format = 'YYYY-MM-DD';\r\n    const value = moment(event.value).format(format);\r\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\r\n    record.entity.properties[key] = value;\r\n  }\r\n\r\n  /**\r\n   * Enable edition mode for one row\r\n   * More than one row can be edited at the same time\r\n   */\r\n  private enableEdit(record: EntityRecord<any>) {\r\n    const item = record.entity.properties || record.entity;\r\n    this.template.columns.forEach((column) => {\r\n      column.title =\r\n        column.validation?.mandatory && !column.title.includes('*')\r\n          ? column.title + ' *'\r\n          : column.title;\r\n\r\n      const key = this.getColumnKeyWithoutPropertiesTag(column.name);\r\n      if (column.type === 'boolean') {\r\n        if (!item[key] || item[key] === null) {\r\n          item[key] = false;\r\n        } else if (typeof item[key] === 'string') {\r\n          item[key] = JSON.parse(item[key].toLowerCase());\r\n        }\r\n        this.formGroup.setControl(\r\n          column.name,\r\n          this.formBuilder.control(item[key])\r\n        );\r\n      } else if (column.type === 'list') {\r\n        if (column.multiple) {\r\n          this.formGroup.setControl(\r\n            column.name,\r\n            this.formBuilder.control([item[key]])\r\n          );\r\n        } else {\r\n          this.formGroup.setControl(\r\n            column.name,\r\n            this.formBuilder.control(item[key])\r\n          );\r\n\r\n          typeof item[key] === 'string'\r\n            ? this.formGroup.controls[column.name].setValue(parseInt(item[key]))\r\n            : this.formGroup.controls[column.name].setValue(item[key]);\r\n        }\r\n      } else if (column.type === 'autocomplete') {\r\n        this.formGroup.setControl(\r\n          column.name,\r\n          this.formBuilder.control(item[key])\r\n        );\r\n\r\n        this.filteredOptions[column.name] = new Observable<any[]>();\r\n        this.filteredOptions[column.name] = this.formGroup.controls[\r\n          column.name\r\n        ].valueChanges.pipe(\r\n          map((value) => {\r\n            if (value?.length) {\r\n              return column.domainValues?.filter((option) => {\r\n                const filterNormalized = value\r\n                  ? value\r\n                      .toLowerCase()\r\n                      .normalize('NFD')\r\n                      .replace(/[\\u0300-\\u036f]/g, '')\r\n                  : '';\r\n                const featureNameNormalized = option.value\r\n                  .toLowerCase()\r\n                  .normalize('NFD')\r\n                  .replace(/[\\u0300-\\u036f]/g, '');\r\n                return featureNameNormalized.includes(filterNormalized);\r\n              });\r\n            }\r\n          })\r\n        );\r\n\r\n        let formControlValue = item[key];\r\n        column.domainValues.forEach((option) => {\r\n          if (\r\n            typeof formControlValue === 'string' &&\r\n            StringUtils.isValidNumber(formControlValue) &&\r\n            !StringUtils.isOctalNumber(formControlValue)\r\n          ) {\r\n            formControlValue = parseInt(formControlValue);\r\n          }\r\n          if (\r\n            option.value === formControlValue ||\r\n            option.id === formControlValue\r\n          ) {\r\n            formControlValue = option.value;\r\n          }\r\n        });\r\n\r\n        this.formGroup.controls[column.name].setValue(formControlValue);\r\n        if (this.isEdition(record) && column.linkColumnForce) {\r\n          const entity = record.entity as any;\r\n          this.formGroup.controls[column.name].setValue(\r\n            entity?.properties[\r\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\r\n            ]\r\n          );\r\n        }\r\n      } else if (column.type === 'date') {\r\n        if (column.visible !== false) {\r\n          if (item[key]) {\r\n            let date = moment(item[key]);\r\n            item[key] = date.utc().format('YYYY-MM-DD');\r\n            this.formGroup.setControl(\r\n              column.name,\r\n              this.formBuilder.control(item[key])\r\n            );\r\n          } else {\r\n            const newKey = this.getColumnKeyWithoutPropertiesTag(column.name);\r\n            record.entity.properties[newKey] = null;\r\n            this.formGroup.setControl(\r\n              column.name,\r\n              this.formBuilder.control(null)\r\n            );\r\n          }\r\n        }\r\n      } else {\r\n        this.formGroup.setControl(\r\n          column.name,\r\n          this.formBuilder.control(item[key])\r\n        );\r\n      }\r\n\r\n      if (\r\n        this.formGroup.controls[column.name] &&\r\n        this.getValidationAttributeValue(column, 'readonly')\r\n      ) {\r\n        this.formGroup.controls[column.name].disable();\r\n      }\r\n    });\r\n  }\r\n\r\n  private handleDatasource() {\r\n    this.unsubscribeStore();\r\n    this.selection$$ = this.store.stateView\r\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\r\n      .subscribe((records: EntityRecord<object>[]) => {\r\n        const firstSelected = records[0];\r\n        const firstSelectedStateviewPosition = this.store.stateView\r\n          .all()\r\n          .indexOf(firstSelected);\r\n        const pageMax = this.paginator\r\n          ? this.paginator.pageSize * (this.paginator.pageIndex + 1)\r\n          : 0;\r\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\r\n\r\n        if (\r\n          this.paginator &&\r\n          (firstSelectedStateviewPosition < pageMin ||\r\n            firstSelectedStateviewPosition >= pageMax)\r\n        ) {\r\n          const pageToReach = Math.floor(\r\n            firstSelectedStateviewPosition / this.paginator.pageSize\r\n          );\r\n          this.dataSource.paginator.pageIndex = pageToReach;\r\n        }\r\n        this.selectionState$.next(this.computeSelectionState(records));\r\n      });\r\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\r\n      if (all[0]) {\r\n        this.enableEdit(all[0]);\r\n      }\r\n      this.dataSource.data = all.map((record) => {\r\n        return {\r\n          record,\r\n          cellData: this.template.columns.reduce((cellData, column) => {\r\n            const value = this.getValue(record, column);\r\n            cellData[column.name] = {\r\n              class: this.getCellClass(record, column),\r\n              value,\r\n              isUrl: this.isUrl(value),\r\n              isImg: this.isImg(value)\r\n            };\r\n            return cellData;\r\n          }, {})\r\n        };\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unbind the store watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unsubscribeStore();\r\n  }\r\n\r\n  private unsubscribeStore() {\r\n    if (this.selection$$) {\r\n      this.selection$$.unsubscribe();\r\n    }\r\n    if (this.dataSource$$) {\r\n      this.dataSource$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trackby function\r\n   * @param record Record\r\n   * @param index Record index\r\n   * @internal\r\n   */\r\n  getTrackByFunction() {\r\n    return (index: number, record: EntityRecord<object, EntityState>) => {\r\n      return record.ref;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Trigger a refresh of thre table. This can be useful when\r\n   * the data source doesn't emit a new value but for some reason\r\n   * the records need an update.\r\n   * @internal\r\n   */\r\n  refresh() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  paginatorChange(event: MatPaginator) {\r\n    this.paginator = event;\r\n  }\r\n\r\n  /**\r\n   * On sort, sort the store\r\n   * @param event Sort event\r\n   * @internal\r\n   */\r\n  onSort(event: { active: string; direction: string }) {\r\n    const direction = event.direction;\r\n    const column = this.template.columns.find(\r\n      (c: EntityTableColumn) => c.name === event.active\r\n    );\r\n\r\n    if (direction === 'asc' || direction === 'desc') {\r\n      this.store.stateView.sort({\r\n        valueAccessor: (record: EntityRecord<object>) =>\r\n          this.getValue(record, column),\r\n        direction,\r\n        nullsFirst: this.sortNullsFirst\r\n      });\r\n      this.entitySortChange.emit({ column, direction });\r\n      this.entitySortChange$.next(true);\r\n    } else {\r\n      this.store.stateView.sort(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When an entity is clicked, emit an event\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onRowClick(record: EntityRecord<object>) {\r\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\r\n    this.entityClick.emit(record.entity);\r\n  }\r\n\r\n  /**\r\n   * When an entity is selected, select it in the store and emit an event. Even if\r\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\r\n   * multiple rows should be achieved by using the checkboxes.\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onRowSelect(record: EntityRecord<object>) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n\r\n    const entity = record.entity;\r\n    this.store.state.update(entity, { selected: true }, true);\r\n    this.entitySelectChange.emit({ added: [entity] });\r\n  }\r\n\r\n  /**\r\n   * Select or unselect all rows at once. On select, emit an event.\r\n   * @param toggle Select or unselect\r\n   * @internal\r\n   */\r\n  onToggleRows(toggle: boolean) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n\r\n    this.store.state.updateAll({ selected: toggle });\r\n    if (toggle === true) {\r\n      const entities = this.store.stateView\r\n        .all()\r\n        .map((record: EntityRecord<object>) => record.entity);\r\n      this.entitySelectChange.emit({ added: [entities] });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When an entity is toggled, select or unselect it in the store. On select,\r\n   * emit an event.\r\n   * @param toggle Select or unselect\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n\r\n    const entity = record.entity;\r\n    const exclusive = toggle === true && !this.selectMany;\r\n    this.store.state.update(entity, { selected: toggle }, exclusive);\r\n    if (toggle === true) {\r\n      this.entitySelectChange.emit({ added: [entity] });\r\n    }\r\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\r\n  }\r\n\r\n  /**\r\n   * When an entity is toggled, select or unselect it in the store. On select,\r\n   * emit an event.\r\n   * @param toggle Select or unselect\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onShiftToggleRow(\r\n    toggle: boolean,\r\n    record: EntityRecord<object>,\r\n    event: MouseEvent\r\n  ) {\r\n    if (this.selection === false) {\r\n      return;\r\n    }\r\n\r\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\r\n      this.onToggleRow(toggle, record);\r\n      return;\r\n    }\r\n\r\n    // This is a workaround mat checkbox wrong behavior\r\n    // when the shift key is held.\r\n    // See https://github.com/angular/components/issues/6232\r\n    const range = window.document.createRange();\r\n    range.selectNode(event.target as HTMLElement);\r\n    window.getSelection().removeAllRanges();\r\n    window.getSelection().addRange(range);\r\n    event.stopImmediatePropagation();\r\n\r\n    const records = this.store.stateView.all();\r\n    const recordIndex = records.indexOf(record);\r\n    const lastRecordChecked = this.store.stateView.get(\r\n      this.lastRecordCheckedKey\r\n    );\r\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\r\n    const indexes = [recordIndex, lastRecordIndex];\r\n    const selectRecords = records.slice(\r\n      Math.min(...indexes),\r\n      Math.max(...indexes) + 1\r\n    );\r\n\r\n    const entities = selectRecords.map(\r\n      (_record: EntityRecord<object>) => _record.entity\r\n    );\r\n    this.store.state.updateMany(entities, { selected: toggle });\r\n    if (toggle === true) {\r\n      this.entitySelectChange.emit({ added: entities });\r\n    }\r\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\r\n  }\r\n\r\n  /**\r\n   * Compute the selection state\r\n   * @returns Whether all, some or no rows are selected\r\n   * @internal\r\n   */\r\n  private computeSelectionState(\r\n    selectedRecords: EntityRecord<object>[]\r\n  ): EntityTableSelectionState {\r\n    const states = EntityTableSelectionState;\r\n    const selectionCount = selectedRecords.length;\r\n    return selectionCount === 0\r\n      ? states.None\r\n      : selectionCount === this.store.stateView.count\r\n      ? states.All\r\n      : states.Some;\r\n  }\r\n\r\n  /**\r\n   * Whether a column is sortable\r\n   * @param column Column\r\n   * @returns True if a column is sortable\r\n   * @internal\r\n   */\r\n  columnIsSortable(column: EntityTableColumn): boolean {\r\n    let sortable = column.sort;\r\n    if (sortable === undefined) {\r\n      sortable = this.template.sort === undefined ? false : this.template.sort;\r\n    }\r\n    return sortable;\r\n  }\r\n\r\n  /**\r\n   * Whether a row is should be selected based on the underlying entity state\r\n   * @param record Record\r\n   * @returns True if a row should be selected\r\n   * @internal\r\n   */\r\n  rowIsSelected(record: EntityRecord<object>): boolean {\r\n    const state = record.state;\r\n    return state.selected ? state.selected : false;\r\n  }\r\n\r\n  isImg(value) {\r\n    if (this.isUrl(value)) {\r\n      return (\r\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !==\r\n        -1\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  isUrl(value) {\r\n    if (typeof value === 'string') {\r\n      return (\r\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Method to access an entity's values\r\n   * @param record Record\r\n   * @param column Column\r\n   * @returns Any value\r\n   * @internal\r\n   */\r\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\r\n    const entity = record.entity;\r\n    let value;\r\n    if (column.valueAccessor !== undefined) {\r\n      return column.valueAccessor(entity, record);\r\n    }\r\n    if (this.template.valueAccessor !== undefined) {\r\n      return this.template.valueAccessor(entity, column.name, record);\r\n    }\r\n    value = this.store.getProperty(entity, column.name);\r\n\r\n    if (column.type === 'boolean') {\r\n      if (value === undefined || value === null || value === '') {\r\n        value = false;\r\n      } else if (typeof value !== 'boolean' && value !== undefined) {\r\n        if (typeof value === 'number') {\r\n          value = Boolean(value);\r\n        } else {\r\n          value = JSON.parse(value.toLowerCase());\r\n        }\r\n      }\r\n      if (!this.isEdition(record)) {\r\n        value = value ? '&#10003;' : ''; // check mark\r\n      }\r\n    } else if (column.type === 'list' && value && column.domainValues) {\r\n      const entity = record.entity as any;\r\n      if (column.multiple) {\r\n        let list_id;\r\n        typeof value === 'string'\r\n          ? (list_id = value.match(/[\\w.-]+/g).map(Number))\r\n          : (list_id = value);\r\n        let list_option = [];\r\n\r\n        column.domainValues.forEach((option) => {\r\n          if (list_id.includes(option.id)) {\r\n            if (record.edition) {\r\n              list_option.push(option.id);\r\n            } else {\r\n              list_option.push(option.value);\r\n            }\r\n          }\r\n        });\r\n\r\n        this.isEdition(record) ? (value = list_id) : (value = list_option);\r\n      } else {\r\n        if (!this.isEdition(record) && column.linkColumnForce) {\r\n          value =\r\n            entity?.properties[\r\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\r\n            ];\r\n        } else {\r\n          column.domainValues.forEach((option) => {\r\n            if (\r\n              typeof value === 'string' &&\r\n              StringUtils.isValidNumber(value) &&\r\n              !StringUtils.isOctalNumber(value)\r\n            ) {\r\n              value = parseInt(value);\r\n            }\r\n            if (option.value === value || option.id === value) {\r\n              this.isEdition(record)\r\n                ? (value = option.id)\r\n                : (value = option.value);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    } else if (column.type === 'autocomplete' && value && column.domainValues) {\r\n      const entity = record.entity as any;\r\n      if (!this.isEdition(record) && column.linkColumnForce) {\r\n        value =\r\n          entity?.properties[\r\n            this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\r\n          ];\r\n      } else {\r\n        column.domainValues.forEach((option) => {\r\n          if (\r\n            typeof value === 'string' &&\r\n            StringUtils.isValidNumber(value) &&\r\n            !StringUtils.isOctalNumber(value)\r\n          ) {\r\n            value = parseInt(value);\r\n          }\r\n          if (option.value === value || option.id === value) {\r\n            value = option.value;\r\n          }\r\n        });\r\n      }\r\n    } else if (column.type === 'date') {\r\n      if (this.isEdition(record)) {\r\n        if (value) {\r\n          let date = moment(value);\r\n          value = date.format();\r\n          this.formGroup.controls[column.name].setValue(value);\r\n        }\r\n      } else if (!this.isEdition(record) && value === null) {\r\n        value = '';\r\n      }\r\n    }\r\n\r\n    if (value === undefined) {\r\n      value = '';\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Method to access an entity's validation values\r\n   * @param column Column\r\n   * @param validationType string\r\n   * @returns Any value (false if no validation or not the one concerned)\r\n   * @internal\r\n   */\r\n  getValidationAttributeValue(\r\n    column: EntityTableColumn,\r\n    validationType: string\r\n  ): any {\r\n    if (\r\n      column.validation !== undefined &&\r\n      column.validation[validationType] !== undefined\r\n    ) {\r\n      return column.validation[validationType];\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public isEdition(record) {\r\n    return record.entity.edition ? true : false;\r\n  }\r\n\r\n  /**\r\n   * Return the type of renderer of a column\r\n   * @param column Column\r\n   * @returns Renderer type\r\n   * @internal\r\n   */\r\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\r\n    if (column.renderer !== undefined) {\r\n      return column.renderer;\r\n    }\r\n    return EntityTableColumnRenderer.Default;\r\n  }\r\n\r\n  /**\r\n   * Return the table ngClass\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getTableClass(): { [key: string]: boolean } {\r\n    return {\r\n      'igo-entity-table-with-selection': this.selection\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Return a header ngClass\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getHeaderClass(): { [key: string]: boolean } {\r\n    const func = this.template.headerClassFunc;\r\n    if (func instanceof Function) {\r\n      return func();\r\n    }\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Return a row ngClass\r\n   * @param record Record\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getRowClass(record: EntityRecord<object>): { [key: string]: boolean } {\r\n    const entity = record.entity;\r\n    const func = this.template.rowClassFunc;\r\n    if (func instanceof Function) {\r\n      return func(entity, record);\r\n    }\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Return a row ngClass\r\n   * @param record Record\r\n   * @param column Column\r\n   * @returns ngClass\r\n   * @internal\r\n   */\r\n  getCellClass(\r\n    record: EntityRecord<object>,\r\n    column: EntityTableColumn\r\n  ): { [key: string]: boolean } {\r\n    const entity = record.entity;\r\n    const cls = {};\r\n\r\n    const tableFunc = this.template.cellClassFunc;\r\n    if (tableFunc instanceof Function) {\r\n      Object.assign(cls, tableFunc(entity, column, record));\r\n    }\r\n\r\n    const columnFunc = column.cellClassFunc;\r\n    if (columnFunc instanceof Function) {\r\n      Object.assign(cls, columnFunc(entity, record));\r\n    }\r\n\r\n    return cls;\r\n  }\r\n\r\n  /**\r\n   * When a button is clicked\r\n   * @param func Function\r\n   * @param record Record\r\n   * @internal\r\n   */\r\n  onButtonClick(\r\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\r\n    record: EntityRecord<object>\r\n  ) {\r\n    this.enableEdit(record);\r\n    if (typeof clickFunc === 'function') {\r\n      clickFunc(record.entity, record);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieve column name without his \"properties\" tag (useful for edition workspace properties)\r\n   */\r\n  public getColumnKeyWithoutPropertiesTag(column: string) {\r\n    if (column.includes('properties.')) {\r\n      return column.split('.')[1];\r\n    }\r\n    return column;\r\n  }\r\n}\r\n","import { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { EntityRecord, EntityStore } from '../../entity';\r\nimport { Tool, ToolboxOptions } from './tool.interface';\r\n\r\n/**\r\n * Service where all available tools and their component are registered.\r\n */\r\nexport class Toolbox {\r\n  /**\r\n   * Observable of the active tool\r\n   */\r\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Ordered list of tool names to display in a toolbar\r\n   */\r\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * Observable of the active tool\r\n   */\r\n  private activeTool$$: Subscription;\r\n\r\n  /**\r\n   * Active tool history. Useful for activating the previous tool.\r\n   */\r\n  private activeToolHistory: string[] = [];\r\n\r\n  /**\r\n   * Tool store\r\n   */\r\n  private store = new EntityStore<Tool>([], {\r\n    getKey: (tool: Tool) => tool.name\r\n  });\r\n\r\n  get tools$(): BehaviorSubject<Tool[]> {\r\n    return this.store.entities$;\r\n  }\r\n\r\n  constructor(private options: ToolboxOptions = {}) {\r\n    this.setToolbar(options.toolbar);\r\n    this.initStore();\r\n  }\r\n\r\n  /**\r\n   * Destroy the toolbox\r\n   */\r\n  destroy() {\r\n    this.activeTool$$.unsubscribe();\r\n    this.store.destroy();\r\n  }\r\n\r\n  /**\r\n   * Return a tool\r\n   * @param name Tool name\r\n   * @returns tool Tool\r\n   */\r\n  getTool(name: string): Tool {\r\n    return this.store.get(name);\r\n  }\r\n\r\n  /**\r\n   * Return all tools\r\n   * @returns Array of tools\r\n   */\r\n  getTools(): Tool[] {\r\n    return this.store.all();\r\n  }\r\n\r\n  /**\r\n   * Set tool configurations\r\n   * @param tools Tools\r\n   */\r\n  setTools(tools: Tool[]) {\r\n    this.store.load(tools);\r\n  }\r\n\r\n  /**\r\n   * Get toolbar\r\n   * @returns Toolbar value\r\n   */\r\n  getToolbar(): string[] {\r\n    return this.toolbar$.getValue();\r\n  }\r\n\r\n  /**\r\n   * Set toolbar\r\n   * @param toolbar A list of tool names\r\n   */\r\n  setToolbar(toolbar: string[]) {\r\n    this.toolbar$.next(toolbar || []);\r\n  }\r\n\r\n  /**\r\n   * Activate a tool (and deactivate other tools)\r\n   * @param name Tool name\r\n   * @param options Tool options\r\n   */\r\n  activateTool(name: string, options: { [key: string]: any } = {}) {\r\n    const tool = this.getTool(name);\r\n    if (tool === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.store.state.update(tool, { active: true, options }, true);\r\n  }\r\n\r\n  /**\r\n   * Activate the previous tool, if any\r\n   */\r\n  activatePreviousTool() {\r\n    if (this.activeToolHistory.length <= 1) {\r\n      this.deactivateTool();\r\n      return;\r\n    }\r\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\r\n    this.activateTool(previous);\r\n  }\r\n\r\n  /**\r\n   * Activate the tool below, if any\r\n   */\r\n  /* activateBelowTool() {\r\n    const arrayTools = this.getToolbar();\r\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\r\n    if (arrayTools[index + 1] !== undefined) {\r\n      this.deactivateTool();\r\n      const below = arrayTools[index + 1];\r\n      this.activateTool(below);\r\n    } else {\r\n      this.deactivateTool();\r\n      const below = arrayTools[0];\r\n      this.activateTool(below);\r\n    }\r\n  } */\r\n\r\n  /**\r\n   * Activate the tool above, if any\r\n   */\r\n  /* activateAboveTool() {\r\n    const arrayTools = this.getToolbar();\r\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\r\n    if (arrayTools[index - 1] !== undefined) {\r\n      this.deactivateTool();\r\n      const above = arrayTools[index - 1];\r\n      this.activateTool(above);\r\n    } else {\r\n      this.deactivateTool();\r\n      const above = arrayTools[arrayTools.length - 1];\r\n      this.activateTool(above);\r\n    }\r\n  } */\r\n\r\n  /**\r\n   * Deactivate the active tool\r\n   */\r\n  deactivateTool() {\r\n    this.clearActiveToolHistory();\r\n    this.store.state.updateAll({ active: false });\r\n  }\r\n\r\n  /**\r\n   * Initialize the tool store and start observing the active tool\r\n   */\r\n  private initStore() {\r\n    this.store = new EntityStore<Tool>([], {\r\n      getKey: (entity: Tool) => entity.name\r\n    });\r\n\r\n    this.activeTool$$ = this.store.stateView\r\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\r\n      .subscribe((record: EntityRecord<Tool>) => {\r\n        if (record === undefined) {\r\n          this.setActiveTool(undefined);\r\n          return;\r\n        }\r\n\r\n        const tool = record.entity;\r\n        const options = Object.assign(\r\n          {},\r\n          tool.options || {},\r\n          record.state.options || {}\r\n        );\r\n        this.setActiveTool(Object.assign({}, tool, { options }));\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Set the active tool and update the tool history\r\n   * @param tool Tool\r\n   */\r\n  private setActiveTool(tool: Tool | undefined) {\r\n    this.activeTool$.next(tool);\r\n    if (tool === undefined) {\r\n      this.clearActiveToolHistory();\r\n    } else {\r\n      this.activeToolHistory = this.activeToolHistory\r\n        .filter((name: string) => name !== tool.name)\r\n        .concat([tool.name]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the tool history\r\n   */\r\n  private clearActiveToolHistory() {\r\n    this.activeToolHistory = [];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport { Tool } from './tool.interface';\nimport { Toolbox } from './toolbox';\n\n/**\n * Service where runtime tool configurations are registered\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolService {\n  static tools: { [key: string]: Tool } = {};\n\n  /**\n   * Toolbox that holds main tools\n   */\n  public toolbox: Toolbox = new Toolbox();\n\n  static register(tool: Tool) {\n    ToolService.tools[tool.name] = tool;\n  }\n\n  constructor() {\n    this.toolbox.setTools(this.getTools());\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return ToolService.tools[name];\n  }\n\n  /**\n   * Return all tools\n   * @returns tTols\n   */\n  getTools(): Tool[] {\n    return Object.values(ToolService.tools);\n  }\n}\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoActionModule } from '../../action/action.module';\r\nimport { IgoDynamicComponentModule } from '../../dynamic-component/dynamic-component.module';\r\nimport { ToolboxComponent } from './toolbox.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoActionModule, IgoDynamicComponentModule],\r\n  exports: [ToolboxComponent],\r\n  declarations: [ToolboxComponent]\r\n})\r\nexport class IgoToolboxModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { ToolService } from './shared/tool.service';\r\nimport { IgoToolboxModule } from './toolbox/toolbox.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [IgoToolboxModule],\r\n  declarations: []\r\n})\r\nexport class IgoToolModule {\r\n  static forRoot(): ModuleWithProviders<IgoToolModule> {\r\n    return {\r\n      ngModule: IgoToolModule,\r\n      providers: [ToolService]\r\n    };\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { DynamicComponentService } from '../../dynamic-component/shared/dynamic-component.service';\r\nimport { Widget } from './widget';\r\nimport { WidgetComponent } from './widget.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WidgetService {\r\n  constructor(private dynamicComponentService: DynamicComponentService) {}\r\n\r\n  create(widgetCls: any): Widget {\r\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoDynamicComponentModule } from '../../dynamic-component/dynamic-component.module';\r\nimport { WidgetOutletComponent } from './widget-outlet.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoDynamicComponentModule],\r\n  exports: [WidgetOutletComponent],\r\n  declarations: [WidgetOutletComponent]\r\n})\r\nexport class IgoWidgetOutletModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { WidgetService } from './shared/widget.service';\r\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, IgoWidgetOutletModule],\r\n  exports: [IgoWidgetOutletModule],\r\n  declarations: [],\r\n  providers: [WidgetService]\r\n})\r\nexport class IgoWidgetModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoEntitySelectorModule } from '../../entity/entity-selector/entity-selector.module';\r\nimport { WorkspaceSelectorComponent } from './workspace-selector.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoEntitySelectorModule],\r\n  exports: [WorkspaceSelectorComponent],\r\n  declarations: [WorkspaceSelectorComponent]\r\n})\r\nexport class IgoWorkspaceSelectorModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoWidgetOutletModule } from '../../widget/widget-outlet/widget-outlet.module';\r\nimport { WorkspaceWidgetOutletComponent } from './workspace-widget-outlet.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoWidgetOutletModule],\r\n  exports: [WorkspaceWidgetOutletComponent],\r\n  declarations: [WorkspaceWidgetOutletComponent]\r\n})\r\nexport class IgoWorkspaceWidgetOutletModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\r\nimport { IgoWorkspaceWidgetOutletModule } from './workspace-widget-outlet/workspace-widget-outlet.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [IgoWorkspaceSelectorModule, IgoWorkspaceWidgetOutletModule],\r\n  declarations: []\r\n})\r\nexport class IgoWorkspaceModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { CommonModule } from '@angular/common';\r\nimport { OverlayModule } from '@angular/cdk/overlay';\r\nimport { ColorChromeModule } from 'ngx-color/chrome';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\n\r\nimport { ColorPickerFormFieldComponent } from './color-picker-form-field.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    FormsModule,\r\n    MatButtonModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    OverlayModule,\r\n    ColorChromeModule,\r\n    TranslateModule\r\n  ],\r\n  declarations: [ColorPickerFormFieldComponent],\r\n  exports: [ColorPickerFormFieldComponent]\r\n})\r\nexport class ColorPickerFormFieldModule {}\r\n","export enum ActionbarMode {\n  Dock = 'dock',\n  Overlay = 'overlay',\n  Context = 'context'\n}\n","import { EntityStore } from '../../entity';\nimport { Action } from './action.interfaces';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * actions.\n */\nexport class ActionStore extends EntityStore<Action> {}\n","<mat-list-item\n  *ngIf=\"!action.checkbox\"\n  class=\"actionbar-item\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n  (click)=\"onClick()\"\n>\n  <button\n    *ngIf=\"withIcon\"\n    matListItemAvatar\n    mat-icon-button\n    [color]=\"color\"\n    [disabled]=\"disabled$ | async\"\n    [disableRipple]=\"true\"\n  >\n    <mat-icon *ngIf=\"withIcon\" svgIcon=\"{{ icon$ | async }}\"></mat-icon>\n  </button>\n  <span *ngIf=\"withTitle\" matLine>{{ title | translate }}</span>\n</mat-list-item>\n\n<mat-list-item\n  class=\"item-checkbox\"\n  *ngIf=\"action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n>\n  <mat-checkbox\n    *ngIf=\"withTitle\"\n    (change)=\"action.handler()\"\n    [checked]=\"checkCondition$ | async\"\n  >\n    {{ title | translate }}\n  </mat-checkbox>\n</mat-list-item>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\r\n\r\nimport { Action } from '../shared/action.interfaces';\r\n\r\n/**\r\n * An action button\r\n */\r\n@Component({\r\n  selector: 'igo-actionbar-item',\r\n  templateUrl: './actionbar-item.component.html',\r\n  styleUrls: ['./actionbar-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\r\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  readonly ngClass$: BehaviorSubject<{ [key: string]: boolean }> =\r\n    new BehaviorSubject({});\r\n\r\n  private ngClass$$: Subscription;\r\n\r\n  private disabled$$: Subscription;\r\n\r\n  private availability$$: Subscription;\r\n\r\n  private icon$$: Subscription;\r\n\r\n  private checkCondition$$: Subscription;\r\n\r\n  private tooltip$$: Subscription;\r\n\r\n  private noDisplay$$: Subscription;\r\n\r\n  private display$$: Subscription;\r\n\r\n  /**\r\n   * Action\r\n   */\r\n  @Input() action: Action;\r\n\r\n  /**\r\n   * Color\r\n   */\r\n  @Input() color = 'default';\r\n\r\n  /**\r\n   * Whether the action title is displayed\r\n   */\r\n  @Input() withTitle = true;\r\n\r\n  /**\r\n   * Whether the action icon is displayed\r\n   */\r\n  @Input() withIcon = true;\r\n\r\n  /**\r\n   * Whether a tooltip should be shown\r\n   */\r\n  @Input() withTooltip = true;\r\n\r\n  /**\r\n   * Whether the action is disabled\r\n   */\r\n  @Input()\r\n  set disabled(value: boolean) {\r\n    this.disabled$.next(value);\r\n  }\r\n  get disabled(): boolean {\r\n    return this.disabled$.value;\r\n  }\r\n\r\n  /**\r\n   * Whether the action is display or not\r\n   */\r\n  @Input()\r\n  set noDisplay(value: boolean) {\r\n    this.noDisplay$.next(value);\r\n  }\r\n  get noDisplay(): boolean {\r\n    return this.noDisplay$.value;\r\n  }\r\n\r\n  /**\r\n   * Event emitted when the action button is clicked\r\n   */\r\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return this.action.title;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    const args = this.action.args || [];\r\n\r\n    if (this.action.ngClass !== undefined) {\r\n      this.ngClass$$ = this.action\r\n        .ngClass(...args)\r\n        .subscribe((ngClass: { [key: string]: boolean }) =>\r\n          this.updateNgClass(ngClass)\r\n        );\r\n    }\r\n\r\n    if (isObservable(this.action.icon)) {\r\n      this.icon$$ = this.action.icon.subscribe((icon: string) =>\r\n        this.updateIcon(icon)\r\n      );\r\n    } else {\r\n      this.updateIcon(this.action.icon);\r\n    }\r\n\r\n    if (isObservable(this.action.checkCondition)) {\r\n      this.checkCondition$$ = this.action.checkCondition.subscribe(\r\n        (checkCondition: boolean) => this.updateCheckCondition(checkCondition)\r\n      );\r\n    } else {\r\n      this.updateCheckCondition(this.action.checkCondition);\r\n    }\r\n\r\n    if (isObservable(this.action.tooltip)) {\r\n      this.tooltip$$ = this.action.tooltip.subscribe((tooltip: string) =>\r\n        this.updateTooltip(tooltip)\r\n      );\r\n    } else {\r\n      this.updateTooltip(this.action.tooltip);\r\n    }\r\n\r\n    if (this.action.availability !== undefined) {\r\n      this.availability$$ = this.action\r\n        .availability(...args)\r\n        .subscribe((available: boolean) => (this.disabled = !available));\r\n    }\r\n\r\n    this.disabled$$ = this.disabled$.subscribe((disabled: boolean) =>\r\n      this.updateNgClass({ 'igo-actionbar-item-disabled': disabled })\r\n    );\r\n\r\n    if (this.action.display !== undefined) {\r\n      this.display$$ = this.action\r\n        .display(...args)\r\n        .subscribe((display: boolean) => (this.noDisplay = !display));\r\n    }\r\n\r\n    this.noDisplay$$ = this.noDisplay$.subscribe((noDisplay: boolean) =>\r\n      this.updateNgClass({ 'igo-actionbar-item-no-display': noDisplay })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    if (this.ngClass$$ !== undefined) {\r\n      this.ngClass$$.unsubscribe();\r\n      this.ngClass$$ = undefined;\r\n    }\r\n\r\n    if (this.availability$$ !== undefined) {\r\n      this.availability$$.unsubscribe();\r\n      this.availability$$ = undefined;\r\n    }\r\n\r\n    if (this.display$$ !== undefined) {\r\n      this.display$$.unsubscribe();\r\n      this.display$$ = undefined;\r\n    }\r\n\r\n    if (this.checkCondition$$ !== undefined) {\r\n      this.checkCondition$$.unsubscribe();\r\n      this.checkCondition$$ = undefined;\r\n    }\r\n\r\n    if (this.icon$$ !== undefined) {\r\n      this.icon$$.unsubscribe();\r\n      this.icon$$ = undefined;\r\n    }\r\n\r\n    if (this.tooltip$$ !== undefined) {\r\n      this.tooltip$$.unsubscribe();\r\n      this.tooltip$$ = undefined;\r\n    }\r\n\r\n    this.disabled$$.unsubscribe();\r\n    this.noDisplay$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * When the action button is clicked, emit the 'trigger' event but don't\r\n   * invoke the action handler. This is handled by the parent component.\r\n   * @internal\r\n   */\r\n  onClick() {\r\n    if (this.disabled === true) {\r\n      return;\r\n    }\r\n    this.trigger.emit(this.action);\r\n  }\r\n\r\n  private updateNgClass(ngClass: { [key: string]: boolean }) {\r\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\r\n  }\r\n\r\n  private updateTooltip(tooltip: string) {\r\n    this.tooltip$.next(tooltip);\r\n  }\r\n\r\n  private updateCheckCondition(checkCondition: boolean) {\r\n    this.checkCondition$.next(checkCondition);\r\n  }\r\n\r\n  private updateIcon(icon: string) {\r\n    this.icon$.next(icon);\r\n  }\r\n}\r\n","<mat-list *ngIf=\"mode === actionbarMode.Dock\" matListItemIcon>\n  <div\n    *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\n    id=\"topChevron\"\n  >\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\n      (click)=\"scrollUp()\"\n    >\n      <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n    </button>\n  </div>\n\n  <igo-actionbar-item\n    *ngIf=\"withToggleButton\"\n    color=\"accent\"\n    [withTitle]=\"false\"\n    [withIcon]=\"true\"\n    [color]=\"color\"\n    [disabled]=\"store.view.empty\"\n    [action]=\"toggleCollapseAction\"\n    (trigger)=\"onTriggerAction(toggleCollapseAction)\"\n  >\n  </igo-actionbar-item>\n\n  <ng-template\n    #buttonContent\n    *ngIf=\"!collapsed\"\n    ngFor\n    let-action\n    [ngForOf]=\"store.view.all$() | async\"\n  >\n    <igo-actionbar-item\n      color=\"accent\"\n      [withTitle]=\"withTitle\"\n      [withIcon]=\"withIcon\"\n      [withTooltip]=\"withTooltip\"\n      [color]=\"color\"\n      [disabled]=\"store.state.get(action).disabled\"\n      [action]=\"action\"\n      (trigger)=\"onTriggerAction(action)\"\n    >\n    </igo-actionbar-item>\n  </ng-template>\n\n  <div\n    *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\n    id=\"lowChevron\"\n  >\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\n      (click)=\"scrollDown()\"\n    >\n      <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n    </button>\n  </div>\n</mat-list>\n\n<div *ngIf=\"mode === actionbarMode.Overlay\">\n  <button\n    class=\"buttonOverlay\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\n    [matMenuTriggerFor]=\"actionbarMenu\"\n    [disabled]=\"store.view.empty\"\n    [color]=\"iconColor\"\n  >\n    <mat-icon [svgIcon]=\"icon\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #actionbarMenu=\"matMenu\"\n    class=\"igo-compact-menu igo-no-min-width-menu\"\n    overlapTrigger=\"true\"\n    [xPosition]=\"xPosition\"\n    [yPosition]=\"yPosition\"\n    [class]=\"overlayClass\"\n  >\n    <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n        <igo-actionbar-item\n          color=\"accent\"\n          [withTitle]=\"withTitle\"\n          [withIcon]=\"withIcon\"\n          [color]=\"color\"\n          [action]=\"action\"\n          (trigger)=\"onTriggerAction(action)\"\n        >\n        </igo-actionbar-item>\n      </ng-template>\n    </mat-list>\n  </mat-menu>\n</div>\n<mat-card\n  *ngIf=\"mode === actionbarMode.Context\"\n  class=\"context-menu-card mat-elevation-z4\"\n>\n  <mat-list>\n    <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n      <igo-actionbar-item\n        color=\"accent\"\n        [withTitle]=\"withTitle\"\n        [withIcon]=\"withIcon\"\n        [color]=\"color\"\n        [action]=\"action\"\n        (trigger)=\"onTriggerAction(action)\"\n      >\n      </igo-actionbar-item>\n      <br />\n    </ng-template>\n  </mat-list>\n</mat-card>\n","import { Overlay } from '@angular/cdk/overlay';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ElementRef,\r\n  HostBinding,\r\n  Input,\r\n  OnChanges,\r\n  OnDestroy,\r\n  SimpleChanges\r\n} from '@angular/core';\r\n\r\nimport { Media, MediaService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStoreWatcher } from '../../entity';\r\nimport { ActionbarMode } from '../shared/action.enums';\r\nimport { Action } from '../shared/action.interfaces';\r\nimport { ActionStore } from '../shared/store';\r\n\r\n/**\r\n * A list of action buttons.\r\n * This component can be displayed in one of two way: 'dock' or 'overlay'\r\n */\r\n@Component({\r\n  selector: 'igo-actionbar',\r\n  templateUrl: './actionbar.component.html',\r\n  styleUrls: ['./actionbar.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ActionbarComponent implements OnDestroy, OnChanges {\r\n  /**\r\n   * Reference to the ActionbarMode enum for use in the template\r\n   * @internal\r\n   */\r\n  actionbarMode = ActionbarMode;\r\n\r\n  /**\r\n   * Whether the actionbar is collapsed (Dock mode)\r\n   * @internal\r\n   */\r\n  collapsed = false;\r\n\r\n  /**\r\n   * Toggle collapse action (Dock)\r\n   * @internal\r\n   */\r\n  toggleCollapseAction = {\r\n    id: 'actionbar_toggle',\r\n    icon: 'dots-vertical',\r\n    handler: () => {\r\n      this.collapsed = !this.collapsed;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Action store watcher\r\n   * @internal\r\n   */\r\n  private watcher: EntityStoreWatcher<Action>;\r\n\r\n  /**\r\n   * Height Condition for scroll button\r\n   */\r\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\r\n    false\r\n  );\r\n\r\n  /**\r\n   * Position Condition for top scroll button\r\n   */\r\n  positionConditionTop$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(true);\r\n\r\n  /**\r\n   * Position Condition for low scroll button\r\n   */\r\n  positionConditionLow$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(true);\r\n\r\n  /**\r\n   * Action store\r\n   */\r\n  @Input() store: ActionStore;\r\n\r\n  /**\r\n   * Actionbar mode\r\n   */\r\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\r\n\r\n  /**\r\n   * Whether a toggle button should be displayed (Dock mode)\r\n   */\r\n  @Input() withToggleButton = false;\r\n\r\n  /**\r\n   * Whether a the actionbar should display buttons horizontally\r\n   */\r\n  @Input() horizontal = false;\r\n\r\n  /**\r\n   * Color\r\n   */\r\n  @Input() color = 'default';\r\n\r\n  /**\r\n   * Color of the button if action mode === overlay\r\n   */\r\n  @Input() iconColor = 'default';\r\n\r\n  /**\r\n   * Whether action titles are displayed\r\n   */\r\n  @Input() withTitle = true;\r\n\r\n  /**\r\n   * Whether action tooltips are displayed\r\n   */\r\n  @Input() withTooltip = true;\r\n\r\n  /**\r\n   * Whether action titles are displayed (condition for scroll button)\r\n   */\r\n  @Input() scrollActive = true;\r\n\r\n  /**\r\n   * Whether action icons are displayed\r\n   */\r\n  @Input() withIcon = true;\r\n\r\n  /**\r\n   * Which icon want to be shown\r\n   */\r\n  @Input() icon = 'dots-horizontal';\r\n\r\n  /**\r\n   * Overlay X position\r\n   */\r\n  @Input() xPosition = 'before';\r\n\r\n  /**\r\n   * Overlay Y position\r\n   */\r\n  @Input() yPosition = 'above';\r\n\r\n  /**\r\n   * Class to add to the actionbar overlay\r\n   */\r\n  @Input()\r\n  set overlayClass(value: string) {\r\n    this._overlayClass = value;\r\n  }\r\n  get overlayClass(): string {\r\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\r\n  }\r\n  private _overlayClass = '';\r\n\r\n  @HostBinding('class.is-collapsed') isCollapsed = this.collapsed;\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.with-title')\r\n  get withTitleClass() {\r\n    return this.withTitle;\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.with-icon')\r\n  get withIconClass() {\r\n    return this.withIcon;\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.horizontal')\r\n  get horizontalClass() {\r\n    return this.horizontal;\r\n  }\r\n\r\n  get heightCondition(): boolean {\r\n    const el = this.elRef.nativeElement;\r\n    if (this.scrollActive === false) {\r\n      if (el.clientHeight < el.scrollHeight) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get positionConditionTop(): boolean {\r\n    if (this.elRef.nativeElement.scrollTop === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get positionConditionLow(): boolean {\r\n    const el = this.elRef.nativeElement;\r\n    if (el.scrollTop >= el.scrollHeight - el.clientHeight) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get isDesktop(): boolean {\r\n    return this.mediaService.getMedia() === Media.Desktop;\r\n  }\r\n\r\n  constructor(\r\n    public overlay: Overlay,\r\n    private elRef: ElementRef,\r\n    private cdRef: ChangeDetectorRef,\r\n    public mediaService: MediaService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const store = changes.store;\r\n    if (store && store.currentValue !== store.previousValue) {\r\n      if (this.watcher !== undefined) {\r\n        this.watcher.destroy();\r\n      }\r\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n  }\r\n\r\n  /**\r\n   * Invoke the action handler\r\n   * @internal\r\n   */\r\n  onTriggerAction(action: Action) {\r\n    const args = action.args || [];\r\n    action.handler(...args);\r\n  }\r\n\r\n  scrollDown() {\r\n    this.elRef.nativeElement.scrollBy(0, 52);\r\n  }\r\n\r\n  scrollUp() {\r\n    this.elRef.nativeElement.scrollBy(0, -52);\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  EventEmitter,\r\n  HostListener,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { userAgent } from '@igo2/utils';\r\n\r\n/**\r\n * IgoLongPress trigger longpress event after a define duration.\r\n * This directive exist to patch the unavailable contextmenu event on iOS.\r\n * @param touchDuration touch duration in ms, default value is 400ms\r\n * @param iOSOnly define if longpress is triggered only for iOS, default value = true\r\n */\r\n@Directive({\r\n  selector: '[igoLongPress]'\r\n})\r\nexport class LongPressDirective {\r\n  private touchTimeout: any;\r\n  @Input() touchDuration: number = 400;\r\n  @Input() onlyIOS: boolean = true;\r\n  @Output() longpress = new EventEmitter();\r\n\r\n  constructor() {}\r\n\r\n  @HostListener('touchstart', ['$event'])\r\n  public touchstart(e: TouchEvent) {\r\n    if (e.touches.length > 1) {\r\n      this.touchEnd();\r\n      return;\r\n    }\r\n    this.touchTimeout = setTimeout(() => {\r\n      if (this.onlyIOS) {\r\n        if (userAgent.getOSName() === 'iOS') {\r\n          this.longpress.emit(e);\r\n        }\r\n      } else {\r\n        this.longpress.emit(e);\r\n      }\r\n    }, this.touchDuration);\r\n  }\r\n  @HostListener('touchmove')\r\n  @HostListener('touchcancel')\r\n  @HostListener('touchend')\r\n  public touchend() {\r\n    this.touchEnd();\r\n  }\r\n\r\n  private touchEnd() {\r\n    clearTimeout(this.touchTimeout);\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnChanges,\r\n  OnDestroy,\r\n  SimpleChanges,\r\n  ViewChild,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { DynamicComponent } from '../shared/dynamic-component';\r\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\r\n\r\n@Component({\r\n  selector: 'igo-dynamic-outlet',\r\n  templateUrl: 'dynamic-outlet.component.html',\r\n  styleUrls: ['dynamic-outlet.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\r\n  /**\r\n   * The dynamic component base class or the dynamic component itself\r\n   */\r\n  @Input() component: DynamicComponent<any> | any;\r\n\r\n  /**\r\n   * The dynamic component inputs\r\n   */\r\n  @Input() inputs: { [key: string]: any } = {};\r\n\r\n  /**\r\n   * The subscribers to the dynamic component outputs\r\n   */\r\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\r\n\r\n  /**\r\n   * The dynamic component\r\n   */\r\n  private dynamicComponent: DynamicComponent<any>;\r\n\r\n  /**\r\n   * The view element to render the component to\r\n   * @ignore\r\n   */\r\n  @ViewChild('target', { read: ViewContainerRef, static: true })\r\n  private target: ViewContainerRef;\r\n\r\n  constructor(\r\n    private dynamicComponentService: DynamicComponentService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  /**\r\n   * If the dynamic component changes, create it.\r\n   * If the inputs or subscribers change, update the current component's\r\n   * inputs or subscribers.\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const component = changes.component;\r\n    const inputs = changes.inputs;\r\n    const subscribers = changes.subscribers;\r\n    const eq = ObjectUtils.objectsAreEquivalent;\r\n\r\n    if (!component || !component.currentValue) {\r\n      return;\r\n    }\r\n\r\n    if (component.currentValue !== component.previousValue) {\r\n      this.createComponent(component.currentValue);\r\n    } else {\r\n      const inputsAreEquivalents =\r\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\r\n      const subscribersAreEquivalents =\r\n        subscribers &&\r\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\r\n\r\n      if (inputsAreEquivalents === false) {\r\n        this.updateInputs();\r\n      }\r\n\r\n      if (subscribersAreEquivalents === false) {\r\n        this.updateSubscribers();\r\n      }\r\n    }\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * Destroy the dynamic component and all it's subscribers\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    if (this.dynamicComponent) {\r\n      this.dynamicComponent.destroy();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a  DynamicComponent out of the component class and render it.\r\n   * @internal\r\n   */\r\n  private createComponent(component: DynamicComponent<any> | any) {\r\n    if (this.dynamicComponent !== undefined) {\r\n      this.dynamicComponent.destroy();\r\n    }\r\n    this.dynamicComponent =\r\n      component instanceof DynamicComponent\r\n        ? component\r\n        : this.dynamicComponentService.create(component);\r\n    this.renderComponent();\r\n  }\r\n\r\n  /**\r\n   * Create and render the dynamic component. Set it's inputs and subscribers\r\n   * @internal\r\n   */\r\n  private renderComponent() {\r\n    this.updateInputs();\r\n    this.updateSubscribers();\r\n    this.dynamicComponent.setTarget(this.target);\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic component inputs. This is an update so any\r\n   * key not defined won't be overwritten.\r\n   * @internal\r\n   */\r\n  private updateInputs() {\r\n    this.dynamicComponent.updateInputs(this.inputs);\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic component subscribers. This is an update so any\r\n   * key not defined won't be overwritten.\r\n   * @internal\r\n   */\r\n  private updateSubscribers() {\r\n    this.dynamicComponent.updateSubscribers(this.subscribers);\r\n  }\r\n}\r\n","<ng-template #target></ng-template>\n","import { FormFieldService } from './form-field.service';\n\nexport function IgoFormFieldComponent(type: string): (cls: any) => any {\n  return (compType: any) => {\n    FormFieldService.register(type, compType);\n  };\n}\n","import { AbstractControl } from '@angular/forms';\n\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\n\nexport function formControlIsRequired(control: AbstractControl): boolean {\n  if (control.validator) {\n    const validator = control.validator({} as AbstractControl);\n    if (validator && validator.required) {\n      return true;\n    }\n  }\n\n  if ((control as any).controls) {\n    const requiredControl = Object.keys((control as any).controls).find(\n      (key: string) => {\n        return formControlIsRequired((control as any).controls[key]);\n      }\n    );\n    return requiredControl !== undefined;\n  }\n\n  return false;\n}\n\nexport function getDefaultErrorMessages(): { [key: string]: string } {\n  return {\n    required: 'igo.common.form.errors.required'\n  };\n}\n\nexport function getControlErrorMessage(\n  control: AbstractControl,\n  messages: { [key: string]: string }\n): string {\n  const errors = control.errors || {};\n  const errorKeys = Object.keys(errors);\n  const errorMessages = errorKeys\n    .map((key: string) => messages[key])\n    .filter((message: string) => message !== undefined);\n  return errorMessages.length > 0 ? errorMessages[0] : '';\n}\n\nexport function getAllFormFields(form: Form): FormField[] {\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\n    return acc.concat(group.fields);\n  }, [].concat(form.fields));\n}\n\nexport function getFormFieldByName(form: Form, name: string): FormField {\n  const fields = getAllFormFields(form);\n  return fields.find((field: FormField) => {\n    return field.name === name;\n  });\n}\n","<ng-container *ngIf=\"field !== undefined\">\n  <igo-dynamic-outlet\n    [component]=\"getFieldComponent()\"\n    [inputs]=\"getFieldInputs()\"\n    [subscribers]=\"getFieldSubscribers()\"\n  >\n  </igo-dynamic-outlet>\n</ng-container>\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\r\n\r\nimport { getDefaultErrorMessages } from '../shared';\r\nimport { FormFieldService } from '../shared/form-field.service';\r\nimport {\r\n  FormField,\r\n  FormFieldInputs,\r\n  FormFieldOptions,\r\n  FormFieldSubscribers\r\n} from '../shared/form.interfaces';\r\n\r\n/**\r\n * This component renders the proper form input based on\r\n * the field configuration it receives.\r\n */\r\n@Component({\r\n  selector: 'igo-form-field',\r\n  templateUrl: './form-field.component.html',\r\n  styleUrls: ['./form-field.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormFieldComponent {\r\n  /**\r\n   * Field configuration\r\n   */\r\n  @Input() field: FormField;\r\n\r\n  /**\r\n   * Field inputs cache\r\n   */\r\n  private fieldInputs: FormFieldInputs = undefined;\r\n\r\n  /**\r\n   * Field subscribers cache\r\n   */\r\n  private fieldSubscribers: FormFieldSubscribers = undefined;\r\n\r\n  get fieldOptions(): FormFieldOptions {\r\n    return this.field.options || {};\r\n  }\r\n\r\n  constructor(private formFieldService: FormFieldService) {}\r\n\r\n  getFieldComponent(): any {\r\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\r\n  }\r\n\r\n  getFieldInputs(): FormFieldInputs {\r\n    if (this.fieldInputs !== undefined) {\r\n      return this.fieldInputs;\r\n    }\r\n\r\n    const errors = this.fieldOptions.errors || {};\r\n    this.fieldInputs = Object.assign(\r\n      {\r\n        placeholder: this.field.title,\r\n        disableSwitch: this.fieldOptions.disableSwitch || false\r\n      },\r\n      Object.assign({}, this.field.inputs || {}),\r\n      {\r\n        formControl: this.field.control,\r\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\r\n      }\r\n    );\r\n    return this.fieldInputs;\r\n  }\r\n\r\n  getFieldSubscribers(): FormFieldSubscribers {\r\n    if (this.fieldSubscribers !== undefined) {\r\n      return this.fieldSubscribers;\r\n    }\r\n\r\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\r\n    return this.fieldSubscribers;\r\n  }\r\n}\r\n","<div *ngIf=\"group && group.fields.length > 0\" class=\"igo-form-group-fields\">\n  <div\n    *ngFor=\"let field of group.fields\"\n    class=\"igo-form-field-wrapper\"\n    [ngClass]=\"getFieldNgClass(field)\"\n  >\n    <igo-form-field [field]=\"field\"></igo-form-field>\n  </div>\n</div>\n\n<div class=\"igo-form-group-extra-content\">\n  <ng-content></ng-content>\n</div>\n\n<mat-error *ngIf=\"formControl.errors\">{{\n  getErrorMessage() | translate\n}}</mat-error>\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\r\nimport { UntypedFormGroup } from '@angular/forms';\r\n\r\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\r\nimport { getControlErrorMessage } from '../shared/form.utils';\r\n\r\n/**\r\n * A configurable form, optionnally bound to an entity\r\n * (for example in case of un update). Submitting that form\r\n * emits an event with the form data but no other operation is performed.\r\n */\r\n@Component({\r\n  selector: 'igo-form-group',\r\n  templateUrl: './form-group.component.html',\r\n  styleUrls: ['./form-group.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormGroupComponent {\r\n  /**\r\n   * Form field group\r\n   */\r\n  @Input() group: FormFieldGroup;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() errors: { [key: string]: string };\r\n\r\n  /**\r\n   * Form group control\r\n   */\r\n  get formControl(): UntypedFormGroup {\r\n    return this.group.control;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Return the number of columns a field should occupy.\r\n   * The maximum allowed is 2, even if the field config says more.\r\n   * @param field Field\r\n   * @returns Number of columns\r\n   * @internal\r\n   */\r\n  getFieldColSpan(field: FormField): number {\r\n    let colSpan = 2;\r\n    const options = field.options || {};\r\n    if (options.cols && options.cols > 0) {\r\n      colSpan = Math.min(options.cols, 2);\r\n    }\r\n\r\n    return colSpan;\r\n  }\r\n\r\n  /**\r\n   * Return the number of columns a field should occupy.\r\n   * The maximum allowed is 2, even if the field config says more.\r\n   * @param field Field\r\n   * @returns Number of columns\r\n   * @internal\r\n   */\r\n  getFieldNgClass(field: FormField): { [key: string]: boolean } {\r\n    const colspan = this.getFieldColSpan(field);\r\n    return { [`igo-form-field-colspan-${colspan}`]: true };\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  getErrorMessage(): string {\r\n    const options = this.group.options || {};\r\n    return getControlErrorMessage(this.formControl, options.errors || {});\r\n  }\r\n}\r\n","<mat-form-field>\n  <input\n    matInput\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  />\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    [svgIcon]=\"\n      (disabled$ | async) === true\n        ? 'checkbox-blank-outline'\n        : 'checkbox-marked-outline'\n    \"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n  >\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\nimport type { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\r\nimport {\r\n  formControlIsRequired,\r\n  getControlErrorMessage\r\n} from '../shared/form.utils';\r\n\r\n/**\r\n * This component renders a text field\r\n */\r\n@IgoFormFieldComponent('text')\r\n@Component({\r\n  selector: 'igo-form-field-text',\r\n  templateUrl: './form-field-text.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormFieldTextComponent implements OnInit {\r\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * The field's form control\r\n   */\r\n  @Input() formControl: UntypedFormControl;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() errors: { [key: string]: string };\r\n\r\n  /**\r\n   * Wheter a disable switch should be available\r\n   */\r\n  @Input() disableSwitch: boolean = false;\r\n\r\n  /**\r\n   * Whether the field is required\r\n   */\r\n  get required(): boolean {\r\n    return formControlIsRequired(this.formControl);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.disabled$.next(this.formControl.disabled);\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  getErrorMessage(): string {\r\n    return getControlErrorMessage(this.formControl, this.errors);\r\n  }\r\n\r\n  onDisableSwitchClick() {\r\n    this.toggleDisabled();\r\n  }\r\n\r\n  private toggleDisabled() {\r\n    const disabled = !this.disabled$.value;\r\n    if (disabled === true) {\r\n      this.formControl.disable();\r\n    } else {\r\n      this.formControl.enable();\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n}\r\n","<mat-form-field>\n  <mat-select\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  >\n    <mat-option *ngFor=\"let choice of choices$ | async\" [value]=\"choice.value\">\n      {{ choice.title }}\n    </mat-option>\n  </mat-select>\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    [svgIcon]=\"\n      (disabled$ | async) === true\n        ? 'checkbox-blank-outline'\n        : 'checkbox-marked-outline'\n    \"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n  >\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\nimport type { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\r\nimport { FormFieldSelectChoice } from '../shared/form.interfaces';\r\nimport {\r\n  formControlIsRequired,\r\n  getControlErrorMessage\r\n} from '../shared/form.utils';\r\n\r\n/**\r\n * This component renders a select field\r\n */\r\n@IgoFormFieldComponent('select')\r\n@Component({\r\n  selector: 'igo-form-field-select',\r\n  templateUrl: './form-field-select.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormFieldSelectComponent implements OnInit {\r\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Select input choices\r\n   */\r\n  @Input()\r\n  set choices(value: FormFieldSelectChoice[]) {\r\n    this.choices$.next(value);\r\n  }\r\n  get choices(): FormFieldSelectChoice[] {\r\n    return this.choices$.value;\r\n  }\r\n  readonly choices$: BehaviorSubject<FormFieldSelectChoice[]> =\r\n    new BehaviorSubject([]);\r\n\r\n  /**\r\n   * The field's form control\r\n   */\r\n  @Input() formControl: UntypedFormControl;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() errors: { [key: string]: string };\r\n\r\n  /**\r\n   * Wheter a disable switch should be available\r\n   */\r\n  @Input() disableSwitch: boolean = false;\r\n\r\n  /**\r\n   * Whether the field is required\r\n   */\r\n  get required(): boolean {\r\n    return formControlIsRequired(this.formControl);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.disabled$.next(this.formControl.disabled);\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  getErrorMessage(): string {\r\n    return getControlErrorMessage(this.formControl, this.errors);\r\n  }\r\n\r\n  onDisableSwitchClick() {\r\n    this.toggleDisabled();\r\n  }\r\n\r\n  private toggleDisabled() {\r\n    const disabled = !this.disabled$.value;\r\n    if (disabled === true) {\r\n      this.formControl.disable();\r\n    } else {\r\n      this.formControl.enable();\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n}\r\n","<mat-form-field>\n  <textarea\n    matInput\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  >\n  </textarea>\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    [svgIcon]=\"\n      (disabled$ | async) === true\n        ? 'checkbox-blank-outline'\n        : 'checkbox-marked-outline'\n    \"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n  >\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\nimport type { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\r\nimport {\r\n  formControlIsRequired,\r\n  getControlErrorMessage\r\n} from '../shared/form.utils';\r\n\r\n/**\r\n * This component renders a textarea field\r\n */\r\n@IgoFormFieldComponent('textarea')\r\n@Component({\r\n  selector: 'igo-form-field-textarea',\r\n  templateUrl: './form-field-textarea.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormFieldTextareaComponent implements OnInit {\r\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * The field's form control\r\n   */\r\n  @Input() formControl: UntypedFormControl;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Field placeholder\r\n   */\r\n  @Input() errors: { [key: string]: string };\r\n\r\n  /**\r\n   * Wheter a disable switch should be available\r\n   */\r\n  @Input() disableSwitch: boolean = false;\r\n\r\n  /**\r\n   * Whether the field is required\r\n   */\r\n  get required(): boolean {\r\n    return formControlIsRequired(this.formControl);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.disabled$.next(this.formControl.disabled);\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  getErrorMessage(): string {\r\n    return getControlErrorMessage(this.formControl, this.errors);\r\n  }\r\n\r\n  onDisableSwitchClick() {\r\n    this.toggleDisabled();\r\n  }\r\n\r\n  private toggleDisabled() {\r\n    const disabled = !this.disabled$.value;\r\n    if (disabled === true) {\r\n      this.formControl.disable();\r\n    } else {\r\n      this.formControl.enable();\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  ElementRef,\r\n  EventEmitter,\r\n  Input,\r\n  OnChanges,\r\n  Output,\r\n  SimpleChanges,\r\n  ViewChild\r\n} from '@angular/core';\r\n\r\nimport { t } from 'typy';\r\n\r\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\r\nimport { getAllFormFields } from '../shared/form.utils';\r\n\r\n/**\r\n * A configurable form\r\n */\r\n@Component({\r\n  selector: 'igo-form',\r\n  templateUrl: './form.component.html',\r\n  styleUrls: ['./form.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FormComponent implements OnChanges {\r\n  /**\r\n   * Form\r\n   */\r\n  @Input() form: Form;\r\n\r\n  /**\r\n   * Input data\r\n   */\r\n  @Input() formData: { [key: string]: any };\r\n\r\n  /**\r\n   * Form autocomplete\r\n   */\r\n  @Input() autocomplete: string = 'off';\r\n\r\n  /**\r\n   * Event emitted when the form is submitted\r\n   */\r\n  @Output() submitForm = new EventEmitter<{ [key: string]: any }>();\r\n\r\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\r\n\r\n  get hasButtons(): boolean {\r\n    return this.buttons.nativeElement.children.length !== 0;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Is the entity or the template change, recreate the form or repopulate it.\r\n   * @internal\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const formData = changes.formData;\r\n    if (formData && formData.currentValue !== formData.previousValue) {\r\n      if (formData.currentValue === undefined) {\r\n        this.clear();\r\n      } else {\r\n        this.setData(formData.currentValue);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transform the form data to a feature and emit an event\r\n   * @param event Form submit event\r\n   * @internal\r\n   */\r\n  onSubmit() {\r\n    this.submitForm.emit(this.getData());\r\n  }\r\n\r\n  getData(): { [key: string]: any } {\r\n    const data = {};\r\n    getAllFormFields(this.form).forEach((field: FormField) => {\r\n      this.updateDataWithFormField(data, field);\r\n    });\r\n    return data;\r\n  }\r\n\r\n  private setData(data: { [key: string]: any }) {\r\n    this.form.fields.forEach((field: FormField) => {\r\n      field.control.setValue(t(data, field.name).safeObject);\r\n    });\r\n\r\n    this.form.groups.forEach((group: FormFieldGroup) => {\r\n      group.fields.forEach((field: FormField) => {\r\n        field.control.setValue(t(data, field.name).safeObject);\r\n      });\r\n    });\r\n  }\r\n\r\n  private updateDataWithFormField(\r\n    data: { [key: string]: any },\r\n    field: FormField\r\n  ) {\r\n    const control = field.control;\r\n    if (!control.disabled) {\r\n      data[field.name] = control.value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear form\r\n   */\r\n  private clear() {\r\n    this.form.control.reset();\r\n  }\r\n}\r\n","<form\n  [autocomplete]=\"autocomplete\"\n  [formGroup]=\"form.control\"\n  (ngSubmit)=\"onSubmit()\"\n>\n  <div\n    class=\"igo-form-body\"\n    [ngClass]=\"{ 'igo-form-body-with-buttons': hasButtons }\"\n  >\n    <div class=\"igo-form-content\">\n      <ng-content></ng-content>\n    </div>\n    <div #buttons class=\"igo-form-buttons\">\n      <ng-content select=\"[formButtons]\"></ng-content>\n    </div>\n  </div>\n</form>\n","import {\r\n  Component,\r\n  ElementRef,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  ViewChild\r\n} from '@angular/core';\r\n\r\nimport { Media, MediaService } from '@igo2/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { FlexibleDirection, FlexibleState } from './flexible.type';\r\n\r\n@Component({\r\n  selector: 'igo-flexible',\r\n  templateUrl: './flexible.component.html',\r\n  styleUrls: ['./flexible.component.scss']\r\n})\r\nexport class FlexibleComponent implements OnInit, OnDestroy {\r\n  static transitionTime = 250;\r\n\r\n  @ViewChild('flexibleMain', { static: true }) main;\r\n\r\n  @Input()\r\n  get initial(): string {\r\n    return this._initial;\r\n  }\r\n  set initial(value: string) {\r\n    this._initial = value;\r\n  }\r\n  private _initial = '0';\r\n\r\n  @Input()\r\n  get collapsed(): string {\r\n    return this._collapsed;\r\n  }\r\n  set collapsed(value: string) {\r\n    this._collapsed = value;\r\n  }\r\n  private _collapsed = '0';\r\n\r\n  @Input()\r\n  get expanded(): string {\r\n    return this._expanded;\r\n  }\r\n  set expanded(value: string) {\r\n    this._expanded = value;\r\n  }\r\n  private _expanded = '100%';\r\n\r\n  @Input()\r\n  get initialMobile(): string {\r\n    return this._initialMobile;\r\n  }\r\n  set initialMobile(value: string) {\r\n    this._initialMobile = value;\r\n  }\r\n  private _initialMobile: string = this.expanded;\r\n\r\n  @Input()\r\n  get collapsedMobile(): string {\r\n    return this._collapsedMobile;\r\n  }\r\n  set collapsedMobile(value: string) {\r\n    this._collapsedMobile = value;\r\n  }\r\n  private _collapsedMobile: string = this.collapsed;\r\n\r\n  @Input()\r\n  get expandedMobile(): string {\r\n    return this._expandedMobile;\r\n  }\r\n  set expandedMobile(value: string) {\r\n    this._expandedMobile = value;\r\n  }\r\n  private _expandedMobile: string = this.expanded;\r\n\r\n  @Input()\r\n  get direction(): FlexibleDirection {\r\n    return this._direction;\r\n  }\r\n  set direction(value: FlexibleDirection) {\r\n    this._direction = value;\r\n  }\r\n  private _direction: FlexibleDirection = 'column';\r\n\r\n  @Input()\r\n  get state(): FlexibleState {\r\n    return this._state;\r\n  }\r\n  set state(value: FlexibleState) {\r\n    const sizes = {\r\n      initial: this.initial,\r\n      collapsed: this.collapsed,\r\n      expanded: this.expanded\r\n    };\r\n\r\n    if (this.mediaService.isMobile()) {\r\n      Object.assign(sizes, {\r\n        initial: this.initialMobile,\r\n        collapsed: this.collapsedMobile,\r\n        expanded: this.expandedMobile\r\n      });\r\n    }\r\n\r\n    const size = sizes[value];\r\n    if (size !== undefined) {\r\n      this.setSize(size);\r\n      setTimeout(() => {\r\n        this._state = value;\r\n      }, FlexibleComponent.transitionTime);\r\n    }\r\n  }\r\n  private _state: FlexibleState = 'initial';\r\n\r\n  private mediaService$$: Subscription;\r\n\r\n  constructor(\r\n    private el: ElementRef,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.el.nativeElement.className += this.direction;\r\n\r\n    // Since this component supports different sizes\r\n    // on mobile, force a redraw when the media changes\r\n    this.mediaService$$ = this.mediaService.media$.subscribe(\r\n      (media: Media) => (this.state = this.state)\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    if (this.mediaService$$) {\r\n      this.mediaService$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  private setSize(size: string) {\r\n    this._state = 'transition';\r\n\r\n    if (this.direction === 'column') {\r\n      this.main.nativeElement.style.height = size;\r\n    } else if (this.direction === 'row') {\r\n      this.main.nativeElement.style.width = size;\r\n    }\r\n  }\r\n}\r\n","<div #flexibleMain class=\"igo-flexible-main {{ state }} {{ direction }}\">\n  <div class=\"igo-container\">\n    <ng-content></ng-content>\n  </div>\n</div>\n<div class=\"igo-flexible-fill\">\n  <div>\n    <div class=\"igo-container\">\n      <ng-content select=\"[igoFlexibleFill]\"></ng-content>\n    </div>\n  </div>\n</div>\n","<ng-container *ngIf=\"showTourButton\">\n  <button\n    *ngIf=\"styleButton === 'icon'; else raisedButton\"\n    (click)=\"startInteractiveTour()\"\n    [ngClass]=\"getClass()\"\n    color=\"primary\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      disabledTourButton\n        ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n          | translate)\n        : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n    \"\n    [disabled]=\"disabledTourButton\"\n  >\n    <mat-icon iconPositionEnd svgIcon=\"presentation-play\"> </mat-icon>\n  </button>\n\n  <ng-template #raisedButton>\n    <button\n      (click)=\"startInteractiveTour()\"\n      [ngClass]=\"getClass()\"\n      color=\"primary\"\n      mat-raised-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"disabledTourButton\"\n    >\n      {{ 'igo.common.interactiveTour.buttonTitle' | translate }}\n      {{ discoverTitleInLocale$ | async | translate }}\n      <mat-icon\n        iconPositionEnd\n        svgIcon=\"presentation-play\"\n        [matTooltip]=\"\n          disabledTourButton\n            ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n              | translate)\n            : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n        \"\n      >\n      </mat-icon>\n    </button>\n  </ng-template>\n</ng-container>\n","import { Component, Input, ViewEncapsulation } from '@angular/core';\r\n\r\nimport { Observable, of } from 'rxjs';\r\n\r\nimport { ToolService } from '../tool/shared/tool.service';\r\nimport { InteractiveTourService } from './interactive-tour.service';\r\n\r\n@Component({\r\n  selector: 'igo-interactive-tour',\r\n  templateUrl: './interactive-tour.component.html',\r\n  styleUrls: ['./interactive-tour.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class InteractiveTourComponent {\r\n  /**\r\n   * Toolbox that holds main tools\r\n   */\r\n  @Input() tourToStart: string = '';\r\n  @Input() styleButton: 'icon' | 'raised';\r\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\r\n\r\n  getClass() {\r\n    return {\r\n      'tour-button-tool-icon': this.styleButton === 'icon',\r\n      'tour-button-tool': this.styleButton === 'raised'\r\n    };\r\n  }\r\n\r\n  get toolbox() {\r\n    return this.toolService.toolbox;\r\n  }\r\n\r\n  getTourToStart() {\r\n    if (this.tourToStart) {\r\n      return this.tourToStart;\r\n    } else {\r\n      return this.activeToolName;\r\n    }\r\n  }\r\n\r\n  get activeToolName() {\r\n    if (this.toolbox) {\r\n      if (this.isActiveTool) {\r\n        return this.toolbox.activeTool$.getValue().name;\r\n      } else {\r\n        return 'global';\r\n      }\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get isActiveTool(): boolean {\r\n    if (this.toolbox) {\r\n      return this.toolbox.activeTool$.getValue() !== undefined;\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get isToolHaveTour(): boolean {\r\n    if (this.activeToolName === 'about' && !this.tourToStart) {\r\n      return false;\r\n    }\r\n    return this.interactiveTourService.isToolHaveTourConfig(\r\n      this.getTourToStart()\r\n    );\r\n  }\r\n\r\n  get showTourButton(): boolean {\r\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\r\n    let haveTour: boolean;\r\n    haveTour = this.isToolHaveTour;\r\n    if (haveTour === false) {\r\n      return false;\r\n    }\r\n\r\n    let inMobileAndShow: boolean;\r\n    if (this.interactiveTourService.isMobile()) {\r\n      inMobileAndShow = this.isTourDisplayInMobile;\r\n      if (inMobileAndShow === false) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get isTourDisplayInMobile(): boolean {\r\n    return this.interactiveTourService.isTourDisplayInMobile();\r\n  }\r\n\r\n  get disabledTourButton(): boolean {\r\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\r\n  }\r\n\r\n  constructor(\r\n    private interactiveTourService: InteractiveTourService,\r\n    private toolService: ToolService\r\n  ) {}\r\n\r\n  startInteractiveTour() {\r\n    const tour = this.getTourToStart();\r\n    if (tour) {\r\n      this.interactiveTourService.startTour(tour);\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-spinner',\r\n  templateUrl: './spinner.component.html',\r\n  styleUrls: ['./spinner.component.scss']\r\n})\r\nexport class SpinnerComponent {\r\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  @Input()\r\n  set shown(value: boolean) {\r\n    this.shown$.next(value);\r\n  }\r\n  get shown(): boolean {\r\n    return this.shown$.value;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  show() {\r\n    this.shown = true;\r\n  }\r\n\r\n  hide() {\r\n    this.shown = false;\r\n  }\r\n}\r\n","<div\n  [ngClass]=\"{\n    'igo-spinner-container': true,\n    'igo-spinner-shown': (shown$ | async)\n  }\"\n>\n  <div class=\"igo-spinner-background\"></div>\n  <mat-progress-spinner\n    diameter=\"40\"\n    mode=\"indeterminate\"\n  ></mat-progress-spinner>\n</div>\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\r\n\r\nimport { ActivityService } from '@igo2/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { SpinnerComponent } from './spinner.component';\r\n\r\n/**\r\n * A directive to bind a SpinnerComponent to the activity service.\r\n * The activity service tracks any HTTP request and this directive\r\n * will display the spinner it's attached to when the activity counter\r\n * is greater than 0.\r\n */\r\n@Directive({\r\n  selector: '[igoSpinnerActivity]'\r\n})\r\nexport class SpinnerActivityDirective implements OnInit, OnDestroy {\r\n  /**\r\n   * Subscription to the activity service counter\r\n   */\r\n  private counter$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() private spinner: SpinnerComponent,\r\n    private activityService: ActivityService\r\n  ) {}\r\n\r\n  /**\r\n   * Subscribe to the activity service counter and display the spinner\r\n   * when it's is greater than 0.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.counter$$ = this.activityService.counter$\r\n      .pipe(debounceTime(50))\r\n      .subscribe((count: number) => {\r\n        count > 0 ? this.spinner.show() : this.spinner.hide();\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Unsubcribe to the activity service counter.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.counter$$.unsubscribe();\r\n  }\r\n}\r\n","export enum TableActionColor {\n  primary,\n  accent,\n  warn\n}\n","import { DataSource } from '@angular/cdk/table';\r\nimport { MatSort } from '@angular/material/sort';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { BehaviorSubject, Observable, merge } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { TableDatabase } from './table-database';\r\nimport { TableModel } from './table-model.interface';\r\n\r\nexport class TableDataSource extends DataSource<any> {\r\n  get filter(): string {\r\n    return this._filterChange.value;\r\n  }\r\n  set filter(filter: string) {\r\n    this._filterChange.next(filter);\r\n  }\r\n  private _filterChange = new BehaviorSubject('');\r\n\r\n  constructor(\r\n    private _database: TableDatabase,\r\n    private _model: TableModel,\r\n    private _sort: MatSort\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  // Connect function called by the table to retrieve one stream containing\r\n  // the data to render.\r\n  connect(): Observable<any[]> {\r\n    if (!this._database) {\r\n      return merge([]);\r\n    }\r\n    const displayDataChanges = [\r\n      this._database.dataChange,\r\n      this._filterChange,\r\n      this._sort.sortChange\r\n    ];\r\n\r\n    return merge(...displayDataChanges).pipe(\r\n      map(() => {\r\n        return this.getFilteredData(this._database.data);\r\n      }),\r\n      map((data) => {\r\n        return this.getSortedData(data);\r\n      })\r\n    );\r\n  }\r\n\r\n  disconnect() {}\r\n\r\n  getFilteredData(data): any[] {\r\n    if (!this.filter) {\r\n      return data;\r\n    }\r\n    return data.slice().filter((item: any) => {\r\n      const searchStr: string = this._model.columns\r\n        .filter((c) => c.filterable)\r\n        .map((c) => ObjectUtils.resolve(item, c.name))\r\n        .join(' ')\r\n        .toLowerCase();\r\n\r\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\r\n    });\r\n  }\r\n\r\n  getSortedData(data): any[] {\r\n    if (!this._sort.active || this._sort.direction === '') {\r\n      return data;\r\n    }\r\n\r\n    return data.sort((a, b) => {\r\n      const propertyA: number | string = ObjectUtils.resolve(\r\n        a,\r\n        this._sort.active\r\n      );\r\n      const propertyB: number | string = ObjectUtils.resolve(\r\n        b,\r\n        this._sort.active\r\n      );\r\n\r\n      return ObjectUtils.naturalCompare(\r\n        propertyB,\r\n        propertyA,\r\n        this._sort.direction\r\n      );\r\n    });\r\n  }\r\n}\r\n","<div class=\"table-box\">\n  <div class=\"table-header\" *ngIf=\"hasFilterInput\">\n    <mat-form-field floatPlaceholder=\"never\">\n      <input\n        matInput\n        #filter\n        [placeholder]=\"'igo.common.table.filter' | translate\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div class=\"table-container\">\n    <table mat-table #table [dataSource]=\"dataSource\" matSort>\n      <!-- Checkbox Column -->\n      <ng-container matColumnDef=\"selectionCheckbox\">\n        <th mat-header-cell *matHeaderCellDef>\n          <mat-checkbox\n            (change)=\"$event ? masterToggle() : null\"\n            [checked]=\"selection.hasValue() && isAllSelected()\"\n            [indeterminate]=\"selection.hasValue() && !isAllSelected()\"\n          >\n          </mat-checkbox>\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <mat-checkbox\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"$event ? selection.toggle(row) : null\"\n            [checked]=\"selection.isSelected(row)\"\n          >\n          </mat-checkbox>\n        </td>\n      </ng-container>\n\n      <ng-container\n        [matColumnDef]=\"column.name\"\n        *ngFor=\"let column of model.columns\"\n      >\n        <ng-container *ngIf=\"column.sortable\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>\n            {{ column.title }}\n          </th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.sortable\">\n          <th mat-header-cell *matHeaderCellDef>{{ column.title }}</th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\n            \"\n          >\n            {{ getValue(row, column.name) }}\n          </td>\n        </ng-container>\n\n        <ng-template #cellHTML>\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\n            \"\n            [innerHTML]=\"getValue(row, column.name)\"\n          ></td>\n        </ng-template>\n      </ng-container>\n\n      <!-- Action Column -->\n      <ng-container matColumnDef=\"action\">\n        <th mat-header-cell *matHeaderCellDef></th>\n        <td mat-cell *matCellDef=\"let row\">\n          <button\n            *ngFor=\"let action of model.actions\"\n            mat-mini-fab\n            [color]=\"getActionColor(action.color)\"\n            (click)=\"handleClickAction($event, action, row)\"\n          >\n            <mat-icon svgIcon=\"{{ action.icon }}\"></mat-icon>\n          </button>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n      <tr\n        mat-row\n        *matRowDef=\"let row; columns: displayedColumns\"\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\n        (click)=\"selection.toggle(row)\"\n      ></tr>\n    </table>\n  </div>\n</div>\n","import { SelectionModel } from '@angular/cdk/collections';\r\nimport {\r\n  AfterViewInit,\r\n  Component,\r\n  ElementRef,\r\n  EventEmitter,\r\n  Input,\r\n  OnChanges,\r\n  OnInit,\r\n  Output,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { MatSort } from '@angular/material/sort';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { fromEvent } from 'rxjs';\r\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { TableActionColor } from './table-action-color.enum';\r\nimport { TableDatabase } from './table-database';\r\nimport { TableDataSource } from './table-datasource';\r\nimport { TableModel } from './table-model.interface';\r\n\r\n@Component({\r\n  selector: 'igo-table',\r\n  templateUrl: './table.component.html',\r\n  styleUrls: ['./table.component.scss']\r\n})\r\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\r\n  @Input()\r\n  get database(): TableDatabase {\r\n    return this._database;\r\n  }\r\n  set database(value: TableDatabase) {\r\n    this._database = value;\r\n  }\r\n  private _database: TableDatabase;\r\n\r\n  @Input()\r\n  get model(): TableModel {\r\n    return this._model;\r\n  }\r\n  set model(value: TableModel) {\r\n    this._model = value;\r\n  }\r\n  private _model: TableModel;\r\n\r\n  @Input()\r\n  get hasFilterInput(): boolean {\r\n    return this._hasFIlterInput;\r\n  }\r\n  set hasFilterInput(value: boolean) {\r\n    this._hasFIlterInput = value;\r\n  }\r\n  private _hasFIlterInput = true;\r\n\r\n  public displayedColumns;\r\n  public dataSource: TableDataSource | null;\r\n  public selection = new SelectionModel<any>(true, []);\r\n\r\n  @Output()\r\n  select = new EventEmitter<{\r\n    added: any[];\r\n    removed: any[];\r\n    source: SelectionModel<any>;\r\n  }>();\r\n\r\n  @ViewChild('filter') filter: ElementRef;\r\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\r\n\r\n  ngOnInit() {\r\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\r\n\r\n    if (this.model) {\r\n      this.displayedColumns = this.model.columns\r\n        .filter((c) => c.displayed !== false)\r\n        .map((c) => c.name);\r\n\r\n      if (this.model.selectionCheckbox) {\r\n        this.displayedColumns.unshift('selectionCheckbox');\r\n      }\r\n      if (this.model.actions && this.model.actions.length) {\r\n        this.displayedColumns.push('action');\r\n      }\r\n    }\r\n\r\n    this.selection.changed.subscribe((e) => this.select.emit(e));\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    if (this.filter) {\r\n      fromEvent(this.filter.nativeElement, 'keyup')\r\n        .pipe(debounceTime(150), distinctUntilChanged())\r\n        .subscribe(() => {\r\n          if (!this.dataSource) {\r\n            return;\r\n          }\r\n          this.dataSource.filter = this.filter.nativeElement.value;\r\n        });\r\n    }\r\n  }\r\n\r\n  ngOnChanges(change) {\r\n    if (change.database) {\r\n      this.dataSource = new TableDataSource(\r\n        this.database,\r\n        this.model,\r\n        this.sort\r\n      );\r\n      this.selection.clear();\r\n    }\r\n  }\r\n\r\n  getActionColor(colorId: number): string {\r\n    return TableActionColor[colorId];\r\n  }\r\n\r\n  getValue(row, key) {\r\n    return ObjectUtils.resolve(row, key);\r\n  }\r\n\r\n  /** Whether the number of selected elements matches the total number of rows. */\r\n  isAllSelected() {\r\n    const numSelected = this.selection.selected.length;\r\n    const numRows = this.database.data.length;\r\n    return numSelected === numRows;\r\n  }\r\n\r\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\r\n  masterToggle() {\r\n    this.isAllSelected()\r\n      ? this.selection.clear()\r\n      : this.database.data.forEach((row) => this.selection.select(row));\r\n  }\r\n\r\n  handleClickAction(event, action, row) {\r\n    event.stopPropagation();\r\n    action.click(row);\r\n  }\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\n\nexport class TableDatabase {\n  /** Stream that emits whenever the data has been modified. */\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\n  get data(): any[] {\n    return this.dataChange.value;\n  }\n\n  constructor(data?) {\n    if (data) {\n      this.dataChange.next(data);\n    }\n  }\n\n  set(data) {\n    this.dataChange.next(data);\n  }\n\n  add(item) {\n    const copiedData = this.data.slice();\n    copiedData.push(item);\n    this.set(copiedData);\n  }\n\n  remove(item) {\n    const copiedData = this.data.slice();\n    const index = copiedData.indexOf(item);\n    copiedData.splice(index, 1);\n    this.set(copiedData);\n  }\n}\n","import { Tool } from './tool.interface';\nimport { ToolService } from './tool.service';\n\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\n  return (compType: any) => {\n    ToolService.register(\n      Object.assign({}, tool, {\n        component: compType\n      } as Tool)\n    );\n  };\n}\n","export enum ToolboxColor {\n  White = 'white',\n  Grey = 'grey',\n  Primary = 'primary'\n}\n","import {\r\n  AnimationTriggerMetadata,\r\n  animate,\r\n  state,\r\n  style,\r\n  transition,\r\n  trigger\r\n} from '@angular/animations';\r\n\r\nexport function toolSlideInOut(\r\n  speed = '300ms',\r\n  type = 'ease-in-out'\r\n): AnimationTriggerMetadata {\r\n  return trigger('toolSlideInOut', [\r\n    state(\r\n      'enter',\r\n      style({\r\n        transform: 'translate3d(0, 0, 0)'\r\n      })\r\n    ),\r\n    transition('void => enter', animate(speed + ' ' + type))\r\n  ]);\r\n}\r\n","<igo-actionbar\n  *ngIf=\"(toolbar$ | async).length > 0\"\n  [store]=\"actionStore\"\n  [withIcon]=\"true\"\n  [withTitle]=\"toolbarWithTitle$ | async\"\n  [withTooltip]=\"(toolbarWithTitle$ | async) === false\"\n  [scrollActive]=\"toolbarWithTitle$ | async\"\n  [horizontal]=\"false\"\n>\n</igo-actionbar>\n\n<div\n  *ngIf=\"activeTool$ | async as tool\"\n  class=\"igo-tool-container mat-body-1\"\n  [ngClass]=\"{\n    'igo-tool-container-with-toolbar': !actionStore.empty,\n    'igo-tool-container-with-animation': animate\n  }\"\n  [@toolSlideInOut]=\"animation$ | async\"\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\n  (@toolSlideInOut.done)=\"onAnimationComplete()\"\n>\n  <igo-dynamic-outlet\n    [component]=\"tool.component\"\n    [inputs]=\"getToolInputs(tool)\"\n  >\n  </igo-dynamic-outlet>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  HostBinding,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { Action, ActionStore } from '../../action';\r\nimport { Tool } from '../shared/tool.interface';\r\nimport { Toolbox } from '../shared/toolbox';\r\nimport { ToolboxColor } from '../shared/toolbox.enums';\r\nimport { toolSlideInOut } from './toolbox.animation';\r\n\r\n@Component({\r\n  selector: 'igo-toolbox',\r\n  templateUrl: 'toolbox.component.html',\r\n  styleUrls: ['toolbox.component.scss'],\r\n  animations: [toolSlideInOut()],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ToolboxComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Observable of the active tool\r\n   */\r\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\r\n\r\n  get isActive(): boolean {\r\n    return !!this.activeTool$.value;\r\n  }\r\n\r\n  /**\r\n   * Store of actions that toggle tools\r\n   */\r\n  actionStore: ActionStore = new ActionStore([]);\r\n\r\n  /**\r\n   * Observable of he anmation state\r\n   */\r\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\r\n\r\n  /**\r\n   * Observable of the toolbar\r\n   */\r\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * Whether the Toolbar should display actions' titles\r\n   */\r\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\r\n    map((tool: Tool | undefined) => tool === undefined)\r\n  );\r\n\r\n  /**\r\n   * Subscription to the active tool\r\n   */\r\n  private activeTool$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the toolbar\r\n   */\r\n  private toolbar$$: Subscription;\r\n\r\n  /**\r\n   * Observable of the ongoing animation. This is useful when\r\n   * multiple animations are triggered at once i.e. when the user clicks\r\n   * too fast on different actions\r\n   */\r\n  private animating$ = new BehaviorSubject<boolean>(false);\r\n\r\n  /**\r\n   * Subscription to the ongoing animation\r\n   */\r\n  private animating$$: Subscription;\r\n\r\n  /**\r\n   * Toolbox\r\n   */\r\n  @Input() toolbox: Toolbox;\r\n\r\n  /**\r\n   * Whether the toolbox should animate the first tool entering\r\n   */\r\n  @Input() animate: boolean = false;\r\n\r\n  /**\r\n   * Color of Toolbox\r\n   */\r\n  @Input() color: ToolboxColor = ToolboxColor.White;\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.color-grey')\r\n  get classColorGrey() {\r\n    return this.color === ToolboxColor.Grey;\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  @HostBinding('class.color-primary')\r\n  get classColorPrimary() {\r\n    return this.color === ToolboxColor.Primary;\r\n  }\r\n\r\n  /**\r\n   * Initialize the toolbar and subscribe to the active tool\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\r\n      this.onToolbarChange(toolbar)\r\n    );\r\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\r\n      this.onActiveToolChange(tool)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the active tool and destroy the action store\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.toolbar$$.unsubscribe();\r\n    this.activeTool$$.unsubscribe();\r\n    this.actionStore.destroy();\r\n  }\r\n\r\n  /**\r\n   * Track the starting animation\r\n   * @internal\r\n   */\r\n  onAnimationStart() {\r\n    this.animating$.next(true);\r\n  }\r\n\r\n  /**\r\n   * Untrack the completed animation\r\n   * @internal\r\n   */\r\n  onAnimationComplete() {\r\n    this.animating$.next(false);\r\n  }\r\n\r\n  /**\r\n   * Return a tool's inputs\r\n   * @param tool Tool\r\n   * @returns Tool inputs\r\n   * @internal\r\n   */\r\n  getToolInputs(tool: Tool): { [key: string]: any } {\r\n    return tool.options || {};\r\n  }\r\n\r\n  /**\r\n   * Initialize an action store\r\n   * @param toolbar Toolbar\r\n   */\r\n  private onToolbarChange(toolbar: string[]) {\r\n    this.setToolbar(toolbar);\r\n  }\r\n\r\n  /**\r\n   * Activate a tool and trigger an animation or not\r\n   * @param tool Tool to activate\r\n   */\r\n  private onActiveToolChange(tool: Tool) {\r\n    if (!this.animate) {\r\n      this.setActiveTool(tool);\r\n      return;\r\n    }\r\n    this.onAnimate(() => this.setActiveTool(tool));\r\n  }\r\n\r\n  /**\r\n   * Set the active tool\r\n   * @param tool Tool to activate\r\n   */\r\n  private setActiveTool(tool: Tool | undefined) {\r\n    if (tool === undefined) {\r\n      this.actionStore.state.updateAll({ active: false });\r\n    } else {\r\n      const action = this.actionStore.get(tool.name);\r\n      if (action !== undefined) {\r\n        this.actionStore.state.update(action, { active: true }, true);\r\n      }\r\n    }\r\n\r\n    this.activeTool$.next(tool);\r\n    if (this.animate) {\r\n      this.animation$.next('enter');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize the toolbar\r\n   */\r\n  private setToolbar(toolbar: string[]) {\r\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\r\n      const tool = this.toolbox.getTool(toolName);\r\n      if (tool === undefined) {\r\n        return acc;\r\n      }\r\n\r\n      acc.push({\r\n        id: tool.name,\r\n        title: tool.title,\r\n        icon: tool.icon,\r\n        // iconImage: tool.iconImage,\r\n        tooltip: tool.tooltip,\r\n        args: [tool, this.toolbox],\r\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\r\n          _toolbox.activateTool(_tool.name);\r\n        },\r\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\r\n          return this.toolbox.activeTool$.pipe(\r\n            map((activeTool: Tool) => {\r\n              let toolActivated = false;\r\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\r\n                toolActivated = true;\r\n              }\r\n\r\n              let childrenToolActivated = false;\r\n              if (\r\n                activeTool !== undefined &&\r\n                _tool.name === activeTool.parent\r\n              ) {\r\n                childrenToolActivated = true;\r\n              }\r\n\r\n              return {\r\n                'tool-activated': toolActivated,\r\n                'children-tool-activated': childrenToolActivated\r\n              };\r\n            })\r\n          );\r\n        }\r\n      });\r\n      return acc;\r\n    }, []);\r\n    this.actionStore.load(actions);\r\n    this.toolbar$.next(toolbar);\r\n  }\r\n\r\n  /**\r\n   * Observe the ongoing animation and ignore any incoming animation\r\n   * while one is still ongoing.\r\n   * @param callback Callback to execute when the animation completes\r\n   */\r\n  private onAnimate(callback: () => void) {\r\n    this.unAnimate();\r\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\r\n      if (!animation) {\r\n        callback.call(this);\r\n        this.unAnimate();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop observing an animation when it's complete\r\n   */\r\n  private unAnimate() {\r\n    if (this.animating$$) {\r\n      this.animating$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","<igo-dynamic-outlet\n  *ngIf=\"widget\"\n  [component]=\"widget\"\n  [inputs]=\"inputs\"\n  [subscribers]=\"getEffectiveSubscribers()\"\n>\n</igo-dynamic-outlet>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { DynamicComponent } from '../../dynamic-component';\r\nimport { WidgetComponent } from '../shared/widget.interfaces';\r\n\r\n/**\r\n * This component dynamically renders a widget. It also subscribes\r\n * to the widget's 'cancel' and 'complete' events and destroys it\r\n * when any of those event is emitted.\r\n */\r\n@Component({\r\n  selector: 'igo-widget-outlet',\r\n  templateUrl: './widget-outlet.component.html',\r\n  styleUrls: ['./widget-outlet.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WidgetOutletComponent implements OnDestroy {\r\n  /**\r\n   * Widget subscribers to 'cancel' and 'complete'\r\n   * @internal\r\n   */\r\n  private baseSubscribers = {\r\n    cancel: (event: any) => this.onCancel(event),\r\n    complete: (event: any) => this.onComplete(event)\r\n  };\r\n\r\n  /**\r\n   * Widget\r\n   */\r\n  @Input() widget: DynamicComponent<WidgetComponent>;\r\n\r\n  /**\r\n   * Widget inputs\r\n   */\r\n  @Input() inputs: { [key: string]: any };\r\n\r\n  /**\r\n   * Widget subscribers\r\n   */\r\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\r\n\r\n  /**\r\n   * Event emitted when the widget emits 'complete'\r\n   */\r\n  @Output() complete = new EventEmitter<any>();\r\n\r\n  /**\r\n   * Event emitted when the widget emits 'cancel'\r\n   */\r\n  @Output() cancel = new EventEmitter<any>();\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Destroy the current widget and all it's inner subscriptions\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.destroyWidget();\r\n  }\r\n\r\n  /**\r\n   * Get the effective subscribers. That means a combination of the base\r\n   * subscribers and any subscriber given as input.\r\n   * @returns Combined subscribers\r\n   * @internal\r\n   */\r\n  getEffectiveSubscribers(): { [key: string]: (event: any) => void } {\r\n    const subscribers = Object.assign({}, this.subscribers);\r\n\r\n    // Base subscribers\r\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\r\n      const subscriber = subscribers[key];\r\n      const baseSubscriber = this.baseSubscribers[key];\r\n      if (subscriber !== undefined) {\r\n        subscribers[key] = (event: any) => {\r\n          subscriber(event);\r\n          baseSubscriber(event);\r\n        };\r\n      } else {\r\n        subscribers[key] = baseSubscriber;\r\n      }\r\n    });\r\n\r\n    return subscribers;\r\n  }\r\n\r\n  /**\r\n   * When the widget emits 'cancel', propagate that event and destroy\r\n   * the widget\r\n   */\r\n  private onCancel(event: any) {\r\n    this.cancel.emit(event);\r\n    this.destroyWidget();\r\n  }\r\n\r\n  /**\r\n   * When the widget emits 'complete', propagate that event and destroy\r\n   * the widget\r\n   */\r\n  private onComplete(event: any) {\r\n    this.complete.emit(event);\r\n    this.destroyWidget();\r\n  }\r\n\r\n  /**\r\n   * Destroy the current widget\r\n   */\r\n  private destroyWidget() {\r\n    if (this.widget !== undefined) {\r\n      this.widget.destroy();\r\n    }\r\n    this.widget = undefined;\r\n  }\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStore } from '../../entity';\r\nimport { Workspace } from './workspace';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * workspaces.\r\n */\r\nexport class WorkspaceStore extends EntityStore<Workspace> {\r\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Activate the an workspace workspace and deactivate the one currently active\r\n   * @param workspace Workspace\r\n   */\r\n  activateWorkspace(workspace: Workspace) {\r\n    const active = this.activeWorkspace$.value;\r\n    if (active !== undefined) {\r\n      active.deactivate();\r\n    }\r\n\r\n    this.deactivateWorkspace();\r\n    if (workspace !== undefined) {\r\n      this.state.update(workspace, { active: true, selected: true }, true);\r\n      this.activeWorkspace$.next(workspace);\r\n      workspace.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate the current workspace\r\n   * @param workspace Workspace\r\n   */\r\n  deactivateWorkspace() {\r\n    const active = this.activeWorkspace$.value;\r\n    if (active !== undefined) {\r\n      active.deactivate();\r\n      this.activeWorkspace$.next(undefined);\r\n    }\r\n  }\r\n}\r\n","import { BehaviorSubject, Subject, Subscription } from 'rxjs';\r\n\r\nimport { ActionStore } from '../../action';\r\nimport { EntityStoreWithStrategy } from '../../entity';\r\nimport { Widget } from '../../widget';\r\nimport { WorkspaceOptions } from './workspace.interfaces';\r\n\r\n/**\r\n * This class is responsible of managing the relations between\r\n * entities and the actions that consume them. It also defines an\r\n * entity table template that may be used by an entity table component.\r\n */\r\nexport class Workspace<E extends object = object> {\r\n  /**\r\n   * Observable of the selected widget\r\n   */\r\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\r\n\r\n  /**\r\n   * Observable of the selected widget's inputs\r\n   */\r\n  readonly widgetInputs$ = new BehaviorSubject<{ [key: string]: any }>({});\r\n\r\n  /**\r\n   * Observable of the selected widget's subscribers\r\n   */\r\n  readonly widgetSubscribers$ = new BehaviorSubject<{\r\n    [key: string]: (event: any) => void;\r\n  }>({});\r\n\r\n  /**\r\n   * Subscription to the selected entity\r\n   */\r\n  private entities$$: Subscription;\r\n\r\n  /**\r\n   * State change that trigger an update of the actions availability\r\n   */\r\n  private change: Subject<void> = new Subject();\r\n\r\n  /**\r\n   * Subscription to state changes\r\n   */\r\n  private change$: Subscription;\r\n\r\n  /**\r\n   * Workspace id\r\n   */\r\n  get id(): string {\r\n    return this.options.id;\r\n  }\r\n\r\n  /**\r\n   * Workspace title\r\n   */\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  /**\r\n   * Workspace title\r\n   */\r\n  get meta(): { [key: string]: any } {\r\n    return this.options.meta || {};\r\n  }\r\n\r\n  /**\r\n   * Entities store\r\n   */\r\n  get entityStore(): EntityStoreWithStrategy<E> {\r\n    return this.options.entityStore as EntityStoreWithStrategy<E>;\r\n  }\r\n\r\n  /**\r\n   * Actions store (some actions activate a widget)\r\n   */\r\n  get actionStore(): ActionStore {\r\n    return this.options.actionStore;\r\n  }\r\n\r\n  /**\r\n   * Selected widget\r\n   */\r\n  get widget(): Widget {\r\n    return this.widget$.value;\r\n  }\r\n\r\n  /**\r\n   * Whether a widget is selected\r\n   */\r\n  get hasWidget(): boolean {\r\n    return this.widget !== undefined;\r\n  }\r\n\r\n  constructor(protected options: WorkspaceOptions) {}\r\n\r\n  /**\r\n   * Whether this strategy is active\r\n   * @internal\r\n   */\r\n  get active(): boolean {\r\n    return this.active$.value;\r\n  }\r\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Activate the workspace. By doing that, the workspace will observe\r\n   * the selected entity (from the store) and update the actions availability.\r\n   * For example, some actions require an entity to be selected.\r\n   */\r\n  activate() {\r\n    if (this.active === true) {\r\n      this.deactivate();\r\n    }\r\n    this.active$.next(true);\r\n\r\n    if (this.entityStore !== undefined) {\r\n      this.entities$$ = this.entityStore.stateView\r\n        .all$()\r\n        .subscribe(() => this.onStateChange());\r\n    }\r\n\r\n    this.change.next();\r\n  }\r\n\r\n  /**\r\n   * Deactivate the workspace. Unsubcribe to the selected entity.\r\n   */\r\n  deactivate() {\r\n    this.active$.next(false);\r\n    this.deactivateWidget();\r\n\r\n    if (this.entities$$ !== undefined) {\r\n      this.entities$$.unsubscribe();\r\n    }\r\n    if (this.change$ !== undefined) {\r\n      this.change$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a widget. In itself, activating a widget doesn't render it but,\r\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\r\n   * show up.\r\n   * @param widget Widget\r\n   * @param inputs Inputs the widget will receive\r\n   */\r\n  activateWidget(\r\n    widget: Widget,\r\n    inputs: { [key: string]: any } = {},\r\n    subscribers: { [key: string]: (event: any) => void } = {}\r\n  ) {\r\n    this.widget$.next(widget);\r\n    this.widgetInputs$.next(inputs);\r\n    this.widgetSubscribers$.next(subscribers);\r\n    this.change.next();\r\n  }\r\n\r\n  /**\r\n   * Deactivate a widget.\r\n   */\r\n  deactivateWidget() {\r\n    this.widget$.next(undefined);\r\n    this.change.next();\r\n  }\r\n\r\n  /**\r\n   * When the state changes, update the actions availability.\r\n   */\r\n  private onStateChange() {\r\n    this.change.next();\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { getEntityTitle } from '../../entity';\r\nimport { WorkspaceStore } from '../shared/store';\r\nimport { Workspace } from '../shared/workspace';\r\n\r\n/**\r\n * Drop list that activates the selected workspace emit an event.\r\n */\r\n@Component({\r\n  selector: 'igo-workspace-selector',\r\n  templateUrl: './workspace-selector.component.html',\r\n  styleUrls: ['./workspace-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WorkspaceSelectorComponent {\r\n  /**\r\n   * Store that holds the available workspaces.\r\n   */\r\n  @Input() store: WorkspaceStore;\r\n\r\n  /**\r\n   * Wheither the selector must be disabled or not.\r\n   */\r\n  @Input() disabled: boolean;\r\n\r\n  /**\r\n   * Event emitted when an workspace is selected or unselected\r\n   */\r\n  @Output() selectedChange = new EventEmitter<{\r\n    selected: boolean;\r\n    value: Workspace;\r\n  }>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  getWorkspaceTitle(workspace: Workspace): string {\r\n    return getEntityTitle(workspace);\r\n  }\r\n\r\n  /**\r\n   * When an workspace is manually selected, select it into the\r\n   * store and emit an event.\r\n   * @internal\r\n   * @param event The selection change event\r\n   */\r\n  onSelectedChange(event: { value: Workspace }) {\r\n    const workspace = event.value;\r\n    this.store.activateWorkspace(workspace);\r\n    this.selectedChange.emit({ selected: true, value: workspace });\r\n  }\r\n}\r\n","<igo-entity-selector\n  [store]=\"store\"\n  [multi]=\"false\"\n  [titleAccessor]=\"getWorkspaceTitle\"\n  [disabled]=\"disabled\"\n  (selectedChange)=\"onSelectedChange($event)\"\n>\n</igo-entity-selector>\n","<ng-container *ngIf=\"widget$ | async as widget\">\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"widgetInputs$ | async\"\n    [subscribers]=\"widgetSubscribers$ | async\"\n    (cancel)=\"onWidgetCancel(widget)\"\n    (complete)=\"onWidgetComplete(widget)\"\n  >\n  </igo-widget-outlet>\n</ng-container>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Widget } from '../../widget';\r\nimport { Workspace } from '../shared/workspace';\r\n\r\n/**\r\n * This component dynamically render an Workspace's active widget.\r\n * It also deactivate that widget whenever the widget's component\r\n * emit the 'cancel' or 'complete' event.\r\n */\r\n@Component({\r\n  selector: 'igo-workspace-widget-outlet',\r\n  templateUrl: './workspace-widget-outlet.component.html',\r\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WorkspaceWidgetOutletComponent {\r\n  /**\r\n   * Workspace\r\n   */\r\n  @Input() workspace: Workspace;\r\n\r\n  /**\r\n   * Event emitted when a widget is deactivate which happens\r\n   * when the widget's component emits the 'cancel' or 'complete' event.\r\n   */\r\n  @Output() deactivateWidget = new EventEmitter<Widget>();\r\n\r\n  /**\r\n   * Observable of the workspace's active widget\r\n   * @internal\r\n   */\r\n  get widget$(): BehaviorSubject<Widget> {\r\n    return this.workspace.widget$;\r\n  }\r\n\r\n  /**\r\n   * Observable of the workspace's widget inputs\r\n   * @internal\r\n   */\r\n  get widgetInputs$(): BehaviorSubject<{ [key: string]: any }> {\r\n    return this.workspace.widgetInputs$;\r\n  }\r\n\r\n  /**\r\n   * Observable of the workspace's widget inputs\r\n   * @internal\r\n   */\r\n  get widgetSubscribers$(): BehaviorSubject<{\r\n    [key: string]: (event: any) => void;\r\n  }> {\r\n    return this.workspace.widgetSubscribers$;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * When a widget's component emit the 'cancel' event,\r\n   * deactivate that widget and emit the 'deactivateWidget' event.\r\n   * @param widget Widget\r\n   * @internal\r\n   */\r\n  onWidgetCancel(widget: Widget) {\r\n    this.workspace.deactivateWidget();\r\n    this.deactivateWidget.emit(widget);\r\n  }\r\n\r\n  /**\r\n   * When a widget's component emit the 'cancel' event,\r\n   * deactivate that widget and emit the 'deactivateWidget' event.\r\n   * @param widget Widget\r\n   * @internal\r\n   */\r\n  onWidgetComplete(widget: Widget) {\r\n    this.workspace.deactivateWidget();\r\n    this.deactivateWidget.emit(widget);\r\n  }\r\n}\r\n","<mat-form-field\r\n  class=\"fill-field\"\r\n  floatLabel=\"always\"\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  subscriptSizing=\"dynamic\"\r\n  cdkOverlayOrigin\r\n  #trigger=\"cdkOverlayOrigin\"\r\n  (click)=\"isOpen = !isOpen\"\r\n>\r\n  <mat-label>{{ colorPicker }}</mat-label>\r\n  <input\r\n    type=\"text\"\r\n    matInput\r\n    [readonly]=\"true\"\r\n    [style.background]=\"colorPicker\"\r\n  />\r\n</mat-form-field>\r\n\r\n<ng-template\r\n  cdkConnectedOverlay\r\n  [cdkConnectedOverlayOrigin]=\"trigger\"\r\n  [cdkConnectedOverlayOpen]=\"isOpen\"\r\n  [cdkConnectedOverlayHasBackdrop]=\"true\"\r\n  (backdropClick)=\"isOpen = false\"\r\n  cdkConnectedOverlayBackdropClass=\"cdk-overlay-transparent-backdrop\"\r\n>\r\n  <div class=\"picker\">\r\n    <color-chrome (onChange)=\"handleChange($event)\" [color]=\"colorPicker\">\r\n    </color-chrome>\r\n    <div class=\"buttons\">\r\n      <button mat-flat-button color=\"primary\" (click)=\"handleClick($event)\">\r\n        {{ 'igo.common.confirmDialog.applyBtn' | translate }}\r\n      </button>\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n","import { Component, Input, forwardRef } from '@angular/core';\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\n\r\nimport { ColorEvent } from 'ngx-color';\r\nimport tinycolor, { ColorInput } from 'tinycolor2';\r\n\r\ntype ColorFormat = 'hex' | 'rgba' | 'hsla';\r\n\r\n@Component({\r\n  selector: 'igo-color-picker-form-field',\r\n  templateUrl: './color-picker-form-field.component.html',\r\n  styleUrls: ['./color-picker-form-field.component.scss'],\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => ColorPickerFormFieldComponent),\r\n      multi: true\r\n    }\r\n  ]\r\n})\r\nexport class ColorPickerFormFieldComponent implements ControlValueAccessor {\r\n  isOpen: boolean = false;\r\n\r\n  set value(value: string) {\r\n    this._value = this.formatColor(value ?? '#000');\r\n    this.colorPicker = this._value;\r\n\r\n    this.onChange(this.value);\r\n    this.onTouch(this.value);\r\n  }\r\n  get value(): string {\r\n    return this._value;\r\n  }\r\n  private _value: string;\r\n\r\n  @Input() outputFormat: ColorFormat = 'rgba';\r\n\r\n  colorPicker: string;\r\n\r\n  onChange: any = () => {};\r\n  onTouch: any = () => {};\r\n\r\n  writeValue(value: string) {\r\n    this.value = value;\r\n  }\r\n\r\n  registerOnChange(fn: any) {\r\n    this.onChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: any) {\r\n    this.onTouch = fn;\r\n  }\r\n\r\n  handleClick(event: MouseEvent) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    this.isOpen = false;\r\n    this.value = this.colorPicker;\r\n  }\r\n\r\n  handleChange($event: ColorEvent) {\r\n    this.colorPicker = this.formatColor($event.color.rgb, 'rgba');\r\n  }\r\n\r\n  private formatColor(\r\n    color: ColorInput,\r\n    format: ColorFormat = this.outputFormat\r\n  ): string {\r\n    switch (format) {\r\n      case 'hex':\r\n        color = tinycolor(color).toHexString();\r\n        break;\r\n      case 'rgba':\r\n        color = tinycolor(color).toRgbString();\r\n        break;\r\n      case 'hsla':\r\n        color = tinycolor(color).toHsvString();\r\n        break;\r\n      default:\r\n        color = tinycolor(color).toRgbString();\r\n        break;\r\n    }\r\n    return color;\r\n  }\r\n}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppActionComponent } from './action.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'action',\r\n    component: AppActionComponent\r\n  }\r\n];\r\n\r\nexport const AppActionRoutingModule = RouterModule.forChild(routes);\r\n","import { Overlay } from '@angular/cdk/overlay';\r\nimport { Component, OnDestroy, OnInit } from '@angular/core';\r\n\r\nimport { ActionStore, ActionbarMode } from '@igo2/common';\r\nimport {\r\n  LanguageService,\r\n  Media,\r\n  MediaOrientation,\r\n  MediaService\r\n} from '@igo2/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-action',\r\n  templateUrl: './action.component.html',\r\n  styleUrls: ['./action.component.scss']\r\n})\r\nexport class AppActionComponent implements OnInit, OnDestroy {\r\n  public store = new ActionStore([]);\r\n\r\n  private added$ = new BehaviorSubject(false);\r\n\r\n  get actionbarMode(): ActionbarMode {\r\n    const media = this.mediaService.media$.value;\r\n    const orientation = this.mediaService.orientation$.value;\r\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\r\n      return ActionbarMode.Dock;\r\n    }\r\n    return ActionbarMode.Overlay;\r\n  }\r\n\r\n  constructor(\r\n    public overlay: Overlay,\r\n    private mediaService: MediaService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.store.load([\r\n      {\r\n        id: 'add',\r\n        title: 'Add',\r\n        icon: 'plus',\r\n        tooltip: 'Add Tooltip',\r\n        handler: () => {\r\n          alert('Add!');\r\n          this.added$.next(true);\r\n        }\r\n      },\r\n      {\r\n        id: 'edit',\r\n        title: 'Edit',\r\n        icon: 'pencil',\r\n        tooltip: 'Edit Tooltip',\r\n        args: ['1'],\r\n        handler: (item: string) => {\r\n          alert(`Edit item ${item}!`);\r\n        },\r\n        availability: () => this.added$\r\n      },\r\n      {\r\n        id: 'delete',\r\n        title: 'Delete',\r\n        tooltip: 'Delete Tooltip',\r\n        icon: 'delete',\r\n        handler: () => {\r\n          alert('Delete!');\r\n          this.added$.next(false);\r\n        },\r\n        availability: () => this.added$\r\n      }\r\n    ]);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Action\" subtitle=\"Common\">\n  <app-example-viewer title=\"Action Bar\" codeFolder=\"common/action\">\n    <igo-actionbar\n      [store]=\"store\"\n      [withIcon]=\"true\"\n      [withTitle]=\"actionbarMode === 'overlay'\"\n      [horizontal]=\"true\"\n      [mode]=\"actionbarMode\"\n    >\n    </igo-actionbar>\n  </app-example-viewer>\n\n  <!-- <app-example-viewer title=\"Action context-menu\" codeFolder=\"common/action\">\n    <mat-card [igoContextMenu]=\"actionbarMenu\">\n      <mat-card-header>\n        <mat-card-subtitle>Common</mat-card-subtitle>\n        <mat-card-title>Action context-menu</mat-card-title>\n      </mat-card-header>\n      <div></div>\n    </mat-card>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"true\"\n        [horizontal]=\"true\"\n        [mode]=\"'context'\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer> -->\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoActionModule, IgoContextMenuModule } from '@igo2/common';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppActionRoutingModule } from './action-routing.module';\r\nimport { AppActionComponent } from './action.component';\r\n\r\n@NgModule({\r\n  declarations: [AppActionComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppActionRoutingModule,\r\n    IgoActionModule,\r\n    IgoContextMenuModule\r\n  ],\r\n  exports: [AppActionComponent]\r\n})\r\nexport class AppActionModule {}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input\r\n} from '@angular/core';\r\n\r\nimport { OnUpdateInputs } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-salutation-component',\r\n  template: '<p>Hello, my name is {{name}}.</p>',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSalutationComponent implements OnUpdateInputs {\r\n  @Input() name: string;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'app-explanation-component',\r\n  template:\r\n    '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppExplanationComponent implements OnUpdateInputs {\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'app-dynamic-component',\r\n  templateUrl: './dynamic-component.component.html',\r\n  styleUrls: ['./dynamic-component.component.scss']\r\n})\r\nexport class AppDynamicComponentComponent {\r\n  component: any = AppSalutationComponent;\r\n\r\n  inputs = { name: 'Bob' };\r\n\r\n  toggleComponent() {\r\n    this.component =\r\n      this.component === AppSalutationComponent\r\n        ? AppExplanationComponent\r\n        : AppSalutationComponent;\r\n  }\r\n}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppDynamicComponentComponent } from './dynamic-component.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'dynamic-component',\r\n    component: AppDynamicComponentComponent\r\n  }\r\n];\r\n\r\nexport const AppDynamicComponentRoutingModule = RouterModule.forChild(routes);\r\n","<app-doc-viewer title=\"Dynamic Component\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/dynamic-component\">\n    <igo-dynamic-outlet [component]=\"component\" [inputs]=\"inputs\">\n    </igo-dynamic-outlet>\n\n    <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">\n      Toggle Component\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoDynamicComponentModule } from '@igo2/common';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppDynamicComponentRoutingModule } from './dynamic-component-routing.module';\r\nimport {\r\n  AppDynamicComponentComponent,\r\n  AppExplanationComponent,\r\n  AppSalutationComponent\r\n} from './dynamic-component.component';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppSalutationComponent,\r\n    AppDynamicComponentComponent,\r\n    AppExplanationComponent\r\n  ],\r\n  imports: [\r\n    SharedModule,\r\n    AppDynamicComponentRoutingModule,\r\n    IgoDynamicComponentModule\r\n  ],\r\n  exports: [AppDynamicComponentComponent]\r\n})\r\nexport class AppDynamicComponentModule {}\r\n","<app-doc-viewer title=\"Entity Selector\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/entity-selector\">\n    <igo-entity-selector\n      [store]=\"store\"\n      [titleAccessor]=\"getTitle\"\n      [emptyText]=\"''\"\n      [placeholder]=\"'Select an entity'\"\n      (selectedChange)=\"onSelectedChange($event)\"\n    >\n    </igo-entity-selector>\n\n    <div *ngIf=\"selected$ | async as selected\">\n      <p>ID: {{ selected.id }}</p>\n      <p>Name: {{ selected.name }}</p>\n      <p>Description: <span [innerHtml]=\"selected.description\"></span></p>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppEntitySelectorComponent } from './entity-selector.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'entity-selector',\r\n    component: AppEntitySelectorComponent\r\n  }\r\n];\r\n\r\nexport const AppEntitySelectorRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\ninterface DemoEntity {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-entity-selector',\r\n  templateUrl: './entity-selector.component.html',\r\n  styleUrls: ['./entity-selector.component.scss']\r\n})\r\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\r\n  public store = new EntityStore([]);\r\n\r\n  public selected$ = new BehaviorSubject<DemoEntity>(undefined);\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    this.store.load([\r\n      { id: '2', name: 'Name 2', description: '<b>Description 2</b>' },\r\n      { id: '1', name: 'Name 1', description: '<b>Description 1</b>' },\r\n      { id: '3', name: 'Name 3', description: '<b>Description 3</b>' }\r\n    ]);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  getTitle(entity: DemoEntity): string {\r\n    return entity.name;\r\n  }\r\n\r\n  onSelectedChange(event: { selected: boolean; entity: DemoEntity }) {\r\n    this.selected$.next(event.entity);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoEntitySelectorModule } from '@igo2/common';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppEntitySelectorRoutingModule } from './entity-selector-routing.module';\r\nimport { AppEntitySelectorComponent } from './entity-selector.component';\r\n\r\n@NgModule({\r\n  declarations: [AppEntitySelectorComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppEntitySelectorRoutingModule,\r\n    IgoEntitySelectorModule\r\n  ],\r\n  exports: [AppEntitySelectorComponent]\r\n})\r\nexport class AppEntitySelectorModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppEntityTableComponent } from './entity-table.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'entity-table',\r\n    component: AppEntityTableComponent\r\n  }\r\n];\r\n\r\nexport const AppEntityTableRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\n\r\nimport {\r\n  EntityStore,\r\n  EntityTableButton,\r\n  EntityTableColumnRenderer,\r\n  EntityTablePaginatorOptions,\r\n  getEntityProperty\r\n} from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-entity-table',\r\n  templateUrl: './entity-table.component.html',\r\n  styleUrls: ['./entity-table.component.scss']\r\n})\r\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\r\n  public store = new EntityStore([]);\r\n  public paginator: MatPaginator;\r\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public paginatorOptions: EntityTablePaginatorOptions = { pageSize: 10 };\r\n\r\n  public template = {\r\n    selection: true,\r\n    selectionCheckbox: true,\r\n    selectMany: true,\r\n    sort: true,\r\n    valueAccessor: (entity: object, name: string) => {\r\n      return getEntityProperty(entity, name);\r\n    },\r\n    columns: [\r\n      {\r\n        name: 'selected',\r\n        title: 'Selected',\r\n        valueAccessor: (entity: object) => {\r\n          return this.store.state.get(entity).selected\r\n            ? 'radiobox-marked'\r\n            : 'radiobox-blank';\r\n        },\r\n        renderer: EntityTableColumnRenderer.Icon\r\n      },\r\n      {\r\n        name: 'id',\r\n        title: 'ID'\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name'\r\n      },\r\n      {\r\n        name: 'description',\r\n        title: 'Description',\r\n        renderer: EntityTableColumnRenderer.HTML\r\n      },\r\n      {\r\n        name: 'url',\r\n        title: 'Hyperlink'\r\n      },\r\n      {\r\n        name: 'image',\r\n        title: 'Image'\r\n      },\r\n      {\r\n        name: 'action',\r\n        title: '',\r\n        valueAccessor: (entity: object) => {\r\n          return [\r\n            {\r\n              icon: 'home',\r\n              color: 'warn',\r\n              click: (row) => {\r\n                console.log(row);\r\n              }\r\n            }\r\n          ] as EntityTableButton[];\r\n        },\r\n        renderer: EntityTableColumnRenderer.ButtonGroup\r\n      }\r\n    ]\r\n  };\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    const ids = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\r\n\r\n    const entities = ids.map((id) => {\r\n      if (id === 3) {\r\n        return {\r\n          id,\r\n          name: `Name ${id}`,\r\n          description: `<b>Description ${id}</b>`,\r\n          url: 'https://igouverte.org',\r\n          image: 'https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png'\r\n        };\r\n      }\r\n      return {\r\n        id,\r\n        name: `Name ${id}`,\r\n        description: `<b>Description ${id}</b>`,\r\n        url: 'https://igouverte.org',\r\n        image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'\r\n      };\r\n    });\r\n    this.store.load(entities);\r\n  }\r\n\r\n  entitySortChange() {\r\n    this.entitySortChange$.next(true);\r\n  }\r\n\r\n  paginatorChange(event: MatPaginator) {\r\n    this.paginator = event;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Entity Table\" subtitle=\"Common\">\r\n  <app-example-viewer codeFolder=\"common/entity-table\">\r\n    <igo-entity-table\r\n      [store]=\"store\"\r\n      [withPaginator]=\"true\"\r\n      [paginatorOptions]=\"paginatorOptions\"\r\n      [template]=\"template\"\r\n      (entitySortChange)=\"entitySortChange()\"\r\n    >\r\n    </igo-entity-table>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport {\r\n  IgoEntityTableModule,\r\n  IgoEntityTablePaginatorModule\r\n} from '@igo2/common';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppEntityTableRoutingModule } from './entity-table-routing.module';\r\nimport { AppEntityTableComponent } from './entity-table.component';\r\n\r\n@NgModule({\r\n  declarations: [AppEntityTableComponent],\r\n  imports: [\r\n    AppEntityTableRoutingModule,\r\n    SharedModule,\r\n    IgoEntityTableModule,\r\n    IgoEntityTablePaginatorModule\r\n  ],\r\n  exports: [AppEntityTableComponent]\r\n})\r\nexport class AppEntityTableModule {}\r\n","<app-doc-viewer title=\"Form\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/form\">\n    <igo-form\n      *ngIf=\"form$ | async as form\"\n      [form]=\"form\"\n      [formData]=\"data$ | async\"\n      (submitForm)=\"onSubmit($event)\"\n    >\n      <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n      <div formButtons class=\"actions-container\">\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"fillForm()\"\n        >\n          Fill Form\n        </button>\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"clearForm()\"\n        >\n          Clear Form\n        </button>\n        <button\n          mat-flat-button\n          type=\"submit\"\n          color=\"primary\"\n          [disabled]=\"submitDisabled\"\n        >\n          Submit\n        </button>\n      </div>\n    </igo-form>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppFormComponent } from './form.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'form',\r\n    component: AppFormComponent\r\n  }\r\n];\r\n\r\nexport const AppFormRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { Validators } from '@angular/forms';\r\n\r\nimport { Form, FormService } from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-form',\r\n  templateUrl: './form.component.html',\r\n  styleUrls: ['./form.component.scss']\r\n})\r\nexport class AppFormComponent implements OnInit, OnDestroy {\r\n  form$ = new BehaviorSubject<Form>(undefined);\r\n\r\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\r\n\r\n  submitDisabled = true;\r\n\r\n  private valueChanges$$: Subscription;\r\n\r\n  constructor(\r\n    private formService: FormService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    const fieldConfigs = [\r\n      {\r\n        name: 'id',\r\n        title: 'ID',\r\n        options: {\r\n          cols: 1,\r\n          validator: Validators.required\r\n        }\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name',\r\n        options: {\r\n          cols: 1,\r\n          validator: Validators.required\r\n        }\r\n      },\r\n      {\r\n        name: 'status',\r\n        title: 'Status',\r\n        type: 'select',\r\n        options: {\r\n          cols: 2\r\n        },\r\n        inputs: {\r\n          choices: [\r\n            { value: 1, title: 'Single' },\r\n            { value: 2, title: 'Married' }\r\n          ]\r\n        }\r\n      }\r\n    ];\r\n\r\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\r\n    const form = this.formService.form(\r\n      [],\r\n      [this.formService.group({ name: 'info' }, fields)]\r\n    );\r\n\r\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\r\n      this.submitDisabled = !form.control.valid;\r\n    });\r\n\r\n    this.form$.next(form);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.valueChanges$$.unsubscribe();\r\n  }\r\n\r\n  fillForm() {\r\n    this.data$.next({\r\n      id: 1,\r\n      name: 'Bob',\r\n      status: 2\r\n    });\r\n  }\r\n\r\n  clearForm() {\r\n    this.form$.value.control.reset();\r\n  }\r\n\r\n  onSubmit(data: { [key: string]: any }) {\r\n    alert(JSON.stringify(data));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoFormModule } from '@igo2/common';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppFormRoutingModule } from './form-routing.module';\r\nimport { AppFormComponent } from './form.component';\r\n\r\n@NgModule({\r\n  declarations: [AppFormComponent],\r\n  imports: [SharedModule, AppFormRoutingModule, IgoFormModule],\r\n  exports: [AppFormComponent]\r\n})\r\nexport class AppFormModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppTableComponent } from './table.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'table',\r\n    component: AppTableComponent\r\n  }\r\n];\r\n\r\nexport const AppTableRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\nimport { TableActionColor, TableDatabase } from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-table',\r\n  templateUrl: './table.component.html',\r\n  styleUrls: ['./table.component.scss']\r\n})\r\nexport class AppTableComponent implements OnInit {\r\n  public database: TableDatabase;\r\n\r\n  public model = {\r\n    columns: [\r\n      {\r\n        name: 'id',\r\n        title: 'ID',\r\n        sortable: false,\r\n        filterable: true\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name',\r\n        sortable: true,\r\n        filterable: true\r\n      },\r\n      {\r\n        name: 'description',\r\n        title: 'Description',\r\n        sortable: true,\r\n        filterable: true\r\n      }\r\n    ],\r\n    actions: [\r\n      {\r\n        icon: 'file-document',\r\n        color: TableActionColor.primary,\r\n        click: (row) => this.showName(row.name)\r\n      }\r\n    ],\r\n    selectionCheckbox: true\r\n  };\r\n\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    this.database = new TableDatabase([\r\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\r\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\r\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\r\n    ]);\r\n  }\r\n\r\n  showName(name) {\r\n    alert(name);\r\n  }\r\n\r\n  handleSelect(rows) {\r\n    console.log(rows);\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Table\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/table\">\n    <igo-table\n      [database]=\"database\"\n      [model]=\"model\"\n      [hasFilterInput]=\"true\"\n      (select)=\"handleSelect($event)\"\n    >\n    </igo-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoTableModule } from '@igo2/common';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppTableRoutingModule } from './table-routing.module';\r\nimport { AppTableComponent } from './table.component';\r\n\r\n@NgModule({\r\n  declarations: [AppTableComponent],\r\n  imports: [SharedModule, AppTableRoutingModule, IgoTableModule],\r\n  exports: [AppTableComponent]\r\n})\r\nexport class AppTableModule {}\r\n","<div\n  *ngIf=\"withHeader\"\n  class=\"igo-panel-header\"\n  title=\"\"\n  [ngClass]=\"{ 'igo-cursor-pointer': cursorPointer === true }\"\n>\n  <div class=\"panel-left\">\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\n  </div>\n  <h3 class=\"igo-panel-title\">\n    {{ title }}\n    <ng-content select=\"[panelHeader]\"></ng-content>\n  </h3>\n  <div class=\"panel-right\">\n    <ng-content select=\"[panelRightButton]\"></ng-content>\n  </div>\n</div>\n<div class=\"igo-panel-content\" title=\"\">\n  <ng-content></ng-content>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  HostBinding,\r\n  Input\r\n} from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'igo-panel',\r\n  templateUrl: './panel.component.html',\r\n  styleUrls: ['./panel.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class PanelComponent {\r\n  @Input() title: string;\r\n\r\n  @Input()\r\n  @HostBinding('class.igo-panel-with-header')\r\n  get withHeader(): boolean {\r\n    return this._withHeader;\r\n  }\r\n  set withHeader(value: boolean) {\r\n    this._withHeader = value;\r\n  }\r\n  private _withHeader = true;\r\n\r\n  @Input() cursorPointer: boolean = false;\r\n}\r\n","<app-doc-viewer title=\"Tool\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/tool\">\n    <igo-panel [title]=\"panelTitle\">\n      <button\n        mat-icon-button\n        panelLeftButton\n        (click)=\"toolbox.activatePreviousTool()\"\n        *ngIf=\"activeTool$ | async\"\n      >\n        <mat-icon svgIcon=\"arrow-back\"></mat-icon>\n      </button>\n\n      <button\n        mat-icon-button\n        panelRightButton\n        (click)=\"toolbox.deactivateTool()\"\n        *ngIf=\"activeTool$ | async\"\n      >\n        <mat-icon svgIcon=\"menu\"></mat-icon>\n      </button>\n\n      <igo-toolbox\n        [toolbox]=\"toolbox\"\n        [animate]=\"true\"\n        color=\"primary\"\n      ></igo-toolbox>\n    </igo-panel>\n\n    <button\n      mat-flat-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"activateSalutationTool()\"\n    >\n      Activate Salutation Tool\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport {\r\n  OnUpdateInputs,\r\n  Tool,\r\n  ToolComponent,\r\n  ToolService,\r\n  Toolbox\r\n} from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@ToolComponent({\r\n  name: 'demo-salutation',\r\n  title: 'Salutation',\r\n  icon: 'account',\r\n  options: { name: 'Jack' }\r\n})\r\n@Component({\r\n  selector: 'app-salutation-tool',\r\n  template: ` <p>Hello, my name is {{ name }}.</p> `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSalutationToolComponent implements OnUpdateInputs {\r\n  @Input() name: string;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n}\r\n\r\n@ToolComponent({\r\n  name: 'demo-about',\r\n  title: 'About',\r\n  icon: 'information'\r\n})\r\n@Component({\r\n  selector: 'app-about-tool',\r\n  template: ` <p>I'm a tool inside a toolbox.</p> `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppAboutToolComponent {}\r\n\r\n@Component({\r\n  selector: 'app-tool',\r\n  templateUrl: './tool.component.html',\r\n  styleUrls: ['./tool.component.scss']\r\n})\r\nexport class AppToolComponent implements OnInit, OnDestroy {\r\n  toolbox = new Toolbox();\r\n\r\n  get activeTool$(): BehaviorSubject<Tool> {\r\n    return this.toolbox.activeTool$;\r\n  }\r\n\r\n  get panelTitle(): string {\r\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\r\n  }\r\n\r\n  constructor(\r\n    private toolService: ToolService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\r\n    this.toolbox.setTools(this.toolService.getTools());\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.toolbox.destroy();\r\n  }\r\n\r\n  activateSalutationTool() {\r\n    this.toolbox.activateTool('demo-salutation', { name: 'Bob' });\r\n  }\r\n}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppToolComponent } from './tool.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'tool',\r\n    component: AppToolComponent\r\n  }\r\n];\r\n\r\nexport const AppToolRoutingModule = RouterModule.forChild(routes);\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoPanelModule, IgoToolModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppToolRoutingModule } from './tool-routing.module';\r\nimport {\r\n  AppAboutToolComponent,\r\n  AppSalutationToolComponent,\r\n  AppToolComponent\r\n} from './tool.component';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppToolComponent,\r\n    AppSalutationToolComponent,\r\n    AppAboutToolComponent\r\n  ],\r\n  imports: [\r\n    SharedModule,\r\n    AppToolRoutingModule,\r\n    IgoLanguageModule,\r\n    IgoPanelModule,\r\n    IgoToolModule.forRoot()\r\n  ],\r\n  exports: [AppToolComponent]\r\n})\r\nexport class AppToolModule {}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport {\r\n  DynamicComponent,\r\n  OnUpdateInputs,\r\n  WidgetComponent,\r\n  WidgetService\r\n} from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-salutation-widget',\r\n  template: `\r\n    <p>Hello, my name is {{ name }}.</p>\r\n    <button mat-flat-button (click)=\"complete.emit(name)\">\r\n      Nice to meet you\r\n    </button>\r\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\r\n  `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSalutationWidgetComponent\r\n  implements OnUpdateInputs, WidgetComponent\r\n{\r\n  @Input() name: string;\r\n\r\n  @Output() complete = new EventEmitter<string>();\r\n\r\n  @Output() cancel = new EventEmitter<string>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'app-widget',\r\n  templateUrl: './widget.component.html',\r\n  styleUrls: ['./widget.component.scss']\r\n})\r\nexport class AppWidgetComponent {\r\n  widget: DynamicComponent<WidgetComponent>;\r\n\r\n  inputs = { name: 'Bob' };\r\n\r\n  constructor(private widgetService: WidgetService) {\r\n    this.widget = this.widgetService.create(AppSalutationWidgetComponent);\r\n  }\r\n\r\n  onWidgetComplete(name: string) {\r\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\r\n  }\r\n\r\n  onWidgetCancel() {\r\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\r\n  }\r\n}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppWidgetComponent } from './widget.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'widget',\r\n    component: AppWidgetComponent\r\n  }\r\n];\r\n\r\nexport const AppWidgetRoutingModule = RouterModule.forChild(routes);\r\n","<app-doc-viewer title=\"Widget\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/widget\">\n    <igo-widget-outlet\n      [widget]=\"widget\"\n      [inputs]=\"inputs\"\n      (complete)=\"onWidgetComplete($event)\"\n      (cancel)=\"onWidgetCancel()\"\n    >\n    </igo-widget-outlet>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoWidgetModule } from '@igo2/common';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppWidgetRoutingModule } from './widget-routing.module';\r\nimport {\r\n  AppSalutationWidgetComponent,\r\n  AppWidgetComponent\r\n} from './widget.component';\r\n\r\n@NgModule({\r\n  declarations: [AppSalutationWidgetComponent, AppWidgetComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppWidgetRoutingModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    IgoWidgetModule\r\n  ],\r\n  exports: [AppWidgetComponent]\r\n})\r\nexport class AppWidgetModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoSpinnerModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { ContextImportExportComponent } from './context-import-export/context-import-export.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatDividerModule,\r\n    MatTabsModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule,\r\n    IgoSpinnerModule,\r\n    MatTooltipModule\r\n  ],\r\n  exports: [ContextImportExportComponent],\r\n  declarations: [ContextImportExportComponent]\r\n})\r\nexport class IgoContextImportExportModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextImportExportModule> {\r\n    return {\r\n      ngModule: IgoContextImportExportModule\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { EMPTY, Observable } from 'rxjs';\r\n\r\nimport { Poi } from './poi.interface';\r\n\r\n@Injectable()\r\nexport class PoiService {\r\n  private baseUrl: string;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService\r\n  ) {\r\n    this.baseUrl = this.config.getConfig('context.url');\r\n  }\r\n\r\n  get(): Observable<Poi[]> {\r\n    if (!this.baseUrl) {\r\n      return EMPTY;\r\n    }\r\n\r\n    const url = this.baseUrl + '/pois';\r\n    return this.http.get<Poi[]>(url);\r\n  }\r\n\r\n  delete(id: string): Observable<void> {\r\n    const url = this.baseUrl + '/pois/' + id;\r\n    return this.http.delete<void>(url);\r\n  }\r\n\r\n  create(context: Poi): Observable<Poi> {\r\n    const url = this.baseUrl + '/pois';\r\n    return this.http.post<Poi>(url, context);\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoAuthModule } from '@igo2/auth';\r\nimport { IgoConfirmDialogModule, IgoStopPropagationModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { BookmarkButtonComponent } from './bookmark-button/bookmark-button.component';\r\nimport { BookmarkDialogComponent } from './bookmark-button/bookmark-dialog.component';\r\nimport { PoiButtonComponent } from './poi-button/poi-button.component';\r\nimport { PoiDialogComponent } from './poi-button/poi-dialog.component';\r\nimport { PoiService } from './poi-button/shared/poi.service';\r\nimport { UserButtonComponent } from './user-button/user-button.component';\r\nimport { UserDialogComponent } from './user-button/user-dialog.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IgoAuthModule,\r\n    IgoConfirmDialogModule,\r\n    IgoLanguageModule,\r\n    IgoStopPropagationModule,\r\n    MatButtonModule,\r\n    MatDialogModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatTooltipModule\r\n  ],\r\n  exports: [\r\n    BookmarkButtonComponent,\r\n    PoiButtonComponent,\r\n    UserButtonComponent,\r\n    BookmarkDialogComponent\r\n  ],\r\n  declarations: [\r\n    BookmarkButtonComponent,\r\n    BookmarkDialogComponent,\r\n    PoiButtonComponent,\r\n    PoiDialogComponent,\r\n    UserButtonComponent,\r\n    UserDialogComponent\r\n  ],\r\n  providers: [PoiService]\r\n})\r\nexport class IgoContextMapButtonModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextMapButtonModule> {\r\n    return {\r\n      ngModule: IgoContextMapButtonModule\r\n    };\r\n  }\r\n}\r\n","import { NumberUtils } from '@igo2/utils';\r\n\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { MAC } from 'ol/has';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { MapViewState } from './map.interface';\r\nimport { Projection } from './projection.interfaces';\r\n\r\n/**\r\n * This method extracts a coordinate tuple from a string.\r\n * @param str Any string\r\n * @param mapProjection string Map Projection\r\n * @param opts.forceNA boolean Force North America Zone\r\n * @returns object:\r\n *             lonLat: Coordinate,\r\n *             message: Message of error,\r\n *             radius: radius of the confience of coordinate,\r\n *             conf: confidence of the coordinate}\r\n */\r\nexport function stringToLonLat(\r\n  str: string,\r\n  mapProjection: string,\r\n  opts: { forceNA?: boolean } = {}\r\n): {\r\n  lonLat: [number, number] | undefined;\r\n  message: string;\r\n  radius: number | undefined;\r\n  conf: number | undefined;\r\n} {\r\n  let lonLat: [number, number];\r\n  let coordStr: string;\r\n  let negativeLon: string;\r\n  let degreesLon: string;\r\n  let minutesLon: string;\r\n  let secondsLon: string;\r\n  let directionLon: string;\r\n  let decimalLon: string;\r\n  let negativeLat: string;\r\n  let degreesLat: string;\r\n  let minutesLat: string;\r\n  let secondsLat: string;\r\n  let directionLat: string;\r\n  let decimalLat: string;\r\n  let zone: string;\r\n  let radius: string;\r\n  let conf: string;\r\n  let lon: any;\r\n  let lat: any;\r\n\r\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\r\n  const toProjection = '4326';\r\n  let projectionStr: string;\r\n  const projectionRegex = new RegExp(projectionPattern, 'g');\r\n\r\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\r\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\r\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\r\n\r\n  const dmsCoord =\r\n    '([0-9]{1,2})[:|]?\\\\s*([0-9]{1,2})?[:|\\'||]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"||]?\\\\s*';\r\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\r\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\r\n\r\n  const patternUtm =\r\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\r\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\r\n\r\n  const patternMtm =\r\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\r\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\r\n\r\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\r\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\r\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\r\n\r\n  const dmdCoord =\r\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\r\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\r\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\r\n\r\n  /* eslint-disable max-len */\r\n  const patternBELL =\r\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\r\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\r\n\r\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\r\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\r\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\r\n\r\n  let isXYCoords = false;\r\n\r\n  str = str.toLocaleUpperCase().trim();\r\n\r\n  // Extract projection\r\n  if (projectionRegex.test(str)) {\r\n    [coordStr, projectionStr] = str.split(';').map((s) => s.trim());\r\n  } else {\r\n    coordStr = str;\r\n  }\r\n  if (lonLatRegex.test(coordStr)) {\r\n    [, negativeLon, lon, , decimalLon, negativeLat, lat, , decimalLat] =\r\n      coordStr.match(lonLatPattern);\r\n\r\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\r\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\r\n  } else if (dmsRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      directionLon,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      directionLat\r\n    ] = coordStr.match(dmsCoordPattern);\r\n\r\n    if (directionLon === 'S' || directionLon === 'N') {\r\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\r\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\r\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\r\n      directionLon = [directionLat, (directionLat = directionLon)][0];\r\n    }\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat(degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat(degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (utmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\r\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\r\n    [lon, lat] = olproj.transform(\r\n      [parseFloat(lon), parseFloat(lat)],\r\n      epsgUtm,\r\n      'EPSG:4326'\r\n    );\r\n  } else if (mtmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\r\n    const epsgMtm =\r\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\r\n    [lon, lat] = olproj.transform(\r\n      [parseFloat(lon), parseFloat(lat)],\r\n      epsgMtm,\r\n      'EPSG:4326'\r\n    );\r\n  } else if (dmdRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      decimalLon,\r\n      negativeLat,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      decimalLat\r\n    ] = coordStr.match(patternDmd);\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (ddRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      degreesLon,\r\n      decimalLon,\r\n      negativeLat,\r\n      degreesLat,\r\n      decimalLat\r\n    ] = coordStr.match(patternDd);\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (bellRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLat,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      ,\r\n      directionLat,\r\n      negativeLon,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      ,\r\n      directionLon,\r\n      radius,\r\n      conf\r\n    ] = coordStr.match(patternBELL);\r\n\r\n    // Set default value for North America\r\n    if (!directionLon) {\r\n      directionLon = 'W';\r\n    }\r\n\r\n    // Check if real minutes or decimals\r\n    if (minutesLon && minutesLon.length > 2) {\r\n      lon = parseFloat(\r\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\r\n      );\r\n    } else {\r\n      lon = convertDMSToDD(\r\n        parseFloat(degreesLon),\r\n        parseFloat(minutesLon),\r\n        parseFloat(secondsLon),\r\n        directionLon\r\n      );\r\n    }\r\n\r\n    if (minutesLat && minutesLat.length > 2) {\r\n      lat = parseFloat(\r\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\r\n      );\r\n    } else {\r\n      lat = convertDMSToDD(\r\n        parseFloat(degreesLat),\r\n        parseFloat(minutesLat),\r\n        parseFloat(secondsLat),\r\n        directionLat\r\n      );\r\n    }\r\n  } else if (mmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\r\n\r\n    if (decimalLon) {\r\n      lon = parseFloat(lon + '.' + decimalLon);\r\n    }\r\n\r\n    if (decimalLat) {\r\n      lat = parseFloat(lat + '.' + decimalLat);\r\n    }\r\n  } else {\r\n    return {\r\n      lonLat: undefined,\r\n      message: '',\r\n      radius: undefined,\r\n      conf: undefined\r\n    };\r\n  }\r\n\r\n  if (opts.forceNA && !isXYCoords) {\r\n    // Set a negative coordinate for North America zone\r\n    if (lon > 0 && lat > 0) {\r\n      if (lon > lat) {\r\n        lon = -lon;\r\n      } else {\r\n        lat = -lat;\r\n      }\r\n    }\r\n\r\n    // Reverse coordinate to respect lonLat convention\r\n    if (lon > lat) {\r\n      lon = [lat, (lat = lon)][0];\r\n    }\r\n  }\r\n\r\n  lonLat = [Number(lon), Number(lat)] as [number, number];\r\n\r\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\r\n  if (\r\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\r\n    lonLat[0] > 180 ||\r\n    lonLat[0] < -180 ||\r\n    lonLat[1] > 90 ||\r\n    lonLat[1] < -90\r\n  ) {\r\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\r\n    const dest = 'EPSG:' + toProjection;\r\n\r\n    try {\r\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\r\n    } catch (e) {\r\n      return {\r\n        lonLat: undefined,\r\n        message: 'Projection ' + source + ' not supported',\r\n        radius: undefined,\r\n        conf: undefined\r\n      };\r\n    }\r\n  }\r\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\r\n    return {\r\n      lonLat,\r\n      message: '',\r\n      radius: radius ? parseInt(radius, 10) : undefined,\r\n      conf: conf ? parseInt(conf, 10) : undefined\r\n    };\r\n  } else {\r\n    return {\r\n      lonLat: undefined,\r\n      message: 'Coordinate out of Longitude/Latitude bounds',\r\n      radius: undefined,\r\n      conf: undefined\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Convert degrees minutes seconds to dd\r\n * @param degrees Degrees\r\n * @param minutes Minutes\r\n * @param seconds Seconds\r\n * @param direction Direction\r\n */\r\nfunction convertDMSToDD(\r\n  degrees: number,\r\n  minutes: number,\r\n  seconds: number,\r\n  direction: string\r\n) {\r\n  minutes = minutes || 0;\r\n  seconds = seconds || 0;\r\n\r\n  const neg = degrees < 0;\r\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\r\n\r\n  if (neg || direction === 'S' || direction === 'W') {\r\n    dd = -dd;\r\n  } // Don't do anything for N or E\r\n  return dd;\r\n}\r\n\r\n/**\r\n * Convert dd to degrees minutes seconds\r\n * @param lonLatDD longitude and latitude in dd\r\n * @param decimal number of decimals for seconds\r\n * @returns longitude and latitude in dms\r\n */\r\nexport function convertDDToDMS(\r\n  lonLatDD: [number, number],\r\n  decimal: number = 3\r\n): string[] {\r\n  const lonLatDMS = [];\r\n\r\n  lonLatDD.forEach((dd) => {\r\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\r\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\r\n    const minutes = Math.floor(int);\r\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\r\n\r\n    lonLatDMS.push(`${degrees} ${minutes}' ${seconds}\"`);\r\n  });\r\n  return lonLatDMS;\r\n}\r\n\r\n/**\r\n * Return true of two view states are equal.\r\n * @param state1 View state\r\n * @param state2 View state\r\n * @returns True if the view states are equal\r\n */\r\nexport function viewStatesAreEqual(\r\n  state1: MapViewState,\r\n  state2: MapViewState\r\n): boolean {\r\n  if (state1 === undefined || state2 === undefined) {\r\n    return false;\r\n  }\r\n\r\n  const tolerance = 1 / 10000;\r\n  return (\r\n    state1.zoom === state2.zoom &&\r\n    Math.trunc(state1.center[0] / tolerance) ===\r\n      Math.trunc(state2.center[0] / tolerance) &&\r\n    Math.trunc(state1.center[1] / tolerance) ===\r\n      Math.trunc(state2.center[1] / tolerance)\r\n  );\r\n}\r\n\r\n/**\r\n * Format the scale to a human readable text\r\n * @param Scale of the map\r\n * @returns Human readable scale text\r\n */\r\nexport function formatScale(scale) {\r\n  scale = Math.round(scale);\r\n  if (scale < 10000) {\r\n    return scale + '';\r\n  }\r\n\r\n  scale = Math.round(scale / 1000);\r\n  if (scale < 1000) {\r\n    return scale + 'K';\r\n  }\r\n\r\n  scale = Math.round(scale / 1000);\r\n  return scale + 'M';\r\n}\r\n\r\n/**\r\n * Return the resolution from a scale denom\r\n * @param scale Scale denom\r\n * @param dpi DPI\r\n * @returns Resolution\r\n */\r\nexport function getResolutionFromScale(\r\n  scale: number,\r\n  dpi: number = 96\r\n): number {\r\n  const inchesPerMeter = 39.3701;\r\n  return scale / (inchesPerMeter * dpi);\r\n}\r\n\r\n/**\r\n * Return the resolution from a scale denom\r\n * @param Scale denom\r\n * @returns Resolution\r\n */\r\nexport function getScaleFromResolution(\r\n  resolution: number,\r\n  unit: string = 'm',\r\n  dpi: number = 96\r\n): number {\r\n  const inchesPerMeter = 39.3701;\r\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\r\n}\r\n\r\n/**\r\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\r\n * @param event OL MapBrowserPointerEvent\r\n * @returns Whether the CTRL key is pushed\r\n */\r\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\r\n  const originalEvent = event.originalEvent;\r\n  return (\r\n    !originalEvent.altKey &&\r\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\r\n    !originalEvent.shiftKey\r\n  );\r\n}\r\n\r\nexport function roundCoordTo(\r\n  coord: [number, number],\r\n  decimal: number = 3\r\n): [number, number] {\r\n  return [\r\n    NumberUtils.roundToNDecimal(coord[0], decimal),\r\n    NumberUtils.roundToNDecimal(coord[1], decimal)\r\n  ] as [number, number];\r\n}\r\n\r\nexport function roundCoordToString(\r\n  coord: [number, number],\r\n  decimal: number = 3\r\n): [string, string] {\r\n  return roundCoordTo(coord, decimal).map((r) => r.toString()) as [\r\n    string,\r\n    string\r\n  ];\r\n}\r\n\r\n/**\r\n * Returns an array of converted coordinates.\r\n * Conversion is done for every configured projections\r\n * and for the current UTM zone and MTM zone.\r\n * @param lonLat [number, number] array of the coordinate to transform.\r\n * @param projections  Projection[] Array of destination projection.\r\n * @param reverseCoords To reverse coords from latLon to lonLat (search option)\r\n * @returns Returns an array of converted coordinates.\r\n */\r\nexport function lonLatConversion(\r\n  lonLat: [number, number],\r\n  projections: Projection[]\r\n): {\r\n  code: string;\r\n  alias: string;\r\n  coord: [number, number];\r\n  igo2CoordFormat: string;\r\n}[] {\r\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [\r\n    number,\r\n    number\r\n  ];\r\n  const convertedLonLat = [\r\n    {\r\n      code: 'EPSG:3857',\r\n      alias: 'Web Mercator',\r\n      coord: rawCoord3857,\r\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\r\n    }\r\n  ];\r\n\r\n  // detect the current utm zone.\r\n  const utmZone = utmZoneFromLonLat(lonLat);\r\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n  const utmName = `UTM-${utmZone}`;\r\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [\r\n    number,\r\n    number\r\n  ];\r\n  convertedLonLat.push({\r\n    code: epsgUtm,\r\n    alias: 'UTM',\r\n    coord: rawCoordUtm,\r\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\r\n  });\r\n\r\n  // detect the current mtm zone.\r\n  const mtmZone = mtmZoneFromLonLat(lonLat);\r\n  if (mtmZone) {\r\n    const epsgMtm =\r\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n    const mtmName = `MTM-${mtmZone}`;\r\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [\r\n      number,\r\n      number\r\n    ];\r\n    convertedLonLat.push({\r\n      code: epsgMtm,\r\n      alias: 'MTM',\r\n      coord: rawCoordMtm,\r\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\r\n    });\r\n  }\r\n\r\n  projections.forEach((projection) => {\r\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [\r\n      number,\r\n      number\r\n    ];\r\n    const numericEpsgCode = projection.code.split(':')[1];\r\n    convertedLonLat.push({\r\n      code: projection.code,\r\n      alias: projection.alias || projection.code,\r\n      coord: rawCoord,\r\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\r\n        ', '\r\n      )} ; ${numericEpsgCode}`\r\n    });\r\n  });\r\n\r\n  return convertedLonLat;\r\n}\r\n\r\n/**\r\n * Detect the current utm zone of the lon/lat coordinate.\r\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\r\n * @returns number The UTM zone.\r\n */\r\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\r\n  return Math.ceil((lonLat[0] + 180) / 6);\r\n}\r\n\r\n/**\r\n * Detect the current mtm zone of the lon/lat coordinate.\r\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\r\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\r\n */\r\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\r\n  const long = lonLat[0];\r\n  let mtmZone;\r\n  if (long < -51 && long > -54) {\r\n    mtmZone = 1;\r\n  }\r\n  if (long < -54 && long > -57) {\r\n    mtmZone = 2;\r\n  }\r\n  if (long < -57 && long > -60) {\r\n    mtmZone = 3;\r\n  }\r\n  if (long < -60 && long > -63) {\r\n    mtmZone = 4;\r\n  }\r\n  if (long < -63 && long > -66) {\r\n    mtmZone = 5;\r\n  }\r\n  if (long < -66 && long > -69) {\r\n    mtmZone = 6;\r\n  }\r\n  if (long < -69 && long > -72) {\r\n    mtmZone = 7;\r\n  }\r\n  if (long < -72 && long > -75) {\r\n    mtmZone = 8;\r\n  }\r\n  if (long < -75 && long > -78) {\r\n    mtmZone = 9;\r\n  }\r\n  if (long < -78 && long > -81) {\r\n    mtmZone = 10;\r\n  }\r\n  return mtmZone;\r\n}\r\n","import { asArray as ColorAsArray } from 'ol/color';\r\nimport * as olstyle from 'ol/style';\r\n\r\n/**\r\n * Create a marker style for points\r\n * @returns Style\r\n */\r\nexport function createOverlayMarkerStyle({\r\n  text,\r\n  opacity = 1,\r\n  markerColor = [0, 161, 222],\r\n  markerOutlineColor = [255, 255, 255]\r\n}: {\r\n  text?: string;\r\n  opacity?: number;\r\n  markerColor?: string | number[];\r\n  markerOutlineColor?: string | number[];\r\n} = {}): olstyle.Style {\r\n  let iconColor;\r\n  let svgIconColor;\r\n  let svgOutlineColor;\r\n  let svg;\r\n\r\n  const newColor = ColorAsArray(markerColor).slice(0);\r\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\r\n\r\n  if (\r\n    newColor.length === 4 &&\r\n    (typeof markerColor !== 'string' ||\r\n      /^#[0-9A-F]{8}$/i.test(markerColor as string))\r\n  ) {\r\n    opacity = newColor[3];\r\n  }\r\n\r\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\r\n  iconColor = markerColor;\r\n\r\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\r\n\r\n  svg =\r\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\r\n    '<path fill=' +\r\n    svgIconColor +\r\n    ' stroke=' +\r\n    svgOutlineColor +\r\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\r\n    '</svg>';\r\n\r\n  return new olstyle.Style({\r\n    image: new olstyle.Icon({\r\n      src: svg,\r\n      opacity,\r\n      anchor: [0.5, 0.92]\r\n    }),\r\n    text: new olstyle.Text({\r\n      text,\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport RenderFeature from 'ol/render/Feature';\r\nimport * as olStyle from 'ol/style';\r\n\r\nimport { ClusterParam } from '../../layer/shared/clusterParam';\r\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\r\nimport { createOverlayMarkerStyle } from '../shared/overlay/overlay-marker-style.utils';\r\nimport { StyleByAttribute } from '../shared/vector/vector-style.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StyleService {\r\n  public style: olStyle.Style;\r\n\r\n  /**\r\n   * Create a style based on a object as\r\n   * style: {\r\n   *       \"stroke\": {\r\n   *         \"color\": \"blue\",\r\n   *         \"lineDash\": [10, 5]\r\n   *       },\r\n   *       \"text\": {\r\n   *         \"minScaleDenom\": 50000,\r\n   *         \"maxScaleDenom\": 200000,\r\n   *         \"minResolution\": 100,\r\n   *         \"maxResolution\": 400,\r\n   *         \"attribute\": \"THE COLUMN NAME TO RETRIEVE THE LABEL VALUE\",\r\n   *         \"text\": \"MY HARCODED TEXT\",\r\n   *         \"stroke\": {\r\n   *           \"color\": \"blue\",\r\n   *           \"width\": 0.75\r\n   *         },\r\n   *         \"fill\": {\r\n   *           \"color\": \"black\"\r\n   *         },\r\n   *         \"font\": \"20px sans-serif\",\r\n   *         \"overflow\": true,\r\n   *         \"offsetX\": 10,\r\n   *         \"offsetY\": 20,\r\n   *         \"padding\": [2.5, 2.5, 2.5, 2.5]\r\n   *       },\r\n   *       \"width\": 5\r\n   *     }\r\n   *\r\n   * @param options\r\n   * @param feature feature to apply style on\r\n   * @param resolution current map resolution, to control label resolution range\r\n   * @returns\r\n   */\r\n  createStyle(\r\n    options: { [key: string]: any },\r\n    feature?: RenderFeature | OlFeature<OlGeometry>,\r\n    resolution?: number\r\n  ) {\r\n    if (!options) {\r\n      return createOverlayMarkerStyle();\r\n    }\r\n    if (typeof options === 'function' || options instanceof olStyle.Style) {\r\n      return options;\r\n    }\r\n    const parsedStyle = this.parseStyle('style', options);\r\n    if (parsedStyle.getText()) {\r\n      let labelMinResolution = 0;\r\n      let labelMaxResolution = Infinity;\r\n      if (options.text) {\r\n        const labelMinResolutionFromScale = options.text?.minScaleDenom\r\n          ? getResolutionFromScale(Number(options.text.minScaleDenom))\r\n          : undefined;\r\n        const labelMaxResolutionFromScale = options.text?.maxScaleDenom\r\n          ? getResolutionFromScale(Number(options.text.maxScaleDenom))\r\n          : undefined;\r\n        const minResolution = options.text?.minResolution\r\n          ? options.text.minResolution\r\n          : 0;\r\n        const maxResolution = options.text?.maxResolution\r\n          ? options.text.maxResolution\r\n          : Infinity;\r\n\r\n        labelMinResolution = labelMinResolutionFromScale || minResolution;\r\n        labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\r\n      }\r\n      if (\r\n        options.text?.minScaleDenom ||\r\n        options.text?.maxScaleDenom ||\r\n        options.text?.minResolution ||\r\n        options.text?.maxResolution\r\n      ) {\r\n        if (\r\n          feature &&\r\n          resolution >= labelMinResolution &&\r\n          resolution <= labelMaxResolution\r\n        ) {\r\n          if (feature && options.text.attribute) {\r\n            parsedStyle\r\n              .getText()\r\n              .setText(this.getLabel(feature, options.text.attribute));\r\n          }\r\n        } else {\r\n          parsedStyle.setText();\r\n        }\r\n      }\r\n    }\r\n    return parsedStyle;\r\n  }\r\n\r\n  public parseStyle(key: string, value: any) {\r\n    const styleOptions = {};\r\n    const olCls = this.getOlCls(key);\r\n\r\n    if (olCls && value instanceof Object) {\r\n      Object.keys(value).forEach((_key) => {\r\n        const olKey = this.getOlKey(_key);\r\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\r\n      });\r\n      return new olCls(styleOptions);\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  private getOlKey(key: any) {\r\n    let olKey;\r\n    switch (key.toLowerCase()) {\r\n      case 'circle':\r\n      case 'regularshape':\r\n      case 'icon':\r\n        olKey = 'image';\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return olKey || key;\r\n  }\r\n\r\n  private getOlCls(key: any) {\r\n    let olCls = olStyle[key.charAt(0).toUpperCase() + key.slice(1)];\r\n    if (key === 'regularshape') {\r\n      olCls = olStyle.RegularShape;\r\n    }\r\n    if (key === 'backgroundFill') {\r\n      olCls = olStyle.Fill;\r\n    }\r\n    if (key === 'backgroundStroke') {\r\n      olCls = olStyle.Stroke;\r\n    }\r\n\r\n    return olCls;\r\n  }\r\n\r\n  createStyleByAttribute(\r\n    feature: RenderFeature | OlFeature<OlGeometry>,\r\n    styleByAttribute: StyleByAttribute,\r\n    resolution: number\r\n  ) {\r\n    let style;\r\n    const type = styleByAttribute.type\r\n      ? styleByAttribute.type\r\n      : this.guessTypeFeature(feature);\r\n    const attribute = styleByAttribute.attribute;\r\n    const data = styleByAttribute.data;\r\n    const stroke = styleByAttribute.stroke;\r\n    const width = styleByAttribute.width;\r\n    const fill = styleByAttribute.fill;\r\n    const anchor = styleByAttribute.anchor;\r\n    const radius = styleByAttribute.radius;\r\n    const icon = styleByAttribute.icon;\r\n    const scale = styleByAttribute.scale;\r\n    const size = data ? data.length : 0;\r\n    const label = styleByAttribute.label\r\n      ? styleByAttribute.label.attribute\r\n      : undefined;\r\n    const labelMinResolutionFromScale = styleByAttribute.label?.minScaleDenom\r\n      ? getResolutionFromScale(Number(styleByAttribute.label.minScaleDenom))\r\n      : undefined;\r\n    const labelMaxResolutionFromScale = styleByAttribute.label?.maxScaleDenom\r\n      ? getResolutionFromScale(Number(styleByAttribute.label.maxScaleDenom))\r\n      : undefined;\r\n    const minResolution = styleByAttribute.label?.minResolution\r\n      ? styleByAttribute.label.minResolution\r\n      : 0;\r\n    const maxResolution = styleByAttribute.label?.maxResolution\r\n      ? styleByAttribute.label.maxResolution\r\n      : Infinity;\r\n\r\n    const labelMinResolution = labelMinResolutionFromScale || minResolution;\r\n    const labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\r\n\r\n    let labelStyle = styleByAttribute.label?.style\r\n      ? this.parseStyle('text', styleByAttribute.label.style)\r\n      : undefined;\r\n    if (!labelStyle && label) {\r\n      labelStyle = new olStyle.Text();\r\n    }\r\n    const baseStyle = styleByAttribute.baseStyle;\r\n\r\n    if (labelStyle) {\r\n      if (\r\n        resolution >= labelMinResolution &&\r\n        resolution <= labelMaxResolution\r\n      ) {\r\n        labelStyle.setText(this.getLabel(feature, label));\r\n      } else {\r\n        labelStyle.setText('');\r\n      }\r\n    }\r\n\r\n    if (type === 'circle') {\r\n      for (let i = 0; i < size; i++) {\r\n        const val =\r\n          typeof feature.get(attribute) !== 'undefined' &&\r\n          feature.get(attribute) !== null\r\n            ? feature.get(attribute)\r\n            : '';\r\n        if (\r\n          val === data[i] ||\r\n          val.toString().match(new RegExp(data[i], 'gmi'))\r\n        ) {\r\n          if (icon) {\r\n            style = [\r\n              new olStyle.Style({\r\n                image: new olStyle.Icon({\r\n                  color: fill ? fill[i] : undefined,\r\n                  src: icon[i],\r\n                  scale: scale ? scale[i] : 1,\r\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\r\n                }),\r\n                text:\r\n                  labelStyle instanceof olStyle.Text ? labelStyle : undefined\r\n              })\r\n            ];\r\n            return style;\r\n          }\r\n          style = [\r\n            new olStyle.Style({\r\n              image: new olStyle.Circle({\r\n                radius: radius ? radius[i] : 4,\r\n                stroke: new olStyle.Stroke({\r\n                  color: stroke ? stroke[i] : 'black',\r\n                  width: width ? width[i] : 1\r\n                }),\r\n                fill: new olStyle.Fill({\r\n                  color: fill ? fill[i] : 'black'\r\n                })\r\n              }),\r\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\r\n        if (baseStyle) {\r\n          style = this.createStyle(baseStyle, feature, resolution);\r\n          if (labelStyle) {\r\n            style.setText(labelStyle);\r\n          }\r\n          return style;\r\n        }\r\n        style = [\r\n          new olStyle.Style({\r\n            image: new olStyle.Circle({\r\n              radius: 4,\r\n              stroke: new olStyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olStyle.Fill({\r\n                color: '#bbbbf2'\r\n              })\r\n            })\r\n          })\r\n        ];\r\n        return style;\r\n      }\r\n    } else if (type === 'regular') {\r\n      for (let i = 0; i < size; i++) {\r\n        const val =\r\n          typeof feature.get(attribute) !== 'undefined' &&\r\n          feature.get(attribute) !== null\r\n            ? feature.get(attribute)\r\n            : '';\r\n        if (\r\n          val === data[i] ||\r\n          val.toString().match(new RegExp(data[i], 'gmi'))\r\n        ) {\r\n          style = [\r\n            new olStyle.Style({\r\n              stroke: new olStyle.Stroke({\r\n                color: stroke ? stroke[i] : 'black',\r\n                width: width ? width[i] : 1\r\n              }),\r\n              fill: new olStyle.Fill({\r\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\r\n              }),\r\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n      if (feature instanceof OlFeature) {\r\n        if (!feature.getStyle()) {\r\n          if (baseStyle) {\r\n            style = this.createStyle(baseStyle, feature, resolution);\r\n            if (labelStyle) {\r\n              style.setText(labelStyle);\r\n            }\r\n            return style;\r\n          }\r\n          style = [\r\n            new olStyle.Style({\r\n              stroke: new olStyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olStyle.Fill({\r\n                color: '#bbbbf2'\r\n              })\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  createClusterStyle(\r\n    feature: RenderFeature | OlFeature<OlGeometry>,\r\n    resolution: number,\r\n    clusterParam: ClusterParam = {},\r\n    layerStyle\r\n  ) {\r\n    let style;\r\n    const size = feature.get('features').length;\r\n    if (size !== 1) {\r\n      if (clusterParam.clusterRanges) {\r\n        for (const r of clusterParam.clusterRanges) {\r\n          if (\r\n            (!r.minRadius || r.minRadius <= size) &&\r\n            (!r.maxRadius || r.maxRadius >= size)\r\n          ) {\r\n            style = this.createStyle(r.style) as olStyle.Circle;\r\n\r\n            if (r.showRange) {\r\n              const text = new olStyle.Text({\r\n                text: size.toString(),\r\n                fill: new olStyle.Fill({\r\n                  color: '#fff'\r\n                })\r\n              });\r\n              style.setText(text);\r\n            }\r\n\r\n            if (r.dynamicRadius) {\r\n              let clusterRadius: number;\r\n              const radiusMin = style.getRadius();\r\n              clusterRadius = 5 * Math.log(size);\r\n              if (clusterRadius < radiusMin) {\r\n                clusterRadius = radiusMin;\r\n              }\r\n              style.image_.setRadius(clusterRadius);\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!style) {\r\n        let clusterRadius: number;\r\n        if (clusterParam.radiusCalc) {\r\n          clusterRadius = clusterParam.radiusCalc(size);\r\n        } else {\r\n          const radiusMin = 6;\r\n          clusterRadius = 5 * Math.log(size);\r\n          if (clusterRadius < radiusMin) {\r\n            clusterRadius = radiusMin;\r\n          }\r\n        }\r\n\r\n        style = [\r\n          new olStyle.Style({\r\n            image: new olStyle.Circle({\r\n              radius: clusterRadius,\r\n              stroke: new olStyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olStyle.Fill({\r\n                color: 'rgba(24, 134, 45, 0.5)'\r\n              })\r\n            }),\r\n            text: new olStyle.Text({\r\n              text: size.toString(),\r\n              fill: new olStyle.Fill({\r\n                color: '#fff'\r\n              })\r\n            })\r\n          })\r\n        ];\r\n      }\r\n    } else {\r\n      style = this.createStyle(layerStyle, feature, resolution);\r\n    }\r\n    return style;\r\n  }\r\n\r\n  getLabel(feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    if (!label) {\r\n      return;\r\n    }\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach((v) => {\r\n      label = label.replace(v[0], feature.get(v[1]));\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.get(labelMatch) || labelMatch;\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  private guessTypeFeature(feature) {\r\n    switch (feature.getGeometry().getType()) {\r\n      case 'Point':\r\n      case 'MultiPoint':\r\n      case 'Circle':\r\n        return 'circle';\r\n      default:\r\n        return 'regular';\r\n    }\r\n  }\r\n}\r\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryLayerFeatures !== undefined\n    ? dataSource.options.queryLayerFeatures === true\n    : true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined\n    ? false\n    : layerIsQueryable(layer) && layerFeatureIsQueryable(layer);\n}\n","import { AuthInterceptor } from '@igo2/auth';\r\nimport { Message, MessageService } from '@igo2/core';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport olLayer from 'ol/layer/Layer';\r\nimport olSource from 'ol/source/Source';\r\n\r\nimport {\r\n  BehaviorSubject,\r\n  Observable,\r\n  Subject,\r\n  Subscription,\r\n  combineLatest\r\n} from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { DataSource, Legend } from '../../../datasource';\r\nimport { MapBase } from '../../../map/shared/map.abstract';\r\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\r\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\r\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\r\nimport { LayerOptions } from './layer.interface';\r\n\r\nexport abstract class Layer {\r\n  public collapsed: boolean;\r\n  public dataSource: DataSource;\r\n  public legend: Legend[];\r\n  public legendCollapsed: boolean = true;\r\n  public firstLoadComponent: boolean = true;\r\n  public map: MapBase;\r\n  public ol: olLayer<olSource>;\r\n  public olLoadingProblem: boolean = false;\r\n  public status$: Subject<SubjectStatus>;\r\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  private hasBeenVisible$$: Subscription;\r\n  private resolution$$: Subscription;\r\n\r\n  /**\r\n   * Define if a layer is generated by code OR defined by layer/context user layer.\r\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\r\n   * return false by default.\r\n   */\r\n  get isIgoInternalLayer(): boolean {\r\n    return this.options.isIgoInternalLayer || false;\r\n  }\r\n\r\n  get id(): string {\r\n    return this.options.id || this.dataSource.id;\r\n  }\r\n\r\n  get alias(): string {\r\n    return this.options.alias;\r\n  }\r\n\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  set title(title: string) {\r\n    this.options.title = title;\r\n  }\r\n\r\n  get zIndex(): number {\r\n    return this.ol.getZIndex();\r\n  }\r\n\r\n  set zIndex(zIndex: number) {\r\n    this.ol.setZIndex(zIndex);\r\n  }\r\n\r\n  get baseLayer(): boolean {\r\n    return this.options.baseLayer;\r\n  }\r\n\r\n  set baseLayer(baseLayer: boolean) {\r\n    this.options.baseLayer = baseLayer;\r\n  }\r\n\r\n  get opacity(): number {\r\n    return this.ol.get('opacity');\r\n  }\r\n\r\n  set opacity(opacity: number) {\r\n    this.ol.setOpacity(opacity);\r\n  }\r\n\r\n  set isInResolutionsRange(value: boolean) {\r\n    this.isInResolutionsRange$.next(value);\r\n  }\r\n  get isInResolutionsRange(): boolean {\r\n    return this.isInResolutionsRange$.value;\r\n  }\r\n  readonly isInResolutionsRange$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject(false);\r\n\r\n  set maxResolution(value: number) {\r\n    this.ol.setMaxResolution(value === 0 ? 0 : value || Infinity);\r\n    this.updateInResolutionsRange();\r\n  }\r\n  get maxResolution(): number {\r\n    return this.ol.getMaxResolution();\r\n  }\r\n\r\n  set minResolution(value: number) {\r\n    this.ol.setMinResolution(value || 0);\r\n    this.updateInResolutionsRange();\r\n  }\r\n  get minResolution(): number {\r\n    return this.ol.getMinResolution();\r\n  }\r\n\r\n  set visible(value: boolean) {\r\n    this.ol.setVisible(value);\r\n    this.visible$.next(value);\r\n    if (!this.hasBeenVisible$.value && value) {\r\n      this.hasBeenVisible$.next(value);\r\n    }\r\n    if (this.options?.messages && value) {\r\n      this.options?.messages\r\n        .filter((m) => m.options?.showOnEachLayerVisibility)\r\n        .map((message) => this.showMessage(message));\r\n    }\r\n  }\r\n  get visible(): boolean {\r\n    return this.visible$.value;\r\n  }\r\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\r\n\r\n  get displayed(): boolean {\r\n    return this.visible && this.isInResolutionsRange;\r\n  }\r\n  readonly displayed$: Observable<boolean> = combineLatest([\r\n    this.isInResolutionsRange$,\r\n    this.visible$\r\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\r\n\r\n  get showInLayerList(): boolean {\r\n    return this.options.showInLayerList !== false;\r\n  }\r\n\r\n  constructor(\r\n    public options: LayerOptions,\r\n    protected messageService?: MessageService,\r\n    protected authInterceptor?: AuthInterceptor,\r\n    protected geoDBService?: GeoDBService,\r\n    public layerDBService?: LayerDBService\r\n  ) {\r\n    this.dataSource = options.source;\r\n\r\n    this.ol = this.createOlLayer();\r\n    if (options.zIndex !== undefined) {\r\n      this.zIndex = options.zIndex;\r\n    }\r\n\r\n    if (options.baseLayer && options.visible === undefined) {\r\n      options.visible = false;\r\n    }\r\n\r\n    this.maxResolution =\r\n      options.maxResolution ||\r\n      getResolutionFromScale(Number(options.maxScaleDenom));\r\n    this.minResolution =\r\n      options.minResolution ||\r\n      getResolutionFromScale(Number(options.minScaleDenom));\r\n\r\n    this.visible = options.visible === undefined ? true : options.visible;\r\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\r\n\r\n    if (\r\n      options.legendOptions &&\r\n      (options.legendOptions.url || options.legendOptions.html)\r\n    ) {\r\n      this.legend = this.dataSource.setLegend(options.legendOptions);\r\n    }\r\n\r\n    this.legendCollapsed = options.legendOptions\r\n      ? options.legendOptions.collapsed\r\n        ? options.legendOptions.collapsed\r\n        : true\r\n      : true;\r\n\r\n    this.ol.set('_layer', this, true);\r\n  }\r\n\r\n  protected abstract createOlLayer(): olLayer<olSource>;\r\n\r\n  setMap(map: MapBase | undefined) {\r\n    this.map = map;\r\n\r\n    this.unobserveResolution();\r\n    if (map !== undefined) {\r\n      this.observeResolution();\r\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\r\n        if (this.options.messages && this.visible) {\r\n          this.options.messages.map((message) => {\r\n            this.showMessage(message);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private showMessage(message: Message) {\r\n    if (!this.messageService) {\r\n      return;\r\n    }\r\n    message.title = message.title;\r\n    message.text = message.text;\r\n    this.messageService.message(message as Message);\r\n  }\r\n\r\n  private observeResolution() {\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\r\n      this.updateInResolutionsRange()\r\n    );\r\n  }\r\n\r\n  private unobserveResolution() {\r\n    if (this.resolution$$ !== undefined) {\r\n      this.resolution$$.unsubscribe();\r\n      this.resolution$$ = undefined;\r\n    }\r\n  }\r\n\r\n  private updateInResolutionsRange() {\r\n    if (this.map !== undefined) {\r\n      const resolution = this.map.viewController.getResolution();\r\n      const minResolution = this.minResolution;\r\n      const maxResolution =\r\n        this.maxResolution === undefined ? Infinity : this.maxResolution;\r\n      this.isInResolutionsRange =\r\n        resolution >= minResolution && resolution <= maxResolution;\r\n    } else {\r\n      this.isInResolutionsRange = false;\r\n    }\r\n  }\r\n}\r\n","import { Message } from '@igo2/core';\r\n\r\nimport olLayer from 'ol/layer/Layer';\r\nimport olSource from 'ol/source/Source';\r\n\r\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\r\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\r\nimport { MapExtent } from '../../../map/shared/map.interface';\r\nimport { LegendOptions } from './legend.interface';\r\n\r\nexport interface LayerOptions {\r\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\r\n  source?: DataSource;\r\n  sourceOptions?: AnyDataSourceOptions;\r\n  title?: string;\r\n  id?: string;\r\n  alias?: string;\r\n  security?: LayerSecurityOptions;\r\n  baseLayer?: boolean;\r\n  opacity?: number;\r\n  visible?: boolean;\r\n  extent?: MapExtent;\r\n  zIndex?: number;\r\n  messages?: Message[];\r\n  minResolution?: number;\r\n  maxResolution?: number;\r\n  minScaleDenom?: number;\r\n  maxScaleDenom?: number;\r\n  showInLayerList?: boolean;\r\n  removable?: boolean;\r\n  workspace?: GeoWorkspaceOptions;\r\n  legendOptions?: LegendOptions;\r\n  ol?: olLayer<olSource>;\r\n  tooltip?: TooltipContent;\r\n  _internal?: { [key: string]: string };\r\n  active?: boolean;\r\n  check?: boolean;\r\n  linkedLayers?: LayersLink;\r\n  showButtonZoomToExtent?: boolean;\r\n}\r\n\r\nexport interface LayerSecurityOptions {\r\n  profils?: string[];\r\n}\r\n\r\nexport interface GeoWorkspaceOptions {\r\n  srcId?: string;\r\n  workspaceId?: string;\r\n  minResolution?: number;\r\n  maxResolution?: number;\r\n  enabled?: boolean;\r\n  queryOptions?: GeoWorkspaceQueryOptions;\r\n  pageSize?: number;\r\n  pageSizeOptions?: number[];\r\n  searchIndexEnabled?: boolean;\r\n  printable?: boolean;\r\n}\r\n\r\nexport interface GeoWorkspaceQueryOptions {\r\n  mapQueryOnOpenTab?: boolean;\r\n  tabQuery?: boolean;\r\n}\r\n\r\nexport interface LayersLink {\r\n  linkId: string;\r\n  links?: LayersLinkProperties[];\r\n}\r\nexport interface LayersLinkProperties {\r\n  linkedIds: string[];\r\n  syncedDelete: boolean;\r\n  properties: LinkedProperties[];\r\n}\r\n\r\nexport enum LinkedProperties {\r\n  OPACITY = 'opacity',\r\n  VISIBLE = 'visible',\r\n  OGCFILTERS = 'ogcFilters',\r\n  MINRESOLUTION = 'minResolution',\r\n  MAXRESOLUTION = 'maxResolution',\r\n  ZINDEX = 'zIndex',\r\n  TIMEFILTER = 'timeFilter'\r\n}\r\n\r\nexport interface GroupLayers {\r\n  title: string;\r\n  layers?: LayerOptions;\r\n  collapsed?: boolean;\r\n}\r\n\r\nexport interface TooltipContent {\r\n  type?: TooltipType;\r\n  text?: string;\r\n}\r\nexport enum TooltipType {\r\n  TITLE = 'title',\r\n  ABSTRACT = 'abstract',\r\n  CUSTOM = 'custom'\r\n}\r\n","import { MessageService } from '@igo2/core';\r\nimport { SubjectStatus, Watcher, uuid } from '@igo2/utils';\r\n\r\nimport olSourceImage from 'ol/source/Image';\r\n\r\nimport { ImageLayer } from '../shared/layers/image-layer';\r\n\r\nexport class ImageWatcher extends Watcher {\r\n  protected id: string;\r\n  protected loaded = 0;\r\n  protected loading = 0;\r\n\r\n  private source: olSourceImage;\r\n\r\n  private messageService: MessageService;\r\n\r\n  constructor(layer: ImageLayer, messageService: MessageService) {\r\n    super();\r\n    this.source = layer.options.source.ol;\r\n    this.id = uuid();\r\n    this.messageService = messageService;\r\n  }\r\n\r\n  protected watch() {\r\n    this.source.on(`imageloadstart`, (e) => this.handleLoadStart(e));\r\n    this.source.on(`imageloadend`, (e) => this.handleLoadEnd(e));\r\n    this.source.on(`imageloaderror`, (e) => this.handleLoadEnd(e));\r\n    this.source.on(`imageloaderror`, (e) => this.handleLoadError(e));\r\n  }\r\n\r\n  protected unwatch() {\r\n    this.source.un(`imageloadstart`, (e) => this.handleLoadStart(e));\r\n    this.source.un(`imageloadend`, (e) => this.handleLoadEnd(e));\r\n    this.source.un(`imageloaderror`, (e) => this.handleLoadEnd(e));\r\n    this.source.un(`imageloaderror`, (e) => this.handleLoadError(e));\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    if (!event.image.__watchers__) {\r\n      event.image.__watchers__ = [];\r\n    }\r\n    event.image.__watchers__.push(this.id);\r\n\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event) {\r\n    if (!event.image.__watchers__) {\r\n      return;\r\n    }\r\n\r\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\r\n    if (watcherIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    event.image.__watchers__.splice(watcherIndex, 1);\r\n\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleLoadError(event) {\r\n    if (!event.image.__watchers__) {\r\n      return;\r\n    }\r\n    this.messageService.error(\r\n      'igo.geo.dataSource.unavailable',\r\n      'igo.geo.dataSource.unavailableTitle',\r\n      undefined,\r\n      { value: event.target.params_.LAYERS }\r\n    );\r\n    this.loaded = -1;\r\n    this.loading = 0;\r\n    this.status = SubjectStatus.Error;\r\n  }\r\n}\r\n","import { SubjectStatus, Watcher, uuid } from '@igo2/utils';\r\n\r\nimport olSourceTile from 'ol/source/Tile';\r\n\r\nimport { TileLayer } from '../shared/layers/tile-layer';\r\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\r\n\r\nexport class TileWatcher extends Watcher {\r\n  private id: string;\r\n  private loaded = 0;\r\n  private loading = 0;\r\n\r\n  private source: olSourceTile;\r\n\r\n  constructor(layer: TileLayer | VectorTileLayer) {\r\n    super();\r\n    this.source = layer.options.source.ol;\r\n    this.id = uuid();\r\n  }\r\n\r\n  protected watch() {\r\n    this.source.on(`tileloadstart`, (e) => this.handleLoadStart(e));\r\n    this.source.on(`tileloadend`, (e) => this.handleLoadEnd(e));\r\n    this.source.on(`tileloaderror`, (e) => this.handleLoadEnd(e));\r\n  }\r\n\r\n  protected unwatch() {\r\n    this.source.un(`tileloadstart`, (e) => this.handleLoadStart(e));\r\n    this.source.un(`tileloadend`, (e) => this.handleLoadEnd(e));\r\n    this.source.un(`tileloaderror`, (e) => this.handleLoadEnd(e));\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    // This is to avoid increasing\r\n    // the number of loaded tiles if a tile was loading\r\n    // before subscribing to this watcher\r\n    if (!event.tile.__watchers__) {\r\n      event.tile.__watchers__ = [];\r\n    }\r\n    event.tile.__watchers__.push(this.id);\r\n\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event) {\r\n    if (!event.tile.__watchers__) {\r\n      return;\r\n    }\r\n\r\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\r\n    if (watcherIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    event.tile.__watchers__.splice(watcherIndex, 1);\r\n\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { uuid } from '@igo2/utils';\r\n\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { WFSDataSourceOptions } from '../datasource';\r\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\r\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\r\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\r\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\r\nimport { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\r\n\r\n/**\r\n * Generate a id from it's datasource options.\r\n * @param options Data source options\r\n * @returns A id\r\n */\r\nexport function generateIdFromSourceOptions(\r\n  options: DataSourceOptions\r\n): string {\r\n  const generators = {\r\n    wms: generateWMSIdFromSourceOptions,\r\n    wmts: generateWMTSIdFromSourceOptions,\r\n    xyz: generateXYZIdFromSourceOptions,\r\n    feature: generateFeatureIdFromSourceOptions,\r\n    wfs: generateWfsIdFromSourceOptions,\r\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\r\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\r\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\r\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\r\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\r\n  };\r\n  const generator = generators[options.type] || generateId;\r\n  return generator(options);\r\n}\r\n\r\n/**\r\n * Generate a id from WMS data source options\r\n * @param options WMS data source options\r\n * @returns A md5 hash of the the url and layers\r\n */\r\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\r\n  const layers = options.params.LAYERS;\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'wms' + url + layers;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from WMTS data source options\r\n * @param options WMTS data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateWMTSIdFromSourceOptions(\r\n  options: WMTSDataSourceOptions\r\n) {\r\n  const layer = options.layer;\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'wmts' + url + layer;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from XYZ data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'xyz' + url;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from feature data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateFeatureIdFromSourceOptions(\r\n  options: WMTSDataSourceOptions\r\n) {\r\n  if (!options.url) {\r\n    return generateId(options);\r\n  }\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'feature' + url;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from feature data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\r\n  if (!options.url || !options.params) {\r\n    return generateId(options);\r\n  }\r\n  const url = standardizeUrl(options.url);\r\n  const chain = 'wfs' + url + options.params.featureTypes;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n/**\r\n * Generate a id from ArcGIS Rest data source options\r\n * @param options ArcGIS Rest data source options\r\n * @returns A md5 hash of the url and layers\r\n */\r\nexport function generateArcgisRestIdFromSourceOptions(\r\n  options: ArcGISRestDataSourceOptions\r\n) {\r\n  const layers = options.layer;\r\n  const url = standardizeUrl(options.url);\r\n  const chain = (options.type || 'arcgis') + url + layers;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a unique id\r\n * @returns A uuid\r\n */\r\nexport function generateId(_options: AnyDataSourceOptions) {\r\n  return uuid();\r\n}\r\n\r\nexport function standardizeUrl(url: string): string {\r\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\r\n  const urlDecomposed = absUrl.split(/[?&]/);\r\n  let urlStandardized = urlDecomposed.shift();\r\n  const paramsToKeep = urlDecomposed.filter(\r\n    (p) => p.length !== 0 && p.charAt(0) !== '_'\r\n  );\r\n  if (paramsToKeep.length) {\r\n    urlStandardized += '?' + paramsToKeep.join('&');\r\n  }\r\n  return urlStandardized;\r\n}\r\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olClusterSource from 'ol/source/Cluster';\r\nimport olSource from 'ol/source/Source';\r\nimport olVectorSource from 'ol/source/Vector';\r\n\r\nimport {\r\n  LegendMapViewOptions,\r\n  LegendOptions\r\n} from '../../../layer/shared/layers/legend.interface';\r\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\r\nimport { DataService } from './data.service';\r\nimport { DataSourceOptions, Legend } from './datasource.interface';\r\n\r\nexport abstract class DataSource {\r\n  public id: string;\r\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource;\r\n  private legend: Legend[];\r\n\r\n  constructor(\r\n    public options: DataSourceOptions = {},\r\n    protected dataService?: DataService\r\n  ) {\r\n    this.options = options;\r\n    this.id = this.options.id || this.generateId();\r\n    this.ol = this.createOlSource();\r\n  }\r\n\r\n  protected abstract createOlSource(): olSource;\r\n\r\n  protected generateId(): string {\r\n    return generateIdFromSourceOptions(this.options);\r\n  }\r\n\r\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\r\n    return this.legend ? this.legend : [];\r\n  }\r\n\r\n  public setLegend(options: LegendOptions): Legend[] {\r\n    if (options.url) {\r\n      this.legend = [{ url: options.url }];\r\n    } else if (options.html) {\r\n      this.legend = [{ html: options.html }];\r\n    } else {\r\n      this.legend = [];\r\n    }\r\n\r\n    return this.legend;\r\n  }\r\n\r\n  protected abstract onUnwatch();\r\n}\r\n","import * as olformat from 'ol/format';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olSourceVector from 'ol/source/Vector';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\r\n\r\nexport class FeatureDataSource extends DataSource {\r\n  public declare options: FeatureDataSourceOptions;\r\n  public declare ol: olSourceVector<OlGeometry>;\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    const sourceOptions = {\r\n      format: this.getSourceFormatFromOptions(this.options)\r\n    };\r\n\r\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\r\n  }\r\n\r\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\r\n    if (options.format) {\r\n      return options.format;\r\n    }\r\n    let olFormatCls;\r\n    const formatType = options.formatType;\r\n    if (!formatType) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    } else {\r\n      olFormatCls = olformat[formatType];\r\n      if (olFormatCls === undefined) {\r\n        throw new Error('Invalid vector source format ${formatType}.');\r\n      }\r\n    }\r\n\r\n    const formatOptions = options.formatOptions;\r\n    let format;\r\n    if (formatOptions) {\r\n      format = new olFormatCls(formatOptions);\r\n    } else {\r\n      format = new olFormatCls();\r\n    }\r\n\r\n    return format;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n}\r\n","import { uuid } from '@igo2/utils';\r\n\r\nimport olSourceCluster from 'ol/source/Cluster';\r\n\r\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\r\nimport { FeatureDataSource } from './feature-datasource';\r\n\r\nexport class ClusterDataSource extends FeatureDataSource {\r\n  public declare options: ClusterDataSourceOptions;\r\n  public declare ol: olSourceCluster;\r\n\r\n  protected createOlSource(): olSourceCluster {\r\n    this.options.format = this.getSourceFormatFromOptions(this.options);\r\n    this.options.source = super.createOlSource();\r\n    return new olSourceCluster(this.options);\r\n  }\r\n\r\n  protected generateId() {\r\n    return uuid();\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import { SubjectStatus, Watcher, uuid } from '@igo2/utils';\r\n\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { VectorLayer } from '../shared/layers/vector-layer';\r\n\r\nexport class VectorWatcher extends Watcher {\r\n  private id: string;\r\n  private loaded = 0;\r\n  private loading = 0;\r\n\r\n  private layer: VectorLayer;\r\n\r\n  constructor(layer: VectorLayer) {\r\n    super();\r\n    this.layer = layer;\r\n    this.id = uuid();\r\n  }\r\n\r\n  protected watch() {\r\n    let olSource = this.layer.options.source.ol;\r\n    if (this.layer.dataSource instanceof ClusterDataSource) {\r\n      olSource = (this.layer.options.source.options as any).source;\r\n    }\r\n\r\n    if (olSource.getUrl()) {\r\n      olSource.on(`featuresloadstart`, (e) => this.handleLoadStart(e));\r\n      olSource.on(`featuresloadend`, (e) => this.handleLoadEnd(e));\r\n      olSource.on(`featuresloaderror`, (e) => this.handleLoadEnd(e));\r\n    }\r\n  }\r\n\r\n  protected unwatch() {\r\n    let olSource = this.layer.options.source.ol;\r\n    if (this.layer.dataSource instanceof ClusterDataSource) {\r\n      olSource = (this.layer.options.source.options as any).source;\r\n    }\r\n    if (olSource.getUrl()) {\r\n      olSource.un(`featuresloadstart`, (e) => this.handleLoadStart(e));\r\n      olSource.un(`featuresloadend`, (e) => this.handleLoadEnd(e));\r\n      olSource.un(`featuresloaderror`, (e) => this.handleLoadEnd(e));\r\n    }\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event: any) {\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { AuthInterceptor } from '@igo2/auth';\r\nimport { MessageService } from '@igo2/core';\r\n\r\nimport olLayerImage from 'ol/layer/Image';\r\nimport olSourceImage from 'ol/source/Image';\r\n\r\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\r\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\r\nimport { IgoMap } from '../../../map/shared';\r\nimport { ImageWatcher } from '../../utils';\r\nimport { ImageLayerOptions } from './image-layer.interface';\r\nimport { Layer } from './layer';\r\n\r\nexport class ImageLayer extends Layer {\r\n  public declare dataSource: WMSDataSource | ImageArcGISRestDataSource;\r\n  public declare options: ImageLayerOptions;\r\n  public declare ol: olLayerImage<olSourceImage>;\r\n\r\n  private watcher: ImageWatcher;\r\n\r\n  constructor(\r\n    options: ImageLayerOptions,\r\n    public messageService: MessageService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(options, messageService, authInterceptor);\r\n    this.watcher = new ImageWatcher(this, this.messageService);\r\n    this.status$ = this.watcher.status$;\r\n    this.status$.subscribe((valStatus) => {\r\n      if (valStatus === 0) {\r\n        this.olLoadingProblem = true;\r\n      }\r\n    });\r\n  }\r\n\r\n  protected createOlLayer(): olLayerImage<olSourceImage> {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceImage\r\n    });\r\n\r\n    const image = new olLayerImage(olOptions);\r\n    if (this.authInterceptor) {\r\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\r\n        this.customLoader(tile, src, this.authInterceptor, this.messageService);\r\n      });\r\n    }\r\n\r\n    return image;\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n\r\n  private customLoader(\r\n    tile,\r\n    src: string,\r\n    interceptor: AuthInterceptor,\r\n    messageService: MessageService\r\n  ) {\r\n    const xhr = new XMLHttpRequest();\r\n\r\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\r\n    let url = src;\r\n    if (alteredUrlWithKeyAuth) {\r\n      url = alteredUrlWithKeyAuth;\r\n    }\r\n    xhr.open('GET', url);\r\n    const intercepted = interceptor.interceptXhr(xhr, url);\r\n    if (!intercepted) {\r\n      xhr.abort();\r\n      tile.getImage().src = url;\r\n      return;\r\n    }\r\n\r\n    xhr.responseType = 'arraybuffer';\r\n\r\n    xhr.onload = function () {\r\n      const arrayBufferView = new Uint8Array((this as any).response);\r\n      const responseString = new TextDecoder().decode(arrayBufferView);\r\n      if (responseString.includes('ServiceExceptionReport')) {\r\n        messageService.error(\r\n          'igo.geo.dataSource.optionsApiUnavailable',\r\n          'igo.geo.dataSource.unavailableTitle'\r\n        );\r\n      }\r\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\r\n      const urlCreator = window.URL;\r\n      const imageUrl = urlCreator.createObjectURL(blob);\r\n      tile.getImage().src = imageUrl;\r\n    };\r\n    xhr.send();\r\n  }\r\n}\r\n","import { AuthInterceptor } from '@igo2/auth';\r\nimport { MessageService } from '@igo2/core';\r\n\r\nimport Tile from 'ol/Tile';\r\nimport olLayerTile from 'ol/layer/Tile';\r\nimport olSourceTile from 'ol/source/Tile';\r\n\r\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\r\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\r\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\r\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\r\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\r\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\r\nimport { IgoMap } from '../../../map/shared';\r\nimport { TileWatcher } from '../../utils';\r\nimport { Layer } from './layer';\r\nimport { TileLayerOptions } from './tile-layer.interface';\r\n\r\nexport class TileLayer extends Layer {\r\n  public declare dataSource:\r\n    | OSMDataSource\r\n    | WMTSDataSource\r\n    | XYZDataSource\r\n    | TileDebugDataSource\r\n    | CartoDataSource\r\n    | TileArcGISRestDataSource;\r\n  public declare options: TileLayerOptions;\r\n  public declare ol: olLayerTile<olSourceTile>;\r\n\r\n  private watcher: TileWatcher;\r\n\r\n  constructor(\r\n    options: TileLayerOptions,\r\n    public messageService?: MessageService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(options, messageService);\r\n\r\n    this.watcher = new TileWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerTile<olSourceTile> {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol\r\n    });\r\n    const tileLayer = new olLayerTile(olOptions);\r\n    const tileSource = tileLayer.getSource();\r\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\r\n      this.customLoader(tile, url, this.authInterceptor);\r\n    });\r\n\r\n    return tileLayer;\r\n  }\r\n\r\n  /**\r\n   * Custom loader for tile layer.\r\n   * @internal\r\n   * @param tile the current tile\r\n   * @param url the url string or function to retrieve the data\r\n   */\r\n  customLoader(tile, url: string, interceptor: AuthInterceptor) {\r\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\r\n    let modifiedUrl = url;\r\n    if (alteredUrlWithKeyAuth) {\r\n      modifiedUrl = alteredUrlWithKeyAuth;\r\n    }\r\n    tile.getImage().src = modifiedUrl;\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n}\r\n","export enum OgcFilterOperatorType {\n  BasicNumericOperator = 'basicnumericoperator',\n  Basic = 'basic',\n  BasicAndSpatial = 'basicandspatial',\n  Spatial = 'spatial',\n  All = 'all',\n  Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n  BBOX = 'BBox',\n  PropertyIsBetween = 'PropertyIsBetween',\n  Contains = 'Contains',\n  During = 'During',\n  PropertyIsEqualTo = 'PropertyIsEqualTo',\n  PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n  PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n  Intersects = 'Intersects',\n  PropertyIsNull = 'PropertyIsNull',\n  PropertyIsLessThan = 'PropertyIsLessThan',\n  PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n  PropertyIsLike = 'PropertyIsLike',\n  PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n  Within = 'Within',\n  And = 'And',\n  Or = 'Or',\n  Not = 'Not'\n}\n","import { ObjectUtils, uuid } from '@igo2/utils';\r\n\r\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\r\nimport olFormatWKT from 'ol/format/WKT';\r\nimport * as olfilter from 'ol/format/filter';\r\nimport olGeometry from 'ol/geom/Geometry';\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { default as moment } from 'moment';\r\n\r\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { OgcFilterOperator, OgcFilterOperatorType } from './ogc-filter.enum';\r\nimport {\r\n  AnyBaseOgcFilterOptions,\r\n  IgoOgcFilterObject,\r\n  IgoOgcSelector,\r\n  OgcFilter,\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFiltersOptions,\r\n  OgcInterfaceFilterOptions,\r\n  OgcSelectorBundle,\r\n  SelectorGroup\r\n} from './ogc-filter.interface';\r\nimport { Extent } from 'ol/extent';\r\n\r\nexport class OgcFilterWriter {\r\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\r\n  public operators = {\r\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.PropertyIsLike as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['string']\r\n    },\r\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.PropertyIsBetween as string]: {\r\n      spatial: false,\r\n      fieldRestrict: ['number']\r\n    },\r\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\r\n    [OgcFilterOperator.PropertyIsNull as string]: {\r\n      spatial: false,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.Intersects as string]: {\r\n      spatial: true,\r\n      fieldRestrict: []\r\n    },\r\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\r\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\r\n  };\r\n\r\n  defineOgcFiltersDefaultOptions(\r\n    ogcFiltersOptions: OgcFiltersOptions,\r\n    fieldNameGeometry: string,\r\n    srcType?: string\r\n  ): OgcFiltersOptions {\r\n    let ogcFiltersDefaultValue = true; // default values for wfs.\r\n    if (srcType && srcType === 'wms') {\r\n      ogcFiltersDefaultValue = false;\r\n    }\r\n\r\n    ogcFiltersOptions = ogcFiltersOptions || {};\r\n    ogcFiltersOptions.enabled =\r\n      ogcFiltersOptions.enabled === undefined\r\n        ? ogcFiltersDefaultValue\r\n        : ogcFiltersOptions.enabled;\r\n    ogcFiltersOptions.editable =\r\n      ogcFiltersOptions.editable === undefined\r\n        ? ogcFiltersDefaultValue\r\n        : ogcFiltersOptions.editable;\r\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\r\n\r\n    ogcFiltersOptions.advancedOgcFilters = true;\r\n    if (\r\n      ogcFiltersOptions.enabled &&\r\n      (ogcFiltersOptions.pushButtons ||\r\n        ogcFiltersOptions.checkboxes ||\r\n        ogcFiltersOptions.radioButtons ||\r\n        ogcFiltersOptions.select ||\r\n        ogcFiltersOptions.autocomplete)\r\n    ) {\r\n      ogcFiltersOptions.advancedOgcFilters = false;\r\n    }\r\n    return ogcFiltersOptions;\r\n  }\r\n\r\n  public buildFilter(\r\n    filters?: IgoOgcFilterObject,\r\n    extent?: Extent,\r\n    proj?: olProjection,\r\n    fieldNameGeometry?: string,\r\n    options?: OgcFilterableDataSourceOptions\r\n  ): string {\r\n    let ourBboxFilter;\r\n    let enableBbox: boolean;\r\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\r\n      enableBbox = false;\r\n    } else {\r\n      enableBbox = true;\r\n    }\r\n    if (filters) {\r\n      fieldNameGeometry =\r\n        (filters as any).geometryName !== undefined\r\n          ? (filters as any).geometryName\r\n          : fieldNameGeometry;\r\n    }\r\n    if (extent && filters) {\r\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\r\n    }\r\n    let filterAssembly: OgcFilter;\r\n    if (filters) {\r\n      filters = this.checkIgoFiltersProperties(\r\n        filters,\r\n        fieldNameGeometry,\r\n        proj\r\n      );\r\n      if (extent && enableBbox) {\r\n        filterAssembly = olfilter.and(\r\n          ourBboxFilter,\r\n          this.bundleFilter(filters, options)\r\n        );\r\n      } else {\r\n        filterAssembly = this.bundleFilter(filters, options);\r\n      }\r\n    } else {\r\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\r\n    }\r\n\r\n    const wfsOptions: WriteGetFeatureOptions = {\r\n      srsName: '',\r\n      featureNS: '',\r\n      featurePrefix: '',\r\n      featureTypes: ['featureTypes'],\r\n      filter: filterAssembly,\r\n      outputFormat: '',\r\n      geometryName: fieldNameGeometry\r\n    };\r\n\r\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\r\n    const str = new XMLSerializer().serializeToString(query);\r\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\r\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\r\n\r\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\r\n  }\r\n\r\n  private bundleFilter(\r\n    filterObject: any,\r\n    options?: OgcFilterableDataSourceOptions\r\n  ) {\r\n    if (filterObject instanceof Array) {\r\n      const logicalArray = [];\r\n      filterObject.forEach((element) => {\r\n        logicalArray.push(this.bundleFilter(element, options));\r\n      });\r\n      return logicalArray;\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        return this.createFilter(\r\n          {\r\n            operator: filterObject.logical,\r\n            logicalArray: this.bundleFilter(filterObject.filters, options)\r\n          },\r\n          options\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        return this.createFilter(\r\n          filterObject as AnyBaseOgcFilterOptions,\r\n          options\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private createFilter(\r\n    filterOptions,\r\n    options?: OgcFilterableDataSourceOptions\r\n  ): OgcFilter {\r\n    const operator = filterOptions.operator;\r\n    const logicalArray = filterOptions.logicalArray;\r\n\r\n    const wfsPropertyName = filterOptions.propertyName;\r\n    const wfsPattern = filterOptions.pattern;\r\n    const wfsMatchCase = filterOptions.matchCase\r\n      ? filterOptions.matchCase\r\n      : true;\r\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\r\n    const wfsSingleChar = filterOptions.singleChar\r\n      ? filterOptions.singleChar\r\n      : '.';\r\n    const wfsEscapeChar = filterOptions.escapeChar\r\n      ? filterOptions.escapeChar\r\n      : '!';\r\n\r\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\r\n    const wfsUpperBoundary = filterOptions.upperBoundary;\r\n\r\n    const wfsGeometryName = filterOptions.geometryName;\r\n    const wfsExtent = filterOptions.extent;\r\n    const wfsWktGeometry = filterOptions.wkt_geometry;\r\n    const wfsSrsName = filterOptions.srsName\r\n      ? filterOptions.srsName\r\n      : 'EPSG:3857';\r\n\r\n    const wfsBegin = this.parseFilterOptionDate(\r\n      filterOptions.begin,\r\n      options ? options.minDate : undefined\r\n    );\r\n    const wfsEnd = this.parseFilterOptionDate(\r\n      filterOptions.end,\r\n      options ? options.maxDate : undefined\r\n    );\r\n\r\n    const wfsExpression = filterOptions.expression;\r\n\r\n    let geometry: olGeometry;\r\n    if (wfsWktGeometry) {\r\n      const wkt = new olFormatWKT();\r\n      geometry = wkt.readGeometry(wfsWktGeometry, {\r\n        dataProjection: wfsSrsName,\r\n        featureProjection: wfsSrsName || 'EPSG:3857'\r\n      });\r\n    }\r\n\r\n    switch (operator.toLowerCase()) {\r\n      case OgcFilterOperator.BBOX.toLowerCase():\r\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\r\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\r\n        return olfilter.between(\r\n          wfsPropertyName,\r\n          wfsLowerBoundary || 1e40 * -1,\r\n          wfsUpperBoundary || 1e40\r\n        );\r\n      case OgcFilterOperator.Contains.toLowerCase():\r\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\r\n      case OgcFilterOperator.During.toLowerCase():\r\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\r\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\r\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\r\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\r\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\r\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.Intersects.toLowerCase():\r\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\r\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\r\n        return olfilter.isNull(wfsPropertyName);\r\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\r\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\r\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\r\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\r\n        return olfilter.like(\r\n          wfsPropertyName,\r\n          wfsPattern\r\n            ? wfsPattern.replace(/[()_]/gi, wfsSingleChar)\r\n            : wfsWildCard,\r\n          wfsWildCard,\r\n          wfsSingleChar,\r\n          wfsEscapeChar,\r\n          wfsMatchCase\r\n        );\r\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\r\n        return olfilter.notEqualTo(\r\n          wfsPropertyName,\r\n          wfsExpression,\r\n          wfsMatchCase\r\n        );\r\n      case OgcFilterOperator.Within.toLowerCase():\r\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\r\n      // LOGICAL\r\n      case OgcFilterOperator.And.toLowerCase():\r\n        return olfilter.and.apply(null, logicalArray);\r\n      case OgcFilterOperator.Or.toLowerCase():\r\n        return olfilter.or.apply(null, logicalArray);\r\n      case OgcFilterOperator.Not.toLowerCase():\r\n        return olfilter.not.apply(null, logicalArray);\r\n\r\n      default:\r\n        return undefined;\r\n    }\r\n  }\r\n\r\n  public defineInterfaceFilterSequence(\r\n    filterObject: any,\r\n    geometryName,\r\n    logical = '',\r\n    level = -1\r\n  ): OgcInterfaceFilterOptions[] {\r\n    if (filterObject instanceof Array) {\r\n      filterObject.forEach((element) => {\r\n        this.filterSequence.concat(\r\n          this.defineInterfaceFilterSequence(\r\n            element,\r\n            geometryName,\r\n            logical,\r\n            level\r\n          )\r\n        );\r\n      });\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        level = level + 1;\r\n        this.filterSequence.concat(\r\n          this.defineInterfaceFilterSequence(\r\n            filterObject.filters,\r\n            geometryName,\r\n            filterObject.logical,\r\n            level\r\n          )\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        this.filterSequence.push(\r\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\r\n        );\r\n      }\r\n    }\r\n    return this.filterSequence;\r\n  }\r\n\r\n  public computeAllowedOperators(\r\n    fields?: SourceFieldsOptionsParams[],\r\n    propertyName?: string,\r\n    defaultOperatorsType?: OgcFilterOperatorType\r\n  ) {\r\n    let effectiveOperators: {} = {};\r\n    let allowedOperators;\r\n    let fieldsHasSpatialOperator: boolean;\r\n    let includeContains: boolean;\r\n\r\n    if (fields && propertyName) {\r\n      const srcField = fields.find((field) => field.name === propertyName);\r\n      allowedOperators =\r\n        srcField && srcField.allowedOperatorsType\r\n          ? srcField.allowedOperatorsType\r\n          : defaultOperatorsType;\r\n    }\r\n\r\n    if (fields) {\r\n      fields.map((field) => {\r\n        if (!field.allowedOperatorsType) {\r\n          return;\r\n        }\r\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\r\n        if (\r\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\r\n          allowedOperatorsType ===\r\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\r\n          allowedOperatorsType ===\r\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\r\n        ) {\r\n          fieldsHasSpatialOperator = true;\r\n          if (\r\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\r\n          ) {\r\n            includeContains = true;\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    allowedOperators = allowedOperators\r\n      ? allowedOperators\r\n      : OgcFilterOperatorType.BasicAndSpatial;\r\n\r\n    switch (allowedOperators.toLowerCase()) {\r\n      case OgcFilterOperatorType.All:\r\n        effectiveOperators = this.operators;\r\n        break;\r\n      case OgcFilterOperatorType.Spatial:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\r\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.BasicAndSpatial:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\r\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.Basic:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.Time:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\r\n        };\r\n        break;\r\n      case OgcFilterOperatorType.BasicNumericOperator:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          },\r\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          },\r\n          [OgcFilterOperator.PropertyIsLessThan]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          },\r\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: ['number']\r\n          }\r\n        };\r\n        break;\r\n      default:\r\n        effectiveOperators = {\r\n          [OgcFilterOperator.PropertyIsEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\r\n            spatial: false,\r\n            fieldRestrict: []\r\n          },\r\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\r\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\r\n        };\r\n    }\r\n\r\n    if (fieldsHasSpatialOperator) {\r\n      (effectiveOperators as any).Intersects = {\r\n        spatial: true,\r\n        fieldRestrict: []\r\n      };\r\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\r\n      if (includeContains) {\r\n        (effectiveOperators as any).Contains = {\r\n          spatial: true,\r\n          fieldRestrict: []\r\n        };\r\n      }\r\n    }\r\n\r\n    return effectiveOperators;\r\n  }\r\n\r\n  public addInterfaceFilter(\r\n    igoOgcFilterObject?,\r\n    geometryName?,\r\n    level = 0,\r\n    parentLogical = 'Or'\r\n  ): OgcInterfaceFilterOptions {\r\n    if (!igoOgcFilterObject) {\r\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\r\n    }\r\n    const f = {\r\n      propertyName: '',\r\n      operator: '',\r\n      active: '',\r\n      filterid: uuid(),\r\n      step: '',\r\n      begin: '',\r\n      end: '',\r\n      sliderOptions: {},\r\n      lowerBoundary: '',\r\n      upperBoundary: '',\r\n      expression: '',\r\n      pattern: '',\r\n      wildCard: '*',\r\n      singleChar: '.',\r\n      escapeChar: '!',\r\n      matchCase: true,\r\n      igoSpatialSelector: '',\r\n      igoSNRC: '',\r\n      geometryName: '',\r\n      geometry: '',\r\n      wkt_geometry: '',\r\n      extent: '',\r\n      srsName: '',\r\n      parentLogical: '',\r\n      level: 0\r\n    };\r\n\r\n    return Object.assign(\r\n      f,\r\n      {\r\n        parentLogical,\r\n        level,\r\n        geometryName\r\n      },\r\n      igoOgcFilterObject\r\n    );\r\n  }\r\n\r\n  public checkIgoFiltersProperties(\r\n    filterObject: any,\r\n    fieldNameGeometry,\r\n    proj: olProjection,\r\n    active = false\r\n  ) {\r\n    const filterArray = [];\r\n    if (filterObject instanceof Array) {\r\n      filterObject.forEach((element) => {\r\n        filterArray.push(\r\n          this.checkIgoFiltersProperties(\r\n            element,\r\n            fieldNameGeometry,\r\n            proj,\r\n            active\r\n          )\r\n        );\r\n      });\r\n      return filterArray;\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        return Object.assign(\r\n          {},\r\n          {\r\n            logical: filterObject.logical,\r\n            filters: this.checkIgoFiltersProperties(\r\n              filterObject.filters,\r\n              fieldNameGeometry,\r\n              proj,\r\n              active\r\n            )\r\n          }\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        return this.addFilterProperties(\r\n          filterObject as OgcInterfaceFilterOptions,\r\n          fieldNameGeometry,\r\n          proj,\r\n          active\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private addFilterProperties(\r\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\r\n    fieldNameGeometry,\r\n    proj: olProjection,\r\n    active = false\r\n  ) {\r\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\r\n      ? igoOgcFilterObject.filterid\r\n      : uuid();\r\n    const status = igoOgcFilterObject.hasOwnProperty('active')\r\n      ? igoOgcFilterObject.active\r\n      : active;\r\n\r\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\r\n      ? igoOgcFilterObject.srsName\r\n      : proj\r\n      ? proj.getCode()\r\n      : 'EPSG:3857';\r\n\r\n    return Object.assign(\r\n      {},\r\n      {\r\n        filterid,\r\n        active: status,\r\n        igoSpatialSelector: 'fixedExtent',\r\n        srsName\r\n      },\r\n      igoOgcFilterObject,\r\n      { geometryName: fieldNameGeometry }\r\n    );\r\n  }\r\n\r\n  public rebuiltIgoOgcFilterObjectFromSequence(\r\n    sequence: OgcInterfaceFilterOptions[]\r\n  ): IgoOgcFilterObject {\r\n    if (sequence instanceof Array) {\r\n      if (sequence.length >= 1) {\r\n        let lastParentLogical = sequence[0].parentLogical;\r\n        let nextElement: any;\r\n        let logicalArray = [];\r\n        let lastProcessedFilter;\r\n        sequence.forEach((uiFilter) => {\r\n          const element = Object.assign({}, uiFilter);\r\n          const index = sequence.indexOf(uiFilter);\r\n          if (index >= 0 && index < sequence.length - 1) {\r\n            nextElement = sequence[index + 1];\r\n          } else {\r\n            nextElement = element;\r\n          }\r\n          delete element.active;\r\n          delete element.filterid;\r\n          delete element.parentLogical;\r\n          logicalArray.push(element);\r\n\r\n          if (sequence.length === 1) {\r\n            lastProcessedFilter = element;\r\n          } else if (lastParentLogical !== nextElement.parentLogical) {\r\n            if (logicalArray.length === 1) {\r\n              console.log(\r\n                'You must set at ' +\r\n                  'least two operator in a logical (' +\r\n                  lastParentLogical +\r\n                  ')'\r\n              );\r\n            } else {\r\n              lastProcessedFilter = Object.assign(\r\n                {},\r\n                { logical: lastParentLogical, filters: logicalArray }\r\n              );\r\n              logicalArray = [lastProcessedFilter];\r\n              lastParentLogical = nextElement.parentLogical;\r\n            }\r\n          }\r\n        });\r\n        return lastProcessedFilter;\r\n      } else {\r\n        return undefined;\r\n      }\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\r\n    if (\r\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\r\n    ) {\r\n      return selectors;\r\n    }\r\n    let selector: IgoOgcSelector;\r\n    if (selectors.groups && selectors.bundles) {\r\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\r\n        throw new Error('You must set an id for each of your bundles');\r\n      }\r\n      selector = ObjectUtils.copyDeep(selectors);\r\n      selector.groups.forEach((group) => {\r\n        group.title = group.title ? group.title : group.name;\r\n        group.enabled = group.enabled ? group.enabled : false;\r\n        group.computedSelectors = ObjectUtils.copyDeep(\r\n          selector.bundles.filter((b) => group.ids.includes(b.id))\r\n        );\r\n      });\r\n    } else if (!selectors.groups && selectors.bundles) {\r\n      selector = ObjectUtils.copyDeep(selectors);\r\n      selector.groups = [\r\n        {\r\n          title: 'group1',\r\n          name: 'group1',\r\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\r\n        } as SelectorGroup\r\n      ];\r\n    } else {\r\n      selector = {\r\n        bundles: selectors as any,\r\n        groups: [\r\n          {\r\n            title: 'group1',\r\n            name: 'group1',\r\n            computedSelectors: ObjectUtils.copyDeep(\r\n              selectors\r\n            ) as OgcSelectorBundle[]\r\n          } as SelectorGroup\r\n        ],\r\n        selectorType: selector.selectorType\r\n      };\r\n    }\r\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\r\n      selector.groups[0].enabled = true;\r\n    }\r\n    return selector;\r\n  }\r\n\r\n  public handleOgcFiltersAppliedValue(\r\n    options: OgcFilterableDataSourceOptions,\r\n    fieldNameGeometry: string,\r\n    extent?: Extent,\r\n    proj?: olProjection\r\n  ): string {\r\n    const ogcFilters = options.ogcFilters;\r\n    if (!ogcFilters) {\r\n      return;\r\n    }\r\n    const conditions = [];\r\n    let filterQueryStringSelector = '';\r\n    let filterQueryStringAdvancedFilters = '';\r\n    if (\r\n      ogcFilters.enabled &&\r\n      (ogcFilters.pushButtons ||\r\n        ogcFilters.checkboxes ||\r\n        ogcFilters.radioButtons ||\r\n        ogcFilters.select ||\r\n        ogcFilters.autocomplete)\r\n    ) {\r\n      let selectors;\r\n      if (ogcFilters.pushButtons) {\r\n        selectors = ogcFilters.pushButtons;\r\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\r\n        for (const condition of pushConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.checkboxes) {\r\n        selectors = ogcFilters.checkboxes;\r\n        const checkboxConditions = this.formatGroupAndFilter(\r\n          ogcFilters,\r\n          selectors\r\n        );\r\n        for (const condition of checkboxConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.radioButtons) {\r\n        selectors = ogcFilters.radioButtons;\r\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\r\n        const radioConditions = this.formatGroupAndFilter(\r\n          ogcFilters,\r\n          selectorsCorr\r\n        );\r\n        for (const condition of radioConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.select) {\r\n        selectors = ogcFilters.select;\r\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\r\n        const selectConditions = this.formatGroupAndFilter(\r\n          ogcFilters,\r\n          selectorsCorr\r\n        );\r\n        for (const condition of selectConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n      if (ogcFilters.autocomplete) {\r\n        selectors = ogcFilters.autocomplete;\r\n        const selectConditions = this.formatGroupAndFilter(\r\n          ogcFilters,\r\n          selectors\r\n        );\r\n        for (const condition of selectConditions) {\r\n          conditions.push(condition);\r\n        }\r\n      }\r\n\r\n      if (conditions.length >= 1) {\r\n        filterQueryStringSelector = this.buildFilter(\r\n          conditions.length === 1\r\n            ? conditions[0]\r\n            : { logical: 'And', filters: conditions },\r\n          extent,\r\n          proj,\r\n          ogcFilters.geometryName\r\n        );\r\n      }\r\n    }\r\n    if (ogcFilters.enabled && ogcFilters.filters) {\r\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\r\n      const igoFilters = ogcFilters.filters;\r\n      filterQueryStringAdvancedFilters = this.buildFilter(\r\n        igoFilters,\r\n        extent,\r\n        proj,\r\n        ogcFilters.geometryName,\r\n        options\r\n      );\r\n    }\r\n\r\n    let filterQueryString = ogcFilters.advancedOgcFilters\r\n      ? filterQueryStringAdvancedFilters\r\n      : filterQueryStringSelector;\r\n    if (options.type === 'wms') {\r\n      filterQueryString = this.formatProcessedOgcFilter(\r\n        filterQueryString,\r\n        (options as any).params.LAYERS\r\n      );\r\n    }\r\n    if (options.type === 'wfs') {\r\n      filterQueryString = this.formatProcessedOgcFilter(\r\n        filterQueryString,\r\n        (options as any).params.featureTypes\r\n      );\r\n    }\r\n\r\n    return filterQueryString;\r\n  }\r\n\r\n  public verifyMultipleEnableds(selectors) {\r\n    selectors.bundles.forEach((bundle) => {\r\n      if (!bundle.multiple && bundle.selectors) {\r\n        const enableds = bundle.selectors.reduce(\r\n          (list, filter, index) =>\r\n            filter.enabled === true ? list.concat(index) : list,\r\n          []\r\n        );\r\n        if (enableds.length > 1) {\r\n          enableds.splice(0, 1);\r\n          enableds.forEach((index) => {\r\n            bundle.selectors[index].enabled = false;\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return selectors;\r\n  }\r\n\r\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\r\n    selectors = this.computeIgoSelector(selectors);\r\n    const selectorBundle = selectors.groups.find(\r\n      (g) => g.enabled\r\n    ).computedSelectors;\r\n    const conditions = [];\r\n    selectorBundle.map((bundle) => {\r\n      const bundleCondition = [];\r\n      const selectorsType = bundle.selectors as any;\r\n      if (!selectorsType) {\r\n        return;\r\n      }\r\n      selectorsType\r\n        .filter((ogcselector) => ogcselector.enabled === true)\r\n        .forEach((enabledSelector) =>\r\n          bundleCondition.push(enabledSelector.filters)\r\n        );\r\n      if (bundleCondition.length === 1) {\r\n        conditions.push(bundleCondition[0]);\r\n      } else if (bundleCondition.length > 1) {\r\n        conditions.push({\r\n          logical: bundle.logical,\r\n          filters: bundleCondition\r\n        });\r\n      }\r\n    });\r\n\r\n    if (selectors.selectorType === 'pushButton') {\r\n      ogcFilters.pushButtons = selectors;\r\n    } else if (selectors.selectorType === 'checkbox') {\r\n      ogcFilters.checkboxes = selectors;\r\n    } else if (selectors.selectorType === 'radioButton') {\r\n      ogcFilters.radioButtons = selectors;\r\n    } else if (selectors.selectorType === 'select') {\r\n      ogcFilters.select = selectors;\r\n    } else if (selectors.selectorType === 'autocomplete') {\r\n      ogcFilters.autocomplete = selectors;\r\n    }\r\n    return conditions;\r\n  }\r\n\r\n  public formatProcessedOgcFilter(\r\n    processedFilter: string,\r\n    layersOrTypenames: string\r\n  ): string {\r\n    if (!processedFilter) {\r\n      return undefined;\r\n    }\r\n    let appliedFilter = '';\r\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\r\n      appliedFilter = processedFilter;\r\n    } else {\r\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\r\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\r\n          'filter=',\r\n          ''\r\n        )})`;\r\n      });\r\n    }\r\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\r\n    const filterValue =\r\n      appliedFilter.length > 0\r\n        ? appliedFilter.replace('filter=', '')\r\n        : undefined;\r\n    return filterValue;\r\n  }\r\n\r\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\r\n    if (!value) {\r\n      return defaultValue;\r\n    } else if (value === 'today') {\r\n      return undefined;\r\n    } else if (moment(value).isValid()) {\r\n      return value;\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n}\r\n","import * as OlFormat from 'ol/format';\r\nimport olFormatGML2 from 'ol/format/GML2';\r\nimport olFormatGML3 from 'ol/format/GML3';\r\nimport olFormatGML32 from 'ol/format/GML32';\r\nimport olFormatOSMXML from 'ol/format/OSMXML';\r\nimport olProjection from 'ol/proj/Projection';\r\nimport { Extent } from 'ol/extent';\r\n\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\r\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\n\r\nexport const defaultEpsg = 'EPSG:3857';\r\nexport const defaultMaxFeatures = 5000;\r\nexport const defaultWfsVersion = '2.0.0';\r\nexport const defaultFieldNameGeometry = 'geometry';\r\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\r\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\r\n\r\n/**\r\n * This method build the WFS URL based on the layer property.\r\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\r\n * @param extent  An extent like array [number, number, number, number]\r\n * @param proj  olProjection\r\n * @param ogcFilters  OgcFiltersOptions\r\n * @returns A string representing the datasource options, based on filter and views\r\n */\r\nexport function buildUrl(\r\n  options: WFSDataSourceOptions,\r\n  extent: Extent,\r\n  proj: olProjection,\r\n  ogcFilters: OgcFiltersOptions,\r\n  randomParam?: boolean\r\n): string {\r\n  const paramsWFS = options.paramsWFS;\r\n  const queryStringValues = formatWFSQueryString(\r\n    options,\r\n    undefined,\r\n    options.paramsWFS.srsName\r\n  );\r\n  let igoFilters;\r\n  if (ogcFilters?.enabled) {\r\n    igoFilters = ogcFilters?.filters;\r\n  }\r\n  const ogcFilterWriter = new OgcFilterWriter();\r\n  const filterOrBox = ogcFilterWriter.buildFilter(\r\n    igoFilters,\r\n    extent,\r\n    proj,\r\n    ogcFilters?.geometryName,\r\n    options\r\n  );\r\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n    options,\r\n    ogcFilters?.geometryName,\r\n    extent,\r\n    proj\r\n  );\r\n\r\n  let prefix = 'filter';\r\n  if (!filterOrPush) {\r\n    prefix = 'bbox';\r\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\r\n  }\r\n\r\n  paramsWFS.xmlFilter = ogcFilters?.advancedOgcFilters\r\n    ? filterOrBox\r\n    : `${prefix}=${filterOrPush}`;\r\n  let baseUrl = queryStringValues.find((f) => f.name === 'getfeature').value;\r\n  const patternFilter = /(filter|bbox)=.*/gi;\r\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter)\r\n    ? `${baseUrl}&${paramsWFS.xmlFilter}`\r\n    : baseUrl;\r\n  options.download = Object.assign({}, options.download, {\r\n    dynamicUrl: baseUrl\r\n  });\r\n  if (randomParam) {\r\n    baseUrl += `$&_t${new Date().getTime()}`;\r\n  }\r\n  return baseUrl.replace(/&&/g, '&');\r\n}\r\n\r\n/**\r\n * This method build/standardize WFS call query params based on the layer property.\r\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\r\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\r\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\r\n * @param properties  String: Used to control the queried fields  (WFS service).\r\n * @returns An array array of {name: '', value: ''} of predefined query params.\r\n */\r\nexport function formatWFSQueryString(\r\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\r\n  count?: number,\r\n  epsg?: string,\r\n  properties?: string,\r\n  startIndex: number = 0,\r\n  forceDefaultOutputFormat: boolean = false\r\n): { name: string; value: string }[] {\r\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\r\n  const url = dataSourceOptions.urlWfs;\r\n  const paramsWFS = dataSourceOptions.paramsWFS;\r\n  const effectiveCount = count || defaultMaxFeatures;\r\n  const effectiveStartIndex =\r\n    paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\r\n  const epsgCode = epsg || defaultEpsg;\r\n  let outputFormat = paramsWFS.outputFormat\r\n    ? `outputFormat=${paramsWFS.outputFormat}`\r\n    : '';\r\n  let version = paramsWFS.version\r\n    ? `version=${paramsWFS.version}`\r\n    : `version=${defaultWfsVersion}`;\r\n  const paramTypename =\r\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\r\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\r\n  const paramMaxFeatures =\r\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\r\n  let cnt = count\r\n    ? `${paramMaxFeatures}=${effectiveCount}`\r\n    : paramsWFS.maxFeatures\r\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\r\n    : `${paramMaxFeatures}=${effectiveCount}`;\r\n  if (forceDefaultOutputFormat) {\r\n    outputFormat = '';\r\n    version = 'version=1.1.0';\r\n    cnt = cnt.replace('count', 'maxFeatures');\r\n  }\r\n\r\n  const srs = epsg\r\n    ? `srsname=${epsgCode}`\r\n    : paramsWFS.srsName\r\n    ? 'srsname=' + paramsWFS.srsName\r\n    : `srsname=${epsgCode}`;\r\n\r\n  let propertyName = '';\r\n  let valueReference = '';\r\n  if (properties) {\r\n    propertyName = `propertyName=${properties}`;\r\n    valueReference = `valueReference=${properties}`;\r\n  }\r\n  const sourceFields = dataSourceOptions.sourceFields;\r\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\r\n    const fieldsNames = [];\r\n    dataSourceOptions.sourceFields.forEach((sourcefield) => {\r\n      fieldsNames.push(sourcefield.name);\r\n    });\r\n    propertyName = `propertyName=${fieldsNames.join(',')},${\r\n      paramsWFS.fieldNameGeometry\r\n    }`;\r\n  }\r\n\r\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\r\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\r\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\r\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\r\n\r\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\r\n  getpropertyvalue += `&${cnt}&${valueReference}`;\r\n\r\n  return [\r\n    { name: 'outputformat', value: outputFormat },\r\n    { name: 'version', value: version },\r\n    { name: 'typename', value: featureTypes },\r\n    { name: 'count', value: cnt },\r\n    { name: 'srsname', value: srs },\r\n    { name: 'propertyname', value: propertyName },\r\n    { name: 'valuereference', value: valueReference },\r\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\r\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\r\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\r\n  ];\r\n}\r\n\r\n/**\r\n * Validate/Modify layer's wfs options based on :\r\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\r\n * https://github.com/openlayers/openlayers/pull/6400\r\n * 2- Set default values for optionals parameters.\r\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\r\n * @returns An array array of {name: '', value: ''} of predefined query params.\r\n */\r\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\r\n  if (srcType && srcType === 'wfs') {\r\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\r\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\r\n  }\r\n\r\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\r\n  wfsDataSourceOptions.urlWfs =\r\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\r\n\r\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\r\n  paramsWFS.fieldNameGeometry =\r\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\r\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\r\n\r\n  let outputFormat;\r\n  if (paramsWFS.outputFormat) {\r\n    outputFormat = paramsWFS.outputFormat;\r\n  }\r\n\r\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\r\n    paramsWFS.version = '1.1.0';\r\n  }\r\n  return Object.assign({}, wfsDataSourceOptions);\r\n}\r\n\r\nexport function getFormatFromOptions(\r\n  options: WFSDataSourceOptions | WMSDataSourceOptions\r\n) {\r\n  const wfsOptions = options as WFSDataSourceOptions;\r\n\r\n  let olFormatCls;\r\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\r\n    ? wfsOptions.paramsWFS.outputFormat\r\n    : undefined;\r\n\r\n  if (!outputFormat) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  }\r\n\r\n  if (OlFormat[outputFormat]) {\r\n    olFormatCls = OlFormat[outputFormat];\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('gml2')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({\r\n      ...wfsOptions.formatOptions,\r\n      ...{ gmlFormat: olFormatGML2 }\r\n    });\r\n  } else if (outputFormat.toLowerCase().match('gml32')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({\r\n      ...wfsOptions.formatOptions,\r\n      ...{ gmlFormat: olFormatGML32 }\r\n    });\r\n  } else if (outputFormat.toLowerCase().match('gml3')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({\r\n      ...wfsOptions.formatOptions,\r\n      ...{ gmlFormat: olFormatGML3 }\r\n    });\r\n  } else if (outputFormat.toLowerCase().match('topojson')) {\r\n    olFormatCls = OlFormat.TopoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('geojson')) {\r\n    olFormatCls = OlFormat.GeoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\r\n    olFormatCls = OlFormat.EsriJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('json')) {\r\n    olFormatCls = OlFormat.GeoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('gpx')) {\r\n    olFormatCls = OlFormat.GPX;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('WKT')) {\r\n    olFormatCls = OlFormat.WKT;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\r\n    olFormatCls = olFormatOSMXML;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('kml')) {\r\n    olFormatCls = OlFormat.KML;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  }\r\n\r\n  return new olFormatCls();\r\n}\r\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import {\r\n  EntityKey,\r\n  getEntityIcon,\r\n  getEntityId,\r\n  getEntityProperty,\r\n  getEntityRevision,\r\n  getEntityTitle\r\n} from '@igo2/common';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport * as olextent from 'ol/extent';\r\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport type { GeometryLayout } from 'ol/geom/Geometry';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlLayer from 'ol/layer/Layer';\r\nimport * as olproj from 'ol/proj';\r\nimport OlRenderFeature from 'ol/render/Feature';\r\nimport OlSource from 'ol/source/Source';\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport { MapExtent, MapViewController } from '../../map/shared';\r\nimport { FEATURE, FeatureMotion } from './feature.enums';\r\nimport { Feature, FeatureGeometry } from './feature.interfaces';\r\n\r\n/**\r\n * Create an Openlayers feature object out of a feature definition.\r\n * The output object has a reference to the feature id.\r\n * @param feature Feature definition\r\n * @param projectionOut Feature object projection\r\n * @returns OpenLayers feature object\r\n */\r\nexport function featureToOl(\r\n  feature: Feature,\r\n  projectionOut: string,\r\n  getId?: (Feature) => EntityKey\r\n): OlFeature<OlGeometry> {\r\n  getId = getId ? getId : getEntityId;\r\n\r\n  const olFormat = new OlFormatGeoJSON();\r\n  const olFeature = olFormat.readFeature(feature, {\r\n    dataProjection: feature.projection,\r\n    featureProjection: projectionOut\r\n  });\r\n\r\n  olFeature.setId(getId(feature));\r\n\r\n  const title = getEntityTitle(feature);\r\n  if (title !== undefined) {\r\n    olFeature.set('_title', title, true);\r\n  }\r\n\r\n  if (feature.extent !== undefined) {\r\n    olFeature.set('_extent', feature.extent, true);\r\n  }\r\n\r\n  if (feature.projection !== undefined) {\r\n    olFeature.set('_projection', feature.projection, true);\r\n  }\r\n\r\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\r\n  if (mapTitle !== undefined) {\r\n    olFeature.set('_mapTitle', mapTitle, true);\r\n  }\r\n\r\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\r\n\r\n  const icon = getEntityIcon(feature);\r\n  if (icon !== undefined) {\r\n    olFeature.set('_icon', icon, true);\r\n  }\r\n\r\n  if (feature.meta && feature.meta.style) {\r\n    olFeature.set('_style', feature.meta.style, true);\r\n  }\r\n\r\n  if (feature.sourceId) {\r\n    olFeature.set('_sourceId', feature.sourceId, true);\r\n  }\r\n\r\n  return olFeature;\r\n}\r\n\r\nexport function renderFeatureFromOl(\r\n  olRenderFeature: OlRenderFeature,\r\n  projectionIn: string,\r\n  olLayer?: OlLayer<OlSource>,\r\n  projectionOut = 'EPSG:4326'\r\n): Feature {\r\n  let geom;\r\n  let title;\r\n  let exclude;\r\n  let excludeOffline;\r\n\r\n  if (olLayer) {\r\n    title = olLayer.get('title');\r\n    if (olLayer.get('sourceOptions')) {\r\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\r\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\r\n    }\r\n  } else {\r\n    title = olRenderFeature.get('_title');\r\n  }\r\n\r\n  const olFormat = new OlFormatGeoJSON();\r\n  const properties = olRenderFeature.getProperties();\r\n  const geometryType = olRenderFeature.getType();\r\n\r\n  if (geometryType === 'Polygon') {\r\n    const ends = olRenderFeature.getEnds() as number[];\r\n    geom = new OlPolygon(\r\n      olRenderFeature.getFlatCoordinates(),\r\n      'XY' as GeometryLayout,\r\n      ends\r\n    );\r\n  } else if (geometryType === 'Point') {\r\n    geom = new OlPoint(\r\n      olRenderFeature.getFlatCoordinates(),\r\n      'XY' as GeometryLayout\r\n    );\r\n  } else if (geometryType === 'LineString') {\r\n    geom = new OlLineString(\r\n      olRenderFeature.getFlatCoordinates(),\r\n      'XY' as GeometryLayout\r\n    );\r\n  }\r\n\r\n  const geometry = olFormat.writeGeometryObject(geom, {\r\n    dataProjection: projectionOut,\r\n    featureProjection: projectionIn\r\n  }) as FeatureGeometry;\r\n\r\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\r\n  const mapTitle = olRenderFeature.get('_mapTitle');\r\n  const extent = olproj.transformExtent(\r\n    olRenderFeature.getExtent(),\r\n    projectionIn,\r\n    projectionOut\r\n  ) as [number, number, number, number];\r\n  return {\r\n    type: FEATURE,\r\n    projection: projectionOut,\r\n    extent,\r\n    meta: {\r\n      id,\r\n      title: title ? title : mapTitle ? mapTitle : id,\r\n      mapTitle,\r\n      excludeAttribute: exclude,\r\n      excludeAttributeOffline: excludeOffline\r\n    },\r\n    properties,\r\n    geometry,\r\n    ol: olRenderFeature\r\n  };\r\n}\r\n/**\r\n * Create a feature object out of an OL feature\r\n * The output object has a reference to the feature id.\r\n * @param olFeature OL Feature\r\n * @param projectionIn OL feature projection\r\n * @param olLayer OL Layer\r\n * @param projectionOut Feature projection\r\n * @returns Feature\r\n */\r\nexport function featureFromOl(\r\n  olFeature: OlFeature<OlGeometry>,\r\n  projectionIn: string,\r\n  olLayer?: OlLayer<OlSource>,\r\n  projectionOut = 'EPSG:4326'\r\n): Feature {\r\n  let title;\r\n  let exclude;\r\n  let excludeOffline;\r\n  let idColumn; // for arcgisrest and tilearcgisrest source\r\n  const olFormat = new OlFormatGeoJSON();\r\n\r\n  const keys = olFeature.getKeys().filter((key: string) => {\r\n    return !key.startsWith('_') && key !== 'geometry';\r\n  });\r\n  const properties = keys.reduce((acc: object, key: string) => {\r\n    acc[key] = olFeature.get(key);\r\n    return acc;\r\n  }, {});\r\n\r\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\r\n    dataProjection: projectionOut,\r\n    featureProjection: projectionIn\r\n  }) as FeatureGeometry;\r\n\r\n  if (olLayer) {\r\n    title = olLayer.get('title');\r\n    const sourceOptions = olLayer.get('sourceOptions');\r\n    if (sourceOptions) {\r\n      exclude = sourceOptions.excludeAttribute;\r\n      excludeOffline = sourceOptions.excludeAttributeOffline;\r\n      idColumn =\r\n        sourceOptions.idColumn ||\r\n        (sourceOptions.type === 'arcgisrest' ||\r\n        sourceOptions.type === 'tilearcgisrest'\r\n          ? 'OBJECTID'\r\n          : undefined);\r\n    }\r\n  } else {\r\n    title = olFeature.get('_title');\r\n  }\r\n  const mapTitle = olFeature.get('_mapTitle');\r\n  const id = olFeature.getId()\r\n    ? olFeature.getId()\r\n    : olFeature.get(idColumn)\r\n    ? olFeature.get(idColumn)\r\n    : uuid();\r\n  const newFeature = olFeature.get('_newFeature');\r\n\r\n  return {\r\n    type: FEATURE,\r\n    projection: projectionOut,\r\n    extent: olFeature.get('_extent'),\r\n    meta: {\r\n      id,\r\n      title: title ? title : mapTitle ? mapTitle : id,\r\n      mapTitle,\r\n      revision: olFeature.getRevision(),\r\n      style: olFeature.get('_style'),\r\n      excludeAttribute: exclude,\r\n      excludeAttributeOffline: excludeOffline\r\n    },\r\n    properties,\r\n    geometry,\r\n    ol: olFeature\r\n  };\r\n}\r\n\r\n/**\r\n * Compute an OL feature extent in it's map projection\r\n * @param map Map\r\n * @param olFeature OL feature\r\n * @returns Extent in the map projection\r\n */\r\nexport function computeOlFeatureExtent(\r\n  olFeature: OlFeature<OlGeometry>,\r\n  projection: olproj.Projection\r\n): [number, number, number, number] {\r\n  let olExtent = olextent.createEmpty();\r\n\r\n  const olFeatureExtent = olFeature.get('_extent');\r\n  const olFeatureProjection = olFeature.get('_projection');\r\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\r\n    olExtent = olproj.transformExtent(\r\n      olFeatureExtent,\r\n      olFeatureProjection,\r\n      projection\r\n    );\r\n  } else {\r\n    const olGeometry = olFeature.getGeometry();\r\n    if (olGeometry !== null) {\r\n      olExtent = olGeometry.getExtent();\r\n    }\r\n  }\r\n\r\n  return olExtent as [number, number, number, number];\r\n}\r\n\r\n/**\r\n * Compute a multiple OL features extent in their map projection\r\n * @param map Map\r\n * @param olFeatures OL features\r\n * @returns Extent in the map projection\r\n */\r\nexport function computeOlFeaturesExtent(\r\n  olFeatures: OlFeature<OlGeometry>[],\r\n  projection: olproj.Projection\r\n): [number, number, number, number] {\r\n  const extent = olextent.createEmpty();\r\n\r\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n    const featureExtent = computeOlFeatureExtent(olFeature, projection);\r\n    olextent.extend(extent, featureExtent);\r\n  });\r\n\r\n  return extent as [number, number, number, number];\r\n}\r\n\r\n/**\r\n * Scale an extent.\r\n * @param extent Extent\r\n * @param Scaling factors for top, right, bottom and left directions, in that order\r\n * @returns Scaled extent\r\n */\r\nexport function scaleExtent(\r\n  extent: [number, number, number, number],\r\n  scale: [number, number, number, number]\r\n): [number, number, number, number] {\r\n  const [width, height] = olextent.getSize(extent);\r\n  return [\r\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\r\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\r\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\r\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\r\n  ];\r\n}\r\n\r\n/**\r\n * Return true if features are out of view.\r\n * If features are too close to the edge, they are considered out of view.\r\n * By default, we define the edge as 5% (0.05) of the extent size.\r\n * @param map Map\r\n * @param featuresExtent The features's extent\r\n * @param edgeRatio Number or Number[] Single value OR an array =>\r\n *  [top,right,bottom,left] directions, in that order\r\n * @returns Return true if features are out of view\r\n */\r\nexport function featuresAreOutOfView(\r\n  extent: MapExtent,\r\n  featuresExtent: [number, number, number, number],\r\n  edgeRatio: number | number[] = 0.05\r\n) {\r\n  const edgesRatio = Array.isArray(edgeRatio)\r\n    ? edgeRatio\r\n    : [edgeRatio, edgeRatio, edgeRatio, edgeRatio];\r\n  const scale = [-1, -1, -1, -1].map((x, i) => x * edgesRatio[i]);\r\n  const viewExtent = scaleExtent(\r\n    extent,\r\n    scale as [number, number, number, number]\r\n  );\r\n\r\n  return !olextent.containsExtent(viewExtent, featuresExtent);\r\n}\r\n\r\n/**\r\n * Return true if features are too deep into the view. This results\r\n * in features being too small.\r\n * Features are considered too small if their extent occupies less than\r\n * 1% of the map extent.\r\n * @param map Map\r\n * @param featuresExtent The features's extent\r\n * @param areaRatio The features extent to view extent acceptable ratio\r\n * @returns Return true if features are too deep in the view\r\n */\r\nexport function featuresAreTooDeepInView(\r\n  viewController: MapViewController,\r\n  featuresExtent: [number, number, number, number],\r\n  areaRatio?: number\r\n) {\r\n  // An area ratio of 0.004 means that the feature extent's width and height\r\n  // should be about 1/16 of the map extent's width and height\r\n  areaRatio = areaRatio ? areaRatio : 0.004;\r\n  const mapExtent = viewController.getExtent();\r\n  const mapExtentArea = olextent.getArea(mapExtent);\r\n  const featuresExtentArea = olextent.getArea(featuresExtent);\r\n\r\n  if (featuresExtentArea === 0 && viewController.getZoom() > 13) {\r\n    // In case it's a point\r\n    return false;\r\n  }\r\n\r\n  return featuresExtentArea / mapExtentArea < areaRatio;\r\n}\r\n\r\n/**\r\n * Fit view to include the features extent.\r\n * By default, this method will let the features occupy about 50% of the viewport.\r\n * @param map Map\r\n * @param olFeatures OL features\r\n * @param motion To motion to the new map view\r\n * @param scale If this is defined, the original view will be scaled\r\n *  by that factor before any logic is applied.\r\n */\r\nexport function moveToOlFeatures(\r\n  viewController: MapViewController,\r\n  olFeatures: OlFeature<OlGeometry>[],\r\n  motion: FeatureMotion = FeatureMotion.Default,\r\n  scale?: [number, number, number, number],\r\n  areaRatio?: number\r\n) {\r\n  const extent = viewController.getExtent();\r\n  const projection = viewController.getOlProjection();\r\n  const featuresExtent = computeOlFeaturesExtent(olFeatures, projection);\r\n  let viewExtent = featuresExtent;\r\n  if (scale !== undefined) {\r\n    viewExtent = scaleExtent(viewExtent, scale);\r\n  }\r\n\r\n  if (motion === FeatureMotion.Zoom) {\r\n    viewController.zoomToExtent(viewExtent);\r\n  } else if (motion === FeatureMotion.Move) {\r\n    viewController.moveToExtent(viewExtent);\r\n  } else if (motion === FeatureMotion.Default) {\r\n    if (\r\n      featuresAreOutOfView(extent, featuresExtent) ||\r\n      featuresAreTooDeepInView(viewController, featuresExtent, areaRatio)\r\n    ) {\r\n      viewController.zoomToExtent(viewExtent);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Hide an OL feature\r\n * @param olFeature OL feature\r\n */\r\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\r\n  olFeature.setStyle(new olstyle.Style({}));\r\n}\r\n\r\n/**\r\n * Compute a diff between a source array of Ol features and a target array\r\n * @param source Source array of OL features\r\n * @param starget Target array of OL features\r\n * @returns Features to add and remove\r\n */\r\nexport function computeOlFeaturesDiff(\r\n  source: OlFeature<OlGeometry>[],\r\n  target: OlFeature<OlGeometry>[]\r\n): {\r\n  add: OlFeature<OlGeometry>[];\r\n  remove: OlFeature<OlGeometry>[];\r\n} {\r\n  const olFeaturesMap = new Map();\r\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n    olFeaturesMap.set(olFeature.getId(), olFeature);\r\n  });\r\n\r\n  const olFeaturesToRemove = [];\r\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\r\n    if (newOlFeature === undefined) {\r\n      olFeaturesToRemove.push(olFeature);\r\n    } else if (\r\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\r\n    ) {\r\n      olFeaturesToRemove.push(olFeature);\r\n    } else {\r\n      olFeaturesMap.delete(newOlFeature.getId());\r\n    }\r\n  });\r\n\r\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\r\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\r\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\r\n  });\r\n\r\n  return {\r\n    add: olFeaturesToAdd,\r\n    remove: olFeaturesToRemove\r\n  };\r\n}\r\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public declare options: OSMDataSourceOptions;\n  public declare ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public declare options: XYZDataSourceOptions;\n  public declare ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import { AuthInterceptor } from '@igo2/auth';\r\n\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\r\nimport olSourceVector from 'ol/source/Vector';\r\n\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\nimport {\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFiltersOptions\r\n} from '../../../filter/shared/ogc-filter.interface';\r\nimport { DataSource } from './datasource';\r\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WFSService } from './wfs.service';\r\nimport {\r\n  checkWfsParams,\r\n  defaultFieldNameGeometry,\r\n  getFormatFromOptions\r\n} from './wms-wfs.utils';\r\n\r\nexport class WFSDataSource extends DataSource {\r\n  public declare ol: olSourceVector<OlGeometry>;\r\n\r\n  set ogcFilters(value: OgcFiltersOptions) {\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\r\n  }\r\n  get ogcFilters(): OgcFiltersOptions {\r\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n  }\r\n\r\n  constructor(\r\n    public options: WFSDataSourceOptions,\r\n    protected wfsService: WFSService,\r\n    private authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(checkWfsParams(options, 'wfs'));\r\n\r\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions)\r\n      .ogcFilters;\r\n    const fieldNameGeometry =\r\n      this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\r\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(\r\n        ogcFilters,\r\n        fieldNameGeometry\r\n      );\r\n    if (\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\r\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\r\n    ) {\r\n      this.wfsService.getSourceFieldsFromWFS(this.options);\r\n    }\r\n\r\n    if (ogcFilters?.pushButtons) {\r\n      ogcFilters.pushButtons.selectorType = 'pushButton';\r\n    }\r\n    if (ogcFilters?.checkboxes) {\r\n      ogcFilters.checkboxes.selectorType = 'checkbox';\r\n    }\r\n    if (ogcFilters?.radioButtons) {\r\n      ogcFilters.radioButtons.selectorType = 'radioButton';\r\n    }\r\n    if (ogcFilters?.select) {\r\n      ogcFilters.select.selectorType = 'select';\r\n    }\r\n    if (ogcFilters?.autocomplete) {\r\n      ogcFilters.autocomplete.selectorType = 'autocomplete';\r\n    }\r\n\r\n    this.setOgcFilters(\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters,\r\n      true\r\n    );\r\n  }\r\n\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    const vectorSource = new olSourceVector({\r\n      format: getFormatFromOptions(this.options),\r\n      strategy: OlLoadingStrategy.bbox\r\n    });\r\n    return vectorSource;\r\n  }\r\n\r\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\r\n    this.ogcFilters = ogcFilters;\r\n    if (triggerEvent) {\r\n      this.ol.notify('ogcFilters', this.ogcFilters);\r\n    }\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","export abstract class DataService {\n  abstract getData(): string;\n}\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { Observable, combineLatest, of } from 'rxjs';\r\nimport { concatMap } from 'rxjs/operators';\r\n\r\nimport { DataService } from './data.service';\r\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\nimport {\r\n  defaultEpsg,\r\n  defaultMaxFeatures,\r\n  formatWFSQueryString,\r\n  getFormatFromOptions,\r\n  gmlRegex\r\n} from './wms-wfs.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WFSService extends DataService {\r\n  constructor(private http: HttpClient) {\r\n    super();\r\n  }\r\n\r\n  getData() {\r\n    console.log('This is defining a data service.');\r\n    return 'This is defining a data service.';\r\n  }\r\n\r\n  public getSourceFieldsFromWFS(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\r\n  ) {\r\n    if (\r\n      !dataSourceOptions.sourceFields ||\r\n      dataSourceOptions.sourceFields.length === 0\r\n    ) {\r\n      dataSourceOptions.sourceFields = [];\r\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\r\n        (getfeatureSourceField) => {\r\n          dataSourceOptions.sourceFields = getfeatureSourceField;\r\n        }\r\n      );\r\n    } else {\r\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\r\n        (getfeatureSourceField) => {\r\n          dataSourceOptions.sourceFields.forEach((sourcefield) => {\r\n            if (sourcefield.alias === undefined) {\r\n              sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\r\n            }\r\n            if (\r\n              sourcefield.values === undefined ||\r\n              sourcefield.values.length === 0\r\n            ) {\r\n              sourcefield.values = getfeatureSourceField.find(\r\n                (sf) => sf.name === sourcefield.name\r\n              ).values;\r\n            }\r\n          });\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  private wfsGetFeature(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\r\n    nb: number = defaultMaxFeatures,\r\n    epsgCode: string = defaultEpsg,\r\n    propertyName?: string,\r\n    startIndex: number = 0,\r\n    forceDefaultOutputFormat: boolean = false\r\n  ): Observable<any> {\r\n    const queryStringValues = formatWFSQueryString(\r\n      dataSourceOptions,\r\n      nb,\r\n      epsgCode,\r\n      propertyName,\r\n      startIndex,\r\n      forceDefaultOutputFormat\r\n    );\r\n    const baseUrl = queryStringValues.find(\r\n      (f) => f.name === 'getfeature'\r\n    ).value;\r\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\r\n    if (\r\n      forceDefaultOutputFormat ||\r\n      gmlRegex.test(outputFormat) ||\r\n      !outputFormat\r\n    ) {\r\n      return this.http.get(baseUrl, { responseType: 'text' });\r\n    } else {\r\n      return this.http.get(baseUrl);\r\n    }\r\n  }\r\n\r\n  defineFieldAndValuefromWFS(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\r\n  ): Observable<any> {\r\n    return new Observable((d) => {\r\n      const sourceFields = [];\r\n      let fieldList;\r\n      let fieldListWoGeom;\r\n      let fieldListWoGeomStr;\r\n      let olFormats;\r\n      let effectiveOlFormats;\r\n\r\n      olFormats = getFormatFromOptions(dataSourceOptions);\r\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions =\r\n        JSON.parse(JSON.stringify(dataSourceOptions));\r\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\r\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\r\n\r\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\r\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields\r\n        ?.filter((f) => !f.values)\r\n        .map((f) => f.name);\r\n\r\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\r\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true)\r\n        .pipe(\r\n          concatMap((res) =>\r\n            String(res).toLowerCase().includes('exception')\r\n              ? of(false)\r\n              : of(true)\r\n          ),\r\n          concatMap((allowGml) => {\r\n            // If the service return GML (return no exception)\r\n            return this.wfsGetFeature(dataSourceOptions, 1).pipe(\r\n              concatMap((firstFeature) => {\r\n                const features = olFormats.readFeatures(firstFeature);\r\n                fieldList = features[0].getKeys();\r\n                if (\r\n                  dataSourceOptions.sourceFields ||\r\n                  dataSourceOptions.sourceFields.length === 0\r\n                ) {\r\n                  sourceFieldsToRetrieveValues = fieldList;\r\n                }\r\n                fieldListWoGeom = fieldList.filter(\r\n                  (field) =>\r\n                    sourceFieldsToRetrieveValues.includes(field) &&\r\n                    field !== features[0].getGeometryName() &&\r\n                    !field.match(/boundedby/gi)\r\n                );\r\n                fieldListWoGeomStr = fieldListWoGeom.join(',');\r\n                const processingArray = [];\r\n                let startIndex = 0;\r\n                // If the service do not allow gml return, dice the call in multiple\r\n                // calls by increment of chunkSize with the original outputFormat\r\n                if (\r\n                  !allowGml &&\r\n                  dataSourceOptions.paramsWFS.version === '2.0.0' &&\r\n                  dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures\r\n                ) {\r\n                  const chunkSize = 1000;\r\n                  while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\r\n                    processingArray.push(\r\n                      this.wfsGetFeature(\r\n                        dataSourceOptions,\r\n                        chunkSize,\r\n                        dataSourceOptions.paramsWFS.srsName,\r\n                        fieldListWoGeomStr,\r\n                        startIndex\r\n                      )\r\n                    );\r\n                    startIndex += chunkSize;\r\n                  }\r\n                  effectiveOlFormats = olFormats;\r\n                } else {\r\n                  processingArray.push(\r\n                    this.wfsGetFeature(\r\n                      dataSourceOptions,\r\n                      dataSourceOptions.paramsWFS.maxFeatures ||\r\n                        defaultMaxFeatures,\r\n                      dataSourceOptions.paramsWFS.srsName,\r\n                      fieldListWoGeomStr,\r\n                      0,\r\n                      true\r\n                    )\r\n                  );\r\n                }\r\n                return combineLatest(processingArray);\r\n              })\r\n            );\r\n          })\r\n        )\r\n        .subscribe((results) => {\r\n          let mfeatures: olFeature<OlGeometry>[] = [];\r\n          results.map((result) => {\r\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\r\n            mfeatures = mfeatures.concat(loopFeatures);\r\n          });\r\n          this.built_properties_value(mfeatures).forEach((element) => {\r\n            sourceFields.push(element);\r\n          });\r\n          d.next(sourceFields);\r\n          d.complete();\r\n        });\r\n    });\r\n  }\r\n\r\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\r\n    if (features.length === 0) {\r\n      return [];\r\n    }\r\n    const kv = Object.assign({}, features[0].getProperties());\r\n    delete kv[features[0].getGeometryName()];\r\n    delete kv.boundedBy;\r\n    const sourceFields = [];\r\n    for (const property in kv) {\r\n      if (kv.hasOwnProperty(property)) {\r\n        const fieldType =\r\n          typeof features[0].get(property) === 'object'\r\n            ? undefined\r\n            : typeof features[0].get(property);\r\n        sourceFields.push({\r\n          name: property,\r\n          alias: property,\r\n          type: fieldType,\r\n          values: [kv[property]]\r\n        });\r\n      }\r\n    }\r\n    features.every((element) => {\r\n      const featureProperties = element.getProperties();\r\n      for (const key in featureProperties) {\r\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\r\n          sourceFields\r\n            .filter((f) => f.name === key)\r\n            .forEach((v) => {\r\n              if (v.values.indexOf(featureProperties[key]) === -1) {\r\n                v.values.push(featureProperties[key]);\r\n              }\r\n            });\r\n        }\r\n      }\r\n      return true;\r\n    });\r\n    return sourceFields;\r\n  }\r\n}\r\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import { ObjectUtils } from '@igo2/utils';\r\n\r\nimport olSourceImageWMS from 'ol/source/ImageWMS';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { TimeFilterOptions } from '../../../filter';\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\nimport {\r\n  OgcFilterDuringOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFiltersOptions\r\n} from '../../../filter/shared/ogc-filter.interface';\r\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/legend.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { WFSService } from './wfs.service';\r\nimport {\r\n  TimeFilterableDataSourceOptions,\r\n  WMSDataSourceOptions\r\n} from './wms-datasource.interface';\r\nimport {\r\n  checkWfsParams,\r\n  defaultFieldNameGeometry,\r\n  formatWFSQueryString\r\n} from './wms-wfs.utils';\r\n\r\nexport interface TimeFilterableDataSource extends WMSDataSource {\r\n  options: TimeFilterableDataSourceOptions;\r\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\r\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\r\n  filterByDate(date: Date | [Date, Date]);\r\n  filterByYear(year: string | [string, string]);\r\n}\r\n\r\nexport class WMSDataSource extends DataSource {\r\n  public declare ol: olSourceImageWMS;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  set ogcFilters(value: OgcFiltersOptions) {\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\r\n  }\r\n  get ogcFilters(): OgcFiltersOptions {\r\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n  }\r\n\r\n  set timeFilter(value: TimeFilterOptions) {\r\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\r\n  }\r\n  get timeFilter(): TimeFilterOptions {\r\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\r\n  }\r\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  constructor(\r\n    public options: WMSDataSourceOptions,\r\n    protected wfsService: WFSService\r\n  ) {\r\n    super(options);\r\n    const sourceParams: any = options.params;\r\n\r\n    const dpi = sourceParams.DPI || 96;\r\n    sourceParams.DPI = dpi;\r\n    sourceParams.MAP_RESOLUTION = dpi;\r\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\r\n\r\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\r\n      setInterval(() => {\r\n        this.refresh();\r\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\r\n    }\r\n\r\n    let fieldNameGeometry = defaultFieldNameGeometry;\r\n\r\n    // ####   START if paramsWFS\r\n    if (options.paramsWFS) {\r\n      const wfsCheckup = checkWfsParams(options, 'wms');\r\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\r\n\r\n      fieldNameGeometry =\r\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\r\n\r\n      options.download = Object.assign({}, options.download, {\r\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\r\n      });\r\n    } //  ####   END  if paramsWFS\r\n\r\n    if (!options.sourceFields || options.sourceFields.length === 0) {\r\n      options.sourceFields = [];\r\n    } else {\r\n      options.sourceFields.forEach((sourceField) => {\r\n        sourceField.alias = sourceField.alias\r\n          ? sourceField.alias\r\n          : sourceField.name;\r\n        // to allow only a list of sourcefield with names\r\n      });\r\n    }\r\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\r\n      .ogcFilters;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (!initOgcFilters) {\r\n      (options as OgcFilterableDataSourceOptions).ogcFilters =\r\n        ogcFilterWriter.defineOgcFiltersDefaultOptions(\r\n          initOgcFilters,\r\n          fieldNameGeometry,\r\n          'wms'\r\n        );\r\n    } else {\r\n      initOgcFilters.advancedOgcFilters =\r\n        initOgcFilters.pushButtons ||\r\n        initOgcFilters.checkboxes ||\r\n        initOgcFilters.radioButtons ||\r\n        initOgcFilters.select ||\r\n        initOgcFilters.autocomplete\r\n          ? false\r\n          : true;\r\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\r\n        const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\r\n        if (filterDuring.calendarModeYear) {\r\n          initOgcFilters.advancedOgcFilters = false;\r\n        }\r\n      }\r\n      if (initOgcFilters.pushButtons) {\r\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\r\n      }\r\n      if (initOgcFilters.checkboxes) {\r\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\r\n      }\r\n      if (initOgcFilters.radioButtons) {\r\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\r\n      }\r\n      if (initOgcFilters.select) {\r\n        initOgcFilters.select.selectorType = 'select';\r\n      }\r\n      if (initOgcFilters.autocomplete) {\r\n        initOgcFilters.autocomplete.selectorType = 'autocomplete';\r\n      }\r\n    }\r\n\r\n    if (\r\n      sourceParams.LAYERS.split(',').length > 1 &&\r\n      initOgcFilters &&\r\n      initOgcFilters.enabled\r\n    ) {\r\n      console.log('*******************************');\r\n      console.log(\r\n        'BE CAREFULL, YOUR WMS LAYERS (' +\r\n          sourceParams.LAYERS +\r\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\r\n      );\r\n      console.log('*******************************');\r\n    }\r\n\r\n    if (\r\n      options.paramsWFS &&\r\n      initOgcFilters &&\r\n      initOgcFilters.enabled &&\r\n      initOgcFilters.editable &&\r\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\r\n    ) {\r\n      this.wfsService.getSourceFieldsFromWFS(options);\r\n    }\r\n\r\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n      options,\r\n      fieldNameGeometry\r\n    );\r\n    sourceParams.FILTER = filterQueryString;\r\n    this.ol.updateParams({ FILTER: sourceParams.FILTER });\r\n    this.setOgcFilters(initOgcFilters, true);\r\n\r\n    const timeFilterableDataSourceOptions =\r\n      options as TimeFilterableDataSourceOptions;\r\n    if (\r\n      timeFilterableDataSourceOptions?.timeFilterable &&\r\n      timeFilterableDataSourceOptions?.timeFilter\r\n    ) {\r\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\r\n    }\r\n  }\r\n\r\n  refresh() {\r\n    this.ol.updateParams({ igoRefresh: Math.random() });\r\n  }\r\n\r\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\r\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\r\n    const downloadUrl = queryStringValues.find(\r\n      (f) => f.name === 'getfeature'\r\n    ).value;\r\n    return downloadUrl;\r\n  }\r\n\r\n  protected createOlSource(): olSourceImageWMS {\r\n    return new olSourceImageWMS(Object.assign({ ratio: 1 }, this.options));\r\n  }\r\n\r\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\r\n    this.ogcFilters = ogcFilters;\r\n    if (triggerEvent) {\r\n      this.ol.notify('ogcFilters', this.ogcFilters);\r\n    }\r\n  }\r\n\r\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\r\n    this.timeFilter = timeFilter;\r\n    if (triggerEvent) {\r\n      this.timeFilter$.next(this.timeFilter);\r\n      this.ol.notify('timeFilter', this.ogcFilters);\r\n    }\r\n  }\r\n\r\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\r\n    let legend = super.getLegend();\r\n    if (legend.length > 0 && style === undefined && !view?.scale) {\r\n      return legend;\r\n    }\r\n\r\n    let contentDependent = false;\r\n    let projParam;\r\n\r\n    if (\r\n      view?.size &&\r\n      view?.extent &&\r\n      view?.projection &&\r\n      this.options.contentDependentLegend\r\n    ) {\r\n      projParam =\r\n        this.params.VERSION === '1.3.0' || this.params.VERSION === undefined\r\n          ? 'CRS'\r\n          : 'SRS';\r\n      contentDependent = true;\r\n    }\r\n\r\n    const sourceParams = this.params;\r\n\r\n    let layers = [];\r\n    if (sourceParams.LAYERS !== undefined) {\r\n      layers = sourceParams.LAYERS.split(',');\r\n    }\r\n\r\n    const baseUrl = this.options.url.replace(/\\?$/, '');\r\n    const params = [\r\n      'REQUEST=GetLegendGraphic',\r\n      'SERVICE=WMS',\r\n      'FORMAT=image/png',\r\n      'SLD_VERSION=1.1.0',\r\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\r\n    ];\r\n    if (style !== undefined) {\r\n      params.push(`STYLE=${style}`);\r\n    }\r\n    if (view?.scale !== undefined) {\r\n      params.push(`SCALE=${view.scale}`);\r\n    }\r\n    if (contentDependent) {\r\n      params.push(`WIDTH=${view.size[0]}`);\r\n      params.push(`HEIGHT=${view.size[1]}`);\r\n      params.push(`BBOX=${view.extent.join(',')}`);\r\n      params.push(`${projParam}=${view.projection}`);\r\n    }\r\n\r\n    legend = layers.map((layer: string) => {\r\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\r\n      return {\r\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\r\n        title: layers.length > 1 ? layer : undefined,\r\n        currentStyle: style === undefined ? undefined : (style as string)\r\n      };\r\n    });\r\n\r\n    return legend;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n\r\nexport interface TimeFilterableDataSource extends WMSDataSource {\r\n  options: TimeFilterableDataSourceOptions;\r\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\r\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\r\n  filterByDate(date: Date | [Date, Date]);\r\n  filterByYear(year: string | [string, string]);\r\n}\r\n","import {\r\n  getTopLeft as extentGetTopLeft,\r\n  getWidth as extentGetWidth\r\n} from 'ol/extent.js';\r\nimport * as olproj from 'ol/proj';\r\nimport olTileGridWMTS from 'ol/tilegrid/WMTS';\r\n\r\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\r\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\r\n  const projectionExtent = projection.getExtent();\r\n  const size = extentGetWidth(projectionExtent) / 256;\r\n  const resolutions = new Array(20);\r\n  const matrixIds = new Array(20);\r\n  for (let z = 0; z < 20; ++z) {\r\n    resolutions[z] = size / Math.pow(2, z);\r\n    matrixIds[z] = z;\r\n  }\r\n\r\n  return new olTileGridWMTS({\r\n    origin: extentGetTopLeft(projectionExtent),\r\n    resolutions,\r\n    matrixIds\r\n  });\r\n}\r\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public declare options: WMTSDataSourceOptions;\n  public declare ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceCarto from 'ol/source/CartoDB';\r\n\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\n\r\nexport class CartoDataSource extends DataSource {\r\n  public declare ol: olSourceCarto;\r\n  public declare options: CartoDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): olSourceCarto {\r\n    const crossOrigin = this.options.crossOrigin\r\n      ? this.options.crossOrigin\r\n      : 'anonymous';\r\n    const sourceOptions = Object.assign(\r\n      {\r\n        crossOrigin\r\n      },\r\n      this.options\r\n    );\r\n    return new olSourceCarto(sourceOptions);\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legend = super.getLegend();\r\n    if (legend.length > 0) {\r\n      return legend;\r\n    }\r\n\r\n    let htmlString = '<table>';\r\n    if (this.options.config.layers[0].legend !== null) {\r\n      this.options.config.layers[0].legend.items.forEach((f) => {\r\n        if (f.visible === true) {\r\n          htmlString +=\r\n            '<tr><td>' +\r\n            '<p><font size=\"5\" color=\"' +\r\n            f.value +\r\n            '\"> &#9679</font></p></td>' +\r\n            '<td>' +\r\n            f.name +\r\n            '</td></tr>';\r\n        }\r\n      });\r\n      htmlString += '</table>';\r\n      return [{ html: htmlString }];\r\n    } else {\r\n      // Try to build the legend from the cartocss options\r\n      const layerOptions = this.options.config.layers[0].options;\r\n      // All available cartocss style options\r\n      const types = [\r\n        'polygon-fill:',\r\n        'marker-fill:',\r\n        'shield-fill:',\r\n        'building-fill:',\r\n        'line-color:'\r\n      ];\r\n      for (const oneType of types) {\r\n        if (layerOptions.cartocss.includes(oneType)) {\r\n          const type = layerOptions.cartocss.split(oneType).pop();\r\n          const color = type.substr(0, type.indexOf(';'));\r\n          if (color.includes('ramp')) {\r\n            const colors = color.split(', (')[1].split(',');\r\n            const data = color.split(', (')[2].split(',');\r\n            for (let j = 0; j < colors.length; j++) {\r\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\r\n              data[j] = data[j].replace(/(\"|\\))/g, '');\r\n              if (data[j].replace(/\\s+/g, '') === '=') {\r\n                data[j] = 'Autres';\r\n              }\r\n              htmlString +=\r\n                '<tr><td>' +\r\n                '<p><font size=\"5\" color=\"' +\r\n                colors[j] +\r\n                '\"> &#9679</font></p></td>' +\r\n                '<td>' +\r\n                data[j] +\r\n                '</td></tr>';\r\n            }\r\n            break;\r\n          } else {\r\n            const title = layerOptions.layer_name\r\n              ? layerOptions.layer_name\r\n              : '';\r\n            htmlString +=\r\n              '<tr><td>' +\r\n              '<p><font size=\"5\" color=\"' +\r\n              color +\r\n              '\"> &#9679</font></p>' +\r\n              '</td><td>' +\r\n              title +\r\n              '</td></tr>';\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      htmlString += '</table>';\r\n      return [{ html: htmlString }];\r\n    }\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olFormatEsriJSON from 'ol/format/EsriJSON';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olloadingstrategy from 'ol/loadingstrategy';\r\nimport olSourceVector from 'ol/source/Vector';\r\n\r\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\n\r\nexport class ArcGISRestDataSource extends DataSource {\r\n  public declare ol: olSourceVector<OlGeometry>;\r\n  public declare options: ArcGISRestDataSourceOptions;\r\n\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    const esrijsonFormat = new olFormatEsriJSON();\r\n    return new olSourceVector({\r\n      attributions: this.options.params.attributions,\r\n      overlaps: false,\r\n      format: esrijsonFormat,\r\n      url: function (extent, resolution, proj) {\r\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\r\n        const geometry = encodeURIComponent(\r\n          '{\"xmin\":' +\r\n            extent[0] +\r\n            ',\"ymin\":' +\r\n            extent[1] +\r\n            ',\"xmax\":' +\r\n            extent[2] +\r\n            ',\"ymax\":' +\r\n            extent[3] +\r\n            ',\"spatialReference\":{\"wkid\":102100}}'\r\n        );\r\n        const params = [\r\n          'f=json',\r\n          `geometry=${geometry}`,\r\n          'geometryType=esriGeometryEnvelope',\r\n          'inSR=102100',\r\n          'spatialRel=esriSpatialRelIntersects',\r\n          'outFields=*',\r\n          'returnGeometry=true',\r\n          'outSR=102100'\r\n        ];\r\n        if (this.options.params.time) {\r\n          const time = `time=${this.options.params.time}`;\r\n          params.push(time);\r\n        }\r\n        if (this.options.params.customParams) {\r\n          this.options.params.customParams.forEach((element) => {\r\n            params.push(element);\r\n          });\r\n        }\r\n        return `${baseUrl}?${params.join('&')}`;\r\n      }.bind(this),\r\n      strategy: olloadingstrategy.bbox\r\n    });\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (legendInfo === undefined || legend.length > 0) {\r\n      return legend;\r\n    }\r\n    if (!legendInfo) {\r\n      return;\r\n    }\r\n    let htmlString = '<table>';\r\n    let src: string;\r\n    let label: string;\r\n    let svg: string;\r\n\r\n    if (legendInfo.legend) {\r\n      for (const legendElement of legendInfo.legend) {\r\n        src = this.htmlImgSrc(\r\n          legendElement.contentType,\r\n          legendElement.imageData\r\n        );\r\n        label = legendElement.label\r\n          ? legendElement.label.replace('<Null>', 'Null')\r\n          : '';\r\n        htmlString +=\r\n          `<tr><td align='left'><img src=\"` +\r\n          src +\r\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n          label +\r\n          '</td></tr>';\r\n      }\r\n    } else if (legendInfo.type === 'uniqueValue') {\r\n      for (const legendElement of legendInfo.uniqueValueInfos) {\r\n        label = legendElement.label.replace('<Null>', 'Null');\r\n        if (legendElement.symbol.type === 'esriPMS') {\r\n          src = this.htmlImgSrc(\r\n            legendElement.symbol.contentType,\r\n            legendElement.symbol.imageData\r\n          );\r\n          htmlString +=\r\n            `<tr><td align='left'><img src=\"` +\r\n            src +\r\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n            label +\r\n            '</td></tr>';\r\n        } else if (legendElement.symbol.type !== 'esriPMS') {\r\n          svg = this.createSVG(legendElement.symbol);\r\n          htmlString +=\r\n            `<tr><td align='left'>` +\r\n            svg +\r\n            `</td><td class=\"mat-typography\">` +\r\n            label +\r\n            '</td></tr>';\r\n        }\r\n      }\r\n    } else if (legendInfo.type === 'simple') {\r\n      label = legendInfo.label\r\n        ? legendInfo.label.replace('<Null>', 'Null')\r\n        : '';\r\n      if (legendInfo.symbol.type === 'esriPMS') {\r\n        src = this.htmlImgSrc(\r\n          legendInfo.symbol.contentType,\r\n          legendInfo.symbol.imageData\r\n        );\r\n        htmlString +=\r\n          `<tr><td align='left'><img src=\"` +\r\n          src +\r\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n          label +\r\n          '</td></tr>';\r\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\r\n        svg = this.createSVG(legendInfo.symbol);\r\n        htmlString +=\r\n          `<tr><td align='left'>` +\r\n          svg +\r\n          `</td><td class=\"mat-typography\">` +\r\n          label +\r\n          '</td></tr>';\r\n      }\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  htmlImgSrc(contentType: string, imageData: string): string {\r\n    return `data:${contentType};base64,${imageData}`;\r\n  }\r\n\r\n  createSVG(symbol): string {\r\n    let svg: string = '';\r\n\r\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\r\n\r\n    if (symbol.type === 'esriSLS') {\r\n      const width: number = symbol.width ? symbol.width : 0;\r\n\r\n      const stroke: string =\r\n        `stroke:rgba(` +\r\n        color[0] +\r\n        ',' +\r\n        color[1] +\r\n        ',' +\r\n        color[2] +\r\n        ',' +\r\n        color[3] +\r\n        ')';\r\n      const strokeWidth: string = `stroke-width:` + width;\r\n\r\n      if (symbol.style === 'esriSLSSolid') {\r\n        svg =\r\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\r\n          stroke +\r\n          ';' +\r\n          strokeWidth +\r\n          `\"/></svg>`;\r\n      } else if (symbol.style === 'esriSLSDash') {\r\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\r\n        svg =\r\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\r\n          stroke +\r\n          ';' +\r\n          strokeWidth +\r\n          `\" ` +\r\n          strokeDashArray +\r\n          `/></svg>`;\r\n      }\r\n    } else if (\r\n      symbol.style === 'esriSMSCircle' ||\r\n      symbol.style === 'esriSFSSolid'\r\n    ) {\r\n      const outlineColor = symbol.outline.color;\r\n      const outlineWidth = symbol.outline.width;\r\n      const size = symbol.size;\r\n\r\n      const stroke =\r\n        `stroke:rgba(` +\r\n        outlineColor[0] +\r\n        ',' +\r\n        outlineColor[1] +\r\n        ',' +\r\n        outlineColor[2] +\r\n        ',' +\r\n        outlineColor[3] +\r\n        ')';\r\n      const strokeWidth = `stroke-width:` + outlineWidth;\r\n      const fill =\r\n        `fill:rgba(` +\r\n        color[0] +\r\n        ',' +\r\n        color[1] +\r\n        ',' +\r\n        color[2] +\r\n        ',' +\r\n        color[3] +\r\n        ')';\r\n\r\n      if (symbol.style === 'esriSMSCircle') {\r\n        svg =\r\n          `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` +\r\n          size / 2 +\r\n          `\" style=\"` +\r\n          stroke +\r\n          ';' +\r\n          strokeWidth +\r\n          ';' +\r\n          fill +\r\n          `\"/></svg>`;\r\n      } else {\r\n        svg =\r\n          `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` +\r\n          stroke +\r\n          ';' +\r\n          strokeWidth +\r\n          ';' +\r\n          fill +\r\n          `\"/></svg>`;\r\n      }\r\n    }\r\n    return svg;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\r\n\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\r\n\r\nexport class ImageArcGISRestDataSource extends DataSource {\r\n  public declare ol: ImageArcGISRest;\r\n  public declare options: ArcGISRestImageDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): ImageArcGISRest {\r\n    const params =\r\n      this.options.layer === undefined\r\n        ? this.options.params\r\n        : Object.assign(\r\n            { LAYERS: `show:${this.options.layer}` },\r\n            this.options.params\r\n          );\r\n\r\n    if (typeof params.renderingRule === 'object') {\r\n      params.renderingRule = JSON.stringify(params.renderingRule);\r\n    }\r\n\r\n    return new ImageArcGISRest({\r\n      ratio: 1,\r\n      params,\r\n      url: this.options.url\r\n    });\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (\r\n      legendInfo === undefined ||\r\n      this.options.layer === undefined ||\r\n      legend.length > 0\r\n    ) {\r\n      return legend;\r\n    }\r\n\r\n    if (!legendInfo) {\r\n      return;\r\n    }\r\n    let htmlString = '<table>';\r\n\r\n    for (const legendElement of legendInfo.legend) {\r\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\r\n      const label = legendElement.label.replace('<Null>', 'Null');\r\n      htmlString +=\r\n        `<tr><td align='left'><img src=\"` +\r\n        src +\r\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n        label +\r\n        '</td></tr>';\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\r\nimport { Options } from 'ol/source/TileArcGISRest';\r\n\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\r\n\r\nexport class TileArcGISRestDataSource extends DataSource {\r\n  public declare ol: olSourceTileArcGISRest;\r\n  public declare options: TileArcGISRestDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): olSourceTileArcGISRest {\r\n    return new olSourceTileArcGISRest(this.options as Options);\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (\r\n      legendInfo === undefined ||\r\n      this.options.layer === undefined ||\r\n      legend.length > 0\r\n    ) {\r\n      return legend;\r\n    }\r\n\r\n    if (!legendInfo) {\r\n      return;\r\n    }\r\n    let htmlString = '<table>';\r\n\r\n    for (const legendElement of legendInfo.legend) {\r\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\r\n      const label = legendElement.label.replace('<Null>', 'Null');\r\n      htmlString +=\r\n        `<tr><td align='left'><img src=\"` +\r\n        src +\r\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\r\n        label +\r\n        '</td></tr>';\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public declare options: TileDebugDataSourceOptions;\n  public declare ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olSourceVector from 'ol/source/Vector';\r\n\r\nimport { FeatureDataSource } from './feature-datasource';\r\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\r\n\r\nexport class WebSocketDataSource extends FeatureDataSource {\r\n  public ws: WebSocket;\r\n  public declare options: WebSocketDataSourceOptions;\r\n\r\n  protected createOlSource(): olSourceVector<OlGeometry> {\r\n    this.createWebSocket();\r\n    this.options.format = this.getSourceFormatFromOptions(this.options);\r\n    return super.createOlSource();\r\n  }\r\n\r\n  private createWebSocket() {\r\n    this.ws = new WebSocket(this.options.url);\r\n    this.ws.onmessage = this.onMessage.bind(this);\r\n\r\n    if (this.options.onclose) {\r\n      this.ws.onclose = this.onClose.bind(this);\r\n    }\r\n\r\n    if (this.options.onerror) {\r\n      this.ws.onerror = this.onError.bind(this);\r\n    }\r\n\r\n    if (this.options.onopen) {\r\n      this.ws.onopen = this.onOpen.bind(this);\r\n    }\r\n  }\r\n\r\n  onMessage(event) {\r\n    const featureAdded = this.options.format.readFeature(\r\n      event.data\r\n    ) as olFeature<OlGeometry>;\r\n\r\n    switch (this.options.onmessage) {\r\n      case 'update':\r\n        // ol don't add if same ID\r\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\r\n        if (featureToRemove) {\r\n          this.ol.removeFeature(featureToRemove);\r\n        }\r\n        this.ol.addFeature(featureAdded);\r\n        break;\r\n      case 'delete':\r\n        this.ol.clear(true);\r\n        this.ol.addFeature(featureAdded);\r\n        break;\r\n      case 'add':\r\n      default:\r\n        this.ol.addFeature(featureAdded);\r\n    }\r\n  }\r\n\r\n  onClose(event) {\r\n    // thrown message to user\r\n  }\r\n\r\n  onError(event) {\r\n    // thrown message to user\r\n  }\r\n\r\n  onOpen(event) {\r\n    // thrown message to user ?\r\n  }\r\n\r\n  public onUnwatch() {\r\n    this.ws.close();\r\n  }\r\n}\r\n","import { uuid } from '@igo2/utils';\r\n\r\nimport feature from 'ol/Feature';\r\nimport olFormatMVT from 'ol/format/MVT';\r\nimport olSourceVectorTile from 'ol/source/VectorTile';\r\n\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\r\n\r\nexport class MVTDataSource extends DataSource {\r\n  public declare options: MVTDataSourceOptions;\r\n  public declare ol: olSourceVectorTile;\r\n\r\n  protected createOlSource(): olSourceVectorTile {\r\n    let mvtFormat;\r\n    if (this.options.featureClass === 'feature') {\r\n      mvtFormat = new olFormatMVT({ featureClass: feature });\r\n    } else {\r\n      mvtFormat = new olFormatMVT();\r\n    }\r\n    this.options.format = mvtFormat;\r\n    return new olSourceVectorTile(this.options);\r\n  }\r\n\r\n  protected generateId() {\r\n    if (!this.options.url) {\r\n      return uuid();\r\n    }\r\n    const chain = 'mvt' + this.options.url;\r\n    return Md5.hashStr(chain) as string;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport * as olproj from 'ol/proj';\r\nimport * as olproj4 from 'ol/proj/proj4';\r\n\r\nimport proj4 from 'proj4';\r\n\r\nimport { Projection } from './projection.interfaces';\r\n\r\n/**\r\n * When injected, this service automatically registers and\r\n * projection defined in the application config. A custom projection\r\n * needs to be registered to be usable by OL.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ProjectionService {\r\n  constructor(private config: ConfigService) {\r\n    const projections: Projection[] =\r\n      this.config.getConfig('projections') || [];\r\n    projections.forEach((projection) => {\r\n      projection.alias = projection.alias ? projection.alias : projection.code;\r\n      this.registerProjection(projection);\r\n    });\r\n\r\n    // register all utm zones\r\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\r\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\r\n      const proj: Projection = { code, def, extent: undefined };\r\n      this.registerProjection(proj);\r\n    }\r\n\r\n    // register all mtm zones\r\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\r\n      const code =\r\n        mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n      let lon0;\r\n      if (Number(mtmZone) <= 2) {\r\n        lon0 = -50 - Number(mtmZone) * 3;\r\n      } else if (Number(mtmZone) >= 12) {\r\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\r\n      } else {\r\n        lon0 = -49.5 - Number(mtmZone) * 3;\r\n      }\r\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\r\n      const proj: Projection = { code, def, extent: undefined };\r\n      this.registerProjection(proj);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define a proj4 projection and register it in OL\r\n   * @param projection Projection\r\n   */\r\n  registerProjection(projection: Projection) {\r\n    proj4.defs(projection.code, projection.def);\r\n    olproj4.register(proj4);\r\n    if (projection.extent) {\r\n      olproj.get(projection.code).setExtent(projection.extent);\r\n    }\r\n  }\r\n}\r\n","export enum TimeFilterType {\n  DATE = 'date',\n  TIME = 'time',\n  DATETIME = 'datetime',\n  YEAR = 'year'\n}\n\nexport enum TimeFilterStyle {\n  CALENDAR = 'calendar',\n  SLIDER = 'slider'\n}\n","import * as olproj from 'ol/proj';\r\nimport * as olstyle from 'ol/style';\r\n\r\nexport class EsriStyleGenerator {\r\n  public _converters: any;\r\n  public _renderers: any;\r\n\r\n  constructor() {\r\n    this._converters = {};\r\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\r\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\r\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\r\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\r\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\r\n    this._renderers = {};\r\n    this._renderers.uniqueValue = this._renderUniqueValue;\r\n    this._renderers.simple = this._renderSimple;\r\n    this._renderers.classBreaks = this._renderClassBreaks;\r\n  }\r\n  static _convertPointToPixel(point) {\r\n    return point / 0.75;\r\n  }\r\n  static _transformColor(color): [number, number, number, number] {\r\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\r\n    return [color[0], color[1], color[2], color[3] / 255];\r\n  }\r\n\r\n  static _getResolutionForScale(scale, units) {\r\n    const dpi = 96;\r\n    const mpu = olproj.METERS_PER_UNIT[units];\r\n    const inchesPerMeter = 39.3701;\r\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\r\n  }\r\n\r\n  /* convert an Esri Text Symbol */\r\n  static _convertEsriTS(symbol) {\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n    const text = symbol.text !== undefined ? symbol.text : undefined;\r\n    return new olstyle.Style({\r\n      text: new olstyle.Text({\r\n        fill: new olstyle.Fill({\r\n          color: EsriStyleGenerator._transformColor(symbol.color)\r\n        }),\r\n        font:\r\n          symbol.font.style +\r\n          ' ' +\r\n          symbol.font.weight +\r\n          ' ' +\r\n          symbol.font.size +\r\n          ' px ' +\r\n          symbol.font.family,\r\n        textBaseline: symbol.verticalAlignment,\r\n        textAlign: symbol.horizontalAlignment,\r\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\r\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\r\n        rotation,\r\n        text\r\n      })\r\n    });\r\n  }\r\n  /* convert an Esri Picture Marker Symbol */\r\n  static _convertEsriPMS(symbol) {\r\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n\r\n    return new olstyle.Style({\r\n      image: new olstyle.Icon({\r\n        src,\r\n        rotation\r\n      })\r\n    });\r\n  }\r\n  /* convert an Esri Simple Fill Symbol */\r\n  static _convertEsriSFS(symbol) {\r\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\r\n    const fill = new olstyle.Fill({\r\n      color: EsriStyleGenerator._transformColor(symbol.color)\r\n    });\r\n    const stroke = symbol.outline\r\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\r\n      : undefined;\r\n    return new olstyle.Style({\r\n      fill,\r\n      stroke\r\n    });\r\n  }\r\n  static _convertOutline(outline) {\r\n    let lineDash;\r\n    const color = EsriStyleGenerator._transformColor(outline.color);\r\n    if (outline.style === 'esriSLSDash') {\r\n      lineDash = [5];\r\n    } else if (outline.style === 'esriSLSDashDot') {\r\n      lineDash = [5, 5, 1, 2];\r\n    } else if (outline.style === 'esriSLSDashDotDot') {\r\n      lineDash = [5, 5, 1, 2, 1, 2];\r\n    } else if (outline.style === 'esriSLSDot') {\r\n      lineDash = [1, 2];\r\n    } else if (outline.style === 'esriSLSNull') {\r\n      // line not visible, make color fully transparent\r\n      color[3] = 0;\r\n    }\r\n    return new olstyle.Stroke({\r\n      color,\r\n      lineDash,\r\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\r\n    });\r\n  }\r\n  /* convert an Esri Simple Line Symbol */\r\n  static _convertEsriSLS(symbol) {\r\n    return new olstyle.Style({\r\n      stroke: EsriStyleGenerator._convertOutline(symbol)\r\n    });\r\n  }\r\n  static _transformAngle(angle) {\r\n    if (angle === 0 || angle === undefined) {\r\n      return undefined;\r\n    }\r\n    const normalRad = (angle * Math.PI) / 180;\r\n    const ol3Rad = -normalRad + Math.PI / 2;\r\n    if (ol3Rad < 0) {\r\n      return 2 * Math.PI + ol3Rad;\r\n    } else {\r\n      return ol3Rad;\r\n    }\r\n  }\r\n  /* convert an Esri Simple Marker Symbol */\r\n  static _convertEsriSMS(symbol) {\r\n    const fill = new olstyle.Fill({\r\n      color: EsriStyleGenerator._transformColor(symbol.color)\r\n    });\r\n    const stroke = symbol.outline\r\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\r\n      : undefined;\r\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n    if (symbol.style === 'esriSMSCircle') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.Circle({\r\n          radius,\r\n          fill,\r\n          stroke\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSCross') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          radius2: 0,\r\n          angle: 0,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSDiamond') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSSquare') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          angle: Math.PI / 4,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSX') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          radius2: 0,\r\n          angle: Math.PI / 4,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSTriangle') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 3,\r\n          radius,\r\n          angle: 0,\r\n          rotation\r\n        })\r\n      });\r\n    }\r\n  }\r\n\r\n  _convertLabelingInfo(labelingInfo, mapUnits) {\r\n    const styles = [];\r\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\r\n      const labelExpression = labelingInfo[i].labelExpression;\r\n      // only limited support for label expressions\r\n      const field = labelExpression.substr(\r\n        labelExpression.indexOf('[') + 1,\r\n        labelExpression.indexOf(']') - 1\r\n      );\r\n      const symbol = labelingInfo[i].symbol;\r\n      const maxScale = labelingInfo[i].maxScale;\r\n      const minScale = labelingInfo[i].minScale;\r\n      let minResolution = null;\r\n      if (maxScale !== 0) {\r\n        minResolution = EsriStyleGenerator._getResolutionForScale(\r\n          maxScale,\r\n          mapUnits\r\n        );\r\n      }\r\n      let maxResolution = null;\r\n      if (minScale !== 0) {\r\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\r\n          minScale,\r\n          mapUnits\r\n        );\r\n      }\r\n      const style = this._converters[symbol.type].call(this, symbol);\r\n      styles.push(\r\n        (() => {\r\n          return function (feature, resolution) {\r\n            let visible = true;\r\n            if (this.minResolution !== null && this.maxResolution !== null) {\r\n              visible =\r\n                resolution < this.maxResolution &&\r\n                resolution >= this.minResolution;\r\n            } else if (this.minResolution !== null) {\r\n              visible = resolution >= this.minResolution;\r\n            } else if (this.maxResolution !== null) {\r\n              visible = resolution < this.maxResolution;\r\n            }\r\n            if (visible) {\r\n              const value = feature.get(this.field);\r\n              this.style.getText().setText(value);\r\n              return [this.style];\r\n            }\r\n          };\r\n        })().bind({\r\n          minResolution,\r\n          maxResolution,\r\n          field,\r\n          style\r\n        })\r\n      );\r\n    }\r\n    return styles;\r\n  }\r\n\r\n  _renderSimple(renderer) {\r\n    const style = this._converters[renderer.symbol.type].call(\r\n      this,\r\n      renderer.symbol\r\n    );\r\n    return (() => {\r\n      return () => {\r\n        return [style];\r\n      };\r\n    })();\r\n  }\r\n  _renderClassBreaks(renderer) {\r\n    const defaultSymbol = renderer.defaultSymbol;\r\n    const defaultStyle = this._converters[defaultSymbol.type].call(\r\n      this,\r\n      defaultSymbol\r\n    );\r\n    const field = renderer.field;\r\n    const classes = [];\r\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\r\n      const classBreakInfo = renderer.classBreakInfos[i];\r\n      let min;\r\n      if (\r\n        classBreakInfo.classMinValue === null ||\r\n        classBreakInfo.classMinValue === undefined\r\n      ) {\r\n        if (i === 0) {\r\n          min = renderer.minValue;\r\n        } else {\r\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\r\n        }\r\n      } else {\r\n        min = classBreakInfo.classMinValue;\r\n      }\r\n      const max = classBreakInfo.classMaxValue;\r\n      const symbol = classBreakInfo.symbol;\r\n      const style = this._converters[symbol.type].call(this, symbol);\r\n      classes.push({ min, max, style });\r\n    }\r\n    return (() => {\r\n      return (feature) => {\r\n        const value = feature.get(field);\r\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\r\n          let condition;\r\n          if (i === 0) {\r\n            condition = value >= classes[i].min && value <= classes[i].max;\r\n          } else {\r\n            condition = value > classes[i].min && value <= classes[i].max;\r\n          }\r\n          if (condition) {\r\n            return [classes[i].style];\r\n          }\r\n        }\r\n        return [defaultStyle];\r\n      };\r\n    })();\r\n  }\r\n  _renderUniqueValue(renderer) {\r\n    const defaultSymbol = renderer.defaultSymbol;\r\n    let defaultStyle = [];\r\n    if (defaultSymbol) {\r\n      defaultStyle = [\r\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\r\n      ];\r\n    }\r\n    const field = renderer.field1;\r\n    const infos = renderer.uniqueValueInfos;\r\n    const me = this;\r\n    return (() => {\r\n      const hash = {};\r\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\r\n        const info = infos[i];\r\n        const symbol = info.symbol;\r\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\r\n      }\r\n\r\n      return (feature) => {\r\n        const style = hash[feature.get(field)];\r\n        return style ? style : defaultStyle;\r\n      };\r\n    })();\r\n  }\r\n  generateStyle(layerInfo, mapUnits) {\r\n    const drawingInfo = layerInfo.drawingInfo;\r\n    let styleFunctions = [];\r\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\r\n      this,\r\n      drawingInfo.renderer\r\n    );\r\n    if (drawingInfoStyle !== undefined) {\r\n      styleFunctions.push(drawingInfoStyle);\r\n    }\r\n    if (layerInfo.labelingInfo) {\r\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\r\n        layerInfo.labelingInfo,\r\n        mapUnits\r\n      );\r\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\r\n    }\r\n    if (styleFunctions.length === 1) {\r\n      return styleFunctions[0];\r\n    } else {\r\n      return (() => {\r\n        return (feature, resolution) => {\r\n          let styles = [];\r\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\r\n            const result = styleFunctions[i].call(null, feature, resolution);\r\n            if (result) {\r\n              styles = styles.concat(result);\r\n            }\r\n          }\r\n          return styles;\r\n        };\r\n      })();\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport olAttribution from 'ol/control/Attribution';\r\nimport { EsriJSON, WMSCapabilities, WMTSCapabilities } from 'ol/format';\r\nimport * as olproj from 'ol/proj';\r\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\r\n\r\nimport { Observable, forkJoin, of } from 'rxjs';\r\nimport { catchError, map } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport {\r\n  TimeFilterStyle,\r\n  TimeFilterType\r\n} from '../../filter/shared/time-filter.enum';\r\nimport {\r\n  ItemStyleOptions,\r\n  LegendOptions\r\n} from '../../layer/shared/layers/legend.interface';\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\r\nimport {\r\n  QueryFormat,\r\n  QueryFormatMimeType\r\n} from '../../query/shared/query.enums';\r\nimport { EsriStyleGenerator } from '../../style/shared/datasource/esri-style-generator';\r\nimport {\r\n  ArcGISRestDataSourceOptions,\r\n  ArcGISRestImageDataSourceOptions,\r\n  CartoDataSourceOptions,\r\n  TileArcGISRestDataSourceOptions,\r\n  WMSDataSourceOptions,\r\n  WMTSDataSourceOptions\r\n} from './datasources';\r\n\r\nexport enum TypeCapabilities {\r\n  wms = 'wms',\r\n  wmts = 'wmts',\r\n  arcgisrest = 'esriJSON',\r\n  imagearcgisrest = 'esriJSON',\r\n  tilearcgisrest = 'esriJSON'\r\n}\r\n\r\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CapabilitiesService {\r\n  private parsers = {\r\n    wms: new WMSCapabilities(),\r\n    wmts: new WMTSCapabilities(),\r\n    esriJSON: new EsriJSON()\r\n  };\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private mapService: MapService\r\n  ) {}\r\n\r\n  getWMSOptions(\r\n    baseOptions: WMSDataSourceOptions\r\n  ): Observable<WMSDataSourceOptions> {\r\n    const url = baseOptions.url;\r\n    const version = (baseOptions.params as any).VERSION;\r\n\r\n    return this.getCapabilities('wms', url, version).pipe(\r\n      map((capabilities: any) => {\r\n        return capabilities\r\n          ? this.parseWMSOptions(baseOptions, capabilities)\r\n          : undefined;\r\n      })\r\n    );\r\n  }\r\n\r\n  getWMTSOptions(\r\n    baseOptions: WMTSDataSourceOptions\r\n  ): Observable<WMTSDataSourceOptions> {\r\n    const url = baseOptions.url;\r\n    const version = baseOptions.version;\r\n\r\n    const options = this.getCapabilities('wmts', url, version).pipe(\r\n      map((capabilities: any) => {\r\n        return capabilities\r\n          ? this.parseWMTSOptions(baseOptions, capabilities)\r\n          : undefined;\r\n      })\r\n    );\r\n    return options;\r\n  }\r\n\r\n  getCartoOptions(\r\n    baseOptions: CartoDataSourceOptions\r\n  ): Observable<CartoDataSourceOptions> {\r\n    const baseUrl =\r\n      'https://' +\r\n      baseOptions.account +\r\n      '.carto.com/api/v2/viz/' +\r\n      baseOptions.mapId +\r\n      '/viz.json';\r\n\r\n    return this.http\r\n      .jsonp(baseUrl, 'callback')\r\n      .pipe(\r\n        map((cartoOptions: any) =>\r\n          this.parseCartoOptions(baseOptions, cartoOptions)\r\n        )\r\n      );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getArcgisOptions(\r\n    baseOptions: ArcGISRestDataSourceOptions\r\n  ): Observable<ArcGISRestDataSourceOptions> {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const serviceCapabilities = this.getCapabilities(\r\n      'arcgisrest',\r\n      baseOptions.url\r\n    );\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    return forkJoin([arcgisOptions, serviceCapabilities]).pipe(\r\n      map((res: any) => {\r\n        return this.parseArcgisOptions(baseOptions, res[0], res[1]);\r\n      })\r\n    );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getImageArcgisOptions(\r\n    baseOptions:\r\n      | ArcGISRestImageDataSourceOptions\r\n      | TileArcGISRestDataSourceOptions\r\n  ): Observable<\r\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\r\n  > {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const legendUrl = baseOptions.url + '/legend?f=json';\r\n    const serviceCapabilities = this.getCapabilities(\r\n      'imagearcgisrest',\r\n      baseOptions.url\r\n    );\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    const legend = this.http.get(legendUrl).pipe(\r\n      map((res: any) => res),\r\n      catchError((err) => {\r\n        console.log('No legend associated with this Image Service');\r\n        return of(err);\r\n      })\r\n    );\r\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\r\n      map((res: any) => {\r\n        return this.parseTileOrImageArcgisOptions(\r\n          baseOptions,\r\n          res[0],\r\n          res[1],\r\n          res[2]\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getTileArcgisOptions(\r\n    baseOptions: TileArcGISRestDataSourceOptions\r\n  ): Observable<\r\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\r\n  > {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const legendUrl = baseOptions.url + '/legend?f=json';\r\n    const serviceCapabilities = this.getCapabilities(\r\n      'tilearcgisrest',\r\n      baseOptions.url\r\n    );\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    const legendInfo = this.http.get(legendUrl).pipe(\r\n      map((res: any) => res),\r\n      catchError((err) => {\r\n        console.log('No legend associated with this Tile Service');\r\n        return of(err);\r\n      })\r\n    );\r\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\r\n      map((res: any) =>\r\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\r\n      )\r\n    );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getCapabilities(\r\n    service: TypeCapabilitiesStrings,\r\n    baseUrl: string,\r\n    version?: string\r\n  ): Observable<any> {\r\n    const params = new HttpParams({\r\n      fromObject: {\r\n        request: 'GetCapabilities',\r\n        service: service.toUpperCase(),\r\n        version: version || '1.3.0',\r\n        _i: 'true'\r\n      }\r\n    });\r\n\r\n    let request;\r\n    if (TypeCapabilities[service] === 'esriJSON') {\r\n      request = this.http.get(baseUrl + '?f=json');\r\n    } else {\r\n      request = this.http.get(baseUrl, {\r\n        params,\r\n        responseType: 'text'\r\n      });\r\n    }\r\n\r\n    return request.pipe(\r\n      map((res) => {\r\n        if (TypeCapabilities[service] === 'esriJSON') {\r\n          return res as object;\r\n        }\r\n        if (\r\n          String(res).toLowerCase().includes('serviceexception') &&\r\n          String(res).toLowerCase().includes('access denied')\r\n        ) {\r\n          throw {\r\n            error: {\r\n              message: 'Service error getCapabilities: Access is denied'\r\n            }\r\n          };\r\n        } else {\r\n          return this.parsers[service].read(res);\r\n        }\r\n      }),\r\n      catchError((e) => {\r\n        if (typeof e.error !== 'undefined') {\r\n          e.error.caught = true;\r\n        }\r\n        throw e;\r\n      })\r\n    );\r\n  }\r\n\r\n  private parseWMSOptions(\r\n    baseOptions: WMSDataSourceOptions,\r\n    capabilities: any\r\n  ): WMSDataSourceOptions {\r\n    const layers = (baseOptions.params as any).LAYERS;\r\n    const layer = this.findDataSourceInCapabilities(\r\n      capabilities.Capability.Layer,\r\n      layers\r\n    );\r\n\r\n    if (!layer) {\r\n      throw {\r\n        error: {\r\n          message: 'Layer not found'\r\n        }\r\n      };\r\n    }\r\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\r\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\r\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\r\n    let queryable = layer.queryable;\r\n    const timeFilter = this.getTimeFilter(layer);\r\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\r\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\r\n    let isExtentInGeographic = true;\r\n    if (layer.EX_GeographicBoundingBox) {\r\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\r\n        if (index < 2 && (coord > 180 || coord < -180)) {\r\n          isExtentInGeographic = false;\r\n        }\r\n        if (index >= 2 && (coord > 90 || coord < -90)) {\r\n          isExtentInGeographic = false;\r\n        }\r\n      });\r\n    } else {\r\n      isExtentInGeographic = false;\r\n    }\r\n\r\n    const extent = isExtentInGeographic\r\n      ? olproj.transformExtent(\r\n          layer.EX_GeographicBoundingBox,\r\n          'EPSG:4326',\r\n          this.mapService.getMap().projection\r\n        )\r\n      : undefined;\r\n\r\n    let queryFormat: QueryFormat;\r\n    const queryFormatMimeTypePriority = [\r\n      QueryFormatMimeType.GEOJSON,\r\n      QueryFormatMimeType.GEOJSON2,\r\n      QueryFormatMimeType.GML3,\r\n      QueryFormatMimeType.GML2,\r\n      QueryFormatMimeType.JSON,\r\n      QueryFormatMimeType.HTML\r\n    ];\r\n\r\n    for (const mimeType of queryFormatMimeTypePriority) {\r\n      if (\r\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\r\n          mimeType\r\n        ) !== -1\r\n      ) {\r\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\r\n          (key) => QueryFormatMimeType[key] === mimeType\r\n        );\r\n        queryFormat = QueryFormat[keyEnum];\r\n        break;\r\n      }\r\n    }\r\n    if (!queryFormat) {\r\n      queryable = false;\r\n    }\r\n\r\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\r\n      _layerOptionsFromSource: {\r\n        title: layer.Title,\r\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\r\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\r\n        extent,\r\n        metadata: {\r\n          url: metadata ? metadata.OnlineResource : undefined,\r\n          extern: metadata ? true : undefined,\r\n          abstract,\r\n          keywordList\r\n        },\r\n        legendOptions\r\n      },\r\n      queryable,\r\n      queryFormat,\r\n      timeFilter: timeFilterable ? timeFilter : undefined,\r\n      timeFilterable: timeFilterable ? true : undefined,\r\n      minDate: timeFilterable ? timeFilter.min : undefined,\r\n      maxDate: timeFilterable ? timeFilter.max : undefined,\r\n      stepDate: timeFilterable ? timeFilter.step : undefined\r\n    });\r\n\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseWMTSOptions(\r\n    baseOptions: WMTSDataSourceOptions,\r\n    capabilities: any\r\n  ): WMTSDataSourceOptions {\r\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\r\n    const layer = capabilities.Contents.Layer.find(\r\n      (el) => el.Identifier === baseOptions.layer\r\n    );\r\n\r\n    const options = optionsFromCapabilities(capabilities, baseOptions);\r\n\r\n    const ouputOptions = Object.assign(options, baseOptions);\r\n    const sourceOptions = ObjectUtils.removeUndefined({\r\n      _layerOptionsFromSource: {\r\n        title: layer.Title\r\n      }\r\n    });\r\n\r\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\r\n  }\r\n\r\n  private parseCartoOptions(\r\n    baseOptions: CartoDataSourceOptions,\r\n    cartoOptions: any\r\n  ): CartoDataSourceOptions {\r\n    const layers = [];\r\n    const params = cartoOptions.layers[1].options.layer_definition;\r\n    params.layers.forEach((element) => {\r\n      layers.push({\r\n        type: element.type.toLowerCase(),\r\n        options: element.options,\r\n        legend: element.legend\r\n      });\r\n    });\r\n    const options = ObjectUtils.removeUndefined({\r\n      config: {\r\n        version: params.version,\r\n        layers\r\n      }\r\n    });\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseArcgisOptions(\r\n    baseOptions: ArcGISRestDataSourceOptions,\r\n    arcgisOptions: any,\r\n    serviceCapabilities: any\r\n  ): ArcGISRestDataSourceOptions {\r\n    const title = arcgisOptions.name;\r\n    let legendInfo: any;\r\n\r\n    if (arcgisOptions.drawingInfo?.renderer) {\r\n      legendInfo = arcgisOptions.drawingInfo.renderer;\r\n    } else {\r\n      legendInfo = undefined;\r\n    }\r\n\r\n    let style;\r\n    if (arcgisOptions.drawingInfo) {\r\n      const styleGenerator = new EsriStyleGenerator();\r\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\r\n      style = styleGenerator.generateStyle(arcgisOptions, units);\r\n    }\r\n    const attributions = new olAttribution({\r\n      target: arcgisOptions.copyrightText\r\n    });\r\n    let timeExtent;\r\n    let timeFilter;\r\n    if (arcgisOptions.timeInfo) {\r\n      const time = arcgisOptions.timeInfo.timeExtent;\r\n      timeExtent = time[0] + ',' + time[1];\r\n      const min = new Date();\r\n      min.setTime(time[0]);\r\n      const max = new Date();\r\n      max.setTime(time[1]);\r\n      timeFilter = {\r\n        min: min.toUTCString(),\r\n        max: max.toUTCString(),\r\n        range: true,\r\n        type: TimeFilterType.DATETIME,\r\n        style: TimeFilterStyle.CALENDAR\r\n      };\r\n    }\r\n    const params = Object.assign(\r\n      {},\r\n      {\r\n        style,\r\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\r\n        time: timeExtent\r\n      }\r\n    );\r\n    const options = ObjectUtils.removeUndefined({\r\n      params,\r\n      _layerOptionsFromSource: {\r\n        title,\r\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\r\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\r\n        metadata: {\r\n          extern: false,\r\n          abstract:\r\n            arcgisOptions.description || serviceCapabilities.serviceDescription\r\n        }\r\n      },\r\n      legendInfo,\r\n      timeFilter,\r\n      sourceFields: arcgisOptions.fields,\r\n      queryTitle: arcgisOptions.displayField\r\n    });\r\n    options.attributions = attributions;\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseTileOrImageArcgisOptions(\r\n    baseOptions:\r\n      | TileArcGISRestDataSourceOptions\r\n      | ArcGISRestImageDataSourceOptions,\r\n    arcgisOptions: any,\r\n    legend: any,\r\n    serviceCapabilities: any\r\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\r\n    const title = arcgisOptions.name;\r\n    const legendInfo = legend.layers\r\n      ? legend.layers.find((x) => x.layerName === title)\r\n      : undefined;\r\n    const attributions = new olAttribution({\r\n      target: arcgisOptions.copyrightText\r\n    });\r\n    let timeExtent;\r\n    let timeFilter;\r\n    if (arcgisOptions.timeInfo) {\r\n      const time = arcgisOptions.timeInfo.timeExtent;\r\n      timeExtent = time[0] + ',' + time[1];\r\n      const min = new Date();\r\n      min.setTime(time[0]);\r\n      const max = new Date();\r\n      max.setTime(time[1]);\r\n      timeFilter = {\r\n        min: min.toUTCString(),\r\n        max: max.toUTCString(),\r\n        range: true,\r\n        type: TimeFilterType.DATETIME,\r\n        style: TimeFilterStyle.CALENDAR\r\n      };\r\n    }\r\n    const params = Object.assign(\r\n      {},\r\n      {\r\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\r\n        time: timeExtent\r\n      }\r\n    );\r\n    const options = ObjectUtils.removeUndefined({\r\n      params,\r\n      _layerOptionsFromSource: {\r\n        title,\r\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\r\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\r\n        metadata: {\r\n          extern: false,\r\n          abstract:\r\n            arcgisOptions.description || serviceCapabilities.serviceDescription\r\n        }\r\n      },\r\n      legendInfo,\r\n      timeFilter,\r\n      sourceFields: arcgisOptions.fields,\r\n      queryTitle: arcgisOptions.displayField\r\n    });\r\n    options.attributions = attributions;\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private findDataSourceInCapabilities(layerArray, name): any {\r\n    if (Array.isArray(layerArray)) {\r\n      let layer;\r\n      layerArray.find((value) => {\r\n        layer = this.findDataSourceInCapabilities(value, name);\r\n        return layer !== undefined;\r\n      }, this);\r\n\r\n      return layer;\r\n    } else if (layerArray.Layer) {\r\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\r\n    } else {\r\n      if (layerArray.Name && layerArray.Name === name) {\r\n        return layerArray;\r\n      }\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  getTimeFilter(layer) {\r\n    let dimension;\r\n\r\n    if (layer.Dimension) {\r\n      const timeFilter: any = {};\r\n      dimension = layer.Dimension[0];\r\n\r\n      if (dimension.values) {\r\n        const minMaxDim = dimension.values.split('/');\r\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\r\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\r\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\r\n      }\r\n\r\n      if (dimension.default) {\r\n        timeFilter.value = dimension.default;\r\n      }\r\n      return timeFilter;\r\n    }\r\n  }\r\n\r\n  getStyle(Style): LegendOptions {\r\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\r\n      return {\r\n        name: style.Name,\r\n        title: style.Title\r\n      };\r\n    })\r\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\r\n      .filter(\r\n        (item, index, self) =>\r\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\r\n          index\r\n      );\r\n\r\n    const legendOptions: LegendOptions = {\r\n      stylesAvailable: styleOptions\r\n    } as LegendOptions;\r\n\r\n    return legendOptions;\r\n  }\r\n}\r\n","import { Observable } from 'rxjs';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\n\nexport abstract class OptionsService {\n  abstract getWMSOptions(\n    _baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions>;\n  abstract getArcgisRestOptions(\n    _baseOptions:\n      | ArcGISRestDataSourceOptions\n      | ArcGISRestImageDataSourceOptions\n      | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<\n    | ArcGISRestDataSourceOptions\n    | ArcGISRestImageDataSourceOptions\n    | TileArcGISRestDataSourceOptions\n  >;\n}\n","import { Injectable, Optional } from '@angular/core';\r\n\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { BehaviorSubject, Observable, forkJoin, of } from 'rxjs';\r\nimport { catchError, map } from 'rxjs/operators';\r\n\r\nimport { ProjectionService } from '../../map/shared/projection.service';\r\nimport { CapabilitiesService } from './capabilities.service';\r\nimport {\r\n  AnyDataSourceOptions,\r\n  ArcGISRestDataSource,\r\n  ArcGISRestDataSourceOptions,\r\n  ArcGISRestImageDataSourceOptions,\r\n  CartoDataSource,\r\n  CartoDataSourceOptions,\r\n  ClusterDataSource,\r\n  ClusterDataSourceOptions,\r\n  DataSource,\r\n  FeatureDataSource,\r\n  FeatureDataSourceOptions,\r\n  ImageArcGISRestDataSource,\r\n  MVTDataSource,\r\n  MVTDataSourceOptions,\r\n  OSMDataSource,\r\n  OSMDataSourceOptions,\r\n  TileArcGISRestDataSource,\r\n  TileArcGISRestDataSourceOptions,\r\n  TileDebugDataSource,\r\n  TileDebugDataSourceOptions,\r\n  WFSDataSource,\r\n  WFSDataSourceOptions,\r\n  WMSDataSource,\r\n  WMSDataSourceOptions,\r\n  WMTSDataSource,\r\n  WMTSDataSourceOptions,\r\n  WebSocketDataSource,\r\n  XYZDataSource,\r\n  XYZDataSourceOptions\r\n} from './datasources';\r\nimport { WFSService } from './datasources/wfs.service';\r\nimport { OptionsService } from './options/options.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DataSourceService {\r\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    @Optional() private optionsService: OptionsService,\r\n    private wfsDataSourceService: WFSService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private projectionService: ProjectionService,\r\n    private authInterceptor?: AuthInterceptor\r\n  ) {}\r\n\r\n  createAsyncDataSource(\r\n    context: AnyDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<DataSource> {\r\n    if (!context.type) {\r\n      console.error(context);\r\n      throw new Error('Datasource needs a type');\r\n    }\r\n    let dataSource;\r\n    switch (context.type.toLowerCase()) {\r\n      case 'osm':\r\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\r\n        break;\r\n      case 'vector':\r\n        dataSource = this.createFeatureDataSource(\r\n          context as FeatureDataSourceOptions\r\n        );\r\n        break;\r\n      case 'wfs':\r\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\r\n        break;\r\n      case 'wms':\r\n        const wmsContext = context as WMSDataSourceOptions;\r\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\r\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\r\n        break;\r\n      case 'wmts':\r\n        dataSource = this.createWMTSDataSource(\r\n          context as WMTSDataSourceOptions\r\n        );\r\n        break;\r\n      case 'xyz':\r\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\r\n        break;\r\n      case 'tiledebug':\r\n        dataSource = this.createTileDebugDataSource(\r\n          context as TileDebugDataSource\r\n        );\r\n        break;\r\n      case 'carto':\r\n        dataSource = this.createCartoDataSource(\r\n          context as CartoDataSourceOptions\r\n        );\r\n        break;\r\n      case 'arcgisrest':\r\n        dataSource = this.createArcGISRestDataSource(\r\n          context as ArcGISRestDataSourceOptions,\r\n          detailedContextUri\r\n        );\r\n        break;\r\n      case 'imagearcgisrest':\r\n        dataSource = this.createArcGISRestImageDataSource(\r\n          context as ArcGISRestImageDataSourceOptions,\r\n          detailedContextUri\r\n        );\r\n        break;\r\n      case 'websocket':\r\n        dataSource = this.createWebSocketDataSource(\r\n          context as FeatureDataSourceOptions\r\n        );\r\n        break;\r\n      case 'mvt':\r\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\r\n        break;\r\n      case 'tilearcgisrest':\r\n        dataSource = this.createTileArcGISRestDataSource(\r\n          context as TileArcGISRestDataSourceOptions,\r\n          detailedContextUri\r\n        );\r\n        break;\r\n      case 'cluster':\r\n        dataSource = this.createClusterDataSource(\r\n          context as ClusterDataSourceOptions\r\n        );\r\n        break;\r\n      default:\r\n        console.error(context);\r\n        throw new Error('Invalid datasource type');\r\n    }\r\n\r\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\r\n\r\n    return dataSource;\r\n  }\r\n\r\n  private createOSMDataSource(\r\n    context: OSMDataSourceOptions\r\n  ): Observable<OSMDataSource> {\r\n    return new Observable((d) => d.next(new OSMDataSource(context)));\r\n  }\r\n\r\n  private createFeatureDataSource(\r\n    context: FeatureDataSourceOptions\r\n  ): Observable<FeatureDataSource> {\r\n    return new Observable((d) => d.next(new FeatureDataSource(context)));\r\n  }\r\n\r\n  private createWebSocketDataSource(\r\n    context: FeatureDataSourceOptions\r\n  ): Observable<WebSocketDataSource> {\r\n    return new Observable((d) => d.next(new WebSocketDataSource(context)));\r\n  }\r\n\r\n  private createWFSDataSource(\r\n    context: WFSDataSourceOptions\r\n  ): Observable<WFSDataSource> {\r\n    return new Observable((d) =>\r\n      d.next(\r\n        new WFSDataSource(\r\n          context,\r\n          this.wfsDataSourceService,\r\n          this.authInterceptor\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  private createWMSDataSource(\r\n    context: WMSDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<any> {\r\n    const observables = [];\r\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\r\n      observables.push(\r\n        this.capabilitiesService.getWMSOptions(context).pipe(\r\n          catchError((e) => {\r\n            this.messageService.error(\r\n              'igo.geo.dataSource.unavailable',\r\n              'igo.geo.dataSource.unavailableTitle',\r\n              undefined,\r\n              { value: context.params.LAYERS }\r\n            );\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n\r\n    if (\r\n      this.optionsService &&\r\n      context.optionsFromApi &&\r\n      window.navigator.onLine\r\n    ) {\r\n      observables.push(\r\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\r\n          catchError((e) => {\r\n            e.error.toDisplay = true;\r\n            e.error.title = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailableTitle'\r\n            );\r\n            e.error.message = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.optionsApiUnavailable'\r\n            );\r\n            return of({});\r\n          })\r\n        )\r\n      );\r\n    }\r\n\r\n    observables.push(of(context));\r\n\r\n    return forkJoin(observables).pipe(\r\n      map((options: WMSDataSourceOptions[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createWMTSDataSource(\r\n    context: WMTSDataSourceOptions\r\n  ): Observable<WMTSDataSource> {\r\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\r\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\r\n        map((options: WMTSDataSourceOptions) => {\r\n          return options ? new WMTSDataSource(options) : undefined;\r\n        }),\r\n        catchError(() => {\r\n          this.messageService.error(\r\n            'igo.geo.dataSource.unavailable',\r\n            'igo.geo.dataSource.unavailableTitle',\r\n            undefined,\r\n            { value: context.layer }\r\n          );\r\n          return of(undefined);\r\n        })\r\n      );\r\n    }\r\n\r\n    return new Observable((d) => d.next(new WMTSDataSource(context)));\r\n  }\r\n\r\n  private createXYZDataSource(\r\n    context: XYZDataSourceOptions\r\n  ): Observable<XYZDataSource> {\r\n    return new Observable((d) => d.next(new XYZDataSource(context)));\r\n  }\r\n\r\n  private createTileDebugDataSource(\r\n    context: TileDebugDataSourceOptions\r\n  ): Observable<TileDebugDataSource> {\r\n    return new Observable((d) => d.next(new TileDebugDataSource(context)));\r\n  }\r\n\r\n  private createCartoDataSource(\r\n    context: CartoDataSourceOptions\r\n  ): Observable<CartoDataSource> {\r\n    if (context.mapId) {\r\n      return this.capabilitiesService\r\n        .getCartoOptions(context)\r\n        .pipe(\r\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\r\n        );\r\n    }\r\n    return new Observable((d) => d.next(new CartoDataSource(context)));\r\n  }\r\n\r\n  private createArcGISRestDataSource(\r\n    context: ArcGISRestDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<ArcGISRestDataSource> {\r\n    const observables = [];\r\n    if (window.navigator.onLine) {\r\n      observables.push(\r\n        this.capabilitiesService.getArcgisOptions(context).pipe(\r\n          catchError((e) => {\r\n            this.messageService.error(\r\n              'igo.geo.dataSource.unavailable',\r\n              'igo.geo.dataSource.unavailableTitle',\r\n              undefined,\r\n              { value: context.layer }\r\n            );\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n    if (\r\n      this.optionsService &&\r\n      context.optionsFromApi &&\r\n      window.navigator.onLine\r\n    ) {\r\n      observables.push(\r\n        this.optionsService\r\n          .getArcgisRestOptions(context, detailedContextUri)\r\n          .pipe(\r\n            catchError((e) => {\r\n              e.error.toDisplay = true;\r\n              e.error.title = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.unavailableTitle'\r\n              );\r\n              e.error.message = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.optionsApiUnavailable'\r\n              );\r\n              return of({});\r\n            })\r\n          )\r\n      );\r\n    }\r\n    observables.push(of(context));\r\n    return forkJoin(observables).pipe(\r\n      map((options: ArcGISRestDataSource[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new ArcGISRestDataSource(optionsMerged);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createArcGISRestImageDataSource(\r\n    context: ArcGISRestImageDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<ArcGISRestImageDataSourceOptions> {\r\n    const observables = [];\r\n\r\n    if (window.navigator.onLine) {\r\n      observables.push(\r\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\r\n          catchError((e) => {\r\n            this.messageService.error(\r\n              'igo.geo.dataSource.unavailable',\r\n              'igo.geo.dataSource.unavailableTitle',\r\n              undefined,\r\n              { value: context.params.LAYERS }\r\n            );\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n    if (\r\n      this.optionsService &&\r\n      context.optionsFromApi &&\r\n      window.navigator.onLine\r\n    ) {\r\n      observables.push(\r\n        this.optionsService\r\n          .getArcgisRestOptions(context, detailedContextUri)\r\n          .pipe(\r\n            catchError((e) => {\r\n              e.error.toDisplay = true;\r\n              e.error.title = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.unavailableTitle'\r\n              );\r\n              e.error.message = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.optionsApiUnavailable'\r\n              );\r\n              return of({});\r\n            })\r\n          )\r\n      );\r\n    }\r\n    observables.push(of(context));\r\n    return forkJoin(observables).pipe(\r\n      map((options: ImageArcGISRestDataSource[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new ImageArcGISRestDataSource(optionsMerged);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createTileArcGISRestDataSource(\r\n    context: TileArcGISRestDataSourceOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<TileArcGISRestDataSource> {\r\n    const observables = [];\r\n    if (window.navigator.onLine) {\r\n      observables.push(\r\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\r\n          catchError((e) => {\r\n            this.messageService.error(\r\n              'igo.geo.dataSource.unavailable',\r\n              'igo.geo.dataSource.unavailableTitle',\r\n              undefined,\r\n              { value: context.params.LAYERS }\r\n            );\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n    if (\r\n      this.optionsService &&\r\n      context.optionsFromApi &&\r\n      window.navigator.onLine\r\n    ) {\r\n      observables.push(\r\n        this.optionsService\r\n          .getArcgisRestOptions(context, detailedContextUri)\r\n          .pipe(\r\n            catchError((e) => {\r\n              e.error.toDisplay = true;\r\n              e.error.title = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.unavailableTitle'\r\n              );\r\n              e.error.message = this.languageService.translate.instant(\r\n                'igo.geo.dataSource.optionsApiUnavailable'\r\n              );\r\n              return of({});\r\n            })\r\n          )\r\n      );\r\n    }\r\n    observables.push(of(context));\r\n    return forkJoin(observables).pipe(\r\n      map((options: TileArcGISRestDataSource[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new TileArcGISRestDataSource(optionsMerged);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createMVTDataSource(\r\n    context: MVTDataSourceOptions\r\n  ): Observable<MVTDataSource> {\r\n    return new Observable((d) => d.next(new MVTDataSource(context)));\r\n  }\r\n\r\n  private createClusterDataSource(\r\n    context: ClusterDataSourceOptions\r\n  ): Observable<ClusterDataSource> {\r\n    return new Observable((d) => d.next(new ClusterDataSource(context)));\r\n  }\r\n}\r\n","import { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureStore } from './store';\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n","import { EntityKey, EntityStoreWithStrategy, getEntityId } from '@igo2/common';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport * as olextent from 'ol/extent';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { Document } from 'flexsearch';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { IgoMap, MapExtent } from '../../map/shared';\r\nimport { FeatureMotion } from './feature.enums';\r\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\r\nimport {\r\n  computeOlFeaturesDiff,\r\n  computeOlFeaturesExtent,\r\n  featureFromOl,\r\n  featureToOl,\r\n  moveToOlFeatures\r\n} from './feature.utils';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * features and the map layer to display them on. Synchronization\r\n * between the store and the layer is handled by strategies.\r\n */\r\nexport class FeatureStore<\r\n  T extends Feature = Feature\r\n> extends EntityStoreWithStrategy<T> {\r\n  /**\r\n   * Vector layer to display the features on\r\n   */\r\n  layer: VectorLayer;\r\n\r\n  /**\r\n   * The map the layer is bound to\r\n   */\r\n  readonly map: IgoMap;\r\n\r\n  /**\r\n   * The layer's data source\r\n   */\r\n  get source(): FeatureDataSource {\r\n    return this.layer\r\n      ? (this.layer.dataSource as FeatureDataSource)\r\n      : undefined;\r\n  }\r\n\r\n  /**\r\n   * The searchable index of loaded feature. Computed if strategy is provided\r\n   */\r\n  set searchDocument(v: Document<T>) {\r\n    this._searchDocument = v;\r\n  }\r\n\r\n  get searchDocument(): Document<T> {\r\n    return this._searchDocument;\r\n  }\r\n  private _searchDocument: Document<T>;\r\n\r\n  constructor(entities: T[], options: FeatureStoreOptions) {\r\n    super(entities, options);\r\n    this.map = options.map;\r\n  }\r\n\r\n  /**\r\n   * Bind this store to a vector layer\r\n   * @param layer Vector layer\r\n   * @returns Feature store\r\n   */\r\n  bindLayer(layer: VectorLayer): FeatureStore {\r\n    this.layer = layer;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set the layer's features and perform a motion to make them visible. Strategies\r\n   * make extensive use of that method.\r\n   * @param features Features\r\n   * @param motion Optional: The type of motion to perform\r\n   */\r\n  setLayerFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    viewScale?: [number, number, number, number],\r\n    areaRatio?: number,\r\n    getId?: (Feature) => EntityKey\r\n  ) {\r\n    getId = getId ? getId : getEntityId;\r\n    this.checkLayer();\r\n\r\n    const olFeatures = features.map((feature: Feature) =>\r\n      featureToOl(feature, this.map.projection, getId)\r\n    );\r\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\r\n  }\r\n\r\n  /**\r\n   * Set the store's features from an array of OL features.\r\n   * @param olFeatures Ol features\r\n   */\r\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\r\n    this.checkLayer();\r\n\r\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      olFeature.set('_featureStore', this, true);\r\n      return featureFromOl(olFeature, this.layer.map.projection);\r\n    });\r\n    this.load(features as T[]);\r\n  }\r\n\r\n  /**\r\n   * Remove all features from the layer\r\n   */\r\n  clearLayer() {\r\n    this.checkLayer();\r\n    this.source.ol.clear();\r\n  }\r\n\r\n  /**\r\n   * Check wether a layer is bound or not and throw an error if not.\r\n   */\r\n  private checkLayer() {\r\n    if (this.layer === undefined) {\r\n      throw new Error('This FeatureStore is not bound to a layer.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the layer's features and perform a motion to make them visible.\r\n   * @param features Openlayers feature objects\r\n   * @param motion Optional: The type of motion to perform\r\n   */\r\n  public setLayerOlFeatures(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    viewScale?: [number, number, number, number],\r\n    areaRatio?: number\r\n  ) {\r\n    const olSource = this.layer.ol.getSource();\r\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\r\n    if (diff.remove.length > 0) {\r\n      this.removeOlFeaturesFromLayer(diff.remove);\r\n    }\r\n\r\n    if (diff.add.length > 0) {\r\n      this.addOlFeaturesToLayer(diff.add);\r\n    }\r\n\r\n    if (diff.add.length > 0) {\r\n      // If features are added, do a motion toward the newly added features\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        diff.add,\r\n        motion,\r\n        viewScale,\r\n        areaRatio\r\n      );\r\n    } else if (diff.remove.length > 0) {\r\n      // Else, do a motion toward all the features\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        olFeatures,\r\n        motion,\r\n        viewScale,\r\n        areaRatio\r\n      );\r\n    }\r\n  }\r\n\r\n  setLayerExtent(): void {\r\n    let features = this.entities$.getValue();\r\n    let extent = olextent.createEmpty() as MapExtent;\r\n    let olFeatures = [];\r\n\r\n    features.forEach((feature) => {\r\n      olFeatures.push(featureToOl(feature, this.map.projection));\r\n    });\r\n    const featuresExtent = computeOlFeaturesExtent(\r\n      olFeatures,\r\n      this.map.viewProjection\r\n    );\r\n    olextent.extend(extent, featuresExtent);\r\n    this.layer.setExtent(extent);\r\n  }\r\n  /**\r\n   * Add features to the the layer\r\n   * @param features Openlayers feature objects\r\n   */\r\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\r\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n      olFeature.set('_featureStore', this, true);\r\n    });\r\n    this.source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  /**\r\n   * Remove features from the the layer\r\n   * @param features Openlayers feature objects\r\n   */\r\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\r\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n      this.source.ol.removeFeature(olFeature);\r\n    });\r\n  }\r\n}\r\n","import { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime, skipWhile } from 'rxjs/operators';\r\n\r\nimport { FeatureStoreInMapExtentStrategyOptions } from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\n/**\r\n * This strategy maintain the store features updated while the map is moved.\r\n * The features's state inside the map are tagged inMapExtent = true;\r\n */\r\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n  private states$$: Subscription[] = [];\r\n  private empty$$: Subscription;\r\n\r\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n    this.empty$$ = store.empty$\r\n      .pipe(skipWhile((empty) => !empty))\r\n      .subscribe(() => this.updateEntitiesInExtent(store));\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.updateEntitiesInExtent(store);\r\n    this.states$$.push(\r\n      store.layer.map.viewController.state$\r\n        .pipe(debounceTime(250))\r\n        .subscribe(() => this.updateEntitiesInExtent(store))\r\n    );\r\n  }\r\n\r\n  private updateEntitiesInExtent(store: FeatureStore) {\r\n    if (store?.layer?.map?.viewController) {\r\n      store.state.updateAll({ inMapExtent: false });\r\n      const mapExtent = store.layer.map.viewController.getExtent();\r\n      let entitiesInMapExtent = store.layer.ol\r\n        .getSource()\r\n        .getFeaturesInExtent(mapExtent)\r\n        .map((f) => store.get(f.getId()));\r\n      if (entitiesInMapExtent) {\r\n        store.state.updateMany(\r\n          entitiesInMapExtent,\r\n          { inMapExtent: true },\r\n          false\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    this.stores$$.clear();\r\n    this.states$$.map((state) => state.unsubscribe());\r\n    if (this.empty$$) {\r\n      this.empty$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { Subscription, debounceTime } from 'rxjs';\r\n\r\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\n/**\r\n * This strategy maintain the store features updated while the map is scrolled.\r\n * The features's state inside the map's resolution are tagged inMapResolution = true;\r\n */\r\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n  private resolution$$: Subscription[] = [];\r\n  private empty$$: Subscription;\r\n\r\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n    this.empty$$ = store.empty$.subscribe(() =>\r\n      this.updateEntitiesInResolution(\r\n        store,\r\n        store.layer.map.viewController.getResolution()\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.updateEntitiesInResolution(\r\n      store,\r\n      store.layer.map.viewController.getResolution()\r\n    );\r\n    this.resolution$$.push(\r\n      store.layer.map.viewController.resolution$\r\n        .pipe(debounceTime(250))\r\n        .subscribe((res) => {\r\n          this.updateEntitiesInResolution(store, res);\r\n        })\r\n    );\r\n  }\r\n\r\n  private updateEntitiesInResolution(store, mapResolution: number) {\r\n    if (\r\n      mapResolution > store.layer.minResolution &&\r\n      mapResolution < store.layer.maxResolution\r\n    ) {\r\n      store.state.updateAll({ inMapResolution: true });\r\n    } else {\r\n      store.state.updateAll({ inMapResolution: false });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    this.stores$$.clear();\r\n    this.resolution$$.map((state) => state.unsubscribe());\r\n    if (this.empty$$) {\r\n      this.empty$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { EntityStoreStrategy } from '@igo2/common';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { Subscription, debounceTime, pairwise } from 'rxjs';\r\n\r\nimport { CapabilitiesService } from '../../../datasource/shared/capabilities.service';\r\nimport { Layer } from '../../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../../map/shared/map';\r\nimport { GeoServiceDefinition } from '../../../utils';\r\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\r\nimport { PropertyTypeDetectorService } from '../../../utils/propertyTypeDetector/propertyTypeDetector.service';\r\nimport {\r\n  Feature,\r\n  FeatureStorePropertyTypeStrategyOptions\r\n} from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\n/**\r\n * This strategy maintain the store features updated to detect geoproperties\r\n * (wms/arcgis... layer and url).\r\n * The features's state inside the map are tagged haveGeoServiceProperties = true;\r\n */\r\nexport class GeoPropertiesStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n  private states$$: Subscription[] = [];\r\n  private empty$$: Subscription;\r\n\r\n  /**\r\n   * The map the layer is bound to\r\n   */\r\n  private readonly map: IgoMap;\r\n\r\n  constructor(\r\n    protected options: FeatureStorePropertyTypeStrategyOptions,\r\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {\r\n    super(options);\r\n    this.map = options.map;\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.updateEntitiesPropertiesState(store);\r\n    this.states$$.push(\r\n      this.map.layers$\r\n        .pipe(debounceTime(250), pairwise())\r\n        .subscribe(([prevLayers, currentLayers]) => {\r\n          let prevLayersId;\r\n          if (prevLayers) {\r\n            prevLayersId = prevLayers.map((l) => l.id);\r\n          }\r\n          const layers = currentLayers.filter(\r\n            (l) => !prevLayersId.includes(l.id)\r\n          );\r\n          this.updateEntitiesPropertiesState(store, layers);\r\n        })\r\n    );\r\n    this.states$$.push(\r\n      store.entities$.pipe(debounceTime(250)).subscribe((a) => {\r\n        this.updateEntitiesPropertiesState(store);\r\n      })\r\n    );\r\n  }\r\n\r\n  private updateEntitiesPropertiesState(store: FeatureStore, layers?: Layer[]) {\r\n    const layersId = this.map.layers.map((l) => l.id);\r\n    let entities: Feature[] = [];\r\n    if (layers) {\r\n      entities = store.entities$.value;\r\n    } else {\r\n      const allSV = store.stateView.all();\r\n      entities = allSV.length\r\n        ? store.stateView\r\n            .all()\r\n            .filter((s) => !s.state.geoService)\r\n            .map((e) => e.entity)\r\n        : store.entities$.value;\r\n    }\r\n    const sampling = entities.length >= 250 ? 250 : entities.length;\r\n    const firstN = entities.slice(0, sampling);\r\n    let allKeys = [];\r\n    firstN.map((e) => {\r\n      allKeys = allKeys.concat(Object.keys(e.properties || {}));\r\n    });\r\n    allKeys = [...new Set(allKeys)];\r\n    const distinctValues = {};\r\n    allKeys.map((k) => {\r\n      distinctValues[k] = [\r\n        ...new Set(entities.map((item) => item.properties[k]))\r\n      ];\r\n    });\r\n    const containGeoServices = {};\r\n    Object.entries(distinctValues).forEach((entry: [string, []]) => {\r\n      const [key, values] = entry;\r\n      const valuedAreGeoservices = values.filter((value) =>\r\n        this.propertyTypeDetectorService.isGeoService(value)\r\n      );\r\n      if (valuedAreGeoservices?.length) {\r\n        containGeoServices[key] = valuedAreGeoservices;\r\n      }\r\n    });\r\n    interface GeoServiceAssociation {\r\n      url: string;\r\n      layerNameProperty: string;\r\n      urlProperty: string;\r\n      geoService: GeoServiceDefinition;\r\n    }\r\n    const geoServiceAssociations: GeoServiceAssociation[] = [];\r\n    Object.entries(containGeoServices).forEach((entry: [string, []]) => {\r\n      const [key, values] = entry;\r\n      values.map((value) => {\r\n        const geoService = this.propertyTypeDetectorService.getGeoService(\r\n          value,\r\n          allKeys\r\n        );\r\n        if (geoService) {\r\n          const propertiesForLayerName = allKeys.filter((p) =>\r\n            geoService.propertiesForLayerName.includes(p)\r\n          );\r\n          // providing the the first matching regex;\r\n          const propertyForLayerName = propertiesForLayerName.length\r\n            ? propertiesForLayerName[0]\r\n            : undefined;\r\n          if (propertyForLayerName) {\r\n            geoServiceAssociations.push({\r\n              url: value,\r\n              urlProperty: key,\r\n              layerNameProperty: propertyForLayerName,\r\n              geoService\r\n            });\r\n          }\r\n        }\r\n      });\r\n    });\r\n    const geoServiceStates: {\r\n      geoServiceAssociation: GeoServiceAssociation;\r\n      state: any;\r\n    }[] = [];\r\n    geoServiceAssociations.map((geoServiceAssociation) => {\r\n      const url = geoServiceAssociation.url;\r\n      const type = geoServiceAssociation.geoService.type || 'wms';\r\n      distinctValues[geoServiceAssociation.layerNameProperty].map(\r\n        (layerName) => {\r\n          let appliedLayerName = layerName;\r\n          let arcgisLayerName = undefined;\r\n          if (\r\n            ['arcgisrest', 'imagearcgisrest', 'tilearcgisrest'].includes(type)\r\n          ) {\r\n            appliedLayerName = undefined;\r\n            arcgisLayerName = layerName;\r\n          }\r\n          const so = ObjectUtils.removeUndefined({\r\n            sourceOptions: {\r\n              type: type || 'wms',\r\n              url,\r\n              optionsFromCapabilities: true,\r\n              optionsFromApi: true,\r\n              params: {\r\n                LAYERS: appliedLayerName,\r\n                LAYER: arcgisLayerName\r\n              }\r\n            }\r\n          });\r\n          const potentialLayerId = generateIdFromSourceOptions(\r\n            so.sourceOptions\r\n          );\r\n          geoServiceStates.push({\r\n            geoServiceAssociation,\r\n            state: {\r\n              added: layersId.find((l) => l === potentialLayerId) !== undefined,\r\n              haveGeoServiceProperties: true,\r\n              type,\r\n              url,\r\n              layerName\r\n            }\r\n          });\r\n        }\r\n      );\r\n    });\r\n    geoServiceStates.map((geoServiceState) => {\r\n      const urlProperty = geoServiceState.geoServiceAssociation.urlProperty;\r\n      const layerNameProperty =\r\n        geoServiceState.geoServiceAssociation.layerNameProperty;\r\n\r\n      const urlValue = geoServiceState.state.url;\r\n      const layerNameValue = geoServiceState.state.layerName;\r\n      const entitiesToProcess = entities.filter(\r\n        (e) =>\r\n          e.properties[urlProperty] === urlValue &&\r\n          e.properties[layerNameProperty] === layerNameValue\r\n      );\r\n      const ns = {\r\n        geoService: geoServiceState.state\r\n      };\r\n      store.state.updateMany(entitiesToProcess, ns, true);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    this.stores$$.clear();\r\n    this.states$$.map((state) => state.unsubscribe());\r\n    if (this.empty$$) {\r\n      this.empty$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { FeatureMotion } from '../feature.enums';\r\nimport {\r\n  Feature,\r\n  FeatureStoreLoadingStrategyOptions\r\n} from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\n/**\r\n * This strategy loads a store's features into it's layer counterpart.\r\n * The store -> layer binding is a one-way binding. That means any entity\r\n * added to the store will be added to the layer but the opposite is false.\r\n *\r\n * Important: This strategy observes filtered entities, not raw entities. This\r\n * is not configurable yet.\r\n */\r\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's features\r\n   */\r\n  private stores$$ = new Map<FeatureStore, Subscription>();\r\n\r\n  private motion: FeatureMotion;\r\n\r\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\r\n    super(options);\r\n    this.setMotion(options.motion);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define the motion to apply on load\r\n   * @param motion Feature motion\r\n   */\r\n  setMotion(motion: FeatureMotion) {\r\n    this.motion = motion;\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for entities changes in a store.\r\n   * Important: Never observe a store's sorted entities. It makes no sense\r\n   * to display sorted entities (instead of unsorted) on a layer and it\r\n   * would potentially result in a lot of useless computation.\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    const subscription = store.view\r\n      .all$()\r\n      .subscribe((features: Feature[]) =>\r\n        this.onFeaturesChange(features, store)\r\n      );\r\n    this.stores$$.set(store, subscription);\r\n  }\r\n\r\n  /**\r\n   * Stop watching for entities changes in a store.\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const subscription = this.stores$$.get(store);\r\n    if (subscription !== undefined) {\r\n      subscription.unsubscribe();\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for entities changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach(\r\n      (entries: [FeatureStore, Subscription]) => {\r\n        entries[1].unsubscribe();\r\n      }\r\n    );\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Load features into a layer or clear the layer if the array of features is empty.\r\n   * @param features Store filtered features\r\n   * @param store Feature store\r\n   */\r\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\r\n    if (features.length === 0) {\r\n      store.clearLayer();\r\n    } else {\r\n      store.setLayerFeatures(\r\n        features,\r\n        this.selectMotion(store),\r\n        this.options.viewScale,\r\n        this.options.areaRatio,\r\n        this.options.getFeatureId\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Selects the best motion\r\n   * @param store A FeatureStore to apply the motion\r\n   * @returns The motion selected\r\n   */\r\n  private selectMotion(store: FeatureStore) {\r\n    if (this.motion !== undefined) {\r\n      return this.motion;\r\n    }\r\n\r\n    if (store.pristine === true) {\r\n      // If features have just been loaded into the store, move/zoom on them\r\n      return FeatureMotion.Default;\r\n    } else if (store.count > store.view.count) {\r\n      // If features have been filtered, move/zoom on the remaining ones\r\n      return FeatureMotion.Default;\r\n    } else {\r\n      // On insert, update or delete, do nothing\r\n      return FeatureMotion.None;\r\n    }\r\n  }\r\n}\r\n","import { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport OlEvent from 'ol/events/Event';\r\n\r\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\r\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\n/**\r\n * This strategy loads a layer's features into it's store counterpart.\r\n * The layer -> store binding is a one-way binding. That means any OL feature\r\n * added to the layer will be added to the store but the opposite is false.\r\n *\r\n * Important: In it's current state, this strategy is to meant to be combined\r\n * with a standard Loading strategy and it would probably cause recursion issues.\r\n */\r\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n\r\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.onSourceChanges(store);\r\n    const olSource = store.layer.ol.getSource();\r\n    olSource.on('change', (event: OlEvent) => {\r\n      this.onSourceChanges(store);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach(\r\n      (entries: [FeatureStore, string]) => {}\r\n    );\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Load features from an OL source into a  store or clear the store if the source is empty\r\n   * @param features Store filtered features\r\n   * @param store Feature store\r\n   */\r\n  private onSourceChanges(store: FeatureStore) {\r\n    let olFeatures = store.layer.ol.getSource().getFeatures();\r\n\r\n    if (store.layer.dataSource instanceof ClusterDataSource) {\r\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\r\n        cluster.get('features')\r\n      );\r\n    }\r\n    if (olFeatures.length === 0) {\r\n      store.clear();\r\n    } else {\r\n      store.setStoreOlFeatures(olFeatures);\r\n    }\r\n  }\r\n}\r\n","import { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { EventsKey } from 'ol/events';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\r\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\r\n\r\nimport { Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime, map, skip } from 'rxjs/operators';\r\n\r\nimport { FeatureDataSource } from '../../../datasource';\r\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../../map/shared/map';\r\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\r\nimport { FeatureMotion } from '../feature.enums';\r\nimport {\r\n  Feature,\r\n  FeatureStoreSelectionStrategyOptions\r\n} from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\r\n  constructor(options) {\r\n    super(options);\r\n  }\r\n}\r\n\r\n/**\r\n * This strategy synchronizes a store and a layer selected entities.\r\n * The store <-> layer binding is a two-way binding.\r\n *\r\n * In many cases, a single strategy bound to multiple stores\r\n * will yield better results that multiple strategies with each their\r\n * own store. In the latter scenario, a click on overlapping features\r\n * would trigger the strategy of each layer and they would cancel\r\n * each other as well as move the map view around needlessly.\r\n */\r\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Listener to the map click event that allows selecting a feature\r\n   * by clicking on the map\r\n   */\r\n  private mapClickListener;\r\n\r\n  private olDragSelectInteraction: OlDragSelectInteraction;\r\n\r\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\r\n\r\n  /**\r\n   * Subscription to all stores selected entities\r\n   */\r\n  private stores$$: Subscription;\r\n\r\n  private motion: FeatureMotion;\r\n\r\n  /**\r\n   * The map the layers belong to\r\n   */\r\n  get map(): IgoMap {\r\n    return this.options.map;\r\n  }\r\n\r\n  /**\r\n   * A feature store that'll contain the selected features. It has it's own\r\n   * layer, shared by all the stores this staretgy is bound to.\r\n   */\r\n  get overlayStore(): FeatureStore {\r\n    return this._overlayStore;\r\n  }\r\n  private _overlayStore: FeatureStore;\r\n\r\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\r\n    super(options);\r\n    this.setMotion(options.motion);\r\n    this._overlayStore = this.createOverlayStore();\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and force this strategy's\r\n   * reactivation to properly setup watchers.\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      // Force reactivation\r\n      this.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and force this strategy's\r\n   * reactivation to properly setup watchers.\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      // Force reactivation\r\n      this.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define the motion to apply on select\r\n   * @param motion Feature motion\r\n   */\r\n  setMotion(motion: FeatureMotion) {\r\n    this.motion = motion;\r\n  }\r\n\r\n  /**\r\n   * Unselect all entities, from all stores\r\n   */\r\n  unselectAll() {\r\n    this.stores.forEach((store: FeatureStore) => {\r\n      store.state.updateAll({ selected: false });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay\r\n   */\r\n  clear() {\r\n    this.overlayStore.source.ol.clear();\r\n    this.overlayStore.clear();\r\n  }\r\n\r\n  /**\r\n   * Deactivate the selection without removing the selection\r\n   * overlay.\r\n   */\r\n  deactivateSelection() {\r\n    this.unlistenToMapClick();\r\n    this.removeDragBoxInteraction();\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer, setup the map click lsitener and\r\n   * start watching for stores selection\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.addOverlayLayer();\r\n    this.listenToMapClick();\r\n    if (this.options.dragBox === true) {\r\n      this.addDragBoxInteraction();\r\n    }\r\n    this.watchAll();\r\n  }\r\n\r\n  /**\r\n   * Remove the overlay layer, remove the map click lsitener and\r\n   * stop watching for stores selection\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.deactivateSelection();\r\n    this.removeOverlayLayer();\r\n  }\r\n\r\n  /**\r\n   * Create a single observable of all the stores. With a single observable,\r\n   * features can be added all at once to the overlay layer and a single\r\n   * motion can be performed. Multiple observable would have\r\n   * a cancelling effect on each other.\r\n   */\r\n  private watchAll() {\r\n    this.unwatchAll();\r\n\r\n    const stores$ = this.stores.map((store: FeatureStore) => {\r\n      return store.stateView\r\n        .manyBy$((record: EntityRecord<Feature>) => {\r\n          return record.state.selected === true;\r\n        })\r\n        .pipe(\r\n          map((records: EntityRecord<Feature>[]) =>\r\n            records.map((record) => record.entity)\r\n          )\r\n        );\r\n    });\r\n    this.stores$$ = combineLatest(stores$)\r\n      .pipe(\r\n        debounceTime(5),\r\n        skip(1), // Skip intial selection\r\n        map((features: Array<Feature[]>) =>\r\n          features.reduce((a, b) => a.concat(b))\r\n        )\r\n      )\r\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\r\n  }\r\n\r\n  /**\r\n   * Stop watching for selection in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    if (this.stores$$ !== undefined) {\r\n      this.stores$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a 'singleclick' listener to the map that'll allow selecting\r\n   * features by clicking on the map. The selection will be performed\r\n   * only on the layers bound to this strategy.\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: MapBrowserPointerEvent<any>) => {\r\n        this.onMapClick(event);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove the map click listener\r\n   */\r\n  private unlistenToMapClick() {\r\n    unByKey(this.mapClickListener);\r\n  }\r\n\r\n  /**\r\n   * On map click, select feature at pixel\r\n   * @param event OL MapBrowserPointerEvent\r\n   */\r\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\r\n    const exclusive = !ctrlKeyDown(event);\r\n    const reverse = !exclusive;\r\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\r\n      hitTolerance: this.options.hitTolerance || 0,\r\n      layerFilter: (olLayer) => {\r\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\r\n          return store.layer?.ol === olLayer;\r\n        });\r\n        return storeOlLayer !== undefined;\r\n      }\r\n    }) as OlFeature<OlGeometry>[];\r\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\r\n  }\r\n\r\n  /**\r\n   * Add a drag box interaction and, on drag box end, select features\r\n   */\r\n  private addDragBoxInteraction() {\r\n    let olDragSelectInteraction;\r\n    const olInteractions = this.map.ol.getInteractions().getArray();\r\n\r\n    // There can only be one dragbox interaction, so find the current one, if any\r\n    // Don't keep a reference to the current dragbox because we don't want\r\n    // to remove it when this startegy is deactivated\r\n    for (const olInteraction of olInteractions) {\r\n      if (olInteraction instanceof OlDragSelectInteraction) {\r\n        olDragSelectInteraction = olInteraction;\r\n        break;\r\n      }\r\n    }\r\n    // If no drag box interaction is found, create a new one and add it to the map\r\n    if (olDragSelectInteraction === undefined) {\r\n      olDragSelectInteraction = new OlDragSelectInteraction({\r\n        condition: ctrlKeyDown\r\n      });\r\n      this.map.ol.addInteraction(olDragSelectInteraction);\r\n      this.olDragSelectInteraction = olDragSelectInteraction;\r\n    }\r\n\r\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\r\n      'boxend',\r\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove drag box interaction\r\n   */\r\n  private removeDragBoxInteraction() {\r\n    if (this.olDragSelectInteractionEndKey !== undefined) {\r\n      unByKey(this.olDragSelectInteractionEndKey);\r\n    }\r\n    if (this.olDragSelectInteraction !== undefined) {\r\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\r\n    }\r\n    this.olDragSelectInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * On dragbox end, select features in drag box\r\n   * @param event OL MapBrowserPointerEvent\r\n   */\r\n  private onDragBoxEnd(event: OlDragBoxEvent) {\r\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\r\n    const target = event.target as any;\r\n    const extent = target.getGeometry().getExtent();\r\n    const olFeatures = this.stores.reduce(\r\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\r\n        const olSource = store.layer.ol.getSource();\r\n        acc.push(...olSource.getFeaturesInExtent(extent));\r\n        return acc;\r\n      },\r\n      []\r\n    );\r\n    this.onSelectFromMap(olFeatures, exclusive, false);\r\n  }\r\n\r\n  /**\r\n   * When features are selected from the store, add\r\n   * them to this startegy's overlay layer (select on map)\r\n   * @param features Store features\r\n   */\r\n  private onSelectFromStore(features: Feature[]) {\r\n    const motion = this.motion;\r\n    const olOverlayFeatures = this.overlayStore.layer.ol\r\n      .getSource()\r\n      .getFeatures();\r\n    const overlayFeaturesKeys = olOverlayFeatures.map(\r\n      (olFeature: OlFeature<OlGeometry>) => olFeature.getId()\r\n    );\r\n    const featuresKeys = features.map(this.overlayStore.getKey);\r\n\r\n    let doMotion;\r\n    if (features.length === 0) {\r\n      doMotion = false;\r\n    } else {\r\n      doMotion =\r\n        overlayFeaturesKeys.length !== featuresKeys.length ||\r\n        !overlayFeaturesKeys.every(\r\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\r\n        );\r\n    }\r\n\r\n    this.overlayStore.setLayerFeatures(\r\n      features,\r\n      doMotion ? motion : FeatureMotion.None,\r\n      this.options.viewScale,\r\n      this.options.areaRatio,\r\n      this.options.getFeatureId\r\n    );\r\n  }\r\n\r\n  /**\r\n   * When features are selected from the map, also select them\r\n   * in their store.\r\n   * @param olFeatures OL feature objects\r\n   */\r\n  private onSelectFromMap(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    exclusive: boolean,\r\n    reverse: boolean\r\n  ) {\r\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\r\n\r\n    this.stores.forEach((store: FeatureStore) => {\r\n      const features = groupedFeatures.get(store);\r\n      if (features === undefined && exclusive === true) {\r\n        this.unselectAllFeaturesFromStore(store);\r\n      } else if (features === undefined && exclusive === false) {\r\n        // Do nothing\r\n      } else {\r\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Select features in store\r\n   * @param store: Feature store\r\n   * @param features Features\r\n   */\r\n  private selectFeaturesFromStore(\r\n    store: FeatureStore,\r\n    features: Feature[],\r\n    exclusive: boolean,\r\n    reverse: boolean\r\n  ) {\r\n    if (reverse === true) {\r\n      store.state.reverseMany(features, ['selected']);\r\n    } else {\r\n      store.state.updateMany(features, { selected: true }, exclusive);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unselect all features from store\r\n   * @param store: Feature store\r\n   */\r\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\r\n    store.state.updateAll({ selected: false });\r\n  }\r\n\r\n  /**\r\n   * This method returns a store -> features mapping from a list\r\n   * of OL selected features. OL features keep a reference to the store\r\n   * they are from.\r\n   * @param olFeatures: OL feature objects\r\n   * @returns Store -> features mapping\r\n   */\r\n  private groupFeaturesByStore(\r\n    olFeatures: OlFeature<OlGeometry>[]\r\n  ): Map<FeatureStore, Feature[]> {\r\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\r\n    if (olFeatures === null || olFeatures === undefined) {\r\n      return groupedFeatures;\r\n    }\r\n\r\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\r\n      const store = olFeature.get('_featureStore');\r\n      if (store === undefined) {\r\n        return;\r\n      }\r\n\r\n      let features = groupedFeatures.get(store);\r\n      if (features === undefined) {\r\n        features = [];\r\n        groupedFeatures.set(store, features);\r\n      }\r\n\r\n      const feature = store.get(olFeature.getId());\r\n      if (feature !== undefined) {\r\n        features.push(feature);\r\n      }\r\n    });\r\n\r\n    return groupedFeatures;\r\n  }\r\n\r\n  /**\r\n   * Create an overlay store that'll contain the selected features.\r\n   * @returns Overlay store\r\n   */\r\n  private createOverlayStore(): FeatureStore {\r\n    const overlayLayer = this.options.layer\r\n      ? this.options.layer\r\n      : this.createOverlayLayer();\r\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Create an overlay store that'll contain the selected features.\r\n   * @returns Overlay layer\r\n   */\r\n  private createOverlayLayer(): VectorLayer {\r\n    return new VectorLayer({\r\n      zIndex: 300,\r\n      source: new FeatureDataSource(),\r\n      style: undefined,\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the overlay store's layer to the map to display the selected\r\n   * features.\r\n   */\r\n  private addOverlayLayer() {\r\n    if (this.overlayStore.layer.map === undefined) {\r\n      this.map.addLayer(this.overlayStore.layer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the overlay layer from the map\r\n   */\r\n  private removeOverlayLayer() {\r\n    this.overlayStore.source.ol.clear();\r\n    this.map.removeLayer(this.overlayStore.layer);\r\n  }\r\n}\r\n","import { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { Document, DocumentOptions } from 'flexsearch';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\nimport { FeatureStoreSearchIndexStrategyOptions } from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\n/**\r\n *\r\n * This strategy loads a layer's features's properties into a searchable index.\r\n */\r\nexport class FeatureStoreSearchIndexStrategy extends EntityStoreStrategy {\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n\r\n  constructor(protected options: FeatureStoreSearchIndexStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  private initStoreSearchIndex(store) {\r\n    store.searchDocument = new Document({ tokenize: 'full' });\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's entities changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n    this.initStoreSearchIndex(store);\r\n\r\n    store.entities$\r\n      .pipe(skipWhile((e) => !e.length))\r\n      .subscribe(() => this.onEntitiesChanges(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's entities changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      store.searchDocument = undefined;\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach(\r\n      (entries: [FeatureStore, string]) => {}\r\n    );\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Maintain searcahble index for every loaded entities\r\n   * @param store Feature store\r\n   */\r\n  private onEntitiesChanges(store: FeatureStore) {\r\n    const ratio = this.options.percentDistinctValueRatio || 2;\r\n    const featuresProperties = [];\r\n    store.index.forEach((value, key) => {\r\n      const fp = value.properties;\r\n      fp.igoSearchID = key;\r\n      featuresProperties.push(fp);\r\n    });\r\n    const toIndex = [];\r\n    let columnsToNotIndex = [];\r\n    let contentToIndex = [];\r\n    if (this.options.sourceFields) {\r\n      columnsToNotIndex = this.options.sourceFields.filter(\r\n        (sf) => !sf.searchIndex?.enabled\r\n      );\r\n      contentToIndex = this.options.sourceFields\r\n        .filter((sf) => sf.searchIndex?.enabled)\r\n        .map((sf2) => {\r\n          return Object.assign(\r\n            {},\r\n            { field: sf2.name, tokenize: 'full' },\r\n            sf2.searchIndex\r\n          );\r\n        });\r\n    } else {\r\n      if (featuresProperties.length) {\r\n        // THIS METHOD COMPUTE COLUMN DISTINCT VALUE TO FILTER WHICH COLUMN TO INDEX BASED ON A RATIO or discard float columns\r\n        const columns = Object.keys(featuresProperties[0]);\r\n        const columnsToIndex = [];\r\n        columnsToNotIndex = columns\r\n          .map((column) => {\r\n            const distinctValues = [\r\n              ...new Set(featuresProperties.map((item) => item[column]))\r\n            ];\r\n            // identify column to not index based on a ratio distinctValues/nb of features OR discart exclusive float column (ex: lat, long)\r\n            if (\r\n              (distinctValues.length / featuresProperties.length) * 100 <=\r\n                ratio ||\r\n              distinctValues.every((n) => Number(n) === n && n % 1 !== 0)\r\n            ) {\r\n              columnsToNotIndex.push(column);\r\n            } else {\r\n              columnsToIndex.push(column);\r\n            }\r\n          })\r\n          .filter((f) => f);\r\n        const keysToIndex = columnsToIndex.filter((f) => f !== 'igoSearchID');\r\n        contentToIndex = keysToIndex.map((key) => {\r\n          return { field: key, tokenize: 'full' };\r\n        });\r\n      }\r\n    }\r\n    store.index.forEach((value, key) => {\r\n      const propertiesToIndex = JSON.parse(JSON.stringify(value.properties));\r\n      columnsToNotIndex.map((c) => delete propertiesToIndex[c]);\r\n      if (Object.keys(propertiesToIndex).length) {\r\n        toIndex.push(propertiesToIndex);\r\n      }\r\n    });\r\n\r\n    if (toIndex.length === 0) {\r\n      this.initStoreSearchIndex(store);\r\n    } else {\r\n      store.searchDocument = new Document({\r\n        document: {\r\n          id: 'igoSearchID',\r\n          index: contentToIndex\r\n        } as DocumentOptions<any>\r\n      });\r\n      toIndex.map((i) => {\r\n        store.searchDocument.add(i.igoSearchID, i);\r\n      });\r\n    }\r\n  }\r\n}\r\n","import { FeatureStore } from './store';\r\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\r\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\r\n\r\n/**\r\n * Try to add a loading strategy to a store and activate it.\r\n * If no strategy is given to that function, a basic one will be created.\r\n * @param store The store to bind the loading strategy\r\n * @param strategy An optional loading strategy\r\n */\r\nexport function tryAddLoadingStrategy(\r\n  store: FeatureStore,\r\n  strategy?: FeatureStoreLoadingStrategy\r\n) {\r\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\r\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\r\n    return;\r\n  }\r\n\r\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\r\n  store.addStrategy(strategy);\r\n  strategy.activate();\r\n}\r\n\r\n/**\r\n * Try to add a selection strategy to a store and activate it.\r\n * If no strategy is given to that function, a basic one will be created.\r\n * @param store The store to bind the selection strategy\r\n * @param [strategy] An optional selection strategy\r\n */\r\nexport function tryAddSelectionStrategy(\r\n  store: FeatureStore,\r\n  strategy?: FeatureStoreSelectionStrategy\r\n) {\r\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\r\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\r\n    return;\r\n  }\r\n  strategy = strategy\r\n    ? strategy\r\n    : new FeatureStoreSelectionStrategy({\r\n        map: store.map\r\n      });\r\n  store.addStrategy(strategy);\r\n  strategy.activate();\r\n}\r\n","import OlFeature from 'ol/Feature';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport { StyleService } from '../../../style/style-service/style.service';\r\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\r\n\r\n/**\r\n * Create an overlay style with markers for points and a basic stroke/fill\r\n * combination for lines and polygons\r\n * @returns Style function\r\n */\r\nexport function createOverlayLayerStyle(): (\r\n  olFeature: OlFeature<OlGeometry>,\r\n  resolution: number\r\n) => olstyle.Style {\r\n  const defaultStyle = createOverlayDefaultStyle();\r\n  const markerStyle = createOverlayMarkerStyle();\r\n\r\n  let style;\r\n\r\n  return (olFeature: OlFeature<OlGeometry>, resolution) => {\r\n    if (olFeature.getId() === 'bufferFeature') {\r\n      style = createBufferStyle(\r\n        olFeature.get('bufferStroke'),\r\n        2,\r\n        olFeature.get('bufferFill'),\r\n        olFeature.get('bufferText')\r\n      );\r\n      return style;\r\n    } else {\r\n      const customStyle = olFeature.get('_style');\r\n      if (customStyle) {\r\n        const styleService = new StyleService();\r\n        return styleService.createStyle(customStyle, olFeature, resolution);\r\n      }\r\n      const geometryType = olFeature.getGeometry().getType();\r\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\r\n      style.getText().setText(olFeature.get('_mapTitle'));\r\n      return style;\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Create a basic style for lines and polygons\r\n * @returns Style\r\n */\r\nexport function createOverlayDefaultStyle({\r\n  text,\r\n  strokeWidth = 2,\r\n  fillColor = [0, 161, 222, 0.3],\r\n  strokeColor = [0, 161, 222, 0.9]\r\n}: {\r\n  text?: string;\r\n  strokeWidth?: number;\r\n  fillColor?: string | number[];\r\n  strokeColor?: string | number[];\r\n} = {}): olstyle.Style {\r\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\r\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\r\n\r\n  const stroke = new olstyle.Stroke({\r\n    width: strokeWidth,\r\n    color: strokeWithOpacity\r\n  });\r\n\r\n  const fill = new olstyle.Fill({\r\n    color: fillWithOpacity\r\n  });\r\n\r\n  return new olstyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    }),\r\n    text: new olstyle.Text({\r\n      text,\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n\r\nfunction createBufferStyle(\r\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\r\n  strokeWidth: number = 2,\r\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\r\n  bufferRadius?\r\n): olstyle.Style {\r\n  const stroke = new olstyle.Stroke({\r\n    width: strokeWidth,\r\n    color: strokeRGBA\r\n  });\r\n\r\n  const fill = new olstyle.Fill({\r\n    color: fillRGBA\r\n  });\r\n\r\n  return new olstyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    }),\r\n    text: new olstyle.Text({\r\n      font: '12px Calibri,sans-serif',\r\n      text: bufferRadius,\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n","import OlFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport {\r\n  Feature,\r\n  FeatureMotion,\r\n  featureToOl,\r\n  moveToOlFeatures\r\n} from '../../feature/shared';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { MapBase } from '../../map/shared/map.abstract';\r\nimport { createOverlayLayer } from './overlay.utils';\r\n\r\n/**\r\n * This class is simply a shortcut for adding features to a map.\r\n * It does nothing more than a standard layer but it's shipped with\r\n * a defautl style based on the geometry type of the features it contains.\r\n * @todo Enhance that by using a FeatureStore and strategies.\r\n */\r\nexport class Overlay<T extends MapBase = MapBase> {\r\n  /**\r\n   * The map to add the layer to\r\n   */\r\n  private map: T;\r\n\r\n  /**\r\n   * Overlay layer\r\n   */\r\n  private layer: VectorLayer;\r\n\r\n  /**\r\n   * Overlay layer's data source\r\n   */\r\n  get dataSource(): FeatureDataSource {\r\n    return this.layer.dataSource as FeatureDataSource;\r\n  }\r\n\r\n  constructor(map?: T) {\r\n    this.layer = createOverlayLayer();\r\n    this.setMap(map);\r\n  }\r\n\r\n  /**\r\n   * Bind this to a map and add the overlay layer to that map\r\n   * @param map Map\r\n   */\r\n  setMap(map: T) {\r\n    if (map === undefined) {\r\n      if (this.map !== undefined) {\r\n        this.map.ol.removeLayer(this.layer.ol);\r\n      }\r\n    } else {\r\n      map.ol.addLayer(this.layer.ol);\r\n    }\r\n    this.map = map;\r\n  }\r\n\r\n  /**\r\n   * Set the overlay features and, optionally, move to them\r\n   * @param features Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\r\n   */\r\n  setFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    sourceId?: string\r\n  ) {\r\n    if (sourceId) {\r\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\r\n        if (olFeature.get('_sourceId') === sourceId) {\r\n          this.removeOlFeature(olFeature);\r\n        }\r\n      }\r\n    } else {\r\n      this.clear();\r\n    }\r\n    this.addFeatures(features, motion);\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the  overlay and, optionally, move to it\r\n   * @param feature Feature\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\r\n    this.addFeatures([feature], motion);\r\n  }\r\n\r\n  /**\r\n   * Add features to the  overlay and, optionally, move to them\r\n   * @param features Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    const olFeatures = [];\r\n    features.forEach((feature: Feature) => {\r\n      const olFeature = featureToOl(feature, this.map.projection);\r\n      const olGeometry = olFeature.getGeometry();\r\n      if (olGeometry === null) {\r\n        return;\r\n      }\r\n      olFeatures.push(olFeature);\r\n    });\r\n\r\n    this.addOlFeatures(olFeatures, motion);\r\n  }\r\n\r\n  /**\r\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\r\n   * @param olFeature OpenLayers Feature\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addOlFeature(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    this.addOlFeatures([olFeature], motion);\r\n  }\r\n\r\n  /**\r\n   * Add OpenLayers features to the overlay and, optionally, move to them\r\n   * @param olFeatures OpenLayers Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addOlFeatures(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    this.dataSource.ol.addFeatures(olFeatures);\r\n    moveToOlFeatures(this.map.viewController, olFeatures, motion);\r\n  }\r\n\r\n  /**\r\n   * Remove a feature from the overlay\r\n   * @param feature Feature\r\n   */\r\n  removeFeature(feature: Feature) {\r\n    this.removeFeatures([feature]);\r\n  }\r\n\r\n  /**\r\n   * Remove features from the overlay\r\n   * @param features Features\r\n   */\r\n  removeFeatures(features: Feature[]) {\r\n    features.forEach((feature: Feature) => {\r\n      if (feature.meta) {\r\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\r\n          this.removeOlFeature(\r\n            this.dataSource.ol.getFeatureById(feature.meta.id)\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove an OpenLayers feature from the overlay\r\n   * @param olFeature OpenLayers Feature\r\n   */\r\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\r\n    this.dataSource.ol.removeFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay\r\n   */\r\n  clear() {\r\n    this.dataSource.ol.clear();\r\n  }\r\n}\r\n","import { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { createOverlayLayerStyle } from '../../style/shared/overlay/overlay-style.utils';\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n","import { SubjectStatus, Watcher } from '@igo2/utils';\r\n\r\nimport { ObjectEvent } from 'ol/Object';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\r\n\r\nexport class LayerWatcher extends Watcher {\r\n  public propertyChange$: BehaviorSubject<{\r\n    event: ObjectEvent;\r\n    layer: Layer;\r\n  }> = new BehaviorSubject(undefined);\r\n  private loaded = 0;\r\n  private loading = 0;\r\n  private layers: Layer[] = [];\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  watch() {}\r\n\r\n  unwatch() {\r\n    this.layers.forEach((layer) => this.unwatchLayer(layer), this);\r\n  }\r\n\r\n  setPropertyChange(change: ObjectEvent, layer: Layer) {\r\n    if (\r\n      ![\r\n        LinkedProperties.TIMEFILTER,\r\n        LinkedProperties.OGCFILTERS,\r\n        LinkedProperties.VISIBLE,\r\n        LinkedProperties.OPACITY,\r\n        LinkedProperties.MINRESOLUTION,\r\n        LinkedProperties.MAXRESOLUTION\r\n      ].includes(change.key as any)\r\n    ) {\r\n      return;\r\n    }\r\n    this.propertyChange$.next({ event: change, layer });\r\n  }\r\n\r\n  watchLayer(layer: Layer) {\r\n    if (layer.status$ === undefined) {\r\n      return;\r\n    }\r\n    layer.ol.on('propertychange', (evt) => this.setPropertyChange(evt, layer));\r\n    layer.dataSource.ol.on('propertychange', (evt) =>\r\n      this.setPropertyChange(evt, layer)\r\n    );\r\n\r\n    this.layers.push(layer);\r\n\r\n    const layer$$ = layer.status$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((status) => {\r\n        if (status === SubjectStatus.Error) {\r\n          this.loading = 0;\r\n          this.loaded = -1;\r\n        }\r\n        if (status === SubjectStatus.Working) {\r\n          this.loading += 1;\r\n        } else if (status === SubjectStatus.Done) {\r\n          this.loaded += 1;\r\n        }\r\n\r\n        if (this.loaded >= this.loading) {\r\n          this.loading = this.loaded = 0;\r\n          this.status = SubjectStatus.Done;\r\n        } else if (this.loading > 0) {\r\n          this.status = SubjectStatus.Working;\r\n        }\r\n      });\r\n\r\n    this.subscriptions.push(layer$$);\r\n  }\r\n\r\n  unwatchLayer(layer: Layer) {\r\n    layer.ol.un('propertychange', (evt) => this.setPropertyChange(evt, layer));\r\n    layer.dataSource.ol.un('propertychange', (evt) =>\r\n      this.setPropertyChange(evt, layer)\r\n    );\r\n    layer.status$.next(SubjectStatus.Done);\r\n    const index = this.layers.indexOf(layer);\r\n    if (index >= 0) {\r\n      const status = (layer as any).watcher.status;\r\n      if (\r\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\r\n      ) {\r\n        this.loaded += 1;\r\n      }\r\n      this.subscriptions[index].unsubscribe();\r\n      this.subscriptions.splice(index, 1);\r\n      this.layers.splice(index, 1);\r\n      (layer as any).watcher.unwatch();\r\n    }\r\n  }\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { EventsKey } from 'ol/events';\r\n\r\n/**\r\n * Base map controller\r\n */\r\nexport class MapController {\r\n  /**\r\n   * OL Map\r\n   */\r\n  protected olMap: OlMap;\r\n\r\n  /**\r\n   * Array of observer keys\r\n   */\r\n  protected observerKeys: EventsKey[] = [];\r\n\r\n  /**\r\n   * Return the OL map this controller is bound to\r\n   * @returns OL Map\r\n   */\r\n  getOlMap(): OlMap {\r\n    return this.olMap;\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\r\n      throw new Error('This controller is already bound to a map.');\r\n    }\r\n\r\n    if (olMap === undefined) {\r\n      this.teardownObservers();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\r\n    this.observerKeys = [];\r\n  }\r\n}\r\n","import { ProjectionLike } from 'ol/proj';\r\n\r\nexport interface GeolocationOptions {\r\n  activateDefault?: boolean;\r\n  basic?: boolean; // to control the button icon.\r\n  followPosition?: boolean; // to overide the followPosition define at the context level.\r\n  button?: {\r\n    visible: boolean;\r\n  };\r\n}\r\n\r\nexport interface MapGeolocationControllerOptions {\r\n  projection: ProjectionLike;\r\n  accuracyThreshold?: number;\r\n  followPosition?: boolean;\r\n  buffer?: GeolocationBuffer;\r\n}\r\n\r\nexport interface MapGeolocationState {\r\n  position: number[];\r\n  projection: string;\r\n  accuracy: number;\r\n  altitude: number;\r\n  altitudeAccuracy: number;\r\n  heading: number;\r\n  speed: number;\r\n  enableHighAccuracy: boolean;\r\n  timestamp: Date;\r\n}\r\nexport interface GeolocationBuffer {\r\n  bufferRadius?: number;\r\n  bufferStroke?: [number, number, number, number];\r\n  bufferFill?: [number, number, number, number];\r\n  showBufferRadius?: boolean;\r\n}\r\n\r\nexport enum GeolocationOverlayType {\r\n  Position = 'position',\r\n  PositionDirection = 'positionDirection',\r\n  Accuracy = 'accuracy',\r\n  Buffer = 'buffer'\r\n}\r\n","import { ConfigService, StorageService } from '@igo2/core';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport olGeolocation from 'ol/Geolocation';\r\nimport OlMap from 'ol/Map';\r\nimport { Point, Polygon } from 'ol/geom';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport Geometry from 'ol/geom/Geometry';\r\nimport { fromCircle } from 'ol/geom/Polygon';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olSphere from 'ol/sphere';\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport { BehaviorSubject, Subscription, interval } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n\r\nimport { FeatureMotion } from '../../../feature/shared/feature.enums';\r\nimport {\r\n  computeOlFeaturesExtent,\r\n  featuresAreOutOfView,\r\n  hideOlFeature,\r\n  moveToOlFeatures\r\n} from '../../../feature/shared/feature.utils';\r\nimport { Overlay } from '../../../overlay/shared/overlay';\r\nimport { MapBase } from '../map.abstract';\r\nimport { MapViewOptions } from '../map.interface';\r\nimport { MapController } from './controller';\r\nimport {\r\n  GeolocationBuffer,\r\n  GeolocationOverlayType,\r\n  MapGeolocationControllerOptions,\r\n  MapGeolocationState\r\n} from './geolocation.interface';\r\n\r\n/**\r\n * Controller to handle map view interactions\r\n */\r\nexport class MapGeolocationController extends MapController {\r\n  private arrowRotation: number;\r\n  private subscriptions$$: Subscription[] = [];\r\n  private geolocationOverlay: Overlay;\r\n  private positionFeatureStyle: olstyle.Style | olstyle.Style[] =\r\n    new olstyle.Style({\r\n      image: new olstyle.Circle({\r\n        radius: 6,\r\n        fill: new olstyle.Fill({\r\n          color: '#3399CC'\r\n        }),\r\n        stroke: new olstyle.Stroke({\r\n          color: '#fff',\r\n          width: 2\r\n        })\r\n      })\r\n    });\r\n  private accuracyFeatureStyle: olstyle.Style | olstyle.Style[] =\r\n    new olstyle.Style({\r\n      stroke: new olstyle.Stroke({\r\n        color: 'rgba(120, 120, 120, 0.4)',\r\n        width: 1\r\n      }),\r\n      fill: new olstyle.Fill({\r\n        color: 'rgba(120, 120, 120, 0.4)'\r\n      })\r\n    });\r\n\r\n  private get bufferStyle(): olstyle.Style {\r\n    return new olstyle.Style({\r\n      stroke: new olstyle.Stroke({ width: 2, color: this.buffer.bufferStroke }),\r\n      fill: new olstyle.Fill({ color: this.buffer.bufferFill }),\r\n      text: new olstyle.Text({\r\n        textAlign: 'left',\r\n        offsetX: 10,\r\n        offsetY: -10,\r\n        font: '12px Calibri,sans-serif',\r\n        text: this.buffer.showBufferRadius\r\n          ? `${this.buffer.bufferRadius}m`\r\n          : '',\r\n        fill: new olstyle.Fill({ color: '#000' }),\r\n        stroke: new olstyle.Stroke({ color: '#fff', width: 3 })\r\n      })\r\n    });\r\n  }\r\n\r\n  private get arrowStyle(): olstyle.Style {\r\n    return new olstyle.Style({\r\n      image: new olstyle.RegularShape({\r\n        radius: 5.5,\r\n        fill: new olstyle.Fill({\r\n          color: 'rgba(0, 132, 202)'\r\n        }),\r\n        stroke: new olstyle.Stroke({\r\n          color: '#fff',\r\n          width: 1.5\r\n        }),\r\n        points: 3,\r\n        displacement: [0, 9],\r\n        rotation: this.arrowRotation,\r\n        rotateWithView: true\r\n      })\r\n    });\r\n  }\r\n\r\n  private geolocation: olGeolocation;\r\n\r\n  /**\r\n   * Observable of the current emission interval of the position. In seconds\r\n   */\r\n  public readonly emissionIntervalSeconds$: BehaviorSubject<number> =\r\n    new BehaviorSubject(5);\r\n\r\n  /**\r\n   * Observable of the current position\r\n   */\r\n  public readonly position$ = new BehaviorSubject<MapGeolocationState>(\r\n    undefined\r\n  );\r\n  /**\r\n   * Observable of the tracking state\r\n   */\r\n  public readonly tracking$ = new BehaviorSubject<boolean>(undefined);\r\n  /**\r\n   * Observable of the follow position state\r\n   */\r\n  public readonly followPosition$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  private lastPosition: { coordinates: number[]; dateTime: Date };\r\n\r\n  /**\r\n   * Whether the geolocate should show a buffer around the current position\r\n   */\r\n  set buffer(value: GeolocationBuffer) {\r\n    this._buffer = value;\r\n    this.handleFeatureCreation(this.position$.value);\r\n  }\r\n  get buffer(): GeolocationBuffer {\r\n    return this._buffer;\r\n  }\r\n  private _buffer: GeolocationBuffer;\r\n\r\n  /**\r\n   * Whether the geolocate controller accuracy threshold to store/show the position.\r\n   */\r\n  set accuracyThreshold(value: number) {\r\n    this._accuracyThreshold = value;\r\n    this.handleFeatureCreation(this.position$.value);\r\n  }\r\n\r\n  get accuracyThreshold(): number {\r\n    return this._accuracyThreshold;\r\n  }\r\n  private _accuracyThreshold;\r\n\r\n  get olGeolocation() {\r\n    return this.geolocation;\r\n  }\r\n\r\n  /**\r\n   * Whether the activate the geolocation.\r\n   */\r\n  get tracking() {\r\n    return this.geolocation.getTracking();\r\n  }\r\n\r\n  set tracking(value: boolean) {\r\n    this.geolocation.setTracking(value || false);\r\n    this.tracking$.next(value);\r\n    if (this.storageService && value !== undefined) {\r\n      this.storageService.set('geolocation.tracking', value);\r\n    }\r\n    if (!value) {\r\n      this.position$.next(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether the activate the view tracking of the current position\r\n   */\r\n  set followPosition(value: boolean) {\r\n    this._followPosition = value;\r\n    this.followPosition$.next(value);\r\n    if (this.configService?.getConfig('geolocate.followPosition') === false) {\r\n      this._followPosition = false;\r\n      this.followPosition$.next(false);\r\n    }\r\n    this.handleFeatureCreation(this.position$.value);\r\n    if (this.storageService && value !== undefined) {\r\n      this.storageService.set('geolocation.followPosition', value);\r\n    }\r\n  }\r\n\r\n  get followPosition() {\r\n    return this._followPosition;\r\n  }\r\n\r\n  private _followPosition;\r\n\r\n  constructor(\r\n    private map: MapBase,\r\n    private options?: MapGeolocationControllerOptions,\r\n    private storageService?: StorageService,\r\n    private configService?: ConfigService\r\n  ) {\r\n    super();\r\n    this.geolocationOverlay = new Overlay(this.map);\r\n    this._followPosition =\r\n      this.options && this.options.followPosition\r\n        ? this.options.followPosition\r\n        : false;\r\n\r\n    this._buffer =\r\n      this.options && this.options.buffer ? this.options.buffer : undefined;\r\n    this._accuracyThreshold =\r\n      this.options && this.options.accuracyThreshold\r\n        ? this.options.accuracyThreshold\r\n        : 5000;\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    super.setOlMap(olMap);\r\n    this.setupObservers();\r\n  }\r\n\r\n  private deleteGeolocationFeatures() {\r\n    this.deleteFeatureByType(GeolocationOverlayType.Position);\r\n    this.deleteFeatureByType(GeolocationOverlayType.PositionDirection);\r\n    this.deleteFeatureByType(GeolocationOverlayType.Accuracy);\r\n    this.deleteFeatureByType(GeolocationOverlayType.Buffer);\r\n  }\r\n\r\n  setupObservers() {\r\n    this.tracking$.subscribe((tracking) => {\r\n      if (tracking) {\r\n        this.onPositionChange(true, true);\r\n      } else {\r\n        this.deleteGeolocationFeatures();\r\n      }\r\n    });\r\n\r\n    this.geolocation = new olGeolocation({\r\n      // enableHighAccuracy must be set to true to have the heading value.\r\n      trackingOptions: {\r\n        enableHighAccuracy: true,\r\n        maximumAge: 10000,\r\n        timeout: 600000\r\n      },\r\n      projection: this.options.projection\r\n    });\r\n    let tracking = false;\r\n    this.subscriptions$$.push(\r\n      this.emissionIntervalSeconds$\r\n        .pipe(switchMap((value) => interval(value * 1000)))\r\n        .subscribe(() => {\r\n          if (tracking === this.tracking) {\r\n            this.onPositionChange(true);\r\n          } else {\r\n            tracking = this.tracking;\r\n            this.onPositionChange(true, true);\r\n          }\r\n        })\r\n    );\r\n\r\n    this.geolocation.on('change', (evt) => {\r\n      this.onPositionChange(false, false);\r\n    });\r\n  }\r\n\r\n  updateArrowFeatureOrientation(position: MapGeolocationState) {\r\n    const position4326 = olproj.transform(\r\n      position.position,\r\n      position.projection,\r\n      'EPSG:4326'\r\n    );\r\n    if (!this.lastPosition) {\r\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\r\n      return;\r\n    }\r\n    const arrowFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.PositionDirection\r\n    );\r\n    const isMoving =\r\n      position?.speed > 1.25 &&\r\n      this.distanceBetweenPoints(this.lastPosition.coordinates, position4326) >\r\n        0.003;\r\n    if (position.accuracy <= this.accuracyThreshold && isMoving) {\r\n      // Calculate the heading using current position and last recorded\r\n      // because ol heading not returning right value\r\n      var dx = position4326[1] - this.lastPosition.coordinates[1];\r\n      var dy = position4326[0] - this.lastPosition.coordinates[0];\r\n      var theta = Math.atan2(dy, dx);\r\n      if (theta < 0) theta = 2 * Math.PI + theta;\r\n      this.arrowRotation = theta;\r\n      if (arrowFeature) {\r\n        arrowFeature.setStyle(this.arrowStyle);\r\n      }\r\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\r\n    } else {\r\n      if (\r\n        arrowFeature &&\r\n        new Date().getTime() - this.lastPosition.dateTime.getTime() > 3000\r\n      )\r\n        hideOlFeature(arrowFeature);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns distance in km between coord1 and coord2\r\n   */\r\n  private distanceBetweenPoints(coord1: number[], coord2: number[]): number {\r\n    return olSphere.getDistance(coord1, coord2) / 1000;\r\n  }\r\n\r\n  public addOnChangedListener(event: (geo: olGeolocation) => any) {\r\n    let listener = () => {\r\n      event(this.geolocation);\r\n    };\r\n    this.geolocation.on('change', listener);\r\n    return listener;\r\n  }\r\n\r\n  public deleteChangedListener(event: () => any) {\r\n    this.geolocation.un('change', event);\r\n  }\r\n\r\n  public updateGeolocationOptions(options: MapViewOptions) {\r\n    if (!options) {\r\n      return;\r\n    }\r\n    // todo maybe a dedicated interface for geolocation should be defined instead of putting these inside the mapviewoptions?\r\n    let tracking = options.geolocate;\r\n    let followPosition = options.alwaysTracking;\r\n    if (this.storageService) {\r\n      const storedTracking = this.storageService.get(\r\n        'geolocation.tracking'\r\n      ) as boolean;\r\n      if (storedTracking !== null && storedTracking !== undefined) {\r\n        tracking = storedTracking;\r\n      }\r\n\r\n      const storedFollowPosition = this.storageService.get(\r\n        'geolocation.followPosition'\r\n      ) as boolean;\r\n      if (storedFollowPosition !== null && storedFollowPosition !== undefined) {\r\n        followPosition = storedFollowPosition;\r\n      }\r\n    }\r\n    this.tracking = tracking;\r\n    this.followPosition = followPosition;\r\n    this.buffer = options.buffer;\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    if (this.subscriptions$$.length) {\r\n      this.subscriptions$$.map((s) => s.unsubscribe());\r\n    }\r\n    super.teardownObservers();\r\n  }\r\n\r\n  /**\r\n   * On position change, get the position, show it on the map and record it.\r\n   * @param emitEvent Map event\r\n   */\r\n  private onPositionChange(\r\n    emitEvent: boolean = false,\r\n    zoomTo: boolean = false\r\n  ) {\r\n    if (!this.tracking) {\r\n      return;\r\n    }\r\n    const geolocateProperties = this.geolocation.getProperties();\r\n\r\n    if (geolocateProperties.accuracy > this.accuracyThreshold) {\r\n      console.warn('Poor geolocation accuracy. No position are stored/shown');\r\n      this.position$.next(undefined);\r\n      return;\r\n    }\r\n\r\n    const position: MapGeolocationState = {\r\n      position: geolocateProperties.position,\r\n      projection: this.geolocation.getProjection().getCode(),\r\n      accuracy: geolocateProperties.accuracy,\r\n      altitude: geolocateProperties.altitude,\r\n      altitudeAccuracy: geolocateProperties.altitudeAccuracy,\r\n      heading: geolocateProperties.heading,\r\n      speed: geolocateProperties.speed,\r\n      enableHighAccuracy: geolocateProperties.trackingOptions\r\n        ?.enableHighAccuracy\r\n        ? true\r\n        : false,\r\n      timestamp: new Date()\r\n    };\r\n    this.handleFeatureCreation(position);\r\n    this.handleViewFromFeatures(position, zoomTo);\r\n    if (emitEvent) {\r\n      this.position$.next(position);\r\n    }\r\n  }\r\n\r\n  private getFeatureByType(type: GeolocationOverlayType): olFeature<Geometry> {\r\n    return this.geolocationOverlay.dataSource.ol.getFeatureById(type);\r\n  }\r\n\r\n  private deleteFeatureByType(type: GeolocationOverlayType) {\r\n    const featureById =\r\n      this.geolocationOverlay?.dataSource.ol.getFeatureById(type);\r\n    if (featureById) {\r\n      this.geolocationOverlay.dataSource.ol.removeFeature(featureById);\r\n    }\r\n  }\r\n\r\n  private handleFeatureCreation(position: MapGeolocationState) {\r\n    if (!position || !position.position) {\r\n      return;\r\n    }\r\n    const positionGeometry = new Point(position.position);\r\n    const accuracyGeometry = fromCircle(\r\n      new OlCircle(position.position, position.accuracy || 0)\r\n    );\r\n    let positionFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.Position\r\n    );\r\n    let positionFeatureArrow = this.getFeatureByType(\r\n      GeolocationOverlayType.PositionDirection\r\n    );\r\n    let accuracyFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.Accuracy\r\n    );\r\n    const positionFeatureExists = positionFeature ? true : false;\r\n    const positionFeatureArrowExists = positionFeatureArrow ? true : false;\r\n    const accuracyFeatureExists = accuracyFeature ? true : false;\r\n    if (!positionFeatureArrowExists) {\r\n      positionFeatureArrow = new olFeature<Point>({\r\n        geometry: positionGeometry\r\n      });\r\n      positionFeatureArrow.setId(GeolocationOverlayType.PositionDirection);\r\n      hideOlFeature(positionFeatureArrow);\r\n    }\r\n    if (!positionFeatureExists) {\r\n      positionFeature = new olFeature<Point>({ geometry: positionGeometry });\r\n      positionFeature.setId(GeolocationOverlayType.Position);\r\n      positionFeature.setStyle(this.positionFeatureStyle);\r\n    }\r\n    if (!accuracyFeatureExists) {\r\n      accuracyFeature = new olFeature<Polygon>({ geometry: accuracyGeometry });\r\n      accuracyFeature.setId(GeolocationOverlayType.Accuracy);\r\n      accuracyFeature.setStyle(this.accuracyFeatureStyle);\r\n    }\r\n\r\n    if (positionGeometry) {\r\n      positionFeatureExists\r\n        ? positionFeature.setGeometry(positionGeometry)\r\n        : this.geolocationOverlay.addOlFeature(\r\n            positionFeature,\r\n            FeatureMotion.None\r\n          );\r\n      positionFeatureArrowExists\r\n        ? positionFeatureArrow.setGeometry(positionGeometry)\r\n        : this.geolocationOverlay.addOlFeature(\r\n            positionFeatureArrow,\r\n            FeatureMotion.None\r\n          );\r\n      this.updateArrowFeatureOrientation(position);\r\n      accuracyFeatureExists\r\n        ? accuracyFeature.setGeometry(accuracyGeometry)\r\n        : this.geolocationOverlay.addOlFeature(\r\n            accuracyFeature,\r\n            FeatureMotion.None\r\n          );\r\n\r\n      if (this.buffer) {\r\n        let bufferFeature = this.getFeatureByType(\r\n          GeolocationOverlayType.Buffer\r\n        );\r\n        const bufferFeatureExists = bufferFeature ? true : false;\r\n        const bufferGeometry = new OlCircle(\r\n          position.position,\r\n          this.buffer.bufferRadius\r\n        );\r\n        if (!bufferFeatureExists) {\r\n          bufferFeature = new olFeature(bufferGeometry);\r\n          bufferFeature.setId(GeolocationOverlayType.Buffer);\r\n          bufferFeature.setStyle(this.positionFeatureStyle);\r\n        }\r\n        bufferFeature.setStyle(this.bufferStyle);\r\n        bufferFeatureExists\r\n          ? bufferFeature.setGeometry(bufferGeometry)\r\n          : this.geolocationOverlay.addOlFeature(\r\n              bufferFeature,\r\n              FeatureMotion.None\r\n            );\r\n      }\r\n    }\r\n  }\r\n  handleViewFromFeatures(\r\n    position: MapGeolocationState,\r\n    zoomTo: boolean = false\r\n  ) {\r\n    let positionFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.Position\r\n    );\r\n    let positionFeatureArrow = this.getFeatureByType(\r\n      GeolocationOverlayType.PositionDirection\r\n    );\r\n    let accuracyFeature = this.getFeatureByType(\r\n      GeolocationOverlayType.Accuracy\r\n    );\r\n    let bufferFeature = this.getFeatureByType(GeolocationOverlayType.Buffer);\r\n    const features = [\r\n      positionFeature,\r\n      positionFeatureArrow,\r\n      accuracyFeature,\r\n      bufferFeature\r\n    ].filter((f) => f);\r\n    if (features.length > 0) {\r\n      const featuresExtent = computeOlFeaturesExtent(\r\n        features,\r\n        this.map.viewProjection\r\n      );\r\n      const edgeRatios =\r\n        position?.speed > 12.5\r\n          ? [0.25, 0.25, 0.25, 0.25]\r\n          : [0.15, 0.1, 0.1, 0.1];\r\n      const areOutOfView = featuresAreOutOfView(\r\n        this.map.getExtent(),\r\n        featuresExtent,\r\n        edgeRatios\r\n      );\r\n      let motion =\r\n        this.followPosition && areOutOfView\r\n          ? FeatureMotion.Move\r\n          : FeatureMotion.None;\r\n      if (zoomTo) {\r\n        motion = FeatureMotion.Zoom;\r\n      }\r\n      motion !== FeatureMotion.None\r\n        ? moveToOlFeatures(this.map.viewController, features, motion)\r\n        : undefined;\r\n    }\r\n  }\r\n}\r\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import OlMap from 'ol/Map';\r\nimport OlMapEvent from 'ol/MapEvent';\r\nimport { ObjectEvent } from 'ol/Object';\r\nimport OlView from 'ol/View';\r\nimport * as oleasing from 'ol/easing';\r\nimport { EventsKey } from 'ol/events';\r\nimport * as olproj from 'ol/proj';\r\nimport OlProjection from 'ol/proj/Projection';\r\n\r\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { MapViewAction } from '../map.enums';\r\nimport { MapExtent, MapViewState } from '../map.interface';\r\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\r\nimport { MapController } from './controller';\r\n\r\nexport interface MapViewControllerOptions {\r\n  stateHistory: boolean;\r\n}\r\n\r\n/**\r\n * Controller to handle map view interactions\r\n */\r\nexport class MapViewController extends MapController {\r\n  /**\r\n   * Observable of the current rotation in radians\r\n   */\r\n  readonly rotation$ = new BehaviorSubject<number>(0);\r\n\r\n  /**\r\n   * Observable of the current resolution\r\n   */\r\n  resolution$ = new BehaviorSubject<number>(undefined);\r\n\r\n  /**\r\n   * Observable of the current state\r\n   */\r\n  state$ = new BehaviorSubject<MapViewState>(undefined);\r\n\r\n  /**\r\n   * View Padding\r\n   * Values in the array are top, right, bottom and left padding.\r\n   */\r\n  padding = [0, 0, 0, 0];\r\n\r\n  /**\r\n   * Max zoom after set extent\r\n   */\r\n  maxZoomOnExtent = 19;\r\n\r\n  /**\r\n   * Max extent possible when zooming\r\n   */\r\n  maxLayerZoomExtent: MapExtent;\r\n\r\n  /**\r\n   * Extent stream\r\n   */\r\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\r\n\r\n  /**\r\n   * Subscription to the movement stream\r\n   */\r\n  private extent$$: Subscription;\r\n\r\n  /**\r\n   * History of states\r\n   */\r\n  private states: MapViewState[] = [];\r\n\r\n  /**\r\n   * Current state index\r\n   */\r\n  private stateIndex: number = 0;\r\n\r\n  /**\r\n   * Whether the view controller should keep the view's state history\r\n   */\r\n  get stateHistory(): boolean {\r\n    return this.options ? this.options.stateHistory === true : false;\r\n  }\r\n\r\n  /**\r\n   * OL View\r\n   */\r\n  get olView(): OlView {\r\n    return this.olMap.getView();\r\n  }\r\n\r\n  constructor(private options?: MapViewControllerOptions) {\r\n    super();\r\n  }\r\n\r\n  setPadding(padding: {\r\n    top?: number;\r\n    bottom?: number;\r\n    left?: number;\r\n    right?: number;\r\n  }) {\r\n    // Values in the array are top, right, bottom and left padding.\r\n    if (padding.top || padding.top === 0) {\r\n      this.padding[0] = padding.top;\r\n    }\r\n    if (padding.right || padding.right === 0) {\r\n      this.padding[1] = padding.right;\r\n    }\r\n    if (padding.bottom || padding.bottom === 0) {\r\n      this.padding[2] = padding.bottom;\r\n    }\r\n    if (padding.left || padding.left === 0) {\r\n      this.padding[3] = padding.left;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    super.setOlMap(olMap);\r\n    this.setupObservers();\r\n  }\r\n\r\n  /**\r\n   * Observe move moveend and subscribe to the extent stream\r\n   */\r\n  setupObservers() {\r\n    if (this.stateHistory === true) {\r\n      this.observerKeys.push(\r\n        this.olMap.on('moveend', (event: OlMapEvent) =>\r\n          this.onMoveEnd(event)\r\n        ) as EventsKey\r\n      );\r\n    }\r\n\r\n    this.extent$$ = this.extent$\r\n      .pipe(debounceTime(25))\r\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\r\n        this.setExtent(value.extent, value.action);\r\n      });\r\n  }\r\n\r\n  monitorRotation() {\r\n    this.observerKeys.push(\r\n      this.olMap.getView().on('change:rotation', (evt: ObjectEvent) => {\r\n        this.rotation$.next(evt.target.getRotation());\r\n      }) as EventsKey\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    super.teardownObservers();\r\n    if (this.extent$$ !== undefined) {\r\n      this.extent$$.unsubscribe();\r\n      this.extent$$ = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the view's OL projection\r\n   * @returns OL projection\r\n   */\r\n  getOlProjection(): OlProjection {\r\n    return this.olView.getProjection();\r\n  }\r\n\r\n  /**\r\n   * Get the current map view center\r\n   * @param projection Output projection\r\n   * @returns Center\r\n   */\r\n  getCenter(projection?: string | OlProjection): [number, number] {\r\n    let center = this.olView.getCenter() as [number, number];\r\n    if (projection && center) {\r\n      center = olproj.transform(center, this.getOlProjection(), projection) as [\r\n        number,\r\n        number\r\n      ];\r\n    }\r\n    return center;\r\n  }\r\n\r\n  /**\r\n   * Get the current view extent\r\n   * @param projection Output projection\r\n   * @returns Extent\r\n   */\r\n  getExtent(projection?: string | OlProjection): MapExtent {\r\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\r\n    if (projection && extent) {\r\n      extent = olproj.transformExtent(\r\n        extent,\r\n        this.getOlProjection(),\r\n        projection\r\n      );\r\n    }\r\n    return extent as [number, number, number, number];\r\n  }\r\n\r\n  /**\r\n   * Get the current scale\r\n   * @param dpi Dot per inches\r\n   * @returns View scale\r\n   */\r\n  getScale(dpi = 96) {\r\n    return getScaleFromResolution(\r\n      this.getResolution(),\r\n      this.getOlProjection().getUnits(),\r\n      dpi\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the current resolution\r\n   * @returns Projection denominator\r\n   */\r\n  getResolution(): number {\r\n    return this.olView.getResolution();\r\n  }\r\n\r\n  /**\r\n   * Get the current zoom level\r\n   * @returns Zoom level\r\n   */\r\n  getZoom(): number {\r\n    return Math.round(this.olView.getZoom());\r\n  }\r\n\r\n  /**\r\n   * Zoom in\r\n   */\r\n  zoomIn() {\r\n    this.zoomTo(this.olView.getZoom() + 1);\r\n  }\r\n\r\n  /**\r\n   * Zoom out\r\n   */\r\n  zoomOut() {\r\n    this.zoomTo(this.olView.getZoom() - 1);\r\n  }\r\n\r\n  /**\r\n   * Zoom to specific zoom level\r\n   * @param zoom Zoom level\r\n   */\r\n  zoomTo(zoom: number) {\r\n    this.olView.cancelAnimations();\r\n    this.olView.animate({\r\n      zoom,\r\n      duration: 250,\r\n      easing: oleasing.easeOut\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Move to extent after a short delay (100ms) unless\r\n   * a new movement gets registered in the meantime.\r\n   * @param extent Extent to move to\r\n   */\r\n  moveToExtent(extent: [number, number, number, number]) {\r\n    this.extent$.next({ extent, action: MapViewAction.Move });\r\n  }\r\n\r\n  /**\r\n   * Zoom to extent after a short delay (100ms) unless\r\n   * a new movement gets registered in the meantime.\r\n   * @param extent Extent to zoom to\r\n   */\r\n  zoomToExtent(extent: [number, number, number, number]) {\r\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\r\n  }\r\n\r\n  /**\r\n   * Return the current view rotation\r\n   * @returns Rotation angle in radians\r\n   */\r\n  getRotation(): number {\r\n    return this.olView.getRotation();\r\n  }\r\n\r\n  /**\r\n   * Reset the view rotation to 0\r\n   */\r\n  resetRotation() {\r\n    this.olView.animate({ rotation: 0 });\r\n  }\r\n\r\n  /**\r\n   * Whether the view has a previous state\r\n   * @returns True if the view has a previous state\r\n   */\r\n  hasPreviousState(): boolean {\r\n    return this.states.length > 1 && this.stateIndex > 0;\r\n  }\r\n\r\n  /**\r\n   * Whether the view has a next state\r\n   * @returns True if the view has a next state\r\n   */\r\n  hasNextState(): boolean {\r\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\r\n  }\r\n\r\n  /**\r\n   * Restore the previous view state\r\n   */\r\n  previousState() {\r\n    if (this.hasPreviousState()) {\r\n      this.setStateIndex(this.stateIndex - 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore the next view state\r\n   */\r\n  nextState() {\r\n    if (this.hasNextState()) {\r\n      this.setStateIndex(this.stateIndex + 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the state history\r\n   */\r\n  clearStateHistory() {\r\n    this.states = [];\r\n    this.stateIndex = 0;\r\n  }\r\n\r\n  /**\r\n   * Update the the view to it's intial state\r\n   */\r\n  setInitialState() {\r\n    if (this.states.length > 0) {\r\n      this.setStateIndex(0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move to the extent retrieved from the stream\r\n   * @param extent Extent\r\n   * @param action Either zoom or move\r\n   * @param animation With or without animation to the target extent.\r\n   */\r\n  private setExtent(\r\n    extent: MapExtent,\r\n    action: MapViewAction,\r\n    animation: boolean = true\r\n  ) {\r\n    const olView = this.olView;\r\n    olView.cancelAnimations();\r\n    const duration = animation ? 500 : 0;\r\n    const zoom = olView.getZoom();\r\n\r\n    const fromCenter = olView.getCenter();\r\n    const toCenter = [\r\n      extent[0] + (extent[2] - extent[0]) / 2,\r\n      extent[1] + (extent[3] - extent[1]) / 2\r\n    ];\r\n    const distCenter = Math.sqrt(\r\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\r\n        Math.pow(fromCenter[1] - toCenter[1], 2)\r\n    );\r\n    const fromExtent = olView.calculateExtent();\r\n    const fromSize = Math.sqrt(\r\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\r\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\r\n    );\r\n    const toSize = Math.sqrt(\r\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\r\n    );\r\n    const moySize = (toSize + fromSize) / 2;\r\n    const xSize = distCenter / moySize;\r\n\r\n    const maxZoom =\r\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\r\n        ? zoom\r\n        : this.maxZoomOnExtent;\r\n\r\n    olView.fit(extent, {\r\n      size: this.olMap.getSize(),\r\n      maxZoom,\r\n      padding: this.padding,\r\n      duration: xSize > 4 ? 0 : duration,\r\n      callback: (isFinished: boolean) => {\r\n        if (!isFinished) {\r\n          olView.fit(extent, {\r\n            size: this.olMap.getSize(),\r\n            maxZoom,\r\n            padding: this.padding,\r\n            duration: xSize > 4 ? 0 : duration\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the view state index\r\n   * @param index State index\r\n   */\r\n  private setStateIndex(index: number) {\r\n    this.stateIndex = index;\r\n    this.setState(this.states[index]);\r\n  }\r\n\r\n  /**\r\n   * Set the view state\r\n   * @param state View state\r\n   */\r\n  private setState(state: MapViewState) {\r\n    this.olView.animate({\r\n      resolution: state.resolution,\r\n      center: state.center,\r\n      duration: 0\r\n    });\r\n  }\r\n\r\n  /**\r\n   * On move end, get the view state and record it.\r\n   * @param event Map event\r\n   */\r\n  private onMoveEnd(event: OlMapEvent) {\r\n    const resolution = this.getResolution();\r\n    if (this.resolution$.value !== resolution) {\r\n      this.resolution$.next(resolution);\r\n    }\r\n\r\n    const state = {\r\n      resolution,\r\n      center: this.getCenter(),\r\n      zoom: this.getZoom()\r\n    };\r\n\r\n    if (this.stateHistory === true) {\r\n      const stateIndex = this.stateIndex;\r\n      const stateAtIndex =\r\n        this.states.length === 0 ? undefined : this.states[stateIndex];\r\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\r\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\r\n        this.stateIndex = this.states.length - 1;\r\n      }\r\n    }\r\n\r\n    this.state$.next(state);\r\n  }\r\n}\r\n","import { ObjectEvent } from 'ol/Object';\r\nimport olSourceImageWMS from 'ol/source/ImageWMS';\r\nimport { getUid } from 'ol/util';\r\n\r\nimport {\r\n  TimeFilterableDataSource,\r\n  TimeFilterableDataSourceOptions\r\n} from '../../datasource';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport {\r\n  OgcFilterableDataSource,\r\n  OgcFilterableDataSourceOptions\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\r\nimport { MapBase } from '../shared/map.abstract';\r\n\r\nexport function getLinkedLayersOptions(layer: Layer) {\r\n  return layer.options.linkedLayers;\r\n}\r\n\r\nexport function getIgoLayerByLinkId(map: MapBase, id: string) {\r\n  return map.layers.find((l) => l.options.linkedLayers?.linkId === id);\r\n}\r\n\r\nexport function layerHasLinkWithProperty(\r\n  layer: Layer,\r\n  property: LinkedProperties\r\n): boolean {\r\n  let hasLinkWithProperty = false;\r\n  const layerLLOptions = getLinkedLayersOptions(layer);\r\n  if (layerLLOptions?.links) {\r\n    const link = layerLLOptions.links.find((l) =>\r\n      l.properties.includes(property)\r\n    );\r\n    hasLinkWithProperty = link ? true : false;\r\n  }\r\n  return hasLinkWithProperty;\r\n}\r\n\r\nexport function layerHasLinkDeletion(layer: Layer): boolean {\r\n  let hasLinkWithSyncedDelete = false;\r\n  const layerLLOptions = getLinkedLayersOptions(layer);\r\n  if (layerLLOptions?.links) {\r\n    const link = layerLLOptions.links.find((l) => l.syncedDelete);\r\n    hasLinkWithSyncedDelete = link ? true : false;\r\n  }\r\n  return hasLinkWithSyncedDelete;\r\n}\r\n\r\nexport function getRootParentByProperty(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  property: LinkedProperties\r\n): Layer {\r\n  let layerToUse = layer;\r\n  let parentLayer = layerToUse;\r\n  let hasParentLayer = true;\r\n  while (hasParentLayer) {\r\n    layerToUse = parentLayer;\r\n    parentLayer = getDirectParentLayerByProperty(map, layerToUse, property);\r\n    hasParentLayer = parentLayer ? true : false;\r\n  }\r\n  if (!hasParentLayer) {\r\n    if (!layerHasLinkWithProperty(layerToUse, property)) {\r\n      layerToUse = undefined;\r\n    }\r\n  }\r\n  return hasParentLayer ? parentLayer : layerToUse;\r\n}\r\n\r\nexport function getDirectParentLayerByProperty(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  property: LinkedProperties\r\n): Layer {\r\n  if (layer?.options.linkedLayers?.linkId) {\r\n    const currentLinkId = layer.options.linkedLayers.linkId;\r\n    let parents = map.layers.filter((pl) => {\r\n      const linkedLayers = pl.options.linkedLayers;\r\n      if (linkedLayers && linkedLayers.links) {\r\n        const a = linkedLayers.links.find(\r\n          (l) =>\r\n            l.linkedIds.includes(currentLinkId) &&\r\n            l.properties.includes(property)\r\n        );\r\n        return a;\r\n      }\r\n    });\r\n    if (parents.length > 1) {\r\n      console.warn(`Your layer ${\r\n        layer.title || layer.id\r\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\r\n            , The first parent (${\r\n              parents[0].title || parents[0].id\r\n            }) will be use to sync properties`);\r\n    }\r\n    return parents[0];\r\n  }\r\n}\r\n\r\nexport function getDirectChildLayersByProperty(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  property: LinkedProperties\r\n): Layer[] {\r\n  let linkedIds = [];\r\n  if (layer?.options.linkedLayers?.links) {\r\n    layer.options.linkedLayers.links\r\n      .filter((l) => l.properties.includes(property))\r\n      .map((link) => {\r\n        linkedIds = linkedIds.concat(link.linkedIds);\r\n      });\r\n  }\r\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\r\n}\r\n\r\nexport function getAllChildLayersByProperty(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  knownChildLayers: Layer[],\r\n  property: LinkedProperties\r\n): Layer[] {\r\n  let childLayers = getDirectChildLayersByProperty(map, layer, property);\r\n  childLayers.map((cl) => {\r\n    knownChildLayers.push(cl);\r\n    const directChildLayers = getDirectChildLayersByProperty(map, cl, property);\r\n    if (directChildLayers) {\r\n      getAllChildLayersByProperty(map, cl, knownChildLayers, property);\r\n    }\r\n  });\r\n  return knownChildLayers;\r\n}\r\n\r\nexport function getRootParentByDeletion(map: MapBase, layer: Layer): Layer {\r\n  let layerToUse = layer;\r\n  let parentLayer = layerToUse;\r\n  let hasParentLayer = true;\r\n  while (hasParentLayer) {\r\n    layerToUse = parentLayer;\r\n    parentLayer = getDirectParentLayerByDeletion(map, layerToUse);\r\n    hasParentLayer = parentLayer ? true : false;\r\n  }\r\n  if (!hasParentLayer) {\r\n    if (!layerHasLinkDeletion(layerToUse)) {\r\n      layerToUse = undefined;\r\n    }\r\n  }\r\n  return hasParentLayer ? parentLayer : layerToUse;\r\n}\r\n\r\nexport function getDirectParentLayerByDeletion(\r\n  map: MapBase,\r\n  layer: Layer\r\n): Layer {\r\n  if (layer.options.linkedLayers?.linkId) {\r\n    const currentLinkId = layer.options.linkedLayers.linkId;\r\n    let parents = map.layers.filter((pl) => {\r\n      const linkedLayers = pl.options.linkedLayers;\r\n      if (linkedLayers && linkedLayers.links) {\r\n        const a = linkedLayers.links.find(\r\n          (l) => l.linkedIds.includes(currentLinkId) && l.syncedDelete\r\n        );\r\n        return a;\r\n      }\r\n    });\r\n    if (parents.length > 1) {\r\n      console.warn(`Your layer ${\r\n        layer.title || layer.id\r\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\r\n          , The first parent (${\r\n            parents[0].title || parents[0].id\r\n          }) will be use to sync properties`);\r\n    }\r\n    return parents[0];\r\n  }\r\n}\r\n\r\nexport function getDirectChildLayersByDeletion(\r\n  map: MapBase,\r\n  layer: Layer\r\n): Layer[] {\r\n  let linkedIds = [];\r\n  if (layer?.options.linkedLayers?.links) {\r\n    layer.options.linkedLayers.links\r\n      .filter((l) => l.syncedDelete)\r\n      .map((link) => {\r\n        linkedIds = linkedIds.concat(link.linkedIds);\r\n      });\r\n  }\r\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\r\n}\r\n\r\nexport function getAllChildLayersByDeletion(\r\n  map: MapBase,\r\n  layer: Layer,\r\n  knownChildLayers: Layer[]\r\n): Layer[] {\r\n  let childLayers = getDirectChildLayersByDeletion(map, layer);\r\n  childLayers.map((cl) => {\r\n    knownChildLayers.push(cl);\r\n    const directChildLayers = getDirectChildLayersByDeletion(map, cl);\r\n    if (directChildLayers) {\r\n      getAllChildLayersByDeletion(map, cl, knownChildLayers);\r\n    }\r\n  });\r\n  return knownChildLayers;\r\n}\r\n\r\nexport function initLayerSyncFromRootParentLayers(\r\n  map: MapBase,\r\n  layers: Layer[]\r\n) {\r\n  const rootLayersByProperty = {};\r\n  const keys = Object.keys(LinkedProperties);\r\n  keys.map((k) => {\r\n    rootLayersByProperty[LinkedProperties[k]] = [];\r\n  });\r\n  layers\r\n    .filter((l) => getLinkedLayersOptions(l))\r\n    .map((l) => {\r\n      keys.map((key) => {\r\n        const k = LinkedProperties[key];\r\n        const plbp = getRootParentByProperty(map, l, k as LinkedProperties);\r\n        const layers = rootLayersByProperty[k];\r\n        const layersId = layers.map((l) => l.id);\r\n        if (plbp && !layersId.includes(plbp.id)) {\r\n          rootLayersByProperty[k].push(plbp);\r\n        }\r\n      });\r\n    });\r\n  Object.keys(rootLayersByProperty).map((k) => {\r\n    const layers = rootLayersByProperty[k];\r\n    layers.map((l: Layer) => l.ol.notify(k, undefined));\r\n  });\r\n}\r\n\r\nexport function handleLayerPropertyChange(\r\n  map: MapBase,\r\n  propertyChange: ObjectEvent,\r\n  initiatorIgoLayer: Layer\r\n) {\r\n  if (!propertyChange) {\r\n    return;\r\n  }\r\n  const ogcFilterWriter = new OgcFilterWriter();\r\n  let isLayerProperty = true;\r\n  let isDatasourceProperty = true;\r\n  const key = propertyChange.key;\r\n  let newValue;\r\n  if (key === 'ogcFilters') {\r\n    isLayerProperty = false;\r\n    isDatasourceProperty = true;\r\n    newValue = (\r\n      initiatorIgoLayer.dataSource.options as OgcFilterableDataSourceOptions\r\n    ).ogcFilters;\r\n  } else if (key === 'timeFilter') {\r\n    isLayerProperty = false;\r\n    isDatasourceProperty = true;\r\n    newValue = (\r\n      initiatorIgoLayer.dataSource.options as TimeFilterableDataSourceOptions\r\n    ).timeFilter;\r\n  } else {\r\n    isLayerProperty = true;\r\n    isDatasourceProperty = false;\r\n    newValue = initiatorIgoLayer.ol.get(key);\r\n  }\r\n\r\n  const initiatorLinkedLayersOptions =\r\n    getLinkedLayersOptions(initiatorIgoLayer);\r\n  if (initiatorLinkedLayersOptions) {\r\n    let rootParentByProperty = getRootParentByProperty(\r\n      map,\r\n      initiatorIgoLayer,\r\n      key as LinkedProperties\r\n    );\r\n    if (!rootParentByProperty) {\r\n      rootParentByProperty = initiatorIgoLayer;\r\n    }\r\n\r\n    const clbp = [rootParentByProperty];\r\n    getAllChildLayersByProperty(\r\n      map,\r\n      rootParentByProperty,\r\n      clbp,\r\n      key as LinkedProperties\r\n    );\r\n\r\n    let resolutionPropertyHasChanged = false;\r\n    const initiatorIgoLayerSourceType =\r\n      initiatorIgoLayer.options.source.options.type;\r\n    const initiatorIgoLayerOgcFilterableDataSourceOptions = initiatorIgoLayer\r\n      .dataSource.options as OgcFilterableDataSourceOptions;\r\n    clbp.map((l) => {\r\n      if (\r\n        initiatorIgoLayer &&\r\n        l &&\r\n        getUid(initiatorIgoLayer.ol) !== getUid(l?.ol)\r\n      ) {\r\n        const lLayerType = l.options.source.options.type;\r\n        if (isLayerProperty) {\r\n          l.ol.set(key, newValue, true);\r\n          if (key === 'visible') {\r\n            l.visible$.next(newValue);\r\n          }\r\n          if (key === 'minResolution' || key === 'maxResolution') {\r\n            resolutionPropertyHasChanged = true;\r\n          }\r\n        } else if (isDatasourceProperty) {\r\n          if (key === 'ogcFilters') {\r\n            (l.dataSource as OgcFilterableDataSource).setOgcFilters(\r\n              newValue,\r\n              false\r\n            );\r\n            if (lLayerType === 'wfs') {\r\n              l.ol.getSource().refresh();\r\n            }\r\n            if (lLayerType === 'wms') {\r\n              let appliedOgcFilter;\r\n              if (initiatorIgoLayerSourceType === 'wfs') {\r\n                appliedOgcFilter = ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n                  initiatorIgoLayerOgcFilterableDataSourceOptions,\r\n                  (initiatorIgoLayer.dataSource.options as any)\r\n                    .fieldNameGeometry,\r\n                  undefined,\r\n                  map.viewController.getOlProjection()\r\n                );\r\n              } else if (initiatorIgoLayerSourceType === 'wms') {\r\n                appliedOgcFilter = (\r\n                  initiatorIgoLayer.dataSource as WMSDataSource\r\n                ).ol.getParams().FILTER;\r\n              }\r\n              (l.dataSource as WMSDataSource).ol.updateParams({\r\n                FILTER: appliedOgcFilter\r\n              });\r\n            }\r\n          } else if (\r\n            l.dataSource instanceof WMSDataSource &&\r\n            key === 'timeFilter'\r\n          ) {\r\n            (l.dataSource as TimeFilterableDataSource).setTimeFilter(\r\n              newValue,\r\n              false\r\n            );\r\n            const appliedTimeFilter = (\r\n              initiatorIgoLayer.ol.getSource() as olSourceImageWMS\r\n            ).getParams().TIME;\r\n            l.dataSource.ol.updateParams({ TIME: appliedTimeFilter });\r\n          }\r\n        }\r\n      }\r\n    });\r\n    if (resolutionPropertyHasChanged) {\r\n      map.viewController.resolution$.next(map.viewController.resolution$.value);\r\n    }\r\n  }\r\n}\r\n","import { ConfigService, StorageService } from '@igo2/core';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport olMap from 'ol/Map';\r\nimport { ObjectEvent } from 'ol/Object';\r\nimport olView, { ViewOptions } from 'ol/View';\r\nimport olControlAttribution from 'ol/control/Attribution';\r\nimport olControlScaleLine from 'ol/control/ScaleLine';\r\nimport * as olinteraction from 'ol/interaction';\r\nimport olLayer from 'ol/layer/Layer';\r\nimport * as olproj from 'ol/proj';\r\nimport OlProjection from 'ol/proj/Projection';\r\nimport * as olproj4 from 'ol/proj/proj4';\r\nimport olSource from 'ol/source/Source';\r\nimport { getUid } from 'ol/util';\r\n\r\nimport proj4 from 'proj4';\r\nimport { BehaviorSubject, Subject, pairwise, skipWhile } from 'rxjs';\r\n\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { Layer, VectorLayer } from '../../layer/shared/layers';\r\nimport { Overlay } from '../../overlay/shared/overlay';\r\nimport { LayerWatcher } from '../utils/layer-watcher';\r\nimport { MapGeolocationController } from './controllers/geolocation';\r\nimport { MapViewController } from './controllers/view';\r\nimport {\r\n  getAllChildLayersByDeletion,\r\n  getRootParentByDeletion,\r\n  handleLayerPropertyChange,\r\n  initLayerSyncFromRootParentLayers\r\n} from './linkedLayers.utils';\r\nimport { MapBase } from './map.abstract';\r\nimport {\r\n  MapAttributionOptions,\r\n  MapControlsOptions,\r\n  MapExtent,\r\n  MapOptions,\r\n  MapScaleLineOptions,\r\n  MapViewOptions\r\n} from './map.interface';\r\n\r\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\r\n// Move some stuff into controllers.\r\nexport class IgoMap implements MapBase {\r\n  public ol: olMap;\r\n  public forcedOffline$ = new BehaviorSubject<boolean>(false);\r\n  public layers$ = new BehaviorSubject<Layer[]>([]);\r\n  public layersAddedByClick$ = new BehaviorSubject<Layer[]>(undefined);\r\n  public status$: Subject<SubjectStatus>;\r\n  public propertyChange$: Subject<{ event: ObjectEvent; layer: Layer }>;\r\n  public overlay: Overlay;\r\n  public queryResultsOverlay: Overlay;\r\n  public searchResultsOverlay: Overlay;\r\n  public viewController: MapViewController;\r\n  public geolocationController: MapGeolocationController;\r\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\r\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\r\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\r\n\r\n  public bufferDataSource: FeatureDataSource;\r\n\r\n  private layerWatcher: LayerWatcher;\r\n  private options: MapOptions;\r\n  private mapViewOptions: MapViewOptions;\r\n  private defaultOptions: Partial<MapOptions> = {\r\n    controls: { attribution: false }\r\n  };\r\n\r\n  get layers(): Layer[] {\r\n    return this.layers$.value;\r\n  }\r\n\r\n  /** @deprecated use projectionCode */\r\n  get projection(): string {\r\n    return this.projectionCode;\r\n  }\r\n\r\n  get viewProjection(): olproj.Projection {\r\n    return this.viewController.getOlProjection();\r\n  }\r\n\r\n  get projectionCode(): string {\r\n    return this.viewProjection.getCode();\r\n  }\r\n\r\n  constructor(\r\n    options?: MapOptions,\r\n    private storageService?: StorageService,\r\n    private configService?: ConfigService\r\n  ) {\r\n    this.options = Object.assign({}, this.defaultOptions, options);\r\n    this.layerWatcher = new LayerWatcher();\r\n    this.status$ = this.layerWatcher.status$;\r\n    this.propertyChange$ = this.layerWatcher.propertyChange$;\r\n    olproj4.register(proj4);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    const controls = [];\r\n    if (this.options.controls) {\r\n      if (this.options.controls.attribution) {\r\n        const attributionOpt = (\r\n          this.options.controls.attribution === true\r\n            ? {}\r\n            : this.options.controls.attribution\r\n        ) as MapAttributionOptions;\r\n        controls.push(new olControlAttribution(attributionOpt));\r\n      }\r\n      if (this.options.controls.scaleLine) {\r\n        const scaleLineOpt = (\r\n          this.options.controls.scaleLine === true\r\n            ? {}\r\n            : this.options.controls.scaleLine\r\n        ) as MapScaleLineOptions;\r\n        controls.push(new olControlScaleLine(scaleLineOpt));\r\n      }\r\n    }\r\n    let interactions = {};\r\n    if (this.options.interactions === false) {\r\n      interactions = {\r\n        altShiftDragRotate: false,\r\n        doubleClickZoom: false,\r\n        keyboard: false,\r\n        mouseWheelZoom: false,\r\n        shiftDragZoom: false,\r\n        dragPan: false,\r\n        pinchRotate: false,\r\n        pinchZoom: false\r\n      };\r\n    }\r\n\r\n    this.ol = new olMap({\r\n      interactions: olinteraction.defaults(interactions),\r\n      controls\r\n    });\r\n\r\n    this.setView(this.options.view || {});\r\n    this.viewController = new MapViewController({\r\n      stateHistory: true\r\n    });\r\n    this.viewController.setOlMap(this.ol);\r\n    this.overlay = new Overlay(this);\r\n    this.queryResultsOverlay = new Overlay(this);\r\n    this.searchResultsOverlay = new Overlay(this);\r\n    this.ol.once('rendercomplete', () => {\r\n      this.geolocationController = new MapGeolocationController(\r\n        this,\r\n        {\r\n          projection: this.viewController.getOlProjection()\r\n        },\r\n        this.storageService,\r\n        this.configService\r\n      );\r\n      this.geolocationController.setOlMap(this.ol);\r\n      if (this.geolocationController) {\r\n        this.geolocationController.updateGeolocationOptions(\r\n          this.mapViewOptions\r\n        );\r\n      }\r\n      this.layers$.pipe(pairwise()).subscribe(([prevLayers, currentLayers]) => {\r\n        let prevLayersId;\r\n        if (prevLayers) {\r\n          prevLayersId = prevLayers.map((l) => l.id);\r\n        }\r\n        const layers = currentLayers.filter(\r\n          (l) => !prevLayersId.includes(l.id)\r\n        );\r\n\r\n        for (const layer of layers) {\r\n          if (layer.options.linkedLayers) {\r\n            layer.ol.once('postrender', () => {\r\n              initLayerSyncFromRootParentLayers(this, layers);\r\n            });\r\n          }\r\n        }\r\n      });\r\n      this.viewController.monitorRotation();\r\n    });\r\n    this.propertyChange$\r\n      .pipe(skipWhile((pc) => !pc))\r\n      .subscribe((p) => handleLayerPropertyChange(this, p.event, p.layer));\r\n  }\r\n\r\n  setTarget(id: string) {\r\n    this.ol.setTarget(id);\r\n    if (id !== undefined) {\r\n      this.layerWatcher.subscribe(() => {}, null);\r\n    } else {\r\n      this.layerWatcher.unsubscribe();\r\n    }\r\n  }\r\n\r\n  updateView(options: MapViewOptions) {\r\n    const currentView = this.ol.getView();\r\n    const viewOptions: MapViewOptions = {\r\n      ...currentView.getProperties(),\r\n      ...options\r\n    };\r\n\r\n    if (options.zoom && options.resolution == null) {\r\n      viewOptions.resolution = undefined;\r\n    }\r\n\r\n    this.setView(viewOptions);\r\n    if (options.maxZoomOnExtent) {\r\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\r\n    }\r\n    this.mapViewOptions = options;\r\n  }\r\n\r\n  /**\r\n   * Set the map view\r\n   * @param options Map view options\r\n   */\r\n  setView(options: MapViewOptions) {\r\n    if (this.viewController !== undefined) {\r\n      this.viewController.clearStateHistory();\r\n    }\r\n\r\n    const viewOptions: ViewOptions = { constrainResolution: true, ...options };\r\n    if (options.center) {\r\n      viewOptions.center = olproj.fromLonLat(\r\n        options.center,\r\n        options.projection\r\n      );\r\n    }\r\n\r\n    this.ol.setView(new olView(viewOptions));\r\n\r\n    if (options.maxLayerZoomExtent) {\r\n      this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\r\n    }\r\n  }\r\n\r\n  updateControls(value: MapControlsOptions) {\r\n    if (value === undefined) {\r\n      return;\r\n    }\r\n\r\n    const controls = [];\r\n    if (value.attribution) {\r\n      const attributionOpt = (\r\n        value.attribution === true ? {} : value.attribution\r\n      ) as MapAttributionOptions;\r\n      controls.push(new olControlAttribution(attributionOpt));\r\n    }\r\n    if (value.scaleLine) {\r\n      const scaleLineOpt = (\r\n        value.scaleLine === true ? {} : value.scaleLine\r\n      ) as MapScaleLineOptions;\r\n      controls.push(new olControlScaleLine(scaleLineOpt));\r\n    }\r\n\r\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\r\n    currentControls.forEach((control) => {\r\n      this.ol.removeControl(control);\r\n    });\r\n    controls.forEach((control) => {\r\n      this.ol.addControl(control);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * TODO: Move to ViewController and update every place it's used\r\n   */\r\n  getCenter(projection?: string | OlProjection): [number, number] {\r\n    return this.viewController.getCenter(projection);\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * TODO: Move to ViewController and update every place it's used\r\n   */\r\n  getExtent(projection?: string | OlProjection): MapExtent {\r\n    return this.viewController.getExtent(projection);\r\n  }\r\n  /**\r\n   * @deprecated\r\n   * TODO: Move to ViewController and update every place it's used\r\n   */\r\n  getZoom(): number {\r\n    return this.viewController.getZoom();\r\n  }\r\n\r\n  changeBaseLayer(baseLayer: Layer) {\r\n    if (!baseLayer) {\r\n      return;\r\n    }\r\n\r\n    for (const bl of this.getBaseLayers()) {\r\n      bl.visible = false;\r\n    }\r\n\r\n    baseLayer.visible = true;\r\n\r\n    this.viewController.olView.setMinZoom(\r\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\r\n    );\r\n    this.viewController.olView.setMaxZoom(\r\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\r\n    );\r\n  }\r\n\r\n  getBaseLayers(): Layer[] {\r\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\r\n  }\r\n\r\n  getLayerById(id: string): Layer {\r\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\r\n  }\r\n\r\n  getLayerByAlias(alias: string): Layer {\r\n    return this.layers.find(\r\n      (layer: Layer) => layer.alias && layer.alias === alias\r\n    );\r\n  }\r\n\r\n  getLayerByOlUId(olUId: string): Layer {\r\n    return this.layers.find(\r\n      (layer: Layer) => getUid(layer.ol) && getUid(layer.ol) === olUId\r\n    );\r\n  }\r\n\r\n  getLayerByOlLayer(olLayer: olLayer<olSource>): Layer {\r\n    const olUId = getUid(olLayer);\r\n    return this.getLayerByOlUId(olUId);\r\n  }\r\n\r\n  /**\r\n   * Add a single layer\r\n   * @param layer Layer to add\r\n   * @param push DEPRECATED\r\n   */\r\n  addLayer(layer: Layer, push = true) {\r\n    this.addLayers([layer]);\r\n  }\r\n\r\n  /**\r\n   * Add many layers\r\n   * @param layers Layers to add\r\n   * @param push DEPRECATED\r\n   */\r\n  addLayers(layers: Layer[], push = true) {\r\n    let offsetZIndex = 0;\r\n    let offsetBaseLayerZIndex = 0;\r\n    const addedLayers = layers\r\n      .map((layer: Layer) => {\r\n        if (!layer) {\r\n          return;\r\n        }\r\n        const offset = layer.zIndex\r\n          ? 0\r\n          : layer.baseLayer\r\n          ? offsetBaseLayerZIndex++\r\n          : offsetZIndex++;\r\n        return this.doAddLayer(layer, offset);\r\n      })\r\n      .filter((layer: Layer | undefined) => layer !== undefined);\r\n    this.setLayers([].concat(this.layers, addedLayers));\r\n  }\r\n\r\n  /**\r\n   * Remove a single layer\r\n   * @param layer Layer to remove\r\n   */\r\n  removeLayer(layer: Layer) {\r\n    this.removeLayers([layer]);\r\n  }\r\n\r\n  /**\r\n   * Remove many layers\r\n   * @param layers Layers to remove\r\n   */\r\n  removeLayers(layers: Layer[]) {\r\n    const newLayers = this.layers$.value.slice(0);\r\n    const layersToRemove = [];\r\n    layers.forEach((layer: Layer) => {\r\n      if (layer instanceof VectorLayer) {\r\n        layer.removeLayerFromIDB();\r\n      }\r\n      const index = newLayers.indexOf(layer);\r\n      if (index >= 0) {\r\n        layersToRemove.push(layer);\r\n        newLayers.splice(index, 1);\r\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\r\n        layersToRemove.map((linkedLayer) => {\r\n          const linkedIndex = newLayers.indexOf(linkedLayer);\r\n          if (linkedIndex >= 0) {\r\n            newLayers.splice(linkedIndex, 1);\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\r\n    this.setLayers(newLayers);\r\n  }\r\n\r\n  /**\r\n   * Build a list of linked layers to delete\r\n   * @param srcLayer Layer that has triggered the deletion\r\n   * @param layersToRemove list to append the layer to delete into\r\n   */\r\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\r\n    let rootParentByDeletion = getRootParentByDeletion(this, srcLayer);\r\n    if (!rootParentByDeletion) {\r\n      rootParentByDeletion = srcLayer;\r\n    }\r\n    const clbd = getAllChildLayersByDeletion(this, rootParentByDeletion, [\r\n      rootParentByDeletion\r\n    ]);\r\n    for (const layer of clbd) {\r\n      layersToRemove.push(layer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all layers\r\n   */\r\n  removeAllLayers() {\r\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\r\n    this.layers$.next([]);\r\n  }\r\n\r\n  raiseLayer(layer: Layer) {\r\n    const index = this.getLayerIndex(layer);\r\n    if (index > 1) {\r\n      this.moveLayer(layer, index, index - 1);\r\n    }\r\n  }\r\n\r\n  raiseLayers(layers: Layer[]) {\r\n    for (const layer of layers) {\r\n      this.raiseLayer(layer);\r\n    }\r\n  }\r\n\r\n  lowerLayer(layer: Layer) {\r\n    const index = this.getLayerIndex(layer);\r\n    if (index < this.layers.length - 1) {\r\n      this.moveLayer(layer, index, index + 1);\r\n    }\r\n  }\r\n\r\n  lowerLayers(layers: Layer[]) {\r\n    const reverseLayers = layers.reverse();\r\n    for (const layer of reverseLayers) {\r\n      this.lowerLayer(layer);\r\n    }\r\n  }\r\n\r\n  moveLayer(layer: Layer, from: number, to: number) {\r\n    const layerTo = this.layers[to];\r\n    const zIndexTo = layerTo.zIndex;\r\n    const zIndexFrom = layer.zIndex;\r\n\r\n    if (layerTo.baseLayer || layer.baseLayer) {\r\n      return;\r\n    }\r\n\r\n    layer.zIndex = zIndexTo;\r\n    layerTo.zIndex = zIndexFrom;\r\n\r\n    this.layers[to] = layer;\r\n    this.layers[from] = layerTo;\r\n    this.layers$.next(this.layers.slice(0));\r\n  }\r\n\r\n  /**\r\n   * Add a layer to the OL map and start watching. If the layer is already\r\n   * added to this map, make it visible but don't add it one again.\r\n   * @param layer Layer\r\n   * @returns The layer added, if any\r\n   */\r\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\r\n    if (layer.baseLayer && layer.visible) {\r\n      this.changeBaseLayer(layer);\r\n    }\r\n\r\n    const existingLayer = this.getLayerById(layer.id);\r\n    if (existingLayer !== undefined) {\r\n      existingLayer.visible = true;\r\n      return;\r\n    }\r\n\r\n    if (!layer.baseLayer && layer.zIndex) {\r\n      layer.zIndex += 10;\r\n    }\r\n\r\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\r\n      const maxZIndex = Math.max(\r\n        layer.baseLayer ? 0 : 10,\r\n        ...this.layers\r\n          .filter(\r\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\r\n          )\r\n          .map((l) => l.zIndex)\r\n      );\r\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\r\n    }\r\n\r\n    if (layer.baseLayer && layer.zIndex > 9) {\r\n      layer.zIndex = 10; // baselayer must have zIndex < 10\r\n    }\r\n\r\n    layer.setMap(this);\r\n    this.layerWatcher.watchLayer(layer);\r\n    this.ol.addLayer(layer.ol);\r\n\r\n    return layer;\r\n  }\r\n\r\n  /**\r\n   * Remove a layer from the OL map and stop watching\r\n   * @param layer Layer\r\n   */\r\n  private doRemoveLayer(layer: Layer) {\r\n    this.layerWatcher.unwatchLayer(layer);\r\n    this.ol.removeLayer(layer.ol);\r\n    layer.setMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Update the layers observable\r\n   * @param layers Layers\r\n   */\r\n  private setLayers(layers: Layer[]) {\r\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\r\n  }\r\n\r\n  /**\r\n   * Sort layers by descending zIndex\r\n   * @param layers Array of layers\r\n   * @returns The original array, sorted by zIndex\r\n   */\r\n  private sortLayersByZIndex(layers: Layer[]) {\r\n    // Sort by descending zIndex\r\n    return layers.sort(\r\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get layer index in the map's inenr array of layers\r\n   * @param layer Layer\r\n   * @returns The layer index\r\n   */\r\n  private getLayerIndex(layer: Layer) {\r\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\r\n  }\r\n}\r\n","import {\r\n  AfterViewInit,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { ActivityService } from '@igo2/core';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\r\n\r\n@Component({\r\n  selector: 'igo-map-browser',\r\n  templateUrl: './map-browser.component.html',\r\n  styleUrls: ['./map-browser.component.scss']\r\n})\r\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\r\n  private activityId: string;\r\n  private status$$: Subscription;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get view(): MapViewOptions {\r\n    return this._view;\r\n  }\r\n  set view(value: MapViewOptions) {\r\n    this._view = value;\r\n    if (this.map !== undefined) {\r\n      this.map.updateView(value);\r\n    }\r\n  }\r\n  private _view: MapViewOptions;\r\n\r\n  get controls(): MapControlsOptions {\r\n    return this._controls;\r\n  }\r\n\r\n  set controls(value: MapControlsOptions) {\r\n    this._controls = value;\r\n    if (this.map !== undefined) {\r\n      this.map.updateControls(value);\r\n    }\r\n  }\r\n  private _controls: MapControlsOptions;\r\n\r\n  public id = `igo-map-target-${new Date().getTime()}`;\r\n\r\n  constructor(private activityService: ActivityService) {}\r\n\r\n  ngOnInit() {\r\n    this.status$$ = this.map.status$.subscribe((status) =>\r\n      this.handleStatusChange(status)\r\n    );\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    this.map.setTarget(this.id);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.map.setTarget(undefined);\r\n    this.activityService.unregister(this.activityId);\r\n    this.status$$.unsubscribe();\r\n  }\r\n\r\n  private handleStatusChange(status: SubjectStatus) {\r\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\r\n      this.activityId = this.activityService.register();\r\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\r\n      this.activityService.unregister(this.activityId);\r\n      this.activityId = undefined;\r\n    }\r\n  }\r\n}\r\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import {\r\n  Directive,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { MediaService } from '@igo2/core';\r\n\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { transform } from 'ol/proj';\r\n\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { IgoMap } from '../../map/shared/map';\r\n\r\n/**\r\n * This directive return the pointer coordinate (on click or pointermove)\r\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\r\n * to avoid too many emitted values.\r\n */\r\n@Directive({\r\n  selector: '[igoPointerPosition]'\r\n})\r\nexport class PointerPositionDirective implements OnInit, OnDestroy {\r\n  private lastTimeoutRequest;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener;\r\n\r\n  /**\r\n   * Listener to the map click event\r\n   */\r\n  private mapClickListener;\r\n\r\n  /**\r\n   * Delay before emitting an event\r\n   */\r\n  @Input() pointerPositionDelay: number = 1000;\r\n\r\n  /**\r\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\r\n   */\r\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.listenToMapPointerMove();\r\n    this.listenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * Stop listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unlistenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: MapBrowserPointerEvent<any>) =>\r\n        this.onPointerEvent(event, this.pointerPositionDelay)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On map click\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    unByKey(this.pointerMoveListener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map clicks\r\n   */\r\n  private unlistenToMapClick() {\r\n    this.mapClickListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\r\n    if (event.dragging || this.mediaService.isTouchScreen()) {\r\n      return;\r\n    }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n\r\n    const lonlat = transform(\r\n      event.coordinate,\r\n      this.mapProjection,\r\n      'EPSG:4326'\r\n    ) as [number, number];\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      this.pointerPositionCoord.emit(lonlat);\r\n    }, delay);\r\n  }\r\n}\r\n","import olFeature from 'ol/Feature';\r\nimport * as olGeom from 'ol/geom';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olStyle from 'ol/style';\r\n\r\nimport { StyleService } from '../../style-service/style.service';\r\n\r\nexport function featureRandomStyleFunction(): (\r\n  olFeature: olFeature<OlGeometry>,\r\n  resolution: number\r\n) => olStyle.Style {\r\n  const r = Math.floor(Math.random() * 255);\r\n  const g = Math.floor(Math.random() * 255);\r\n  const b = Math.floor(Math.random() * 255);\r\n  const stroke = new olStyle.Stroke({\r\n    color: [r, g, b, 1],\r\n    width: 2\r\n  });\r\n  const fill = new olStyle.Fill({\r\n    color: [r, g, b, 0.4]\r\n  });\r\n  return (olFeature: olFeature<OlGeometry>, resolution: number) => {\r\n    const customStyle = olFeature.get('_style');\r\n    if (customStyle) {\r\n      if (\r\n        customStyle.circle &&\r\n        olFeature.get('rad') &&\r\n        olFeature.get('longitude') &&\r\n        olFeature.get('latitude')\r\n      ) {\r\n        const lonLat: [number, number] = [\r\n          olFeature.get('longitude'),\r\n          olFeature.get('latitude')\r\n        ];\r\n        const radius =\r\n          olFeature.get('rad') /\r\n          Math.cos((Math.PI / 180) * lonLat[1]) /\r\n          resolution;\r\n        customStyle.circle.radius = radius;\r\n      }\r\n      const styleService = new StyleService();\r\n      return styleService.createStyle(customStyle, undefined, resolution);\r\n    }\r\n    const style = new olStyle.Style({\r\n      stroke,\r\n      fill,\r\n      image: new olStyle.Circle({\r\n        radius: 5,\r\n        stroke,\r\n        fill\r\n      }),\r\n      text: olFeature.get('_mapTitle')\r\n        ? new olStyle.Text({\r\n            text: olFeature.get('_mapTitle').toString(),\r\n            offsetX: 5,\r\n            offsetY: -5,\r\n            font: '12px Calibri,sans-serif',\r\n            fill: new olStyle.Fill({ color: '#000' }),\r\n            stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\r\n            overflow: true\r\n          })\r\n        : undefined\r\n    });\r\n    return style;\r\n  };\r\n}\r\n\r\nexport function featureRandomStyle(): olStyle.Style {\r\n  const r = Math.floor(Math.random() * 255);\r\n  const g = Math.floor(Math.random() * 255);\r\n  const b = Math.floor(Math.random() * 255);\r\n  const stroke = new olStyle.Stroke({\r\n    color: [r, g, b, 1],\r\n    width: 2\r\n  });\r\n  const fill = new olStyle.Fill({\r\n    color: [r, g, b, 0.4]\r\n  });\r\n\r\n  const style = new olStyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olStyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    })\r\n  });\r\n  return style;\r\n}\r\n\r\n/**\r\n * Create a default style for the pointer position and it's label summary.\r\n * @param feature olFeature\r\n * @returns OL style function\r\n */\r\nexport function hoverFeatureMarkerStyle(\r\n  feature: olFeature<olGeom.Geometry>,\r\n  resolution: number\r\n): olStyle.Style[] {\r\n  const olStyleText = new olStyle.Style({\r\n    text: new olStyle.Text({\r\n      text: feature.get('hoverSummary'),\r\n      textAlign: 'left',\r\n      textBaseline: 'top',\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olStyle.Fill({ color: '#000' }),\r\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\r\n      backgroundStroke: new olStyle.Stroke({\r\n        color: 'rgba(200, 200, 200, 0.75)',\r\n        width: 2\r\n      }),\r\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true,\r\n      offsetX: 10,\r\n      offsetY: 20,\r\n      padding: [2.5, 2.5, 2.5, 2.5]\r\n    })\r\n  });\r\n  const olStyles = [olStyleText];\r\n  switch (feature.getGeometry().getType()) {\r\n    case 'Point':\r\n      olStyles.push(\r\n        new olStyle.Style({\r\n          image: new olStyle.Circle({\r\n            radius: 10,\r\n            stroke: new olStyle.Stroke({\r\n              color: 'blue',\r\n              width: 3\r\n            })\r\n          })\r\n        })\r\n      );\r\n      break;\r\n    default:\r\n      olStyles.push(\r\n        new olStyle.Style({\r\n          stroke: new olStyle.Stroke({\r\n            color: 'white',\r\n            width: 5\r\n          })\r\n        })\r\n      );\r\n      olStyles.push(\r\n        new olStyle.Style({\r\n          stroke: new olStyle.Stroke({\r\n            color: 'blue',\r\n            width: 3\r\n          })\r\n        })\r\n      );\r\n  }\r\n\r\n  return olStyles;\r\n}\r\n\r\n/**\r\n * Create a default style for the pointer position and it's label summary.\r\n * @param feature olFeature\r\n * @returns OL style function\r\n */\r\nexport function pointerPositionSummaryMarkerStyle(\r\n  feature: olFeature<OlGeometry>,\r\n  resolution: number\r\n): olStyle.Style {\r\n  return new olStyle.Style({\r\n    image: new olStyle.Icon({\r\n      src: './assets/igo2/geo/icons/cross_black_18px.svg'\r\n    }),\r\n\r\n    text: new olStyle.Text({\r\n      text: feature.get('pointerSummary'),\r\n      textAlign: 'left',\r\n      textBaseline: 'bottom',\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olStyle.Fill({ color: '#000' }),\r\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\r\n      backgroundStroke: new olStyle.Stroke({\r\n        color: 'rgba(200, 200, 200, 0.75)',\r\n        width: 2\r\n      }),\r\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true,\r\n      offsetX: 10,\r\n      offsetY: -10,\r\n      padding: [2.5, 2.5, 2.5, 2.5]\r\n    })\r\n  });\r\n}\r\n","import {\r\n  Directive,\r\n  HostListener,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { MediaService } from '@igo2/core';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\r\nimport { unByKey } from 'ol/Observable';\r\nimport * as OlGeom from 'ol/geom';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olLayerVector from 'ol/layer/Vector';\r\nimport olLayerVectorTile from 'ol/layer/VectorTile';\r\nimport RenderFeature from 'ol/render/Feature';\r\nimport olVectorTileSource from 'ol/source/VectorTile';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { first } from 'rxjs/operators';\r\n\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\r\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport { Layer, VectorLayer, VectorTileLayer } from '../../layer/shared/layers';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { hoverFeatureMarkerStyle } from '../../style/shared/feature/feature-style';\r\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\n\r\n/**\r\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\r\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\r\n * By default, no search sources. Config in config file must be defined.\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoHoverFeature]'\r\n})\r\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\r\n  public store: FeatureStore<Feature>;\r\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> =\r\n    new EntityStore<OlFeature<OlGeometry>>([]);\r\n  private lastTimeoutRequest;\r\n  private store$$: Subscription;\r\n  private layers$$: Subscription;\r\n\r\n  private selectionLayer: olLayerVectorTile;\r\n  private selectionMVT = {};\r\n  private mvtStyleOptions: StyleByAttribute;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener;\r\n\r\n  private singleClickMapListener;\r\n\r\n  private hoverFeatureId: string = 'hoverFeatureId';\r\n  /**\r\n   * The delay where the mouse must be motionless before trigger the reverse search\r\n   */\r\n  @Input() igoHoverFeatureDelay: number = 1000;\r\n\r\n  /**\r\n   * If the user has enabled or not the directive\r\n   */\r\n  @Input() igoHoverFeatureEnabled: boolean = false;\r\n\r\n  @HostListener('mouseout')\r\n  mouseout() {\r\n    clearTimeout(this.lastTimeoutRequest);\r\n    this.clearLayer();\r\n  }\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private mediaService: MediaService,\r\n    private styleService: StyleService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.listenToMapPointerMove();\r\n    this.subscribeToPointerStore();\r\n    this.listenToMapClick();\r\n\r\n    this.map.status$\r\n      .pipe(first((status) => status === SubjectStatus.Done))\r\n      .subscribe(() => {\r\n        this.store = new FeatureStore<Feature>([], { map: this.map });\r\n        this.initStore();\r\n      });\r\n\r\n    // To handle context change without using the contextService.\r\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\r\n      if (this.store && !layers.find((l) => l.id === 'hoverFeatureId')) {\r\n        this.initStore();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize the pointer position store\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      isIgoInternalLayer: true,\r\n      id: 'hoverFeatureId',\r\n      title: 'hoverFeature',\r\n      zIndex: 900,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      style: hoverFeatureMarkerStyle\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n\r\n    this.selectionLayer = new olLayerVectorTile({\r\n      map: this.map.ol,\r\n      zIndex: 901,\r\n      renderMode: 'vector',\r\n      declutter: true,\r\n      source: new olVectorTileSource({ projection: this.map.projection }),\r\n      style: (feature, resolution) => {\r\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\r\n          return this.createHoverStyle(\r\n            feature,\r\n            this.mvtStyleOptions,\r\n            resolution\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  createHoverStyle(\r\n    feature: RenderFeature | OlFeature<OlGeometry>,\r\n    hoverStyle: StyleByAttribute,\r\n    resolution: number\r\n  ) {\r\n    const localHoverStyle = { ...hoverStyle };\r\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\r\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\r\n\r\n    if (!feature.get('_isLabel')) {\r\n      localHoverStyle.label = undefined;\r\n      hasLabelStyle = false;\r\n      label = undefined;\r\n    } else {\r\n      // clear the style for label....\r\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\r\n      const radius = [];\r\n      const stroke = [];\r\n      const width = [];\r\n      const fill = [];\r\n      for (let i = 0; i < size; i++) {\r\n        radius.push(0);\r\n        stroke.push('rgba(255, 255, 255, 0)');\r\n        width.push(0);\r\n        fill.push('rgba(255, 255, 255, 0)');\r\n      }\r\n      localHoverStyle.radius = radius;\r\n      localHoverStyle.stroke = stroke;\r\n      localHoverStyle.width = width;\r\n      localHoverStyle.fill = fill;\r\n    }\r\n    if (!hasLabelStyle && label) {\r\n      localHoverStyle.label.style = {\r\n        textAlign: 'left',\r\n        textBaseline: 'top',\r\n        font: '12px Calibri,sans-serif',\r\n        fill: { color: '#000' },\r\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\r\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\r\n        stroke: { color: '#fff', width: 3 },\r\n        overflow: true,\r\n        offsetX: 10,\r\n        offsetY: 20,\r\n        padding: [2.5, 2.5, 2.5, 2.5]\r\n      };\r\n    }\r\n    return this.styleService.createStyleByAttribute(\r\n      feature,\r\n      localHoverStyle,\r\n      resolution\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unsubscribeToPointerStore();\r\n    this.unlistenToMapSingleClick();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to pointermove result store\r\n   * @internal\r\n   */\r\n  subscribeToPointerStore() {\r\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(\r\n      (resultsUnderPointerPosition) => {\r\n        this.addFeatureOverlay(resultsUnderPointerPosition);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On map singleclick\r\n   */\r\n  private listenToMapClick() {\r\n    this.singleClickMapListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to pointer store.\r\n   * @internal\r\n   */\r\n  unsubscribeToPointerStore() {\r\n    this.store$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   * @internal\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    unByKey(this.pointerMoveListener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map singleclick\r\n   * @internal\r\n   */\r\n  private unlistenToMapSingleClick() {\r\n    unByKey(this.singleClickMapListener);\r\n    this.singleClickMapListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Trigger clear layer on singleclick.\r\n   * @param event OL map browser singleclick event\r\n   */\r\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\r\n    this.clearLayer();\r\n  }\r\n\r\n  /**\r\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\r\n    if (\r\n      event.dragging ||\r\n      !this.igoHoverFeatureEnabled ||\r\n      this.mediaService.isTouchScreen()\r\n    ) {\r\n      this.clearLayer();\r\n      return;\r\n    }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n    let maximumZindex = -Infinity;\r\n    let topMostOlLayer;\r\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\r\n      this.map.ol.forEachFeatureAtPixel(\r\n        pixel,\r\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\r\n          if (!layerOL) {\r\n            return;\r\n          }\r\n          const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\r\n          if (!this.canProcessHover(igoLayer as any)) {\r\n            return;\r\n          }\r\n          if (igoLayer.zIndex <= maximumZindex) {\r\n            return;\r\n          }\r\n          maximumZindex = igoLayer.zIndex;\r\n          topMostOlLayer = layerOL;\r\n        },\r\n        {\r\n          hitTolerance: 10,\r\n          layerFilter: (olLayer) =>\r\n            olLayer instanceof olLayerVector ||\r\n            olLayer instanceof olLayerVectorTile\r\n        }\r\n      );\r\n      if (!topMostOlLayer) {\r\n        // To clear label\r\n        this.clearLayer();\r\n        this.pointerHoverFeatureStore.clear();\r\n        return;\r\n      }\r\n\r\n      this.map.ol.forEachFeatureAtPixel(\r\n        pixel,\r\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\r\n          // To avoid flashing feature\r\n          if (\r\n            mapFeature.get('hoverSummary') === undefined &&\r\n            mapFeature.getProperties() !==\r\n              this.pointerHoverFeatureStore.all()[0]?.getProperties()\r\n          ) {\r\n            this.clearLayer();\r\n            let igoLayer;\r\n            if (layerOL instanceof olLayerVector) {\r\n              const myLayerVector = this.map.getLayerByOlUId(\r\n                (layerOL as any).ol_uid\r\n              ) as VectorLayer;\r\n              if (!this.canProcessHover(myLayerVector)) {\r\n                return;\r\n              }\r\n              let localOlFeature = this.handleRenderFeature(mapFeature);\r\n              this.setLayerStyleFromOptions(myLayerVector, localOlFeature);\r\n              const featuresToLoad = [localOlFeature];\r\n              localOlFeature.set('_isLabel', false);\r\n              const myLabelOlFeature = new OlFeature();\r\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\r\n              const labelGeom =\r\n                localOlFeature.getGeometry().getType() === 'Point'\r\n                  ? localOlFeature.getGeometry()\r\n                  : new OlGeom.Point(event.coordinate);\r\n              myLabelOlFeature.setGeometry(labelGeom);\r\n              myLabelOlFeature.setId(localOlFeature.getId());\r\n              myLabelOlFeature.set('_isLabel', true);\r\n              this.setLayerStyleFromOptions(myLayerVector, myLabelOlFeature);\r\n              featuresToLoad.push(myLabelOlFeature);\r\n              this.pointerHoverFeatureStore.load(featuresToLoad);\r\n              igoLayer = myLayerVector;\r\n              return true;\r\n            }\r\n            if (layerOL instanceof olLayerVectorTile) {\r\n              const myLayerVectorTile = this.map.getLayerByOlUId(\r\n                (layerOL as any).ol_uid\r\n              ) as VectorTileLayer;\r\n              if (!this.canProcessHover(myLayerVectorTile)) {\r\n                return;\r\n              }\r\n              if (\r\n                myLayerVectorTile?.options?.igoStyle?.styleByAttribute\r\n                  ?.hoverStyle\r\n              ) {\r\n                this.mvtStyleOptions =\r\n                  myLayerVectorTile.options.igoStyle.styleByAttribute.hoverStyle;\r\n              } else if (myLayerVectorTile?.options?.igoStyle?.hoverStyle) {\r\n                this.mvtStyleOptions =\r\n                  myLayerVectorTile.options.igoStyle.hoverStyle;\r\n              }\r\n              this.selectionLayer.setSource(layerOL.getSource());\r\n              layerOL\r\n                .getFeatures(event.pixel)\r\n                .then(\r\n                  (mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\r\n                    if (!mvtFeatures.length) {\r\n                      this.selectionMVT = {};\r\n                      this.selectionLayer.changed();\r\n                      this.clearLayer();\r\n                      return;\r\n                    }\r\n                    const feature = mvtFeatures[0];\r\n                    if (!feature) {\r\n                      this.clearLayer();\r\n                      return;\r\n                    }\r\n                    let localOlFeature = this.handleRenderFeature(feature);\r\n                    localOlFeature.set('_isLabel', false);\r\n                    const myLabelOlFeature = new OlFeature();\r\n                    myLabelOlFeature.setProperties(\r\n                      localOlFeature.getProperties()\r\n                    );\r\n                    const labelGeom =\r\n                      localOlFeature.getGeometry().getType() === 'Point'\r\n                        ? localOlFeature.getGeometry()\r\n                        : new OlGeom.Point(event.coordinate);\r\n                    myLabelOlFeature.setGeometry(labelGeom);\r\n                    myLabelOlFeature.setId(localOlFeature.getId());\r\n                    myLabelOlFeature.set('_isLabel', true);\r\n                    this.setLayerStyleFromOptions(\r\n                      myLayerVectorTile,\r\n                      myLabelOlFeature\r\n                    );\r\n                    this.pointerHoverFeatureStore.load([myLabelOlFeature]);\r\n                    this.selectionMVT[feature.getId()] = localOlFeature;\r\n                    this.selectionLayer.changed();\r\n                  }\r\n                );\r\n              igoLayer = myLayerVectorTile;\r\n            }\r\n          }\r\n        },\r\n        {\r\n          hitTolerance: 10,\r\n          layerFilter: (olLayer) => olLayer === topMostOlLayer\r\n        }\r\n      );\r\n    }, this.igoHoverFeatureDelay);\r\n  }\r\n\r\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\r\n    if (!igoLayer) {\r\n      return false;\r\n    }\r\n    if (!igoLayer.visible) {\r\n      return false;\r\n    }\r\n    if (!igoLayer.options) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      !igoLayer.options.igoStyle?.styleByAttribute &&\r\n      !igoLayer.options.igoStyle?.hoverStyle\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      igoLayer.options.igoStyle?.styleByAttribute &&\r\n      !igoLayer.options.igoStyle?.styleByAttribute.hoverStyle &&\r\n      !igoLayer.options.igoStyle?.hoverStyle\r\n    ) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  handleRenderFeature(\r\n    feature: RenderFeature | OlFeature<OlGeometry>\r\n  ): OlFeature<OlGeometry> {\r\n    let localFeature: OlFeature<OlGeometry>;\r\n    if (feature instanceof RenderFeature) {\r\n      localFeature = new OlFeature({\r\n        geometry: this.getGeometry(feature)\r\n      });\r\n      localFeature.setId(feature.getId());\r\n    } else if (feature instanceof OlFeature) {\r\n      localFeature = feature;\r\n    }\r\n    localFeature.setProperties(feature.getProperties());\r\n    return localFeature;\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the pointer store\r\n   * @param text string\r\n   */\r\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\r\n    if (hoverEntity.length > 0) {\r\n      const result = hoverEntity[0];\r\n      this.clearLayer();\r\n      const feature = new OlFeature({\r\n        geometry: result.getGeometry(),\r\n        meta: { id: this.hoverFeatureId },\r\n        hoverSummary: this.getHoverSummary(result.getProperties())\r\n      });\r\n\r\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\r\n    }\r\n  }\r\n\r\n  private setLayerStyleFromOptions(\r\n    igoLayer: VectorLayer | VectorTileLayer,\r\n    feature: OlFeature<OlGeometry>\r\n  ) {\r\n    const resolution = this.store.layer.map.viewController.getResolution();\r\n    if (igoLayer?.options?.igoStyle?.styleByAttribute?.hoverStyle) {\r\n      this.store.layer.ol.setStyle(\r\n        this.createHoverStyle(\r\n          feature,\r\n          igoLayer.options.igoStyle.styleByAttribute.hoverStyle,\r\n          resolution\r\n        )\r\n      );\r\n      return;\r\n    }\r\n    if (igoLayer?.options?.igoStyle?.hoverStyle) {\r\n      this.store.layer.ol.setStyle(\r\n        this.createHoverStyle(\r\n          feature,\r\n          igoLayer.options.igoStyle.hoverStyle,\r\n          resolution\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  private getHoverSummary(properties): string {\r\n    let summary = '';\r\n    for (const [key, value] of Object.entries(properties)) {\r\n      if (!key.startsWith('_') && key !== 'geometry') {\r\n        summary += `${key}: ${value}` + '\\n';\r\n      }\r\n    }\r\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\r\n  }\r\n\r\n  private getGeometry(feature): OlGeom.Geometry {\r\n    let geom;\r\n    if (!feature.getOrientedFlatCoordinates) {\r\n      geom = feature.getGeometry();\r\n    } else {\r\n      const coords = feature.getOrientedFlatCoordinates();\r\n      const flatCoords = [];\r\n\r\n      coords.forEach((c, idx) => {\r\n        if (idx % 2 === 0) {\r\n          flatCoords.push([\r\n            parseFloat(coords[idx]),\r\n            parseFloat(coords[idx + 1])\r\n          ]);\r\n        }\r\n      });\r\n\r\n      // TODO: test MultiX\r\n      switch (feature.getType()) {\r\n        case 'Point':\r\n          geom = new OlGeom.Point(flatCoords);\r\n          break;\r\n        case 'Polygon':\r\n          geom = new OlGeom.Polygon([flatCoords]);\r\n          break;\r\n        case 'LineString':\r\n          geom = new OlGeom.LineString([flatCoords]);\r\n          break;\r\n      }\r\n    }\r\n\r\n    return geom;\r\n  }\r\n\r\n  /**\r\n   * Clear the pointer store features\r\n   */\r\n  private clearLayer() {\r\n    this.selectionMVT = {};\r\n    if (this.selectionLayer) {\r\n      this.selectionLayer.changed();\r\n    }\r\n    if (this.store) {\r\n      this.store.clearLayer();\r\n    }\r\n  }\r\n}\r\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n  let lonMin = -54;\n  const lonMax = -81;\n  if (lon < lonMax || lon > lonMin) {\n    return 0;\n  } else {\n    const deltaLon = 3;\n    let zone = 2;\n    while (Math.abs(lon - lonMin) > deltaLon) {\n      lonMin = lonMin - deltaLon;\n      zone++;\n    }\n    return zone;\n  }\n}\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n  projectionsLimitations: ProjectionsLimitationsOptions\n): ProjectionsLimitationsOptions {\n  const mtmZone = projectionsLimitations.mtmZone;\n  const utmZone = projectionsLimitations.utmZone;\n  const projectionsConstraints = {\n    projFromConfig:\n      projectionsLimitations.projFromConfig === false ? false : true,\n    nad83: projectionsLimitations.nad83 === false ? false : true,\n    wgs84: projectionsLimitations.wgs84 === false ? false : true,\n    webMercator: projectionsLimitations.webMercator === false ? false : true,\n    utm: projectionsLimitations.utm === false ? false : true,\n    mtm: projectionsLimitations.mtm === false ? false : true,\n    utmZone: {\n      minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n      maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21\n    },\n    mtmZone: {\n      minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n      maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10\n    }\n  };\n  return projectionsConstraints;\n}\n","export enum InsertSourceInsertDBEnum {\n  System = 'system',\n  User = 'user'\n}\n","import { AuthInterceptor } from '@igo2/auth';\r\nimport { MessageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport OlFeature from 'ol/Feature';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\nimport { easeOut } from 'ol/easing';\r\nimport BaseEvent from 'ol/events/Event';\r\nimport { Extent } from 'ol/extent';\r\nimport { FeatureLoader } from 'ol/featureloader';\r\nimport * as olformat from 'ol/format';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olLayerVector from 'ol/layer/Vector';\r\nimport * as olproj from 'ol/proj';\r\nimport olProjection from 'ol/proj/Projection';\r\nimport { getVectorContext } from 'ol/render';\r\nimport olSourceVector from 'ol/source/Vector';\r\n\r\nimport { fromEvent, of, zip } from 'rxjs';\r\nimport {\r\n  catchError,\r\n  concatMap,\r\n  debounceTime,\r\n  delay,\r\n  first\r\n} from 'rxjs/operators';\r\n\r\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\r\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\r\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\r\nimport { FeatureDataSourceOptions } from '../../../datasource/shared/datasources/feature-datasource.interface';\r\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\r\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\r\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport {\r\n  buildUrl,\r\n  defaultMaxFeatures\r\n} from '../../../datasource/shared/datasources/wms-wfs.utils';\r\nimport {\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFiltersOptions\r\n} from '../../../filter/shared/ogc-filter.interface';\r\nimport { IgoMap, MapExtent, getResolutionFromScale } from '../../../map/shared';\r\nimport { LayerDBData } from '../../../offline';\r\nimport { InsertSourceInsertDBEnum } from '../../../offline/geoDB/geoDB.enums';\r\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\r\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\r\nimport {\r\n  GeoNetworkService,\r\n  SimpleGetOptions\r\n} from '../../../offline/shared/geo-network.service';\r\nimport { olStyleToBasicIgoStyle } from '../../../style/shared/vector/conversion.utils';\r\nimport { VectorWatcher } from '../../utils';\r\nimport { Layer } from './layer';\r\nimport { VectorLayerOptions } from './vector-layer.interface';\r\n\r\nexport class VectorLayer extends Layer {\r\n  private previousLoadExtent: Extent;\r\n  private previousLoadResolution: number;\r\n  private previousOgcFilters: OgcFiltersOptions;\r\n  private xhrAccumulator: XMLHttpRequest[] = [];\r\n  public declare dataSource:\r\n    | FeatureDataSource\r\n    | WFSDataSource\r\n    | ArcGISRestDataSource\r\n    | WebSocketDataSource\r\n    | ClusterDataSource;\r\n  public declare options: VectorLayerOptions;\r\n  public declare ol: olLayerVector<olSourceVector<OlGeometry>>;\r\n  private watcher: VectorWatcher;\r\n  private trackFeatureListenerId;\r\n\r\n  get browsable(): boolean {\r\n    return this.options.browsable !== false;\r\n  }\r\n\r\n  get exportable(): boolean {\r\n    return this.options.exportable !== false;\r\n  }\r\n\r\n  constructor(\r\n    options: VectorLayerOptions,\r\n    public messageService?: MessageService,\r\n    public authInterceptor?: AuthInterceptor,\r\n    private geoNetworkService?: GeoNetworkService,\r\n    public geoDBService?: GeoDBService,\r\n    public layerDBService?: LayerDBService\r\n  ) {\r\n    super(\r\n      options,\r\n      messageService,\r\n      authInterceptor,\r\n      geoDBService,\r\n      layerDBService\r\n    );\r\n    this.watcher = new VectorWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\r\n    const initialOpacityValue = this.options.opacity || 1;\r\n    const initialVisibleValue = this.options.visible !== false;\r\n    const initialMinResValue =\r\n      this.options.minResolution ||\r\n      getResolutionFromScale(Number(this.options.minScaleDenom));\r\n    const initialMaxResValue =\r\n      this.options.maxResolution ||\r\n      getResolutionFromScale(Number(this.options.maxScaleDenom));\r\n    const so = this.options.sourceOptions as FeatureDataSourceOptions;\r\n    if (this.dataSource instanceof FeatureDataSource) {\r\n      if (so?.preload?.bypassResolution || so?.preload?.bypassVisible) {\r\n        this.options.opacity = 0;\r\n        if (\r\n          so.preload.bypassResolution &&\r\n          (this.options.minResolution || this.options.maxResolution)\r\n        ) {\r\n          this.options.minResolution = 0;\r\n          this.options.maxResolution = Infinity;\r\n        }\r\n        if (so.preload.bypassVisible && !initialVisibleValue) {\r\n          this.options.visible = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceVector<OlGeometry>,\r\n      sourceOptions: this.options.sourceOptions || this.options.source.options\r\n    });\r\n\r\n    if (this.options.animation) {\r\n      this.dataSource.ol.on(\r\n        'addfeature',\r\n        function (e) {\r\n          this.flash(e.feature);\r\n        }.bind(this)\r\n      );\r\n    }\r\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\r\n      if (this.options.idbInfo.firstLoad) {\r\n        this.maintainFeaturesInIdb();\r\n      }\r\n      this.dataSource.ol.once('featuresloadend', () => {\r\n        this.dataSource.ol.on('addfeature', () => this.maintainFeaturesInIdb());\r\n        this.dataSource.ol.on('changefeature', () =>\r\n          this.maintainFeaturesInIdb()\r\n        );\r\n        this.dataSource.ol.on('clear', () => this.maintainFeaturesInIdb());\r\n        this.dataSource.ol.on('removefeature', () =>\r\n          this.maintainFeaturesInIdb()\r\n        );\r\n      });\r\n    }\r\n\r\n    if (\r\n      this.dataSource instanceof FeatureDataSource &&\r\n      (so?.preload?.bypassResolution || so?.preload?.bypassVisible)\r\n    ) {\r\n      this.dataSource.ol.once('featuresloadend', () => {\r\n        if (initialOpacityValue) {\r\n          this.opacity = initialOpacityValue;\r\n        }\r\n        if (so.preload.bypassResolution) {\r\n          this.minResolution = initialMinResValue;\r\n          this.maxResolution = initialMaxResValue;\r\n        }\r\n        if (so.preload.bypassVisible) {\r\n          this.visible = initialVisibleValue;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (this.options.trackFeature) {\r\n      this.enableTrackFeature(this.options.trackFeature);\r\n    }\r\n\r\n    const vector = new olLayerVector(olOptions);\r\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\r\n    const url = vectorSource.getUrl();\r\n    if (typeof url === 'function') {\r\n      return vector;\r\n    }\r\n    if (url || olOptions.sourceOptions?.type === 'wfs') {\r\n      let loader: FeatureLoader;\r\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\r\n      if (\r\n        wfsOptions?.type === 'wfs' &&\r\n        (wfsOptions.params || wfsOptions.paramsWFS)\r\n      ) {\r\n        loader = (extent, resolution, proj, success, failure) => {\r\n          this.customWFSLoader(\r\n            vectorSource,\r\n            wfsOptions,\r\n            this.authInterceptor,\r\n            extent,\r\n            resolution,\r\n            proj,\r\n            success,\r\n            failure\r\n          );\r\n        };\r\n      } else {\r\n        loader = (extent, resolution, proj, success, failure) => {\r\n          this.customLoader(\r\n            vectorSource,\r\n            url,\r\n            this.authInterceptor,\r\n            extent,\r\n            resolution,\r\n            proj,\r\n            success,\r\n            failure\r\n          );\r\n        };\r\n      }\r\n      if (loader) {\r\n        vectorSource.setLoader(loader);\r\n      }\r\n    } else if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\r\n      const idbLoader = (extent, resolution, proj, success, failure) => {\r\n        this.customIDBLoader(\r\n          vectorSource,\r\n          olOptions.id,\r\n          extent,\r\n          proj,\r\n          success,\r\n          failure\r\n        );\r\n      };\r\n      if (idbLoader) {\r\n        vectorSource.setLoader(idbLoader);\r\n      }\r\n    }\r\n\r\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\r\n      vector.once('sourceready', () => {\r\n        if (this.options.idbInfo.firstLoad) {\r\n          this.maintainOptionsInIdb();\r\n        }\r\n        fromEvent<BaseEvent>(vector, 'change')\r\n          .pipe(debounceTime(750))\r\n          .subscribe(() => this.maintainOptionsInIdb());\r\n        vector.on('change:zIndex', () => this.maintainOptionsInIdb());\r\n      });\r\n    }\r\n    return vector;\r\n  }\r\n\r\n  removeLayerFromIDB() {\r\n    if (this.geoDBService && this.layerDBService) {\r\n      zip(\r\n        this.geoDBService.deleteByKey(this.id),\r\n        this.layerDBService.deleteByKey(this.id)\r\n      ).subscribe();\r\n    }\r\n  }\r\n\r\n  private maintainOptionsInIdb() {\r\n    this.options.igoStyle.igoStyleObject = olStyleToBasicIgoStyle(this.ol);\r\n    const layerData: LayerDBData = ObjectUtils.removeUndefined({\r\n      layerId: this.id,\r\n      detailedContextUri: this.options.idbInfo.contextUri,\r\n      sourceOptions: {\r\n        id: this.id,\r\n        type: 'vector',\r\n        queryable: true\r\n      },\r\n      layerOptions: {\r\n        workspace: this.options.workspace,\r\n        zIndex: this.ol ? this.zIndex : 1000000,\r\n        id: this.id,\r\n        isIgoInternalLayer: this.isIgoInternalLayer,\r\n        title: this.title,\r\n        igoStyle: this.options.igoStyle,\r\n        idbInfo: Object.assign({}, this.options.idbInfo, { firstLoad: false })\r\n      },\r\n      insertEvent: `${this.title}-${this.id}-${new Date()}`\r\n    });\r\n    this.layerDBService.update(layerData);\r\n  }\r\n\r\n  private maintainFeaturesInIdb() {\r\n    const dsFeatures = this.dataSource.ol.getFeatures();\r\n    const geojsonObject = JSON.parse(\r\n      new olformat.GeoJSON().writeFeatures(dsFeatures, {\r\n        dataProjection: 'EPSG:4326',\r\n        featureProjection: this.dataSource.ol.getProjection() || 'EPSG:3857'\r\n      })\r\n    );\r\n    this.geoDBService.update(\r\n      this.id,\r\n      this.id,\r\n      geojsonObject,\r\n      InsertSourceInsertDBEnum.User,\r\n      `${this.title}-${this.id}-${new Date()}`\r\n    );\r\n  }\r\n\r\n  protected flash(feature) {\r\n    const start = new Date().getTime();\r\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\r\n\r\n    function animate(event) {\r\n      const vectorContext = getVectorContext(event);\r\n      const frameState = event.frameState;\r\n      const flashGeom = feature.getGeometry().clone();\r\n      const elapsed = frameState.time - start;\r\n      const elapsedRatio = elapsed / this.options.animation.duration;\r\n      const opacity = easeOut(1 - elapsedRatio);\r\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\r\n      newColor[3] = opacity;\r\n      let style = this.ol\r\n        .getStyleFunction()\r\n        .call(this, feature)\r\n        .find((style2) => {\r\n          return style2.getImage();\r\n        });\r\n      if (!style) {\r\n        style = this.ol.getStyleFunction().call(this, feature)[0];\r\n      }\r\n      const styleClone = style.clone();\r\n\r\n      switch (feature.getGeometry().getType()) {\r\n        case 'Point':\r\n          if (\r\n            styleClone.getImage() !== null &&\r\n            typeof styleClone.getImage().getRadius === 'function'\r\n          ) {\r\n            const radius =\r\n              easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\r\n            styleClone.getImage().setRadius(radius);\r\n            styleClone.getImage().setOpacity(opacity);\r\n          }\r\n\r\n          break;\r\n        case 'LineString':\r\n          // TODO\r\n          if (styleClone.getImage()) {\r\n            styleClone.getImage().getStroke().setColor(newColor);\r\n            styleClone\r\n              .getImage()\r\n              .getStroke()\r\n              .setWidth(\r\n                easeOut(elapsedRatio) *\r\n                  (styleClone.getImage().getStroke().getWidth() * 3)\r\n              );\r\n          }\r\n          if (styleClone.getStroke()) {\r\n            styleClone.getStroke().setColor(newColor);\r\n            styleClone\r\n              .getStroke()\r\n              .setWidth(\r\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\r\n              );\r\n          }\r\n          break;\r\n        case 'Polygon':\r\n          // TODO\r\n          if (styleClone.getImage()) {\r\n            styleClone.getImage().getFill().setColor(newColor);\r\n          }\r\n          if (styleClone.getFill()) {\r\n            styleClone.getFill().setColor(newColor);\r\n          }\r\n          break;\r\n      }\r\n\r\n      styleClone.setText('');\r\n      vectorContext.setStyle(styleClone);\r\n      vectorContext.drawGeometry(flashGeom);\r\n\r\n      if (elapsed > this.options.animation.duration) {\r\n        unByKey(listenerKey);\r\n        // remove last geometry\r\n        // there is a little flash before feature disappear, better solution ?\r\n        this.map.ol.render();\r\n        return;\r\n      }\r\n      // tell OpenLayers to continue postcompose animation\r\n      this.map.ol.render();\r\n    }\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n\r\n  public setExtent(extent: MapExtent): void {\r\n    this.options.extent = extent;\r\n  }\r\n\r\n  public onUnwatch() {\r\n    this.dataSource.onUnwatch();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  public stopAnimation() {\r\n    this.dataSource.ol.un(\r\n      'addfeature',\r\n      function (e) {\r\n        if (this.visible) {\r\n          this.flash(e.feature);\r\n        }\r\n      }.bind(this)\r\n    );\r\n  }\r\n\r\n  public enableTrackFeature(id: string | number) {\r\n    this.trackFeatureListenerId = this.dataSource.ol.on(\r\n      'addfeature',\r\n      this.trackFeature.bind(this, id)\r\n    );\r\n  }\r\n  public centerMapOnFeature(id: string | number) {\r\n    const feat = this.dataSource.ol.getFeatureById(id);\r\n    if (feat) {\r\n      this.map.ol\r\n        .getView()\r\n        .setCenter((feat.getGeometry() as any).getCoordinates());\r\n    }\r\n  }\r\n\r\n  public trackFeature(id, feat) {\r\n    if (feat.feature.getId() === id && this.visible) {\r\n      this.centerMapOnFeature(id);\r\n    }\r\n  }\r\n\r\n  public disableTrackFeature(id?: string | number) {\r\n    unByKey(this.trackFeatureListenerId);\r\n  }\r\n\r\n  /**\r\n   * Custom loader for a WFS datasource\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param options olOptions from source\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param resolution the current resolution\r\n   * @param proj the projection to retrieve the data\r\n   * @param success success callback\r\n   * @param failure failure callback\r\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\r\n   */\r\n  public customWFSLoader(\r\n    vectorSource: olSourceVector<OlGeometry>,\r\n    options: WFSDataSourceOptions,\r\n    interceptor: AuthInterceptor,\r\n    extent: Extent,\r\n    resolution: number,\r\n    proj: olProjection,\r\n    success: (features: olFeature<OlGeometry>[]) => void,\r\n    failure: () => void,\r\n    randomParam?: boolean\r\n  ) {\r\n    {\r\n      const paramsWFS = options.paramsWFS;\r\n      const wfsProj = paramsWFS.srsName\r\n        ? new olProjection({ code: paramsWFS.srsName })\r\n        : proj;\r\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\r\n      const ogcFilters = (options as OgcFilterableDataSourceOptions).ogcFilters;\r\n\r\n      if (\r\n        (this.previousLoadExtent &&\r\n          this.previousLoadExtent !== currentExtent) ||\r\n        (this.previousLoadResolution &&\r\n          this.previousLoadResolution !== resolution) ||\r\n        (this.previousOgcFilters && this.previousOgcFilters !== ogcFilters)\r\n      ) {\r\n        vectorSource.removeLoadedExtent(this.previousLoadExtent);\r\n        for (let xhr of this.xhrAccumulator) {\r\n          xhr.abort();\r\n        }\r\n      }\r\n\r\n      this.previousLoadExtent = currentExtent;\r\n      this.previousLoadResolution = resolution;\r\n      this.previousOgcFilters = ogcFilters;\r\n\r\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\r\n      const url = buildUrl(\r\n        options,\r\n        currentExtent,\r\n        wfsProj,\r\n        ogcFilters,\r\n        randomParam\r\n      );\r\n      let startIndex = 0;\r\n      if (\r\n        paramsWFS.version === '2.0.0' &&\r\n        paramsWFS.maxFeatures > defaultMaxFeatures\r\n      ) {\r\n        const nbOfFeature = 1000;\r\n        while (startIndex < paramsWFS.maxFeatures) {\r\n          let alteredUrl = url.replace(\r\n            'count=' + paramsWFS.maxFeatures,\r\n            'count=' + nbOfFeature\r\n          );\r\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\r\n          alteredUrl += '&startIndex=' + startIndex;\r\n          alteredUrl.replace(/&&/g, '&');\r\n          this.getFeatures(\r\n            vectorSource,\r\n            interceptor,\r\n            currentExtent,\r\n            wfsProj,\r\n            proj,\r\n            alteredUrl,\r\n            success,\r\n            failure\r\n          );\r\n          startIndex += nbOfFeature;\r\n        }\r\n      } else {\r\n        this.getFeatures(\r\n          vectorSource,\r\n          interceptor,\r\n          currentExtent,\r\n          wfsProj,\r\n          proj,\r\n          url,\r\n          success,\r\n          failure\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Custom loader to get feature from a WFS datasource\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param dataProjection the projection of the retrieved data\r\n   * @param featureProjection the projection of the created features\r\n   * @param url the url string to retrieve the data\r\n   * @param success success callback\r\n   * @param failure failure callback\r\n   */\r\n  private getFeatures(\r\n    vectorSource: olSourceVector<OlGeometry>,\r\n    interceptor: AuthInterceptor,\r\n    extent: Extent,\r\n    dataProjection: olProjection,\r\n    featureProjection: olProjection,\r\n    url: string,\r\n    success: (features: olFeature<OlGeometry>[]) => void,\r\n    failure: () => void\r\n  ) {\r\n    const xhr = new XMLHttpRequest();\r\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\r\n    let modifiedUrl = url;\r\n    if (alteredUrlWithKeyAuth) {\r\n      modifiedUrl = alteredUrlWithKeyAuth;\r\n    }\r\n    xhr.open('GET', modifiedUrl);\r\n    if (interceptor) {\r\n      interceptor.interceptXhr(xhr, modifiedUrl);\r\n    }\r\n    const onError = () => {\r\n      vectorSource.removeLoadedExtent(extent);\r\n      failure();\r\n    };\r\n    xhr.onerror = onError;\r\n    xhr.onload = () => {\r\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\r\n        const features = vectorSource\r\n          .getFormat()\r\n          .readFeatures(xhr.responseText, {\r\n            dataProjection,\r\n            featureProjection\r\n          }) as olFeature<OlGeometry>[];\r\n        if (features) {\r\n          vectorSource.addFeatures(features);\r\n          success(features);\r\n        } else {\r\n          success([]);\r\n        }\r\n      } else {\r\n        onError();\r\n      }\r\n    };\r\n    this.xhrAccumulator.push(xhr);\r\n    xhr.send();\r\n  }\r\n\r\n  /**\r\n   * Custom loader for vector layer.\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param url the url string or function to retrieve the data\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param resolution the current resolution\r\n   * @param projection the projection to retrieve the data\r\n   */\r\n  private customLoader(\r\n    vectorSource: olSourceVector<OlGeometry>,\r\n    url: string,\r\n    interceptor: AuthInterceptor,\r\n    extent: Extent,\r\n    resolution: number,\r\n    projection: olProjection,\r\n    success: (features: olFeature<OlGeometry>[]) => void,\r\n    failure: () => void\r\n  ) {\r\n    const xhr = new XMLHttpRequest();\r\n    let modifiedUrl = url;\r\n    if (typeof url !== 'function') {\r\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\r\n      if (alteredUrlWithKeyAuth) {\r\n        modifiedUrl = alteredUrlWithKeyAuth;\r\n      }\r\n    }\r\n\r\n    if (this.geoNetworkService && typeof url !== 'function') {\r\n      const format = vectorSource.getFormat();\r\n      const type = format.getType();\r\n\r\n      let responseType = type;\r\n      const onError = () => {\r\n        vectorSource.removeLoadedExtent(extent);\r\n        failure();\r\n      };\r\n\r\n      const options: SimpleGetOptions = { responseType };\r\n      this.geoNetworkService.geoDBService\r\n        .get(url)\r\n        .pipe(delay(750))\r\n        .pipe(\r\n          concatMap((r) =>\r\n            r\r\n              ? of(r)\r\n              : this.geoNetworkService.get(modifiedUrl as string, options).pipe(\r\n                  first(),\r\n                  catchError((res) => {\r\n                    onError();\r\n                    throw res;\r\n                  })\r\n                )\r\n          )\r\n        )\r\n        .subscribe((content) => {\r\n          if (content) {\r\n            const format = vectorSource.getFormat();\r\n            const type = format.getType();\r\n            let source;\r\n            if (type === 'json' || type === 'text') {\r\n              source = content;\r\n            } else if (type === 'xml') {\r\n              source = content;\r\n              if (!source) {\r\n                source = new DOMParser().parseFromString(\r\n                  content,\r\n                  'application/xml'\r\n                );\r\n              }\r\n            } else if (type === 'arraybuffer') {\r\n              source = content;\r\n            }\r\n            if (source) {\r\n              const features = format.readFeatures(source, {\r\n                extent,\r\n                featureProjection: projection\r\n              }) as OlFeature<OlGeometry>[];\r\n              vectorSource.addFeatures(features);\r\n              success(features);\r\n            } else {\r\n              onError();\r\n            }\r\n          }\r\n        });\r\n    } else {\r\n      xhr.open('GET', modifiedUrl as string);\r\n      const format = vectorSource.getFormat();\r\n      if (format.getType() === 'arraybuffer') {\r\n        xhr.responseType = 'arraybuffer';\r\n      }\r\n      if (interceptor) {\r\n        interceptor.interceptXhr(xhr, modifiedUrl as string);\r\n      }\r\n\r\n      const onError = () => {\r\n        vectorSource.removeLoadedExtent(extent);\r\n        failure();\r\n      };\r\n      xhr.onerror = onError;\r\n      xhr.onload = () => {\r\n        // status will be 0 for file:// urls\r\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\r\n          const type = format.getType();\r\n          let source;\r\n          if (type === 'json' || type === 'text') {\r\n            source = xhr.responseText;\r\n          } else if (type === 'xml') {\r\n            source = xhr.responseXML;\r\n            if (!source) {\r\n              source = new DOMParser().parseFromString(\r\n                xhr.responseText,\r\n                'application/xml'\r\n              );\r\n            }\r\n          } else if (type === 'arraybuffer') {\r\n            source = xhr.response;\r\n          }\r\n          if (source) {\r\n            const features = format.readFeatures(source, {\r\n              extent,\r\n              featureProjection: projection\r\n            }) as OlFeature<OlGeometry>[];\r\n            vectorSource.addFeatures(features);\r\n            success(features);\r\n          } else {\r\n            onError();\r\n          }\r\n        } else {\r\n          onError();\r\n        }\r\n      };\r\n      xhr.send();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Custom loader for vector layer.\r\n   * @internal\r\n   * @param vectorSource the vector source to be created\r\n   * @param layerID the url string or function to retrieve the data\r\n   * @param interceptor the interceptor of the data\r\n   * @param extent the extent of the requested data\r\n   * @param resolution the current resolution\r\n   * @param projection the projection to retrieve the data\r\n   */\r\n  private customIDBLoader(\r\n    vectorSource,\r\n    layerID,\r\n    extent,\r\n    projection,\r\n    success,\r\n    failure\r\n  ) {\r\n    if (this.geoNetworkService) {\r\n      const onError = () => {\r\n        vectorSource.removeLoadedExtent(extent);\r\n        failure();\r\n      };\r\n      this.geoNetworkService.geoDBService.get(layerID).subscribe((content) => {\r\n        if (content) {\r\n          const format = vectorSource.getFormat();\r\n          const type = format.getType();\r\n          let source;\r\n          if (type === 'json' || type === 'text') {\r\n            source = content;\r\n          } else if (type === 'xml') {\r\n            source = content;\r\n            if (!source) {\r\n              source = new DOMParser().parseFromString(\r\n                content,\r\n                'application/xml'\r\n              );\r\n            }\r\n          } else if (type === 'arraybuffer') {\r\n            source = content;\r\n          }\r\n          if (source) {\r\n            const features = format.readFeatures(source, {\r\n              extent,\r\n              featureProjection: projection\r\n            });\r\n            vectorSource.addFeatures(features, format.readProjection(source));\r\n            success(features);\r\n          } else {\r\n            onError();\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olLayerVector from 'ol/layer/Vector';\r\nimport olSourceVector from 'ol/source/Vector';\r\n\r\nexport function olStyleToBasicIgoStyle(\r\n  layer: olLayerVector<olSourceVector<OlGeometry>>\r\n) {\r\n  const layerOlStyle = layer.getStyle();\r\n  if (typeof layerOlStyle === 'function' || layerOlStyle instanceof Array) {\r\n    return;\r\n  }\r\n\r\n  const rStyle = {\r\n    fill: {\r\n      color: layerOlStyle.getFill().getColor()\r\n    },\r\n    stroke: {\r\n      color: layerOlStyle.getStroke().getColor(),\r\n      width: 2\r\n    },\r\n    circle: {\r\n      fill: {\r\n        color: (layerOlStyle.getImage() as any).getFill().getColor()\r\n      },\r\n      stroke: {\r\n        color: (layerOlStyle.getImage() as any).getStroke().getColor(),\r\n        width: 2\r\n      },\r\n      radius: 5\r\n    }\r\n  };\r\n  return rStyle;\r\n}\r\n","import { AuthInterceptor } from '@igo2/auth';\r\nimport { MessageService } from '@igo2/core';\r\n\r\nimport VectorTile from 'ol/VectorTile';\r\nimport olLayerVectorTile from 'ol/layer/VectorTile';\r\nimport olSourceVectorTile from 'ol/source/VectorTile';\r\n\r\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\r\nimport { IgoMap } from '../../../map/shared';\r\nimport { TileWatcher } from '../../utils';\r\nimport { Layer } from './layer';\r\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\r\n\r\nexport class VectorTileLayer extends Layer {\r\n  public declare dataSource: MVTDataSource;\r\n  public declare options: VectorTileLayerOptions;\r\n  public declare ol: olLayerVectorTile;\r\n\r\n  private watcher: TileWatcher;\r\n\r\n  constructor(\r\n    options: VectorTileLayerOptions,\r\n    public messageService?: MessageService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(options, messageService, authInterceptor);\r\n    this.watcher = new TileWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerVectorTile {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceVectorTile\r\n    });\r\n\r\n    const vectorTile = new olLayerVectorTile(olOptions);\r\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\r\n\r\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\r\n      const loader = this.customLoader(\r\n        url,\r\n        tile.getFormat(),\r\n        this.authInterceptor,\r\n        tile.onLoad.bind(tile)\r\n      );\r\n      if (loader) {\r\n        tile.setLoader(loader);\r\n      }\r\n    });\r\n\r\n    return vectorTile;\r\n  }\r\n\r\n  /**\r\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\r\n   * @internal\r\n   * @param url the url string or function to retrieve the data\r\n   * @param format the format of the tile\r\n   * @param interceptor the interceptor of the data\r\n   * @param success On success event action to trigger\r\n   * @param failure On failure event action to trigger TODO\r\n   */\r\n  customLoader(url, format, interceptor, success, failure?) {\r\n    return (extent, resolution, projection) => {\r\n      const xhr = new XMLHttpRequest();\r\n      let modifiedUrl = url;\r\n      if (typeof url !== 'function') {\r\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\r\n        if (alteredUrlWithKeyAuth) {\r\n          modifiedUrl = alteredUrlWithKeyAuth;\r\n        }\r\n      } else {\r\n        modifiedUrl = url(extent, resolution, projection);\r\n      }\r\n      xhr.open('GET', modifiedUrl);\r\n      if (interceptor) {\r\n        interceptor.interceptXhr(xhr, modifiedUrl);\r\n      }\r\n\r\n      if (format.getType() === 'arraybuffer') {\r\n        xhr.responseType = 'arraybuffer';\r\n      }\r\n      xhr.onload = (event) => {\r\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\r\n          const type = format.getType();\r\n          let source;\r\n          if (type === 'json' || type === 'text') {\r\n            source = xhr.responseText;\r\n          } else if (type === 'xml') {\r\n            source = xhr.responseXML;\r\n            if (!source) {\r\n              source = new DOMParser().parseFromString(\r\n                xhr.responseText,\r\n                'application/xml'\r\n              );\r\n            }\r\n          } else if (type === 'arraybuffer') {\r\n            source = xhr.response;\r\n          }\r\n          if (source) {\r\n            success.call(\r\n              this,\r\n              format.readFeatures(source, {\r\n                extent,\r\n                featureProjection: projection\r\n              }),\r\n              format.readProjection(source)\r\n            );\r\n          } else {\r\n            // TODO\r\n            failure.call(this);\r\n          }\r\n        } else {\r\n          // TODO\r\n          failure.call(this);\r\n        }\r\n      };\r\n      xhr.onerror = () => {\r\n        // TODO\r\n        failure.call(this);\r\n      };\r\n      xhr.send();\r\n    };\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n}\r\n","<mat-list-item class=\"igo-layer-list-item\">\n  <mat-checkbox\n    *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    matListItemIcon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\"\n  >\n  </mat-checkbox>\n  <span\n    matListItemTitle\n    class=\"igo-layer-title\"\n    [matTooltip]=\"tooltipText\"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleLegendOnClick()\"\n  >\n    {{ layer.title }}\n  </span>\n\n  <div matListItemMeta>\n    <button\n      *ngIf=\"!selectionMode\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"eyeTooltip | translate\"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\"\n      >\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"selectionMode\"\n      class=\"selection-eye\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        layer.visible\n          ? ('igo.geo.layer.hideLayer' | translate)\n          : ('igo.geo.layer.showLayer' | translate)\n      \"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\"\n      >\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"!selectionMode\"\n      class=\"actions-button\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.moreOptions' | translate\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"toggleLayerTool()\"\n    >\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  >\n  </igo-layer-legend>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ElementRef,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output,\r\n  Renderer2\r\n} from '@angular/core';\r\n\r\nimport { ConnectionState, NetworkService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { layerIsQueryable } from '../../query/shared/query.utils';\r\nimport { Layer, TooltipType } from '../shared/layers';\r\n\r\n@Component({\r\n  selector: 'igo-layer-item',\r\n  templateUrl: './layer-item.component.html',\r\n  styleUrls: ['./layer-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerItemComponent implements OnInit, OnDestroy {\r\n  public focusedCls = 'igo-layer-item-focused';\r\n\r\n  @Input()\r\n  get activeLayer() {\r\n    return this._activeLayer;\r\n  }\r\n  set activeLayer(value) {\r\n    if (\r\n      value &&\r\n      this.layer &&\r\n      value.id === this.layer.id &&\r\n      !this.selectionMode\r\n    ) {\r\n      this.layerTool$.next(true);\r\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n    } else {\r\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\r\n    }\r\n  }\r\n  private _activeLayer;\r\n\r\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  tooltipText: string;\r\n\r\n  state: ConnectionState;\r\n\r\n  @Input()\r\n  get selectAll() {\r\n    return this._selectAll;\r\n  }\r\n  set selectAll(value: boolean) {\r\n    this._selectAll = value;\r\n    if (value === true) {\r\n      this.layerCheck = true;\r\n    }\r\n  }\r\n  private _selectAll = false;\r\n\r\n  @Input() layerCheck;\r\n\r\n  private resolution$$: Subscription;\r\n  private network$$: Subscription;\r\n  private layers$$: Subscription;\r\n\r\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\r\n\r\n  @Input()\r\n  get layer() {\r\n    return this._layer;\r\n  }\r\n  set layer(value) {\r\n    this._layer = value;\r\n    this.layers$.next(value);\r\n  }\r\n  private _layer;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendIfVisible: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() orderable: boolean = true;\r\n\r\n  @Input() lowerDisabled: boolean = false;\r\n\r\n  @Input() raiseDisabled: boolean = false;\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Input() selectionMode;\r\n\r\n  @Input() changeDetection;\r\n\r\n  get opacity() {\r\n    return this.layer.opacity * 100;\r\n  }\r\n  set opacity(opacity: number) {\r\n    this.layer.opacity = opacity / 100;\r\n  }\r\n\r\n  get eyeTooltip() {\r\n    if (this.inResolutionRange$.getValue() === false) {\r\n      return 'igo.geo.layer.notInResolution';\r\n    } else {\r\n      return this.layer.visible\r\n        ? 'igo.geo.layer.hideLayer'\r\n        : 'igo.geo.layer.showLayer';\r\n    }\r\n  }\r\n\r\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\r\n  @Output() checkbox = new EventEmitter<{\r\n    layer: Layer;\r\n    check: boolean;\r\n  }>();\r\n\r\n  constructor(\r\n    private networkService: NetworkService,\r\n    private renderer: Renderer2,\r\n    private elRef: ElementRef,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    if (\r\n      this.layer.visible &&\r\n      this.expandLegendIfVisible &&\r\n      this.layer.firstLoadComponent === true\r\n    ) {\r\n      this.layer.firstLoadComponent = false;\r\n      this.layer.legendCollapsed = false;\r\n    }\r\n    this.toggleLegend(this.layer.legendCollapsed);\r\n    this.updateQueryBadge();\r\n\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.onResolutionChange();\r\n    });\r\n    this.tooltipText = this.computeTooltip();\r\n\r\n    this.network$$ = this.networkService\r\n      .currentState()\r\n      .subscribe((state: ConnectionState) => {\r\n        this.state = state;\r\n        this.onResolutionChange();\r\n      });\r\n\r\n    this.layers$$ = this.layers$.subscribe(() => {\r\n      if (this.layer && this.layer.options.active) {\r\n        this.layerTool$.next(true);\r\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n      }\r\n    });\r\n\r\n    if (this.changeDetection) {\r\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n    this.network$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    this.toggleLegend(this.showLegend$.value);\r\n  }\r\n\r\n  toggleVisibility(event: Event) {\r\n    event.stopPropagation();\r\n    this.layer.visible = !this.layer.visible;\r\n    if (this.toggleLegendOnVisibilityChange) {\r\n      this.toggleLegend(!this.layer.visible);\r\n    }\r\n    this.updateQueryBadge();\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return this.layer.title;\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  private onResolutionChange() {\r\n    const inResolutionRange = this.layer.isInResolutionsRange;\r\n    if (\r\n      inResolutionRange === false &&\r\n      this.updateLegendOnResolutionChange === true\r\n    ) {\r\n      this.toggleLegend(true);\r\n    }\r\n    this.inResolutionRange$.next(inResolutionRange);\r\n  }\r\n\r\n  private updateQueryBadge() {\r\n    const hidden =\r\n      this.queryBadge === false ||\r\n      this.layer.visible === false ||\r\n      !layerIsQueryable(this.layer);\r\n    this.queryBadgeHidden$.next(hidden);\r\n  }\r\n\r\n  toggleLayerTool() {\r\n    this.layerTool$.next(!this.layerTool$.getValue());\r\n    if (this.layerTool$.getValue() === true) {\r\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n    } else {\r\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\r\n    }\r\n    this.action.emit(this.layer);\r\n  }\r\n\r\n  public check() {\r\n    this.layerCheck = !this.layerCheck;\r\n    this.checkbox.emit({ layer: this.layer, check: this.layerCheck });\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { ConnectionState, NetworkService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { Layer, TooltipType } from '../shared/layers';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend-item',\r\n  templateUrl: './layer-legend-item.component.html',\r\n  styleUrls: ['./layer-legend-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  tooltipText: string;\r\n\r\n  state: ConnectionState;\r\n\r\n  private resolution$$: Subscription;\r\n  private network$$: Subscription;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  constructor(private networkService: NetworkService) {}\r\n\r\n  ngOnInit() {\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.onResolutionChange();\r\n    });\r\n    this.tooltipText = this.computeTooltip();\r\n\r\n    this.network$$ = this.networkService\r\n      .currentState()\r\n      .subscribe((state: ConnectionState) => {\r\n        this.state = state;\r\n        this.onResolutionChange();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n    this.network$$.unsubscribe();\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return this.layer.title;\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  private onResolutionChange() {\r\n    const inResolutionRange = this.layer.isInResolutionsRange;\r\n    this.inResolutionRange$.next(inResolutionRange);\r\n  }\r\n}\r\n","<mat-list-item class=\"igo-layer-list-item\">\n  <span\n    matListItemTitle\n    class=\"igo-layer-title\"\n    [matTooltip]=\"tooltipText\"\n    matTooltipShowDelay=\"500\"\n    >{{ layer.title }}</span\n  >\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  >\n  </igo-layer-legend>\n</div>\n","<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n    [checked]=\"showAllLegendsValue\"\n    class=\"mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\n    [labelPosition]=\"'before'\"\n    (change)=\"toggleShowAllLegends($event.checked)\"\n  >\n    {{ 'igo.geo.layer.legend.showAll' | translate }}\n  </mat-slide-toggle>\n  <mat-divider\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\n  ></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item\n        *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n        igoListItem\n        [layer]=\"layer\"\n        [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      >\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      !showAllLegendsValue &&\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\n      allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      !showAllLegendsValue &&\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) &&\n      allowShowAllLegends\n    \"\n  >\n    {{\n      'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate\n    }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\n      !allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisible' | translate }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) &&\n      !allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisibleButZoom' | translate }}\n  </p>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport {\r\n  BehaviorSubject,\r\n  EMPTY,\r\n  ReplaySubject,\r\n  Subscription,\r\n  timer\r\n} from 'rxjs';\r\nimport { debounce } from 'rxjs/operators';\r\n\r\nimport { Layer } from '../shared';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend-list',\r\n  templateUrl: './layer-legend-list.component.html',\r\n  styleUrls: ['./layer-legend-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\r\n  orderable = true;\r\n\r\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    true\r\n  );\r\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject(true);\r\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  showAllLegend: boolean = false;\r\n  public change$ = new ReplaySubject<void>(1);\r\n  private change$$: Subscription;\r\n  @Input()\r\n  set layers(value: Layer[]) {\r\n    this._layers = value;\r\n    this.next();\r\n  }\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  private _layers: Layer[];\r\n  @Input() excludeBaseLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() allowShowAllLegends: boolean = false;\r\n\r\n  @Input() showAllLegendsValue: boolean = false;\r\n\r\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\r\n\r\n  constructor() {}\r\n  ngOnInit(): void {\r\n    this.change$$ = this.change$\r\n      .pipe(\r\n        debounce(() => {\r\n          return this.layers.length === 0 ? EMPTY : timer(50);\r\n        })\r\n      )\r\n      .subscribe(() => {\r\n        const layers = this.computeShownLayers(this.layers.slice(0));\r\n        this.layers$.next(layers);\r\n        this.hasVisibleOrInRangeLayers$.next(\r\n          this.layers\r\n            .slice(0)\r\n            .filter((layer) => layer.baseLayer !== true)\r\n            .filter(\r\n              (layer) =>\r\n                layer.visible$.value && layer.isInResolutionsRange$.value\r\n            ).length > 0\r\n        );\r\n        this.hasVisibleAndNotInRangeLayers$.next(\r\n          this.layers\r\n            .slice(0)\r\n            .filter((layer) => layer.baseLayer !== true)\r\n            .filter(\r\n              (layer) =>\r\n                layer.visible$.value && !layer.isInResolutionsRange$.value\r\n            ).length > 0\r\n        );\r\n\r\n        this.layersInUi$.next(\r\n          this.layers\r\n            .slice(0)\r\n            .filter(\r\n              (layer) =>\r\n                layer.showInLayerList !== false &&\r\n                (!this.excludeBaseLayers || !layer.baseLayer)\r\n            )\r\n        );\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n  private computeShownLayers(layers: Layer[]) {\r\n    let shownLayers = layers.filter(\r\n      (layer: Layer) => layer.visible && layer.isInResolutionsRange\r\n    );\r\n    if (this.showAllLegendsValue) {\r\n      shownLayers = layers;\r\n    }\r\n    return this.sortLayersByZindex(shownLayers);\r\n  }\r\n  private sortLayersByZindex(layers: Layer[]) {\r\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\r\n  }\r\n\r\n  toggleShowAllLegends(toggle: boolean) {\r\n    this.showAllLegendsValue = toggle;\r\n    this.next();\r\n    this.allLegendsShown.emit(toggle);\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  ElementRef,\r\n  EventEmitter,\r\n  HostListener,\r\n  Input,\r\n  Output,\r\n  Renderer2\r\n} from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoCollapse]'\r\n})\r\nexport class CollapseDirective {\r\n  @Input()\r\n  get target() {\r\n    return this._target;\r\n  }\r\n  set target(value: Element) {\r\n    this._target = value;\r\n  }\r\n  private _target: Element;\r\n\r\n  @Input()\r\n  get collapsed(): boolean {\r\n    return this._collapsed;\r\n  }\r\n  set collapsed(collapsed: boolean) {\r\n    collapsed ? this.collapseTarget() : this.expandTarget();\r\n    this._collapsed = collapsed;\r\n    this.toggle.emit(collapsed);\r\n  }\r\n  private _collapsed = false;\r\n\r\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\r\n\r\n  @HostListener('click')\r\n  click() {\r\n    this.collapsed = !this.collapsed;\r\n  }\r\n\r\n  constructor(\r\n    private renderer: Renderer2,\r\n    private el: ElementRef\r\n  ) {}\r\n\r\n  private collapseTarget() {\r\n    this.renderer.addClass(this.target, 'igo-collapsed');\r\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\r\n  }\r\n\r\n  private expandTarget() {\r\n    this.renderer.removeClass(this.target, 'igo-collapsed');\r\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\r\n  }\r\n}\r\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            matListItemIcon\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"item.collapsed\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            svgIcon=\"chevron-up\"\n          >\n          </mat-icon>\n          <span matListItemTitle>{{ computeItemTitle(item) | async }} </span>\n        </mat-list-item>\n        <div\n          #legend\n          class=\"igo-layer-legend\"\n          [ngClass]=\"{ 'with-title': item.title }\"\n        >\n          <div *ngIf=\"currentStyle !== undefined\">\n            <mat-form-field>\n              <mat-select\n                tooltip-position=\"below\"\n                matTooltipShowDelay=\"500\"\n                [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n                [(ngModel)]=\"currentStyle\"\n                (selectionChange)=\"onChangeStyle()\"\n              >\n                <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{\n                  style.title\n                }}</mat-option>\n              </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!item.collapsed\">\n            <div *ngIf=\"item.url\">\n              <img\n                igoImageError\n                *ngIf=\"item.imgGraphValue\"\n                hideError=\"true\"\n                #renderedLegend\n                id=\"{{ item.title }}\"\n                (load)=\"onLoadImage(item.title)\"\n                [src]=\"item.imgGraphValue\"\n                alt=\"{{ 'igo.geo.layer.legend.loadingLegendText' | translate }}\"\n              />\n              <small *ngIf=\"imagesHeight[item.title] < 16\">\n                {{ 'igo.geo.layer.legend.noLegendScale' | translate }}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html | sanitizeHtml\"\n              *ngIf=\"item.html\"\n            ></div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{ 'igo.geo.layer.legend.noLegendText' | translate }}\n    </small>\n  </ng-template>\n</ng-container>\n","import { HttpClient } from '@angular/common/http';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ElementRef,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  ViewChildren\r\n} from '@angular/core';\r\nimport type { QueryList } from '@angular/core';\r\n\r\nimport { SecureImagePipe } from '@igo2/common';\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, Observable, Subscription, of } from 'rxjs';\r\nimport { catchError, map } from 'rxjs/operators';\r\n\r\nimport { WMSDataSource, WMSDataSourceOptions } from '../../datasource';\r\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\r\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { Layer } from '../shared/layers';\r\nimport {\r\n  ItemStyleOptions,\r\n  LegendMapViewOptions\r\n} from '../shared/layers/legend.interface';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend',\r\n  templateUrl: './layer-legend.component.html',\r\n  styleUrls: ['./layer-legend.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendComponent implements OnInit, OnDestroy {\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  /**\r\n   * Observable of the legend items\r\n   */\r\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * Subscription to the map's resolution\r\n   */\r\n  private state$$: Subscription;\r\n\r\n  /**\r\n   * The available styles\r\n   */\r\n  public styles;\r\n\r\n  /**\r\n   * The style used to make the legend\r\n   */\r\n  public currentStyle;\r\n\r\n  /**\r\n   * The scale used to make the legend\r\n   */\r\n  private scale: number = undefined;\r\n\r\n  /**\r\n   * The extent used to make the legend\r\n   */\r\n  private view: LegendMapViewOptions = undefined;\r\n  /**\r\n   * Get list of images display\r\n   */\r\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\r\n\r\n  /**\r\n   * List of size of images displayed\r\n   */\r\n  public imagesHeight: { [srcKey: string]: number } = {};\r\n\r\n  /**\r\n   * Layer\r\n   */\r\n  @Input() layer: Layer;\r\n\r\n  /**\r\n   * if getLegendGraphic is authorized\r\n   */\r\n  public getLegend = true;\r\n\r\n  /**\r\n   * activeLegend\r\n   */\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    private languageService: LanguageService,\r\n    private configService: ConfigService,\r\n    private http: HttpClient,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  /**\r\n   * On init, subscribe to the map's resolution and update the legend accordingly\r\n   */\r\n  ngOnInit() {\r\n    let lastlLegend = this.layer.legend;\r\n    this.styles = this.listStyles();\r\n    const sourceOptions = this.layer.options.source.options as any;\r\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\r\n      // if a styles is provided into the layers wms params\r\n      this.currentStyle = this.styles.find(\r\n        (style) => style.name === sourceOptions.params.STYLES\r\n      ).name;\r\n    } else if (!lastlLegend) {\r\n      // if no legend is manually provided\r\n      if (this.styles && this.styles.length > 1) {\r\n        this.currentStyle = this.styles[0].name;\r\n      }\r\n    } else if (this.styles && this.styles.length > 1) {\r\n      this.currentStyle = lastlLegend[0].currentStyle;\r\n    }\r\n    if (\r\n      typeof this.layer.options.legendOptions !== 'undefined' &&\r\n      this.layer.options.legendOptions.display === false\r\n    ) {\r\n      lastlLegend = [];\r\n    } else {\r\n      lastlLegend = this.layer.dataSource.getLegend(\r\n        this.currentStyle,\r\n        this.view\r\n      );\r\n    }\r\n\r\n    if (\r\n      this.updateLegendOnResolutionChange ||\r\n      (sourceOptions as WMSDataSourceOptions).contentDependentLegend\r\n    ) {\r\n      const state$ = this.layer.map.viewController.state$;\r\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\r\n    } else if (lastlLegend && lastlLegend.length !== 0) {\r\n      this.legendItems$.next(lastlLegend);\r\n      for (const legend of lastlLegend) {\r\n        this.getLegendGraphic(legend);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On destroy, unsubscribe to the map's view state\r\n   */\r\n  ngOnDestroy() {\r\n    if (this.state$$ !== undefined) {\r\n      this.state$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  getLegendGraphic(item: Legend) {\r\n    if (item.url) {\r\n      const secureIMG = new SecureImagePipe(this.http, this.configService);\r\n      secureIMG\r\n        .transform(item.url)\r\n        .pipe(\r\n          catchError((err) => {\r\n            if (err.error) {\r\n              err.error.caught = true;\r\n              this.getLegend = false;\r\n              this.cdRef.detectChanges();\r\n              return err;\r\n            }\r\n          })\r\n        )\r\n        .subscribe((obsLegGraph) => {\r\n          const idx = this.legendItems$.value.findIndex(\r\n            (leg) => leg.title === item.title\r\n          );\r\n          const legendGraph = obsLegGraph as string;\r\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  toggleLegendItem(collapsed: boolean, item: Legend) {\r\n    item.collapsed = collapsed;\r\n  }\r\n\r\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\r\n    const outLegends: Legend[] = newLegends;\r\n    const lastLegends = this.layer.legend;\r\n    for (let i = 0; i < lastLegends.length; i++) {\r\n      outLegends[i].collapsed = lastLegends[i].collapsed;\r\n    }\r\n    return outLegends;\r\n  }\r\n\r\n  computeItemTitle(layerLegend): Observable<string> {\r\n    const layerOptions = this.layer.dataSource.options as any;\r\n    if (layerOptions.type !== 'wms') {\r\n      return of(layerLegend.title);\r\n    }\r\n\r\n    const layers = layerOptions.params.LAYERS.split(',');\r\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\r\n    localLayerOptions.params.LAYERS = layers.find(\r\n      (layer) => layer === layerLegend.title\r\n    );\r\n    return this.capabilitiesService.getWMSOptions(localLayerOptions).pipe(\r\n      map((wmsDataSourceOptions) => {\r\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On resolution change, compute the effective scale level and update the\r\n   * legend accordingly.\r\n   * @param resolution Map resolution\r\n   */\r\n  private onViewControllerStateChange() {\r\n    this.view = {\r\n      resolution: this.layer.map.viewController.getResolution(),\r\n      extent: this.layer.map.viewController.getExtent(),\r\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\r\n      scale: this.layer.map.viewController.getScale(),\r\n      size: this.layer.map.ol.getSize()\r\n    } as LegendMapViewOptions;\r\n    this.updateLegend();\r\n  }\r\n\r\n  /**\r\n   * Update the legend with scale level and style define\r\n   */\r\n  private updateLegend() {\r\n    let legendItems = this.layer.dataSource.getLegend(\r\n      this.currentStyle,\r\n      this.view\r\n    );\r\n    if (this.layer.legend && this.layer.legend.length > 1) {\r\n      legendItems = this.transfertToggleLegendItem(legendItems);\r\n    }\r\n    this.layer.legend = legendItems;\r\n\r\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\r\n      return;\r\n    }\r\n    this.legendItems$.next(legendItems);\r\n    for (const legend of this.legendItems$.value) {\r\n      this.getLegendGraphic(legend);\r\n    }\r\n  }\r\n\r\n  private listStyles() {\r\n    const layerOptions = this.layer.options;\r\n    if (layerOptions && layerOptions.legendOptions) {\r\n      const translate = this.languageService.translate;\r\n      const title = translate.instant('igo.geo.layer.legend.default');\r\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\r\n      if (layerOptions.legendOptions.stylesAvailable) {\r\n        stylesAvailable = stylesAvailable.concat(\r\n          layerOptions.legendOptions.stylesAvailable.filter(\r\n            (sA) =>\r\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\r\n                'default' &&\r\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\r\n                'defaut'\r\n          )\r\n        );\r\n      }\r\n      stylesAvailable\r\n        .filter((sa) => !sa.title)\r\n        .map((sa) => (sa.title = sa.name));\r\n      stylesAvailable.map(\r\n        (s) =>\r\n          (s.title =\r\n            s.title.charAt(0).toUpperCase() +\r\n            s.title.slice(1).replace(/_/g, ' '))\r\n      );\r\n      return stylesAvailable;\r\n    }\r\n    return;\r\n  }\r\n\r\n  onChangeStyle() {\r\n    this.updateLegend();\r\n    let STYLES = '';\r\n    if (this.layer.dataSource instanceof WMSDataSource) {\r\n      this.layer.dataSource.ol\r\n        .getParams()\r\n        .LAYERS.split(',')\r\n        .map((layer) => (STYLES += this.currentStyle + ','));\r\n      STYLES = STYLES.slice(0, -1);\r\n      this.layer.dataSource.ol.updateParams({ STYLES });\r\n    }\r\n  }\r\n\r\n  onLoadImage(id: string) {\r\n    let elemRef: HTMLImageElement;\r\n    if (this.renderedLegends.length === 1) {\r\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\r\n    } else {\r\n      elemRef = this.renderedLegends.find(\r\n        (renderedLegend) => renderedLegend.nativeElement.id === id\r\n      ).nativeElement as HTMLImageElement;\r\n    }\r\n    this.imagesHeight[id] = elemRef.height;\r\n  }\r\n}\r\n","import { Directive, ElementRef, Input, OnInit } from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\n\r\n/**\r\n * This directive allow to add an icon inside a matBadge.\r\n * A value must be set into the matBadge directive ex: matBadge=\"icon\".\r\n * The badge content will be overrided by this current directive.\r\n */\r\n@Directive({\r\n  selector: '[igoMatBadgeIcon]'\r\n})\r\nexport class IgoBadgeIconDirective implements OnInit {\r\n  @Input()\r\n  set igoMatBadgeIcon(value: string) {\r\n    this.matIconRegistry.getNamedSvgIcon(value).subscribe((svgObj) => {\r\n      this.svg = svgObj;\r\n      this.updateSvg();\r\n    });\r\n  }\r\n  private svg: SVGElement;\r\n\r\n  @Input()\r\n  set matBadgeHidden(value: boolean) {\r\n    this.hidden = value;\r\n    this.updateHidden();\r\n  }\r\n  private hidden = false;\r\n\r\n  @Input()\r\n  set matBadgeDisabled(value: boolean) {\r\n    this.disabled = value;\r\n    this.updateDisabled();\r\n  }\r\n  private disabled = false;\r\n\r\n  @Input()\r\n  set igoMatBadgeInverseColor(value: boolean) {\r\n    this.inverseColor = value;\r\n    this.updateColor();\r\n  }\r\n  private inverseColor = false;\r\n\r\n  @Input()\r\n  set igoMatBadgeInheritColor(value: boolean) {\r\n    this.inheritColor = value;\r\n    this.updateColor();\r\n  }\r\n  private inheritColor = false;\r\n\r\n  @Input()\r\n  set igoMatBadgeColor(value: string) {\r\n    this.color = value;\r\n    this.updateColor();\r\n  }\r\n  private color;\r\n\r\n  @Input()\r\n  set igoMatBadgeBackgroundColor(value: string) {\r\n    this.backgroundColor = value;\r\n    this.updateColor();\r\n  }\r\n  private backgroundColor;\r\n\r\n  get badge() {\r\n    return this.el.nativeElement.querySelector('.mat-badge-content');\r\n  }\r\n\r\n  private originalColor: string;\r\n\r\n  constructor(\r\n    private el: ElementRef,\r\n    private matIconRegistry: MatIconRegistry\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.badge.style.alignItems = 'center';\r\n    this.badge.style.justifyContent = 'center';\r\n\r\n    this.updateHidden();\r\n    this.updateColor();\r\n    this.updateSvg();\r\n  }\r\n\r\n  private updateSvg() {\r\n    if (!this.badge) {\r\n      return;\r\n    }\r\n    this.badge.innerHTML = '';\r\n    if (this.svg) {\r\n      this.badge.appendChild(this.svg);\r\n    }\r\n  }\r\n  private updateColor() {\r\n    if (!this.badge) {\r\n      return;\r\n    }\r\n\r\n    if (this.color || this.backgroundColor) {\r\n      this.badge.style.color = this.color ? this.color : '';\r\n      this.badge.style.background = this.backgroundColor\r\n        ? this.backgroundColor\r\n        : '';\r\n    } else if (this.inheritColor) {\r\n      if (this.inverseColor) {\r\n        this.badge.style.color = 'currentColor';\r\n        this.badge.style.background = 'none';\r\n      } else {\r\n        this.badge.style.color = '';\r\n        this.badge.style.background = 'currentColor';\r\n      }\r\n    } else if (!this.inheritColor) {\r\n      if (this.inverseColor) {\r\n        this.badge.style.color = window\r\n          .getComputedStyle(this.badge, null)\r\n          .getPropertyValue('background-color');\r\n        this.badge.style.background = 'none';\r\n      } else {\r\n        this.badge.style.color = '';\r\n        this.badge.style.background = '';\r\n      }\r\n    }\r\n    this.originalColor = this.badge.style.color;\r\n    this.updateDisabled();\r\n  }\r\n\r\n  private updateHidden() {\r\n    if (!this.badge) {\r\n      return;\r\n    }\r\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\r\n  }\r\n\r\n  private updateDisabled() {\r\n    if (!this.badge || !this.inverseColor) {\r\n      return;\r\n    }\r\n    if (this.disabled) {\r\n      this.originalColor = this.badge.style.color;\r\n      this.badge.style.color = '#b9b9b9';\r\n    } else {\r\n      this.badge.style.color = this.originalColor;\r\n    }\r\n  }\r\n}\r\n","<mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n    [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n    matTooltipShowDelay=\"500\"\n    type=\"text\"\n    [(ngModel)]=\"term\"\n  />\n  <button\n    *ngIf=\"term\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    color=\"warn\"\n    (click)=\"clearTerm()\"\n  >\n    <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"actions-container\">\n  <button\n    class=\"sort-alpha\"\n    [color]=\"sortAlpha ? 'warn' : 'primary'\"\n    mat-icon-button\n    [matTooltip]=\"\n      sortAlpha\n        ? ('igo.geo.layer.sortMapOrder' | translate)\n        : ('igo.geo.layer.sortAlphabetically' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSortAlpha()\"\n  >\n    <mat-icon\n      [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"\n    ></mat-icon>\n  </button>\n\n  <button\n    class=\"only-visible\"\n    mat-icon-button\n    [disabled]=\"layersAreAllVisible && !onlyVisible\"\n    [color]=\"onlyVisible ? 'warn' : 'primary'\"\n    [matTooltip]=\"\n      onlyVisible\n        ? ('igo.geo.layer.resetLayersList' | translate)\n        : ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleOnlyVisible()\"\n  >\n    <mat-icon\n      aria-hidden=\"false\"\n      matBadge=\"icon\"\n      igoMatBadgeIcon=\"eye\"\n      igoMatBadgeInverseColor=\"true\"\n      igoMatBadgeInheritColor=\"true\"\n      [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\"\n    >\n    </mat-icon>\n  </button>\n\n  <button\n    class=\"selection-mode\"\n    mat-icon-button\n    color=\"primary\"\n    [matTooltip]=\"\n      selectionMode\n        ? ('igo.geo.layer.deactivateSelectionMode' | translate)\n        : ('igo.geo.layer.activateSelectionMode' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSelectionMode()\"\n  >\n    <mat-icon\n      [svgIcon]=\"\n        selectionMode\n          ? 'checkbox-multiple-marked-outline'\n          : 'checkbox-multiple-blank-outline'\n      \"\n    ></mat-icon>\n  </button>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material/form-field';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\r\n\r\n@Component({\r\n  selector: 'igo-layer-list-tool',\r\n  templateUrl: './layer-list-tool.component.html',\r\n  styleUrls: ['./layer-list-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerListToolComponent implements OnInit, OnDestroy {\r\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n  onlyVisible$$: Subscription;\r\n  sortAlpha$$: Subscription;\r\n  term$$: Subscription;\r\n\r\n  @Input() layersAreAllVisible: boolean = true;\r\n\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input()\r\n  set onlyVisible(value: boolean) {\r\n    this.onlyVisible$.next(value);\r\n  }\r\n  get onlyVisible(): boolean {\r\n    return this.onlyVisible$.value;\r\n  }\r\n\r\n  @Input()\r\n  set sortAlpha(value: boolean) {\r\n    this.sortAlpha$.next(value);\r\n  }\r\n  get sortAlpha(): boolean {\r\n    return this.sortAlpha$.value;\r\n  }\r\n\r\n  @Input()\r\n  set term(value: string) {\r\n    this.term$.next(value);\r\n  }\r\n  get term(): string {\r\n    return this.term$.value;\r\n  }\r\n\r\n  public selectionMode = false;\r\n\r\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\r\n  @Output() selection = new EventEmitter<boolean>();\r\n\r\n  ngOnInit(): void {\r\n    this.term$$ = this.term$.subscribe((keyword) => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword,\r\n        onlyVisible: this.onlyVisible,\r\n        sortAlpha: this.sortAlpha\r\n      });\r\n    });\r\n\r\n    this.onlyVisible$$ = this.onlyVisible$.subscribe((onlyVisible) => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword: this.term,\r\n        onlyVisible,\r\n        sortAlpha: this.sortAlpha\r\n      });\r\n    });\r\n    this.sortAlpha$$ = this.sortAlpha$.subscribe((sortAlpha) => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword: this.term,\r\n        onlyVisible: this.onlyVisible,\r\n        sortAlpha\r\n      });\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.onlyVisible$$.unsubscribe();\r\n    this.sortAlpha$$.unsubscribe();\r\n    this.term$$.unsubscribe();\r\n  }\r\n\r\n  clearTerm() {\r\n    this.term = undefined;\r\n  }\r\n  toggleSortAlpha() {\r\n    this.sortAlpha = !this.sortAlpha;\r\n  }\r\n\r\n  toggleOnlyVisible() {\r\n    this.onlyVisible = !this.onlyVisible;\r\n  }\r\n\r\n  toggleSelectionMode() {\r\n    this.selectionMode = !this.selectionMode;\r\n    this.selection.emit(this.selectionMode);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolService {\n  public keyword: string;\n  public sortAlpha = false;\n  public onlyVisible = false;\n  public onlyInRange = false;\n  public keywordInitialized = false;\n  public sortedAlphaInitialized = false;\n  public onlyVisibleInitialized = false;\n  public onlyInRangeInitialized = false;\n\n  constructor() {}\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower'\n}\n","<igo-layer-list-tool\n  *ngIf=\"showToolbar$ | async\"\n  floatLabel=\"auto\"\n  [layersAreAllVisible]=\"layersAreAllVisible\"\n  [term]=\"layerFilterAndSortOptions.keyword\"\n  [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n  [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n  (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n  (selection)=\"toggleSelectionMode($event)\"\n>\n</igo-layer-list-tool>\n\n<div *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"\n  >\n    {{\n      selectAllCheck\n        ? ('igo.geo.layer.deselectAll' | translate)\n        : ('igo.geo.layer.selectAll' | translate)\n    }}\n  </mat-checkbox>\n</div>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item\n      *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\"\n    >\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel\n  *ngIf=\"!selection && layerTool && activeLayer\"\n  class=\"igo-layer-actions-container\"\n  [title]=\"activeLayer.title\"\n>\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\n          : ('igo.geo.layer.lowerLayer' | translate)\n      \"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Lower, true)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"lowerDisabled\"\n        svgIcon=\"arrow-down\"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\n          : ('igo.geo.layer.raiseLayer' | translate)\n      \"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Raise, true)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"raiseDisabled\"\n        svgIcon=\"arrow-up\"\n      ></mat-icon>\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"badgeOpacity\"\n        matBadgeColor=\"primary\"\n        matBadgeSize=\"medium\"\n        svgIcon=\"opacity\"\n      ></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"panel-opacity-menu\">\n      <mat-slider\n        id=\"opacity-slider\"\n        color=\"primary\"\n        discrete\n        step=\"5\"\n        [min]=\"0\"\n        [max]=\"100\"\n        [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n        (click)=\"$event.stopPropagation()\"\n        matTooltipShowDelay=\"500\"\n        tooltip-position=\"below\"\n        #ngSlider\n        ><input\n          matSliderThumb\n          [value]=\"opacity\"\n          (input)=\"\n            changeOpacity({\n              source: ngSliderThumb,\n              parent: ngSlider,\n              value: ngSliderThumb.value\n            })\n          \"\n          #ngSliderThumb=\"matSliderThumb\"\n        />\n      </mat-slider>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerExtentIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\"\n    >\n      <mat-icon\n        matBadgeColor=\"primary\"\n        matBadgeSize=\"medium\"\n        svgIcon=\"magnify-scan\"\n      ></mat-icon>\n    </button>\n\n    <ng-container\n      igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{ layer: activeLayer }\"\n    >\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel\n  *ngIf=\"selection && layers.length > 0\"\n  class=\"igo-layer-actions-container\"\n  [title]=\"'igo.geo.layer.tools' | translate\"\n>\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"\n        isAllLayersRemovable(layersChecked)\n          ? ('igo.geo.layer.removeSelectedLayers' | translate)\n          : ('igo.geo.layer.removeSelectedLayersRestriction' | translate)\n      \"\n      (click)=\"removeLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"'!'\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n        svgIcon=\"delete\"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"\n        statusSelectedLayersCheck === 'ALL_HIDDEN'\n          ? ('igo.geo.layer.showSelectedLayers' | translate)\n          : ('igo.geo.layer.hideSelectedLayers' | translate)\n      \"\n      (click)=\"toggleVisibility(layersChecked)\"\n    >\n      <mat-icon\n        [svgIcon]=\"\n          statusSelectedLayersCheck === 'ALL_HIDDEN' ? 'eye-off' : 'eye'\n        \"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\n          : ('igo.geo.layer.lowerLayer' | translate)\n      \"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"lowerDisabledSelection\"\n        svgIcon=\"arrow-down\"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\n          : ('igo.geo.layer.raiseLayer' | translate)\n      \"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"raiseDisabledSelection\"\n        svgIcon=\"arrow-up\"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n    >\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <!-- TODO: The 'tickInterval' property no longer exists -->\n        <mat-slider\n          *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          showTickMarks\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click)=\"$event.stopPropagation()\"\n          ><input matSliderThumb />\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"\n        layersChecked.length !== 0 && activeLayersExtentAreValid(layersChecked)\n      \"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\"\n    >\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  ContentChild,\r\n  ElementRef,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport type { TemplateRef } from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material/form-field';\r\nimport { MatSliderChange } from '@angular/material/slider';\r\n\r\nimport * as olextent from 'ol/extent';\r\n\r\nimport {\r\n  BehaviorSubject,\r\n  EMPTY,\r\n  ReplaySubject,\r\n  Subscription,\r\n  timer\r\n} from 'rxjs';\r\nimport { debounce } from 'rxjs/operators';\r\nimport scrollIntoView from 'scroll-into-view-if-needed';\r\n\r\nimport {\r\n  getAllChildLayersByProperty,\r\n  getRootParentByProperty\r\n} from '../../map/shared/linkedLayers.utils';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport {\r\n  MetadataLayerOptions,\r\n  MetadataOptions\r\n} from '../../metadata/shared/metadata.interface';\r\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { LinkedProperties } from '../shared/layers/layer.interface';\r\nimport {\r\n  LayerListControlsEnum,\r\n  LayerListDisplacement\r\n} from './layer-list.enum';\r\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\r\n\r\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\r\n@Component({\r\n  selector: 'igo-layer-list',\r\n  templateUrl: './layer-list.component.html',\r\n  styleUrls: ['./layer-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerListComponent implements OnInit, OnDestroy {\r\n  orderable = true;\r\n  thresholdToFilterAndSort = 5;\r\n\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public layerTool: boolean;\r\n\r\n  public hideSelectedLayers: boolean = true;\r\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\r\n\r\n  layersChecked: Layer[] = [];\r\n  public selection: boolean;\r\n\r\n  private change$$: Subscription;\r\n  private layers$$: Subscription;\r\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\r\n\r\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\r\n  templateLayerToolbar: TemplateRef<any>;\r\n\r\n  @Input() layersAreAllVisible: boolean = true;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  set layers(value: Layer[]) {\r\n    this._layers = this.removeProblemLayerInList(value);\r\n    this.next();\r\n  }\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  private _layers: Layer[];\r\n\r\n  set activeLayer(value: Layer) {\r\n    this._activeLayer = value;\r\n    this.activeLayer$.next(value);\r\n  }\r\n  get activeLayer(): Layer {\r\n    return this._activeLayer;\r\n  }\r\n  private _activeLayer: Layer;\r\n\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\r\n\r\n  @Input() excludeBaseLayers: boolean = false;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\r\n\r\n  get keyword(): string {\r\n    return this._keyword;\r\n  }\r\n  set keyword(value: string) {\r\n    this._keyword = value;\r\n    this.next();\r\n  }\r\n  private _keyword = undefined;\r\n\r\n  get onlyVisible(): boolean {\r\n    return this._onlyVisible;\r\n  }\r\n  set onlyVisible(value: boolean) {\r\n    this._onlyVisible = value;\r\n    this.next();\r\n  }\r\n  private _onlyVisible = false;\r\n\r\n  get sortAlpha(): boolean {\r\n    return this._sortedAlpha;\r\n  }\r\n  set sortAlpha(value: boolean) {\r\n    this._sortedAlpha = value;\r\n    this.next();\r\n  }\r\n  private _sortedAlpha = false;\r\n\r\n  get opacity() {\r\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\r\n  }\r\n  set opacity(opacity: number) {\r\n    this.activeLayer$.getValue().opacity = opacity / 100;\r\n  }\r\n\r\n  get badgeOpacity() {\r\n    if (this.opacity === 100) {\r\n      return;\r\n    }\r\n    return this.opacity;\r\n  }\r\n\r\n  get raiseDisabled(): boolean {\r\n    if (\r\n      !this.orderable ||\r\n      this.activeLayer.baseLayer ||\r\n      this.getUpperLayer().id === this.activeLayer.id ||\r\n      this.isUpperBaselayer(this.activeLayer)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get lowerDisabled(): boolean {\r\n    if (\r\n      !this.orderable ||\r\n      this.activeLayer.baseLayer ||\r\n      this.getLowerLayer().id === this.activeLayer.id ||\r\n      this.isLowerBaselayer(this.activeLayer)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get raiseDisabledSelection(): boolean {\r\n    if (\r\n      this.layersChecked.length === 0 ||\r\n      !this.orderable ||\r\n      !this.raisableLayers(this.layersChecked) ||\r\n      this.selectAllCheck === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get lowerDisabledSelection(): boolean {\r\n    if (\r\n      this.layersChecked.length === 0 ||\r\n      !this.orderable ||\r\n      !this.lowerableLayers(this.layersChecked) ||\r\n      this.selectAllCheck === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get checkOpacity() {\r\n    return this.layersCheckedOpacity() * 100;\r\n  }\r\n  set checkOpacity(opacity: number) {\r\n    for (const layer of this.layersChecked) {\r\n      layer.opacity = opacity / 100;\r\n    }\r\n  }\r\n\r\n  get layerListDisplacement(): typeof LayerListDisplacement {\r\n    return LayerListDisplacement;\r\n  }\r\n\r\n  public toggleOpacity = false;\r\n\r\n  public selectAllCheck: boolean;\r\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\r\n  private selectAllCheck$$: Subscription;\r\n\r\n  constructor(private elRef: ElementRef) {}\r\n\r\n  /**\r\n   * Subscribe to the search term stream and trigger researches\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.change$$ = this.change$\r\n      .pipe(\r\n        debounce(() => {\r\n          return this.layers.length === 0 ? EMPTY : timer(50);\r\n        })\r\n      )\r\n      .subscribe(() => {\r\n        this.showToolbar$.next(this.computeShowToolbar());\r\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\r\n        this.appliedFilterAndSort.emit({\r\n          keyword: this.keyword,\r\n          sortAlpha: this.sortAlpha,\r\n          onlyVisible: this.onlyVisible\r\n        });\r\n      });\r\n\r\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\r\n      this.selectAllCheck = value;\r\n    });\r\n\r\n    this.layers$$ = this.layers$.subscribe(() => {\r\n      if (this.layers) {\r\n        let checks = 0;\r\n        for (const layer of this.layers) {\r\n          layer.status$.subscribe((valStatus) => {\r\n            if (valStatus === 0) {\r\n              this.map.removeLayer(layer);\r\n            }\r\n          });\r\n          if (layer.options.active) {\r\n            this.activeLayer = layer;\r\n            this.layerTool = true;\r\n          }\r\n          if (layer.options.check) {\r\n            checks += 1;\r\n          }\r\n        }\r\n        if (this.excludeBaseLayers) {\r\n          this.selectAllCheck =\r\n            checks ===\r\n            this.layers.filter(\r\n              (lay) => lay.baseLayer !== true && lay.showInLayerList\r\n            ).length\r\n              ? true\r\n              : false;\r\n        } else {\r\n          this.selectAllCheck =\r\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\r\n              ? true\r\n              : false;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n    this.selectAllCheck$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  activeLayerExtentIsValid(layer: Layer): boolean {\r\n    let valid = false;\r\n    if (layer.options.showButtonZoomToExtent === false) {\r\n      return false;\r\n    }\r\n    const layerExtent = layer.options.extent;\r\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\r\n\r\n    if (layerExtent) {\r\n      if (maxLayerZoomExtent) {\r\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\r\n      } else {\r\n        valid = true;\r\n      }\r\n    }\r\n    return valid;\r\n  }\r\n\r\n  activeLayersExtentAreValid(layers: Layer[]): boolean {\r\n    let valid = false;\r\n    const layersExtent = olextent.createEmpty();\r\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\r\n\r\n    for (const layer of layers) {\r\n      const layerExtent = layer.options.extent;\r\n\r\n      if (layerExtent && !layerExtent.includes(Infinity)) {\r\n        olextent.extend(layersExtent, layerExtent);\r\n      }\r\n    }\r\n\r\n    if (!olextent.isEmpty(layersExtent)) {\r\n      if (maxLayerZoomExtent) {\r\n        valid = olextent.containsExtent(maxLayerZoomExtent, layersExtent);\r\n      } else {\r\n        valid = true;\r\n      }\r\n    }\r\n    return valid;\r\n  }\r\n\r\n  zoomLayerExtents(layer: Layer) {\r\n    this.map.viewController.zoomToExtent(layer.options.extent);\r\n  }\r\n\r\n  zoomLayersExtents(layers: Layer[]) {\r\n    const layersExtent = olextent.createEmpty() as [\r\n      number,\r\n      number,\r\n      number,\r\n      number\r\n    ];\r\n\r\n    for (const layer of layers) {\r\n      const layerExtent = layer.options.extent;\r\n\r\n      if (layerExtent) {\r\n        olextent.extend(layersExtent, layerExtent);\r\n      }\r\n    }\r\n    this.map.viewController.zoomToExtent(layersExtent);\r\n  }\r\n\r\n  changeOpacity(event: MatSliderChange) {\r\n    this.opacity = event.value;\r\n  }\r\n\r\n  clearKeyword() {\r\n    this.keyword = undefined;\r\n  }\r\n\r\n  getLowerLayer() {\r\n    return this.layers\r\n      .filter((l) => !l.baseLayer)\r\n      .reduce(\r\n        (prev, current) => {\r\n          return prev.zIndex < current.zIndex ? prev : current;\r\n        },\r\n        { zIndex: undefined, id: undefined }\r\n      );\r\n  }\r\n\r\n  isLowerBaselayer(layer) {\r\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\r\n    if (\r\n      this.layers &&\r\n      this.layers[index + 1] &&\r\n      this.layers[index + 1].baseLayer === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getUpperLayer() {\r\n    return this.layers\r\n      .filter((l) => !l.baseLayer)\r\n      .reduce(\r\n        (prev, current) => {\r\n          return prev.zIndex > current.zIndex ? prev : current;\r\n        },\r\n        { zIndex: undefined, id: undefined }\r\n      );\r\n  }\r\n\r\n  isUpperBaselayer(layer) {\r\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\r\n    if (\r\n      this.layers &&\r\n      this.layers[index - 1] &&\r\n      this.layers[index - 1].baseLayer === true\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  moveActiveLayer(\r\n    activeLayer: Layer,\r\n    actiontype: LayerListDisplacement,\r\n    fromUi: boolean = false\r\n  ) {\r\n    const sortedLayersToMove = [];\r\n    getRootParentByProperty(this.map, activeLayer, LinkedProperties.ZINDEX);\r\n    let rootParentByProperty = getRootParentByProperty(\r\n      this.map,\r\n      activeLayer,\r\n      LinkedProperties.ZINDEX\r\n    );\r\n    if (!rootParentByProperty) {\r\n      rootParentByProperty = activeLayer;\r\n    }\r\n    const layersToMove = [rootParentByProperty];\r\n    getAllChildLayersByProperty(\r\n      this.map,\r\n      rootParentByProperty,\r\n      layersToMove,\r\n      LinkedProperties.ZINDEX\r\n    );\r\n\r\n    this.layers.map((layer) => {\r\n      if (layersToMove.indexOf(layer) !== -1) {\r\n        sortedLayersToMove.push(layer);\r\n      }\r\n    });\r\n\r\n    if (actiontype === LayerListDisplacement.Raise) {\r\n      this.raiseLayers(sortedLayersToMove, fromUi);\r\n    } else if (actiontype === LayerListDisplacement.Lower) {\r\n      this.lowerLayers(sortedLayersToMove, fromUi);\r\n    }\r\n  }\r\n\r\n  /*\r\n   * For selection mode disabled attribute\r\n   */\r\n  raisableLayers(layers: Layer[]) {\r\n    let response = false;\r\n    let base = 0;\r\n    for (const layer of layers) {\r\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\r\n      const currentLayer = this.layers[mapIndex];\r\n      if (currentLayer.baseLayer) {\r\n        base += 1;\r\n      }\r\n\r\n      const previousLayer = this.layers[mapIndex - 1];\r\n      if (\r\n        previousLayer &&\r\n        previousLayer.baseLayer !== true &&\r\n        !layers.find((lay) => previousLayer.id === lay.id) &&\r\n        currentLayer.baseLayer !== true\r\n      ) {\r\n        response = true;\r\n      }\r\n    }\r\n\r\n    if (\r\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\r\n      base === this.layersChecked.length\r\n    ) {\r\n      response = false;\r\n    }\r\n    return response;\r\n  }\r\n\r\n  /*\r\n   * When multiple layers is selected but some may be allow to move\r\n   */\r\n  raisableLayer(index: number) {\r\n    if (index < 1) {\r\n      return false;\r\n    }\r\n\r\n    if (this.layers[index - 1].options.check) {\r\n      return this.raisableLayer(index - 1);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\r\n    const layersToRaise = [];\r\n    for (const layer of layers) {\r\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\r\n      if (this.raisableLayer(index)) {\r\n        layersToRaise.push(layer);\r\n      }\r\n    }\r\n    this.map.raiseLayers(layersToRaise);\r\n    if (fromUi) {\r\n      setTimeout(() => {\r\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\r\n          'mat-checkbox-checked'\r\n        );\r\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\r\n          'igo-layer-item-focused'\r\n        );\r\n        let targetToScroll;\r\n        if (checkItems.length) {\r\n          targetToScroll = checkItems[0];\r\n        }\r\n        if (itemFocused.length) {\r\n          targetToScroll = itemFocused[0];\r\n        }\r\n        if (targetToScroll) {\r\n          scrollIntoView(targetToScroll, {\r\n            scrollMode: 'if-needed',\r\n            behavior: 'smooth',\r\n            block: 'end',\r\n            inline: 'nearest'\r\n          });\r\n        }\r\n      }, 100);\r\n    }\r\n  }\r\n  /*\r\n   * For selection mode disabled attribute\r\n   */\r\n  lowerableLayers(layers: Layer[]) {\r\n    let response = false;\r\n    let base = 0;\r\n    for (const layer of layers) {\r\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\r\n      const currentLayer = this.layers[mapIndex];\r\n      if (currentLayer.baseLayer) {\r\n        base += 1;\r\n      }\r\n\r\n      const nextLayer = this.layers[mapIndex + 1];\r\n      if (\r\n        nextLayer &&\r\n        nextLayer.baseLayer !== true &&\r\n        !layers.find((lay) => nextLayer.id === lay.id)\r\n      ) {\r\n        response = true;\r\n      }\r\n    }\r\n\r\n    if (\r\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\r\n      base === this.layersChecked.length\r\n    ) {\r\n      response = false;\r\n    }\r\n    return response;\r\n  }\r\n\r\n  /*\r\n   * When multiple layers is selected but some may be allow to move\r\n   */\r\n  lowerableLayer(index: number) {\r\n    if (\r\n      index >\r\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (this.layers[index + 1].options.check) {\r\n      return this.lowerableLayer(index + 1);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\r\n    const layersToLower = [];\r\n    for (const layer of layers) {\r\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\r\n      if (this.lowerableLayer(index)) {\r\n        layersToLower.push(layer);\r\n      }\r\n    }\r\n    this.map.lowerLayers(layersToLower);\r\n    if (fromUi) {\r\n      setTimeout(() => {\r\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\r\n          'mat-checkbox-checked'\r\n        );\r\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\r\n          'igo-layer-item-focused'\r\n        );\r\n        let targetToScroll;\r\n        if (checkItems.length) {\r\n          targetToScroll = checkItems[checkItems.length - 1];\r\n        }\r\n        if (itemFocused.length) {\r\n          targetToScroll = itemFocused[0];\r\n        }\r\n        if (targetToScroll) {\r\n          scrollIntoView(targetToScroll, {\r\n            scrollMode: 'if-needed',\r\n            behavior: 'smooth',\r\n            block: 'end',\r\n            inline: 'nearest'\r\n          });\r\n        }\r\n      }, 100);\r\n    }\r\n  }\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n  private computeLayers(layers: Layer[]): Layer[] {\r\n    let layersOut = this.filterLayers(layers);\r\n    if (this.sortAlpha) {\r\n      layersOut = this.sortLayersByTitle(layersOut);\r\n    } else {\r\n      layersOut = this.sortLayersByZindex(layersOut);\r\n    }\r\n    return layersOut;\r\n  }\r\n\r\n  onKeywordChange(term) {\r\n    this.keyword = term;\r\n  }\r\n\r\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\r\n    this.keyword = appliedFilter.keyword;\r\n    this.onlyVisible = appliedFilter.onlyVisible;\r\n    this.sortAlpha = appliedFilter.sortAlpha;\r\n  }\r\n\r\n  private filterLayers(layers: Layer[]): Layer[] {\r\n    if (\r\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\r\n    ) {\r\n      return layers;\r\n    }\r\n    if (!this.keyword && !this.onlyVisible) {\r\n      return layers;\r\n    }\r\n\r\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\r\n\r\n    layers.forEach((layer: Layer) => {\r\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\r\n      const dataSourceOptions = layer.dataSource.options || {};\r\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\r\n      const keywords = metadata.keywordList || [];\r\n      const layerKeywords = keywords.map((kw: string) => {\r\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n      });\r\n\r\n      if (this.keyword && layer.title) {\r\n        const localKeyword = this.keyword\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const layerTitle = layer.title\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const dataSourceType = dataSourceOptions.type || '';\r\n        const keywordRegex = new RegExp(localKeyword, 'gi');\r\n        const keywordInList =\r\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\r\n          undefined;\r\n        if (\r\n          !keywordRegex.test(layerTitle) &&\r\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\r\n          !keywordInList\r\n        ) {\r\n          const index = keepLayerIds.indexOf(layer.id);\r\n          if (index > -1) {\r\n            keepLayerIds.splice(index, 1);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (this.onlyVisible && layer.visible === false) {\r\n        const index = keepLayerIds.indexOf(layer.id);\r\n        if (index > -1) {\r\n          keepLayerIds.splice(index, 1);\r\n        }\r\n      }\r\n    });\r\n\r\n    return layers.filter(\r\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\r\n    );\r\n  }\r\n\r\n  private sortLayersByZindex(layers: Layer[]) {\r\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\r\n  }\r\n\r\n  private sortLayersByTitle(layers: Layer[]) {\r\n    return layers.sort((a, b) => {\r\n      if (this.normalize(a.title) < this.normalize(b.title)) {\r\n        return -1;\r\n      }\r\n      if (this.normalize(a.title) > this.normalize(b.title)) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  private normalize(str: string) {\r\n    return str\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .toLowerCase();\r\n  }\r\n\r\n  private computeShowToolbar(): boolean {\r\n    switch (this.layerFilterAndSortOptions.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        return true;\r\n      case LayerListControlsEnum.never:\r\n        return false;\r\n      default:\r\n        if (\r\n          this.layers.length >= this.thresholdToFilterAndSort ||\r\n          this.keyword ||\r\n          this.onlyVisible\r\n        ) {\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  }\r\n\r\n  toggleLayerTool(layer) {\r\n    this.toggleOpacity = false;\r\n    if (this.layerTool && layer === this.activeLayer) {\r\n      this.layerTool = false;\r\n    } else {\r\n      this.layerTool = true;\r\n    }\r\n\r\n    for (const lay of this.layers) {\r\n      lay.options.active = false;\r\n    }\r\n    layer.options.active = true;\r\n    this.activeLayer = layer;\r\n  }\r\n\r\n  removeLayers(layers?: Layer[]) {\r\n    if (layers && layers.length > 0) {\r\n      this.layersChecked = [];\r\n      for (const layer of layers) {\r\n        if (layer.options.removable !== false) {\r\n          layer.map.removeLayer(layer);\r\n        } else {\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n    } else if (!layers && this.activeLayer.options.removable !== false) {\r\n      this.activeLayer.map.removeLayer(this.activeLayer);\r\n      this.layerTool = false;\r\n    }\r\n  }\r\n\r\n  toggleVisibility(layers?: Layer[]) {\r\n    if (layers && layers.length > 0) {\r\n      for (const layer of layers) {\r\n        layer.visible = this.hideSelectedLayers;\r\n      }\r\n    }\r\n    this.layerItemChangeDetection$.next(true);\r\n  }\r\n\r\n  isLayerRemovable(layer: Layer): boolean {\r\n    return layer.options.removable !== false;\r\n  }\r\n\r\n  isAllLayersRemovable(layers: Layer[]): boolean {\r\n    return layers.every((l) => this.isLayerRemovable(l));\r\n  }\r\n\r\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\r\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\r\n      LayerListSelectVisibleEnum.NULL;\r\n    let findTrue: boolean = false;\r\n    let findFalse: boolean = false;\r\n\r\n    if (this.layersChecked.length === 0) {\r\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\r\n    } else {\r\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\r\n      this.hideSelectedLayers = false;\r\n\r\n      for (const layer2 of this.layersChecked) {\r\n        if (layer2.visible === true) {\r\n          findTrue = true;\r\n        }\r\n        if (layer2.visible === false) {\r\n          findFalse = true;\r\n        }\r\n      }\r\n\r\n      if (findTrue === true && findFalse === false) {\r\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\r\n      }\r\n      if (findTrue === false && findFalse === true) {\r\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\r\n        this.hideSelectedLayers = true;\r\n      }\r\n    }\r\n\r\n    return statusSelectedLayers;\r\n  }\r\n\r\n  layersCheck(event: { layer: Layer; check: boolean }) {\r\n    event.layer.options.check = event.check;\r\n    if (event.check === true) {\r\n      const eventMapIndex = this.layers.findIndex(\r\n        (layer) => event.layer.id === layer.id\r\n      );\r\n      for (const layer of this.layersChecked) {\r\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\r\n        if (eventMapIndex < mapIndex) {\r\n          this.layersChecked.splice(\r\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\r\n            0,\r\n            event.layer\r\n          );\r\n\r\n          if (this.excludeBaseLayers) {\r\n            if (\r\n              this.layersChecked.length ===\r\n              this.layers.filter(\r\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\r\n              ).length\r\n            ) {\r\n              this.selectAllCheck = true;\r\n            } else {\r\n              this.selectAllCheck = false;\r\n            }\r\n          } else if (!this.excludeBaseLayers) {\r\n            if (\r\n              this.layersChecked.length ===\r\n              this.layers.filter((lay) => lay.showInLayerList).length\r\n            ) {\r\n              this.selectAllCheck = true;\r\n            } else {\r\n              this.selectAllCheck = false;\r\n            }\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      this.layersChecked.push(event.layer);\r\n    } else {\r\n      const index = this.layersChecked.findIndex(\r\n        (layer) => event.layer.id === layer.id\r\n      );\r\n      this.layersChecked.splice(index, 1);\r\n    }\r\n\r\n    if (this.excludeBaseLayers) {\r\n      if (\r\n        this.layersChecked.length ===\r\n        this.layers.filter(\r\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\r\n        ).length\r\n      ) {\r\n        this.selectAllCheck = true;\r\n      } else {\r\n        this.selectAllCheck = false;\r\n      }\r\n    } else if (!this.excludeBaseLayers) {\r\n      if (\r\n        this.layersChecked.length ===\r\n        this.layers.filter((lay) => lay.showInLayerList).length\r\n      ) {\r\n        this.selectAllCheck = true;\r\n      } else {\r\n        this.selectAllCheck = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  toggleSelectionMode(value: boolean) {\r\n    this.selection = value;\r\n    this.activeLayer = undefined;\r\n    if (value === true) {\r\n      this.layerTool = false;\r\n      for (const layer of this.layers) {\r\n        if (layer.options.check) {\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  layersCheckedOpacity(): any {\r\n    if (this.layersChecked.length > 1) {\r\n      return 1;\r\n    } else {\r\n      const opacity = [];\r\n      for (const layer of this.layersChecked) {\r\n        opacity.push(layer.opacity);\r\n      }\r\n      return opacity;\r\n    }\r\n  }\r\n\r\n  selectAll() {\r\n    if (!this.selectAllCheck) {\r\n      for (const layer of this.layers) {\r\n        if (\r\n          this.excludeBaseLayers &&\r\n          layer.baseLayer !== true &&\r\n          layer.showInLayerList\r\n        ) {\r\n          layer.options.check = true;\r\n          this.layersChecked.push(layer);\r\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\r\n          layer.options.check = true;\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n      this.selectAllCheck$.next(true);\r\n    } else {\r\n      for (const layer of this.layers) {\r\n        layer.options.check = false;\r\n      }\r\n      this.layersChecked = [];\r\n      this.selectAllCheck$.next(false);\r\n    }\r\n  }\r\n\r\n  isScrolledIntoView(elemSource, elem) {\r\n    const docViewTop = elemSource.scrollTop;\r\n    const docViewBottom = docViewTop + elemSource.clientHeight;\r\n\r\n    const elemTop = elem.offsetTop;\r\n    const elemBottom = elemTop + elem.clientHeight;\r\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\r\n  }\r\n\r\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\r\n    for (const layer of layersList) {\r\n      if (layer.olLoadingProblem === true) {\r\n        this.map.removeLayer(layer);\r\n      }\r\n    }\r\n    return layersList;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { CompressionService } from '@igo2/core';\r\n\r\nimport { DBMode, NgxIndexedDBService } from 'ngx-indexed-db';\r\nimport { Observable, Subject, of } from 'rxjs';\r\nimport { concatMap, first, map, take } from 'rxjs/operators';\r\n\r\nimport { InsertSourceInsertDBEnum } from './geoDB.enums';\r\nimport { GeoDBData } from './geoDB.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeoDBService {\r\n  readonly dbName: string = 'geoData';\r\n  public collisionsMap: Map<number, string[]> = new Map();\r\n  public _newData: number = 0;\r\n\r\n  constructor(\r\n    private ngxIndexedDBService: NgxIndexedDBService,\r\n    private compression: CompressionService\r\n  ) {}\r\n\r\n  /**\r\n   * Only blob can be compressed\r\n   * @param url\r\n   * @param regionID\r\n   * @param object object to handle\r\n   * @param insertSource type of event user or system\r\n   * @param insertEvent Name of the event where the insert has been triggered\r\n   * @returns\r\n   */\r\n  update(\r\n    url: string,\r\n    regionID: any,\r\n    object: any,\r\n    insertSource: InsertSourceInsertDBEnum,\r\n    insertEvent: string\r\n  ): Observable<any> {\r\n    if (!object) {\r\n      return;\r\n    }\r\n    let compress = false;\r\n\r\n    const subject: Subject<GeoDBData> = new Subject();\r\n    let object$: Observable<any> = of(object);\r\n    if (object instanceof Blob) {\r\n      object$ = this.compression.compressBlob(object);\r\n      compress = true;\r\n    }\r\n    let geoDBData: GeoDBData;\r\n    object$\r\n      .pipe(\r\n        first(),\r\n        concatMap((object) => {\r\n          geoDBData = {\r\n            url,\r\n            regionID,\r\n            object: object,\r\n            compressed: compress,\r\n            insertSource,\r\n            insertEvent\r\n          };\r\n          return this.ngxIndexedDBService.getByID(this.dbName, url);\r\n        }),\r\n        concatMap((dbObject: GeoDBData) => {\r\n          if (!dbObject) {\r\n            this._newData++;\r\n            return this.ngxIndexedDBService.add(this.dbName, geoDBData);\r\n          } else {\r\n            const currentRegionID = dbObject.regionID;\r\n            if (currentRegionID !== regionID) {\r\n              const collisions = this.collisionsMap.get(currentRegionID);\r\n              if (collisions !== undefined) {\r\n                collisions.push(dbObject.url);\r\n                this.collisionsMap.set(currentRegionID, collisions);\r\n              } else {\r\n                this.collisionsMap.set(currentRegionID, [dbObject.url]);\r\n              }\r\n            }\r\n            return this.customUpdate(geoDBData);\r\n          }\r\n        })\r\n      )\r\n      .subscribe((response) => {\r\n        subject.next(response);\r\n        subject.complete();\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  private customUpdate(geoDBData: GeoDBData): Observable<GeoDBData> {\r\n    const subject: Subject<GeoDBData> = new Subject();\r\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\r\n      this.dbName,\r\n      geoDBData.url\r\n    );\r\n    deleteRequest\r\n      .pipe(\r\n        concatMap((isDeleted) =>\r\n          isDeleted\r\n            ? this.ngxIndexedDBService.add(this.dbName, geoDBData)\r\n            : of(undefined)\r\n        )\r\n      )\r\n      .subscribe((object) => {\r\n        if (object) {\r\n          subject.next(object);\r\n        }\r\n        subject.complete();\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  get(url: string): Observable<any> {\r\n    return this.ngxIndexedDBService.getByID(this.dbName, url).pipe(\r\n      map((data: GeoDBData) => {\r\n        if (data) {\r\n          const object = data.object;\r\n          if (!data.compressed) {\r\n            return object;\r\n          }\r\n          return this.compression.decompressBlob(object);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  getByID(url: string): Observable<any> {\r\n    return this.ngxIndexedDBService.getByID(this.dbName, url);\r\n  }\r\n\r\n  deleteByKey(url: string): Observable<any> {\r\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, url);\r\n  }\r\n\r\n  getRegionCountByID(id: number): Observable<number> {\r\n    const subject: Subject<number> = new Subject();\r\n    const dbRequest = this.getRegionByID(id).subscribe((datas) => {\r\n      subject.next(datas.length);\r\n      subject.complete();\r\n    });\r\n    return subject;\r\n  }\r\n\r\n  getRegionByID(id: number): Observable<any[]> {\r\n    if (!id) {\r\n      return;\r\n    }\r\n\r\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\r\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\r\n      this.dbName,\r\n      'regionID',\r\n      IDBKey\r\n    );\r\n    return dbRequest;\r\n  }\r\n\r\n  deleteByRegionID(id: number): Observable<any> {\r\n    if (!id) {\r\n      return;\r\n    }\r\n\r\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\r\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\r\n      this.dbName,\r\n      'regionID',\r\n      IDBKey\r\n    );\r\n    dbRequest.subscribe((datas: GeoDBData[]) => {\r\n      datas.forEach((data) => {\r\n        this.ngxIndexedDBService.deleteByKey(this.dbName, data.url);\r\n      });\r\n    });\r\n    return dbRequest;\r\n  }\r\n\r\n  openCursor(\r\n    keyRange: IDBKeyRange = IDBKeyRange.lowerBound(0),\r\n    mode: DBMode = DBMode.readonly\r\n  ) {\r\n    const request = this.ngxIndexedDBService.openCursorByIndex(\r\n      this.dbName,\r\n      'regionID',\r\n      keyRange,\r\n      mode\r\n    );\r\n    return request;\r\n  }\r\n\r\n  resetCounters() {\r\n    this.resetCollisionsMap();\r\n    this._newData = 0;\r\n  }\r\n\r\n  resetCollisionsMap() {\r\n    this.collisionsMap = new Map();\r\n  }\r\n\r\n  revertCollisions() {\r\n    for (const [regionID, collisions] of this.collisionsMap) {\r\n      for (const url of collisions) {\r\n        this.ngxIndexedDBService\r\n          .getByKey(this.dbName, url)\r\n          .pipe(take(1))\r\n          .subscribe((dbObject: GeoDBData) => {\r\n            const updatedObject = dbObject;\r\n            updatedObject.regionID = regionID;\r\n            this.customUpdate(dbObject);\r\n          });\r\n      }\r\n    }\r\n  }\r\n\r\n  get newData(): number {\r\n    return this._newData;\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ConnectionState, NetworkService } from '@igo2/core';\r\n\r\nimport { Type } from 'ol/format/Feature';\r\n\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { GeoDBService } from '../geoDB/geoDB.service';\r\n\r\nexport enum ResponseType {\r\n  Arraybuffer = 'arraybuffer',\r\n  Blob = 'blob',\r\n  Text = 'text',\r\n  Json = 'json'\r\n}\r\nexport interface SimpleGetOptions {\r\n  responseType: Type;\r\n  withCredentials?: boolean;\r\n}\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeoNetworkService {\r\n  private networkOnline: boolean = true;\r\n  constructor(\r\n    private http: HttpClient,\r\n    public geoDBService: GeoDBService,\r\n    private networkService: NetworkService\r\n  ) {\r\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\r\n      this.networkOnline = state.connection;\r\n    });\r\n  }\r\n\r\n  get(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\r\n    if (window.navigator.onLine && this.networkOnline) {\r\n      return this.getOnline(url, simpleGetOptions);\r\n    }\r\n    return this.getOffline(url);\r\n  }\r\n\r\n  private getOnline(\r\n    url: string,\r\n    simpleGetOptions: SimpleGetOptions\r\n  ): Observable<any> {\r\n    let request;\r\n    switch (simpleGetOptions.responseType) {\r\n      case 'arraybuffer':\r\n        request = this.http.get(url, {\r\n          responseType: 'arraybuffer',\r\n          withCredentials: simpleGetOptions.withCredentials\r\n        });\r\n        break;\r\n      case 'text':\r\n        request = this.http.get(url, {\r\n          responseType: 'text',\r\n          withCredentials: simpleGetOptions.withCredentials\r\n        });\r\n        break;\r\n      case 'json':\r\n        request = this.http.get(url, {\r\n          responseType: 'json',\r\n          withCredentials: simpleGetOptions.withCredentials\r\n        });\r\n        break;\r\n      default:\r\n        request = this.http.get(url, {\r\n          responseType: 'blob',\r\n          withCredentials: simpleGetOptions.withCredentials\r\n        });\r\n        break;\r\n    }\r\n    return request;\r\n  }\r\n\r\n  private getOffline(url: string): Observable<any> {\r\n    return this.geoDBService.get(url);\r\n  }\r\n\r\n  public isOnline() {\r\n    return this.networkOnline && window.navigator.onLine;\r\n  }\r\n}\r\n","import { AnyLayerOptions } from '../shared/layers/any-layer.interface';\nimport { VectorTileLayerOptions } from '../shared/layers/vectortile-layer.interface';\n\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\n  if (\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\n    (vectorTileLayerOptions.igoStyle?.styleByAttribute?.hoverStyle ||\n      vectorTileLayerOptions.igoStyle?.hoverStyle)\n  ) {\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\n  }\n  return layerOptions;\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { NgxIndexedDBService } from 'ngx-indexed-db';\r\nimport { Observable, Subject, of } from 'rxjs';\r\nimport { concatMap, first } from 'rxjs/operators';\r\n\r\nimport { LayerDBData } from './layerDB.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerDBService {\r\n  readonly dbName: string = 'layerData';\r\n\r\n  constructor(private ngxIndexedDBService: NgxIndexedDBService) {}\r\n\r\n  /**\r\n   * This method allow to update the stored layer into the indexeddb (layerData)\r\n   * @param layerDBData\r\n   * @returns\r\n   */\r\n  update(layerDBData: LayerDBData): Observable<any> {\r\n    const subject: Subject<LayerDBData> = new Subject();\r\n    this.ngxIndexedDBService\r\n      .getByID(this.dbName, layerDBData.layerId)\r\n      .pipe(\r\n        first(),\r\n        concatMap((dbObject: LayerDBData) => {\r\n          if (!dbObject) {\r\n            return this.ngxIndexedDBService.add(this.dbName, layerDBData);\r\n          } else {\r\n            return this.customUpdate(layerDBData);\r\n          }\r\n        })\r\n      )\r\n      .subscribe((response) => {\r\n        subject.next(response);\r\n        subject.complete();\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  private customUpdate(layerDBData: LayerDBData): Observable<LayerDBData> {\r\n    const subject: Subject<LayerDBData> = new Subject();\r\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\r\n      this.dbName,\r\n      layerDBData.layerId\r\n    );\r\n    deleteRequest\r\n      .pipe(\r\n        concatMap((isDeleted) =>\r\n          isDeleted\r\n            ? this.ngxIndexedDBService.add(this.dbName, layerDBData)\r\n            : of(undefined)\r\n        )\r\n      )\r\n      .subscribe((object) => {\r\n        if (object) {\r\n          subject.next(object);\r\n        }\r\n        subject.complete();\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  /**\r\n   * This method retrieve an idb layer definition\r\n   * @param layerId\r\n   * @returns\r\n   */\r\n  getByID(layerId: string): Observable<LayerDBData> {\r\n    return this.ngxIndexedDBService.getByID(this.dbName, layerId);\r\n  }\r\n\r\n  /**\r\n   * This method delete an idb layer definition\r\n   * @param layerId\r\n   * @returns\r\n   */\r\n  deleteByKey(layerId: string): Observable<boolean> {\r\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, layerId);\r\n  }\r\n\r\n  /**\r\n   * This method retrive all idb layer definition\r\n   * @param layerId\r\n   * @returns\r\n   */\r\n  getAll(): Observable<LayerDBData[]> {\r\n    return this.ngxIndexedDBService.getAll(this.dbName);\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable, Optional } from '@angular/core';\r\n\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { MessageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport olLayerVectorTile from 'ol/layer/VectorTile';\r\nimport { Style } from 'ol/style';\r\nimport * as olStyle from 'ol/style';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\n\r\nimport { stylefunction } from 'ol-mapbox-style';\r\nimport { Observable, combineLatest, of } from 'rxjs';\r\nimport { catchError, concatMap, map } from 'rxjs/operators';\r\n\r\nimport {\r\n  ArcGISRestDataSource,\r\n  CartoDataSource,\r\n  ClusterDataSource,\r\n  FeatureDataSource,\r\n  ImageArcGISRestDataSource,\r\n  MVTDataSource,\r\n  OSMDataSource,\r\n  TileArcGISRestDataSource,\r\n  TileDebugDataSource,\r\n  WFSDataSource,\r\n  WMSDataSource,\r\n  WMTSDataSource,\r\n  WebSocketDataSource,\r\n  XYZDataSource\r\n} from '../../datasource';\r\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\r\nimport { LayerDBService } from '../../offline/layerDB/layerDB.service';\r\nimport { GeoNetworkService } from '../../offline/shared/geo-network.service';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\r\nimport {\r\n  AnyLayerOptions,\r\n  ImageLayer,\r\n  ImageLayerOptions,\r\n  Layer,\r\n  LayerOptions,\r\n  TileLayer,\r\n  TileLayerOptions,\r\n  VectorLayer,\r\n  VectorLayerOptions,\r\n  VectorTileLayer,\r\n  VectorTileLayerOptions\r\n} from './layers';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private styleService: StyleService,\r\n    private dataSourceService: DataSourceService,\r\n    private geoNetworkService: GeoNetworkService,\r\n    private messageService: MessageService,\r\n    private layerDBService: LayerDBService,\r\n    @Optional() private authInterceptor: AuthInterceptor\r\n  ) {}\r\n\r\n  createLayer(layerOptions: AnyLayerOptions): Layer {\r\n    if (!layerOptions.source) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      layerOptions.source.options &&\r\n      layerOptions.source.options._layerOptionsFromSource\r\n    ) {\r\n      layerOptions = ObjectUtils.mergeDeep(\r\n        layerOptions.source.options._layerOptionsFromSource,\r\n        layerOptions || {}\r\n      );\r\n    }\r\n\r\n    let layer;\r\n    switch (layerOptions.source.constructor) {\r\n      case OSMDataSource:\r\n      case WMTSDataSource:\r\n      case XYZDataSource:\r\n      case TileDebugDataSource:\r\n      case CartoDataSource:\r\n      case TileArcGISRestDataSource:\r\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\r\n        break;\r\n      case FeatureDataSource:\r\n      case WFSDataSource:\r\n      case ArcGISRestDataSource:\r\n      case WebSocketDataSource:\r\n      case ClusterDataSource:\r\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\r\n        break;\r\n      case ImageArcGISRestDataSource:\r\n      case WMSDataSource:\r\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\r\n        break;\r\n      case MVTDataSource:\r\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\r\n        layer = this.createVectorTileLayer(\r\n          _layerOptions as VectorTileLayerOptions\r\n        );\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return layer;\r\n  }\r\n\r\n  createAsyncLayer(\r\n    _layerOptions: AnyLayerOptions,\r\n    detailedContextUri?: string\r\n  ): Observable<Layer> {\r\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\r\n    if (layerOptions.source) {\r\n      return new Observable((d) => d.next(this.createLayer(layerOptions)));\r\n    }\r\n\r\n    return this.dataSourceService\r\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\r\n      .pipe(\r\n        map((source) => {\r\n          if (source === undefined) {\r\n            return undefined;\r\n          }\r\n          return this.createLayer(Object.assign(layerOptions, { source }));\r\n        })\r\n      );\r\n  }\r\n\r\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\r\n    return new ImageLayer(\r\n      layerOptions,\r\n      this.messageService,\r\n      this.authInterceptor\r\n    );\r\n  }\r\n\r\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\r\n    return new TileLayer(\r\n      layerOptions,\r\n      this.messageService,\r\n      this.authInterceptor\r\n    );\r\n  }\r\n\r\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\r\n    let style: Style[] | Style | OlStyleLike = layerOptions.style;\r\n    let igoLayer: VectorLayer;\r\n\r\n    if (!layerOptions.igoStyle) {\r\n      layerOptions.igoStyle = {};\r\n    }\r\n    const legacyStyleOptions = [\r\n      'styleByAttribute',\r\n      'hoverStyle',\r\n      'mapboxStyle',\r\n      'clusterBaseStyle',\r\n      'style'\r\n    ];\r\n    // handling legacy property.\r\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\r\n    if (\r\n      layerOptions.igoStyle.igoStyleObject &&\r\n      !layerOptions.idbInfo?.storeToIdb\r\n    ) {\r\n      style = (feature, resolution) =>\r\n        this.styleService.createStyle(\r\n          layerOptions.igoStyle.igoStyleObject,\r\n          feature,\r\n          resolution\r\n        );\r\n    } else if (\r\n      layerOptions.igoStyle.igoStyleObject &&\r\n      layerOptions.idbInfo?.storeToIdb\r\n    ) {\r\n      // temporary fix todo : handle it with geostyler.\r\n      style = this.styleService.parseStyle(\r\n        'style',\r\n        layerOptions.igoStyle.igoStyleObject\r\n      );\r\n    }\r\n\r\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\r\n      const source = layerOptions.source as ArcGISRestDataSource;\r\n      style = source.options.params.style;\r\n    } else if (layerOptions.igoStyle?.styleByAttribute) {\r\n      const serviceStyle = this.styleService;\r\n      layerOptions.style = (feature, resolution) => {\r\n        return serviceStyle.createStyleByAttribute(\r\n          feature,\r\n          layerOptions.igoStyle.styleByAttribute,\r\n          resolution\r\n        );\r\n      };\r\n      igoLayer = new VectorLayer(\r\n        layerOptions,\r\n        this.messageService,\r\n        this.authInterceptor,\r\n        this.geoNetworkService,\r\n        this.geoNetworkService.geoDBService,\r\n        this.layerDBService\r\n      );\r\n    }\r\n\r\n    if (layerOptions.source instanceof ClusterDataSource) {\r\n      const serviceStyle = this.styleService;\r\n      const baseStyle = layerOptions.igoStyle.clusterBaseStyle;\r\n      layerOptions.style = (feature, resolution) => {\r\n        return serviceStyle.createClusterStyle(\r\n          feature,\r\n          resolution,\r\n          layerOptions.clusterParam,\r\n          baseStyle\r\n        );\r\n      };\r\n      igoLayer = new VectorLayer(\r\n        layerOptions,\r\n        this.messageService,\r\n        this.authInterceptor,\r\n        this.geoNetworkService,\r\n        this.geoNetworkService.geoDBService,\r\n        this.layerDBService\r\n      );\r\n    }\r\n\r\n    const layerOptionsOl = Object.assign({}, layerOptions, {\r\n      style\r\n    });\r\n\r\n    if (!igoLayer) {\r\n      igoLayer = new VectorLayer(\r\n        layerOptionsOl,\r\n        this.messageService,\r\n        this.authInterceptor,\r\n        this.geoNetworkService,\r\n        this.geoNetworkService.geoDBService,\r\n        this.layerDBService\r\n      );\r\n    }\r\n\r\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\r\n\r\n    return igoLayer;\r\n  }\r\n\r\n  private handleLegacyStyles(layerOptions, legacyStyleOptions: string[]) {\r\n    legacyStyleOptions.map((legacyOption) => {\r\n      if (layerOptions[legacyOption]) {\r\n        let newKey = legacyOption;\r\n        if (legacyOption === 'style') {\r\n          if (layerOptions[legacyOption] instanceof olStyle.Style) {\r\n            return;\r\n          }\r\n          if (typeof layerOptions[legacyOption] === 'object') {\r\n            newKey = 'igoStyleObject';\r\n          } else {\r\n            return;\r\n          }\r\n        }\r\n        layerOptions.igoStyle[newKey] = layerOptions[legacyOption];\r\n        delete layerOptions[legacyOption];\r\n        console.warn(`\r\n        The location of this style option (${legacyOption}) is deprecated.\r\n        Please move this property within igoStyle property.\r\n        Ex: ${legacyOption}: {...} must be transfered to igoStyle: { ${newKey}: {...} }\r\n        This legacy conversion will be deleted in 2024.\r\n        `);\r\n      }\r\n    });\r\n  }\r\n\r\n  private createVectorTileLayer(\r\n    layerOptions: VectorTileLayerOptions\r\n  ): VectorTileLayer {\r\n    let style: Style[] | Style | OlStyleLike;\r\n    let igoLayer: VectorTileLayer;\r\n\r\n    if (!layerOptions.igoStyle) {\r\n      layerOptions.igoStyle = {};\r\n    }\r\n    const legacyStyleOptions = [\r\n      'styleByAttribute',\r\n      'hoverStyle',\r\n      'mapboxStyle',\r\n      'style'\r\n    ];\r\n    // handling legacy property.\r\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\r\n\r\n    if (layerOptions.igoStyle.igoStyleObject) {\r\n      style = (feature, resolution) =>\r\n        this.styleService.createStyle(\r\n          layerOptions.igoStyle.igoStyleObject,\r\n          feature,\r\n          resolution\r\n        );\r\n    }\r\n\r\n    if (layerOptions.igoStyle.styleByAttribute) {\r\n      const serviceStyle = this.styleService;\r\n      layerOptions.style = (feature, resolution) => {\r\n        return serviceStyle.createStyleByAttribute(\r\n          feature,\r\n          layerOptions.igoStyle.styleByAttribute,\r\n          resolution\r\n        );\r\n      };\r\n      igoLayer = new VectorTileLayer(\r\n        layerOptions,\r\n        this.messageService,\r\n        this.authInterceptor\r\n      );\r\n    }\r\n\r\n    const layerOptionsOl = Object.assign({}, layerOptions, {\r\n      style\r\n    });\r\n\r\n    if (!igoLayer) {\r\n      igoLayer = new VectorTileLayer(\r\n        layerOptionsOl,\r\n        this.messageService,\r\n        this.authInterceptor\r\n      );\r\n    }\r\n\r\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\r\n    return igoLayer;\r\n  }\r\n\r\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\r\n    if (layerOptions.igoStyle?.mapboxStyle) {\r\n      this.getStuff(layerOptions.igoStyle.mapboxStyle.url).subscribe((res) => {\r\n        if (res.sprite) {\r\n          const url = this.getAbsoluteUrl(\r\n            layerOptions.igoStyle.mapboxStyle.url,\r\n            res.sprite\r\n          );\r\n          this.getStuff(url + '.json').subscribe((res2) => {\r\n            stylefunction(\r\n              layer.ol as olLayerVectorTile,\r\n              res,\r\n              layerOptions.igoStyle.mapboxStyle.source,\r\n              undefined,\r\n              res2,\r\n              url + '.png'\r\n            );\r\n          });\r\n        } else {\r\n          stylefunction(\r\n            layer.ol as olLayerVectorTile,\r\n            res,\r\n            layerOptions.igoStyle.mapboxStyle.source\r\n          );\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private getStuff(url: string) {\r\n    return this.http.get(url).pipe(\r\n      map((res: any) => res),\r\n      catchError((err) => {\r\n        console.log('No style was found');\r\n        return of(err);\r\n      })\r\n    );\r\n  }\r\n\r\n  private getAbsoluteUrl(source, url) {\r\n    const r = new RegExp('^http|//', 'i');\r\n    if (r.test(url)) {\r\n      return url;\r\n    } else {\r\n      if (source.substr(source.length - 1) === '/') {\r\n        return source + url;\r\n      } else {\r\n        return source + '/' + url;\r\n      }\r\n    }\r\n  }\r\n\r\n  createAsyncIdbLayers(contextUri: string = '*'): Observable<Layer[]> {\r\n    return this.layerDBService.getAll().pipe(\r\n      concatMap((res) => {\r\n        const idbLayers =\r\n          contextUri !== '*'\r\n            ? res.filter((l) => l.detailedContextUri === contextUri)\r\n            : res;\r\n        const layersOptions: LayerOptions[] = idbLayers.map((idbl) =>\r\n          Object.assign({}, idbl.layerOptions, {\r\n            sourceOptions: idbl.sourceOptions\r\n          })\r\n        );\r\n        return combineLatest(\r\n          layersOptions.map((layerOptions) =>\r\n            this.createAsyncLayer(layerOptions)\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  ElementRef,\r\n  EventEmitter,\r\n  HostListener,\r\n  Input,\r\n  Output,\r\n  Renderer2\r\n} from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[igoListItem]'\r\n})\r\nexport class ListItemDirective {\r\n  static focusedCls = 'igo-list-item-focused';\r\n  static selectedCls = 'igo-list-item-selected';\r\n  static disabledCls = 'igo-list-item-disabled';\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  @Input()\r\n  get focused() {\r\n    return this._focused;\r\n  }\r\n  set focused(value: boolean) {\r\n    if (value === this._focused) {\r\n      return;\r\n    }\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\r\n\r\n    this._focused = value;\r\n    if (this.selected !== true) {\r\n      this.toggleFocusedClass();\r\n    }\r\n\r\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\r\n  }\r\n  private _focused = false;\r\n\r\n  @Input()\r\n  get selected() {\r\n    return this._selected;\r\n  }\r\n  set selected(value: boolean) {\r\n    if (value === this._selected) {\r\n      return;\r\n    }\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\r\n\r\n    this._selected = value;\r\n    this._focused = value;\r\n    this.toggleSelectedClass();\r\n\r\n    value ? this.select.emit(this) : this.unselect.emit(this);\r\n  }\r\n  private _selected = false;\r\n\r\n  @Input()\r\n  get disabled() {\r\n    return this._disabled;\r\n  }\r\n  set disabled(value: boolean) {\r\n    if (value === this._disabled) {\r\n      return;\r\n    }\r\n\r\n    if (value === true) {\r\n      this.selected = false;\r\n    }\r\n\r\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\r\n\r\n    this._disabled = value;\r\n    this.toggleDisabledClass();\r\n\r\n    value ? this.disable.emit(this) : this.enable.emit(this);\r\n  }\r\n  private _disabled = false;\r\n\r\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\r\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\r\n  @Output() focus = new EventEmitter<ListItemDirective>();\r\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\r\n  @Output() select = new EventEmitter<ListItemDirective>();\r\n  @Output() unselect = new EventEmitter<ListItemDirective>();\r\n  @Output() disable = new EventEmitter<ListItemDirective>();\r\n  @Output() enable = new EventEmitter<ListItemDirective>();\r\n\r\n  @HostListener('click')\r\n  onClick() {\r\n    this.selected = true;\r\n  }\r\n\r\n  constructor(\r\n    public renderer: Renderer2,\r\n    public el: ElementRef\r\n  ) {}\r\n\r\n  getOffsetTop(): number {\r\n    const padding = 5;\r\n\r\n    return this.el.nativeElement.offsetTop - padding;\r\n  }\r\n\r\n  private toggleFocusedClass() {\r\n    if (this.focused) {\r\n      this.addCls(ListItemDirective.focusedCls);\r\n    } else {\r\n      this.removeCls(ListItemDirective.focusedCls);\r\n    }\r\n  }\r\n\r\n  private toggleSelectedClass() {\r\n    if (this.selected) {\r\n      this.addCls(ListItemDirective.selectedCls);\r\n      this.removeCls(ListItemDirective.focusedCls);\r\n    } else {\r\n      this.removeCls(ListItemDirective.selectedCls);\r\n    }\r\n  }\r\n\r\n  private toggleDisabledClass() {\r\n    if (this.disabled) {\r\n      this.addCls(ListItemDirective.disabledCls);\r\n    } else {\r\n      this.removeCls(ListItemDirective.disabledCls);\r\n    }\r\n  }\r\n\r\n  private addCls(cls: string) {\r\n    this.renderer.addClass(this.el.nativeElement, cls);\r\n  }\r\n\r\n  private removeCls(cls: string) {\r\n    this.renderer.removeClass(this.el.nativeElement, cls);\r\n  }\r\n}\r\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Output\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoClickout]'\n})\nexport class ClickoutDirective {\n  @Output() clickout = new EventEmitter<MouseEvent>();\n\n  @HostListener('document:click', ['$event', '$event.target'])\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\n    if (!target) {\n      return;\n    }\n\n    if (!this.el.nativeElement.contains(target)) {\n      this.clickout.emit(event);\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n}\n","import {\r\n  AfterViewInit,\r\n  Component,\r\n  ContentChildren,\r\n  ElementRef,\r\n  HostListener,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport type { QueryList } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { ListItemDirective } from './list-item.directive';\r\n\r\n@Component({\r\n  selector: 'igo-list',\r\n  templateUrl: './list.component.html',\r\n  styleUrls: ['./list.component.scss']\r\n})\r\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\r\n  @Input()\r\n  get navigation() {\r\n    return this._navigation;\r\n  }\r\n  set navigation(value: boolean) {\r\n    this._navigation = value;\r\n  }\r\n  private _navigation = true;\r\n\r\n  @Input()\r\n  get selection() {\r\n    return this._selection;\r\n  }\r\n  set selection(value: boolean) {\r\n    this._selection = value;\r\n  }\r\n  private _selection = true;\r\n\r\n  get selectedItem() {\r\n    return this._selectedItem;\r\n  }\r\n  set selectedItem(value: ListItemDirective) {\r\n    this.focusedItem = value;\r\n    this._selectedItem = value;\r\n  }\r\n  private _selectedItem: ListItemDirective;\r\n\r\n  get focusedItem() {\r\n    return this._focusedItem;\r\n  }\r\n  set focusedItem(value: ListItemDirective) {\r\n    this._focusedItem = value;\r\n  }\r\n  private _focusedItem: ListItemDirective;\r\n\r\n  private navigationEnabled: boolean;\r\n  private listItems$$: Subscription;\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  @ContentChildren(ListItemDirective, { descendants: true })\r\n  listItems: QueryList<ListItemDirective>;\r\n\r\n  @HostListener('document:keydown', ['$event'])\r\n  @HostListener('document:enter', ['$event'])\r\n  handleKeyboardEvent(event: KeyboardEvent) {\r\n    // It would be nice to be able to unsubscribe to the event\r\n    // completely but until ES7 this won't be possible because\r\n    // document events are not observables\r\n    if (this.navigationEnabled) {\r\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\r\n        event.preventDefault();\r\n        this.navigate(event.key);\r\n      } else if (event.key === 'Enter') {\r\n        this.select(this.focusedItem);\r\n      }\r\n    }\r\n  }\r\n\r\n  constructor(private el: ElementRef) {}\r\n\r\n  ngOnInit() {\r\n    this.enableNavigation();\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    if (this.listItems.length) {\r\n      this.init();\r\n    }\r\n\r\n    this.listItems$$ = this.listItems.changes.subscribe(\r\n      (items: ListItemDirective[]) => this.init()\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.listItems$$.unsubscribe();\r\n  }\r\n\r\n  focus(item?: ListItemDirective) {\r\n    if (!this.selection) {\r\n      return;\r\n    }\r\n\r\n    this.unfocus();\r\n\r\n    // We need to make this check because dynamic\r\n    // lists such as in the search results list may fail\r\n    if (item !== undefined) {\r\n      item.focused = true;\r\n    }\r\n  }\r\n\r\n  unfocus() {\r\n    if (this.focusedItem !== undefined) {\r\n      this.focusedItem.focused = false;\r\n    }\r\n\r\n    this.focusedItem = undefined;\r\n  }\r\n\r\n  focusNext() {\r\n    const items = this.listItems.toArray();\r\n    let item;\r\n    const igoList = this.el.nativeElement;\r\n    let disabled = true;\r\n    let index = this.getFocusedIndex();\r\n    if (index === undefined) {\r\n      index = -1;\r\n    }\r\n\r\n    while (disabled && index < items.length - 1) {\r\n      index += 1;\r\n      item = items[index];\r\n      disabled = item.disabled;\r\n    }\r\n\r\n    if (item !== undefined) {\r\n      this.focus(item);\r\n    }\r\n\r\n    if (!items[index + 1]) {\r\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\r\n      return;\r\n    }\r\n\r\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\r\n      igoList.scrollTop =\r\n        item.el.nativeElement.offsetTop +\r\n        item.el.nativeElement.children[0].offsetHeight -\r\n        igoList.clientHeight;\r\n    }\r\n  }\r\n\r\n  focusPrevious() {\r\n    const items = this.listItems.toArray();\r\n    let item: ListItemDirective;\r\n    const igoList = this.el.nativeElement;\r\n    let disabled = true;\r\n    let index = this.getFocusedIndex();\r\n\r\n    while (disabled && index > 0) {\r\n      index -= 1;\r\n      item = items[index];\r\n      disabled = item.disabled;\r\n    }\r\n\r\n    if (item !== undefined) {\r\n      this.focus(item);\r\n    }\r\n\r\n    if (!items[index - 1]) {\r\n      igoList.scrollTop = 0;\r\n      return;\r\n    }\r\n\r\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\r\n      const padding = 3;\r\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\r\n    }\r\n  }\r\n\r\n  select(item?: ListItemDirective) {\r\n    if (!this.selection) {\r\n      return;\r\n    }\r\n\r\n    this.unselect();\r\n\r\n    if (item !== undefined) {\r\n      item.selected = true;\r\n    }\r\n  }\r\n\r\n  unselect() {\r\n    this.unfocus();\r\n\r\n    if (this.selectedItem !== undefined) {\r\n      this.selectedItem.selected = false;\r\n    }\r\n\r\n    this.selectedItem = undefined;\r\n  }\r\n\r\n  enableNavigation() {\r\n    if (this.navigation) {\r\n      this.navigationEnabled = true;\r\n    }\r\n  }\r\n\r\n  disableNavigation() {\r\n    this.navigationEnabled = false;\r\n  }\r\n\r\n  scrollToItem(item: ListItemDirective) {\r\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\r\n  }\r\n\r\n  isScrolledIntoView(elem) {\r\n    const docViewTop =\r\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\r\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\r\n\r\n    const elemTop = elem.offsetTop;\r\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\r\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\r\n  }\r\n\r\n  private init() {\r\n    this.subscribe();\r\n\r\n    this.selectedItem = this.findSelectedItem();\r\n    this.focusedItem = this.findFocusedItem();\r\n\r\n    this.enableNavigation();\r\n  }\r\n\r\n  private subscribe() {\r\n    this.unsubscribe();\r\n\r\n    this.listItems.toArray().forEach((item) => {\r\n      this.subscriptions.push(\r\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemBeforeSelect(item2)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        item.select.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemSelect(item2)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemBeforeFocus(item2)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        item.focus.subscribe((item2: ListItemDirective) =>\r\n          this.handleItemFocus(item2)\r\n        )\r\n      );\r\n    }, this);\r\n  }\r\n\r\n  private unsubscribe() {\r\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\r\n    this.subscriptions = [];\r\n  }\r\n\r\n  private handleItemBeforeFocus(item: ListItemDirective) {\r\n    if (item !== this.focusedItem) {\r\n      this.unfocus();\r\n    }\r\n  }\r\n\r\n  private handleItemFocus(item: ListItemDirective) {\r\n    this.focusedItem = item;\r\n  }\r\n\r\n  private handleItemBeforeSelect(item: ListItemDirective) {\r\n    if (item !== this.focusedItem) {\r\n      this.unselect();\r\n    }\r\n  }\r\n\r\n  private handleItemSelect(item: ListItemDirective) {\r\n    this.selectedItem = item;\r\n  }\r\n\r\n  private findSelectedItem() {\r\n    return this.listItems.toArray().find((item) => item.selected);\r\n  }\r\n\r\n  private findFocusedItem() {\r\n    return this.listItems.toArray().find((item) => item.focused);\r\n  }\r\n\r\n  private getFocusedIndex() {\r\n    return this.listItems\r\n      .toArray()\r\n      .findIndex((item) => item === this.focusedItem);\r\n  }\r\n\r\n  private navigate(key: string) {\r\n    switch (key) {\r\n      case 'ArrowUp':\r\n        this.focusPrevious();\r\n        break;\r\n      case 'ArrowDown':\r\n        this.focusNext();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n}\r\n","<mat-list\n  igoClickout\n  [ngClass]=\"{ selectable: selection }\"\n  (clickout)=\"disableNavigation()\"\n  (click)=\"enableNavigation()\"\n>\n  <ng-content></ng-content>\n</mat-list>\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatSliderModule } from '@angular/material/slider';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoCustomHtmlModule,\r\n  IgoImageModule,\r\n  IgoListModule,\r\n  IgoMatBadgeIconModule,\r\n  IgoPanelModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { StyleService } from '../style/style-service/style.service';\r\nimport { LayerItemComponent } from './layer-item/layer-item.component';\r\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\r\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\r\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\r\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\r\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\r\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\r\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\r\nimport { LayerListComponent } from './layer-list/layer-list.component';\r\nimport { LayerService } from './shared/layer.service';\r\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    MatInputModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    CommonModule,\r\n    FormsModule,\r\n    MatDividerModule,\r\n    MatMenuModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSlideToggleModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    MatListModule,\r\n    MatSliderModule,\r\n    MatBadgeModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule,\r\n    IgoImageModule,\r\n    IgoPanelModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoCustomHtmlModule\r\n  ],\r\n  exports: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ],\r\n  declarations: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ]\r\n})\r\nexport class IgoLayerModule {\r\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\r\n    return {\r\n      ngModule: IgoLayerModule,\r\n      providers: [LayerService, StyleService, LayerListToolService]\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport {\r\n  MetadataAbstractComponent,\r\n  MetadataButtonComponent\r\n} from './metadata-button/metadata-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule,\r\n    MatDialogModule\r\n  ],\r\n  exports: [MetadataButtonComponent, MetadataAbstractComponent],\r\n  declarations: [MetadataButtonComponent, MetadataAbstractComponent]\r\n})\r\nexport class IgoMetadataModule {\r\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\r\n    return {\r\n      ngModule: IgoMetadataModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport * as olextent from 'ol/extent';\r\nimport * as olformat from 'ol/format';\r\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\r\nimport olFormatGML2 from 'ol/format/GML2';\r\nimport olFormatGML3 from 'ol/format/GML3';\r\nimport * as olgeom from 'ol/geom';\r\n\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, mergeMap } from 'rxjs/operators';\r\nimport { default as striptags } from 'striptags';\r\n\r\nimport {\r\n  CartoDataSource,\r\n  ImageArcGISRestDataSource,\r\n  TileArcGISRestDataSource,\r\n  WMSDataSource,\r\n  WMSDataSourceOptions\r\n} from '../../datasource';\r\nimport { FEATURE } from '../../feature/shared/feature.enums';\r\nimport {\r\n  Feature,\r\n  FeatureGeometry\r\n} from '../../feature/shared/feature.interfaces';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { MapExtent } from '../../map/shared/map.interface';\r\nimport {\r\n  QueryFormat,\r\n  QueryFormatMimeType,\r\n  QueryHtmlTarget\r\n} from './query.enums';\r\nimport {\r\n  QueryOptions,\r\n  QueryUrlData,\r\n  QueryableDataSource,\r\n  QueryableDataSourceOptions\r\n} from './query.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class QueryService {\r\n  public queryEnabled = true;\r\n  public defaultFeatureCount = 20; // default feature count\r\n  public featureCount = 20; // feature count\r\n\r\n  private previousMessageIds = [];\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\r\n    if (this.previousMessageIds.length) {\r\n      this.previousMessageIds.forEach((id) => {\r\n        this.messageService.remove(id);\r\n      });\r\n    }\r\n\r\n    const newLayers = layers\r\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\r\n      .map((layer: Layer) => this.queryLayer(layer, options));\r\n    // the directive accept array in this format [observable, observable...]\r\n    // if we use multiple 'url' in queryUrl so the result => this form [observable, observable, [observable, observable]]\r\n    // so we need to flat the array\r\n    let flatArray = [].concat.apply([], newLayers);\r\n    return flatArray;\r\n  }\r\n\r\n  queryLayer(\r\n    layer: Layer,\r\n    options: QueryOptions\r\n  ): Observable<Feature[]> | Observable<Feature[]>[] {\r\n    const url = this.getQueryUrl(\r\n      layer.dataSource,\r\n      options,\r\n      false,\r\n      layer.map.viewController.getExtent()\r\n    );\r\n    if (!url) {\r\n      return of([]);\r\n    }\r\n\r\n    const resolution: number = layer.map.viewController.getResolution();\r\n    const scale: number = layer.map.viewController.getScale();\r\n\r\n    if (\r\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\r\n      QueryFormat.HTMLGML2\r\n    ) {\r\n      if (typeof url === 'string') {\r\n        const urlGml = this.getQueryUrl(\r\n          layer.dataSource,\r\n          options,\r\n          true\r\n        ) as string;\r\n        return this.http.get(urlGml, { responseType: 'text' }).pipe(\r\n          mergeMap((gmlRes) => {\r\n            const mergedGML = this.mergeGML(gmlRes, url, layer);\r\n            const imposedGeom = mergedGML[0];\r\n            const imposedProperties = mergedGML[1];\r\n            return this.http\r\n              .get(url, { responseType: 'text' })\r\n              .pipe(\r\n                map((res) =>\r\n                  this.extractData(\r\n                    res,\r\n                    layer,\r\n                    options,\r\n                    url,\r\n                    imposedGeom,\r\n                    imposedProperties\r\n                  )\r\n                )\r\n              );\r\n          })\r\n        );\r\n      }\r\n      const urlGmls = this.getQueryUrl(layer.dataSource, options, true);\r\n      let observables: any = [];\r\n      for (let i = 0; i < urlGmls.length; i++) {\r\n        const element = urlGmls[i] as QueryUrlData;\r\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\r\n          observables.push(\r\n            this.requestDataForHTMLGML2(element.url, url[i].url, layer, options)\r\n          );\r\n        }\r\n      }\r\n      return observables;\r\n    } else {\r\n      if (typeof url === 'string') {\r\n        const request = this.http.get(url, { responseType: 'text' });\r\n        return request.pipe(\r\n          map((res) => this.extractData(res, layer, options, url))\r\n        );\r\n      }\r\n      let observables: any = [];\r\n      for (let i = 0; i < url.length; i++) {\r\n        const element: QueryUrlData = url[i];\r\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\r\n          const request = this.http.get(element.url, { responseType: 'text' });\r\n          observables.push(\r\n            request.pipe(\r\n              map((res) => this.extractData(res, layer, options, element.url))\r\n            )\r\n          );\r\n        }\r\n      }\r\n      return observables;\r\n    }\r\n  }\r\n\r\n  private requestDataForHTMLGML2(\r\n    urlGml: string,\r\n    url: string,\r\n    layer: Layer,\r\n    options: QueryOptions\r\n  ): Observable<Feature[]> {\r\n    return this.http.get(urlGml, { responseType: 'text' }).pipe(\r\n      mergeMap((gmlRes) => {\r\n        const mergedGML = this.mergeGML(gmlRes, url, layer);\r\n        const imposedGeom = mergedGML[0];\r\n        const imposedProperties = mergedGML[1];\r\n        return this.http\r\n          .get(url, { responseType: 'text' })\r\n          .pipe(\r\n            map((res) =>\r\n              this.extractData(\r\n                res,\r\n                layer,\r\n                options,\r\n                url,\r\n                imposedGeom,\r\n                imposedProperties\r\n              )\r\n            )\r\n          );\r\n      })\r\n    );\r\n  }\r\n\r\n  private checkScaleAndResolution(\r\n    resolution: number,\r\n    scale: number,\r\n    element: QueryUrlData\r\n  ): boolean {\r\n    let checkScale: boolean;\r\n    let checkResolution: boolean;\r\n\r\n    if (\r\n      !element.minResolution &&\r\n      !element.maxResolution &&\r\n      !element.minScale &&\r\n      !element.maxScale\r\n    ) {\r\n      return true;\r\n    } else {\r\n      /******************* checking Resolution *******************/\r\n      if (element.minResolution && element.maxResolution) {\r\n        // if \"minResolution\" and \"maxResolution\" exists check if resoltion is between\r\n        if (\r\n          resolution >= element.minResolution &&\r\n          resolution <= element.maxResolution\r\n        ) {\r\n          checkResolution = true;\r\n        }\r\n      } else {\r\n        // check if \"minResolution\" or \"maxResolution\" exists\r\n        if (element.minResolution && resolution >= element.minResolution) {\r\n          checkResolution = true;\r\n        }\r\n        if (element.maxResolution && resolution <= element.maxResolution) {\r\n          checkResolution = true;\r\n        }\r\n      }\r\n\r\n      /******************* checking Scale *******************/\r\n      if (element.minScale && element.maxScale) {\r\n        // if \"minScale\" and \"maxScale\" exists check if scale is between\r\n        if (scale > element.minScale && scale < element.maxScale) {\r\n          checkScale = true;\r\n        }\r\n      } else {\r\n        // check if \"minScale\" or \"maxScale\" exists\r\n        if (element.maxScale && scale <= element.maxScale) {\r\n          checkScale = true;\r\n        }\r\n        if (element.minScale && scale >= element.minScale) {\r\n          checkScale = true;\r\n        }\r\n      }\r\n\r\n      /******************* result of checking *******************/\r\n      if (checkScale === true && checkResolution === true) {\r\n        return true;\r\n      } else if (\r\n        (checkResolution === true && !checkScale) ||\r\n        (checkScale === true && !checkResolution)\r\n      ) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  private mergeGML(\r\n    gmlRes,\r\n    url,\r\n    layer: Layer\r\n  ): [FeatureGeometry, { [key: string]: any }] {\r\n    const parser = new olFormatGML2();\r\n    let features = parser.readFeatures(gmlRes);\r\n    // Handle non standard GML output (MapServer)\r\n    if (features.length === 0) {\r\n      const wmsParser = new olformat.WMSGetFeatureInfo();\r\n      features = wmsParser.readFeatures(gmlRes);\r\n    }\r\n    const olmline = new olgeom.MultiLineString([]);\r\n    let pts;\r\n    const ptsArray = [];\r\n    let olmpoly = new olgeom.MultiPolygon([]);\r\n    let firstFeatureType;\r\n    const nbFeatures = features.length;\r\n\r\n    // Check if geometry intersect bbox\r\n    // for geoserver getfeatureinfo response in data projection, not call projection\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const bboxRaw = searchParams.bbox;\r\n    const bbox = bboxRaw.split(',');\r\n    const bboxExtent = olextent.createEmpty();\r\n    olextent.extend(bboxExtent, bbox);\r\n    const outBboxExtent = false;\r\n    let titleContent;\r\n    let queryTileField;\r\n    if (layer.options?.source?.options) {\r\n      const dataSourceOptions = layer.options.source\r\n        .options as QueryableDataSourceOptions;\r\n      if (dataSourceOptions.queryTitle) {\r\n        queryTileField = dataSourceOptions.queryTitle;\r\n      }\r\n    }\r\n    features.map((feature) => {\r\n      if (queryTileField) {\r\n        let queryTitleContent = feature.getProperties()[queryTileField];\r\n        if (queryTitleContent) {\r\n          titleContent = !titleContent\r\n            ? queryTitleContent\r\n            : `${titleContent},${queryTitleContent}`;\r\n        }\r\n      }\r\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\r\n        outBboxExtent = true;\r\n        // TODO: Check to project the geometry?\r\n      }*/\r\n      const featureGeometryCoordinates = (\r\n        feature.getGeometry() as any\r\n      ).getCoordinates();\r\n      const featureGeometryType = feature.getGeometry().getType();\r\n\r\n      if (!firstFeatureType && !outBboxExtent) {\r\n        firstFeatureType = featureGeometryType;\r\n      }\r\n      if (!outBboxExtent) {\r\n        switch (featureGeometryType) {\r\n          case 'Point':\r\n            if (nbFeatures === 1) {\r\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\r\n            } else {\r\n              ptsArray.push(featureGeometryCoordinates);\r\n            }\r\n            break;\r\n          case 'LineString':\r\n            olmline.appendLineString(\r\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\r\n            );\r\n            break;\r\n          case 'Polygon':\r\n            olmpoly.appendPolygon(\r\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\r\n            );\r\n            break;\r\n          case 'MultiPolygon':\r\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\r\n            break;\r\n          default:\r\n            return;\r\n        }\r\n      }\r\n    });\r\n\r\n    let olmpts;\r\n    if (ptsArray.length === 0 && pts) {\r\n      olmpts = {\r\n        type: pts.getType(),\r\n        coordinates: pts.getCoordinates()\r\n      };\r\n    } else {\r\n      olmpts = {\r\n        type: 'Polygon',\r\n        coordinates: [this.convexHull(ptsArray)]\r\n      };\r\n    }\r\n\r\n    let returnGeometry;\r\n    switch (firstFeatureType) {\r\n      case 'LineString':\r\n        returnGeometry = {\r\n          type: olmline.getType(),\r\n          coordinates: olmline.getCoordinates()\r\n        };\r\n        break;\r\n      case 'Point':\r\n        returnGeometry = olmpts;\r\n        break;\r\n      case 'Polygon':\r\n        returnGeometry = {\r\n          type: olmpoly.getType(),\r\n          coordinates: olmpoly.getCoordinates()\r\n        };\r\n        break;\r\n      case 'MultiPolygon':\r\n        returnGeometry = {\r\n          type: olmpoly.getType(),\r\n          coordinates: olmpoly.getCoordinates()\r\n        };\r\n        break;\r\n    }\r\n    const imposedProperties = {};\r\n\r\n    if (queryTileField) {\r\n      imposedProperties[queryTileField] = titleContent;\r\n    }\r\n\r\n    return [returnGeometry, imposedProperties];\r\n  }\r\n\r\n  cross(a, b, o) {\r\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\r\n  }\r\n\r\n  /**\r\n   * @param points An array of [X, Y] coordinates\r\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\r\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\r\n   */\r\n  convexHull(points) {\r\n    points.sort((a, b) => {\r\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\r\n    });\r\n\r\n    const lower = [];\r\n    for (const point of points) {\r\n      while (\r\n        lower.length >= 2 &&\r\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\r\n      ) {\r\n        lower.pop();\r\n      }\r\n      lower.push(point);\r\n    }\r\n\r\n    const upper = [];\r\n    for (let i = points.length - 1; i >= 0; i--) {\r\n      while (\r\n        upper.length >= 2 &&\r\n        this.cross(\r\n          upper[upper.length - 2],\r\n          upper[upper.length - 1],\r\n          points[i]\r\n        ) <= 0\r\n      ) {\r\n        upper.pop();\r\n      }\r\n      upper.push(points[i]);\r\n    }\r\n\r\n    upper.pop();\r\n    lower.pop();\r\n    return lower.concat(upper);\r\n  }\r\n\r\n  private extractData(\r\n    res,\r\n    layer: Layer,\r\n    options: QueryOptions,\r\n    url: string,\r\n    imposedGeometry?,\r\n    imposedProperties?: { [key: string]: any }\r\n  ): Feature[] {\r\n    const queryDataSource = layer.dataSource as QueryableDataSource;\r\n\r\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\r\n    let features = [];\r\n    switch (queryDataSource.options.queryFormat) {\r\n      case QueryFormat.GML3:\r\n        features = this.extractGML3Data(\r\n          res,\r\n          layer.zIndex,\r\n          allowedFieldsAndAlias\r\n        );\r\n        break;\r\n      case QueryFormat.JSON:\r\n      case QueryFormat.GEOJSON:\r\n      case QueryFormat.GEOJSON2:\r\n        features = this.extractGeoJSONData(\r\n          res,\r\n          layer.zIndex,\r\n          allowedFieldsAndAlias\r\n        );\r\n        break;\r\n      case QueryFormat.ESRIJSON:\r\n        features = this.extractEsriJSONData(\r\n          res,\r\n          layer.zIndex,\r\n          allowedFieldsAndAlias\r\n        );\r\n        break;\r\n      case QueryFormat.TEXT:\r\n        features = this.extractTextData(res);\r\n        break;\r\n      case QueryFormat.HTML:\r\n        features = this.extractHtmlData(\r\n          res,\r\n          queryDataSource.queryHtmlTarget,\r\n          url\r\n        );\r\n        break;\r\n      case QueryFormat.HTMLGML2:\r\n        features = this.extractHtmlData(\r\n          res,\r\n          queryDataSource.queryHtmlTarget,\r\n          url,\r\n          imposedGeometry,\r\n          imposedProperties\r\n        );\r\n        break;\r\n      case QueryFormat.GML2:\r\n      default:\r\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\r\n        break;\r\n    }\r\n    if (\r\n      features.length > 0 &&\r\n      (features[0].geometry === null || !features[0].geometry)\r\n    ) {\r\n      const geomToAdd = this.createGeometryFromUrlClick(url);\r\n\r\n      for (const feature of features) {\r\n        feature.geometry = geomToAdd;\r\n      }\r\n    }\r\n\r\n    const wmsDatasource = layer.dataSource as WMSDataSource;\r\n    const featureCount = wmsDatasource.params?.FEATURE_COUNT\r\n      ? new RegExp('FEATURE_COUNT=' + this.featureCount)\r\n      : new RegExp('FEATURE_COUNT=' + this.defaultFeatureCount);\r\n\r\n    if (\r\n      featureCount.test(url) &&\r\n      ((wmsDatasource.params?.FEATURE_COUNT &&\r\n        this.featureCount > 1 &&\r\n        features.length === this.featureCount) ||\r\n        (!wmsDatasource.params?.FEATURE_COUNT &&\r\n          features.length === this.defaultFeatureCount))\r\n    ) {\r\n      const messageObj = this.messageService.info(\r\n        'igo.geo.query.featureCountMax',\r\n        undefined,\r\n        undefined,\r\n        { value: layer.title }\r\n      );\r\n      this.previousMessageIds.push(messageObj.toastId);\r\n    }\r\n\r\n    return features.map((feature: Feature, index: number) => {\r\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\r\n\r\n      let exclude;\r\n      if (layer.options.sourceOptions?.type === 'wms') {\r\n        const sourceOptions = layer.options\r\n          .sourceOptions as WMSDataSourceOptions;\r\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\r\n      }\r\n\r\n      let title = this.getQueryTitle(feature, layer);\r\n      if (!title && features.length > 1) {\r\n        title = `${layer.title} (${index + 1})`;\r\n      } else if (!title) {\r\n        title = layer.title;\r\n      }\r\n\r\n      const meta = Object.assign({}, feature.meta || {}, {\r\n        id: uuid(),\r\n        title,\r\n        mapTitle: mapLabel,\r\n        sourceTitle: layer.title,\r\n        order: 1000 - layer.zIndex,\r\n        excludeAttribute: exclude\r\n      });\r\n\r\n      return Object.assign(feature, {\r\n        meta,\r\n        projection:\r\n          queryDataSource.options.type === 'carto'\r\n            ? 'EPSG:4326'\r\n            : options.projection\r\n      });\r\n    });\r\n  }\r\n\r\n  private createGeometryFromUrlClick(url) {\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const bboxRaw = searchParams.bbox;\r\n    const width = parseInt(searchParams.width, 10);\r\n    const height = parseInt(searchParams.height, 10);\r\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\r\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\r\n\r\n    const bbox = bboxRaw.split(',');\r\n    let threshold =\r\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\r\n\r\n    // for context in degree (EPSG:4326,4269...)\r\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\r\n      threshold = 0.045;\r\n    }\r\n    const clickx =\r\n      parseFloat(bbox[0]) +\r\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\r\n        width -\r\n      threshold;\r\n    const clicky =\r\n      parseFloat(bbox[1]) +\r\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\r\n        height -\r\n      threshold;\r\n    const clickx1 = clickx + threshold * 2;\r\n    const clicky1 = clicky + threshold * 2;\r\n\r\n    const wktPoly =\r\n      'POLYGON((' +\r\n      clickx +\r\n      ' ' +\r\n      clicky +\r\n      ', ' +\r\n      clickx +\r\n      ' ' +\r\n      clicky1 +\r\n      ', ' +\r\n      clickx1 +\r\n      ' ' +\r\n      clicky1 +\r\n      ', ' +\r\n      clickx1 +\r\n      ' ' +\r\n      clicky +\r\n      ', ' +\r\n      clickx +\r\n      ' ' +\r\n      clicky +\r\n      '))';\r\n\r\n    const format = new olformat.WKT();\r\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\r\n    const f = tenPercentWidthGeom.getGeometry() as any;\r\n\r\n    const newGeom = {\r\n      type: f.getType(),\r\n      coordinates: f.getCoordinates()\r\n    };\r\n\r\n    return newGeom;\r\n  }\r\n\r\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\r\n    const parser = new olFormatGML2();\r\n    let features = parser.readFeatures(res);\r\n    // Handle non standard GML output (MapServer)\r\n    if (features.length === 0) {\r\n      const wmsParser = new olformat.WMSGetFeatureInfo();\r\n      try {\r\n        features = wmsParser.readFeatures(res);\r\n      } catch (e) {\r\n        console.warn(\r\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\r\n        );\r\n      }\r\n    }\r\n\r\n    return features.map((feature) =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\r\n    const parser = new olFormatGML3();\r\n    let features = [];\r\n    try {\r\n      features = parser.readFeatures(res);\r\n    } catch (e) {\r\n      console.warn('query.service: GML3 is not well supported');\r\n    }\r\n    return features.map((feature) =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\r\n    let features = [];\r\n    try {\r\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\r\n    } catch (e) {\r\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\r\n    }\r\n    features.map(\r\n      (feature) =>\r\n        (feature.meta = {\r\n          id: uuid(),\r\n          order: 1000 - zIndex,\r\n          alias: allowedFieldsAndAlias\r\n        })\r\n    );\r\n    return features;\r\n  }\r\n\r\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\r\n    if (res) {\r\n      try {\r\n        if (JSON.parse(res).error) {\r\n          return [];\r\n        }\r\n      } catch (e) {}\r\n    }\r\n    const parser = new olFormatEsriJSON();\r\n    const features = parser.readFeatures(res);\r\n\r\n    return features.map((feature) =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractTextData(res) {\r\n    // TODO\r\n    return [];\r\n  }\r\n\r\n  private extractHtmlData(\r\n    res,\r\n    htmlTarget: QueryHtmlTarget,\r\n    url,\r\n    imposedGeometry?,\r\n    imposedProperties?: { [key: string]: any }\r\n  ) {\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\r\n    const geomToAdd = this.createGeometryFromUrlClick(url);\r\n\r\n    if (\r\n      htmlTarget !== QueryHtmlTarget.BLANK &&\r\n      htmlTarget !== QueryHtmlTarget.IFRAME\r\n    ) {\r\n      htmlTarget = QueryHtmlTarget.IFRAME;\r\n    }\r\n\r\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\r\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\r\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\r\n    const body = striptags(\r\n      res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, '')\r\n    );\r\n    if (body === '' || res === '') {\r\n      return [];\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: FEATURE,\r\n        projection,\r\n        properties: Object.assign(\r\n          { target: htmlTarget, body: res, url },\r\n          imposedProperties\r\n        ),\r\n        geometry: imposedGeometry || geomToAdd\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getQueryParams(url) {\r\n    const queryString = url.split('?');\r\n    if (!queryString[1]) {\r\n      return;\r\n    }\r\n    const pairs = queryString[1].split('&');\r\n\r\n    const result = {};\r\n    pairs.forEach((pair) => {\r\n      pair = pair.split('=');\r\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\r\n    });\r\n    return result;\r\n  }\r\n\r\n  public featureToResult(\r\n    featureOL: olFeature<olgeom.Geometry>,\r\n    zIndex: number,\r\n    allowedFieldsAndAlias?\r\n  ): Feature {\r\n    const featureGeometry = featureOL.getGeometry() as any;\r\n    const properties: any = Object.assign({}, featureOL.getProperties());\r\n    delete properties.geometry;\r\n    delete properties.GEOMETRIE;\r\n    delete properties.boundedBy;\r\n    delete properties.shape;\r\n    delete properties.SHAPE;\r\n    delete properties.SHAPE_S;\r\n    delete properties.SHAPE_L;\r\n    delete properties.SHAPE_P;\r\n    delete properties.the_geom;\r\n    delete properties.geom;\r\n    delete properties.geom32198;\r\n\r\n    let geometry;\r\n    if (featureGeometry) {\r\n      geometry = {\r\n        type: featureGeometry.getType(),\r\n        coordinates: featureGeometry.getCoordinates()\r\n      };\r\n    }\r\n\r\n    return {\r\n      type: FEATURE,\r\n      projection: undefined,\r\n      properties,\r\n      geometry,\r\n      meta: {\r\n        id: uuid(),\r\n        order: 1000 - zIndex,\r\n        alias: allowedFieldsAndAlias\r\n      }\r\n    };\r\n  }\r\n\r\n  private getQueryUrl(\r\n    datasource: QueryableDataSource,\r\n    options: QueryOptions,\r\n    forceGML2 = false,\r\n    mapExtent?: MapExtent\r\n  ): string | QueryUrlData[] {\r\n    let url;\r\n\r\n    if (datasource.options.queryUrls) {\r\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\r\n    }\r\n\r\n    switch (datasource.constructor) {\r\n      case WMSDataSource:\r\n        const wmsDatasource = datasource as WMSDataSource;\r\n\r\n        const WMSGetFeatureInfoOptions = {\r\n          INFO_FORMAT:\r\n            wmsDatasource.params.INFO_FORMAT ||\r\n            this.getMimeInfoFormat(datasource.options.queryFormat),\r\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\r\n          FEATURE_COUNT:\r\n            wmsDatasource.params.FEATURE_COUNT || this.defaultFeatureCount\r\n        };\r\n\r\n        if (wmsDatasource.params.FEATURE_COUNT) {\r\n          this.featureCount = wmsDatasource.params.FEATURE_COUNT;\r\n        }\r\n\r\n        if (forceGML2) {\r\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\r\n            QueryFormat.GML2\r\n          );\r\n        }\r\n\r\n        url = wmsDatasource.ol.getFeatureInfoUrl(\r\n          options.coordinates,\r\n          options.resolution,\r\n          options.projection,\r\n          WMSGetFeatureInfoOptions\r\n        );\r\n        // const wmsVersion =\r\n        //   wmsDatasource.params.VERSION ||\r\n        //   wmsDatasource.params.version ||\r\n        //   '1.3.0';\r\n        // if (wmsVersion !== '1.3.0') {\r\n        //   url = url.replace('&I=', '&X=');\r\n        //   url = url.replace('&J=', '&Y=');\r\n        // }\r\n        break;\r\n      case CartoDataSource:\r\n        const cartoDatasource = datasource as CartoDataSource;\r\n        const baseUrl =\r\n          'https://' +\r\n          cartoDatasource.options.account +\r\n          '.carto.com/api/v2/sql?';\r\n        const format = 'format=GeoJSON';\r\n        const sql =\r\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\r\n        const clause =\r\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\r\n        const meters = cartoDatasource.options.queryPrecision\r\n          ? cartoDatasource.options.queryPrecision\r\n          : '1000';\r\n        const coordinates =\r\n          options.coordinates[0] +\r\n          ',' +\r\n          options.coordinates[1] +\r\n          '),3857),' +\r\n          meters +\r\n          '))';\r\n\r\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\r\n        break;\r\n      case ImageArcGISRestDataSource:\r\n      case TileArcGISRestDataSource:\r\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\r\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\r\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\r\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\r\n        const clickBuffer = maxDelta * 0.005;\r\n        const threshold = tileArcGISRestDatasource.options.queryPrecision\r\n          ? tileArcGISRestDatasource.options.queryPrecision\r\n          : clickBuffer;\r\n        const extent = olextent.buffer(\r\n          olextent.boundingExtent([options.coordinates]),\r\n          threshold\r\n        );\r\n        const serviceUrl =\r\n          tileArcGISRestDatasource.options.url +\r\n          '/' +\r\n          tileArcGISRestDatasource.options.layer +\r\n          '/query/';\r\n        const geometry = encodeURIComponent(\r\n          '{\"xmin\":' +\r\n            extent[0] +\r\n            ',\"ymin\":' +\r\n            extent[1] +\r\n            ',\"xmax\":' +\r\n            extent[2] +\r\n            ',\"ymax\":' +\r\n            extent[3] +\r\n            ',\"spatialReference\":{\"wkid\":102100}}'\r\n        );\r\n        const params = [\r\n          'f=json',\r\n          `geometry=${geometry}`,\r\n          'geometryType=esriGeometryEnvelope',\r\n          'inSR=102100',\r\n          'spatialRel=esriSpatialRelIntersects',\r\n          'outFields=*',\r\n          'returnGeometry=true',\r\n          'outSR=102100'\r\n        ];\r\n        url = `${serviceUrl}?${params.join('&')}`;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return url;\r\n  }\r\n\r\n  private getMimeInfoFormat(queryFormat: string) {\r\n    let mime = 'application/vnd.ogc.gml';\r\n    const keyEnum = Object.keys(QueryFormat).find(\r\n      (key) => QueryFormat[key] === queryFormat\r\n    );\r\n    if (keyEnum) {\r\n      mime = QueryFormatMimeType[keyEnum];\r\n    }\r\n\r\n    return mime;\r\n  }\r\n\r\n  getAllowedFieldsAndAlias(layer: any) {\r\n    let allowedFieldsAndAlias;\r\n    if (\r\n      layer.options?.source?.options?.sourceFields &&\r\n      layer.options.source.options.sourceFields.length >= 1\r\n    ) {\r\n      allowedFieldsAndAlias = {};\r\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\r\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\r\n        allowedFieldsAndAlias[sourceField.name] = alias;\r\n      });\r\n    }\r\n    return allowedFieldsAndAlias;\r\n  }\r\n\r\n  getQueryTitle(feature: Feature, layer: Layer): string {\r\n    let title;\r\n    if (layer.options?.source?.options) {\r\n      const dataSourceOptions = layer.options.source\r\n        .options as QueryableDataSourceOptions;\r\n      if (dataSourceOptions.queryTitle) {\r\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\r\n      }\r\n    }\r\n\r\n    return title;\r\n  }\r\n\r\n  getLabelMatch(feature: Feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach((v) => {\r\n      label = label.replace(v[0], feature.properties[v[1]]);\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.properties[labelMatch] || labelMatch;\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  /**\r\n   * @param datasource QueryableDataSource\r\n   * @param options QueryOptions\r\n   * @mapExtent extent of the map when click event\r\n   *\r\n   */\r\n\r\n  getCustomQueryUrl(\r\n    datasource: QueryableDataSource,\r\n    options: QueryOptions,\r\n    mapExtent?: MapExtent\r\n  ): QueryUrlData[] {\r\n    const extent = olextent.getForViewAndSize(\r\n      options.coordinates,\r\n      options.resolution,\r\n      0,\r\n      [101, 101]\r\n    );\r\n\r\n    return datasource.options.queryUrls.map((item) => {\r\n      let data: QueryUrlData = {\r\n        url: item.url\r\n          .replace(/\\{bbox\\}/g, extent.join(','))\r\n          .replace(/\\{x\\}/g, options.coordinates[0].toString())\r\n          .replace(/\\{y\\}/g, options.coordinates[1].toString())\r\n          .replace(/\\{resolution\\}/g, options.resolution.toString())\r\n          .replace(/\\{srid\\}/g, options.projection.replace('EPSG:', ''))\r\n      };\r\n\r\n      // if the queryFormat changed to \"QueryFormat.HTMLGML2\": mapExtent will be undefined\r\n      // we need to check \"mapExtent\" befor replace variables in the url\r\n      if (mapExtent) {\r\n        data.url\r\n          .replace(/\\{xmin\\}/g, mapExtent[0].toString())\r\n          .replace(/\\{ymin\\}/g, mapExtent[1].toString())\r\n          .replace(/\\{xmax\\}/g, mapExtent[2].toString())\r\n          .replace(/\\{ymax\\}/g, mapExtent[3].toString());\r\n      }\r\n\r\n      if (item.maxResolution) {\r\n        data.maxResolution = item.maxResolution;\r\n      }\r\n\r\n      if (item.minResolution) {\r\n        data.minResolution = item.minResolution;\r\n      }\r\n\r\n      if (item.minScale) {\r\n        data.minScale = item.minScale;\r\n      }\r\n\r\n      if (item.maxScale) {\r\n        data.maxScale = item.maxScale;\r\n      }\r\n\r\n      return data;\r\n    });\r\n  }\r\n}\r\n","import {\r\n  AfterViewInit,\r\n  Directive,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  Output,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { EventsKey } from 'ol/events';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlLayer from 'ol/layer/Layer';\r\nimport OlRenderFeature from 'ol/render/Feature';\r\nimport OlSource from 'ol/source/Source';\r\nimport olVectorSource from 'ol/source/Vector';\r\n\r\nimport { Observable, Subscription, of, zip } from 'rxjs';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\r\nimport { featureFromOl } from '../../feature/shared/feature.utils';\r\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\r\nimport { QueryableDataSourceOptions } from './query.interfaces';\r\nimport { QueryService } from './query.service';\r\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\r\n\r\n/**\r\n * This directive makes a map queryable with a click of with a drag box.\r\n * By default, all layers are queryable but this can ben controlled at\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoQuery]'\r\n})\r\nexport class QueryDirective implements AfterViewInit, OnDestroy {\r\n  /**\r\n   * Subscriptions to ongoing queries\r\n   */\r\n  private queries$$: Subscription[] = [];\r\n\r\n  /**\r\n   * Listener to the map click event\r\n   */\r\n  private mapClickListener;\r\n\r\n  /**\r\n   * OL drag box interaction\r\n   */\r\n  private olDragSelectInteraction: OlDragSelectInteraction;\r\n\r\n  /**\r\n   * Ol drag box \"end\" event key\r\n   */\r\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\r\n\r\n  /**\r\n   * Whter to query features or not\r\n   */\r\n  @Input() queryFeatures: boolean = false;\r\n\r\n  /**\r\n   * Feature query hit tolerance\r\n   */\r\n  @Input() queryFeaturesHitTolerance: number = 0;\r\n\r\n  /**\r\n   * Feature query hit tolerance\r\n   */\r\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\r\n\r\n  /**\r\n   * Whether all query should complete before emitting an event\r\n   */\r\n  @Input() waitForAllQueries: boolean = true;\r\n\r\n  /**\r\n   * Event emitted when a query (or all queries) complete\r\n   */\r\n  @Output() query = new EventEmitter<{\r\n    features: Feature[] | Feature[][];\r\n    event: MapBrowserPointerEvent<any>;\r\n  }>();\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map as any as IgoMap;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private queryService: QueryService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to click and drag box events\r\n   * @internal\r\n   */\r\n  ngAfterViewInit() {\r\n    this.listenToMapClick();\r\n    this.addDragBoxInteraction();\r\n  }\r\n\r\n  /**\r\n   * Stop listening to click and drag box events and cancel ongoind requests\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.cancelOngoingQueries();\r\n    this.unlistenToMapClick();\r\n    this.removeDragBoxInteraction();\r\n  }\r\n\r\n  /**\r\n   * On map click, issue queries\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map clicks\r\n   */\r\n  private unlistenToMapClick() {\r\n    unByKey(this.mapClickListener);\r\n    this.mapClickListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Issue queries from a map event and emit events with the results\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\r\n    this.cancelOngoingQueries();\r\n    if (!this.queryService.queryEnabled) {\r\n      return;\r\n    }\r\n\r\n    const queries$ = [];\r\n    if (this.queryFeatures) {\r\n      queries$.push(this.doQueryFeatures(event));\r\n    }\r\n\r\n    const resolution = this.map.ol.getView().getResolution();\r\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\r\n    queries$.push(\r\n      ...this.queryService.query(queryLayers, {\r\n        coordinates: event.coordinate as [number, number],\r\n        projection: this.map.projection,\r\n        resolution\r\n      })\r\n    );\r\n\r\n    if (queries$.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (this.waitForAllQueries) {\r\n      this.queries$$.push(\r\n        zip(...queries$).subscribe((results: Feature[][]) => {\r\n          const features = [].concat(...results);\r\n          this.query.emit({ features, event });\r\n        })\r\n      );\r\n    } else {\r\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\r\n        return query$.subscribe((features: Feature[]) => {\r\n          this.query.emit({ features, event });\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Query features already present on the map\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private doQueryFeatures(\r\n    event: MapBrowserPointerEvent<any>\r\n  ): Observable<Feature[]> {\r\n    const clickedFeatures = [];\r\n\r\n    if (event.type === 'singleclick') {\r\n      this.map.ol.forEachFeatureAtPixel(\r\n        event.pixel,\r\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\r\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\r\n          if (\r\n            (layer.dataSource.options as QueryableDataSourceOptions)\r\n              .queryFormatAsWms\r\n          ) {\r\n            return;\r\n          }\r\n          if (featureOL) {\r\n            if (featureOL.get('features')) {\r\n              for (const feature of featureOL.get('features')) {\r\n                const newFeature = featureFromOl(feature, this.map.projection);\r\n                newFeature.meta = {\r\n                  title: feature.values_.nom,\r\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\r\n                  icon: feature.values_._icon,\r\n                  sourceTitle: layerOL.values_.title,\r\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer)\r\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\r\n                };\r\n                clickedFeatures.push(newFeature);\r\n              }\r\n            } else if (featureOL instanceof OlRenderFeature) {\r\n              const newFeature = renderFeatureFromOl(\r\n                featureOL,\r\n                this.map.projection,\r\n                layerOL\r\n              );\r\n              newFeature.meta = {\r\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\r\n                sourceTitle: layerOL.values_.title,\r\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n                title:\r\n                  this.queryService.getQueryTitle(newFeature, layer) ||\r\n                  newFeature.meta.title\r\n              };\r\n              clickedFeatures.push(newFeature);\r\n            } else {\r\n              const newFeature = featureFromOl(\r\n                featureOL,\r\n                this.map.projection,\r\n                layerOL\r\n              );\r\n              newFeature.meta = {\r\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\r\n                sourceTitle: layerOL.values_.title,\r\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n                title:\r\n                  this.queryService.getQueryTitle(newFeature, layer) ||\r\n                  newFeature.meta.title\r\n              };\r\n              clickedFeatures.push(newFeature);\r\n            }\r\n          }\r\n        },\r\n        {\r\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\r\n          layerFilter: this.queryFeaturesCondition\r\n            ? this.queryFeaturesCondition\r\n            : olLayerFeatureIsQueryable\r\n        }\r\n      );\r\n    } else if (event.type === 'boxend') {\r\n      const target = event.target as any;\r\n      const dragExtent = target.getGeometry().getExtent();\r\n      this.map.layers\r\n        .filter(layerIsQueryable)\r\n        .filter((layer) => layer instanceof VectorLayer && layer.visible)\r\n        .map((layer) => {\r\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\r\n          featuresOL.forEachFeatureIntersectingExtent(\r\n            dragExtent,\r\n            (olFeature: any) => {\r\n              const newFeature: Feature = featureFromOl(\r\n                olFeature,\r\n                this.map.projection,\r\n                layer.ol\r\n              );\r\n              newFeature.meta = {\r\n                id: layer.id + '.' + olFeature.getId(),\r\n                icon: olFeature.values_._icon,\r\n                sourceTitle: layer.title,\r\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\r\n                title:\r\n                  this.queryService.getQueryTitle(newFeature, layer) ||\r\n                  newFeature.meta.title\r\n              };\r\n              clickedFeatures.push(newFeature);\r\n            }\r\n          );\r\n        });\r\n    }\r\n\r\n    return of(clickedFeatures);\r\n  }\r\n\r\n  /**\r\n   * Cancel ongoing requests, if any\r\n   */\r\n  private cancelOngoingQueries() {\r\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\r\n    this.queries$$ = [];\r\n  }\r\n\r\n  /**\r\n   * Add a drag box interaction and, on drag box end, select features\r\n   */\r\n  private addDragBoxInteraction() {\r\n    let olDragSelectInteractionOnQuery;\r\n    const olInteractions = this.map.ol.getInteractions().getArray();\r\n\r\n    // There can only be one dragbox interaction, so find the current one, if any\r\n    // Don't keep a reference to the current dragbox because we don't want\r\n    // to remove it when this startegy is deactivated\r\n    for (const olInteraction of olInteractions) {\r\n      if (olInteraction instanceof OlDragSelectInteraction) {\r\n        olDragSelectInteractionOnQuery = olInteraction;\r\n        break;\r\n      }\r\n    }\r\n    // If no drag box interaction is found, create a new one and add it to the map\r\n    if (olDragSelectInteractionOnQuery === undefined) {\r\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\r\n        condition: ctrlKeyDown\r\n      });\r\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\r\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\r\n    }\r\n\r\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\r\n      'boxend',\r\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove drag box interaction\r\n   */\r\n  private removeDragBoxInteraction() {\r\n    if (this.olDragSelectInteractionEndKey !== undefined) {\r\n      unByKey(this.olDragSelectInteractionEndKey);\r\n    }\r\n    if (this.olDragSelectInteraction !== undefined) {\r\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\r\n    }\r\n    this.olDragSelectInteraction = undefined;\r\n  }\r\n}\r\n","import { Workspace } from '@igo2/common';\r\nimport { StorageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { FeatureStore } from '../../../feature';\r\nimport {\r\n  ISearchSourceParams,\r\n  SearchSourceOptions,\r\n  SearchSourceSettings\r\n} from './source.interfaces';\r\n\r\n/**\r\n * Base search source class\r\n */\r\nexport class SearchSource {\r\n  /**\r\n   * Search source ID\r\n   * @internal\r\n   */\r\n  static id = '';\r\n\r\n  /**\r\n   * Search source type\r\n   * @internal\r\n   */\r\n  static type = '';\r\n\r\n  /**\r\n   * Search source options\r\n   * @internal\r\n   */\r\n  protected options: SearchSourceOptions;\r\n\r\n  /**\r\n   * Get search source's id\r\n   * @returns Search source's id\r\n   */\r\n  getId(): string {\r\n    throw new Error('You have to implement the method \"getId\".');\r\n  }\r\n  /**\r\n   * Get search source's type\r\n   * @returns Search source's type\r\n   */\r\n  getType(): string {\r\n    throw new Error('You have to implement the method \"getType\".');\r\n  }\r\n\r\n  /**\r\n   * Get search source's default options\r\n   * @returns Search source default options\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\r\n  }\r\n\r\n  /**\r\n   * Search source's title\r\n   */\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  /**\r\n   * Whether the search source is available\r\n   */\r\n  get available(): boolean {\r\n    return this.options.available !== false;\r\n  }\r\n\r\n  /**\r\n   * Whether the search source is enabled\r\n   */\r\n  set enabled(value: boolean) {\r\n    this.options.enabled = value;\r\n  }\r\n  get enabled(): boolean {\r\n    return this.available && this.options.enabled !== false;\r\n  }\r\n\r\n  get showInPointerSummary(): boolean {\r\n    const showInPointerSummary = this.options.showInPointerSummary;\r\n    return showInPointerSummary ? showInPointerSummary : false;\r\n  }\r\n\r\n  get showInSettings(): boolean {\r\n    const showInSettings = this.options.showInSettings;\r\n    return showInSettings === undefined ? true : showInSettings;\r\n  }\r\n\r\n  /**\r\n   * Search url\r\n   */\r\n  get searchUrl(): string {\r\n    return this.options.searchUrl;\r\n  }\r\n\r\n  /**\r\n   * Search query params\r\n   */\r\n  get params(): ISearchSourceParams | null {\r\n    return this.options.params;\r\n  }\r\n\r\n  /**\r\n   * Search settings\r\n   */\r\n  get settings(): SearchSourceSettings[] {\r\n    return this.options.settings === undefined ? [] : this.options.settings;\r\n  }\r\n\r\n  set featureStoresWithIndex(storesWithIndex: FeatureStore[]) {\r\n    this._featureStoresWithIndex = storesWithIndex;\r\n  }\r\n  get featureStoresWithIndex() {\r\n    return this._featureStoresWithIndex;\r\n  }\r\n  private _featureStoresWithIndex: FeatureStore[];\r\n\r\n  setWorkspaces(workspaces: Workspace[]) {\r\n    if (\r\n      workspaces.filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\r\n        .length >= 1\r\n    ) {\r\n      this.options.available = true;\r\n    } else {\r\n      this.options.available = false;\r\n    }\r\n    const values = [];\r\n    this.featureStoresWithIndex = workspaces\r\n      .filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\r\n      .map((fw) => {\r\n        values.push({\r\n          title: fw.title,\r\n          value: fw.title,\r\n          enabled: true\r\n        });\r\n        return fw.entityStore as FeatureStore;\r\n      });\r\n    const datasets = this.options.settings.find((s) => s.title === 'datasets');\r\n    if (datasets) {\r\n      datasets.values = values;\r\n    }\r\n    this.setParamFromSetting(datasets);\r\n  }\r\n\r\n  /**\r\n   * Set params from selected settings\r\n   */\r\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\r\n    switch (setting.type) {\r\n      case 'radiobutton':\r\n        setting.values.forEach((conf) => {\r\n          if (conf.enabled) {\r\n            this.options.params = Object.assign(this.options.params || {}, {\r\n              [setting.name]: conf.value\r\n            });\r\n          }\r\n        });\r\n        break;\r\n      case 'checkbox':\r\n        let confValue = '';\r\n        setting.values\r\n          .filter((s) => s.available !== false)\r\n          .forEach((conf) => {\r\n            if (conf.enabled) {\r\n              confValue += conf.value + ',';\r\n            }\r\n          });\r\n        confValue = confValue.slice(0, -1);\r\n        this.options.params = Object.assign(this.options.params || {}, {\r\n          [setting.name]: confValue\r\n        });\r\n        break;\r\n    }\r\n\r\n    if (saveInStorage && this.storageService) {\r\n      this.storageService.set(this.getId() + '.options', {\r\n        params: this.options.params\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search results display order\r\n   */\r\n  get displayOrder(): number {\r\n    return this.options.order === undefined ? 99 : this.options.order;\r\n  }\r\n\r\n  constructor(\r\n    options: SearchSourceOptions,\r\n    private storageService?: StorageService\r\n  ) {\r\n    this.options = options;\r\n    if (this.storageService) {\r\n      const storageOptions = this.storageService.get(\r\n        this.getId() + '.options'\r\n      ) as object;\r\n      if (storageOptions) {\r\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\r\n      }\r\n    }\r\n\r\n    this.options = ObjectUtils.mergeDeep(\r\n      this.getDefaultOptions(),\r\n      this.options\r\n    );\r\n\r\n    // Set Default Params from Settings\r\n    this.settings.forEach((setting) => {\r\n      this.setParamFromSetting(setting, false);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get hashtags valid\r\n   * @param hashtag hashtag from query\r\n   */\r\n  getHashtagsValid(term: string, settingsName: string): string[] {\r\n    const hashtags = term.match(/(#[A-Za-z--+]+)/g);\r\n    if (!hashtags) {\r\n      return undefined;\r\n    }\r\n\r\n    const searchSourceSetting = this.getSettingsValues(settingsName);\r\n    const hashtagsValid = [];\r\n    hashtags.forEach((hashtag) => {\r\n      searchSourceSetting.values.forEach((conf) => {\r\n        const hashtagKey = hashtag.substring(1);\r\n        if (typeof conf.value === 'string') {\r\n          const types = conf.value\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n            .split(',');\r\n          const index = types.indexOf(\r\n            hashtagKey\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '')\r\n          );\r\n          if (index !== -1) {\r\n            hashtagsValid.push(types[index]);\r\n          }\r\n        }\r\n        if (\r\n          conf.hashtags &&\r\n          conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1\r\n        ) {\r\n          hashtagsValid.push(conf.value);\r\n        }\r\n      });\r\n    });\r\n\r\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\r\n  }\r\n\r\n  getSettingsValues(search: string): SearchSourceSettings {\r\n    return this.getDefaultOptions().settings.find(\r\n      (value: SearchSourceSettings) => {\r\n        return value.name === search;\r\n      }\r\n    );\r\n  }\r\n}\r\n","import { Inject, Injectable } from '@angular/core';\r\n\r\nimport { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\r\n\r\n/**\r\n * Map search source. For now it has no search capability. All it does\r\n * is act as a placeholder for the map query results' \"search source\".\r\n */\r\n@Injectable()\r\nexport class QuerySearchSource extends SearchSource {\r\n  static id = 'map';\r\n  static type = FEATURE;\r\n\r\n  constructor(@Inject('options') options: SearchSourceOptions) {\r\n    super(options);\r\n  }\r\n\r\n  getId(): string {\r\n    return QuerySearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return QuerySearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Carte'\r\n    };\r\n  }\r\n}\r\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return `https://www.google.com/maps/search/?api=1&query=${lat}%2C${lon}`;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return `https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${lat}%2C${lon}`;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return `https://www.google.com/maps/search/?api=1&query=${encodedName}`;\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { RegexService } from '@igo2/core';\r\n\r\nimport { GeoServiceDefinition } from './propertyTypeDetector.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PropertyTypeDetectorService {\r\n  public geoServiceRegexes: GeoServiceDefinition[] = [];\r\n\r\n  constructor(private regexService: RegexService) {\r\n    this.geoServiceRegexes = this.getGeoServiceRegexes();\r\n  }\r\n\r\n  getPropertyType(value) {\r\n    return typeof value;\r\n  }\r\n\r\n  private isUrl(value): boolean {\r\n    const regex = /^https?:\\/\\//;\r\n    return regex.test(value.toString());\r\n  }\r\n\r\n  isGeoService(value): boolean {\r\n    let isGeoService = false;\r\n    if (!this.isUrl) {\r\n      return;\r\n    }\r\n    for (const geoServiceRegex of this.geoServiceRegexes) {\r\n      const domainRegex = new RegExp(geoServiceRegex.url);\r\n      if (domainRegex.test(value)) {\r\n        isGeoService = true;\r\n        break;\r\n      }\r\n    }\r\n    return isGeoService;\r\n  }\r\n\r\n  getGeoService(\r\n    url: string,\r\n    availableProperties: string[]\r\n  ): GeoServiceDefinition {\r\n    if (!this.isGeoService(url)) {\r\n      return;\r\n    }\r\n    let matchingGeoservice: GeoServiceDefinition;\r\n    for (const geoServiceRegex of this.geoServiceRegexes) {\r\n      const domainRegex = new RegExp(geoServiceRegex.url);\r\n      if (domainRegex.test(url)) {\r\n        // providing the the first matching regex;\r\n        const matchingProperties = availableProperties.filter((p) =>\r\n          geoServiceRegex.propertiesForLayerName.includes(p)\r\n        );\r\n        matchingGeoservice = matchingProperties ? geoServiceRegex : undefined;\r\n        if (matchingGeoservice) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return matchingGeoservice;\r\n  }\r\n\r\n  private getGeoServiceRegexes(): GeoServiceDefinition[] {\r\n    return (this.regexService.get('geoservice') ||\r\n      []) as GeoServiceDefinition[];\r\n  }\r\n}\r\n","import { QueryFormat } from '../../query/shared/query.enums';\r\n\r\nexport type CatalogQueryFormatTypes = {\r\n  [key in QueryFormat]: string | string[];\r\n};\r\n\r\nexport enum CatalogItemType {\r\n  Layer = 'layer',\r\n  Group = 'group'\r\n}\r\n\r\nexport enum TypeCatalog {\r\n  wms,\r\n  wmts,\r\n  baselayers,\r\n  arcgisrest,\r\n  tilearcgisrest,\r\n  imagearcgisrest,\r\n  composite\r\n}\r\n\r\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\r\n","import { Observable } from 'rxjs';\r\n\r\nimport { TimeFilterOptions } from '../../filter/shared';\r\nimport { TooltipType } from '../../layer/shared';\r\nimport { QueryFormat, QueryHtmlTarget } from '../../query/shared';\r\nimport { TypeCatalogStrings } from './catalog.enum';\r\nimport { CatalogItem, CatalogItemGroup, ICatalog } from './catalog.interface';\r\n\r\nexport abstract class Catalog implements ICatalog {\r\n  id: string;\r\n  title: string;\r\n  url: string;\r\n  removable?: boolean;\r\n  externalProvider?: boolean;\r\n  abstract?: string;\r\n  forcedProperties?: any[];\r\n  items?: CatalogItem[];\r\n  type?: TypeCatalogStrings;\r\n  version?: string;\r\n  matrixSet?: string;\r\n  requestEncoding?: string;\r\n  regFilters?: string[];\r\n  groupImpose?: CatalogItemGroup;\r\n  groupSeparator?: string;\r\n  timeFilter?: TimeFilterOptions;\r\n  queryFormat?: QueryFormat;\r\n  queryHtmlTarget?: QueryHtmlTarget;\r\n  queryParams?: { [key: string]: string };\r\n  sourceOptions?: { [key: string]: any };\r\n  count?: number;\r\n  tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\r\n  sortDirection?: 'asc' | 'desc';\r\n  setCrossOriginAnonymous?: boolean;\r\n  showLegend?: boolean;\r\n  profils?: string[];\r\n\r\n  constructor(options: Catalog) {\r\n    Object.assign(this, options);\r\n  }\r\n\r\n  public abstract collectCatalogItems(): Observable<CatalogItem[]>;\r\n}\r\n\r\nexport type CollectCatalogItemsFn = (\r\n  _this: Catalog\r\n) => Observable<CatalogItem[]>;\r\n","import { Observable } from 'rxjs';\r\n\r\nimport { Catalog, CollectCatalogItemsFn } from './catalog.abstract';\r\nimport { TypeCatalog } from './catalog.enum';\r\nimport {\r\n  CatalogItem,\r\n  CatalogItemGroup,\r\n  ICatalog,\r\n  ICompositeCatalog\r\n} from './catalog.interface';\r\n\r\nexport class WMSCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.wms];\r\n    this.type = TypeCatalog[sType];\r\n  }\r\n\r\n  public collectCatalogItems(): Observable<CatalogItem[]> {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class WMTSCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.wmts];\r\n    this.type = TypeCatalog[sType];\r\n  }\r\n\r\n  public collectCatalogItems(): Observable<CatalogItem[]> {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class BaselayersCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.baselayers];\r\n    this.type = TypeCatalog[sType];\r\n  }\r\n\r\n  public collectCatalogItems(): Observable<CatalogItemGroup[]> {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class ArcGISRestCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\r\n    this.type = TypeCatalog[sType];\r\n  }\r\n\r\n  public collectCatalogItems() {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class TileOrImageArcGISRestCatalog extends Catalog {\r\n  constructor(\r\n    options: Catalog,\r\n    public _collectCatlogItems: CollectCatalogItemsFn,\r\n    typeCatalog: TypeCatalog\r\n  ) {\r\n    super(options);\r\n    this.type = TypeCatalog[TypeCatalog[typeCatalog]];\r\n  }\r\n\r\n  public collectCatalogItems() {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n\r\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\r\n  declare composite: ICatalog[];\r\n\r\n  constructor(\r\n    options: Catalog,\r\n    private _collectCatlogItems: CollectCatalogItemsFn\r\n  ) {\r\n    super(options);\r\n    const sType: string = TypeCatalog[TypeCatalog.composite];\r\n    this.type = TypeCatalog[sType];\r\n    this.url = null;\r\n  }\r\n\r\n  public collectCatalogItems(): Observable<CatalogItem[]> {\r\n    return this._collectCatlogItems(this);\r\n  }\r\n}\r\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService, LanguageService, MessageService } from '@igo2/core';\r\nimport { ObjectUtils, uuid } from '@igo2/utils';\r\n\r\nimport { EMPTY, Observable, of, zip } from 'rxjs';\r\nimport { catchError, map } from 'rxjs/operators';\r\n\r\nimport {\r\n  ArcGISRestDataSourceOptions,\r\n  CapabilitiesService,\r\n  WMSDataSourceOptions,\r\n  WMSDataSourceOptionsParams,\r\n  WMTSDataSourceOptions\r\n} from '../../datasource';\r\nimport { ImageLayerOptions, LayerOptions } from '../../layer/shared';\r\nimport { getResolutionFromScale } from '../../map/shared';\r\nimport { QueryFormat } from '../../query/shared';\r\nimport { generateIdFromSourceOptions } from '../../utils';\r\nimport { Catalog } from './catalog.abstract';\r\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\r\nimport {\r\n  CatalogItem,\r\n  CatalogItemGroup,\r\n  CatalogItemLayer,\r\n  CatalogServiceOptions,\r\n  ForcedProperty\r\n} from './catalog.interface';\r\nimport {\r\n  ArcGISRestCatalog,\r\n  BaselayersCatalog,\r\n  CompositeCatalog,\r\n  TileOrImageArcGISRestCatalog,\r\n  WMSCatalog,\r\n  WMTSCatalog\r\n} from './catalogs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CatalogService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {}\r\n\r\n  loadCatalogs(): Observable<Catalog[]> {\r\n    const contextConfig = this.config.getConfig('context') || {};\r\n\r\n    const catalogConfig: CatalogServiceOptions =\r\n      this.config.getConfig('catalog') || {};\r\n    const apiUrl = catalogConfig.url || contextConfig.url;\r\n    const catalogsFromConfig = catalogConfig.sources || [];\r\n\r\n    const observables$ = [];\r\n\r\n    if (apiUrl) {\r\n      if (catalogConfig.baselayers) {\r\n        const translate = this.languageService.translate;\r\n        const title = translate.instant('igo.geo.catalog.baseLayers');\r\n        const baseLayersCatalog = [\r\n          {\r\n            id: 'catalog.baselayers',\r\n            title,\r\n            url: `${apiUrl}/baselayers`,\r\n            type: 'baselayers'\r\n          }\r\n        ];\r\n        observables$.push(of(baseLayersCatalog));\r\n      }\r\n\r\n      // Catalogs from API\r\n      const catalogsFromApi$ = this.http\r\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\r\n        .pipe(\r\n          map((catalogs) =>\r\n            catalogs.map((c: any) => Object.assign(c, c.options))\r\n          ),\r\n          catchError((_response: HttpErrorResponse) => EMPTY)\r\n        );\r\n      observables$.push(catalogsFromApi$);\r\n    }\r\n\r\n    // Catalogs from config\r\n    if (catalogsFromConfig.length > 0) {\r\n      observables$.push(\r\n        of(catalogsFromConfig).pipe(\r\n          map((catalogs: Catalog[]) =>\r\n            catalogs.map((c) => {\r\n              if (!c.id) {\r\n                c.id = uuid();\r\n              }\r\n              return c;\r\n            })\r\n          )\r\n        )\r\n      );\r\n    }\r\n\r\n    return zip(...observables$).pipe(\r\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\r\n    ) as Observable<Catalog[]>;\r\n  }\r\n\r\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    let newCatalog: Catalog;\r\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\r\n    return newCatalog.collectCatalogItems();\r\n  }\r\n\r\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\r\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\r\n      map((layersOptions: LayerOptions[]) => {\r\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\r\n          return {\r\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\r\n            title: layerOptions.title,\r\n            type: CatalogItemType.Layer,\r\n            externalProvider: catalog.externalProvider,\r\n            options: layerOptions\r\n          } as CatalogItemLayer;\r\n        });\r\n        return [\r\n          {\r\n            id: 'catalog.group.baselayers',\r\n            type: CatalogItemType.Group,\r\n            externalProvider: catalog.externalProvider,\r\n            title: catalog.title,\r\n            items\r\n          }\r\n        ];\r\n      })\r\n    );\r\n  }\r\n\r\n  private getCatalogBaseLayersOptions(\r\n    catalog: Catalog\r\n  ): Observable<LayerOptions[]> {\r\n    return this.http.get<LayerOptions[]>(catalog.url);\r\n  }\r\n\r\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => {\r\n        const items = [];\r\n        if (!capabilities) {\r\n          return items;\r\n        }\r\n        if (\r\n          capabilities.Service &&\r\n          capabilities.Service.Abstract &&\r\n          capabilities.Service.Abstract.length\r\n        ) {\r\n          catalog.abstract = capabilities.Service.Abstract;\r\n        }\r\n        const finalLayers = [];\r\n        this.flattenWmsCapabilities(\r\n          capabilities.Capability.Layer,\r\n          0,\r\n          finalLayers,\r\n          catalog.groupSeparator\r\n        );\r\n        const capabilitiesCapabilityLayer = Object.assign(\r\n          {},\r\n          capabilities.Capability.Layer\r\n        );\r\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(\r\n          (f) => f.Layer.length !== 0\r\n        );\r\n        this.includeRecursiveItems(catalog, capabilitiesCapabilityLayer, items);\r\n        return items;\r\n      })\r\n    );\r\n  }\r\n\r\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\r\n    if (!finalLayers.includes(parent.Title)) {\r\n      const modifiedParent = Object.assign({}, parent);\r\n      modifiedParent.Layer = [];\r\n      finalLayers.push(modifiedParent);\r\n    }\r\n    for (const layer of parent.Layer) {\r\n      const modifiedLayer = Object.assign({}, layer);\r\n      if (level > 0) {\r\n        modifiedLayer.Title = parent.Title + separator + layer.Title;\r\n      }\r\n      if (layer.Layer) {\r\n        this.flattenWmsCapabilities(\r\n          modifiedLayer,\r\n          level + 1,\r\n          finalLayers,\r\n          separator\r\n        );\r\n      } else {\r\n        finalLayers.find((ff) => ff.Title === parent.Title).Layer.push(layer);\r\n      }\r\n    }\r\n  }\r\n\r\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\r\n    );\r\n  }\r\n\r\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => {\r\n        return this.getArcGISRESTItems(catalog, capabilities);\r\n      })\r\n    );\r\n  }\r\n\r\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\r\n\r\n    const catalogsFromInstance = [] as Catalog[];\r\n    compositeCatalog.map((component: Catalog) => {\r\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\r\n      catalogsFromInstance.push(\r\n        CatalogFactory.createInstanceCatalog(component, this)\r\n      );\r\n    });\r\n\r\n    // get CatalogItems for each original Catalog-----------------------------------------------------\r\n    const request1$ = [];\r\n    catalogsFromInstance.map((component: Catalog) =>\r\n      request1$.push(component.collectCatalogItems())\r\n    );\r\n\r\n    // integrate imposed group -----------------------------------------------------\r\n    let request2$ = [];\r\n\r\n    function flatDeepLayer(arr) {\r\n      return arr.reduce(\r\n        (acc, val) =>\r\n          acc.concat(\r\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\r\n          ),\r\n        []\r\n      );\r\n    }\r\n\r\n    if (\r\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\r\n    ) {\r\n      const pushImposeGroup = (item, index) => {\r\n        const c = catalogsFromInstance[index];\r\n        const outGroupImpose = Object.assign({}, c.groupImpose);\r\n        outGroupImpose.address = c.id;\r\n        outGroupImpose.type = CatalogItemType.Group;\r\n        outGroupImpose.externalProvider = c.externalProvider;\r\n        if (outGroupImpose.sortDirection === undefined) {\r\n          outGroupImpose.sortDirection = c.sortDirection;\r\n        }\r\n        outGroupImpose.items = [];\r\n\r\n        const flatLayer = flatDeepLayer(item);\r\n        flatLayer.map(\r\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\r\n        );\r\n        outGroupImpose.items = flatLayer;\r\n\r\n        return outGroupImpose;\r\n      };\r\n\r\n      request2$ = request1$.map((obs, idx) =>\r\n        obs.pipe(\r\n          map((items) =>\r\n            compositeCatalog[idx].groupImpose\r\n              ? pushImposeGroup(items, idx)\r\n              : items\r\n          )\r\n        )\r\n      );\r\n    } else {\r\n      request2$ = request1$;\r\n    }\r\n\r\n    // concat Group -----------------------------------------------------\r\n    const request3$ = zip(...request2$).pipe(\r\n      map(\r\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\r\n      )\r\n    );\r\n\r\n    // merge Group (first level only) -----------------------------------------------------\r\n    const groupByGroupId = (data, keyFn) =>\r\n      data.reduce((acc, group) => {\r\n        const groupId = keyFn(group);\r\n        const ind = acc.find((x) => x.id === groupId);\r\n\r\n        if (!ind) {\r\n          acc[acc.length] = group;\r\n        } else {\r\n          const ix = acc.indexOf(ind);\r\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\r\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\r\n          }\r\n          acc[ix].items.push(...group.items);\r\n        }\r\n        return acc;\r\n      }, []);\r\n\r\n    // merge Layer for each Level (catalog, group(recursive))\r\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\r\n      items.reduce((acc, item, idx, arr) => {\r\n        const layerTitle = keyFn(item);\r\n        const outItem = Object.assign({}, item);\r\n\r\n        if (item.type === CatalogItemType.Layer) {\r\n          // same title, same address => result: only one item is kept\r\n\r\n          // same title, address diff\r\n          const indicesMatchTitle = [];\r\n          const indicesMatchNewMetadataUrl = []; // metadata\r\n          const diffAddress = arr.filter((x, i) => {\r\n            let bInd = false;\r\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\r\n              if (i !== idx && x.address !== item.address) {\r\n                bInd = true;\r\n              }\r\n              indicesMatchTitle.push(i);\r\n            }\r\n            return bInd;\r\n          }); // $& i !== idx\r\n\r\n          if (diffAddress.length > 0) {\r\n            let nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\r\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\r\n            nPosition =\r\n              indicesMatchNewMetadataUrl.findIndex((x) => x === idx) + 1;\r\n            outItem.newMetadataUrl = `${item.newMetadataUrl} (${nPosition})`; // source: ${item.address.split('.')[0]}\r\n          }\r\n\r\n          const exist = acc.find(\r\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\r\n          );\r\n          if (!exist) {\r\n            acc[acc.length] = outItem;\r\n          }\r\n        } else if (item.type === CatalogItemType.Group) {\r\n          outItem.items = recursiveGroupByLayerAddress(\r\n            item.items,\r\n            (layer) => layer.title\r\n          );\r\n          acc[acc.length] = outItem;\r\n        }\r\n\r\n        return acc;\r\n      }, []);\r\n\r\n    const request4$ = request3$.pipe(\r\n      map((output) => groupByGroupId(output, (group) => group.id)),\r\n      map((output) => [].concat(...output)),\r\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\r\n    );\r\n\r\n    return request4$;\r\n  }\r\n\r\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\r\n    const sType: string = TypeCatalog[catalog.type as string];\r\n    return this.capabilitiesService\r\n      .getCapabilities(sType as any, catalog.url, catalog.version)\r\n      .pipe(\r\n        catchError((e) => {\r\n          this.messageService.error(\r\n            catalog.title\r\n              ? 'igo.geo.catalog.unavailable'\r\n              : 'igo.geo.catalog.someUnavailable',\r\n            'igo.geo.catalog.unavailableTitle',\r\n            undefined,\r\n            catalog.title ? { value: catalog.title } : undefined\r\n          );\r\n          console.error(e);\r\n          return of(undefined);\r\n        })\r\n      );\r\n  }\r\n\r\n  private computeForcedProperties(\r\n    layerNameFromCatalog: string,\r\n    forcedProperties: ForcedProperty[]\r\n  ): ForcedProperty {\r\n    if (!forcedProperties || forcedProperties.length === 0) {\r\n      return;\r\n    }\r\n    const returnProperty: ForcedProperty = {\r\n      layerName: layerNameFromCatalog,\r\n      title: undefined,\r\n      metadataUrl: undefined,\r\n      metadataAbstract: undefined,\r\n      metadataAbstractAll: undefined,\r\n      metadataUrlAll: undefined\r\n    };\r\n    //process wildcard before\r\n    // if there is a * wildcard\r\n    const forcedPropertiesForAllLayers = forcedProperties.find(\r\n      (f) => f.layerName === '*'\r\n    );\r\n    if (forcedPropertiesForAllLayers) {\r\n      // metadataAbstractAll\r\n      if (forcedPropertiesForAllLayers.metadataAbstractAll) {\r\n        returnProperty.metadataAbstractAll =\r\n          forcedPropertiesForAllLayers.metadataAbstractAll;\r\n      }\r\n      // metadataUrlAll\r\n      if (forcedPropertiesForAllLayers.metadataUrlAll) {\r\n        returnProperty.metadataUrlAll =\r\n          forcedPropertiesForAllLayers.metadataUrlAll;\r\n      }\r\n    }\r\n    forcedProperties.map((forcedProperty) => {\r\n      // if match found\r\n      if (layerNameFromCatalog === forcedProperty.layerName) {\r\n        // title\r\n        if (forcedProperty.title) {\r\n          returnProperty.title = forcedProperty.title;\r\n        }\r\n        // metadataUrl\r\n        if (forcedProperty.metadataUrl) {\r\n          returnProperty.metadataUrl = forcedProperty.metadataUrl;\r\n        }\r\n        // metadataAbstract\r\n        if (forcedProperty.metadataAbstract) {\r\n          returnProperty.metadataAbstract = forcedProperty.metadataAbstract;\r\n        }\r\n      }\r\n    });\r\n    return returnProperty;\r\n  }\r\n\r\n  /// WMS\r\n\r\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\r\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\r\n      layer.Name,\r\n      layersQueryFormat\r\n    );\r\n\r\n    const legendOptions =\r\n      catalog.showLegend && layer.Style\r\n        ? this.capabilitiesService.getStyle(layer.Style)\r\n        : undefined;\r\n\r\n    const params = Object.assign({}, catalog.queryParams, {\r\n      LAYERS: layer.Name,\r\n      VERSION: catalog.version\r\n    } as WMSDataSourceOptionsParams);\r\n\r\n    const baseSourceOptions = {\r\n      type: 'wms',\r\n      url: catalog.url,\r\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\r\n      queryFormat: configuredQueryFormat,\r\n      queryHtmlTarget:\r\n        configuredQueryFormat === QueryFormat.HTML ||\r\n        configuredQueryFormat === QueryFormat.HTMLGML2\r\n          ? 'iframe'\r\n          : undefined,\r\n      optionsFromCapabilities: true\r\n    };\r\n\r\n    const sourceOptions = Object.assign(\r\n      {},\r\n      baseSourceOptions,\r\n      catalog.sourceOptions,\r\n      { params }\r\n    ) as WMSDataSourceOptions;\r\n\r\n    const propertiesToForce = this.computeForcedProperties(\r\n      layer.Name,\r\n      catalog.forcedProperties\r\n    );\r\n    let baseAbstract;\r\n    let extern = true;\r\n    if (layer.Abstract) {\r\n      baseAbstract = layer.Abstract;\r\n    } else if (!layer.Abstract && catalog.abstract) {\r\n      baseAbstract = catalog.abstract;\r\n    }\r\n    const layerOnlineResource =\r\n      layer?.DataURL && layer?.DataURL.length > 0\r\n        ? layer?.DataURL[0].OnlineResource\r\n        : undefined;\r\n\r\n    let metadataUrl =\r\n      propertiesToForce?.metadataUrl ||\r\n      propertiesToForce?.metadataUrlAll ||\r\n      layerOnlineResource;\r\n    let metadataAbstract =\r\n      propertiesToForce?.metadataAbstract ||\r\n      propertiesToForce?.metadataAbstractAll ||\r\n      baseAbstract;\r\n\r\n    if (\r\n      !propertiesToForce?.metadataUrl &&\r\n      !propertiesToForce?.metadataUrlAll &&\r\n      (propertiesToForce?.metadataAbstract ||\r\n        propertiesToForce?.metadataAbstractAll)\r\n    ) {\r\n      extern = false;\r\n    }\r\n    if (\r\n      propertiesToForce?.metadataAbstract &&\r\n      propertiesToForce?.metadataUrlAll\r\n    ) {\r\n      extern = false;\r\n    }\r\n\r\n    const layerPrepare = {\r\n      id: generateIdFromSourceOptions(sourceOptions),\r\n      type: CatalogItemType.Layer,\r\n      title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\r\n      address: idParent,\r\n      externalProvider: catalog.externalProvider || false,\r\n      options: {\r\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\r\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\r\n        metadata: {\r\n          url: metadataUrl,\r\n          extern,\r\n          abstract: metadataAbstract,\r\n          type: baseSourceOptions.type\r\n        },\r\n        legendOptions,\r\n        tooltip: { type: catalog.tooltipType },\r\n        sourceOptions\r\n      }\r\n    } as CatalogItem;\r\n\r\n    return ObjectUtils.removeUndefined(layerPrepare);\r\n  }\r\n\r\n  private prepareCatalogItemGroup(\r\n    itemListIn,\r\n    regexes,\r\n    idGroup,\r\n    layersQueryFormat,\r\n    catalog\r\n  ) {\r\n    const groupPrepare = {\r\n      id: idGroup,\r\n      type: CatalogItemType.Group,\r\n      title: itemListIn.Title,\r\n      address: catalog.id,\r\n      externalProvider: catalog.externalProvider || false,\r\n      sortDirection: catalog.sortDirection, // propagate sortDirection\r\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\r\n        if (layer.Layer !== undefined) {\r\n          // recursive, check next level\r\n          const idGroupItemNextLevel =\r\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\r\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\r\n            layer,\r\n            regexes,\r\n            idGroupItemNextLevel,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n\r\n          items.push(groupItem);\r\n        } else {\r\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\r\n            return items;\r\n          }\r\n\r\n          const layerItem: CatalogItemLayer<ImageLayerOptions> =\r\n            this.prepareCatalogItemLayer(\r\n              layer,\r\n              idGroup,\r\n              layersQueryFormat,\r\n              catalog\r\n            );\r\n\r\n          items.push(layerItem);\r\n        }\r\n        return items;\r\n      }, [])\r\n    };\r\n    return groupPrepare;\r\n  }\r\n\r\n  private includeRecursiveItems(\r\n    catalog: Catalog,\r\n    itemListIn: any,\r\n    itemsPrepare: CatalogItem[],\r\n    loopLevel: number = 0\r\n  ) {\r\n    // Dig all levels until last level (layer object are not defined on last level)\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n    if (!itemListIn.Layer) {\r\n      return;\r\n    }\r\n\r\n    for (const item of itemListIn.Layer) {\r\n      if (item.Layer !== undefined) {\r\n        // recursive, check next level\r\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\r\n        continue;\r\n      }\r\n\r\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\r\n\r\n      // group(with layers) and layer(without group) level 1\r\n      if (loopLevel !== 0) {\r\n        // TODO: Slice that into multiple methods\r\n        // Define object of group layer\r\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\r\n        const groupItem = this.prepareCatalogItemGroup(\r\n          itemListIn,\r\n          regexes,\r\n          idGroupItem,\r\n          layersQueryFormat,\r\n          catalog\r\n        );\r\n\r\n        if (groupItem.items.length !== 0) {\r\n          itemsPrepare.push(groupItem);\r\n        }\r\n\r\n        // Break the group (don't add a group of layer for each of their layer!)\r\n        break;\r\n      } else {\r\n        // layer without group\r\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\r\n          const layerItem = this.prepareCatalogItemLayer(\r\n            item,\r\n            catalog.id,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n          itemsPrepare.push(layerItem);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /// WMTS\r\n\r\n  private getWMTSItems(\r\n    catalog,\r\n    capabilities: { [key: string]: any }\r\n  ): CatalogItemLayer[] {\r\n    if (!capabilities) {\r\n      return [];\r\n    }\r\n    const layers = capabilities.Contents.Layer;\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n\r\n    if (\r\n      capabilities.ServiceIdentification &&\r\n      capabilities.ServiceIdentification.Abstract &&\r\n      capabilities.ServiceIdentification.Abstract.length\r\n    ) {\r\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\r\n    }\r\n\r\n    return layers\r\n      .map((layer: any) => {\r\n        const propertiesToForce = this.computeForcedProperties(\r\n          layer.Title,\r\n          catalog.forcedProperties\r\n        );\r\n        let extern = true;\r\n\r\n        let metadataUrl =\r\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\r\n        let metadataAbstract =\r\n          propertiesToForce?.metadataAbstract ||\r\n          propertiesToForce?.metadataAbstractAll ||\r\n          catalog.abstract;\r\n\r\n        if (\r\n          !propertiesToForce?.metadataUrl &&\r\n          !propertiesToForce?.metadataUrlAll &&\r\n          (propertiesToForce?.metadataAbstract ||\r\n            propertiesToForce?.metadataAbstractAll)\r\n        ) {\r\n          extern = false;\r\n        }\r\n        if (\r\n          propertiesToForce?.metadataAbstract &&\r\n          propertiesToForce?.metadataUrlAll\r\n        ) {\r\n          extern = false;\r\n        }\r\n\r\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\r\n          return undefined;\r\n        }\r\n        const params = Object.assign({}, catalog.queryParams, {\r\n          version: '1.0.0'\r\n        });\r\n        const baseSourceOptions = {\r\n          type: 'wmts',\r\n          url: catalog.url,\r\n          crossOrigin: catalog.setCrossOriginAnonymous\r\n            ? 'anonymous'\r\n            : undefined,\r\n          layer: layer.Identifier,\r\n          matrixSet: catalog.matrixSet,\r\n          optionsFromCapabilities: true,\r\n          requestEncoding: catalog.requestEncoding || 'KVP',\r\n          style: 'default'\r\n        } as WMTSDataSourceOptions;\r\n        const sourceOptions = Object.assign(\r\n          {},\r\n          baseSourceOptions,\r\n          catalog.sourceOptions,\r\n          { params }\r\n        ) as WMTSDataSourceOptions;\r\n\r\n        return ObjectUtils.removeUndefined({\r\n          id: generateIdFromSourceOptions(sourceOptions),\r\n          type: CatalogItemType.Layer,\r\n          title: propertiesToForce?.title\r\n            ? propertiesToForce.title\r\n            : layer.Title,\r\n          address: catalog.id,\r\n          externalProvider: catalog.externalProvider,\r\n          options: {\r\n            sourceOptions,\r\n            metadata: {\r\n              url: metadataUrl,\r\n              extern,\r\n              abstract: metadataAbstract,\r\n              type: baseSourceOptions.type\r\n            }\r\n          }\r\n        } as CatalogItem);\r\n      })\r\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\r\n  }\r\n\r\n  /// ERSI\r\n\r\n  private getArcGISRESTItems(catalog, capabilities): CatalogItemLayer[] {\r\n    if (!capabilities) {\r\n      return [];\r\n    }\r\n    const layers = !capabilities.layers\r\n      ? []\r\n      : capabilities.layers.filter(\r\n          (layer) => !layer.type || layer.type === 'Feature Layer'\r\n        );\r\n    if (!capabilities.layers) {\r\n      this.messageService.error(\r\n        'igo.geo.catalog.someUnavailable',\r\n        'igo.geo.catalog.unavailableTitle'\r\n      );\r\n    }\r\n\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n\r\n    let abstract;\r\n    if (\r\n      capabilities.serviceDescription &&\r\n      capabilities.serviceDescription.length\r\n    ) {\r\n      const regex = /(<([^>]+)>)/gi;\r\n      abstract = capabilities.serviceDescription.replace(regex, '');\r\n    }\r\n\r\n    return layers\r\n      .map((layer: any) => {\r\n        const propertiesToForce = this.computeForcedProperties(\r\n          layer.name,\r\n          catalog.forcedProperties\r\n        );\r\n        let baseAbstract;\r\n        let extern = true;\r\n        if (layer.Abstract) {\r\n          baseAbstract = layer.Abstract;\r\n        } else if (!layer.Abstract && catalog.abstract) {\r\n          baseAbstract = catalog.abstract;\r\n        }\r\n\r\n        let metadataUrl =\r\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\r\n        let metadataAbstract =\r\n          propertiesToForce?.metadataAbstract ||\r\n          propertiesToForce?.metadataAbstractAll ||\r\n          baseAbstract;\r\n\r\n        if (\r\n          !propertiesToForce?.metadataUrl &&\r\n          !propertiesToForce?.metadataUrlAll &&\r\n          (propertiesToForce?.metadataAbstract ||\r\n            propertiesToForce?.metadataAbstractAll)\r\n        ) {\r\n          extern = false;\r\n        }\r\n        if (\r\n          propertiesToForce?.metadataAbstract &&\r\n          propertiesToForce?.metadataUrlAll\r\n        ) {\r\n          extern = false;\r\n        }\r\n\r\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\r\n          return undefined;\r\n        }\r\n        const baseSourceOptions = {\r\n          type: TypeCatalog[catalog.type],\r\n          url: catalog.url,\r\n          crossOrigin: catalog.setCrossOriginAnonymous\r\n            ? 'anonymous'\r\n            : undefined,\r\n          layer: layer.id as string,\r\n          queryable: true,\r\n          queryFormat: 'esrijson',\r\n          matrixSet: catalog.matrixSet,\r\n          optionsFromCapabilities: true,\r\n          style: 'default'\r\n        } as ArcGISRestDataSourceOptions;\r\n        const sourceOptions = Object.assign(\r\n          {},\r\n          baseSourceOptions,\r\n          catalog.sourceOptions\r\n        ) as ArcGISRestDataSourceOptions;\r\n        return ObjectUtils.removeUndefined({\r\n          id: generateIdFromSourceOptions(sourceOptions),\r\n          type: CatalogItemType.Layer,\r\n          title: propertiesToForce?.title\r\n            ? propertiesToForce.title\r\n            : layer.name,\r\n          externalProvider: catalog.externalProvider,\r\n          address: catalog.id,\r\n          options: {\r\n            sourceOptions,\r\n            minResolution: getResolutionFromScale(layer.maxScale),\r\n            maxResolution: getResolutionFromScale(layer.minScale),\r\n            metadata: {\r\n              url: metadataUrl,\r\n              extern,\r\n              abstract: metadataAbstract,\r\n              type: baseSourceOptions.type\r\n            }\r\n          }\r\n        } as CatalogItem);\r\n      })\r\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\r\n  }\r\n\r\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\r\n    if (regexes.length === 0) {\r\n      return true;\r\n    }\r\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\r\n  }\r\n\r\n  private retrieveLayerInfoFormat(\r\n    layerNameFromCatalog: string,\r\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\r\n  ): QueryFormat {\r\n    const currentLayerInfoFormat = layersQueryFormat.find(\r\n      (f) => f.layer === layerNameFromCatalog\r\n    );\r\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\r\n    let queryFormat: QueryFormat;\r\n    if (currentLayerInfoFormat) {\r\n      queryFormat = currentLayerInfoFormat.queryFormat;\r\n    } else if (baseInfoFormat) {\r\n      queryFormat = baseInfoFormat.queryFormat;\r\n    }\r\n    return queryFormat;\r\n  }\r\n\r\n  private findCatalogInfoFormat(\r\n    catalog: Catalog\r\n  ): { layer: string; queryFormat: QueryFormat }[] {\r\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\r\n    if (!catalog.queryFormat) {\r\n      return layersQueryFormat;\r\n    }\r\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\r\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\r\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\r\n          if (\r\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\r\n          ) {\r\n            layersQueryFormat.push({\r\n              layer: layerName,\r\n              queryFormat: configuredInfoFormat as QueryFormat\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        if (\r\n          !layersQueryFormat.find(\r\n            (specific) =>\r\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\r\n          )\r\n        ) {\r\n          layersQueryFormat.push({\r\n            layer: catalog.queryFormat[configuredInfoFormat],\r\n            queryFormat: configuredInfoFormat as QueryFormat\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return layersQueryFormat;\r\n  }\r\n}\r\n\r\nclass CatalogFactory {\r\n  public static createInstanceCatalog(\r\n    options: Catalog,\r\n    catalogService: CatalogService\r\n  ): Catalog {\r\n    let catalog: Catalog;\r\n    if (options.hasOwnProperty('composite')) {\r\n      catalog = new CompositeCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogCompositeLayerItems(catalog)\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\r\n      catalog = new BaselayersCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogBaseLayerItems(catalog)\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\r\n      catalog = new ArcGISRestCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogArcGISRestItems(catalog)\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\r\n      catalog = new TileOrImageArcGISRestCatalog(\r\n        options,\r\n        (catalog: Catalog) =>\r\n          catalogService.loadCatalogArcGISRestItems(catalog),\r\n        TypeCatalog.tilearcgisrest\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\r\n      catalog = new TileOrImageArcGISRestCatalog(\r\n        options,\r\n        (catalog: Catalog) =>\r\n          catalogService.loadCatalogArcGISRestItems(catalog),\r\n        TypeCatalog.imagearcgisrest\r\n      );\r\n    } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\r\n      catalog = new WMTSCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogWMTSLayerItems(catalog)\r\n      );\r\n    } else {\r\n      catalog = new WMSCatalog(options, (catalog: Catalog) =>\r\n        catalogService.loadCatalogWMSLayerItems(catalog)\r\n      );\r\n    }\r\n\r\n    return catalog;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\n  *ngIf=\"\n    (options && options.metadata && options.metadata.url) ||\n    (options && options.metadata && options.metadata.abstract)\n  \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\"\n>\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Inject,\r\n  Input,\r\n  ViewEncapsulation\r\n} from '@angular/core';\r\nimport { MAT_DIALOG_DATA, MatDialog } from '@angular/material/dialog';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport {\r\n  MetadataLayerOptions,\r\n  MetadataOptions\r\n} from '../shared/metadata.interface';\r\nimport { MetadataService } from '../shared/metadata.service';\r\n\r\n@Component({\r\n  selector: 'igo-metadata-button',\r\n  templateUrl: './metadata-button.component.html',\r\n  styleUrls: ['./metadata-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MetadataButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor(\r\n    private metadataService: MetadataService,\r\n    private dialog: MatDialog\r\n  ) {}\r\n\r\n  openMetadata(metadata: MetadataOptions) {\r\n    if (metadata.extern) {\r\n      if (!metadata.url && metadata.abstract) {\r\n        this.dialog.open(MetadataAbstractComponent, {\r\n          data: {\r\n            layerTitle: this.layer.title,\r\n            abstract: metadata.abstract,\r\n            type: metadata.type\r\n          }\r\n        });\r\n      } else if (metadata.url) {\r\n        this.metadataService.open(metadata);\r\n      }\r\n    } else if (!metadata.extern && metadata.abstract) {\r\n      this.dialog.open(MetadataAbstractComponent, {\r\n        data: {\r\n          layerTitle: this.layer.title,\r\n          abstract: metadata.abstract,\r\n          type: metadata.type\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  get options(): MetadataLayerOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.options;\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'igo-metadata-abstract',\r\n  templateUrl: './metadata-abstract.component.html',\r\n  styleUrls: ['./metadata-abstract.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class MetadataAbstractComponent {\r\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\r\n}\r\n","<mat-list-item>\r\n  <mat-icon\r\n    *ngIf=\"haveGroup()\"\r\n    class=\"catalog-browser-layer-carret\"\r\n    matListItemIcon\r\n    svgIcon=\"blank\"\r\n  ></mat-icon>\r\n  <span\r\n    matListItemTitle\r\n    matTooltipShowDelay=\"500\"\r\n    [ngClass]=\"catalogAllowLegend ? 'igo-cataloglayer-title' : ''\"\r\n    (click)=\"askForLegend($event)\"\r\n    [matTooltip]=\"computeTitleTooltip()\"\r\n  >\r\n    {{ title }}\r\n  </span>\r\n\r\n  <div matListItemMeta>\r\n    <button *ngIf=\"layer.externalProvider\" disabled=\"true\" mat-icon-button>\r\n      <mat-icon\r\n        class=\"igo-cataloglayer-external-icon\"\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\r\n        color=\"primary\"\r\n        (click)=\"$event.stopPropagation()\"\r\n        svgIcon=\"earth-arrow-right\"\r\n      >\r\n      </mat-icon>\r\n    </button>\r\n    <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\r\n\r\n    <button\r\n      (mouseenter)=\"onMouseEvent($event)\"\r\n      (mouseleave)=\"onMouseEvent($event)\"\r\n      mat-icon-button\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"computeTooltip() | translate\"\r\n      [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\r\n      (click)=\"onToggleClick($event)\"\r\n    >\r\n      <mat-icon\r\n        aria-hidden=\"false\"\r\n        matBadge=\"icon\"\r\n        [igoMatBadgeIcon]=\"getBadgeIcon()\"\r\n        igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\r\n        igoMatBadgeBackgroundColor=\"none\"\r\n        igoMatBadgeInverseColor=\"true\"\r\n        [matBadgeHidden]=\"\r\n          ((inRange$ | async) && (isVisible$ | async) === true) ||\r\n          ((inRange$ | async) && !added) ||\r\n          ((inRange$ | async) && (isPreview$ | async))\r\n        \"\r\n        [matBadgeDisabled]=\"(inRange$ | async) === false\"\r\n        matBadgeSize=\"small\"\r\n        matBadgePosition=\"after\"\r\n        [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\"\r\n      >\r\n      </mat-icon>\r\n    </button>\r\n  </div>\r\n</mat-list-item>\r\n\r\n<div #legend class=\"igo-cataloglayer-legend-container\">\r\n  <igo-layer-legend\r\n    *ngIf=\"\r\n      (layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\r\n    \"\r\n    [layer]=\"igoLayer$ | async\"\r\n  >\r\n  </igo-layer-legend>\r\n</div>\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { getEntityIcon, getEntityTitle } from '@igo2/common';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { first } from 'rxjs/operators';\r\n\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { Layer, TooltipType } from '../../layer/shared/layers';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { AddedChangeEmitter, CatalogItemLayer } from '../shared';\r\n\r\n/**\r\n * Catalog browser layer item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser-layer',\r\n  templateUrl: './catalog-browser-layer.component.html',\r\n  styleUrls: ['./catalog-browser-layer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\r\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private isPreview$$: Subscription;\r\n  private resolution$$: Subscription;\r\n  private layers$$: Subscription;\r\n  private lastTimeoutRequest;\r\n\r\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\r\n\r\n  private mouseInsideAdd: boolean = false;\r\n\r\n  @Input() resolution: number;\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Catalog layer\r\n   */\r\n  @Input() layer: CatalogItemLayer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Whether the layer is already added to the map\r\n   */\r\n  @Input() added = false;\r\n\r\n  /**\r\n   * Event emitted when the add/remove button is clicked\r\n   */\r\n  @Output() addedChange = new EventEmitter<AddedChangeEmitter>();\r\n\r\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.layer);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.layer) || 'layers';\r\n  }\r\n\r\n  constructor(private layerService: LayerService) {}\r\n\r\n  ngOnInit(): void {\r\n    this.isPreview$$ = this.isPreview$.subscribe((value) =>\r\n      this.addedLayerIsPreview.emit(value)\r\n    );\r\n\r\n    this.layers$$ = this.map.layers$.subscribe(() => {\r\n      this.isVisible();\r\n    });\r\n\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\r\n      (resolution) => {\r\n        this.isInResolutionsRange(resolution);\r\n        this.isVisible();\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.isPreview$$.unsubscribe();\r\n    this.resolution$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  computeTitleTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return getEntityTitle(this.layer);\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    this.onToggleClick(event);\r\n  }\r\n\r\n  askForLegend(event) {\r\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\r\n    this.layerService\r\n      .createAsyncLayer(this.layer.options)\r\n      .pipe(first())\r\n      .subscribe((layer) => this.igoLayer$.next(layer));\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(event) {\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'click':\r\n        if (!this.isPreview$.value) {\r\n          if (this.added) {\r\n            this.remove(event);\r\n          } else {\r\n            this.add(event);\r\n          }\r\n        }\r\n        this.isPreview$.next(false);\r\n        break;\r\n      case 'mouseenter':\r\n        if (!this.isPreview$.value && !this.added) {\r\n          this.lastTimeoutRequest = setTimeout(() => {\r\n            this.add(event);\r\n            this.isPreview$.next(true);\r\n          }, 500);\r\n        }\r\n        this.mouseInsideAdd = true;\r\n        break;\r\n      case 'mouseleave':\r\n        if (this.isPreview$.value) {\r\n          this.remove(event);\r\n          this.isPreview$.next(false);\r\n        }\r\n        this.mouseInsideAdd = false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private add(event: Event) {\r\n    if (!this.added) {\r\n      this.added = true;\r\n      this.addedChange.emit({ added: true, layer: this.layer, event });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = false\r\n   */\r\n  private remove(event: Event) {\r\n    if (this.added) {\r\n      this.added = false;\r\n      this.addedChange.emit({ added: false, layer: this.layer, event });\r\n    }\r\n  }\r\n\r\n  haveGroup(): boolean {\r\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\r\n  }\r\n\r\n  isInResolutionsRange(resolution: number) {\r\n    const minResolution =\r\n      !this.layer.options.minResolution ||\r\n      Number.isNaN(this.layer.options.minResolution)\r\n        ? 0\r\n        : this.layer.options.minResolution;\r\n    const maxResolution =\r\n      !this.layer.options.maxResolution ||\r\n      Number.isNaN(this.layer.options.maxResolution)\r\n        ? Infinity\r\n        : this.layer.options.maxResolution;\r\n    this.inRange$.next(\r\n      resolution >= minResolution && resolution <= maxResolution\r\n    );\r\n  }\r\n\r\n  isVisible() {\r\n    if (this.layer?.id) {\r\n      const oLayer = this.map.getLayerById(this.layer?.id);\r\n      oLayer\r\n        ? this.isVisible$.next(oLayer.visible)\r\n        : this.isVisible$.next(false);\r\n    }\r\n  }\r\n\r\n  getBadgeIcon() {\r\n    if (this.inRange$.getValue()) {\r\n      return this.isVisible$.getValue() ? '' : 'eye-off';\r\n    } else {\r\n      return 'eye-off';\r\n    }\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    if (this.added) {\r\n      if (this.isPreview$.value) {\r\n        return 'igo.geo.catalog.layer.addToMap';\r\n      } else if (this.inRange$.value) {\r\n        return this.isVisible$.value\r\n          ? 'igo.geo.catalog.layer.removeFromMap'\r\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\r\n      } else {\r\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\r\n      }\r\n    } else {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : 'igo.geo.catalog.layer.addToMapOutRange';\r\n    }\r\n  }\r\n}\r\n","<mat-list-item>\r\n  <mat-icon\r\n    matListItemIcon\r\n    svgIcon=\"chevron-up\"\r\n    igoCollapse\r\n    class=\"igo-chevron catalog-browser-group-carret\"\r\n    [target]=\"items\"\r\n    [collapsed]=\"collapsed\"\r\n    (toggle)=\"onToggleCollapsed($event)\"\r\n  >\r\n  </mat-icon>\r\n\r\n  <span\r\n    class=\"igo-catalog-group-title\"\r\n    matListItemTitle\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"title\"\r\n    (click)=\"onTitleClick()\"\r\n    >{{ title }}</span\r\n  >\r\n\r\n  <div matListItemMeta>\r\n    <button *ngIf=\"group.externalProvider\" disabled=\"true\" mat-icon-button>\r\n      <mat-icon\r\n        class=\"igo-cataloggroup-external-icon\"\r\n        *ngIf=\"group.externalProvider\"\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\r\n        color=\"primary\"\r\n        (click)=\"$event.stopPropagation()\"\r\n        svgIcon=\"earth-arrow-right\"\r\n      >\r\n      </mat-icon>\r\n    </button>\r\n\r\n    <ng-container\r\n      *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\"\r\n    >\r\n      <button\r\n        mat-icon-button\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\r\n        color=\"warn\"\r\n        [disabled]=\"disabled$ | async\"\r\n        (click)=\"onToggleClick($event)\"\r\n      >\r\n        <mat-icon svgIcon=\"delete\"></mat-icon>\r\n      </button>\r\n    </ng-container>\r\n\r\n    <ng-template #notadded>\r\n      <button\r\n        mat-icon-button\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\r\n        [disabled]=\"disabled$ | async\"\r\n        (click)=\"onToggleClick($event)\"\r\n      >\r\n        <mat-icon svgIcon=\"plus\"></mat-icon>\r\n      </button>\r\n    </ng-template>\r\n  </div>\r\n</mat-list-item>\r\n\r\n<div #items>\r\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\r\n    <ng-container *ngIf=\"isGroup(item)\">\r\n      <!-- todo: add display ans manage CatalogItemGroup -->\r\n    </ng-container>\r\n    <ng-container *ngIf=\"isLayer(item)\">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]=\"item\"\r\n        [resolution]=\"resolution\"\r\n        [map]=\"map\"\r\n        [catalogAllowLegend]=\"catalogAllowLegend\"\r\n        [added]=\"state.get(item).added\"\r\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\r\n        (addedChange)=\"onLayerAddedChange($event)\"\r\n      >\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</div>\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport type { EntityStateManager } from '@igo2/common';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { IgoMap } from '../../map/shared';\r\nimport {\r\n  AddedChangeEmitter,\r\n  AddedChangeGroupEmitter,\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogItemGroup,\r\n  CatalogItemState,\r\n  CatalogItemType\r\n} from '../shared';\r\n\r\n/**\r\n * Catalog browser group item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser-group',\r\n  templateUrl: './catalog-browser-group.component.html',\r\n  styleUrls: ['./catalog-browser-group.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Group's items store\r\n   * @internal\r\n   */\r\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\r\n\r\n  /**\r\n   * Whether all the layers of the group are added\r\n   * @internal\r\n   */\r\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  /**\r\n   * Whether the toggle button is disabled\r\n   * @internal\r\n   */\r\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Catalog group\r\n   */\r\n  @Input() group: CatalogItemGroup;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Whether the group is collapsed\r\n   */\r\n  @Input() collapsed: boolean = true;\r\n\r\n  @Input() resolution: number;\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Whether the group can be toggled when it's collapsed\r\n   */\r\n  @Input() toggleCollapsed: boolean = true;\r\n\r\n  /**\r\n   * Parent catalog's items store state. Groups share a unique\r\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\r\n   * Sharing a unique state would also allow us to expand this component to allow\r\n   * the selection of a layer while unselecting any layer already selected in another group.\r\n   * This could be useful to display some layer info before adding it, for example.\r\n   */\r\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\r\n\r\n  /**\r\n   * Event emitted when the add/remove button of the group is clicked\r\n   */\r\n  @Output() addedChange = new EventEmitter<AddedChangeGroupEmitter>();\r\n\r\n  /**\r\n   * Event emitted when the add/remove button of a layer is clicked\r\n   */\r\n  @Output() layerAddedChange = new EventEmitter<AddedChangeEmitter>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return this.group.title;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.store.load(this.group.items);\r\n    this.evaluateAdded();\r\n    this.evaluateDisabled(this.collapsed);\r\n    if (this.group.sortDirection !== undefined) {\r\n      this.store.view.sort({\r\n        direction: this.group.sortDirection,\r\n        valueAccessor: (item: CatalogItem) => item.title\r\n      });\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isGroup(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Group;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isLayer(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Layer;\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(event: Event) {\r\n    this.added$.value ? this.remove(event) : this.add(event);\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleCollapsed(collapsed: boolean) {\r\n    this.evaluateDisabled(collapsed);\r\n  }\r\n\r\n  /**\r\n   * When a layer is added or removed, evaluate if all the layers of the group\r\n   * are now added or removed. If so, consider that the group itself is added\r\n   * or removed.\r\n   * @internal\r\n   * @param event Layer added change event\r\n   */\r\n  onLayerAddedChange(event: AddedChangeEmitter) {\r\n    this.layerAddedChange.emit(event);\r\n    this.tryToggleGroup(event);\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private add(event: Event) {\r\n    this.added$.next(true);\r\n    this.addedChange.emit({\r\n      added: true,\r\n      group: this.group,\r\n      event\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private remove(event: Event) {\r\n    this.added$.next(false);\r\n    this.addedChange.emit({\r\n      added: false,\r\n      group: this.group,\r\n      event\r\n    });\r\n  }\r\n\r\n  onLayerPreview(event) {\r\n    this.preview$.next(event);\r\n  }\r\n\r\n  /**\r\n   * If all the layers of the group added or removed, add or remove the group itself.\r\n   * @param event The last layer added change event to occur\r\n   */\r\n  private tryToggleGroup(event: AddedChangeEmitter) {\r\n    const added = event.added;\r\n    const layer = event.layer;\r\n\r\n    const layersAdded = this.store.view\r\n      .all()\r\n      .filter((item: CatalogItem) => item.id !== layer.id)\r\n      .map((item: CatalogItem) => this.state.get(item).added || false);\r\n\r\n    if (layersAdded.every((value) => value === added)) {\r\n      added ? this.add(event.event) : this.remove(event.event);\r\n    } else if (this.added$.value === true) {\r\n      this.added$.next(false);\r\n    }\r\n  }\r\n\r\n  private evaluateAdded() {\r\n    const added = this.store.all().every((item: CatalogItem) => {\r\n      return (this.state.get(item).added || false) === true;\r\n    });\r\n    this.added$.next(added);\r\n  }\r\n\r\n  private evaluateDisabled(collapsed: boolean) {\r\n    let disabled = false;\r\n    if (this.toggleCollapsed === false) {\r\n      disabled = collapsed;\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n\r\n  onTitleClick() {\r\n    this.collapsed = !this.collapsed;\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [map]=\"map\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"store.count === 1 ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [map]=\"map\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\r\n\r\nimport { BehaviorSubject, zip } from 'rxjs';\r\n\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map/shared';\r\nimport {\r\n  AddedChangeEmitter,\r\n  AddedChangeGroupEmitter,\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogItemGroup,\r\n  CatalogItemLayer,\r\n  CatalogItemState,\r\n  CatalogItemType\r\n} from '../shared';\r\n\r\n/**\r\n * Component to browse a catalog's groups and layers and display them on a map.\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser',\r\n  templateUrl: './catalog-browser.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Catalog items store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<CatalogItem>;\r\n\r\n  // private resolution$$: Subscription;\r\n\r\n  get resolution$(): BehaviorSubject<number> {\r\n    return this.map.viewController.resolution$;\r\n  }\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Store holding the catalog's items\r\n   */\r\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Whether a group can be toggled when it's collapsed\r\n   */\r\n  @Input() toggleCollapsedGroup: boolean = true;\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    const currentItems = this.map.layers.map((layer: Layer) => {\r\n      return {\r\n        id: layer.options.source.id,\r\n        title: layer.title,\r\n        type: CatalogItemType.Layer\r\n      };\r\n    });\r\n    this.store.state.updateMany(currentItems, { added: true }, true);\r\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\r\n      this.store.view.sort({\r\n        direction: this.catalog.sortDirection,\r\n        valueAccessor: (item: CatalogItem) => item.title\r\n      });\r\n    }\r\n\r\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\r\n    this.catalogAllowLegend = catalogShowLegend\r\n      ? catalogShowLegend\r\n      : this.catalogAllowLegend;\r\n\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isGroup(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Group;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isLayer(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Layer;\r\n  }\r\n\r\n  /**\r\n   * When a layer is added or removed, add or remove it from the map\r\n   * @internal\r\n   * @param event Layer added event\r\n   */\r\n  onLayerAddedChange(event: AddedChangeEmitter) {\r\n    const layer = event.layer;\r\n    this.store.state.update(layer, { added: event.added }, false);\r\n    event.added\r\n      ? this.addLayerToMap(layer, event)\r\n      : this.removeLayerFromMap(layer);\r\n  }\r\n\r\n  /**\r\n   * When a froup is added or removed, add or remove it from the map\r\n   * @internal\r\n   * @param event Group added event\r\n   */\r\n  onGroupAddedChange(event: AddedChangeGroupEmitter) {\r\n    const group = event.group;\r\n    this.store.state.update(group, { added: event.added }, false);\r\n    event.added\r\n      ? this.addGroupToMap(group, event)\r\n      : this.removeGroupFromMap(group);\r\n  }\r\n\r\n  /**\r\n   * Add layer to map\r\n   * @param layer Catalog layer\r\n   */\r\n  private addLayerToMap(layer: CatalogItemLayer, event?: AddedChangeEmitter) {\r\n    this.addLayersToMap([layer], event);\r\n  }\r\n\r\n  /**\r\n   * Remove layer from map\r\n   * @param layer Catalog layer\r\n   */\r\n  private removeLayerFromMap(layer: CatalogItemLayer) {\r\n    this.removeLayersFromMap([layer]);\r\n  }\r\n\r\n  /**\r\n   * Add multiple layers to map\r\n   * @param layers Catalog layers\r\n   */\r\n  private addLayersToMap(\r\n    layers: CatalogItemLayer[],\r\n    event: AddedChangeEmitter | AddedChangeGroupEmitter\r\n  ) {\r\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\r\n      if (!layer.options.sourceOptions.optionsFromApi) {\r\n        layer.options.sourceOptions.optionsFromApi = true;\r\n      }\r\n      if (this.catalog.profils?.length) {\r\n        layer.options.security = { profils: this.catalog.profils };\r\n      }\r\n      return this.layerService.createAsyncLayer(layer.options);\r\n    });\r\n    zip(...layers$).subscribe((layers: Layer[]) => {\r\n      if (event.event.type === 'click' && event.added) {\r\n        this.map.layersAddedByClick$.next(layers);\r\n      }\r\n      this.store.state.updateMany(layers, { added: true });\r\n      this.map.addLayers(layers);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove multiple layers from map\r\n   * @param layers Catalog layers\r\n   */\r\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\r\n    layers.forEach((layer: CatalogItemLayer) => {\r\n      this.store.state.update(layer, { added: false });\r\n      if (layer.options.baseLayer === true) {\r\n        const currLayer = this.map.getLayerById(layer.options.id);\r\n        if (currLayer !== undefined) {\r\n          this.map.removeLayer(currLayer);\r\n        }\r\n      } else {\r\n        const currLayer = this.map.getLayerById(layer.id);\r\n        if (currLayer !== undefined) {\r\n          this.map.removeLayer(currLayer);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sort the layers by title. asc or desc.\r\n   * @internal\r\n   */\r\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\r\n    const returnItem = items.sort((a, b) => {\r\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n\r\n      if (titleA < titleB) {\r\n        return -1;\r\n      }\r\n      if (titleA > titleB) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n    switch (direction) {\r\n      case 'asc':\r\n        return returnItem;\r\n      case 'desc':\r\n        return returnItem.reverse();\r\n      default:\r\n        return items;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add all the layers of a group to map\r\n   * @param group Catalog group\r\n   */\r\n  private addGroupToMap(\r\n    group: CatalogItemGroup,\r\n    event: AddedChangeGroupEmitter\r\n  ) {\r\n    let layers = group.items.filter((item: CatalogItem) => {\r\n      const added = this.store.state.get(item).added || false;\r\n      return this.isLayer(item) && added === false;\r\n    });\r\n    if (group.sortDirection !== undefined) {\r\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\r\n    }\r\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[], event);\r\n  }\r\n\r\n  /**\r\n   * Remove all the layers of a group from map\r\n   * @param group Catalog group\r\n   */\r\n  private removeGroupFromMap(group: CatalogItemGroup) {\r\n    const layers = group.items.filter((item: CatalogItem) => {\r\n      const added = this.store.state.get(item).added || false;\r\n      return this.isLayer(item) && added === true;\r\n    });\r\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoListModule,\r\n  IgoMatBadgeIconModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoLayerModule } from '../../layer/layer.module';\r\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\r\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\r\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\r\nimport { CatalogBrowserComponent } from './catalog-browser.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule,\r\n    IgoMetadataModule,\r\n    IgoLayerModule\r\n  ],\r\n  exports: [CatalogBrowserComponent],\r\n  declarations: [\r\n    CatalogBrowserComponent,\r\n    CatalogBrowserGroupComponent,\r\n    CatalogBrowserLayerComponent\r\n  ]\r\n})\r\nexport class IgoCatalogBrowserModule {}\r\n","<mat-list-item>\n  <span matListItemTitle>\n    {{ title }}\n  </span>\n  <div matListItemMeta>\n    <mat-icon\n      *ngIf=\"catalog.externalProvider\"\n      matListItemIcon\n      class=\"igo-external-provider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\"\n    >\n    </mat-icon>\n    <button\n      *ngIf=\"catalog.removable\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n      color=\"warn\"\n      (click)=\"removeCatalogFromLibrary($event)\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"igo-blank\"\n      *ngIf=\"!catalog.removable\"\n      disabled=\"true\"\n      mat-icon-button\n    >\n      <mat-icon svgIcon=\"blank\"></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { getEntityTitle } from '@igo2/common';\r\n\r\nimport { IgoMap } from '../../map/shared';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\n\r\n/**\r\n * Catalog library item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-library-item',\r\n  templateUrl: './catalog-library-item.component.html',\r\n  styleUrls: ['./catalog-library-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibaryItemComponent {\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  @Output() catalogRemove = new EventEmitter();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.catalog);\r\n  }\r\n\r\n  removeCatalogFromLibrary(event) {\r\n    event.stopPropagation();\r\n    this.catalogRemove.emit();\r\n  }\r\n}\r\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.catalog.library.addTitle' | translate }}\n</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          formControlName=\"title\"\n          placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\n          matInput\n          [matAutocomplete]=\"auto2\"\n        />\n        <mat-autocomplete\n          #auto2=\"matAutocomplete\"\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\n        >\n          <mat-option\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\"\n            [value]=\"predefinedCatalog\"\n          >\n            {{ predefinedCatalog.title }}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          formControlName=\"url\"\n          placeholder=\"URL\"\n          matInput\n          [matAutocomplete]=\"auto\"\n        />\n        <mat-autocomplete\n          #auto=\"matAutocomplete\"\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\n        >\n          <mat-option\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\"\n            [value]=\"predefinedCatalog\"\n          >\n            {{ predefinedCatalog.url }}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select formControlName=\"type\" placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\"\n          >\n            <p matListItemTitle>{{ type }}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">\n      {{\n        languageService.translate.instant(\n          'igo.geo.catalog.externalProvider.unavailableWithEmail',\n          { value: addedCatalog.url, email: emailAddress }\n        )\n      }}\n    </p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">\n      {{\n        languageService.translate.instant('igo.geo.catalog.unavailable', {\n          value: addedCatalog.url\n        })\n      }}\n    </p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n      {{ 'igo.geo.catalog.library.cancel' | translate }}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\"\n    >\n      {{ 'igo.geo.catalog.library.add' | translate }}\n    </button>\n  </div>\n</div>\n","import { Component, Inject, OnDestroy, OnInit, Optional } from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { TypeCapabilities } from '../../datasource';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\n\r\n@Component({\r\n  selector: 'igo-add-catalog-dialog',\r\n  templateUrl: './add-catalog-dialog.component.html',\r\n  styleUrls: ['./add-catalog-dialog.component.scss']\r\n})\r\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\r\n  public form: UntypedFormGroup;\r\n  private defaultAddedCatalogType = 'wms';\r\n  private addedCatalogType$$: Subscription;\r\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\r\n  typeCapabilities: string[];\r\n  predefinedCatalogs: Catalog[] = [];\r\n  store: EntityStore<Catalog>;\r\n  error = false;\r\n  addedCatalog: Catalog;\r\n  emailAddress: string;\r\n  private storeViewAll$$: Subscription;\r\n\r\n  constructor(\r\n    private formBuilder: UntypedFormBuilder,\r\n    public languageService: LanguageService,\r\n    private configService: ConfigService,\r\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\r\n    @Optional()\r\n    @Inject(MAT_DIALOG_DATA)\r\n    public data: {\r\n      predefinedCatalogs: Catalog[];\r\n      store: EntityStore<Catalog>;\r\n      error: boolean;\r\n      addedCatalog: Catalog;\r\n    }\r\n  ) {\r\n    this.store = data.store;\r\n    this.predefinedCatalogs = data.predefinedCatalogs;\r\n    this.error = data.error;\r\n    this.addedCatalog = data.addedCatalog;\r\n    this.form = this.formBuilder.group({\r\n      id: ['', []],\r\n      title: ['', []],\r\n      url: ['', [Validators.required]],\r\n      type: [this.defaultAddedCatalogType, [Validators.required]]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.store.state.clear();\r\n    this.typeCapabilities = Object.keys(TypeCapabilities);\r\n\r\n    this.addedCatalogType$$ = this.form\r\n      .get('type')\r\n      .valueChanges.subscribe((value) => {\r\n        if (value === 'wmts') {\r\n          this.form.get('title').setValidators(Validators.required);\r\n        } else {\r\n          this.form.get('title').setValidators([]);\r\n        }\r\n        this.form.get('title').updateValueAndValidity();\r\n      });\r\n\r\n    this.computePredefinedCatalogList();\r\n    this.storeViewAll$$ = this.store.view\r\n      .all$()\r\n      .subscribe(() => this.computePredefinedCatalogList());\r\n\r\n    this.emailAddress = this.configService.getConfig('emailAddress');\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.addedCatalogType$$.unsubscribe();\r\n    this.storeViewAll$$.unsubscribe();\r\n  }\r\n\r\n  changeUrlOrTitle(catalog: Catalog) {\r\n    this.form.patchValue(catalog);\r\n    this.error = false;\r\n    this.computePredefinedCatalogList();\r\n  }\r\n\r\n  computePredefinedCatalogList() {\r\n    this.predefinedCatalogsList$.next(\r\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\r\n    );\r\n  }\r\n\r\n  addCatalog(addedCatalog: Catalog) {\r\n    this.error = false;\r\n    this.dialogRef.close(addedCatalog);\r\n  }\r\n\r\n  cancel() {\r\n    this.error = false;\r\n    this.dialogRef.close();\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\"\n    >\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=\"btnAddCatalog\">\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\"\n  >\n    {{ 'igo.geo.catalog.library.addBtn' | translate }}\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\n  </button>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { MessageService, StorageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { Observable, Subscription } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { CapabilitiesService } from '../../datasource';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { standardizeUrl } from '../../utils/id-generator';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\r\n\r\n/**\r\n * Component to browse a list of available catalogs\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-library',\r\n  templateUrl: './catalog-library.component.html',\r\n  styleUrls: ['./catalog-library.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Store holding the catalogs\r\n   */\r\n  @Input() store: EntityStore<Catalog>;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Determine if the form to add a catalog is allowed\r\n   */\r\n  @Input() addCatalogAllowed: boolean = false;\r\n\r\n  /**\r\n   * Determine if the form to add a catalog is allowed\r\n   */\r\n  @Input() predefinedCatalogs: Catalog[] = [];\r\n\r\n  /**\r\n   * Event emitted a catalog is selected or unselected\r\n   */\r\n  @Output() catalogSelectChange = new EventEmitter<{\r\n    selected: boolean;\r\n    catalog: Catalog;\r\n  }>();\r\n\r\n  submitDisabled = true;\r\n  private addingCatalog$$: Subscription;\r\n\r\n  get addedCatalogs(): Catalog[] {\r\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\r\n  }\r\n  set addedCatalogs(catalogs: Catalog[]) {\r\n    this.storageService.set('addedCatalogs', catalogs);\r\n  }\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    private messageService: MessageService,\r\n    private storageService: StorageService,\r\n    private dialog: MatDialog\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.store.state.clear();\r\n\r\n    this.predefinedCatalogs = this.predefinedCatalogs.map((c) => {\r\n      c.id = Md5.hashStr((c.type || 'wms') + standardizeUrl(c.url)) as string;\r\n      c.title = c.title === '' || !c.title ? c.url : c.title;\r\n      return c;\r\n    });\r\n  }\r\n\r\n  getCatalogs(): Observable<Catalog[]> {\r\n    return this.store.view.all$();\r\n  }\r\n\r\n  /**\r\n   * When a catalog is selected, update it's state in the store\r\n   * and emit the catalog select change event\r\n   * @internal\r\n   */\r\n  onCatalogSelect(catalog: Catalog) {\r\n    this.store.state.update(\r\n      catalog,\r\n      {\r\n        selected: true,\r\n        focused: true\r\n      },\r\n      true\r\n    );\r\n    this.catalogSelectChange.emit({ selected: true, catalog });\r\n  }\r\n\r\n  private unsubscribeAddingCatalog() {\r\n    if (this.addingCatalog$$) {\r\n      this.addingCatalog$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  addCatalog(addedCatalog: Catalog) {\r\n    if (!addedCatalog) {\r\n      return;\r\n    }\r\n    let id = Md5.hashStr(\r\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\r\n    ) as string;\r\n    const predefinedCatalog = this.predefinedCatalogs.find(\r\n      (c) => c.id === addedCatalog.id\r\n    );\r\n\r\n    if (predefinedCatalog) {\r\n      addedCatalog.version = predefinedCatalog.version;\r\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\r\n      id = predefinedCatalog.id;\r\n    }\r\n\r\n    if (this.store.get(id)) {\r\n      this.messageService.alert(\r\n        'igo.geo.catalog.library.inlist.message',\r\n        'igo.geo.catalog.library.inlist.title'\r\n      );\r\n      return;\r\n    }\r\n    this.unsubscribeAddingCatalog();\r\n\r\n    this.addingCatalog$$ = this.capabilitiesService\r\n      .getCapabilities(\r\n        addedCatalog.type as any,\r\n        addedCatalog.url,\r\n        addedCatalog.version\r\n      )\r\n      .pipe(\r\n        catchError((e) => {\r\n          if (e.error) {\r\n            this.addCatalogDialog(true, addedCatalog);\r\n            e.error.caught = true;\r\n            return e;\r\n          }\r\n          this.messageService.error(\r\n            'igo.geo.catalog.unavailable',\r\n            'igo.geo.catalog.unavailableTitle',\r\n            undefined,\r\n            { value: addedCatalog.url }\r\n          );\r\n          throw e;\r\n        })\r\n      )\r\n      .subscribe((capabilities) => {\r\n        let title;\r\n        let version;\r\n        switch (addedCatalog.type) {\r\n          case 'wms':\r\n            title = addedCatalog.title || capabilities.Service.Title;\r\n            version = addedCatalog.version || capabilities.version;\r\n            break;\r\n          case 'arcgisrest':\r\n          case 'imagearcgisrest':\r\n          case 'tilearcgisrest':\r\n            title = addedCatalog.title || capabilities.mapName;\r\n            break;\r\n          case 'wmts':\r\n            title =\r\n              addedCatalog.title ||\r\n              capabilities.ServiceIdentification.ServiceType;\r\n            break;\r\n          default:\r\n            title = addedCatalog.title;\r\n        }\r\n\r\n        const catalogToAdd = ObjectUtils.removeUndefined(\r\n          Object.assign(\r\n            {},\r\n            predefinedCatalog,\r\n            ObjectUtils.removeUndefined({\r\n              id,\r\n              title,\r\n              url: addedCatalog.url,\r\n              type: addedCatalog.type || 'wms',\r\n              externalProvider: addedCatalog.externalProvider || false,\r\n              removable: true,\r\n              version\r\n            })\r\n          ) as Catalog\r\n        );\r\n        this.store.insert(catalogToAdd);\r\n        const newCatalogs = this.addedCatalogs.slice(0);\r\n        newCatalogs.push(catalogToAdd);\r\n        this.addedCatalogs = newCatalogs;\r\n        this.unsubscribeAddingCatalog();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribeAddingCatalog();\r\n  }\r\n\r\n  onCatalogRemove(catalog) {\r\n    this.store.delete(catalog);\r\n    this.addedCatalogs = this.addedCatalogs\r\n      .slice(0)\r\n      .filter((c) => c.id !== catalog.id);\r\n  }\r\n\r\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\r\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\r\n      width: '700px',\r\n      data: {\r\n        predefinedCatalogs: this.predefinedCatalogs,\r\n        store: this.store,\r\n        error,\r\n        addedCatalog\r\n      }\r\n    });\r\n\r\n    dialogRef.afterClosed().subscribe((catalog) => {\r\n      this.addCatalog(catalog);\r\n    });\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoListModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\r\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\r\nimport { CatalogLibaryComponent } from './catalog-library.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatBadgeModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoListModule,\r\n    IgoLanguageModule,\r\n    MatButtonModule,\r\n    MatFormFieldModule,\r\n    ReactiveFormsModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatAutocompleteModule,\r\n    MatDialogModule\r\n  ],\r\n  exports: [CatalogLibaryComponent, AddCatalogDialogComponent],\r\n  declarations: [\r\n    CatalogLibaryComponent,\r\n    CatalogLibaryItemComponent,\r\n    AddCatalogDialogComponent\r\n  ]\r\n})\r\nexport class IgoCatalogLibraryModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoListModule,\r\n  IgoMatBadgeIconModule\r\n} from '@igo2/common';\r\n\r\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\r\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule\r\n  ],\r\n  exports: [IgoCatalogBrowserModule, IgoCatalogLibraryModule],\r\n  declarations: []\r\n})\r\nexport class IgoCatalogModule {}\r\n","import { Observable } from 'rxjs';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\n\nexport abstract class DirectionsSource {\n  abstract enabled: boolean;\n  abstract getName(): string;\n  abstract route(\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions\n  ): Observable<Direction[]>;\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","import { DragDropModule } from '@angular/cdk/drag-drop';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\r\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\r\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\r\nimport { DirectionsComponent } from './directions.component';\r\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    DragDropModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatListModule,\r\n    MatDividerModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    MatTooltipModule,\r\n    MatAutocompleteModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [\r\n    DirectionsComponent,\r\n    DirectionsInputsComponent,\r\n    DirectionsButtonsComponent,\r\n    DirectionsResultsComponent\r\n  ],\r\n  declarations: [\r\n    DirectionsComponent,\r\n    DirectionsInputsComponent,\r\n    DirectionsButtonsComponent,\r\n    DirectionsResultsComponent\r\n  ],\r\n  providers: [provideDirectionsSourceService()]\r\n})\r\nexport class IgoDirectionsModule {\r\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\r\n    return {\r\n      ngModule: IgoDirectionsModule\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { DownloadButtonComponent } from './download-button/download-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [DownloadButtonComponent],\r\n  declarations: [DownloadButtonComponent]\r\n})\r\nexport class IgoDownloadModule {\r\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\r\n    return {\r\n      ngModule: IgoDownloadModule\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { BrowserModule } from '@angular/platform-browser';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\n\r\nimport { IgoEntityTableModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\r\nimport { DrawPopupComponent } from './draw-popup.component';\r\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\r\nimport { DrawComponent } from './draw.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatDividerModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatBadgeModule,\r\n    MatTooltipModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatListModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    MatDialogModule,\r\n    IgoLanguageModule,\r\n    IgoEntityTableModule,\r\n    BrowserModule,\r\n    BrowserAnimationsModule,\r\n    MatRadioModule,\r\n    MatCheckboxModule\r\n  ],\r\n  declarations: [\r\n    DrawComponent,\r\n    DrawPopupComponent,\r\n    DrawLayerPopupComponent,\r\n    DrawShorcutsComponent\r\n  ],\r\n  exports: [DrawComponent]\r\n})\r\nexport class IgoDrawModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoImageModule, IgoKeyValueModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { FeatureDetailsComponent } from './feature-details.component';\r\nimport { FeatureDetailsDirective } from './feature-details.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    IgoLanguageModule,\r\n    IgoKeyValueModule,\r\n    IgoImageModule\r\n  ],\r\n  exports: [FeatureDetailsComponent, FeatureDetailsDirective],\r\n  declarations: [FeatureDetailsComponent, FeatureDetailsDirective]\r\n})\r\nexport class IgoFeatureDetailsModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoFormModule } from '@igo2/common';\r\n\r\nimport { FeatureFormComponent } from './feature-form.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, IgoFormModule],\r\n  exports: [IgoFormModule, FeatureFormComponent],\r\n  declarations: [FeatureFormComponent]\r\n})\r\nexport class IgoFeatureFormModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\r\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [IgoFeatureDetailsModule, IgoFeatureFormModule],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoFeatureModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\r\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [GeometryFormFieldComponent, GeometryFormFieldInputComponent],\r\n  declarations: [GeometryFormFieldComponent, GeometryFormFieldInputComponent]\r\n})\r\nexport class IgoGeometryFormFieldModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, IgoGeometryFormFieldModule],\r\n  exports: [IgoGeometryFormFieldModule],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoGeometryModule {}\r\n","<button\n  *ngIf=\"\n    header &&\n    options.ogcFilters &&\n    options.ogcFilters.enabled &&\n    (options.ogcFilters.pushButtons ||\n      options.ogcFilters.checkboxes ||\n      options.ogcFilters.radioButtons ||\n      options.ogcFilters.select ||\n      options.ogcFilters.autocomplete ||\n      options.ogcFilters.editable)\n  \"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    [matBadge]=\"badge\"\n    matBadgeColor=\"warn\"\n    matBadgeSize=\"medium\"\n    svgIcon=\"filter\"\n  ></mat-icon>\n</button>\n\n<div\n  #ogcFilter\n  class=\"igo-layer-actions-container\"\n  *ngIf=\"\n    options.ogcFilters &&\n    options.ogcFilters.enabled &&\n    (options.ogcFilters.pushButtons ||\n      options.ogcFilters.checkboxes ||\n      options.ogcFilters.radioButtons ||\n      options.ogcFilters.select ||\n      options.ogcFilters.autocomplete ||\n      options.ogcFilters.editable)\n  \"\n>\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\"\n  >\n  </igo-ogc-filterable-item>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map/shared';\r\nimport {\r\n  IgoOgcSelector,\r\n  OgcFilterableDataSourceOptions\r\n} from '../shared/ogc-filter.interface';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-button',\r\n  templateUrl: './ogc-filter-button.component.html',\r\n  styleUrls: ['./ogc-filter-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterButtonComponent implements OnInit {\r\n  public options: OgcFilterableDataSourceOptions;\r\n\r\n  get badge() {\r\n    const filter = this.options.ogcFilters as any;\r\n    let cnt = 0;\r\n    if (filter && !filter.advancedOgcFilters) {\r\n      if (filter.pushButtons) {\r\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\r\n        const currentPushButtonGroup = pushButtons.groups.find(\r\n          (gr) => gr.enabled\r\n        );\r\n        let cntPushButtons = 0;\r\n        if (currentPushButtonGroup) {\r\n          currentPushButtonGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntPushButtons += (cb.selectors as any)?.filter(\r\n                (button) => button.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntPushButtons;\r\n      }\r\n      if (filter.checkboxes) {\r\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\r\n        const currentCheckboxGroup = checkboxes.groups.find((gr) => gr.enabled);\r\n        let cntCheckboxes = 0;\r\n        if (currentCheckboxGroup) {\r\n          currentCheckboxGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntCheckboxes += (cb.selectors as any)?.filter(\r\n                (checkbox) => checkbox.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntCheckboxes;\r\n      }\r\n      if (filter.radioButtons) {\r\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\r\n        const currentRadioButtonsGroup = radioButtons.groups.find(\r\n          (gr) => gr.enabled\r\n        );\r\n        let cntRadioButtons = 0;\r\n        if (currentRadioButtonsGroup) {\r\n          currentRadioButtonsGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntRadioButtons += (cb.selectors as any)?.filter(\r\n                (radio) => radio.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntRadioButtons;\r\n      }\r\n      if (filter.select) {\r\n        const select = filter.select as IgoOgcSelector;\r\n        const currentSelectGroup = select.groups.find((gr) => gr.enabled);\r\n        let cntSelect = 0;\r\n        if (currentSelectGroup) {\r\n          currentSelectGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntSelect += (cb.selectors as any)?.filter(\r\n                (multi) => multi.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntSelect;\r\n      }\r\n      if (filter.autocomplete) {\r\n        const autocomplete = filter.autocomplete as IgoOgcSelector;\r\n        const currentAutocompleteGroup = autocomplete.groups.find(\r\n          (gr) => gr.enabled\r\n        );\r\n        let cntAutocomplete = 0;\r\n        if (currentAutocompleteGroup) {\r\n          currentAutocompleteGroup.computedSelectors?.map(\r\n            (cb) =>\r\n              (cntAutocomplete += (cb.selectors as any)?.filter(\r\n                (autocomplete) => autocomplete.enabled\r\n              ).length)\r\n          );\r\n        }\r\n        cnt += cntAutocomplete;\r\n      }\r\n    } else if (filter && filter.filters && !filter.filters.filters) {\r\n      return 1;\r\n    } else if (filter && filter.filters && filter.filters.filters) {\r\n      return filter.filters.filters.length;\r\n    }\r\n    if (\r\n      filter.filters &&\r\n      filter.filters.operator === 'During' &&\r\n      filter.filters.active &&\r\n      filter.interfaceOgcFilters &&\r\n      filter.interfaceOgcFilters[0].active\r\n    ) {\r\n      const filterActiveValue = filter.interfaceOgcFilters[0];\r\n      if (filter.filters.calendarModeYear) {\r\n        // year mode check just year\r\n        if (\r\n          filterActiveValue.begin.substring(0, 4) !==\r\n            this.options.minDate.substring(0, 4) ||\r\n          filterActiveValue.end.substring(0, 4) !==\r\n            this.options.maxDate.substring(0, 4)\r\n        ) {\r\n          cnt += 1;\r\n        }\r\n      } else if (\r\n        filterActiveValue.begin !== this.options.minDate ||\r\n        filterActiveValue.end !== this.options.maxDate\r\n      ) {\r\n        cnt += 1;\r\n      }\r\n    }\r\n    return cnt > 0 ? cnt : undefined;\r\n  }\r\n\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    if (value) {\r\n      this.options = this.layer.dataSource\r\n        .options as OgcFilterableDataSourceOptions;\r\n    }\r\n  }\r\n  private _layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  @Input() header: boolean;\r\n\r\n  public ogcFilterCollapse = false;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.options = this.layer.dataSource\r\n      .options as OgcFilterableDataSourceOptions;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport olWKT from 'ol/format/WKT';\r\nimport * as olproj from 'ol/proj';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WktService {\r\n  constructor() {}\r\n\r\n  public wktToFeature(wkt, wktProj, featureProj) {\r\n    return new olWKT().readFeature(wkt, {\r\n      dataProjection: wktProj,\r\n      featureProjection: featureProj\r\n    });\r\n  }\r\n  public extentToWkt(epsgTO, extent, extentProj) {\r\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\r\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\r\n    const wktPoly = `POLYGON((\r\n      ${extent[0]} ${extent[1]},\r\n      ${extent[0]} ${extent[3]},\r\n      ${extent[2]} ${extent[3]},\r\n      ${extent[2]} ${extent[1]},\r\n      ${extent[0]} ${extent[1]}))`;\r\n    const wktLine = `LINESTRING(\r\n      ${extent[0]} ${extent[1]},\r\n      ${extent[0]} ${extent[3]},\r\n      ${extent[2]} ${extent[3]},\r\n      ${extent[2]} ${extent[1]},\r\n      ${extent[0]} ${extent[1]})`;\r\n    const wktMultiPoints = `MULTIPOINT(\r\n        ${extent[0]} ${extent[1]},\r\n        ${extent[0]} ${extent[3]},\r\n        ${extent[2]} ${extent[3]},\r\n        ${extent[2]} ${extent[1]})`;\r\n    return {\r\n      wktPoly,\r\n      wktLine,\r\n      wktMultiPoints\r\n    };\r\n  }\r\n\r\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\r\n    const lproj = olproj.get(projection);\r\n    const units = lproj.getUnits();\r\n    const olUnits = ['ft', 'm', 'us-ft'];\r\n    if (olUnits.indexOf(units) !== -1) {\r\n      coordinateArray = this.roundArray(coordinateArray, decimal);\r\n    }\r\n    return coordinateArray;\r\n  }\r\n\r\n  private roundArray(array, decimal = 0) {\r\n    let x = 0;\r\n    while (x < array.length) {\r\n      array[x] = array[x].toFixed(decimal);\r\n      x++;\r\n    }\r\n    return array;\r\n  }\r\n\r\n  public snrcToWkt(snrc, epsgTO) {\r\n    snrc = snrc.toLowerCase();\r\n    let wktPoly;\r\n    const ew = {\r\n      1: { from: -56, to: -64 },\r\n      2: { from: -64, to: -72 },\r\n      3: { from: -72, to: -80 },\r\n      4: { from: -80, to: -88 },\r\n      5: { from: -88, to: -96 },\r\n      6: { from: -96, to: -104 },\r\n      7: { from: -104, to: -112 },\r\n      8: { from: -112, to: -120 },\r\n      9: { from: -120, to: -128 },\r\n      10: { from: -128, to: -136 }\r\n    };\r\n    const sn = {\r\n      1: { from: 44, to: 48 },\r\n      2: { from: 48, to: 52 },\r\n      3: { from: 52, to: 56 },\r\n      4: { from: 56, to: 60 },\r\n      5: { from: 60, to: 64 },\r\n      6: { from: 64, to: 68 },\r\n      7: { from: 68, to: 72 },\r\n      8: { from: 72, to: 76 },\r\n      9: { from: 76, to: -128 }\r\n    };\r\n    const snrc250kIndex = [\r\n      ['m', 'n', 'o', 'p'],\r\n      ['l', 'k', 'j', 'i'],\r\n      ['e', 'f', 'g', 'h'],\r\n      ['d', 'c', 'b', 'a']\r\n    ];\r\n\r\n    const snrc50kIndex = [\r\n      ['13', '14', '15', '16'],\r\n      ['12', '11', '10', '09'],\r\n      ['05', '06', '07', '08'],\r\n      ['04', '03', '02', '01']\r\n    ];\r\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\r\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\r\n    const checkSNRC1m = /\\d{2,3}/gi;\r\n\r\n    let snrc1m = false;\r\n    let snrc250k = false;\r\n    let snrc50k = false;\r\n\r\n    if (checkSNRC50k.test(snrc)) {\r\n      snrc50k = true;\r\n    } else {\r\n      if (checkSNRC250k.test(snrc)) {\r\n        snrc250k = true;\r\n      } else {\r\n        if (checkSNRC1m.test(snrc)) {\r\n          snrc1m = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (snrc1m) {\r\n      snrc += 'a01';\r\n    } else if (snrc250k) {\r\n      snrc += '01';\r\n    }\r\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\r\n      const regex1m = /(?=[a-p])/gi;\r\n      const ar1m = snrc.split(regex1m);\r\n      const part1m = ar1m[0];\r\n      const part250k = ar1m[1][0];\r\n      const part50k = ar1m[1].split(part250k)[1];\r\n      let separator = 1;\r\n      if (part1m.length === 3) {\r\n        separator = 2;\r\n      }\r\n      const partEW = part1m.substring(0, separator);\r\n      const partSN = part1m.substring(separator);\r\n      const unit1mEW = 8;\r\n      const unit1mSN = 4;\r\n      const unit250kEW = 2;\r\n      const unit250kSN = 1;\r\n      const unit50kEW = 0.5;\r\n      const unit50kSN = 0.25;\r\n      let index250kEW = 0;\r\n      let index250kSN = 0;\r\n      let index50kEW = 0;\r\n      let index50kSN = 0;\r\n      snrc250kIndex.forEach((element) => {\r\n        if (element.indexOf(part250k) !== -1) {\r\n          index250kSN = snrc250kIndex.indexOf(element);\r\n          index250kEW = element.indexOf(part250k);\r\n        }\r\n      });\r\n      snrc50kIndex.forEach((element) => {\r\n        if (element.indexOf(part50k) !== -1) {\r\n          index50kSN = snrc50kIndex.indexOf(element);\r\n          index50kEW = element.indexOf(part50k);\r\n        }\r\n      });\r\n\r\n      let increment250kEW = 0;\r\n      let increment250kSN = 0;\r\n      let increment50kEW = 0;\r\n      let increment50kSN = 0;\r\n      let unitPerTypeEW = unit1mEW;\r\n      let unitPerTypeSN = unit1mSN;\r\n      if (snrc250k) {\r\n        increment250kEW = index250kEW * unit250kEW;\r\n        increment250kSN = index250kSN * unit250kSN;\r\n        increment50kEW = 0;\r\n        increment50kSN = 0;\r\n        unitPerTypeEW = unit250kEW;\r\n        unitPerTypeSN = unit250kSN;\r\n      } else if (snrc50k) {\r\n        increment250kEW = index250kEW * unit250kEW;\r\n        increment250kSN = index250kSN * unit250kSN;\r\n        increment50kEW = index50kEW * unit50kEW;\r\n        increment50kSN = index50kSN * unit50kSN;\r\n        unitPerTypeEW = unit50kEW;\r\n        unitPerTypeSN = unit50kSN;\r\n      }\r\n\r\n      const coord: { ul?: any; lr?: any; ur?: any; ll?: any } = {\r\n        ul: [\r\n          ew[partEW].to + increment250kEW + increment50kEW,\r\n          sn[partSN].to - increment250kSN - increment50kSN\r\n        ]\r\n      };\r\n\r\n      coord.lr = [coord.ul[0] + unitPerTypeEW, coord.ul[1] - unitPerTypeSN];\r\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\r\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\r\n\r\n      coord.ul = olproj.transform(\r\n        [coord.ul[0], coord.ul[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.lr = olproj.transform(\r\n        [coord.lr[0], coord.lr[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.ur = olproj.transform(\r\n        [coord.ur[0], coord.ur[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.ll = olproj.transform(\r\n        [coord.ll[0], coord.ll[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n\r\n      // Rounded coordinate to shorten url in get\r\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\r\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\r\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\r\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\r\n\r\n      wktPoly =\r\n        'POLYGON((' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' '),\r\n          coord.ul.join(' ')\r\n        ].join(',') +\r\n        '))';\r\n      const wktLine =\r\n        'LINESTRING(' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' '),\r\n          coord.ul.join(' ')\r\n        ].join(',') +\r\n        ')';\r\n\r\n      const wktMultiPoints =\r\n        'MULTIPOINT(' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' ')\r\n        ].join(',') +\r\n        ')';\r\n      return {\r\n        wktPoly,\r\n        wktLine,\r\n        wktMultiPoints\r\n      };\r\n    }\r\n  }\r\n}\r\n","<div class=\"ogc-filter-form-container\">\n  <mat-checkbox\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n    (click)=\"$event.stopPropagation()\"\n    (change)=\"toggleFilterState($event)\"\n    [checked]=\"currentFilter.active\"\n  >\n  </mat-checkbox>\n\n  <mat-form-field\n    [ngClass]=\"{\n      logical:\n        activeFilters.indexOf(currentFilter) !== 0 &&\n        currentFilter.active === true,\n      logicalHidden:\n        activeFilters.indexOf(currentFilter) === 0 ||\n        currentFilter.active !== true\n    }\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.parentLogical\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.parentLogical\n          ? ('igo.geo.operators.tooltip.' + currentFilter.parentLogical\n            | translate)\n          : ''\n      \"\n      (selectionChange)=\"changeLogical($event.value)\"\n    >\n      <mat-option\n        [value]=\"ogcFilterOperator.And\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\"\n      >\n        {{ 'igo.geo.operators.And' | translate }}\n      </mat-option>\n      <mat-option\n        [value]=\"ogcFilterOperator.Or\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\"\n      >\n        {{ 'igo.geo.operators.Or' | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"field\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) === false &&\n      (fields$ | async) &&\n      (fields$ | async).length > 0 &&\n      (fields$ | async)[0].name !== ''\n    \"\n    (mouseenter)=\"inputClearable = 'selectField'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteField\"\n      [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        (selectedField$ | async)\n          ? (selectedField$ | async).alias\n          : ('igo.geo.sourceFields.selectField' | translate)\n      \"\n      (input)=\"updateFieldsList($event.target.value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteField=\"matAutocomplete\"\n      (optionSelected)=\"changeField($event.option.id)\"\n    >\n      <mat-option\n        *ngFor=\"let field of filteredFields$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"field.alias\"\n        [id]=\"field.name\"\n        [matTooltip]=\"field.alias\"\n      >\n        {{ field.alias }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        currentFilter.propertyName &&\n        inputClearable === 'selectField' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearSelectedField()\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    [ngClass]=\"{\n      operator: (currentFilterIsSpatial$ | async) === false,\n      dualInput: (currentFilterIsSpatial$ | async)\n    }\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <mat-select\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.operator\n          ? ('igo.geo.operators.tooltip.' + currentFilter.operator | translate)\n          : ('igo.geo.filter.selectOperator' | translate)\n      \"\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.operator\"\n      (selectionChange)=\"changeOperator($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let operator of ogcFilterOperators$ | async | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.' + operator.key | translate\"\n      >\n        {{ 'igo.geo.operators.' + operator.key | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"spatialSelector\"\n    *ngIf=\"currentFilterIsSpatial$ | async\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.igoSpatialSelector\"\n      (selectionChange)=\"changeSpatialSelector($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\"\n      >\n        {{ 'igo.geo.spatialSelector.' + igoSpatialSelector.type | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"singleInput\"\n    *ngIf=\"['expression', 'pattern'].indexOf(detectProperty()) !== -1\"\n    (mouseenter)=\"inputClearable = 'selectProperty'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteValues\"\n      [value]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression\n          : currentFilter.pattern\n      \"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression || ''\n          : currentFilter.pattern || ''\n      \"\n      (input)=\"updateValuesList($event.target.value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteValues=\"matAutocomplete\"\n      (optionSelected)=\"changeProperty($event.option.value)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable() &&\n        inputClearable === 'selectProperty' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty()\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <div class=\"igo-layer-button-group\">\n    <button\n      mat-icon-button\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n      color=\"warn\"\n      (click)=\"deleteFilter()\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n  </div>\n\n  <mat-form-field\n    class=\"snrc\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'snrc'\n    \"\n    (mouseenter)=\"inputClearable = 'selectSNRC'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n      [value]=\"currentFilter.igoSNRC\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n      (input)=\"changeSNRC($event.target.value)\"\n    />\n    <button\n      *ngIf=\"currentFilter.igoSNRC\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"\n        !currentFilter.active &&\n        inputClearable === 'selectSNRC' &&\n        currentFilter.active\n      \"\n      (click)=\"currentFilter.igoSNRC = ''\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <ng-container\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'fixedExtent'\n    \"\n  >\n    <button\n      [disabled]=\"!currentFilter.active\"\n      *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n      matSuffix\n      mat-icon-button\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"changeMapExtentGeometry()\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\"\n    >\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\n    </button>\n  </ng-container>\n</div>\n\n<div class=\"ogc-filter-form-container\">\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['lowerBoundary', 'begin'].indexOf(detectProperty(1)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty1'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(1) === 'lowerBoundary'\n          ? currentFilter.lowerBoundary\n          : currentFilter.begin\n      \"\n      (input)=\"updateValuesList($event.target.value, 1)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 1)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(1) &&\n        inputClearable === 'selectProperty1' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['upperBoundary', 'end'].indexOf(detectProperty(2)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty2'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(2) === 'upperBoundary'\n          ? currentFilter.upperBoundary\n          : currentFilter.end\n      \"\n      (input)=\"updateValuesList($event.target.value, 2)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 2)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(2) &&\n        inputClearable === 'selectProperty2' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n</div>\n\n<igo-ogc-filter-time\n  *ngIf=\"isTemporalOperator()\"\n  [(datasource)]=\"datasource\"\n  [(currentFilter)]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\"\n>\n</igo-ogc-filter-time>\n","import { Component, Input, OnInit } from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material/form-field';\r\n\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\n\r\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\r\nimport {\r\n  OgcFilterableDataSource,\r\n  OgcFiltersOptions\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { WktService } from '../../wkt/shared/wkt.service';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-form',\r\n  templateUrl: './ogc-filter-form.component.html',\r\n  styleUrls: ['./ogc-filter-form.component.scss']\r\n})\r\nexport class OgcFilterFormComponent implements OnInit {\r\n  ogcFilterOperator = OgcFilterOperator;\r\n  filteredValues$: Observable<string[]>;\r\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\r\n  public allOgcFilterOperators;\r\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\r\n    undefined\r\n  );\r\n  public igoSpatialSelectors;\r\n  public value = '';\r\n  public inputOperator;\r\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\r\n    undefined\r\n  );\r\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\r\n  public color = 'primary';\r\n  public disabled;\r\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\r\n  public defaultStepMillisecond = 6000;\r\n  public inputClearable: string;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() currentFilter: any;\r\n\r\n  set snrc(value: any) {\r\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\r\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\r\n    const checkSNRC1m = /^\\d{2}$/gi;\r\n    if (\r\n      checkSNRC1m.test(value) ||\r\n      checkSNRC250k.test(value) ||\r\n      checkSNRC50k.test(value)\r\n    ) {\r\n      this._snrc = value;\r\n      this.currentFilter.igoSNRC = value;\r\n    }\r\n  }\r\n\r\n  get snrc(): any {\r\n    return this._snrc;\r\n  }\r\n\r\n  private _snrc = '';\r\n\r\n  @Input() floatLabel: FloatLabelType;\r\n\r\n  get activeFilters() {\r\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\r\n      (f) => f.active === true\r\n    );\r\n  }\r\n\r\n  get allowedOperators() {\r\n    return new OgcFilterWriter().computeAllowedOperators(\r\n      this.fields$.value,\r\n      this.currentFilter.propertyName,\r\n      this.datasource.options.ogcFilters.allowedOperatorsType\r\n    );\r\n  }\r\n\r\n  constructor(private wktService: WktService) {\r\n    // TODO: Filter permitted operator based on wfscapabilities\r\n    // Need to work on regex on XML capabilities because\r\n    // comaparison operator's name varies between WFS servers...\r\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\r\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\r\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\r\n    this.igoSpatialSelectors = [\r\n      {\r\n        type: 'fixedExtent'\r\n      },\r\n      {\r\n        type: 'snrc'\r\n      }\r\n    ];\r\n    // TODO: selectFeature & drawFeature\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.datasource.options.sourceFields) {\r\n      const sFields = this.datasource.options.sourceFields.filter(\r\n        (sf) =>\r\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\r\n      );\r\n      sFields.map((sfs) => {\r\n        if (sfs.values) {\r\n          sfs.values.sort();\r\n        }\r\n      });\r\n      this.fields$.next(sFields);\r\n    }\r\n\r\n    this.updateFieldsList();\r\n    this.selectedField$.next(\r\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\r\n    );\r\n    this.updateValuesList();\r\n    this.selectedField$.subscribe((f) => {\r\n      this.ogcFilterOperators$.next(this.allowedOperators);\r\n      if (\r\n        Object.keys(this.allowedOperators).indexOf(\r\n          this.currentFilter.operator\r\n        ) === -1\r\n      ) {\r\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\r\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\r\n      }\r\n      this.updateValuesList();\r\n    });\r\n    this.currentFilterIsSpatial();\r\n  }\r\n\r\n  updateFieldsList(value?: string) {\r\n    this.filteredFields$ =\r\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\r\n    if (this.fields$.value.find((f) => f.name === value)) {\r\n      this.changeField(value);\r\n    }\r\n  }\r\n\r\n  updateValuesList(value?: string, pos?: number) {\r\n    this.filteredValues$ =\r\n      value && value.length > 0\r\n        ? of(this._filterValues(value))\r\n        : this.selectedField$.value\r\n        ? of(this.selectedField$.value.values)\r\n        : of([]);\r\n    if (value && value.length >= 1) {\r\n      this.changeProperty(value, pos);\r\n    }\r\n  }\r\n\r\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\r\n    const keywordRegex = new RegExp(\r\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\r\n      'gi'\r\n    );\r\n    return this.fields$.value.filter((val) =>\r\n      keywordRegex.test(\r\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\r\n      )\r\n    );\r\n  }\r\n\r\n  private _filterValues(value: string): string[] {\r\n    const keywordRegex = new RegExp(\r\n      value\r\n        .toString()\r\n        .normalize('NFD')\r\n        .replace(/[\\u0300-\\u036f]/g, ''),\r\n      'gi'\r\n    );\r\n    return this.selectedField$.value.values.filter(\r\n      (val) =>\r\n        val &&\r\n        keywordRegex.test(\r\n          val\r\n            .toString()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n        )\r\n    );\r\n  }\r\n\r\n  clearSelectedField() {\r\n    this.currentFilter.propertyName = '';\r\n    this.selectedField$.next(undefined);\r\n    this.clearProperty();\r\n  }\r\n\r\n  isClearable(pos?: number) {\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      return this.currentFilter[detectedProperty];\r\n    }\r\n  }\r\n  clearProperty(pos?: number) {\r\n    // this.autoCompleteInputValues.closePanel();\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      return (this.currentFilter[detectedProperty] = '');\r\n    }\r\n  }\r\n\r\n  toggleFilterState(event) {\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n      (f) => f.filterid === this.currentFilter.filterid\r\n    ).active = event.checked;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  deleteFilter() {\r\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\r\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\r\n      (f) => f.filterid !== this.currentFilter.filterid\r\n    );\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeLogical(logical: string) {\r\n    this.currentFilter.parentLogical = logical;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeOperator(operator: string) {\r\n    this.currentFilter.operator = operator;\r\n    this.currentFilterIsSpatial();\r\n\r\n    if (\r\n      this.currentFilterIsSpatial$.value &&\r\n      this.currentFilter.wkt_geometry.length === 0\r\n    ) {\r\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\r\n    } else {\r\n      this.refreshFilters();\r\n    }\r\n  }\r\n\r\n  changeField(field: string) {\r\n    this.currentFilter.propertyName = field;\r\n    this.selectedField$.next(\r\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\r\n    );\r\n    this.refreshFilters();\r\n  }\r\n\r\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\r\n  // Due to this issue, the checkbox is hide.\r\n  changeCaseSensitive(matchCase) {\r\n    this.currentFilter.matchCase = matchCase.checked;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        (f) => f.filterid === this.currentFilter.filterid\r\n      )[detectedProperty] = value;\r\n\r\n      if (refreshFilter) {\r\n        this.refreshFilters();\r\n      }\r\n    }\r\n  }\r\n\r\n  changeNumericProperty(value, pos: number) {\r\n    this.changeProperty(parseFloat(value), pos);\r\n  }\r\n\r\n  changeSpatialSelector(value: any) {\r\n    this.currentFilter.igoSpatialSelector = value;\r\n\r\n    if (value === 'fixedExtent') {\r\n      this.changeMapExtentGeometry(false);\r\n    }\r\n    this.currentFilterIsSpatial();\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeSNRC(value: any) {\r\n    this.snrc = value;\r\n    this.changeSNRCGeometry();\r\n  }\r\n\r\n  changeSNRCGeometry() {\r\n    const interfaceOgcFilter =\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        (f) => f.filterid === this.currentFilter.filterid\r\n      );\r\n    if (!interfaceOgcFilter) {\r\n      return;\r\n    }\r\n\r\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\r\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\r\n        this.snrc,\r\n        this.map.projection\r\n      ).wktPoly;\r\n    }\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeMapExtentGeometry(refresh: boolean = true) {\r\n    const interfaceOgcFilter =\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        (f) => f.filterid === this.currentFilter.filterid\r\n      );\r\n    if (!interfaceOgcFilter) {\r\n      return;\r\n    }\r\n\r\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\r\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\r\n        this.map.projection,\r\n        this.map.viewController.getExtent(),\r\n        this.map.projection\r\n      ).wktPoly;\r\n    }\r\n    if (refresh) {\r\n      this.refreshFilters();\r\n    }\r\n  }\r\n\r\n  detectProperty(pos?: number): string {\r\n    switch (this.currentFilter.operator) {\r\n      case OgcFilterOperator.PropertyIsNotEqualTo:\r\n      case OgcFilterOperator.PropertyIsEqualTo:\r\n      case OgcFilterOperator.PropertyIsGreaterThan:\r\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\r\n      case OgcFilterOperator.PropertyIsLessThan:\r\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\r\n        return 'expression';\r\n      case OgcFilterOperator.PropertyIsLike:\r\n        return 'pattern';\r\n      case OgcFilterOperator.PropertyIsBetween:\r\n        return pos && pos === 1\r\n          ? 'lowerBoundary'\r\n          : pos && pos === 2\r\n          ? 'upperBoundary'\r\n          : undefined;\r\n      case OgcFilterOperator.During:\r\n        return pos && pos === 1\r\n          ? 'begin'\r\n          : pos && pos === 2\r\n          ? 'end'\r\n          : undefined;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  private currentFilterIsSpatial() {\r\n    let isSpatial = false;\r\n    if (this.currentFilter) {\r\n      isSpatial =\r\n        [\r\n          OgcFilterOperator.Contains,\r\n          OgcFilterOperator.Intersects,\r\n          OgcFilterOperator.Within\r\n        ].indexOf(this.currentFilter.operator) !== -1;\r\n    }\r\n    this.currentFilterIsSpatial$.next(isSpatial);\r\n  }\r\n\r\n  isTemporalOperator() {\r\n    return (\r\n      this.currentFilter.operator.toLowerCase() ===\r\n      this.ogcFilterOperator.During.toLowerCase()\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(\n      filterString,\n      wmsDatasource.options.params.LAYERS\n    );\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters =\n          ogcFilterWriter.defineInterfaceFilterSequence(\n            options.ogcFilters.filters,\n            options.paramsWFS.fieldNameGeometry\n          );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters =\n          ogcFilterWriter.defineInterfaceFilterSequence(\n            // With some wms server, this param must be set to make spatials call.\n            options.ogcFilters.filters,\n            options.fieldNameGeometry\n          );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(\n          options.ogcFilters.filters,\n          undefined,\n          undefined,\n          undefined,\n          wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div\n      class=\"pushButtonGroups\"\n      *ngIf=\"selector.selectorType === 'pushButton'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\"\n          class=\"mat-typography\"\n          appearance=\"legacy\"\n          vertical=\"{{ bundleIsVertical(bundle) }}\"\n          multiple=\"true\"\n        >\n          <mat-button-toggle\n            *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\"\n            (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\"\n            >{{ ogcPushButton.title }}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox\n            *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\"\n            (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\"\n            >{{ ogcCheckbox.title }}\n          </mat-checkbox>\n        </div>\n        <p\n          *ngIf=\"\n            isLessResults(bundle, 'checkbox') ||\n            isMoreResults(bundle, 'checkbox')\n          \"\n        >\n          <u\n            *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\"\n            >{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u\n            *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\"\n            >{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div\n      class=\"radioButtonGroups\"\n      *ngIf=\"selector.selectorType === 'radioButton'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <mat-radio-group formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button\n            *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\"\n            >{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button\n            *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\"\n            (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\"\n            >{{ ogcRadioButton.title }}\n          </mat-radio-button>\n          <p\n            *ngIf=\"\n              isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\n            \"\n          >\n            <u\n              *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\"\n              >{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u\n              *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\"\n              >{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"groupsSelector\">\n          <mat-button\n            *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\"\n          >\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\n          >\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection\n                [multiple]=\"bundle.multiple\"\n                [placeholder]=\"bundle.title\"\n                formControlName=\"selectMulti\"\n              >\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox\n                    *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"selectAllSelected\"\n                    [ngModelOptions]=\"{ standalone: true }\"\n                    (change)=\"toggleAllSelection()\"\n                    >Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\n                  tooltip-position=\"below\"\n                  matTooltipDelay=\"500\"\n                  matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"\n                    selectOptionClick($event.source.value, bundle, $event)\n                  \"\n                  [value]=\"ogcSelect\"\n                  >{{ ogcSelect.title }}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select [placeholder]=\"bundle.title\" formControlName=\"select\">\n                <mat-option\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\n                  tooltip-position=\"below\"\n                  matTooltipDelay=\"500\"\n                  matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\"\n                  (onSelectionChange)=\"\n                    selectOptionClick($event.source.value, bundle)\n                  \"\n                  >{{ ogcSelect.title }}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n\n    <div\n      class=\"autocompleteGroups\"\n      *ngIf=\"selector.selectorType === 'autocomplete'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getAutocompleteGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"autocompleteGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentAutocompleteGroup\"\n          >\n            <mat-option\n              *ngFor=\"let autocompleteGroup of getAutocompleteGroups()\"\n              [value]=\"autocompleteGroup\"\n              >{{ autocompleteGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentAutocompleteGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"groupsSelector\">\n          <mat-button\n            *ngIf=\"bundle.unfiltered\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (click)=\"emptyAutocomplete()\"\n          >\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field\n            *ngIf=\"filteredOgcAutocomplete[bundle.id]\"\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\n          >\n            <input\n              matInput\n              type=\"text\"\n              formControlName=\"autocomplete\"\n              #autocomplete\n              class=\"autocomplete\"\n              [matAutocomplete]=\"auto\"\n              [placeholder]=\"bundle.title\"\n            />\n            <mat-autocomplete\n              #auto=\"matAutocomplete\"\n              #autocomplete\n              (optionSelected)=\"autocompleteOptionClick($event.option.value)\"\n              [displayWith]=\"displayFn\"\n            >\n              <mat-option\n                *ngFor=\"\n                  let ogcAutocomplete of filteredOgcAutocomplete[bundle.id]\n                    | async\n                \"\n                [value]=\"ogcAutocomplete\"\n              >\n                {{ ogcAutocomplete.value }}\n              </mat-option>\n            </mat-autocomplete>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h3 *ngIf=\"!currentFilter.title\">\n    {{ 'igo.geo.filter.reportingDate' | translate }}\n  </h3>\n  <h3 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h3>\n  <igo-ogc-filter-time\n    [(datasource)]=\"datasource\"\n    [(currentFilter)]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\"\n  >\n  </igo-ogc-filter-time>\n</div>\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { MatOption } from '@angular/material/core';\r\nimport { MatSelect } from '@angular/material/select';\r\n\r\nimport { DOMOptions, DOMService, DOMValue } from '@igo2/common';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { debounceTime, map } from 'rxjs/operators';\r\n\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport {\r\n  IgoOgcFilterObject,\r\n  OgcFilterableDataSource,\r\n  OgcPushButton,\r\n  OgcSelectorBundle,\r\n  SelectorGroup\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\r\nimport { OGCFilterService } from '../shared/ogc-filter.service';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-selection',\r\n  templateUrl: './ogc-filter-selection.component.html',\r\n  styleUrls: ['./ogc-filter-selection.component.scss'],\r\n  providers: [DOMService]\r\n})\r\nexport class OgcFilterSelectionComponent implements OnInit {\r\n  @ViewChild('selection') sel: MatSelect;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() checkboxesIndex = 5;\r\n  @Input() radioButtonsIndex = 5;\r\n  @Input() baseIndex = 5;\r\n\r\n  @Input()\r\n  get currentFilter(): any {\r\n    return this._currentFilter;\r\n  }\r\n  set currentFilter(value) {\r\n    this._currentFilter = value;\r\n    if (this._currentFilter?.sliderOptions) {\r\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\r\n    }\r\n  }\r\n  private _currentFilter: any;\r\n\r\n  public ogcFilterOperator = OgcFilterOperator;\r\n\r\n  public form: UntypedFormGroup;\r\n  private ogcFilterWriter: OgcFilterWriter;\r\n  public color = 'primary';\r\n  public selectAllSelected = false;\r\n  public selectEnabled$ = new BehaviorSubject(undefined);\r\n  public selectEnableds$ = new BehaviorSubject([]);\r\n  public autocompleteEnabled$ = new BehaviorSubject(undefined);\r\n  public filteredOgcAutocomplete = {};\r\n\r\n  public applyFiltersTimeout;\r\n\r\n  get ogcFiltersSelectors() {\r\n    const ogcSelector = [];\r\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.select) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\r\n    }\r\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\r\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.autocomplete);\r\n    }\r\n    ogcSelector.sort((a, b) => {\r\n      if (a.order < b.order) {\r\n        return -1;\r\n      }\r\n      if (a.order > b.order) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n    return ogcSelector;\r\n  }\r\n\r\n  get currentPushButtonsGroup() {\r\n    return this.form.get('pushButtonsGroup').value;\r\n  }\r\n  set currentPushButtonsGroup(value) {\r\n    this.form.patchValue({ pushButtonsGroup: value });\r\n  }\r\n\r\n  get currentCheckboxesGroup() {\r\n    return this.form.get('checkboxesGroup').value;\r\n  }\r\n  set currentCheckboxesGroup(value) {\r\n    this.form.patchValue({ checkboxesGroup: value });\r\n  }\r\n\r\n  get currentRadioButtonsGroup() {\r\n    return this.form.get('radioButtonsGroup').value;\r\n  }\r\n  set currentRadioButtonsGroup(value) {\r\n    this.form.patchValue({ radioButtonsGroup: value });\r\n  }\r\n\r\n  get currentSelectGroup() {\r\n    return this.form.get('selectGroup').value;\r\n  }\r\n  set currentSelectGroup(value) {\r\n    this.form.patchValue({ selectGroup: value });\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  get currentAutocompleteGroup() {\r\n    return this.form.get('autocompleteGroup').value;\r\n  }\r\n  set currentAutocompleteGroup(value) {\r\n    this.form.patchValue({ autocompleteGroup: value });\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  get selectEnabled() {\r\n    return this.selectEnabled$.value;\r\n  }\r\n\r\n  set selectEnabled(value) {\r\n    this.selectEnabled$.next(value);\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors?.forEach((selector) => {\r\n        value === selector\r\n          ? (selector.enabled = true)\r\n          : (selector.enabled = false);\r\n      });\r\n    });\r\n\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  get selectEnableds() {\r\n    return this.selectEnableds$.value;\r\n  }\r\n\r\n  set selectEnableds(value) {\r\n    this.selectEnableds$.next(value);\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors?.forEach((selector) => {\r\n        value.includes(selector)\r\n          ? (selector.enabled = true)\r\n          : (selector.enabled = false);\r\n      });\r\n    });\r\n\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  get autocompleteEnabled() {\r\n    return this.autocompleteEnabled$.value;\r\n  }\r\n\r\n  set autocompleteEnabled(value) {\r\n    this.autocompleteEnabled$.next(value);\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors?.forEach((selector) => {\r\n        value === selector.title\r\n          ? (selector.enabled = true)\r\n          : (selector.enabled = false);\r\n      });\r\n    });\r\n\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  constructor(\r\n    private ogcFilterService: OGCFilterService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private domService: DOMService,\r\n    private configService: ConfigService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {\r\n    this.ogcFilterWriter = new OgcFilterWriter();\r\n    this.buildForm();\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      pushButtons: ['', [Validators.required]],\r\n      radioButtons: ['', [Validators.required]],\r\n      pushButtonsGroup: ['', [Validators.required]],\r\n      checkboxesGroup: ['', [Validators.required]],\r\n      radioButtonsGroup: ['', [Validators.required]],\r\n      selectGroup: ['', [Validators.required]],\r\n      select: ['', [Validators.required]],\r\n      selectMulti: ['', [Validators.required]],\r\n      autocompleteGroup: ['', [Validators.required]],\r\n      autocomplete: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  getPushButtonsGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\r\n      return this.datasource.options.ogcFilters.pushButtons.groups;\r\n    }\r\n  }\r\n\r\n  getCheckboxesGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\r\n      return this.datasource.options.ogcFilters.checkboxes.groups;\r\n    }\r\n  }\r\n\r\n  getRadioButtonsGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\r\n      return this.datasource.options.ogcFilters.radioButtons.groups;\r\n    }\r\n  }\r\n\r\n  getSelectGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.select) {\r\n      return this.datasource.options.ogcFilters.select.groups;\r\n    }\r\n  }\r\n\r\n  getAutocompleteGroups(): SelectorGroup[] {\r\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\r\n      return this.datasource.options.ogcFilters.autocomplete.groups;\r\n    }\r\n  }\r\n\r\n  async ngOnInit() {\r\n    if (this.datasource.options.ogcFilters) {\r\n      if (this.datasource.options.ogcFilters.pushButtons) {\r\n        this.currentPushButtonsGroup =\r\n          this.datasource.options.ogcFilters.pushButtons.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.pushButtons.groups[0];\r\n      }\r\n      if (this.datasource.options.ogcFilters.checkboxes) {\r\n        this.currentCheckboxesGroup =\r\n          this.datasource.options.ogcFilters.checkboxes.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.checkboxes.groups[0];\r\n      }\r\n      if (this.datasource.options.ogcFilters.radioButtons) {\r\n        this.currentRadioButtonsGroup =\r\n          this.datasource.options.ogcFilters.radioButtons.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.radioButtons.groups[0];\r\n      }\r\n      if (this.datasource.options.ogcFilters.select) {\r\n        this.currentSelectGroup =\r\n          this.datasource.options.ogcFilters.select.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.select.groups[0];\r\n        this.getSelectEnabled();\r\n        await this.getSelectDomValues();\r\n      }\r\n      if (this.datasource.options.ogcFilters.autocomplete) {\r\n        this.currentAutocompleteGroup =\r\n          this.datasource.options.ogcFilters.autocomplete.groups.find(\r\n            (group) => group.enabled\r\n          ) || this.datasource.options.ogcFilters.autocomplete.groups[0];\r\n        this.getAutocompleteEnabled();\r\n        await this.getAutocompleteDomValues();\r\n      }\r\n      this.applyFilters();\r\n    }\r\n\r\n    this.form\r\n      .get('pushButtonsGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onPushButtonsChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('checkboxesGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onCheckboxesChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('radioButtonsGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onRadioButtonsChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('selectGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onSelectChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('autocompleteGroup')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.onAutocompleteChangeGroup();\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('pushButtons')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.applyFilters();\r\n      });\r\n    this.form\r\n      .get('radioButtons')\r\n      .valueChanges.pipe(debounceTime(750))\r\n      .subscribe(() => {\r\n        this.applyFilters();\r\n      });\r\n  }\r\n\r\n  private getSelectEnabled() {\r\n    const enableds = [];\r\n    let enabled;\r\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\r\n      if (compSelect.multiple) {\r\n        compSelect.selectors?.forEach((selector) => {\r\n          if (selector.enabled) {\r\n            enableds.push(selector);\r\n          }\r\n        });\r\n        this.selectEnableds = enableds;\r\n        this.form.controls['selectMulti'].setValue(enableds);\r\n      } else {\r\n        compSelect.selectors?.forEach((selector) => {\r\n          if (selector.enabled) {\r\n            enabled = selector;\r\n          }\r\n        });\r\n        this.form.controls['select'].reset(enabled);\r\n        this.selectEnabled$.subscribe((value) => {\r\n          if (this.form.controls['select'].value !== value) {\r\n            this.form.controls['select'].setValue(value);\r\n          }\r\n        });\r\n        this.selectEnabled = enabled;\r\n      }\r\n    });\r\n  }\r\n\r\n  private getAutocompleteEnabled() {\r\n    let enabled;\r\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors?.forEach((selector) => {\r\n        if (selector.enabled) {\r\n          const dom = {\r\n            id: selector.filters.expression,\r\n            value: selector.title\r\n          };\r\n          enabled = selector.title;\r\n          this.form.controls['autocomplete'].setValue(dom);\r\n        }\r\n      });\r\n      this.autocompleteEnabled = enabled;\r\n    });\r\n  }\r\n\r\n  getToolTip(selector): string {\r\n    let toolTip;\r\n    if (selector.tooltip) {\r\n      if (Array.isArray(selector.tooltip)) {\r\n        toolTip = selector.tooltip.join('\\n');\r\n      } else {\r\n        toolTip = selector.tooltip;\r\n      }\r\n    }\r\n    return toolTip || '';\r\n  }\r\n\r\n  async getSelectDomValues() {\r\n    for (const bundle of this.datasource.options.ogcFilters.select.bundles) {\r\n      if (bundle.domSelectors) {\r\n        let domValues;\r\n        for (const domSelector of bundle.domSelectors) {\r\n          let filterDOM;\r\n          for (const domOptions of this.configService.getConfig<DOMOptions[]>(\r\n            'dom'\r\n          )) {\r\n            if (\r\n              domSelector.id === domOptions.id ||\r\n              domSelector.name === domOptions.name\r\n            ) {\r\n              filterDOM = {\r\n                id: domOptions.id,\r\n                url: domOptions.url,\r\n                name: domOptions.name,\r\n                values: domOptions.values\r\n              };\r\n            }\r\n          }\r\n          filterDOM.url\r\n            ? (domValues = (await this.domService.getDom(\r\n                filterDOM\r\n              )) as DOMValue[])\r\n            : (domValues = filterDOM.values);\r\n\r\n          if (domValues) {\r\n            let newBundle = bundle;\r\n            newBundle.selectors = [];\r\n            let selector;\r\n            for (const value of domValues) {\r\n              if (bundle.multiple) {\r\n                let enabled;\r\n                this.selectEnableds?.find((sel) => sel.title === value.value)\r\n                  ? (enabled = true)\r\n                  : (enabled = false);\r\n                selector = {\r\n                  title: value.value,\r\n                  enabled,\r\n                  filters: {\r\n                    operator: domSelector.operator,\r\n                    propertyName: domSelector.propertyName,\r\n                    expression: value.id\r\n                  }\r\n                };\r\n              } else {\r\n                selector = {\r\n                  title: value.value,\r\n                  enabled:\r\n                    this.selectEnabled?.title === value.value ? true : false,\r\n                  filters: {\r\n                    operator: domSelector.operator,\r\n                    propertyName: domSelector.propertyName,\r\n                    expression: value.id\r\n                  }\r\n                };\r\n              }\r\n              newBundle.selectors.push(selector);\r\n            }\r\n            this.getSelectGroups()\r\n              .find((group) => group.ids.includes(newBundle.id))\r\n              .computedSelectors.find(\r\n                (comp) => comp.title === newBundle.title\r\n              ).selectors = newBundle.selectors;\r\n          }\r\n        }\r\n        this.getSelectEnabled();\r\n      }\r\n    }\r\n  }\r\n\r\n  async getAutocompleteDomValues() {\r\n    for (const bundle of this.datasource.options.ogcFilters.autocomplete\r\n      .bundles) {\r\n      if (bundle.domSelectors) {\r\n        let domValues;\r\n        for (const domSelector of bundle.domSelectors) {\r\n          let filterDOM;\r\n          for (const domOptions of this.configService.getConfig<DOMOptions[]>(\r\n            'dom'\r\n          )) {\r\n            if (\r\n              domSelector.id === domOptions.id ||\r\n              domSelector.name === domOptions.name\r\n            ) {\r\n              filterDOM = {\r\n                id: domOptions.id,\r\n                url: domOptions.url,\r\n                name: domOptions.name,\r\n                values: domOptions.values\r\n              };\r\n            }\r\n          }\r\n          filterDOM.url\r\n            ? (domValues = (await this.domService.getDom(\r\n                filterDOM\r\n              )) as DOMValue[])\r\n            : (domValues = filterDOM.values);\r\n\r\n          if (domValues) {\r\n            let newBundle = bundle;\r\n            newBundle.selectors = [];\r\n            let selector;\r\n            for (const value of domValues) {\r\n              selector = {\r\n                title: value.value,\r\n                enabled:\r\n                  this.autocompleteEnabled &&\r\n                  this.autocompleteEnabled === value.value\r\n                    ? true\r\n                    : false,\r\n                filters: {\r\n                  operator: domSelector.operator,\r\n                  propertyName: domSelector.propertyName,\r\n                  expression: value.id\r\n                }\r\n              };\r\n              newBundle.selectors.push(selector);\r\n            }\r\n            this.getAutocompleteGroups()\r\n              .find((group) => group.ids.includes(newBundle.id))\r\n              .computedSelectors.find(\r\n                (comp) => comp.title === newBundle.title\r\n              ).selectors = newBundle.selectors;\r\n          }\r\n        }\r\n\r\n        this.filteredOgcAutocomplete[bundle.id] = new Observable<any[]>();\r\n        this.cdRef.detectChanges();\r\n        this.filteredOgcAutocomplete[bundle.id] = this.form.controls[\r\n          'autocomplete'\r\n        ].valueChanges.pipe(\r\n          map((value) => {\r\n            if (value.length) {\r\n              return domValues?.filter((option) => {\r\n                const filterNormalized = value\r\n                  ? value\r\n                      .toLowerCase()\r\n                      .normalize('NFD')\r\n                      .replace(/[\\u0300-\\u036f]/g, '')\r\n                  : '';\r\n                const featureNameNormalized = option.value\r\n                  .toLowerCase()\r\n                  .normalize('NFD')\r\n                  .replace(/[\\u0300-\\u036f]/g, '');\r\n                return featureNameNormalized.includes(filterNormalized);\r\n              });\r\n            }\r\n          })\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  // getButtonStyle(pb: OgcPushButton): {} {\r\n\r\n  //   let styles;\r\n  //   if (pb.color) {\r\n  //     styles = {\r\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\r\n  //     };\r\n  //   } else {\r\n  //     styles = {\r\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\r\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\r\n  //     }\r\n  //   }\r\n  //   return styles;\r\n  // }\r\n\r\n  getButtonColor(pushButton: OgcPushButton): {} {\r\n    let styles;\r\n    if (pushButton.color && pushButton.enabled) {\r\n      styles = {\r\n        'background-color': `rgba(${pushButton.color})`\r\n      };\r\n    }\r\n    return styles;\r\n  }\r\n\r\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\r\n    return bundle.vertical ? bundle.vertical : false;\r\n  }\r\n\r\n  private onPushButtonsChangeGroup() {\r\n    this.getPushButtonsGroups().map((group) => (group.enabled = false));\r\n    this.getPushButtonsGroups().find(\r\n      (group) => group === this.currentPushButtonsGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  private onCheckboxesChangeGroup() {\r\n    this.getCheckboxesGroups().map((group) => (group.enabled = false));\r\n    this.getCheckboxesGroups().find(\r\n      (group) => group === this.currentCheckboxesGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  private onRadioButtonsChangeGroup() {\r\n    this.getRadioButtonsGroups().map((group) => (group.enabled = false));\r\n    this.getRadioButtonsGroups().find(\r\n      (group) => group === this.currentRadioButtonsGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  private onSelectChangeGroup() {\r\n    this.getSelectGroups().map((group) => (group.enabled = false));\r\n    this.getSelectGroups().find(\r\n      (group) => group === this.currentSelectGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  private onAutocompleteChangeGroup() {\r\n    this.getAutocompleteGroups().map((group) => (group.enabled = false));\r\n    this.getAutocompleteGroups().find(\r\n      (group) => group === this.currentAutocompleteGroup\r\n    ).enabled = true;\r\n  }\r\n\r\n  onSelectionChange(currentOgcSelection?, selectorType?) {\r\n    clearTimeout(this.applyFiltersTimeout);\r\n    if (selectorType === 'radioButton') {\r\n      this.emptyRadioButtons();\r\n    }\r\n\r\n    if (currentOgcSelection) {\r\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\r\n    }\r\n    this.applyFiltersTimeout = setTimeout(() => {\r\n      this.applyFilters();\r\n    }, 750);\r\n  }\r\n\r\n  emptyRadioButtons() {\r\n    this.currentRadioButtonsGroup.computedSelectors.forEach((compSelect) => {\r\n      compSelect.selectors.map((selector) => (selector.enabled = false));\r\n\r\n      this.applyFiltersTimeout = setTimeout(() => {\r\n        this.applyFilters();\r\n      }, 750);\r\n    });\r\n  }\r\n\r\n  emptySelect() {\r\n    this.selectEnabled = undefined;\r\n  }\r\n\r\n  emptyAutocomplete() {\r\n    this.autocompleteEnabled = undefined;\r\n    this.form.controls['autocomplete'].setValue('');\r\n    this.form.controls['autocomplete'].markAsUntouched();\r\n  }\r\n\r\n  toggleAllSelection() {\r\n    if (this.selectAllSelected) {\r\n      const enableds = [];\r\n      this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\r\n        compSelect.selectors?.forEach((selector) => {\r\n          enableds.push(selector);\r\n        });\r\n      });\r\n      this.sel.options.forEach((item: MatOption) => item.select());\r\n      this.selectEnableds = enableds;\r\n    } else {\r\n      this.sel.options.forEach((item: MatOption) => item.deselect());\r\n      this.selectEnableds = [];\r\n    }\r\n  }\r\n\r\n  selectOptionClick(value, bundle, event?) {\r\n    if (bundle.multiple) {\r\n      const enableds = this.selectEnableds;\r\n      let newStatus = true;\r\n      this.sel.options.forEach((item: MatOption) => {\r\n        if (!item.selected) {\r\n          newStatus = false;\r\n        }\r\n      });\r\n      this.selectAllSelected = newStatus;\r\n      if (event.isUserInput) {\r\n        if (enableds.length) {\r\n          for (const enabled of enableds) {\r\n            if (enabled.title === value.title) {\r\n              if (enabled.enabled && value.enabled) {\r\n                enableds.splice(enableds.indexOf(enabled), 1);\r\n                this.selectEnableds = enableds;\r\n                break;\r\n              }\r\n            } else if (enableds.indexOf(enabled) === enableds.length - 1) {\r\n              enableds.push(value);\r\n              this.selectEnableds = enableds;\r\n              break;\r\n            }\r\n          }\r\n        } else {\r\n          enableds.push(value);\r\n          this.selectEnableds = enableds;\r\n        }\r\n      }\r\n    } else {\r\n      this.selectEnabled = value;\r\n    }\r\n  }\r\n\r\n  autocompleteOptionClick(value) {\r\n    this.autocompleteEnabled = value.value;\r\n  }\r\n\r\n  displayFn(dom): string {\r\n    return dom ? dom.value : undefined;\r\n  }\r\n\r\n  private applyFilters() {\r\n    let filterQueryString = '';\r\n    const conditions = [];\r\n    const currentGroups = [\r\n      this.currentPushButtonsGroup,\r\n      this.currentCheckboxesGroup,\r\n      this.currentRadioButtonsGroup,\r\n      this.currentSelectGroup,\r\n      this.currentAutocompleteGroup\r\n    ];\r\n    for (const currentGroup of currentGroups) {\r\n      if (currentGroup.computedSelectors) {\r\n        currentGroup.computedSelectors.map((selectorBundle) => {\r\n          const bundleCondition = [];\r\n          selectorBundle.selectors\r\n            ?.filter((ogcSelector) => ogcSelector.enabled === true)\r\n            .forEach((enabledSelector) =>\r\n              bundleCondition.push(enabledSelector.filters)\r\n            );\r\n          if (bundleCondition.length >= 1) {\r\n            if (bundleCondition.length === 1) {\r\n              conditions.push(bundleCondition[0]);\r\n            } else {\r\n              conditions.push({\r\n                logical: selectorBundle.logical,\r\n                filters: bundleCondition\r\n              });\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n    if (this.isTemporalOperator() && this._currentFilter.active) {\r\n      conditions.push(\r\n        this.datasource.options.ogcFilters.interfaceOgcFilters[0]\r\n      );\r\n    }\r\n    if (conditions.length >= 1) {\r\n      filterQueryString = this.ogcFilterWriter.buildFilter(\r\n        conditions.length === 1\r\n          ? conditions[0]\r\n          : ({ logical: 'And', filters: conditions } as IgoOgcFilterObject)\r\n      );\r\n    }\r\n    if (this.datasource.options.type === 'wms') {\r\n      this.ogcFilterService.filterByOgc(\r\n        this.datasource as WMSDataSource,\r\n        filterQueryString\r\n      );\r\n    }\r\n    if (this.datasource.options.type === 'wfs') {\r\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\r\n      this.datasource.ol.refresh();\r\n    }\r\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\r\n  }\r\n\r\n  isMoreResults(bundle, type) {\r\n    let selectorsLength = 0;\r\n    for (const selectors of bundle.selectors) {\r\n      selectorsLength++;\r\n    }\r\n    const index =\r\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\r\n    return selectorsLength > index;\r\n  }\r\n\r\n  displayMoreResults(type) {\r\n    type === 'radio'\r\n      ? (this.radioButtonsIndex += 5)\r\n      : (this.checkboxesIndex += 5);\r\n    return;\r\n  }\r\n\r\n  isLessResults(bundle, type) {\r\n    let selectorsLength = 0;\r\n    for (const selectors of bundle.selectors) {\r\n      selectorsLength++;\r\n    }\r\n    const index =\r\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\r\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\r\n  }\r\n\r\n  displayLessResults(type) {\r\n    type === 'radio'\r\n      ? (this.radioButtonsIndex = this.baseIndex)\r\n      : (this.checkboxesIndex = this.baseIndex);\r\n    return;\r\n  }\r\n\r\n  isTemporalOperator() {\r\n    return (\r\n      this.currentFilter?.operator?.toLowerCase() ===\r\n      this.ogcFilterOperator.During.toLowerCase()\r\n    );\r\n  }\r\n\r\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\r\n    const detectedProperty = this.detectProperty(pos);\r\n    if (detectedProperty) {\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\r\n        (filter) => filter.filterid === this.currentFilter.filterid\r\n      )[detectedProperty] = value;\r\n\r\n      if (refreshFilter) {\r\n        this.applyFilters();\r\n      }\r\n    }\r\n  }\r\n\r\n  detectProperty(pos?: number): string {\r\n    switch (this.currentFilter.operator) {\r\n      case OgcFilterOperator.PropertyIsNotEqualTo:\r\n      case OgcFilterOperator.PropertyIsEqualTo:\r\n      case OgcFilterOperator.PropertyIsGreaterThan:\r\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\r\n      case OgcFilterOperator.PropertyIsLessThan:\r\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\r\n        return 'expression';\r\n      case OgcFilterOperator.PropertyIsLike:\r\n        return 'pattern';\r\n      case OgcFilterOperator.PropertyIsBetween:\r\n        return pos && pos === 1\r\n          ? 'lowerBoundary'\r\n          : pos && pos === 2\r\n          ? 'upperBoundary'\r\n          : undefined;\r\n      case OgcFilterOperator.During:\r\n        return pos && pos === 1\r\n          ? 'begin'\r\n          : pos && pos === 2\r\n          ? 'end'\r\n          : undefined;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { default as moment } from 'moment';\r\n\r\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\r\n\r\n@Injectable()\r\nexport class OGCFilterTimeService {\r\n  readonly defaultStepMillisecond = 60000;\r\n\r\n  constructor() {}\r\n\r\n  step(datasource: OgcFilterableDataSource, currentFilter): string {\r\n    return datasource.options.stepDate\r\n      ? datasource.options.stepDate\r\n      : currentFilter.step;\r\n  }\r\n\r\n  stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\r\n    const step = moment\r\n      .duration(this.step(dataSource, currentFilter))\r\n      .asMilliseconds();\r\n    return step === 0 ? this.defaultStepMillisecond : step;\r\n  }\r\n\r\n  stepIsYearDuration(step: string) {\r\n    const year = moment.duration(step);\r\n    return (\r\n      year.years() !== 0 &&\r\n      year.months() === 0 &&\r\n      year.weeks() === 0 &&\r\n      year.days() === 0 &&\r\n      year.hours() === 0 &&\r\n      year.minutes() === 0\r\n    );\r\n  }\r\n\r\n  stepIsMonthDuration(step: string) {\r\n    const month = moment.duration(step);\r\n    return (\r\n      month.months() !== 0 &&\r\n      month.weeks() === 0 &&\r\n      month.days() === 0 &&\r\n      month.hours() === 0 &&\r\n      month.minutes() === 0\r\n    );\r\n  }\r\n\r\n  stepIsWeekDuration(step: string) {\r\n    const week = moment.duration(step);\r\n    return (\r\n      week.weeks() !== 0 &&\r\n      week.days() === 7 &&\r\n      week.hours() === 0 &&\r\n      week.minutes() === 0\r\n    );\r\n  }\r\n\r\n  stepIsDayDuration(step: string) {\r\n    const day = moment.duration(step);\r\n    return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\r\n  }\r\n\r\n  stepIsHourDuration(step: string) {\r\n    const hour = moment.duration(step);\r\n    return hour.hours() !== 0 && hour.minutes() === 0;\r\n  }\r\n\r\n  stepIsMinuteDuration(step: string) {\r\n    const minute = moment.duration(step);\r\n    return minute.minutes() !== 0;\r\n  }\r\n\r\n  dateToNumber(date: Date): number {\r\n    let newDate = new Date();\r\n    if (date) {\r\n      newDate = new Date(date);\r\n    }\r\n    return newDate.getTime();\r\n  }\r\n\r\n  public addStep(value, stepMillisecond) {\r\n    return moment(value).add(stepMillisecond, 'milliseconds').toDate();\r\n  }\r\n\r\n  public subtractStep(value, stepMillisecond) {\r\n    return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnInit,\r\n  Output,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { MatSlider } from '@angular/material/slider';\r\n\r\nimport { default as moment } from 'moment';\r\n\r\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-time-slider',\r\n  templateUrl: './ogc-filter-time-slider.component.html',\r\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\r\n})\r\nexport class OgcFilterTimeSliderComponent implements OnInit {\r\n  @Input() currentFilter: any;\r\n  @Input() begin: any;\r\n  @Input() max: any;\r\n  @Input() datasource: any;\r\n  @Output() changeProperty: EventEmitter<{\r\n    value: any;\r\n    pos: number;\r\n    refreshFilter: boolean;\r\n  }> = new EventEmitter<any>();\r\n  @ViewChild(MatSlider) slider: MatSlider;\r\n\r\n  interval;\r\n  sliderValue: number = 1;\r\n  calculatedStep: number = 0;\r\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\r\n  readonly _defaultSliderInterval: number = 2000;\r\n  public playIcon = 'play-circle';\r\n  public resetIcon = 'replay';\r\n\r\n  get sliderInterval(): number {\r\n    return this.currentFilter.sliderInterval === undefined\r\n      ? this._defaultSliderInterval\r\n      : this.currentFilter.sliderInterval;\r\n  }\r\n\r\n  get displayFormat(): string {\r\n    if (this.currentFilter.sliderOptions?.displayFormat) {\r\n      return this.currentFilter.sliderOptions.displayFormat;\r\n    }\r\n    if (this.currentFilter.displayFormat) {\r\n      return this.currentFilter.displayFormat;\r\n    }\r\n    return this._defaultDisplayFormat;\r\n  }\r\n\r\n  get beginMillisecond(): number {\r\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\r\n  }\r\n\r\n  get maxMillisecond(): number {\r\n    return this.ogcFilterTimeService.dateToNumber(this.max);\r\n  }\r\n\r\n  get stepMillisecond(): number {\r\n    return this.ogcFilterTimeService.stepMillisecond(\r\n      this.datasource,\r\n      this.currentFilter\r\n    );\r\n  }\r\n\r\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\r\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.calculateStep();\r\n    this.handleSliderInput({ value: 1 });\r\n  }\r\n\r\n  sliderDisplayWith(value) {\r\n    let dateTmp = new Date(\r\n      this.beginMillisecond + (value - 1) * this.stepMillisecond\r\n    );\r\n\r\n    if (\r\n      this.ogcFilterTimeService.stepIsYearDuration(\r\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n      )\r\n    ) {\r\n      const toAdd = moment\r\n        .duration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n        .years();\r\n      dateTmp = moment(this.beginMillisecond)\r\n        .add((value - 1) * toAdd, 'year')\r\n        .toDate();\r\n    } else if (\r\n      this.ogcFilterTimeService.stepIsMonthDuration(\r\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n      )\r\n    ) {\r\n      const toAdd = moment\r\n        .duration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n        .months();\r\n      dateTmp = moment(this.beginMillisecond)\r\n        .add((value - 1) * toAdd, 'month')\r\n        .toDate();\r\n    }\r\n\r\n    return moment(dateTmp).format(this.displayFormat);\r\n  }\r\n\r\n  playFilter(event: any) {\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        (that) => {\r\n          if (this.slider.step < this.calculatedStep) {\r\n            const _increment = '_increment';\r\n            const _emitInputEvent = '_emitInputEvent';\r\n            this.slider[_increment](1);\r\n            this.slider[_emitInputEvent]();\r\n          } else {\r\n            this.stopFilter();\r\n          }\r\n        },\r\n        this.sliderInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  stopFilter() {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n  }\r\n\r\n  resetFilter(event: any) {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n    this.slider.step = 1;\r\n    const _increment = '_increment';\r\n    const _emitInputEvent = '_emitInputEvent';\r\n    this.slider[_emitInputEvent]();\r\n  }\r\n\r\n  handleSliderInput(matSliderChange) {\r\n    if (matSliderChange) {\r\n      if (\r\n        this.ogcFilterTimeService.stepIsYearDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n      ) {\r\n        const toAdd = moment\r\n          .duration(\r\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n          )\r\n          .years();\r\n        const dateBeginTmp = moment(this.beginMillisecond)\r\n          .add((matSliderChange.value - 1) * toAdd, 'year')\r\n          .toDate();\r\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\r\n        this.changeProperty.next({\r\n          value: moment(dateBeginTmp).toDate().toISOString(),\r\n          pos: 1,\r\n          refreshFilter: false\r\n        });\r\n        this.changeProperty.next({\r\n          value: moment(dateEndTmp).toDate().toISOString(),\r\n          pos: 2,\r\n          refreshFilter: true\r\n        });\r\n      } else if (\r\n        this.ogcFilterTimeService.stepIsMonthDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n      ) {\r\n        const toAdd = moment\r\n          .duration(\r\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n          )\r\n          .months();\r\n        const dateBeginTmp = moment(this.beginMillisecond)\r\n          .add((matSliderChange.value - 1) * toAdd, 'month')\r\n          .toDate();\r\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\r\n        this.changeProperty.next({\r\n          value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\r\n          pos: 1,\r\n          refreshFilter: false\r\n        });\r\n        this.changeProperty.next({\r\n          value: moment(dateEndTmp).toDate().toISOString(),\r\n          pos: 2,\r\n          refreshFilter: true\r\n        });\r\n      } else if (\r\n        this.ogcFilterTimeService.stepIsDayDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        ) ||\r\n        this.ogcFilterTimeService.stepIsHourDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        ) ||\r\n        this.ogcFilterTimeService.stepIsMinuteDuration(\r\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\r\n        )\r\n      ) {\r\n        const dateTmp = new Date(\r\n          this.beginMillisecond +\r\n            this.stepMillisecond * (matSliderChange.value - 1)\r\n        );\r\n        this.changeProperty.next({\r\n          value: dateTmp.toISOString(),\r\n          pos: 1,\r\n          refreshFilter: false\r\n        });\r\n        this.changeProperty.next({\r\n          value: new Date(\r\n            this.ogcFilterTimeService.addStep(\r\n              dateTmp.toISOString(),\r\n              this.stepMillisecond\r\n            )\r\n          ).toISOString(),\r\n          pos: 2,\r\n          refreshFilter: true\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  calculateStep() {\r\n    for (\r\n      let i = 1;\r\n      this.maxMillisecond -\r\n        (this.beginMillisecond + i * this.stepMillisecond) >=\r\n      -1;\r\n      i++\r\n    ) {\r\n      this.calculatedStep = i;\r\n    }\r\n  }\r\n}\r\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    thumbLabel\n    #ngSlider\n    ><input\n      matSliderThumb\n      (input)=\"\n        handleSliderInput({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n    />\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\n  </button>\n</div>\n","<div class=\"datetime-container\">\n  <mat-slide-toggle\n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\"\n  >\n    {{ 'igo.geo.filter.sliderModeTitle' | translate }}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\"\n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n        with the datepicker  -->\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.timeFilter.startYear' | translate }}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{ onlyYearBegin }}\"\n          (change)=\"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n          [disabled]=\"filterStateDisable\"\n        />\n        <mat-datepicker-toggle\n          matSuffix\n          [for]=\"beginDatepicker\"\n          [disabled]=\"filterStateDisable\"\n        ></mat-datepicker-toggle>\n\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n        >\n        </mat-datepicker>\n\n        <input\n          #beginYear\n          class=\"year-input-hide\"\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          enabled=\"false\"\n          readonly=\"true\"\n          [value]=\"\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\n          \"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"\n            endValue && !restrictedToStep()\n              ? endValue\n              : handleDate(datasource.options.maxDate)\n          \"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.timeFilter.endYear' | translate }}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{ onlyYearEnd }}\"\n          (change)=\"yearOnlyInputChange($event, endDatepicker, 'end')\"\n          [disabled]=\"filterStateDisable\"\n        />\n        <mat-datepicker-toggle\n          matSuffix\n          [for]=\"endDatepicker\"\n          [disabled]=\"filterStateDisable\"\n        ></mat-datepicker-toggle>\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #endDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"endValue\"\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n        >\n        </mat-datepicker>\n\n        <input\n          #endYear\n          class=\"year-input-hide\"\n          matInput\n          [matDatepicker]=\"endDatepicker\"\n          enabled=\"false\"\n          readonly=\"true\"\n          [value]=\"endValue ? endValue : handleDate(datasource.options.maxDate)\"\n          [min]=\"\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\n          \"\n          [max]=\"handleDate(datasource.options.maxDate)\"\n        />\n      </mat-form-field>\n      <div class=\"actions-container\">\n        <button\n          class=\"reset-button\"\n          mat-icon-button\n          color=\"primary\"\n          (click)=\"resetFilter()\"\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n          [disabled]=\"filterStateDisable\"\n        >\n          <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\n        </button>\n        <mat-slide-toggle\n          class=\"toggle-filter-state\"\n          (change)=\"toggleFilterState()\"\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [checked]=\"!filterStateDisable\"\n        >\n        </mat-slide-toggle>\n      </div>\n    </div>\n\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType() !== 'year'\">\n      <div class=\"datetime-input\">\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\n          <mat-datepicker-toggle\n            matSuffix\n            [for]=\"beginDatepicker\"\n            [disabled]=\"filterStateDisable\"\n          ></mat-datepicker-toggle>\n          <input\n            #begin\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n            [matDatepickerFilter]=\"filterBeginFunction\"\n            [value]=\"\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\n            \"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"\n              endValue && !restrictedToStep()\n                ? endValue\n                : handleDate(datasource.options.maxDate)\n            \"\n            [disabled]=\"filterStateDisable\"\n          />\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\"\n          >\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"beginHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\n            >\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{\n                hour\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"beginMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\n            >\n              <mat-option\n                *ngFor=\"let minute of beginMinutes\"\n                [value]=\"minute\"\n                >{{ minute }}</mat-option\n              >\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div *ngIf=\"!restrictedToStep()\" class=\"datetime-input\">\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\n          <mat-datepicker-toggle\n            matSuffix\n            [for]=\"endDatepicker\"\n            [disabled]=\"filterStateDisable\"\n          ></mat-datepicker-toggle>\n          <input\n            #end\n            matInput\n            [matDatepicker]=\"endDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n            [matDatepickerFilter]=\"filterEndFunction\"\n            [value]=\"\n              endValue ? endValue : handleDate(datasource.options.maxDate)\n            \"\n            [min]=\"\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\n            \"\n            [max]=\"handleDate(datasource.options.maxDate)\"\n            [disabled]=\"filterStateDisable\"\n          />\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #endDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"endValue\"\n            (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n            (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\"\n          >\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"endHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\n            >\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{\n                hour\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"endMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\n            >\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{\n                minute\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div class=\"actions-container\">\n        <button\n          class=\"reset-button\"\n          mat-icon-button\n          color=\"primary\"\n          (click)=\"resetFilter()\"\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n          [disabled]=\"filterStateDisable\"\n        >\n          <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\n        </button>\n        <mat-slide-toggle\n          class=\"toggle-filter-state\"\n          (change)=\"toggleFilterState()\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n          [checked]=\"!filterStateDisable\"\n        >\n        </mat-slide-toggle>\n      </div>\n    </div>\n  </div>\n</div>\n","import {\r\n  Component,\r\n  ElementRef,\r\n  EventEmitter,\r\n  Input,\r\n  OnInit,\r\n  Output,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { default as moment } from 'moment';\r\n\r\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\r\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\r\nimport {\r\n  OgcFilterDuringOptions,\r\n  OgcFilterableDataSource,\r\n  OgcFilterableDataSourceOptions\r\n} from '../shared/ogc-filter.interface';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-time',\r\n  templateUrl: './ogc-filter-time.component.html',\r\n  styleUrls: ['./ogc-filter-time.component.scss']\r\n})\r\nexport class OgcFilterTimeComponent implements OnInit {\r\n  @Input() datasource: OgcFilterableDataSource;\r\n  @Input() currentFilter: any;\r\n  @Output() changeProperty: EventEmitter<{\r\n    value: string;\r\n    pos: number;\r\n    refreshFilter: boolean;\r\n  }> = new EventEmitter<any>();\r\n\r\n  beginHours: number[];\r\n  endHours: number[];\r\n  beginMinutes: number[];\r\n  endMinutes: number[];\r\n  beginHourFormControl = new UntypedFormControl();\r\n  beginMinuteFormControl = new UntypedFormControl();\r\n  endHourFormControl = new UntypedFormControl();\r\n  endMinuteFormControl = new UntypedFormControl();\r\n  _beginValue: Date;\r\n  _endValue: Date;\r\n  readonly _defaultMin: string = '1900-01-01';\r\n  readonly _defaultMax: string = '2052-01-06';\r\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\r\n  readonly _defaultSliderModeEnabled: boolean = true;\r\n  ogcFilterOperator = OgcFilterOperator;\r\n  public sliderMode = false;\r\n\r\n  readonly defaultStepMillisecond = 60000;\r\n  public options: OgcFilterableDataSourceOptions;\r\n\r\n  public onlyYearBegin: number;\r\n  public onlyYearEnd: number;\r\n  public calendarTypeYear = false;\r\n  public resetIcon = 'replay';\r\n  public filterStateDisable: boolean;\r\n\r\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\r\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\r\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\r\n  @ViewChild('endTime') endTime: HTMLInputElement;\r\n\r\n  get step(): string {\r\n    return this.datasource.options.stepDate\r\n      ? this.datasource.options.stepDate\r\n      : this.currentFilter.step;\r\n  }\r\n\r\n  get stepMilliseconds(): number {\r\n    const step = moment.duration(this.step).asMilliseconds();\r\n    return step === 0 ? this.defaultStepMillisecond : step;\r\n  }\r\n\r\n  set beginValue(begin: Date) {\r\n    this._beginValue = begin;\r\n  }\r\n\r\n  get beginValue(): Date {\r\n    return this._beginValue;\r\n  }\r\n\r\n  set endValue(end: Date) {\r\n    this._endValue = end;\r\n  }\r\n\r\n  get endValue(): Date {\r\n    return this._endValue;\r\n  }\r\n\r\n  get sliderInterval(): number {\r\n    return this.currentFilter.sliderInterval === undefined\r\n      ? 2000\r\n      : this.currentFilter.sliderInterval;\r\n  }\r\n\r\n  get maxDate(): string {\r\n    return this.datasource.options.maxDate\r\n      ? this.datasource.options.maxDate\r\n      : this._defaultMax;\r\n  }\r\n\r\n  get displayFormat(): string {\r\n    return this.currentFilter.displayFormat\r\n      ? this.currentFilter.displayFormat\r\n      : this._defaultDisplayFormat;\r\n  }\r\n\r\n  public filterBeginFunction;\r\n  public filterEndFunction;\r\n\r\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\r\n\r\n  ngOnInit() {\r\n    if (this.currentFilter.sliderOptions) {\r\n      this.currentFilter.sliderOptions.enabled =\r\n        this.currentFilter.sliderOptions.enabled !== undefined\r\n          ? this.currentFilter.sliderOptions.enabled\r\n          : this._defaultSliderModeEnabled;\r\n    }\r\n    this.beginValue = this.parseFilter(this.handleMin());\r\n    this.endValue = this.parseFilter(this.handleMax());\r\n\r\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\r\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\r\n    this.calendarTypeYear = this.isCalendarYearMode();\r\n    this.setFilterStateDisable();\r\n    this.updateHoursMinutesArray();\r\n    // update value for now value\r\n    this.updateValues();\r\n    this.dateFilter(this.filterBeginFunction, 'begin');\r\n    this.dateFilter(this.filterEndFunction, 'end');\r\n  }\r\n\r\n  parseFilter(filter): Date {\r\n    if (!filter) {\r\n      return new Date();\r\n    } else if (isNaN(new Date(filter).getTime())) {\r\n      if (filter.search('now') >= 0) {\r\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\r\n        if (filter.match(/\\+/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('+') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment().add(intervalInt, interval[0]).toDate();\r\n        }\r\n        if (filter.match(/\\-/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('-') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment().subtract(intervalInt, interval[0]).toDate();\r\n        }\r\n        return new Date();\r\n      }\r\n      if (filter.search('today') >= 0) {\r\n        const _now = moment().endOf('day').toDate();\r\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\r\n        if (filter.match(/\\+/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('+') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment(_now).add(intervalInt, interval[0]).toDate();\r\n        }\r\n        if (filter.match(/\\-/)) {\r\n          const intervalInt = parseInt(\r\n            filter.substring(filter.search('-') + 1, interval.index),\r\n            10\r\n          );\r\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\r\n        }\r\n        return _now;\r\n      }\r\n      return new Date();\r\n    }\r\n    if (this.currentFilter.calendarModeYear) {\r\n      const date = this.getDateFromStringWithoutTime(filter);\r\n      return date;\r\n    } else {\r\n      return filter ? new Date(filter) : new Date();\r\n    }\r\n  }\r\n\r\n  changeTemporalProperty(value, position?, refreshFilter = true) {\r\n    let valueTmp = this.getDateTime(value, position);\r\n    if (this.isCalendarYearMode()) {\r\n      let dateStringFromYearNotime;\r\n      if (position === 1) {\r\n        this.beginValue = value;\r\n        this.onlyYearBegin = this.beginValue.getFullYear();\r\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\r\n      } else {\r\n        this.endValue = value;\r\n        this.onlyYearEnd = this.endValue.getFullYear();\r\n        dateStringFromYearNotime = `${this.onlyYearEnd}-01-01`;\r\n      }\r\n      // call service with string date without time\r\n      this.changeProperty.next({\r\n        value: dateStringFromYearNotime,\r\n        pos: position,\r\n        refreshFilter\r\n      });\r\n      return;\r\n    }\r\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\r\n      /* Above month: see yearSelected or monthSelected */\r\n      valueTmp = moment(valueTmp).endOf('day').toDate();\r\n    }\r\n\r\n    if (position === 1) {\r\n      this.beginValue = valueTmp;\r\n      if (this.restrictedToStep()) {\r\n        this.changeTemporalProperty(\r\n          this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds),\r\n          2,\r\n          refreshFilter\r\n        );\r\n      }\r\n    } else {\r\n      this.endValue = valueTmp;\r\n    }\r\n    this.updateHoursMinutesArray();\r\n    this.changeProperty.next({\r\n      value: valueTmp.toISOString(),\r\n      pos: position,\r\n      refreshFilter\r\n    });\r\n  }\r\n\r\n  handleDate(value): Date {\r\n    if (!value || value === '') {\r\n      return undefined;\r\n    }\r\n    if (typeof value === 'string' && this.currentFilter.calendarModeYear) {\r\n      return this.getDateFromStringWithoutTime(value);\r\n    }\r\n    return new Date(value);\r\n  }\r\n\r\n  calendarType() {\r\n    if (this.currentFilter.calendarModeYear) {\r\n      return 'year';\r\n    }\r\n    if (this.stepMilliseconds < 86400000) {\r\n      return 'datetime';\r\n    }\r\n    return 'date';\r\n  }\r\n\r\n  isCalendarYearMode(): boolean {\r\n    if (this.calendarType() === 'year') {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\r\n    const year = changeEvent.target.value;\r\n    const date = this.getDateFromStringWithoutTime(year);\r\n    this.yearSelected(date, datePicker, property);\r\n  }\r\n\r\n  yearSelected(\r\n    year,\r\n    datePicker?: any,\r\n    property?: string,\r\n    refreshFilter = true\r\n  ) {\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\r\n      if (datePicker) {\r\n        datePicker.close();\r\n      }\r\n      if (property === 'end') {\r\n        // change value 01 jan to 31 dec same year\r\n        year = moment(year).endOf('year').toDate();\r\n      } else if (\r\n        property === 'begin' &&\r\n        this.restrictedToStep() &&\r\n        !this.calendarTypeYear\r\n      ) {\r\n        this.yearSelected(year, undefined, 'end');\r\n      }\r\n      this.changeTemporalProperty(\r\n        year,\r\n        property === 'begin' ? 1 : 2,\r\n        refreshFilter\r\n      );\r\n    }\r\n  }\r\n\r\n  monthSelected(\r\n    month,\r\n    datePicker?: any,\r\n    property?: string,\r\n    refreshFilter = true\r\n  ) {\r\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\r\n      if (datePicker) {\r\n        datePicker.close();\r\n      }\r\n      if (property === 'end') {\r\n        month = moment(month).endOf('month').toDate();\r\n      } else if (property === 'begin' && this.restrictedToStep()) {\r\n        this.monthSelected(month, undefined, 'end');\r\n      }\r\n      this.changeTemporalProperty(\r\n        month,\r\n        property === 'begin' ? 1 : 2,\r\n        refreshFilter\r\n      );\r\n    }\r\n  }\r\n\r\n  calendarView() {\r\n    const test = this.stepMilliseconds;\r\n    const diff = Math.abs(\r\n      this.parseFilter(this.currentFilter.end).getTime() -\r\n        this.parseFilter(this.currentFilter.begin).getTime()\r\n    );\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\r\n      return 'multi-year';\r\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\r\n      return 'year';\r\n    } else if (test < 86400000 && diff < 86400000) {\r\n      return 'clock';\r\n    } else {\r\n      return 'month';\r\n    }\r\n  }\r\n\r\n  dateFilter(type: string, date: string) {\r\n    const dateValue = new Date(date);\r\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\r\n\r\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\r\n      const monthDiff = moment(dateValue).diff(\r\n        moment(this.handleMin()),\r\n        'years',\r\n        true\r\n      );\r\n      if (type === 'end') {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\r\n          moment(this.handleMin()),\r\n          'years',\r\n          true\r\n        );\r\n        this.filterEndFunction =\r\n          monthDiffPlus1 % moment.duration(this.step).asYears() === 0;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        this.filterBeginFunction =\r\n          monthDiff % moment.duration(this.step).asYears() === 0;\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\r\n      const monthDiff = moment(dateValue).diff(\r\n        moment(this.handleMin()),\r\n        'months',\r\n        true\r\n      );\r\n      if (type === 'end') {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\r\n          moment(this.handleMin()),\r\n          'months',\r\n          true\r\n        );\r\n        this.filterEndFunction =\r\n          monthDiffPlus1 % moment.duration(this.step).asMonths() === 0;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        this.filterBeginFunction =\r\n          monthDiff % moment.duration(this.step).asMonths() === 0;\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\r\n      const weekDiff = moment(dateValue).diff(\r\n        moment(this.handleMin()),\r\n        'weeks',\r\n        true\r\n      );\r\n      if (type === 'end') {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(\r\n          moment(this.handleMin()),\r\n          'weeks',\r\n          true\r\n        );\r\n        this.filterEndFunction =\r\n          weekDiffPlus1 % moment.duration(this.step).asWeeks() === 0;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        this.filterBeginFunction =\r\n          weekDiff % moment.duration(this.step).asWeeks() === 0;\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\r\n      const dayDiff = moment(dateValue).diff(\r\n        moment(this.handleMin()),\r\n        'days',\r\n        true\r\n      );\r\n      if (type === 'end') {\r\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\r\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(\r\n          moment(this.handleMin()),\r\n          'days',\r\n          true\r\n        );\r\n        const _mod = dayDiffPlus1 % moment.duration(this.step).asDays();\r\n        this.filterEndFunction =\r\n          (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0; // 1 millisecond = 1.1574074074074076e-8\r\n        return;\r\n      } else if (type === 'begin') {\r\n        const _mod = (dayDiff % moment.duration(this.step).asDays()) + 1;\r\n        this.filterBeginFunction =\r\n          (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1; // 1 millisecond = 1.1574074074074076e-8\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\r\n      if (type === 'end') {\r\n        const hourDiff = moment(dateValue).diff(\r\n          moment(this.handleMin()),\r\n          'hours',\r\n          true\r\n        );\r\n        this.filterEndFunction =\r\n          hourDiff % moment.duration(this.step).asHours() === 0;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        const hourDiff = moment(dateValue).diff(\r\n          moment(this.handleMin()),\r\n          'hours',\r\n          true\r\n        );\r\n        this.filterBeginFunction =\r\n          hourDiff % moment.duration(this.step).asHours() === 0;\r\n        return;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\r\n      if (type === 'end') {\r\n        this.filterEndFunction = true;\r\n        return;\r\n      } else if (type === 'begin') {\r\n        this.filterBeginFunction = true;\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.filterEndFunction = diff % this.stepMilliseconds === 0;\r\n    this.filterBeginFunction = diff % this.stepMilliseconds === 0;\r\n    return;\r\n  }\r\n\r\n  getDateTime(date, pos) {\r\n    const valuetmp = new Date(date);\r\n    let valuetmp2;\r\n    if (!this.sliderMode) {\r\n      switch (pos) {\r\n        case 1: {\r\n          if (this.currentFilter.calendarModeYear) {\r\n            valuetmp2 = valuetmp.setHours(0, 0);\r\n            break;\r\n          } else {\r\n            valuetmp2 = valuetmp.setHours(\r\n              this.beginHourFormControl.value,\r\n              this.beginMinuteFormControl.value\r\n            );\r\n            break;\r\n          }\r\n        }\r\n        case 2: {\r\n          if (this.currentFilter.calendarModeYear) {\r\n            valuetmp2 = valuetmp.setHours(0, 0);\r\n            break;\r\n          } else {\r\n            valuetmp2 = valuetmp.setHours(\r\n              this.endHourFormControl.value,\r\n              this.endMinuteFormControl.value\r\n            );\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\r\n  }\r\n\r\n  handleMinuteIncrement() {\r\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\r\n      if (this.stepMilliseconds < 3600000) {\r\n        return this.stepMilliseconds / 1000 === 60\r\n          ? 1\r\n          : this.stepMilliseconds / 1000;\r\n      } else {\r\n        return (this.stepMilliseconds % 3600000) / 60;\r\n      }\r\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\r\n      return 60;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  handleHourIncrement() {\r\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\r\n      return this.stepMilliseconds / 1000 / 60 / 60;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  fullBeginHoursArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.beginHours = Array.from(\r\n        {\r\n          length:\r\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\r\n        },\r\n        (_, i) => 0 + i * this.handleHourIncrement()\r\n      );\r\n    } else {\r\n      this.beginHours = Array.from(\r\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleHourIncrement()\r\n      );\r\n    }\r\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\r\n  }\r\n\r\n  fullEndHoursArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.endHours = Array.from(\r\n        {\r\n          length:\r\n            (23 - this.beginHourFormControl.value) /\r\n              this.handleHourIncrement() +\r\n            1\r\n        },\r\n        (_, i) =>\r\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\r\n      );\r\n    } else {\r\n      this.endHours = Array.from(\r\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleHourIncrement()\r\n      );\r\n    }\r\n    this.endHourFormControl.setValue(this.endValue.getHours());\r\n  }\r\n\r\n  fullBeginMinutesArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.beginMinutes = Array.from(\r\n        {\r\n          length:\r\n            (this.endMinuteFormControl.value - 0) /\r\n              this.handleMinuteIncrement() +\r\n            1\r\n        },\r\n        (_, i) => 0 + i * this.handleMinuteIncrement()\r\n      );\r\n    } else {\r\n      this.beginMinutes = Array.from(\r\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleMinuteIncrement()\r\n      );\r\n    }\r\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\r\n  }\r\n\r\n  fullEndMinutesArray(checkEndValue?) {\r\n    if (checkEndValue) {\r\n      this.endMinutes = Array.from(\r\n        {\r\n          length:\r\n            (59 - this.beginMinuteFormControl.value) /\r\n              this.handleMinuteIncrement() +\r\n            1\r\n        },\r\n        (_, i) =>\r\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\r\n      );\r\n    } else {\r\n      this.endMinutes = Array.from(\r\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\r\n        (_, i) => 0 + i * this.handleMinuteIncrement()\r\n      );\r\n    }\r\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\r\n  }\r\n\r\n  updateHoursMinutesArray() {\r\n    const beginTmp = new Date(this.beginValue);\r\n    const endTmp = new Date(this.endValue);\r\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\r\n      this.fullBeginHoursArray(true);\r\n      this.fullEndHoursArray(true);\r\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\r\n        this.fullBeginMinutesArray(true);\r\n        this.fullEndMinutesArray(true);\r\n      }\r\n    } else {\r\n      this.fullBeginHoursArray();\r\n      this.fullEndHoursArray();\r\n      this.fullBeginMinutesArray();\r\n      this.fullEndMinutesArray();\r\n    }\r\n  }\r\n\r\n  private updateValues() {\r\n    this.changeTemporalProperty(this.beginValue, 1, false);\r\n    this.changeTemporalProperty(this.endValue, 2, true);\r\n  }\r\n\r\n  public restrictedToStep(): boolean {\r\n    return this.currentFilter.restrictToStep\r\n      ? this.currentFilter.restrictToStep\r\n      : false;\r\n  }\r\n\r\n  public handleMin() {\r\n    return this.currentFilter.begin\r\n      ? this.currentFilter.begin\r\n      : this.datasource.options.minDate\r\n      ? this.datasource.options.minDate\r\n      : this._defaultMin;\r\n  }\r\n\r\n  public handleMax() {\r\n    return this.currentFilter.end\r\n      ? this.currentFilter.end\r\n      : this.datasource.options.maxDate\r\n      ? this.datasource.options.maxDate\r\n      : this._defaultMax;\r\n  }\r\n\r\n  changePropertyByPass(event) {\r\n    this.changeProperty.next(event);\r\n  }\r\n\r\n  modeChange(event) {\r\n    if (!event.checked) {\r\n      this.updateValues();\r\n    }\r\n  }\r\n\r\n  setFilterStateDisable() {\r\n    if (this.currentFilter) {\r\n      this.filterStateDisable = !this.currentFilter.active;\r\n    } else {\r\n      this.filterStateDisable = false;\r\n    }\r\n    if (this.calendarType() === 'datetime') {\r\n      if (this.filterStateDisable === true) {\r\n        this.beginHourFormControl.disable();\r\n        this.beginMinuteFormControl.disable();\r\n        this.endHourFormControl.disable();\r\n        this.endMinuteFormControl.disable();\r\n      } else {\r\n        this.beginHourFormControl.enable();\r\n        this.beginMinuteFormControl.enable();\r\n        this.endHourFormControl.enable();\r\n        this.endMinuteFormControl.enable();\r\n      }\r\n    }\r\n  }\r\n  getDateFromStringWithoutTime(stringDate: string): Date {\r\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\r\n    // exemple:\r\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de lEst nord-amricain)\r\n    // to create same date as string, add time 00 in the creation\r\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de lEst nord-amricain)\r\n    let year;\r\n    let month = '01';\r\n    let day = '01';\r\n    if (stringDate.length === 10) {\r\n      const dateItems = stringDate.split('-');\r\n      if (dateItems.length !== 3) {\r\n        throw new Error(\r\n          'Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY'\r\n        );\r\n      } else {\r\n        year = dateItems[0];\r\n        month = dateItems[1];\r\n        day = dateItems[2];\r\n      }\r\n    } else if (stringDate.length === 4) {\r\n      year = stringDate;\r\n    } else {\r\n      return new Date(stringDate);\r\n    }\r\n    return new Date(`${year}-${month}-${day} 00:00:00`);\r\n  }\r\n\r\n  resetFilter() {\r\n    let filterOriginConfig = this.datasource.options.ogcFilters\r\n      .filters as OgcFilterDuringOptions;\r\n\r\n    let minDefaultDate;\r\n    let maxDefaultDate;\r\n    let minDefaultISOString;\r\n    let maxDefaultISOString;\r\n\r\n    if (this.calendarTypeYear) {\r\n      if (filterOriginConfig.end === 'today') {\r\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\r\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0, 4)}-01-01`;\r\n      } else {\r\n        maxDefaultISOString = `${filterOriginConfig.end.substring(0, 4)}-01-01`;\r\n      }\r\n      minDefaultISOString = `${filterOriginConfig.begin.substring(0, 4)}-01-01`;\r\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\r\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\r\n    } else {\r\n      minDefaultDate = this.parseFilter(filterOriginConfig.begin);\r\n      maxDefaultDate = this.parseFilter(filterOriginConfig.end);\r\n      minDefaultISOString = minDefaultDate.toISOString();\r\n      maxDefaultISOString = maxDefaultDate.toISOString();\r\n    }\r\n\r\n    if (\r\n      this.currentFilter.begin !== minDefaultISOString ||\r\n      this.currentFilter.end !== maxDefaultISOString\r\n    ) {\r\n      this.beginValue = minDefaultDate;\r\n      this.endValue = maxDefaultDate;\r\n      this.updateValues();\r\n    }\r\n  }\r\n\r\n  toggleFilterState() {\r\n    if (this.currentFilter.active === true) {\r\n      this.currentFilter.active = false;\r\n    } else {\r\n      this.currentFilter.active = true;\r\n    }\r\n    this.setFilterStateDisable();\r\n    this.updateValues();\r\n  }\r\n}\r\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\"\n>\n</igo-ogc-filter-selection>\n\n<ng-template\n  *ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\n  ngFor\n  let-currentFilter\n  [ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\"\n>\n  <igo-ogc-filter-form\n    [currentFilter]=\"currentFilter\"\n    [refreshFilters]=\"refreshFunc\"\n    [datasource]=\"datasource\"\n    [map]=\"map\"\n  >\n  </igo-ogc-filter-form>\n</ng-template>\n","import { Component, Input } from '@angular/core';\r\nimport { MAT_AUTOCOMPLETE_DEFAULT_OPTIONS } from '@angular/material/autocomplete';\r\nimport { MAT_SELECT_CONFIG } from '@angular/material/select';\r\n\r\nimport { IgoMap } from '../../map/shared';\r\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-form',\r\n  templateUrl: './ogc-filterable-form.component.html',\r\n  styles: ['::ng-deep.igo-overlay-panel-width { min-width: fit-content;}'],\r\n  providers: [\r\n    {\r\n      provide: MAT_SELECT_CONFIG,\r\n      useValue: { overlayPanelClass: 'igo-overlay-panel-width' }\r\n    },\r\n    {\r\n      provide: MAT_AUTOCOMPLETE_DEFAULT_OPTIONS,\r\n      useValue: { overlayPanelClass: 'igo-overlay-panel-width' }\r\n    }\r\n  ]\r\n})\r\nexport class OgcFilterableFormComponent {\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  get refreshFunc() {\r\n    return this.refreshFilters;\r\n  }\r\n\r\n  get advancedOgcFilters(): boolean {\r\n    if (this.datasource.options.ogcFilters) {\r\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\r\n    }\r\n    return;\r\n  }\r\n\r\n  get currentFilter(): any {\r\n    return this.datasource.options.ogcFilters.interfaceOgcFilters\r\n      ? this.datasource.options.ogcFilters.interfaceOgcFilters[0]\r\n      : undefined;\r\n  }\r\n\r\n  public color = 'primary';\r\n\r\n  constructor() {}\r\n}\r\n","<div [ngClass]=\"{ 'separate-item': header === true }\">\n  <mat-list-item>\n    <mat-icon\n      *ngIf=\"header\"\n      class=\"igo-chevron\"\n      matListItemIcon\n      igoCollapse\n      [target]=\"ogcFilters\"\n      [collapsed]=\"filtersCollapsed\"\n      (click)=\"toggleFiltersCollapsed()\"\n      svgIcon=\"chevron-up\"\n    >\n    </mat-icon>\n    <span\n      *ngIf=\"header\"\n      matListItemTitle\n      [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\n      [matTooltip]=\"layer.title\"\n      matTooltipShowDelay=\"500\"\n      (click)=\"toggleLegendOnClick()\"\n    >\n      {{ layer.title }}\n    </span>\n    <div matListItemMeta>\n      <button\n        *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\"\n        [disabled]=\"addFilterDisabled()\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.addFilter' | translate\"\n        [color]=\"color\"\n        (click)=\"addFilterToSequence()\"\n      >\n        <mat-icon svgIcon=\"plus\"></mat-icon>\n      </button>\n      <button\n        *ngIf=\"header\"\n        mat-icon-button\n        [color]=\"layer.visible ? 'primary' : 'default'\"\n        collapsibleButton\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"\n          layer.visible\n            ? ('igo.geo.layer.hideLayer' | translate)\n            : ('igo.geo.layer.showLayer' | translate)\n        \"\n        (click)=\"layer.visible = !layer.visible\"\n      >\n        <mat-icon\n          [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n          [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\"\n        >\n        </mat-icon>\n      </button>\n    </div>\n  </mat-list-item>\n\n  <div #ogcFilters>\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n      </igo-layer-legend>\n    </div>\n    <igo-ogc-filterable-form\n      [datasource]=\"datasource\"\n      [map]=\"map\"\n      [refreshFilters]=\"refreshFunc\"\n    >\n    </igo-ogc-filterable-form>\n\n    <section\n      *ngIf=\"hasSelector && filtersAreEditable\"\n      class=\"mat-typography advancedOgcFilters\"\n    >\n      <mat-divider></mat-divider>\n      <mat-checkbox\n        (change)=\"changeOgcFilterType($event)\"\n        [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\"\n      >\n        {{ 'igo.geo.filter.advancedOgcFilters' | translate }}\n      </mat-checkbox>\n    </section>\n  </div>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { OgcFilterWriter } from '../shared/ogc-filter';\r\nimport {\r\n  OgcFilterableDataSource,\r\n  OgcFiltersOptions,\r\n  OgcInterfaceFilterOptions\r\n} from '../shared/ogc-filter.interface';\r\nimport { OGCFilterService } from '../shared/ogc-filter.service';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-item',\r\n  templateUrl: './ogc-filterable-item.component.html',\r\n  styleUrls: ['./ogc-filterable-item.component.scss']\r\n})\r\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\r\n  public color = 'primary';\r\n  private lastRunOgcFilter;\r\n  private defaultLogicalParent = OgcFilterOperator.And;\r\n  public hasActiveSpatialFilter = false;\r\n  public filtersAreEditable = true;\r\n  public filtersCollapsed = true;\r\n  public hasSelector: boolean = false;\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  private resolution$$: Subscription;\r\n  private ogcFilterWriter;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  get refreshFunc() {\r\n    return this.refreshFilters.bind(this);\r\n  }\r\n\r\n  get datasource(): OgcFilterableDataSource {\r\n    return this.layer.dataSource as OgcFilterableDataSource;\r\n  }\r\n\r\n  constructor(private ogcFilterService: OGCFilterService) {\r\n    this.ogcFilterWriter = new OgcFilterWriter();\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.layer.visible) {\r\n      this.filtersCollapsed = false;\r\n    }\r\n\r\n    const ogcFilters = this.datasource.options.ogcFilters;\r\n    if (\r\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\r\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\r\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\r\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0) ||\r\n      (ogcFilters.autocomplete && ogcFilters.autocomplete.bundles.length > 0)\r\n    ) {\r\n      if (ogcFilters.advancedOgcFilters === undefined) {\r\n        ogcFilters.advancedOgcFilters = false;\r\n      }\r\n      this.hasSelector = true;\r\n    }\r\n\r\n    switch (this.datasource.options.type) {\r\n      case 'wms':\r\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\r\n        break;\r\n      case 'wfs':\r\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (ogcFilters) {\r\n      if (ogcFilters.interfaceOgcFilters) {\r\n        this.lastRunOgcFilter = JSON.parse(\r\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\r\n        );\r\n        if (\r\n          ogcFilters.interfaceOgcFilters.filter((f) => f.wkt_geometry).length >=\r\n          1\r\n        ) {\r\n          this.hasActiveSpatialFilter = true;\r\n        }\r\n      }\r\n\r\n      this.filtersAreEditable = ogcFilters.editable\r\n        ? ogcFilters.editable\r\n        : false;\r\n    }\r\n\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.resolution$$.unsubscribe();\r\n  }\r\n\r\n  addFilterToSequence() {\r\n    this.filtersCollapsed = false;\r\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] =\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters;\r\n    const arr = interfaceOgcFilters || [];\r\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\r\n    let firstFieldName = '';\r\n    const includedFields = this.datasource.options.sourceFields.filter(\r\n      (f) => !f.excludeFromOgcFilters\r\n    );\r\n    if (includedFields.length > 0) {\r\n      firstFieldName =\r\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\r\n    }\r\n    let fieldNameGeometry;\r\n    const datasourceOptions = this.datasource\r\n      .options as WFSDataSourceOptionsParams;\r\n    if (datasourceOptions.fieldNameGeometry) {\r\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\r\n    } else if (\r\n      (this.datasource.options as any).paramsWFS &&\r\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\r\n    ) {\r\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\r\n        .fieldNameGeometry;\r\n    }\r\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\r\n      this.datasource.options.sourceFields,\r\n      firstFieldName,\r\n      this.datasource.options.ogcFilters.allowedOperatorsType\r\n    );\r\n    const firstOperatorName = Object.keys(allowedOperators)[0];\r\n\r\n    arr.push(\r\n      this.ogcFilterWriter.addInterfaceFilter(\r\n        {\r\n          propertyName: firstFieldName,\r\n          operator: firstOperatorName,\r\n          active: true,\r\n          igoSpatialSelector: 'fixedExtent',\r\n          srsName: this.map.projection\r\n        } as OgcInterfaceFilterOptions,\r\n        fieldNameGeometry,\r\n        lastLevel,\r\n        this.defaultLogicalParent\r\n      )\r\n    );\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\r\n  }\r\n\r\n  refreshFilters(force?: boolean) {\r\n    if (force === true) {\r\n      this.lastRunOgcFilter = undefined;\r\n    }\r\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\r\n    const activeFilters = ogcFilters.interfaceOgcFilters\r\n      ? ogcFilters.interfaceOgcFilters.filter((f) => f.active === true)\r\n      : [];\r\n    if (activeFilters.length === 0) {\r\n      ogcFilters.filters = undefined;\r\n      ogcFilters.filtered = false;\r\n    }\r\n    if (activeFilters.length > 1) {\r\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\r\n    }\r\n    if (\r\n      activeFilters.filter(\r\n        (af) => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\r\n      ).length === 0\r\n    ) {\r\n      this.hasActiveSpatialFilter = false;\r\n    } else {\r\n      this.hasActiveSpatialFilter = true;\r\n    }\r\n\r\n    if (\r\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\r\n    ) {\r\n      if (this.layer.dataSource.options.type === 'wfs') {\r\n        const ogcDataSource: any = this.layer.dataSource;\r\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\r\n        ogcLayer.filters =\r\n          this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\r\n            activeFilters\r\n          );\r\n        this.layer.dataSource.ol.refresh();\r\n      } else if (\r\n        this.layer.dataSource.options.type === 'wms' &&\r\n        ogcFilters.enabled\r\n      ) {\r\n        let rebuildFilter = '';\r\n        if (activeFilters.length >= 1) {\r\n          const ogcDataSource: any = this.layer.dataSource;\r\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\r\n          ogcLayer.filters =\r\n            this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\r\n              activeFilters\r\n            );\r\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\r\n            ogcLayer.filters,\r\n            undefined,\r\n            undefined,\r\n            (this.layer.dataSource.options as any).fieldNameGeometry,\r\n            ogcDataSource.options\r\n          );\r\n        }\r\n        this.ogcFilterService.filterByOgc(\r\n          this.datasource as WMSDataSource,\r\n          rebuildFilter\r\n        );\r\n        this.datasource.options.ogcFilters.filtered =\r\n          activeFilters.length === 0 ? false : true;\r\n      }\r\n\r\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\r\n    } else {\r\n      // identical filter. Nothing triggered\r\n    }\r\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(\r\n      ogcFilters,\r\n      true\r\n    );\r\n  }\r\n\r\n  public setVisible() {\r\n    this.layer.visible = true;\r\n  }\r\n\r\n  public isAdvancedOgcFilters(): boolean {\r\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\r\n  }\r\n\r\n  public addFilterDisabled(): boolean {\r\n    return (\r\n      !this.datasource.options.sourceFields ||\r\n      this.datasource.options.sourceFields.length === 0\r\n    );\r\n  }\r\n\r\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\r\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\r\n  }\r\n\r\n  changeOgcFilterType(isAdvancedOgcFilters) {\r\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\r\n    if (isAdvancedOgcFilters.checked) {\r\n      this.refreshFilters(true);\r\n    }\r\n  }\r\n\r\n  private toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    if (!this.filtersCollapsed) {\r\n      this.toggleLegend(this.showLegend$.value);\r\n    }\r\n  }\r\n\r\n  toggleFiltersCollapsed() {\r\n    this.filtersCollapsed = !this.filtersCollapsed;\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <div\n    id=\"no-layer-message\"\n    *ngIf=\"(layers | filterableDataSource: 'ogc').length === 0\"\n  >\n    {{ 'igo.geo.filter.noFilterableLayer' | translate }}\n  </div>\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item\n      igoListItem\n      [header]=\"true\"\n      [layer]=\"layer\"\n      [map]=\"layer.map\"\n    ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-list',\r\n  templateUrl: './ogc-filterable-list.component.html',\r\n  styleUrls: ['./ogc-filterable-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterableListComponent {\r\n  @Input() layers: Layer[];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  constructor() {}\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { TimeFilterableDataSource } from '../../datasource';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\r\n\r\n@Pipe({\r\n  name: 'filterableDataSource'\r\n})\r\nexport class FilterableDataSourcePipe implements PipeTransform {\r\n  transform(value: Layer[], arg: string): Layer[] {\r\n    let layers;\r\n\r\n    if (arg === 'time') {\r\n      layers = value.filter((layer: Layer) => {\r\n        const datasource = layer.dataSource as TimeFilterableDataSource;\r\n        return (\r\n          this.isTimeFilterable(datasource) &&\r\n          datasource.options.timeFilter !== undefined &&\r\n          Object.keys(datasource.options.timeFilter).length\r\n        );\r\n      });\r\n    }\r\n    if (arg === 'ogc') {\r\n      layers = value.filter((layer: Layer) => {\r\n        const datasource = layer.dataSource as OgcFilterableDataSource;\r\n        return this.isOgcFilterable(datasource);\r\n      });\r\n    }\r\n    return layers;\r\n  }\r\n\r\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\r\n    if (dataSource.options.type !== 'wms') {\r\n      return false;\r\n    }\r\n    return dataSource.options.timeFilterable;\r\n  }\r\n\r\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\r\n    let isOgcFilterable = false;\r\n    if (\r\n      dataSource.options.ogcFilters &&\r\n      dataSource.options.ogcFilters.enabled &&\r\n      dataSource.options.ogcFilters.editable\r\n    ) {\r\n      isOgcFilterable = true;\r\n    }\r\n    if (\r\n      dataSource.options.ogcFilters &&\r\n      dataSource.options.ogcFilters.enabled &&\r\n      (dataSource.options.ogcFilters.pushButtons ||\r\n        dataSource.options.ogcFilters.checkboxes ||\r\n        dataSource.options.ogcFilters.radioButtons ||\r\n        dataSource.options.ogcFilters.select ||\r\n        dataSource.options.ogcFilters.autocomplete)\r\n    ) {\r\n      isOgcFilterable = true;\r\n    }\r\n    return isOgcFilterable;\r\n  }\r\n}\r\n","export enum SpatialFilterQueryType {\n  AdmRegion = 'AdmRegion',\n  Mun = 'Mun',\n  Arrond = 'Arrond',\n  CircFed = 'CircFed',\n  CircProv = 'CircProv',\n  DirReg = 'DirReg',\n  MRC = 'MRC',\n  RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n  Predefined = 'Predefined',\n  Polygon = 'Polygon',\n  Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n  Address = 'Address',\n  Thematics = 'Thematics'\n}\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { Feature } from '../../feature/shared';\r\nimport {\r\n  SpatialFilterItemType,\r\n  SpatialFilterQueryType,\r\n  SpatialFilterType\r\n} from './spatial-filter.enum';\r\nimport { SpatialFilterThematic } from './spatial-filter.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SpatialFilterService {\r\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\r\n\r\n  /*\r\n   * Type association with URL\r\n   */\r\n  public urlFilterList = {\r\n    AdmRegion: 'regadmin',\r\n    Arrond: 'arrondissements',\r\n    CircFed: 'circ-fed',\r\n    CircProv: 'circ-prov',\r\n    DirReg: 'dir-reg',\r\n    MRC: 'mrc',\r\n    Mun: 'municipalites',\r\n    RegTour: 'tourisme',\r\n    bornes: 'bornes-sumi',\r\n    hydro: 'hydro',\r\n    routes: 'routes'\r\n  };\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    private configService: ConfigService\r\n  ) {\r\n    this.baseUrl =\r\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\r\n  }\r\n\r\n  getKeyByValue(object, value) {\r\n    return Object.keys(object).find((key) => object[key] === value);\r\n  }\r\n\r\n  /*\r\n   * Loading data for spatial filter list component (NO GEOMETRY)\r\n   */\r\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\r\n    const urlPath = type as string;\r\n    if (urlPath) {\r\n      return this.http\r\n        .get<{ features: Feature[] }>(\r\n          this.baseUrl + this.urlFilterList[urlPath]\r\n        )\r\n        .pipe(\r\n          map((featureCollection) =>\r\n            featureCollection.features.map((f) => {\r\n              f.meta = {\r\n                id: f.properties.code\r\n              };\r\n              return f;\r\n            })\r\n          )\r\n        );\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Loading item list (STRING)\r\n   */\r\n  loadThematicsList() {\r\n    const url = 'types';\r\n    const items: SpatialFilterThematic[] = [];\r\n    return this.http.get(this.baseUrl + url).pipe(\r\n      map((types: string[]) => {\r\n        types.forEach((type) => {\r\n          if (type.startsWith('lieux')) {\r\n            const item: SpatialFilterThematic = {\r\n              name: undefined,\r\n              source: type\r\n            };\r\n            let substr = type.substring(6, type.length);\r\n            let name = substr;\r\n            if (substr.includes('.')) {\r\n              const index = substr.indexOf('.');\r\n              name = substr.substring(index + 1, substr.length);\r\n              substr = substr.substring(0, index);\r\n            }\r\n            try {\r\n              item.name = this.languageService.translate.instant(\r\n                'igo.geo.terrapi.' + name\r\n              );\r\n            } catch (e) {\r\n              item.name =\r\n                name.substring(0, 1).toUpperCase() +\r\n                name.substring(1, name.length - 1);\r\n            }\r\n\r\n            try {\r\n              item.group = this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.group.' + substr\r\n              );\r\n            } catch (e) {\r\n              item.group =\r\n                substr.substring(0, 1).toUpperCase() +\r\n                substr.substring(1, name.length - 1);\r\n            }\r\n\r\n            items.push(item);\r\n          } else {\r\n            if (this.getKeyByValue(this.urlFilterList, type)) {\r\n              const item: SpatialFilterThematic = {\r\n                name: undefined,\r\n                source: type\r\n              };\r\n              const name = this.getKeyByValue(this.urlFilterList, type);\r\n              try {\r\n                item.name = this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.' + name\r\n                );\r\n              } catch (e) {\r\n                item.name =\r\n                  name.substring(0, 1).toUpperCase() +\r\n                  name.substring(1, name.length - 1);\r\n              }\r\n              item.source = type;\r\n\r\n              items.push(item);\r\n            }\r\n          }\r\n        });\r\n        return items;\r\n      })\r\n    );\r\n  }\r\n\r\n  /*\r\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\r\n   */\r\n  loadFilterItem(\r\n    feature,\r\n    itemType: SpatialFilterItemType,\r\n    type?: SpatialFilterQueryType,\r\n    thematic?: SpatialFilterThematic,\r\n    buffer?: number\r\n  ) {\r\n    if (type) {\r\n      // Predefined type\r\n      const urlType = type as string;\r\n      const url = this.baseUrl + this.urlFilterList[urlType];\r\n      let urlItem = '';\r\n      if (itemType === SpatialFilterItemType.Address) {\r\n        urlItem = 'adresses';\r\n        return this.http\r\n          .get<{ features: Feature[] }>(\r\n            url + '/' + feature.properties.code + '/' + urlItem,\r\n            {\r\n              params: {\r\n                geometry: 'true',\r\n                icon: 'true',\r\n                bufferInput: buffer.toString(),\r\n                simplified: '100'\r\n              }\r\n            }\r\n          )\r\n          .pipe(\r\n            map((featureCollection) =>\r\n              featureCollection.features.map((f) => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: this.languageService.translate.instant(\r\n                    'igo.geo.spatialFilter.Address'\r\n                  ),\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      } else {\r\n        // If thematics search\r\n        urlItem = thematic.source;\r\n        return this.http\r\n          .get<{ features: Feature[] }>(\r\n            url + '/' + feature.properties.code + '/' + urlItem,\r\n            {\r\n              params: {\r\n                geometry: 'true',\r\n                icon: 'true',\r\n                bufferInput: buffer.toString(),\r\n                simplified: '100'\r\n              }\r\n            }\r\n          )\r\n          .pipe(\r\n            map((featureCollection) =>\r\n              featureCollection.features.map((f) => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: thematic.name,\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      }\r\n    } else {\r\n      // Draw type\r\n      const url = this.baseUrl + 'locate';\r\n      if (itemType === SpatialFilterItemType.Address) {\r\n        const urlItem = '?type=adresses';\r\n        return this.http\r\n          .post<{ features: Feature[] }>(url + urlItem, {\r\n            geometry: 'true',\r\n            icon: 'true',\r\n            loc: JSON.stringify(feature),\r\n            bufferInput: buffer.toString(),\r\n            simplified: '100'\r\n          })\r\n          .pipe(\r\n            map((featureCollection) =>\r\n              featureCollection.features.map((f) => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: this.languageService.translate.instant(\r\n                    'igo.geo.spatialFilter.Address'\r\n                  ),\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      } else {\r\n        // If thematics search\r\n        const urlItem = '?type=' + thematic.source;\r\n        return this.http\r\n          .post<{ features: Feature[] }>(url + urlItem, {\r\n            geometry: 'true',\r\n            icon: 'true',\r\n            loc: JSON.stringify(feature),\r\n            bufferInput: buffer.toString(),\r\n            simplified: '100'\r\n          })\r\n          .pipe(\r\n            map((featureCollection) =>\r\n              featureCollection.features.map((f) => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: thematic.name,\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get one territory by id (WITH GEOMETRY)\r\n   */\r\n  loadItemById(\r\n    feature: Feature,\r\n    type: SpatialFilterQueryType\r\n  ): Observable<Feature> {\r\n    const featureType = this.urlFilterList[type];\r\n    const featureCode = '/' + feature.properties.code;\r\n    if (featureType && featureCode) {\r\n      return this.http\r\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\r\n          params: {\r\n            geometry: 'true'\r\n          }\r\n        })\r\n        .pipe(\r\n          map((f) => {\r\n            f.meta = {\r\n              id: f.properties.code,\r\n              alias: f.properties.nom,\r\n              title: f.properties.nom\r\n            };\r\n            return f;\r\n          })\r\n        );\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get buffer geometry\r\n   */\r\n  loadBufferGeometry(\r\n    feature: Feature,\r\n    filterType: SpatialFilterType,\r\n    buffer?: number,\r\n    type?: SpatialFilterQueryType\r\n  ): Observable<Feature> {\r\n    if (filterType === SpatialFilterType.Predefined) {\r\n      const featureType = this.urlFilterList[type];\r\n      const featureCode = '/' + feature.properties.code;\r\n      if (featureType && featureCode) {\r\n        return this.http\r\n          .get<Feature>(this.baseUrl + featureType + featureCode, {\r\n            params: {\r\n              geometry: '100',\r\n              bufferOutput: buffer.toString()\r\n            }\r\n          })\r\n          .pipe(\r\n            map((f) => {\r\n              f.meta = {\r\n                id: f.properties.code,\r\n                alias: f.properties.nom,\r\n                title: f.properties.nom\r\n              };\r\n              return f;\r\n            })\r\n          );\r\n      }\r\n    } else {\r\n      return this.http\r\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\r\n          buffer,\r\n          loc: JSON.stringify(feature)\r\n        })\r\n        .pipe(\r\n          map((f) => {\r\n            return f;\r\n          })\r\n        );\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\n\r\n@Injectable()\r\nexport class TimeFilterService {\r\n  constructor() {}\r\n\r\n  filterByDate(\r\n    datasource: WMSDataSource | TileArcGISRestDataSource,\r\n    date: Date | [Date, Date]\r\n  ) {\r\n    let time;\r\n    let newdateform;\r\n    let newdateformStart;\r\n    let newdateformEnd;\r\n\r\n    if (Array.isArray(date)) {\r\n      const dates = [];\r\n      if (date[0]) {\r\n        newdateformStart = this.reformatDateTime(date[0]);\r\n        dates.push(date[0]);\r\n      }\r\n      if (date[1]) {\r\n        newdateformEnd = this.reformatDateTime(date[1]);\r\n        dates.push(date[1]);\r\n      }\r\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\r\n        if (datasource instanceof TileArcGISRestDataSource) {\r\n          time = newdateformStart + ',' + newdateformEnd;\r\n        } else {\r\n          time = newdateformStart + '/' + newdateformEnd;\r\n        }\r\n      }\r\n      if (newdateformStart === newdateformEnd) {\r\n        time = newdateformStart;\r\n      }\r\n    } else if (date) {\r\n      newdateform = this.reformatDateTime(date);\r\n      time = newdateform;\r\n    }\r\n\r\n    const params = { TIME: time };\r\n    datasource.ol.updateParams(params);\r\n    if (datasource instanceof WMSDataSource) {\r\n      const wmsDataSource = datasource as WMSDataSource;\r\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\r\n    }\r\n  }\r\n\r\n  filterByYear(\r\n    datasource: WMSDataSource | TileArcGISRestDataSource,\r\n    year: string | [string, string]\r\n  ) {\r\n    let time;\r\n    let newdateformStart;\r\n    let newdateformEnd;\r\n\r\n    if (Array.isArray(year)) {\r\n      const years = [];\r\n      if (year[0]) {\r\n        newdateformStart = year[0];\r\n        years.push(year[0]);\r\n      }\r\n      if (year[1]) {\r\n        newdateformEnd = year[1];\r\n        years.push(year[1]);\r\n      }\r\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\r\n        if (datasource instanceof TileArcGISRestDataSource) {\r\n          time = newdateformStart + ',' + newdateformEnd;\r\n        } else {\r\n          time = newdateformStart + '/' + newdateformEnd;\r\n        }\r\n      }\r\n      if (newdateformStart === newdateformEnd) {\r\n        time = newdateformStart;\r\n      }\r\n    } else {\r\n      // to reset filter.\r\n      time = year;\r\n    }\r\n\r\n    const params = { TIME: time };\r\n    datasource.ol.updateParams(params);\r\n    if (datasource instanceof WMSDataSource) {\r\n      const wmsDataSource = datasource as WMSDataSource;\r\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\r\n    }\r\n  }\r\n\r\n  private reformatDateTime(value) {\r\n    const year = value.getFullYear();\r\n    let month = value.getMonth() + 1;\r\n    let day = value.getUTCDate();\r\n    let hour = value.getUTCHours();\r\n    let minute = value.getUTCMinutes();\r\n\r\n    if (Number(month) < 10) {\r\n      month = '0' + month;\r\n    }\r\n\r\n    if (Number(day) < 10) {\r\n      day = '0' + day;\r\n    }\r\n\r\n    if (Number(hour) < 10) {\r\n      hour = '0' + hour;\r\n    }\r\n\r\n    if (Number(minute) < 10) {\r\n      minute = '0' + minute;\r\n    }\r\n\r\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'keyvalue'\n})\nexport class KeyValuePipe implements PipeTransform {\n  transform(value: any, args?: any): any {\n    const keyValues = [];\n    Object.getOwnPropertyNames(value).forEach((key: string) =>\n      keyValues.push({ key, value: value[key] })\n    );\n\n    return keyValues;\n  }\n}\n","<table\r\n  class=\"igo-striped mat-typography\"\r\n  *ngIf=\"\r\n    ready &&\r\n    feature &&\r\n    isObject(feature.properties) &&\r\n    feature.properties.target !== 'iframe'\r\n  \"\r\n>\r\n  <tbody>\r\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\r\n      <td\r\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\r\n      >\r\n        <mat-icon matListItemIcon svgIcon=\"{{ icon }}\"></mat-icon>\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\r\n      >\r\n        <a\r\n          href=\"{{ property.value }}\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          {{ 'igo.geo.targetHtmlUrl' | translate }} {{ title }}</a\r\n        >\r\n        <button\r\n          class=\"copyClipboard\"\r\n          mat-icon-button\r\n          (click)=\"copyTextToClipboard(property.value)\"\r\n        >\r\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n        </button>\r\n      </td>\r\n\r\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\r\n        {{ property.key }}\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined &&\r\n          !isObject(property.value) &&\r\n          !isUrl(property.value) &&\r\n          !isEmbeddedLink(property.value)\r\n        \"\r\n        [innerHTML]=\"property.value\"\r\n      ></td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined &&\r\n          isEmbeddedLink(property.value)\r\n        \"\r\n      >\r\n        <u\r\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\r\n          (click)=\"openSecureUrl(property.value)\"\r\n          >{{ getEmbeddedLinkText(property.value) }}</u\r\n        >\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined &&\r\n          !isObject(property.value) &&\r\n          (isDoc(property.value) || isUrl(property.value)) &&\r\n          !isImg(property.value)\r\n        \"\r\n      >\r\n        <u\r\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\r\n          (click)=\"openSecureUrl(property.value)\"\r\n          >{{ 'igo.geo.targetHtmlUrl' | translate }}</u\r\n        >\r\n        <button\r\n          class=\"copyClipboard\"\r\n          mat-icon-button\r\n          (click)=\"copyTextToClipboard(property.value)\"\r\n        >\r\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n        </button>\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined &&\r\n          !isObject(property.value) &&\r\n          isUrl(property.value) &&\r\n          isImg(property.value)\r\n        \"\r\n      >\r\n        <a\r\n          href=\"{{ property.value }}\"\r\n          target=\"_blank\"\r\n          (click)=\"openSecureUrl(property.value)\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          <img\r\n            igoImageError\r\n            src=\"{{ property.value | secureImage | async }}\"\r\n            width=\"225\"\r\n            height=\"auto\"\r\n          />\r\n        </a>\r\n      </td>\r\n\r\n      <td\r\n        *ngIf=\"\r\n          feature.properties.target === undefined && isObject(property.value)\r\n        \"\r\n        [innerHTML]=\"property.value | json\"\r\n      ></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<iframe\r\n  *ngIf=\"isHtmlDisplay()\"\r\n  [srcdoc]=\"htmlSanitizer(feature.properties)\"\r\n  [src]=\"urlSanitizer(feature.properties.url)\"\r\n></iframe>\r\n","import { HttpClient } from '@angular/common/http';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\r\n\r\nimport { getEntityIcon, getEntityTitle } from '@igo2/common';\r\nimport type { Toolbox } from '@igo2/common';\r\nimport { ConnectionState, MessageService, NetworkService } from '@igo2/core';\r\nimport { ConfigService } from '@igo2/core';\r\nimport { Clipboard } from '@igo2/utils';\r\n\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\nimport { Feature } from '../shared';\r\n\r\n@Component({\r\n  selector: 'igo-feature-details',\r\n  templateUrl: './feature-details.component.html',\r\n  styleUrls: ['./feature-details.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\r\n  private state: ConnectionState;\r\n  private unsubscribe$ = new Subject<void>();\r\n  ready = false;\r\n\r\n  @Input()\r\n  get source(): SearchSource {\r\n    return this._source;\r\n  }\r\n  set source(value: SearchSource) {\r\n    this._source = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() toolbox: Toolbox;\r\n\r\n  @Input()\r\n  get feature(): Feature {\r\n    return this._feature;\r\n  }\r\n  set feature(value: Feature) {\r\n    this._feature = value;\r\n    this.cdRef.detectChanges();\r\n    this.selectFeature.emit();\r\n  }\r\n\r\n  private _feature: Feature;\r\n  private _source: SearchSource;\r\n\r\n  @Output() routeEvent = new EventEmitter<boolean>();\r\n  @Output() selectFeature = new EventEmitter<boolean>();\r\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.feature);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.feature) || 'link';\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private cdRef: ChangeDetectorRef,\r\n    private sanitizer: DomSanitizer,\r\n    private networkService: NetworkService,\r\n    private messageService: MessageService,\r\n    private configService: ConfigService\r\n  ) {\r\n    this.networkService\r\n      .currentState()\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe((state: ConnectionState) => {\r\n        this.state = state;\r\n      });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.ready = true;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribe$.next();\r\n    this.unsubscribe$.complete();\r\n  }\r\n\r\n  urlSanitizer(value): SafeResourceUrl {\r\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\r\n  }\r\n\r\n  isHtmlDisplay(): boolean {\r\n    if (\r\n      this.feature &&\r\n      this.isObject(this.feature.properties) &&\r\n      this.feature.properties.target === 'iframe'\r\n    ) {\r\n      this.htmlDisplayEvent.emit(true);\r\n      return true;\r\n    } else {\r\n      this.htmlDisplayEvent.emit(false);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  htmlSanitizer(value): SafeResourceUrl {\r\n    if (!value.body) {\r\n      return;\r\n    }\r\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\r\n    if (!regexBase.test(value.body)) {\r\n      const url = new URL(value.url, window.location.origin);\r\n      value.body = value.body.replace(\r\n        '<head>',\r\n        `<head><base href=\"${url.origin}\">`\r\n      );\r\n    }\r\n\r\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\r\n  }\r\n\r\n  isObject(value) {\r\n    return typeof value === 'object';\r\n  }\r\n\r\n  openSecureUrl(value) {\r\n    let url: string;\r\n    const regexDepot = new RegExp(\r\n      this.configService?.getConfig('depot.url') + '.*?(?=\"|$)'\r\n    );\r\n\r\n    if (regexDepot.test(value)) {\r\n      url = value.match(regexDepot)[0];\r\n\r\n      this.http\r\n        .get(url, {\r\n          responseType: 'blob'\r\n        })\r\n        .subscribe(\r\n          (docOrImage) => {\r\n            const fileUrl = URL.createObjectURL(docOrImage);\r\n            window.open(fileUrl, '_blank');\r\n            this.cdRef.detectChanges();\r\n          },\r\n          (error: Error) => {\r\n            this.messageService.error(\r\n              'igo.geo.targetHtmlUrlUnauthorized',\r\n              'igo.geo.targetHtmlUrlUnauthorizedTitle'\r\n            );\r\n          }\r\n        );\r\n    } else {\r\n      let url = value;\r\n      if (this.isEmbeddedLink(value)) {\r\n        var div = document.createElement('div');\r\n        div.innerHTML = value;\r\n        url = div.children[0].getAttribute('href');\r\n      }\r\n      window.open(url, '_blank');\r\n    }\r\n  }\r\n\r\n  isUrl(value) {\r\n    if (typeof value === 'string') {\r\n      const regex = /^https?:\\/\\//;\r\n      return regex.test(value);\r\n    }\r\n  }\r\n\r\n  isDoc(value) {\r\n    if (typeof value === 'string') {\r\n      if (this.isUrl(value)) {\r\n        const regex = /(pdf|docx?|xlsx?)$/;\r\n        return regex.test(value.toLowerCase());\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  isImg(value) {\r\n    if (typeof value === 'string') {\r\n      if (this.isUrl(value)) {\r\n        const regex = /(jpe?g|png|gif)$/;\r\n        return regex.test(value.toLowerCase());\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  isEmbeddedLink(value) {\r\n    if (typeof value === 'string') {\r\n      const matchRegex = /<a/g;\r\n      const match = value.match(matchRegex) || [];\r\n      const count = match.length;\r\n      if (count === 1) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getEmbeddedLinkText(value) {\r\n    const regex = /(?:>).*?(?=<|$)/;\r\n    let text = value.match(regex)[0] as string;\r\n    text = text.replace(/>/g, '');\r\n    return text;\r\n  }\r\n\r\n  filterFeatureProperties(feature) {\r\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\r\n    const properties = {};\r\n    let offlineButtonState;\r\n\r\n    if (this.map) {\r\n      this.map.forcedOffline$\r\n        .pipe(takeUntil(this.unsubscribe$))\r\n        .subscribe((state) => {\r\n          offlineButtonState = state;\r\n        });\r\n    }\r\n\r\n    if (\r\n      feature.properties &&\r\n      feature.properties.Route &&\r\n      this.toolbox &&\r\n      !this.toolbox.getTool('directions')\r\n    ) {\r\n      delete feature.properties.Route;\r\n    }\r\n\r\n    if (allowedFieldsAndAlias) {\r\n      Object.keys(allowedFieldsAndAlias).forEach((field) => {\r\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\r\n      });\r\n      return properties;\r\n    } else if (offlineButtonState !== undefined) {\r\n      if (!offlineButtonState) {\r\n        if (\r\n          this.state.connection &&\r\n          feature.meta &&\r\n          feature.meta.excludeAttribute\r\n        ) {\r\n          const excludeAttribute = feature.meta.excludeAttribute;\r\n          excludeAttribute.forEach((attribute) => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        } else if (\r\n          !this.state.connection &&\r\n          feature.meta &&\r\n          feature.meta.excludeAttributeOffline\r\n        ) {\r\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n          excludeAttributeOffline.forEach((attribute) => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        }\r\n      } else {\r\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\r\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n          excludeAttributeOffline.forEach((attribute) => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      if (\r\n        this.state.connection &&\r\n        feature.meta &&\r\n        feature.meta.excludeAttribute\r\n      ) {\r\n        const excludeAttribute = feature.meta.excludeAttribute;\r\n        excludeAttribute.forEach((attribute) => {\r\n          delete feature.properties[attribute];\r\n        });\r\n      } else if (\r\n        !this.state.connection &&\r\n        feature.meta &&\r\n        feature.meta.excludeAttributeOffline\r\n      ) {\r\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n        excludeAttributeOffline.forEach((attribute) => {\r\n          delete feature.properties[attribute];\r\n        });\r\n      }\r\n    }\r\n    return feature.properties;\r\n  }\r\n\r\n  /**\r\n   * Copy the url to a clipboard\r\n   */\r\n  copyTextToClipboard(value: string): void {\r\n    const successful = Clipboard.copy(value);\r\n    if (successful) {\r\n      this.messageService.success('igo.geo.query.link.message');\r\n    }\r\n  }\r\n}\r\n","export const LAYER = 'Layer';\n","export const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm',\n  [MeasureAreaUnit.SquareKilometers]: 'km',\n  [MeasureAreaUnit.SquareMiles]: 'mi',\n  [MeasureAreaUnit.SquareFeet]: 'ft',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core';\r\n\r\nimport OlOverlay from 'ol/Overlay';\r\nimport { getCenter as olGetCenter } from 'ol/extent';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport { getArea as olGetArea, getLength as olGetLength } from 'ol/sphere';\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport {\r\n  MeasureAreaUnit,\r\n  MeasureAreaUnitAbbreviation,\r\n  MeasureLengthUnit,\r\n  MeasureLengthUnitAbbreviation\r\n} from './measure.enum';\r\nimport { Measure } from './measure.interfaces';\r\n\r\n/**\r\n * Convert value from meters to kilometers\r\n * @param value Value in meters\r\n * @returns Value in kilometers\r\n */\r\nexport function metersToKilometers(value: number): number {\r\n  return value * 0.001;\r\n}\r\n\r\n/**\r\n * Convert value from meters to feet\r\n * @param value Value in meters\r\n * @returns Value in feet\r\n */\r\nexport function metersToFeet(value: number): number {\r\n  return value * 3.2808;\r\n}\r\n\r\n/**\r\n * Convert value from meters to miles\r\n * @param value Value in meters\r\n * @returns Value in miles\r\n */\r\nexport function metersToMiles(value: number): number {\r\n  return value * 0.000621;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square kilometers\r\n * @param value Value in square meters\r\n * @returns Value in square kilometers\r\n */\r\nexport function squareMetersToSquareKilometers(value: number): number {\r\n  return value * 0.000001;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square miles\r\n * @param value Value in square meters\r\n * @returns Value in square miles\r\n */\r\nexport function squareMetersToSquareMiles(value: number): number {\r\n  return value * 0.0000003861;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square feet\r\n * @param value Value in square meters\r\n * @returns Value in square feet\r\n */\r\nexport function squareMetersToSquareFeet(value: number): number {\r\n  return value * 10.764;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to hectares\r\n * @param value Value in square meters\r\n * @returns Value in hectares\r\n */\r\nexport function squareMetersToHectares(value: number): number {\r\n  return value * 0.0001;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to acres\r\n * @param value Value in square meters\r\n * @returns Value in acres\r\n */\r\nexport function squareMetersToAcres(value: number): number {\r\n  return value * 0.00024711;\r\n}\r\n\r\n/**\r\n * Convert value from meters to the specified length unit\r\n * @param value Value in meters\r\n * @param unit Length unit\r\n * @returns Value in unit\r\n */\r\nexport function metersToUnit(\r\n  value: number,\r\n  unit: MeasureLengthUnit\r\n): number | undefined {\r\n  const conversionMapper = new Map([\r\n    [MeasureLengthUnit.Meters, (val: number) => val],\r\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\r\n    [MeasureLengthUnit.Miles, metersToMiles],\r\n    [MeasureLengthUnit.Feet, metersToFeet]\r\n  ]);\r\n  const conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to the specified area unit\r\n * @param value Value in meters\r\n * @param unit Area unit\r\n * @returns Value in unit\r\n */\r\nexport function squareMetersToUnit(\r\n  value: number,\r\n  unit: MeasureAreaUnit\r\n): number | undefined {\r\n  const conversionMapper = new Map([\r\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\r\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\r\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\r\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\r\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\r\n    [MeasureAreaUnit.Acres, squareMetersToAcres]\r\n  ]);\r\n  const conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n\r\n/**\r\n * This method format a measure to a readable format\r\n * @param measure Measure\r\n * @param options Formatting options\r\n * @returns Formatted measure\r\n */\r\nexport function formatMeasure(\r\n  measure: number,\r\n  options?: {\r\n    decimal?: number;\r\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\r\n    unitAbbr?: boolean;\r\n    locale?: string;\r\n  },\r\n  languageService?: LanguageService\r\n) {\r\n  let decimal = options.decimal;\r\n  if (decimal === undefined || decimal < 0) {\r\n    decimal = 1;\r\n  }\r\n\r\n  const parts = [];\r\n  if (options.locale !== undefined) {\r\n    parts.push(\r\n      measure.toLocaleString(options.locale, {\r\n        minimumFractionDigits: decimal,\r\n        maximumFractionDigits: decimal\r\n      })\r\n    );\r\n  } else {\r\n    parts.push(measure.toFixed(decimal).toString());\r\n  }\r\n\r\n  if (options.unit !== undefined && options.unitAbbr === true) {\r\n    if (languageService) {\r\n      parts.push(\r\n        MeasureLengthUnitAbbreviation[options.unit]\r\n          ? languageService.translate.instant(\r\n              'igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]\r\n            )\r\n          : languageService.translate.instant(\r\n              'igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit]\r\n            )\r\n      );\r\n    } else {\r\n      parts.push(\r\n        MeasureLengthUnitAbbreviation[options.unit] ||\r\n          MeasureAreaUnitAbbreviation[options.unit]\r\n      );\r\n    }\r\n  }\r\n\r\n  return parts.filter((p) => p !== undefined).join(' ');\r\n}\r\n\r\n/**\r\n * Compute best length measure unit for a given measure in meters\r\n * @param value Value in meters\r\n * @returns Measure unit\r\n */\r\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\r\n  let unit = MeasureLengthUnit.Meters;\r\n  let converted = value;\r\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\r\n  while (converted > 1000 && possibleUnits.length > 0) {\r\n    unit = possibleUnits.pop();\r\n    converted = metersToUnit(value, unit);\r\n  }\r\n  return unit;\r\n}\r\n\r\n/**\r\n * Compute best length measure unit for a given measure in square meters\r\n * @param value Value in meters\r\n * @returns Measure unit\r\n */\r\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\r\n  let unit = MeasureAreaUnit.SquareMeters;\r\n  let converted = value;\r\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\r\n  while (converted > 1000000 && possibleUnits.length > 0) {\r\n    unit = possibleUnits.pop();\r\n    converted = squareMetersToUnit(value, unit);\r\n  }\r\n  return unit;\r\n}\r\n\r\n/**\r\n * Create a default style for a measure interaction\r\n * @returns OL style\r\n */\r\nexport function createMeasureInteractionStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: '#ffcc33',\r\n      lineDash: [10, 10],\r\n      width: 2\r\n    }),\r\n    fill: new olstyle.Fill({\r\n      color: 'rgba(255, 255, 255, 0.2)'\r\n    }),\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke: new olstyle.Stroke({\r\n        color: '#ffcc33'\r\n      }),\r\n      fill: new olstyle.Fill({\r\n        color: 'rgba(255, 255, 255, 0.2)'\r\n      })\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Create a default style for a measure layer\r\n * @returns OL style\r\n */\r\nexport function createMeasureLayerStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: '#ffcc33',\r\n      width: 2\r\n    }),\r\n    fill: new olstyle.Fill({\r\n      color: 'rgba(255, 255, 255, 0.2)'\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Compute the length in meters of an OL geometry with a given projection\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Length in meters\r\n */\r\nexport function measureOlGeometryLength(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\r\n  projection: string\r\n): number | undefined {\r\n  if (olGeometry instanceof OlPoint) {\r\n    return undefined;\r\n  }\r\n  if (olGeometry.getFlatCoordinates().length === 0) {\r\n    return undefined;\r\n  }\r\n  return olGetLength(olGeometry, { projection });\r\n}\r\n\r\n/**\r\n * Compute the area in square meters of an OL geometry with a given projection\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Area in square meters\r\n */\r\nexport function measureOlGeometryArea(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\r\n  projection: string\r\n): number | undefined {\r\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\r\n    return undefined;\r\n  }\r\n  if (olGeometry.getFlatCoordinates().length === 0) {\r\n    return undefined;\r\n  }\r\n  return olGetArea(olGeometry, { projection });\r\n}\r\n\r\n/**\r\n * Compute the area (square meters), length (meters) and last length (meters)\r\n * of an OL geometry with a given projection.\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Computed measure\r\n */\r\nexport function measureOlGeometry(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\r\n  projection: string\r\n): Measure {\r\n  const length = measureOlGeometryLength(olGeometry, projection);\r\n  const area = measureOlGeometryArea(olGeometry, projection);\r\n\r\n  const lengths = [];\r\n  const coordinates = olGeometry.getFlatCoordinates();\r\n  const coordinatesLength = coordinates.length;\r\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\r\n    const olSegment = new OlLineString([\r\n      [coordinates[i], coordinates[i + 1]],\r\n      [coordinates[i + 2], coordinates[i + 3]]\r\n    ]);\r\n\r\n    lengths.push(measureOlGeometryLength(olSegment, projection));\r\n  }\r\n\r\n  return {\r\n    area,\r\n    length,\r\n    lengths\r\n  };\r\n}\r\n\r\n/**\r\n * Update an OL geometry midpoints and return an array of those points\r\n * @param olGeometry OL Geometry\r\n * @returns OL points\r\n */\r\nexport function updateOlGeometryMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlPoint[] {\r\n  let olMidpoints;\r\n  if (olGeometry instanceof OlPoint) {\r\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\r\n    olMidpoints = new Array(1);\r\n    olMidpoints[0] = olMidpointPoint;\r\n  } else {\r\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\r\n    // TODO: handle multi geometries\r\n    const coordinates = olGeometry.getFlatCoordinates();\r\n    const midpointsLength = olMidpoints.length;\r\n    for (let i = 0; i < midpointsLength; i++) {\r\n      const j = i * 2;\r\n      const olSegment = new OlLineString([\r\n        [coordinates[j], coordinates[j + 1]],\r\n        [coordinates[j + 2], coordinates[j + 3]]\r\n      ]);\r\n\r\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\r\n      const olMidpoint = olMidpoints[i];\r\n      if (olMidpoint !== undefined) {\r\n        olMidpoint.setCoordinates(midpointCoordinate);\r\n      } else {\r\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\r\n      }\r\n    }\r\n  }\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Clear an OL geometry midpoints and return an array of those points\r\n * @param olGeometry OL Geometry\r\n */\r\nexport function clearOlGeometryMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n) {\r\n  const olMidpoints = olGeometry.get('_midpoints') || [];\r\n  const midpointsLength = olMidpoints.length;\r\n  for (let i = 0; i < midpointsLength; i++) {\r\n    const olMidpoint = olMidpoints[i];\r\n    if (olMidpoint !== undefined) {\r\n      if (olMidpoint !== undefined) {\r\n        clearOlMidpointTooltip(olMidpoint);\r\n      }\r\n    }\r\n  }\r\n\r\n  olGeometry.set('_midpoints', undefined, true);\r\n\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Return an array of  OL geometry midpoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL points\r\n */\r\nfunction getOlGeometryMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlPoint[] {\r\n  let expectedNumber;\r\n  if (olGeometry instanceof OlCircle) {\r\n    expectedNumber = 0;\r\n  } else {\r\n    expectedNumber = Math.max(\r\n      olGeometry.getFlatCoordinates().length / 2 - 1,\r\n      0\r\n    );\r\n  }\r\n  // TODO: This works but it's quite messy. If time permits,\r\n  // clean this. Maybe a Tooltip class could handle that\r\n  let olMidpoints = olGeometry.get('_midpoints');\r\n\r\n  if (olMidpoints === undefined) {\r\n    if (olGeometry instanceof OlPoint) {\r\n      olMidpoints = new Array(1);\r\n    } else {\r\n      olMidpoints = new Array(expectedNumber);\r\n    }\r\n    olGeometry.set('_midpoints', olMidpoints, true);\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber === 0) {\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber === olMidpoints.length) {\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber > olMidpoints.length) {\r\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\r\n    return olMidpoints;\r\n  }\r\n\r\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\r\n    const olMidpoint = olMidpoints[expectedNumber];\r\n    if (olMidpoint !== undefined) {\r\n      clearOlMidpointTooltip(olMidpoint);\r\n    }\r\n  }\r\n  olMidpoints.splice(expectedNumber);\r\n\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Remove an OL midpoint's tooltip from the map\r\n * @param olMidpoint OL Point\r\n */\r\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\r\n  const olTooltip = olMidpoint.get('_tooltip');\r\n  if (olTooltip !== undefined) {\r\n    const olMap = olTooltip.getMap();\r\n    if (olMap !== undefined) {\r\n      olMap.removeOverlay(olTooltip);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Add an OL overlay at each midpoint and return an array of those overlays\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function updateOlTooltipsAtMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay[] {\r\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n  let typeGeom = '';\r\n  if (olGeometry instanceof OlLineString) {\r\n    typeGeom = 'line-';\r\n  } else if (olGeometry instanceof OlPolygon) {\r\n    typeGeom = 'polygone-';\r\n  }\r\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\r\n    let olTooltip = olMidpoint.get('_tooltip');\r\n    if (olTooltip === undefined) {\r\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\r\n    } else {\r\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\r\n    }\r\n    return olTooltip;\r\n  });\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Return an array of OL overlay at midspoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getOlTooltipsAtMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay[] {\r\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\r\n  return olMidpoints.map((olMidpoint: OlPoint) => {\r\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\r\n  });\r\n}\r\n\r\n/**\r\n * Update an OL geometry center and return it\r\n * @param olGeometry OL Geometry\r\n * @returns OL point\r\n */\r\nexport function updateOlGeometryCenter(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlPoint {\r\n  let olCenter = olGeometry.get('_center');\r\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\r\n  if (olCenter !== undefined) {\r\n    olCenter.setCoordinates(centerCoordinate);\r\n  } else {\r\n    olCenter = new OlPoint(centerCoordinate);\r\n    olGeometry.set('_center', olCenter);\r\n  }\r\n\r\n  return olCenter;\r\n}\r\n\r\n/**\r\n * Add an OL overlay at the center of a geometry and return that overlay\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlay\r\n */\r\nexport function updateOlTooltipAtCenter(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay {\r\n  const olCenter = updateOlGeometryCenter(olGeometry);\r\n  let olTooltip = olCenter.get('_tooltip');\r\n  if (olTooltip === undefined) {\r\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\r\n  } else {\r\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\r\n  }\r\n  return olTooltip;\r\n}\r\n\r\n/**\r\n * Return an array of OL overlay at midspoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getOlTooltipAtCenter(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay {\r\n  const olCenter = olGeometry.get('_center');\r\n  return olCenter ? olCenter.get('_tooltip') : undefined;\r\n}\r\n\r\n/**\r\n * Get all the tooltips of an OL geometry\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getTooltipsOfOlGeometry(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay[] {\r\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\r\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\r\n  if (olCenterTooltip !== undefined) {\r\n    olTooltips.push(olCenterTooltip);\r\n  }\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Create an OL overlay at a point and bind the overlay to the point\r\n * @param olPoint OL Point\r\n * @returns OL overlay\r\n */\r\nexport function createOlTooltipAtPoint(\r\n  olPoint: OlPoint,\r\n  center: boolean = false,\r\n  srcGeomType: string = ''\r\n): OlOverlay {\r\n  const olTooltip = new OlOverlay({\r\n    element: document.createElement('div'),\r\n    offset: [-30, -10],\r\n    className: (center\r\n      ? [\r\n          'igo-map-tooltip',\r\n          'igo-map-tooltip-measure',\r\n          'igo-map-tooltip-measure-area'\r\n        ]\r\n      : [\r\n          'igo-map-tooltip',\r\n          'igo-map-tooltip-measure',\r\n          `igo-map-tooltip-measure-${srcGeomType}segments`\r\n        ]\r\n    ).join(' '),\r\n    stopEvent: false\r\n  });\r\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\r\n  olPoint.set('_tooltip', olTooltip);\r\n\r\n  return olTooltip;\r\n}\r\n","import BasicEvent from 'ol/events/Event';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlLinearRing from 'ol/geom/LinearRing';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport { lineString } from '@turf/helpers';\r\nimport lineIntersect from '@turf/line-intersect';\r\n\r\nimport {\r\n  GeometrySliceLineStringError,\r\n  GeometrySliceMultiPolygonError,\r\n  GeometrySliceTooManyIntersectionError\r\n} from './geometry.errors';\r\n\r\n/**\r\n * Create a default style for draw and modify interactions\r\n * @param color Style color (R, G, B)\r\n * @returns OL style\r\n */\r\nexport function createDrawInteractionStyle(\r\n  color?: [number, number, number]\r\n): olstyle.Circle {\r\n  color = color || [0, 153, 255];\r\n  return new olstyle.Circle({\r\n    stroke: new olstyle.Stroke({\r\n      color: color.concat([1]),\r\n      width: 2\r\n    }),\r\n    fill: new olstyle.Fill({\r\n      color: color.concat([0.2])\r\n    }),\r\n    radius: 8\r\n  });\r\n}\r\n\r\n/**\r\n * Create a default style for drawing a hole\r\n * @returns OL style\r\n */\r\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: [0, 153, 255, 1],\r\n      width: 2\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Slice geometry into two parts\r\n * @param olGeometry OL geometry\r\n * @param olSlicer Slicing line\r\n * @returns New OL geometries\r\n */\r\nexport function sliceOlGeometry(\r\n  olGeometry: OlLineString | OlPolygon,\r\n  olSlicer: OlLineString\r\n): Array<OlLineString | OlPolygon> {\r\n  if (olGeometry instanceof OlPolygon) {\r\n    return sliceOlPolygon(olGeometry, olSlicer);\r\n  } else if (olGeometry instanceof OlLineString) {\r\n    return sliceOlLineString(olGeometry, olSlicer);\r\n  }\r\n  return [];\r\n}\r\n\r\n/**\r\n * Slice OL LineString into one or more lines\r\n * @param olLineString OL line string\r\n * @param olSlicer Slicing line\r\n * @returns New OL line strings\r\n */\r\nexport function sliceOlLineString(\r\n  olLineString: OlLineString,\r\n  olSlicer: OlLineString\r\n): OlLineString[] {\r\n  return [];\r\n}\r\n\r\n/**\r\n * Slice OL Polygon into one or more polygons\r\n * @param olPolygon OL polygon\r\n * @param olSlicer Slicing line\r\n * @returns New OL polygons\r\n */\r\nexport function sliceOlPolygon(\r\n  olPolygon: OlPolygon,\r\n  olSlicer: OlLineString\r\n): OlPolygon[] {\r\n  if (olPolygon.getLinearRingCount() > 1) {\r\n    throw new GeometrySliceMultiPolygonError();\r\n  }\r\n\r\n  if (olSlicer.getCoordinates().length > 2) {\r\n    throw new GeometrySliceLineStringError();\r\n  }\r\n\r\n  const olGeoJSON = new OlGeoJSON();\r\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\r\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\r\n\r\n  const parts = [[], []];\r\n  let totalIntersectionCount = 0;\r\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\r\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\r\n    const segment = lineString(segmentCoordinates);\r\n    const intersections = lineIntersect(segment, slicer).features;\r\n\r\n    const intersectionCount = intersections.length;\r\n    totalIntersectionCount += intersectionCount;\r\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\r\n      throw new GeometrySliceTooManyIntersectionError();\r\n    }\r\n\r\n    parts[0].push(segmentCoordinates[0]);\r\n    if (intersectionCount === 1) {\r\n      const intersection = intersections[0].geometry.coordinates;\r\n      parts[0].push(intersection);\r\n      parts[1].push(intersection);\r\n      parts.reverse();\r\n    }\r\n  }\r\n\r\n  if (totalIntersectionCount <= 1) {\r\n    return [];\r\n  }\r\n\r\n  parts[0].push(parts[0][0]);\r\n  parts[1].push(parts[1][0]);\r\n\r\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\r\n}\r\n\r\n/**\r\n * Splice geometry into two parts\r\n * @param olGeometry OL geometry\r\n * @param olSlicer Slicing line\r\n * @returns New OL geometries\r\n */\r\nexport function addLinearRingToOlPolygon(\r\n  olPolygon: OlPolygon,\r\n  olLinearRing: OlLinearRing\r\n) {\r\n  // TODO: make some validation and support updating an existing linear ring\r\n  olPolygon.appendLinearRing(olLinearRing);\r\n}\r\n\r\nexport function getMousePositionFromOlGeometryEvent(olEvent: BasicEvent) {\r\n  const olGeometry = olEvent.target as OlGeometry;\r\n  if (olGeometry instanceof OlPolygon) {\r\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\r\n  }\r\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\r\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { EventsKey } from 'ol/events';\r\nimport BasicEvent from 'ol/events/Event';\r\nimport { doubleClick } from 'ol/events/condition';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlDraw from 'ol/interaction/Draw';\r\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\r\nimport OlModify from 'ol/interaction/Modify';\r\nimport OlSelect from 'ol/interaction/Select';\r\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\n\r\nimport { BehaviorSubject, Subject, Subscription, fromEvent } from 'rxjs';\r\n\r\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\r\n\r\nexport interface DrawControlOptions {\r\n  geometryType: Type | string;\r\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\r\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\r\n  drawingLayerStyle?: OlStyleLike;\r\n  interactionStyle?: OlStyleLike;\r\n  maxPoints?: number;\r\n}\r\n\r\n/**\r\n * Control to draw entities\r\n */\r\nexport class DrawControl {\r\n  /**\r\n   * Draw start observable\r\n   */\r\n  public start$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw end observable\r\n   */\r\n  public end$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw changes observable (while drawing)\r\n   */\r\n  public changes$: Subject<any> = new Subject();\r\n\r\n  /**\r\n   * Draw modify observable (modify drawn features)\r\n   */\r\n  public modify$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw select observable (modify drawn features)\r\n   */\r\n  public select$: Subject<any> = new Subject();\r\n\r\n  /**\r\n   * Draw abort observable (abort drawn features)\r\n   */\r\n  public abort$: Subject<any> = new Subject();\r\n\r\n  /**\r\n   * Freehand mode observable (defaults to false)\r\n   */\r\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  /**\r\n   * Observables from predefined radius (defaults to false and undefined)\r\n   */\r\n  ispredefinedRadius$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(undefined);\r\n  radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(undefined);\r\n\r\n  private keyDown$$: Subscription;\r\n\r\n  private olGeometryType: typeof OlGeometry | undefined | string;\r\n  private olInteractionStyle: OlStyleLike;\r\n  private olMap: OlMap;\r\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\r\n  private olDrawInteraction: OlDraw;\r\n  private olSelectInteraction: OlSelect;\r\n  private olModifyInteraction: OlModify;\r\n  private onDrawStartKey: EventsKey;\r\n  private onDrawEndKey: EventsKey;\r\n  private onDrawAbortKey: EventsKey;\r\n  private onDrawKey: EventsKey;\r\n  public radius: number;\r\n\r\n  private mousePosition: [number, number];\r\n\r\n  /**\r\n   * take the value of radius\r\n   */\r\n  get radiusVal(): number {\r\n    return this.predefinedRadius$.getValue();\r\n  }\r\n  set radiusValData(radiusCercle: number) {\r\n    this.predefinedRadius$.next(radiusCercle);\r\n  }\r\n\r\n  /**\r\n   * Wheter the control is active\r\n   */\r\n  get active(): boolean {\r\n    return this.olMap !== undefined;\r\n  }\r\n\r\n  /**\r\n   * OL overlay source\r\n   * @internal\r\n   */\r\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\r\n    return this.olDrawingLayer.getSource();\r\n  }\r\n\r\n  constructor(private options: DrawControlOptions) {\r\n    this.olDrawingLayer = options.drawingLayer\r\n      ? options.drawingLayer\r\n      : this.createOlInnerOverlayLayer();\r\n    this.olGeometryType = this.options.geometryType;\r\n    this.olInteractionStyle = this.options.interactionStyle;\r\n  }\r\n\r\n  /**\r\n   * Add or remove this control to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\r\n    if (!olMap) {\r\n      this.clearOlInnerOverlaySource();\r\n      this.removeOlInnerOverlayLayer();\r\n      this.removeOlInteractions();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n    this.addOlInnerOverlayLayer();\r\n    this.addOlInteractions(activateModifyAndSelect);\r\n  }\r\n\r\n  /**\r\n   * Return the drawing layer source\r\n   */\r\n  getSource(): OlVectorSource<OlGeometry> {\r\n    return this.olDrawingLayerSource;\r\n  }\r\n\r\n  setOlInteractionStyle(style) {\r\n    this.olInteractionStyle = style;\r\n  }\r\n\r\n  /**\r\n   * Set the current geometry type\r\n   * @param geometryType the geometry type\r\n   */\r\n  setGeometryType(geometryType: Type) {\r\n    this.olGeometryType = geometryType;\r\n  }\r\n\r\n  /**\r\n   * Get the current geometry type\r\n   */\r\n  getGeometryType() {\r\n    return this.olGeometryType;\r\n  }\r\n\r\n  /**\r\n   * Create a drawing source if none is defined in the options\r\n   */\r\n  private createOlInnerOverlayLayer(): OlVectorLayer<\r\n    OlVectorSource<OlGeometry>\r\n  > {\r\n    return new OlVectorLayer({\r\n      source: this.options.drawingLayerSource\r\n        ? this.options.drawingLayerSource\r\n        : new OlVectorSource(),\r\n      style: this.options.drawingLayerStyle,\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the drawing layer if it wasn't defined in the options\r\n   */\r\n  private removeOlInnerOverlayLayer() {\r\n    if (!this.options.drawingLayer && this.olMap) {\r\n      this.olMap.removeLayer(this.olDrawingLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the drawing layer if it wasn't defined in the options\r\n   */\r\n  private addOlInnerOverlayLayer() {\r\n    if (!this.options.drawingLayer) {\r\n      this.olMap.addLayer(this.olDrawingLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the drawing layer source if it wasn't defined in the options\r\n   */\r\n  private clearOlInnerOverlaySource() {\r\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\r\n      this.olDrawingLayerSource.clear(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add interactions to the map an set up some listeners\r\n   */\r\n  addOlInteractions(activateModifyAndSelect?: boolean) {\r\n    // Create Draw interaction\r\n    let olDrawInteraction;\r\n    if (!this.freehand$.getValue()) {\r\n      if (!this.ispredefinedRadius$.getValue()) {\r\n        olDrawInteraction = new OlDraw({\r\n          type: this.olGeometryType as Type,\r\n          source: this.getSource(),\r\n          stopClick: true,\r\n          style: this.olInteractionStyle,\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: false,\r\n          freehandCondition: () => false\r\n        });\r\n      } else {\r\n        olDrawInteraction = new OlDraw({\r\n          type: 'Point',\r\n          source: this.getSource(),\r\n          stopClick: true,\r\n          style: this.olInteractionStyle,\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: false,\r\n          freehandCondition: () => false\r\n        });\r\n      }\r\n    } else {\r\n      if (this.olGeometryType === 'Point') {\r\n        olDrawInteraction = new OlDraw({\r\n          type: 'Circle',\r\n          source: this.getSource(),\r\n          style:\r\n            typeof this.olInteractionStyle === 'function'\r\n              ? undefined\r\n              : this.olInteractionStyle,\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: true\r\n        });\r\n      } else {\r\n        olDrawInteraction = new OlDraw({\r\n          type: this.olGeometryType as Type,\r\n          source: this.getSource(),\r\n          style: this.olInteractionStyle,\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: true\r\n        });\r\n      }\r\n    }\r\n\r\n    // Add Draw interaction to map and create listeners\r\n    this.olMap.addInteraction(olDrawInteraction);\r\n    this.olDrawInteraction = olDrawInteraction;\r\n    this.onDrawStartKey = olDrawInteraction.on(\r\n      'drawstart',\r\n      (event: OlDrawEvent) => this.onDrawStart(event)\r\n    );\r\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) =>\r\n      this.onDrawEnd(event)\r\n    );\r\n    this.onDrawAbortKey = olDrawInteraction.on(\r\n      'drawabort',\r\n      (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry())\r\n    );\r\n\r\n    if (activateModifyAndSelect) {\r\n      // Create a Modify interaction, add it to map and create a listener\r\n      const olModifyInteraction = new OlModify({\r\n        source: this.getSource()\r\n      });\r\n\r\n      this.olMap.addInteraction(olModifyInteraction);\r\n      this.olModifyInteraction = olModifyInteraction;\r\n\r\n      // Create a select interaction and add it to map\r\n      if (!this.olSelectInteraction) {\r\n        const olSelectInteraction = new OlSelect({\r\n          condition: doubleClick,\r\n          style: undefined\r\n        });\r\n        this.olMap.addInteraction(olSelectInteraction);\r\n        this.olSelectInteraction = olSelectInteraction;\r\n\r\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) =>\r\n          this.onSelect(event)\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove interactions\r\n   */\r\n  private removeOlInteractions() {\r\n    this.unsubscribeKeyDown();\r\n    unByKey([\r\n      this.onDrawStartKey,\r\n      this.onDrawEndKey,\r\n      this.onDrawKey,\r\n      this.onDrawAbortKey\r\n    ]);\r\n\r\n    if (this.olMap) {\r\n      this.olMap.removeInteraction(this.olDrawInteraction);\r\n      this.olMap.removeInteraction(this.olModifyInteraction);\r\n    }\r\n\r\n    this.olDrawInteraction = undefined;\r\n    this.olModifyInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * When drawing starts, clear the overlay and start watching for changes\r\n   * @param event Draw start event\r\n   */\r\n  private onDrawStart(event: OlDrawEvent) {\r\n    const olGeometry = event.feature.getGeometry();\r\n    this.start$.next(olGeometry);\r\n    this.clearOlInnerOverlaySource();\r\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\r\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n      this.changes$.next(olGeometryEvent.target);\r\n    });\r\n    this.subscribeKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When drawing ends, update the drawing (feature) geometry observable and add\r\n   * @param event Draw event (drawend)\r\n   */\r\n  private onDrawEnd(event: OlDrawEvent) {\r\n    if (event.feature.getGeometry().getType() === 'Point') {\r\n      this.radiusDrawEnd$.next(this.predefinedRadius$.getValue());\r\n    }\r\n    this.unsubscribeKeyDown();\r\n    unByKey(this.onDrawKey);\r\n    const olGeometry = event.feature.getGeometry();\r\n    olGeometry.on('change', () => {\r\n      this.modify$.next(olGeometry);\r\n    });\r\n    this.end$.next(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * When a feature is selected, update the selected feature observable\r\n   * @param event Modify event (modifyend)\r\n   */\r\n  private onSelect(event: OlSelectEvent) {\r\n    if (event.selected.length === 1) {\r\n      this.select$.next(event.selected[0]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to key downs used as drawing interaction shorcuts\r\n   */\r\n  private subscribeKeyDown() {\r\n    this.unsubscribeKeyDown();\r\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        // On Escape or 'c' keydowns, abort the current drawing\r\n        if (event.key === 'Escape') {\r\n          this.olDrawInteraction.abortDrawing();\r\n          return;\r\n        }\r\n\r\n        // On Backspace or 'u' keydowns, remove last vertex of current drawing\r\n        if (event.key === 'Backspace') {\r\n          this.olDrawInteraction.removeLastPoint();\r\n        }\r\n\r\n        // On Enter or 'f' keydowns, finish current drawing\r\n        if (event.key === 'Enter') {\r\n          this.olDrawInteraction.finishDrawing();\r\n        }\r\n\r\n        // On space bar key down, pan to the current mouse position\r\n        if (event.key === ' ') {\r\n          this.olMap.getView().animate({\r\n            center: this.mousePosition,\r\n            duration: 100\r\n          });\r\n          return;\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key down\r\n   */\r\n  private unsubscribeKeyDown() {\r\n    if (this.keyDown$$) {\r\n      this.keyDown$$.unsubscribe();\r\n      this.keyDown$$ = undefined;\r\n    }\r\n  }\r\n}\r\n","import OlFeature from 'ol/Feature';\r\nimport OlMap from 'ol/Map';\r\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\r\nimport { unByKey } from 'ol/Observable';\r\nimport BasicEvent from 'ol/events/Event';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlLinearRing from 'ol/geom/LinearRing';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\r\nimport OlDraw from 'ol/interaction/Draw';\r\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\r\nimport OlInteraction from 'ol/interaction/Interaction';\r\nimport OlModify from 'ol/interaction/Modify';\r\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\r\nimport OlTranslate from 'ol/interaction/Translate';\r\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport * as OlStyle from 'ol/style';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\n\r\nimport { Subject, Subscription, fromEvent } from 'rxjs';\r\n\r\nimport {\r\n  addLinearRingToOlPolygon,\r\n  createDrawHoleInteractionStyle,\r\n  getMousePositionFromOlGeometryEvent\r\n} from '../geometry.utils';\r\n\r\nexport interface ModifyControlOptions {\r\n  source?: OlVectorSource<any>;\r\n  layer?: OlVectorLayer<any>;\r\n  layerStyle?: OlStyleLike;\r\n  drawStyle?: OlStyleLike;\r\n  modify?: boolean;\r\n  translate?: boolean;\r\n}\r\n\r\n/**\r\n * Control to modify geometries\r\n */\r\nexport class ModifyControl {\r\n  /**\r\n   * Modify start observable\r\n   */\r\n  public start$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Modify end observable\r\n   */\r\n  public end$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Geometry changes observable\r\n   */\r\n  public changes$: Subject<OlGeometry> = new Subject();\r\n\r\n  private olMap: OlMap;\r\n  private olOverlayLayer: OlVectorLayer<any>;\r\n  public olModifyInteraction: OlModify;\r\n  private onModifyStartKey: any;\r\n  private onModifyEndKey: any;\r\n  private onModifyKey: any;\r\n  private olModifyInteractionIsActive: boolean = false;\r\n  private olTranslateInteraction: OlTranslate;\r\n  private onTranslateStartKey: any;\r\n  private onTranslateEndKey: any;\r\n  private onTranslateKey: any;\r\n  private olTranslateInteractionIsActive: boolean = false;\r\n  private olDrawInteraction: OlDraw;\r\n  private onDrawStartKey: any;\r\n  private onDrawEndKey: any;\r\n  private onDrawKey: any;\r\n  private olDrawInteractionIsActive: boolean = false;\r\n\r\n  private mousePosition: [number, number];\r\n\r\n  private keyDown$$: Subscription;\r\n  private drawKeyUp$$: Subscription;\r\n  private drawKeyDown$$: Subscription;\r\n\r\n  private removedOlInteractions: OlInteraction[] = [];\r\n  private olLinearRingsLayer: OlVectorLayer<any>;\r\n\r\n  // This is the geometry to test against when drawing holes\r\n  private olOuterGeometry: OlGeometry;\r\n\r\n  /**\r\n   * Wheter the control is active\r\n   */\r\n  get active(): boolean {\r\n    return this.olMap !== undefined;\r\n  }\r\n\r\n  /**\r\n   * OL overlay source\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource<any> {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  /**\r\n   * OL linear rings source\r\n   * @internal\r\n   */\r\n  get olLinearRingsSource(): OlVectorSource<any> {\r\n    return this.olLinearRingsLayer.getSource();\r\n  }\r\n\r\n  /**\r\n   * Whether a modify control should be available\r\n   */\r\n  private modify: boolean = true;\r\n\r\n  /**\r\n   * Whether a translate control should be available\r\n   */\r\n  private translate: boolean = true;\r\n\r\n  constructor(private options: ModifyControlOptions) {\r\n    if (options.modify !== undefined) {\r\n      this.modify = options.modify;\r\n    }\r\n    if (options.translate !== undefined) {\r\n      this.translate = options.translate;\r\n    }\r\n\r\n    if (options.layer !== undefined) {\r\n      this.olOverlayLayer = options.layer;\r\n    } else {\r\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\r\n    }\r\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\r\n  }\r\n\r\n  /**\r\n   * Add or remove this control to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap === undefined) {\r\n      this.clearOlInnerOverlaySource();\r\n      this.removeOlInnerOverlayLayer();\r\n      this.removeOlModifyInteraction();\r\n      this.removeOlTranslateInteraction();\r\n      this.removeOlDrawInteraction();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n    this.addOlInnerOverlayLayer();\r\n\r\n    // The order in which these interactions\r\n    // are added is important\r\n    if (this.modify === true) {\r\n      this.addOlDrawInteraction();\r\n    }\r\n\r\n    if (this.translate === true) {\r\n      this.addOlTranslateInteraction();\r\n      this.activateTranslateInteraction();\r\n    }\r\n\r\n    if (this.modify === true) {\r\n      this.addOlModifyInteraction();\r\n      this.activateModifyInteraction();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the overlay source\r\n   */\r\n  getSource(): OlVectorSource<any> {\r\n    return this.olOverlaySource;\r\n  }\r\n\r\n  /**\r\n   * Add an OL geometry to the overlay and start modifying it\r\n   * @param olGeometry Ol Geometry\r\n   */\r\n  setOlGeometry(olGeometry: OlGeometry) {\r\n    const olFeature = new OlFeature({ geometry: olGeometry });\r\n    this.olOverlaySource.clear();\r\n    this.olOverlaySource.addFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Create an overlay source if none is defined in the options\r\n   */\r\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\r\n    return new OlVectorLayer({\r\n      source: this.options.source ? this.options.source : new OlVectorSource(),\r\n      style: this.options.layerStyle,\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer if it wasn't defined in the options\r\n   */\r\n  private addOlInnerOverlayLayer() {\r\n    if (this.options.layer === undefined) {\r\n      this.olMap.addLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer if it wasn't defined in the options\r\n   */\r\n  private removeOlInnerOverlayLayer() {\r\n    if (this.options.layer === undefined && this.olMap !== undefined) {\r\n      this.olMap.removeLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay source if it wasn't defined in the options\r\n   */\r\n  private clearOlInnerOverlaySource() {\r\n    if (this.options.layer === undefined && this.options.source === undefined) {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n  }\r\n\r\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\r\n    return new OlVectorLayer({\r\n      source: new OlVectorSource(),\r\n      style: createDrawHoleInteractionStyle(),\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the linear rings layer\r\n   */\r\n  private addOlLinearRingsLayer() {\r\n    this.olMap.addLayer(this.olLinearRingsLayer);\r\n  }\r\n\r\n  /**\r\n   * Clear the linear rings layer\r\n   */\r\n  private removeOlLinearRingsLayer() {\r\n    this.olMap.removeLayer(this.olLinearRingsLayer);\r\n  }\r\n\r\n  /**\r\n   * Clear the linear rings source\r\n   */\r\n  private clearOlLinearRingsSource() {\r\n    this.olLinearRingsSource.clear(true);\r\n  }\r\n\r\n  /**\r\n   * Add a modify interaction to the map an set up some listeners\r\n   */\r\n  private addOlModifyInteraction() {\r\n    const olModifyInteraction = new OlModify({\r\n      source: this.olOverlaySource,\r\n      style: this.options.drawStyle as OlStyle.Style\r\n    });\r\n    this.olModifyInteraction = olModifyInteraction;\r\n  }\r\n\r\n  /**\r\n   * Remove the modify interaction\r\n   */\r\n  private removeOlModifyInteraction() {\r\n    if (this.olModifyInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateModifyInteraction();\r\n    this.olModifyInteraction = undefined;\r\n  }\r\n\r\n  private activateModifyInteraction() {\r\n    if (this.olModifyInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.olModifyInteractionIsActive = true;\r\n    this.onModifyStartKey = this.olModifyInteraction.on(\r\n      'modifystart',\r\n      (event: OlModifyEvent) => this.onModifyStart(event)\r\n    );\r\n    this.onModifyEndKey = this.olModifyInteraction.on(\r\n      'modifyend',\r\n      (event: OlModifyEvent) => this.onModifyEnd(event)\r\n    );\r\n    this.olMap.addInteraction(this.olModifyInteraction);\r\n  }\r\n\r\n  private deactivateModifyInteraction() {\r\n    if (this.olModifyInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.olModifyInteractionIsActive = false;\r\n\r\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olModifyInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When modifying starts, clear the overlay and start watching for changes\r\n   * @param event Modify start event\r\n   */\r\n  private onModifyStart(event: OlModifyEvent) {\r\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\r\n    this.start$.next(olGeometry);\r\n    this.onModifyKey = olGeometry.on(\r\n      'change',\r\n      (olGeometryEvent: BasicEvent) => {\r\n        this.mousePosition =\r\n          getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n        this.changes$.next(\r\n          olGeometryEvent.target as OlLineString | OlCircle | OlPolygon\r\n        );\r\n      }\r\n    );\r\n    this.subscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When modifying ends, update the geometry observable and stop watching for changes\r\n   * @param event Modify end event\r\n   */\r\n  private onModifyEnd(event: OlModifyEvent) {\r\n    unByKey(this.onModifyKey);\r\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\r\n    this.unsubscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to space key down to pan the map\r\n   */\r\n  private subscribeToKeyDown() {\r\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        if (event.key === ' ') {\r\n          // On space bar, pan to the current mouse position\r\n          this.olMap.getView().animate({\r\n            center: this.mousePosition,\r\n            duration: 0\r\n          });\r\n          return;\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key down\r\n   */\r\n  private unsubscribeToKeyDown() {\r\n    if (this.keyDown$$ !== undefined) {\r\n      this.keyDown$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a translate interaction to the map an set up some listeners\r\n   */\r\n  private addOlTranslateInteraction() {\r\n    const olTranslateInteraction = new OlTranslate({\r\n      layers: [this.olOverlayLayer]\r\n    });\r\n    this.olTranslateInteraction = olTranslateInteraction;\r\n  }\r\n\r\n  /**\r\n   * Remove the translate interaction\r\n   */\r\n  private removeOlTranslateInteraction() {\r\n    if (this.olTranslateInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateTranslateInteraction();\r\n    this.olTranslateInteraction = undefined;\r\n  }\r\n\r\n  private activateTranslateInteraction() {\r\n    if (this.olTranslateInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.olTranslateInteractionIsActive = true;\r\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\r\n      'translatestart',\r\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\r\n    );\r\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\r\n      'translateend',\r\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\r\n    );\r\n    this.olMap.addInteraction(this.olTranslateInteraction);\r\n  }\r\n\r\n  private deactivateTranslateInteraction() {\r\n    if (this.olTranslateInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.olTranslateInteractionIsActive = false;\r\n    unByKey([\r\n      this.onTranslateStartKey,\r\n      this.onTranslateEndKey,\r\n      this.onTranslateKey\r\n    ]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olTranslateInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When translation starts, clear the overlay and start watching for changes\r\n   * @param event Translate start event\r\n   */\r\n  private onTranslateStart(event: OlTranslateEvent) {\r\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\r\n    this.start$.next(olGeometry);\r\n    this.onTranslateKey = olGeometry.on(\r\n      'change',\r\n      (olGeometryEvent: BasicEvent) => {\r\n        // this.changes$.next(olGeometryEvent.target);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * When translation ends, update the geometry observable and stop watchign for changes\r\n   * @param event Translate end event\r\n   */\r\n  private onTranslateEnd(event: OlTranslateEvent) {\r\n    unByKey(this.onTranslateKey);\r\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\r\n  }\r\n\r\n  /**\r\n   * Add a draw interaction to the map an set up some listeners\r\n   */\r\n  private addOlDrawInteraction() {\r\n    const olDrawInteraction = new OlDraw({\r\n      type: 'Polygon',\r\n      source: this.olLinearRingsSource,\r\n      stopClick: true,\r\n      style: createDrawHoleInteractionStyle(),\r\n      condition: (event: MapBrowserEvent<any>) => {\r\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\r\n        const intersects = olOuterGeometry.intersectsCoordinate(\r\n          event.coordinate\r\n        );\r\n        return intersects;\r\n      }\r\n    });\r\n\r\n    this.olDrawInteraction = olDrawInteraction;\r\n    this.subscribeToDrawKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to CTRL key down to activate the draw control\r\n   */\r\n  private subscribeToDrawKeyDown() {\r\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        if (event.key !== 'Control') {\r\n          return;\r\n        }\r\n\r\n        this.unsubscribeToDrawKeyDown();\r\n\r\n        const olGeometry = this.getOlGeometry();\r\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\r\n          return;\r\n        }\r\n\r\n        this.subscribeToDrawKeyUp();\r\n\r\n        this.deactivateModifyInteraction();\r\n        this.deactivateTranslateInteraction();\r\n        this.activateDrawInteraction();\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Subscribe to CTRL key up to deactivate the draw control\r\n   */\r\n  private subscribeToDrawKeyUp() {\r\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\r\n      (event: KeyboardEvent) => {\r\n        if (event.key !== 'Control') {\r\n          return;\r\n        }\r\n\r\n        this.unsubscribeToDrawKeyUp();\r\n        this.unsubscribeToKeyDown();\r\n        this.deactivateDrawInteraction();\r\n\r\n        this.activateModifyInteraction();\r\n        if (this.translate === true) {\r\n          this.activateTranslateInteraction();\r\n        }\r\n        this.subscribeToDrawKeyDown();\r\n\r\n        this.olOuterGeometry = undefined;\r\n        this.clearOlLinearRingsSource();\r\n        this.end$.next(this.getOlGeometry());\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to draw key down\r\n   */\r\n  private unsubscribeToDrawKeyDown() {\r\n    if (this.drawKeyDown$$ !== undefined) {\r\n      this.drawKeyDown$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key up\r\n   */\r\n  private unsubscribeToDrawKeyUp() {\r\n    if (this.drawKeyUp$$ !== undefined) {\r\n      this.drawKeyUp$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the draw interaction\r\n   */\r\n  private removeOlDrawInteraction() {\r\n    if (this.olDrawInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.unsubscribeToKeyDown();\r\n    this.unsubscribeToDrawKeyUp();\r\n    this.unsubscribeToDrawKeyDown();\r\n    this.deactivateDrawInteraction();\r\n    this.clearOlLinearRingsSource();\r\n    this.olDrawInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * Activate the draw interaction\r\n   */\r\n  private activateDrawInteraction() {\r\n    if (this.olDrawInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.clearOlLinearRingsSource();\r\n    this.addOlLinearRingsLayer();\r\n\r\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\r\n      if (olInteraction instanceof OlDragBoxInteraction) {\r\n        this.olMap.removeInteraction(olInteraction);\r\n        this.removedOlInteractions.push(olInteraction);\r\n      }\r\n    });\r\n\r\n    this.olDrawInteractionIsActive = true;\r\n    this.onDrawStartKey = this.olDrawInteraction.on(\r\n      'drawstart',\r\n      (event: OlDrawEvent) => this.onDrawStart(event)\r\n    );\r\n    this.onDrawEndKey = this.olDrawInteraction.on(\r\n      'drawend',\r\n      (event: OlDrawEvent) => this.onDrawEnd(event)\r\n    );\r\n    this.olMap.addInteraction(this.olDrawInteraction);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the draw interaction\r\n   */\r\n  private deactivateDrawInteraction() {\r\n    if (this.olDrawInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.removeOlLinearRingsLayer();\r\n\r\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\r\n      this.olMap.addInteraction(olInteraction);\r\n    });\r\n    this.removedOlInteractions = [];\r\n\r\n    this.olDrawInteractionIsActive = false;\r\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olDrawInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\r\n   * @param event Draw start event\r\n   */\r\n  private onDrawStart(event: OlDrawEvent) {\r\n    const olGeometry = event.feature.getGeometry();\r\n    this.olOuterGeometry = this.getOlGeometry().clone();\r\n\r\n    const linearRingCoordinates = (\r\n      (olGeometry as any).getLinearRing() as any\r\n    ).getCoordinates();\r\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\r\n    this.start$.next(this.getOlGeometry());\r\n\r\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\r\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n      const olGeometryTarget = olGeometryEvent.target as OlPolygon;\r\n      const _linearRingCoordinates = olGeometryTarget\r\n        .getLinearRing(0)\r\n        .getCoordinates();\r\n      this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\r\n      this.changes$.next(this.getOlGeometry());\r\n    });\r\n    this.subscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When translation ends, update the geometry observable and stop watchign for changes\r\n   * @param event Draw end event\r\n   */\r\n  private onDrawEnd(event: OlDrawEvent) {\r\n    unByKey(this.onDrawKey);\r\n    this.olOuterGeometry = undefined;\r\n\r\n    const linearRingCoordinates = (\r\n      (event.feature.getGeometry() as any).getLinearRing() as any\r\n    ).getCoordinates();\r\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\r\n    this.clearOlLinearRingsSource();\r\n    this.end$.next(this.getOlGeometry());\r\n    this.unsubscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Add a linear ring to the geometry being modified\r\n   * @param coordinates Linear ring coordinates\r\n   */\r\n  private addLinearRingToOlGeometry(coordinates: number[]) {\r\n    const olGeometry = this.getOlGeometry() as OlPolygon;\r\n    const olLinearRing = new OlLinearRing(coordinates);\r\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\r\n  }\r\n\r\n  /**\r\n   * Update the last linear ring of the geometry being modified\r\n   * @param coordinates Linear ring coordinates\r\n   */\r\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\r\n    const olGeometry = this.getOlGeometry() as OlPolygon;\r\n    // Remove the last linear ring (the one we are updating)\r\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\r\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\r\n      return olLinearRing.getCoordinates();\r\n    });\r\n    newCoordinates.push(coordinates);\r\n    olGeometry.setCoordinates(newCoordinates);\r\n  }\r\n\r\n  /**\r\n   * Get the geometry being modified\r\n   * @returns OL Geometry\r\n   */\r\n  private getOlGeometry(): OlGeometry {\r\n    const olFeatures = this.olOverlaySource.getFeatures();\r\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\r\n  }\r\n}\r\n","<h3 mat-dialog-title>{{ 'igo.geo.measure.dialog.title' | translate }}</h3>\n<div mat-dialog-content>\n  <table *ngIf=\"data.length > 0\" class=\"mat-typography\">\n    <thead>\n      <tr>\n        <th colspan=\"2\">\n          {{ 'igo.geo.measure.dialog.length.title' | translate }}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Meters }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInMeters' | translate }}</td>\n      </tr>\n      <tr>\n        <td>\n          {{ data.length | measureFormat: measureLengthUnit.Kilometers }}\n        </td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInKilometers' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Miles }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInMiles' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Feet }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInFeet' | translate }}</td>\n      </tr>\n    </tbody>\n  </table>\n\n  <table *ngIf=\"data.area > 0\" class=\"mat-typography\">\n    <thead>\n      <tr>\n        <th colspan=\"2\">\n          {{ 'igo.geo.measure.dialog.area.title' | translate }}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMeters }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMeters' | translate }}</td>\n      </tr>\n      <tr>\n        <td>\n          {{ data.area | measureFormat: measureAreaUnit.SquareKilometers }}\n        </td>\n        <td>\n          {{ 'igo.geo.measure.dialog.areaInSquareKilometers' | translate }}\n        </td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMiles }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMiles' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.Acres }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInAcres' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.Hectares }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInHectares' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ 'igo.geo.measure.dialog.perimeterInMeters' | translate }}</td>\n        <td>{{ data.perimeter | measureFormat: measureLengthUnit.Meters }}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n","import { Component, Inject } from '@angular/core';\r\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\r\n\r\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\r\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\r\n\r\n@Component({\r\n  selector: 'igo-measurer-dialog',\r\n  templateUrl: 'measurer-dialog.component.html',\r\n  styleUrls: ['./measurer-dialog.component.scss']\r\n})\r\nexport class MeasurerDialogComponent {\r\n  measureAreaUnit = MeasureAreaUnit;\r\n\r\n  measureLengthUnit = MeasureLengthUnit;\r\n\r\n  constructor(\r\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\r\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\r\n  ) {}\r\n\r\n  onNoClick(): void {\r\n    this.dialogRef.close();\r\n  }\r\n}\r\n","<div>\r\n  <div class=\"measure-type-toggle mat-typography\">\r\n    <mat-button-toggle-group\r\n      [value]=\"activeMeasureType\"\r\n      (change)=\"onMeasureTypeChange($event.value)\"\r\n    >\r\n      <mat-button-toggle [value]=\"measureType.Length\">\r\n        {{ 'igo.geo.measure.' + measureType.Length | translate }}\r\n      </mat-button-toggle>\r\n      <mat-button-toggle [value]=\"measureType.Area\">\r\n        {{ 'igo.geo.measure.' + measureType.Area | translate }}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class=\"measure-options mat-typography\">\r\n    <mat-slide-toggle\r\n      [disabled]=\"drawControlIsDisabled\"\r\n      [checked]=\"drawControlIsActive\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDrawControl($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleActive' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-divider *ngIf=\"hasLine$ | async\"></mat-divider>\r\n\r\n    <mat-slide-toggle\r\n      *ngIf=\"hasLine$ | async\"\r\n      [checked]=\"displayLines\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDisplayLines($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleDisplayLines' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\r\n\r\n    <mat-slide-toggle\r\n      *ngIf=\"hasArea$ | async\"\r\n      [checked]=\"displayDistance\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDisplayDistance($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleDisplayDistance' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      *ngIf=\"hasArea$ | async\"\r\n      [checked]=\"displayAreas\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDisplayAreas($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleDisplayAreas' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-divider *ngIf=\"hasArea$ | async\"></mat-divider>\r\n\r\n    <mat-slide-toggle\r\n      [checked]=\"measureUnitsAuto\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.measure.toggleAutoUnits' | translate }}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <ng-container *ngIf=\"measure$ | async as measure\">\r\n    <igo-measurer-item\r\n      *ngIf=\"\r\n        activeMeasureType === measureType.Length ||\r\n        activeMeasureType === measureType.Area\r\n      \"\r\n      [measureType]=\"measureType.Length\"\r\n      [measureUnit]=\"measureLengthUnit.Meters\"\r\n      [measure]=\"measure.length\"\r\n      [auto]=\"measureUnitsAuto\"\r\n      [placeholder]=\"\r\n        (activeMeasureType === measureType.Area\r\n          ? 'igo.geo.measure.perimeter'\r\n          : 'igo.geo.measure.length'\r\n        ) | translate\r\n      \"\r\n      (measureUnitChange)=\"onLengthUnitChange($event)\"\r\n    >\r\n    </igo-measurer-item>\r\n\r\n    <igo-measurer-item\r\n      *ngIf=\"activeMeasureType === measureType.Area\"\r\n      [measureType]=\"measureType.Area\"\r\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\r\n      [measure]=\"measure.area\"\r\n      [auto]=\"measureUnitsAuto\"\r\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\r\n      (measureUnitChange)=\"onAreaUnitChange($event)\"\r\n    >\r\n    </igo-measurer-item>\r\n  </ng-container>\r\n\r\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\r\n\r\n  <div class=\"measure-store-buttons\">\r\n    <button\r\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\r\n      color=\"accent\"\r\n      (click)=\"onCalculateClick()\"\r\n    >\r\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\r\n      color=\"warn\"\r\n      (click)=\"onDeleteClick()\"\r\n    >\r\n      <mat-icon svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n\r\n    <!--button\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\r\n      (click)=\"onModifyClick()\">\r\n      <mat-icon svgIcon=\"edit\"></mat-icon>\r\n    </button-->\r\n  </div>\r\n\r\n  <igo-entity-table\r\n    #table\r\n    class=\"table-compact\"\r\n    [store]=\"store\"\r\n    [template]=\"tableTemplate\"\r\n  >\r\n  </igo-entity-table>\r\n</div>\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\r\nimport type { EntityTableComponent } from '@igo2/common';\r\nimport { LanguageService, StorageScope, StorageService } from '@igo2/core';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport { unByKey } from 'ol/Observable';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\r\nimport OlStyle from 'ol/style/Style';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { skip } from 'rxjs/operators';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport {\r\n  FEATURE,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  tryAddLoadingStrategy,\r\n  tryAddSelectionStrategy,\r\n  tryBindStoreLayer\r\n} from '../../feature';\r\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\nimport {\r\n  MeasureAreaUnit,\r\n  MeasureLengthUnit,\r\n  MeasureType\r\n} from '../shared/measure.enum';\r\nimport {\r\n  FeatureWithMeasure,\r\n  Measure,\r\n  MeasurerDialogData\r\n} from '../shared/measure.interfaces';\r\nimport {\r\n  createMeasureInteractionStyle,\r\n  createMeasureLayerStyle,\r\n  formatMeasure,\r\n  getTooltipsOfOlGeometry,\r\n  measureOlGeometry,\r\n  metersToUnit,\r\n  squareMetersToUnit,\r\n  updateOlTooltipAtCenter,\r\n  updateOlTooltipsAtMidpoints\r\n} from '../shared/measure.utils';\r\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\r\n\r\n/**\r\n * Tool to measure lengths and areas\r\n */\r\n@Component({\r\n  selector: 'igo-measurer',\r\n  templateUrl: './measurer.component.html',\r\n  styleUrls: ['./measurer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Table template\r\n   * @internal\r\n   */\r\n  public tableTemplate: EntityTableTemplate;\r\n\r\n  private subscriptions$$: Subscription[] = [];\r\n\r\n  /**\r\n   * Reference to the MeasureType enum\r\n   * @internal\r\n   */\r\n  public measureType = MeasureType;\r\n\r\n  /**\r\n   * Reference to the AreaMeasureUnit enum\r\n   * @internal\r\n   */\r\n  public measureAreaUnit = MeasureAreaUnit;\r\n\r\n  /**\r\n   * Reference to the LengthMeasureUnit enum\r\n   * @internal\r\n   */\r\n  public measureLengthUnit = MeasureLengthUnit;\r\n\r\n  /**\r\n   * Whether measure units should be automatically determined\r\n   * @internal\r\n   */\r\n  public measureUnitsAuto: boolean = false;\r\n\r\n  /**\r\n   * Whether display of distances of areas\r\n   * @internal\r\n   */\r\n  public displayDistance: boolean = true;\r\n\r\n  /**\r\n   * Whether display of distances of lines\r\n   * @internal\r\n   */\r\n  public displayLines: boolean = true;\r\n\r\n  /**\r\n   * Whether display of areas\r\n   * @internal\r\n   */\r\n  public displayAreas: boolean = true;\r\n\r\n  /**\r\n   * Observable of line boolean\r\n   * @internal\r\n   */\r\n  public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Observable of area boolean\r\n   * @internal\r\n   */\r\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Observable of area\r\n   * @internal\r\n   */\r\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\r\n\r\n  /**\r\n   * Observable of selected features\r\n   * @internal\r\n   */\r\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> =\r\n    new BehaviorSubject([]);\r\n\r\n  /**\r\n   * OL draw source\r\n   * @internal\r\n   */\r\n  public showTooltips: boolean = true;\r\n\r\n  /**\r\n   * Whether draw control toggle is disabled or not\r\n   * @internal\r\n   */\r\n  public drawControlIsDisabled: boolean = true;\r\n\r\n  /**\r\n   * Draw line control\r\n   */\r\n  private drawLineControl: DrawControl;\r\n\r\n  /**\r\n   * Draw polygon control\r\n   */\r\n  private drawPolygonControl: DrawControl;\r\n\r\n  /**\r\n   * Modify control\r\n   */\r\n  private modifyControl: ModifyControl;\r\n\r\n  /**\r\n   * Active OL geometry\r\n   */\r\n  private activeOlGeometry: OlLineString | OlPolygon;\r\n\r\n  /**\r\n   * Active mlength unit\r\n   */\r\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n\r\n  /**\r\n   * Active area unit\r\n   */\r\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\r\n\r\n  /**\r\n   * Feature added listener key\r\n   */\r\n  private onFeatureAddedKey;\r\n\r\n  /**\r\n   * Feature removed listener key\r\n   */\r\n  private onFeatureRemovedKey;\r\n\r\n  /**\r\n   * Active draw control\r\n   * @internal\r\n   */\r\n  private activeDrawControl: DrawControl;\r\n\r\n  /**\r\n   * Subscription to draw start\r\n   */\r\n  private drawStart$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to draw end\r\n   */\r\n  private drawEnd$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to controls changes\r\n   */\r\n  private drawChanges$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to modify start\r\n   */\r\n  private modifyStart$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to modify end\r\n   */\r\n  private modifyEnd$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to controls changes\r\n   */\r\n  private modifyChanges$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to measures selection\r\n   */\r\n  private selectedFeatures$$: Subscription;\r\n\r\n  /**\r\n   * OL draw source\r\n   */\r\n  private olDrawSource = new OlVectorSource();\r\n\r\n  /**\r\n   * The map to measure on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The measures store\r\n   */\r\n  @Input() store: FeatureStore<FeatureWithMeasure>;\r\n\r\n  /**\r\n   * Measure type\r\n   * @internal\r\n   */\r\n  @Input()\r\n  set activeMeasureType(value: MeasureType) {\r\n    this.setActiveMeasureType(value);\r\n  }\r\n  get activeMeasureType(): MeasureType {\r\n    return this._activeMeasureType;\r\n  }\r\n  private _activeMeasureType: MeasureType;\r\n\r\n  /**\r\n   * The minimum length a segment must have to display a tooltip.\r\n   * It also applies to area tooltips.\r\n   */\r\n  @Input() minSegmentLength: number = 10;\r\n\r\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\r\n\r\n  /**\r\n   * Wheter one of the draw control is active\r\n   * @internal\r\n   */\r\n  get drawControlIsActive(): boolean {\r\n    return this.activeDrawControl !== undefined;\r\n  }\r\n\r\n  get projection(): string {\r\n    return this.map.ol.getView().getProjection().getCode();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dialog: MatDialog,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.tableTemplate = {\r\n      selection: true,\r\n      selectMany: true,\r\n      selectionCheckbox: true,\r\n      sort: true,\r\n      columns: [\r\n        {\r\n          name: 'length',\r\n          title: this.languageService.translate.instant(\r\n            'igo.geo.measure.lengthHeader'\r\n          ),\r\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\r\n            const unit = this.activeLengthUnit;\r\n            const measure = metersToUnit(\r\n              localFeature.properties.measure.length,\r\n              unit\r\n            );\r\n            return formatMeasure(measure, {\r\n              decimal: 1,\r\n              unit,\r\n              unitAbbr: false,\r\n              locale: 'fr'\r\n            });\r\n          }\r\n        },\r\n        {\r\n          name: 'area',\r\n          title: this.languageService.translate.instant(\r\n            'igo.geo.measure.areaHeader'\r\n          ),\r\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\r\n            const unit = this.activeAreaUnit;\r\n            const measure = squareMetersToUnit(\r\n              localFeature.properties.measure.area,\r\n              unit\r\n            );\r\n            return measure\r\n              ? formatMeasure(measure, {\r\n                  decimal: 1,\r\n                  unit,\r\n                  unitAbbr: false,\r\n                  locale: 'fr'\r\n                })\r\n              : '';\r\n          }\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add draw controls and activate one\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.initStore();\r\n    this.createDrawLineControl();\r\n    this.createDrawPolygonControl();\r\n    this.createModifyControl();\r\n    this.toggleDrawControl();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    this.checkDistanceAreaToggle();\r\n    this.setActiveMeasureType(MeasureType.Length);\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer and any interaction added by this component.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.setActiveMeasureType(undefined);\r\n    this.deactivateModifyControl();\r\n    this.freezeStore();\r\n    this.subscriptions$$.map((s) => s.unsubscribe());\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onMeasureTypeChange(measureType: MeasureType) {\r\n    this.activeMeasureType = measureType;\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current draw control\r\n   * @internal\r\n   */\r\n  onToggleDrawControl(toggle: boolean) {\r\n    if (toggle === true) {\r\n      this.toggleDrawControl();\r\n    } else {\r\n      this.deactivateDrawControl();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current draw control\r\n   * @internal\r\n   */\r\n  onToggleMeasureUnitsAuto(toggle: boolean) {\r\n    this.measureUnitsAuto = toggle;\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of the areas\r\n   * @internal\r\n   */\r\n  onToggleDisplayDistance(toggle: boolean) {\r\n    this.displayDistance = toggle;\r\n    this.onDisplayDistance();\r\n    toggle\r\n      ? this.storageService.set('distanceToggle', true, StorageScope.SESSION)\r\n      : this.storageService.set('distanceToggle', false, StorageScope.SESSION);\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of the lines\r\n   * @internal\r\n   */\r\n  onToggleDisplayLines(toggle: boolean) {\r\n    this.displayLines = toggle;\r\n    this.onDisplayLines();\r\n    toggle\r\n      ? this.storageService.set('linesToggle', true, StorageScope.SESSION)\r\n      : this.storageService.set('linesToggle', false, StorageScope.SESSION);\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of areas\r\n   * @internal\r\n   */\r\n  onToggleDisplayAreas(toggle: boolean) {\r\n    this.displayAreas = toggle;\r\n    this.onDisplayAreas();\r\n    toggle\r\n      ? this.storageService.set('areasToggle', true, StorageScope.SESSION)\r\n      : this.storageService.set('areasToggle', false, StorageScope.SESSION);\r\n  }\r\n\r\n  /**\r\n   * Set display parametres in current values\r\n   * @internal\r\n   */\r\n  checkDistanceAreaToggle() {\r\n    if (this.storageService.get('distanceToggle') === false) {\r\n      this.displayDistance = false;\r\n    }\r\n    if (this.storageService.get('linesToggle') === false) {\r\n      this.displayLines = false;\r\n    }\r\n    if (this.storageService.get('areasToggle') === false) {\r\n      this.displayAreas = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of areas\r\n   * @internal\r\n   */\r\n  onDisplayDistance() {\r\n    if (this.displayDistance) {\r\n      Array.from(\r\n        document.getElementsByClassName(\r\n          'igo-map-tooltip-measure-polygone-segments'\r\n        )\r\n      ).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-hidden')\r\n      );\r\n    } else {\r\n      Array.from(\r\n        document.getElementsByClassName(\r\n          'igo-map-tooltip-measure-polygone-segments'\r\n        )\r\n      ).map((value: Element) => value.classList.add('igo-map-tooltip-hidden'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of distances of lines\r\n   * @internal\r\n   */\r\n  onDisplayLines() {\r\n    if (this.displayLines) {\r\n      Array.from(\r\n        document.getElementsByClassName('igo-map-tooltip-measure-line-segments')\r\n      ).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-hidden')\r\n      );\r\n    } else {\r\n      Array.from(\r\n        document.getElementsByClassName('igo-map-tooltip-measure-line-segments')\r\n      ).map((value: Element) => value.classList.add('igo-map-tooltip-hidden'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current display of areas\r\n   * @internal\r\n   */\r\n  onDisplayAreas() {\r\n    if (this.displayAreas) {\r\n      Array.from(\r\n        document.getElementsByClassName('igo-map-tooltip-measure-area')\r\n      ).map((value: Element) =>\r\n        value.classList.remove('igo-map-tooltip-hidden')\r\n      );\r\n    } else {\r\n      Array.from(\r\n        document.getElementsByClassName('igo-map-tooltip-measure-area')\r\n      ).map((value: Element) => value.classList.add('igo-map-tooltip-hidden'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onLengthUnitChange(unit: MeasureLengthUnit) {\r\n    this.activeLengthUnit = unit;\r\n    this.table.refresh();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onAreaUnitChange(unit: MeasureAreaUnit) {\r\n    this.activeAreaUnit = unit;\r\n    this.table.refresh();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n  }\r\n\r\n  onCalculateClick() {\r\n    const features = this.selectedFeatures$.value;\r\n    const area = features.reduce(\r\n      (sum: number, localFeature: FeatureWithMeasure) => {\r\n        return sum + localFeature.properties.measure.area || 0;\r\n      },\r\n      0\r\n    );\r\n    const length = features.reduce(\r\n      (sum: number, localFeature: FeatureWithMeasure) => {\r\n        if (localFeature.geometry.type === 'Polygon') {\r\n          return sum;\r\n        }\r\n        return sum + localFeature.properties.measure.length || 0;\r\n      },\r\n      0\r\n    );\r\n    const perimeter = features.reduce(\r\n      (sum: number, localFeature: FeatureWithMeasure) => {\r\n        if (localFeature.geometry.type === 'LineString') {\r\n          return sum;\r\n        }\r\n        return sum + localFeature.properties.measure.length || 0;\r\n      },\r\n      0\r\n    );\r\n\r\n    this.openDialog({\r\n      area,\r\n      length,\r\n      perimeter\r\n    });\r\n  }\r\n\r\n  onDeleteClick() {\r\n    this.store.deleteMany(this.selectedFeatures$.value);\r\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\r\n      this.olDrawSource.getFeatures().forEach((drawingLayerFeature) => {\r\n        const geometry = drawingLayerFeature.getGeometry() as any;\r\n        if (selectedFeature.properties.id === geometry.ol_uid) {\r\n          this.olDrawSource.removeFeature(drawingLayerFeature);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  onModifyClick() {\r\n    if (this.selectedFeatures$.value.length !== 1) {\r\n      return;\r\n    }\r\n\r\n    if (this.modifyControl.active === true) {\r\n      this.deactivateModifyControl();\r\n      this.toggleDrawControl();\r\n    } else {\r\n      const localFeature = this.selectedFeatures$.value[0];\r\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\r\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\r\n        return _olFeature.get('id') === localFeature.properties.id;\r\n      });\r\n\r\n      if (olFeature !== undefined) {\r\n        this.deactivateDrawControl();\r\n        this.activateModifyControl();\r\n\r\n        const olGeometry = olFeature.getGeometry();\r\n        this.clearTooltipsOfOlGeometry(olGeometry as OlLineString | OlPolygon);\r\n        this.modifyControl.setOlGeometry(olGeometry);\r\n      }\r\n    }\r\n  }\r\n\r\n  private openDialog(data: MeasurerDialogData): void {\r\n    this.dialog.open(MeasurerDialogComponent, { data });\r\n  }\r\n\r\n  /**\r\n   * Initialize the measure store and set up some listeners\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      title: this.languageService.translate.instant(\r\n        'igo.geo.measure.layerTitle'\r\n      ),\r\n      isIgoInternalLayer: true,\r\n      id: `igo-measures-${uuid()}`,\r\n      zIndex: 200,\r\n      source: new FeatureDataSource(),\r\n      style: createMeasureLayerStyle(),\r\n      showInLayerList: true,\r\n      exportable: true,\r\n      browsable: false,\r\n      workspace: { enabled: false }\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n    store.layer.visible = true;\r\n    layer.visible$.subscribe((visible) => {\r\n      if (visible) {\r\n        Array.from(\r\n          document.getElementsByClassName('igo-map-tooltip-measure')\r\n        ).map((value: Element) =>\r\n          value.classList.remove('igo-map-tooltip-measure-by-display')\r\n        );\r\n      } else {\r\n        Array.from(\r\n          document.getElementsByClassName('igo-map-tooltip-measure')\r\n        ).map((value: Element) =>\r\n          value.classList.add('igo-map-tooltip-measure-by-display')\r\n        );\r\n      }\r\n    });\r\n\r\n    tryAddLoadingStrategy(store);\r\n\r\n    tryAddSelectionStrategy(\r\n      store,\r\n      new FeatureStoreSelectionStrategy({\r\n        map: this.map,\r\n        many: true\r\n      })\r\n    );\r\n\r\n    this.onFeatureAddedKey = store.source.ol.on(\r\n      'addfeature',\r\n      (event: OlVectorSourceEvent<OlGeometry>) => {\r\n        const localFeature = event.feature;\r\n        const olGeometry = localFeature.getGeometry() as any;\r\n        this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\r\n        this.onDisplayDistance();\r\n      }\r\n    );\r\n\r\n    this.onFeatureRemovedKey = store.source.ol.on(\r\n      'removefeature',\r\n      (event: OlVectorSourceEvent<OlGeometry>) => {\r\n        const olGeometry = event.feature.getGeometry() as any;\r\n        this.clearTooltipsOfOlGeometry(olGeometry);\r\n      }\r\n    );\r\n\r\n    this.selectedFeatures$$ = store.stateView\r\n      .manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\r\n        return record.state.selected === true;\r\n      })\r\n      .pipe(\r\n        skip(1) // Skip initial emission\r\n      )\r\n      .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\r\n        if (this.modifyControl.active === true) {\r\n          this.deactivateModifyControl();\r\n        }\r\n        this.selectedFeatures$.next(records.map((record) => record.entity));\r\n      });\r\n\r\n    this.subscriptions$$.push(\r\n      this.store.entities$.subscribe((objectsExists) => {\r\n        if (\r\n          objectsExists.find(\r\n            (objectExist) => objectExist.geometry.type === 'Polygon'\r\n          )\r\n        ) {\r\n          this.hasArea$.next(true);\r\n        } else {\r\n          this.hasArea$.next(false);\r\n        }\r\n\r\n        if (\r\n          objectsExists.find(\r\n            (objectExist) => objectExist.geometry.type === 'LineString'\r\n          )\r\n        ) {\r\n          this.hasLine$.next(true);\r\n        } else {\r\n          this.hasLine$.next(false);\r\n        }\r\n      })\r\n    );\r\n\r\n    this.subscriptions$$.push(\r\n      this.store.count$.subscribe((cnt) => {\r\n        cnt >= 1\r\n          ? (this.store.layer.options.showInLayerList = true)\r\n          : (this.store.layer.options.showInLayerList = false);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\r\n   * and some listener removed\r\n   * @internal\r\n   */\r\n  private freezeStore() {\r\n    const store = this.store;\r\n    this.selectedFeatures$$.unsubscribe();\r\n    unByKey(this.onFeatureAddedKey);\r\n    unByKey(this.onFeatureRemovedKey);\r\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\r\n  }\r\n\r\n  /**\r\n   * Create a draw line control\r\n   */\r\n  private createDrawLineControl() {\r\n    this.drawLineControl = new DrawControl({\r\n      geometryType: 'LineString',\r\n      drawingLayerSource: this.olDrawSource,\r\n      interactionStyle: createMeasureInteractionStyle(),\r\n      drawingLayerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a draw polygon control\r\n   */\r\n  private createDrawPolygonControl() {\r\n    this.drawPolygonControl = new DrawControl({\r\n      geometryType: 'Polygon',\r\n      drawingLayerSource: this.olDrawSource,\r\n      interactionStyle: createMeasureInteractionStyle(),\r\n      drawingLayerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a draw polygon control\r\n   */\r\n  private createModifyControl() {\r\n    this.modifyControl = new ModifyControl({\r\n      source: this.olDrawSource,\r\n      drawStyle: createMeasureInteractionStyle(),\r\n      layerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate the right control\r\n   */\r\n  private toggleDrawControl() {\r\n    this.deactivateDrawControl();\r\n    // this.deactivateModifyControl();\r\n    if (this.activeMeasureType === MeasureType.Length) {\r\n      this.activateDrawControl(this.drawLineControl);\r\n    } else if (this.activeMeasureType === MeasureType.Area) {\r\n      this.activateDrawControl(this.drawPolygonControl);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param drawControl Draw control\r\n   */\r\n  private activateDrawControl(drawControl: DrawControl) {\r\n    this.drawControlIsDisabled = false;\r\n    this.activeDrawControl = drawControl;\r\n    this.drawStart$$ = drawControl.start$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry)\r\n    );\r\n    this.drawEnd$$ = drawControl.end$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry)\r\n    );\r\n    this.drawChanges$$ = drawControl.changes$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry)\r\n    );\r\n    this.drawChanges$$ = drawControl.abort$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => {\r\n        this.clearTooltipsOfOlGeometry(olGeometry);\r\n        this.clearMeasures();\r\n      }\r\n    );\r\n    drawControl.setOlMap(this.map.ol, false);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active draw control\r\n   */\r\n  private deactivateDrawControl() {\r\n    if (this.activeDrawControl === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.olDrawSource.clear();\r\n    if (this.drawStart$$ !== undefined) {\r\n      this.drawStart$$.unsubscribe();\r\n    }\r\n    if (this.drawEnd$$ !== undefined) {\r\n      this.drawEnd$$.unsubscribe();\r\n    }\r\n    if (this.drawChanges$$ !== undefined) {\r\n      this.drawChanges$$.unsubscribe();\r\n    }\r\n\r\n    this.clearTooltipsOfOlSource(this.olDrawSource);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n    this.activeDrawControl.setOlMap(undefined);\r\n    this.activeDrawControl = undefined;\r\n    this.activeOlGeometry = undefined;\r\n  }\r\n\r\n  private setActiveMeasureType(measureType: MeasureType) {\r\n    this._activeMeasureType = measureType;\r\n    this.clearMeasures();\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being drawn\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\r\n    this.activeOlGeometry = olGeometry;\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\r\n    this.activeOlGeometry = undefined;\r\n    this.finalizeMeasureOfOlGeometry(olGeometry);\r\n    this.addFeatureToStore(olGeometry);\r\n    this.clearTooltipsOfOlGeometry(olGeometry);\r\n    this.olDrawSource.clear(true);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = measureOlGeometry(olGeometry, this.projection);\r\n    this.updateMeasureOfOlGeometry(\r\n      olGeometry,\r\n      Object.assign({}, measure, {\r\n        area: undefined // We don't want to display an area tooltip while drawing.\r\n      })\r\n    );\r\n    this.measure$.next(measure);\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param modifyControl Modify control\r\n   */\r\n  private activateModifyControl() {\r\n    const selection = this.store.getStrategyOfType(\r\n      FeatureStoreSelectionStrategy\r\n    ) as FeatureStoreSelectionStrategy;\r\n    selection.deactivate();\r\n    selection.clear();\r\n\r\n    this.modifyStart$$ = this.modifyControl.start$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry)\r\n    );\r\n    this.modifyEnd$$ = this.modifyControl.end$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry)\r\n    );\r\n    this.modifyChanges$$ = this.modifyControl.changes$.subscribe(\r\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry)\r\n    );\r\n    this.modifyControl.setOlMap(this.map.ol);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active modify control\r\n   */\r\n  private deactivateModifyControl() {\r\n    if (this.modifyStart$$ !== undefined) {\r\n      this.modifyStart$$.unsubscribe();\r\n    }\r\n    if (this.modifyEnd$$ !== undefined) {\r\n      this.modifyEnd$$.unsubscribe();\r\n    }\r\n    if (this.modifyChanges$$ !== undefined) {\r\n      this.modifyChanges$$.unsubscribe();\r\n    }\r\n\r\n    if (this.activeOlGeometry !== undefined) {\r\n      if (this.selectedFeatures$.value.length === 1) {\r\n        const localFeature = this.selectedFeatures$.value[0];\r\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\r\n      }\r\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n\r\n    this.olDrawSource.clear();\r\n\r\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\r\n\r\n    this.activeOlGeometry = undefined;\r\n    this.modifyControl.setOlMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being drawn\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\r\n    this.onDrawStart(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\r\n    this.onDrawChanges(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\r\n    this.finalizeMeasureOfOlGeometry(olGeometry);\r\n  }\r\n\r\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = measureOlGeometry(olGeometry, this.projection);\r\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables\r\n   * @param olGeometry Ol linestring or polygon\r\n   * @param measure Measure\r\n   */\r\n  private updateMeasureOfOlGeometry(\r\n    olGeometry: OlLineString | OlPolygon,\r\n    measure: Measure\r\n  ) {\r\n    olGeometry.setProperties({ _measure: measure }, true);\r\n    this.updateTooltipsOfOlGeometry(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Clear the measures observables\r\n   */\r\n  private clearMeasures() {\r\n    this.measure$.next({});\r\n  }\r\n\r\n  /**\r\n   * Add a feature with measures to the store. The loading stragegy of the store\r\n   * will trigger and add the feature to the map.\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\r\n    const featureId = localFeature\r\n      ? localFeature.properties.id\r\n      : olGeometry.ol_uid;\r\n    const projection = this.map.ol.getView().getProjection();\r\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\r\n      featureProjection: projection,\r\n      dataProjection: projection\r\n    }) as any;\r\n    this.store.update({\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: projection.getCode(),\r\n      properties: {\r\n        id: featureId,\r\n        measure: olGeometry.get('_measure')\r\n      },\r\n      meta: {\r\n        id: featureId\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update all the tooltips of an OL geometry\r\n   * @param olGeometry OL Geometry\r\n   * @param lengths Lengths of the OL geometry's segments\r\n   * @param measureUnit Display tooltip measure in those units\r\n   */\r\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = olGeometry.get('_measure');\r\n    const lengths = measure.lengths;\r\n    const area = measure.area;\r\n\r\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\r\n    if (lengths.length === olMidpointsTooltips.length) {\r\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\r\n        const length = lengths[i];\r\n        if (length !== undefined) {\r\n          this.updateOlTooltip(\r\n            olMidpointsTooltips[i],\r\n            metersToUnit(length, this.activeLengthUnit),\r\n            this.activeLengthUnit,\r\n            MeasureType.Length\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    if (area !== undefined) {\r\n      this.updateOlTooltip(\r\n        updateOlTooltipAtCenter(olGeometry),\r\n        squareMetersToUnit(area, this.activeAreaUnit),\r\n        this.activeAreaUnit,\r\n        MeasureType.Area\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of a geoemtry\r\n   */\r\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach(\r\n      (olTooltip: OlOverlay | undefined) => {\r\n        if (this.shouldShowTooltip(olTooltip)) {\r\n          this.map.ol.addOverlay(olTooltip);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Clear the tooltips of an OL geometrys\r\n   * @param olGeometry OL geometry with tooltips\r\n   */\r\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach(\r\n      (olTooltip: OlOverlay | undefined) => {\r\n        if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\r\n          this.map.ol.removeOverlay(olTooltip);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of all the geometries of a source\r\n   */\r\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\r\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\r\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of all the geometries of a source\r\n   */\r\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\r\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\r\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the map tooltips\r\n   * @param olDrawSource OL vector source\r\n   */\r\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\r\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\r\n      const olGeometry = olFeature.getGeometry();\r\n      if (olGeometry !== undefined) {\r\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\r\n   * @param olTooltip OL tooltip\r\n   * @param measure The measure valeu ti display\r\n   * @param measureUnit Display tooltip measure in those units\r\n   */\r\n  private updateOlTooltip(\r\n    olTooltip: OlOverlay,\r\n    measure: number,\r\n    unit: MeasureAreaUnit | MeasureLengthUnit,\r\n    type: MeasureType\r\n  ) {\r\n    olTooltip.setProperties(\r\n      { _measure: measure, _unit: unit, _type: type },\r\n      true\r\n    );\r\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\r\n    if (this.shouldShowTooltip(olTooltip)) {\r\n      this.map.ol.addOverlay(olTooltip);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compute a tooltip's content\r\n   * @param olTooltip OL overlay\r\n   * @returns Inner HTML\r\n   */\r\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\r\n    const properties = olTooltip.getProperties() as any;\r\n    return formatMeasure(\r\n      properties._measure,\r\n      {\r\n        decimal: 1,\r\n        unit: properties._unit,\r\n        unitAbbr: true,\r\n        locale: 'fr'\r\n      },\r\n      this.languageService\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Whether a tooltip should be showned based on the length\r\n   * of the segment it is bound to.\r\n   * @param olTooltip OL overlay\r\n   * @returns True if the tooltip should be shown\r\n   */\r\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\r\n    if (this.showTooltips === false) {\r\n      return false;\r\n    }\r\n\r\n    const properties = olTooltip.getProperties() as any;\r\n    const measure = properties._measure;\r\n    if (measure === undefined) {\r\n      return false;\r\n    }\r\n\r\n    if (properties._unit === MeasureType.Length) {\r\n      const minSegmentLength =\r\n        metersToUnit(this.minSegmentLength, properties._unit) || 0;\r\n      return measure > Math.max(minSegmentLength, 0);\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\r\nimport {\r\n  formatMeasure,\r\n  metersToUnit,\r\n  squareMetersToUnit\r\n} from '../shared/measure.utils';\r\n\r\n/**\r\n * This pipe returns a measure converted from meters (or square meters)\r\n * to the specified unit. It also keeps a certain number of decimals.\r\n */\r\n@Pipe({\r\n  name: 'measureFormat'\r\n})\r\nexport class MeasureFormatPipe implements PipeTransform {\r\n  /**\r\n   * @ignore\r\n   */\r\n  transform(\r\n    value: number,\r\n    unit: MeasureAreaUnit | MeasureLengthUnit,\r\n    unitAbbr: boolean = false,\r\n    decimal: number = 1\r\n  ): number {\r\n    let out;\r\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\r\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\r\n    } else if (\r\n      Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0\r\n    ) {\r\n      out = metersToUnit(value, unit as MeasureLengthUnit);\r\n    }\r\n\r\n    return out\r\n      ? formatMeasure(out, {\r\n          decimal: 1,\r\n          unit,\r\n          unitAbbr,\r\n          locale: 'fr'\r\n        })\r\n      : out;\r\n  }\r\n}\r\n","<igo-geometry-form-field-input\r\n  [formControl]=\"formControl\"\r\n  [map]=\"map\"\r\n  [geometryType]=\"geometryType\"\r\n  [drawGuide]=\"drawGuide$ | async\"\r\n  [measure]=\"measure\"\r\n  [drawControlIsActive]=\"drawControlIsActive\"\r\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\r\n  [drawStyle]=\"drawStyle$ | async\"\r\n  [overlayStyle]=\"overlayStyle$ | async\"\r\n  [radius]=\"radius\"\r\n  [predefinedRadius]=\"predefinedRadius\"\r\n>\r\n</igo-geometry-form-field-input>\r\n\r\n<div class=\"header\">\r\n  <mat-slide-toggle\r\n    *ngIf=\"!isPredefined()\"\r\n    [checked]=\"drawControlIsActive\"\r\n    [labelPosition]=\"'before'\"\r\n    (change)=\"onDrawControlChange()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.drawControl' | translate }}\r\n  </mat-slide-toggle>\r\n  <mat-slide-toggle\r\n    *ngIf=\"!isPredefined()\"\r\n    [checked]=\"freehandDrawIsActive\"\r\n    [labelPosition]=\"'before'\"\r\n    (change)=\"onfreehandControlChange()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.freehandControl' | translate }}\r\n  </mat-slide-toggle>\r\n</div>\r\n\r\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\r\n  <form class=\"buffer-form\">\r\n    <mat-form-field class=\"buffer\">\r\n      <input\r\n        type=\"number\"\r\n        matInput\r\n        placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\r\n        [formControl]=\"bufferFormControl\"\r\n        [value]=\"0\"\r\n        [readonly]=\"this.formControl.value === null\"\r\n      />\r\n    </mat-form-field>\r\n  </form>\r\n\r\n  <mat-form-field class=\"unit-field\">\r\n    <mat-select\r\n      [value]=\"measureUnit\"\r\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\r\n    >\r\n      <mat-option\r\n        *ngFor=\"let measureUnit of measureUnits\"\r\n        [value]=\"measureUnit\"\r\n      >\r\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n</div>\r\n\r\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\r\n  <form class=\"radius-form\">\r\n    <mat-form-field class=\"radius\">\r\n      <input\r\n        type=\"number\"\r\n        matInput\r\n        placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\r\n        [formControl]=\"radiusFormControl\"\r\n        [value]=\"1000\"\r\n        (input)=\"getRadius()\"\r\n        [readonly]=\"\r\n          this.freehandDrawIsActive && this.formControl.value === null\r\n        \"\r\n      />\r\n    </mat-form-field>\r\n  </form>\r\n\r\n  <mat-form-field class=\"unit-field\">\r\n    <mat-select\r\n      [value]=\"measureUnit\"\r\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\r\n    >\r\n      <mat-option\r\n        *ngFor=\"let measureUnit of measureUnits\"\r\n        [value]=\"measureUnit\"\r\n      >\r\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n</div>\r\n\r\n<mat-label class=\"title mat-typography\"\r\n  >{{ 'igo.geo.spatialFilter.search' | translate }} :\r\n</mat-label>\r\n<mat-radio-group [value]=\"selectedItemType\">\r\n  <mat-radio-button\r\n    *ngFor=\"let item of itemType\"\r\n    [value]=\"item\"\r\n    (change)=\"onItemTypeChange($event)\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.' + item | translate }}\r\n  </mat-radio-button>\r\n</mat-radio-group>\r\n\r\n<div\r\n  class=\"thematics\"\r\n  *ngIf=\"\r\n    (selectedItemType === 'Thematics' && !tableTemplate) ||\r\n    (selectedItemType === 'Thematics' && tableTemplate && !listIsVisible)\r\n  \"\r\n>\r\n  <mat-table>\r\n    <!-- Name Column -->\r\n    <ng-container matColumnDef=\"name\">\r\n      <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{\r\n        'igo.geo.spatialFilter.Thematics' | translate\r\n      }}</mat-header-cell>\r\n    </ng-container>\r\n\r\n    <!-- Select Column -->\r\n    <ng-container matColumnDef=\"select\">\r\n      <mat-header-cell *matHeaderCellDef class=\"checks-header\">\r\n        <mat-checkbox\r\n          (change)=\"$event ? masterToggle() : null\"\r\n          [checked]=\"isAllSelected()\"\r\n          [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\"\r\n        >\r\n        </mat-checkbox>\r\n      </mat-header-cell>\r\n    </ng-container>\r\n\r\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\r\n    <mat-row *matRowDef=\"let row; columns: displayedColumns\"></mat-row>\r\n  </mat-table>\r\n\r\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\r\n    <!-- This is the tree node template for leaf nodes -->\r\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\r\n      <li class=\"mat-tree-node\">\r\n        <!-- use a disabled button to provide padding for tree leaf -->\r\n        <button mat-icon-button disabled></button>\r\n        {{ node.name }}\r\n        <mat-checkbox\r\n          class=\"tree-check\"\r\n          (click)=\"$event.stopPropagation()\"\r\n          (change)=\"$event ? onToggleChange(node) : null\"\r\n          [checked]=\"selectedThematics.isSelected(node)\"\r\n        >\r\n        </mat-checkbox>\r\n      </li>\r\n    </mat-tree-node>\r\n\r\n    <!-- This is the tree node template for expandable nodes -->\r\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\r\n      <div class=\"mat-tree-node\">\r\n        <button mat-icon-button (click)=\"onToggleClick(node)\">\r\n          <mat-icon\r\n            [svgIcon]=\"\r\n              treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\r\n            \"\r\n          ></mat-icon>\r\n        </button>\r\n        {{ node.name }}\r\n        <mat-checkbox\r\n          class=\"tree-check-2\"\r\n          (change)=\"$event ? childrensToggle(node) : null\"\r\n          [checked]=\"isAllSelected(node)\"\r\n          [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\"\r\n        >\r\n        </mat-checkbox>\r\n      </div>\r\n      <ul\r\n        class=\"tree-ul\"\r\n        [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\"\r\n      >\r\n        <ng-container matTreeNodeOutlet></ng-container>\r\n      </ul>\r\n    </mat-nested-tree-node>\r\n  </mat-tree>\r\n</div>\r\n\r\n<div class=\"buttons\">\r\n  <button\r\n    *ngIf=\"isPredefined()\"\r\n    mat-raised-button\r\n    class=\"clear-search-button\"\r\n    [disabled]=\"disabledClearSearch()\"\r\n    (click)=\"clearSearch()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.clearSearch' | translate }}\r\n  </button>\r\n\r\n  <button\r\n    *ngIf=\"isPolygon() || isPoint()\"\r\n    mat-raised-button\r\n    class=\"clear-form-button\"\r\n    [disabled]=\"this.formControl.value === null\"\r\n    (click)=\"clearDrawZone()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.clearForm' | translate }}\r\n  </button>\r\n\r\n  <button\r\n    mat-raised-button\r\n    class=\"search-button\"\r\n    [disabled]=\"disableSearchButton()\"\r\n    color=\"primary\"\r\n    (click)=\"toggleSearchButton()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.goSearch' | translate }}\r\n  </button>\r\n\r\n  <button\r\n    mat-raised-button\r\n    class=\"remove-button\"\r\n    [disabled]=\"allLayers.length === 0\"\r\n    (click)=\"clearButton()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.removeLayer' | translate }}\r\n  </button>\r\n\r\n  <button\r\n    mat-raised-button\r\n    class=\"export-button\"\r\n    [disabled]=\"!store.entities$.getValue().length\"\r\n    (click)=\"export.emit()\"\r\n  >\r\n    {{ 'igo.geo.spatialFilter.exportLayer' | translate }}\r\n  </button>\r\n</div>\r\n\r\n<button\r\n  class=\"chevron-down\"\r\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\r\n  mat-icon-button\r\n  matTooltipShowDelay=\"500\"\r\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\r\n  (click)=\"toggleVisibleList()\"\r\n>\r\n  <mat-icon svgIcon=\"chevron-down\"></mat-icon>\r\n</button>\r\n\r\n<div\r\n  class=\"results\"\r\n  *ngIf=\"store.all().length && tableTemplate && listIsVisible\"\r\n>\r\n  <button\r\n    *ngIf=\"listIsVisible\"\r\n    mat-icon-button\r\n    matTooltipShowDelay=\"500\"\r\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\r\n    (click)=\"toggleVisibleList()\"\r\n  >\r\n    <mat-icon svgIcon=\"chevron-up\"></mat-icon>\r\n  </button>\r\n  <igo-entity-table\r\n    class=\"results-list\"\r\n    [template]=\"tableTemplate\"\r\n    [store]=\"store\"\r\n    (entitySelectChange)=\"entityChange.emit($event)\"\r\n  >\r\n  </igo-entity-table>\r\n</div>\r\n","import { SelectionModel } from '@angular/cdk/collections';\r\nimport { NestedTreeControl } from '@angular/cdk/tree';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { UntypedFormControl } from '@angular/forms';\r\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\r\n\r\nimport {\r\n  EntityStoreFilterSelectionStrategy,\r\n  EntityStoreWithStrategy,\r\n  EntityTableColumnRenderer,\r\n  EntityTableTemplate\r\n} from '@igo2/common';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olStyle from 'ol/style';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { FeatureDataSource } from '../../../datasource/shared';\r\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\r\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\r\nimport { Layer, VectorLayer } from '../../../layer/shared';\r\nimport { IgoMap } from '../../../map/shared';\r\nimport { MeasureLengthUnit } from '../../../measure';\r\nimport {\r\n  SpatialFilterQueryType,\r\n  SpatialFilterType\r\n} from '../../shared/spatial-filter.enum';\r\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\r\nimport { Feature } from './../../../feature/shared/feature.interfaces';\r\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\r\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\r\n\r\n/**\r\n * Spatial-Filter-Item (search parameters)\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-item',\r\n  templateUrl: './spatial-filter-item.component.html',\r\n  styleUrls: ['./spatial-filter-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get type(): SpatialFilterType {\r\n    return this._type;\r\n  }\r\n  set type(type: SpatialFilterType) {\r\n    this._type = type;\r\n    const index = this.geometryTypes.findIndex((geom) => geom === this.type);\r\n    this.geometryType = this.geometryTypes[index];\r\n    this.formControl.reset();\r\n    this.radius = undefined;\r\n    this.drawGuide$.next(null);\r\n    this.drawStyle$.next(undefined);\r\n\r\n    // Necessary to keep reference to the geometry form field input\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      const geojson: GeoJSONGeometry = {\r\n        type: 'Point',\r\n        coordinates: ''\r\n      };\r\n      this.formControl.setValue(geojson);\r\n    }\r\n\r\n    // Necessary to apply the right style when geometry type is Point\r\n    if (this.type === SpatialFilterType.Point) {\r\n      this.radius = 1000; // Base radius\r\n      this.radiusFormControl.setValue(this.radius);\r\n      this.PointStyle = (\r\n        feature: OlFeature<OlGeometry>,\r\n        resolution: number\r\n      ) => {\r\n        const geom = feature.getGeometry() as OlPoint;\r\n        const coordinates = olproj.transform(\r\n          geom.getCoordinates(),\r\n          this.map.projection,\r\n          'EPSG:4326'\r\n        );\r\n        return new olStyle.Style({\r\n          image: new olStyle.Circle({\r\n            radius:\r\n              this.radius /\r\n              Math.cos((Math.PI / 180) * coordinates[1]) /\r\n              resolution, // Latitude correction\r\n            stroke: new olStyle.Stroke({\r\n              width: 2,\r\n              color: 'rgba(0, 153, 255)'\r\n            }),\r\n            fill: new olStyle.Fill({\r\n              color: 'rgba(0, 153, 255, 0.2)'\r\n            })\r\n          })\r\n        });\r\n      };\r\n      this.overlayStyle = this.PointStyle;\r\n      this.drawStyle$.next(this.overlayStyle);\r\n    } else {\r\n      // If geometry types is Polygon\r\n      this.radius = undefined;\r\n      this.PolyStyle = () => {\r\n        return new olStyle.Style({\r\n          stroke: new olStyle.Stroke({\r\n            width: 2,\r\n            color: 'rgba(0, 153, 255)'\r\n          }),\r\n          fill: new olStyle.Fill({\r\n            color: 'rgba(0, 153, 255, 0.2)'\r\n          })\r\n        });\r\n      };\r\n      const color = [0, 153, 255];\r\n      const drawStyle = () => {\r\n        return new olStyle.Style({\r\n          image: new olStyle.Circle({\r\n            radius: 8,\r\n            stroke: new olStyle.Stroke({\r\n              width: 2,\r\n              color: 'rgba(0, 153, 255)'\r\n            }),\r\n            fill: new olStyle.Fill({\r\n              color: 'rgba(0, 153, 255, 0.2)'\r\n            })\r\n          }),\r\n          stroke: new olStyle.Stroke({\r\n            color: color.concat([1]),\r\n            width: 2\r\n          }),\r\n          fill: new olStyle.Fill({\r\n            color: color.concat([0.2])\r\n          })\r\n        });\r\n      };\r\n      this.overlayStyle = this.PolyStyle;\r\n      this.drawStyle$.next(drawStyle);\r\n    }\r\n    this.overlayStyle$.next(this.overlayStyle);\r\n  }\r\n  private _type: SpatialFilterType;\r\n\r\n  @Input() queryType: SpatialFilterQueryType;\r\n\r\n  @Input() zone: Feature;\r\n\r\n  @Input() loading;\r\n\r\n  @Input()\r\n  get store(): EntityStoreWithStrategy<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStoreWithStrategy<Feature>) {\r\n    this._store = store;\r\n    this._store.entities$.subscribe(() => {\r\n      this.cdRef.detectChanges();\r\n    });\r\n  }\r\n  private _store: EntityStoreWithStrategy<Feature>;\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\r\n  }\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  @Input() allLayers: Layer[] = [];\r\n\r\n  @Input()\r\n  get thematicLength(): number {\r\n    return this._thematicLength;\r\n  }\r\n  set thematicLength(value: number) {\r\n    this._thematicLength = value;\r\n  }\r\n  private _thematicLength: number;\r\n\r\n  @Output() toggleSearch = new EventEmitter();\r\n\r\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\r\n\r\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\r\n\r\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\r\n\r\n  @Output() bufferEvent = new EventEmitter<number>();\r\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\r\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\r\n\r\n  @Output() radiusEvent = new EventEmitter<number>();\r\n  @Output() freehandControl = new EventEmitter<boolean>();\r\n  @Output() predefinedRadius = new EventEmitter<boolean>();\r\n\r\n  @Output() clearButtonEvent = new EventEmitter();\r\n\r\n  @Output() clearSearchEvent = new EventEmitter();\r\n\r\n  @Output() export = new EventEmitter();\r\n\r\n  @Output() openWorkspace = new EventEmitter();\r\n  @Output() entityChange = new EventEmitter<any>();\r\n\r\n  public itemType: SpatialFilterItemType[] = [\r\n    SpatialFilterItemType.Address,\r\n    SpatialFilterItemType.Thematics\r\n  ];\r\n  public selectedItemType: SpatialFilterItemType =\r\n    SpatialFilterItemType.Address;\r\n  public selectedSourceAddress;\r\n\r\n  treeControl: NestedTreeControl<SpatialFilterThematic> =\r\n    new NestedTreeControl<SpatialFilterThematic>((node) => node.children);\r\n\r\n  // For thematics and results tables\r\n  public displayedColumns: string[] = ['name', 'select'];\r\n  public childrens: SpatialFilterThematic[] = [];\r\n  public groups: string[] = [];\r\n  public thematics: SpatialFilterThematic[] = [];\r\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\r\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(\r\n    true,\r\n    []\r\n  );\r\n\r\n  // For geometry form field input\r\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\r\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\r\n  overlayStyle$: BehaviorSubject<\r\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\r\n  > = new BehaviorSubject(undefined);\r\n  drawStyle$: BehaviorSubject<\r\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\r\n  > = new BehaviorSubject(undefined);\r\n\r\n  private value$$: Subscription;\r\n  private radiusChanges$$: Subscription;\r\n  private bufferChanges$$: Subscription;\r\n\r\n  public formControl = new UntypedFormControl();\r\n  public geometryType: Type | string;\r\n  public geometryTypeField = false;\r\n  public geometryTypes: string[] = ['Point', 'Polygon'];\r\n  public drawGuideField = false;\r\n  public drawGuide: number = null;\r\n  public drawGuidePlaceholder = '';\r\n  public measure = false;\r\n  public drawControlIsActive = true;\r\n  public freehandDrawIsActive = false;\r\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n  public drawZone;\r\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\r\n\r\n  public radius: number;\r\n  public buffer: number = 0;\r\n  public radiusFormControl = new UntypedFormControl();\r\n  public bufferFormControl = new UntypedFormControl();\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n  public zoneWithBuffer;\r\n\r\n  public listIsVisible = true;\r\n  public tableTemplate: EntityTableTemplate;\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private spatialFilterService: SpatialFilterService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.spatialFilterService\r\n      .loadThematicsList()\r\n      .subscribe((items: SpatialFilterThematic[]) => {\r\n        for (const item of items) {\r\n          this.childrens.push(item);\r\n          this.childrens.sort((a, b) => {\r\n            return a.name.localeCompare(b.name);\r\n          });\r\n        }\r\n        this.groups.push(\r\n          this.languageService.translate.instant('igo.geo.terrapi.limites')\r\n        );\r\n        const limits: SpatialFilterThematic = {\r\n          name: this.groups[0],\r\n          children: []\r\n        };\r\n        this.thematics.push(limits);\r\n        this.childrens.forEach((child) => {\r\n          if (child.group && this.groups.indexOf(child.group) === -1) {\r\n            this.groups.push(child.group);\r\n            const thematic: SpatialFilterThematic = {\r\n              name: child.group,\r\n              children: []\r\n            };\r\n            this.thematics.push(thematic);\r\n          }\r\n\r\n          if (!child.group) {\r\n            if (\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.AdmRegion'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.Arrond'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.CircFed'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.CircProv'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.DirReg'\r\n                ) ||\r\n              child.name ===\r\n                this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\r\n              child.name ===\r\n                this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.RegTour'\r\n                )\r\n            ) {\r\n              child.group = limits.name;\r\n            } else if (\r\n              child.name ===\r\n              this.languageService.translate.instant('igo.geo.terrapi.routes')\r\n            ) {\r\n              child.group = this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.group.transport'\r\n              );\r\n            } else {\r\n              const thematic: SpatialFilterThematic = {\r\n                name: child.name,\r\n                children: [],\r\n                source: child.source\r\n              };\r\n              this.thematics.push(thematic);\r\n            }\r\n          }\r\n          this.thematics.sort((a, b) => {\r\n            return a.name.localeCompare(b.name);\r\n          });\r\n        });\r\n        this.thematics.forEach((thematic) => {\r\n          for (const child of this.childrens) {\r\n            if (child.group === thematic.name) {\r\n              thematic.children.push(child);\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n    this.dataSource.data = this.thematics;\r\n\r\n    this.drawGuide$.next(null);\r\n    this.value$.next(\r\n      this.formControl.value ? this.formControl.value : undefined\r\n    );\r\n    this.value$$ = this.formControl.valueChanges.subscribe(\r\n      (value: GeoJSONGeometry) => {\r\n        if (value) {\r\n          this.value$.next(value);\r\n          this.drawZone = this.formControl.value as Feature;\r\n          if (this.buffer !== 0) {\r\n            this.drawZoneEvent.emit(this.drawZone);\r\n            this.bufferFormControl.setValue(this.buffer);\r\n          }\r\n        } else {\r\n          this.value$.next(undefined);\r\n          this.drawZone = undefined;\r\n        }\r\n      }\r\n    );\r\n\r\n    this.value$.subscribe(() => {\r\n      this.getRadius();\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\r\n      this.getRadius();\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\r\n      .pipe(debounceTime(500))\r\n      .subscribe((value) => {\r\n        if (\r\n          this.measureUnit === MeasureLengthUnit.Meters &&\r\n          value > 0 &&\r\n          value <= 100000\r\n        ) {\r\n          this.buffer = value;\r\n          this.bufferEvent.emit(value);\r\n          this.spatialFilterService\r\n            .loadBufferGeometry(this.drawZone, SpatialFilterType.Polygon, value)\r\n            .subscribe((featureGeom: Feature) => {\r\n              this.zoneWithBuffer = featureGeom;\r\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n            });\r\n        } else if (\r\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n          value > 0 &&\r\n          value <= 100\r\n        ) {\r\n          this.buffer = value;\r\n          this.bufferEvent.emit(value);\r\n          this.spatialFilterService\r\n            .loadBufferGeometry(\r\n              this.drawZone,\r\n              SpatialFilterType.Polygon,\r\n              value * 1000\r\n            )\r\n            .subscribe((featureGeom: Feature) => {\r\n              this.zoneWithBuffer = featureGeom;\r\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n            });\r\n        } else if (value === 0) {\r\n          this.buffer = value;\r\n          this.bufferEvent.emit(value);\r\n          this.drawZoneEvent.emit(this.drawZone);\r\n        } else if (\r\n          value < 0 ||\r\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\r\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\r\n        ) {\r\n          this.bufferFormControl.setValue(0);\r\n          this.buffer = 0;\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.bufferAlert',\r\n            'igo.geo.spatialFilter.warning'\r\n          );\r\n        }\r\n      });\r\n\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: undefined,\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map: this.map,\r\n      hitTolerance: 15,\r\n      motion: FeatureMotion.Default,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n\r\n    this.store.addStrategy(selectionStrategy, true);\r\n    this.store.addStrategy(selectedRecordStrategy, false);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the value stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.value$$.unsubscribe();\r\n    this.radiusChanges$$.unsubscribe();\r\n    this.bufferChanges$$.unsubscribe();\r\n    this.cdRef.detach();\r\n    if (this.radiusChanges$$) {\r\n      this.radiusChanges$$.unsubscribe();\r\n    }\r\n    if (this.value$$) {\r\n      this.value$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  onItemTypeChange(event) {\r\n    this.selectedItemType = event.value;\r\n    this.itemTypeChange.emit(this.selectedItemType);\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\r\n    if (unit === this.measureUnit) {\r\n      return;\r\n    } else {\r\n      this.measureUnit = unit;\r\n      this.measureUnitChange.emit(this.measureUnit);\r\n      if (this.isPolygon()) {\r\n        this.measureUnit === MeasureLengthUnit.Meters\r\n          ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\r\n          : this.bufferFormControl.setValue(\r\n              this.bufferFormControl.value / 1000\r\n            );\r\n      } else if (this.isPoint()) {\r\n        this.measureUnit === MeasureLengthUnit.Meters\r\n          ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\r\n          : this.radiusFormControl.setValue(\r\n              this.radiusFormControl.value / 1000\r\n            );\r\n      }\r\n    }\r\n  }\r\n\r\n  isPredefined() {\r\n    return this.type === SpatialFilterType.Predefined;\r\n  }\r\n\r\n  isPolygon() {\r\n    return this.type === SpatialFilterType.Polygon;\r\n  }\r\n\r\n  isPoint() {\r\n    return this.type === SpatialFilterType.Point;\r\n  }\r\n\r\n  hasChild(_: number, node: SpatialFilterThematic) {\r\n    if (node.children) {\r\n      return node.children.length;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  onToggleClick(node: SpatialFilterThematic) {\r\n    this.treeControl.isExpanded(node)\r\n      ? this.treeControl.collapse(node)\r\n      : this.treeControl.expand(node);\r\n  }\r\n\r\n  isAllSelected(node?: SpatialFilterThematic) {\r\n    let numSelected;\r\n    let numNodes = 0;\r\n    if (!node) {\r\n      numSelected = this.selectedThematics.selected.length;\r\n      this.thematics.forEach((thematic) => {\r\n        if (this.groups.indexOf(thematic.name) === -1) {\r\n          numNodes++;\r\n        }\r\n      });\r\n      this.childrens.forEach((children) => {\r\n        if (\r\n          !this.thematics.find(\r\n            (thematic) => thematic.source === children.source\r\n          )\r\n        ) {\r\n          numNodes++;\r\n        }\r\n      });\r\n    } else {\r\n      numSelected = node.children.length;\r\n      node.children.forEach((children) => {\r\n        if (\r\n          this.selectedThematics.selected.find(\r\n            (thematic) => thematic === children\r\n          )\r\n        ) {\r\n          numNodes++;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (numNodes >= 1) {\r\n      return numSelected === numNodes;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  hasChildrenSelected(node: SpatialFilterThematic) {\r\n    let bool = false;\r\n    node.children.forEach((child) => {\r\n      if (\r\n        this.selectedThematics.selected.find(\r\n          (thematic) => thematic.source === child.source\r\n        )\r\n      ) {\r\n        bool = true;\r\n      }\r\n    });\r\n    return bool;\r\n  }\r\n\r\n  /**\r\n   * Apply header checkbox\r\n   */\r\n  masterToggle() {\r\n    this.isAllSelected() ? this.selectedThematics.clear() : this.selectAll();\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n\r\n    if (this.isAllSelected()) {\r\n      this.thematics.forEach((thematic) => {\r\n        if (this.hasChild(0, thematic)) {\r\n          this.treeControl.expand(thematic);\r\n        }\r\n      });\r\n    } else {\r\n      this.thematics.forEach((thematic) => {\r\n        if (this.hasChild(0, thematic)) {\r\n          this.treeControl.collapse(thematic);\r\n        }\r\n      });\r\n    }\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  selectAll(node?: SpatialFilterThematic) {\r\n    if (!node) {\r\n      this.thematics.forEach((thematic) => {\r\n        if (this.groups.indexOf(thematic.name) === -1) {\r\n          this.selectedThematics.select(thematic);\r\n        }\r\n      });\r\n      this.childrens.forEach((children) => {\r\n        if (\r\n          !this.selectedThematics.selected.find(\r\n            (thematic) => thematic.source === children.source\r\n          )\r\n        ) {\r\n          this.selectedThematics.select(children);\r\n        }\r\n      });\r\n    } else {\r\n      if (this.hasChild(0, node)) {\r\n        node.children.forEach((children) =>\r\n          this.selectedThematics.select(children)\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  childrensToggle(node: SpatialFilterThematic) {\r\n    this.isAllSelected(node)\r\n      ? node.children.forEach((child) => this.selectedThematics.deselect(child))\r\n      : this.selectAll(node);\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n    this.treeControl.expand(node);\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  /**\r\n   * Apply changes to the thematics selected tree and emit event\r\n   */\r\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\r\n    let selected = false;\r\n    if (\r\n      this.selectedThematics.selected.find(\r\n        (thematic) => thematic.source === nodeSelected.source\r\n      ) !== undefined\r\n    ) {\r\n      selected = true;\r\n    }\r\n\r\n    this.childrens.forEach((children) => {\r\n      if (children === nodeSelected && selected === false) {\r\n        this.selectedThematics.select(children);\r\n      }\r\n      if (children === nodeSelected && selected === true) {\r\n        this.selectedThematics.deselect(children);\r\n      }\r\n    });\r\n    this.thematics.forEach((thematic) => {\r\n      if (thematic === nodeSelected && selected === false) {\r\n        this.selectedThematics.select(thematic);\r\n      }\r\n      if (thematic === nodeSelected && selected === true) {\r\n        this.selectedThematics.deselect(thematic);\r\n      }\r\n    });\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  onDrawControlChange() {\r\n    this.drawControlIsActive = !this.drawControlIsActive;\r\n  }\r\n\r\n  onfreehandControlChange() {\r\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\r\n    this.freehandControl.emit(this.freehandDrawIsActive);\r\n    if (this.isPoint()) {\r\n      this.predefinedRadius.emit(!this.freehandDrawIsActive);\r\n      if (this.freehandDrawIsActive) {\r\n        this.overlayStyle$.next(undefined);\r\n        this.drawStyle$.next(undefined);\r\n      }\r\n    } else {\r\n      this.predefinedRadius.emit(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Launch search button\r\n   */\r\n  toggleSearchButton() {\r\n    if (!this.isPredefined()) {\r\n      if (this.buffer > 0) {\r\n        this.zoneWithBuffer.meta = {\r\n          id: undefined,\r\n          title: 'Zone'\r\n        };\r\n        this.zoneWithBuffer.properties = {\r\n          nom: 'Zone',\r\n          type: this.type as string\r\n        };\r\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\r\n      } else {\r\n        this.drawZone.meta = {\r\n          id: undefined,\r\n          title: 'Zone'\r\n        };\r\n        this.drawZone.properties = {\r\n          nom: 'Zone',\r\n          type: this.type as string\r\n        };\r\n        this.drawZoneEvent.emit(this.drawZone);\r\n      }\r\n    }\r\n    if (this.isPoint()) {\r\n      this.radiusEvent.emit(this.radius);\r\n    } else if (this.isPolygon()) {\r\n      this.bufferEvent.emit(this.buffer);\r\n    }\r\n    this.toggleSearch.emit();\r\n    this.store.entities$.pipe(debounceTime(500)).subscribe((value) => {\r\n      if (value.length && this.layers.length === this.thematicLength + 1) {\r\n        this.openWorkspace.emit();\r\n        this.createTableTemplate();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Launch clear button (clear store and map layers)\r\n   */\r\n  clearButton() {\r\n    this.loading = true;\r\n    if (this.store) {\r\n      this.store.clear();\r\n    }\r\n    if (this.isPoint() || this.isPolygon()) {\r\n      this.drawZone = undefined;\r\n      this.formControl.reset();\r\n    }\r\n    this.bufferFormControl.setValue(0);\r\n    this.buffer = 0;\r\n    this.bufferEvent.emit(0);\r\n    this.clearButtonEvent.emit();\r\n    this.loading = false;\r\n    this.tableTemplate = undefined;\r\n  }\r\n\r\n  clearDrawZone() {\r\n    this.formControl.reset();\r\n    this.bufferFormControl.setValue(0);\r\n    this.buffer = 0;\r\n  }\r\n\r\n  /**\r\n   * Launch clear search (clear field if type is predefined)\r\n   */\r\n  clearSearch() {\r\n    this.selectedThematics.clear();\r\n    this.bufferFormControl.setValue(0);\r\n    this.buffer = 0;\r\n    this.bufferEvent.emit(0);\r\n    this.thematicChange.emit([]);\r\n    this.clearSearchEvent.emit();\r\n  }\r\n\r\n  /**\r\n   * Verify conditions of incomplete fields or busy service\r\n   */\r\n  disableSearchButton(): boolean {\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\r\n        if (this.queryType !== undefined && this.zone !== undefined) {\r\n          return this.loading;\r\n        }\r\n      }\r\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\r\n        if (\r\n          this.queryType !== undefined &&\r\n          this.zone !== undefined &&\r\n          this.selectedThematics.selected.length > 0\r\n        ) {\r\n          return this.loading;\r\n        }\r\n      }\r\n    }\r\n    if (\r\n      this.type === SpatialFilterType.Polygon ||\r\n      this.type === SpatialFilterType.Point\r\n    ) {\r\n      if (\r\n        this.selectedItemType === SpatialFilterItemType.Address &&\r\n        this.formControl.value !== null\r\n      ) {\r\n        return this.loading;\r\n      }\r\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\r\n        if (\r\n          this.selectedThematics.selected.length > 0 &&\r\n          this.formControl.value !== null\r\n        ) {\r\n          return this.loading;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  disabledClearSearch() {\r\n    let disable = true;\r\n    this.selectedItemType === SpatialFilterItemType.Address\r\n      ? (disable = this.queryType === undefined)\r\n      : (disable =\r\n          this.queryType === undefined &&\r\n          this.selectedThematics.selected.length === 0);\r\n\r\n    return disable;\r\n  }\r\n\r\n  /**\r\n   * Manage radius value at user change\r\n   */\r\n  getRadius() {\r\n    let formValue;\r\n    if (this.formControl.value !== null) {\r\n      this.measureUnit === MeasureLengthUnit.Meters\r\n        ? (formValue = this.formControl.value.radius)\r\n        : (formValue = this.formControl.value.radius / 1000);\r\n    } else {\r\n      formValue = undefined;\r\n    }\r\n\r\n    if (this.type === SpatialFilterType.Point) {\r\n      if (!this.freehandDrawIsActive) {\r\n        if (\r\n          this.radiusFormControl.value < 0 ||\r\n          (this.measureUnit === MeasureLengthUnit.Meters &&\r\n            this.radiusFormControl.value >= 100000) ||\r\n          (this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n            this.radiusFormControl.value >= 100)\r\n        ) {\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.radiusAlert',\r\n            'igo.geo.spatialFilter.warning'\r\n          );\r\n          this.radius = 1000;\r\n          this.measureUnit === MeasureLengthUnit.Meters\r\n            ? this.radiusFormControl.setValue(this.radius)\r\n            : this.radiusFormControl.setValue(this.radius / 1000);\r\n          this.drawGuide$.next(this.radius);\r\n          return;\r\n        }\r\n      } else {\r\n        if (formValue) {\r\n          if (formValue >= 100000) {\r\n            this.messageService.alert(\r\n              'igo.geo.spatialFilter.radiusAlert',\r\n              'igo.geo.spatialFilter.warning'\r\n            );\r\n            this.formControl.reset();\r\n            return;\r\n          }\r\n          if (formValue !== this.radiusFormControl.value) {\r\n            this.radiusFormControl.setValue(formValue);\r\n            return;\r\n          }\r\n        }\r\n      }\r\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\r\n        this.radius = this.radiusFormControl.value;\r\n        this.drawGuide$.next(this.radius);\r\n      } else {\r\n        this.radius = this.radiusFormControl.value * 1000;\r\n        this.drawGuide$.next(this.radius * 1000);\r\n      }\r\n      this.overlayStyle$.next(this.PointStyle);\r\n      this.drawStyle$.next(this.PointStyle);\r\n    }\r\n  }\r\n\r\n  toggleVisibleList() {\r\n    this.listIsVisible = !this.listIsVisible;\r\n  }\r\n\r\n  private createTableTemplate() {\r\n    const typeColumn = {\r\n      name: 'meta.title',\r\n      title: this.languageService.translate.instant(\r\n        'igo.geo.spatialFilter.type'\r\n      ),\r\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n    };\r\n    const nameColumn = {\r\n      name: 'properties.nom',\r\n      title: this.languageService.translate.instant(\r\n        'igo.geo.spatialFilter.searchResults'\r\n      ),\r\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n    };\r\n    const columns = [typeColumn, nameColumn];\r\n\r\n    this.tableTemplate = {\r\n      selection: true,\r\n      sort: true,\r\n      columns\r\n    };\r\n  }\r\n}\r\n","<div class=\"form-list\">\n  <mat-form-field class=\"zone-list\">\n    <mat-label>{{ 'igo.geo.spatialFilter.listLabel' | translate }}</mat-label>\n    <input\n      #input\n      type=\"text\"\n      placeholder=\"{{ 'igo.geo.spatialFilter.listLabel' | translate }}\"\n      matInput\n      [formControl]=\"formControl\"\n      [matAutocomplete]=\"auto\"\n    />\n    <mat-autocomplete\n      #auto=\"matAutocomplete\"\n      (optionSelected)=\"onZoneChange($event.option.value)\"\n      [displayWith]=\"displayFn\"\n    >\n      <mat-option\n        *ngFor=\"let entities of this.store.view.all$() | async\"\n        [value]=\"entities\"\n      >\n        {{ entities.properties.nom }}\n      </mat-option>\n    </mat-autocomplete>\n  </mat-form-field>\n  <div>\n    <div class=\"buffer-div\">\n      <mat-form-field class=\"buffer\">\n        <mat-label>{{ 'igo.geo.spatialFilter.buffer' | translate }}</mat-label>\n        <input\n          type=\"number\"\n          matInput\n          placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\n          [formControl]=\"bufferFormControl\"\n          [value]=\"0\"\n          [readonly]=\"!zone\"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\n        >\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\"\n          >\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { MessageService } from '@igo2/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { Feature } from '../../../feature';\r\nimport { Layer } from '../../../layer';\r\nimport { MeasureLengthUnit } from '../../../measure/shared';\r\nimport {\r\n  SpatialFilterQueryType,\r\n  SpatialFilterType\r\n} from './../../shared/spatial-filter.enum';\r\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\r\n\r\n@Component({\r\n  selector: 'igo-spatial-filter-list',\r\n  templateUrl: './spatial-filter-list.component.html',\r\n  styleUrls: ['./spatial-filter-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  @Input()\r\n  get queryType(): SpatialFilterQueryType {\r\n    return this._queryType;\r\n  }\r\n  set queryType(queryType: SpatialFilterQueryType) {\r\n    this.formControl.setValue('');\r\n    this._queryType = queryType;\r\n  }\r\n  private _queryType: SpatialFilterQueryType;\r\n\r\n  @Input()\r\n  get zone() {\r\n    return this._zone;\r\n  }\r\n  set zone(value) {\r\n    this._zone = value;\r\n    if (!value) {\r\n      this.zoneWithBuffer = undefined;\r\n      this.bufferFormControl.setValue(0);\r\n    }\r\n  }\r\n  private _zone;\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  public zoneWithBuffer;\r\n  public selectedZone: any;\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n\r\n  public formControl = new UntypedFormControl();\r\n\r\n  public bufferFormControl = new UntypedFormControl();\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\r\n  }\r\n\r\n  @Output() zoneChange = new EventEmitter<Feature>();\r\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\r\n  @Output() bufferChange = new EventEmitter<number>();\r\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\r\n\r\n  formValueChanges$$: Subscription;\r\n  bufferValueChanges$$: Subscription;\r\n\r\n  constructor(\r\n    private spatialFilterService: SpatialFilterService,\r\n    private messageService: MessageService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\r\n      (value) => {\r\n        if (value.length) {\r\n          this.store.view.filter((feature) => {\r\n            const filterNormalized = value\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            const featureNameNormalized = feature.properties.nom\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            return featureNameNormalized.includes(filterNormalized);\r\n          });\r\n        }\r\n      }\r\n    );\r\n\r\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\r\n      .pipe(debounceTime(500), distinctUntilChanged())\r\n      .subscribe((value) => {\r\n        if (\r\n          this.measureUnit === MeasureLengthUnit.Meters &&\r\n          value > 0 &&\r\n          value <= 100000\r\n        ) {\r\n          this.bufferChange.emit(value);\r\n          this.spatialFilterService\r\n            .loadBufferGeometry(\r\n              this.selectedZone,\r\n              SpatialFilterType.Predefined,\r\n              value,\r\n              this.queryType\r\n            )\r\n            .subscribe((featureGeom: Feature) => {\r\n              this.zoneWithBuffer = featureGeom;\r\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n            });\r\n        } else if (\r\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n          value > 0 &&\r\n          value <= 100\r\n        ) {\r\n          this.bufferChange.emit(value);\r\n          this.spatialFilterService\r\n            .loadBufferGeometry(\r\n              this.selectedZone,\r\n              SpatialFilterType.Predefined,\r\n              value * 1000,\r\n              this.queryType\r\n            )\r\n            .subscribe((featureGeom: Feature) => {\r\n              this.zoneWithBuffer = featureGeom;\r\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\r\n            });\r\n        } else if (value === 0 && this.layers.length > 0) {\r\n          this.bufferChange.emit(value);\r\n          this.zoneWithBufferChange.emit(this.selectedZone);\r\n        } else if (\r\n          value < 0 ||\r\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\r\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\r\n        ) {\r\n          this.bufferFormControl.setValue(0);\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.bufferAlert',\r\n            'igo.geo.spatialFilter.warning'\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.formValueChanges$$.unsubscribe();\r\n  }\r\n\r\n  displayFn(feature?: Feature): string | undefined {\r\n    return feature ? feature.properties.nom : undefined;\r\n  }\r\n\r\n  onZoneChange(feature) {\r\n    if (feature && this.queryType) {\r\n      this.spatialFilterService\r\n        .loadItemById(feature, this.queryType)\r\n        .subscribe((featureGeom: Feature) => {\r\n          this.selectedZone = featureGeom;\r\n          this.zoneChange.emit(featureGeom);\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\r\n    if (unit === this.measureUnit) {\r\n      return;\r\n    } else {\r\n      this.measureUnit = unit;\r\n      this.measureUnitChange.emit(this.measureUnit);\r\n      this.measureUnit === MeasureLengthUnit.Meters\r\n        ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\r\n        : this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\r\n    }\r\n  }\r\n}\r\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\"\n>\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' | translate\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.spatialFilter.searchLabel' | translate\n      }}</mat-label>\n      <mat-select\n        (selectionChange)=\"onSelectionChange()\"\n        [(value)]=\"selectedQueryType\"\n      >\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{ 'igo.geo.terrapi.' + queryType | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\"\n    >\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' | translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\"\n      >\n        <mat-button-toggle\n          [value]=\"spatialType.Polygon\"\n          [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' | translate\"\n        >\n          <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle\n          [value]=\"spatialType.Point\"\n          [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' | translate\"\n        >\n          <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n</mat-tab-group>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\n\r\nimport { Feature } from '../../../feature';\r\nimport { Layer } from '../../../layer';\r\nimport { MeasureLengthUnit } from '../../../measure';\r\nimport {\r\n  SpatialFilterQueryType,\r\n  SpatialFilterType\r\n} from '../../shared/spatial-filter.enum';\r\n\r\n/**\r\n * Spatial Filter Type\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-type',\r\n  templateUrl: './spatial-filter-type.component.html',\r\n  styleUrls: ['./spatial-filter-type.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterTypeComponent implements OnInit {\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  public queryType: string[] = [\r\n    'Arrond',\r\n    'CircFed',\r\n    'CircProv',\r\n    'DirReg',\r\n    'Mun',\r\n    'MRC',\r\n    'AdmRegion',\r\n    'RegTour'\r\n  ];\r\n  public selectedTypeIndex = new UntypedFormControl(0);\r\n\r\n  /**\r\n   * Reference to the SpatialFIlterType enum\r\n   * @internal\r\n   */\r\n  public spatialType = SpatialFilterType;\r\n\r\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\r\n\r\n  @Input() selectedQueryType: SpatialFilterQueryType;\r\n\r\n  @Input() zone: Feature;\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  public type: SpatialFilterType;\r\n\r\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\r\n\r\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\r\n\r\n  @Output() zoneChange = new EventEmitter<Feature>();\r\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\r\n\r\n  @Output() bufferChange = new EventEmitter<number>();\r\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    if (this.selectedTypeIndex.value === 0) {\r\n      this.type = this.spatialType.Predefined;\r\n    }\r\n    if (this.selectedTypeIndex.value === 1) {\r\n      this.type = this.activeDrawType;\r\n    }\r\n    this.eventType.emit(this.type);\r\n  }\r\n\r\n  onTypeChange(event) {\r\n    if (this.selectedTypeIndex.value === 0) {\r\n      this.type = SpatialFilterType.Predefined;\r\n    }\r\n    if (this.selectedTypeIndex.value === 1) {\r\n      this.type = this.activeDrawType;\r\n    }\r\n    this.eventType.emit(this.type);\r\n  }\r\n\r\n  onDrawTypeChange(spatialType: SpatialFilterType) {\r\n    this.activeDrawType = spatialType;\r\n    this.eventType.emit(this.activeDrawType);\r\n  }\r\n\r\n  onSelectionChange() {\r\n    this.eventQueryType.emit(this.selectedQueryType);\r\n    this.zoneChange.emit(undefined);\r\n  }\r\n}\r\n","<button\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    [matBadge]=\"badge\"\n    matBadgeColor=\"warn\"\n    matBadgeSize=\"medium\"\n    svgIcon=\"history\"\n  ></mat-icon>\n</button>\n\n<div\n  #ogcFilter\n  class=\"igo-layer-actions-container\"\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n>\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\"\n  >\n  </igo-time-filter-item>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { TimeFilterableDataSourceOptions } from '../../datasource';\r\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-button',\r\n  templateUrl: './time-filter-button.component.html',\r\n  styleUrls: ['./time-filter-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TimeFilterButtonComponent implements OnInit {\r\n  public options: TimeFilterableDataSourceOptions;\r\n\r\n  get badge() {\r\n    const filter = this.options.timeFilter as any;\r\n    if (filter && filter.enabled) {\r\n      return 1;\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    if (value) {\r\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\r\n    }\r\n  }\r\n  private _layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  public timeFilterCollapse = false;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\r\n  }\r\n}\r\n","<div *ngIf=\"style === 'calendar' && type !== 'year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle\n        class=\"time-filter-mat-datetimepicker-toggle\"\n        [for]=\"datetimePicker\"\n        matSuffix\n      ></mat-datetimepicker-toggle>\n      <mat-datetimepicker\n        #datetimePicker\n        type=\"{{ type }}\"\n        openOnFocus=\"true\"\n        timeInterval=\"5\"\n      ></mat-datetimepicker>\n      <input\n        matInput\n        autocomplete=\"false\"\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle\n          class=\"time-filter-mat-datetimepicker-toggle\"\n          [for]=\"minDatetimePicker\"\n          matSuffix\n        ></mat-datetimepicker-toggle>\n        <mat-datetimepicker\n          #minDatetimePicker\n          type=\"{{ type }}\"\n          openOnFocus=\"true\"\n          timeInterval=\"5\"\n        ></mat-datetimepicker>\n        <input\n          matInput\n          autocomplete=\"false\"\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"(startDate)\"\n          (dateChange)=\"handleDateChange($event)\"\n        />\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle\n          class=\"time-filter-mat-datetimepicker-toggle\"\n          [for]=\"maxDatetimePicker\"\n          matSuffix\n        ></mat-datetimepicker-toggle>\n        <mat-datetimepicker\n          #maxDatetimePicker\n          type=\"{{ type }}\"\n          openOnFocus=\"true\"\n          timeInterval=\"5\"\n        ></mat-datetimepicker>\n        <input\n          matInput\n          autocomplete=\"false\"\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\"\n        />\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type === 'year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-select\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\n        [(ngModel)]=\"year\"\n        (selectionChange)=\"handleYearChange($event)\"\n      >\n        <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{\n          year\n        }}</mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-select\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\n          [(ngModel)]=\"startYear\"\n          (selectionChange)=\"handleYearChange($event)\"\n        >\n          <mat-option\n            [value]=\"startYear\"\n            *ngFor=\"let startYear of startListYears\"\n            >{{ startYear }}</mat-option\n          >\n        </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-select\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\n          [(ngModel)]=\"endYear\"\n          (selectionChange)=\"handleYearChange($event)\"\n        >\n          <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{\n            endYear\n          }}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<br />\n<div\n  *ngIf=\"!isRange && style === 'slider' && type === 'year'\"\n  class=\"igo-col igo-col-100 igo-col-100-m mat-typography\"\n>\n  <span>{{ startYear }}</span>\n  <!-- TODO: The 'tickInterval' property no longer exists -->\n  <mat-slider\n    id=\"time-slider\"\n    step=\"{{ step }}\"\n    [min]=\"startYear\"\n    [max]=\"endYear\"\n    [color]=\"color\"\n    thumbLabel\n    [disabled]=\"!options.enabled || !layer.visible\"\n    #ngSlider\n    ><input\n      matSliderThumb\n      [value]=\"handleSliderValue()\"\n      (input)=\"\n        handleSliderYearChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n      (change)=\"\n        handleSliderYearChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n    />\n  </mat-slider>\n  <span>{{ endYear }}</span>\n  <p *ngIf=\"options.enabled\" class=\"date-below\">{{ year }}</p>\n  <div #actions class=\"igo-layer-actions-container\">\n    <mat-slide-toggle\n      (change)=\"toggleFilterState()\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n      [color]=\"color\"\n      [checked]=\"options.enabled\"\n      [disabled]=\"!layer.visible\"\n    >\n    </mat-slide-toggle>\n    <button\n      [disabled]=\"!options.enabled || !layer.visible\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"playYear($event)\"\n    >\n      <mat-icon svgIcon=\"{{ playIcon }}\"></mat-icon>\n    </button>\n    <button\n      [disabled]=\"!options.enabled || !layer.visible\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"resetFilter($event)\"\n    >\n      <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\n    </button>\n  </div>\n</div>\n\n<div\n  *ngIf=\"style === 'slider' && type !== 'year'\"\n  class=\"igo-col igo-col-100 igo-col-100-m\"\n>\n  <!-- TODO: The 'tickInterval' property no longer exists -->\n  <mat-slider\n    id=\"time-slider\"\n    step=\"{{ step }}\"\n    [min]=\"dateToNumber(min)\"\n    [max]=\"dateToNumber(max)\"\n    thumbLabel\n    (selectionChange)=\"handleSliderDateChange($event)\"\n    #ngSlider\n    ><input\n      matSliderThumb\n      [value]=\"handleSliderValue()\"\n      (input)=\"\n        handleSliderDateChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n    />\n  </mat-slider>\n  <p class=\"date-below\">{{ handleSliderTooltip() }}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon svgIcon=\"{{ playIcon }}\"></mat-icon>\n  </button>\n</div>\n","import {\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnInit,\r\n  Output,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { DateAdapter } from '@angular/material/core';\r\nimport { MatSlider } from '@angular/material/slider';\r\n\r\nimport olSourceImageWMS from 'ol/source/ImageWMS';\r\n\r\nimport { default as moment } from 'moment';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { TimeFilterStyle, TimeFilterType } from '../shared/time-filter.enum';\r\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-form',\r\n  templateUrl: './time-filter-form.component.html',\r\n  styleUrls: ['./time-filter-form.component.scss']\r\n})\r\nexport class TimeFilterFormComponent implements OnInit {\r\n  @Input() layer: Layer;\r\n\r\n  @Input() options: TimeFilterOptions;\r\n\r\n  public color = 'primary';\r\n  public date: Date;\r\n  public startDate: Date;\r\n  public endDate: Date;\r\n  public year: any;\r\n  public startYear: any;\r\n  public endYear: any;\r\n  public initStartYear: any;\r\n  public initEndYear: any;\r\n  public listYears: Array<string> = [];\r\n  public startListYears: Array<string> = [];\r\n  public endListYears: Array<string> = [];\r\n\r\n  @Input()\r\n  set currentValue(value: string) {\r\n    if (value) {\r\n      if (this.type !== TimeFilterType.YEAR) {\r\n        const valueArray = value.split('/');\r\n        if (valueArray.length > 0) {\r\n          const startDate = new Date(valueArray[0]);\r\n          const endDate = new Date(valueArray[1]);\r\n          if (!isNaN(startDate.valueOf())) {\r\n            this.startDate = startDate;\r\n          }\r\n          if (!isNaN(endDate.valueOf())) {\r\n            this.endDate = endDate;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public interval: any;\r\n  public playIcon = 'play-circle';\r\n  public resetIcon = 'replay';\r\n\r\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\r\n  @Output()\r\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\r\n  @ViewChild(MatSlider) mySlider;\r\n\r\n  get type(): TimeFilterType {\r\n    return this.options.type === undefined\r\n      ? TimeFilterType.DATE\r\n      : this.options.type;\r\n  }\r\n\r\n  get isRange(): boolean {\r\n    return this.options.range === undefined ||\r\n      this.options.style === TimeFilterStyle.SLIDER\r\n      ? false\r\n      : this.options.range;\r\n  }\r\n\r\n  get style(): TimeFilterStyle {\r\n    return this.options.style === undefined\r\n      ? TimeFilterStyle.SLIDER\r\n      : this.options.style;\r\n  }\r\n\r\n  get step(): number {\r\n    let step = 10800000;\r\n    if (this.options.step === undefined) {\r\n      switch (this.type) {\r\n        case TimeFilterType.DATE:\r\n        case TimeFilterType.DATETIME:\r\n          step = 10800000;\r\n          break;\r\n        case TimeFilterType.TIME:\r\n          step = 3600000;\r\n          break;\r\n        case TimeFilterType.YEAR:\r\n          step = 31536000000;\r\n          break;\r\n        default:\r\n          step = 10800000;\r\n      }\r\n    } else {\r\n      step = this.getStepDefinition(this.options.step);\r\n    }\r\n\r\n    return step;\r\n  }\r\n\r\n  get timeInterval(): number {\r\n    return this.options.timeInterval === undefined\r\n      ? 2000\r\n      : this.options.timeInterval;\r\n  }\r\n\r\n  get min(): Date {\r\n    if (this.options.min) {\r\n      const min = new Date(this.options.min);\r\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get max(): Date {\r\n    if (this.options.max) {\r\n      const max = new Date(this.options.max);\r\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get is(): boolean {\r\n    return this.options.range === undefined ? false : this.options.range;\r\n  }\r\n\r\n  constructor(private dateAdapter: DateAdapter<Date>) {\r\n    this.dateAdapter.setLocale('fr');\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.startDate === undefined) {\r\n      this.startDate = new Date(this.min);\r\n    }\r\n    if (this.endDate === undefined) {\r\n      this.endDate = new Date(this.max);\r\n    }\r\n    if (this.startYear === undefined) {\r\n      this.startYear = new Date(this.startDate).getFullYear();\r\n      this.initStartYear = this.startYear;\r\n    }\r\n    if (this.endYear === undefined) {\r\n      this.endYear = new Date(this.endDate).getFullYear();\r\n      this.initEndYear = this.endYear;\r\n    }\r\n\r\n    if (!this.isRange) {\r\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\r\n        this.listYears.push(i);\r\n      }\r\n    } else {\r\n      for (let i = this.startYear; i < this.endYear; i++) {\r\n        this.startListYears.push(i);\r\n      }\r\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\r\n        this.endListYears.push(i);\r\n      }\r\n    }\r\n    this.options.enabled =\r\n      this.options.enabled === undefined ? true : this.options.enabled;\r\n    this.checkFilterValue();\r\n    if (this.options.enabled) {\r\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\r\n        this.yearChange.emit(this.year);\r\n      }\r\n    } else {\r\n      this.storeCurrentFilterValue();\r\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  storeCurrentFilterValue() {\r\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    if (\r\n      !this.isRange &&\r\n      this.style === TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      this.options.value = this.year.toString();\r\n    }\r\n  }\r\n\r\n  checkFilterValue() {\r\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\r\n    const timeFromWms = olSource.getParams().TIME;\r\n    if (\r\n      !this.isRange &&\r\n      this.style === TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      if (timeFromWms) {\r\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\r\n      } else if (this.options.value) {\r\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\r\n      } else {\r\n        this.year = new Date(this.min).getFullYear() + 1;\r\n      }\r\n    } else if (\r\n      this.isRange &&\r\n      this.style === TimeFilterStyle.CALENDAR &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      if (timeFromWms) {\r\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\r\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\r\n        const newStartListYears: any[] = [];\r\n        const newEndListYears: any[] = [];\r\n        for (let i = this.initStartYear; i < this.endYear; i++) {\r\n          newStartListYears.push(i);\r\n        }\r\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\r\n          newEndListYears.push(i);\r\n        }\r\n        this.startListYears = newStartListYears;\r\n        this.endListYears = newEndListYears;\r\n      }\r\n    }\r\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n  }\r\n\r\n  handleDateChange(event: any) {\r\n    this.setupDateOutput();\r\n    this.applyTypeChange();\r\n\r\n    // Only if is range, use 2 dates to make the range\r\n    if (this.isRange) {\r\n      this.change.emit([this.startDate, this.endDate]);\r\n    } else {\r\n      this.change.emit(this.startDate);\r\n    }\r\n  }\r\n\r\n  handleYearChange(event: any) {\r\n    if (this.isRange) {\r\n      this.endListYears = [];\r\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\r\n        this.endListYears.push(i);\r\n      }\r\n      this.startListYears = [];\r\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\r\n        this.startListYears.push(i);\r\n      }\r\n      this.yearChange.emit([this.startYear, this.endYear]);\r\n    } else {\r\n      this.yearChange.emit(this.year);\r\n    }\r\n  }\r\n\r\n  handleListYearChange(event: any) {\r\n    this.handleYearChange([this.startYear, this.endYear]);\r\n  }\r\n\r\n  handleListYearStartChange(event: any) {\r\n    this.change.emit([this.startDate, this.endDate]);\r\n  }\r\n\r\n  dateToNumber(date: Date): number {\r\n    let newDate;\r\n    if (date) {\r\n      newDate = new Date(date);\r\n    } else {\r\n      newDate = new Date(this.min);\r\n    }\r\n\r\n    return newDate.getTime();\r\n  }\r\n\r\n  setSliderThumbLabel(label: string) {\r\n    const thumbLabel = this.findThumbLabel(\r\n      this.mySlider._elementRef.nativeElement.childNodes\r\n    );\r\n    if (thumbLabel) {\r\n      thumbLabel.textContent = label;\r\n    }\r\n  }\r\n\r\n  findThumbLabel(test: any[]): any {\r\n    let thumbLabel;\r\n\r\n    test.forEach((value) => {\r\n      if (value.className === 'mat-slider-thumb-label-text') {\r\n        thumbLabel = value;\r\n      }\r\n\r\n      if (value.children.length > 0 && !thumbLabel) {\r\n        thumbLabel = this.findThumbLabel(value.childNodes);\r\n      }\r\n    }, this);\r\n    return thumbLabel;\r\n  }\r\n\r\n  toggleFilterState() {\r\n    this.options.enabled = !this.options.enabled;\r\n\r\n    if (this.options.enabled) {\r\n      if (\r\n        !this.isRange &&\r\n        TimeFilterStyle.SLIDER &&\r\n        this.type === TimeFilterType.YEAR\r\n      ) {\r\n        this.yearChange.emit(this.year);\r\n      }\r\n    } else {\r\n      this.stopFilter();\r\n      this.storeCurrentFilterValue();\r\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  resetFilter(event: any) {\r\n    this.date = new Date(this.min);\r\n    this.year = this.date.getFullYear();\r\n    if (\r\n      !this.isRange &&\r\n      TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      this.yearChange.emit(this.year);\r\n    } else {\r\n      this.setupDateOutput();\r\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  playFilter(event: any) {\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        (that) => {\r\n          let newMinDateNumber;\r\n          const maxDateNumber = new Date(that.max);\r\n\r\n          newMinDateNumber =\r\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\r\n          newMinDateNumber += that.mySlider.step;\r\n          that.date = new Date(newMinDateNumber);\r\n\r\n          if (newMinDateNumber > maxDateNumber.getTime()) {\r\n            that.stopFilter();\r\n          }\r\n\r\n          that.handleDateChange({ value: that.date, date: that.date });\r\n        },\r\n        this.timeInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  playYear(event: any) {\r\n    if (\r\n      this.year + this.mySlider.step >\r\n      this.max.getFullYear() + this.mySlider.step\r\n    ) {\r\n      this.stopFilter();\r\n      this.resetFilter(event);\r\n    }\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        () => {\r\n          if (this.year + this.mySlider.step > this.max.getFullYear()) {\r\n            this.stopFilter();\r\n          } else {\r\n            this.year = this.year + this.mySlider.step;\r\n          }\r\n          this.yearChange.emit(this.year);\r\n        },\r\n        this.timeInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  stopFilter() {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n  }\r\n\r\n  handleSliderDateChange(event: any) {\r\n    this.date = new Date(event.value);\r\n    this.setSliderThumbLabel(this.handleSliderTooltip());\r\n    this.handleDateChange(event);\r\n  }\r\n\r\n  handleSliderYearChange(event: any) {\r\n    this.year = event.value;\r\n    this.yearChange.emit(this.year);\r\n  }\r\n\r\n  handleSliderValue(): number {\r\n    if (this.options.current === true || !this.min) {\r\n      const currentDate = new Date();\r\n      this.date = this.getRoundedDate(currentDate);\r\n    }\r\n    if (this.type === TimeFilterType.YEAR) {\r\n      return this.year;\r\n    } else {\r\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\r\n    }\r\n  }\r\n\r\n  handleSliderTooltip() {\r\n    let label: string;\r\n\r\n    switch (this.type) {\r\n      case TimeFilterType.DATE:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toDateString()\r\n            : this.date.toDateString();\r\n        break;\r\n      case TimeFilterType.TIME:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toTimeString()\r\n            : this.date.toTimeString();\r\n        break;\r\n      // datetime\r\n      default:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toUTCString()\r\n            : this.date.toUTCString();\r\n        break;\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  setupDateOutput() {\r\n    if (this.style === TimeFilterStyle.SLIDER) {\r\n      this.startDate = new Date(this.date);\r\n      this.startDate.setSeconds(-(this.step / 1000));\r\n      this.endDate = new Date(this.startDate);\r\n      this.endDate.setSeconds(this.step / 1000);\r\n    } else if (!this.isRange && !!this.date) {\r\n      this.endDate = new Date(this.date);\r\n      this.startDate = new Date(this.date);\r\n    } else if (this.isRange && (!!this.date || !this.date)) {\r\n      this.startDate =\r\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\r\n      this.endDate =\r\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\r\n    } else if (!this.date) {\r\n      this.startDate =\r\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\r\n      this.endDate =\r\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\r\n    }\r\n  }\r\n\r\n  applyTypeChange() {\r\n    switch (this.type) {\r\n      case TimeFilterType.DATE:\r\n        if (this.startDate !== undefined || this.endDate !== undefined) {\r\n          this.startDate.setHours(0);\r\n          this.startDate.setMinutes(0);\r\n          this.startDate.setSeconds(0);\r\n          this.endDate.setHours(23);\r\n          this.endDate.setMinutes(59);\r\n          this.endDate.setSeconds(59);\r\n        }\r\n        break;\r\n      case TimeFilterType.TIME:\r\n        if (this.style === TimeFilterStyle.CALENDAR) {\r\n          if (this.startDate.getDay() !== this.min.getDay()) {\r\n            const selectedHour = this.startDate.getHours();\r\n            const selectedMinute = this.startDate.getMinutes();\r\n            this.startDate = this.min;\r\n            this.startDate.setHours(selectedHour);\r\n            this.startDate.setMinutes(selectedMinute);\r\n          }\r\n\r\n          if (this.endDate.getDay() !== this.min.getDay()) {\r\n            const selectedHour = this.endDate.getHours();\r\n            const selectedMinute = this.endDate.getMinutes();\r\n            this.endDate = this.min;\r\n            this.endDate.setHours(selectedHour);\r\n            this.endDate.setMinutes(selectedMinute);\r\n          }\r\n        }\r\n\r\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\r\n          this.startDate.setMinutes(0);\r\n          this.startDate.setSeconds(0);\r\n          this.endDate.setMinutes(59);\r\n          this.endDate.setSeconds(59);\r\n        }\r\n        break;\r\n      // datetime\r\n      default:\r\n      // do nothing\r\n    }\r\n  }\r\n\r\n  getRangeMinDate(): Date {\r\n    return this.startDate === undefined ? this.min : this.startDate;\r\n  }\r\n\r\n  getRangeMaxDate(): Date {\r\n    return this.endDate === undefined ? this.max : this.endDate;\r\n  }\r\n\r\n  /**\r\n   * Round date at a certain time, 10 minutes by Default\r\n   * @param date - Date to Round\r\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\r\n   * @return the rounded date\r\n   */\r\n  getRoundedDate(date, atMinute = 10) {\r\n    const coeff = 1000 * 60 * atMinute;\r\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\r\n  }\r\n\r\n  /**\r\n   * Get the step (period) definition from the layer dimension tag\r\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\r\n   * @return the duration in milliseconds\r\n   */\r\n  getStepDefinition(step) {\r\n    return moment.duration(step).asMilliseconds();\r\n  }\r\n}\r\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    matListItemIcon\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\"\n  >\n  </mat-icon>\n\n  <span\n    matListItemTitle\n    (click)=\"toggleLegendOnClick()\"\n    [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\n    >{{ layer.title }}</span\n  >\n\n  <button\n    *ngIf=\"header\"\n    mat-icon-button\n    matListItemMeta\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      layer.visible\n        ? ('igo.geo.layer.hideLayer' | translate)\n        : ('igo.geo.layer.showLayer' | translate)\n    \"\n    (click)=\"layer.visible = !layer.visible\"\n  >\n    <mat-icon\n      [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\"\n    >\n    </mat-icon>\n  </button>\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]=\"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\"\n  >\n  </igo-time-filter-form>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { TimeFilterableDataSource } from '../../datasource';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { TimeFilterService } from '../shared/time-filter.service';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-item',\r\n  templateUrl: './time-filter-item.component.html',\r\n  styleUrls: ['./time-filter-item.component.scss']\r\n})\r\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\r\n  public color = 'primary';\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  private resolution$$: Subscription;\r\n\r\n  filtersCollapsed: boolean = false;\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  get datasource(): TimeFilterableDataSource {\r\n    return this.layer.dataSource as TimeFilterableDataSource;\r\n  }\r\n  constructor(private timeFilterService: TimeFilterService) {}\r\n\r\n  ngOnInit(): void {\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.resolution$$.unsubscribe();\r\n  }\r\n\r\n  handleYearChange(year: string | [string, string]) {\r\n    this.timeFilterService.filterByYear(this.datasource, year);\r\n  }\r\n\r\n  handleDateChange(date: Date | [Date, Date]) {\r\n    this.timeFilterService.filterByDate(this.datasource, date);\r\n  }\r\n\r\n  private toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    if (!this.filtersCollapsed) {\r\n      this.toggleLegend(this.showLegend$.value);\r\n    }\r\n  }\r\n\r\n  public setVisible() {\r\n    this.layer.visible = true;\r\n  }\r\n\r\n  toggleFiltersCollapsed() {\r\n    this.filtersCollapsed = !this.filtersCollapsed;\r\n  }\r\n}\r\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template\n    ngFor\n    let-layer\n    [ngForOf]=\"layers | filterableDataSource: 'time'\"\n  >\n    <igo-time-filter-item\n      [header]=\"true\"\n      igoListItem\n      [layer]=\"layer\"\n    ></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input\r\n} from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-list',\r\n  templateUrl: './time-filter-list.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TimeFilterListComponent {\r\n  @Input()\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  set layers(value: Layer[]) {\r\n    this._layers = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n  private _layers: Layer[] = [];\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Optional,\r\n  Self\r\n} from '@angular/core';\r\nimport { ControlValueAccessor, NgControl } from '@angular/forms';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlGeometry from 'ol/geom/Geometry';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport Point from 'ol/geom/Point';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport * as olproj from 'ol/proj';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport * as OlStyle from 'ol/style';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { IgoMap } from '../../map/shared';\r\nimport {\r\n  MeasureLengthUnit,\r\n  formatMeasure,\r\n  measureOlGeometry,\r\n  updateOlGeometryMidpoints\r\n} from '../../measure';\r\nimport {\r\n  DrawControl,\r\n  ModifyControl,\r\n  ModifyControlOptions\r\n} from '../shared/controls';\r\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\r\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\r\nimport { DrawControlOptions } from './../shared/controls/draw';\r\n\r\ninterface HasRadius {\r\n  getRadius: () => number;\r\n  setRadius: (radius: number) => void;\r\n}\r\n\r\n/**\r\n * This input allows a user to draw a new geometry or to edit\r\n * an existing one on a map. A text input is also displayed in the\r\n * form with some instructions.\r\n * This is still WIP.\r\n */\r\n@Component({\r\n  selector: 'igo-geometry-form-field-input',\r\n  templateUrl: './geometry-form-field-input.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class GeometryFormFieldInputComponent\r\n  implements OnInit, OnDestroy, ControlValueAccessor\r\n{\r\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\r\n  private olGeoJSON = new OlGeoJSON();\r\n  private ready = false;\r\n\r\n  private drawControl: DrawControl;\r\n  private modifyControl: ModifyControl;\r\n  private defaultDrawStyleRadius: number;\r\n  private olGeometryEnds$$: Subscription;\r\n  private olGeometryChanges$$: Subscription;\r\n  private olTooltip = this.createMeasureTooltip();\r\n\r\n  /**\r\n   * Active control\r\n   * @internal\r\n   */\r\n  public activeControl: DrawControl | ModifyControl;\r\n\r\n  /**\r\n   * The map to draw the geometry on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The geometry type\r\n   */\r\n  @Input()\r\n  set geometryType(value: Type) {\r\n    this._geometryType = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateControl();\r\n    this.createDrawControl();\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n    this.toggleControl();\r\n  }\r\n  get geometryType(): Type {\r\n    return this._geometryType;\r\n  }\r\n  private _geometryType: Type;\r\n\r\n  /**\r\n   * The drawGuide around the mouse pointer to help drawing\r\n   */\r\n  @Input() drawGuide: number = null;\r\n\r\n  /**\r\n   * Whether a measure tooltip should be displayed\r\n   */\r\n  @Input() measure: boolean = false;\r\n\r\n  /**\r\n   * Whether draw control should be active or not\r\n   */\r\n  @Input()\r\n  get drawControlIsActive(): boolean {\r\n    return this._drawControlIsActive;\r\n  }\r\n  set drawControlIsActive(value: boolean) {\r\n    this._drawControlIsActive = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n    this.deactivateControl();\r\n    if (!this._drawControlIsActive) {\r\n      return;\r\n    } else {\r\n      this.toggleControl();\r\n    }\r\n  }\r\n  private _drawControlIsActive: boolean = true;\r\n\r\n  /**\r\n   * Whether freehand draw control should be active or not\r\n   */\r\n  @Input()\r\n  get freehandDrawIsActive(): boolean {\r\n    return this._freehandDrawIsActive;\r\n  }\r\n  set freehandDrawIsActive(value: boolean) {\r\n    this._freehandDrawIsActive = value;\r\n    this.deactivateControl();\r\n\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    if (!this.drawControlIsActive) {\r\n      return;\r\n    }\r\n    this.toggleControl();\r\n  }\r\n  private _freehandDrawIsActive: boolean;\r\n\r\n  /**\r\n   * Whether freehand draw control should be active or not\r\n   */\r\n  @Input()\r\n  get predefinedRadius(): boolean {\r\n    return this._predefinedRadius;\r\n  }\r\n  set predefinedRadius(value: boolean) {\r\n    this._predefinedRadius = value;\r\n    this.drawControl.ispredefinedRadius$.next(value);\r\n  }\r\n  private _predefinedRadius: boolean;\r\n\r\n  /**\r\n   * Control options\r\n   */\r\n  @Input() controlOptions: { [key: string]: any } = {};\r\n\r\n  /**\r\n   * Style for the draw control (applies while the geometry is being drawn)\r\n   */\r\n  @Input()\r\n  set drawStyle(value: OlStyleLike | OlStyle.RegularShape) {\r\n    if (value === undefined) {\r\n      value = createDrawInteractionStyle();\r\n    }\r\n    this._drawStyle = value;\r\n\r\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value);\r\n    if (olGuideStyle !== undefined) {\r\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\r\n    } else {\r\n      this.defaultDrawStyleRadius = null;\r\n    }\r\n\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateControl();\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n    this.toggleControl();\r\n  }\r\n  get drawStyle(): OlStyleLike | OlStyle.RegularShape {\r\n    return this._drawStyle;\r\n  }\r\n  private _drawStyle: OlStyleLike | OlStyle.RegularShape;\r\n\r\n  /**\r\n   * Style for the overlay layer (applies once the geometry is added to the map)\r\n   * If not specified, drawStyle applies\r\n   */\r\n  @Input()\r\n  set overlayStyle(value: OlStyleLike | OlStyle.RegularShape) {\r\n    this._overlayStyle = value;\r\n  }\r\n  get overlayStyle(): OlStyleLike | OlStyle.RegularShape {\r\n    return this._overlayStyle;\r\n  }\r\n  private _overlayStyle: OlStyleLike | OlStyle.RegularShape;\r\n\r\n  /**\r\n   * The geometry value (GeoJSON)\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  @Input()\r\n  set value(value: GeoJSONGeometry) {\r\n    this._value = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    if (value) {\r\n      this.addGeoJSONToOverlay(value);\r\n    } else {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n    this.onChange(value);\r\n    this.toggleControl();\r\n    this.cdRef.detectChanges();\r\n  }\r\n  get value(): GeoJSONGeometry {\r\n    return this._value;\r\n  }\r\n  private _value: GeoJSONGeometry;\r\n\r\n  /**\r\n   * The vector source to add the geometry to\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  @Input()\r\n  set radius(value: any) {\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n    if (this.modifyControl.getSource()) {\r\n      this.modifyControl.getSource().refresh();\r\n    }\r\n    if (this.freehandDrawIsActive) {\r\n      let olModify;\r\n      setTimeout(() => {\r\n        olModify = this.modifyControl.olModifyInteraction;\r\n        if (olModify) {\r\n          if (olModify.features_) {\r\n            olModify.features_.clear();\r\n            this.addGeoJSONToOverlay(this.value);\r\n          }\r\n        }\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    @Optional() @Self() public ngControl: NgControl\r\n  ) {\r\n    if (this.ngControl !== undefined) {\r\n      // Setting the value accessor directly (instead of using\r\n      // the providers) to avoid running into a circular import.\r\n      this.ngControl.valueAccessor = this;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create an overlay layer, add the initial geometry to it (if any)\r\n   * and toggle the right interaction.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    if (this.drawStyle === undefined) {\r\n      this.drawStyle = createDrawInteractionStyle();\r\n    }\r\n\r\n    if (this.overlayStyle === undefined) {\r\n      this.overlayStyle = this.drawStyle;\r\n    }\r\n\r\n    this.addOlOverlayLayer();\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    if (this.value) {\r\n      this.addGeoJSONToOverlay(this.value);\r\n    }\r\n    this.toggleControl();\r\n\r\n    this.ready = true;\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer and any interaction added by this component.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    // This is mandatory when the form control is reused after\r\n    // this component has been destroyed. It seems like the control\r\n    // keeps a reference to this component even after it's destroyed\r\n    // and it attempts to set it's value\r\n    this.ready = false;\r\n\r\n    this.deactivateControl();\r\n    this.olOverlaySource.clear();\r\n    this.map.ol.removeLayer(this.olOverlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  registerOnChange(fn: Function) {\r\n    this.onChange = fn;\r\n  }\r\n  private onChange: any = () => {};\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  registerOnTouched(fn: Function) {\r\n    this.onTouched = fn;\r\n  }\r\n  private onTouched: any = () => {};\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  writeValue(value: GeoJSONGeometry) {\r\n    this.value = value;\r\n  }\r\n\r\n  /**\r\n   * Add an overlay layer to the map\r\n   */\r\n  private addOlOverlayLayer() {\r\n    this.olOverlayLayer = new OlVectorLayer({\r\n      source: new OlVectorSource(),\r\n      zIndex: 500,\r\n      style: null\r\n    });\r\n    this.map.ol.addLayer(this.olOverlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Create a draw control and subscribe to it's geometry\r\n   */\r\n  private createDrawControl() {\r\n    const controlOptions = Object.assign({}, this.controlOptions, {\r\n      geometryType: this.geometryType || 'Point',\r\n      drawingLayer: this.olOverlayLayer,\r\n      interactionStyle:\r\n        typeof this.drawStyle === 'function'\r\n          ? this.drawStyle\r\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\r\n              const style = this.drawStyle;\r\n              this.updateDrawStyleWithDrawGuide(style, resolution);\r\n              return style;\r\n            }\r\n    }) as DrawControlOptions;\r\n    this.drawControl = new DrawControl(controlOptions);\r\n  }\r\n\r\n  /**\r\n   * Create a modify control and subscribe to it's geometry\r\n   */\r\n  private createModifyControl() {\r\n    const controlOptions = Object.assign({}, this.controlOptions, {\r\n      layer: this.olOverlayLayer,\r\n      drawStyle:\r\n        typeof this.drawStyle === 'function'\r\n          ? this.drawStyle\r\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\r\n              const style = this.drawStyle;\r\n              this.updateDrawStyleWithDrawGuide(style, resolution);\r\n              return style;\r\n            }\r\n    }) as ModifyControlOptions;\r\n    this.modifyControl = new ModifyControl(controlOptions);\r\n  }\r\n\r\n  /**\r\n   * Toggle the proper control (draw or modify)\r\n   */\r\n  private toggleControl() {\r\n    let activate;\r\n    if (!this.value && this.geometryType) {\r\n      activate = this.drawControl;\r\n    } else {\r\n      activate = this.modifyControl;\r\n    }\r\n\r\n    // If the control that should be activated\r\n    // is not the same as the current active control,\r\n    // deactivate the current control and activate the new one\r\n    // Otherwise, do nothing and keep the current control active\r\n    if (activate !== this.activeControl) {\r\n      this.deactivateControl();\r\n      this.activateControl(activate);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param control Control\r\n   */\r\n  private activateControl(control: DrawControl | ModifyControl) {\r\n    this.activeControl = control;\r\n    this.olGeometryEnds$$ = control.end$.subscribe((olGeometry: OlGeometry) =>\r\n      this.onOlGeometryEnds(olGeometry)\r\n    );\r\n    if (this.measure === true && control === this.drawControl) {\r\n      this.olGeometryChanges$$ = control.changes$.subscribe(\r\n        (olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) =>\r\n          this.onOlGeometryChanges(olGeometry)\r\n      );\r\n    }\r\n    control.setOlMap(this.map.ol, false);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active control\r\n   */\r\n  private deactivateControl() {\r\n    this.removeMeasureTooltip();\r\n    if (this.activeControl !== undefined) {\r\n      this.activeControl.setOlMap(undefined);\r\n    }\r\n    if (this.olGeometryEnds$$ !== undefined) {\r\n      this.olGeometryEnds$$.unsubscribe();\r\n    }\r\n    if (this.olGeometryChanges$$ !== undefined) {\r\n      this.olGeometryChanges$$.unsubscribe();\r\n    }\r\n    this.activeControl = undefined;\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\r\n    this.removeMeasureTooltip();\r\n    this.setOlGeometry(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onOlGeometryChanges(\r\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\r\n  ) {\r\n    if (olGeometry.getType() !== 'Point') {\r\n      this.updateMeasureTooltip(olGeometry);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When drawing ends, convert the output value to GeoJSON and keep it.\r\n   * Restore the double click interaction.\r\n   * @param olGeometry OL geometry\r\n   */\r\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\r\n    let value;\r\n    if (olGeometry === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (olGeometry.getType() === 'Circle') {\r\n      // Because Circle doesn't exist as a GeoJSON object\r\n      olGeometry = this.circleToPoint(olGeometry);\r\n    }\r\n\r\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\r\n      featureProjection: this.map.projection,\r\n      dataProjection: 'EPSG:4326'\r\n    });\r\n    if (olGeometry.get('radius')) {\r\n      value.radius = olGeometry.get('radius');\r\n      olGeometry.set('radius', value.radius);\r\n    }\r\n    this.writeValue(value);\r\n  }\r\n\r\n  private circleToPoint(olGeometry) {\r\n    const center = olGeometry.getCenter();\r\n    const coordinates = olproj.transform(\r\n      center,\r\n      this.map.projection,\r\n      'EPSG:4326'\r\n    );\r\n    const radius = Math.round(\r\n      olGeometry.getRadius() * Math.cos((Math.PI / 180) * coordinates[1])\r\n    );\r\n\r\n    // Convert it to a point object\r\n    olGeometry = new Point(center);\r\n    olGeometry.set('radius', radius, true);\r\n    return olGeometry;\r\n  }\r\n\r\n  /**\r\n   * Add a GeoJSON geometry to the overlay\r\n   * @param geometry GeoJSON geometry\r\n   */\r\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\r\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: this.map.projection\r\n    });\r\n    const olFeature = new OlFeature({\r\n      geometry: olGeometry\r\n    });\r\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\r\n    this.olOverlaySource.clear();\r\n    this.olOverlaySource.addFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Create the measure tooltip\r\n   */\r\n  private createMeasureTooltip() {\r\n    return new OlOverlay({\r\n      element: document.createElement('div'),\r\n      offset: [-30, -10],\r\n      className: ['igo-map-tooltip', 'igo-map-tooltip-measure'].join(' '),\r\n      stopEvent: false\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update the measure tooltip of an OL geometry\r\n   * @param olGeometry OL Geometry\r\n   */\r\n  private updateMeasureTooltip(\r\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\r\n  ) {\r\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\r\n    const lengths = measure.lengths;\r\n    const lastIndex =\r\n      olGeometry.getType() === 'Polygon'\r\n        ? lengths.length - 2\r\n        : lengths.length - 1;\r\n    const lastLength = lengths[lastIndex];\r\n\r\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n    const olLastMidpoint = olMidpoints[lastIndex];\r\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\r\n      this.removeMeasureTooltip();\r\n      return;\r\n    }\r\n\r\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\r\n\r\n    const innerHtml = formatMeasure(lastLength, {\r\n      decimal: 1,\r\n      unit: MeasureLengthUnit.Meters,\r\n      unitAbbr: true,\r\n      locale: 'fr'\r\n    });\r\n    this.olTooltip.getElement().innerHTML = innerHtml;\r\n    if (this.olTooltip.getMap() === undefined) {\r\n      this.map.ol.addOverlay(this.olTooltip);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the measure tooltip from the map\r\n   */\r\n  private removeMeasureTooltip() {\r\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\r\n      this.map.ol.removeOverlay(this.olTooltip);\r\n      this.olTooltip.setMap(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adjust the draw style with the specified draw guide distance, if possible\r\n   * @param olStyle Draw style to update\r\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\r\n   */\r\n  private updateDrawStyleWithDrawGuide(\r\n    olStyle: OlStyleLike | OlStyle.RegularShape,\r\n    resolution: number\r\n  ) {\r\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle);\r\n    if (olGuideStyle === undefined) {\r\n      return;\r\n    }\r\n    const drawGuide = this.drawGuide;\r\n    let radius;\r\n    if (!drawGuide || drawGuide < 0) {\r\n      radius = this.defaultDrawStyleRadius;\r\n    } else {\r\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\r\n    }\r\n    olGuideStyle.setRadius(radius);\r\n  }\r\n\r\n  /**\r\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\r\n   * @param olStyle The style on which to perform the check\r\n   */\r\n  private getGuideStyleFromDrawStyle(\r\n    olStyle: OlStyleLike | OlStyle.RegularShape\r\n  ): HasRadius | undefined {\r\n    let baseStyle: unknown;\r\n    if (Array.isArray(olStyle)) {\r\n      baseStyle = olStyle[0];\r\n    } else {\r\n      baseStyle = olStyle;\r\n    }\r\n\r\n    if (typeof (baseStyle as any).getImage === 'function') {\r\n      baseStyle = (baseStyle as any).getImage() as OlStyle.Image;\r\n    }\r\n\r\n    let guideStyle: HasRadius;\r\n    if (typeof (baseStyle as any).setRadius === 'function') {\r\n      guideStyle = baseStyle as HasRadius;\r\n    }\r\n\r\n    return guideStyle;\r\n  }\r\n}\r\n","<ng-template></ng-template>\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MAT_DATE_LOCALE, MatNativeDateModule } from '@angular/material/core';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDatepickerModule } from '@angular/material/datepicker';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatSliderModule } from '@angular/material/slider';\r\nimport { MatTableModule } from '@angular/material/table';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatTreeModule } from '@angular/material/tree';\r\n\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoDOMModule,\r\n  IgoEntityModule,\r\n  IgoKeyValueModule,\r\n  IgoListModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport {\r\n  MatDatetimepickerModule,\r\n  MatNativeDatetimeModule\r\n} from '@mat-datetimepicker/core';\r\n\r\nimport { IgoLayerModule } from '../layer/layer.module';\r\nimport { IgoGeometryModule } from './../geometry/geometry.module';\r\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\r\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\r\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\r\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\r\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\r\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\r\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\r\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\r\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\r\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\r\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\r\nimport { OGCFilterService } from './shared/ogc-filter.service';\r\nimport { SpatialFilterService } from './shared/spatial-filter.service';\r\nimport { TimeFilterService } from './shared/time-filter.service';\r\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\r\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\r\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\r\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\r\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\r\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\r\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\r\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatAutocompleteModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTabsModule,\r\n    MatRadioModule,\r\n    MatMenuModule,\r\n    MatTableModule,\r\n    MatTreeModule,\r\n    MatButtonToggleModule,\r\n    MatCheckboxModule,\r\n    MatSliderModule,\r\n    MatSlideToggleModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    MatDatepickerModule,\r\n    MatNativeDateModule,\r\n    MatDatetimepickerModule,\r\n    MatNativeDatetimeModule,\r\n    IgoLanguageModule,\r\n    IgoLayerModule,\r\n    IgoCollapsibleModule,\r\n    IgoListModule,\r\n    IgoEntityModule,\r\n    IgoDOMModule,\r\n    IgoKeyValueModule,\r\n    IgoGeometryModule,\r\n    MatBadgeModule\r\n  ],\r\n  exports: [\r\n    FilterableDataSourcePipe,\r\n    TimeFilterButtonComponent,\r\n    TimeFilterFormComponent,\r\n    TimeFilterItemComponent,\r\n    TimeFilterListComponent,\r\n    TimeFilterListBindingDirective,\r\n    OgcFilterFormComponent,\r\n    OgcFilterButtonComponent,\r\n    OgcFilterSelectionComponent,\r\n    OgcFilterableFormComponent,\r\n    OgcFilterableItemComponent,\r\n    OgcFilterableListComponent,\r\n    OgcFilterableListBindingDirective,\r\n    SpatialFilterTypeComponent,\r\n    SpatialFilterListComponent,\r\n    SpatialFilterItemComponent,\r\n    OgcFilterTimeComponent,\r\n    OgcFilterTimeSliderComponent\r\n  ],\r\n  declarations: [\r\n    FilterableDataSourcePipe,\r\n    TimeFilterButtonComponent,\r\n    TimeFilterFormComponent,\r\n    TimeFilterItemComponent,\r\n    TimeFilterListComponent,\r\n    TimeFilterListBindingDirective,\r\n    OgcFilterFormComponent,\r\n    OgcFilterButtonComponent,\r\n    OgcFilterSelectionComponent,\r\n    OgcFilterableFormComponent,\r\n    OgcFilterableItemComponent,\r\n    OgcFilterableListComponent,\r\n    OgcFilterableListBindingDirective,\r\n    SpatialFilterTypeComponent,\r\n    SpatialFilterListComponent,\r\n    SpatialFilterItemComponent,\r\n    OgcFilterTimeComponent,\r\n    OgcFilterTimeSliderComponent\r\n  ],\r\n  providers: [\r\n    TimeFilterService,\r\n    OGCFilterService,\r\n    OGCFilterTimeService,\r\n    SpatialFilterService\r\n  ]\r\n})\r\nexport class IgoFilterModule {\r\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\r\n    return {\r\n      ngModule: IgoFilterModule,\r\n      providers: [\r\n        {\r\n          provide: MAT_DATE_LOCALE,\r\n          useValue: 'fr-FR'\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport {\r\n  IgoCustomHtmlModule,\r\n  IgoDrapDropModule,\r\n  IgoKeyValueModule,\r\n  IgoSpinnerModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { ExportButtonComponent } from './export-button/export-button.component';\r\nimport { ImportExportComponent } from './import-export/import-export.component';\r\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\r\n\r\n@NgModule({\r\n  imports: [\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatTabsModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule,\r\n    IgoSpinnerModule,\r\n    IgoKeyValueModule,\r\n    IgoDrapDropModule,\r\n    IgoCustomHtmlModule\r\n  ],\r\n  exports: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent],\r\n  declarations: [\r\n    ImportExportComponent,\r\n    DropGeoFileDirective,\r\n    ExportButtonComponent\r\n  ]\r\n})\r\nexport class IgoImportExportModule {\r\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\r\n    return {\r\n      ngModule: IgoImportExportModule\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoConfirmDialogModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\r\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\r\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\r\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\r\nimport { InfoSectionComponent } from './info-section/info-section.component';\r\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\r\nimport { MapCenterComponent } from './map-center/map-center.component';\r\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\r\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\r\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\r\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\r\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\r\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\r\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\r\nimport { WakeLockButtonComponent } from './wake-lock-button/wake-lock-button.component';\r\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoLanguageModule,\r\n    IgoConfirmDialogModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule\r\n  ],\r\n  exports: [\r\n    MapBrowserComponent,\r\n    ZoomButtonComponent,\r\n    GeolocateButtonComponent,\r\n    HomeExtentButtonComponent,\r\n    RotationButtonComponent,\r\n    InfoSectionComponent,\r\n    BaseLayersSwitcherComponent,\r\n    MiniBaseMapComponent,\r\n    MapOfflineDirective,\r\n    OfflineButtonComponent,\r\n    WakeLockButtonComponent,\r\n    PointerPositionDirective,\r\n    HoverFeatureDirective,\r\n    SwipeControlComponent,\r\n    MapCenterComponent,\r\n    MenuButtonComponent\r\n  ],\r\n  declarations: [\r\n    MapBrowserComponent,\r\n    ZoomButtonComponent,\r\n    GeolocateButtonComponent,\r\n    HomeExtentButtonComponent,\r\n    RotationButtonComponent,\r\n    InfoSectionComponent,\r\n    BaseLayersSwitcherComponent,\r\n    MiniBaseMapComponent,\r\n    MapOfflineDirective,\r\n    OfflineButtonComponent,\r\n    WakeLockButtonComponent,\r\n    PointerPositionDirective,\r\n    HoverFeatureDirective,\r\n    SwipeControlComponent,\r\n    MapCenterComponent,\r\n    MenuButtonComponent\r\n  ]\r\n})\r\nexport class IgoMapModule {}\r\n","<mat-form-field class=\"measure-field\" floatLabel=\"always\">\n  <mat-label>{{ placeholder }}</mat-label>\n  <input\n    matInput\n    [disabled]=\"true\"\n    [readonly]=\"true\"\n    [value]=\"(measure$ | async) || 0 | measureFormat: measureUnit\"\n  />\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\"\n  >\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{ 'igo.geo.measure.' + measureUnit | translate }}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport {\r\n  MeasureAreaUnit,\r\n  MeasureLengthUnit,\r\n  MeasureType\r\n} from '../shared/measure.enum';\r\nimport {\r\n  computeBestAreaUnit,\r\n  computeBestLengthUnit\r\n} from '../shared/measure.utils';\r\n\r\n/**\r\n * Measurer item\r\n */\r\n@Component({\r\n  selector: 'igo-measurer-item',\r\n  templateUrl: './measurer-item.component.html',\r\n  styleUrls: ['./measurer-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerItemComponent implements OnDestroy {\r\n  /**\r\n   * Measure observable\r\n   * @internal\r\n   */\r\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Subscription to the measure observable when the auto mode is on\r\n   * @internal\r\n   */\r\n  public measure$$: Subscription;\r\n\r\n  /**\r\n   * Measure type\r\n   */\r\n  @Input() measureType: MeasureType;\r\n\r\n  /**\r\n   * Measure unit\r\n   */\r\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\r\n\r\n  /**\r\n   * Measure\r\n   */\r\n  @Input()\r\n  set measure(value: number) {\r\n    this.measure$.next(value);\r\n  }\r\n  get measure(): number {\r\n    return this.measure$.value;\r\n  }\r\n\r\n  /**\r\n   * Whther measure units should be automatically determined\r\n   */\r\n  @Input()\r\n  set auto(value: boolean) {\r\n    this.toggleAutoUnit(value);\r\n  }\r\n  get auto(): boolean {\r\n    return this._auto;\r\n  }\r\n  private _auto: boolean = false;\r\n\r\n  /**\r\n   * Placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Event emitted when the measure unit changes\r\n   */\r\n  @Output() measureUnitChange = new EventEmitter<\r\n    MeasureAreaUnit | MeasureLengthUnit\r\n  >();\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    if (this.measureType === MeasureType.Area) {\r\n      return Object.values(MeasureAreaUnit);\r\n    }\r\n    return Object.values(MeasureLengthUnit);\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Toggle the auto unit off\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.toggleAutoUnit(false);\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\r\n    this.measureUnit = unit;\r\n    this.measureUnitChange.emit(unit);\r\n  }\r\n\r\n  private toggleAutoUnit(toggle: boolean) {\r\n    if (this.measure$$ !== undefined) {\r\n      this.measure$$.unsubscribe();\r\n    }\r\n    if (toggle === true) {\r\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\r\n        this.computeBestMeasureUnit(measure);\r\n      });\r\n    }\r\n    this._auto = toggle;\r\n  }\r\n\r\n  private computeBestMeasureUnit(measure: number) {\r\n    let measureUnit = this.measureUnit;\r\n    if (this.measureType === MeasureType.Area) {\r\n      measureUnit = computeBestAreaUnit(measure);\r\n    } else if (this.measureType === MeasureType.Length) {\r\n      measureUnit = computeBestLengthUnit(measure);\r\n    }\r\n    if (measureUnit !== this.measureUnit) {\r\n      this.onMeasureUnitChange(measureUnit);\r\n    }\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoEntityTableModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { MeasureFormatPipe } from './measure-format.pipe';\r\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\r\nimport { MeasurerItemComponent } from './measurer-item.component';\r\nimport { MeasurerComponent } from './measurer.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatDialogModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    MatDividerModule,\r\n    IgoLanguageModule,\r\n    IgoEntityTableModule\r\n  ],\r\n  declarations: [\r\n    MeasureFormatPipe,\r\n    MeasurerItemComponent,\r\n    MeasurerComponent,\r\n    MeasurerDialogComponent\r\n  ],\r\n  exports: [MeasureFormatPipe, MeasurerComponent]\r\n})\r\nexport class IgoMeasurerModule {}\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoMeasurerModule } from './measurer/measurer.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [IgoMeasurerModule]\n})\nexport class IgoMeasureModule {}\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\n\r\nimport { IgoKeyValueModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { PrintFormComponent } from './print-form/print-form.component';\r\nimport { PrintComponent } from './print/print.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatInputModule,\r\n    MatFormFieldModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule,\r\n    IgoKeyValueModule\r\n  ],\r\n  exports: [PrintComponent, PrintFormComponent],\r\n  declarations: [PrintComponent, PrintFormComponent]\r\n})\r\nexport class IgoPrintModule {}\r\n","import { ConfigService } from '@igo2/core';\r\n\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\nimport { QuerySearchSource } from './query-search-source';\r\n\r\n/**\r\n * Map search source factory\r\n * @ignore\r\n */\r\nexport function querySearchSourceFactory(config: ConfigService) {\r\n  return new QuerySearchSource(\r\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the map search source\r\n */\r\nexport function provideQuerySearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: querySearchSourceFactory,\r\n    multi: true,\r\n    deps: [ConfigService]\r\n  };\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { IgoLanguageModule, IgoMessageModule } from '@igo2/core';\r\n\r\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\r\nimport { QueryDirective } from './shared/query.directive';\r\nimport { QueryService } from './shared/query.service';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, IgoLanguageModule, IgoMessageModule],\r\n  exports: [QueryDirective],\r\n  declarations: [QueryDirective],\r\n  providers: [QueryService]\r\n})\r\nexport class IgoQueryModule {\r\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\r\n    return {\r\n      ngModule: IgoQueryModule,\r\n      providers: [provideQuerySearchSource()]\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { SearchSelectorComponent } from './search-selector.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatTabsModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [SearchSelectorComponent],\r\n  declarations: [SearchSelectorComponent]\r\n})\r\nexport class IgoSearchSelectorModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { SearchSettingsComponent } from './search-settings.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  declarations: [SearchSettingsComponent],\r\n  imports: [\r\n    CommonModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatCheckboxModule,\r\n    MatDividerModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [SearchSettingsComponent]\r\n})\r\nexport class IgoSearchSettingsModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\r\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\r\nimport { SearchBarComponent } from './search-bar.component';\r\nimport { SearchUrlParamDirective } from './search-url-param.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatDividerModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    IgoLanguageModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchSettingsModule\r\n  ],\r\n  exports: [SearchBarComponent],\r\n  declarations: [SearchBarComponent, SearchUrlParamDirective]\r\n})\r\nexport class IgoSearchBarModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoListModule,\r\n  IgoMatBadgeIconModule,\r\n  IgoStopPropagationModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\r\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\r\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\r\nimport { SearchResultsItemComponent } from './search-results-item.component';\r\nimport { SearchResultsComponent } from './search-results.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoCollapsibleModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoMetadataModule,\r\n    IgoStopPropagationModule,\r\n    MatAutocompleteModule,\r\n    MatBadgeModule,\r\n    MatButtonModule,\r\n    MatDialogModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatInputModule,\r\n    MatListModule,\r\n    MatSelectModule,\r\n    MatTabsModule,\r\n    MatTooltipModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  exports: [SearchResultsComponent, SearchResultAddButtonComponent],\r\n  declarations: [\r\n    SearchResultsComponent,\r\n    SearchResultsItemComponent,\r\n    SearchResultAddButtonComponent,\r\n    SaveFeatureDialogComponent\r\n  ]\r\n})\r\nexport class IgoSearchResultsModule {}\r\n","import { Workspace } from '@igo2/common';\r\n\r\nimport { SearchSource } from './sources/source';\r\nimport { SearchSourceSettings } from './sources/source.interfaces';\r\n\r\n/**\r\n * Service where all available search sources are registered.\r\n */\r\nexport class SearchSourceService {\r\n  constructor(private sources: SearchSource[]) {}\r\n\r\n  /**\r\n   * Return available search sources\r\n   * @returns Search sources\r\n   */\r\n  getSources(): SearchSource[] {\r\n    return this.sources;\r\n  }\r\n\r\n  /**\r\n   * Return enabled search sources\r\n   * @returns Search sources\r\n   */\r\n  getEnabledSources(): SearchSource[] {\r\n    return this.getSources().filter(\r\n      (source: SearchSource) => source.enabled === true\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Enable search sources of given type\r\n   * @param type Search type\r\n   * @todo It would be better to track the enabled search sources\r\n   *  without updating their 'enabled' property.\r\n   */\r\n  enableSourcesByType(type: string) {\r\n    this.getSources().forEach((source: SearchSource) => {\r\n      if ((source.constructor as typeof SearchSource).type === type) {\r\n        source.enabled = true;\r\n      } else {\r\n        source.enabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set Param from the selected settings\r\n   * @param source search-source\r\n   * @param setting settings\r\n   */\r\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\r\n    source.setParamFromSetting(setting);\r\n  }\r\n\r\n  /**\r\n   * Set Param from the selected settings\r\n   * @param source search-source\r\n   * @param setting settings\r\n   */\r\n  setWorkspaces(source: SearchSource, workspaces: Workspace[]) {\r\n    source.setWorkspaces(workspaces);\r\n  }\r\n}\r\n","import { SearchSourceService } from './search-source.service';\r\nimport { SearchSource } from './sources/source';\r\n\r\n/**\r\n * Search source factory\r\n * @ignore\r\n */\r\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\r\n  return new SearchSourceService(sources);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the SearchSource service\r\n */\r\nexport function provideSearchSourceService() {\r\n  return {\r\n    provide: SearchSourceService,\r\n    useFactory: searchSourceServiceFactory,\r\n    deps: [SearchSource]\r\n  };\r\n}\r\n","import { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { SearchResult } from './search.interfaces';\r\nimport { SearchSource } from './sources/source';\r\n\r\n/**\r\n * Function that checks whether a search source implements TextSearch\r\n * @param source Search source\r\n * @returns True if the search source implements TextSearch\r\n */\r\nexport function sourceCanSearch(source: SearchSource): boolean {\r\n  return (source as any).search !== undefined;\r\n}\r\n\r\n/**\r\n * Function that checks whether a search source implements ReverseSearch\r\n * @param source Search source\r\n * @returns True if the search source implements ReverseSearch\r\n */\r\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\r\n  return (source as any).reverseSearch !== undefined;\r\n}\r\n\r\n/**\r\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\r\n * @param source Search source\r\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\r\n */\r\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\r\n  return (\r\n    (source as any).reverseSearch !== undefined &&\r\n    source.showInPointerSummary === true\r\n  );\r\n}\r\n\r\n/**\r\n * Return a search result out of an Feature. This is used to adapt\r\n * the IGO query module to the new Feature/SearchResult interfaces\r\n * @param feature feature\r\n * @param source Search source\r\n * @returns SearchResult\r\n */\r\nexport function featureToSearchResult(\r\n  feature: Feature,\r\n  source: SearchSource\r\n): SearchResult<Feature> {\r\n  if (feature.properties) {\r\n    delete feature.properties.geometry;\r\n    delete feature.properties.GEOMETRIE;\r\n    delete feature.properties.boundedBy;\r\n    delete feature.properties.shape;\r\n    delete feature.properties.SHAPE;\r\n    delete feature.properties.SHAPE_S;\r\n    delete feature.properties.SHAPE_L;\r\n    delete feature.properties.SHAPE_P;\r\n    delete feature.properties.the_geom;\r\n    delete feature.properties.geom;\r\n    delete feature.properties.geom32198;\r\n  }\r\n  feature.sourceId = source.getId();\r\n  return {\r\n    source,\r\n    data: feature,\r\n    meta: {\r\n      dataType: FEATURE,\r\n      id: feature.meta.id as string,\r\n      title: feature.meta.title,\r\n      icon: feature.meta.icon || 'map-marker'\r\n    }\r\n  };\r\n}\r\n\r\nexport function findDiff(str1: string, str2: string) {\r\n  let diff = '';\r\n  str2.split('').forEach((val, i) => {\r\n    if (val !== str1.charAt(i)) {\r\n      diff += val;\r\n    }\r\n  });\r\n  return diff;\r\n}\r\n\r\n/**\r\n * Return a score calculation based on \"from\" term with the \"to\" term,\r\n * where the perfect match is 100 and a total difference is 0 or under.\r\n * @param from string\r\n * @param to string\r\n * @param caseSensitive boolean\r\n * @returns number\r\n */\r\nexport function computeTermSimilarity(\r\n  from,\r\n  to,\r\n  caseSensitive: boolean = false\r\n): number {\r\n  if (!from || !to) {\r\n    return 0;\r\n  }\r\n  const termFrom = caseSensitive ? from : from.toString().toLowerCase();\r\n  const termTo = caseSensitive ? to : to.toString().toLowerCase();\r\n  const fromToDiff = findDiff(termFrom, termTo);\r\n  const toFromDiff = findDiff(termTo, termFrom);\r\n  const totalDiff = fromToDiff + toFromDiff;\r\n\r\n  let delta = 0;\r\n  if (totalDiff.length) {\r\n    delta = (totalDiff.length / termFrom.length) * 100;\r\n  }\r\n\r\n  return 100 - Math.floor(delta);\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { StorageService } from '@igo2/core';\r\n\r\nimport { stringToLonLat } from '../../map/shared';\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { SearchSourceService } from './search-source.service';\r\nimport { Research, ReverseSearch, TextSearch } from './search.interfaces';\r\nimport {\r\n  sourceCanReverseSearch,\r\n  sourceCanReverseSearchAsSummary,\r\n  sourceCanSearch\r\n} from './search.utils';\r\nimport { SearchSource } from './sources/source';\r\nimport {\r\n  ReverseSearchOptions,\r\n  TextSearchOptions\r\n} from './sources/source.interfaces';\r\n\r\n/**\r\n * This service perform researches in all the search sources enabled.\r\n * It returns Research objects who's 'request' property needs to be\r\n * subscribed to in order to trigger the research. This services has\r\n * keeps internal state of the researches it performed\r\n * and the results they yielded.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SearchService {\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private mapService: MapService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  /**\r\n   * Perform a research by text\r\n   * @param term Any text\r\n   * @returns Researches\r\n   */\r\n  search(term: string, options: TextSearchOptions = {}): Research[] {\r\n    if (!this.termIsValid(term)) {\r\n      return [];\r\n    }\r\n\r\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\r\n    const response = stringToLonLat(term, proj, {\r\n      forceNA: options.forceNA\r\n    });\r\n    if (response.lonLat) {\r\n      return this.reverseSearch(response.lonLat, {\r\n        distance: response.radius,\r\n        conf: response.conf\r\n      });\r\n    } else if (response.message) {\r\n      console.log(response.message);\r\n    }\r\n\r\n    options.extent = this.mapService\r\n      .getMap()\r\n      ?.viewController.getExtent('EPSG:4326');\r\n\r\n    let sources;\r\n\r\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\r\n      sources = this.searchSourceService.getEnabledSources();\r\n    } else {\r\n      sources = this.searchSourceService.getSources();\r\n    }\r\n\r\n    if (options.sourceId) {\r\n      sources = sources.filter((source) => source.getId() === options.sourceId);\r\n    } else if (options.searchType) {\r\n      sources = sources.filter(\r\n        (source) => source.getType() === options.searchType\r\n      );\r\n    }\r\n\r\n    sources = sources.filter(sourceCanSearch);\r\n    return this.searchSources(sources, term, options);\r\n  }\r\n\r\n  /**\r\n   * Perform a research by lon/lat\r\n   * @param lonLat Any lon/lat coordinates\r\n   * @returns Researches\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions,\r\n    asPointerSummary: boolean = false\r\n  ) {\r\n    const reverseSourceFonction = asPointerSummary\r\n      ? sourceCanReverseSearchAsSummary\r\n      : sourceCanReverseSearch;\r\n    const sources = this.searchSourceService\r\n      .getEnabledSources()\r\n      .filter(reverseSourceFonction);\r\n    const reverseSearchCoordsFormat =\r\n      (this.storageService.get(\r\n        'reverseSearchCoordsFormatEnabled'\r\n      ) as boolean) || false;\r\n\r\n    return this.reverseSearchSources(\r\n      sources,\r\n      lonLat,\r\n      options || {},\r\n      reverseSearchCoordsFormat\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a text research out of all given search sources\r\n   * @param sources Search sources that implement TextSearch\r\n   * @param term Search term\r\n   * @returns Observable of Researches\r\n   */\r\n  private searchSources(\r\n    sources: SearchSource[],\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): Research[] {\r\n    return sources.map((source: SearchSource) => {\r\n      return {\r\n        request: (source as any as TextSearch).search(term, options),\r\n        reverse: false,\r\n        source\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a reverse research out of all given search sources\r\n   * @param sources Search sources that implement ReverseSearch\r\n   * @param lonLat Any lon/lat coordinates\r\n   * @returns Observable of Researches\r\n   */\r\n  private reverseSearchSources(\r\n    sources: SearchSource[],\r\n    lonLat: [number, number],\r\n    options: ReverseSearchOptions,\r\n    reverseSearchCoordsFormat: boolean\r\n  ): Research[] {\r\n    return sources.map((source: SearchSource) => {\r\n      return {\r\n        request: (source as any as ReverseSearch).reverseSearch(\r\n          lonLat,\r\n          options,\r\n          reverseSearchCoordsFormat\r\n        ),\r\n        reverse: true,\r\n        source\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validate that a search term is valid\r\n   * @param term Search term\r\n   * @returns True if the search term is valid\r\n   */\r\n  private termIsValid(term: string): boolean {\r\n    return typeof term === 'string' && term !== '';\r\n  }\r\n}\r\n","import { Inject, Injectable } from '@angular/core';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport { fromCircle } from 'ol/geom/Polygon';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\nimport {\r\n  convertDDToDMS,\r\n  lonLatConversion,\r\n  roundCoordTo\r\n} from '../../../map/shared/map.utils';\r\nimport { Projection } from '../../../map/shared/projection.interfaces';\r\nimport { OsmLinks } from '../../../utils';\r\nimport { GoogleLinks } from '../../../utils/googleLinks';\r\nimport { ReverseSearch, SearchResult } from '../search.interfaces';\r\nimport { SearchSource } from './source';\r\nimport { ReverseSearchOptions, SearchSourceOptions } from './source.interfaces';\r\n\r\n@Injectable()\r\nexport class CoordinatesSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\r\n    return result;\r\n  }\r\n}\r\n/**\r\n * CoordinatesReverse search source\r\n */\r\n@Injectable()\r\nexport class CoordinatesReverseSearchSource\r\n  extends SearchSource\r\n  implements ReverseSearch\r\n{\r\n  static id = 'coordinatesreverse';\r\n  static type = FEATURE;\r\n\r\n  private projections;\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    @Inject('options') options: SearchSourceOptions,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('projections') projections: Projection[]\r\n  ) {\r\n    super(options, storageService);\r\n    this.projections = projections;\r\n    this.languageService.language$.subscribe(() => {\r\n      this.title$.next(\r\n        this.languageService.translate.instant(this.options.title)\r\n      );\r\n    });\r\n  }\r\n\r\n  getId(): string {\r\n    return CoordinatesReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return CoordinatesReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'igo.geo.search.coordinates.name',\r\n      order: 1,\r\n      showInSettings: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions,\r\n    reverseSearchCoordsFormatEnabled?: boolean\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return of([\r\n      this.dataToResult(lonLat, options, reverseSearchCoordsFormatEnabled)\r\n    ]);\r\n  }\r\n\r\n  private dataToResult(\r\n    data: [number, number],\r\n    options: ReverseSearchOptions,\r\n    reverseSearchCoordsFormatEnabled: boolean\r\n  ): SearchResult<Feature> {\r\n    const dataDMS = convertDDToDMS(data);\r\n    const convertedCoord = lonLatConversion(data, this.projections);\r\n    const coords = convertedCoord.reduce(\r\n      (obj, item) => ((obj[item.alias] = item.igo2CoordFormat), obj),\r\n      {}\r\n    );\r\n\r\n    const roundedCoordString = !reverseSearchCoordsFormatEnabled\r\n      ? roundCoordTo(data, 6).join(', ')\r\n      : roundCoordTo(data, 6).reverse().join(', ');\r\n\r\n    const roundedCoordStringDMS = !reverseSearchCoordsFormatEnabled\r\n      ? dataDMS.join(', ')\r\n      : dataDMS.reverse().join(', ');\r\n\r\n    let geometry: FeatureGeometry = {\r\n      type: 'Point',\r\n      coordinates: [data[0], data[1]]\r\n    };\r\n\r\n    const properties = {};\r\n    let subtitleHtml = '';\r\n    if (options.distance) {\r\n      const radiusKey = this.languageService.translate.instant(\r\n        'igo.geo.search.coordinates.radius'\r\n      );\r\n      properties[radiusKey] = options.distance;\r\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\r\n\r\n      // Create polygon\r\n      const center = olproj.transform(\r\n        [data[0], data[1]],\r\n        'EPSG:4326',\r\n        'EPSG:3857'\r\n      );\r\n      const circleGeometry = new OlCircle(center, options.distance);\r\n      const polygonGeometry = fromCircle(circleGeometry);\r\n      const writer = new olformat.GeoJSON();\r\n      geometry = JSON.parse(\r\n        writer.writeGeometry(\r\n          polygonGeometry.transform('EPSG:3857', 'EPSG:4326')\r\n        )\r\n      );\r\n    }\r\n\r\n    if (options.conf) {\r\n      const confKey = this.languageService.translate.instant(\r\n        'igo.geo.search.coordinates.conf'\r\n      );\r\n      properties[confKey] = options.conf;\r\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\r\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\r\n    }\r\n\r\n    const coordKey = !reverseSearchCoordsFormatEnabled\r\n      ? this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.coord'\r\n        )\r\n      : this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.reversedCoord'\r\n        );\r\n    properties[coordKey] = roundedCoordString;\r\n\r\n    const coordKeyDMS = !reverseSearchCoordsFormatEnabled\r\n      ? this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.coordDMS'\r\n        )\r\n      : this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.reversedCoordDMS'\r\n        );\r\n    properties[coordKeyDMS] = roundedCoordStringDMS;\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        extent: undefined,\r\n        properties: Object.assign(properties, coords, {\r\n          GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\r\n          GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\r\n            data[0],\r\n            data[1]\r\n          ),\r\n          OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\r\n          Route:\r\n            '<span class=\"routing\"> <u>' +\r\n            this.languageService.translate.instant('igo.geo.seeRouting') +\r\n            '</u> </span>'\r\n        }),\r\n        meta: {\r\n          id: data[0].toString() + ',' + data[1].toString(),\r\n          title: roundedCoordString\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id: data[0].toString() + ',' + data[1].toString(),\r\n        title: roundedCoordString,\r\n        titleHtml: roundedCoordString + subtitleHtml,\r\n        icon: 'map-marker',\r\n        score: 100 // every coord exists\r\n      }\r\n    };\r\n  }\r\n}\r\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { Projection } from '../../../map/shared/projection.interfaces';\r\nimport { ProjectionService } from '../../../map/shared/projection.service';\r\nimport {\r\n  CoordinatesReverseSearchSource,\r\n  CoordinatesSearchResultFormatter\r\n} from './coordinates';\r\nimport { SearchSource } from './source';\r\n\r\n/**\r\n * Coordinate search result formatter factory\r\n * @ignore\r\n */\r\nexport function defaultCoordinatesSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new CoordinatesSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Coordinates search result formatter\r\n */\r\nexport function provideDefaultCoordinatesSearchResultFormatter() {\r\n  return {\r\n    provide: CoordinatesSearchResultFormatter,\r\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * CoordinatesReverse search source factory\r\n * @ignore\r\n */\r\nexport function CoordinatesReverseSearchSourceFactory(\r\n  config: ConfigService,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  _projectionService: ProjectionService\r\n) {\r\n  return new CoordinatesReverseSearchSource(\r\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\r\n    languageService,\r\n    storageService,\r\n    (config.getConfig('projections') as Projection[]) || []\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Coordinate search source\r\n */\r\nexport function provideCoordinatesReverseSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: CoordinatesReverseSearchSourceFactory,\r\n    multi: true,\r\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\r\n  };\r\n}\r\n","import {\r\n  HttpClient,\r\n  HttpParameterCodec,\r\n  HttpParams\r\n} from '@angular/common/http';\r\nimport { Inject, Injectable, Injector } from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\r\n\r\nimport pointOnFeature from '@turf/point-on-feature';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { catchError, map } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport { FEATURE, Feature } from '../../../feature';\r\nimport { ReverseSearch, SearchResult, TextSearch } from '../search.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { GoogleLinks } from './../../../utils/googleLinks';\r\nimport {\r\n  IChercheData,\r\n  IChercheResponse,\r\n  IChercheReverseData,\r\n  IChercheReverseResponse\r\n} from './icherche.interfaces';\r\nimport { SearchSource } from './source';\r\nimport {\r\n  ReverseSearchOptions,\r\n  SearchSourceOptions,\r\n  SearchSourceSettings,\r\n  TextSearchOptions\r\n} from './source.interfaces';\r\n\r\n@Injectable()\r\nexport class IChercheSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\r\n    return result;\r\n  }\r\n}\r\n\r\n// Fix the \"+\" is replaced with space \" \" in a query string\r\n// https://github.com/angular/angular/issues/11058\r\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\r\n  encodeKey(key: string): string {\r\n    return encodeURIComponent(key);\r\n  }\r\n\r\n  encodeValue(value: string): string {\r\n    return encodeURIComponent(value);\r\n  }\r\n\r\n  decodeKey(key: string): string {\r\n    return decodeURIComponent(key);\r\n  }\r\n\r\n  decodeValue(value: string): string {\r\n    return decodeURIComponent(value);\r\n  }\r\n}\r\n\r\n/**\r\n * ICherche search source\r\n */\r\n@Injectable()\r\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'icherche';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  private hashtagsLieuxToKeep = [];\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    @Inject(IChercheSearchResultFormatter)\r\n    private formatter: IChercheSearchResultFormatter,\r\n    injector: Injector\r\n  ) {\r\n    super(options, storageService);\r\n\r\n    const authService = injector.get(AuthService);\r\n    if (this.settings.length) {\r\n      if (!authService) {\r\n        this.getAllowedTypes();\r\n      } else {\r\n        authService.authenticate$.subscribe(() => {\r\n          this.getAllowedTypes();\r\n        });\r\n      }\r\n    }\r\n\r\n    this.languageService.language$.subscribe(() => {\r\n      this.title$.next(\r\n        this.languageService.translate.instant(this.options.title)\r\n      );\r\n    });\r\n  }\r\n\r\n  getId(): string {\r\n    return IChercheSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return IChercheSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const limit =\r\n      this.options.params && this.options.params.limit\r\n        ? Number(this.options.params.limit)\r\n        : undefined;\r\n    const ecmax =\r\n      this.options.params && this.options.params.ecmax\r\n        ? Number(this.options.params.ecmax)\r\n        : undefined;\r\n\r\n    const types = this.options.params?.type\r\n      ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\r\n      : [\r\n          'adresses',\r\n          'codes-postaux',\r\n          'routes',\r\n          'intersections',\r\n          'municipalites',\r\n          'mrc',\r\n          'regadmin',\r\n          'lieux'\r\n        ];\r\n\r\n    const showAdvancedParams = this.options.showAdvancedSettings ?? true;\r\n\r\n    return {\r\n      title: 'igo.geo.search.icherche.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.type.address',\r\n              value: 'adresses',\r\n              enabled: types.indexOf('adresses') !== -1,\r\n              hashtags: ['adresse']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.oldAddress',\r\n              value: 'anciennes-adresses',\r\n              enabled: types.indexOf('anciennes-adresses') !== -1,\r\n              hashtags: ['anciennes-adresses']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.oldCity',\r\n              value: 'anciennes-municipalites',\r\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\r\n              hashtags: ['anciennes-municipalites']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cn',\r\n              value: 'bornes-cn',\r\n              enabled: types.indexOf('bornes-cn') !== -1,\r\n              hashtags: ['borne', 'bornes', 'cn']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.sumi',\r\n              value: 'bornes-sumi',\r\n              enabled: types.indexOf('bornes-sumi') !== -1,\r\n              hashtags: ['borne', 'bornes', 'sumi']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cadastre',\r\n              value: 'cadastre',\r\n              enabled: types.indexOf('cadastre') !== -1,\r\n              hashtags: ['cadastre']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.postalCode',\r\n              value: 'codes-postaux',\r\n              enabled: types.indexOf('codes-postaux') !== -1,\r\n              hashtags: ['code-postal']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.entreprise',\r\n              value: 'entreprises',\r\n              enabled: types.indexOf('entreprises') !== -1,\r\n              available: false,\r\n              hashtags: ['entreprise']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cycleStop',\r\n              value: 'haltes_cyclables',\r\n              enabled: types.indexOf('haltes_cyclables') !== -1,\r\n              hashtags: ['haltevelo', 'haltes_cyclables']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.restArea',\r\n              value: 'haltes_routieres',\r\n              enabled: types.indexOf('haltes_routieres') !== -1,\r\n              hashtags: ['halteroute', 'haltes_routieres']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.hq',\r\n              value: 'hq',\r\n              enabled: types.indexOf('hq') !== -1,\r\n              hashtags: ['hq']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.intersection',\r\n              value: 'intersections',\r\n              enabled: types.indexOf('intersections') !== -1,\r\n              hashtags: ['intersection', '+']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.place',\r\n              value: 'lieux',\r\n              enabled: types.indexOf('lieux') !== -1,\r\n              hashtags: ['lieu']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.mrc',\r\n              value: 'mrc',\r\n              enabled: types.indexOf('mrc') !== -1,\r\n              hashtags: ['mrc']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.city',\r\n              value: 'municipalites',\r\n              enabled: types.indexOf('municipalites') !== -1,\r\n              hashtags: ['municipalit', 'mun']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.regadmin',\r\n              value: 'regadmin',\r\n              enabled: types.indexOf('regadmin') !== -1,\r\n              hashtags: ['rgion-administrative', 'regadmin']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.gcc',\r\n              value: 'bornes-gcc',\r\n              enabled: types.indexOf('bornes-gcc') !== -1,\r\n              hashtags: ['borne', 'bornes', 'repre', 'gcc', 'ccg']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.km',\r\n              value: 'bornes-km',\r\n              enabled: types.indexOf('bornes-km') !== -1,\r\n              hashtags: ['borne', 'bornes', 'repre', 'km']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.road',\r\n              value: 'routes',\r\n              enabled: types.indexOf('routes') !== -1,\r\n              hashtags: ['route']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.exit',\r\n              value: 'sorties-autoroute',\r\n              enabled: types.indexOf('sorties-autoroute') !== -1,\r\n              hashtags: ['sortie', 'sorties', 'exit']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.cultpatri',\r\n              value: 'culture',\r\n              enabled: types.indexOf('culture') !== -1,\r\n              hashtags: ['grille', 'culture']\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '1',\r\n              value: 1,\r\n              enabled: limit === 1\r\n            },\r\n            {\r\n              title: '5',\r\n              value: 5,\r\n              enabled: limit === 5 || !limit\r\n            },\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: limit === 10\r\n            },\r\n            {\r\n              title: '25',\r\n              value: 25,\r\n              enabled: limit === 25\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: limit === 50\r\n            }\r\n          ]\r\n        },\r\n        showAdvancedParams && {\r\n          type: 'radiobutton',\r\n          title: 'ecmax',\r\n          name: 'ecmax',\r\n          values: [\r\n            {\r\n              title: '10 %',\r\n              value: 10,\r\n              enabled: ecmax === 10\r\n            },\r\n            {\r\n              title: '30 %',\r\n              value: 30,\r\n              enabled: ecmax === 30 || !ecmax\r\n            },\r\n            {\r\n              title: '50 %',\r\n              value: 50,\r\n              enabled: ecmax === 50\r\n            },\r\n            {\r\n              title: '75 %',\r\n              value: 75,\r\n              enabled: ecmax === 75\r\n            },\r\n            {\r\n              title: '100 %',\r\n              value: 100,\r\n              enabled: ecmax === 100\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'restrictExtent',\r\n          name: 'loc',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.restrictExtent.map',\r\n              value: 'true',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\r\n              value: 'false',\r\n              enabled: true\r\n            }\r\n          ]\r\n        }\r\n      ].filter(Boolean) as SearchSourceSettings[]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(term, options || {});\r\n    if (!params.get('type').length) {\r\n      return of([]);\r\n    }\r\n    this.options.params.page = params.get('page') || '1';\r\n\r\n    return this.getSearch(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getSearch(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\r\n      map((response: IChercheResponse) => this.extractResults(response, term)),\r\n      catchError((err) => {\r\n        err.error.toDisplay = true;\r\n        err.error.title = this.languageService.translate.instant(\r\n          this.getDefaultOptions().title\r\n        );\r\n        throw err;\r\n      })\r\n    );\r\n  }\r\n  private getAllowedTypes() {\r\n    return this.http\r\n      .get(`${this.searchUrl}/types`)\r\n      .subscribe((types: string[]) => {\r\n        const typeSetting = this.settings.find((s) => s.name === 'type');\r\n        typeSetting.values.forEach((v) => {\r\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\r\n          const typesMatched = types.filter((value) => regex.test(value));\r\n          v.available = typesMatched.length > 0;\r\n          if (v.value === 'lieux') {\r\n            this.hashtagsLieuxToKeep = [\r\n              ...(new Set(\r\n                typesMatched\r\n                  .map((t) => t.split('.'))\r\n                  .reduce((a, b) => a.concat(b))\r\n                  .filter((t) => t !== 'lieux')\r\n              ) as any)\r\n            ];\r\n          }\r\n        });\r\n        this.setParamFromSetting(typeSetting, false);\r\n      });\r\n  }\r\n\r\n  private computeRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    const queryParams: any = Object.assign(\r\n      {\r\n        geometry: true,\r\n        bbox: true,\r\n        icon: true,\r\n        type: 'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\r\n      },\r\n      this.params,\r\n      this.computeOptionsParam(term, options || {}).params,\r\n      {\r\n        q: this.computeTerm(term),\r\n        page: options.page\r\n      }\r\n    );\r\n\r\n    if (queryParams.loc === 'true') {\r\n      const [xMin, yMin, xMax, yMax] = options.extent;\r\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\r\n    } else if (queryParams.loc === 'false') {\r\n      delete queryParams.loc;\r\n    }\r\n\r\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\r\n      queryParams.type = 'lieux';\r\n    }\r\n\r\n    return new HttpParams({\r\n      fromObject: ObjectUtils.removeUndefined(queryParams),\r\n      encoder: new IgoHttpParameterCodec()\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: IChercheResponse,\r\n    term: string\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: IChercheData) => {\r\n      return this.formatter.formatResult(\r\n        this.dataToResult(data, term, response)\r\n      );\r\n    });\r\n  }\r\n\r\n  private dataToResult(\r\n    data: IChercheData,\r\n    term: string,\r\n    response?: IChercheResponse\r\n  ): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, properties.code].join('.');\r\n\r\n    const titleHtml = data.highlight.title || data.properties.nom;\r\n    const subtitleHtml = data.highlight.title2\r\n      ? ' <small> ' + data.highlight.title2 + '</small>'\r\n      : '';\r\n    const subtitleHtml2 = data.highlight.title3\r\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\r\n      : '';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        extent: data.bbox,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties.nom\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.nom,\r\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\r\n        icon: data.icon || 'map-marker',\r\n        score:\r\n          data.score || computeTermSimilarity(term.trim(), data.properties.nom),\r\n        nextPage:\r\n          response.features.length % +this.options.params.limit === 0 &&\r\n          +this.options.params.page < 10\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: IChercheData): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      IChercheSearchSource.propertiesBlacklist\r\n    );\r\n\r\n    if (!data.geometry) {\r\n      return Object.assign({ type: data.index }, properties);\r\n    }\r\n\r\n    const googleLinksProperties: {\r\n      GoogleMaps: string;\r\n      GoogleStreetView?: string;\r\n    } = {\r\n      GoogleMaps: ''\r\n    };\r\n\r\n    let googleMaps;\r\n    if (data.geometry.type === 'Point') {\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        data.geometry.coordinates[0],\r\n        data.geometry.coordinates[1]\r\n      );\r\n    } else {\r\n      const point = pointOnFeature(data.geometry);\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        point.geometry.coordinates[0],\r\n        point.geometry.coordinates[1]\r\n      );\r\n    }\r\n\r\n    let googleMapsNom;\r\n    if (data.index === 'routes') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom + ', ' + data.properties.municipalite\r\n      );\r\n    } else if (data.index === 'municipalites') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom + ', ' + 'ville'\r\n      );\r\n    } else if (data.index === 'mrc') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        'mrc+' + data.properties.nom\r\n      );\r\n    } else if (data.index === 'regadmin') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom + ',+QC'\r\n      );\r\n    } else {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\r\n        data.properties.nom || data.highlight.title\r\n      );\r\n    }\r\n\r\n    googleLinksProperties.GoogleMaps =\r\n      '<a href=' +\r\n      googleMaps +\r\n      ' target=\"_blank\">' +\r\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\r\n      '</a> <br /> <a href=' +\r\n      googleMapsNom +\r\n      ' target=\"_blank\">' +\r\n      this.languageService.translate.instant('igo.geo.searchByName') +\r\n      '</a>';\r\n\r\n    if (data.geometry.type === 'Point') {\r\n      googleLinksProperties.GoogleStreetView =\r\n        GoogleLinks.getGoogleStreetViewLink(\r\n          data.geometry.coordinates[0],\r\n          data.geometry.coordinates[1]\r\n        );\r\n    }\r\n\r\n    const routing: {\r\n      Route: string;\r\n    } = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n\r\n    return Object.assign(\r\n      { type: data.index },\r\n      properties,\r\n      googleLinksProperties,\r\n      routing\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove hashtag from query\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTerm(term: string): string {\r\n    // Keep hashtags for \"lieux\"\r\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\r\n    let keep = false;\r\n    keep = hashtags.some((hashtag) => {\r\n      const hashtagKey = hashtag.substring(1);\r\n      return this.hashtagsLieuxToKeep.some(\r\n        (h) =>\r\n          h\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '') ===\r\n          hashtagKey\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n      );\r\n    });\r\n\r\n    if (!keep) {\r\n      term = term.replace(/(#[A-Za-z]+)/g, '');\r\n    }\r\n\r\n    return term.replace(/[^\\w- !\\-\\+\\(\\)\\.\\/,'#]+/g, '');\r\n  }\r\n\r\n  /**\r\n   * Add hashtag to param if valid\r\n   * @param term Query with hashtag\r\n   * @param options TextSearchOptions\r\n   */\r\n  private computeOptionsParam(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): TextSearchOptions {\r\n    const hashtags = super.getHashtagsValid(term, 'type');\r\n    if (hashtags) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        type: hashtags.join(',')\r\n      });\r\n    }\r\n\r\n    return options;\r\n  }\r\n}\r\n\r\n/**\r\n * IChercheReverse search source\r\n */\r\n@Injectable()\r\nexport class IChercheReverseSearchSource\r\n  extends SearchSource\r\n  implements ReverseSearch\r\n{\r\n  static id = 'icherchereverse';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    injector: Injector\r\n  ) {\r\n    super(options, storageService);\r\n\r\n    this.languageService.language$.subscribe(() => {\r\n      this.title$.next(\r\n        this.languageService.translate.instant(this.options.title)\r\n      );\r\n    });\r\n\r\n    const authService = injector.get(AuthService);\r\n    if (this.settings.length) {\r\n      if (!authService) {\r\n        this.getAllowedTypes();\r\n      } else {\r\n        authService.authenticate$.subscribe(() => {\r\n          this.getAllowedTypes();\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  getId(): string {\r\n    return IChercheReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return IChercheReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const types =\r\n      this.options.params && this.options.params.type\r\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\r\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\r\n\r\n    return {\r\n      title: 'igo.geo.search.ichercheReverse.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.type.address',\r\n              value: 'adresses',\r\n              enabled: types.indexOf('adresses') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.road',\r\n              value: 'routes',\r\n              enabled: types.indexOf('routes') !== -1,\r\n              available: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.district',\r\n              value: 'arrondissements',\r\n              enabled: types.indexOf('arrondissements') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.city',\r\n              value: 'municipalites',\r\n              enabled: types.indexOf('municipalites') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.mrc',\r\n              value: 'mrc',\r\n              enabled: types.indexOf('mrc') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.regadmin',\r\n              value: 'regadmin',\r\n              enabled: types.indexOf('regadmin') !== -1\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'radius',\r\n          name: 'bufferInput',\r\n          values: [\r\n            {\r\n              title: '100 m',\r\n              value: 100,\r\n              enabled: !this.options.distance || this.options.distance === 100\r\n            },\r\n            {\r\n              title: '500 m',\r\n              value: 500,\r\n              enabled: this.options.distance === 500\r\n            },\r\n            {\r\n              title: '1 km',\r\n              value: 1000,\r\n              enabled: this.options.distance === 1000\r\n            },\r\n            {\r\n              title: '2 km',\r\n              value: 2000,\r\n              enabled: this.options.distance === 2000\r\n            },\r\n            {\r\n              title: '5 km',\r\n              value: 5000,\r\n              enabled: this.options.distance === 5000\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param distance Search raidus around lonLat\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(lonLat, options || {});\r\n    if (!params.get('type').length) {\r\n      return of([]);\r\n    }\r\n    return this.getReverseSearch(params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getReverseSearch(\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\r\n      map((response: IChercheReverseResponse) => {\r\n        return this.extractResults(response);\r\n      })\r\n    );\r\n  }\r\n\r\n  private getAllowedTypes() {\r\n    return this.http\r\n      .get(`${this.searchUrl}/types`)\r\n      .subscribe((types: string[]) => {\r\n        const typeSetting = this.settings.find((s) => s.name === 'type');\r\n        typeSetting.values.forEach((v) => {\r\n          v.available = types.indexOf(v.value as string) > -1;\r\n        });\r\n        this.setParamFromSetting(typeSetting, false);\r\n      });\r\n  }\r\n\r\n  private computeRequestParams(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): HttpParams {\r\n    if (options.distance || this.options.distance) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        bufferInput: options.distance || this.options.distance\r\n      });\r\n    }\r\n\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          loc: lonLat.join(','),\r\n          sort: 'distance',\r\n          geometry: true,\r\n          icon: true\r\n        },\r\n        options.params || {},\r\n        this.params\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: IChercheReverseResponse\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: IChercheReverseData) => {\r\n      return this.dataToResult(data);\r\n    });\r\n  }\r\n\r\n  private getSubtitle(data: IChercheReverseData) {\r\n    if (!this.settings.length) {\r\n      return '';\r\n    }\r\n    let subtitle = '';\r\n    switch (data.properties.type) {\r\n      case 'arrondissements':\r\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\r\n        break;\r\n      default:\r\n        const typeSetting = this.settings.find((s) => s.name === 'type');\r\n        const type = typeSetting.values.find(\r\n          (t) => t.value === data.properties.type\r\n        );\r\n        if (type) {\r\n          subtitle = this.languageService.translate.instant(type.title);\r\n        }\r\n    }\r\n    return subtitle;\r\n  }\r\n\r\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const extent = this.computeExtent(data);\r\n    const id = [this.getId(), properties.type, properties.code].join('.');\r\n\r\n    const titleHtml = data.properties.nom;\r\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties.nom\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.nom,\r\n        titleHtml: titleHtml + subtitleHtml,\r\n        icon: data.icon || 'map-marker',\r\n        pointerSummaryTitle: this.getSubtitle(data) + ': ' + data.properties.nom\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      IChercheReverseSearchSource.propertiesBlacklist\r\n    );\r\n\r\n    const routing: {\r\n      Route: string;\r\n    } = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n\r\n    return Object.assign(properties, routing);\r\n  }\r\n\r\n  private computeExtent(\r\n    data: IChercheReverseData\r\n  ): [number, number, number, number] | undefined {\r\n    return data.bbox\r\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\r\n      : undefined;\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injector } from '@angular/core';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport {\r\n  IChercheReverseSearchSource,\r\n  IChercheSearchResultFormatter,\r\n  IChercheSearchSource\r\n} from './icherche';\r\nimport { SearchSource } from './source';\r\n\r\n/**\r\n * ICherche search result formatter factory\r\n * @ignore\r\n */\r\nexport function defaultIChercheSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new IChercheSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ICherche search result formatter\r\n */\r\nexport function provideDefaultIChercheSearchResultFormatter() {\r\n  return {\r\n    provide: IChercheSearchResultFormatter,\r\n    useFactory: defaultIChercheSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * ICherche search source factory\r\n * @ignore\r\n */\r\nexport function ichercheSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService,\r\n  formatter: IChercheSearchResultFormatter,\r\n  injector: Injector\r\n) {\r\n  return new IChercheSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\r\n    formatter,\r\n    injector\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ICherche search source\r\n */\r\nexport function provideIChercheSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ichercheSearchSourceFactory,\r\n    multi: true,\r\n    deps: [\r\n      HttpClient,\r\n      LanguageService,\r\n      StorageService,\r\n      ConfigService,\r\n      IChercheSearchResultFormatter,\r\n      Injector\r\n    ]\r\n  };\r\n}\r\n\r\n/**\r\n * IChercheReverse search source factory\r\n * @ignore\r\n */\r\nexport function ichercheReverseSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService,\r\n  injector: Injector\r\n) {\r\n  return new IChercheReverseSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\r\n    injector\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the IChercheReverse search source\r\n */\r\nexport function provideIChercheReverseSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ichercheReverseSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\r\n  };\r\n}\r\n","import { Directive, OnDestroy, OnInit, Optional, Self } from '@angular/core';\r\n\r\nimport { RouteService } from '@igo2/core';\r\n\r\nimport { Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime, map } from 'rxjs/operators';\r\n\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { LayerListComponent } from './layer-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoLayerListBinding]'\r\n})\r\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\r\n  private component: LayerListComponent;\r\n  private layersOrResolutionChange$$: Subscription;\r\n  layersVisibility$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: LayerListComponent,\r\n    private mapService: MapService,\r\n    @Optional() private route: RouteService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    // this.component.layers = [];\r\n    this.layersOrResolutionChange$$ = combineLatest([\r\n      this.mapService.getMap().layers$,\r\n      this.mapService.getMap().viewController.resolution$\r\n    ])\r\n      .pipe(debounceTime(10))\r\n      .subscribe((bunch: [Layer[], number]) => {\r\n        const shownLayers = bunch[0].filter((layer: Layer) => {\r\n          return layer.showInLayerList === true;\r\n        });\r\n        this.component.layers = shownLayers;\r\n        this.setLayersVisibilityStatus(\r\n          shownLayers,\r\n          this.component.excludeBaseLayers\r\n        );\r\n      });\r\n  }\r\n\r\n  private setLayersVisibilityStatus(\r\n    layers: Layer[],\r\n    excludeBaseLayers: boolean\r\n  ) {\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n    this.layersVisibility$$ = combineLatest(\r\n      layers\r\n        .filter((layer) => layer.baseLayer !== excludeBaseLayers)\r\n        .map((layer: Layer) => layer.visible$)\r\n    )\r\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\r\n      .subscribe(\r\n        (allLayersAreVisible: boolean) =>\r\n          (this.component.layersAreAllVisible = allLayersAreVisible)\r\n      );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layersOrResolutionChange$$.unsubscribe();\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n  }\r\n}\r\n","<button\n  *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\"\n>\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n</button>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { VectorLayer } from '../shared/layers';\r\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\r\n\r\n@Component({\r\n  selector: 'igo-track-feature-button',\r\n  templateUrl: './track-feature-button.component.html',\r\n  styleUrls: ['./track-feature-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TrackFeatureButtonComponent implements OnInit {\r\n  @Input() layer: VectorLayer;\r\n\r\n  @Input() trackFeature = false;\r\n\r\n  get options(): VectorLayerOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.options;\r\n  }\r\n\r\n  public color: string = 'primary';\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.color = this.trackFeature ? 'primary' : 'basic';\r\n  }\r\n\r\n  toggleTrackFeature() {\r\n    if (this.trackFeature) {\r\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\r\n      this.color = 'basic';\r\n    } else {\r\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\r\n      this.color = 'primary';\r\n    }\r\n    this.trackFeature = !this.trackFeature;\r\n  }\r\n}\r\n","import { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Inject, Injectable } from '@angular/core';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\r\n\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport { LAYER } from '../../../layer';\r\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\r\nimport { QueryFormat, QueryableDataSourceOptions } from '../../../query';\r\nimport { SearchResult, TextSearch } from '../search.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\r\nimport {\r\n  ILayerData,\r\n  ILayerDataSource,\r\n  ILayerItemResponse,\r\n  ILayerSearchSourceOptions,\r\n  ILayerServiceResponse\r\n} from './ilayer.interfaces';\r\nimport { SearchSource } from './source';\r\nimport { TextSearchOptions } from './source.interfaces';\r\n\r\n@Injectable()\r\nexport class ILayerSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(data: ILayerData): ILayerData {\r\n    const allowedKey = [\r\n      'title',\r\n      'abstract',\r\n      'groupTitle',\r\n      'metadataUrl',\r\n      'downloadUrl',\r\n      'urlInfo',\r\n      'name'\r\n    ];\r\n\r\n    const property = Object.entries(data.properties)\r\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\r\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\r\n        const [key, value] = entries;\r\n        let newKey;\r\n        try {\r\n          newKey = this.languageService.translate.instant(\r\n            'igo.geo.search.ilayer.properties.' + key\r\n          );\r\n        } catch (e) {\r\n          newKey = key;\r\n        }\r\n        out[newKey] = value ? value : '';\r\n        return out;\r\n      }, {});\r\n\r\n    const dataR = Object.assign({}, data);\r\n    dataR.properties = property as ILayerDataSource;\r\n\r\n    return dataR;\r\n  }\r\n}\r\n\r\n/**\r\n * ILayer search source\r\n */\r\n@Injectable()\r\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'ilayer';\r\n  static type = LAYER;\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: ILayerSearchSourceOptions,\r\n    @Inject(ILayerSearchResultFormatter)\r\n    private formatter: ILayerSearchResultFormatter\r\n  ) {\r\n    super(options, storageService);\r\n    this.languageService.language$.subscribe(() => {\r\n      this.title$.next(\r\n        this.languageService.translate.instant(this.options.title)\r\n      );\r\n    });\r\n  }\r\n\r\n  getId(): string {\r\n    return ILayerSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return ILayerSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\r\n    const limit =\r\n      this.options.params && this.options.params.limit\r\n        ? Number(this.options.params.limit)\r\n        : undefined;\r\n    const ecmax =\r\n      this.options.params && this.options.params.ecmax\r\n        ? Number(this.options.params.ecmax)\r\n        : undefined;\r\n    return {\r\n      title: 'igo.geo.search.ilayer.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.ilayer.type.layer',\r\n              value: 'layer',\r\n              enabled: true,\r\n              hashtags: ['layer', 'layers', 'couche', 'couches']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.ilayer.type.groupLayer',\r\n              value: 'group',\r\n              enabled: false,\r\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '1',\r\n              value: 1,\r\n              enabled: limit === 1\r\n            },\r\n            {\r\n              title: '5',\r\n              value: 5,\r\n              enabled: limit === 5 || !limit\r\n            },\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: limit === 10\r\n            },\r\n            {\r\n              title: '25',\r\n              value: 25,\r\n              enabled: limit === 25\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: limit === 50\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'ecmax',\r\n          name: 'ecmax',\r\n          values: [\r\n            {\r\n              title: '10 %',\r\n              value: 10,\r\n              enabled: ecmax === 10\r\n            },\r\n            {\r\n              title: '30 %',\r\n              value: 30,\r\n              enabled: ecmax === 30\r\n            },\r\n            {\r\n              title: '50 %',\r\n              value: 50,\r\n              enabled: ecmax === 50 || !ecmax\r\n            },\r\n            {\r\n              title: '75 %',\r\n              value: 75,\r\n              enabled: ecmax === 75\r\n            },\r\n            {\r\n              title: '100 %',\r\n              value: 100,\r\n              enabled: ecmax === 100\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a layer by name or keyword\r\n   * @param term Layer name or keyword\r\n   * @returns Observable of <SearchResult<LayerOptions>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('q') || !params.get('type')) {\r\n      return of([]);\r\n    }\r\n    this.options.params.page = params.get('page') || '1';\r\n    return this.getSearch(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getSearch(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\r\n    return this.http\r\n      .get(this.searchUrl, { params })\r\n      .pipe(\r\n        map((response: ILayerServiceResponse) =>\r\n          this.extractResults(response, term)\r\n        )\r\n      );\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: ObjectUtils.removeUndefined(\r\n        Object.assign(\r\n          {\r\n            q: this.computeTerm(term)\r\n          },\r\n          this.params,\r\n          this.computeOptionsParam(term, options || {}).params,\r\n          {\r\n            page: options.page\r\n          }\r\n        )\r\n      )\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove hashtag from query\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTerm(term: string): string {\r\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\w- !\\-\\(\\),'#]+/g, '');\r\n  }\r\n\r\n  /**\r\n   * Add hashtag to param if valid\r\n   * @param term Query with hashtag\r\n   * @param options TextSearchOptions\r\n   */\r\n  private computeOptionsParam(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): TextSearchOptions {\r\n    const hashtags = super.getHashtagsValid(term, 'type');\r\n    if (hashtags) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        type: hashtags.join(',')\r\n      });\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  private extractResults(\r\n    response: ILayerServiceResponse,\r\n    term: string\r\n  ): SearchResult<ILayerItemResponse>[] {\r\n    return response.items.map((data: ILayerData) =>\r\n      this.dataToResult(data, term, response)\r\n    );\r\n  }\r\n\r\n  private dataToResult(\r\n    data: ILayerData,\r\n    term: string,\r\n    response?: ILayerServiceResponse\r\n  ): SearchResult<ILayerItemResponse> {\r\n    const layerOptions = this.computeLayerOptions(data);\r\n\r\n    const titleHtml = data.highlight.title || data.properties.title;\r\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\r\n    const subtitleHtml = groupTitle\r\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\r\n      : '';\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: LAYER,\r\n        id: [this.getId(), data.properties.id].join('.'),\r\n        title: data.properties.title,\r\n        titleHtml: titleHtml + subtitleHtml,\r\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\r\n        score:\r\n          data.score ||\r\n          computeTermSimilarity(term.trim(), data.properties.name),\r\n        nextPage:\r\n          response.items.length % +this.options.params.limit === 0 &&\r\n          +this.options.params.page < 10\r\n      },\r\n      data: layerOptions\r\n    };\r\n  }\r\n\r\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\r\n    const url = data.properties.url;\r\n    const queryParams: QueryableDataSourceOptions =\r\n      this.extractQueryParamsFromSourceUrl(url);\r\n    return ObjectUtils.removeUndefined({\r\n      sourceOptions: {\r\n        id: data.properties.id,\r\n        type: data.properties.format,\r\n        url,\r\n        queryFormat: queryParams.queryFormat,\r\n        queryHtmlTarget: queryParams.queryHtmlTarget,\r\n        params:\r\n          data.properties.format === 'wms'\r\n            ? { LAYERS: data.properties.name }\r\n            : undefined,\r\n        layer:\r\n          data.properties.format === 'wms' ? undefined : data.properties.name,\r\n        optionsFromCapabilities: true,\r\n        crossOrigin: 'anonymous'\r\n      },\r\n      title: data.properties.title,\r\n      maxResolution: getResolutionFromScale(\r\n        Number(data.properties.maxScaleDenom)\r\n      ),\r\n      minResolution: getResolutionFromScale(\r\n        Number(data.properties.minScaleDenom)\r\n      ),\r\n      metadata: {\r\n        url: data.properties.metadataUrl,\r\n        extern: data.properties.metadataUrl ? true : undefined,\r\n        abstract: data.properties.abstract || undefined\r\n      },\r\n      properties: this.formatter.formatResult(data).properties\r\n    });\r\n  }\r\n\r\n  private extractQueryParamsFromSourceUrl(url: string): {\r\n    queryFormat: QueryFormat;\r\n    queryHtmlTarget: QueryHtmlTarget;\r\n  } {\r\n    let queryFormat;\r\n    let queryHtmlTarget;\r\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\r\n    if (formatOpt) {\r\n      for (const key of Object.keys(formatOpt)) {\r\n        const value = formatOpt[key];\r\n        if (value === '*') {\r\n          queryFormat = QueryFormat[key.toUpperCase()];\r\n          break;\r\n        }\r\n\r\n        const urls = (value as any as { urls: string[] }).urls;\r\n        if (Array.isArray(urls)) {\r\n          urls.forEach((urlOpt) => {\r\n            if (url.indexOf(urlOpt) !== -1) {\r\n              queryFormat = QueryFormat[key.toUpperCase()];\r\n            }\r\n          });\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (\r\n        queryFormat === QueryFormat.HTML ||\r\n        queryFormat === QueryFormat.HTMLGML2\r\n      ) {\r\n        queryHtmlTarget = 'iframe';\r\n      }\r\n    }\r\n\r\n    return {\r\n      queryFormat,\r\n      queryHtmlTarget\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { ILayerSearchResultFormatter, ILayerSearchSource } from './ilayer';\r\nimport { SearchSource } from './source';\r\n\r\n/**\r\n * ILayer search result formatter factory\r\n * @ignore\r\n */\r\nexport function ilayerSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new ILayerSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ILayer search result formatter\r\n */\r\nexport function provideILayerSearchResultFormatter() {\r\n  return {\r\n    provide: ILayerSearchResultFormatter,\r\n    useFactory: ilayerSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * ILayer search source factory\r\n * @ignore\r\n */\r\nexport function ilayerSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService,\r\n  formatter: ILayerSearchResultFormatter\r\n) {\r\n  return new ILayerSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\r\n    formatter\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ILayer search source\r\n */\r\nexport function provideILayerSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ilayerSearchSourceFactory,\r\n    multi: true,\r\n    deps: [\r\n      HttpClient,\r\n      LanguageService,\r\n      StorageService,\r\n      ConfigService,\r\n      ILayerSearchResultFormatter\r\n    ]\r\n  };\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\r\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\r\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\r\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\r\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\r\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\r\nimport { SearchService } from './shared/search.service';\r\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\r\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\r\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoSearchBarModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchResultsModule,\r\n    IgoSearchSettingsModule\r\n  ],\r\n  exports: [\r\n    IgoSearchBarModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchResultsModule,\r\n    IgoSearchSettingsModule,\r\n    SearchPointerSummaryDirective\r\n  ],\r\n  declarations: [SearchPointerSummaryDirective]\r\n})\r\nexport class IgoSearchModule {\r\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\r\n    return {\r\n      ngModule: IgoSearchModule,\r\n      providers: [\r\n        SearchService,\r\n        provideSearchSourceService(),\r\n        provideDefaultIChercheSearchResultFormatter(),\r\n        provideDefaultCoordinatesSearchResultFormatter(),\r\n        provideILayerSearchResultFormatter()\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { HttpBackend, HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport { StyleListOptions } from './style-list.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StyleListService {\r\n  private styleList: object = {};\r\n  private httpClient: HttpClient;\r\n\r\n  constructor(handler: HttpBackend) {\r\n    this.httpClient = new HttpClient(handler);\r\n  }\r\n\r\n  /**\r\n   * Use to get the data found in styleList file\r\n   */\r\n  public getStyleList(key: string): any {\r\n    return ObjectUtils.resolve(this.styleList, key);\r\n  }\r\n\r\n  /**\r\n   * This method loads \"[path]\" to get all styleList's variables\r\n   */\r\n  public load(options: StyleListOptions) {\r\n    const baseStyleList = options.default || {};\r\n    if (!options.path) {\r\n      this.styleList = baseStyleList;\r\n      return true;\r\n    }\r\n\r\n    return new Promise((resolve, _reject) => {\r\n      this.httpClient\r\n        .get(options.path)\r\n        .pipe(\r\n          catchError((error: any): any => {\r\n            console.log(`StyleList file ${options.path} could not be read`);\r\n            resolve(true);\r\n            return throwError(error.error || 'Server error');\r\n          })\r\n        )\r\n        .subscribe((styleListResponse: object) => {\r\n          this.styleList = ObjectUtils.mergeDeep(\r\n            baseStyleList,\r\n            styleListResponse\r\n          );\r\n          resolve(true);\r\n        });\r\n    });\r\n  }\r\n}\r\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\r\n\r\nimport { StyleListOptions } from './style-list.interface';\r\nimport { StyleListService } from './style-list.service';\r\n\r\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>(\r\n  'styleListOptions'\r\n);\r\n\r\nexport function provideStyleListOptions(options: StyleListOptions) {\r\n  return {\r\n    provide: STYLELIST_OPTIONS,\r\n    useValue: options\r\n  };\r\n}\r\n\r\nexport function styleListFactory(\r\n  styleListService: StyleListService,\r\n  options: StyleListOptions\r\n) {\r\n  return () => styleListService.load(options);\r\n}\r\n\r\nexport function provideStyleListLoader() {\r\n  return {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: styleListFactory,\r\n    multi: true,\r\n    deps: [StyleListService, STYLELIST_OPTIONS]\r\n  };\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport {\r\n  provideStyleListLoader,\r\n  provideStyleListOptions\r\n} from './style-list.provider';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoStyleListModule {\r\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\r\n    return {\r\n      ngModule: IgoStyleListModule,\r\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\r\n    };\r\n  }\r\n}\r\n","export enum FontType {\n  Arial = 'Arial',\n  ArialBlack = 'Arial Black',\n  Verdana = 'Verdana',\n  Tahoma = 'Tahoma',\n  TrebuchetMS = 'Trebuchet MS',\n  Impact = 'Impact',\n  TimesNewRoman = 'Times New Roman',\n  Georgia = 'Georgia',\n  AmericanTypewriter = 'American Typewriter',\n  Courier = 'Courier',\n  LucidaConsole = 'Lucida Console',\n  BrushScriptMT = 'Brush Script MT',\n  ComicSansMS = 'Comic Sans MS'\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport OlPoint from 'ol/geom/Point';\r\nimport { ProjectionLike, transform } from 'ol/proj';\r\nimport * as OlStyle from 'ol/style';\r\n\r\nimport { FontType } from '../shared/font.enum';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DrawStyleService {\r\n  private fillColor = 'rgba(255,255,255,0.4)';\r\n  private strokeColor = 'rgba(143,7,7,1)';\r\n  private strokeWidth: number = 1;\r\n  private labelsAreShown = true;\r\n  private icon: string;\r\n  private fontSize: string = '15';\r\n  private fontStyle: string = FontType.Arial.toString();\r\n  private offsetX: number = 0;\r\n  private offsetY: number = 0;\r\n\r\n  constructor() {}\r\n\r\n  getFillColor(): string {\r\n    return this.fillColor;\r\n  }\r\n\r\n  setFillColor(fillColor: string) {\r\n    this.fillColor = fillColor;\r\n  }\r\n\r\n  getStrokeColor(): string {\r\n    return this.strokeColor;\r\n  }\r\n\r\n  setStrokeColor(strokeColor: string) {\r\n    this.strokeColor = strokeColor;\r\n  }\r\n\r\n  getStrokeWidth(): number {\r\n    return this.strokeWidth;\r\n  }\r\n\r\n  getLabelsAreShown() {\r\n    return this.labelsAreShown;\r\n  }\r\n\r\n  toggleLabelsAreShown() {\r\n    this.labelsAreShown = !this.labelsAreShown;\r\n  }\r\n\r\n  setIcon(icon: string) {\r\n    this.icon = icon;\r\n  }\r\n\r\n  getIcon() {\r\n    return this.icon;\r\n  }\r\n\r\n  // To edit the label of drawing\r\n  getFontSize() {\r\n    return this.fontSize;\r\n  }\r\n\r\n  setFontSize(fontSize: string) {\r\n    this.fontSize = fontSize;\r\n  }\r\n\r\n  getFontStyle() {\r\n    return this.fontStyle;\r\n  }\r\n\r\n  setFontStyle(fontStyle: string) {\r\n    this.fontStyle = fontStyle;\r\n  }\r\n\r\n  getOffsetX(): number {\r\n    return this.offsetX;\r\n  }\r\n\r\n  setOffsetX(offsetX: number) {\r\n    this.offsetX = offsetX;\r\n  }\r\n\r\n  getOffsetY(): number {\r\n    return this.offsetY;\r\n  }\r\n\r\n  setOffsetY(offsetY: number) {\r\n    this.offsetY = offsetY;\r\n  }\r\n\r\n  createIndividualElementStyle(\r\n    feature,\r\n    resolution,\r\n    labelsAreShown: boolean,\r\n    fontSizeAndStyle: string,\r\n    fillColor: string,\r\n    strokeColor: string,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    proj: ProjectionLike,\r\n    icon?: string\r\n  ): OlStyle.Style {\r\n    let style;\r\n    let labelsAreOffset: boolean = false;\r\n    const geom = feature.getGeometry();\r\n\r\n    if (geom instanceof OlPoint) {\r\n      labelsAreOffset = !labelsAreOffset;\r\n    }\r\n    const textToShow = labelsAreShown ? feature.get('draw') : '';\r\n    feature.set('_mapTitle', textToShow);\r\n    const textIgoStyleObject = {\r\n      text: textToShow,\r\n      stroke: {\r\n        color: 'white',\r\n        width: 0.75\r\n      },\r\n      fill: { color: 'black' },\r\n      font: fontSizeAndStyle,\r\n      overflow: true,\r\n      offsetX: offsetX,\r\n      offsetY: offsetY\r\n    };\r\n\r\n    let igoStyleObject;\r\n\r\n    // if feature is a circle\r\n    if (feature.get('rad')) {\r\n      const coordinates = transform(\r\n        feature.getGeometry().flatCoordinates,\r\n        proj,\r\n        'EPSG:4326'\r\n      );\r\n      const radius =\r\n        feature.get('rad') /\r\n        Math.cos((Math.PI / 180) * coordinates[1]) /\r\n        resolution;\r\n      igoStyleObject = {\r\n        text: textIgoStyleObject,\r\n        circle: {\r\n          radius,\r\n          stroke: {\r\n            color: strokeColor ? strokeColor : this.strokeColor,\r\n            width: this.strokeWidth\r\n          },\r\n          fill: {\r\n            color: fillColor\r\n          }\r\n        }\r\n      };\r\n      feature.set('_style', igoStyleObject);\r\n\r\n      style = new OlStyle.Style({\r\n        text: new OlStyle.Text({\r\n          text: textToShow,\r\n          stroke: new OlStyle.Stroke({\r\n            color: 'white',\r\n            width: 0.75\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'black'\r\n          }),\r\n\r\n          font: fontSizeAndStyle,\r\n          overflow: true,\r\n          offsetX: offsetX,\r\n          offsetY: offsetY\r\n        }),\r\n\r\n        image: new OlStyle.Circle({\r\n          radius,\r\n          stroke: new OlStyle.Stroke({\r\n            color: strokeColor ? strokeColor : this.strokeColor,\r\n            width: this.strokeWidth\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: fillColor\r\n          })\r\n        })\r\n      });\r\n      return style;\r\n\r\n      // if feature is an icon\r\n    } else if (icon) {\r\n      this.offsetY = -26;\r\n      textIgoStyleObject.offsetY = this.offsetY;\r\n      const igoStyleObject = {\r\n        text: textIgoStyleObject,\r\n        stroke: {\r\n          color: strokeColor,\r\n          width: this.strokeWidth\r\n        },\r\n        fill: {\r\n          color: fillColor\r\n        },\r\n        icon: {\r\n          src: icon\r\n        }\r\n      };\r\n      feature.set('_style', igoStyleObject);\r\n\r\n      style = new OlStyle.Style({\r\n        text: new OlStyle.Text({\r\n          text: labelsAreShown ? feature.get('draw') : '',\r\n          stroke: new OlStyle.Stroke({\r\n            color: 'white',\r\n            width: 0.75\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'black'\r\n          }),\r\n          font: fontSizeAndStyle,\r\n          overflow: true,\r\n          offsetX: offsetX,\r\n          offsetY: offsetY\r\n        }),\r\n\r\n        stroke: new OlStyle.Stroke({\r\n          color: strokeColor,\r\n          width: this.strokeWidth\r\n        }),\r\n\r\n        fill: new OlStyle.Fill({\r\n          color: fillColor\r\n        }),\r\n\r\n        image: new OlStyle.Icon({\r\n          src: icon\r\n        })\r\n      });\r\n      return style;\r\n\r\n      // if feature is a point, a linestring or a polygon\r\n    } else {\r\n      this.offsetY = labelsAreOffset ? -15 : 0;\r\n\r\n      textIgoStyleObject.offsetY = this.offsetY;\r\n      const igoStyleObject = {\r\n        text: textIgoStyleObject,\r\n        stroke: {\r\n          color: strokeColor,\r\n          width: this.strokeWidth\r\n        },\r\n        fill: {\r\n          color: fillColor\r\n        },\r\n        circle: {\r\n          radius: 5,\r\n          stroke: {\r\n            color: strokeColor,\r\n            width: this.strokeWidth\r\n          },\r\n          fill: {\r\n            color: fillColor\r\n          }\r\n        }\r\n      };\r\n      feature.set('_style', igoStyleObject);\r\n\r\n      style = new OlStyle.Style({\r\n        text: new OlStyle.Text({\r\n          text: labelsAreShown ? feature.get('draw') : '',\r\n          stroke: new OlStyle.Stroke({\r\n            color: 'white',\r\n            width: 0.75\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'black'\r\n          }),\r\n          font: fontSizeAndStyle,\r\n          overflow: true,\r\n\r\n          offsetX: offsetX,\r\n          offsetY: offsetY\r\n        }),\r\n\r\n        stroke: new OlStyle.Stroke({\r\n          color: strokeColor,\r\n          width: this.strokeWidth\r\n        }),\r\n\r\n        fill: new OlStyle.Fill({\r\n          color: fillColor\r\n        }),\r\n\r\n        image: new OlStyle.Circle({\r\n          radius: 5,\r\n          stroke: new OlStyle.Stroke({\r\n            color: strokeColor,\r\n            width: this.strokeWidth\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: fillColor\r\n          })\r\n        })\r\n      });\r\n      return style;\r\n    }\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { ColorPickerFormFieldModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoStyleListModule } from './style-list/style-list.module';\r\nimport { StyleModalDrawingComponent } from './style-modal/drawing/style-modal-drawing.component';\r\nimport { StyleModalLayerButtonComponent } from './style-modal/layer-button/style-modal-layer-button.component';\r\nimport { StyleModalLayerComponent } from './style-modal/layer/style-modal-layer.component';\r\nimport { DrawStyleService } from './style-service/draw-style.service';\r\nimport { StyleService } from './style-service/style.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IgoLanguageModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatDialogModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    ReactiveFormsModule,\r\n    ColorPickerFormFieldModule,\r\n    IgoStyleListModule.forRoot()\r\n  ],\r\n  exports: [\r\n    IgoStyleListModule,\r\n    StyleModalDrawingComponent,\r\n    StyleModalLayerComponent,\r\n    StyleModalLayerButtonComponent\r\n  ],\r\n  declarations: [\r\n    StyleModalDrawingComponent,\r\n    StyleModalLayerComponent,\r\n    StyleModalLayerButtonComponent\r\n  ]\r\n})\r\nexport class IgoStyleModule {\r\n  static forRoot(): ModuleWithProviders<IgoStyleModule> {\r\n    return {\r\n      ngModule: IgoStyleModule,\r\n      providers: [StyleService, DrawStyleService]\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\n\r\nimport { ConfirmationPopupComponent } from './confirmation-popup.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatDialogModule,\r\n    MatButtonToggleModule\r\n  ],\r\n  exports: [ConfirmationPopupComponent],\r\n  declarations: [ConfirmationPopupComponent]\r\n})\r\nexport class IgoConfirmationPopupModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoFilterModule } from '../../../filter/filter.module';\r\nimport { OgcFilterComponent } from './ogc-filter.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule, MatButtonModule, IgoLanguageModule, IgoFilterModule],\r\n  exports: [OgcFilterComponent],\r\n  declarations: [OgcFilterComponent]\r\n})\r\nexport class IgoOgcFilterModule {}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\r\n\r\nimport { Layer } from '../../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../../map/shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter',\r\n  templateUrl: './ogc-filter.component.html',\r\n  styleUrls: ['./ogc-filter.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\r\n  @Input() layer: Layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Event emitted on complete\r\n   */\r\n  @Output() complete = new EventEmitter<void>();\r\n\r\n  /**\r\n   * Event emitted on cancel\r\n   */\r\n  @Output() cancel = new EventEmitter<void>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Implemented as part of OnUpdateInputs\r\n   */\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * On close, emit the cancel event\r\n   */\r\n  onClose() {\r\n    this.cancel.emit();\r\n  }\r\n}\r\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [map]=\"map\"\n>\n</igo-ogc-filterable-item>\n","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [WorkspaceSelectorDirective],\r\n  declarations: [WorkspaceSelectorDirective]\r\n})\r\nexport class IgoWorkspaceSelectorModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [WorkspaceUpdatorDirective],\r\n  declarations: [WorkspaceUpdatorDirective]\r\n})\r\nexport class IgoWorkspaceUpdatorModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\n\r\nimport { IgoWidgetModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoConfirmationPopupModule } from './confirmation-popup/confirmation-popup.module';\r\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\r\nimport { provideOgcFilterWidget } from './widgets/widgets';\r\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\r\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoLanguageModule,\r\n    IgoWidgetModule,\r\n    IgoWorkspaceSelectorModule,\r\n    IgoWorkspaceUpdatorModule,\r\n    IgoOgcFilterModule,\r\n    MatDialogModule\r\n  ],\r\n  exports: [\r\n    IgoWorkspaceSelectorModule,\r\n    IgoWorkspaceUpdatorModule,\r\n    IgoOgcFilterModule,\r\n    IgoConfirmationPopupModule\r\n  ],\r\n  declarations: [],\r\n  providers: [provideOgcFilterWidget()]\r\n})\r\nexport class IgoGeoWorkspaceModule {}\r\n","import {\r\n  Directive,\r\n  ElementRef,\r\n  EventEmitter,\r\n  HostListener,\r\n  OnInit,\r\n  Output,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { FeatureDetailsComponent } from './feature-details.component';\r\n\r\n@Directive({\r\n  // This directive allow to view the route between the user coordinates and the feature\r\n  selector: '[igoFeatureDetailsDirective]'\r\n})\r\nexport class FeatureDetailsDirective implements OnInit {\r\n  private component: FeatureDetailsComponent;\r\n\r\n  get feature() {\r\n    return this.component.feature;\r\n  }\r\n  feature$ = new BehaviorSubject(undefined);\r\n\r\n  @Output() routingEvent = new EventEmitter<void>();\r\n\r\n  @HostListener('selectFeature')\r\n  setFeature() {\r\n    this.feature$.next(this.feature);\r\n  }\r\n\r\n  constructor(\r\n    @Self() component: FeatureDetailsComponent,\r\n    private el: ElementRef\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.feature$.subscribe(() => {\r\n      if (this.feature.geometry) {\r\n        this.bindClicking();\r\n      }\r\n    });\r\n  }\r\n\r\n  bindClicking() {\r\n    setTimeout(() => {\r\n      const routeElement = this.el.nativeElement.querySelector('span.routing');\r\n      if (routeElement) {\r\n        routeElement.addEventListener('click', () => {\r\n          this.routingEvent.emit();\r\n        });\r\n      }\r\n    }, 1);\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { OverlayDirective } from './shared/overlay.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  exports: [OverlayDirective],\r\n  declarations: [OverlayDirective]\r\n})\r\nexport class IgoOverlayModule {\r\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\r\n    return {\r\n      ngModule: IgoOverlayModule\r\n    };\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { MessageService } from '@igo2/core';\r\n\r\nimport * as olproj from 'ol/proj';\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\r\nimport {\r\n  OgcFilterWriter,\r\n  OgcFilterableDataSourceOptions\r\n} from '../../filter/shared';\r\nimport { Layer } from '../../layer/shared';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DownloadService {\r\n  constructor(private messageService: MessageService) {}\r\n\r\n  open(layer: Layer) {\r\n    this.messageService.success(\r\n      'igo.geo.download.start',\r\n      'igo.geo.download.title'\r\n    );\r\n\r\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\r\n    if (Object.keys(DSOptions.download).length > 0) {\r\n      if (\r\n        DSOptions.download.dynamicUrl &&\r\n        DSOptions.download.url === undefined\r\n      ) {\r\n        let wfsOptions;\r\n        let currentProj = new olProjection({ code: layer.map.projection });\r\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\r\n        if (paramsWFS && Object.keys(paramsWFS).length > 0) {\r\n          currentProj = paramsWFS.srsName\r\n            ? new olProjection({ code: paramsWFS.srsName })\r\n            : currentProj;\r\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\r\n        } else {\r\n          wfsOptions = (layer.dataSource.options as any).params;\r\n        }\r\n\r\n        const currentExtent = olproj.transformExtent(\r\n          layer.map.viewController.getExtent(),\r\n          new olProjection({ code: layer.map.projection }),\r\n          currentProj\r\n        );\r\n        const outputFormatDownload =\r\n          wfsOptions.outputFormatDownload === undefined\r\n            ? wfsOptions.outputFormat === undefined\r\n              ? ''\r\n              : 'outputformat=' + wfsOptions.outputFormat\r\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\r\n\r\n        const baseurl = DSOptions.download.dynamicUrl\r\n          .replace(/&?outputformat=[^&]*/gi, '')\r\n          .replace(/&?filter=[^&]*/gi, '')\r\n          .replace(/&?bbox=[^&]*/gi, '');\r\n\r\n        const ogcFilters = (\r\n          layer.dataSource.options as OgcFilterableDataSourceOptions\r\n        ).ogcFilters;\r\n\r\n        let filterQueryString;\r\n        filterQueryString = new OgcFilterWriter().handleOgcFiltersAppliedValue(\r\n          layer.dataSource.options,\r\n          ogcFilters.geometryName,\r\n          currentExtent as [number, number, number, number],\r\n          currentProj\r\n        );\r\n        if (!filterQueryString) {\r\n          // Prevent getting all the features for empty filter\r\n          filterQueryString = new OgcFilterWriter().buildFilter(\r\n            undefined,\r\n            currentExtent as [number, number, number, number],\r\n            currentProj,\r\n            ogcFilters.geometryName\r\n          );\r\n        } else {\r\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\r\n        }\r\n        window.open(\r\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\r\n          '_blank'\r\n        );\r\n      } else if (DSOptions.download) {\r\n        window.open(DSOptions.download.url, '_blank');\r\n      }\r\n    }\r\n  }\r\n}\r\n","<button\n  *ngIf=\"\n    options &&\n    options.download &&\n    (options.download['dynamicUrl'] || options.download['url'])\n  \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\"\n>\n  <mat-icon svgIcon=\"download\"></mat-icon>\n</button>\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\r\nimport { DownloadService } from '../shared/download.service';\r\n\r\n@Component({\r\n  selector: 'igo-download-button',\r\n  templateUrl: './download-button.component.html',\r\n  styleUrls: ['./download-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class DownloadButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor(private downloadService: DownloadService) {}\r\n\r\n  openDownload(layer: Layer) {\r\n    this.downloadService.open(layer);\r\n  }\r\n\r\n  get options(): DownloadDataSourceOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.dataSource.options;\r\n  }\r\n}\r\n","export enum GeometryType {\n  Point = 'Point',\n  LineString = 'LineString',\n  Polygon = 'Polygon',\n  Circle = 'Circle'\n}\n\nexport enum LabelType {\n  Coordinates = 'Coordinates',\n  Length = 'Length',\n  Area = 'Area',\n  Predefined = 'Predefined',\n  Custom = 'Custom'\n}\n\nexport enum CoordinatesUnit {\n  DecimalDegree = 'DD',\n  DegreesMinutesSeconds = 'DMS'\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DrawIconService {\r\n  protected icons: Array<string>;\r\n\r\n  constructor(protected config: ConfigService) {\r\n    this.getIconsList();\r\n  }\r\n\r\n  getIcons() {\r\n    return this.icons;\r\n  }\r\n\r\n  getPath(): string[] {\r\n    return this.config.getConfig('drawingTool.icons') || [];\r\n  }\r\n\r\n  getIconsList() {\r\n    this.icons = this.getPath();\r\n  }\r\n}\r\n","import OlOverlay from 'ol/Overlay';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport * as Olstyle from 'ol/style';\r\n\r\nimport { convertDDToDMS, roundCoordToString } from '../../map/shared/map.utils';\r\nimport {\r\n  updateOlGeometryCenter,\r\n  updateOlGeometryMidpoints\r\n} from '../../measure/shared/measure.utils';\r\nimport { CoordinatesUnit } from './draw.enum';\r\n\r\n/**\r\n * Create a default style\r\n * @param fillColor the fill color\r\n * @param strokeColor the stroke color\r\n * @param strokeWidth the stroke width\r\n * @param label a label\r\n * @returns OL style\r\n */\r\nexport function createInteractionStyle(\r\n  fillColor?: string,\r\n  strokeColor?: string,\r\n  strokeWidth?: number,\r\n  label?: string\r\n): Olstyle.Style {\r\n  return new Olstyle.Style({\r\n    stroke: new Olstyle.Stroke({\r\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\r\n      width: strokeWidth ? strokeWidth : 1\r\n    }),\r\n    fill: new Olstyle.Fill({\r\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\r\n    }),\r\n    image: new Olstyle.Circle({\r\n      radius: 5,\r\n      stroke: new Olstyle.Stroke({\r\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\r\n        width: strokeWidth ? strokeWidth : 1\r\n      }),\r\n      fill: new Olstyle.Fill({\r\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\r\n      })\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Add an OL overlay at each midpoint and return an array of those overlays\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function updateOlTooltipsDrawAtMidpoints(\r\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\r\n): OlOverlay[] {\r\n  let olMidpoints;\r\n  if (olGeometry instanceof OlPoint) {\r\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\r\n    olMidpoints = new Array(1);\r\n    olMidpoints[0] = olMidpointPoint;\r\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\r\n  } else if (olGeometry instanceof OlCircle) {\r\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\r\n    olMidpoints = new Array(1);\r\n    olMidpoints[0] = olMidpointPoint;\r\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\r\n  } else {\r\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n  }\r\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\r\n    let olTooltip = olMidpoint.get('_tooltip');\r\n    if (olTooltip === undefined) {\r\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\r\n    } else {\r\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\r\n    }\r\n    return olTooltip;\r\n  });\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Add an OL overlay at the center of a geometry and return that overlay\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlay\r\n */\r\nexport function updateOlTooltipDrawAtCenter(\r\n  olGeometry: OlLineString | OlPolygon\r\n): OlOverlay {\r\n  const olCenter = updateOlGeometryCenter(olGeometry);\r\n  let olTooltip = olCenter.get('_tooltip');\r\n  if (olTooltip === undefined) {\r\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\r\n  } else {\r\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\r\n  }\r\n  return olTooltip;\r\n}\r\n\r\n/**\r\n * Create an OL overlay at a point and bind the overlay to the point\r\n * @param olPoint OL Point\r\n * @returns OL overlay\r\n */\r\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\r\n  const olTooltip = new OlOverlay({\r\n    element: document.createElement('div'),\r\n    offset: [-30, -10],\r\n    className: ['igo-map-tooltip', 'igo-map-tooltip-draw'].join(' '),\r\n    stopEvent: false\r\n  });\r\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\r\n  olPoint.set('_tooltip', olTooltip);\r\n\r\n  return olTooltip;\r\n}\r\n\r\nexport function DDtoDMS(\r\n  value: [number, number],\r\n  unit: CoordinatesUnit\r\n): string[] | undefined {\r\n  const conversionMapper = new Map([\r\n    [\r\n      CoordinatesUnit.DecimalDegree,\r\n      (val: [number, number]) => {\r\n        if (typeof val[0] === 'number') {\r\n          return roundCoordToString(val, 5) as string[];\r\n        } else {\r\n          const numVal: [number, number] = [Number(val[0]), Number(val[1])];\r\n          return roundCoordToString(numVal, 5) as string[];\r\n        }\r\n      }\r\n    ],\r\n    [\r\n      CoordinatesUnit.DegreesMinutesSeconds,\r\n      (val: [number, number]) => convertDDToDMS(val, 2)\r\n    ]\r\n  ]);\r\n  let conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n","<h2 mat-dialog-title>\r\n  {{ 'igo.geo.style.styleModal' | translate }}\r\n</h2>\r\n<div\r\n  class=\"edition-drawing\"\r\n  mat-dialog-content\r\n  [hidden]=\"data.features.length === 0\"\r\n>\r\n  <form class=\"igo-form\" [formGroup]=\"form\">\r\n    <div class=\"color-picker\">\r\n      <ng-container *ngIf=\"linestringOnly !== true\">\r\n        <span>\r\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\r\n          {{ 'igo.geo.style.fill' | translate }}\r\n        </span>\r\n\r\n        <igo-color-picker-form-field\r\n          formControlName=\"fill\"\r\n        ></igo-color-picker-form-field>\r\n      </ng-container>\r\n\r\n      <span>\r\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\">\r\n        </mat-icon>\r\n        {{ 'igo.geo.style.stroke' | translate }}\r\n      </span>\r\n\r\n      <igo-color-picker-form-field\r\n        formControlName=\"stroke\"\r\n      ></igo-color-picker-form-field>\r\n    </div>\r\n\r\n    <div class=\"igo-input-container\">\r\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.style.fontSize' | translate }}</mat-label>\r\n        <input\r\n          matInput\r\n          #testFontSize\r\n          type=\"number\"\r\n          placeholder=\"10\"\r\n          min=\"10\"\r\n          onkeydown=\"return event.keyCode !== 69\"\r\n          [value]=\"getFeatureFontSize()\"\r\n          (input)=\"styleModalData.fontSize = $event.target.value\"\r\n        />\r\n        <span matTextSuffix>px</span>\r\n      </mat-form-field>\r\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.style.fontStyle' | translate }}</mat-label>\r\n        <mat-select\r\n          #testFontStyle\r\n          [value]=\"getFeatureFontStyle()\"\r\n          (selectionChange)=\"styleModalData.fontStyle = $event.value\"\r\n        >\r\n          <mat-option\r\n            *ngFor=\"let fontSelect of allFontStyles\"\r\n            [value]=\"fontSelect\"\r\n          >\r\n            {{ fontSelect }}\r\n          </mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.style.offsetX' | translate }}</mat-label>\r\n        <input\r\n          matInput\r\n          #offsetXInput\r\n          type=\"number\"\r\n          onkeydown=\"return event.keyCode !== 69\"\r\n          [value]=\"getFeatureOffsetX()\"\r\n          (input)=\"styleModalData.offsetX = $event.target.value\"\r\n        />\r\n      </mat-form-field>\r\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\r\n        <mat-label>{{ 'igo.geo.style.offsetY' | translate }}</mat-label>\r\n        <input\r\n          matInput\r\n          #offsetYInput\r\n          type=\"number\"\r\n          onkeydown=\"return event.keyCode !== 69\"\r\n          [value]=\"getFeatureOffsetY()\"\r\n          (input)=\"styleModalData.offsetY = $event.target.value\"\r\n        />\r\n      </mat-form-field>\r\n    </div>\r\n  </form>\r\n</div>\r\n<div mat-dialog-actions>\r\n  <button mat-raised-button (click)=\"cancelDrawing()\">\r\n    {{ 'igo.geo.style.cancel' | translate }}\r\n  </button>\r\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\r\n</div>\r\n","import { Component, Inject, Input, OnInit } from '@angular/core';\r\nimport { UntypedFormBuilder, UntypedFormGroup } from '@angular/forms';\r\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\r\n\r\nimport { FontType } from '../../shared/font.enum';\r\nimport { DrawStyleService } from '../../style-service/draw-style.service';\r\nimport {\r\n  DrawingMatDialogData,\r\n  StyleModalData\r\n} from '../shared/style-modal.interface';\r\n\r\n@Component({\r\n  selector: 'igo-style-modal-drawing',\r\n  templateUrl: './style-modal-drawing.component.html',\r\n  styleUrls: ['./style-modal-drawing.component.scss']\r\n})\r\nexport class StyleModalDrawingComponent implements OnInit {\r\n  @Input() confirmFlag: boolean = false;\r\n\r\n  public form: UntypedFormGroup;\r\n\r\n  public styleModalData: StyleModalData;\r\n  public linestringOnly: boolean;\r\n\r\n  constructor(\r\n    public dialogRef: MatDialogRef<StyleModalDrawingComponent>,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private drawStyleService: DrawStyleService,\r\n    @Inject(MAT_DIALOG_DATA) public data: DrawingMatDialogData\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.linestringOnly = true;\r\n    for (const feature of this.data.features) {\r\n      if (feature.geometry.type !== 'LineString') {\r\n        this.linestringOnly = false;\r\n      }\r\n    }\r\n    this.buildStyleData();\r\n    this.buildForm();\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      fill: [this.getFeatureFillColor()],\r\n      stroke: [this.getFeatureStrokeColor()]\r\n    });\r\n  }\r\n\r\n  private buildStyleData() {\r\n    this.styleModalData = {\r\n      fillColor:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.drawingStyle.fill\r\n          : 'rgba(255,255,255,0.4)',\r\n      strokeColor:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.drawingStyle.stroke\r\n          : 'rgba(143,7,7,1)',\r\n      fontSize:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.fontStyle\r\n              .split(' ')[0]\r\n              .replace('px', '')\r\n          : '20',\r\n      fontStyle:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.fontStyle.substring(\r\n              this.data.features[0].properties.fontStyle.indexOf(' ') + 1\r\n            )\r\n          : FontType.Arial,\r\n      offsetX:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.offsetX\r\n          : this.drawStyleService.getOffsetX(),\r\n      offsetY:\r\n        this.data.features.length > 0\r\n          ? this.data.features[0].properties.offsetY\r\n          : this.drawStyleService.getOffsetY()\r\n    };\r\n  }\r\n\r\n  get allFontStyles(): string[] {\r\n    return Object.values(FontType);\r\n  }\r\n\r\n  getFeatureFontSize(): string {\r\n    if (!this.styleModalData.fontSize) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.fontStyle\r\n            .split(' ')[0]\r\n            .replace('px', '')\r\n        : '20';\r\n    } else {\r\n      return this.styleModalData.fontSize;\r\n    }\r\n  }\r\n\r\n  getFeatureFontStyle() {\r\n    if (!this.styleModalData.fontStyle) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.fontStyle.substring(\r\n            this.data.features[0].properties.fontStyle.indexOf(' ') + 1\r\n          )\r\n        : FontType.Arial;\r\n    } else {\r\n      return this.styleModalData.fontStyle;\r\n    }\r\n  }\r\n\r\n  private getFeatureFillColor() {\r\n    if (!this.styleModalData.fillColor) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.drawingStyle.fill\r\n        : 'rgba(255,255,255,0.4)';\r\n    } else {\r\n      return this.styleModalData.fillColor;\r\n    }\r\n  }\r\n\r\n  private getFeatureStrokeColor() {\r\n    if (!this.styleModalData.strokeColor) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.drawingStyle.stroke\r\n        : 'rgba(143,7,7,1)';\r\n    } else {\r\n      return this.styleModalData.strokeColor;\r\n    }\r\n  }\r\n\r\n  getFeatureOffsetX() {\r\n    if (!this.styleModalData.offsetX) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.offsetX\r\n        : this.drawStyleService.getOffsetX();\r\n    } else {\r\n      return this.styleModalData.offsetX;\r\n    }\r\n  }\r\n\r\n  getFeatureOffsetY() {\r\n    if (!this.styleModalData.offsetY) {\r\n      return this.data.features.length > 0\r\n        ? this.data.features[0].properties.offsetY\r\n        : this.drawStyleService.getOffsetY();\r\n    } else {\r\n      return this.styleModalData.offsetY;\r\n    }\r\n  }\r\n\r\n  cancelDrawing() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  confirm() {\r\n    this.confirmFlag = true;\r\n    if (this.form.get('fill').value) {\r\n      this.styleModalData.fillColor = this.form.get('fill').value;\r\n    }\r\n\r\n    if (this.form.get('stroke').value) {\r\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\r\n    }\r\n    this.dialogRef.close(this.styleModalData);\r\n  }\r\n\r\n  openPicker() {\r\n    this.dialogRef.disableClose = true;\r\n  }\r\n\r\n  closePicker() {\r\n    this.dialogRef.disableClose = false;\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-layer-popup.component.html',\n  styleUrls: ['./draw-layer-popup.component.scss']\n})\nexport class DrawLayerPopupComponent {\n  @Input() confirmFlag: boolean = false;\n\n  constructor(public dialogRef: MatDialogRef<DrawLayerPopupComponent>) {}\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n  confirm(labelString: string) {\n    this.confirmFlag = true;\n    this.dialogRef.close(labelString);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{ 'igo.geo.draw.layer.layerDialogInstruction' | translate }}\n  </p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{ 'igo.geo.draw.layer.title' | translate }}\"\n    />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.draw.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n    OK\n  </button>\n</div>\n","<h2 mat-dialog-title>\n  {{ 'igo.geo.draw.popupTitle' | translate }}\n</h2>\n\n<ng-container *ngIf=\"labelFlag !== labelType.Custom\">\n  <div mat-dialog-content class=\"geometry-type-toggle\">\n    <div class=\"button-toggle-container\">\n      <mat-button-toggle-group\n        (change)=\"onLabelTypeChange($event.value)\"\n        [value]=\"customOrPredefined\"\n      >\n        <mat-button-toggle [value]=\"labelType.Custom\">\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"labelType.Predefined\">\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n    <div>\n      <p>\n        {{ 'igo.geo.draw.builtInInstructions' | translate }}\n      </p>\n      <mat-radio-group *ngIf=\"olGeometryType !== 'Polygon'\">\n        <mat-radio-button\n          *ngFor=\"let option of arrayBuiltInType\"\n          [value]=\"option.value\"\n          [disabled]=\"optionAvailable(option.value)\"\n          (change)=\"onLabelTypeChange($event.value)\"\n          [checked]=\"option.checked\"\n        >\n          {{ getProperLengthLabel(option.value) }}\n        </mat-radio-button>\n      </mat-radio-group>\n      <ng-container *ngIf=\"olGeometryType === 'Polygon'\">\n        <mat-checkbox\n          *ngFor=\"let option of arrayBuiltInType\"\n          class=\"mat-typography\"\n          [value]=\"option.value\"\n          [disabled]=\"optionAvailable(option.value)\"\n          (change)=\"onLabelTypeChange($event.source.value, $event.checked)\"\n          [checked]=\"option.checked\"\n        >\n          {{ getProperLengthLabel(option.value) }}\n        </mat-checkbox>\n      </ng-container>\n      <div *ngIf=\"labelFlag === labelType.Coordinates\" class=\"fields-container\">\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>(Latitude, Longitude)</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"(Latitude, Longitude)\"\n            value=\"{{ currentCoordinates }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"coordinatesMeasureUnit\"\n            (selectionChange)=\"onChangeCoordinateUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allCoordinatesUnits\" [value]=\"unit\">\n              {{ unit }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <div\n        *ngIf=\"labelFlag === labelType.Length || polygonCheck === 2\"\n        class=\"fields-container\"\n      >\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>{{ lengthLabelT }}</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"{{ lengthLabelT }}\"\n            value=\"{{ currentLength }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"lengthMeasureUnit\"\n            (selectionChange)=\"onChangeLengthUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allLengthUnits\" [value]=\"unit\">\n              {{ getLengthUnitEnum(unit) }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <div\n        *ngIf=\"labelFlag === labelType.Area || polygonCheck === 2\"\n        class=\"fields-container\"\n      >\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>{{ 'igo.geo.draw.labelType.Area' | translate }}</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"{{ 'igo.geo.draw.labelType.Area' | translate }}\"\n            value=\"{{ currentArea }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"areaMeasureUnit\"\n            (selectionChange)=\"onChangeAreaUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allAreaUnits\" [value]=\"unit\">\n              {{ getAreaUnitEnum(unit) }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n    </div>\n  </div>\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\">\n      {{ 'igo.geo.draw.cancel' | translate }}\n    </button>\n    <button mat-raised-button color=\"primary\" (click)=\"confirm()\">\n      {{ noLabelButton() }}\n    </button>\n  </div>\n</ng-container>\n\n<ng-container *ngIf=\"labelFlag === labelType.Custom\">\n  <div mat-dialog-content class=\"geometry-type-toggle\">\n    <div class=\"button-toggle-container\">\n      <mat-button-toggle-group\n        (change)=\"onLabelTypeChange($event.value)\"\n        [value]=\"customOrPredefined\"\n      >\n        <mat-button-toggle [value]=\"labelType.Custom\">\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"labelType.Predefined\">\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n    <p>\n      {{ 'igo.geo.draw.dialogInstruction' | translate }}\n    </p>\n    <mat-form-field class=\"input\">\n      <mat-label>{{ 'igo.geo.draw.dialogTitle' | translate }}</mat-label>\n      <input\n        #input\n        matInput\n        (select)=\"(true)\"\n        (input)=\"getLabelLength($event.target.value)\"\n        placeholder=\"{{ 'igo.geo.draw.dialogTitle' | translate }}\"\n        value=\"{{ currentLabel }}\"\n        cdkFocusInitial\n      />\n    </mat-form-field>\n  </div>\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\">\n      {{ 'igo.geo.draw.cancel' | translate }}\n    </button>\n    <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n      {{ noLabelButton() }}\n    </button>\n  </div>\n</ng-container>\n","import { Component, Inject, Input } from '@angular/core';\r\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport Circle from 'ol/geom/Circle';\r\nimport { fromCircle } from 'ol/geom/Polygon';\r\nimport { transform } from 'ol/proj';\r\nimport { getLength } from 'ol/sphere';\r\n\r\nimport { IgoMap, roundCoordTo } from '../../map/shared';\r\nimport {\r\n  MeasureAreaUnit,\r\n  MeasureAreaUnitAbbreviation,\r\n  MeasureLengthUnit,\r\n  MeasureLengthUnitAbbreviation\r\n} from '../../measure/shared/measure.enum';\r\nimport {\r\n  measureOlGeometryArea,\r\n  measureOlGeometryLength,\r\n  metersToUnit,\r\n  squareMetersToUnit\r\n} from '../../measure/shared/measure.utils';\r\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\r\nimport { DDtoDMS } from '../shared/draw.utils';\r\n\r\n@Component({\r\n  selector: 'igo-draw-popup-component',\r\n  templateUrl: './draw-popup.component.html',\r\n  styleUrls: ['./draw-popup.component.scss']\r\n})\r\nexport class DrawPopupComponent {\r\n  @Input() confirmFlag: boolean = false;\r\n  @Input() labelFlag: LabelType | [LabelType, LabelType] = LabelType.Custom;\r\n  @Input() coordinatesMeasureUnit: CoordinatesUnit;\r\n  @Input() lengthMeasureUnit: MeasureLengthUnit;\r\n  @Input() areaMeasureUnit: MeasureAreaUnit;\r\n\r\n  public geometryType = GeometryType;\r\n  public labelType = LabelType;\r\n  public arrayBuiltInType: any[] = [];\r\n\r\n  public currentLabel: string;\r\n  public currentCoordinates: string;\r\n  public currentArea: string;\r\n  public currentLength: string;\r\n\r\n  public olGeometryType: GeometryType = undefined;\r\n  public lengthInMeters: string;\r\n  public areaInMetersSquare: string;\r\n  public coordinatesInDD: string;\r\n  public currentCoordinatesUnit: string;\r\n\r\n  private longlatDD: [number, number];\r\n  private labelLength: number;\r\n\r\n  public polygonCheck = 0; // Count for polygon label types checkboxes\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    public dialogRef: MatDialogRef<DrawPopupComponent>,\r\n    @Inject(MAT_DIALOG_DATA) public data: { olGeometry: any; map: IgoMap }\r\n  ) {\r\n    this.currentLabel = this.data.olGeometry.get('draw');\r\n    this.labelLength = this.currentLabel ? this.currentLabel.length : 0;\r\n    let olGeometry;\r\n\r\n    const projection = this.data.map.ol.getView().getProjection();\r\n\r\n    if (this.data.olGeometry instanceof OlFeature) {\r\n      if (this.data.olGeometry.get('rad')) {\r\n        const longitudeLatitude = [\r\n          this.data.olGeometry.get('longitude'),\r\n          this.data.olGeometry.get('latitude')\r\n        ];\r\n        this.olGeometryType = GeometryType.Circle;\r\n        olGeometry = new Circle(\r\n          longitudeLatitude,\r\n          this.data.olGeometry.get('rad')\r\n        );\r\n      } else {\r\n        this.olGeometryType = this.data.olGeometry.getGeometry().getType();\r\n        olGeometry = this.data.olGeometry.get('geometry');\r\n      }\r\n    } else {\r\n      this.olGeometryType = this.data.olGeometry.getType();\r\n      olGeometry = this.data.olGeometry;\r\n    }\r\n\r\n    if (\r\n      this.olGeometryType === GeometryType.Point ||\r\n      this.olGeometryType === GeometryType.Circle\r\n    ) {\r\n      if (this.data.olGeometry instanceof OlFeature) {\r\n        let longitude = this.data.olGeometry.get('longitude');\r\n        let latitude = this.data.olGeometry.get('latitude');\r\n        this.longlatDD = roundCoordTo([longitude, latitude], 5);\r\n        this.coordinatesInDD = '(' + latitude + ', ' + longitude + ')';\r\n      } else {\r\n        let point4326 = transform(\r\n          this.data.olGeometry.getFlatCoordinates(),\r\n          projection,\r\n          'EPSG:4326'\r\n        );\r\n        this.longlatDD = roundCoordTo([point4326[0], point4326[1]], 5);\r\n        this.coordinatesInDD =\r\n          '(' + this.longlatDD[1] + ', ' + this.longlatDD[0] + ')';\r\n      }\r\n      this.currentCoordinates = this.coordinatesInDD;\r\n    }\r\n    if (this.olGeometryType === GeometryType.LineString) {\r\n      this.lengthInMeters = measureOlGeometryLength(\r\n        olGeometry,\r\n        projection.getCode()\r\n      ).toFixed(2);\r\n      this.currentLength = this.lengthInMeters;\r\n    } else if (this.olGeometryType === GeometryType.Polygon) {\r\n      this.lengthInMeters = measureOlGeometryLength(\r\n        olGeometry,\r\n        projection.getCode()\r\n      ).toFixed(2);\r\n      this.currentLength = this.lengthInMeters;\r\n      this.areaInMetersSquare = measureOlGeometryArea(\r\n        olGeometry,\r\n        projection.getCode()\r\n      ).toFixed(2);\r\n      this.currentArea = this.areaInMetersSquare;\r\n    } else if (this.olGeometryType === GeometryType.Circle) {\r\n      let circularPolygon = fromCircle(olGeometry, 10000);\r\n      const radius = this.getRadius(circularPolygon);\r\n      this.lengthInMeters = radius.toFixed(2);\r\n      this.currentLength = this.lengthInMeters;\r\n      this.areaInMetersSquare = measureOlGeometryArea(\r\n        circularPolygon,\r\n        projection.getCode()\r\n      ).toFixed(2);\r\n      this.currentArea = this.areaInMetersSquare;\r\n    }\r\n\r\n    if (data.olGeometry.get('labelType') === LabelType.Coordinates) {\r\n      this.onLabelTypeChange(LabelType.Predefined);\r\n      this.onLabelTypeChange(LabelType.Coordinates, true);\r\n      this.coordinatesMeasureUnit = data.olGeometry.get('measureUnit');\r\n    } else if (data.olGeometry.get('labelType') === LabelType.Length) {\r\n      this.onLabelTypeChange(LabelType.Predefined);\r\n      this.onLabelTypeChange(LabelType.Length, true);\r\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit');\r\n    } else if (data.olGeometry.get('labelType') === LabelType.Area) {\r\n      this.onLabelTypeChange(LabelType.Predefined);\r\n      this.onLabelTypeChange(LabelType.Area, true);\r\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit');\r\n    } else if (data.olGeometry.get('labelType')?.length === 2) {\r\n      this.onLabelTypeChange(LabelType.Predefined);\r\n      this.onLabelTypeChange(LabelType.Length, true);\r\n      this.onLabelTypeChange(LabelType.Area, true);\r\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit')[0];\r\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit')[1];\r\n    }\r\n    this.buildArrayType();\r\n  }\r\n\r\n  /**\r\n   * HTML Interactions\r\n   */\r\n\r\n  cancelDrawing() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  confirm(input?: string) {\r\n    this.confirmFlag = true;\r\n    if (this.labelFlag === LabelType.Predefined) {\r\n      this.dialogRef.close();\r\n    } else if (this.labelFlag === LabelType.Custom) {\r\n      this.dialogRef.close({\r\n        label: input\r\n      });\r\n    } else if (this.labelFlag === LabelType.Coordinates) {\r\n      this.dialogRef.close({\r\n        label: this.currentCoordinates,\r\n        measureUnit: this.coordinatesMeasureUnit\r\n      });\r\n    } else if (this.olGeometryType === GeometryType.Polygon) {\r\n      if (this.polygonCheck === 2) {\r\n        this.labelFlag = [LabelType.Length, LabelType.Area];\r\n        this.dialogRef.close({\r\n          label:\r\n            'P: ' +\r\n            this.currentLength +\r\n            ' ' +\r\n            MeasureLengthUnitAbbreviation[MeasureLengthUnit.Meters] +\r\n            '\\n' +\r\n            this.languageService.translate.instant('igo.geo.draw.labelType.A') +\r\n            this.currentArea +\r\n            ' ' +\r\n            MeasureAreaUnitAbbreviation[MeasureAreaUnit.SquareMeters],\r\n          measureUnit: [this.lengthMeasureUnit, this.areaMeasureUnit]\r\n        });\r\n      } else {\r\n        this.labelFlag === LabelType.Length\r\n          ? this.dialogRef.close({\r\n              label:\r\n                'P: ' +\r\n                this.currentLength +\r\n                ' ' +\r\n                MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\r\n              measureUnit: this.lengthMeasureUnit\r\n            })\r\n          : this.dialogRef.close({\r\n              label:\r\n                this.currentArea +\r\n                ' ' +\r\n                MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\r\n              measureUnit: this.areaMeasureUnit\r\n            });\r\n      }\r\n    } else if (this.labelFlag === LabelType.Length) {\r\n      if (this.olGeometryType === GeometryType.Circle) {\r\n        this.dialogRef.close({\r\n          label:\r\n            'R: ' +\r\n            this.currentLength +\r\n            ' ' +\r\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\r\n          measureUnit: this.lengthMeasureUnit\r\n        });\r\n      } else if (this.olGeometryType === GeometryType.LineString) {\r\n        this.dialogRef.close({\r\n          label:\r\n            this.currentLength +\r\n            ' ' +\r\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\r\n          measureUnit: this.lengthMeasureUnit\r\n        });\r\n      }\r\n    } else if (this.labelFlag === LabelType.Area) {\r\n      this.dialogRef.close({\r\n        label:\r\n          this.currentArea +\r\n          ' ' +\r\n          MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\r\n        measureUnit: this.areaMeasureUnit\r\n      });\r\n    }\r\n  }\r\n\r\n  onLabelTypeChange(labelType: LabelType, checked?: boolean) {\r\n    if (\r\n      labelType !== LabelType.Predefined &&\r\n      labelType !== LabelType.Custom &&\r\n      this.olGeometryType === GeometryType.Polygon\r\n    ) {\r\n      this.arrayBuiltInType.find((type) => type.value === labelType)\r\n        ? (this.arrayBuiltInType.find(\r\n            (type) => type.value === labelType\r\n          ).checked = checked)\r\n        : (this.labelFlag = undefined);\r\n      checked\r\n        ? (this.labelFlag = labelType)\r\n        : (this.labelFlag = this.arrayBuiltInType.find((type) => type.checked)\r\n            ?.value);\r\n    } else {\r\n      this.labelFlag = labelType;\r\n    }\r\n\r\n    if (labelType === LabelType.Predefined) {\r\n      if (this.olGeometryType === GeometryType.Point) {\r\n        this.labelFlag = LabelType.Coordinates;\r\n        this.currentCoordinates = this.coordinatesInDD;\r\n        this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\r\n      } else if (this.olGeometryType === GeometryType.LineString) {\r\n        this.labelFlag = LabelType.Length;\r\n        this.currentLength = this.lengthInMeters;\r\n        this.lengthMeasureUnit = MeasureLengthUnit.Meters;\r\n      }\r\n    } else if (labelType === LabelType.Area) {\r\n      this.currentArea = this.areaInMetersSquare;\r\n      this.areaMeasureUnit = MeasureAreaUnit.SquareMeters;\r\n    } else if (labelType === LabelType.Length) {\r\n      this.currentLength = this.lengthInMeters;\r\n      this.lengthMeasureUnit = MeasureLengthUnit.Meters;\r\n    } else if (this.labelFlag === LabelType.Coordinates) {\r\n      this.currentCoordinates = this.coordinatesInDD;\r\n      this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\r\n    }\r\n\r\n    const labeltypes = [this.labelType.Length, this.labelType.Area];\r\n    if (\r\n      this.olGeometryType === GeometryType.Polygon &&\r\n      labeltypes.includes(labelType)\r\n    ) {\r\n      checked ? (this.polygonCheck += 1) : (this.polygonCheck -= 1);\r\n    } else {\r\n      this.polygonCheck = 0;\r\n    }\r\n  }\r\n\r\n  onChangeLengthUnit(lengthUnit: MeasureLengthUnit) {\r\n    this.lengthMeasureUnit = lengthUnit;\r\n    this.currentLength = metersToUnit(\r\n      Number(this.lengthInMeters),\r\n      lengthUnit\r\n    ).toFixed(2);\r\n  }\r\n\r\n  onChangeAreaUnit(areaUnit: MeasureAreaUnit) {\r\n    this.areaMeasureUnit = areaUnit;\r\n    this.currentArea = squareMetersToUnit(\r\n      Number(this.areaInMetersSquare),\r\n      areaUnit\r\n    ).toFixed(2);\r\n  }\r\n\r\n  onChangeCoordinateUnit(coordinatesUnit: CoordinatesUnit) {\r\n    this.coordinatesMeasureUnit = coordinatesUnit;\r\n    let coordinates = DDtoDMS(this.longlatDD, coordinatesUnit);\r\n    this.currentCoordinates =\r\n      '(' + coordinates[1] + ', ' + coordinates[0] + ')';\r\n  }\r\n\r\n  buildArrayType() {\r\n    for (const labelType of Object.values(LabelType)) {\r\n      if (\r\n        labelType !== LabelType.Custom &&\r\n        labelType !== LabelType.Predefined\r\n      ) {\r\n        this.arrayBuiltInType.push({\r\n          value: labelType,\r\n          checked:\r\n            this.selectOptions(labelType) ||\r\n            this.labelFlag === labelType ||\r\n            (this.polygonCheck === 2 && labelType !== LabelType.Coordinates)\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  noLabelButton() {\r\n    if (\r\n      this.labelFlag === LabelType.Predefined ||\r\n      (this.labelFlag === LabelType.Custom && this.labelLength === 0)\r\n    ) {\r\n      return this.languageService.translate.instant('igo.geo.draw.noLabel');\r\n    }\r\n\r\n    return 'OK';\r\n  }\r\n\r\n  get customOrPredefined() {\r\n    if (this.labelFlag === LabelType.Custom) {\r\n      return LabelType.Custom;\r\n    }\r\n    return LabelType.Predefined;\r\n  }\r\n\r\n  optionAvailable(currentOption: LabelType) {\r\n    switch (this.olGeometryType) {\r\n      case GeometryType.Point:\r\n        if (currentOption === LabelType.Coordinates) {\r\n          return false;\r\n        }\r\n        return true;\r\n      case GeometryType.LineString:\r\n        if (currentOption === LabelType.Length) {\r\n          return false;\r\n        }\r\n        return true;\r\n      case GeometryType.Polygon:\r\n        if (currentOption === LabelType.Coordinates) {\r\n          return true;\r\n        }\r\n        return false;\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  get allLengthUnits(): string[] {\r\n    return Object.values(MeasureLengthUnit);\r\n  }\r\n\r\n  getLengthUnitEnum(lengthUnit: MeasureLengthUnit) {\r\n    return MeasureLengthUnitAbbreviation[lengthUnit];\r\n  }\r\n\r\n  get allAreaUnits(): string[] {\r\n    return Object.values(MeasureAreaUnit);\r\n  }\r\n\r\n  get allCoordinatesUnits(): string[] {\r\n    return Object.values(CoordinatesUnit);\r\n  }\r\n\r\n  getAreaUnitEnum(areaUnit: MeasureAreaUnit) {\r\n    return MeasureAreaUnitAbbreviation[areaUnit];\r\n  }\r\n\r\n  private getRadius(olGeometry): number {\r\n    const length = getLength(olGeometry);\r\n    return Number(length / (2 * Math.PI));\r\n  }\r\n\r\n  get lengthLabelT() {\r\n    if (this.olGeometryType === GeometryType.Polygon) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.measure.perimeter'\r\n      );\r\n    }\r\n    if (this.olGeometryType === GeometryType.Circle) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.search.coordinates.radius'\r\n      );\r\n    }\r\n    return this.languageService.translate.instant(\r\n      'igo.geo.draw.labelType.Length'\r\n    );\r\n  }\r\n\r\n  getLabelLength(event?) {\r\n    this.labelLength = event.length;\r\n  }\r\n\r\n  selectOptions(option) {\r\n    if (this.olGeometryType === GeometryType.Point) {\r\n      return option === LabelType.Coordinates;\r\n    } else if (this.olGeometryType === GeometryType.LineString) {\r\n      return option === LabelType.Length;\r\n    }\r\n  }\r\n\r\n  getProperLengthLabel(option) {\r\n    if (option === LabelType.Length) {\r\n      if (this.olGeometryType === GeometryType.Polygon) {\r\n        return this.languageService.translate.instant(\r\n          'igo.geo.measure.perimeter'\r\n        );\r\n      }\r\n      if (this.olGeometryType === GeometryType.Circle) {\r\n        return this.languageService.translate.instant(\r\n          'igo.geo.search.coordinates.radius'\r\n        );\r\n      }\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.draw.labelType.Length'\r\n      );\r\n    }\r\n    return this.languageService.translate.instant(\r\n      'igo.geo.draw.labelType.' + option\r\n    );\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss']\n})\nexport class DrawShorcutsComponent {}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon\n      >{{ 'igo.geo.draw.finish' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon\n      >{{ 'igo.geo.draw.undo' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon\n      >{{ 'igo.geo.draw.abort' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon\n      >{{ 'igo.geo.draw.move' | translate }}</span\n    >\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>\n","<div>\r\n  <div class=\"geometry-type-toggle mat-typography\">\r\n    <mat-button-toggle-group\r\n      (change)=\"onGeometryTypeChange($event.value)\"\r\n      [value]=\"geometryType.Point\"\r\n    >\r\n      <mat-button-toggle [value]=\"geometryType.Point\">\r\n        {{ 'igo.geo.draw.' + geometryType.Point | translate }}\r\n      </mat-button-toggle>\r\n\r\n      <mat-button-toggle [value]=\"geometryType.LineString\">\r\n        {{ 'igo.geo.draw.' + geometryType.LineString | translate }}\r\n      </mat-button-toggle>\r\n\r\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\r\n        {{ 'igo.geo.draw.' + geometryType.Polygon | translate }}\r\n      </mat-button-toggle>\r\n\r\n      <mat-button-toggle [value]=\"geometryType.Circle\">\r\n        {{ 'igo.geo.draw.' + geometryType.Circle | translate }}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class=\"draw-options mat-typography\">\r\n    <mat-slide-toggle\r\n      [disabled]=\"drawControlIsDisabled\"\r\n      [checked]=\"drawControlIsActive\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleDrawControl($event.checked)\"\r\n    >\r\n      {{ 'igo.geo.draw.drawControl' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]=\"labelsAreShown\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleLabels()\"\r\n    >\r\n      {{ 'igo.geo.draw.toggleMapTooltips' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      *ngIf=\"!isPoint()\"\r\n      [checked]=\"freehandMode\"\r\n      [labelPosition]=\"'before'\"\r\n      (change)=\"onToggleFreehandMode($event)\"\r\n    >\r\n      {{ 'igo.geo.draw.freehandMode' | translate }}\r\n    </mat-slide-toggle>\r\n\r\n    <div class=\"radius-unit\" *ngIf=\"isCircle()\">\r\n      <form class=\"radius-form\">\r\n        <mat-form-field class=\"radius\">\r\n          <input\r\n            matInput\r\n            type=\"number\"\r\n            min=\"0\"\r\n            placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\r\n            [formControl]=\"radiusFormControl\"\r\n            [readonly]=\"this.freehandMode\"\r\n          />\r\n        </mat-form-field>\r\n      </form>\r\n\r\n      <mat-form-field class=\"unit-field\">\r\n        <mat-select\r\n          [value]=\"measureUnit\"\r\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\r\n        >\r\n          <mat-option\r\n            *ngFor=\"let measureUnit of measureUnits\"\r\n            [value]=\"measureUnit\"\r\n          >\r\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\r\n          </mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n\r\n  <mat-divider></mat-divider>\r\n\r\n  <div class=\"layer-select-container\">\r\n    <mat-form-field class=\"layer-select\" subscriptSizing=\"dynamic\">\r\n      <mat-label>{{ 'igo.geo.draw.layer.title' | translate }}</mat-label>\r\n      <mat-select\r\n        #selectedLayer\r\n        (selectionChange)=\"onLayerChange(selectedLayer.value)\"\r\n        [value]=\"updateActiveLayer()\"\r\n      >\r\n        <mat-option *ngFor=\"let layer of allLayers\" [value]=\"layer\">\r\n          {{ layer.title }}\r\n        </mat-option>\r\n        <mat-option id=\"createNewLayer\">\r\n          {{ 'igo.geo.draw.layer.createNewLayer' | translate }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n    <button\r\n      *ngIf=\"activeDrawingLayer\"\r\n      mat-icon-button\r\n      [color]=\"activeDrawingLayer.visible ? 'primary' : 'default'\"\r\n      collapsibleButton\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"\r\n        activeDrawingLayer.visible\r\n          ? ('igo.geo.layer.hideLayer' | translate)\r\n          : ('igo.geo.layer.showLayer' | translate)\r\n      \"\r\n      (click)=\"activeDrawingLayer.visible = !activeDrawingLayer.visible\"\r\n    >\r\n      <mat-icon [svgIcon]=\"activeDrawingLayer.visible ? 'eye' : 'eye-off'\">\r\n      </mat-icon>\r\n    </button>\r\n  </div>\r\n  <mat-divider></mat-divider>\r\n  <div>\r\n    <button\r\n      *ngIf=\"activeStore.count$.getValue() > 0\"\r\n      class=\"deleteBtn\"\r\n      mat-icon-button\r\n      color=\"warn\"\r\n      tooltip-position=\"below\"\r\n      matTooltipShowDelay=\"500\"\r\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\r\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\r\n      (click)=\"deleteDrawings()\"\r\n    >\r\n      <mat-icon svgIcon=\"delete\"></mat-icon>\r\n    </button>\r\n\r\n    <div>\r\n      <igo-entity-table\r\n        #table\r\n        class=\"table-compact\"\r\n        [store]=\"activeStore\"\r\n        [template]=\"tableTemplate\"\r\n      >\r\n      </igo-entity-table>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"icon-options\">\r\n    <mat-form-field *ngIf=\"icons.length >= 1\">\r\n      <mat-label>{{ 'igo.geo.draw.icon' | translate }}</mat-label>\r\n      <mat-select>\r\n        <mat-select-trigger>\r\n          <div *ngIf=\"icon\" class=\"box\">\r\n            <img src=\"{{ icon }}\" />\r\n          </div>\r\n        </mat-select-trigger>\r\n        <mat-option value=\"\" (click)=\"onIconChange()\">{{\r\n          'igo.geo.draw.noIcon' | translate\r\n        }}</mat-option>\r\n        <mat-option\r\n          *ngFor=\"let icon_html of icons\"\r\n          [value]=\"icon_html\"\r\n          (click)=\"onIconChange(icon_html)\"\r\n        >\r\n          <div class=\"box\">\r\n            <img src=\"{{ icon_html }}\" />\r\n          </div>\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"actions-container\">\r\n    <button\r\n      mat-icon-button\r\n      color=\"accent\"\r\n      disableRipple=\"true\"\r\n      (click)=\"openShorcutsDialog()\"\r\n    >\r\n      <mat-icon\r\n        class=\"shortcuts-icon\"\r\n        svgIcon=\"keyboard-outline\"\r\n        tooltip-position=\"below\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\"\r\n      >\r\n      </mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      *ngIf=\"selectedFeatures$.value.length\"\r\n      mat-raised-button\r\n      color=\"primary\"\r\n      (click)=\"openStyleModalDialog()\"\r\n      [matTooltip]=\"'igo.geo.style.styleModalTooltipSelected' | translate\"\r\n    >\r\n      {{ 'igo.geo.style.styleModal' | translate }}\r\n      <mat-icon\r\n        aria-hidden=\"false\"\r\n        iconPositionEnd\r\n        class=\"style-icon\"\r\n        svgIcon=\"palette\"\r\n        [matBadge]=\"selectedFeatures$.value.length\"\r\n        matBadgeColor=\"warn\"\r\n        matBadgeSize=\"medium\"\r\n      >\r\n      </mat-icon>\r\n    </button>\r\n  </div>\r\n</div>\r\n","import {\r\n  animate,\r\n  state,\r\n  style,\r\n  transition,\r\n  trigger\r\n} from '@angular/animations';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormControl,\r\n  UntypedFormGroup\r\n} from '@angular/forms';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport {\r\n  EntityRecord,\r\n  EntityTableButton,\r\n  EntityTableColumnRenderer,\r\n  EntityTableTemplate\r\n} from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlCircle from 'ol/geom/Circle';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport Polygon, { fromCircle } from 'ol/geom/Polygon';\r\nimport * as olproj from 'ol/proj';\r\nimport { transform } from 'ol/proj';\r\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport { getDistance, getLength } from 'ol/sphere';\r\nimport * as OlStyle from 'ol/style';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { first, skip } from 'rxjs/operators';\r\n\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport {\r\n  FEATURE,\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  featureToOl,\r\n  tryAddLoadingStrategy,\r\n  tryAddSelectionStrategy\r\n} from '../../feature';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\r\nimport { DrawControl } from '../../geometry/shared/controls/draw';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport {\r\n  MeasureAreaUnit,\r\n  MeasureAreaUnitAbbreviation,\r\n  MeasureLengthUnit,\r\n  MeasureLengthUnitAbbreviation\r\n} from '../../measure/shared/measure.enum';\r\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\r\nimport {\r\n  measureOlGeometryArea,\r\n  measureOlGeometryLength,\r\n  metersToUnit,\r\n  squareMetersToUnit\r\n} from '../../measure/shared/measure.utils';\r\nimport { FontType } from '../../style/shared/font.enum';\r\nimport { StyleModalDrawingComponent } from '../../style/style-modal/drawing/style-modal-drawing.component';\r\nimport { StyleModalData } from '../../style/style-modal/shared/style-modal.interface';\r\nimport { DrawStyleService } from '../../style/style-service/draw-style.service';\r\nimport { DrawIconService } from '../shared/draw-icon.service';\r\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\r\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\r\nimport { DDtoDMS, createInteractionStyle } from '../shared/draw.utils';\r\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\r\nimport { DrawPopupComponent } from './draw-popup.component';\r\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\r\n\r\n@Component({\r\n  selector: 'igo-draw',\r\n  animations: [\r\n    trigger('openClose', [\r\n      state(\r\n        'open',\r\n        style({\r\n          opacity: 1\r\n        })\r\n      ),\r\n      state(\r\n        'closed',\r\n        style({\r\n          opacity: 0\r\n        })\r\n      ),\r\n      transition('open => closed', [animate('600ms ease')]),\r\n      transition('closed => open', [animate('800ms ease')])\r\n    ])\r\n  ],\r\n  templateUrl: './draw.component.html',\r\n  styleUrls: ['./draw.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class DrawComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Table template\r\n   * @internal\r\n   */\r\n  public tableTemplate: EntityTableTemplate;\r\n\r\n  public geometryType = GeometryType; // Reference to the GeometryType enum\r\n  @Input() map: IgoMap; // Map to draw on\r\n\r\n  @Input()\r\n  get stores(): FeatureStore<FeatureWithDraw>[] {\r\n    return this._stores;\r\n  }\r\n  set stores(value: FeatureStore<FeatureWithDraw>[]) {\r\n    this._stores = value;\r\n  }\r\n  private _stores: FeatureStore<FeatureWithDraw>[] = [];\r\n\r\n  @Input()\r\n  get drawControls(): [string, DrawControl][] {\r\n    return this._drawControls;\r\n  }\r\n  set drawControls(value: [string, DrawControl][]) {\r\n    this._drawControls = value;\r\n  }\r\n  private _drawControls = [];\r\n\r\n  @Input()\r\n  get activeDrawingLayer(): VectorLayer {\r\n    return this._activeDrawingLayer;\r\n  }\r\n  set activeDrawingLayer(value: VectorLayer) {\r\n    this._activeDrawingLayer = value;\r\n  }\r\n  private _activeDrawingLayer: VectorLayer;\r\n\r\n  @Output() activeLayerChange = new EventEmitter<VectorLayer>();\r\n  @Output() drawControlsEvent = new EventEmitter<[string, DrawControl][]>();\r\n  @Output() layersIDEvent = new EventEmitter<string>();\r\n\r\n  @Output() fillColor: string;\r\n  @Output() strokeColor: string;\r\n  @Output() strokeWidth: number;\r\n\r\n  @Output() fontSize: string;\r\n  @Output() fontStyle: string;\r\n\r\n  public activeStore: FeatureStore<FeatureWithDraw>;\r\n  private layerCounterID: number = 0;\r\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\r\n  private activeDrawingLayerSource = new OlVectorSource();\r\n  private activeDrawControl: DrawControl;\r\n  private drawEnd$$: Subscription;\r\n  private drawSelect$$: Subscription;\r\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> =\r\n    new BehaviorSubject([]);\r\n  public fillForm: string;\r\n  public strokeForm: string;\r\n  public drawControlIsDisabled: boolean = true;\r\n  public drawControlIsActive: boolean = false;\r\n  public labelsAreShown: boolean;\r\n  public freehandMode = false;\r\n  private subscriptions$$: Subscription[] = [];\r\n\r\n  public position: string = 'bottom';\r\n  public form: UntypedFormGroup;\r\n  public icons: Array<string>;\r\n  public icon: string;\r\n\r\n  public radiusFormControl = new UntypedFormControl(1000);\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n  public radiusFormControlChange$$: Subscription = new Subscription();\r\n  public predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  public radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\r\n  }\r\n  private numberOfDrawings: number;\r\n  public isCreatingNewLayer: boolean = false;\r\n  private currGeometryType = this.geometryType.Point as any;\r\n\r\n  @ViewChild('selectedLayer') select;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private drawStyleService: DrawStyleService,\r\n    private dialog: MatDialog,\r\n    private drawIconService: DrawIconService\r\n  ) {\r\n    this.tableTemplate = {\r\n      selection: true,\r\n      selectMany: true,\r\n      selectionCheckbox: true,\r\n      sort: true,\r\n      fixedHeader: true,\r\n      tableHeight: 'auto',\r\n      columns: [\r\n        {\r\n          name: 'Drawing',\r\n          title: this.languageService.translate.instant('igo.geo.draw.labels'),\r\n          valueAccessor: (feature: FeatureWithDraw) => {\r\n            return feature.properties.draw;\r\n          }\r\n        },\r\n        {\r\n          name: 'Edition',\r\n          title: '',\r\n          sort: false,\r\n          valueAccessor: (feature: FeatureWithDraw) => {\r\n            return [\r\n              {\r\n                editMode: false,\r\n                icon: 'pencil',\r\n                color: 'primary',\r\n                click: () => {\r\n                  this.editLabelDrawing(feature);\r\n                },\r\n                style: 'mat-icon-button'\r\n              }\r\n            ] as EntityTableButton[];\r\n          },\r\n          renderer: EntityTableColumnRenderer.ButtonGroup\r\n        }\r\n      ]\r\n    };\r\n    this.buildForm();\r\n    this.fillColor = this.drawStyleService.getFillColor();\r\n    this.strokeColor = this.drawStyleService.getStrokeColor();\r\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\r\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\r\n    this.icons = this.drawIconService.getIcons();\r\n    this.icon = this.drawStyleService.getIcon();\r\n\r\n    this.fontSize = this.drawStyleService.getFontSize();\r\n    this.fontStyle = this.drawStyleService.getFontStyle();\r\n  }\r\n\r\n  // Initialize the store that will contain the entities and create the Draw control\r\n  ngOnInit() {\r\n    if (!this.stores.length) {\r\n      this.activeStore = new FeatureStore<FeatureWithDraw>([], {\r\n        map: this.map\r\n      });\r\n      this.initStore();\r\n      this.activeDrawControl = this.createDrawControl(\r\n        this.fillColor,\r\n        this.strokeColor,\r\n        this.strokeWidth\r\n      );\r\n      this.activeDrawControl.setGeometryType(this.geometryType.Point as any);\r\n      this.toggleDrawControl();\r\n      this.stores.push(this.activeStore);\r\n      this.drawControls.push([\r\n        this.activeDrawingLayer.id,\r\n        this.activeDrawControl\r\n      ]);\r\n      this.drawControlsEvent.emit(this.drawControls);\r\n      this.layersIDEvent.emit(this.activeDrawingLayer.id);\r\n      this.onLayerChange(this.activeDrawingLayer);\r\n    } else {\r\n      this.activeStore = this.stores.find(\r\n        (store) => store.layer.id === this.activeDrawingLayer.id\r\n      );\r\n      this.activeDrawControl = this.drawControls.find(\r\n        (dc) => dc[0] === this.activeDrawingLayer.id\r\n      )[1];\r\n      this.deactivateDrawControl();\r\n      this.allLayers.forEach((layer) => {\r\n        if (layer.id !== this.activeDrawingLayer.id) {\r\n          layer.opacity = 0;\r\n        }\r\n        let store = this.stores.find((s) => s.layer.id === layer.id);\r\n\r\n        this.subscriptions$$.push(\r\n          store.stateView\r\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\r\n              return record.state.selected === true;\r\n            })\r\n            .pipe(first())\r\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\r\n              records.forEach((record) => {\r\n                record.state.selected = false;\r\n              });\r\n            })\r\n        );\r\n\r\n        this.subscriptions$$.push(\r\n          store.stateView\r\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\r\n              return record.state.selected === true;\r\n            })\r\n            .pipe(\r\n              skip(1) // Skip initial emission\r\n            )\r\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\r\n              this.selectedFeatures$.next(\r\n                records.map((record) => record.entity)\r\n              );\r\n            })\r\n        );\r\n\r\n        this.subscriptions$$.push(\r\n          store.count$.subscribe((cnt) => {\r\n            cnt >= 1\r\n              ? (this.activeStore.layer.options.showInLayerList = true)\r\n              : (this.activeStore.layer.options.showInLayerList = false);\r\n          })\r\n        );\r\n      });\r\n      this.onLayerChange(this.activeDrawingLayer);\r\n    }\r\n\r\n    this.radiusFormControlChange$$ =\r\n      this.radiusFormControl.valueChanges.subscribe((value) => {\r\n        if (this.activeDrawControl.ispredefinedRadius$.getValue()) {\r\n          this.changeRadius(value);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Remove the drawing layer and the interactions\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.allLayers.forEach((layer) => (layer.opacity = 1));\r\n    this.activeStore.state.updateAll({ selected: false });\r\n    this.deactivateDrawControl();\r\n    this.subscriptions$$.map((s) => s.unsubscribe());\r\n    this.radiusFormControlChange$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Create a Draw Control\r\n   * @param fillColor the fill color\r\n   * @param strokeColor the stroke color\r\n   * @param strokeWidth the stroke width\r\n   * @returns a Draw Control\r\n   */\r\n  createDrawControl(\r\n    fillColor?: string,\r\n    strokeColor?: string,\r\n    strokeWidth?: number\r\n  ) {\r\n    const activeDrawControl = new DrawControl({\r\n      geometryType: undefined,\r\n      drawingLayerSource: this.activeDrawingLayerSource,\r\n      drawingLayerStyle: new OlStyle.Style({}),\r\n      interactionStyle: createInteractionStyle(\r\n        fillColor,\r\n        strokeColor,\r\n        strokeWidth\r\n      )\r\n    });\r\n    return activeDrawControl;\r\n  }\r\n\r\n  /**\r\n   * Store initialization, including drawing layer creation\r\n   */\r\n\r\n  private initStore(newTitle?: string, isNewLayer?: boolean) {\r\n    this.createLayer(newTitle, isNewLayer);\r\n    this.subscriptions$$.push(\r\n      this.activeStore.stateView\r\n        .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\r\n          return record.state.selected === true;\r\n        })\r\n        .pipe(\r\n          skip(1) // Skip initial emission\r\n        )\r\n        .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\r\n          this.selectedFeatures$.next(records.map((record) => record.entity));\r\n        })\r\n    );\r\n\r\n    this.subscriptions$$.push(\r\n      this.activeStore.count$.subscribe((cnt) => {\r\n        cnt >= 1\r\n          ? (this.activeStore.layer.options.showInLayerList = true)\r\n          : (this.activeStore.layer.options.showInLayerList = false);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Open the style modal dialog box\r\n   */\r\n  openStyleModalDialog() {\r\n    setTimeout(() => {\r\n      // open the dialog box used to style features\r\n      const dialogRef = this.dialog.open(StyleModalDrawingComponent, {\r\n        disableClose: false,\r\n        data: {\r\n          features: this.selectedFeatures$.getValue(),\r\n          icons: this.icons,\r\n          icon: this.icon\r\n        },\r\n        autoFocus: false\r\n      });\r\n\r\n      // when dialog box is closed, get label and set it to geometry\r\n      dialogRef.afterClosed().subscribe((data: StyleModalData) => {\r\n        // checks if the user clicked ok\r\n        if (dialogRef.componentInstance.confirmFlag) {\r\n          this.onFontChange(this.labelsAreShown, data.fontSize, data.fontStyle);\r\n          this.onColorChange(\r\n            this.labelsAreShown,\r\n            this.icon ? true : false,\r\n            data.fillColor,\r\n            data.strokeColor\r\n          );\r\n          this.onOffsetLabelChange(\r\n            this.labelsAreShown,\r\n            data.offsetX,\r\n            data.offsetY\r\n          );\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  /**\r\n   * Open a dialog box to enter label and do something\r\n   * @param olGeometry geometry at draw end or selected geometry\r\n   * @param drawEnd event fired at drawEnd?\r\n   */\r\n  private openDrawDialog(olGeometry, isDrawEnd: boolean) {\r\n    setTimeout(() => {\r\n      // open the dialog box used to enter label\r\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\r\n        disableClose: false,\r\n        data: { olGeometry: olGeometry, map: this.map }\r\n      });\r\n\r\n      // when dialog box is closed, get label and set it to geometry\r\n      dialogRef.afterClosed().subscribe((result) => {\r\n        // checks if the user clicked ok\r\n        if (dialogRef.componentInstance.confirmFlag) {\r\n          this.updateLabelOfOlGeometry(olGeometry, result.label);\r\n          this.updateLabelType(\r\n            olGeometry,\r\n            dialogRef.componentInstance.labelFlag\r\n          );\r\n          this.updateMeasureUnit(olGeometry, result.measureUnit);\r\n\r\n          if (!(olGeometry instanceof OlFeature)) {\r\n            this.updateFontSizeAndStyle(olGeometry, '15', FontType.Arial);\r\n            this.updateFillAndStrokeColor(\r\n              olGeometry,\r\n              'rgba(255,255,255,0.4)',\r\n              'rgba(143,7,7,1)'\r\n            );\r\n            this.updateOffset(\r\n              olGeometry,\r\n              0,\r\n              olGeometry instanceof OlPoint ? -15 : 0\r\n            );\r\n          }\r\n\r\n          isDrawEnd\r\n            ? this.onDrawEnd(olGeometry)\r\n            : this.onSelectDraw(olGeometry, result.label, [\r\n                dialogRef.componentInstance.labelFlag,\r\n                result.measureUnit\r\n              ]);\r\n          this.updateHeightTable();\r\n        }\r\n        // deletes the feature\r\n        else {\r\n          this.activeDrawingLayerSource\r\n            .getFeatures()\r\n            .forEach((drawingLayerFeature) => {\r\n              const geometry = drawingLayerFeature.getGeometry() as any;\r\n              if (olGeometry === geometry) {\r\n                this.activeDrawingLayerSource.removeFeature(\r\n                  drawingLayerFeature\r\n                );\r\n              }\r\n            });\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\r\n    this.addFeatureToStore(olGeometry, radius);\r\n    this.clearLabelsOfOlGeometry(olGeometry);\r\n    this.activeStore.layer.ol.getSource().refresh();\r\n  }\r\n\r\n  private onModifyDraw(olGeometry) {\r\n    const entities = this.activeStore.all();\r\n\r\n    entities.forEach((entity) => {\r\n      const entityId = entity.properties.id;\r\n      const olGeometryId = olGeometry.ol_uid;\r\n\r\n      if (entityId === olGeometryId) {\r\n        if (entity.properties.labelType === LabelType.Coordinates) {\r\n          let longLat = DDtoDMS(\r\n            [entity.properties.longitude, entity.properties.latitude],\r\n            entity.properties.measureUnit as CoordinatesUnit\r\n          );\r\n          this.updateLabelOfOlGeometry(\r\n            olGeometry,\r\n            '(' + longLat[1] + ', ' + longLat[0] + ')'\r\n          );\r\n        } else if (entity.properties.labelType === LabelType.Length) {\r\n          if (olGeometry instanceof OlCircle) {\r\n            let circularPolygon = fromCircle(olGeometry, 10000);\r\n            const radius = metersToUnit(\r\n              this.getRadius(circularPolygon),\r\n              entity.properties.measureUnit as MeasureLengthUnit\r\n            );\r\n            const unit =\r\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\r\n            const radiusLabel =\r\n              'R: ' + radius.toFixed(2).toString() + ' ' + unit;\r\n            this.updateLabelOfOlGeometry(olGeometry, radiusLabel);\r\n          } else {\r\n            let olGeometryLength = measureOlGeometryLength(\r\n              olGeometry,\r\n              this.map.ol.getView().getProjection().getCode()\r\n            );\r\n            let measureUnit: any;\r\n            const temp: MeasureLengthUnit = entity.properties\r\n              .measureUnit as MeasureLengthUnit;\r\n            measureUnit =\r\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\r\n            olGeometryLength = metersToUnit(olGeometryLength, temp);\r\n            let lengthLabel =\r\n              olGeometry instanceof Polygon\r\n                ? 'P: ' +\r\n                  olGeometryLength.toFixed(2).toString() +\r\n                  ' ' +\r\n                  measureUnit\r\n                : olGeometryLength.toFixed(2).toString() + ' ' + measureUnit;\r\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\r\n          }\r\n        } else if (entity.properties.labelType === LabelType.Area) {\r\n          if (olGeometry instanceof OlCircle) {\r\n            let circularPolygon = fromCircle(olGeometry, 10000);\r\n            let circleArea = measureOlGeometryArea(\r\n              circularPolygon,\r\n              this.map.ol.getView().getProjection().getCode()\r\n            );\r\n            const unit =\r\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\r\n            const temp: MeasureAreaUnit = entity.properties\r\n              .measureUnit as MeasureAreaUnit;\r\n            circleArea = squareMetersToUnit(circleArea, temp);\r\n            const areaLabel = circleArea.toFixed(2).toString() + ' ' + unit;\r\n            this.updateLabelOfOlGeometry(olGeometry, areaLabel);\r\n          } else {\r\n            let olGeometryArea = measureOlGeometryArea(\r\n              olGeometry,\r\n              this.map.ol.getView().getProjection().getCode()\r\n            );\r\n            let measureUnit: any;\r\n            const temp: MeasureAreaUnit = entity.properties\r\n              .measureUnit as MeasureAreaUnit;\r\n            measureUnit =\r\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\r\n            olGeometryArea = squareMetersToUnit(olGeometryArea, temp);\r\n            const lengthLabel =\r\n              olGeometryArea.toFixed(2).toString() + ' ' + measureUnit;\r\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\r\n          }\r\n        } else {\r\n          this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\r\n        }\r\n\r\n        this.updateLabelType(olGeometry, entity.properties.labelType);\r\n        this.updateMeasureUnit(olGeometry, entity.properties.measureUnit);\r\n        this.updateFontSizeAndStyle(\r\n          olGeometry,\r\n          entity.properties.fontStyle.split(' ')[0].replace('px', ''),\r\n          entity.properties.fontStyle.substring(\r\n            entity.properties.fontStyle.indexOf(' ') + 1\r\n          )\r\n        );\r\n        this.updateFillAndStrokeColor(\r\n          olGeometry,\r\n          entity.properties.drawingStyle.fill,\r\n          entity.properties.drawingStyle.stroke\r\n        );\r\n        this.updateOffset(\r\n          olGeometry,\r\n          entity.properties.offsetX,\r\n          entity.properties.offsetY\r\n        );\r\n        this.replaceFeatureInStore(entity, olGeometry);\r\n      }\r\n    });\r\n  }\r\n\r\n  private onSelectDraw(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    label: string,\r\n    labelTypeAndUnit?\r\n  ) {\r\n    const entities = this.activeStore.all();\r\n\r\n    const olGeometry = olFeature.getGeometry() as any;\r\n    olGeometry.ol_uid = olFeature.get('id');\r\n\r\n    const olGeometryCoordinates = JSON.stringify(\r\n      olGeometry.getCoordinates()[0]\r\n    );\r\n\r\n    entities.forEach((entity) => {\r\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\r\n      if (olGeometryCoordinates === entityCoordinates) {\r\n        const fontSize = olFeature\r\n          .get('fontStyle')\r\n          .split(' ')[0]\r\n          .replace('px', '');\r\n        const fontStyle = olFeature\r\n          .get('fontStyle')\r\n          .substring(olFeature.get('fontStyle').indexOf(' ') + 1);\r\n\r\n        const fillColor = olFeature.get('drawingStyle').fill;\r\n        const strokeColor = olFeature.get('drawingStyle').stroke;\r\n\r\n        const offsetX = olFeature.get('offsetX');\r\n        const offsetY = olFeature.get('offsetY');\r\n\r\n        const rad: number = entity.properties.rad\r\n          ? entity.properties.rad\r\n          : undefined;\r\n        this.updateLabelOfOlGeometry(olGeometry, label);\r\n        this.updateFontSizeAndStyle(olGeometry, fontSize, fontStyle);\r\n        this.updateFillAndStrokeColor(olGeometry, fillColor, strokeColor);\r\n        this.updateOffset(olGeometry, offsetX, offsetY);\r\n        this.updateLabelType(olGeometry, labelTypeAndUnit[0]);\r\n        this.updateMeasureUnit(olGeometry, labelTypeAndUnit[1]);\r\n        this.replaceFeatureInStore(entity, olGeometry, rad);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add a feature with draw label to the store. The loading stragegy of the store\r\n   * will trigger and add the feature to the map.\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(\r\n    olGeometry,\r\n    radius?: number,\r\n    feature?: FeatureWithDraw\r\n  ) {\r\n    let rad: number;\r\n    let center4326: Array<number>;\r\n    let point4326: Array<number>;\r\n    let lon4326: number;\r\n    let lat4326: number;\r\n\r\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\r\n    const projection = this.map.ol.getView().getProjection();\r\n\r\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\r\n      featureProjection: projection,\r\n      dataProjection: projection\r\n    }) as any;\r\n\r\n    if (olGeometry instanceof OlCircle || radius) {\r\n      if (radius) {\r\n        rad = radius;\r\n      } else {\r\n        geometry.type = 'Point';\r\n        geometry.coordinates = olGeometry.getCenter();\r\n        const extent4326 = transform(\r\n          [\r\n            olGeometry.getFlatCoordinates()[2],\r\n            olGeometry.getFlatCoordinates()[3]\r\n          ],\r\n          projection,\r\n          'EPSG:4326'\r\n        );\r\n        center4326 = transform(\r\n          [\r\n            olGeometry.getFlatCoordinates()[0],\r\n            olGeometry.getFlatCoordinates()[1]\r\n          ],\r\n          projection,\r\n          'EPSG:4326'\r\n        );\r\n        lon4326 = center4326[0];\r\n        lat4326 = center4326[1];\r\n        rad = getDistance(center4326, extent4326);\r\n        this.radiusFormControl.setValue(Math.round(rad));\r\n      }\r\n    }\r\n    if (this.activeDrawControl.radiusDrawEnd$.getValue()) {\r\n      rad = this.activeDrawControl.radiusDrawEnd$.getValue();\r\n    }\r\n\r\n    if (olGeometry instanceof OlPoint) {\r\n      point4326 = transform(\r\n        olGeometry.getFlatCoordinates(),\r\n        projection,\r\n        'EPSG:4326'\r\n      );\r\n      lon4326 = point4326[0];\r\n      lat4326 = point4326[1];\r\n    }\r\n\r\n    this.activeStore.update({\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: projection.getCode(),\r\n      properties: {\r\n        id: featureId,\r\n        draw: olGeometry.get('_label'),\r\n        longitude: lon4326 ? lon4326 : null,\r\n        latitude: lat4326 ? lat4326 : null,\r\n        rad: rad ? rad : null,\r\n        fontStyle: olGeometry.get('fontStyle_'),\r\n        drawingStyle: {\r\n          fill: olGeometry.get('fillColor_'),\r\n          stroke: olGeometry.get('strokeColor_')\r\n        },\r\n        offsetX: olGeometry.get('offsetX_'),\r\n        offsetY: olGeometry.get('offsetY_'),\r\n        labelType: olGeometry.get('labelType_'),\r\n        measureUnit: olGeometry.get('measureUnit_')\r\n      },\r\n      meta: {\r\n        id: featureId\r\n      }\r\n    });\r\n    this.activeStore.setLayerExtent();\r\n    this.activeDrawControl.predefinedRadius$.next(undefined);\r\n    this.activeDrawControl.radiusDrawEnd$.next(undefined);\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      fill: [''],\r\n      stroke: ['']\r\n    });\r\n  }\r\n\r\n  public setupLayer(isNewLayer?: boolean) {\r\n    setTimeout(() => {\r\n      const dialogRef = this.dialog.open(DrawLayerPopupComponent, {\r\n        disableClose: false\r\n      });\r\n      dialogRef.afterClosed().subscribe((label: string) => {\r\n        if (dialogRef.componentInstance.confirmFlag) {\r\n          this.activeStore.state.updateAll({ selected: false });\r\n          this.activeStore = new FeatureStore<FeatureWithDraw>([], {\r\n            map: this.map\r\n          });\r\n          this.activeDrawingLayerSource = new OlVectorSource();\r\n          this.activeDrawingLayer.opacity = 0;\r\n          this.deactivateDrawControl();\r\n          this.initStore(label, isNewLayer);\r\n          this.activeDrawControl = this.createDrawControl(\r\n            this.fillColor,\r\n            this.strokeColor,\r\n            this.strokeWidth\r\n          );\r\n          this.activeDrawControl.setGeometryType(this.currGeometryType);\r\n          this.toggleDrawControl();\r\n          this.stores.push(this.activeStore);\r\n          this.drawControls.push([\r\n            this.activeDrawingLayer.id,\r\n            this.activeDrawControl\r\n          ]);\r\n          this.drawControlsEvent.emit(this.drawControls);\r\n          this.layersIDEvent.emit(this.activeDrawingLayer.id);\r\n          this.isCreatingNewLayer = false;\r\n          if (!this.labelsAreShown) {\r\n            this.onToggleLabels();\r\n          }\r\n          this.activeLayerChange.emit(this.activeDrawingLayer);\r\n        } else {\r\n          this.select.value = this.activeDrawingLayer;\r\n          this.select.selectionChange.emit(this.activeDrawingLayer);\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  // HTML user interactions\r\n\r\n  /**\r\n   * Called when the user double-clicks the selected drawing\r\n   */\r\n  editLabelDrawing(feature) {\r\n    const olGeometryFeature = featureToOl(\r\n      feature,\r\n      this.map.ol.getView().getProjection().getCode()\r\n    );\r\n    this.openDrawDialog(olGeometryFeature, false);\r\n  }\r\n\r\n  openShorcutsDialog() {\r\n    this.dialog.open(DrawShorcutsComponent);\r\n  }\r\n\r\n  deleteDrawings() {\r\n    this.activeStore.deleteMany(this.selectedFeatures$.value);\r\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\r\n      this.activeDrawingLayerSource\r\n        .getFeatures()\r\n        .forEach((drawingLayerFeature) => {\r\n          const geometry = drawingLayerFeature.getGeometry() as any;\r\n          if (selectedFeature.properties.id === geometry.ol_uid) {\r\n            this.activeDrawingLayerSource.removeFeature(drawingLayerFeature);\r\n          }\r\n        });\r\n    });\r\n    this.updateHeightTable();\r\n    this.activeStore.setLayerExtent();\r\n  }\r\n\r\n  /**\r\n   * Called when the user toggles the labels toggle\r\n   */\r\n  onToggleLabels() {\r\n    this.drawStyleService.toggleLabelsAreShown();\r\n    this.labelsAreShown = !this.labelsAreShown;\r\n    this.icon\r\n      ? this.elementStyle(this.labelsAreShown, true)\r\n      : this.elementStyle(this.labelsAreShown, false);\r\n    this.createDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Called when the user toggles the Draw control is toggled\r\n   * @internal\r\n   */\r\n  onToggleDrawControl(toggleIsChecked: boolean) {\r\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\r\n  }\r\n\r\n  onToggleFreehandMode(event: any) {\r\n    if (this.isCircle() && !event.checked) {\r\n      this.activeDrawControl.ispredefinedRadius$.next(true);\r\n      this.changeRadius(this.radiusFormControl.value);\r\n    } else {\r\n      this.activeDrawControl.setOlInteractionStyle(\r\n        createInteractionStyle(\r\n          this.fillColor,\r\n          this.strokeColor,\r\n          this.strokeWidth\r\n        )\r\n      );\r\n      this.activeDrawControl.ispredefinedRadius$.next(false);\r\n    }\r\n    this.freehandMode = event.checked;\r\n    this.activeDrawControl.freehand$.next(event.checked);\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  // User changes properties of a drawing element\r\n\r\n  /**\r\n   * Display the current layer with the current store and the current layerSource\r\n   */\r\n\r\n  public onLayerChange(currLayer?: VectorLayer) {\r\n    if (currLayer) {\r\n      this.activeStore.state.updateAll({ selected: false });\r\n      this.isCreatingNewLayer = false;\r\n      this.activeDrawingLayer.opacity = 0;\r\n      this.activeDrawingLayer = currLayer;\r\n      this.activeDrawingLayer.opacity = 1;\r\n      this.deactivateDrawControl();\r\n      if (!this.labelsAreShown) {\r\n        this.onToggleLabels();\r\n      }\r\n      this.activeStore = this.stores.find(\r\n        (store) => store.layer.id === this.activeDrawingLayer.id\r\n      );\r\n      this.activeDrawControl = this.drawControls.find(\r\n        (dc) => dc[0] === this.activeDrawingLayer.id\r\n      )[1];\r\n      this.activeDrawingLayerSource =\r\n        this.activeDrawControl.olDrawingLayerSource;\r\n      this.activeDrawControl.setGeometryType(this.currGeometryType);\r\n      this.toggleDrawControl();\r\n    } else {\r\n      this.setupLayer(true);\r\n    }\r\n    this.activeLayerChange.emit(this.activeDrawingLayer);\r\n  }\r\n\r\n  public createLayer(newTitle?, isNewLayer?) {\r\n    for (const layer of this.allLayers) {\r\n      let numberId = Number(layer.id.replace('igo-draw-layer', ''));\r\n      this.layerCounterID = Math.max(numberId, this.layerCounterID);\r\n    }\r\n    this.activeDrawingLayer = new VectorLayer({\r\n      isIgoInternalLayer: true,\r\n      id: 'igo-draw-layer' + ++this.layerCounterID,\r\n      title: isNewLayer\r\n        ? newTitle\r\n        : this.languageService.translate.instant('igo.geo.draw.drawing'),\r\n      zIndex: 200,\r\n      source: new FeatureDataSource(),\r\n      style: (feature, resolution) => {\r\n        return this.drawStyleService.createIndividualElementStyle(\r\n          feature,\r\n          resolution,\r\n          this.labelsAreShown,\r\n          feature.get('fontStyle'),\r\n          feature.get('drawingStyle').fill,\r\n          feature.get('drawingStyle').stroke,\r\n          feature.get('offsetX'),\r\n          feature.get('offsetY'),\r\n          this.map.projection,\r\n          this.icon\r\n        );\r\n      },\r\n      showInLayerList: true,\r\n      exportable: true,\r\n      browsable: false,\r\n      workspace: {\r\n        enabled: false\r\n      }\r\n    });\r\n\r\n    tryBindStoreLayer(this.activeStore, this.activeDrawingLayer);\r\n\r\n    tryAddLoadingStrategy(\r\n      this.activeStore,\r\n      new FeatureStoreLoadingStrategy({\r\n        motion: FeatureMotion.None\r\n      })\r\n    );\r\n\r\n    tryAddSelectionStrategy(\r\n      this.activeStore,\r\n      new FeatureStoreSelectionStrategy({\r\n        map: this.map,\r\n        motion: FeatureMotion.None,\r\n        many: true\r\n      })\r\n    );\r\n    this.activeStore.layer.visible = true;\r\n    this.activeStore.source.ol.on(\r\n      'removefeature',\r\n      (event: OlVectorSourceEvent<OlGeometry>) => {\r\n        const olGeometry = event.feature.getGeometry();\r\n        this.clearLabelsOfOlGeometry(olGeometry);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Called when the user changes the color in a color picker\r\n   * @param labelsAreShown wheter the labels are shown or not\r\n   * @param isAnIcon wheter the feature is an icon or not\r\n   * @param fillColor which is the filling color\r\n   * @param strokeColor which is the stroke color\r\n   */\r\n  onColorChange(\r\n    labelsAreShown: boolean,\r\n    isAnIcon: boolean,\r\n    fillColor: string,\r\n    strokeColor: string\r\n  ) {\r\n    if (this.selectedFeatures$.value.length > 0 && !isAnIcon) {\r\n      this.selectedFeatures$.value.forEach((feature) => {\r\n        let olFeature = featureToOl(\r\n          feature,\r\n          this.map.ol.getView().getProjection().getCode()\r\n        );\r\n        this.updateFillAndStrokeColor(olFeature, fillColor, strokeColor);\r\n\r\n        const entity = this.activeStore\r\n          .all()\r\n          .find((e) => e.meta.id === olFeature.getId());\r\n        entity.properties.drawingStyle.fill = olFeature.get('fillColor_');\r\n        entity.properties.drawingStyle.stroke = olFeature.get('strokeColor_');\r\n        this.activeStore.update(entity);\r\n      });\r\n    }\r\n\r\n    this.elementStyle(labelsAreShown, isAnIcon);\r\n    this.createDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Called when the user changes the font size or/and style\r\n   * @param labelsAreShown wheter the labels are shown or not\r\n   * @param size the size of the font\r\n   * @param style the style of the font\r\n   */\r\n\r\n  onFontChange(labelsAreShown: boolean, size: string, style: FontType) {\r\n    if (this.selectedFeatures$.value.length > 0) {\r\n      this.selectedFeatures$.value.forEach((feature) => {\r\n        let olFeature = featureToOl(\r\n          feature,\r\n          this.map.ol.getView().getProjection().getCode()\r\n        );\r\n        this.updateFontSizeAndStyle(olFeature, size, style);\r\n        const entity = this.activeStore\r\n          .all()\r\n          .find((e) => e.meta.id === olFeature.getId());\r\n        entity.properties.fontStyle = olFeature.get('fontStyle_');\r\n        this.activeStore.update(entity);\r\n        olFeature = this.activeStore.layer.ol\r\n          .getSource()\r\n          .getFeatures()\r\n          .find((f) => f.getId() === entity.meta.id);\r\n        olFeature.setProperties({ fontStyle: entity.properties.fontStyle });\r\n        olFeature.changed();\r\n      });\r\n\r\n      this.fontSize = size;\r\n      this.fontStyle = style;\r\n\r\n      this.drawStyleService.setFontSize(size);\r\n      this.drawStyleService.setFontStyle(style);\r\n\r\n      this.elementStyle(labelsAreShown);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Called when the user changes the value of the horizontal/vertical offset\r\n   * @param labelsAreShown wheter the labels are shown or not\r\n   * @param offsetX horizontal offset of the label\r\n   * @param offsetY vertical offset of the label\r\n   */\r\n\r\n  onOffsetLabelChange(\r\n    labelsAreShown: boolean,\r\n    offsetX: number,\r\n    offsetY: number\r\n  ) {\r\n    if (this.selectedFeatures$.value.length > 0) {\r\n      this.selectedFeatures$.value.forEach((feature) => {\r\n        let olFeature = featureToOl(\r\n          feature,\r\n          this.map.ol.getView().getProjection().getCode()\r\n        );\r\n        this.updateOffset(olFeature, offsetX, offsetY);\r\n        const entity = this.activeStore\r\n          .all()\r\n          .find((e) => e.meta.id === olFeature.getId());\r\n        entity.properties.offsetX = olFeature.get('offsetX_');\r\n        entity.properties.offsetY = olFeature.get('offsetY_');\r\n        this.activeStore.update(entity);\r\n        olFeature = this.activeStore.layer.ol\r\n          .getSource()\r\n          .getFeatures()\r\n          .find((f) => f.getId() === entity.meta.id);\r\n        olFeature.setProperties({\r\n          offsetX: entity.properties.offsetX,\r\n          offsetY: entity.properties.offsetY\r\n        });\r\n        olFeature.changed();\r\n      });\r\n      this.elementStyle(labelsAreShown);\r\n    }\r\n  }\r\n\r\n  onIconChange(event?) {\r\n    this.icon = event;\r\n    this.drawStyleService.setIcon(this.icon);\r\n    this.elementStyle(true, this.icon);\r\n  }\r\n\r\n  /**\r\n   * Called when the user selects a new geometry type\r\n   * @param geometryType the geometry type selected by the user\r\n   */\r\n  onGeometryTypeChange(geometryType: Type) {\r\n    this.currGeometryType = geometryType;\r\n    this.activeDrawControl.setGeometryType(geometryType);\r\n    this.freehandMode\r\n      ? this.onToggleFreehandMode({ checked: true })\r\n      : this.onToggleFreehandMode({ checked: false });\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  // Updates the properties of olFeature inputted\r\n\r\n  /**\r\n   * Update the label of a geometry when a label is entered in a dialog box\r\n   * @param OlFeature the feature\r\n   * @param label the label\r\n   */\r\n  private updateLabelOfOlGeometry(OlFeature, label: string) {\r\n    OlFeature.setProperties(\r\n      {\r\n        _label: label\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateFontSizeAndStyle(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    fontSize: string,\r\n    fontStyle: string\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        fontStyle_: `${fontSize}px ${fontStyle}`\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateFillAndStrokeColor(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    fillColor: string,\r\n    strokeColor: string\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        fillColor_: fillColor,\r\n        strokeColor_: strokeColor\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateOffset(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    offsetX: number,\r\n    offsetY: number\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        offsetX_: offsetX,\r\n        offsetY_: offsetY\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateLabelType(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    typeOfLabel: LabelType | [LabelType, LabelType]\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        labelType_: typeOfLabel\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  private updateMeasureUnit(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    measureUnit: MeasureLengthUnit | MeasureAreaUnit | CoordinatesUnit | []\r\n  ) {\r\n    olFeature.setProperties(\r\n      {\r\n        measureUnit_: measureUnit\r\n      },\r\n      true\r\n    );\r\n  }\r\n\r\n  // Updates values of the selected element on the HTML view\r\n\r\n  getFeatureFontSize(): string {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.fontStyle\r\n          .split(' ')[0]\r\n          .replace('px', '')\r\n      : '15';\r\n  }\r\n\r\n  getFeatureFontStyle() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.fontStyle.substring(\r\n          this.selectedFeatures$.value[0].properties.fontStyle.indexOf(' ') + 1\r\n        )\r\n      : FontType.Arial;\r\n  }\r\n\r\n  getFeatureFillColor() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.fill\r\n      : 'rgba(255,255,255,0.4)';\r\n  }\r\n\r\n  getFeatureStrokeColor() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.stroke\r\n      : 'rgba(143,7,7,1)';\r\n  }\r\n\r\n  getFeatureOffsetX() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.offsetX\r\n      : this.drawStyleService.getOffsetX();\r\n  }\r\n\r\n  getFeatureOffsetY() {\r\n    return this.selectedFeatures$.value.length > 0\r\n      ? this.selectedFeatures$.value[0].properties.offsetY\r\n      : '0';\r\n  }\r\n\r\n  get allFontStyles(): string[] {\r\n    return Object.values(FontType);\r\n  }\r\n\r\n  get allLayers() {\r\n    return this.map.layers.filter((layer) =>\r\n      String(layer.id).includes('igo-draw-layer')\r\n    );\r\n  }\r\n\r\n  updateHeightTable() {\r\n    // Check the amount of rows as a possible alternative\r\n    this.numberOfDrawings = this.activeStore.count$.getValue();\r\n    this.numberOfDrawings > 10\r\n      ? (this.tableTemplate.tableHeight = '35vh')\r\n      : (this.tableTemplate.tableHeight = 'auto');\r\n  }\r\n\r\n  updateActiveLayer() {\r\n    let currLayer = this.allLayers.find(\r\n      (layer) => layer.title === this.activeDrawingLayer.title\r\n    );\r\n    return currLayer ? currLayer : this.allLayers[0];\r\n  }\r\n\r\n  // Helper methods\r\n\r\n  /**\r\n   * Activate the correct control\r\n   */\r\n  private toggleDrawControl() {\r\n    this.deactivateDrawControl();\r\n    this.activateDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Clear the tooltips of an OL geometry\r\n   * @param olGeometry OL geometry with tooltips\r\n   */\r\n  private clearLabelsOfOlGeometry(olGeometry) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach(\r\n      (olTooltip: OlOverlay | undefined) => {\r\n        if (olTooltip && olTooltip.getMap()) {\r\n          this.map.ol.removeOverlay(olTooltip);\r\n        }\r\n      }\r\n    );\r\n  }\r\n  /**\r\n   * Replace the feature in the store\r\n   * @param entity the entity to replace\r\n   * @param olGeometry the new geometry to insert in the store\r\n   */\r\n  private replaceFeatureInStore(\r\n    entity,\r\n    olGeometry: OlGeometry,\r\n    radius?: number\r\n  ) {\r\n    this.activeStore.delete(entity);\r\n    this.onDrawEnd(olGeometry, radius);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active draw control\r\n   */\r\n  private deactivateDrawControl() {\r\n    if (!this.activeDrawControl) {\r\n      return;\r\n    }\r\n\r\n    if (this.drawEnd$$) {\r\n      this.drawEnd$$.unsubscribe();\r\n    }\r\n\r\n    this.activeDrawControl.setOlMap(undefined);\r\n    this.drawControlIsActive = false;\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   */\r\n  private activateDrawControl() {\r\n    this.drawControlIsDisabled = false;\r\n    this.drawControlIsActive = true;\r\n    this.drawEnd$$ = this.activeDrawControl.end$.subscribe(\r\n      (olGeometry: OlGeometry) => {\r\n        this.openDrawDialog(olGeometry, true);\r\n      }\r\n    );\r\n\r\n    this.activeDrawControl.modify$.subscribe((olGeometry: OlGeometry) => {\r\n      this.onModifyDraw(olGeometry);\r\n    });\r\n\r\n    if (!this.drawSelect$$) {\r\n      this.drawSelect$$ = this.activeDrawControl.select$.subscribe(\r\n        (olFeature: OlFeature<OlGeometry>) => {\r\n          this.openDrawDialog(olFeature, false);\r\n        }\r\n      );\r\n    }\r\n    this.activeDrawControl.setOlMap(this.map.ol, true);\r\n  }\r\n\r\n  /**\r\n   * get the geometry of design\r\n   *\r\n   */\r\n\r\n  isPoint() {\r\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Point;\r\n  }\r\n\r\n  isLineString() {\r\n    return (\r\n      this.activeDrawControl.getGeometryType() === this.geometryType.LineString\r\n    );\r\n  }\r\n\r\n  isPolygon() {\r\n    return (\r\n      this.activeDrawControl.getGeometryType() === this.geometryType.Polygon\r\n    );\r\n  }\r\n\r\n  isCircle() {\r\n    return (\r\n      this.activeDrawControl.getGeometryType() === this.geometryType.Circle\r\n    );\r\n  }\r\n\r\n  /**\r\n   * The fonction to predefine the radius of the user\r\n   *\r\n   */\r\n\r\n  changeRadius(radius: number) {\r\n    let radiusMeters: number;\r\n\r\n    if (radius) {\r\n      this.measureUnit === MeasureLengthUnit.Meters\r\n        ? (radiusMeters = radius)\r\n        : (radiusMeters = radius * 1000);\r\n    } else {\r\n      radiusMeters = undefined;\r\n    }\r\n\r\n    const pointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\r\n      const geom = feature.getGeometry() as OlPoint;\r\n      const coordinates = olproj.transform(\r\n        geom.getCoordinates(),\r\n        this.map.projection,\r\n        'EPSG:4326'\r\n      );\r\n\r\n      const radius =\r\n        radiusMeters / Math.cos((Math.PI / 180) * coordinates[1]) / resolution;\r\n      this.activeDrawControl.predefinedRadius$.next(radiusMeters);\r\n      return new OlStyle.Style({\r\n        image: new OlStyle.Circle({\r\n          radius: radius,\r\n          stroke: new OlStyle.Stroke({\r\n            width: 1,\r\n            color: 'rgba(143,7,7,1)'\r\n          }),\r\n          fill: new OlStyle.Fill({\r\n            color: 'rgba(255,255,255,0.4)'\r\n          })\r\n        })\r\n      });\r\n    };\r\n\r\n    this.activeDrawControl.setOlInteractionStyle(pointStyle);\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  onMeasureUnitChange(selectedMeasureUnit: MeasureLengthUnit) {\r\n    if (selectedMeasureUnit === this.measureUnit) {\r\n      return;\r\n    } else {\r\n      this.measureUnit = selectedMeasureUnit;\r\n      this.measureUnit === MeasureLengthUnit.Meters\r\n        ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\r\n        : this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recreates the style of the feature stored\r\n   */\r\n  private elementStyle(labelsAreShown: boolean, isAnIcon?) {\r\n    if (isAnIcon) {\r\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\r\n        return this.drawStyleService.createIndividualElementStyle(\r\n          feature,\r\n          resolution,\r\n          labelsAreShown,\r\n          feature.get('fontStyle'),\r\n          feature.get('drawingStyle').fill,\r\n          feature.get('drawingStyle').stroke,\r\n          feature.get('offsetX'),\r\n          feature.get('offsetY'),\r\n          this.map.projection,\r\n          this.icon\r\n        );\r\n      });\r\n    } else {\r\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\r\n        return this.drawStyleService.createIndividualElementStyle(\r\n          feature,\r\n          resolution,\r\n          labelsAreShown,\r\n          feature.get('fontStyle'),\r\n          feature.get('drawingStyle').fill,\r\n          feature.get('drawingStyle').stroke,\r\n          feature.get('offsetX'),\r\n          feature.get('offsetY'),\r\n          this.map.projection\r\n        );\r\n      });\r\n    }\r\n  }\r\n\r\n  private getRadius(olGeometry): number {\r\n    const length = getLength(olGeometry);\r\n    return Number(length / (2 * Math.PI));\r\n  }\r\n}\r\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { OgcFilterableListComponent } from './ogc-filterable-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoOgcFilterableListBinding]'\r\n})\r\nexport class OgcFilterableListBindingDirective implements OnInit, OnDestroy {\r\n  private component: OgcFilterableListComponent;\r\n  private layers$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: OgcFilterableListComponent,\r\n    private mapService: MapService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    this.component.layers = [];\r\n\r\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\r\n      this.component.layers = layers.filter((layer) => layer.showInLayerList);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n}\r\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType$ | async\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [controlOptions]=\"controlOptions\"\n  [drawStyle]=\"drawStyle\"\n  [overlayStyle]=\"overlayStyle\"\n>\n</igo-geometry-form-field-input>\n\n<div *ngIf=\"geometryTypeField\" class=\"geometry-type-toggle\">\n  <mat-button-toggle-group\n    [disabled]=\"(value$ | async) !== undefined\"\n    [(ngModel)]=\"geometryType\"\n  >\n    <mat-button-toggle\n      value=\"Point\"\n      [disabled]=\"geometryTypes.indexOf('Point') < 0\"\n    >\n      {{ 'igo.geo.geometry.point' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"LineString\"\n      [disabled]=\"geometryTypes.indexOf('LineString') < 0\"\n    >\n      {{ 'igo.geo.geometry.line' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"Polygon\"\n      [disabled]=\"geometryTypes.indexOf('Polygon') < 0\"\n    >\n      {{ 'igo.geo.geometry.polygon' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<mat-form-field *ngIf=\"drawGuideField\" class=\"draw-guide-field\">\n  <input\n    matInput\n    type=\"number\"\n    [placeholder]=\"drawGuidePlaceholder\"\n    [(ngModel)]=\"drawGuide\"\n  />\n  <mat-icon matPrefix [color]=\"'primary'\" svgIcon=\"adjust\"> </mat-icon>\n  <span matSuffix class=\"draw-guide-units\">{{\n    'igo.geo.measure.meters' | translate\n  }}</span>\n</mat-form-field>\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { UntypedFormControl } from '@angular/forms';\r\n\r\nimport { IgoFormFieldComponent } from '@igo2/common';\r\n\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { IgoMap } from '../../map/shared';\r\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\r\n\r\n/**\r\n * This input allows a user to draw a new geometry or to edit\r\n * an existing one on a map.\r\n */\r\n@IgoFormFieldComponent('geometry')\r\n@Component({\r\n  selector: 'igo-geometry-form-field',\r\n  templateUrl: './geometry-form-field.component.html',\r\n  styleUrls: ['./geometry-form-field.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class GeometryFormFieldComponent implements OnInit, OnDestroy {\r\n  readonly value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  private value$$: Subscription;\r\n\r\n  set drawControlIsActive(value: boolean) {\r\n    this._drawControlIsActive = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  get drawControlIsActive(): boolean {\r\n    return this._drawControlIsActive;\r\n  }\r\n  private _drawControlIsActive = true;\r\n\r\n  set freehandDrawIsActive(value: boolean) {\r\n    this._freehandDrawIsActive = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  get freehandDrawIsActive(): boolean {\r\n    return this._freehandDrawIsActive;\r\n  }\r\n  private _freehandDrawIsActive = false;\r\n\r\n  /**\r\n   * The field's form control\r\n   */\r\n  @Input() formControl: UntypedFormControl;\r\n\r\n  /**\r\n   * The map to draw the geometry on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  set geometryType(value: Type) {\r\n    this.geometryType$.next(value);\r\n  }\r\n  get geometryType(): Type {\r\n    return this.geometryType$.value;\r\n  }\r\n  readonly geometryType$: BehaviorSubject<Type> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Whether a geometry type toggle should be displayed\r\n   */\r\n  @Input() geometryTypeField: boolean = false;\r\n\r\n  /**\r\n   * Available geometry types\r\n   */\r\n  @Input() geometryTypes: string[] = ['Point', 'LineString', 'Polygon'];\r\n\r\n  /**\r\n   * Whether a draw guide field should be displayed\r\n   */\r\n  @Input() drawGuideField: boolean = false;\r\n\r\n  /**\r\n   * The drawGuide around the mouse pointer to help drawing\r\n   */\r\n  @Input()\r\n  set drawGuide(value: number) {\r\n    this.drawGuide$.next(value);\r\n  }\r\n  get drawGuide(): number {\r\n    return this.drawGuide$.value;\r\n  }\r\n  readonly drawGuide$: BehaviorSubject<number> = new BehaviorSubject(0);\r\n\r\n  /**\r\n   * Draw guide placeholder\r\n   */\r\n  @Input() drawGuidePlaceholder: string = '';\r\n\r\n  /**\r\n   * Whether a measure tooltip should be displayed\r\n   */\r\n  @Input() measure: boolean = false;\r\n\r\n  /**\r\n   * Control options\r\n   */\r\n  @Input() controlOptions: { [key: string]: any } = {};\r\n\r\n  /**\r\n   * Style for the draw control (applies while the geometry is being drawn)\r\n   */\r\n  @Input() drawStyle: OlStyleLike;\r\n\r\n  /**\r\n   * Style for the overlay layer (applies once the geometry is added to the map)\r\n   * If not specified, drawStyle applies\r\n   */\r\n  @Input() overlayStyle: OlStyleLike;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Set up a value stream\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.value$.next(\r\n      this.formControl.value ? this.formControl.value : undefined\r\n    );\r\n    this.value$$ = this.formControl.valueChanges.subscribe(\r\n      (value: GeoJSONGeometry) => {\r\n        this.value$.next(value ? value : undefined);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the value stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.value$$.unsubscribe();\r\n  }\r\n}\r\n","import { ConfirmDialogService } from '@igo2/common';\r\nimport { MessageService } from '@igo2/core';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { first, of } from 'rxjs';\r\n\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport {\r\n  computeOlFeaturesExtent,\r\n  featureToOl,\r\n  moveToOlFeatures\r\n} from '../../feature/shared/feature.utils';\r\nimport { ClusterParam } from '../../layer/shared/clusterParam';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport {\r\n  featureRandomStyle,\r\n  featureRandomStyleFunction\r\n} from '../../style/shared/feature/feature-style';\r\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\r\nimport { StyleListService } from '../../style/style-list/style-list.service';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\n\r\nexport function addLayerAndFeaturesToMap(\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  contextUri: string,\r\n  layerTitle: string,\r\n  layerService: LayerService,\r\n  storeToIdb: boolean = false\r\n): VectorLayer {\r\n  const olFeatures = features.map((feature: Feature) =>\r\n    featureToOl(feature, map.projection)\r\n  );\r\n\r\n  const id = uuid();\r\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n    id,\r\n    type: 'vector',\r\n    queryable: true\r\n  };\r\n  const source = new FeatureDataSource(sourceOptions);\r\n  source.ol.addFeatures(olFeatures);\r\n  let randomStyle;\r\n  let editable: boolean = false;\r\n  if (\r\n    olFeatures[0].getKeys().includes('_style') ||\r\n    olFeatures[0].getKeys().includes('_mapTitle')\r\n  ) {\r\n    randomStyle = featureRandomStyleFunction();\r\n  } else {\r\n    randomStyle = featureRandomStyle();\r\n    editable = true;\r\n  }\r\n  const layer = layerService.createLayer({\r\n    id,\r\n    title: layerTitle,\r\n    workspace: { enabled: true, searchIndexEnabled: true },\r\n    isIgoInternalLayer: true,\r\n    source,\r\n    igoStyle: { editable },\r\n    idbInfo: { firstLoad: true, storeToIdb, contextUri: contextUri || '*' },\r\n    style: randomStyle\r\n  }) as VectorLayer;\r\n  layer.setExtent(computeOlFeaturesExtent(olFeatures, map.viewProjection));\r\n  map.addLayer(layer);\r\n  moveToOlFeatures(map.viewController, olFeatures);\r\n\r\n  return layer;\r\n}\r\n\r\nexport function addLayerAndFeaturesStyledToMap(\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  layerTitle: string,\r\n  styleListService: StyleListService,\r\n  styleService: StyleService,\r\n  layerId?: string,\r\n  imposedSourceOptions?,\r\n  imposedLayerOptions?,\r\n  zoomTo: boolean = true\r\n): VectorLayer {\r\n  const olFeatures = features.map((feature: Feature) =>\r\n    featureToOl(feature, map.projection)\r\n  );\r\n  let style;\r\n  let distance: number;\r\n\r\n  if (\r\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\r\n  ) {\r\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\r\n      layerTitle.toString() + '.styleByAttribute'\r\n    );\r\n\r\n    style = (feature, resolution) => {\r\n      return styleService.createStyleByAttribute(\r\n        feature,\r\n        styleByAttribute,\r\n        resolution\r\n      );\r\n    };\r\n  } else if (\r\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\r\n  ) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(\r\n      layerTitle.toString() + '.clusterParam'\r\n    );\r\n    distance = styleListService.getStyleList(\r\n      layerTitle.toString() + '.distance'\r\n    );\r\n\r\n    style = (feature, resolution) => {\r\n      const baseStyle = styleService.createStyle(\r\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'),\r\n        feature,\r\n        resolution\r\n      );\r\n      return styleService.createClusterStyle(\r\n        feature,\r\n        resolution,\r\n        clusterParam,\r\n        baseStyle\r\n      );\r\n    };\r\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\r\n    style = (feature, resolution) =>\r\n      styleService.createStyle(\r\n        styleListService.getStyleList(layerTitle.toString() + '.style'),\r\n        feature,\r\n        resolution\r\n      );\r\n  } else if (\r\n    styleListService.getStyleList('default.clusterStyle') &&\r\n    features[0].geometry.type === 'Point'\r\n  ) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(\r\n      'default.clusterParam'\r\n    );\r\n    distance = styleListService.getStyleList('default.distance');\r\n\r\n    style = (feature, resolution) => {\r\n      const baseStyle = styleService.createStyle(\r\n        styleListService.getStyleList('default.clusterStyle'),\r\n        feature,\r\n        resolution\r\n      );\r\n      return styleService.createClusterStyle(\r\n        feature,\r\n        resolution,\r\n        clusterParam,\r\n        baseStyle\r\n      );\r\n    };\r\n  } else {\r\n    style = (feature, resolution) =>\r\n      styleService.createStyle(\r\n        styleListService.getStyleList('default.style'),\r\n        feature,\r\n        resolution\r\n      );\r\n  }\r\n\r\n  let source;\r\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\r\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        distance,\r\n        type: 'cluster',\r\n        queryable: true\r\n      };\r\n    source = new ClusterDataSource(\r\n      Object.assign(sourceOptions, imposedSourceOptions)\r\n    );\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        type: 'vector',\r\n        queryable: true\r\n      };\r\n    source = new FeatureDataSource(\r\n      Object.assign(sourceOptions, imposedSourceOptions)\r\n    );\r\n    source.ol.addFeatures(olFeatures);\r\n  } else if (\r\n    styleListService.getStyleList('default.clusterStyle') &&\r\n    features[0].geometry.type === 'Point'\r\n  ) {\r\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        distance,\r\n        type: 'cluster',\r\n        queryable: true\r\n      };\r\n    source = new ClusterDataSource(\r\n      Object.assign(sourceOptions, imposedSourceOptions)\r\n    );\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        type: 'vector',\r\n        queryable: true\r\n      };\r\n    source = new FeatureDataSource(\r\n      Object.assign(sourceOptions, imposedSourceOptions)\r\n    );\r\n    source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  const layer = new VectorLayer(\r\n    Object.assign(\r\n      {\r\n        title: layerTitle,\r\n        id: layerId || uuid(),\r\n        isIgoInternalLayer: true,\r\n        source,\r\n        style\r\n      },\r\n      imposedLayerOptions\r\n    )\r\n  );\r\n  map.addLayer(layer);\r\n  if (zoomTo) {\r\n    moveToOlFeatures(map.viewController, olFeatures);\r\n  }\r\n  return layer;\r\n}\r\n\r\nfunction padTo2Digits(num) {\r\n  return num.toString().padStart(2, '0');\r\n}\r\n\r\nexport function handleFileImportSuccess(\r\n  file: File,\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  contextUri: string,\r\n  messageService: MessageService,\r\n  layerService: LayerService,\r\n  confirmDialogService?: ConfirmDialogService,\r\n  styleListService?: StyleListService,\r\n  styleService?: StyleService\r\n) {\r\n  if (features.length === 0) {\r\n    handleNothingToImportError(file, messageService);\r\n    return;\r\n  }\r\n\r\n  let layerTitle = computeLayerTitleFromFile(file);\r\n\r\n  const obs$ = confirmDialogService\r\n    ? confirmDialogService.open('igo.geo.import.promptStoreToIdb')\r\n    : of(false);\r\n\r\n  obs$.pipe(first()).subscribe((confirm) => {\r\n    const d = new Date();\r\n    const dformat =\r\n      [\r\n        d.getFullYear(),\r\n        padTo2Digits(d.getMonth() + 1),\r\n        padTo2Digits(d.getDate())\r\n      ].join('/') +\r\n      ' ' +\r\n      [padTo2Digits(d.getHours()), padTo2Digits(d.getMinutes())].join(':');\r\n\r\n    layerTitle = confirm ? `${layerTitle} (${dformat})` : layerTitle;\r\n    if (!styleListService) {\r\n      addLayerAndFeaturesToMap(\r\n        features,\r\n        map,\r\n        contextUri,\r\n        layerTitle,\r\n        layerService,\r\n        confirm\r\n      );\r\n    } else {\r\n      addLayerAndFeaturesStyledToMap(\r\n        features,\r\n        map,\r\n        layerTitle,\r\n        styleListService,\r\n        styleService\r\n      );\r\n    }\r\n\r\n    messageService.success(\r\n      'igo.geo.dropGeoFile.success.text',\r\n      'igo.geo.dropGeoFile.success.title',\r\n      undefined,\r\n      { value: layerTitle }\r\n    );\r\n  });\r\n}\r\n\r\nexport function handleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  sizeMb?: number\r\n) {\r\n  sizeMb = sizeMb ? sizeMb : 30;\r\n  const errMapping = {\r\n    'Invalid file': handleInvalidFileImportError,\r\n    'File is too large': handleSizeFileImportError,\r\n    'Failed to read file': handleUnreadbleFileImportError,\r\n    'Invalid SRS definition': handleSRSImportError,\r\n    'Error 500 with OGRE': handleOgreServerImportError\r\n  };\r\n  errMapping[error.message](file, error, messageService, sizeMb);\r\n}\r\n\r\nexport function handleInvalidFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.invalid.text',\r\n    'igo.geo.dropGeoFile.invalid.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      mimeType: file.type\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleUnreadbleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.unreadable.text',\r\n    'igo.geo.dropGeoFile.unreadable.title',\r\n    undefined,\r\n    { value: file.name }\r\n  );\r\n}\r\n\r\nexport function handleSizeFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  sizeMb: number\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.tooLarge.text',\r\n    'igo.geo.dropGeoFile.tooLarge.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      size: sizeMb\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleNothingToImportError(\r\n  file: File,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.empty.text',\r\n    'igo.geo.dropGeoFile.empty.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      mimeType: file.type\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleSRSImportError(\r\n  file: File,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.invalidSRS.text',\r\n    'igo.geo.dropGeoFile.invalidSRS.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      mimeType: file.type\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleOgreServerImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.geo.dropGeoFile.ogreServer.text',\r\n    'igo.geo.dropGeoFile.ogreServer.title'\r\n  );\r\n}\r\n\r\nexport function getFileExtension(file: File): string {\r\n  return file.name.split('.').pop().toLowerCase();\r\n}\r\n\r\nexport function computeLayerTitleFromFile(file: File): string {\r\n  return file.name.substr(0, file.name.lastIndexOf('.'));\r\n}\r\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n    super('Failed to read file');\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n    super('Nothing to import');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n    super('File is too large');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n    super('Invalid SRS definition');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n    super('Error 500 with OGRE');\n    Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport * as olformat from 'ol/format';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport {\r\n  ImportInvalidFileError,\r\n  ImportOgreServerError,\r\n  ImportSRSError,\r\n  ImportSizeError,\r\n  ImportUnreadableFileError\r\n} from './import.errors';\r\nimport { ImportExportServiceOptions } from './import.interface';\r\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ImportService {\r\n  static formatExtensionAssociation = {\r\n    GeoJSON: 'geojson',\r\n    GML: 'gml',\r\n    GPX: 'gpx',\r\n    KML: 'kml',\r\n    Shapefile: 'zip'\r\n  };\r\n\r\n  static allowedMimeTypes = [\r\n    'application/gml+xml',\r\n    'application/vnd.google-earth.kml+xml',\r\n    'application/gpx+xml',\r\n    'application/json'\r\n  ];\r\n\r\n  static allowedZipMimeTypes = [\r\n    'application/zip',\r\n    'application/x-zip-compressed',\r\n    'application/x-zip'\r\n  ];\r\n\r\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml', 'zip'];\r\n\r\n  private ogreUrl: string;\r\n  private clientSideFileSizeMax: number;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService\r\n  ) {\r\n    const importConfig = this.config.getConfig(\r\n      'importExport'\r\n    ) as ImportExportServiceOptions;\r\n    this.ogreUrl = importConfig.url;\r\n    const configFileSizeMb = importConfig.clientSideFileSizeMaxMb;\r\n    this.clientSideFileSizeMax =\r\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\r\n    if (importConfig.formats) {\r\n      ImportService.allowedExtensions = importConfig.formats\r\n        .map((format) => ImportService.formatExtensionAssociation[format])\r\n        .filter((e) => e);\r\n      if (ImportService.allowedExtensions.includes('geojson')) {\r\n        ImportService.allowedExtensions.push('json');\r\n      }\r\n    }\r\n  }\r\n\r\n  import(\r\n    file: File,\r\n    projectionIn = 'EPSG:4326',\r\n    projectionOut = 'EPSG:4326'\r\n  ): Observable<Feature[]> {\r\n    return this.importAsync(file, projectionIn, projectionOut);\r\n  }\r\n\r\n  private getFileImporter(\r\n    file: File\r\n  ): (\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) => void {\r\n    const extension = getFileExtension(file);\r\n    const allowedExtensions = ImportService.allowedExtensions;\r\n    let zipMimeTypes = [];\r\n    if (allowedExtensions.includes('zip')) {\r\n      zipMimeTypes = ImportService.allowedZipMimeTypes;\r\n    }\r\n    const mimeType = file.type;\r\n    const allowedMimeTypes = [\r\n      ...ImportService.allowedMimeTypes,\r\n      ...zipMimeTypes\r\n    ];\r\n\r\n    if (\r\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\r\n      allowedExtensions.indexOf(extension) < 0\r\n    ) {\r\n      return undefined;\r\n    } else if (\r\n      mimeType === 'application/json' ||\r\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\r\n    ) {\r\n      return this.importFile;\r\n    } else if (this.ogreUrl !== undefined) {\r\n      return this.importFileWithOgre;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  private importAsync(\r\n    file: File,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Observable<Feature[]> {\r\n    const doImport = (observer: Observer<Feature[]>) => {\r\n      if (file.size >= this.clientSideFileSizeMax) {\r\n        observer.error(new ImportSizeError());\r\n        return;\r\n      }\r\n      const importer = this.getFileImporter(file);\r\n      if (importer === undefined) {\r\n        observer.error(new ImportInvalidFileError());\r\n        return;\r\n      }\r\n\r\n      importer.call(this, file, observer, projectionIn, projectionOut);\r\n    };\r\n\r\n    return new Observable(doImport);\r\n  }\r\n\r\n  private importFile(\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = (event: any) => {\r\n      try {\r\n        const features = this.parseFeaturesFromFile(\r\n          file,\r\n          event.target.result,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n        observer.next(features);\r\n      } catch (e) {\r\n        observer.error(new ImportUnreadableFileError());\r\n      }\r\n\r\n      observer.complete();\r\n    };\r\n\r\n    reader.onerror = (evt) => {\r\n      observer.error(new ImportUnreadableFileError());\r\n    };\r\n\r\n    reader.readAsText(file, 'UTF-8');\r\n  }\r\n\r\n  private importFileWithOgre(\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const url = `${this.ogreUrl}/convert`;\r\n    const formData = new FormData();\r\n    formData.append('upload', file);\r\n    formData.append('sourceSrs', projectionIn);\r\n    formData.append('targetSrs', projectionOut);\r\n    formData.append('formatOutput', 'GEOJSON');\r\n    formData.append('skipFailures', '');\r\n\r\n    this.http.post(url, formData, { headers: new HttpHeaders() }).subscribe(\r\n      (response: { errors?: string[] } | object | null) => {\r\n        if (response === null) {\r\n          observer.error(new ImportUnreadableFileError());\r\n          return;\r\n        }\r\n\r\n        const errors = (response as any).errors || [];\r\n        if (errors.length > 0) {\r\n          observer.error(new ImportUnreadableFileError());\r\n        } else {\r\n          const features = this.parseFeaturesFromGeoJSON(\r\n            file,\r\n            response,\r\n            projectionOut\r\n          );\r\n          observer.next(features);\r\n          observer.complete();\r\n        }\r\n      },\r\n      (error: any) => {\r\n        error.error.caught = true;\r\n        const errMsg = error.error.msg || '';\r\n        if (errMsg === 'No valid files found') {\r\n          observer.error(new ImportInvalidFileError());\r\n        } else if (\r\n          errMsg &&\r\n          errMsg.startWith('ERROR 1: Failed to process SRS definition')\r\n        ) {\r\n          observer.error(new ImportSRSError());\r\n        } else if (error.status === 500) {\r\n          observer.error(new ImportOgreServerError());\r\n        } else {\r\n          observer.error(new ImportUnreadableFileError());\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  private parseFeaturesFromFile(\r\n    file: File,\r\n    data: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Feature[] {\r\n    const extension = getFileExtension(file);\r\n    const mimeType = file.type;\r\n\r\n    const GeoJSON = new olformat.GeoJSON();\r\n\r\n    let format;\r\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\r\n      format = new olformat.KML();\r\n    } else if (mimeType === 'application/gml+xml') {\r\n      format = new olformat.GML();\r\n    } else if (mimeType === 'application/gpx+xml') {\r\n      format = new olformat.GPX();\r\n    } else {\r\n      switch (extension) {\r\n        case 'kml':\r\n          format = new olformat.KML();\r\n          break;\r\n        case 'gpx':\r\n          format = new olformat.GPX();\r\n          break;\r\n        case 'gml':\r\n          format = new olformat.GML();\r\n          break;\r\n        default:\r\n          format = GeoJSON;\r\n          break;\r\n      }\r\n    }\r\n\r\n    const olFeatures = format.readFeatures(data, {\r\n      dataProjection: projectionIn,\r\n      featureProjection: projectionOut\r\n    });\r\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\r\n        projection: projectionOut,\r\n        meta: {\r\n          id: uuid(),\r\n          title: computeLayerTitleFromFile(file)\r\n        }\r\n      });\r\n    });\r\n\r\n    return features;\r\n  }\r\n\r\n  private parseFeaturesFromGeoJSON(\r\n    file: File,\r\n    data: object,\r\n    projectionOut: string\r\n  ): Feature[] {\r\n    const olFormat = new olformat.GeoJSON();\r\n    const olFeatures = olFormat.readFeatures(data);\r\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\r\n        projection: projectionOut,\r\n        meta: {\r\n          id: uuid(),\r\n          title: computeLayerTitleFromFile(file)\r\n        }\r\n      });\r\n    });\r\n\r\n    return features as Feature[];\r\n  }\r\n}\r\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum([\n  'URL',\n  'GeoJSON',\n  'GML',\n  'GPX',\n  'KML',\n  'Shapefile',\n  'CSVcomma',\n  'CSVsemicolon'\n]);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport * as olformat from 'ol/format';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\nimport { encode } from 'windows-1252';\r\n\r\nimport {\r\n  ExportInvalidFileError,\r\n  ExportNothingToExportError\r\n} from './export.errors';\r\nimport { EncodingFormat, ExportFormat } from './export.type';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ExportService {\r\n  static ogreFormats = {\r\n    GML: 'gml',\r\n    GPX: 'gpx',\r\n    KML: 'kml',\r\n    Shapefile: 'ESRI Shapefile',\r\n    CSVcomma: 'CSVcomma',\r\n    CSVsemicolon: 'CSVsemicolon'\r\n  };\r\n\r\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\r\n\r\n  private ogreUrl: string;\r\n  private aggregateInComment: boolean = true;\r\n\r\n  constructor(private config: ConfigService) {\r\n    this.ogreUrl = this.config.getConfig('importExport.url');\r\n    const gpxAggregateInComment = this.config.getConfig(\r\n      'importExport.gpxAggregateInComment'\r\n    );\r\n    if (gpxAggregateInComment !== undefined) {\r\n      this.aggregateInComment = gpxAggregateInComment;\r\n    }\r\n  }\r\n\r\n  export(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: ExportFormat,\r\n    title: string,\r\n    encoding: EncodingFormat,\r\n    projectionIn = 'EPSG:4326',\r\n    projectionOut = 'EPSG:4326'\r\n  ): Observable<void> {\r\n    const exportOlFeatures = this.generateFeature(\r\n      olFeatures,\r\n      format,\r\n      '_featureStore'\r\n    );\r\n\r\n    return this.exportAsync(\r\n      exportOlFeatures,\r\n      format,\r\n      title,\r\n      encoding,\r\n      projectionIn,\r\n      projectionOut\r\n    );\r\n  }\r\n\r\n  public generateFeature(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: ExportFormat,\r\n    excludePrefix: string = '_'\r\n  ): OlFeature<OlGeometry>[] {\r\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\r\n      return this.generateAggregatedFeature(olFeatures);\r\n    }\r\n\r\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      const keys = olFeature\r\n        .getKeys()\r\n        .filter((key: string) => !key.startsWith(excludePrefix));\r\n      const properties = keys.reduce(\r\n        (acc: object, key: string) => {\r\n          acc[key] = olFeature.get(key);\r\n          return acc;\r\n        },\r\n        { geometry: olFeature.getGeometry() }\r\n      );\r\n      return new OlFeature(properties);\r\n    });\r\n  }\r\n\r\n  private generateAggregatedFeature(\r\n    olFeatures: OlFeature<OlGeometry>[]\r\n  ): OlFeature<OlGeometry>[] {\r\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\r\n      const keys = olFeature\r\n        .getKeys()\r\n        .filter((key: string) => !key.startsWith('_'));\r\n      let comment: string = '';\r\n      const properties = keys.reduce(\r\n        (acc: object, key: string) => {\r\n          if (key && key !== 'geometry') {\r\n            key === 'id' && olFeature.get('draw')\r\n              ? (comment += key + ':' + olFeature.get('draw') + '   \\r\\n')\r\n              : (comment += key + ':' + olFeature.get(key) + '   \\r\\n');\r\n          }\r\n          acc[key] = olFeature.get(key);\r\n          return acc;\r\n        },\r\n        {\r\n          geometry: olFeature.getGeometry()\r\n        }\r\n      );\r\n      const newFeature = new OlFeature(properties);\r\n      newFeature.set('name', olFeature.getId());\r\n      newFeature.set('cmt', comment);\r\n\r\n      return newFeature;\r\n    });\r\n  }\r\n\r\n  private exportAsync(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: ExportFormat,\r\n    title: string,\r\n    encoding: EncodingFormat,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Observable<void> {\r\n    const doExport = (observer: Observer<void>) => {\r\n      const nothingToExport = this.nothingToExport(olFeatures, format);\r\n      if (nothingToExport) {\r\n        observer.error(new ExportNothingToExportError());\r\n        return;\r\n      }\r\n\r\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n      if (ogreFormats.indexOf(format) >= 0) {\r\n        if (!this.ogreUrl) {\r\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\r\n            this.exportToFile(\r\n              olFeatures,\r\n              observer,\r\n              format,\r\n              title,\r\n              projectionIn,\r\n              projectionOut\r\n            );\r\n          } else {\r\n            observer.error(new ExportInvalidFileError());\r\n          }\r\n          return;\r\n        }\r\n        this.exportWithOgre(\r\n          olFeatures,\r\n          observer,\r\n          format,\r\n          title,\r\n          encoding,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n      } else {\r\n        this.exportToFile(\r\n          olFeatures,\r\n          observer,\r\n          format,\r\n          title,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n      }\r\n    };\r\n\r\n    return new Observable(doExport);\r\n  }\r\n\r\n  protected exportToFile(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    observer: Observer<void>,\r\n    format: ExportFormat,\r\n    title: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const olFormat = new olformat[format]();\r\n    const featuresText = olFormat.writeFeatures(olFeatures, {\r\n      dataProjection: projectionOut,\r\n      featureProjection: projectionIn,\r\n      featureType: 'feature',\r\n      featureNS: 'http://example.com/feature'\r\n    });\r\n\r\n    const fileName = `${title}.${format.toLowerCase()}`;\r\n\r\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\r\n    observer.complete();\r\n  }\r\n\r\n  private exportWithOgre(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    observer: Observer<void>,\r\n    format: string,\r\n    title: string,\r\n    encodingType: EncodingFormat,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    let featuresText: string = new olformat.GeoJSON().writeFeatures(\r\n      olFeatures,\r\n      {\r\n        dataProjection: projectionOut,\r\n        featureProjection: projectionIn\r\n      }\r\n    );\r\n\r\n    const url = `${this.ogreUrl}/convertJson`;\r\n    const form = document.createElement('form');\r\n    form.style.display = 'none';\r\n    document.body.appendChild(form);\r\n    form.setAttribute('method', 'post');\r\n    form.setAttribute('target', '_blank');\r\n    form.setAttribute('action', url);\r\n\r\n    if (encodingType === EncodingFormat.UTF8) {\r\n      form.acceptCharset = 'UTF-8';\r\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\r\n    } else if (encodingType === EncodingFormat.LATIN1) {\r\n      const enctype = 'ISO-8859-1';\r\n      const featuresJson = JSON.parse(featuresText);\r\n      featuresJson.features.map((f) => {\r\n        const encodedProperties = String.fromCharCode.apply(\r\n          null,\r\n          encode(JSON.stringify(f.properties), { mode: 'replacement' })\r\n        );\r\n        f.properties = JSON.parse(encodedProperties);\r\n      });\r\n      featuresText = JSON.stringify(featuresJson);\r\n      const encoding = document.createElement('input');\r\n      encoding.setAttribute('type', 'hidden');\r\n      encoding.setAttribute('name', 'encoding');\r\n      encoding.setAttribute('value', enctype);\r\n      form.appendChild(encoding);\r\n    }\r\n\r\n    if (format === 'CSVsemicolon') {\r\n      const options = document.createElement('input');\r\n      options.setAttribute('type', 'hidden');\r\n      options.setAttribute('name', 'lco');\r\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\r\n      form.appendChild(options);\r\n    }\r\n\r\n    const geojsonField = document.createElement('input');\r\n    geojsonField.setAttribute('type', 'hidden');\r\n    geojsonField.setAttribute('name', 'json');\r\n    geojsonField.setAttribute('value', featuresText);\r\n    form.appendChild(geojsonField);\r\n\r\n    const outputNameField = document.createElement('input');\r\n    let outputName =\r\n      format === 'Shapefile'\r\n        ? `${title}.zip`\r\n        : `${title}.${format.toLowerCase()}`;\r\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\r\n      outputName = `${title}.csv`;\r\n    }\r\n    outputName = outputName.replace(' ', '_');\r\n    outputName = outputName\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(//g, \"'\");\r\n    outputNameField.setAttribute('type', 'hidden');\r\n    outputNameField.setAttribute('name', 'outputName');\r\n    outputNameField.setAttribute('value', outputName);\r\n    form.appendChild(outputNameField);\r\n\r\n    let ogreFormat = ExportService.ogreFormats[format];\r\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\r\n      ogreFormat = 'CSV';\r\n    }\r\n    const outputFormatField = document.createElement('input');\r\n    outputFormatField.setAttribute('type', 'hidden');\r\n    outputFormatField.setAttribute('name', 'format');\r\n    outputFormatField.setAttribute('value', ogreFormat);\r\n    form.appendChild(outputFormatField);\r\n\r\n    form.submit();\r\n    document.body.removeChild(form);\r\n\r\n    observer.complete();\r\n  }\r\n\r\n  private nothingToExport(\r\n    olFeatures: OlFeature<OlGeometry>[],\r\n    format: string\r\n  ): boolean {\r\n    if (olFeatures.length === 0) {\r\n      return true;\r\n    }\r\n    if (format === 'GPX') {\r\n      const pointOrLine = olFeatures.find((olFeature) => {\r\n        return (\r\n          ['Point', 'LineString', 'MultiLineString'].indexOf(\r\n            olFeature.getGeometry().getType()\r\n          ) >= 0\r\n        );\r\n      });\r\n      return pointOrLine === undefined;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-custom-html',\n  templateUrl: './custom-html.component.html',\n  styleUrls: ['./custom-html.component.scss']\n})\nexport class CustomHtmlComponent {\n  @Input()\n  get html(): string {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = value;\n  }\n  private _html = '';\n\n  constructor() {}\n}\n","<div class=\"custom-html\" [innerHTML]=\"html | sanitizeHtml\"></div>\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n    [value]=\"selectedMode\"\n    (change)=\"onImportExportChange($event)\"\n  >\n    <mat-button-toggle [value]=\"'import'\">\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"'export'\">\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form\n  class=\"igo-form\"\n  [formGroup]=\"importForm\"\n  *ngIf=\"selectedMode === 'import'\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.importProjPlaceholder' | translate\n      }}</mat-label>\n      <mat-select [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of projections$ | async\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\"\n        >\n          <p matListItemTitle *ngIf=\"projection.translateKey\">\n            {{\n              'igo.geo.importExportForm.projections.' + projection.translateKey\n                | translate: projection\n            }}\n          </p>\n          <p matListItemTitle *ngIf=\"!projection.translateKey\">\n            {{ projection.alias }}\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      importForm.invalid\n        ? ('igo.geo.importExportForm.projections.choose' | translate)\n        : ('igo.geo.importExportForm.importButton' | translate)\n    \"\n    class=\"igo-form-button-group\"\n  >\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\"\n    >\n      {{ 'igo.geo.importExportForm.importButton' | translate }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($event.target.files)\"\n    />\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <div *ngIf=\"importHtmlClarifications === ''\">\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\n    <ul>\n      <li>\n        {{\n          'igo.geo.importExportForm.importSizeMax'\n            | translate: { size: fileSizeMb }\n        }}\n      </li>\n      <li>\n        {{ 'igo.geo.importExportForm.importFormatAuthorized' | translate }}\n      </li>\n      <li>{{ 'igo.geo.importExportForm.importShpZip' | translate }}</li>\n    </ul>\n  </div>\n  <igo-custom-html\n    *ngIf=\"importHtmlClarifications !== ''\"\n    class=\"mat-typography\"\n    [html]=\"importHtmlClarifications\"\n  >\n  </igo-custom-html>\n</section>\n\n<section\n  class=\"mat-typography\"\n  *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\"\n>\n  <h4>{{ 'igo.geo.importExportForm.exportNoLayersExportable' | translate }}</h4>\n</section>\n\n<form\n  class=\"igo-form\"\n  [formGroup]=\"form\"\n  *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.exportLayerPlaceholder' | translate\n      }}</mat-label>\n      <mat-select [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{ layers.length ? getLayerTitleById(layers[0]) : '' }}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{ layers.length - 1 }}\n            {{\n              (layers?.length === 2\n                ? 'igo.geo.importExportForm.other'\n                : 'igo.geo.importExportForm.others'\n              ) | translate\n            }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of exportableLayers$ | async\"\n          [ngClass]=\"{\n            'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)\n          }\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\"\n        >\n          <p matListItemTitle>{{ layer.title }}</p>\n          <p matListItemTitle>\n            <mat-slide-toggle\n              *ngIf=\"layerHasSelectedFeatures(layer)\"\n              (click)=\"onlySelectedClick($event, layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event, layer.id)\"\n            >\n              <small>{{\n                'igo.geo.importExportForm.exportSelectedFeature' | translate\n              }}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.exportFormatPlaceholder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option\n            *ngFor=\"let format of formats$ | async | keyvalue\"\n            [value]=\"format.key\"\n          >\n            {{ 'igo.geo.export.format.' + format.value | translate }}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{ 'igo.geo.export.noFormat.title' | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    *ngIf=\"forceNaming && form.value.format !== 'URL'\"\n  >\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"name\"\n        placeholder=\"{{\n          'igo.geo.importExportForm.exportFileNamePlaceholder' | translate\n        }}\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    *ngIf=\"\n      form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\n    \"\n  >\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.encodingPlaceholder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option\n            *ngFor=\"let encoding of encodings$ | async | keyvalue\"\n            [value]=\"encoding.key\"\n          >\n            {{ 'igo.geo.export.encoding.' + encoding.value | translate }}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"export-combine-layers mat-typography\"\n    *ngIf=\"\n      layers.length > 1 &&\n      (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\n    \"\n  >\n    <mat-slide-toggle\n      formControlName=\"combineLayers\"\n      [labelPosition]=\"'before'\"\n    >\n      {{ 'igo.geo.importExportForm.exportCombineResults' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div\n    class=\"export-separator mat-typography\"\n    *ngIf=\"\n      layers.length > 1 &&\n      (form.value.format === 'CSVcomma' ||\n        form.value.format === 'CSVsemicolon') &&\n      form.value.combineLayers\n    \"\n  >\n    <mat-slide-toggle formControlName=\"separator\" [labelPosition]=\"'before'\">\n      {{ 'igo.geo.importExportForm.exportSeparator' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div\n    class=\"export-options mat-typography\"\n    *ngIf=\"form.value.format !== 'URL'\"\n  >\n    <mat-slide-toggle\n      formControlName=\"featureInMapExtent\"\n      [labelPosition]=\"'before'\"\n    >\n      {{ 'igo.geo.importExportForm.exportFeatureInExtent' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\"\n    >\n      {{\n        form.value.format !== 'URL'\n          ? ('igo.geo.importExportForm.exportButton' | translate)\n          : form.value.layers.length > 1\n          ? ('igo.geo.importExportForm.exportButtonLinks' | translate)\n          : ('igo.geo.importExportForm.exportButtonLink' | translate)\n      }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n  <igo-custom-html\n    *ngIf=\"exportHtmlClarifications !== ''\"\n    class=\"mat-typography\"\n    [html]=\"exportHtmlClarifications\"\n  >\n  </igo-custom-html>\n</form>\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\r\n\r\nimport { ConfirmDialogService, EntityRecord, Workspace } from '@igo2/common';\r\nimport type { WorkspaceStore } from '@igo2/common';\r\nimport {\r\n  ConfigService,\r\n  LanguageService,\r\n  MessageService,\r\n  StorageService\r\n} from '@igo2/core';\r\nimport { strEnum } from '@igo2/utils';\r\n\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olPoint from 'ol/geom/Point';\r\nimport { circular } from 'ol/geom/Polygon';\r\nimport olClusterSource from 'ol/source/Cluster';\r\nimport olVectorSource from 'ol/source/Vector';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { DownloadService } from '../../download/shared/download.service';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\r\nimport { computeProjectionsConstraints } from '../../map/shared';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { StyleListService } from '../../style/style-list/style-list.service';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\r\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\r\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\r\nimport { ExportOptions } from '../shared/export.interface';\r\nimport { ExportService } from '../shared/export.service';\r\nimport { EncodingFormat, ExportFormat } from '../shared/export.type';\r\nimport {\r\n  handleFileExportError,\r\n  handleFileExportSuccess\r\n} from '../shared/export.utils';\r\nimport { ImportExportServiceOptions } from '../shared/import.interface';\r\nimport { ImportService } from '../shared/import.service';\r\nimport {\r\n  handleFileImportError,\r\n  handleFileImportSuccess\r\n} from '../shared/import.utils';\r\n\r\n@Component({\r\n  selector: 'igo-import-export',\r\n  templateUrl: './import-export.component.html',\r\n  styleUrls: ['./import-export.component.scss']\r\n})\r\nexport class ImportExportComponent implements OnDestroy, OnInit {\r\n  public form: UntypedFormGroup;\r\n  public importForm: UntypedFormGroup;\r\n  public formats$ = new BehaviorSubject(undefined);\r\n  public encodings$ = new BehaviorSubject(undefined);\r\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\r\n    []\r\n  );\r\n  public loading$ = new BehaviorSubject(false);\r\n  public forceNaming = false;\r\n  public controlFormat = 'format';\r\n\r\n  private layers$$: Subscription;\r\n  private exportableLayers$$: Subscription;\r\n  private formats$$: Subscription;\r\n  private encodings$$: Subscription;\r\n  private formLayer$$: Subscription;\r\n  private exportOptions$$: Subscription;\r\n\r\n  public importHtmlClarifications: string;\r\n  public exportHtmlClarifications: string;\r\n\r\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\r\n  private clientSideFileSizeMax: number;\r\n  public fileSizeMb: number;\r\n\r\n  public projections$: BehaviorSubject<InputProjections[]> =\r\n    new BehaviorSubject([]);\r\n  private projectionsConstraints: ProjectionsLimitationsOptions;\r\n\r\n  public popupChecked: boolean = false;\r\n\r\n  private previousLayerSpecs$: BehaviorSubject<\r\n    {\r\n      id: string;\r\n      visible: boolean;\r\n      opacity: number;\r\n      queryable: boolean;\r\n    }[]\r\n  > = new BehaviorSubject(undefined);\r\n\r\n  @Input() selectFirstProj: boolean = false;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() contextUri: string;\r\n\r\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\r\n  @Input()\r\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\r\n    this._projectionsLimitations = value;\r\n    this.computeProjections();\r\n  }\r\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\r\n    return this._projectionsLimitations || {};\r\n  }\r\n\r\n  /**\r\n   * Store that holds the available workspaces.\r\n   */\r\n  @Input() store: WorkspaceStore;\r\n\r\n  @Input() selectedMode = 'import';\r\n\r\n  @Output() selectMode = new EventEmitter<string>();\r\n\r\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\r\n\r\n  get layers() {\r\n    return this.form.get('layers').value;\r\n  }\r\n  set layers(value) {\r\n    this.form.patchValue({ layers: value });\r\n  }\r\n\r\n  get inputProj() {\r\n    return this.importForm.get('inputProj').value;\r\n  }\r\n  set inputProj(value) {\r\n    this.importForm.patchValue({ inputProj: value });\r\n  }\r\n\r\n  get popupAllowed(): boolean {\r\n    return (\r\n      (this.storageService.get('importExportPopupAllowed') as boolean) || false\r\n    );\r\n  }\r\n\r\n  set popupAllowed(value: boolean) {\r\n    this.storageService.set('importExportPopupAllowed', value);\r\n  }\r\n\r\n  constructor(\r\n    private importService: ImportService,\r\n    private exportService: ExportService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private styleListService: StyleListService,\r\n    private styleService: StyleService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private config: ConfigService,\r\n    private cdRef: ChangeDetectorRef,\r\n    private storageService: StorageService,\r\n    private downloadService: DownloadService,\r\n    private layerService: LayerService,\r\n    private confirmDialogService: ConfirmDialogService\r\n  ) {\r\n    this.loadConfig();\r\n    this.buildForm();\r\n    this.computeProjections();\r\n    this.importHtmlClarifications = this.languageService.translate.instant(\r\n      'igo.geo.importExportForm.importHtmlClarifications'\r\n    );\r\n    this.exportHtmlClarifications = this.languageService.translate.instant(\r\n      'igo.geo.importExportForm.exportHtmlClarifications'\r\n    );\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\r\n      this.exportableLayers$.next(\r\n        layers.filter((layer: Layer) => {\r\n          return (\r\n            (layer instanceof VectorLayer && layer.exportable === true) ||\r\n            (layer.dataSource.options.download &&\r\n              layer.dataSource.options.download.url)\r\n          );\r\n        }) as AnyLayer[]\r\n      );\r\n    });\r\n    const configFileSizeMb = this.config.getConfig(\r\n      'importExport.clientSideFileSizeMaxMb'\r\n    );\r\n    this.clientSideFileSizeMax =\r\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\r\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\r\n\r\n    this.exportOptions$$ = this.exportOptions$\r\n      .pipe(skipWhile((exportOptions) => !exportOptions))\r\n      .subscribe((exportOptions) => {\r\n        this.form.patchValue(exportOptions, { emitEvent: true });\r\n        if (exportOptions.layers) {\r\n          this.computeFormats(\r\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\r\n          );\r\n        }\r\n      });\r\n    this.formLayer$$ = this.form\r\n      .get('format')\r\n      .valueChanges.subscribe((format) => {\r\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n        if (\r\n          !this.popupChecked &&\r\n          this.form.get('layers').value?.length > 1 &&\r\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)\r\n        ) {\r\n          if (!this.handlePopup(true)) {\r\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\r\n          }\r\n        }\r\n      });\r\n\r\n    this.formLayer$$ = this.form\r\n      .get('layers')\r\n      .valueChanges.subscribe((layersId) => {\r\n        this.handlePreviousLayerSpecs();\r\n        const selectedLayers =\r\n          layersId instanceof Array ? layersId : [layersId];\r\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\r\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\r\n        this.computeFormats(layers);\r\n\r\n        if (\r\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\r\n          -1\r\n        ) {\r\n          this.form.patchValue({ format: undefined });\r\n        }\r\n\r\n        this.loading$.next(true);\r\n        const previousSpecs: {\r\n          id: string;\r\n          visible: boolean;\r\n          opacity: number;\r\n          queryable: boolean;\r\n        }[] = [];\r\n        layers.forEach((layer) => {\r\n          if (\r\n            layer instanceof VectorLayer &&\r\n            layer.dataSource.ol.getFeatures().length === 0\r\n          ) {\r\n            previousSpecs.push({\r\n              id: layer.id,\r\n              visible: layer.visible,\r\n              opacity: layer.opacity,\r\n              queryable: (layer as any).queryable\r\n            });\r\n            layer.opacity = 0;\r\n            layer.visible = true;\r\n          }\r\n        });\r\n\r\n        this.previousLayerSpecs$.next(previousSpecs);\r\n        setTimeout(() => {\r\n          this.loading$.next(false);\r\n        }, 500);\r\n      });\r\n\r\n    this.formats$$ = this.formats$\r\n      .pipe(skipWhile((formats) => !formats))\r\n      .subscribe((formats) => {\r\n        if (Object.keys(formats).length === 1) {\r\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\r\n        }\r\n      });\r\n\r\n    this.encodings$$ = this.encodings$\r\n      .pipe(skipWhile((encodings) => !encodings))\r\n      .subscribe((encodings) => {\r\n        if (Object.keys(encodings).length === 1) {\r\n          this.form.patchValue({\r\n            encoding: encodings[Object.keys(encodings)[0]]\r\n          });\r\n        }\r\n      });\r\n\r\n    this.exportableLayers$$ = this.exportableLayers$\r\n      .pipe(skipWhile((layers) => !layers))\r\n      .subscribe((layers) => {\r\n        if (layers.length === 1) {\r\n          this.form.patchValue({ layers: layers[0].id });\r\n        }\r\n      });\r\n\r\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\r\n      if (\r\n        format === ExportFormat.CSVcomma ||\r\n        format === ExportFormat.CSVsemicolon\r\n      ) {\r\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\r\n      } else {\r\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\r\n      }\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    if (this.selectFirstProj) {\r\n      if (this.projections$.value.length === 0) {\r\n        this.importForm.patchValue({\r\n          inputProj: {\r\n            translateKey: 'nad83',\r\n            alias: 'NAD83',\r\n            code: 'EPSG:4326',\r\n            zone: ''\r\n          }\r\n        });\r\n      } else {\r\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\r\n      }\r\n    } else {\r\n      this.importForm.patchValue({ inputProj: undefined });\r\n    }\r\n  }\r\n\r\n  private computeProjections() {\r\n    this.projectionsConstraints = computeProjectionsConstraints(\r\n      this.projectionsLimitations\r\n    );\r\n    const projections: InputProjections[] = [];\r\n\r\n    if (this.projectionsConstraints.nad83) {\r\n      projections.push({\r\n        translateKey: 'nad83',\r\n        alias: 'NAD83',\r\n        code: 'EPSG:4269',\r\n        zone: '',\r\n        extent: undefined,\r\n        def: undefined\r\n      });\r\n    }\r\n    if (this.projectionsConstraints.wgs84) {\r\n      projections.push({\r\n        translateKey: 'wgs84',\r\n        alias: 'WGS84',\r\n        code: 'EPSG:4326',\r\n        zone: '',\r\n        extent: undefined,\r\n        def: undefined\r\n      });\r\n    }\r\n    if (this.projectionsConstraints.webMercator) {\r\n      projections.push({\r\n        translateKey: 'webMercator',\r\n        alias: 'Web Mercator',\r\n        code: 'EPSG:3857',\r\n        zone: '',\r\n        extent: undefined,\r\n        def: undefined\r\n      });\r\n    }\r\n\r\n    if (this.projectionsConstraints.mtm) {\r\n      // all mtm zones\r\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\r\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\r\n\r\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\r\n        const code =\r\n          mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n        projections.push({\r\n          translateKey: 'mtm',\r\n          alias: `MTM ${mtmZone}`,\r\n          code,\r\n          zone: `${mtmZone}`,\r\n          extent: undefined,\r\n          def: undefined\r\n        });\r\n      }\r\n    }\r\n\r\n    if (this.projectionsConstraints.utm) {\r\n      // all utm zones\r\n      const minZone = this.projectionsConstraints.utmZone.minZone;\r\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\r\n\r\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\r\n        const code =\r\n          utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n        projections.push({\r\n          translateKey: 'utm',\r\n          alias: `UTM ${utmZone}`,\r\n          code,\r\n          zone: `${utmZone}`,\r\n          extent: undefined,\r\n          def: undefined\r\n        });\r\n      }\r\n    }\r\n\r\n    let configProjection: InputProjections[] = [];\r\n    if (this.projectionsConstraints.projFromConfig) {\r\n      configProjection = (this.config.getConfig('projections') ||\r\n        []) as InputProjections[];\r\n    }\r\n\r\n    this.projections$.next(configProjection.concat(projections));\r\n  }\r\n\r\n  private getWorkspaceByLayerId(id: string): Workspace {\r\n    const wksFromLayerId = this.store\r\n      .all()\r\n      .find(\r\n        (workspace) =>\r\n          (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace)\r\n            .layer.id === id\r\n      );\r\n    if (wksFromLayerId) {\r\n      return wksFromLayerId;\r\n    }\r\n    return;\r\n  }\r\n\r\n  public getLayerTitleById(id): string {\r\n    return this.map.getLayerById(id)?.title;\r\n  }\r\n\r\n  layerHasSelectedFeatures(layer: Layer): boolean {\r\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\r\n    if (wksFromLayer) {\r\n      const recs = wksFromLayer.entityStore.stateView.firstBy(\r\n        (record: EntityRecord<Feature>) => {\r\n          return record.state.selected === true;\r\n        }\r\n      );\r\n      return recs ? true : false;\r\n    }\r\n  }\r\n\r\n  public onlySelected(event: MatSlideToggleChange, id: string) {\r\n    let layersWithSelection = this.form.value.layersWithSelection;\r\n    if (event.checked) {\r\n      layersWithSelection.push(id);\r\n    } else {\r\n      layersWithSelection = layersWithSelection.filter(\r\n        (layerId) => layerId !== id\r\n      );\r\n    }\r\n    this.form.patchValue({ layersWithSelection });\r\n  }\r\n\r\n  public onlySelectedClick(event, id: string) {\r\n    if (this.form.value.layers.find((layerId) => layerId === id)) {\r\n      event.stopPropagation();\r\n    }\r\n  }\r\n\r\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\r\n    return this.form.value.layersWithSelection.find(\r\n      (layerId) => layerId === layer.id\r\n    )\r\n      ? true\r\n      : false;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n    this.exportableLayers$$.unsubscribe();\r\n    this.formats$$.unsubscribe();\r\n    this.encodings$$.unsubscribe();\r\n    this.formLayer$$.unsubscribe();\r\n    if (this.exportOptions$$) {\r\n      this.exportOptions$$.unsubscribe();\r\n    }\r\n    this.exportOptionsChange.emit(this.form.value);\r\n    this.handlePreviousLayerSpecs();\r\n  }\r\n\r\n  private handlePreviousLayerSpecs() {\r\n    const previousSpecs = this.previousLayerSpecs$.value;\r\n    if (previousSpecs && previousSpecs.length) {\r\n      previousSpecs.forEach((specs) => {\r\n        const previousLayer = this.map.getLayerById(specs.id);\r\n        previousLayer.visible = specs.visible;\r\n        previousLayer.opacity = specs.opacity;\r\n        (previousLayer as any).queryable = specs.queryable;\r\n      });\r\n    }\r\n    this.previousLayerSpecs$.next(undefined);\r\n  }\r\n\r\n  importFiles(files: File[]) {\r\n    let inputProj = this.inputProj.code;\r\n    if (this.espgCodeRegex.test(inputProj)) {\r\n      inputProj = `EPSG:${inputProj}`;\r\n    }\r\n\r\n    this.loading$.next(true);\r\n    for (const file of files) {\r\n      this.importService.import(file, inputProj).subscribe(\r\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\r\n        (error: Error) => this.onFileImportError(file, error),\r\n        () => {\r\n          this.loading$.next(false);\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  handlePopup(preCheck: boolean = true): boolean {\r\n    const p1 = window.open('', 'popup', 'width=1, height=1');\r\n    p1.close();\r\n    const p2 = window.open('', 'popup', 'width=1, height=1');\r\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\r\n      this.onPopupBlockedError(preCheck);\r\n      this.popupAllowed = false;\r\n    } else {\r\n      p2.close();\r\n      this.popupAllowed = true;\r\n      this.popupChecked = true;\r\n    }\r\n    return this.popupAllowed;\r\n  }\r\n\r\n  handleExportFormSubmit(data: ExportOptions) {\r\n    this.loading$.next(true);\r\n\r\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n    if (\r\n      !this.popupChecked &&\r\n      data.layers.length > 1 &&\r\n      (ogreFormats.indexOf(data.format) >= 0 ||\r\n        data.format === ExportFormat.URL) &&\r\n      !this.popupAllowed\r\n    ) {\r\n      this.handlePopup();\r\n    }\r\n\r\n    let geomTypesCSV: { geometryType: string; features: any[] }[] = [];\r\n    let featuresCSV: any[] = [];\r\n    let filename: string = '';\r\n\r\n    for (const [layerIndex, layer] of data.layers.entries()) {\r\n      const lay = this.map.getLayerById(layer);\r\n      if (\r\n        !(\r\n          data.format === ExportFormat.CSVsemicolon ||\r\n          data.format === ExportFormat.CSVcomma\r\n        ) ||\r\n        !data.combineLayers ||\r\n        data.layers.length === 1\r\n      ) {\r\n        filename = lay.title;\r\n        if (data.name) {\r\n          filename = data.name;\r\n        }\r\n      } else {\r\n        filename = this.languageService.translate.instant(\r\n          'igo.geo.export.combinedLayers'\r\n        );\r\n      }\r\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\r\n      if (\r\n        data.format === ExportFormat.URL &&\r\n        dSOptions.download &&\r\n        (dSOptions.download.url || dSOptions.download.dynamicUrl)\r\n      ) {\r\n        setTimeout(() => {\r\n          // better look an feel\r\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\r\n          url.match(/service=wfs/gi)\r\n            ? this.downloadService.open(lay)\r\n            : window.open(url, '_blank');\r\n          this.loading$.next(false);\r\n        }, 500);\r\n        return;\r\n      }\r\n      const wks = this.getWorkspaceByLayerId(layer);\r\n      let olFeatures;\r\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\r\n        if (\r\n          data.layersWithSelection.indexOf(layer) !== -1 &&\r\n          data.featureInMapExtent\r\n        ) {\r\n          // Only export selected feature && into map extent\r\n          olFeatures = wks.entityStore.stateView\r\n            .all()\r\n            .filter(\r\n              (e: EntityRecord<object>) =>\r\n                e.state.inMapExtent && e.state.selected\r\n            )\r\n            .map((e) => (e.entity as Feature).ol);\r\n        } else if (\r\n          data.layersWithSelection.indexOf(layer) !== -1 &&\r\n          !data.featureInMapExtent\r\n        ) {\r\n          // Only export selected feature &&  (into map extent OR not)\r\n          olFeatures = wks.entityStore.stateView\r\n            .all()\r\n            .filter((e: EntityRecord<object>) => e.state.selected)\r\n            .map((e) => (e.entity as Feature).ol);\r\n        } else if (data.featureInMapExtent) {\r\n          // Only into map extent\r\n          olFeatures = wks.entityStore.stateView\r\n            .all()\r\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent)\r\n            .map((e) => (e.entity as Feature).ol);\r\n        } else {\r\n          // All features\r\n          olFeatures = wks.entityStore.stateView\r\n            .all()\r\n            .map((e) => (e.entity as Feature).ol);\r\n        }\r\n      } else {\r\n        const ol = lay.dataSource.ol as\r\n          | olVectorSource<OlGeometry>\r\n          | olClusterSource;\r\n        if (data.featureInMapExtent) {\r\n          olFeatures = ol.getFeaturesInExtent(\r\n            lay.map.viewController.getExtent()\r\n          );\r\n        } else {\r\n          olFeatures = ol.getFeatures();\r\n        }\r\n        if (lay.dataSource instanceof ClusterDataSource) {\r\n          olFeatures = olFeatures.flatMap((cluster: any) =>\r\n            cluster.get('features')\r\n          );\r\n        }\r\n      }\r\n\r\n      let geomTypes: { geometryType: string; features: any[] }[] = [];\r\n      if (\r\n        data.format === ExportFormat.Shapefile ||\r\n        data.format === ExportFormat.GPX\r\n      ) {\r\n        olFeatures.forEach((olFeature) => {\r\n          const featureGeomType = olFeature.getGeometry().getType();\r\n          const currentGeomType = geomTypes.find(\r\n            (geomType) => geomType.geometryType === featureGeomType\r\n          );\r\n          if (currentGeomType) {\r\n            currentGeomType.features.push(olFeature);\r\n          } else {\r\n            geomTypes.push({\r\n              geometryType: featureGeomType,\r\n              features: [olFeature]\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        geomTypes = [{ geometryType: '', features: olFeatures }];\r\n      }\r\n\r\n      geomTypes.forEach((geomType) => {\r\n        geomType.features.forEach((feature) => {\r\n          const radius: number = feature.get('rad');\r\n          if (radius) {\r\n            const center4326: Array<number> = [\r\n              feature.get('longitude'),\r\n              feature.get('latitude')\r\n            ];\r\n            const circle = circular(center4326, radius, 500);\r\n            circle.transform('EPSG:4326', feature.get('_projection'));\r\n            feature.setGeometry(circle);\r\n          }\r\n        });\r\n      });\r\n\r\n      if (data.format === ExportFormat.GPX) {\r\n        const gpxFeatureCnt = geomTypes.length;\r\n        geomTypes = geomTypes.filter((geomType) =>\r\n          ['LineString', 'Point'].includes(geomType.geometryType)\r\n        );\r\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\r\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\r\n          this.messageService.error(\r\n            'igo.geo.export.gpx.error.poly.text',\r\n            'igo.geo.export.gpx.error.poly.title',\r\n            { timeOut: 20000 }\r\n          );\r\n        }\r\n      } else if (\r\n        (data.format === ExportFormat.CSVsemicolon ||\r\n          data.format === ExportFormat.CSVcomma) &&\r\n        data.combineLayers\r\n      ) {\r\n        geomTypes.forEach((geomType) => geomTypesCSV.push(geomType));\r\n\r\n        if (layerIndex !== data.layers.length - 1) {\r\n          continue;\r\n        } else {\r\n          let previousFeature = undefined;\r\n          geomTypesCSV.forEach((geomType) => {\r\n            geomType.features.forEach((currentFeature) => {\r\n              if (data.separator) {\r\n                if (previousFeature) {\r\n                  if (\r\n                    currentFeature.get('_featureStore').layer.options.title !==\r\n                    previousFeature.get('_featureStore').layer.options.title\r\n                  ) {\r\n                    const titleEmptyRows = this.createTitleEmptyRows(\r\n                      previousFeature,\r\n                      currentFeature\r\n                    );\r\n                    featuresCSV.push(titleEmptyRows[2]);\r\n                    featuresCSV.push(titleEmptyRows[0]);\r\n                    featuresCSV.push(titleEmptyRows[1]);\r\n                  }\r\n                } else {\r\n                  const titleEmptyRows = this.createTitleEmptyRows(\r\n                    currentFeature,\r\n                    currentFeature\r\n                  );\r\n                  featuresCSV.push(titleEmptyRows[0]);\r\n                }\r\n              }\r\n              featuresCSV.push(currentFeature);\r\n              previousFeature = currentFeature;\r\n            });\r\n          });\r\n        }\r\n      }\r\n\r\n      if (geomTypes.length === 0) {\r\n        this.loading$.next(false);\r\n        this.messageService.error(\r\n          'igo.geo.export.nothing.text',\r\n          'igo.geo.export.nothing.title',\r\n          { timeOut: 20000 }\r\n        );\r\n      } else {\r\n        if (\r\n          !(\r\n            data.format === ExportFormat.CSVsemicolon ||\r\n            data.format === ExportFormat.CSVcomma\r\n          ) ||\r\n          !data.combineLayers\r\n        ) {\r\n          geomTypes.map((geomType) =>\r\n            this.exportService\r\n              .export(\r\n                geomType.features,\r\n                data.format,\r\n                filename + geomType.geometryType,\r\n                data.encoding,\r\n                this.map.projection\r\n              )\r\n              .subscribe(\r\n                () => {},\r\n                (error: Error) => this.onFileExportError(error),\r\n                () => {\r\n                  this.onFileExportSuccess();\r\n\r\n                  geomType.features.forEach((feature) => {\r\n                    this.circleToPoint(feature);\r\n                  });\r\n\r\n                  this.loading$.next(false);\r\n                }\r\n              )\r\n          );\r\n        }\r\n      }\r\n    }\r\n    if (\r\n      (data.format === ExportFormat.CSVsemicolon ||\r\n        data.format === ExportFormat.CSVcomma) &&\r\n      data.combineLayers\r\n    ) {\r\n      this.exportService\r\n        .export(\r\n          featuresCSV,\r\n          data.format,\r\n          filename,\r\n          data.encoding,\r\n          this.map.projection\r\n        )\r\n        .subscribe(\r\n          () => {},\r\n          (error: Error) => this.onFileExportError(error),\r\n          () => {\r\n            this.onFileExportSuccess();\r\n\r\n            featuresCSV.forEach((feature) => {\r\n              this.circleToPoint(feature);\r\n            });\r\n\r\n            this.loading$.next(false);\r\n          }\r\n        );\r\n    }\r\n  }\r\n\r\n  private createTitleEmptyRows(previousFeature, currentFeature) {\r\n    const titleRow = currentFeature.clone();\r\n    const headerRow = currentFeature.clone();\r\n    const emptyRow = currentFeature.clone();\r\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\r\n    let firstKeyPrevious: string = '';\r\n    for (const key in previousFeatureKeys) {\r\n      if (previousFeatureKeys[key] !== 'geometry') {\r\n        firstKeyPrevious = previousFeatureKeys[key];\r\n        break;\r\n      }\r\n    }\r\n\r\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\r\n    let firstKeyCurrent: string = '';\r\n    for (const key in currentFeatureKeys) {\r\n      if (currentFeatureKeys[key] !== 'geometry') {\r\n        firstKeyCurrent = currentFeatureKeys[key];\r\n        break;\r\n      }\r\n    }\r\n    const allKeys: Array<string> = currentFeature.getKeys();\r\n    previousFeatureKeys.forEach((previousKey) => {\r\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\r\n        allKeys.push(previousKey);\r\n      }\r\n    });\r\n    allKeys.unshift(firstKeyPrevious);\r\n\r\n    let firstKeyAll: string = '';\r\n    for (const key in allKeys) {\r\n      if (allKeys[key] !== 'geometry') {\r\n        firstKeyAll = allKeys[key];\r\n        break;\r\n      }\r\n    }\r\n    allKeys.forEach((key) => {\r\n      const sameKeys: boolean =\r\n        previousFeatureKeys.length === currentFeatureKeys.length &&\r\n        previousFeatureKeys.every(\r\n          (value, index) => value === currentFeatureKeys[index]\r\n        );\r\n      if (key === firstKeyAll && !sameKeys) {\r\n        titleRow.set(\r\n          key,\r\n          currentFeature.get('_featureStore').layer.options.title +\r\n            ' ===============>',\r\n          true\r\n        );\r\n        headerRow.set(key, key, true);\r\n        emptyRow.unset(key, true);\r\n      } else if (key === firstKeyAll && sameKeys) {\r\n        titleRow.set(\r\n          key,\r\n          currentFeature.get('_featureStore').layer.options.title,\r\n          true\r\n        );\r\n        headerRow.set(key, key, true);\r\n        emptyRow.unset(key, true);\r\n      } else if (key === firstKeyCurrent) {\r\n        titleRow.set(\r\n          key,\r\n          currentFeature.get('_featureStore').layer.options.title,\r\n          true\r\n        );\r\n        headerRow.set(key, key, true);\r\n        emptyRow.unset(key, true);\r\n      } else if (key !== 'geometry') {\r\n        titleRow.unset(key, true);\r\n        headerRow.set(key, key, true);\r\n        emptyRow.unset(key, true);\r\n      } else {\r\n        titleRow.unset(key, true);\r\n        emptyRow.unset(key, true);\r\n      }\r\n\r\n      if (!currentFeatureKeys.includes(key)) {\r\n        headerRow.unset(key, true);\r\n      }\r\n    });\r\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\r\n    return titleEmptyRows;\r\n  }\r\n\r\n  private circleToPoint(feature) {\r\n    const radius: number = feature.get('rad');\r\n\r\n    if (radius) {\r\n      const point = new olPoint([\r\n        feature.get('longitude'),\r\n        feature.get('latitude')\r\n      ]);\r\n      point.transform('EPSG:4326', feature.get('_projection'));\r\n      feature.setGeometry(point);\r\n    }\r\n  }\r\n\r\n  private buildForm() {\r\n    this.importForm = this.formBuilder.group({\r\n      inputProj: ['', [Validators.required]]\r\n    });\r\n\r\n    if (this.forceNaming) {\r\n      this.form = this.formBuilder.group({\r\n        format: ['', [Validators.required]],\r\n        layers: [[], [Validators.required]],\r\n        layersWithSelection: [[]],\r\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\r\n        combineLayers: [true, [Validators.required]],\r\n        separator: [false, [Validators.required]],\r\n        featureInMapExtent: [false, [Validators.required]],\r\n        name: ['', [Validators.required]]\r\n      });\r\n    } else {\r\n      this.form = this.formBuilder.group({\r\n        format: ['', [Validators.required]],\r\n        layers: [[], [Validators.required]],\r\n        layersWithSelection: [[]],\r\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\r\n        combineLayers: [true, [Validators.required]],\r\n        separator: [false, [Validators.required]],\r\n        featureInMapExtent: [false, [Validators.required]]\r\n      });\r\n    }\r\n  }\r\n\r\n  private onFileImportSuccess(file: File, features: Feature[]) {\r\n    const importExportOptions = this.config.getConfig(\r\n      'importExport'\r\n    ) as ImportExportServiceOptions;\r\n    const confirmDialogService = importExportOptions?.allowToStoreLayer\r\n      ? this.confirmDialogService\r\n      : undefined;\r\n    if (!importExportOptions?.importWithStyle) {\r\n      handleFileImportSuccess(\r\n        file,\r\n        features,\r\n        this.map,\r\n        this.contextUri,\r\n        this.messageService,\r\n        this.layerService,\r\n        confirmDialogService\r\n      );\r\n    } else {\r\n      handleFileImportSuccess(\r\n        file,\r\n        features,\r\n        this.map,\r\n        this.contextUri,\r\n        this.messageService,\r\n        this.layerService,\r\n        confirmDialogService,\r\n        this.styleListService,\r\n        this.styleService\r\n      );\r\n    }\r\n  }\r\n\r\n  private onFileImportError(file: File, error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\r\n  }\r\n\r\n  private onPopupBlockedError(preCheck: boolean = true) {\r\n    this.loading$.next(false);\r\n    const extraMessage = preCheck\r\n      ? 'igo.geo.export.popupBlocked.selectAgain'\r\n      : 'igo.geo.export.popupBlocked.retry';\r\n    this.messageService.error(\r\n      'igo.geo.export.popupBlocked.text',\r\n      'igo.geo.export.popupBlocked.title',\r\n      { timeOut: 20000 },\r\n      { extraMessage }\r\n    );\r\n  }\r\n\r\n  private onFileExportError(error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileExportError(error, this.messageService);\r\n  }\r\n\r\n  private loadConfig() {\r\n    const forceNamingConfig = this.config.getConfig('importExport.forceNaming');\r\n    this.forceNaming =\r\n      forceNamingConfig !== undefined ? forceNamingConfig : false;\r\n\r\n    this.computeFormats();\r\n    this.loadEncodings();\r\n  }\r\n\r\n  public encodingDefaultValue(format: ExportFormat) {\r\n    if (\r\n      format === ExportFormat.CSVcomma ||\r\n      format === ExportFormat.CSVsemicolon\r\n    ) {\r\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\r\n      return EncodingFormat.LATIN1;\r\n    } else {\r\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\r\n      return EncodingFormat.UTF8;\r\n    }\r\n  }\r\n\r\n  private loadEncodings() {\r\n    this.encodings$.next(EncodingFormat);\r\n  }\r\n\r\n  private computeFormats(layers?: AnyLayer[]) {\r\n    let appliedformats: string[] = Object.keys(ExportFormat);\r\n    const formatsType = {\r\n      onlyUrl: false,\r\n      onlyVector: false,\r\n      vectorAndUrl: false,\r\n      customList: false\r\n    };\r\n    const customList = [];\r\n    if (layers && layers.length) {\r\n      layers.forEach((layer) => {\r\n        if (!layer) {\r\n          return;\r\n        }\r\n        if (layer.dataSource.options.download?.allowedFormats) {\r\n          formatsType.customList = true;\r\n          customList.push({\r\n            layer: layer.title,\r\n            formats: this.validateListFormat(\r\n              layer.dataSource.options.download.allowedFormats\r\n            )\r\n          });\r\n        } else if (\r\n          !(layer instanceof VectorLayer) &&\r\n          layer.dataSource.options.download &&\r\n          layer.dataSource.options.download.url\r\n        ) {\r\n          formatsType.onlyUrl = true;\r\n        } else if (\r\n          layer.dataSource.options.download &&\r\n          (layer.dataSource.options.download.url ||\r\n            layer.dataSource.options.download.dynamicUrl)\r\n        ) {\r\n          formatsType.vectorAndUrl = true;\r\n        } else if (layer instanceof VectorLayer) {\r\n          formatsType.onlyVector = true;\r\n        }\r\n      });\r\n\r\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\r\n        appliedformats = ['URL'];\r\n      } else if (\r\n        formatsType.onlyVector === true &&\r\n        formatsType.onlyUrl === false\r\n      ) {\r\n        this.computeFormats(); // reset\r\n        if (ExportFormat.URL in this.formats$.value) {\r\n          const keys = Object.keys(this.formats$.value).filter(\r\n            (key) => key !== 'URL'\r\n          );\r\n          appliedformats = keys;\r\n        }\r\n      } else if (\r\n        formatsType.vectorAndUrl === true &&\r\n        formatsType.onlyUrl === false &&\r\n        formatsType.onlyVector === false\r\n      ) {\r\n        this.computeFormats(); // reset\r\n        if (!(ExportFormat.URL in this.formats$.value)) {\r\n          const keys = Object.keys(this.formats$.value);\r\n          keys.push('URL');\r\n          appliedformats = keys;\r\n        }\r\n      }\r\n    }\r\n    const configImportExportFormats = this.config.getConfig(\r\n      'importExport.formats'\r\n    );\r\n    if (configImportExportFormats) {\r\n      const validatedListFormat = this.validateListFormat(\r\n        configImportExportFormats\r\n      );\r\n      appliedformats = appliedformats.filter((af) =>\r\n        validatedListFormat.includes(af)\r\n      );\r\n    }\r\n    if (formatsType.customList) {\r\n      let commonFormats;\r\n      const layersWithCustomFormats = [];\r\n      let previousCustomListFormats = customList[0].formats;\r\n      customList.map((list) => {\r\n        layersWithCustomFormats.push(list.layer);\r\n        commonFormats = list.formats.filter((value) =>\r\n          previousCustomListFormats.includes(value)\r\n        );\r\n        previousCustomListFormats = list.formats;\r\n      });\r\n      const finalFormats = commonFormats.filter((value) =>\r\n        appliedformats.includes(value)\r\n      );\r\n      if (finalFormats.length > 0) {\r\n        this.formats$.next(strEnum(finalFormats));\r\n\r\n        if (layers && layers.length) {\r\n          if (layers.length > 1) {\r\n            this.messageService.alert(\r\n              'igo.geo.export.customList.text',\r\n              'igo.geo.export.customList.title',\r\n              undefined,\r\n              { value: layersWithCustomFormats.join() }\r\n            );\r\n          }\r\n        }\r\n      } else {\r\n        this.formats$.next([]);\r\n        this.messageService.alert(\r\n          'igo.geo.export.noFormat.text',\r\n          'igo.geo.export.noFormat.title'\r\n        );\r\n      }\r\n      return;\r\n    } else {\r\n      this.formats$.next(strEnum(appliedformats));\r\n    }\r\n  }\r\n\r\n  private validateListFormat(formats: string[]): string[] {\r\n    return formats\r\n      .filter((format) => {\r\n        if (\r\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\r\n        ) {\r\n          return format;\r\n        }\r\n      })\r\n      .map((format) => {\r\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\r\n          format = ExportFormat.CSVcomma;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\r\n          format = ExportFormat.CSVsemicolon;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\r\n          format = ExportFormat.GML;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\r\n          format = ExportFormat.GPX;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\r\n          format = ExportFormat.GeoJSON;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\r\n          format = ExportFormat.KML;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\r\n          format = ExportFormat.Shapefile;\r\n          return format;\r\n        }\r\n\r\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\r\n          format = ExportFormat.URL;\r\n          return format;\r\n        }\r\n      });\r\n  }\r\n\r\n  public modeChanged(mode) {\r\n    this.selectMode.emit(mode);\r\n  }\r\n\r\n  private onFileExportSuccess() {\r\n    handleFileExportSuccess(this.messageService);\r\n  }\r\n\r\n  onImportExportChange(event) {\r\n    this.selectedMode = event.value;\r\n  }\r\n}\r\n","import {\r\n  EntityTableColumn,\r\n  EntityTableColumnRenderer,\r\n  getEntityProperty\r\n} from '@igo2/common';\r\nimport { MessageService } from '@igo2/core';\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport { ExportNothingToExportError } from './export.errors';\r\n\r\nexport function handleFileExportError(\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  if (error instanceof ExportNothingToExportError) {\r\n    handleNothingToExportError(messageService);\r\n    return;\r\n  }\r\n  messageService.error(\r\n    'igo.geo.export.failed.text',\r\n    'igo.geo.export.failed.title'\r\n  );\r\n}\r\n\r\nexport function handleFileExportSuccess(messageService: MessageService) {\r\n  messageService.success(\r\n    'igo.geo.export.success.text',\r\n    'igo.geo.export.success.title'\r\n  );\r\n}\r\n\r\nexport function handleNothingToExportError(messageService: MessageService) {\r\n  messageService.error(\r\n    'igo.geo.export.nothing.text',\r\n    'igo.geo.export.nothing.title'\r\n  );\r\n}\r\n\r\n/**\r\n * Export array to CSV\r\n *\r\n * @param rows Array of arrays to export as CSV\r\n * @param separator Cell separator\r\n */\r\nexport function exportToCSV(\r\n  rows: any[][],\r\n  fileName: string,\r\n  separator: string = ';'\r\n) {\r\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\r\n  const csvContent = lines.join('\\n');\r\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\r\n}\r\n\r\n/**\r\n * Return an array of values from an array of entities.\r\n *\r\n * @param entities Array of entities\r\n * @param scolumns Columns definition of the output data\r\n */\r\nexport function entitiesToRowData(\r\n  entities: object[],\r\n  columns: EntityTableColumn[]\r\n) {\r\n  return entities.map((entity: object) => {\r\n    return columns.map((column: EntityTableColumn) => {\r\n      let valueAccessor;\r\n      if (\r\n        column.renderer === undefined ||\r\n        column.renderer === EntityTableColumnRenderer.Default\r\n      ) {\r\n        valueAccessor = column.valueAccessor;\r\n      }\r\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\r\n      return valueAccessor(entity, column.name);\r\n    });\r\n  });\r\n}\r\n","<button\n  *ngIf=\"layerIsExportable()\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n>\n  <!-- (click)=\"openDownload(layer)\"> -->\n  <mat-icon svgIcon=\"file-export\"></mat-icon>\n</button>\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\r\n\r\nimport { DataSourceOptions } from '../../datasource';\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\n@Component({\r\n  selector: 'igo-export-button',\r\n  templateUrl: './export-button.component.html',\r\n  styleUrls: ['./export-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ExportButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor() {}\r\n\r\n  get options(): DataSourceOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.dataSource.options;\r\n  }\r\n\r\n  layerIsExportable(): boolean {\r\n    if (\r\n      (this.layer instanceof VectorLayer && this.layer.exportable === true) ||\r\n      (this.layer.dataSource.options.download &&\r\n        this.layer.dataSource.options.download.url) ||\r\n      (this.layer.options.workspace?.enabled &&\r\n        this.layer.options.workspace?.workspaceId !== this.layer.id)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-zoom-button',\r\n  templateUrl: './zoom-button.component.html',\r\n  styleUrls: ['./zoom-button.component.scss']\r\n})\r\nexport class ZoomButtonComponent {\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string;\r\n\r\n  get zoom(): number {\r\n    return this.map.viewController.getZoom();\r\n  }\r\n\r\n  get minZoom(): number {\r\n    return this.map.viewController.olView.getMinZoom() || 1;\r\n  }\r\n\r\n  get maxZoom(): number {\r\n    return this.map.viewController.olView.getMaxZoom();\r\n  }\r\n\r\n  constructor() {}\r\n}\r\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: { zoom: zoom + 1 }\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\"\n  >\n    <mat-icon svgIcon=\"plus\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: { zoom: zoom - 1 }\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\"\n  >\n    <mat-icon svgIcon=\"minus\"></mat-icon>\n  </button>\n</div>\n","<div class=\"igo-geolocate-button-container\" *ngIf=\"map.geolocationController\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"\n      map.geolocationController.tracking\n        ? ('igo.geo.mapButtons.geolocateInactive' | translate)\n        : ('igo.geo.mapButtons.geolocate' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onGeolocationClick()\"\n  >\n    <mat-icon svgIcon=\"{{ icon$ | async }}\"></mat-icon>\n  </button>\n</div>\n","import { AfterContentInit, Component, Input, OnDestroy } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-geolocate-button',\r\n  templateUrl: './geolocate-button.component.html',\r\n  styleUrls: ['./geolocate-button.component.scss']\r\n})\r\nexport class GeolocateButtonComponent implements AfterContentInit, OnDestroy {\r\n  private tracking$$: Subscription;\r\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'crosshairs-gps'\r\n  );\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get color(): string {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color: string;\r\n\r\n  constructor(private configService: ConfigService) {}\r\n  ngAfterContentInit(): void {\r\n    this.map.ol.once('rendercomplete', () => {\r\n      this.tracking$$ = this.map.geolocationController.tracking$.subscribe(\r\n        (tracking) => {\r\n          if (tracking) {\r\n            this.icon$.next('crosshairs-gps');\r\n          } else {\r\n            this.configService.getConfig('geolocate.basic')\r\n              ? this.icon$.next('crosshairs-gps')\r\n              : this.icon$.next('crosshairs');\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.tracking$$) {\r\n      this.tracking$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  onGeolocationClick() {\r\n    const tracking = this.map.geolocationController.tracking;\r\n    this.map.geolocationController.tracking = tracking ? false : true;\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapExtent } from '../shared/map.interface';\r\nimport { HomeExtentButtonOptions } from './home-extent-button.interface';\r\n\r\n/*\r\nButton to center the map to the home extent\r\n*/\r\n@Component({\r\n  selector: 'igo-home-extent-button',\r\n  templateUrl: './home-extent-button.component.html',\r\n  styleUrls: ['./home-extent-button.component.scss']\r\n})\r\nexport class HomeExtentButtonComponent {\r\n  @Input() map: IgoMap;\r\n  @Input() color: string;\r\n  @Input() extentOverride?: MapExtent;\r\n  @Input() centerOverride?: [number, number];\r\n  @Input() zoomOverride?: number;\r\n\r\n  private homeExtentButtonExtent;\r\n  private homeExtentButtonCenter;\r\n  private homeExtentButtonZoom;\r\n\r\n  constructor(public configService: ConfigService) {\r\n    this.computeHomeExtent();\r\n  }\r\n\r\n  computeHomeExtent() {\r\n    const homeExtentButtonOptions: HomeExtentButtonOptions =\r\n      this.configService.getConfig('homeExtentButton');\r\n\r\n    this.homeExtentButtonExtent =\r\n      this.extentOverride || homeExtentButtonOptions.homeExtButtonExtent;\r\n    this.homeExtentButtonCenter =\r\n      this.centerOverride || homeExtentButtonOptions.homeExtButtonCenter;\r\n    this.homeExtentButtonZoom =\r\n      this.zoomOverride || homeExtentButtonOptions.homeExtButtonZoom;\r\n\r\n    // priority over extent if these 2 properties are defined;\r\n    if (this.centerOverride && this.zoomOverride) {\r\n      this.homeExtentButtonExtent = undefined;\r\n    }\r\n  }\r\n\r\n  onToggleClick() {\r\n    this.computeHomeExtent();\r\n    if (this.homeExtentButtonExtent) {\r\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\r\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\r\n      const center = olproj.fromLonLat(\r\n        this.homeExtentButtonCenter,\r\n        this.map.viewController.olView.getProjection().getCode()\r\n      );\r\n      this.map.viewController.olView.setCenter(center);\r\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\r\n    }\r\n  }\r\n}\r\n","<div class=\"igo-home-extent-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onToggleClick()\"\n  >\n    <mat-icon svgIcon=\"home-map-marker\"></mat-icon>\n  </button>\n</div>\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { StorageService } from '@igo2/core';\r\nimport { userAgent } from '@igo2/utils';\r\n\r\nimport NoSleep from 'nosleep.js';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-wake-lock-button',\r\n  templateUrl: './wake-lock-button.component.html',\r\n  styleUrls: ['./wake-lock-button.component.scss']\r\n})\r\n\r\n/**\r\n * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\r\n * On iOS, the Wake Lock API is not supported\r\n * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\r\n * On not supported browser, a fake video is used to keep the screen open.\r\n *\r\n * TODO: When the API will be supported by every browser, We should remove the NoSleep.js dependency\r\n * and replace it by a WakeLock API implementation.\r\n */\r\nexport class WakeLockButtonComponent {\r\n  @Input() color: string = 'primary';\r\n  @Input()\r\n  get enabled(): boolean {\r\n    return this.storageService.get('wakeLockEnabled') as boolean;\r\n  }\r\n  set enabled(value: boolean) {\r\n    this.storageService.set('wakeLockEnabled', value);\r\n  }\r\n\r\n  private noSleep: NoSleep;\r\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('sleep');\r\n  public visible = false;\r\n\r\n  constructor(private storageService: StorageService) {\r\n    this.noSleep = new NoSleep();\r\n    const nonWakeLockApiBrowser = userAgent.satisfies({\r\n      ie: '>0',\r\n      edge: '<84',\r\n      chrome: '<84',\r\n      firefox: '>0',\r\n      opera: '<70',\r\n      safari: '>0'\r\n    });\r\n    if (nonWakeLockApiBrowser) {\r\n      this.disableWakeLock();\r\n      this.enabled = false;\r\n      window.addEventListener('blur', () => {\r\n        this.disableWakeLock();\r\n        this.enabled = false;\r\n      });\r\n    }\r\n    this.enabled ? this.enableWakeLock() : this.disableWakeLock();\r\n  }\r\n\r\n  /**\r\n   * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\r\n   * On iOS, the Wake Lock API is not supported\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\r\n   * On not supported browser, a fake video is used to keep the screen open.\r\n   */\r\n  private enableWakeLock() {\r\n    this.noSleep.enable();\r\n    this.enabled = true;\r\n    this.icon$.next('sleep-off');\r\n  }\r\n  /**\r\n   * Let display sleep\r\n   */\r\n  private disableWakeLock() {\r\n    this.noSleep.disable();\r\n    this.enabled = false;\r\n    this.icon$.next('sleep');\r\n  }\r\n\r\n  toggleWakeLock() {\r\n    if (this.enabled) {\r\n      this.disableWakeLock();\r\n    } else {\r\n      this.enableWakeLock();\r\n    }\r\n  }\r\n}\r\n","<div class=\"igo-wake-lock-button-container\">\n  <button\n    [color]=\"color\"\n    mat-icon-button\n    [matTooltip]=\"\n      enabled\n        ? ('igo.geo.mapButtons.preventScreenLock' | translate)\n        : ('igo.geo.mapButtons.letScreenLock' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    (click)=\"toggleWakeLock()\"\n  >\n    <mat-icon svgIcon=\"{{ icon$ | async }}\"></mat-icon>\n  </button>\n</div>\n","<div\n  *ngIf=\"((rotated$ | async) && !showIfNoRotation) || showIfNoRotation\"\n  class=\"igo-rotation-button-container\"\n  [matTooltip]=\"\n    (rotated$ | async)\n      ? ('igo.geo.mapButtons.resetRotation'\n        | translate: { azimuth: azimuthRounded, rotation: rotationRounded })\n      : ('igo.geo.mapButtons.tipRotation' | translate)\n  \"\n  matTooltipPosition=\"left\"\n>\n  <button\n    mat-icon-button\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"(rotated$ | async) === false\"\n    (click)=\"map.viewController.resetRotation()\"\n  >\n    <mat-icon [ngStyle]=\"currentStyle$ | async\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>\n","import { AfterContentInit, Component, Input } from '@angular/core';\r\n\r\nimport { bearingToAzimuth } from '@turf/helpers';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-rotation-button',\r\n  templateUrl: './rotation-button.component.html',\r\n  styleUrls: ['./rotation-button.component.scss']\r\n})\r\nexport class RotationButtonComponent implements AfterContentInit {\r\n  readonly rotated$ = new BehaviorSubject<boolean>(false);\r\n  public azimuthRounded: number = 0;\r\n  public rotationRounded: number = 0;\r\n  readonly currentStyle$ = new BehaviorSubject<{}>({\r\n    transform: 'rotate(0rad)'\r\n  });\r\n\r\n  @Input() map: IgoMap;\r\n  @Input() showIfNoRotation: boolean;\r\n  @Input() color: string;\r\n\r\n  constructor() {}\r\n\r\n  ngAfterContentInit() {\r\n    this.map.viewController.rotation$.subscribe((r) => {\r\n      const radians = r || 0;\r\n      const deg = (radians * 180) / Math.PI;\r\n      this.rotationRounded = Math.round(deg);\r\n      this.azimuthRounded = Math.round(bearingToAzimuth(deg * -1));\r\n      this.currentStyle$.next({\r\n        transform: 'rotate(' + radians + 'rad)'\r\n      });\r\n      this.rotated$.next(radians !== 0);\r\n    });\r\n  }\r\n}\r\n","export enum OverlayAction {\n  None,\n  Move,\n  Zoom,\n  ZoomIfOutMapExtent\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { OverlayAction } from './overlay.enum';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class OverlayService {\r\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\r\n    [],\r\n    undefined\r\n  ]);\r\n\r\n  constructor() {}\r\n\r\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\r\n    this.features$.next([features, action]);\r\n  }\r\n\r\n  clear() {\r\n    this.features$.next([[], OverlayAction.None]);\r\n  }\r\n}\r\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\r\n\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { OverlayAction } from '../shared/overlay.enum';\r\nimport { OverlayService } from '../shared/overlay.service';\r\n\r\n@Directive({\r\n  selector: '[igoOverlay]'\r\n})\r\nexport class OverlayDirective implements OnInit, OnDestroy {\r\n  private features$$: Subscription;\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private overlayService: OverlayService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.features$$ = this.overlayService.features$.subscribe((res) =>\r\n      this.handleFeatures(res[0], res[1])\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.features$$.unsubscribe();\r\n  }\r\n\r\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\r\n}\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2016-2017 Dan \"Ducky\" Little\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport default function jsGeoPdfPlugin(jsPDFAPI) {\n  const setGeoArea = function (pdfExt, geoExt) {\n    const bbox = pdfExt.join(' ');\n    // the ordering may seem odd here but PDF\n    //  flips the Y axis upside down and this accounts for that\n    //  change.\n    const minx = geoExt[0];\n    const maxx = geoExt[2];\n    const maxy = geoExt[1];\n    const miny = geoExt[3];\n    const bounds = [miny, minx, maxy, minx, maxy, maxx, miny, maxx].join(' ');\n    const bbox_obj = this.internal.newAdditionalObject();\n    const bounds_obj = this.internal.newAdditionalObject();\n    const proj_obj = this.internal.newAdditionalObject();\n\n    proj_obj.content =\n      '<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS[\"WGS_1984_Web_Mercator_Auxiliary_Sphere\"' +\n      ',GEOGCS[\"GCS_WGS_1984\",DATUM[\"D_WGS_1984\",SPHEROID[\"WGS_1984\",6378137.0,298.257223563]],PRIMEM[\"Greenwich\",0.0]' +\n      ',UNIT[\"Degree\",0.017453292519943295]],PROJECTION[\"Mercator_Auxiliary_Sphere\"],PARAMETER[\"False_Easting\",0.0]' +\n      ',PARAMETER[\"False_Northing\",0.0],PARAMETER[\"Central_Meridian\",0.0],PARAMETER[\"Standard_Parallel_1\",0.0]' +\n      ',PARAMETER[\"Auxiliary_Sphere_Type\",0.0],UNIT[\"Meter\",1.0]]) >>';\n\n    bounds_obj.content =\n      '<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS ' +\n      proj_obj.objId +\n      ' 0 R /GPTS [ ' +\n      bounds +\n      ' ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>';\n\n    bbox_obj.content =\n      '<< /BBox [ ' +\n      bbox +\n      ' ] /Measure ' +\n      bounds_obj.objId +\n      ' 0 R /Name (Layer) /Type /Viewport >>';\n\n    const title_obj = this.internal.newAdditionalObject();\n    const date = new Date().toLocaleDateString('en-CA');\n    title_obj.content = '<< /Name IGO2 /Type /OCG /Date ' + date + ' >>';\n\n    return bbox_obj.objId;\n  };\n\n  jsPDFAPI.setGeoArea = function (pdfExt, geoExt) {\n    this.internal.events.subscribe('putPage', function () {\n      const bbox_id = setGeoArea.call(this, pdfExt, geoExt);\n      this.internal.write('/VP [ ' + bbox_id + ' 0 R ]');\n    });\n  };\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\nexport type PrintResolution = keyof typeof PrintResolution;\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { SecureImagePipe } from '@igo2/common';\r\nimport {\r\n  ActivityService,\r\n  ConfigService,\r\n  LanguageService,\r\n  MessageService\r\n} from '@igo2/core';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport { saveAs } from 'file-saver';\r\nimport html2canvas from 'html2canvas';\r\nimport jsPDF from 'jspdf';\r\nimport { default as JSZip } from 'jszip';\r\nimport { Observable, Subject, forkJoin } from 'rxjs';\r\nimport { map as rxMap } from 'rxjs/operators';\r\n\r\nimport { LegendMapViewOptions } from '../../layer/shared/layers/legend.interface';\r\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { formatScale } from '../../map/shared/map.utils';\r\nimport GeoPdfPlugin from './geopdf';\r\nimport { PrintOptions, TextPdfSizeAndMargin } from './print.interface';\r\nimport {\r\n  PrintLegendPosition,\r\n  PrintPaperFormat,\r\n  PrintResolution\r\n} from './print.type';\r\n\r\ndeclare global {\r\n  interface Navigator {\r\n    msSaveBlob?: (blob: any, defaultName?: string) => boolean;\r\n  }\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PrintService {\r\n  zipFile: JSZip;\r\n  nbFileToProcess: number;\r\n  activityId: string;\r\n  imgSizeAdded: Array<number>;\r\n\r\n  TEXTPDFFONT = {\r\n    titleFont: 'Times',\r\n    titleFontStyle: 'bold',\r\n    subtitleFont: 'Times',\r\n    subtitleFontStyle: 'bold',\r\n    commentFont: 'courier',\r\n    commentFontStyle: 'normal',\r\n    commentFontSize: 12\r\n  };\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private messageService: MessageService,\r\n    private activityService: ActivityService,\r\n    private languageService: LanguageService,\r\n    private configService: ConfigService\r\n  ) {}\r\n\r\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\r\n    const status$ = new Subject();\r\n    const paperFormat: string = options.paperFormat;\r\n    const resolution = +options.resolution; // Default is 96\r\n    const orientation = options.orientation;\r\n    const legendPostion = options.legendPosition;\r\n    this.activityId = this.activityService.register();\r\n\r\n    GeoPdfPlugin(jsPDF.API);\r\n\r\n    const doc = new jsPDF({\r\n      orientation,\r\n      format: paperFormat.toLowerCase(),\r\n      unit: 'mm' // default\r\n    });\r\n\r\n    const dimensions = [\r\n      doc.internal.pageSize.width,\r\n      doc.internal.pageSize.height\r\n    ];\r\n\r\n    const margins = [10, 10, 10, 10];\r\n    const width = dimensions[0] - margins[3] - margins[1];\r\n    const height = dimensions[1] - margins[0] - margins[2];\r\n    const size: [number, number] = [width, height];\r\n    let titleSizes: TextPdfSizeAndMargin;\r\n    let subtitleSizes: TextPdfSizeAndMargin;\r\n\r\n    // if paper format A1 or A0 add margin top\r\n    if (\r\n      (options.title !== '' || options.subtitle !== '') &&\r\n      (paperFormat === PrintPaperFormat.A1 ||\r\n        paperFormat === PrintPaperFormat.A0)\r\n    ) {\r\n      margins[0] += 10;\r\n    }\r\n    // PDF title\r\n    const fontSizeInPt = Math.round(2 * (height + 145) * 0.05) / 2; //calculate the fontSize title from the page height.\r\n    if (options.title !== undefined && options.title !== '') {\r\n      titleSizes = this.getTextPdfObjectSizeAndMarg(\r\n        options.title,\r\n        margins,\r\n        this.TEXTPDFFONT.titleFont,\r\n        fontSizeInPt,\r\n        this.TEXTPDFFONT.titleFontStyle,\r\n        doc\r\n      );\r\n\r\n      this.addTextInPdfDoc(\r\n        doc,\r\n        options.title,\r\n        this.TEXTPDFFONT.titleFont,\r\n        this.TEXTPDFFONT.titleFontStyle,\r\n        titleSizes.fontSize,\r\n        titleSizes.marginLeft + margins[3],\r\n        margins[0]\r\n      );\r\n\r\n      margins[0] = titleSizes.height + margins[0]; // cumulative margin top for next elem to place in pdf doc\r\n    }\r\n\r\n    // PDF subtitle\r\n    if (options.subtitle !== undefined && options.subtitle !== '') {\r\n      subtitleSizes = this.getTextPdfObjectSizeAndMarg(\r\n        options.subtitle,\r\n        margins,\r\n        this.TEXTPDFFONT.subtitleFont,\r\n        options.title !== '' ? titleSizes.fontSize * 0.7 : fontSizeInPt * 0.7, // 70% size of title\r\n        this.TEXTPDFFONT.subtitleFontStyle,\r\n        doc\r\n      );\r\n\r\n      this.addTextInPdfDoc(\r\n        doc,\r\n        options.subtitle,\r\n        this.TEXTPDFFONT.subtitleFont,\r\n        this.TEXTPDFFONT.subtitleFontStyle,\r\n        subtitleSizes.fontSize,\r\n        subtitleSizes.marginLeft + margins[3],\r\n        margins[0]\r\n      );\r\n\r\n      margins[0] += 5; // cumulative marg top for next elem to place in pdf doc. 5 is a fix it could be adjust\r\n    }\r\n\r\n    if (options.showProjection === true || options.showScale === true) {\r\n      this.addProjScale(\r\n        doc,\r\n        map,\r\n        resolution,\r\n        options.showProjection,\r\n        options.showScale\r\n      );\r\n    }\r\n    if (options.comment !== undefined && options.comment !== '') {\r\n      this.addComment(doc, options.comment);\r\n    }\r\n\r\n    this.addMap(doc, map, resolution, size, margins, legendPostion).subscribe(\r\n      async (status: SubjectStatus) => {\r\n        if (status === SubjectStatus.Done) {\r\n          await this.handleMeasureLayer(doc, map, margins);\r\n\r\n          const width = this.imgSizeAdded[0];\r\n          const height = this.imgSizeAdded[1];\r\n          const res = 1;\r\n          this.addGeoRef(doc, map, width, height, res, margins);\r\n\r\n          if (options.legendPosition !== 'none') {\r\n            if (\r\n              ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\r\n                options.legendPosition\r\n              ) > -1\r\n            ) {\r\n              await this.addLegendSamePage(\r\n                doc,\r\n                map,\r\n                margins,\r\n                resolution,\r\n                options.legendPosition\r\n              );\r\n            } else if (options.legendPosition === 'newpage') {\r\n              await this.addLegend(doc, map, margins, resolution);\r\n            }\r\n          } else {\r\n            await this.saveDoc(doc);\r\n          }\r\n        }\r\n\r\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\r\n          this.activityService.unregister(this.activityId);\r\n          status$.next(SubjectStatus.Done);\r\n        }\r\n      }\r\n    );\r\n\r\n    return status$;\r\n  }\r\n  // ref GeoMoose https://github.com/geomoose/gm3/tree/main/src/gm3/components/print\r\n  addGeoRef(doc, map, width, height, resolution, margins) {\r\n    const unit = 'mm';\r\n    const docHeight = doc.internal.pageSize.getHeight();\r\n\r\n    // x,y = margin left-bottom corner for img in pdf doc\r\n    const x = margins[3];\r\n    const y = docHeight - margins[0] - height;\r\n\r\n    let pdf_extents = [x, y, x + width, y + height];\r\n    for (let i = 0; i < pdf_extents.length; i++) {\r\n      pdf_extents[i] = this.pdf_units2points(pdf_extents[i], unit);\r\n    }\r\n\r\n    const mapExtent = map.viewController.getExtent('EPSG:3857');\r\n    doc.setGeoArea(pdf_extents, mapExtent);\r\n  }\r\n\r\n  /**\r\n   * Add measure overlay on the map on the document when the measure layer is present\r\n   * @param  doc - Pdf document where measure tooltip will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private async handleMeasureLayer(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    margins: Array<number>\r\n  ) {\r\n    if (\r\n      map.layers.find(\r\n        (layer) => layer.visible && layer.id.startsWith('igo-measures-')\r\n      )\r\n    ) {\r\n      let canvasOverlayHTMLMeasures;\r\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\r\n      await html2canvas(mapOverlayMeasuresHTML, {\r\n        scale: 1,\r\n        backgroundColor: null\r\n      }).then((e) => {\r\n        canvasOverlayHTMLMeasures = e;\r\n      });\r\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get html code for all layers legend\r\n   * @param  map IgoMap\r\n   * @param  width The width that the legend need to be\r\n   * @return Html code for the legend\r\n   */\r\n  getLayersLegendHtml(\r\n    map: IgoMap,\r\n    width: number,\r\n    resolution: number\r\n  ): Observable<string> {\r\n    return new Observable((observer) => {\r\n      let html = '';\r\n      const legends = getLayersLegends(map.layers, {\r\n        resolution: map.viewController.getResolution(),\r\n        extent: map.viewController.getExtent(),\r\n        projection: map.viewController.getOlProjection().getCode(),\r\n        // scale: map.viewController.getScale(resolution),\r\n        size: map.ol.getSize()\r\n      } as LegendMapViewOptions);\r\n\r\n      if (legends.filter((l) => l.display === true).length === 0) {\r\n        observer.next(html);\r\n        observer.complete();\r\n        return;\r\n      }\r\n      // Define important style to be sure that all container is convert\r\n      // to image not just visible part\r\n      html += '<style media=\"screen\" type=\"text/css\">';\r\n      html +=\r\n        '.html2canvas-container { width: ' +\r\n        width +\r\n        'mm !important; height: 2000px !important; }';\r\n      html += 'table.tableLegend {table-layout: auto;}';\r\n      html +=\r\n        'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\r\n      html += '</style>';\r\n      // The font size will also be lowered afterwards (globally along the legend size)\r\n      // this allows having a good relative font size here and to keep ajusting the legend size\r\n      // while keeping good relative font size\r\n      html += '<font size=\"3\" face=\"Times\" >';\r\n      html += '<div class=\"styleLegend\">';\r\n      html += '<table class=\"tableLegend\" >';\r\n\r\n      // For each legend, define an html table cell\r\n      const images$ = legends\r\n        .filter((l) => l.display && l.isInResolutionsRange === true)\r\n        .map((legend) =>\r\n          this.getDataImage(legend.url).pipe(\r\n            rxMap((dataImage) => {\r\n              let htmlImg =\r\n                '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\r\n              htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\r\n              return htmlImg;\r\n            })\r\n          )\r\n        );\r\n      forkJoin(images$).subscribe((dataImages) => {\r\n        html = dataImages.reduce((acc, current) => (acc += current), html);\r\n        html += '</table>';\r\n        html += '</div>';\r\n        observer.next(html);\r\n        observer.complete();\r\n      });\r\n    });\r\n  }\r\n\r\n  getDataImage(url: string): Observable<string> {\r\n    const secureIMG = new SecureImagePipe(this.http, this.configService);\r\n    return secureIMG.transform(url);\r\n  }\r\n\r\n  /**\r\n   * Get all the legend in a single image\r\n   * * @param  format - Image format. default value to \"png\"\r\n   * @return The image of the legend\r\n   */\r\n  async getLayersLegendImage(\r\n    map,\r\n    format: string = 'png',\r\n    doZipFile: boolean,\r\n    resolution: number\r\n  ) {\r\n    const status$ = new Subject();\r\n    // Get html code for the legend\r\n    const width = 200; // milimeters unit, originally define for document pdf\r\n    let html = await this.getLayersLegendHtml(\r\n      map,\r\n      width,\r\n      resolution\r\n    ).toPromise();\r\n    format = format.toLowerCase();\r\n\r\n    // If no legend show No LEGEND in an image\r\n    if (html.length === 0) {\r\n      html = '<font size=\"12\" face=\"Courier New\" >';\r\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n    div.style.zIndex = '-1';\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n\r\n    await this.timeout(1);\r\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\r\n      console.log(e);\r\n    });\r\n    this.removeHtmlElement(div);\r\n    if (canvas) {\r\n      let status = SubjectStatus.Done;\r\n      try {\r\n        if (!doZipFile) {\r\n          // Save the canvas as file\r\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\r\n        }\r\n      } catch (err) {\r\n        status = SubjectStatus.Error;\r\n      }\r\n      status$.next(status);\r\n    }\r\n\r\n    return status$;\r\n  }\r\n\r\n  private removeHtmlElement(element: HTMLElement) {\r\n    element.parentNode.removeChild(element);\r\n  }\r\n\r\n  getTextPdfObjectSizeAndMarg(\r\n    text: string,\r\n    margins,\r\n    font: string,\r\n    fontSizeInPt: number,\r\n    fontStyle: string,\r\n    doc: jsPDF\r\n  ): TextPdfSizeAndMargin {\r\n    const pdfResolution = 96;\r\n    const docWidth = doc.internal.pageSize.getWidth();\r\n    const pageWidth = docWidth - margins[1] - margins[3];\r\n\r\n    // important to set it first, the textDimension change when font change!\r\n    doc.setFont(font, fontStyle);\r\n    doc.setFontSize(fontSizeInPt);\r\n\r\n    let textDimensions = doc.getTextDimensions(text);\r\n    let textMarginLeft: number;\r\n\r\n    if (textDimensions.w > pageWidth) {\r\n      // if the text is to long, reduce fontSize 70% and the overflow with be cut in print...\r\n      textMarginLeft = 0;\r\n      fontSizeInPt = fontSizeInPt * 0.7;\r\n      doc.setFontSize(fontSizeInPt);\r\n      textDimensions = doc.getTextDimensions(text);\r\n    } else {\r\n      textMarginLeft = (pageWidth - textDimensions.w) / 2;\r\n    }\r\n\r\n    return {\r\n      fontSize: fontSizeInPt,\r\n      marginLeft: textMarginLeft,\r\n      height: textDimensions.h\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add comment to the document\r\n   * * @param  doc - pdf document\r\n   * * @param  comment - Comment to add in the document\r\n   */\r\n  private addComment(doc: jsPDF, comment: string) {\r\n    const commentMarginLeft = 10; //margin left and bottom is fix\r\n    const commentMarginBottom = 10;\r\n    const marginTop = doc.internal.pageSize.height - commentMarginBottom;\r\n    this.addTextInPdfDoc(\r\n      doc,\r\n      comment,\r\n      this.TEXTPDFFONT.commentFont,\r\n      this.TEXTPDFFONT.commentFontStyle,\r\n      this.TEXTPDFFONT.commentFontSize,\r\n      commentMarginLeft,\r\n      marginTop,\r\n      true\r\n    );\r\n  }\r\n\r\n  private addTextInPdfDoc(\r\n    doc: jsPDF,\r\n    textToAdd: string,\r\n    textFont: string,\r\n    textFontStyle: string,\r\n    textFontSize: number,\r\n    textMarginLeft: number,\r\n    textMarginTop: number,\r\n    isComment: boolean = false\r\n  ) {\r\n    doc.setFont(textFont, textFontStyle);\r\n    doc.setFontSize(textFontSize);\r\n\r\n    if (isComment) {\r\n      textToAdd = doc.splitTextToSize(\r\n        textToAdd,\r\n        doc.internal.pageSize.getWidth() - textMarginLeft * 3\r\n      );\r\n    }\r\n    doc.text(textToAdd, textMarginLeft, textMarginTop);\r\n  }\r\n\r\n  /**\r\n   * Add projection and/or scale to the document\r\n   * @param  doc - pdf document\r\n   * @param  map - Map of the app\r\n   * @param  dpi - DPI resolution of the document\r\n   * @param  projection - Bool to indicate if projection need to be added\r\n   * @param  scale - Bool to indicate if scale need to be added\r\n   */\r\n  private addProjScale(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    dpi: number,\r\n    projection: boolean,\r\n    scale: boolean\r\n  ) {\r\n    const translate = this.languageService.translate;\r\n    const projScaleSize = 12;\r\n    const projScaleMarginLeft = 10;\r\n    const marginBottom = 15;\r\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\r\n\r\n    let textProjScale: string = '';\r\n    if (projection === true) {\r\n      const projText = translate.instant('igo.geo.printForm.projection');\r\n      textProjScale += projText + ': ' + map.projection;\r\n    }\r\n    if (scale === true) {\r\n      if (projection === true) {\r\n        textProjScale += '   ';\r\n      }\r\n      const scaleText = translate.instant('igo.geo.printForm.scale');\r\n      const mapScale = map.viewController.getScale(dpi);\r\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\r\n    }\r\n    doc.setFont('courier');\r\n    doc.setFontSize(projScaleSize);\r\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\r\n  }\r\n\r\n  /**\r\n   * Add the legend to the document\r\n   * @param  doc - Pdf document where legend will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private async addLegend(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    margins: Array<number>,\r\n    resolution: number\r\n  ) {\r\n    // Get html code for the legend\r\n    const width = doc.internal.pageSize.width;\r\n    const html = await this.getLayersLegendHtml(\r\n      map,\r\n      width,\r\n      resolution\r\n    ).toPromise();\r\n    // If no legend, save the map directly\r\n    if (html === '') {\r\n      await this.saveDoc(doc);\r\n      return true;\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n    div.style.zIndex = '-1';\r\n\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n\r\n    await this.timeout(1);\r\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\r\n      console.log(e);\r\n    });\r\n    this.removeHtmlElement(div);\r\n    if (canvas) {\r\n      const pourcentageReduction = 0.85;\r\n      const imageSize = [\r\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\r\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\r\n      ];\r\n      let imgData;\r\n      doc.addPage();\r\n      imgData = canvas.toDataURL('image/png');\r\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\r\n    }\r\n\r\n    await this.saveDoc(doc);\r\n  }\r\n\r\n  /**\r\n   * Add the legend to the document\r\n   * @param  doc - Pdf document where legend will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private async addLegendSamePage(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    margins: Array<number>,\r\n    resolution: number,\r\n    legendPosition: string\r\n  ) {\r\n    // Get html code for the legend\r\n    const width = doc.internal.pageSize.width;\r\n    const html = await this.getLayersLegendHtml(\r\n      map,\r\n      width,\r\n      resolution\r\n    ).toPromise();\r\n    // If no legend, save the map directly\r\n    if (html === '') {\r\n      await this.saveDoc(doc);\r\n      return true;\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n    div.style.zIndex = '-1';\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n    await this.timeout(1);\r\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\r\n      console.log(e);\r\n    });\r\n    this.removeHtmlElement(div);\r\n    let marginsLegend;\r\n    if (canvas) {\r\n      const pourcentageReduction = 0.85;\r\n      const imageSize = [\r\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\r\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\r\n      ];\r\n      // Move the legend to the correct position on the page\r\n      if (legendPosition === 'bottomright') {\r\n        marginsLegend = [\r\n          doc.internal.pageSize.height - margins[2] - imageSize[1],\r\n          margins[1],\r\n          margins[2],\r\n          doc.internal.pageSize.width - margins[1] - imageSize[0]\r\n        ];\r\n      } else if (legendPosition === 'topright') {\r\n        marginsLegend = [\r\n          margins[0],\r\n          margins[1],\r\n          doc.internal.pageSize.height - margins[0] - imageSize[1],\r\n          doc.internal.pageSize.width - margins[1] - imageSize[0]\r\n        ];\r\n      } else if (legendPosition === 'bottomleft') {\r\n        // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\r\n        marginsLegend = [\r\n          doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\r\n          doc.internal.pageSize.width - margins[3] - imageSize[0],\r\n          margins[2] + 15,\r\n          margins[3]\r\n        ];\r\n      } else if (legendPosition === 'topleft') {\r\n        marginsLegend = [\r\n          margins[0],\r\n          doc.internal.pageSize.width - margins[3] - imageSize[0],\r\n          doc.internal.pageSize.height - margins[0] - imageSize[1],\r\n          margins[3]\r\n        ];\r\n      }\r\n      this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\r\n      await this.saveDoc(doc);\r\n    }\r\n  }\r\n\r\n  defineNbFileToProcess(nbFileToProcess) {\r\n    this.nbFileToProcess = nbFileToProcess;\r\n  }\r\n\r\n  private timeout(ms) {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  private addCanvas(\r\n    doc: jsPDF,\r\n    canvas: HTMLCanvasElement,\r\n    margins: Array<number>\r\n  ) {\r\n    let image;\r\n    if (canvas) {\r\n      image = canvas.toDataURL('image/png');\r\n    }\r\n\r\n    if (image !== undefined) {\r\n      if (image.length < 20) {\r\n        console.log('Warning: An image cannot be print in pdf file');\r\n        return;\r\n      }\r\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\r\n      doc.addImage(\r\n        image,\r\n        'PNG',\r\n        margins[3],\r\n        margins[0],\r\n        imageSize[0],\r\n        imageSize[1]\r\n      );\r\n\r\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\r\n\r\n      this.imgSizeAdded = imageSize; // keep img size for georef later\r\n    }\r\n  }\r\n\r\n  // TODO fix printing with image resolution\r\n  addMap(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    resolution: number,\r\n    docSize: [number, number],\r\n    margins: Array<number>,\r\n    legendPostion: PrintLegendPosition\r\n  ) {\r\n    const mapSize = map.ol.getSize() as [number, number];\r\n    const viewResolution = map.ol.getView().getResolution();\r\n    const dimensionPixels = this.setMapResolution(\r\n      map,\r\n      docSize,\r\n      resolution,\r\n      viewResolution\r\n    );\r\n    const status$ = new Subject();\r\n\r\n    let timeout;\r\n    map.ol.once('rendercomplete', async (event: any) => {\r\n      const mapCanvas = event.target\r\n        .getViewport()\r\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\r\n      const mapResultCanvas = await this.drawMap(dimensionPixels, mapCanvas);\r\n\r\n      this.resetOriginalMapSize(map, mapSize, viewResolution);\r\n\r\n      await this.drawMapControls(map, mapResultCanvas, legendPostion);\r\n\r\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\r\n        clearTimeout(timeout);\r\n        if (mapStatus !== SubjectStatus.Done) {\r\n          return;\r\n        }\r\n        mapStatus$$.unsubscribe();\r\n        let status = SubjectStatus.Done;\r\n        try {\r\n          if (mapResultCanvas.width !== 0) {\r\n            this.addCanvas(doc, mapResultCanvas, margins);\r\n          }\r\n        } catch (err) {\r\n          status = SubjectStatus.Error;\r\n          this.messageService.error(\r\n            'igo.geo.printForm.corsErrorMessageBody',\r\n            'igo.geo.printForm.corsErrorMessageHeader'\r\n          );\r\n        }\r\n        status$.next(status);\r\n      });\r\n\r\n      // If no loading as started after 200ms, then probably no loading\r\n      // is required.\r\n      timeout = window.setTimeout(() => {\r\n        mapStatus$$.unsubscribe();\r\n\r\n        let status = SubjectStatus.Done;\r\n        try {\r\n          if (mapResultCanvas.width !== 0) {\r\n            this.addCanvas(doc, mapResultCanvas, margins);\r\n          }\r\n        } catch (err) {\r\n          status = SubjectStatus.Error;\r\n          this.messageService.error(\r\n            'igo.geo.printForm.corsErrorMessageBody',\r\n            'igo.geo.printForm.corsErrorMessageHeader'\r\n          );\r\n        }\r\n        this.resetOriginalMapSize(map, mapSize, viewResolution);\r\n        status$.next(status);\r\n      }, 200);\r\n    });\r\n\r\n    return status$;\r\n  }\r\n\r\n  private setMapResolution(\r\n    map: IgoMap,\r\n    initialSize: [number, number],\r\n    resolution: number,\r\n    viewResolution: number\r\n  ): [number, number] {\r\n    const mapSize = map.ol.getSize();\r\n    const widthPixels = Math.round((initialSize[0] * resolution) / 25.4);\r\n    const heightPixels = Math.round((initialSize[1] * resolution) / 25.4);\r\n\r\n    // Set print size\r\n    const printSize = [widthPixels, heightPixels];\r\n    map.ol.setSize(printSize);\r\n    const scaling = Math.min(\r\n      widthPixels / mapSize[0],\r\n      heightPixels / mapSize[1]\r\n    );\r\n    map.ol.getView().setResolution(viewResolution / scaling);\r\n\r\n    return [widthPixels, heightPixels];\r\n  }\r\n\r\n  private resetOriginalMapSize(\r\n    map: IgoMap,\r\n    initialSize: [number, number],\r\n    viewResolution: number\r\n  ) {\r\n    map.ol.setSize(initialSize);\r\n    map.ol.getView().setResolution(viewResolution);\r\n    map.ol.updateSize();\r\n    map.ol.renderSync();\r\n  }\r\n\r\n  async drawMap(\r\n    size: Array<number>,\r\n    mapCanvas: HTMLCollectionOf<HTMLCanvasElement>\r\n  ): Promise<HTMLCanvasElement> {\r\n    const mapResultCanvas = document.createElement('canvas');\r\n    mapResultCanvas.width = size[0];\r\n    mapResultCanvas.height = size[1];\r\n\r\n    for (let index = 0; index < mapCanvas.length; index++) {\r\n      const canvas = mapCanvas[index];\r\n      if (canvas.width > 0) {\r\n        this.handleCanvas(canvas, mapResultCanvas);\r\n      }\r\n    }\r\n    return mapResultCanvas;\r\n  }\r\n\r\n  private handleCanvas(\r\n    canvas: HTMLCanvasElement,\r\n    mapResultCanvas: HTMLCanvasElement\r\n  ) {\r\n    const mapContextResult = mapResultCanvas.getContext('2d');\r\n    const opacity = canvas.parentElement.style.opacity || canvas.style.opacity;\r\n    mapContextResult.globalAlpha = opacity === '' ? 1 : Number(opacity);\r\n    const transform = canvas.style.transform;\r\n    let matrix: number[];\r\n    if (transform) {\r\n      // Get the transform parameters from the style's transform matrix\r\n      matrix = transform\r\n        .match(/^matrix\\(([^\\(]*)\\)$/)[1]\r\n        .split(',')\r\n        .map(Number);\r\n    } else {\r\n      matrix = [\r\n        parseFloat(canvas.style.width) / canvas.width,\r\n        0,\r\n        0,\r\n        parseFloat(canvas.style.height) / canvas.height,\r\n        0,\r\n        0\r\n      ];\r\n    }\r\n    CanvasRenderingContext2D.prototype.setTransform.apply(\r\n      mapContextResult,\r\n      matrix\r\n    );\r\n    const backgroundColor = canvas.parentElement.style.backgroundColor;\r\n    if (backgroundColor) {\r\n      mapContextResult.fillStyle = backgroundColor;\r\n      mapContextResult.fillRect(0, 0, canvas.width, canvas.height);\r\n    }\r\n    mapContextResult.drawImage(canvas, 0, 0);\r\n    mapContextResult.globalAlpha = 1;\r\n    // reset canvas transform to initial\r\n    mapContextResult.setTransform(1, 0, 0, 1, 0, 0);\r\n  }\r\n\r\n  async drawMapControls(\r\n    map: IgoMap,\r\n    canvas: HTMLCanvasElement,\r\n    position: PrintLegendPosition\r\n  ): Promise<void> {\r\n    const context = canvas.getContext('2d');\r\n    // Get the scale and attribution\r\n    // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\r\n    const mapOverlayHTML = map.ol\r\n      .getOverlayContainerStopEvent()\r\n      .cloneNode(true) as HTMLElement;\r\n    // add North Direction to mapOverly\r\n    await this.addNorthDirection(mapOverlayHTML, position);\r\n    // add map Attribution designe to print\r\n    await this.addAttribution(mapOverlayHTML);\r\n\r\n    // set 'OverlayContainer' size to print size\r\n    mapOverlayHTML.style.width = canvas.width + 'px';\r\n    mapOverlayHTML.style.height = canvas.height + 'px';\r\n    // we add zindex -1 to not show modification to the user\r\n    mapOverlayHTML.style.zIndex = '-1';\r\n    // and make sure html2canvas to render the image correctly\r\n    document\r\n      .getElementsByClassName('ol-viewport')[0]\r\n      .appendChild(mapOverlayHTML);\r\n    // Change the styles of hyperlink in the printed version\r\n    // Transform the Overlay into a canvas\r\n    // scale is necessary to make it in google chrome\r\n    // background as null because otherwise it is white and cover the map\r\n    // allowtaint is to allow rendering images in the attributions\r\n    // useCORS: true pour permettre de renderer les images (ne marche pas en local)\r\n    const canvasOverlayHTML = await html2canvas(mapOverlayHTML, {\r\n      scale: 1,\r\n      backgroundColor: null,\r\n      allowTaint: true,\r\n      useCORS: true\r\n    });\r\n\r\n    context.drawImage(canvasOverlayHTML, 0, 0);\r\n    // remove 'mapOverlayHTML' after generating canvas\r\n    mapOverlayHTML.remove();\r\n  }\r\n\r\n  private async addNorthDirection(\r\n    mapOverlayHTML: HTMLElement,\r\n    position: PrintLegendPosition\r\n  ): Promise<void> {\r\n    const northDirection = document\r\n      .getElementsByTagName('igo-rotation-button')[0]\r\n      .cloneNode(true) as HTMLElement;\r\n    const HTMLButton = northDirection.getElementsByTagName(\r\n      'button'\r\n    )[0] as HTMLElement;\r\n    if (!HTMLButton) {\r\n      return null;\r\n    }\r\n    // in case legend position is topright\r\n    // we change rotate btn to topleft\r\n    if (position === 'topright') {\r\n      northDirection.style.width = 'inherit';\r\n      northDirection.style.left = '10px';\r\n    }\r\n    HTMLButton.parentElement.style.background = 'transparent';\r\n    HTMLButton.style.color = '#000';\r\n    mapOverlayHTML.appendChild(northDirection);\r\n  }\r\n\r\n  private async addAttribution(mapOverlayHTML: HTMLElement): Promise<void> {\r\n    const HTMLattribution =\r\n      mapOverlayHTML.getElementsByClassName('ol-attribution')[0];\r\n    const HTMLButton = HTMLattribution.getElementsByTagName('button')[0];\r\n    if (!HTMLButton) {\r\n      return null;\r\n    }\r\n    HTMLButton.setAttribute('data-html2canvas-ignore', 'true');\r\n    const olCollapsed: boolean =\r\n      HTMLattribution.classList.contains('ol-collapsed');\r\n    if (olCollapsed) {\r\n      HTMLattribution.classList.remove('ol-collapsed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Download an image of the map with addition of informations\r\n   * @param  map - Map of the app\r\n   * @param  format - Image format. default value to \"png\"\r\n   * @param  projection - Indicate if projection need to be add. Default to false\r\n   * @param  scale - Indicate if scale need to be add. Default to false\r\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\r\n   * @param  title - Title to add for the map - Default to blank\r\n   * @param  subtitle - Subtitle to add for the map - Default to blank\r\n   * @param  comment - Comment to add for the map - Default to blank\r\n   * @param  doZipFile - Indicate if we do a zip with the file\r\n   * @return Image file of the map with extension format given as parameter\r\n   */\r\n  downloadMapImage(\r\n    map: IgoMap,\r\n    printResolution: PrintResolution,\r\n    format = 'png',\r\n    projection = false,\r\n    scale = false,\r\n    title = '',\r\n    subtitle = '',\r\n    comment = '',\r\n    doZipFile = true,\r\n    legendPosition: PrintLegendPosition\r\n  ) {\r\n    const status$ = new Subject();\r\n    this.activityId = this.activityService.register();\r\n    const translate = this.languageService.translate;\r\n    format = format.toLowerCase();\r\n    const resolution = +printResolution;\r\n    const initialMapSize = map.ol.getSize() as [number, number];\r\n    const viewResolution = map.ol.getView().getResolution();\r\n\r\n    map.ol.once('rendercomplete', async (event: any) => {\r\n      const size = map.ol.getSize();\r\n      const mapCanvas = event.target\r\n        .getViewport()\r\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\r\n      const mapResultCanvas = await this.drawMap(size, mapCanvas);\r\n\r\n      this.resetOriginalMapSize(map, initialMapSize, viewResolution);\r\n\r\n      await this.drawMapControls(map, mapResultCanvas, legendPosition);\r\n      // Check the legendPosition\r\n      if (legendPosition !== 'none') {\r\n        if (\r\n          ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\r\n            legendPosition\r\n          ) > -1\r\n        ) {\r\n          await this.addLegendToImage(\r\n            mapResultCanvas,\r\n            map,\r\n            resolution,\r\n            legendPosition,\r\n            format\r\n          );\r\n        } else if (legendPosition === 'newpage') {\r\n          await this.getLayersLegendImage(map, format, doZipFile, resolution);\r\n        }\r\n      }\r\n      // add other information to final canvas before exporting\r\n      const newCanvas = document.createElement('canvas');\r\n      const newContext = newCanvas.getContext('2d');\r\n      // Postion in height to set the canvas in new canvas\r\n      let positionHCanvas = 0;\r\n      // Get height/width of map canvas\r\n      const width = mapResultCanvas.width;\r\n      let height = mapResultCanvas.height;\r\n      // Set Font to calculate comment width\r\n      newContext.font = '20px Calibri';\r\n      const commentWidth = newContext.measureText(comment).width;\r\n      // Add height for title if defined\r\n      height = title !== '' ? height + 30 : height;\r\n      // Add height for title if defined\r\n      height = subtitle !== '' ? height + 30 : height;\r\n      // Add height for projection or scale (same line) if defined\r\n      height = projection !== false || scale !== false ? height + 30 : height;\r\n      const positionHProjScale = height - 10;\r\n      // Define number of line depending of the comment length\r\n      const commentNbLine = Math.ceil(commentWidth / width);\r\n      // Add height for multiline comment if defined\r\n      height = comment !== '' ? height + commentNbLine * 30 : height;\r\n      let positionHComment = height - commentNbLine * 20 + 5;\r\n      // Set the new canvas with the new calculated size\r\n      newCanvas.width = width;\r\n      newCanvas.height = height;\r\n\r\n      if (['bmp', 'gif', 'jpeg', 'png', 'tiff'].indexOf(format) > -1) {\r\n        // Patch Jpeg default black background to white\r\n        if (\r\n          format === 'jpeg' ||\r\n          title !== '' ||\r\n          subtitle !== '' ||\r\n          comment !== '' ||\r\n          projection !== false ||\r\n          scale !== false\r\n        ) {\r\n          newContext.fillStyle = '#ffffff';\r\n          newContext.fillRect(0, 0, width, height);\r\n          newContext.fillStyle = '#000000';\r\n        }\r\n      }\r\n      // If a title need to be added to canvas\r\n      if (title !== '') {\r\n        // Set font for title\r\n        // Adjust according to title length\r\n        newContext.font = '26px Calibri';\r\n        positionHCanvas = 30;\r\n        newContext.textAlign = 'center';\r\n        newContext.fillText(title, width / 2, 20, width * 0.9);\r\n      }\r\n\r\n      if (subtitle !== '') {\r\n        // Set font for subtitle\r\n        // Adjust according to title length\r\n        newContext.font = '26px Calibri';\r\n        positionHCanvas = 60;\r\n        newContext.textAlign = 'center';\r\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\r\n      }\r\n\r\n      // Set font for next section\r\n      newContext.font = '20px Calibri';\r\n      // If projection or/end scale need to be added to canvas\r\n      if (projection !== false || scale !== false) {\r\n        let projectionScaleText = '';\r\n        if (projection !== false) {\r\n          const projText = translate.instant('igo.geo.printForm.projection');\r\n          projectionScaleText = projText + ': ' + map.projection + '         ';\r\n        }\r\n\r\n        if (scale !== false) {\r\n          const scaleText = translate.instant('igo.geo.printForm.scale');\r\n          const mapScale = map.viewController.getScale(resolution);\r\n          projectionScaleText += scaleText + ': ~ 1 / ' + formatScale(mapScale);\r\n        }\r\n        newContext.textAlign = 'center';\r\n        newContext.fillText(\r\n          projectionScaleText,\r\n          width / 2,\r\n          positionHProjScale,\r\n          width * 0.9\r\n        );\r\n      }\r\n\r\n      // If a comment need to be added to canvas\r\n      if (comment !== '') {\r\n        newContext.textAlign = 'center';\r\n        // If only one line, no need to multiline the comment\r\n        if (commentNbLine === 1) {\r\n          newContext.fillText(comment, width / 2, positionHComment);\r\n        } else {\r\n          // Separate the setenses to be approx. the same length\r\n          const nbCommentChar = comment.length;\r\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\r\n          let commentCurrentLine = '';\r\n          let positionFirstCutChar = 0;\r\n          let positionLastBlank;\r\n          // Loop for the number of line calculated\r\n          for (let i = 0; i < commentNbLine; i++) {\r\n            // For all line except last\r\n            if (commentNbLine - 1 > i) {\r\n              // Get comment current line to find the right place tu cut comment\r\n              commentCurrentLine = comment.substr(\r\n                positionFirstCutChar,\r\n                CommentLengthToCut\r\n              );\r\n              // Cut the setence at blank\r\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\r\n              newContext.fillText(\r\n                commentCurrentLine.substr(0, positionLastBlank),\r\n                width / 2,\r\n                positionHComment\r\n              );\r\n              positionFirstCutChar += positionLastBlank;\r\n              // Go to next line for insertion\r\n              positionHComment += 20;\r\n            } else {\r\n              // Don't cut last part\r\n              newContext.fillText(\r\n                comment.substr(positionFirstCutChar),\r\n                width / 2,\r\n                positionHComment\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      newContext.drawImage(mapResultCanvas, 0, positionHCanvas);\r\n\r\n      let status = SubjectStatus.Done;\r\n      let fileNameWithExt = 'map.' + format;\r\n      if (format.toLowerCase() === 'tiff') {\r\n        fileNameWithExt =\r\n          'map' + map.projection.replace(':', '_') + '.' + format;\r\n      }\r\n\r\n      try {\r\n        // Save the canvas as file\r\n        if (!doZipFile) {\r\n          this.saveCanvasImageAsFile(newCanvas, fileNameWithExt, format);\r\n        } else if (format.toLowerCase() === 'tiff') {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\r\n        }\r\n      } catch (err) {\r\n        status = SubjectStatus.Error;\r\n      }\r\n      status$.next(status);\r\n\r\n      if (format.toLowerCase() === 'tiff') {\r\n        const tfwFileNameWithExt =\r\n          fileNameWithExt.substring(\r\n            0,\r\n            fileNameWithExt.toLowerCase().indexOf('.tiff')\r\n          ) + '.tfw';\r\n        const tiwContent = this.getWorldFileInformation(map);\r\n        const blob = new Blob([tiwContent], {\r\n          type: 'text/plain;charset=utf-8'\r\n        });\r\n        if (!doZipFile) {\r\n          // saveAs automaticly replace ':' for '_'\r\n          saveAs(blob, tfwFileNameWithExt);\r\n          this.saveFileProcessing();\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.addFileToZip(tfwFileNameWithExt, blob);\r\n        }\r\n      }\r\n    });\r\n\r\n    this.setMapImageResolution(map, initialMapSize, resolution, viewResolution);\r\n\r\n    return status$;\r\n  }\r\n\r\n  private setMapImageResolution(\r\n    map: IgoMap,\r\n    initialMapSize: [number, number],\r\n    resolution: number,\r\n    viewResolution: number\r\n  ): void {\r\n    const scaleFactor = resolution / 96;\r\n    const newMapSize = [\r\n      Math.round(initialMapSize[0] * scaleFactor), // width\r\n      Math.round(initialMapSize[1] * scaleFactor) // height\r\n    ];\r\n    map.ol.setSize(newMapSize);\r\n    const scaling = Math.min(\r\n      newMapSize[0] / initialMapSize[0],\r\n      newMapSize[1] / initialMapSize[1]\r\n    );\r\n    const view = map.ol.getView();\r\n    view.setResolution(viewResolution / scaling);\r\n    map.ol.renderSync();\r\n  }\r\n\r\n  /**\r\n   * Create and Add Legend to the map canvas\r\n   * @param  canvas Canvas of the map\r\n   * @param  map Map of the app\r\n   * @param  resolution Resolution of map\r\n   * @param  legendPosition Legend position\r\n   * @param  format Image format\r\n   */\r\n  private async addLegendToImage(\r\n    canvas: HTMLCanvasElement,\r\n    map: IgoMap,\r\n    resolution: number,\r\n    legendPosition: string,\r\n    format: string\r\n  ) {\r\n    const fileNameWithExt = 'map.' + format;\r\n    const context = canvas.getContext('2d');\r\n\r\n    // Get html code for the legend\r\n    const html = await this.getLayersLegendHtml(\r\n      map,\r\n      canvas.width,\r\n      resolution\r\n    ).toPromise();\r\n    // If no legend, save the map directly\r\n    if (html === '') {\r\n      await this.saveCanvasImageAsFile(canvas, fileNameWithExt, format);\r\n      return true;\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.top = '0';\r\n    div.style.zIndex = '-1';\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n    await this.timeout(1);\r\n    const canvasLegend = await html2canvas(div, { useCORS: true }).catch(\r\n      (e) => {\r\n        console.log(e);\r\n      }\r\n    );\r\n\r\n    if (canvasLegend) {\r\n      const canvasHeight = canvas.height;\r\n      const canvasWidth = canvas.width;\r\n      const legendHeight = canvasLegend.height;\r\n      const legendWidth = canvasLegend.width;\r\n      // Move the legend to the correct position on the page\r\n      const offset = canvasHeight * 0.01;\r\n      let legendX: number;\r\n      let legendY: number;\r\n\r\n      if (legendPosition === 'bottomright') {\r\n        legendX = canvasWidth - legendWidth - offset;\r\n        legendY = canvasHeight - legendHeight - offset;\r\n      } else if (legendPosition === 'topright') {\r\n        legendX = canvasWidth - legendWidth - offset;\r\n        legendY = offset;\r\n      } else if (legendPosition === 'bottomleft') {\r\n        legendX = offset;\r\n        legendY = canvasHeight - legendHeight - offset - 15;\r\n      } else if (legendPosition === 'topleft') {\r\n        legendX = offset;\r\n        legendY = offset;\r\n      }\r\n\r\n      context.drawImage(\r\n        canvasLegend,\r\n        legendX,\r\n        legendY,\r\n        legendWidth,\r\n        legendHeight\r\n      );\r\n      context.strokeRect(legendX, legendY, legendWidth, legendHeight);\r\n      this.removeHtmlElement(div);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  private renderMap(map, size, extent) {\r\n    map.ol.updateSize();\r\n    map.ol.renderSync();\r\n  }\r\n\r\n  /**\r\n   * Save document\r\n   * @param  doc - Document to save\r\n   */\r\n  protected async saveDoc(doc: jsPDF) {\r\n    await doc.save('map_georef.pdf', { returnPromise: true });\r\n  }\r\n\r\n  /**\r\n   * Calculate the best Image size to fit in pdf\r\n   * @param doc - Pdf Document\r\n   * @param canvas - Canvas of image\r\n   * @param margins - Page margins\r\n   */\r\n  getImageSizeToFitPdf(doc, canvas, margins) {\r\n    // Define variable to calculate best size to fit in one page\r\n    const pageHeight =\r\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2] + 10);\r\n    const pageWidth =\r\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\r\n    const canHeight = this.pdf_units2points(canvas.height, 'mm');\r\n    const canWidth = this.pdf_units2points(canvas.width, 'mm');\r\n\r\n    const heightRatio = canHeight / pageHeight;\r\n    const widthRatio = canWidth / pageWidth;\r\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\r\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\r\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\r\n    return [imgWidth, imgHeigh];\r\n  }\r\n\r\n  /**\r\n   * Get a world file information for tiff\r\n   * @param  map - Map of the app\r\n   */\r\n  private getWorldFileInformation(map) {\r\n    const currentResolution = map.viewController.getResolution();\r\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\r\n    return [\r\n      currentResolution,\r\n      0,\r\n      0,\r\n      -currentResolution,\r\n      currentExtent[0] + currentResolution / 0.5,\r\n      currentExtent[3] - currentResolution / 0.5\r\n    ].join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Save canvas image as file\r\n   * @param canvas - Canvas to save\r\n   * @param name - Name of the file\r\n   * @param format - file format\r\n   */\r\n  private saveCanvasImageAsFile(canvas, nameWithExt, format) {\r\n    const blobFormat = 'image/' + format;\r\n    const that = this;\r\n\r\n    try {\r\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\r\n      canvas.toBlob((blob) => {\r\n        // download image\r\n        saveAs(blob, nameWithExt);\r\n        that.saveFileProcessing();\r\n      }, blobFormat);\r\n    } catch (err) {\r\n      this.messageService.error(\r\n        'igo.geo.printForm.corsErrorMessageBody',\r\n        'igo.geo.printForm.corsErrorMessageHeader'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add file to a zip\r\n   * @param canvas - File to add to the zip\r\n   * @param  name -Name of the fileoverview\r\n   */\r\n  private generateCanvaFileToZip(canvas, name) {\r\n    const blobFormat = 'image/' + 'jpeg';\r\n    const that = this;\r\n    if (\r\n      !this.hasOwnProperty('zipFile') ||\r\n      typeof this.zipFile === 'undefined'\r\n    ) {\r\n      this.zipFile = new JSZip();\r\n    }\r\n\r\n    try {\r\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\r\n      if (navigator.msSaveBlob) {\r\n        this.addFileToZip(name, canvas.msToBlob());\r\n      } else {\r\n        canvas.toBlob((blob) => {\r\n          that.addFileToZip(name, blob);\r\n        }, blobFormat);\r\n      }\r\n    } catch (err) {\r\n      this.messageService.error(\r\n        'igo.geo.printForm.corsErrorMessageBody',\r\n        'igo.geo.printForm.corsErrorMessageHeader'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add file to zip, if all file are zipped, download\r\n   * @param name - Name of the files\r\n   * @param blob - Contain of file\r\n   */\r\n  private addFileToZip(name, blob) {\r\n    // add file to zip\r\n    this.zipFile.file(name, blob);\r\n    this.nbFileToProcess--;\r\n\r\n    // If all files are proccessed\r\n    if (this.nbFileToProcess === 0) {\r\n      // Download zip file\r\n      this.getZipFile();\r\n      // Stop loading\r\n      this.activityService.unregister(this.activityId);\r\n    }\r\n  }\r\n\r\n  private saveFileProcessing() {\r\n    this.nbFileToProcess--;\r\n\r\n    // If all files are proccessed\r\n    if (this.nbFileToProcess === 0) {\r\n      // Stop loading\r\n      this.activityService.unregister(this.activityId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the zipped file\r\n   * @return Retun a zip file\r\n   */\r\n  private getZipFile() {\r\n    const that = this;\r\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\r\n      // 1) generate the zip file\r\n      saveAs(blob, 'map.zip');\r\n      delete that.zipFile;\r\n    });\r\n  }\r\n\r\n  private pdf_units2points(n, unit): number {\r\n    let k = 1;\r\n\r\n    // this code is borrowed from jsPDF\r\n    //  as it does not expose a public API\r\n    //  for converting units to points.\r\n    switch (unit) {\r\n      case 'pt':\r\n        k = 1;\r\n        break;\r\n      case 'mm':\r\n        k = 72 / 25.4;\r\n        break;\r\n      case 'cm':\r\n        k = 72 / 2.54;\r\n        break;\r\n      case 'in':\r\n        k = 72;\r\n        break;\r\n      case 'px':\r\n        k = 96 / 72;\r\n        break;\r\n      case 'pc':\r\n        k = 12;\r\n        break;\r\n      case 'em':\r\n        k = 12;\r\n        break;\r\n      case 'ex':\r\n        k = 6;\r\n        break;\r\n      default:\r\n        throw new Error('Invalid unit: ' + unit);\r\n    }\r\n\r\n    return n * k;\r\n  }\r\n}\r\n","import { Layer } from '../shared/layers/layer';\nimport {\n  LegendMapViewOptions,\n  OutputLayerLegend\n} from '../shared/layers/legend.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(\n  layers: Layer[],\n  view?: LegendMapViewOptions\n): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    const legendOptions = layer.options.legendOptions;\n    if (layer.visible === false) {\n      continue;\n    }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) {\n        continue;\n      }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title || '',\n        url: legendUrl.url,\n        display:\n          legendOptions?.display === undefined ? true : legendOptions.display,\n        isInResolutionsRange: layer.isInResolutionsRange\n      });\n    }\n  }\n\n  return legends;\n}\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.title' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\n      />\n      <mat-error *ngIf=\"titleField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.title' | translate,\n                value: 130\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.subtitle' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{ 'igo.geo.printForm.subtitle' | translate }}\"\n      />\n      <mat-error *ngIf=\"subtitleField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.subtitle' | translate,\n                value: 120\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.comment' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{ 'igo.geo.printForm.comment' | translate }}\"\n      />\n      <mat-error *ngIf=\"commentField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.comment' | translate,\n                value: maxLength\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container slide-toggle-container\">\n    <div class=\"print-slide-toggle-container\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\"\n      >\n        {{ 'igo.geo.printForm.showProjection' | translate }}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\"\n      >\n        {{ 'igo.geo.printForm.showScale' | translate }}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\"\n      >\n        {{ 'igo.geo.printForm.doZipFile' | translate }}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.printForm.legendPosition' | translate\n      }}</mat-label>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{ 'igo.geo.printForm.legendPosition' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let legendPosition of legendPositions | keyvalue\"\n          [value]=\"legendPosition.key\"\n        >\n          <ng-container\n            *ngIf=\"!['newpage', 'newimage'].includes(legendPosition.value)\"\n          >\n            {{\n              'igo.geo.printForm.legendPositions.' + legendPosition.value\n                | translate\n            }}\n          </ng-container>\n\n          <ng-container\n            *ngIf=\"['newpage', 'newimage'].includes(legendPosition.value)\"\n          >\n            {{\n              (outputFormat === 'Pdf'\n                ? 'igo.geo.printForm.legendPositions.newpage'\n                : 'igo.geo.printForm.legendPositions.newimage'\n              ) | translate\n            }}\n          </ng-container>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.outputFormat' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.outputFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let outputFormat of outputFormats | keyvalue\"\n          [value]=\"outputFormat.key\"\n        >\n          {{ outputFormat.value }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.paperFormat' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"paperFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.paperFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let paperFormat of paperFormats | keyvalue\"\n          [value]=\"paperFormat.key\"\n        >\n          {{\n            'igo.geo.printForm.paperFormats.' + paperFormat.value | translate\n          }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'none' : 'block'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.imageFormat' | translate }}</mat-label>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.imageFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let imageFormat of imageFormats | keyvalue\"\n          [value]=\"imageFormat.key\"\n        >\n          {{ imageFormat.value }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.resolution' | translate }}</mat-label>\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{ 'igo.geo.printForm.resolution' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let resolution of resolutions | keyvalue\"\n          [value]=\"resolution.key\"\n        >\n          {{ resolution.value + ' PPI' }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.orientation' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"orientation\"\n        placeholder=\"{{ 'igo.geo.printForm.orientation' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let orientation of orientations | keyvalue\"\n          [value]=\"orientation.key\"\n        >\n          {{ 'igo.geo.printForm.' + orientation.value | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\"\n    >\n      {{ 'igo.geo.printForm.saveBtn' | translate }}\n    </button>\n  </div>\n</form>\n","import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormControl,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { PrintOptions } from '../shared/print.interface';\r\nimport {\r\n  PrintLegendPosition,\r\n  PrintOrientation,\r\n  PrintOutputFormat,\r\n  PrintPaperFormat,\r\n  PrintResolution,\r\n  PrintSaveImageFormat\r\n} from '../shared/print.type';\r\n\r\n@Component({\r\n  selector: 'igo-print-form',\r\n  templateUrl: './print-form.component.html',\r\n  styleUrls: ['./print-form.component.scss']\r\n})\r\nexport class PrintFormComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n  public outputFormats = PrintOutputFormat;\r\n  public paperFormats = PrintPaperFormat;\r\n  public orientations = PrintOrientation;\r\n  public resolutions = PrintResolution;\r\n  public imageFormats = PrintSaveImageFormat;\r\n  public legendPositions = PrintLegendPosition;\r\n  public isPrintService = true;\r\n\r\n  @Input() disabled$: BehaviorSubject<boolean>;\r\n\r\n  @Input()\r\n  get imageFormat(): PrintSaveImageFormat {\r\n    return this.imageFormatField.value;\r\n  }\r\n  set imageFormat(value: PrintSaveImageFormat) {\r\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get outputFormat(): PrintOutputFormat {\r\n    return this.outputFormatField.value;\r\n  }\r\n  set outputFormat(value: PrintOutputFormat) {\r\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get paperFormat(): PrintPaperFormat {\r\n    return this.paperFormatField.value;\r\n  }\r\n  set paperFormat(value: PrintPaperFormat) {\r\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get orientation(): PrintOrientation {\r\n    return this.orientationField.value;\r\n  }\r\n  set orientation(value: PrintOrientation) {\r\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get resolution(): PrintResolution {\r\n    return this.resolutionField.value;\r\n  }\r\n  set resolution(value: PrintResolution) {\r\n    this.resolutionField.setValue(value || PrintResolution['96'], {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get legendPosition(): PrintLegendPosition {\r\n    return this.legendPositionField.value;\r\n  }\r\n  set legendPosition(value: PrintLegendPosition) {\r\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get title(): string {\r\n    return this.titleField.value;\r\n  }\r\n  set title(value: string) {\r\n    this.titleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get subtitle(): string {\r\n    return this.subtitleField.value;\r\n  }\r\n  set subtitle(value: string) {\r\n    this.subtitleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get comment(): string {\r\n    return this.commentField.value;\r\n  }\r\n  set comment(value: string) {\r\n    this.commentField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showProjection(): boolean {\r\n    return this.showProjectionField.value;\r\n  }\r\n  set showProjection(value: boolean) {\r\n    this.showProjectionField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showScale(): boolean {\r\n    return this.showScaleField.value;\r\n  }\r\n  set showScale(value: boolean) {\r\n    this.showScaleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showLegend(): boolean {\r\n    return this.showLegendField.value;\r\n  }\r\n  set showLegend(value: boolean) {\r\n    this.showLegendField.setValue(value, { onlySelf: true });\r\n  }\r\n\r\n  @Input()\r\n  get doZipFile(): boolean {\r\n    return this.doZipFileField.value;\r\n  }\r\n  set doZipFile(value: boolean) {\r\n    this.doZipFileField.setValue(value, { onlySelf: true });\r\n  }\r\n\r\n  get outputFormatField() {\r\n    return (this.form.controls as any).outputFormat as UntypedFormControl;\r\n  }\r\n\r\n  get paperFormatField() {\r\n    return (this.form.controls as any).paperFormat as UntypedFormControl;\r\n  }\r\n\r\n  get imageFormatField() {\r\n    return (this.form.controls as any).imageFormat as UntypedFormControl;\r\n  }\r\n\r\n  get orientationField() {\r\n    return (this.form.controls as any).orientation as UntypedFormControl;\r\n  }\r\n\r\n  get resolutionField() {\r\n    return (this.form.controls as any).resolution as UntypedFormControl;\r\n  }\r\n\r\n  get commentField() {\r\n    return (this.form.controls as any).comment as UntypedFormControl;\r\n  }\r\n\r\n  get showProjectionField() {\r\n    return (this.form.controls as any).showProjection as UntypedFormControl;\r\n  }\r\n\r\n  get showScaleField() {\r\n    return (this.form.controls as any).showScale as UntypedFormControl;\r\n  }\r\n\r\n  get showLegendField() {\r\n    return (this.form.controls as any).showLegend as UntypedFormControl;\r\n  }\r\n\r\n  get doZipFileField() {\r\n    return (this.form.controls as any).doZipFile as UntypedFormControl;\r\n  }\r\n\r\n  get titleField() {\r\n    return (this.form.controls as any).title as UntypedFormControl;\r\n  }\r\n\r\n  get subtitleField() {\r\n    return (this.form.controls as any).subtitle as UntypedFormControl;\r\n  }\r\n\r\n  get legendPositionField() {\r\n    return (this.form.controls as any).legendPosition as UntypedFormControl;\r\n  }\r\n\r\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\r\n\r\n  maxLength: number = 180;\r\n\r\n  constructor(private formBuilder: UntypedFormBuilder) {\r\n    this.form = this.formBuilder.group({\r\n      title: ['', [Validators.minLength(0), Validators.maxLength(130)]],\r\n      subtitle: ['', [Validators.minLength(0), Validators.maxLength(120)]],\r\n      comment: [\r\n        '',\r\n        [Validators.minLength(0), Validators.maxLength(this.maxLength)]\r\n      ],\r\n      outputFormat: ['', [Validators.required]],\r\n      paperFormat: ['', [Validators.required]],\r\n      imageFormat: ['', [Validators.required]],\r\n      resolution: ['', [Validators.required]],\r\n      orientation: ['', [Validators.required]],\r\n      legendPosition: ['', [Validators.required]],\r\n      showProjection: false,\r\n      showScale: false,\r\n      showLegend: false,\r\n      doZipFile: [{ hidden: this.isPrintService }]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.doZipFileField.setValue(false);\r\n  }\r\n\r\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\r\n    data.isPrintService = this.isPrintService;\r\n    if (isValid) {\r\n      this.submit.emit(data);\r\n    }\r\n  }\r\n\r\n  toggleImageSaveProp() {\r\n    if (this.outputFormatField.value === 'Image') {\r\n      this.isPrintService = false;\r\n      this.commentField.clearValidators();\r\n      this.commentField.updateValueAndValidity();\r\n    } else {\r\n      this.isPrintService = true;\r\n    }\r\n  }\r\n\r\n  changeCommentLength() {\r\n    switch (this.paperFormat) {\r\n      case PrintPaperFormat.A0:\r\n        // A0, landscape, length 900 | A0, portrait, comment length:  600\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 900 : 600;\r\n        break;\r\n      case PrintPaperFormat.A1:\r\n        // A1, landscape, length 600 | A1, portrait, length 400;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 600 : 400;\r\n        break;\r\n      case PrintPaperFormat.A2:\r\n        // A2, landscape, length 400 | A2, portrait, length 300;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 400 : 300;\r\n        break;\r\n      case PrintPaperFormat.A3:\r\n        // A3, landscape, length 300 | A3, portrait, length 200;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 300 : 200;\r\n        break;\r\n      case PrintPaperFormat.A4:\r\n        // A4, landscape length 200 | A4, portrait length 120;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 200 : 100;\r\n        break;\r\n      case PrintPaperFormat.A5:\r\n        // A5, landscape length 120 | A5, portrait length 80;\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 120 : 80;\r\n        break;\r\n      case PrintPaperFormat.Letter:\r\n        // lettre, landscape, 180 | lettre, portrait, 140\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 180 : 140;\r\n        break;\r\n      default:\r\n        // legal, landscape, 200 | legal, portrait, 140\r\n        this.maxLength =\r\n          this.orientation === PrintOrientation.landscape ? 200 : 140;\r\n        break;\r\n    }\r\n\r\n    this.commentField.setValidators([Validators.maxLength(this.maxLength)]);\r\n    this.commentField.updateValueAndValidity();\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { PrintOptions } from '../shared/print.interface';\r\nimport { PrintService } from '../shared/print.service';\r\nimport {\r\n  PrintLegendPosition,\r\n  PrintOrientation,\r\n  PrintOutputFormat,\r\n  PrintPaperFormat,\r\n  PrintResolution,\r\n  PrintSaveImageFormat\r\n} from '../shared/print.type';\r\n\r\n@Component({\r\n  selector: 'igo-print',\r\n  templateUrl: './print.component.html'\r\n})\r\nexport class PrintComponent {\r\n  public disabled$ = new BehaviorSubject(false);\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get outputFormat(): PrintOutputFormat {\r\n    return this._outputFormat;\r\n  }\r\n  set outputFormat(value: PrintOutputFormat) {\r\n    this._outputFormat = value;\r\n  }\r\n  private _outputFormat: PrintOutputFormat;\r\n\r\n  @Input()\r\n  get paperFormat(): PrintPaperFormat {\r\n    return this._paperFormat;\r\n  }\r\n  set paperFormat(value: PrintPaperFormat) {\r\n    this._paperFormat = value;\r\n  }\r\n  private _paperFormat: PrintPaperFormat;\r\n\r\n  @Input()\r\n  get orientation(): PrintOrientation {\r\n    return this._orientation;\r\n  }\r\n  set orientation(value: PrintOrientation) {\r\n    this._orientation = value;\r\n  }\r\n  private _orientation: PrintOrientation;\r\n\r\n  @Input()\r\n  get imageFormat(): PrintSaveImageFormat {\r\n    return this._imageFormat;\r\n  }\r\n  set imageFormat(value: PrintSaveImageFormat) {\r\n    this._imageFormat = value;\r\n  }\r\n  private _imageFormat: PrintSaveImageFormat;\r\n\r\n  @Input()\r\n  get legendPosition(): PrintLegendPosition {\r\n    return this._legendPosition;\r\n  }\r\n  set legendPosition(value: PrintLegendPosition) {\r\n    this._legendPosition = value;\r\n  }\r\n  private _legendPosition: PrintLegendPosition;\r\n\r\n  @Input()\r\n  get resolution(): PrintResolution {\r\n    return this._resolution;\r\n  }\r\n  set resolution(value: PrintResolution) {\r\n    this._resolution = value;\r\n  }\r\n  private _resolution: PrintResolution;\r\n\r\n  constructor(private printService: PrintService) {}\r\n\r\n  handleFormSubmit(data: PrintOptions) {\r\n    this.disabled$.next(true);\r\n\r\n    if (data.isPrintService === true) {\r\n      this.printService\r\n        .print(this.map, data)\r\n        .pipe(take(1))\r\n        .subscribe(() => {\r\n          this.disabled$.next(false);\r\n        });\r\n    } else {\r\n      let nbFileToProcess = 1;\r\n\r\n      if (data.showLegend) {\r\n        nbFileToProcess++;\r\n      }\r\n      if (data.imageFormat.toLowerCase() === 'tiff') {\r\n        nbFileToProcess++;\r\n      }\r\n\r\n      if (data.legendPosition === 'newpage') {\r\n        nbFileToProcess++;\r\n      }\r\n\r\n      this.printService.defineNbFileToProcess(nbFileToProcess);\r\n\r\n      this.printService\r\n        .downloadMapImage(\r\n          this.map,\r\n          data.resolution,\r\n          data.imageFormat,\r\n          data.showProjection,\r\n          data.showScale,\r\n          data.title,\r\n          data.subtitle,\r\n          data.comment,\r\n          data.doZipFile,\r\n          data.legendPosition\r\n        )\r\n        .pipe(take(1))\r\n        .subscribe(() => {\r\n          this.disabled$.next(false);\r\n        });\r\n    }\r\n  }\r\n}\r\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\"\n>\n</igo-print-form>\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import { LanguageService } from '@igo2/core';\r\nimport { NumberUtils, uuid } from '@igo2/utils';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport * as olGeom from 'ol/geom';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olProj from 'ol/proj';\r\nimport * as olStyle from 'ol/style';\r\n\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\r\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\r\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\r\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\r\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { createOverlayMarkerStyle } from '../../style/shared/overlay/overlay-marker-style.utils';\r\nimport {\r\n  DirectionRelativePositionType,\r\n  DirectionType\r\n} from './directions.enum';\r\nimport {\r\n  Direction,\r\n  FeatureWithDirection,\r\n  FeatureWithStop,\r\n  Stop\r\n} from './directions.interface';\r\nimport {\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsFeatureStore,\r\n  StopsStore\r\n} from './store';\r\n\r\n/**\r\n * Function that updat the sort of the list base on the provided field.\r\n * @param source stop store\r\n * @param direction asc / desc sort order\r\n * @param field the field to use to sort the view\r\n */\r\nexport function updateStoreSorting(\r\n  stopsStore: StopsStore,\r\n  direction: 'asc' | 'desc' = 'asc',\r\n  field = 'position'\r\n) {\r\n  stopsStore.view.sort({\r\n    direction,\r\n    valueAccessor: (entity: Stop) => entity[field]\r\n  });\r\n}\r\n\r\nexport function computeRelativePosition(\r\n  index: number,\r\n  totalLength\r\n): DirectionRelativePositionType {\r\n  let relativePosition = DirectionRelativePositionType.Intermediate;\r\n  if (index === 0) {\r\n    relativePosition = DirectionRelativePositionType.Start;\r\n  } else if (index === totalLength - 1) {\r\n    relativePosition = DirectionRelativePositionType.End;\r\n  }\r\n  return relativePosition;\r\n}\r\n\r\nexport function computeStopsPosition(stopsStore: StopsStore) {\r\n  const stopsToComputePosition = [...stopsStore.all()];\r\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\r\n  stopsToComputePosition.map((stop, i) => {\r\n    stop.position = i;\r\n    stop.relativePosition = computeRelativePosition(\r\n      stop.position,\r\n      stopsToComputePosition.length\r\n    );\r\n  });\r\n  if (stopsToComputePosition) {\r\n    stopsStore.updateMany(stopsToComputePosition);\r\n  }\r\n}\r\n\r\n/**\r\n * Function that add a stop to the stop store. Stop are always added before the last stop.\r\n * @param stopsStore stop store as an EntityStore\r\n */\r\nexport function addStopToStore(stopsStore: StopsStore): Stop {\r\n  const id = uuid();\r\n  const stops = stopsStore.all();\r\n  let positions: number[];\r\n  if (stopsStore.count === 0) {\r\n    positions = [0];\r\n  } else {\r\n    positions = stops.map((stop) => stop.position);\r\n  }\r\n  const maxPosition: number = Math.max(...positions);\r\n  const insertPosition: number = maxPosition;\r\n  const lastPosition: number = maxPosition + 1;\r\n\r\n  const stopToUpdate = stopsStore\r\n    .all()\r\n    .find((stop) => stop.position === maxPosition);\r\n  if (stopToUpdate) {\r\n    stopToUpdate.position = lastPosition;\r\n    stopToUpdate.relativePosition = computeRelativePosition(\r\n      lastPosition,\r\n      stopsStore.count + 1\r\n    );\r\n  }\r\n\r\n  stopsStore.insert({\r\n    id,\r\n    position: insertPosition,\r\n    relativePosition: computeRelativePosition(\r\n      insertPosition,\r\n      stopsStore.count + 1\r\n    )\r\n  });\r\n\r\n  updateStoreSorting(stopsStore);\r\n  return stopsStore.get(id);\r\n}\r\n\r\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\r\n  stopsStore.delete(stop);\r\n  computeStopsPosition(stopsStore);\r\n}\r\n\r\n/**\r\n * Create a style for the directions stops and routes\r\n * @param feature OlFeature\r\n * @returns OL style function\r\n */\r\nexport function directionsStyle(\r\n  feature: olFeature<OlGeometry>,\r\n  resolution: number\r\n): olStyle.Style | olStyle.Style[] {\r\n  const vertexStyle = [\r\n    new olStyle.Style({\r\n      geometry: feature.getGeometry(),\r\n      image: new olStyle.Circle({\r\n        radius: 7,\r\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\r\n      })\r\n    })\r\n  ];\r\n\r\n  const stopStyle = createOverlayMarkerStyle({\r\n    text: feature.get('stopText'),\r\n    opacity: feature.get('stopOpacity'),\r\n    markerColor: feature.get('stopColor'),\r\n    markerOutlineColor: [255, 255, 255]\r\n  });\r\n\r\n  const routeStyle = [\r\n    new olStyle.Style({\r\n      stroke: new olStyle.Stroke({\r\n        color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`,\r\n        width: 10\r\n      })\r\n    }),\r\n    new olStyle.Style({\r\n      stroke: new olStyle.Stroke({\r\n        color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`,\r\n        width: 6\r\n      })\r\n    })\r\n  ];\r\n\r\n  if (feature.get('type') === DirectionType.Stop) {\r\n    return stopStyle;\r\n  }\r\n  if (feature.get('type') === 'vertex') {\r\n    return vertexStyle;\r\n  }\r\n  if (feature.get('type') === DirectionType.Route) {\r\n    return routeStyle;\r\n  }\r\n}\r\n\r\nexport function initStopsFeatureStore(\r\n  stopsFeatureStore: StopsFeatureStore,\r\n  languageService: LanguageService\r\n) {\r\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\r\n    motion: FeatureMotion.None\r\n  });\r\n\r\n  const stopsLayer = new VectorLayer({\r\n    isIgoInternalLayer: true,\r\n    id: 'igo-direction-stops-layer',\r\n    title: languageService.translate.instant(\r\n      'igo.geo.directionsForm.stopLayer'\r\n    ),\r\n    zIndex: 911,\r\n    source: new FeatureDataSource(),\r\n    showInLayerList: true,\r\n    workspace: {\r\n      enabled: false\r\n    },\r\n    linkedLayers: {\r\n      linkId: 'igo-direction-stops-layer',\r\n      links: [\r\n        {\r\n          syncedDelete: true,\r\n          linkedIds: ['igo-direction-route-layer'],\r\n          properties: []\r\n        }\r\n      ]\r\n    },\r\n    exportable: true,\r\n    browsable: false,\r\n    style: directionsStyle\r\n  });\r\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\r\n  stopsFeatureStore.layer.visible = true;\r\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\r\n}\r\n\r\nexport function initRoutesFeatureStore(\r\n  routesFeatureStore: RoutesFeatureStore,\r\n  languageService: LanguageService\r\n) {\r\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\r\n    motion: FeatureMotion.None\r\n  });\r\n\r\n  const routeLayer = new VectorLayer({\r\n    isIgoInternalLayer: true,\r\n    id: 'igo-direction-route-layer',\r\n    title: languageService.translate.instant(\r\n      'igo.geo.directionsForm.routeLayer'\r\n    ),\r\n    zIndex: 910,\r\n    source: new FeatureDataSource(),\r\n    showInLayerList: true,\r\n    workspace: {\r\n      enabled: false\r\n    },\r\n    linkedLayers: {\r\n      linkId: 'igo-direction-route-layer'\r\n    },\r\n    exportable: true,\r\n    browsable: false,\r\n    style: directionsStyle\r\n  });\r\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\r\n  routesFeatureStore.layer.visible = true;\r\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\r\n}\r\n\r\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\r\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\r\n    motion: FeatureMotion.None\r\n  });\r\n\r\n  const stepLayer = new VectorLayer({\r\n    isIgoInternalLayer: true,\r\n    id: 'igo-direction-step-layer',\r\n    title: '',\r\n    zIndex: 910,\r\n    source: new FeatureDataSource(),\r\n    showInLayerList: false,\r\n    workspace: {\r\n      enabled: false\r\n    },\r\n    linkedLayers: {\r\n      linkId: 'igo-direction-route-layer'\r\n    },\r\n    exportable: false,\r\n    browsable: false,\r\n    style: directionsStyle\r\n  });\r\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\r\n  stepFeatureStore.layer.visible = true;\r\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\r\n}\r\n\r\nexport function addStopToStopsFeatureStore(\r\n  stop: Stop,\r\n  stopsStore: StopsStore,\r\n  stopsFeatureStore: StopsFeatureStore,\r\n  projection: string,\r\n  languageService: LanguageService\r\n) {\r\n  let stopColor;\r\n  let stopText;\r\n\r\n  switch (stop.relativePosition) {\r\n    case DirectionRelativePositionType.Start:\r\n      stopColor = '#008000';\r\n      stopText = languageService.translate.instant(\r\n        'igo.geo.directionsForm.start'\r\n      );\r\n      break;\r\n    case DirectionRelativePositionType.End:\r\n      stopColor = '#f64139';\r\n      stopText = languageService.translate.instant(\r\n        'igo.geo.directionsForm.end'\r\n      );\r\n      break;\r\n    default:\r\n      stopColor = '#ffd700';\r\n      stopText =\r\n        languageService.translate.instant(\r\n          'igo.geo.directionsForm.intermediate'\r\n        ) +\r\n        ' #' +\r\n        stop.position;\r\n      break;\r\n  }\r\n\r\n  const geometry = new olGeom.Point(\r\n    olProj.transform(\r\n      stop.coordinates,\r\n      projection,\r\n      stopsFeatureStore.map.projection\r\n    )\r\n  );\r\n\r\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n    featureProjection: stopsFeatureStore.map.projection,\r\n    dataProjection: stopsFeatureStore.map.projection\r\n  }) as FeatureGeometry;\r\n\r\n  const previousStop = stopsFeatureStore.get(stop.id);\r\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\r\n\r\n  const stopFeatureStore: FeatureWithStop = {\r\n    type: FEATURE,\r\n    geometry: geojsonGeom,\r\n    projection: stopsFeatureStore.map.projection,\r\n    properties: {\r\n      id: stop.id,\r\n      type: DirectionType.Stop,\r\n      stopText,\r\n      stopColor,\r\n      stopOpacity: 1,\r\n      stop\r\n    },\r\n    meta: {\r\n      id: stop.id,\r\n      revision: previousStopRevision + 1\r\n    },\r\n    ol: new olFeature({ geometry })\r\n  };\r\n  stopsFeatureStore.update(stopFeatureStore);\r\n}\r\n\r\nexport function addDirectionToRoutesFeatureStore(\r\n  routesFeatureStore: RoutesFeatureStore,\r\n  direction: Direction,\r\n  projection: string,\r\n  active: boolean = false,\r\n  moveToExtent = false\r\n) {\r\n  const geom = direction.geometry.coordinates;\r\n  const geometry4326 = new olGeom.LineString(geom);\r\n  const geometry = geometry4326.transform(\r\n    projection,\r\n    routesFeatureStore.map.projection\r\n  );\r\n\r\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n    featureProjection: routesFeatureStore.map.projection,\r\n    dataProjection: routesFeatureStore.map.projection\r\n  }) as FeatureGeometry;\r\n\r\n  const previousRoute = routesFeatureStore.get(direction.id);\r\n  const previousRouteRevision = previousRoute ? previousRoute.meta.revision : 0;\r\n\r\n  const routeFeatureStore: FeatureWithDirection = {\r\n    type: FEATURE,\r\n    geometry: geojsonGeom,\r\n    projection: routesFeatureStore.map.projection,\r\n    properties: {\r\n      id: direction.id,\r\n      type: DirectionType.Route,\r\n      active,\r\n      direction\r\n    },\r\n    meta: {\r\n      id: direction.id,\r\n      revision: previousRouteRevision + 1\r\n    },\r\n    ol: new olFeature({ geometry })\r\n  };\r\n  routesFeatureStore.update(routeFeatureStore);\r\n}\r\n\r\nexport function formatDistance(distance: number): string {\r\n  if (distance === 0) {\r\n    return;\r\n  }\r\n  if (distance >= 100000) {\r\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\r\n  }\r\n  if (distance >= 10000) {\r\n    return (\r\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\r\n    );\r\n  }\r\n  if (distance >= 1000) {\r\n    return (\r\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\r\n    );\r\n  }\r\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\r\n}\r\n\r\nexport function formatDuration(duration: number): string {\r\n  if (duration >= 3600) {\r\n    const hour = Math.floor(duration / 3600);\r\n    const minute = Math.round((duration / 3600 - hour) * 60);\r\n    if (minute === 60) {\r\n      return hour + 1 + ' h';\r\n    }\r\n    return hour + ' h ' + minute + ' min';\r\n  }\r\n\r\n  if (duration >= 60) {\r\n    return Math.round(duration / 60) + ' min';\r\n  }\r\n  return duration + ' s';\r\n}\r\n\r\nexport function formatInstruction(\r\n  type,\r\n  modifier,\r\n  route,\r\n  direction,\r\n  stepPosition,\r\n  exit,\r\n  languageService: LanguageService,\r\n  lastStep = false\r\n) {\r\n  const translate = languageService.translate;\r\n  let directive;\r\n  let image = 'forward';\r\n  let cssClass = 'rotate-270';\r\n  const translatedDirection = translateBearing(direction, languageService);\r\n  const translatedModifier = translateModifier(modifier, languageService);\r\n  const prefix =\r\n    modifier === 'straight'\r\n      ? ''\r\n      : translate.instant('igo.geo.directions.modifier.prefix');\r\n\r\n  let aggregatedDirection = prefix + translatedModifier;\r\n\r\n  if (modifier?.search('slight') >= 0) {\r\n    aggregatedDirection = translatedModifier;\r\n  }\r\n\r\n  if (modifier === 'uturn') {\r\n    image = 'forward';\r\n    cssClass = 'rotate-90';\r\n  } else if (modifier === 'sharp right') {\r\n    image = 'subdirectory-arrow-right';\r\n    cssClass = 'icon-flipped';\r\n  } else if (modifier === 'right') {\r\n    image = 'subdirectory-arrow-right';\r\n    cssClass = 'icon-flipped';\r\n  } else if (modifier === 'slight right') {\r\n    image = 'forward';\r\n    cssClass = 'rotate-290';\r\n  } else if (modifier === 'straight') {\r\n    image = 'forward';\r\n  } else if (modifier === 'slight left') {\r\n    image = 'forward';\r\n    cssClass = 'rotate-250';\r\n  } else if (modifier === 'left') {\r\n    image = 'subdirectory-arrow-left';\r\n    cssClass = 'icon-flipped';\r\n  } else if (modifier === 'sharp left') {\r\n    image = 'subdirectory-arrow-left';\r\n    cssClass = 'icon-flipped';\r\n  }\r\n\r\n  if (type === 'turn') {\r\n    if (modifier === 'straight') {\r\n      directive = translate.instant('igo.geo.directions.turn.straight', {\r\n        route\r\n      });\r\n    } else if (modifier === 'uturn') {\r\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\r\n    } else {\r\n      directive = translate.instant('igo.geo.directions.turn.else', {\r\n        route,\r\n        aggregatedDirection,\r\n        translatedModifier\r\n      });\r\n    }\r\n  } else if (type === 'new name') {\r\n    directive = translate.instant('igo.geo.directions.new name', {\r\n      route,\r\n      translatedDirection\r\n    });\r\n    image = 'compass';\r\n    cssClass = '';\r\n  } else if (type === 'depart') {\r\n    directive = translate.instant('igo.geo.directions.depart', {\r\n      route,\r\n      translatedDirection\r\n    });\r\n    image = 'compass';\r\n    cssClass = '';\r\n  } else if (type === 'arrive') {\r\n    if (lastStep) {\r\n      const coma = !translatedModifier ? '' : ', ';\r\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\r\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', {\r\n        coma,\r\n        aggregatedDirection\r\n      });\r\n    } else {\r\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', {\r\n        route\r\n      });\r\n      image = 'map-marker';\r\n      cssClass = '';\r\n    }\r\n  } else if (type === 'merge') {\r\n    directive = translate.instant('igo.geo.directions.merge', { route });\r\n    image = 'forward';\r\n    cssClass = 'rotate-270';\r\n  } else if (type === 'on ramp') {\r\n    directive = translate.instant('igo.geo.directions.on ramp', {\r\n      aggregatedDirection\r\n    });\r\n  } else if (type === 'off ramp') {\r\n    directive = translate.instant('igo.geo.directions.off ramp', {\r\n      aggregatedDirection\r\n    });\r\n  } else if (type === 'fork') {\r\n    if (modifier.search('left') >= 0) {\r\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\r\n    } else if (modifier.search('right') >= 0) {\r\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\r\n    } else {\r\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\r\n    }\r\n  } else if (type === 'end of road') {\r\n    directive = translate.instant('igo.geo.directions.end of road', {\r\n      translatedModifier,\r\n      route\r\n    });\r\n  } else if (type === 'use lane') {\r\n    directive = translate.instant('igo.geo.directions.use lane');\r\n  } else if (type === 'continue' && modifier !== 'uturn') {\r\n    directive = translate.instant('igo.geo.directions.continue.notUturn', {\r\n      route\r\n    });\r\n    image = 'forward';\r\n    cssClass = 'rotate-270';\r\n  } else if (type === 'roundabout') {\r\n    const cntSuffix =\r\n      exit === 1\r\n        ? translate.instant('igo.geo.directions.cntSuffix.first')\r\n        : translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\r\n    directive = translate.instant('igo.geo.directions.roundabout', {\r\n      exit,\r\n      cntSuffix,\r\n      route\r\n    });\r\n    image = 'chart-donut';\r\n    cssClass = '';\r\n  } else if (type === 'rotary') {\r\n    directive = translate.instant('igo.geo.directions.rotary');\r\n    image = 'chart-donut';\r\n    cssClass = '';\r\n  } else if (type === 'roundabout turn') {\r\n    directive = translate.instant('igo.geo.directions.roundabout turn');\r\n    image = 'chart-donut';\r\n    cssClass = '';\r\n  } else if (type === 'exit roundabout') {\r\n    directive = translate.instant('igo.geo.directions.exit roundabout', {\r\n      route\r\n    });\r\n    image = 'forward';\r\n    cssClass = 'rotate-270';\r\n  } else if (type === 'notification') {\r\n    directive = translate.instant('igo.geo.directions.notification');\r\n  } else if (modifier === 'uturn') {\r\n    directive = translate.instant('igo.geo.directions.uturnText', {\r\n      translatedDirection,\r\n      route\r\n    });\r\n  } else {\r\n    directive = translate.instant('igo.geo.directions.unknown');\r\n  }\r\n\r\n  image = lastStep ? 'flag-variant' : image;\r\n  cssClass = lastStep ? '' : cssClass;\r\n  image = stepPosition === 0 ? 'compass' : image;\r\n  cssClass = stepPosition === 0 ? '' : cssClass;\r\n\r\n  return { instruction: directive, image, cssClass };\r\n}\r\n\r\nexport function translateModifier(modifier, languageService: LanguageService) {\r\n  const translate = languageService.translate;\r\n  if (modifier === 'uturn') {\r\n    return translate.instant('igo.geo.directions.uturn');\r\n  } else if (modifier === 'sharp right') {\r\n    return translate.instant('igo.geo.directions.sharp right');\r\n  } else if (modifier === 'right') {\r\n    return translate.instant('igo.geo.directions.right');\r\n  } else if (modifier === 'slight right') {\r\n    return translate.instant('igo.geo.directions.slight right');\r\n  } else if (modifier === 'sharp left') {\r\n    return languageService.translate.instant('igo.geo.directions.sharp left');\r\n  } else if (modifier === 'left') {\r\n    return languageService.translate.instant('igo.geo.directions.left');\r\n  } else if (modifier === 'slight left') {\r\n    return languageService.translate.instant('igo.geo.directions.slight left');\r\n  } else if (modifier === 'straight') {\r\n    return languageService.translate.instant('igo.geo.directions.straight');\r\n  } else {\r\n    return modifier;\r\n  }\r\n}\r\n\r\nexport function translateBearing(\r\n  bearing: number,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  if (bearing >= 337 || bearing < 23) {\r\n    return translate.instant('igo.geo.cardinalPoints.n');\r\n  } else if (bearing < 67) {\r\n    return translate.instant('igo.geo.cardinalPoints.ne');\r\n  } else if (bearing < 113) {\r\n    return translate.instant('igo.geo.cardinalPoints.e');\r\n  } else if (bearing < 157) {\r\n    return translate.instant('igo.geo.cardinalPoints.se');\r\n  } else if (bearing < 203) {\r\n    return translate.instant('igo.geo.cardinalPoints.s');\r\n  } else if (bearing < 247) {\r\n    return translate.instant('igo.geo.cardinalPoints.sw');\r\n  } else if (bearing < 293) {\r\n    return translate.instant('igo.geo.cardinalPoints.w');\r\n  } else if (bearing < 337) {\r\n    return translate.instant('igo.geo.cardinalPoints.nw');\r\n  } else {\r\n    return;\r\n  }\r\n}\r\n","import { DOCUMENT } from '@angular/common';\r\nimport { Inject, Injectable } from '@angular/core';\r\n\r\nimport { ActivityService, ConfigService, LanguageService } from '@igo2/core';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport html2canvas from 'html2canvas';\r\nimport jsPDF from 'jspdf';\r\nimport 'jspdf-autotable';\r\nimport { UserOptions } from 'jspdf-autotable';\r\nimport moment from 'moment';\r\nimport { Observable, Subject } from 'rxjs';\r\n\r\nimport { IgoMap } from '../../map';\r\nimport { PrintLegendPosition, PrintService } from '../../print';\r\nimport { DirectionsSource } from '../directions-sources/directions-source';\r\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\r\nimport { DirectionsSourceService } from './directions-source.service';\r\nimport {\r\n  formatDistance,\r\n  formatDuration,\r\n  formatInstruction\r\n} from './directions.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DirectionsService {\r\n  constructor(\r\n    private directionsSourceService: DirectionsSourceService,\r\n    private configService: ConfigService,\r\n    private languageService: LanguageService,\r\n    private printService: PrintService,\r\n    @Inject(DOCUMENT) private document: Document,\r\n    private activityService: ActivityService\r\n  ) {}\r\n\r\n  route(\r\n    coordinates: [number, number][],\r\n    directionsOptions: DirectionOptions = {}\r\n  ): Observable<Direction[]>[] {\r\n    if (coordinates.length === 0) {\r\n      return;\r\n    }\r\n    return this.directionsSourceService.sources\r\n      .filter((source: DirectionsSource) => source.enabled)\r\n      .map((source: DirectionsSource) =>\r\n        this.routeSource(source, coordinates, directionsOptions)\r\n      );\r\n  }\r\n\r\n  routeSource(\r\n    source: DirectionsSource,\r\n    coordinates: [number, number][],\r\n    directionsOptions: DirectionOptions = {}\r\n  ): Observable<Direction[]> {\r\n    const request = source.route(coordinates, directionsOptions);\r\n    return request;\r\n  }\r\n\r\n  downloadDirection(\r\n    map: IgoMap,\r\n    direction: Direction\r\n  ): Observable<SubjectStatus> {\r\n    const activityId = this.activityService.register();\r\n    const status$ = new Subject<SubjectStatus>();\r\n\r\n    const doc: jsPDF = new jsPDF({\r\n      orientation: 'p',\r\n      format: 'Letter',\r\n      unit: 'mm' // default\r\n    });\r\n    const dimensions = [\r\n      doc.internal.pageSize.width,\r\n      doc.internal.pageSize.height\r\n    ];\r\n    const margins = [10, 10, 10, 10];\r\n    const width = dimensions[0];\r\n    const height = dimensions[1] - margins[0] - margins[2];\r\n    const size: [number, number] = [width, height];\r\n\r\n    const title = `${direction.title} (${formatDistance(\r\n      direction.distance\r\n    )}, ${formatDuration(direction.duration)})`;\r\n    const titlePosition = 25;\r\n\r\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\r\n      align: 'center'\r\n    });\r\n\r\n    margins[0] += 20;\r\n    const resolution = 96; // Default is 96\r\n    this.printService\r\n      .addMap(doc, map, resolution, size, margins, PrintLegendPosition.none)\r\n      .subscribe(async (status: SubjectStatus) => {\r\n        if (status === SubjectStatus.Done) {\r\n          await this.addInstructions(doc, direction, title);\r\n          this.setPageHeaderFooter(doc);\r\n          await doc.save(`${title}.pdf`, { returnPromise: true });\r\n        }\r\n\r\n        this.activityService.unregister(activityId);\r\n        status$.next(status);\r\n      });\r\n\r\n    return status$;\r\n  }\r\n\r\n  private async setHTMLTableContent(\r\n    direction: Direction\r\n  ): Promise<HTMLTableElement> {\r\n    const data = await this.directionsInstruction(direction);\r\n    const table = document.createElement('table');\r\n    const tblBody = document.createElement('tbody');\r\n    for (let index = 0; index < data.length; index++) {\r\n      const element = data[index];\r\n      var row = document.createElement('tr');\r\n      var cellImage = document.createElement('td');\r\n      var cellText = document.createElement('td');\r\n      // icon\r\n      const img = document.createElement('img') as HTMLImageElement;\r\n      img.src = element.icon;\r\n      // instruction text\r\n      const span = document.createElement('span') as HTMLElement;\r\n      span.innerHTML = element.instruction;\r\n      cellImage.appendChild(img);\r\n      cellText.appendChild(span);\r\n      if (element.distance) {\r\n        const spanDistance = document.createElement('span') as HTMLElement;\r\n        spanDistance.style.verticalAlign = 'middle';\r\n        spanDistance.innerHTML =\r\n          '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + element.distance;\r\n        cellText.appendChild(spanDistance);\r\n      }\r\n      row.append(cellImage);\r\n      row.append(cellText);\r\n      tblBody.appendChild(row);\r\n    }\r\n    table.appendChild(tblBody);\r\n    return table;\r\n  }\r\n\r\n  private async directionsInstruction(\r\n    direction: Direction\r\n  ): Promise<Array<{ instruction: string; icon: string; distance: string }>> {\r\n    const matListItems = this.document\r\n      .getElementsByTagName('igo-directions-results')[0]\r\n      .getElementsByTagName('mat-list')[0];\r\n    const matListItem = matListItems.getElementsByTagName('mat-list-item');\r\n    // convert icon list to base64\r\n    let iconsArray: Array<{ name: string; icon: string }> = [];\r\n    for (let index = 0; index < matListItem.length; index++) {\r\n      const element = matListItem[index];\r\n      const icon = element.getElementsByTagName('mat-icon')[0] as HTMLElement;\r\n      const iconName = icon.getAttribute('data-mat-icon-name') as string;\r\n      const found = iconsArray.some((el) => el.name === iconName);\r\n      if (!found) {\r\n        const iconCanvas = await html2canvas(icon, { scale: 3 });\r\n        iconsArray.push({ name: iconName, icon: iconCanvas.toDataURL() });\r\n      }\r\n    }\r\n\r\n    let formattedDirection: Array<{\r\n      instruction: string;\r\n      icon: string;\r\n      distance: string;\r\n    }> = [];\r\n    for (let i = 0; i < direction.steps.length; i++) {\r\n      const step = direction.steps[i];\r\n      const instruction = formatInstruction(\r\n        step.maneuver.type,\r\n        step.maneuver.modifier,\r\n        step.name,\r\n        step.maneuver.bearing_after,\r\n        i,\r\n        (step.maneuver as any).exit,\r\n        this.languageService,\r\n        i === direction.steps.length - 1\r\n      );\r\n\r\n      const distance = formatDistance(step.distance);\r\n      formattedDirection.push({\r\n        instruction: i + 1 + '. ' + instruction.instruction,\r\n        icon: iconsArray.find((icon) => icon.name === instruction.image).icon,\r\n        distance: distance ? '(' + distance + ')' : undefined\r\n      });\r\n    }\r\n    return formattedDirection;\r\n  }\r\n\r\n  private async addInstructions(\r\n    doc: jsPDF,\r\n    direction: Direction,\r\n    title: string\r\n  ) {\r\n    doc.addPage();\r\n    const titlePosition = 25;\r\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\r\n      align: 'center'\r\n    });\r\n    const HTMLtable = await this.setHTMLTableContent(direction);\r\n    const tablePos = titlePosition + 5;\r\n    (doc as any).autoTable({\r\n      html: HTMLtable,\r\n      startY: tablePos,\r\n      margin: { top: 20, bottom: 20 },\r\n      columnStyles: {\r\n        0: { cellWidth: 10 }\r\n      },\r\n      theme: 'plain',\r\n      styles: {\r\n        fontSize: 12\r\n      },\r\n      didDrawCell: function (data) {\r\n        if (data.column.index === 0 && data.cell.section === 'body') {\r\n          data.row.height = 10;\r\n          const td = data.cell.raw as HTMLElement;\r\n          const img = td.getElementsByTagName('img')[0];\r\n          doc.addImage(img.src, data.cell.x, data.cell.y, 8, 8);\r\n        }\r\n      }\r\n    } satisfies UserOptions);\r\n  }\r\n\r\n  private setPageHeaderFooter(doc: jsPDF) {\r\n    const pageCount = doc.getNumberOfPages();\r\n    const date = moment(Date.now()).format('DD/MM/YYYY hh:mm').toString();\r\n\r\n    const logoConfig = this.configService.getConfig('directionsSources.logo');\r\n    const logo = logoConfig ? logoConfig : 'assets/logo.png';\r\n\r\n    for (let index = 0; index < pageCount; index++) {\r\n      doc.setPage(index);\r\n      doc.setFontSize(8);\r\n      const pageSize = doc.internal.pageSize;\r\n      const pageHeight = pageSize.height\r\n        ? pageSize.height\r\n        : pageSize.getHeight();\r\n      const width = pageSize.width ? pageSize.width : pageSize.getWidth();\r\n      doc.text(date, 10, 10, { baseline: 'top' });\r\n      doc.addImage(logo, 'PNG', width - 20, 5, 10, 10);\r\n      doc.text(date, 10, pageHeight - 10);\r\n      doc.text(\r\n        'Page ' + doc.getCurrentPageInfo().pageNumber + ' / ' + pageCount,\r\n        width - 20,\r\n        pageHeight - 10\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { EntityStore } from '@igo2/common';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport {\r\n  FeatureWithDirection,\r\n  FeatureWithStep,\r\n  FeatureWithStop,\r\n  Stop\r\n} from './directions.interface';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * stops.\r\n */\r\nexport class StopsStore extends EntityStore<Stop> {\r\n  public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n\r\n  public clearStops() {\r\n    this.storeInitialized$.next(false);\r\n    this.clear();\r\n  }\r\n}\r\n\r\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {}\r\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {}\r\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {}\r\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div\n    touchleave\n    (touchenter)=\"onStopEnter(stop)\"\n    (touchleave)=\"onStopLeave()\"\n    (mouseover)=\"onStopEnter(stop)\"\n    (mouseleave)=\"onStopLeave()\"\n    (cdkDragStarted)=\"stopIsDragged = true\"\n    (cdkDragEnded)=\"stopIsDragged = false\"\n    cdkDragLockAxis=\"y\"\n    class=\"stop-box\"\n    *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index\"\n    cdkDrag\n  >\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <mat-label>{{ getPlaceholder(stop) }}</mat-label>\n        <input\n          id=\"{{ stop.id }}\"\n          type=\"text\"\n          [placeholder]=\"getPlaceholder(stop)\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"stop.text\"\n          aria-label=\"Number\"\n          matInput\n          (focus)=\"onInputFocus(stop)\"\n          [(ngModel)]=\"stop.text\"\n          (keyup)=\"setStopText($event, stop)\"\n          (keydown.enter)=\"$event.preventDefault()\"\n          [matAutocomplete]=\"auto\"\n        />\n        <button\n          *ngIf=\"\n            (stop.text || stop.coordinates) &&\n            stopWithHover &&\n            stop.id === stopWithHover.id\n          \"\n          mat-icon-button\n          matSuffix\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n          color=\"warn\"\n          aria-label=\"Clear\"\n          (click)=\"clearStop(stop)\"\n        >\n          <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n\n        <mat-autocomplete\n          [displayWith]=\"getOptionText\"\n          #auto=\"matAutocomplete\"\n          (optionSelected)=\"chooseProposal($event, stop)\"\n        >\n          <mat-optgroup\n            *ngFor=\"let source of stop.searchProposals\"\n            [label]=\"source.source.title\"\n            [disabled]=\"source.source.enabled === false\"\n          >\n            <mat-option\n              *ngFor=\"let result of source.results\"\n              [value]=\"result\"\n              matTooltipShowDelay=\"500\"\n              [matTooltip]=\"result.meta ? result.meta.title : ''\"\n            >\n              {{ result.meta ? result.meta.title : '' }}\n            </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n    <div\n      *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\"\n      class=\"igo-form-button-group\"\n    >\n      <button\n        class=\"swipe-vertical\"\n        cdkDragHandle\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\"\n        color=\"primary\"\n      >\n        <mat-icon svgIcon=\"gesture-swipe-vertical\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"(stopsStore.count$ | async) > 2\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\"\n        color=\"warn\"\n        (click)=\"removeStop(stop)\"\n      >\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n  </div>\n</div>\n","import { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\r\nimport {\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  Output\r\n} from '@angular/core';\r\nimport { MatAutocomplete } from '@angular/material/autocomplete';\r\nimport { MatOption } from '@angular/material/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport * as olObservable from 'ol/Observable';\r\nimport * as olProj from 'ol/proj';\r\n\r\nimport pointOnFeature from '@turf/point-on-feature';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { roundCoordTo } from '../../map/shared/map.utils';\r\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\r\nimport { Stop } from '../shared/directions.interface';\r\nimport {\r\n  computeRelativePosition,\r\n  removeStopFromStore,\r\n  updateStoreSorting\r\n} from '../shared/directions.utils';\r\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\r\n\r\n@Component({\r\n  selector: 'igo-directions-inputs',\r\n  templateUrl: './directions-inputs.component.html',\r\n  styleUrls: ['./directions-inputs.component.scss']\r\n})\r\nexport class DirectionsInputsComponent implements OnDestroy {\r\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\r\n  private onMapClickEventKeys = [];\r\n  public stopWithHover: Stop;\r\n  public stopIsDragged: boolean = false;\r\n  @Input() stopsStore: StopsStore;\r\n  @Input() stopsFeatureStore: StopsFeatureStore;\r\n  @Input() projection: string;\r\n  @Input() coordRoundedDecimals: number = 6;\r\n\r\n  @Input() debounce: number = 200;\r\n  @Input() length: number = 2;\r\n\r\n  @Output() stopInputHasFocus: EventEmitter<boolean> =\r\n    new EventEmitter<boolean>(false);\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  ngOnDestroy(): void {\r\n    this.unlistenMapSingleClick();\r\n  }\r\n  onStopEnter(stop: Stop) {\r\n    this.stopWithHover = stop;\r\n  }\r\n  onStopLeave() {\r\n    this.stopWithHover = undefined;\r\n  }\r\n\r\n  getOptionText(option) {\r\n    if (option instanceof Object) {\r\n      return option?.meta ? option.meta.title : '';\r\n    }\r\n    return option;\r\n  }\r\n\r\n  chooseProposal(\r\n    event: { source: MatAutocomplete; option: MatOption },\r\n    stop: Stop\r\n  ) {\r\n    const result: Feature = event.option.value;\r\n    if (result) {\r\n      let geomCoord;\r\n      const geom = result.geometry;\r\n      if (geom.type === 'Point') {\r\n        geomCoord = geom.coordinates;\r\n      } else {\r\n        const point = pointOnFeature(result.geometry);\r\n        geomCoord = [\r\n          point.geometry.coordinates[0],\r\n          point.geometry.coordinates[1]\r\n        ];\r\n      }\r\n      if (geomCoord) {\r\n        stop.coordinates = geomCoord;\r\n        stop.text = result.meta.title;\r\n        this.stopsStore.update(stop);\r\n      }\r\n    }\r\n  }\r\n\r\n  setStopText(event: KeyboardEvent, stop: Stop) {\r\n    this.unlistenMapSingleClick();\r\n    const term = (event.target as HTMLInputElement).value;\r\n    if (term.length === 0) {\r\n      this.clearStop(stop);\r\n    } else if (this.validateTerm(term)) {\r\n      stop.text = term;\r\n      this.stopsStore.update(stop);\r\n    }\r\n  }\r\n\r\n  validateTerm(term: string) {\r\n    if (\r\n      this.keyIsValid(term) &&\r\n      (term.length >= this.length || term.length === 0)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private keyIsValid(key: string) {\r\n    return this.invalidKeys.find((value) => value === key) === undefined;\r\n  }\r\n\r\n  getNgClass(stop: Stop): string {\r\n    if (!this.stopWithHover) {\r\n      return 'igo-input-container';\r\n    } else if (stop.id === this.stopWithHover.id) {\r\n      return 'igo-input-container reduce';\r\n    } else {\r\n      return 'igo-input-container';\r\n    }\r\n  }\r\n\r\n  getPlaceholder(stop: Stop): string {\r\n    let extra = '';\r\n    if (stop.relativePosition) {\r\n      if (\r\n        stop.relativePosition === DirectionRelativePositionType.Intermediate\r\n      ) {\r\n        extra = ' #' + stop.position;\r\n      }\r\n      return (\r\n        this.languageService.translate.instant(\r\n          'igo.geo.directionsForm.' + stop.relativePosition\r\n        ) + extra\r\n      );\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  removeStop(stop: Stop) {\r\n    removeStopFromStore(this.stopsStore, stop);\r\n  }\r\n\r\n  clearStop(stop: Stop) {\r\n    this.stopsStore.update({\r\n      id: stop.id,\r\n      relativePosition: stop.relativePosition,\r\n      position: stop.position\r\n    });\r\n  }\r\n\r\n  drop(event: CdkDragDrop<string[]>) {\r\n    this.moveStops(event.previousIndex, event.currentIndex);\r\n  }\r\n\r\n  private moveStops(fromIndex, toIndex) {\r\n    if (fromIndex !== toIndex) {\r\n      const stops = [...this.stopsStore.view.all()];\r\n      moveItemInArray(stops, fromIndex, toIndex);\r\n      stops.map((stop, i) => {\r\n        stop.relativePosition = computeRelativePosition(i, stops.length);\r\n        stop.position = i;\r\n      });\r\n      this.stopsStore.updateMany(stops);\r\n      updateStoreSorting(this.stopsStore);\r\n    }\r\n  }\r\n\r\n  onInputFocus(stop: Stop) {\r\n    if (!stop.text || stop.text?.length === 0) {\r\n      this.unlistenMapSingleClick();\r\n      this.stopInputHasFocus.emit(true);\r\n      this.listenMapSingleClick(stop);\r\n    }\r\n  }\r\n\r\n  private listenMapSingleClick(stop: Stop) {\r\n    const key = this.stopsFeatureStore.layer.map.ol.once(\r\n      'singleclick',\r\n      (event) => {\r\n        const clickCoordinates = olProj.transform(\r\n          event.coordinate,\r\n          this.stopsFeatureStore.layer.map.projection,\r\n          this.projection\r\n        );\r\n        const roundedCoord = roundCoordTo(\r\n          clickCoordinates as [number, number],\r\n          this.coordRoundedDecimals\r\n        );\r\n        stop.text = roundedCoord.join(',');\r\n        stop.coordinates = roundedCoord;\r\n        this.stopsStore.update(stop);\r\n        setTimeout(() => {\r\n          this.stopInputHasFocus.emit(false);\r\n        }, 500);\r\n      }\r\n    );\r\n    this.onMapClickEventKeys.push(key);\r\n  }\r\n\r\n  private unlistenMapSingleClick() {\r\n    this.onMapClickEventKeys.map((key) => {\r\n      olObservable.unByKey(key);\r\n    });\r\n    this.onMapClickEventKeys = [];\r\n  }\r\n}\r\n","<div class=\"igo-form-button-group\">\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\"\n    color=\"primary\"\n    (click)=\"addStop()\"\n  >\n    <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"\n      (routesFeatureStore.count$ | async) >= 1 ||\n      (stopsStore.count$ | async) >= 1\n    \"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\"\n    color=\"warn\"\n    (click)=\"resetStops()\"\n  >\n    <mat-icon svgIcon=\"file-restore\"></mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"copyLinkToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon svgIcon=\"link\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"printDirections()\"\n    [disabled]=\"disabled$ | async\"\n    [matTooltip]=\"'igo.geo.directionsForm.print' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon svgIcon=\"printer\"></mat-icon>\n  </button>\n</div>\n","import { Component, Input, Optional } from '@angular/core';\r\n\r\nimport { LanguageService, MessageService, RouteService } from '@igo2/core';\r\nimport { Clipboard } from '@igo2/utils';\r\n\r\nimport { BehaviorSubject, Subject } from 'rxjs';\r\n\r\nimport { roundCoordTo } from '../../map/shared/map.utils';\r\nimport { DirectionsService } from '../shared';\r\nimport { FeatureWithDirection } from '../shared/directions.interface';\r\nimport {\r\n  addStopToStore,\r\n  formatDistance,\r\n  formatDuration,\r\n  formatInstruction\r\n} from '../shared/directions.utils';\r\nimport {\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsStore\r\n} from '../shared/store';\r\n\r\n@Component({\r\n  selector: 'igo-directions-buttons',\r\n  templateUrl: './directions-buttons.component.html',\r\n  styleUrls: ['./directions-buttons.component.scss']\r\n})\r\nexport class DirectionsButtonsComponent {\r\n  get activeRoute() {\r\n    return this.routesFeatureStore\r\n      .all()\r\n      .find((route) => route.properties.active);\r\n  }\r\n  @Input() contextUri: string;\r\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\r\n  @Input() stopsStore: StopsStore;\r\n  @Input() routesFeatureStore: RoutesFeatureStore;\r\n  @Input() stepFeatureStore: StepFeatureStore;\r\n\r\n  public disabled$ = new BehaviorSubject(false);\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    @Optional() private route: RouteService,\r\n    private directionsService: DirectionsService\r\n  ) {}\r\n\r\n  resetStops() {\r\n    this.stopsStore.clearStops();\r\n  }\r\n\r\n  // stop are always added before the last stop.\r\n  addStop(): void {\r\n    addStopToStore(this.stopsStore);\r\n  }\r\n\r\n  copyLinkToClipboard() {\r\n    const successful = Clipboard.copy(this.getUrl());\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.geo.directionsForm.dialog.copyMsgLink',\r\n        'igo.geo.directionsForm.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  zoomRoute() {\r\n    this.zoomToActiveRoute$.next();\r\n  }\r\n\r\n  copyDirectionsToClipboard() {\r\n    const directionsBody = this.directionsToText();\r\n    const successful = Clipboard.copy(directionsBody);\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.geo.directionsForm.dialog.copyMsg',\r\n        'igo.geo.directionsForm.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  private directionsToText() {\r\n    const indent = '\\t';\r\n    let activeRouteDirective =\r\n      this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.instructions'\r\n      ) + ':\\n';\r\n    let wayPointList = '';\r\n    const summary =\r\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\r\n      ': \\n' +\r\n      indent +\r\n      this.activeRoute.properties.direction.title +\r\n      '\\n' +\r\n      indent +\r\n      formatDistance(this.activeRoute.properties.direction.distance) +\r\n      '\\n' +\r\n      indent +\r\n      formatDuration(this.activeRoute.properties.direction.duration) +\r\n      '\\n\\n' +\r\n      this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.stopsList'\r\n      ) +\r\n      ':\\n';\r\n\r\n    const url =\r\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\r\n      ':\\n' +\r\n      indent +\r\n      this.getUrl();\r\n\r\n    let wayPointsCnt = 1;\r\n    this.stopsStore.view.all().forEach((stop) => {\r\n      let coord = '';\r\n      let stopText = '';\r\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\r\n        stopText = stop.text;\r\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\r\n      } else {\r\n        stopText = roundCoordTo(stop.coordinates).join(',');\r\n      }\r\n\r\n      wayPointList =\r\n        wayPointList +\r\n        indent +\r\n        wayPointsCnt.toLocaleString() +\r\n        '. ' +\r\n        stopText +\r\n        coord +\r\n        '\\n';\r\n      wayPointsCnt++;\r\n    });\r\n\r\n    let localCnt = 0;\r\n    this.activeRoute.properties.direction.steps.forEach((step) => {\r\n      const instruction = this.formatStep(step, localCnt).instruction;\r\n      const distance =\r\n        formatDistance(step.distance) === undefined\r\n          ? ''\r\n          : ' (' + formatDistance(step.distance) + ')';\r\n      activeRouteDirective =\r\n        activeRouteDirective +\r\n        indent +\r\n        (localCnt + 1).toLocaleString() +\r\n        '. ' +\r\n        instruction +\r\n        distance +\r\n        '\\n';\r\n      localCnt++;\r\n    });\r\n\r\n    const directionsBody =\r\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\r\n\r\n    return directionsBody;\r\n  }\r\n\r\n  formatStep(step, cnt) {\r\n    return formatInstruction(\r\n      step.maneuver.type,\r\n      step.maneuver.modifier,\r\n      step.name,\r\n      step.maneuver.bearing_after,\r\n      cnt,\r\n      step.maneuver.exit,\r\n      this.languageService,\r\n      cnt === this.activeRoute.properties.direction.steps.length - 1\r\n    );\r\n  }\r\n\r\n  private getUrl() {\r\n    if (!this.route) {\r\n      return;\r\n    }\r\n    let context = '';\r\n    if (this.contextUri) {\r\n      context = `context=${this.contextUri}&`;\r\n    }\r\n\r\n    const pos = this.routesFeatureStore\r\n      .all()\r\n      .map((direction: FeatureWithDirection) => direction.properties.id)\r\n      .indexOf(this.activeRoute.properties.id);\r\n    let routingOptions = '';\r\n    if (pos !== 0) {\r\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\r\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\r\n    }\r\n    const directionsKey = this.route.options.directionsCoordKey;\r\n    const stopsCoordinates = this.stopsStore.view\r\n      .all()\r\n      .map((stop) => roundCoordTo(stop.coordinates, 6));\r\n    let directionsUrl = '';\r\n    if (stopsCoordinates.length >= 2) {\r\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\r\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\r\n    }\r\n    return;\r\n  }\r\n\r\n  printDirections() {\r\n    this.stepFeatureStore.clear();\r\n    this.disabled$.next(true);\r\n    this.directionsService\r\n      .downloadDirection(\r\n        this.routesFeatureStore.map,\r\n        this.activeRoute.properties.direction\r\n      )\r\n      .subscribe(() => {\r\n        this.disabled$.next(false);\r\n      });\r\n  }\r\n}\r\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n  <mat-form-field *ngIf=\"directions && directions.length > 1\">\n    <mat-label>{{\n      'igo.geo.directionsForm.drivingOptions' | translate\n    }}</mat-label>\n    <mat-select\n      placeholder=\"{{ 'igo.geo.directionsForm.drivingOptions' | translate }}\"\n      (selectionChange)=\"changeRoute()\"\n      [(ngModel)]=\"activeDirection\"\n    >\n      <mat-option\n        *ngFor=\"let direction of directions; let cnt = index\"\n        [value]=\"direction\"\n      >\n        Option {{ cnt + 1 }} : {{ formatDistance(direction.distance) }} ({{\n          formatDuration(direction.duration)\n        }})\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n  <mat-list (mouseleave)=\"onStepsListBlur()\">\n    <h2 mat-header class=\"igo-route-title\">{{ activeDirection.title }}</h2>\n    <span class=\"mat-caption\">\n      {{ formatDistance(activeDirection.distance) }},\n      {{ formatDuration(activeDirection.duration) }}\n    </span>\n    <mat-list-item\n      class=\"igo-steps\"\n      (mouseenter)=\"showSegment(step)\"\n      (click)=\"showSegment(step, true)\"\n      *ngFor=\"let step of activeDirection.steps; let cnt = index\"\n      igoListItem\n    >\n      <mat-icon\n        [ngClass]=\"formatStep(step, cnt).cssClass\"\n        matListItemIcon\n        svgIcon=\"{{ formatStep(step, cnt).image }}\"\n      >\n      </mat-icon>\n\n      <span class=\"igo-step-text\">\n        {{ cnt + 1 }}. {{ formatStep(step, cnt).instruction }}\n      </span>\n      <span matListItemMeta>\n        {{ formatDistance(step.distance) }}\n      </span>\n    </mat-list-item>\n\n    <mat-divider></mat-divider>\n  </mat-list>\n</div>\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport * as olGeom from 'ol/geom';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\r\nimport { DirectionType } from '../shared/directions.enum';\r\nimport {\r\n  Direction,\r\n  FeatureWithStep,\r\n  IgoStep\r\n} from '../shared/directions.interface';\r\nimport {\r\n  formatDistance,\r\n  formatDuration,\r\n  formatInstruction\r\n} from '../shared/directions.utils';\r\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\r\n\r\n@Component({\r\n  selector: 'igo-directions-results',\r\n  templateUrl: './directions-results.component.html',\r\n  styleUrls: ['./directions-results.component.scss']\r\n})\r\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\r\n  public activeDirection: Direction;\r\n  public directions: Direction[];\r\n\r\n  private entities$$: Subscription;\r\n\r\n  @Input() routesFeatureStore: RoutesFeatureStore;\r\n  @Input() stepFeatureStore: StepFeatureStore;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.entities$$ = this.routesFeatureStore.entities$\r\n      .pipe(debounceTime(200))\r\n      .subscribe((entities) => {\r\n        const activeFeatureWithDirection = entities.find(\r\n          (entity) => entity.properties.active\r\n        );\r\n        this.directions = entities.map((entity) => entity.properties.direction);\r\n        if (activeFeatureWithDirection) {\r\n          this.activeDirection =\r\n            activeFeatureWithDirection.properties.direction;\r\n        } else {\r\n          this.activeDirection = undefined;\r\n        }\r\n        this.cdRef.detectChanges();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.entities$$.unsubscribe();\r\n  }\r\n\r\n  changeRoute() {\r\n    this.routesFeatureStore.entities$.value.map(\r\n      (entity) => (entity.properties.active = !entity.properties.active)\r\n    );\r\n    this.routesFeatureStore.layer.ol\r\n      .getSource()\r\n      .getFeatures()\r\n      .map((feature) => feature.set('active', !feature.get('active')));\r\n  }\r\n\r\n  formatDistance(distance: number): string {\r\n    return formatDistance(distance);\r\n  }\r\n\r\n  formatDuration(duration: number): string {\r\n    return formatDuration(duration);\r\n  }\r\n\r\n  formatStep(step, cnt) {\r\n    return formatInstruction(\r\n      step.maneuver.type,\r\n      step.maneuver.modifier,\r\n      step.name,\r\n      step.maneuver.bearing_after,\r\n      cnt,\r\n      step.maneuver.exit,\r\n      this.languageService,\r\n      cnt === this.activeDirection.steps.length - 1\r\n    );\r\n  }\r\n\r\n  onStepsListBlur() {\r\n    this.stepFeatureStore.clear();\r\n  }\r\n\r\n  showSegment(step: IgoStep, zoomToExtent = false) {\r\n    this.showRouteSegmentGeometry(step, zoomToExtent);\r\n  }\r\n\r\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\r\n    const coordinates = step.geometry.coordinates;\r\n    const vertexId = 'vertex';\r\n    const geometry4326 = new olGeom.LineString(coordinates);\r\n    const geometryMapProjection = geometry4326.transform(\r\n      'EPSG:4326',\r\n      this.stepFeatureStore.layer.map.projection\r\n    );\r\n    const routeSegmentCoordinates = (\r\n      geometryMapProjection as any\r\n    ).getCoordinates();\r\n    const lastPoint = routeSegmentCoordinates[0];\r\n\r\n    const geometry = new olGeom.Point(lastPoint);\r\n    const feature = new olFeature({ geometry });\r\n\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.stepFeatureStore.layer.map.projection,\r\n      dataProjection: this.stepFeatureStore.layer.map.projection\r\n    }) as FeatureGeometry;\r\n\r\n    const previousVertex = this.stepFeatureStore.get(vertexId);\r\n    const previousVertexRevision = previousVertex\r\n      ? previousVertex.meta.revision\r\n      : 0;\r\n\r\n    const stepFeature: FeatureWithStep = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.stepFeatureStore.layer.map.projection,\r\n      properties: {\r\n        id: vertexId,\r\n        step,\r\n        type: DirectionType.Vertex\r\n      },\r\n      meta: {\r\n        id: vertexId,\r\n        revision: previousVertexRevision + 1\r\n      },\r\n      ol: feature\r\n    };\r\n    this.stepFeatureStore.update(stepFeature);\r\n    if (zoomToExtent) {\r\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(\r\n        feature.getGeometry().getExtent() as [number, number, number, number]\r\n      );\r\n    }\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { EntityStoreWatcher } from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\r\n\r\nimport Collection from 'ol/Collection';\r\nimport * as olCondition from 'ol/events/condition';\r\nimport * as olInteraction from 'ol/interaction';\r\nimport { SelectEvent } from 'ol/interaction/Select';\r\nimport { TranslateEvent } from 'ol/interaction/Translate';\r\nimport * as olProj from 'ol/proj';\r\n\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\r\n\r\nimport { Feature } from '../feature/shared/feature.interfaces';\r\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\r\nimport { roundCoordTo, stringToLonLat } from '../map';\r\nimport { QueryService } from '../query/shared/query.service';\r\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\r\nimport { SearchService } from '../search/shared/search.service';\r\nimport { DirectionType, ProposalType } from './shared/directions.enum';\r\nimport {\r\n  DirectionOptions,\r\n  FeatureWithStopProperties,\r\n  Stop\r\n} from './shared/directions.interface';\r\nimport { DirectionsService } from './shared/directions.service';\r\nimport {\r\n  addDirectionToRoutesFeatureStore,\r\n  addStopToStopsFeatureStore,\r\n  addStopToStore,\r\n  initRoutesFeatureStore,\r\n  initStepFeatureStore,\r\n  initStopsFeatureStore,\r\n  updateStoreSorting\r\n} from './shared/directions.utils';\r\nimport {\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsFeatureStore,\r\n  StopsStore\r\n} from './shared/store';\r\n\r\n@Component({\r\n  selector: 'igo-directions',\r\n  templateUrl: './directions.component.html',\r\n  styleUrls: ['./directions.component.scss']\r\n})\r\nexport class DirectionsComponent implements OnInit, OnDestroy {\r\n  private watcher: EntityStoreWatcher<Stop>;\r\n\r\n  public projection: string = 'EPSG:4326';\r\n\r\n  private zoomRoute$$: Subscription;\r\n  private storeEmpty$$: Subscription;\r\n  private storeChange$$: Subscription;\r\n  private routesQueries$$: Subscription[] = [];\r\n\r\n  private selectStopInteraction: olInteraction.Select;\r\n  private translateStop: olInteraction.Translate;\r\n  private selectedRoute: olInteraction.Select;\r\n  private focusOnStop: boolean = false;\r\n  private isTranslating: boolean = false;\r\n\r\n  public previousStops: Stop[] = [];\r\n\r\n  private searchs$$: Subscription[] = [];\r\n\r\n  @Input() contextUri: string;\r\n  @Input() stopsStore: StopsStore;\r\n  @Input() stopsFeatureStore: StopsFeatureStore;\r\n  @Input() routesFeatureStore: RoutesFeatureStore;\r\n  @Input() stepFeatureStore: StepFeatureStore;\r\n  @Input() debounce: number = 200;\r\n  @Input() length: number = 2;\r\n  @Input() coordRoundedDecimals: number = 6;\r\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\r\n\r\n  /**\r\n   * Wheter one of the direction control is active\r\n   * @internal\r\n   */\r\n  get directionControlIsActive(): boolean {\r\n    return !this.queryService.queryEnabled;\r\n  }\r\n\r\n  get interactions(): olInteraction.Interaction[] {\r\n    return [this.selectStopInteraction, this.translateStop, this.selectedRoute];\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private languageService: LanguageService,\r\n    private directionsService: DirectionsService,\r\n    private searchService: SearchService,\r\n    private queryService: QueryService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.queryService.queryEnabled = false;\r\n    this.initEntityStores();\r\n    setTimeout(() => {\r\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\r\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\r\n      initStepFeatureStore(this.stepFeatureStore);\r\n      this.initOlInteraction();\r\n    }, 1);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.queryService.queryEnabled = true;\r\n    this.storeEmpty$$.unsubscribe();\r\n    this.storeChange$$.unsubscribe();\r\n    this.routesQueries$$.map((u) => u.unsubscribe());\r\n    this.zoomRoute$$.unsubscribe();\r\n    this.freezeStores();\r\n  }\r\n\r\n  private freezeStores() {\r\n    this.interactions.map((interaction) =>\r\n      this.routesFeatureStore.layer.map.ol.removeInteraction(interaction)\r\n    );\r\n    this.stopsFeatureStore.deactivateStrategyOfType(\r\n      FeatureStoreLoadingStrategy\r\n    );\r\n    this.routesFeatureStore.deactivateStrategyOfType(\r\n      FeatureStoreLoadingStrategy\r\n    );\r\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n  }\r\n\r\n  private initEntityStores() {\r\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\r\n    this.monitorEmptyEntityStore();\r\n    this.monitorEntityStoreChange();\r\n    this.monitorActiveRouteZoom();\r\n  }\r\n\r\n  private monitorActiveRouteZoom() {\r\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\r\n      if (this.routesFeatureStore.count >= 1) {\r\n        const activeRoute = this.routesFeatureStore\r\n          .all()\r\n          .find((route) => route.properties.active);\r\n\r\n        if (activeRoute) {\r\n          activeRoute.ol.getGeometry();\r\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\r\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(\r\n            routeExtent as [number, number, number, number]\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private initOlInteraction() {\r\n    this.selectStopInteraction = new olInteraction.Select({\r\n      layers: [this.stopsFeatureStore.layer.ol],\r\n      hitTolerance: 7,\r\n      condition: (event) => {\r\n        return event.type === 'pointermove' && !event.dragging;\r\n      }\r\n    });\r\n\r\n    this.translateStop = new olInteraction.Translate({\r\n      features: this.selectStopInteraction.getFeatures()\r\n    });\r\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\r\n      this.isTranslating = true;\r\n      this.executeStopTranslation(evt.features);\r\n    });\r\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\r\n      this.isTranslating = false;\r\n      this.executeStopTranslation(evt.features);\r\n    });\r\n\r\n    this.selectedRoute = new olInteraction.Select({\r\n      layers: [this.routesFeatureStore.layer.ol],\r\n      condition: olCondition.click,\r\n      hitTolerance: 7,\r\n      filter: (feature) => {\r\n        return (\r\n          feature.get('type') === DirectionType.Route &&\r\n          feature.get('active') &&\r\n          !this.isTranslating\r\n        );\r\n      }\r\n    });\r\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\r\n      if (this.focusOnStop === false) {\r\n        const selectCoordinates = roundCoordTo(\r\n          olProj.transform(\r\n            (evt as any).mapBrowserEvent.coordinate,\r\n            this.routesFeatureStore.layer.map.projection,\r\n            this.projection\r\n          ) as [number, number],\r\n          this.coordRoundedDecimals\r\n        );\r\n        const addedStop = addStopToStore(this.stopsStore);\r\n        addedStop.text = selectCoordinates.join(',');\r\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\r\n      }\r\n    });\r\n\r\n    this.interactions.map((interaction) =>\r\n      this.routesFeatureStore.layer.map.ol.addInteraction(interaction)\r\n    );\r\n  }\r\n\r\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\r\n    stopInputHasFocus\r\n      ? this.routesFeatureStore.layer.map.ol.removeInteraction(\r\n          this.selectedRoute\r\n        )\r\n      : this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\r\n  }\r\n\r\n  private executeStopTranslation(features: Collection<any>) {\r\n    if (features.getLength() === 0) {\r\n      return;\r\n    }\r\n    const firstFeature = features.getArray()[0];\r\n    const translatedStopId = firstFeature.getId();\r\n\r\n    const translationCoordinates = olProj.transform(\r\n      firstFeature.getGeometry().getCoordinates(),\r\n      this.stopsFeatureStore.layer.map.projection,\r\n      this.projection\r\n    );\r\n    const translatedStop = this.stopsStore.get(translatedStopId);\r\n    const roundedCoord = roundCoordTo(\r\n      translationCoordinates as [number, number],\r\n      this.coordRoundedDecimals\r\n    );\r\n    translatedStop.coordinates = roundedCoord;\r\n    translatedStop.text = roundedCoord.join(',');\r\n    this.stopsStore.update(translatedStop);\r\n  }\r\n\r\n  private monitorEmptyEntityStore() {\r\n    // Watch if the store is empty to reset it\r\n    this.storeEmpty$$ = this.stopsStore.count$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((count) => {\r\n        if (count < 2) {\r\n          addStopToStore(this.stopsStore);\r\n          if (this.stopsStore.count === 2) {\r\n            this.stopsStore.storeInitialized$.next(true);\r\n            return;\r\n          }\r\n          this.stopsStore.storeInitialized$.next(false);\r\n        }\r\n        this.routesQueries$$.map((u) => u.unsubscribe());\r\n      });\r\n  }\r\n\r\n  private monitorEntityStoreChange() {\r\n    this.storeChange$$ = this.stopsStore.entities$\r\n      .pipe(debounceTime(this.debounce))\r\n      .subscribe((stops: Stop[]) => {\r\n        this.handleStopDiff(stops);\r\n        updateStoreSorting(this.stopsStore);\r\n        this.handleStopsFeature();\r\n        this.getRoutes(this.isTranslating);\r\n      });\r\n  }\r\n\r\n  cancelSearch() {\r\n    this.searchs$$.map((s) => s.unsubscribe());\r\n  }\r\n\r\n  private handleStopDiff(stops: Stop[]) {\r\n    const simplifiedStops = stops.map((stop: Stop) => {\r\n      return ObjectUtils.removeUndefined({\r\n        ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates }\r\n      });\r\n    });\r\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, [\r\n      'coordinates'\r\n    ]);\r\n    const stopIdToProcess = diff.added.concat(diff.modified);\r\n    if (stopIdToProcess) {\r\n      stopIdToProcess.map((change) => {\r\n        const changedStop = change.newValue as Stop;\r\n        if (changedStop) {\r\n          const stop: Stop = this.stopsStore.get(changedStop.id);\r\n          const term = stop.text;\r\n          if (!term || term.length === 0) {\r\n            return;\r\n          }\r\n          const response = stringToLonLat(\r\n            term,\r\n            this.stopsFeatureStore.layer.map.projection\r\n          );\r\n          let researches: Research[];\r\n          let isCoord = false;\r\n          if (response.lonLat) {\r\n            isCoord = true;\r\n          }\r\n          researches = this.searchService.search(term, {\r\n            searchType: 'Feature'\r\n          });\r\n          this.cancelSearch();\r\n          const requests$ = researches.map((res) =>\r\n            res.request.pipe(\r\n              map((results: SearchResult[]) =>\r\n                results.filter((r) =>\r\n                  isCoord\r\n                    ? r.data.geometry.type === 'Point' && r.data.geometry\r\n                    : r.data.geometry\r\n                )\r\n              )\r\n            )\r\n          );\r\n          this.searchs$$ = requests$.map((request) => {\r\n            return request\r\n              .pipe(\r\n                map((results: SearchResult[]) =>\r\n                  results.filter((r) =>\r\n                    isCoord\r\n                      ? r.data.geometry.type === 'Point' && r.data.geometry\r\n                      : r.data.geometry\r\n                  )\r\n                )\r\n              )\r\n              .subscribe((res: SearchResult[]) => {\r\n                if (res.length > 0) {\r\n                  const source = res[0].source;\r\n                  const meta = res[0].meta;\r\n                  const results = res.map((r) => r.data);\r\n                  if (!stop.searchProposals) {\r\n                    stop.searchProposals = [];\r\n                  }\r\n                  stop.searchProposals = stop.searchProposals.filter(\r\n                    (sp) =>\r\n                      sp.type ===\r\n                      (isCoord ? ProposalType.Coord : ProposalType.Text)\r\n                  );\r\n                  let storedSource = stop.searchProposals.find(\r\n                    (sp) => sp.source === source\r\n                  );\r\n                  if (storedSource) {\r\n                    storedSource.results = results;\r\n                  } else {\r\n                    stop.searchProposals.push({\r\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\r\n                      source,\r\n                      meta,\r\n                      results\r\n                    });\r\n                  }\r\n                }\r\n                this.cdRef.detectChanges();\r\n              });\r\n          });\r\n        }\r\n      });\r\n    }\r\n    this.previousStops = simplifiedStops;\r\n  }\r\n\r\n  private handleStopsFeature() {\r\n    const stops = this.stopsStore.all();\r\n    const stopsWithCoordinates = stops.filter((stop) => stop.coordinates);\r\n    stopsWithCoordinates.map((stop) => this.addStopOverlay(stop));\r\n    this.stopsFeatureStore\r\n      .all()\r\n      .map((stopFeature: Feature<FeatureWithStopProperties>) => {\r\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\r\n          this.stopsFeatureStore.delete(stopFeature);\r\n        }\r\n      });\r\n    const stopsWithoutCoordinates = stops.filter((stop) => !stop.coordinates);\r\n    stopsWithoutCoordinates.map((stop) => {\r\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\r\n      if (stopFeature) {\r\n        this.stopsFeatureStore.delete(stopFeature);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getRoutes(isOverview: boolean = false) {\r\n    const stopsWithCoordinates = this.stopsStore.view\r\n      .all()\r\n      .filter((stop) => stop.coordinates);\r\n    if (stopsWithCoordinates.length < 2) {\r\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\r\n      return;\r\n    }\r\n\r\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\r\n      const roundedCoord = roundCoordTo(\r\n        stop.coordinates,\r\n        this.coordRoundedDecimals\r\n      );\r\n      return roundedCoord;\r\n    });\r\n    const overviewDirectionsOptions: DirectionOptions = {\r\n      overview: true,\r\n      steps: false,\r\n      alternatives: false,\r\n      continue_straight: false\r\n    };\r\n    this.routesQueries$$.map((u) => u.unsubscribe());\r\n    const routeResponse = this.directionsService.route(\r\n      roundedCoordinates,\r\n      isOverview ? overviewDirectionsOptions : undefined\r\n    );\r\n    if (routeResponse) {\r\n      routeResponse.map((res) =>\r\n        this.routesQueries$$.push(\r\n          res.subscribe((directions) => {\r\n            this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\r\n            directions.map((direction) =>\r\n              addDirectionToRoutesFeatureStore(\r\n                this.routesFeatureStore,\r\n                direction,\r\n                this.projection,\r\n                direction === directions[0] ? true : false\r\n              )\r\n            );\r\n          })\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  public addStopOverlay(stop: Stop) {\r\n    addStopToStopsFeatureStore(\r\n      stop,\r\n      this.stopsStore,\r\n      this.stopsFeatureStore,\r\n      this.projection,\r\n      this.languageService\r\n    );\r\n  }\r\n\r\n  onToggleDirectionsControl(isActive: boolean) {\r\n    this.queryService.queryEnabled = !isActive;\r\n    const ol = this.routesFeatureStore.layer.map.ol;\r\n    this.interactions.map((interaction) =>\r\n      isActive\r\n        ? ol.addInteraction(interaction)\r\n        : ol.removeInteraction(interaction)\r\n    );\r\n  }\r\n}\r\n","<div class=\"directions-options\">\r\n  <mat-slide-toggle\r\n    [checked]=\"directionControlIsActive\"\r\n    [labelPosition]=\"'before'\"\r\n    (change)=\"onToggleDirectionsControl($event.checked)\"\r\n  >\r\n    {{ 'igo.geo.directionsForm.toggleActive' | translate }}\r\n  </mat-slide-toggle>\r\n</div>\r\n\r\n<igo-directions-buttons\r\n  [stepFeatureStore]=\"stepFeatureStore\"\r\n  [contextUri]=\"contextUri\"\r\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\r\n  [routesFeatureStore]=\"routesFeatureStore\"\r\n  [stopsStore]=\"stopsStore\"\r\n></igo-directions-buttons>\r\n\r\n<igo-directions-inputs\r\n  (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\"\r\n  [coordRoundedDecimals]=\"coordRoundedDecimals\"\r\n  [projection]=\"projection\"\r\n  [stopsFeatureStore]=\"stopsFeatureStore\"\r\n  [stopsStore]=\"stopsStore\"\r\n  [debounce]=\"debounce\"\r\n  [length]=\"length\"\r\n></igo-directions-inputs>\r\n\r\n<igo-directions-results\r\n  [stepFeatureStore]=\"stepFeatureStore\"\r\n  [routesFeatureStore]=\"routesFeatureStore\"\r\n></igo-directions-results>\r\n","import { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { customCacheHasher, uuid } from '@igo2/utils';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport {\r\n  DirectionsFormat,\r\n  SourceDirectionsType\r\n} from '../shared/directions.enum';\r\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\r\nimport { DirectionsSource } from './directions-source';\r\nimport { OsrmDirectionsSourceOptions } from './directions-source.interface';\r\n\r\n@Injectable()\r\nexport class OsrmDirectionsSource extends DirectionsSource {\r\n  get enabled(): boolean {\r\n    return this.options.enabled !== false;\r\n  }\r\n  set enabled(value: boolean) {\r\n    this.options.enabled = value;\r\n  }\r\n  static _name = 'OSRM Qubec';\r\n  private directionsUrl =\r\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\r\n  private options: OsrmDirectionsSourceOptions;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService\r\n  ) {\r\n    super();\r\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\r\n    this.directionsUrl = this.options.url || this.directionsUrl;\r\n  }\r\n\r\n  getName(): string {\r\n    return OsrmDirectionsSource._name;\r\n  }\r\n\r\n  route(\r\n    coordinates: [number, number][],\r\n    directionsOptions: DirectionOptions = {}\r\n  ): Observable<Direction[]> {\r\n    const directionsParams = this.getRouteParams(directionsOptions);\r\n    return this.getRoute(coordinates, directionsParams);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getRoute(\r\n    coordinates: [number, number][],\r\n    params: HttpParams\r\n  ): Observable<Direction[]> {\r\n    return this.http\r\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\r\n        params\r\n      })\r\n      .pipe(map((res) => this.extractRoutesData(res)));\r\n  }\r\n\r\n  private extractRoutesData(response): Direction[] {\r\n    const routeResponse = [];\r\n    response.routes.forEach((route) => {\r\n      routeResponse.push(this.formatRoute(route, response.waypoints));\r\n    });\r\n    return routeResponse;\r\n  }\r\n\r\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\r\n    directionsOptions.alternatives =\r\n      directionsOptions.alternatives !== undefined\r\n        ? directionsOptions.alternatives\r\n        : true;\r\n    directionsOptions.steps =\r\n      directionsOptions.steps !== undefined ? directionsOptions.steps : true;\r\n    directionsOptions.geometries =\r\n      directionsOptions.geometries !== undefined\r\n        ? directionsOptions.geometries\r\n        : 'geojson';\r\n    directionsOptions.overview =\r\n      directionsOptions.overview !== undefined\r\n        ? directionsOptions.overview\r\n        : false;\r\n    directionsOptions.continue_straight =\r\n      directionsOptions.continue_straight !== undefined\r\n        ? directionsOptions.continue_straight\r\n        : false;\r\n\r\n    return new HttpParams({\r\n      fromObject: {\r\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\r\n        overview: directionsOptions.overview ? 'simplified' : 'full',\r\n        steps: directionsOptions.steps ? 'true' : 'false',\r\n        geometries: directionsOptions.geometries\r\n          ? directionsOptions.geometries\r\n          : 'geojson',\r\n        continue_straight: directionsOptions.continue_straight\r\n          ? 'true'\r\n          : 'false'\r\n      }\r\n    });\r\n  }\r\n\r\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\r\n    const stepsUI = [];\r\n    roadNetworkRoute.legs.forEach((leg) => {\r\n      leg.steps.forEach((step) => {\r\n        stepsUI.push(step);\r\n      });\r\n    });\r\n    return {\r\n      id: uuid(),\r\n      title: roadNetworkRoute.legs[0].summary,\r\n      source: OsrmDirectionsSource._name,\r\n      sourceType: SourceDirectionsType.Route,\r\n      order: 1,\r\n      format: DirectionsFormat.GeoJSON,\r\n      icon: 'directions',\r\n      projection: 'EPSG:4326',\r\n      waypoints,\r\n      distance: roadNetworkRoute.distance,\r\n      duration: roadNetworkRoute.duration,\r\n      geometry: roadNetworkRoute.geometry,\r\n      legs: roadNetworkRoute.legs,\r\n      steps: stepsUI,\r\n      weight: roadNetworkRoute.weight,\r\n      weight_name: roadNetworkRoute.weight_name\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { DirectionsSource } from './directions-source';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import { FEATURE } from '../../feature';\nimport { LAYER } from '../../layer/shared';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","import {\r\n  AfterContentChecked,\r\n  Directive,\r\n  HostListener,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { MediaService } from '@igo2/core';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\r\nimport { unByKey } from 'ol/Observable';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport * as olgeom from 'ol/geom';\r\nimport { transform } from 'ol/proj';\r\n\r\nimport { Subscription, first } from 'rxjs';\r\n\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\r\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { pointerPositionSummaryMarkerStyle } from '../../style/shared/feature/feature-style';\r\nimport { FeatureGeometry } from './../../feature/shared/feature.interfaces';\r\nimport { SearchSourceService } from './search-source.service';\r\nimport { Research, SearchResult } from './search.interfaces';\r\nimport { SearchService } from './search.service';\r\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\r\n\r\n/**\r\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\r\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\r\n * By default, no search sources. Config in config file must be defined.\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoSearchPointerSummary]'\r\n})\r\nexport class SearchPointerSummaryDirective\r\n  implements OnInit, OnDestroy, AfterContentChecked\r\n{\r\n  public store: FeatureStore<Feature>;\r\n  private lonLat: [number, number];\r\n  private pointerSearchStore: EntityStore<SearchResult> =\r\n    new EntityStore<SearchResult>([]);\r\n  private lastTimeoutRequest;\r\n  private store$$: Subscription;\r\n  private layers$$: Subscription;\r\n  private reverseSearch$$: Subscription[] = [];\r\n  private hasPointerReverseSearchSource: boolean = false;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener;\r\n\r\n  private searchPointerSummaryFeatureId: string =\r\n    'searchPointerSummaryFeatureId';\r\n  /**\r\n   * The delay where the mouse must be motionless before trigger the reverse search\r\n   */\r\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\r\n\r\n  /**\r\n   * If the user has enabled or not the directive\r\n   */\r\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\r\n\r\n  @HostListener('mouseleave')\r\n  mouseleave() {\r\n    clearTimeout(this.lastTimeoutRequest);\r\n    this.clearLayer();\r\n  }\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private searchService: SearchService,\r\n    private searchSourceService: SearchSourceService,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.listenToMapPointerMove();\r\n    this.subscribeToPointerStore();\r\n\r\n    this.map.status$\r\n      .pipe(first((status) => status === SubjectStatus.Done))\r\n      .subscribe(() => {\r\n        this.store = new FeatureStore<Feature>([], { map: this.map });\r\n        this.initStore();\r\n      });\r\n\r\n    // To handle context change without using the contextService.\r\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\r\n      if (\r\n        this.store &&\r\n        !layers.find((l) => l.id === 'searchPointerSummaryId')\r\n      ) {\r\n        this.initStore();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize the pointer position store\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      isIgoInternalLayer: true,\r\n      id: 'searchPointerSummaryId',\r\n      title: 'searchPointerSummary',\r\n      zIndex: 900,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      style: pointerPositionSummaryMarkerStyle\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n  }\r\n\r\n  ngAfterContentChecked(): void {\r\n    if (\r\n      !this.searchSourceService\r\n        .getEnabledSources()\r\n        .filter(sourceCanReverseSearchAsSummary).length\r\n    ) {\r\n      this.hasPointerReverseSearchSource = false;\r\n    } else {\r\n      this.hasPointerReverseSearchSource = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unsubscribeToPointerStore();\r\n    this.unsubscribeReverseSearch();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to pointermove result store\r\n   * @internal\r\n   */\r\n  subscribeToPointerStore() {\r\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(\r\n      (resultsUnderPointerPosition) => {\r\n        this.entitiesToPointerOverlay(resultsUnderPointerPosition);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Build an object based on the closest feature by type (base on type and distance properties )\r\n   * @param results SearchResult[]\r\n   * @returns OL style function\r\n   */\r\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\r\n    const closestResultByType = {};\r\n\r\n    results.map((result) => {\r\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\r\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\r\n          const prevDistance =\r\n            closestResultByType[result.data.properties.type].distance;\r\n          if (result.data.properties.distance < prevDistance) {\r\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\r\n            closestResultByType[result.data.properties.type] = {\r\n              distance: result.data.properties.distance,\r\n              title\r\n            };\r\n          }\r\n        } else {\r\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\r\n          closestResultByType[result.data.properties.type] = {\r\n            distance: result.data.properties.distance,\r\n            title\r\n          };\r\n        }\r\n      }\r\n    });\r\n\r\n    return closestResultByType;\r\n  }\r\n\r\n  /**\r\n   * convert store entities to a pointer position overlay with label summary on.\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private entitiesToPointerOverlay(\r\n    resultsUnderPointerPosition: SearchResult[]\r\n  ) {\r\n    const closestResultByType = this.computeSummaryClosestFeature(\r\n      resultsUnderPointerPosition\r\n    );\r\n    const summarizedClosestType = Object.keys(closestResultByType);\r\n    const processedSummarizedClosestType = [];\r\n    const summary = [];\r\n    resultsUnderPointerPosition.map((result) => {\r\n      const typeIndex = summarizedClosestType.indexOf(\r\n        result.data.properties.type\r\n      );\r\n      if (typeIndex !== -1) {\r\n        summary.push(closestResultByType[result.data.properties.type].title);\r\n        summarizedClosestType.splice(typeIndex, 1);\r\n        processedSummarizedClosestType.push(result.data.properties.type);\r\n      } else {\r\n        if (\r\n          processedSummarizedClosestType.indexOf(\r\n            result.data.properties.type\r\n          ) === -1\r\n        ) {\r\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\r\n        }\r\n      }\r\n    });\r\n    if (summary.length) {\r\n      this.addPointerOverlay(summary.join('\\n'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to pointer store.\r\n   * @internal\r\n   */\r\n  unsubscribeToPointerStore() {\r\n    this.store$$.unsubscribe();\r\n  }\r\n  /**\r\n   * Unsubscribe to reverse seatch store.\r\n   * @internal\r\n   */\r\n  unsubscribeReverseSearch() {\r\n    this.reverseSearch$$.map((s) => s.unsubscribe());\r\n    this.reverseSearch$$ = [];\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   * @internal\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    unByKey(this.pointerMoveListener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\r\n    if (\r\n      event.dragging ||\r\n      !this.igoSearchPointerSummaryEnabled ||\r\n      !this.hasPointerReverseSearchSource ||\r\n      this.mediaService.isTouchScreen()\r\n    ) {\r\n      this.clearLayer();\r\n      return;\r\n    }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n      this.clearLayer();\r\n      this.unsubscribeReverseSearch();\r\n    }\r\n\r\n    this.lonLat = transform(\r\n      event.coordinate,\r\n      this.mapProjection,\r\n      'EPSG:4326'\r\n    ) as [number, number];\r\n\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      this.onSearchCoordinate();\r\n    }, this.igoSearchPointerSummaryDelay);\r\n  }\r\n\r\n  /**\r\n   * Sort the results by display order.\r\n   * @param r1 First result\r\n   * @param r2 Second result\r\n   */\r\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\r\n    return r1.source.displayOrder - r2.source.displayOrder;\r\n  }\r\n\r\n  private onSearchCoordinate() {\r\n    this.pointerSearchStore.clear();\r\n    const results = this.searchService.reverseSearch(\r\n      this.lonLat,\r\n      { params: { geometry: 'false', icon: 'false' } },\r\n      true\r\n    );\r\n\r\n    for (const i in results) {\r\n      if (results.length > 0) {\r\n        this.reverseSearch$$.push(\r\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\r\n            this.onSearch({ research: results[i], results: _results });\r\n          })\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\r\n    const results = event.results;\r\n    const newResults = this.pointerSearchStore\r\n      .all()\r\n      .filter((result: SearchResult) => result.source !== event.research.source)\r\n      .concat(results);\r\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the pointer store\r\n   * @param text string\r\n   */\r\n  private addPointerOverlay(text: string) {\r\n    this.clearLayer();\r\n\r\n    const geometry = new olgeom.Point(\r\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\r\n    );\r\n    const feature = new olFeature({ geometry });\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.mapProjection,\r\n      dataProjection: this.mapProjection\r\n    }) as FeatureGeometry;\r\n\r\n    const f: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.mapProjection,\r\n      properties: {\r\n        id: this.searchPointerSummaryFeatureId,\r\n        pointerSummary: text\r\n      },\r\n      meta: {\r\n        id: this.searchPointerSummaryFeatureId\r\n      },\r\n      ol: feature\r\n    };\r\n    this.store.setLayerFeatures([f], FeatureMotion.None);\r\n  }\r\n\r\n  /**\r\n   * Clear the pointer store features\r\n   */\r\n  private clearLayer() {\r\n    if (this.store) {\r\n      this.store.clearLayer();\r\n    }\r\n  }\r\n}\r\n","import { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Inject, Injectable } from '@angular/core';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { customCacheHasher } from '@igo2/utils';\r\n\r\nimport olWKT from 'ol/format/WKT';\r\n\r\nimport { GeoJsonGeometryTypes } from 'geojson';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\nimport { SearchResult, TextSearch } from '../search.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { SearchSource } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\n\r\n/**\r\n * Cadastre search source\r\n */\r\n@Injectable()\r\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'cadastre';\r\n  static type = FEATURE;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n  }\r\n\r\n  getId(): string {\r\n    return CadastreSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return CadastreSearchSource.type;\r\n  }\r\n\r\n  /*\r\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Cadastre (Qubec)',\r\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a place by name\r\n   * @param term Place name\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\r\n    term = term.startsWith(',') ? term.substr(1) : term;\r\n    term = term.replace(/ /g, '');\r\n\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\r\n      return of([]);\r\n    }\r\n    return this.getCadastre(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getCadastre(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return this.http\r\n      .get(this.searchUrl, { params, responseType: 'text' })\r\n      .pipe(map((response: string) => this.extractResults(response, term)));\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          numero: term,\r\n          epsg: '4326'\r\n        },\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: string,\r\n    term: string\r\n  ): SearchResult<Feature>[] {\r\n    return response\r\n      .split('<br />')\r\n      .filter((lot: string) => lot.length > 0)\r\n      .map((lot: string) => this.dataToResult(lot, term));\r\n  }\r\n\r\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\r\n    const lot = data.split(';');\r\n    const numero = lot[0];\r\n    const wkt = lot[7];\r\n    const geometry = this.computeGeometry(wkt);\r\n\r\n    const properties = {\r\n      NoLot: numero,\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n    const id = [this.getId(), 'cadastre', numero].join('.');\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: numero,\r\n        score: computeTermSimilarity(term.trim(), numero),\r\n        icon: 'map-marker'\r\n      },\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: numero\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeGeometry(wkt: string): FeatureGeometry {\r\n    const feature = new olWKT().readFeature(wkt, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: 'EPSG:4326'\r\n    });\r\n    return {\r\n      type: feature.getGeometry().getType() as GeoJsonGeometryTypes,\r\n      coordinates: (feature.getGeometry() as any).getCoordinates()\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { CadastreSearchSource } from './cadastre';\r\nimport { SearchSource } from './source';\r\n\r\n/**\r\n * Cadastre search source factory\r\n * @ignore\r\n */\r\nexport function cadastreSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService\r\n) {\r\n  return new CadastreSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Cadastre search source\r\n */\r\nexport function provideCadastreSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: cadastreSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\r\n  };\r\n}\r\n","import { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Inject, Injectable } from '@angular/core';\r\n\r\nimport { StorageService } from '@igo2/core';\r\nimport { customCacheHasher } from '@igo2/utils';\r\n\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\nimport { SearchResult, TextSearch } from '../search.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { NominatimData } from './nominatim.interfaces';\r\nimport { SearchSource } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\n\r\n/**\r\n * Nominatim search source\r\n */\r\n@Injectable()\r\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'nominatim';\r\n  static type = FEATURE;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    storageService: StorageService\r\n  ) {\r\n    super(options, storageService);\r\n  }\r\n\r\n  getId(): string {\r\n    return NominatimSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return NominatimSearchSource.type;\r\n  }\r\n\r\n  /*\r\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Nominatim (OSM)',\r\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'amenity',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.food',\r\n              value:\r\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.health',\r\n              value:\r\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.entertainment',\r\n              value:\r\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\r\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.finance',\r\n              value: 'atm,bank,bureau_de_change',\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: true\r\n            },\r\n            {\r\n              title: '20',\r\n              value: 20,\r\n              enabled: false\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'restrictExtent',\r\n          name: 'countrycodes',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.nominatim.country.canada',\r\n              value: 'CA',\r\n              enabled: true\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.country.all',\r\n              value: null,\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'multiple object',\r\n          name: 'dedupe',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.searchSources.settings.true',\r\n              value: 0,\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.searchSources.settings.false',\r\n              value: 1,\r\n              enabled: true\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a place by name\r\n   * @param term Place name\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('q')) {\r\n      return of([]);\r\n    }\r\n    return this.getSearch(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getSearch(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return this.http\r\n      .get(this.searchUrl, { params })\r\n      .pipe(\r\n        map((response: NominatimData[]) => this.extractResults(response, term))\r\n      );\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          q: this.computeTerm(term),\r\n          format: 'json'\r\n        },\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: NominatimData[],\r\n    term: string\r\n  ): SearchResult<Feature>[] {\r\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\r\n  }\r\n\r\n  private dataToResult(\r\n    data: NominatimData,\r\n    term: string\r\n  ): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const geometry = this.computeGeometry(data);\r\n    const extent = this.computeExtent(data);\r\n    const id = [this.getId(), 'place', data.place_id].join('.');\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.display_name,\r\n        icon: 'map-marker',\r\n        score: computeTermSimilarity(term.trim(), data.display_name)\r\n      },\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.display_name\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: NominatimData): { [key: string]: any } {\r\n    return {\r\n      display_name: data.display_name,\r\n      place_id: data.place_id,\r\n      osm_type: data.osm_type,\r\n      class: data.class,\r\n      type: data.type\r\n    };\r\n  }\r\n\r\n  private computeGeometry(data: NominatimData): FeatureGeometry {\r\n    return {\r\n      type: 'Point',\r\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\r\n    };\r\n  }\r\n\r\n  private computeExtent(data: NominatimData): [number, number, number, number] {\r\n    return [\r\n      parseFloat(data.boundingbox[2]),\r\n      parseFloat(data.boundingbox[0]),\r\n      parseFloat(data.boundingbox[3]),\r\n      parseFloat(data.boundingbox[1])\r\n    ];\r\n  }\r\n\r\n  private computeTerm(term: string): string {\r\n    return this.computeTermTags(term);\r\n  }\r\n\r\n  /**\r\n   * Add hashtag from query in Nominatim's format (+[])\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTermTags(term: string): string {\r\n    const hashtags = super.getHashtagsValid(term, 'amenity');\r\n    if (!hashtags) {\r\n      return this.computeTermSettings(term);\r\n    }\r\n\r\n    if (!hashtags.length) {\r\n      return null;\r\n    }\r\n\r\n    term = term.replace(/(#[^\\s]*)/g, '');\r\n    hashtags.forEach((tag) => {\r\n      term += '+[' + tag + ']';\r\n    });\r\n\r\n    return term;\r\n  }\r\n\r\n  /**\r\n   * Add hashtag from settings in Nominatim's format (+[])\r\n   * @param term Query\r\n   */\r\n  private computeTermSettings(term: string): string {\r\n    this.options.settings.forEach((settings) => {\r\n      if (settings.name === 'amenity') {\r\n        settings.values.forEach((conf) => {\r\n          if (conf.enabled && typeof conf.value === 'string') {\r\n            const splitted = conf.value.split(',');\r\n            splitted.forEach((value) => {\r\n              term += '+[' + value + ']';\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n    return term;\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\n\r\nimport { NominatimSearchSource } from './nominatim';\r\nimport { SearchSource } from './source';\r\n\r\n/**\r\n * Nominatim search source factory\r\n * @ignore\r\n */\r\nexport function nominatimSearchSourceFactory(\r\n  http: HttpClient,\r\n  config: ConfigService,\r\n  storageService: StorageService\r\n) {\r\n  return new NominatimSearchSource(\r\n    http,\r\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\r\n    storageService\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Nominatim search source\r\n */\r\nexport function provideNominatimSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: nominatimSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, ConfigService, StorageService]\r\n  };\r\n}\r\n","import { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Inject, Injectable } from '@angular/core';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\r\n\r\nimport * as olformat from 'ol/format';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { Cacheable } from 'ts-cacheable';\r\n\r\nimport { FEATURE, Feature } from '../../../feature';\r\nimport { ReverseSearch, SearchResult, TextSearch } from '../search.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { SearchSource } from './source';\r\nimport {\r\n  ReverseSearchOptions,\r\n  SearchSourceOptions,\r\n  TextSearchOptions\r\n} from './source.interfaces';\r\nimport {\r\n  StoredQueriesData,\r\n  StoredQueriesFields,\r\n  StoredQueriesResponse,\r\n  StoredQueriesReverseData,\r\n  StoredQueriesReverseResponse,\r\n  StoredQueriesReverseSearchSourceOptions,\r\n  StoredQueriesSearchSourceOptions\r\n} from './storedqueries.interfaces';\r\n\r\n/**\r\n * StoredQueries search source\r\n */\r\n@Injectable()\r\nexport class StoredQueriesSearchSource\r\n  extends SearchSource\r\n  implements TextSearch\r\n{\r\n  static id = 'storedqueries';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [\r\n    'boundedBy',\r\n    'id',\r\n    'coord_x',\r\n    'coord_y'\r\n  ];\r\n  public resultTitle: 'title';\r\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\r\n  public multipleFieldsQuery: boolean;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\r\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\r\n      return;\r\n    }\r\n\r\n    const defaultStoredqueryId = 'rtss';\r\n    const defaultFieldSplitter: StoredQueriesFields[] = [\r\n      { name: 'rtss', defaultValue: '-99' },\r\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\r\n    ];\r\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\r\n    const defaultSrsname = 'EPSG:4326';\r\n    const defaultResultTitle = 'title';\r\n\r\n    if (!this.storedQueriesOptions) {\r\n      console.log(\r\n        ' No configuration for this search source (storedqueries). You will use the default values'\r\n      );\r\n      this.storedQueriesOptions = {\r\n        storedquery_id: defaultStoredqueryId,\r\n        fields: defaultFieldSplitter,\r\n        outputformat: defaultOutputformat,\r\n        srsname: defaultSrsname,\r\n        resultTitle: defaultResultTitle\r\n      };\r\n      this.resultTitle = defaultResultTitle;\r\n      console.log('Default values', this.storedQueriesOptions);\r\n    }\r\n\r\n    if (!this.storedQueriesOptions.storedquery_id) {\r\n      const err =\r\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\r\n      throw new Error(err);\r\n    }\r\n    if (!this.storedQueriesOptions.fields) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\r\n      );\r\n    }\r\n\r\n    this.storedQueriesOptions.outputformat =\r\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\r\n    this.storedQueriesOptions.srsname =\r\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\r\n\r\n    const storedQueryId =\r\n      this.storedQueriesOptions.storedquery_id.toLowerCase();\r\n    if (\r\n      storedQueryId.includes('getfeaturebyid') &&\r\n      this.storedQueriesOptions.outputformat\r\n        .toLowerCase()\r\n        .includes('getfeaturebyid')\r\n    ) {\r\n      let err =\r\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\r\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\r\n      throw new Error(err);\r\n    }\r\n\r\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\r\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\r\n    }\r\n\r\n    this.multipleFieldsQuery =\r\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\r\n\r\n    this.storedQueriesOptions.fields.forEach((field, index) => {\r\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\r\n        throw new Error(\r\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\r\n        );\r\n      }\r\n      if (!field.defaultValue) {\r\n        throw new Error(\r\n          'Stored Queries :You must set a field default value into your field definition'\r\n        );\r\n      }\r\n    });\r\n\r\n    this.storedQueriesOptions.resultTitle =\r\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\r\n  }\r\n\r\n  getId(): string {\r\n    return StoredQueriesSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return StoredQueriesSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Stored Queries',\r\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\r\n    };\r\n  }\r\n\r\n  // URL CALL EXAMPLES:\r\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\r\n  /* eslint-disable max-len */\r\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\r\n  //  Custom StoredQuery\r\n  /* eslint-disable max-len */\r\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const storedqueriesParams = this.termSplitter(\r\n      term,\r\n      this.storedQueriesOptions.fields\r\n    );\r\n    const params = this.computeRequestParams(\r\n      options || {},\r\n      storedqueriesParams\r\n    );\r\n    this.options.params = this.options.params ? this.options.params : {};\r\n    this.options.params.page = options.page ? String(options.page) : '1';\r\n\r\n    return this.getSearch(term, params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getSearch(\r\n    term: string,\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return new RegExp('.*?gml.*?', 'i').test(\r\n      this.storedQueriesOptions.outputformat\r\n    )\r\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' }).pipe(\r\n          map((response) => {\r\n            let resultArray = this.extractResults(\r\n              this.extractWFSData(response),\r\n              term\r\n            );\r\n            resultArray.sort((a, b) =>\r\n              a.meta.score > b.meta.score\r\n                ? 1\r\n                : a.meta.score === b.meta.score\r\n                ? a.meta.titleHtml < b.meta.titleHtml\r\n                  ? 1\r\n                  : -1\r\n                : -1\r\n            );\r\n            resultArray.reverse();\r\n            if (resultArray.length > Number(this.options.params.limit)) {\r\n              const idxEnd =\r\n                Number(this.options.params.limit) *\r\n                Number(this.options.params.page);\r\n              const resultTotLenght = resultArray.length;\r\n              resultArray = resultArray.slice(0, idxEnd);\r\n              if (idxEnd < resultTotLenght) {\r\n                resultArray[resultArray.length - 1].meta.nextPage = true;\r\n              } else {\r\n                resultArray[resultArray.length - 1].meta.nextPage = false;\r\n              }\r\n            }\r\n            return resultArray;\r\n          })\r\n        )\r\n      : this.http.get(this.searchUrl, { params }).pipe(\r\n          map((response) => {\r\n            return this.extractResults(this.extractWFSData(response), term);\r\n          })\r\n        );\r\n  }\r\n\r\n  private getFormatFromOptions() {\r\n    let olFormatCls;\r\n\r\n    const outputFormat = this.storedQueriesOptions.outputformat;\r\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\r\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\r\n\r\n    if (patternGeojson.test(outputFormat)) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    }\r\n    if (patternGml3.test(outputFormat)) {\r\n      olFormatCls = olformat.WFS;\r\n    }\r\n\r\n    return new olFormatCls();\r\n  }\r\n\r\n  private extractWFSData(res) {\r\n    const olFormat = this.getFormatFromOptions();\r\n    const geojson = olformat.GeoJSON;\r\n    const wfsfeatures = olFormat.readFeatures(res);\r\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\r\n    return features;\r\n  }\r\n\r\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\r\n    const splittedTerm = {};\r\n    let remainingTerm = term;\r\n    let cnt = 0;\r\n\r\n    // Used to build the default values\r\n    fields.forEach((field) => {\r\n      splittedTerm[field.name] = field.defaultValue;\r\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\r\n      if (splitterRegex.test(remainingTerm)) {\r\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\r\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\r\n      }\r\n    });\r\n    if (cnt === 0) {\r\n      splittedTerm[fields[0].name] = term;\r\n      return splittedTerm;\r\n    }\r\n    remainingTerm = term;\r\n    const localFields = [...fields].reverse();\r\n    localFields.forEach((field) => {\r\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\r\n      if (remainingTerm || remainingTerm !== '') {\r\n        const values = remainingTerm.split(splitterRegex);\r\n        remainingTerm = values[0];\r\n        if (values[1]) {\r\n          splittedTerm[field.name] = values[1].trim();\r\n        }\r\n      }\r\n    });\r\n    return splittedTerm;\r\n  }\r\n\r\n  private computeRequestParams(\r\n    options: TextSearchOptions,\r\n    queryParams\r\n  ): HttpParams {\r\n    const wfsversion = this.storedQueriesOptions.storedquery_id\r\n      .toLowerCase()\r\n      .includes('getfeaturebyid')\r\n      ? '2.0.0'\r\n      : '1.1.0';\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          service: 'wfs',\r\n          version: wfsversion,\r\n          request: 'GetFeature',\r\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\r\n          srsname: this.storedQueriesOptions.srsname,\r\n          outputformat: this.storedQueriesOptions.outputformat\r\n        },\r\n        queryParams,\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: StoredQueriesResponse,\r\n    term: string\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: StoredQueriesData) => {\r\n      return this.dataToResult(data, term);\r\n    });\r\n  }\r\n\r\n  private dataToResult(\r\n    data: StoredQueriesData,\r\n    term: string\r\n  ): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.id].join('.');\r\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\r\n      ? this.storedQueriesOptions.resultTitle\r\n      : this.resultTitle;\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        // extent: data.bbox,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties[title]\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.title,\r\n        titleHtml: data.properties[title],\r\n        icon: 'map-marker',\r\n        score: data.properties.title\r\n          ? computeTermSimilarity(term.trim(), data.properties.title)\r\n          : computeTermSimilarity(term.trim(), data.properties[title])\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\r\n    const properties = Object.assign(\r\n      {},\r\n      ObjectUtils.removeKeys(\r\n        data.properties,\r\n        StoredQueriesSearchSource.propertiesBlacklist\r\n      ),\r\n      {\r\n        Route:\r\n          '<span class=\"routing\"> <u>' +\r\n          this.languageService.translate.instant('igo.geo.seeRouting') +\r\n          '</u> </span>'\r\n      }\r\n    );\r\n    return properties;\r\n  }\r\n}\r\n\r\n/**\r\n * StoredQueriesReverse search source\r\n */\r\n\r\n// EXAMPLE CALLS\r\n/* eslint-disable max-len */\r\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\r\n//\r\n\r\n@Injectable()\r\nexport class StoredQueriesReverseSearchSource\r\n  extends SearchSource\r\n  implements ReverseSearch\r\n{\r\n  static id = 'storedqueriesreverse';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n  public resultTitle: 'title';\r\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\r\n  public multipleFieldsQuery: boolean;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n    this.storedQueriesOptions =\r\n      options as StoredQueriesReverseSearchSourceOptions;\r\n\r\n    if (\r\n      !this.storedQueriesOptions ||\r\n      (this.storedQueriesOptions && !this.storedQueriesOptions.available)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (!this.storedQueriesOptions.storedquery_id) {\r\n      const err =\r\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\r\n      throw new Error(err);\r\n    }\r\n    if (!this.storedQueriesOptions.longField) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\r\n      );\r\n    }\r\n    if (!this.storedQueriesOptions.latField) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\r\n      );\r\n    }\r\n\r\n    this.storedQueriesOptions.outputformat =\r\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\r\n    this.storedQueriesOptions.srsname =\r\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\r\n    this.storedQueriesOptions.resultTitle =\r\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\r\n  }\r\n\r\n  getId(): string {\r\n    return StoredQueriesReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return StoredQueriesReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Stored Queries (reverse)',\r\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param distance Search raidus around lonLat\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(lonLat, options || {});\r\n    return this.getReverseSearch(params);\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20,\r\n    cacheHasher: customCacheHasher\r\n  })\r\n  private getReverseSearch(\r\n    params: HttpParams\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const isGml = new RegExp('.*?gml.*?', 'i').test(\r\n      this.storedQueriesOptions.outputformat\r\n    );\r\n    const request$ = isGml\r\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' })\r\n      : this.http.get(this.searchUrl, { params });\r\n    return request$.pipe(\r\n      map((response) => {\r\n        return this.extractResults(this.extractWFSData(response));\r\n      })\r\n    );\r\n  }\r\n\r\n  private getFormatFromOptions() {\r\n    let olFormatCls;\r\n\r\n    const outputFormat = this.storedQueriesOptions.outputformat;\r\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\r\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\r\n\r\n    if (patternGeojson.test(outputFormat)) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    }\r\n    if (patternGml3.test(outputFormat)) {\r\n      olFormatCls = olformat.WFS;\r\n    }\r\n\r\n    return new olFormatCls();\r\n  }\r\n\r\n  private extractWFSData(res) {\r\n    const olFormat = this.getFormatFromOptions();\r\n    const geojson = olformat.GeoJSON;\r\n    const wfsfeatures = olFormat.readFeatures(res);\r\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\r\n    return features;\r\n  }\r\n\r\n  private computeRequestParams(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): HttpParams {\r\n    const longLatParams = {};\r\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\r\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\r\n\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          service: 'WFS',\r\n          version: '1.1.0',\r\n          request: 'GetFeature',\r\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\r\n          srsname: this.storedQueriesOptions.srsname,\r\n          outputformat: this.storedQueriesOptions.outputformat\r\n        },\r\n        longLatParams,\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: StoredQueriesReverseResponse\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: StoredQueriesReverseData) => {\r\n      return this.dataToResult(data);\r\n    });\r\n  }\r\n\r\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.id].join('.');\r\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\r\n      ? this.storedQueriesOptions.resultTitle\r\n      : this.resultTitle;\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties[title]\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties[title],\r\n        icon: 'map-marker'\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: StoredQueriesReverseData): {\r\n    [key: string]: any;\r\n  } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      StoredQueriesReverseSearchSource.propertiesBlacklist\r\n    );\r\n    const routing = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n    return Object.assign(\r\n      properties,\r\n      { type: data.properties.doc_type },\r\n      routing\r\n    );\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport {\r\n  StoredQueriesReverseSearchSource,\r\n  StoredQueriesSearchSource\r\n} from './storedqueries';\r\n\r\n/**\r\n * StoredQueries search source factory\r\n * @ignore\r\n */\r\nexport function storedqueriesSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService\r\n) {\r\n  return new StoredQueriesSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the StoredQueries search source\r\n */\r\nexport function provideStoredQueriesSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: storedqueriesSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\r\n  };\r\n}\r\n\r\n/**\r\n * StoredQueriesReverse search source factory\r\n * @ignore\r\n */\r\n\r\nexport function storedqueriesReverseSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService\r\n) {\r\n  return new StoredQueriesReverseSearchSource(\r\n    http,\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the StoredQueriesReverse search source\r\n */\r\nexport function provideStoredQueriesReverseSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: storedqueriesReverseSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\r\n  };\r\n}\r\n","import { Inject, Injectable } from '@angular/core';\r\n\r\nimport { LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport pointOnFeature from '@turf/point-on-feature';\r\nimport { SimpleDocumentSearchResultSetUnit } from 'flexsearch';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\n\r\nimport { FEATURE, Feature } from '../../../feature';\r\nimport { Layer } from '../../../layer/shared/layers/layer';\r\nimport { GoogleLinks } from '../../../utils/googleLinks';\r\nimport { SearchResult, TextSearch } from '../search.interfaces';\r\nimport { computeTermSimilarity } from '../search.utils';\r\nimport { SearchSource } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\nimport { WorkspaceData } from './workspace.interfaces';\r\n\r\n/**\r\n * Workspace search source\r\n */\r\n@Injectable()\r\nexport class WorkspaceSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'workspace';\r\n  static type = FEATURE;\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    storageService: StorageService,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options, storageService);\r\n\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe((title) => this.title$.next(title));\r\n  }\r\n\r\n  getId(): string {\r\n    return WorkspaceSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return WorkspaceSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const limit: Number = 5;\r\n\r\n    return {\r\n      title: 'igo.geo.search.workspace.name',\r\n      searchUrl: undefined,\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'datasets',\r\n          name: 'datasets',\r\n          values: []\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            { title: '1', value: 1, enabled: limit === 1 },\r\n            { title: '5', value: 5, enabled: limit === 5 || !limit },\r\n            { title: '10', value: 10, enabled: limit === 10 },\r\n            { title: '25', value: 25, enabled: limit === 25 },\r\n            { title: '50', value: 50, enabled: limit === 50 }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const limitSetting = this.settings.find((s) => s.name === 'limit');\r\n    const limitValue =\r\n      (limitSetting.values.find((v) => v.enabled).value as number) || 5;\r\n    this.options.params.limit = limitValue.toLocaleString();\r\n    const results: WorkspaceData[] = [];\r\n    this.options.params.page = (options.page || 1).toLocaleString();\r\n    const page = options.page || 1;\r\n    const datasets = this.options.params.datasets.split(',');\r\n    this.featureStoresWithIndex\r\n      .filter(\r\n        (fswi) => fswi.searchDocument && datasets.includes(fswi.layer.title)\r\n      )\r\n      .map((fswi) => {\r\n        const termToUse = term;\r\n        fswi.searchDocument\r\n          .search(termToUse, { limit: page * limitValue })\r\n          .map((i) => {\r\n            const foundIn: SimpleDocumentSearchResultSetUnit = i;\r\n            const field = foundIn.field;\r\n            foundIn.result.map((index) => {\r\n              const feature = fswi.index.get(index);\r\n              const score = computeTermSimilarity(\r\n                termToUse.trim(),\r\n                feature.properties[field]\r\n              );\r\n              results.push({ index, feature, layer: fswi.layer, field, score });\r\n            });\r\n          });\r\n      });\r\n\r\n    results.sort((a, b) => (a.score > b.score ? -1 : 1));\r\n    const gettedIndex = [];\r\n    const sortedResultToProcess: WorkspaceData[] = [];\r\n    results.map((r) => {\r\n      if (!gettedIndex.includes(r.index)) {\r\n        gettedIndex.push(r.index);\r\n        sortedResultToProcess.push(r);\r\n      }\r\n    });\r\n\r\n    return of(\r\n      this.extractResults(\r\n        sortedResultToProcess\r\n          .sort((a, b) => (a.score > b.score ? -1 : 1))\r\n          .slice(0, page * limitValue)\r\n      )\r\n    );\r\n  }\r\n\r\n  private extractResults(results: WorkspaceData[]): SearchResult<Feature>[] {\r\n    return results.map((result) => this.dataToResult(result, results.length));\r\n  }\r\n\r\n  private dataToResult(\r\n    data: WorkspaceData,\r\n    resultsCnt: number\r\n  ): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.index].join('.');\r\n    const titleHtml = data.feature.properties[data.field];\r\n    const subtitleHtml2 = '<br><small> ' + data.layer.title + '</small>';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.feature.geometry,\r\n        extent: data.feature.extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.feature.properties[data.field],\r\n          alias: this.getAllowedFieldsAndAlias(data.layer)\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.feature.meta.title,\r\n        titleHtml: titleHtml + subtitleHtml2,\r\n        icon: 'map-marker',\r\n        score: data.score,\r\n        nextPage:\r\n          resultsCnt % +this.options.params.limit === 0 &&\r\n          +this.options.params.page < 10\r\n      }\r\n    } as SearchResult<Feature>;\r\n  }\r\n\r\n  private getAllowedFieldsAndAlias(layer: Layer) {\r\n    let allowedFieldsAndAlias;\r\n    if (\r\n      layer.options?.source?.options?.sourceFields &&\r\n      layer.options.source.options.sourceFields.length >= 1\r\n    ) {\r\n      allowedFieldsAndAlias = {};\r\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\r\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\r\n        allowedFieldsAndAlias[sourceField.name] = alias;\r\n      });\r\n    }\r\n    return allowedFieldsAndAlias;\r\n  }\r\n\r\n  private computeProperties(data: WorkspaceData): { [key: string]: any } {\r\n    if (!data.feature.geometry) {\r\n      return Object.assign(\r\n        { type: data.layer.title + '.' + data.field },\r\n        data.feature.properties\r\n      );\r\n    }\r\n    const googleLinksProperties: {\r\n      GoogleMaps: string;\r\n      GoogleStreetView?: string;\r\n    } = {\r\n      GoogleMaps: ''\r\n    };\r\n    let googleMaps;\r\n    if (data.feature.geometry.type === 'Point') {\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        data.feature.geometry.coordinates[0],\r\n        data.feature.geometry.coordinates[1]\r\n      );\r\n    } else {\r\n      const point = pointOnFeature(data.feature.geometry);\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        point.geometry.coordinates[0],\r\n        point.geometry.coordinates[1]\r\n      );\r\n    }\r\n    googleLinksProperties.GoogleMaps =\r\n      '<a href=' +\r\n      googleMaps +\r\n      ' target=\"_blank\">' +\r\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\r\n      '</a>';\r\n    if (data.feature.geometry.type === 'Point') {\r\n      googleLinksProperties.GoogleStreetView =\r\n        GoogleLinks.getGoogleStreetViewLink(\r\n          data.feature.geometry.coordinates[0],\r\n          data.feature.geometry.coordinates[1]\r\n        );\r\n    }\r\n    const routing: {\r\n      Route: string;\r\n    } = {\r\n      Route:\r\n        '<span class=\"routing\"> <u>' +\r\n        this.languageService.translate.instant('igo.geo.seeRouting') +\r\n        '</u> </span>'\r\n    };\r\n    return Object.assign(\r\n      { type: data.feature.sourceId },\r\n      data.feature.properties,\r\n      googleLinksProperties,\r\n      routing\r\n    );\r\n  }\r\n}\r\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport { WorkspaceSearchSource } from './workspace';\r\n\r\n/**\r\n * Workspace search source factory\r\n * @ignore\r\n */\r\nexport function workspaceSearchSourceFactory(\r\n  languageService: LanguageService,\r\n  storageService: StorageService,\r\n  config: ConfigService\r\n) {\r\n  return new WorkspaceSearchSource(\r\n    languageService,\r\n    storageService,\r\n    config.getConfig(`searchSources.${WorkspaceSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Workspace search source\r\n */\r\nexport function provideWorkspaceSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: workspaceSearchSourceFactory,\r\n    multi: true,\r\n    deps: [LanguageService, StorageService, ConfigService]\r\n  };\r\n}\r\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\"\n  >\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\"\n  >\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\"\n    >\n      <mat-radio-button\n        *ngFor=\"let searchType of searchTypes\"\n        [value]=\"searchType\"\n      >\n        {{ getSearchTypeTitle(searchType) | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\nimport { SEARCH_TYPES } from '../shared/search.enums';\r\n\r\n/**\r\n * This component allows a user to select a search type yo enable. In it's\r\n * current version, only one search type can be selected at once (radio). If\r\n * this component were to support more than one search source enabled (checkbox),\r\n * the searchbar component would require a small change to it's\r\n * placeholder getter. The search source service already supports having\r\n * more than one search source enabled.\r\n */\r\n@Component({\r\n  selector: 'igo-search-selector',\r\n  templateUrl: './search-selector.component.html',\r\n  styleUrls: ['./search-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Subscription to the search type\r\n   */\r\n  private searchType$$: Subscription;\r\n\r\n  /**\r\n   * List of available search types\r\n   */\r\n  @Input() searchTypes: string[] = SEARCH_TYPES;\r\n\r\n  /**\r\n   * The search type enabled\r\n   */\r\n  @Input()\r\n  set searchType(value: string) {\r\n    this.setSearchType(value);\r\n  }\r\n  get searchType(): string {\r\n    return this.searchType$.value;\r\n  }\r\n\r\n  /**\r\n   * Event emitted when the enabled search type changes\r\n   */\r\n  @Output() searchTypeChange = new EventEmitter<string>();\r\n\r\n  constructor(private searchSourceService: SearchSourceService) {}\r\n\r\n  ngOnInit() {\r\n    this.searchType$$ = this.searchType$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.searchType$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Enable the selected search type\r\n   * @param searchType Search type\r\n   * @internal\r\n   */\r\n  onSearchTypeChange(searchType: string) {\r\n    this.setSearchType(searchType);\r\n  }\r\n\r\n  /**\r\n   * Get a search type's title. The title\r\n   * for all availables search typers needs to be defined in the locale\r\n   * files or an error will be thrown.\r\n   * @param searchType Search type\r\n   * @internal\r\n   */\r\n  getSearchTypeTitle(searchType: string) {\r\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\r\n  }\r\n\r\n  /**\r\n   * Emit an event and enable the search sources of the given type.\r\n   * @param searchType Search type\r\n   */\r\n  private setSearchType(searchType: string | undefined) {\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  private onSetSearchType(searchType: string) {\r\n    if (searchType === undefined || searchType === null) {\r\n      return;\r\n    }\r\n\r\n    this.searchSourceService.enableSourcesByType(searchType);\r\n    this.searchTypeChange.emit(searchType);\r\n  }\r\n}\r\n","<div class=\"igo-search-settings\">\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\"\n  >\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n  </button>\n  <mat-menu #searchSettingsMenu=\"matMenu\" class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length > 4\">\n      <button mat-raised-button (click)=\"checkUncheckAllSources($event)\">\n        {{\n          !searchSourcesAllEnabled\n            ? ('igo.geo.search.searchSources.unselectAll' | translate)\n            : ('igo.geo.search.searchSources.selectAll' | translate)\n        }}\n      </button>\n    </div>\n    <ng-container *ngFor=\"let source of getSearchSources()\">\n      <span class=\"igo-search-settings-search-source\">\n        <mat-checkbox\n          class=\"igo-search-settings-checkbox\"\n          [checked]=\"source.enabled\"\n          [value]=\"source\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"onCheckSearchSource($event, source)\"\n        >\n        </mat-checkbox>\n        <button\n          *ngIf=\"source.settings.length > 0\"\n          [matMenuTriggerFor]=\"sub_menu\"\n          mat-menu-item\n        >\n          {{ source.title }}\n        </button>\n        <button mat-menu-item *ngIf=\"source.settings.length === 0\">\n          {{ source.title }}\n        </button>\n      </span>\n      <mat-menu #sub_menu=\"matMenu\">\n        <ng-container *ngFor=\"let setting of source.settings\">\n          <button mat-menu-item [matMenuTriggerFor]=\"test_sub_menu\">\n            {{\n              'igo.geo.search.searchSources.settings.' + setting.title\n                | translate\n            }}\n          </button>\n          <mat-menu\n            #test_sub_menu=\"matMenu\"\n            [ngSwitch]=\"setting.type\"\n            yPosition=\"above\"\n          >\n            <span *ngSwitchCase=\"'radiobutton'\">\n              <mat-radio-group\n                class=\"igo-search-settings-radio-group\"\n                [value]=\"setting\"\n              >\n                <mat-radio-button\n                  *ngFor=\"let settingValue of setting.values\"\n                  class=\"mat-typography\"\n                  [value]=\"settingValue\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  [checked]=\"settingValue.enabled\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedRadioButton(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-radio-button>\n              </mat-radio-group>\n            </span>\n            <span *ngSwitchCase=\"'checkbox'\">\n              <div class=\"checkAllButton\" *ngIf=\"setting.values.length > 3\">\n                <button\n                  mat-raised-button\n                  (click)=\"checkUncheckAll($event, source, setting)\"\n                >\n                  {{\n                    setting.allEnabled || setting.allEnabled === undefined\n                      ? ('igo.geo.search.searchSources.settings.unselectAll'\n                        | translate)\n                      : ('igo.geo.search.searchSources.settings.selectAll'\n                        | translate)\n                  }}\n                </button>\n              </div>\n              <div mat-menu-item>\n                <mat-checkbox\n                  *ngFor=\"let settingValue of getAvailableValues(setting)\"\n                  [style.display]=\"displayBlock\"\n                  [checked]=\"settingValue.enabled\"\n                  [value]=\"setting\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedCheckbox(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-checkbox>\n              </div>\n            </span>\n          </mat-menu>\n        </ng-container>\n      </mat-menu>\n    </ng-container>\n    <mat-divider></mat-divider>\n    <span class=\"pointer-summary-slide-toggle-container\">\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changePointerReverseSearch($event)\"\n          tooltip-position=\"below\"\n          *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.pointerSearchSummary.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"pointerSummaryEnabled\"\n        >\n          {{ 'igo.geo.search.pointerSearchSummary.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changeSearchResultsGeometry($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.searchResultsGeometry.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"searchResultsGeometryEnabled\"\n        >\n          {{ 'igo.geo.search.searchResultsGeometry.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"reverseSearchCoordsFormat($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            reverseSearchCoordsFormatEnabled\n              ? ('igo.geo.search.reverseCoordFormat.tooltipLatLon' | translate)\n              : ('igo.geo.search.reverseCoordFormat.tooltipLonLat' | translate)\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"reverseSearchCoordsFormatEnabled\"\n        >\n          {{ 'igo.geo.search.reverseCoordFormat.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n    </span>\n  </mat-menu>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  HostListener,\r\n  Input,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { MatCheckboxChange } from '@angular/material/checkbox';\r\nimport { MatRadioChange } from '@angular/material/radio';\r\n\r\nimport { MediaService, StorageService } from '@igo2/core';\r\n\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\nimport {\r\n  sourceCanReverseSearch,\r\n  sourceCanReverseSearchAsSummary,\r\n  sourceCanSearch\r\n} from '../shared/search.utils';\r\nimport { SearchSource } from '../shared/sources/source';\r\nimport {\r\n  SearchSourceSettings,\r\n  SettingOptions\r\n} from '../shared/sources/source.interfaces';\r\n\r\n/**\r\n * This component allows a user to select a search type yo enable. In it's\r\n * current version, only one search type can be selected at once (radio). If\r\n * this component were to support more than one search source enabled (checkbox),\r\n * the searchbar component would require a small change to it's\r\n * placeholder getter. The search source service already supports having\r\n * more than one search source enabled.\r\n */\r\n@Component({\r\n  selector: 'igo-search-settings',\r\n  templateUrl: './search-settings.component.html',\r\n  styleUrls: ['./search-settings.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchSettingsComponent implements OnInit {\r\n  public hasPointerReverseSearchSource: boolean = false;\r\n  public searchSourcesAllEnabled: boolean = false;\r\n\r\n  public buffer = [];\r\n  public lastKeyTime = Date.now();\r\n\r\n  public displayBlock = 'block';\r\n\r\n  get isTouchScreen(): boolean {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  @Input() pointerSummaryEnabled: boolean = false;\r\n  @Input() searchResultsGeometryEnabled: boolean = false;\r\n  @Input() reverseSearchCoordsFormatEnabled: boolean = false;\r\n\r\n  /**\r\n   * Event emitted when the enabled search source changes\r\n   */\r\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\r\n\r\n  /**\r\n   * Event emitted when the pointer summary is activated\r\n   */\r\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the show geometry summary is changed\r\n   */\r\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the coords format is changed\r\n   */\r\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\r\n\r\n  @HostListener('document:keydown', ['$event'])\r\n  handleKeyboardEvent(event: KeyboardEvent) {\r\n    if (event.key === 'F2') {\r\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\r\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private mediaService: MediaService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.hasPointerReverseSearchSource =\r\n      this.hasReverseSearchSourcesForPointerSummary();\r\n  }\r\n\r\n  /**\r\n   * Get all search sources\r\n   * @internal\r\n   */\r\n  getSearchSources(): SearchSource[] {\r\n    const textSearchSources = this.searchSourceService\r\n      .getSources()\r\n      .filter(sourceCanSearch)\r\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\r\n\r\n    const reverseSearchSources = this.searchSourceService\r\n      .getSources()\r\n      .filter(sourceCanReverseSearch)\r\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\r\n    const sources = textSearchSources.concat(reverseSearchSources);\r\n    this.computeSourcesCheckAllBehavior(sources);\r\n    return sources;\r\n  }\r\n\r\n  /**\r\n   * Get all search sources usable for pointer summary\r\n   * @internal\r\n   */\r\n  hasReverseSearchSourcesForPointerSummary(): boolean {\r\n    if (\r\n      this.searchSourceService\r\n        .getEnabledSources()\r\n        .filter(sourceCanReverseSearchAsSummary).length\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Triggered when a setting is checked (checkbox style)\r\n   * @internal\r\n   */\r\n  settingsValueCheckedCheckbox(\r\n    event: MatCheckboxChange,\r\n    source: SearchSource,\r\n    setting: SearchSourceSettings,\r\n    settingValue: SettingOptions\r\n  ) {\r\n    settingValue.enabled = event.checked;\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  /**\r\n   * Defining the action to do for check/uncheck checkboxes (settings)\r\n   * return true if all checkbox must be checked\r\n   * return false if all checkbox must be unchecked\r\n   * @internal\r\n   */\r\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\r\n    if (setting.allEnabled === undefined) {\r\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\r\n        setting.allEnabled = false;\r\n      } else {\r\n        setting.allEnabled = true;\r\n      }\r\n    } else {\r\n      setting.allEnabled = !setting.allEnabled;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Defining the action to do for check/uncheck checkboxes (sources)\r\n   * return true if all checkbox must be checked\r\n   * return false if all checkbox must be unchecked\r\n   * @internal\r\n   */\r\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\r\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\r\n    const disabledSourcesCnt = sources.filter(\r\n      (source) => !source.enabled\r\n    ).length;\r\n    this.searchSourcesAllEnabled =\r\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\r\n  }\r\n\r\n  /**\r\n   * Triggered when the check all / uncheck all type is clicked,\r\n   * @internal\r\n   */\r\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\r\n    event.stopPropagation();\r\n    this.computeSettingCheckAllBehavior(setting);\r\n    setting.values.forEach((settingValue) => {\r\n      settingValue.enabled = setting.allEnabled;\r\n    });\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  /**\r\n   * Triggered when the check all / uncheck all type is clicked,\r\n   * @internal\r\n   */\r\n  checkUncheckAllSources(event) {\r\n    event.stopPropagation();\r\n    this.getSearchSources().map((source) => {\r\n      source.enabled = this.searchSourcesAllEnabled;\r\n      this.searchSourceChange.emit(source);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Triggered when a setting is checked (radiobutton style)\r\n   * @internal\r\n   */\r\n  settingsValueCheckedRadioButton(\r\n    event: MatRadioChange,\r\n    source: SearchSource,\r\n    setting: SearchSourceSettings,\r\n    settingValue: SettingOptions\r\n  ) {\r\n    setting.values.forEach((conf) => {\r\n      if (conf.value !== settingValue.value) {\r\n        conf.enabled = !event.source.checked;\r\n      } else {\r\n        conf.enabled = event.source.checked;\r\n      }\r\n    });\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\r\n    source.enabled = event.checked;\r\n    const storage = (this.storageService.get(source.getId() + '.options') ||\r\n      {}) as SettingOptions;\r\n    storage.enabled = source.enabled;\r\n    this.storageService.set(source.getId() + '.options', storage);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  getAvailableValues(setting: SearchSourceSettings) {\r\n    return setting.values.filter((s) => s.available !== false);\r\n  }\r\n\r\n  getAvailableHashtagsValues(setting: SettingOptions) {\r\n    if (setting.hashtags) {\r\n      return setting.hashtags.map((h) => '#' + h).join(', ');\r\n    }\r\n    return;\r\n  }\r\n\r\n  stopPropagation(event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  changePointerReverseSearch(event) {\r\n    this.pointerSummaryEnabled = event.checked;\r\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\r\n  }\r\n\r\n  changeSearchResultsGeometry(event) {\r\n    this.searchResultsGeometryEnabled = event.checked;\r\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\r\n  }\r\n\r\n  reverseSearchCoordsFormat(event) {\r\n    this.reverseSearchCoordsFormatEnabled = event.checked;\r\n    this.reverseSearchCoordsFormatStatus.emit(\r\n      this.reverseSearchCoordsFormatEnabled\r\n    );\r\n  }\r\n}\r\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{ empty: empty$ | async }\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{ label }}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{ hasSearchIcon: showSearchButton }\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"\n        placeholder\n          ? placeholder\n          : (placeholder$ | async)\n          ? (placeholder$.value | translate)\n          : undefined\n      \"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n      (touchend)=\"onKeyup($event)\"\n    />\n    <button\n      *ngIf=\"(empty$ | async) === false\"\n      mat-icon-button\n      matSuffix\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\"\n      [matTooltip]=\"'igo.geo.search.clearSearch' | translate\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-divider *ngIf=\"withDivider\" [vertical]=\"true\"></mat-divider>\n\n  <div class=\"search-bar-buttons\">\n    <button *ngIf=\"showSearchButton\" mat-icon-button [color]=\"color\">\n      <mat-icon svgIcon=\"magnify\"></mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\"\n    >\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      [reverseSearchCoordsFormatEnabled]=\"reverseSearchCoordsFormatEnabled\"\n      (reverseSearchCoordsFormatStatus)=\"\n        reverseSearchCoordsFormatStatus.emit($event)\n      \"\n      (searchSourceChange)=\"onSearchSettingsChange()\"\n    >\n    </igo-search-settings>\n  </div>\n</div>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  ElementRef,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport {\r\n  FloatLabelType,\r\n  MatFormFieldAppearance\r\n} from '@angular/material/form-field';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, Subscription, timer } from 'rxjs';\r\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\nimport { SEARCH_TYPES } from '../shared/search.enums';\r\nimport { Research, SearchResult } from '../shared/search.interfaces';\r\nimport { SearchService } from '../shared/search.service';\r\n\r\n/**\r\n * Searchbar that triggers a research in all search sources enabled.\r\n * If the store input is defined, the search results will be loaded\r\n * into that store. An event is always emitted when a research is completed.\r\n */\r\n@Component({\r\n  selector: 'igo-search-bar',\r\n  templateUrl: './search-bar.component.html',\r\n  styleUrls: ['./search-bar.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchBarComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Invalid keys\r\n   */\r\n  static invalidKeys = [\r\n    'Control',\r\n    'Shift',\r\n    'Alt',\r\n    'ArrowDown',\r\n    'ArrowUp',\r\n    'ArrowRight',\r\n    'ArrowLeft'\r\n  ];\r\n\r\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'igo.geo.search.placeholder'\r\n  );\r\n\r\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  /**\r\n   * Subscription to the ssearch bar term\r\n   */\r\n  private term$$: Subscription;\r\n\r\n  /**\r\n   * Search term stream\r\n   */\r\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n  /**\r\n   * Subscription to the search term stream\r\n   */\r\n  private stream$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the search type\r\n   */\r\n  private searchType$$: Subscription;\r\n\r\n  private researches$$: Subscription[];\r\n\r\n  /**\r\n   * whether to show search button or not\r\n   */\r\n\r\n  public showSearchButton: boolean = false;\r\n\r\n  /**\r\n   * List of available search types\r\n   */\r\n  @Input() searchTypes: string[] = SEARCH_TYPES;\r\n\r\n  @Input() withDivider: boolean;\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  set searchType(value: string) {\r\n    this.setSearchType(value);\r\n  }\r\n  get searchType(): string {\r\n    return this.searchType$.value;\r\n  }\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Event emitted when the pointer summary is activated by the searchbar setting\r\n   */\r\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the show geometry setting is changed\r\n   */\r\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Event emitted when the coords format setting is changed\r\n   */\r\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  set term(value: string) {\r\n    this.setTerm(value);\r\n  }\r\n  get term(): string {\r\n    return this.term$.value;\r\n  }\r\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n  /**\r\n   * Whether this component is disabled\r\n   */\r\n  @Input()\r\n  set disabled(value: boolean) {\r\n    this.disabled$.next(value);\r\n  }\r\n  get disabled(): boolean {\r\n    return this.disabled$.value;\r\n  }\r\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  @Input() pointerSummaryEnabled: boolean = false;\r\n  @Input() searchResultsGeometryEnabled: boolean = false;\r\n\r\n  /**\r\n   * When reverse coordinates status change\r\n   */\r\n  @Input()\r\n  get reverseSearchCoordsFormatEnabled(): boolean {\r\n    return this._reverseSearchCoordsFormatEnabled;\r\n  }\r\n  set reverseSearchCoordsFormatEnabled(value: boolean) {\r\n    this._reverseSearchCoordsFormatEnabled = value;\r\n    this.setTerm(this.term, true);\r\n  }\r\n  private _reverseSearchCoordsFormatEnabled = false;\r\n\r\n  /**\r\n   * Whether a float label should be displayed\r\n   */\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input() appearance: MatFormFieldAppearance = 'fill';\r\n\r\n  @Input() placeholder: string;\r\n\r\n  @Input() label: string;\r\n\r\n  /**\r\n   * Icons color (search and clear)\r\n   */\r\n  @Input() color = 'primary';\r\n\r\n  @Input() termSplitter: string = '|';\r\n\r\n  /**\r\n   * Debounce time between each keystroke\r\n   */\r\n  @Input() debounce = 200;\r\n\r\n  /**\r\n   * Minimum term length required to trigger a research\r\n   */\r\n  @Input() minLength = 2;\r\n\r\n  /**\r\n   * Search Selector\r\n   */\r\n  @Input() searchSelector = false;\r\n\r\n  /**\r\n   * Search Settings\r\n   */\r\n  @Input() searchSettings = false;\r\n\r\n  /**\r\n   * Force coordinates in north america\r\n   */\r\n  @Input() forceNA = false;\r\n\r\n  /**\r\n   * Search results store\r\n   */\r\n  @Input() store: EntityStore<SearchResult>;\r\n\r\n  /**\r\n   * Event emitted when the search term changes\r\n   */\r\n  @Output() searchTermChange = new EventEmitter<string>();\r\n\r\n  /**\r\n   * Event emitted when a research is completed\r\n   */\r\n  @Output() search = new EventEmitter<{\r\n    research: Research;\r\n    results: SearchResult[];\r\n  }>();\r\n\r\n  /**\r\n   * Event emitted when the search type changes\r\n   */\r\n  @Output() searchTypeChange = new EventEmitter<string>();\r\n\r\n  /**\r\n   * Event emitted when the search type changes\r\n   */\r\n  @Output() clearFeature = new EventEmitter();\r\n\r\n  /**\r\n   * Event emitted when the search settings changes\r\n   */\r\n  @Output() searchSettingsChange = new EventEmitter();\r\n\r\n  /**\r\n   * Input element\r\n   * @internal\r\n   */\r\n  @ViewChild('input', { static: true }) input: ElementRef;\r\n\r\n  /**\r\n   * Whether the search bar is empty\r\n   * @internal\r\n   */\r\n  get empty(): boolean {\r\n    return this.term.length === 0;\r\n  }\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    private searchService: SearchService,\r\n    private searchSourceService: SearchSourceService\r\n  ) {}\r\n\r\n  /**\r\n   * Subscribe to the search term stream and trigger researches\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.term$$ = this.term$.subscribe((term: string) => {\r\n      this.empty$.next(term === undefined || term.length === 0);\r\n    });\r\n\r\n    this.stream$$ = this.stream$\r\n      .pipe(debounce(() => timer(this.debounce)))\r\n      .subscribe((term: string) => this.onSetTerm(term));\r\n\r\n    this.handlePlaceholder();\r\n\r\n    this.searchType$$ = this.searchType$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\r\n\r\n    const configValue = this.configService.getConfig(\r\n      'searchBar.showSearchButton'\r\n    );\r\n    this.showSearchButton = configValue !== undefined ? configValue : false;\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the search term stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.term$$.unsubscribe();\r\n    this.stream$$.unsubscribe();\r\n    this.searchType$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * When a user types, validates the key and send it into the\r\n   * stream if it's valid\r\n   * @param event Keyboard event\r\n   * @internal\r\n   */\r\n  onKeyup(event: KeyboardEvent) {\r\n    const key = event.key;\r\n    if (!this.keyIsValid(key)) {\r\n      return;\r\n    }\r\n    const term = (event.target as HTMLInputElement).value;\r\n    this.setTerm(term);\r\n  }\r\n\r\n  /**\r\n   * Clear the stream and the input\r\n   * @internal\r\n   */\r\n  onClearButtonClick() {\r\n    this.clear();\r\n    this.clearFeature.emit();\r\n  }\r\n\r\n  /**\r\n   * Update search type\r\n   * @param searchType Enabled search type\r\n   * @internal\r\n   */\r\n  onSearchTypeChange(searchType: string) {\r\n    this.setSearchType(searchType);\r\n  }\r\n\r\n  /**\r\n   * Update the placeholder with the enabled search type. The placeholder\r\n   * for all availables search typers needs to be defined in the locale\r\n   * files or an error will be thrown.\r\n   * @param searchType Enabled search type\r\n   * @internal\r\n   */\r\n  setSearchType(searchType: string) {\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  onSearchSettingsChange() {\r\n    this.doSearch(this.term);\r\n    this.searchSettingsChange.emit();\r\n    this.handlePlaceholder();\r\n  }\r\n\r\n  /**\r\n   * Send the term into the stream only if this component is not disabled\r\n   * @param term Search term\r\n   */\r\n  setTerm(term: string, reverseCoordEvent?: boolean) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    term = term || '';\r\n\r\n    if (term !== this.term && !reverseCoordEvent) {\r\n      this.term$.next(term);\r\n    }\r\n\r\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\r\n    if (slug.length >= this.minLength || slug.length === 0) {\r\n      this.stream$.next(term);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the stream and the input\r\n   */\r\n  private clear() {\r\n    this.term$.next('');\r\n    this.stream$.next('');\r\n    this.input.nativeElement.focus();\r\n  }\r\n\r\n  /**\r\n   * Validate if a given key stroke is a valid input\r\n   */\r\n  private keyIsValid(key: string) {\r\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\r\n  }\r\n\r\n  /**\r\n   * When the search term changes, emit an event and trigger a\r\n   * research in every enabled search sources.\r\n   * @param term Search term\r\n   */\r\n  private onSetTerm(term: string | undefined) {\r\n    this.searchTermChange.emit(term);\r\n    this.doSearch(term);\r\n  }\r\n\r\n  private handlePlaceholder() {\r\n    const searchTypes = [\r\n      ...new Set(\r\n        this.searchSourceService\r\n          .getEnabledSources()\r\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\r\n          .map((ss) => ss.getType())\r\n      )\r\n    ];\r\n\r\n    let placeholder = `igo.geo.search.placeholder`;\r\n    if (searchTypes.length === 1) {\r\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\r\n    } else if (searchTypes.length === 0) {\r\n      placeholder = `igo.geo.search.emptyType.placeholder`;\r\n    }\r\n    this.placeholder$.next(placeholder);\r\n  }\r\n\r\n  private onSetSearchType(searchType: string) {\r\n    if (searchType === undefined || searchType === null) {\r\n      return;\r\n    }\r\n\r\n    this.searchTypeChange.emit(searchType);\r\n\r\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\r\n    this.placeholder$.next(placeholder);\r\n\r\n    this.setTerm(this.term);\r\n  }\r\n\r\n  /**\r\n   * Execute the search\r\n   * @param term Search term\r\n   */\r\n  private doSearch(rawTerm: string | undefined) {\r\n    if (this.researches$$) {\r\n      this.researches$$.map((research) => research.unsubscribe());\r\n      this.researches$$ = undefined;\r\n    }\r\n\r\n    let terms;\r\n    if (\r\n      this.termSplitter &&\r\n      rawTerm.match(new RegExp(this.termSplitter, 'g'))\r\n    ) {\r\n      terms = rawTerm\r\n        .split(this.termSplitter)\r\n        .filter((t) => t.length >= this.minLength);\r\n      if (this.store) {\r\n        this.store.clear();\r\n      }\r\n    } else {\r\n      terms = [rawTerm];\r\n    }\r\n\r\n    let researches: Research[] = [];\r\n    terms.map((term: string) => {\r\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\r\n      if (slug === '') {\r\n        if (this.store !== undefined) {\r\n          this.store.clear();\r\n        }\r\n        return;\r\n      }\r\n\r\n      researches = researches.concat(\r\n        this.searchService.search(term, {\r\n          forceNA: this.forceNA\r\n        })\r\n      );\r\n    });\r\n    this.researches$$ = researches.map((research) => {\r\n      return research.request.subscribe((results: SearchResult[]) => {\r\n        this.onResearchCompleted(research, results);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * When a research  is completed, emit an event and update\r\n   * the store's items.\r\n   * @param research Research\r\n   * @param results Research results\r\n   */\r\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\r\n    this.search.emit({ research, results });\r\n\r\n    if (this.store !== undefined) {\r\n      const newResults = this.store\r\n        .all()\r\n        .filter((result) => result.source !== research.source)\r\n        .concat(results);\r\n      this.store.updateMany(newResults);\r\n    }\r\n  }\r\n}\r\n","<mat-list-item\n  (mouseenter)=\"onMouseEvent($event)\"\n  (mouseleave)=\"onMouseEvent($event)\"\n>\n  <mat-icon\n    *ngIf=\"icon\"\n    matListItemIcon\n    [svgIcon]=\"showIcons ? icon : 'blank'\"\n  ></mat-icon>\n\n  <div\n    matListItemTitle\n    *ngIf=\"titleHtml; else normalTitle\"\n    [innerHtml]=\"titleHtml\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"tooltipHtml\"\n    matTooltipClass=\"search-result-tooltip\"\n  ></div>\n  <ng-template #normalTitle>\n    <span\n      matListItemTitle\n      *ngIf=\"!titleHtml\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"title\"\n      >{{ title }}</span\n    >\n  </ng-template>\n\n  <div matListItemMeta>\n    <button\n      *ngIf=\"withZoomButton\"\n      igoStopPropagation\n      mat-icon-button\n      (click)=\"onZoomHandler()\"\n    >\n      <mat-icon svgIcon=\"magnify\"></mat-icon>\n    </button>\n\n    <ng-content select=\"[igoSearchItemToolbar]\"> </ng-content>\n  </div>\n</mat-list-item>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport {\r\n  getEntityIcon,\r\n  getEntityTitle,\r\n  getEntityTitleHtml\r\n} from '@igo2/common';\r\n\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\n\r\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { SearchResult } from '../shared/search.interfaces';\r\n\r\n/**\r\n * Search results list item\r\n */\r\n@Component({\r\n  selector: 'igo-search-results-item',\r\n  templateUrl: './search-results-item.component.html',\r\n  styleUrls: ['./search-results-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsItemComponent {\r\n  /**\r\n   * Search result item\r\n   */\r\n  @Input() result: SearchResult;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Search result title\r\n   * @internal\r\n   */\r\n\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean;\r\n\r\n  /**\r\n   * Whether there should be a zoom button\r\n   */\r\n  @Input() withZoomButton = false;\r\n\r\n  @Output() zoomEvent = new EventEmitter<boolean>();\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get title(): string {\r\n    return getEntityTitle(this.result);\r\n  }\r\n\r\n  /**\r\n   * Search result HTML title\r\n   * @internal\r\n   */\r\n  get titleHtml(): string {\r\n    return getEntityTitleHtml(this.result);\r\n  }\r\n\r\n  /**\r\n   * Search result tooltip\r\n   * @internal\r\n   */\r\n  get tooltipHtml(): string {\r\n    return this.titleHtml\r\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\r\n      .replace(/<\\/?[^>]+(>|$)/g, '');\r\n  }\r\n\r\n  /**\r\n   * Search result icon\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.result);\r\n  }\r\n\r\n  onZoomHandler() {\r\n    const olFeature = this.format.readFeature(this.result.data, {\r\n      dataProjection: this.result.data.projection,\r\n      featureProjection: this.map.projection\r\n    });\r\n    moveToOlFeatures(\r\n      this.map.viewController,\r\n      [olFeature],\r\n      FeatureMotion.Default\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    const element = event.target;\r\n    const type = event.type;\r\n    switch (type) {\r\n      case 'mouseenter':\r\n        const hideBtn = element.querySelector('#hide-save-search-result-btn');\r\n        hideBtn\r\n          ? hideBtn.setAttribute('id', 'show-save-search-result-btn')\r\n          : null;\r\n        break;\r\n      case 'mouseleave':\r\n        const showBtn = element.querySelector('#show-save-search-result-btn');\r\n        showBtn\r\n          ? showBtn.setAttribute('id', 'hide-save-search-result-btn')\r\n          : null;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n}\r\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.layer.saveFeatureInLayer' | translate }}\n</h1>\n\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <igo-list [navigation]=\"false\" [selection]=\"false\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [result]=\"feature\"\n        showIcons=\"true\"\n      >\n      </igo-search-results-item>\n    </igo-list>\n\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          placeholder=\"{{ 'igo.geo.layer.chooseOrSet' | translate }}\"\n          matInput\n          [matAutocomplete]=\"auto\"\n          formControlName=\"layerName\"\n        />\n        <mat-autocomplete [displayWith]=\"displayFn\" #auto=\"matAutocomplete\">\n          <mat-option\n            *ngFor=\"let layer of filteredLayers$ | async\"\n            [value]=\"layer\"\n          >\n            <p matListItemTitle>{{ layer.title }}</p>\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n  </form>\n</div>\n\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group create-layer-button-top-padding\">\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n      {{ 'igo.geo.layer.cancelBtn' | translate }}\n    </button>\n    <button\n      id=\"createLayerBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"save()\"\n    >\n      {{ 'igo.geo.layer.saveBtn' | translate }}\n    </button>\n  </div>\n</div>\n","import { Component, Inject, OnInit, Optional } from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { map, startWith } from 'rxjs/operators';\r\n\r\nimport { Layer } from '../../layer/shared';\r\nimport { SearchResult } from '../shared';\r\n\r\n@Component({\r\n  selector: 'igo-save-feature-dialog',\r\n  templateUrl: './save-feature-dialog.component.html',\r\n  styleUrls: ['./save-feature-dialog.component.scss']\r\n})\r\nexport class SaveFeatureDialogComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n  feature: SearchResult;\r\n  layers: Layer[] = [];\r\n  filteredLayers$: Observable<Layer[]>;\r\n\r\n  constructor(\r\n    private formBuilder: UntypedFormBuilder,\r\n    public languageService: LanguageService,\r\n    public dialogRef: MatDialogRef<SaveFeatureDialogComponent>,\r\n    @Optional()\r\n    @Inject(MAT_DIALOG_DATA)\r\n    public data: { feature: SearchResult; layers: Layer[] }\r\n  ) {\r\n    this.form = this.formBuilder.group({\r\n      layerName: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.feature = this.data.feature;\r\n    this.layers = this.data.layers;\r\n    this.filteredLayers$ = this.form.controls['layerName'].valueChanges.pipe(\r\n      startWith(''),\r\n      map((val) => this.filter(val))\r\n    );\r\n  }\r\n\r\n  private filter(val): Layer[] {\r\n    if (typeof val !== 'string') {\r\n      return;\r\n    }\r\n    return this.layers\r\n      .map((l) => l)\r\n      .filter(\r\n        (layer) => layer?.title?.toLowerCase().includes(val.toLowerCase())\r\n      );\r\n  }\r\n\r\n  displayFn(layer: Layer): string {\r\n    return layer && layer.title ? layer.title : '';\r\n  }\r\n\r\n  save() {\r\n    const data: { layer: string | Layer; feature: SearchResult } = {\r\n      layer: this.form.value.layerName,\r\n      feature: this.feature\r\n    };\r\n    this.dialogRef.close(data);\r\n  }\r\n\r\n  cancel() {\r\n    this.dialogRef.close();\r\n  }\r\n}\r\n","<button\n  igoStopPropagation\n  (mouseenter)=\"onMouseEvent($event)\"\n  (mouseleave)=\"onMouseEvent($event)\"\n  *ngIf=\"layer.meta.dataType === 'Layer'\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"computeTooltip() | translate\"\n  [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n  (click)=\"onToggleClick($event)\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    matBadge=\"icon\"\n    [igoMatBadgeIcon]=\"getBadgeIcon()\"\n    igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n    igoMatBadgeBackgroundColor=\"none\"\n    igoMatBadgeInverseColor=\"true\"\n    [matBadgeHidden]=\"\n      ((inRange$ | async) && (isVisible$ | async) === true) ||\n      ((inRange$ | async) && !added) ||\n      ((inRange$ | async) && (isPreview$ | async))\n    \"\n    [matBadgeDisabled]=\"(inRange$ | async) === false\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\"\n  >\n  </mat-icon>\n</button>\n\n<button\n  [id]=\"!isMobile ? 'hide-save-search-result-btn' : ''\"\n  igoStopPropagation\n  *ngIf=\"layer.meta.dataType === 'Feature' && saveSearchResultInLayer\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"addFeatureToLayerTooltip$ | async | translate\"\n  (click)=\"addFeatureToLayer()\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    matBadge=\"icon\"\n    igoMatBadgeIcon=\"eye-off\"\n    igoMatBadgeInverseColor=\"true\"\n    [matBadgeHidden]=\"inRange$ | async\"\n    matBadgeDisabled=\"true\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    svgIcon=\"file-plus-outline\"\n  >\n  </mat-icon>\n</button>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { Media, MediaService } from '@igo2/core';\r\n\r\nimport OlOverlay from 'ol/Overlay';\r\nimport { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\r\nimport Circle from 'ol/style/Circle';\r\nimport Fill from 'ol/style/Fill';\r\nimport Stroke from 'ol/style/Stroke';\r\nimport Style from 'ol/style/Style';\r\n\r\nimport { BehaviorSubject, Subscription, take } from 'rxjs';\r\n\r\nimport { DataSourceService, FeatureDataSource } from '../../datasource';\r\nimport {\r\n  Feature,\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  tryAddLoadingStrategy,\r\n  tryAddSelectionStrategy,\r\n  tryBindStoreLayer\r\n} from '../../feature';\r\nimport { LAYER } from '../../layer/shared/layer.enums';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { getTooltipsOfOlGeometry } from '../../measure';\r\nimport { QueryableDataSourceOptions } from '../../query/shared';\r\nimport { SearchResult } from '../shared/search.interfaces';\r\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\r\n\r\n@Component({\r\n  selector: 'igo-search-add-button',\r\n  templateUrl: './search-results-add-button.component.html',\r\n  styleUrls: ['./search-results-add-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\r\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'igo.geo.catalog.layer.addToMap'\r\n  );\r\n\r\n  public addFeatureToLayerTooltip$: BehaviorSubject<string> =\r\n    new BehaviorSubject('igo.geo.search.addToLayer');\r\n\r\n  private resolution$$: Subscription;\r\n  private layers$$: Subscription;\r\n\r\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private layersSubcriptions = [];\r\n\r\n  private lastTimeoutRequest;\r\n\r\n  private mouseInsideAdd: boolean = false;\r\n\r\n  @Input() layer: SearchResult;\r\n\r\n  @Input() store: EntityStore<SearchResult>;\r\n\r\n  /**\r\n   * Whether the layer is already added to the map\r\n   */\r\n  @Input() added: boolean;\r\n\r\n  /**\r\n   * The map to add the search result layer to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * show hide save search result in layer button\r\n   */\r\n  @Input() saveSearchResultInLayer: boolean = false;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  @Input() stores: FeatureStore<Feature>[] = [];\r\n\r\n  get allLayers() {\r\n    return this.map.layers.filter((layer) =>\r\n      String(layer.id).includes('igo-search-layer')\r\n    );\r\n  }\r\n  private mediaService$$: Subscription;\r\n  public isMobile: boolean = false;\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private dialog: MatDialog,\r\n    private dataSourceService: DataSourceService,\r\n    private mediaService: MediaService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    // check the view if is mobile or not\r\n    this.mediaService$$ = this.mediaService.media$.subscribe((media: Media) => {\r\n      if (media === Media.Mobile) {\r\n        this.isMobile = true;\r\n      }\r\n    });\r\n    if (this.layer.meta.dataType === 'Layer') {\r\n      this.added =\r\n        this.map.layers.findIndex(\r\n          (lay) => lay.id === this.layer.data.sourceOptions.id\r\n        ) !== -1;\r\n    }\r\n    this.layers$$ = this.map.layers$.subscribe(() => {\r\n      this.isVisible();\r\n    });\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\r\n      (value) => {\r\n        this.isInResolutionsRange(value);\r\n        this.isVisible();\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n    this.layers$$.unsubscribe();\r\n    if (this.mediaService$$) {\r\n      this.mediaService$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    this.onToggleClick(event);\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(currEvent: Event) {\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n    const event = currEvent ? currEvent : ({} as Event);\r\n\r\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'click':\r\n        if (!this.isPreview$.value) {\r\n          if (this.added) {\r\n            this.remove();\r\n          } else {\r\n            this.add(event);\r\n          }\r\n        }\r\n        this.isPreview$.next(false);\r\n        break;\r\n      case 'mouseenter':\r\n        if (!this.isPreview$.value && !this.added) {\r\n          this.lastTimeoutRequest = setTimeout(() => {\r\n            this.add(event);\r\n            this.isPreview$.next(true);\r\n          }, 500);\r\n        }\r\n        this.mouseInsideAdd = true;\r\n        break;\r\n      case 'mouseleave':\r\n        if (this.isPreview$.value) {\r\n          this.remove();\r\n          this.isPreview$.next(false);\r\n        }\r\n        this.mouseInsideAdd = false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  private add(event: Event) {\r\n    if (!this.added) {\r\n      this.added = true;\r\n      this.addLayerToMap(event);\r\n    }\r\n  }\r\n\r\n  private remove() {\r\n    if (this.added) {\r\n      this.added = false;\r\n      this.removeLayerFromMap();\r\n      this.layersSubcriptions.map((s) => s.unsubscribe());\r\n      this.layersSubcriptions = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private addLayerToMap(event?: Event) {\r\n    if (this.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.layer.meta.dataType !== LAYER) {\r\n      return undefined;\r\n    }\r\n\r\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\r\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\r\n      layerOptions.sourceOptions.optionsFromApi = true;\r\n    }\r\n    this.layersSubcriptions.push(\r\n      this.layerService.createAsyncLayer(layerOptions).subscribe((layer) => {\r\n        if (event.type === 'click') {\r\n          this.map.layersAddedByClick$.next([layer]);\r\n        }\r\n        this.map.addLayer(layer);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = false\r\n   */\r\n  private removeLayerFromMap() {\r\n    if (this.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.layer.meta.dataType !== LAYER) {\r\n      return undefined;\r\n    }\r\n\r\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\r\n    this.map.removeLayer(oLayer);\r\n  }\r\n\r\n  isInResolutionsRange(resolution: number) {\r\n    const minResolution = this.layer.data.minResolution || 0;\r\n    const maxResolution = this.layer.data.maxResolution || Infinity;\r\n    this.inRange$.next(\r\n      resolution >= minResolution && resolution <= maxResolution\r\n    );\r\n  }\r\n\r\n  isVisible() {\r\n    if (this.layer?.data?.sourceOptions?.id) {\r\n      const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\r\n      oLayer\r\n        ? this.isVisible$.next(oLayer.visible)\r\n        : this.isVisible$.next(false);\r\n    }\r\n  }\r\n\r\n  getBadgeIcon() {\r\n    if (this.inRange$.value) {\r\n      return this.isVisible$.value ? '' : 'eye-off';\r\n    } else {\r\n      return 'eye-off';\r\n    }\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    if (this.added) {\r\n      if (this.isPreview$.value) {\r\n        return 'igo.geo.catalog.layer.addToMap';\r\n      } else if (this.inRange$.value) {\r\n        return this.isVisible$.value\r\n          ? 'igo.geo.catalog.layer.removeFromMap'\r\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\r\n      } else {\r\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\r\n      }\r\n    } else {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : 'igo.geo.catalog.layer.addToMapOutRange';\r\n    }\r\n  }\r\n\r\n  addFeatureToLayer() {\r\n    if (this.layer.meta.dataType !== 'Feature') {\r\n      return;\r\n    }\r\n\r\n    const selectedFeature = this.layer;\r\n    const dialogRef = this.dialog.open(SaveFeatureDialogComponent, {\r\n      width: '700px',\r\n      data: {\r\n        feature: selectedFeature,\r\n        layers: this.allLayers\r\n      }\r\n    });\r\n\r\n    dialogRef\r\n      .afterClosed()\r\n      .subscribe((data: { layer: string | any; feature: SearchResult }) => {\r\n        if (data) {\r\n          if (this.stores.length > 0) {\r\n            this.stores.map((store) => {\r\n              store.state.updateAll({ selected: false });\r\n              if (store?.layer) {\r\n                store.layer.visible = false;\r\n              }\r\n              return store;\r\n            });\r\n          }\r\n          // check if is new layer\r\n          if (typeof data.layer === 'string') {\r\n            this.createLayer(data.layer, data.feature);\r\n          } else {\r\n            const activeStore = this.stores.find(\r\n              (store) => store.layer.id === data.layer.id\r\n            );\r\n            activeStore.layer.visible = true;\r\n            activeStore.layer.opacity = 1;\r\n            this.addFeature(data.feature, activeStore);\r\n          }\r\n        }\r\n      });\r\n  }\r\n\r\n  createLayer(layerTitle: string, selectedFeature: SearchResult) {\r\n    const activeStore: FeatureStore<Feature> = new FeatureStore<Feature>([], {\r\n      map: this.map\r\n    });\r\n\r\n    const styles = [\r\n      new Style({\r\n        image: new Circle({\r\n          radius: 5,\r\n          stroke: new Stroke({\r\n            width: 1,\r\n            color: 'rgba(143,7,7,1)'\r\n          }),\r\n          fill: new Fill({\r\n            color: 'rgba(143,7,7,1)'\r\n          })\r\n        })\r\n      }),\r\n      new Style({\r\n        stroke: new Stroke({\r\n          width: 1,\r\n          color: 'rgba(143,7,7,1)'\r\n        }),\r\n        fill: new Fill({\r\n          color: 'rgba(0, 0, 255, 0.1)'\r\n        })\r\n      })\r\n    ];\r\n\r\n    // set layer id\r\n    let layerCounterID: number = 0;\r\n    for (const layer of this.allLayers) {\r\n      let numberId = Number(layer.id.replace('igo-search-layer', ''));\r\n      layerCounterID = Math.max(numberId, layerCounterID);\r\n    }\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'vector',\r\n        queryable: true\r\n      } as QueryableDataSourceOptions)\r\n      .pipe(take(1))\r\n      .subscribe((dataSource: FeatureDataSource) => {\r\n        let searchLayer: VectorLayer = new VectorLayer({\r\n          isIgoInternalLayer: true,\r\n          id: 'igo-search-layer' + ++layerCounterID,\r\n          title: layerTitle,\r\n          source: dataSource,\r\n          igoStyle: {\r\n            editable: false,\r\n            igoStyleObject: {\r\n              fill: { color: 'rgba(255,255,255,0.4)' },\r\n              stroke: { color: 'rgba(143,7,7,1)', width: 1 },\r\n              circle: {\r\n                fill: { color: 'rgba(255,255,255,0.4)' },\r\n                stroke: { color: 'rgba(143,7,7,1)', width: 1 },\r\n                radius: 5\r\n              }\r\n            }\r\n          },\r\n          style: styles,\r\n          showInLayerList: true,\r\n          exportable: true,\r\n          workspace: {\r\n            enabled: true\r\n          }\r\n        });\r\n\r\n        tryBindStoreLayer(activeStore, searchLayer);\r\n        tryAddLoadingStrategy(\r\n          activeStore,\r\n          new FeatureStoreLoadingStrategy({\r\n            motion: FeatureMotion.None\r\n          })\r\n        );\r\n\r\n        tryAddSelectionStrategy(\r\n          activeStore,\r\n          new FeatureStoreSelectionStrategy({\r\n            map: this.map,\r\n            motion: FeatureMotion.None,\r\n            many: true\r\n          })\r\n        );\r\n\r\n        activeStore.layer.visible = true;\r\n        activeStore.source.ol.on(\r\n          'removefeature',\r\n          (event: OlVectorSourceEvent<OlGeometry>) => {\r\n            const olGeometry = event.feature.getGeometry();\r\n            this.clearLabelsOfOlGeometry(olGeometry);\r\n          }\r\n        );\r\n\r\n        this.addFeature(selectedFeature, activeStore);\r\n        this.stores.push(activeStore);\r\n      });\r\n  }\r\n\r\n  addFeature(feature: SearchResult, activeStore: FeatureStore<Feature>) {\r\n    const newFeature = {\r\n      type: feature.data.type,\r\n      geometry: {\r\n        coordinates: feature.data.geometry.coordinates,\r\n        type: feature.data.geometry.type\r\n      },\r\n      projection: feature.data.projection,\r\n      properties: feature.data.properties,\r\n      meta: {\r\n        id: feature.meta.id\r\n      }\r\n    };\r\n    delete newFeature.properties.Route;\r\n    activeStore.update(newFeature);\r\n    activeStore.setLayerExtent();\r\n    activeStore.layer.ol.getSource().refresh();\r\n  }\r\n\r\n  private clearLabelsOfOlGeometry(olGeometry) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach(\r\n      (olTooltip: OlOverlay | undefined) => {\r\n        if (olTooltip && olTooltip.getMap()) {\r\n          this.map.ol.removeOverlay(olTooltip);\r\n        }\r\n      }\r\n    );\r\n  }\r\n}\r\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'igo-collapsible',\r\n  templateUrl: './collapsible.component.html',\r\n  styleUrls: ['./collapsible.component.scss']\r\n})\r\nexport class CollapsibleComponent {\r\n  @Input()\r\n  get title() {\r\n    return this._title;\r\n  }\r\n  set title(value: string) {\r\n    this._title = value;\r\n  }\r\n  private _title = '';\r\n\r\n  @Input()\r\n  get collapsed() {\r\n    return this._collapsed;\r\n  }\r\n  set collapsed(value: boolean) {\r\n    this._collapsed = value;\r\n    this.toggle.emit(value);\r\n  }\r\n  private _collapsed = false;\r\n\r\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\r\n}\r\n","<mat-list-item>\n  <mat-icon\n    svgIcon=\"chevron-up\"\n    class=\"igo-chevron\"\n    matListItemIcon\n    igoCollapse\n    [target]=\"content\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"collapsed = $event\"\n  >\n  </mat-icon>\n  <span matListItemTitle>{{ title }}</span>\n</mat-list-item>\n\n<div #content>\n  <ng-content></ng-content>\n</div>\n","<igo-list [navigation]=\"true\" *ngIf=\"tabsMode === false\">\n  <ng-template #groupTemplate ngFor let-group [ngForOf]=\"results$ | async\">\n    <igo-collapsible\n      [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\"\n    >\n      <ng-container\n        *ngTemplateOutlet=\"\n          storeItemTemplate;\n          context: { results: group.results }\n        \"\n      ></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container\n        *ngTemplateOutlet=\"\n          storeItemTemplate;\n          context: { results: group.results }\n        \"\n      ></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\"\n        >\n          <ng-container\n            igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{ result: result }\"\n          >\n          </ng-container>\n        </igo-search-results-item>\n      </ng-template>\n      <span\n        class=\"moreResults mat-typography\"\n        *ngIf=\"isMoreResults(group)\"\n        (click)=\"displayMoreResults(group)\"\n      >\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n  </ng-template>\n</igo-list>\n\n<igo-list [navigation]=\"true\" *ngIf=\"tabsMode\">\n  <ng-container\n    *ngIf=\"\n      mode === searchResultMode.Grouped;\n      then tabsTemplate;\n      else flatTemplate\n    \"\n  ></ng-container>\n\n  <ng-template #tabsTemplate>\n    <mat-tab-group class=\"custom-tabs-view\" dynamicHeight>\n      <mat-tab\n        *ngFor=\"let group of results$ | async\"\n        [label]=\"computeGroupTitle(group)\"\n      >\n        <ng-container\n          *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\n        ></ng-container>\n      </mat-tab>\n    </mat-tab-group>\n  </ng-template>\n\n  <ng-template #flatTemplate>\n    <ng-template ngFor let-group [ngForOf]=\"results$ | async\">\n      <ng-container\n        *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\n      ></ng-container>\n    </ng-template>\n  </ng-template>\n\n  <ng-template #storeItemTemplate let-group=\"group\">\n    <ng-template ngFor let-result [ngForOf]=\"group.results\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [map]=\"map\"\n        [result]=\"result\"\n        [showIcons]=\"showIcons\"\n        [withZoomButton]=\"withZoomButton\"\n        [focused]=\"store.state.get(result).focused\"\n        [selected]=\"store.state.get(result).selected\"\n        (focus)=\"resultFocus.emit(result)\"\n        (unfocus)=\"resultUnfocus.emit(result)\"\n        (select)=\"onResultSelect(result)\"\n        (mouseenter)=\"resultFocus.emit(result)\"\n        (mouseleave)=\"resultUnfocus.emit(result)\"\n      >\n        <ng-container\n          igoSearchItemToolbar\n          [ngTemplateOutlet]=\"templateSearchToolbar\"\n          [ngTemplateOutletContext]=\"{ result: result }\"\n        >\n        </ng-container>\n      </igo-search-results-item>\n    </ng-template>\n    <span\n      class=\"moreResults mat-typography\"\n      *ngIf=\"isMoreResults(group)\"\n      (click)=\"displayMoreResults(group)\"\n    >\n      <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n    </span>\n  </ng-template>\n</igo-list>\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ContentChild,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport type { TemplateRef } from '@angular/core';\r\n\r\nimport {\r\n  EntityState,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreWatcher,\r\n  EntityStoreWithStrategy\r\n} from '@igo2/common';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject, EMPTY, Observable, Subscription, timer } from 'rxjs';\r\nimport { debounce, map } from 'rxjs/operators';\r\n\r\nimport { IgoMap } from '../../map/shared';\r\nimport { Research, SearchResult } from '../shared/search.interfaces';\r\nimport { SearchService } from '../shared/search.service';\r\nimport { SearchSource } from '../shared/sources/source';\r\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\r\n\r\nexport enum SearchResultMode {\r\n  Grouped = 'grouped',\r\n  Flat = 'flat'\r\n}\r\n\r\n/**\r\n * List of search results with focus and selection capabilities.\r\n * This component is dumb and only emits events.\r\n */\r\n@Component({\r\n  selector: 'igo-search-results',\r\n  templateUrl: './search-results.component.html',\r\n  styleUrls: ['./search-results.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsComponent implements OnInit, OnDestroy {\r\n  private showResultsCount: boolean = true;\r\n\r\n  /**\r\n   * Reference to the SearchResultMode enum\r\n   * @internal\r\n   */\r\n  public searchResultMode = SearchResultMode;\r\n\r\n  /**\r\n   * Search results store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<SearchResult>;\r\n\r\n  private settingsChange$$: Subscription;\r\n\r\n  public pageIterator: { sourceId: string }[] = [];\r\n\r\n  public collapsed: { sourceId: string }[] = [];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Search results store\r\n   */\r\n  @Input() store: EntityStoreWithStrategy<SearchResult>;\r\n\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean;\r\n\r\n  /**\r\n   * Search results display mode\r\n   */\r\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\r\n\r\n  /**\r\n   * Whether there should be a zoom button\r\n   */\r\n  @Input() withZoomButton = false;\r\n\r\n  /**\r\n   * To check if the view for tabsMode for search-result-tools\r\n   */\r\n  @Input() tabsMode: boolean = false;\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  get term(): string {\r\n    return this._term;\r\n  }\r\n  set term(value: string) {\r\n    this._term = value;\r\n    this.pageIterator = [];\r\n  }\r\n  public _term: string;\r\n\r\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  @Input() termSplitter: string = '|';\r\n\r\n  /**\r\n   * Event emitted when a result is focused\r\n   */\r\n  @Output() resultFocus = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a result is unfocused\r\n   */\r\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a result is selected\r\n   */\r\n  @Output() resultSelect = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a research is completed after displaying more results is clicked\r\n   */\r\n  @Output() moreResults = new EventEmitter<{\r\n    research: Research;\r\n    results: SearchResult[];\r\n  }>();\r\n\r\n  /**\r\n   * Events emitted when a result is focus or unfocus by mouse event\r\n   */\r\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\r\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\r\n\r\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {})\r\n  templateSearchToolbar: TemplateRef<any>;\r\n\r\n  get results$(): Observable<\r\n    { source: SearchSource; results: SearchResult[] }[]\r\n  > {\r\n    if (this._results$ === undefined) {\r\n      this._results$ = this.liftResults();\r\n    }\r\n    return this._results$;\r\n  }\r\n  private _results$: Observable<\r\n    { source: SearchSource; results: SearchResult[] }[]\r\n  >;\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private searchService: SearchService,\r\n    private configService: ConfigService\r\n  ) {}\r\n\r\n  /**\r\n   * Bind the search results store to the watcher\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n\r\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\r\n      this.pageIterator = [];\r\n    });\r\n\r\n    if (\r\n      this.configService.getConfig('searchSources.showResultsCount') === false\r\n    ) {\r\n      this.showResultsCount = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind the search results store from the watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n    this.settingsChange$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Compute a group title\r\n   * @param group Search results group\r\n   * @returns Group title\r\n   * @internal\r\n   */\r\n  computeGroupTitle(group: {\r\n    source: SearchSource;\r\n    results: SearchResult[];\r\n  }): string {\r\n    const parts = [group.source.title];\r\n    const count = group.results.length;\r\n    if (count > 1 && this.showResultsCount) {\r\n      parts.push(`(${count})`);\r\n    }\r\n    return parts.join(' ');\r\n  }\r\n\r\n  /**\r\n   * When a result is selected, update it's state in the store and emit\r\n   * an event. A selected result is also considered focused\r\n   * @param result Search result\r\n   * @internal\r\n   */\r\n  onResultSelect(result: SearchResult) {\r\n    if (this.store.state.get(result)) {\r\n      if (this.store.state.get(result).selected === true) {\r\n        return;\r\n      }\r\n    }\r\n    this.store.state.update(result, { focused: true, selected: true }, true);\r\n    this.resultSelect.emit(result);\r\n  }\r\n\r\n  /**\r\n   * Return an observable of the search results, grouped by search source\r\n   * @returns Observable of grouped search results\r\n   * @internal\r\n   */\r\n  private liftResults(): Observable<\r\n    { source: SearchSource; results: SearchResult[] }[]\r\n  > {\r\n    return this.store.stateView.all$().pipe(\r\n      debounce((results: { entity: SearchResult; state: EntityState }[]) => {\r\n        return results.length === 0 ? EMPTY : timer(200);\r\n      }),\r\n      map((results: { entity: SearchResult; state: EntityState }[]) => {\r\n        return this.groupResults(\r\n          results.map((r) => r.entity).sort(this.sortByOrder)\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Sort the results by display order.\r\n   * @param r1 First result\r\n   * @param r2 Second result\r\n   */\r\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\r\n    return r1.source.displayOrder - r2.source.displayOrder;\r\n  }\r\n\r\n  /**\r\n   * Group results by search source\r\n   * @param results Search results from all sources\r\n   * @returns Search results grouped by source\r\n   */\r\n  private groupResults(\r\n    results: SearchResult[]\r\n  ): { source: SearchSource; results: SearchResult[] }[] {\r\n    const grouped = new Map<SearchSource, SearchResult[]>();\r\n    results.forEach((result: SearchResult) => {\r\n      const source = result.source;\r\n      let sourceResults = grouped.get(source);\r\n      if (sourceResults === undefined) {\r\n        sourceResults = [];\r\n        grouped.set(source, sourceResults);\r\n      }\r\n      sourceResults.push(result);\r\n    });\r\n\r\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\r\n      if (this.pageIterator[source.getId()] === undefined) {\r\n        this.pageIterator[source.getId()] = 1;\r\n      }\r\n      return { source, results: grouped.get(source) };\r\n    });\r\n  }\r\n\r\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\r\n    const stategy = this.store.getStrategyOfType(\r\n      EntityStoreFilterCustomFuncStrategy\r\n    );\r\n    const active = stategy?.active || false;\r\n    if (!active) {\r\n      return (\r\n        group.results &&\r\n        group.results[group.results.length - 1].meta.nextPage === true\r\n      );\r\n    } else {\r\n      return (\r\n        group.results?.length % +group.source.params.limit === 0 &&\r\n        +group.source.params.page < 30\r\n      );\r\n    }\r\n  }\r\n\r\n  displayMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\r\n    const options: TextSearchOptions = {\r\n      sourceId: group.source.getId(),\r\n      page: ++this.pageIterator[group.source.getId()]\r\n    };\r\n\r\n    let terms;\r\n    if (\r\n      this.termSplitter &&\r\n      this.term.match(new RegExp(this.termSplitter, 'g'))\r\n    ) {\r\n      terms = this.term.split(this.termSplitter);\r\n    } else {\r\n      terms = [this.term];\r\n    }\r\n\r\n    let researches: Research[] = [];\r\n    terms.map((term: string) => {\r\n      researches = researches.concat(this.searchService.search(term, options));\r\n    });\r\n\r\n    researches.map((research) => {\r\n      research.request.subscribe((results: SearchResult[]) => {\r\n        const newResults = group.results.concat(results);\r\n        if (!results.length) {\r\n          newResults[newResults.length - 1].meta.nextPage = false;\r\n        }\r\n        this.moreResults.emit({ research, results: newResults });\r\n      });\r\n    });\r\n    return;\r\n  }\r\n}\r\n","import { Workspace, WorkspaceOptions } from '@igo2/common';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\r\n  layer: VectorLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class WfsWorkspace extends Workspace {\r\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    true\r\n  );\r\n\r\n  get layer(): VectorLayer {\r\n    return this.options.layer;\r\n  }\r\n\r\n  get map(): IgoMap {\r\n    return this.options.map;\r\n  }\r\n\r\n  constructor(protected options: WfsWorkspaceOptions) {\r\n    super(options);\r\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\r\n      if (\r\n        mapResolution > this.layer.minResolution &&\r\n        mapResolution < this.layer.maxResolution\r\n      ) {\r\n        this.inResolutionRange$.next(true);\r\n      } else {\r\n        this.inResolutionRange$.next(false);\r\n      }\r\n    });\r\n  }\r\n\r\n  public getLayerWksOptionTabQuery(): boolean {\r\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\r\n      return this.layer.options.workspace.queryOptions.tabQuery;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getLayerWksOptionMapQuery(): boolean {\r\n    if (\r\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\r\n    ) {\r\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private getInResolutionRange(): boolean {\r\n    return this.inResolutionRange$.value;\r\n  }\r\n}\r\n","import olFeature from 'ol/Feature';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport * as olStyle from 'ol/style';\r\n\r\nimport { Feature } from '../../../feature/shared/feature.interfaces';\r\nimport { createOverlayMarkerStyle } from '../overlay/overlay-marker-style.utils';\r\nimport { createOverlayDefaultStyle } from '../overlay/overlay-style.utils';\r\nimport { FeatureCommonVectorStyleOptions } from './vector-style.interface';\r\n\r\n/**\r\n * Generate a style for selected features\r\n * @param feature The feature to generate the style\r\n * @returns A olStyle\r\n */\r\nexport function getCommonVectorSelectedStyle({\r\n  feature,\r\n  markerColor = [0, 161, 222],\r\n  markerOpacity = 1,\r\n  markerOutlineColor = [0, 255, 255],\r\n  fillColor,\r\n  fillOpacity = 0.15,\r\n  strokeColor = [0, 255, 255],\r\n  strokeOpacity = 0.5,\r\n  strokeWidth = 4\r\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\r\n  return getCommonVectorStyle({\r\n    feature,\r\n    markerColor,\r\n    markerOpacity,\r\n    markerOutlineColor,\r\n    fillColor,\r\n    fillOpacity,\r\n    strokeColor,\r\n    strokeOpacity,\r\n    strokeWidth\r\n  });\r\n}\r\n\r\n/**\r\n * Generate a basic style for features\r\n * @param feature The feature to generate the style\r\n * @returns A olStyle\r\n */\r\nexport function getCommonVectorStyle({\r\n  feature,\r\n  markerColor = [0, 161, 222],\r\n  markerOpacity = 0.5,\r\n  markerOutlineColor,\r\n  fillColor = [0, 161, 222],\r\n  fillOpacity = 0.15,\r\n  strokeColor = [0, 161, 222],\r\n  strokeOpacity = 0.5,\r\n  strokeWidth = 2\r\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\r\n  const isOlFeature = feature instanceof olFeature;\r\n  let geometry;\r\n  let text;\r\n  if (isOlFeature) {\r\n    feature = feature as olFeature<OlGeometry>;\r\n    geometry = feature.getGeometry();\r\n  } else {\r\n    feature = feature as Feature;\r\n    geometry = feature.geometry;\r\n    text = feature.meta.mapTitle;\r\n  }\r\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\r\n\r\n  if (!geometry || geometryType === 'Point') {\r\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\r\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\r\n\r\n    if (\r\n      markerColorAsArray.length === 4 &&\r\n      (typeof markerColor !== 'string' ||\r\n        /^#[0-9A-F]{8}$/i.test(markerColor as string))\r\n    ) {\r\n      markerOpacity = markerColorAsArray[3];\r\n    }\r\n\r\n    return createOverlayMarkerStyle({\r\n      text,\r\n      opacity: markerOpacity,\r\n      markerOutlineColor,\r\n      markerColor: markerColorRGB\r\n    });\r\n  } else {\r\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\r\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\r\n\r\n    if (\r\n      !(\r\n        fillWithOpacity.length === 4 &&\r\n        (typeof fillColor !== 'string' ||\r\n          /^#[0-9A-F]{8}$/i.test(fillColor as string))\r\n      )\r\n    ) {\r\n      fillWithOpacity[3] = fillOpacity;\r\n    }\r\n\r\n    if (\r\n      !(\r\n        strokeWithOpacity.length === 4 &&\r\n        (typeof strokeColor !== 'string' ||\r\n          /^#[0-9A-F]{8}$/i.test(strokeColor as string))\r\n      )\r\n    ) {\r\n      strokeWithOpacity[3] = strokeOpacity;\r\n    }\r\n\r\n    return createOverlayDefaultStyle({\r\n      text,\r\n      strokeWidth,\r\n      strokeColor: strokeWithOpacity,\r\n      fillColor: fillWithOpacity\r\n    });\r\n  }\r\n}\r\n","import {\r\n  EntityRecord,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreStrategyFuncOptions,\r\n  EntityTableButton,\r\n  EntityTableColumnRenderer,\r\n  EntityTableTemplate,\r\n  Workspace\r\n} from '@igo2/common';\r\nimport { EntityTableColumn } from '@igo2/common';\r\nimport { StorageScope } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { map, skipWhile, take } from 'rxjs/operators';\r\n\r\nimport {\r\n  RelationOptions,\r\n  SourceFieldsOptionsParams\r\n} from '../../datasource/shared/datasources/datasource.interface';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { LayerService, VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { generateIdFromSourceOptions } from '../../utils/id-generator';\r\nimport { FeatureWorkspace } from './feature-workspace';\r\nimport { WfsWorkspace } from './wfs-workspace';\r\n\r\nexport function getRowsInMapExtent(layerId, storageService): boolean {\r\n  return (\r\n    (storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean) ||\r\n    true\r\n  );\r\n}\r\n\r\nexport function setRowsInMapExtent(value, layerId, storageService) {\r\n  storageService.set(\r\n    `workspace.rowsInMapExtent.${layerId}`,\r\n    value,\r\n    StorageScope.SESSION\r\n  );\r\n}\r\n\r\nexport function getSelectedOnly(layerId, storageService): boolean {\r\n  return (\r\n    (storageService.get(`workspace.selectedOnly.${layerId}`) as boolean) ||\r\n    false\r\n  );\r\n}\r\n\r\nexport function setSelectedOnly(value, layerId, storageService) {\r\n  storageService.set(\r\n    `workspace.selectedOnly.${layerId}`,\r\n    value,\r\n    StorageScope.SESSION\r\n  );\r\n}\r\n\r\nexport function mapExtentStrategyActiveToolTip(\r\n  ws: Workspace\r\n): Observable<string> {\r\n  return ws.entityStore\r\n    .getStrategyOfType(EntityStoreFilterCustomFuncStrategy)\r\n    .active$.pipe(\r\n      map((active: boolean) =>\r\n        active\r\n          ? 'igo.geo.workspace.inMapExtent.active.tooltip'\r\n          : 'igo.geo.workspace.inMapExtent.inactive.tooltip'\r\n      )\r\n    );\r\n}\r\n\r\nexport function noElementSelected(ws: Workspace): Observable<boolean> {\r\n  return ws.entityStore.stateView\r\n    .manyBy$((record: EntityRecord<Feature>) => {\r\n      return record.state.selected === true;\r\n    })\r\n    .pipe(map((entities: EntityRecord<Feature>[]) => entities.length >= 1));\r\n}\r\n\r\nexport function addOrRemoveLayer(\r\n  action: 'add' | 'remove',\r\n  map: IgoMap,\r\n  url: string,\r\n  type: string,\r\n  layerName: string,\r\n  layerService: LayerService\r\n) {\r\n  const so = ObjectUtils.removeUndefined({\r\n    sourceOptions: {\r\n      type: type,\r\n      url,\r\n      optionsFromCapabilities: true,\r\n      optionsFromApi: true,\r\n      params: {\r\n        LAYERS: type === 'wms' ? layerName : undefined,\r\n        LAYER: type === 'wms' ? undefined : layerName\r\n      }\r\n    }\r\n  });\r\n  if (action === 'add') {\r\n    layerService.createAsyncLayer(so).subscribe((layer) => {\r\n      map.layersAddedByClick$.next([layer]);\r\n      map.addLayer(layer);\r\n    });\r\n  } else if (action === 'remove') {\r\n    const addedLayerId = generateIdFromSourceOptions(so.sourceOptions);\r\n    map.removeLayer(map.layers.find((l) => l.id === addedLayerId));\r\n  }\r\n}\r\n\r\nexport function getGeoServiceAction(\r\n  workspace: FeatureWorkspace | WfsWorkspace,\r\n  layerService: LayerService\r\n) {\r\n  const geoServiceAction = [\r\n    {\r\n      name: 'geoServiceAction',\r\n      title: undefined,\r\n      tooltip: '',\r\n      renderer: EntityTableColumnRenderer.ButtonGroup,\r\n      valueAccessor: (entity: Feature, record: EntityRecord<Feature>) => {\r\n        let geoServiceProperties = record.state.geoService;\r\n        if (\r\n          geoServiceProperties &&\r\n          geoServiceProperties.haveGeoServiceProperties &&\r\n          geoServiceProperties.url &&\r\n          geoServiceProperties.layerName\r\n        ) {\r\n          if (geoServiceProperties.added) {\r\n            return [\r\n              {\r\n                icon: 'delete',\r\n                color: 'warn',\r\n                click: (row, record) => {\r\n                  addOrRemoveLayer(\r\n                    'remove',\r\n                    workspace.map,\r\n                    record.state.geoService.url,\r\n                    record.state.geoService.type,\r\n                    record.state.geoService.layerName,\r\n                    layerService\r\n                  );\r\n                  geoServiceProperties.added = false;\r\n                }\r\n              }\r\n            ] as EntityTableButton[];\r\n          } else {\r\n            return [\r\n              {\r\n                icon: 'plus',\r\n                color: 'primary',\r\n                click: (row, record) => {\r\n                  addOrRemoveLayer(\r\n                    'add',\r\n                    workspace.map,\r\n                    record.state.geoService.url,\r\n                    record.state.geoService.type,\r\n                    record.state.geoService.layerName,\r\n                    layerService\r\n                  );\r\n                  geoServiceProperties.added = true;\r\n                }\r\n              }\r\n            ] as EntityTableButton[];\r\n          }\r\n        } else {\r\n          return [];\r\n        }\r\n      }\r\n    }\r\n  ];\r\n  return geoServiceAction;\r\n}\r\n\r\nexport function createTableTemplate(\r\n  workspace: FeatureWorkspace | WfsWorkspace,\r\n  layer: VectorLayer,\r\n  layerService: LayerService,\r\n  ws$\r\n) {\r\n  const geoServiceAction = getGeoServiceAction(workspace, layerService);\r\n  const fields = layer.dataSource.options.sourceFields || [];\r\n\r\n  const relations = layer.dataSource.options.relations || [];\r\n\r\n  if (fields.length === 0) {\r\n    workspace.entityStore.entities$\r\n      .pipe(\r\n        skipWhile((val) => val.length === 0),\r\n        take(1)\r\n      )\r\n      .subscribe((entities) => {\r\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\r\n        const columnsFromFeatures = ol\r\n          .getKeys()\r\n          .filter(\r\n            (col) =>\r\n              !col.startsWith('_') &&\r\n              col !== 'geometry' &&\r\n              col !== ol.getGeometryName() &&\r\n              !col.match(/boundedby/gi)\r\n          )\r\n          .map((key) => {\r\n            return {\r\n              name: `properties.${key}`,\r\n              title: key,\r\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\r\n            };\r\n          });\r\n        columnsFromFeatures.unshift(...geoServiceAction);\r\n        workspace.meta.tableTemplate = {\r\n          selection: true,\r\n          sort: true,\r\n          columns: columnsFromFeatures,\r\n          tableHeight: '100%'\r\n        } as EntityTableTemplate;\r\n      });\r\n    return;\r\n  }\r\n  const columns = fields.map((field: SourceFieldsOptionsParams) => {\r\n    return {\r\n      name: `properties.${field.name}`,\r\n      title: field.alias ? field.alias : field.name,\r\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML,\r\n      tooltip: field.tooltip,\r\n      cellClassFunc: () => {\r\n        const cellClass = {};\r\n        if (field.type) {\r\n          cellClass[`class_${field.type}`] = true;\r\n          return cellClass;\r\n        }\r\n      }\r\n    } as EntityTableColumn;\r\n  });\r\n\r\n  const relationsColumn = relations.map((relation: RelationOptions) => {\r\n    return {\r\n      name: `properties.${relation.name}`,\r\n      title: relation.alias ? relation.alias : relation.name,\r\n      renderer: EntityTableColumnRenderer.Icon,\r\n      icon: relation.icon,\r\n      parent: relation.parent,\r\n      type: 'relation',\r\n      tooltip: relation.tooltip,\r\n      onClick: () => {\r\n        ws$.next(relation.title);\r\n      },\r\n      cellClassFunc: () => {\r\n        return { class_icon: true };\r\n      }\r\n    };\r\n  });\r\n\r\n  columns.push(...relationsColumn);\r\n  columns.unshift(...geoServiceAction);\r\n  workspace.meta.tableTemplate = {\r\n    selection: true,\r\n    sort: true,\r\n    columns,\r\n    tableHeight: '100%'\r\n  };\r\n}\r\n\r\nexport function createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\r\n  const filterClauseFunc = (record: EntityRecord<object>) => {\r\n    return (\r\n      record.state.inMapExtent === true && record.state.inMapResolution === true\r\n    );\r\n  };\r\n  return new EntityStoreFilterCustomFuncStrategy({\r\n    filterClauseFunc\r\n  } as EntityStoreStrategyFuncOptions);\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ActionStore, EntityStoreFilterSelectionStrategy } from '@igo2/common';\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { CapabilitiesService, FeatureDataSource } from '../../datasource';\r\nimport {\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreInMapExtentStrategy,\r\n  FeatureStoreInMapResolutionStrategy,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  GeoPropertiesStrategy\r\n} from '../../feature';\r\nimport { LayerService, VectorLayer } from '../../layer/shared';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\r\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector';\r\nimport { WfsWorkspace } from './wfs-workspace';\r\nimport {\r\n  createFilterInMapExtentOrResolutionStrategy,\r\n  createTableTemplate\r\n} from './workspace.utils';\r\nimport { FeatureCommonVectorStyleOptions, OverlayStyleOptions } from '../../style';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WfsWorkspaceService {\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  public ws$ = new BehaviorSubject<string>(undefined);\r\n\r\n  constructor(\r\n    private storageService: StorageService,\r\n    private configService: ConfigService,\r\n    private layerService: LayerService,\r\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {}\r\n\r\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\r\n    if (\r\n      layer.options.workspace?.enabled === false ||\r\n      layer.dataSource.options.edition\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\r\n      srcId: layer.id,\r\n      workspaceId: layer.id,\r\n      enabled: true\r\n    } as GeoWorkspaceOptions);\r\n\r\n    const wks = new WfsWorkspace({\r\n      id: layer.id,\r\n      title: layer.title,\r\n      layer,\r\n      map,\r\n      entityStore: this.createFeatureStore(layer, map),\r\n      actionStore: new ActionStore([]),\r\n      meta: {\r\n        tableTemplate: undefined\r\n      }\r\n    });\r\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\r\n    return wks;\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], { map });\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\r\n      { map },\r\n      this.propertyTypeDetectorService,\r\n      this.capabilitiesService\r\n    );\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const confQueryOverlayStyle: OverlayStyleOptions =\r\n      this.configService.getConfig('queryOverlayStyle');\r\n\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: (feature) => {\r\n          return getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature },\r\n              confQueryOverlayStyle?.selection || {}\r\n            ) as FeatureCommonVectorStyleOptions\r\n          );\r\n        },\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(geoPropertiesStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n}\r\n","import { Workspace, WorkspaceOptions } from '@igo2/common';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\n\r\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\r\n  layer: VectorLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class FeatureWorkspace extends Workspace {\r\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    true\r\n  );\r\n\r\n  get layer(): VectorLayer {\r\n    return this.options.layer;\r\n  }\r\n\r\n  get map(): IgoMap {\r\n    return this.options.map;\r\n  }\r\n\r\n  constructor(protected options: FeatureWorkspaceOptions) {\r\n    super(options);\r\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\r\n      if (\r\n        mapResolution > this.layer.minResolution &&\r\n        mapResolution < this.layer.maxResolution\r\n      ) {\r\n        this.inResolutionRange$.next(true);\r\n      } else {\r\n        this.inResolutionRange$.next(false);\r\n      }\r\n    });\r\n  }\r\n\r\n  public getLayerWksOptionTabQuery(): boolean {\r\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\r\n      return this.layer.options.workspace.queryOptions.tabQuery;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getLayerWksOptionMapQuery(): boolean {\r\n    if (\r\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\r\n    ) {\r\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private getInResolutionRange(): boolean {\r\n    return this.inResolutionRange$.value;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ActionStore, EntityStoreFilterSelectionStrategy } from '@igo2/common';\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { CapabilitiesService, FeatureDataSource } from '../../datasource';\r\nimport {\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreInMapExtentStrategy,\r\n  FeatureStoreInMapResolutionStrategy,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSearchIndexStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  GeoPropertiesStrategy\r\n} from '../../feature';\r\nimport { LayerService, VectorLayer } from '../../layer/shared';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\r\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\r\nimport { FeatureWorkspace } from './feature-workspace';\r\nimport {\r\n  createFilterInMapExtentOrResolutionStrategy,\r\n  createTableTemplate\r\n} from './workspace.utils';\r\nimport { FeatureCommonVectorStyleOptions, OverlayStyleOptions } from '../../style';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FeatureWorkspaceService {\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  public ws$ = new BehaviorSubject<string>(undefined);\r\n\r\n  constructor(\r\n    private storageService: StorageService,\r\n    private configService: ConfigService,\r\n    private layerService: LayerService,\r\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {}\r\n\r\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\r\n    if (\r\n      layer.options.workspace?.enabled === false ||\r\n      layer.dataSource.options.edition\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\r\n      srcId: layer.id,\r\n      workspaceId: layer.id,\r\n      enabled: true\r\n    } as GeoWorkspaceOptions);\r\n\r\n    const wks = new FeatureWorkspace({\r\n      id: layer.id,\r\n      title: layer.title,\r\n      layer,\r\n      map,\r\n      entityStore: this.createFeatureStore(layer, map),\r\n      actionStore: new ActionStore([]),\r\n      meta: {\r\n        tableTemplate: undefined\r\n      }\r\n    });\r\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\r\n    return wks;\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], { map });\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const searchStrategy = new FeatureStoreSearchIndexStrategy({\r\n      percentDistinctValueRatio: 2,\r\n      sourceFields: layer.dataSource.options.sourceFields\r\n    });\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\r\n      { map },\r\n      this.propertyTypeDetectorService,\r\n      this.capabilitiesService\r\n    );\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const confQueryOverlayStyle: OverlayStyleOptions =\r\n      this.configService.getConfig('queryOverlayStyle');\r\n\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: (feature) => {\r\n          return getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature },\r\n              confQueryOverlayStyle?.selection || {}\r\n            ) as FeatureCommonVectorStyleOptions\r\n          );\r\n        },\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    if (layer.options.workspace?.searchIndexEnabled) {\r\n      store.addStrategy(searchStrategy, true);\r\n    }\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(geoPropertiesStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n}\r\n","import { Component, Inject } from '@angular/core';\r\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nexport interface DialogData {\r\n  type: string;\r\n  cancel: boolean;\r\n}\r\n\r\n@Component({\r\n  selector: 'igo-confirmation-popup-component',\r\n  templateUrl: './confirmation-popup.component.html',\r\n  styleUrls: ['./confirmation-popup.component.scss']\r\n})\r\nexport class ConfirmationPopupComponent {\r\n  constructor(\r\n    public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\r\n    public languageService: LanguageService,\r\n    @Inject(MAT_DIALOG_DATA) public data: { type: string; cancel: boolean }\r\n  ) {}\r\n\r\n  cancelAction() {\r\n    this.data.cancel = true;\r\n    this.dialogRef.close(this.data.cancel);\r\n  }\r\n\r\n  confirmedAction() {\r\n    this.data.cancel = false;\r\n    this.dialogRef.close(this.data.cancel);\r\n  }\r\n}\r\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{\n      data.type === 'add'\n        ? languageService.translate.instant('igo.geo.workspace.addConfirmation')\n        : languageService.translate.instant(\n            'igo.geo.workspace.deleteConfirmation'\n          )\n    }}\n  </p>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button color=\"primary\" (click)=\"confirmedAction()\">\n    Ok\n  </button>\n  <button mat-raised-button (click)=\"cancelAction()\">\n    {{ languageService.translate.instant('igo.geo.workspace.cancel') }}\n  </button>\n</div>\n","import { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { EntityRecord, Workspace, WorkspaceOptions } from '@igo2/common';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport Collection from 'ol/Collection';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport type { Type } from 'ol/geom/Geometry';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport OlModify from 'ol/interaction/Modify';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport * as OlStyle from 'ol/style';\r\n\r\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\r\n\r\nimport { FeatureDataSource, RelationOptions } from '../../datasource/shared';\r\nimport { GeometryType, createInteractionStyle } from '../../draw';\r\nimport { featureToOl } from '../../feature';\r\nimport { DrawControl } from '../../geometry';\r\nimport { ImageLayer, VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\r\n\r\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\r\n  layer: ImageLayer | VectorLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class EditionWorkspace extends Workspace {\r\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    true\r\n  );\r\n\r\n  get layer(): ImageLayer | VectorLayer {\r\n    return this.options.layer;\r\n  }\r\n\r\n  get map(): IgoMap {\r\n    return this.options.map;\r\n  }\r\n\r\n  private drawControl: DrawControl;\r\n  private drawEnd$$: Subscription;\r\n  private olDrawingLayerSource = new OlVectorSource();\r\n  private olDrawingLayer: VectorLayer;\r\n  public geometryType = GeometryType; // Reference to the GeometryType enum\r\n  public modify; // Reference to the ol interaction\r\n\r\n  public modifyStyle = new OlStyle.Style({\r\n    stroke: new OlStyle.Stroke({\r\n      color: 'rgba(255,255,255,1)',\r\n      width: 1\r\n    }),\r\n    fill: new OlStyle.Fill({\r\n      color: 'rgba(0,161,222,1)'\r\n    }),\r\n    image: new OlStyle.Circle({\r\n      radius: 7,\r\n      stroke: new OlStyle.Stroke({\r\n        color: 'rgba(255,255,255,1)',\r\n        width: 1\r\n      }),\r\n      fill: new OlStyle.Fill({\r\n        color: 'rgba(0,161,222,1)'\r\n      })\r\n    })\r\n  });\r\n\r\n  private newFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\r\n    return record.state.newFeature === true;\r\n  };\r\n\r\n  private editFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\r\n    return record.state.edit === true;\r\n  };\r\n\r\n  public fillColor: string;\r\n  public strokeColor: string;\r\n  public strokeWidth: number;\r\n\r\n  constructor(\r\n    private dialog: MatDialog,\r\n    private configService: ConfigService,\r\n    private adding$: BehaviorSubject<boolean>,\r\n    private getDomainValues: (relation: RelationOptions) => Observable<any>,\r\n    protected options: EditionWorkspaceOptions\r\n  ) {\r\n    super(options);\r\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\r\n      if (\r\n        mapResolution > this.layer.minResolution &&\r\n        mapResolution < this.layer.maxResolution\r\n      ) {\r\n        this.inResolutionRange$.next(true);\r\n      } else {\r\n        this.inResolutionRange$.next(false);\r\n      }\r\n    });\r\n\r\n    this.drawControl = this.createDrawControl();\r\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\r\n\r\n    this.map.removeLayer(this.olDrawingLayer);\r\n\r\n    this.olDrawingLayer = new VectorLayer({\r\n      id: 'igo-draw-layer',\r\n      title: 'edition',\r\n      zIndex: 300,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      workspace: {\r\n        enabled: false\r\n      }\r\n    });\r\n  }\r\n\r\n  deleteFeature(feature, workspace) {\r\n    setTimeout(() => {\r\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\r\n        disableClose: false,\r\n        data: { type: 'delete' }\r\n      });\r\n\r\n      dialogRef.afterClosed().subscribe((result) => {\r\n        if (result === false) {\r\n          let id, url;\r\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\r\n          const deleteUrl =\r\n            workspace.layer.dataSource.options.edition.deleteUrl;\r\n          if (baseUrl.length) {\r\n            url = this.configService.getConfig('edition.url')\r\n              ? this.configService.getConfig('edition.url') +\r\n                baseUrl +\r\n                '?' +\r\n                deleteUrl\r\n              : baseUrl + '?' + deleteUrl;\r\n          } else {\r\n            url = this.configService.getConfig('edition.url')\r\n              ? this.configService.getConfig('edition.url') + deleteUrl\r\n              : deleteUrl;\r\n          }\r\n\r\n          for (const column of workspace.meta.tableTemplate.columns) {\r\n            for (const property in feature.properties) {\r\n              let columnName = column.name;\r\n              if (columnName.includes('properties.')) {\r\n                columnName = columnName.split('.')[1];\r\n              }\r\n              if (columnName === property && column.primary === true) {\r\n                id = feature.properties[property];\r\n              }\r\n            }\r\n          }\r\n          if (url) {\r\n            url += id;\r\n            this.deleteFeature(workspace, url);\r\n          }\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  editFeature(feature, workspace: EditionWorkspace) {\r\n    feature.edition = true;\r\n    let id;\r\n    let find = false;\r\n    const editionOpt = workspace.layer.dataSource.options.edition;\r\n    for (const column of workspace.meta.tableTemplate.columns) {\r\n      // Update domain list\r\n      if (column.type === 'list' || column.type === 'autocomplete') {\r\n        this.getDomainValues(column.relation).subscribe((result) => {\r\n          column.domainValues = result;\r\n        });\r\n      }\r\n      if (find === false) {\r\n        for (const property in feature.properties) {\r\n          let columnName = column.name;\r\n          if (columnName.includes('properties.')) {\r\n            columnName = columnName.split('.')[1];\r\n          }\r\n          if (columnName === property && column.primary === true) {\r\n            id = feature.properties[property];\r\n            find = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (id) {\r\n      feature.original_properties = JSON.parse(\r\n        JSON.stringify(feature.properties)\r\n      );\r\n      feature.original_geometry = feature.geometry;\r\n      feature.idkey = id;\r\n      workspace.entityStore.state.updateAll({ edit: false });\r\n      workspace.entityStore.stateView.filter(this.editFeaturefilterClauseFunc);\r\n      this.addFeatureToStore(feature, workspace);\r\n    } else {\r\n      // Only for edition with it's own geometry\r\n      if (!feature.newFeature && editionOpt.geomType) {\r\n        feature.newFeature = true;\r\n        this.adding$.next(true);\r\n        workspace.entityStore.state.updateAll({ newFeature: false });\r\n        workspace.entityStore.stateView.filter(this.newFeaturefilterClauseFunc);\r\n        if (editionOpt.addWithDraw) {\r\n          const geometryType = editionOpt.geomType;\r\n          this.onGeometryTypeChange(geometryType, feature, workspace);\r\n        } else {\r\n          workspace.entityStore.insert(feature);\r\n          workspace.entityStore.state.update(\r\n            feature,\r\n            { newFeature: true },\r\n            true\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a Draw Control\r\n   * @param fillColor the fill color\r\n   * @param strokeColor the stroke color\r\n   * @param strokeWidth the stroke width\r\n   * @returns a Draw Control\r\n   */\r\n  createDrawControl(\r\n    fillColor?: string,\r\n    strokeColor?: string,\r\n    strokeWidth?: number\r\n  ) {\r\n    const drawControl = new DrawControl({\r\n      geometryType: undefined,\r\n      drawingLayerSource: this.olDrawingLayerSource,\r\n      drawingLayerStyle: new OlStyle.Style({}),\r\n      interactionStyle: createInteractionStyle(\r\n        fillColor,\r\n        strokeColor,\r\n        strokeWidth\r\n      )\r\n    });\r\n\r\n    return drawControl;\r\n  }\r\n\r\n  /**\r\n   * Called when the user selects a new geometry type\r\n   * @param geometryType the geometry type selected by the user\r\n   */\r\n  onGeometryTypeChange(\r\n    geometryType: Type,\r\n    feature,\r\n    workspace: EditionWorkspace\r\n  ) {\r\n    this.drawControl.setGeometryType(geometryType);\r\n    this.toggleDrawControl(feature, workspace);\r\n  }\r\n\r\n  /**\r\n   * Activate the correct control\r\n   */\r\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\r\n    this.deactivateDrawControl();\r\n    this.activateDrawControl(feature, workspace);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active draw control\r\n   */\r\n  public deactivateDrawControl() {\r\n    if (!this.drawControl) {\r\n      return;\r\n    }\r\n\r\n    if (this.drawEnd$$) {\r\n      this.drawEnd$$.unsubscribe();\r\n    }\r\n\r\n    this.drawControl.setOlMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   */\r\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\r\n    this.drawEnd$$ = this.drawControl.end$.subscribe(\r\n      (olGeometry: OlGeometry) => {\r\n        this.addFeatureToStore(feature, workspace, olGeometry);\r\n      }\r\n    );\r\n\r\n    this.drawControl.setOlMap(this.map.ol, true);\r\n  }\r\n\r\n  /**\r\n   * Add a feature to layer. The loading strategy of the layer\r\n   * will trigger and add the feature to the workspace store.\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(\r\n    feature,\r\n    workspace: EditionWorkspace,\r\n    olGeometry?: OlGeometry\r\n  ) {\r\n    const projection = this.map.ol.getView().getProjection();\r\n    let geometry = feature.geometry;\r\n\r\n    // If an olGeometry is passed, it means that it is a new feature\r\n    if (olGeometry) {\r\n      workspace.entityStore.insert(feature);\r\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\r\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\r\n        featureProjection: projection,\r\n        dataProjection: 'EPSG:4326'\r\n      }) as any;\r\n\r\n      feature.geometry = geometry;\r\n    } else {\r\n      workspace.entityStore.state.update(feature, { edit: true }, true);\r\n    }\r\n\r\n    feature.projection = 'EPSG:4326';\r\n\r\n    const featureOl = featureToOl(feature, projection.getCode());\r\n\r\n    this.olDrawingLayer.dataSource.ol.clear();\r\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\r\n    this.map.addLayer(this.olDrawingLayer);\r\n\r\n    this.deactivateDrawControl();\r\n    this.createModifyInteraction(featureOl, feature, workspace);\r\n  }\r\n\r\n  /**\r\n   * Delete drawings layer and source from the map AND feature from the entity store.\r\n   * Layer refresh will automatically add the new feature into the store.\r\n   */\r\n  deleteDrawings() {\r\n    this.map.removeLayer(this.olDrawingLayer);\r\n    this.olDrawingLayerSource.clear();\r\n    this.map.ol.removeInteraction(this.modify);\r\n  }\r\n\r\n  /**\r\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\r\n   */\r\n  createModifyInteraction(\r\n    olFeature: OlFeature<OlGeometry>,\r\n    feature,\r\n    workspace: EditionWorkspace\r\n  ) {\r\n    this.map.ol.removeInteraction(this.modify);\r\n    const olCollection = new Collection([olFeature], { unique: true });\r\n    this.modify = new OlModify({\r\n      features: olCollection\r\n    });\r\n\r\n    this.map.ol.addInteraction(this.modify);\r\n    olCollection.forEach((feature) => {\r\n      feature.setStyle(this.modifyStyle);\r\n    });\r\n\r\n    this.modify.on('modifyend', (event) => {\r\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\r\n      if (olGeometry) {\r\n        this.addFeatureToStore(feature, workspace, olGeometry);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import {\r\n  HttpClient,\r\n  HttpErrorResponse,\r\n  HttpHeaders\r\n} from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport {\r\n  ActionStore,\r\n  EntityStoreFilterSelectionStrategy,\r\n  EntityTableButton,\r\n  EntityTableColumnRenderer,\r\n  EntityTableTemplate\r\n} from '@igo2/common';\r\nimport { ConfigService, MessageService, StorageService } from '@igo2/core';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport { FeatureLoader } from 'ol/featureloader';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport WKT from 'ol/format/WKT';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olSourceImageWMS from 'ol/source/ImageWMS';\r\n\r\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\r\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\r\n\r\nimport {\r\n  RelationOptions,\r\n  SourceFieldsOptionsParams,\r\n  WMSDataSource\r\n} from '../../datasource';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport {\r\n  Feature,\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreInMapExtentStrategy,\r\n  FeatureStoreInMapResolutionStrategy,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy\r\n} from '../../feature';\r\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\r\nimport {\r\n  ImageLayer,\r\n  LayerService,\r\n  LayersLinkProperties,\r\n  LinkedProperties,\r\n  VectorLayer\r\n} from '../../layer/shared';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap, MapBase } from '../../map/shared';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { EditionWorkspace } from './edition-workspace';\r\nimport { createFilterInMapExtentOrResolutionStrategy } from './workspace.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class EditionWorkspaceService {\r\n  public ws$ = new BehaviorSubject<string>(undefined);\r\n  public adding$ = new BehaviorSubject<boolean>(false);\r\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(\r\n    undefined\r\n  );\r\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\r\n  public loading = false;\r\n  public wktFormat = new WKT();\r\n  public geoJsonFormat = new GeoJSON();\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private storageService: StorageService,\r\n    private configService: ConfigService,\r\n    private messageService: MessageService,\r\n    private http: HttpClient,\r\n    private dialog: MatDialog,\r\n    private styleService: StyleService,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {}\r\n\r\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\r\n    if (\r\n      layer.options.workspace?.enabled !== true ||\r\n      layer.dataSource.options.edition.enabled !== true\r\n    ) {\r\n      return;\r\n    }\r\n    let wksConfig;\r\n    if (layer.options.workspace) {\r\n      wksConfig = layer.options.workspace;\r\n    } else {\r\n      wksConfig = {};\r\n    }\r\n    wksConfig.srcId = layer.id;\r\n    wksConfig.workspaceId = layer.id;\r\n    wksConfig.enabled = true;\r\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\r\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\r\n\r\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\r\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\r\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\r\n    if (!layer.options.linkedLayers) {\r\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\r\n    }\r\n    const linkProperties = {\r\n      syncedDelete: true,\r\n      linkedIds: [wfsLinkId],\r\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\r\n    } as LayersLinkProperties;\r\n\r\n    if (!layer.options.workspace?.minResolution) {\r\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\r\n    }\r\n    let hasOgcFilters = false;\r\n    if (\r\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\r\n    ) {\r\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\r\n      hasOgcFilters = true;\r\n    }\r\n    if (!layer.options.workspace?.maxResolution) {\r\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\r\n    }\r\n\r\n    let clonedLinks: LayersLinkProperties[] = [];\r\n    if (layer.options.linkedLayers.links) {\r\n      clonedLinks = JSON.parse(\r\n        JSON.stringify(layer.options.linkedLayers.links)\r\n      );\r\n    }\r\n    clonedLinks.push(linkProperties);\r\n\r\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\r\n      ? layer.options.linkedLayers.linkId\r\n      : wmsLinkId),\r\n      (layer.options.linkedLayers.links = clonedLinks);\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n    let wks;\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        id: wfsLinkId,\r\n        linkedLayers: {\r\n          linkId: wfsLinkId\r\n        },\r\n        workspace: {\r\n          srcId: layer.id,\r\n          workspaceId: undefined,\r\n          enabled: false,\r\n          queryOptions: {\r\n            mapQueryOnOpenTab:\r\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\r\n            tabQuery: false\r\n          },\r\n          pageSize: layer.options.workspace?.pageSize,\r\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\r\n        },\r\n        showInLayerList: false,\r\n        opacity: 0,\r\n        title: layer.title,\r\n        minResolution:\r\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\r\n        maxResolution:\r\n          layer.options.workspace?.maxResolution ||\r\n          layer.maxResolution ||\r\n          Infinity,\r\n        style: this.styleService.createStyle({\r\n          fill: {\r\n            color: 'rgba(255, 255, 255, 0.01)'\r\n          },\r\n          stroke: {\r\n            color: 'rgba(255, 255, 255, 0.01)'\r\n          },\r\n          circle: {\r\n            fill: {\r\n              color: 'rgba(255, 255, 255, 0.01)'\r\n            },\r\n            stroke: {\r\n              color: 'rgba(255, 255, 255, 0.01)'\r\n            },\r\n            radius: 5\r\n          }\r\n        }),\r\n        sourceOptions: {\r\n          download: dataSource.options.download,\r\n          type: 'wfs',\r\n          url: dataSource.options.urlWfs || dataSource.options.url,\r\n          queryable: true,\r\n          relations: dataSource.options.relations,\r\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\r\n            .queryTitle,\r\n          params: dataSource.options.paramsWFS,\r\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\r\n            enabled: hasOgcFilters\r\n          }),\r\n          sourceFields: dataSource.options.sourceFields || undefined,\r\n          edition: dataSource.options.edition\r\n        } as WFSoptions\r\n      })\r\n      .subscribe((workspaceLayer: VectorLayer) => {\r\n        map.addLayer(workspaceLayer);\r\n        layer.ol.setProperties(\r\n          {\r\n            linkedLayers: {\r\n              linkId: layer.options.linkedLayers.linkId,\r\n              links: clonedLinks\r\n            }\r\n          },\r\n          false\r\n        );\r\n        workspaceLayer.dataSource.ol.refresh();\r\n\r\n        wks = new EditionWorkspace(\r\n          this.dialog,\r\n          this.configService,\r\n          this.adding$,\r\n          (relation: RelationOptions) => this.getDomainValues(relation),\r\n          {\r\n            id: layer.id,\r\n            title: layer.title,\r\n            layer: workspaceLayer,\r\n            map,\r\n            entityStore: this.createFeatureStore(workspaceLayer, map),\r\n            actionStore: new ActionStore([]),\r\n            meta: {\r\n              tableTemplate: undefined\r\n            }\r\n          }\r\n        );\r\n        this.createTableTemplate(wks, workspaceLayer);\r\n\r\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\r\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\r\n          wksConfig\r\n        } as GeoWorkspaceOptions);\r\n\r\n        delete dataSource.options.download;\r\n        return wks;\r\n      });\r\n\r\n    return wks;\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], { map });\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: undefined,\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n\r\n  private createTableTemplate(\r\n    workspace: EditionWorkspace,\r\n    layer: VectorLayer\r\n  ): EntityTableTemplate {\r\n    const fields = layer.dataSource.options.sourceFields || [];\r\n\r\n    const relations = layer.dataSource.options.relations || [];\r\n\r\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\r\n    let buttons = [];\r\n    let columns = [];\r\n    let relationsColumn = [];\r\n\r\n    buttons = [\r\n      {\r\n        name: 'edition',\r\n        title: undefined,\r\n        renderer: EntityTableColumnRenderer.ButtonGroup,\r\n        primary: false,\r\n        valueAccessor: () => {\r\n          return [\r\n            {\r\n              editMode: false,\r\n              icon: 'pencil',\r\n              color: 'primary',\r\n              disabled:\r\n                layer.dataSource.options.edition.modifyButton === false\r\n                  ? true\r\n                  : false,\r\n              click: (feature) => {\r\n                workspace.editFeature(feature, workspace);\r\n              }\r\n            },\r\n            {\r\n              editMode: false,\r\n              icon: 'delete',\r\n              color: 'warn',\r\n              disabled:\r\n                layer.dataSource.options.edition.deleteButton === false\r\n                  ? true\r\n                  : false,\r\n              click: (feature) => {\r\n                workspace.deleteFeature(feature, workspace);\r\n              }\r\n            },\r\n            {\r\n              editMode: true,\r\n              icon: 'check',\r\n              color: 'primary',\r\n              disabled: this.loading,\r\n              click: (feature) => {\r\n                this.saveFeature(feature, workspace);\r\n              }\r\n            },\r\n            {\r\n              editMode: true,\r\n              icon: 'alpha-x',\r\n              color: 'primary',\r\n              disabled: this.loading,\r\n              click: (feature) => {\r\n                this.cancelEdit(workspace, feature);\r\n              }\r\n            }\r\n          ] as EntityTableButton[];\r\n        }\r\n      }\r\n    ];\r\n\r\n    if (fields.length === 0) {\r\n      workspace.entityStore.entities$\r\n        .pipe(\r\n          skipWhile((val) => val.length === 0),\r\n          take(1)\r\n        )\r\n        .subscribe((entities) => {\r\n          const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\r\n          const columnsFromFeatures = ol\r\n            .getKeys()\r\n            .filter(\r\n              (col) =>\r\n                !col.startsWith('_') &&\r\n                col !== 'geometry' &&\r\n                col !== ol.getGeometryName() &&\r\n                !col.match(/boundedby/gi)\r\n            )\r\n            .map((key) => {\r\n              return {\r\n                name: `properties.${key}`,\r\n                title: key,\r\n                renderer: rendererType\r\n              };\r\n            });\r\n          workspace.meta.tableTemplate = {\r\n            selection: false,\r\n            sort: true,\r\n            columns: columnsFromFeatures\r\n          };\r\n        });\r\n      return;\r\n    }\r\n\r\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\r\n      let column = {\r\n        name: `properties.${field.name}`,\r\n        title: field.alias ? field.alias : field.name,\r\n        renderer: rendererType,\r\n        valueAccessor: undefined,\r\n        cellClassFunc: () => {\r\n          const cellClass = {};\r\n          if (field.type) {\r\n            cellClass[`class_${field.type}`] = true;\r\n            return cellClass;\r\n          }\r\n        },\r\n        primary: field.primary === true ? true : false,\r\n        visible: field.visible,\r\n        validation: field.validation,\r\n        linkColumnForce: field.linkColumnForce,\r\n        type: field.type,\r\n        domainValues: undefined,\r\n        relation: undefined,\r\n        multiple: field.multiple,\r\n        step: field.step,\r\n        tooltip: field.tooltip\r\n      };\r\n\r\n      if (field.type === 'list' || field.type === 'autocomplete') {\r\n        this.getDomainValues(field.relation).subscribe((result) => {\r\n          column.domainValues = result;\r\n          column.relation = field.relation;\r\n        });\r\n      }\r\n      return column;\r\n    });\r\n\r\n    relationsColumn = relations.map((relation: RelationOptions) => {\r\n      return {\r\n        name: `properties.${relation.name}`,\r\n        title: relation.alias ? relation.alias : relation.name,\r\n        renderer: EntityTableColumnRenderer.Icon,\r\n        icon: relation.icon,\r\n        parent: relation.parent,\r\n        type: 'relation',\r\n        tooltip: relation.tooltip,\r\n        onClick: () => {\r\n          if (this.adding$.getValue() === false) {\r\n            this.ws$.next(relation.title);\r\n          }\r\n        },\r\n        cellClassFunc: () => {\r\n          return { class_icon: true };\r\n        }\r\n      };\r\n    });\r\n\r\n    columns.push(...relationsColumn);\r\n    columns.push(...buttons);\r\n\r\n    workspace.meta.tableTemplate = {\r\n      selection: false,\r\n      sort: true,\r\n      columns\r\n    };\r\n  }\r\n\r\n  public saveFeature(feature, workspace: EditionWorkspace) {\r\n    if (!this.validateFeature(feature, workspace)) {\r\n      return false;\r\n    }\r\n\r\n    this.sanitizeParameter(feature, workspace);\r\n\r\n    const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\r\n    let url = this.configService.getConfig('edition.url');\r\n\r\n    if (!url) {\r\n      url = baseUrl;\r\n    } else {\r\n      url += baseUrl ? baseUrl : '';\r\n    }\r\n\r\n    if (feature.newFeature) {\r\n      url += workspace.layer.dataSource.options.edition.addUrl;\r\n\r\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\r\n      const headers = new HttpHeaders(addHeaders);\r\n\r\n      this.addFeature(feature, workspace, url, headers);\r\n    } else {\r\n      if (\r\n        workspace.layer.dataSource.options.edition.modifyProtocol !== 'post'\r\n      ) {\r\n        url +=\r\n          '?' +\r\n          workspace.layer.dataSource.options.edition.modifyUrl +\r\n          feature.idkey;\r\n      } else {\r\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\r\n      }\r\n\r\n      const protocole =\r\n        workspace.layer.dataSource.options.edition.modifyProtocol;\r\n      const modifyHeaders =\r\n        workspace.layer.dataSource.options.edition.modifyHeaders;\r\n      const headers = new HttpHeaders(modifyHeaders);\r\n\r\n      this.modifyFeature(feature, workspace, url, headers, protocole);\r\n    }\r\n  }\r\n\r\n  public addFeature(\r\n    feature,\r\n    workspace: EditionWorkspace,\r\n    url: string,\r\n    headers: { [key: string]: any }\r\n  ) {\r\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\r\n      const projDest =\r\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\r\n      feature.properties[\r\n        workspace.layer.dataSource.options.params.fieldNameGeometry\r\n      ] =\r\n        'SRID=' +\r\n        projDest.replace('EPSG:', '') +\r\n        ';' +\r\n        this.wktFormat.writeGeometry(\r\n          this.geoJsonFormat\r\n            .readFeature(feature.geometry)\r\n            .getGeometry()\r\n            .transform('EPSG:4326', projDest),\r\n          { dataProjection: projDest }\r\n        );\r\n    }\r\n\r\n    for (const property in feature.properties) {\r\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\r\n        if (\r\n          (sf.name === property && sf.validation?.readonly) ||\r\n          (sf.name === property && sf.validation?.send === false)\r\n        ) {\r\n          delete feature.properties[property];\r\n        }\r\n      }\r\n    }\r\n\r\n    this.loading = true;\r\n    this.http\r\n      .post(`${url}`, feature.properties, { headers: headers })\r\n      .subscribe(\r\n        () => {\r\n          this.loading = false;\r\n          workspace.entityStore.stateView.clear();\r\n          workspace.deleteDrawings();\r\n          workspace.entityStore.delete(feature);\r\n\r\n          this.messageService.success('igo.geo.workspace.addSuccess');\r\n\r\n          this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\r\n          this.adding$.next(false);\r\n          this.rowsInMapExtentCheckCondition$.next(true);\r\n        },\r\n        (error) => {\r\n          this.loading = false;\r\n          error.error.caught = true;\r\n          const messages = workspace.layer.dataSource.options.edition.messages;\r\n          if (messages) {\r\n            let text;\r\n            messages.forEach((message) => {\r\n              const key = Object.keys(message)[0];\r\n              if (error.error.message.includes(key)) {\r\n                text = message[key];\r\n                this.messageService.error(text);\r\n              }\r\n            });\r\n            if (!text) {\r\n              this.messageService.error('igo.geo.workspace.addError');\r\n            }\r\n          } else {\r\n            this.messageService.error('igo.geo.workspace.addError');\r\n          }\r\n        }\r\n      );\r\n  }\r\n\r\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\r\n    this.loading = true;\r\n    this.http.delete(`${url}`, {}).subscribe(\r\n      () => {\r\n        this.loading = false;\r\n        this.messageService.success('igo.geo.workspace.deleteSuccess');\r\n\r\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\r\n        for (const relation of workspace.layer.options.sourceOptions\r\n          .relations) {\r\n          workspace.map.layers.forEach((layer) => {\r\n            if (layer.title === relation.title) {\r\n              layer.dataSource.ol.refresh();\r\n            }\r\n          });\r\n        }\r\n      },\r\n      (error) => {\r\n        this.loading = false;\r\n        error.error.caught = true;\r\n        const messages = workspace.layer.dataSource.options.edition.messages;\r\n        if (messages) {\r\n          let text;\r\n          messages.forEach((message) => {\r\n            const key = Object.keys(message)[0];\r\n            if (error.error.message.includes(key)) {\r\n              text = message[key];\r\n              this.messageService.error(text);\r\n            }\r\n          });\r\n          if (!text) {\r\n            this.messageService.error('igo.geo.workspace.addError');\r\n          }\r\n        } else {\r\n          this.messageService.error('igo.geo.workspace.addError');\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  public modifyFeature(\r\n    feature,\r\n    workspace: EditionWorkspace,\r\n    url: string,\r\n    headers: { [key: string]: any },\r\n    protocole = 'patch'\r\n  ) {\r\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\r\n      const projDest =\r\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\r\n      // Remove 3e dimension\r\n      feature.geometry.coordinates = removeZ(feature.geometry.coordinates);\r\n      feature.properties[\r\n        workspace.layer.dataSource.options.params.fieldNameGeometry\r\n      ] =\r\n        'SRID=' +\r\n        projDest.replace('EPSG:', '') +\r\n        ';' +\r\n        this.wktFormat.writeGeometry(\r\n          this.geoJsonFormat\r\n            .readFeature(feature.geometry)\r\n            .getGeometry()\r\n            .transform('EPSG:4326', projDest),\r\n          { dataProjection: projDest }\r\n        );\r\n    }\r\n\r\n    for (const property in feature.properties) {\r\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\r\n        if (\r\n          (sf.name === property && sf.validation?.readonly) ||\r\n          (sf.name === property && sf.validation?.send === false) ||\r\n          property === 'boundedBy'\r\n        ) {\r\n          delete feature.properties[property];\r\n        }\r\n      }\r\n    }\r\n\r\n    this.loading = true;\r\n    this.http[protocole](`${url}`, feature.properties, {\r\n      headers: headers\r\n    }).subscribe(\r\n      () => {\r\n        this.loading = false;\r\n        this.cancelEdit(workspace, feature, true);\r\n\r\n        this.messageService.success('igo.geo.workspace.modifySuccess');\r\n\r\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\r\n\r\n        let relationLayers = [];\r\n        for (const relation of workspace.layer.options.sourceOptions\r\n          .relations) {\r\n          workspace.map.layers.forEach((layer) => {\r\n            if (layer.title === relation.title) {\r\n              relationLayers.push(layer);\r\n              layer.dataSource.ol.refresh();\r\n            }\r\n          });\r\n        }\r\n        this.relationLayers$.next(relationLayers);\r\n      },\r\n      (error) => {\r\n        this.loading = false;\r\n        error.error.caught = true;\r\n        const messages = workspace.layer.dataSource.options.edition.messages;\r\n        if (messages) {\r\n          let text;\r\n          messages.forEach((message) => {\r\n            const key = Object.keys(message)[0];\r\n            if (error.error.message.includes(key)) {\r\n              text = message[key];\r\n              this.messageService.error(text);\r\n            }\r\n          });\r\n          if (!text) {\r\n            this.messageService.error('igo.geo.workspace.addError');\r\n          }\r\n        } else {\r\n          this.messageService.error('igo.geo.workspace.addError');\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\r\n    feature.edition = false;\r\n    this.adding$.next(false);\r\n    workspace.deleteDrawings();\r\n    workspace.entityStore.stateView.clear();\r\n\r\n    if (feature.newFeature) {\r\n      workspace.entityStore.delete(feature);\r\n      workspace.deactivateDrawControl();\r\n\r\n      this.rowsInMapExtentCheckCondition$.next(true);\r\n    } else {\r\n      if (!fromSave) {\r\n        feature.properties = feature.original_properties;\r\n        feature.geometry = feature.original_geometry;\r\n      }\r\n      delete feature.original_properties;\r\n      delete feature.original_geometry;\r\n    }\r\n  }\r\n\r\n  getDomainValues(relation: RelationOptions): Observable<any> {\r\n    let url = relation.url;\r\n    if (!url) {\r\n      url = this.configService.getConfig('edition.url')\r\n        ? this.configService.getConfig('edition.url') + relation.table\r\n        : relation.table;\r\n    }\r\n\r\n    return this.http.get<any>(url).pipe(\r\n      map((result) => {\r\n        return result;\r\n      }),\r\n      catchError((err: HttpErrorResponse) => {\r\n        err.error.caught = true;\r\n        return throwError(err);\r\n      })\r\n    );\r\n  }\r\n\r\n  /*\r\n   * Refresh both wms and wfs layer\r\n   * A new wfs loader is used to ensure cache is not retrieving old data\r\n   * WMS params are updated to ensure layer is correctly refreshed\r\n   */\r\n  refreshMap(layer: VectorLayer, map: MapBase) {\r\n    const wfsOlLayer = layer.dataSource.ol;\r\n    const loader: FeatureLoader = (\r\n      extent,\r\n      resolution,\r\n      proj,\r\n      success,\r\n      failure\r\n    ) => {\r\n      layer.customWFSLoader(\r\n        layer.ol.getSource(),\r\n        layer.options.sourceOptions as WFSDataSourceOptions,\r\n        this.authInterceptor,\r\n        extent,\r\n        resolution,\r\n        proj,\r\n        success,\r\n        failure,\r\n        true\r\n      );\r\n    };\r\n    wfsOlLayer.setLoader(loader);\r\n    wfsOlLayer.refresh();\r\n\r\n    for (const lay of map.layers) {\r\n      if (\r\n        lay.id !== layer.id &&\r\n        lay.options.linkedLayers?.linkId.includes(\r\n          layer.id.substr(0, layer.id.indexOf('.') - 1)\r\n        ) &&\r\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\r\n      ) {\r\n        const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\r\n        let params = wmsOlLayer.getParams();\r\n        params._t = new Date().getTime();\r\n        wmsOlLayer.updateParams(params);\r\n      }\r\n    }\r\n  }\r\n\r\n  validateFeature(feature, workspace: EditionWorkspace) {\r\n    let message;\r\n    let key;\r\n    let valid = true;\r\n    workspace.meta.tableTemplate.columns.forEach((column) => {\r\n      if (column.hasOwnProperty('validation') && column.validation) {\r\n        key = getColumnKeyWithoutPropertiesTag(column.name);\r\n        Object.keys(column.validation).forEach((type) => {\r\n          switch (type) {\r\n            case 'mandatory': {\r\n              if (\r\n                column.validation[type] &&\r\n                (!feature.properties.hasOwnProperty(key) ||\r\n                  !feature.properties[key])\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.mandatory',\r\n                  undefined,\r\n                  undefined,\r\n                  { column: column.title }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n            case 'minValue': {\r\n              if (\r\n                feature.properties.hasOwnProperty(key) &&\r\n                feature.properties[key] &&\r\n                feature.properties[key] < column.validation[type]\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.minValue',\r\n                  undefined,\r\n                  undefined,\r\n                  {\r\n                    column: column.title,\r\n                    value: column.validation[type]\r\n                  }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n            case 'maxValue': {\r\n              if (\r\n                feature.properties.hasOwnProperty(key) &&\r\n                feature.properties[key] &&\r\n                feature.properties[key] > column.validation[type]\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.maxValue',\r\n                  undefined,\r\n                  undefined,\r\n                  {\r\n                    column: column.title,\r\n                    value: column.validation[type]\r\n                  }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n            case 'minLength': {\r\n              if (\r\n                feature.properties.hasOwnProperty(key) &&\r\n                feature.properties[key] &&\r\n                feature.properties[key].length < column.validation[type]\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.minLength',\r\n                  undefined,\r\n                  undefined,\r\n                  {\r\n                    column: column.title,\r\n                    value: column.validation[type]\r\n                  }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n            case 'maxLength': {\r\n              if (\r\n                feature.properties.hasOwnProperty(key) &&\r\n                feature.properties[key] &&\r\n                feature.properties[key].length > column.validation[type]\r\n              ) {\r\n                valid = false;\r\n                this.messageService.error(\r\n                  'igo.geo.formValidation.maxLength',\r\n                  undefined,\r\n                  undefined,\r\n                  {\r\n                    column: column.title,\r\n                    value: column.validation[type]\r\n                  }\r\n                );\r\n              }\r\n              break;\r\n            }\r\n          }\r\n        });\r\n      }\r\n    });\r\n    return valid;\r\n  }\r\n\r\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\r\n    workspace.meta.tableTemplate.columns.forEach((column) => {\r\n      if (\r\n        column.type === 'list' &&\r\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]\r\n      ) {\r\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\r\n          feature.properties[\r\n            getColumnKeyWithoutPropertiesTag(column.name)\r\n          ].toString();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\r\n  if (column.includes('properties.')) {\r\n    return column.split('.')[1];\r\n  }\r\n  return column;\r\n}\r\n\r\nfunction removeZ(coords: any) {\r\n  if (coords.length === 0) return coords;\r\n  if (typeof coords[0] === 'number') return coords.slice(0, 2);\r\n  return coords.map(removeZ);\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ActionStore, EntityStoreFilterSelectionStrategy } from '@igo2/common';\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';\r\n\r\nimport { CapabilitiesService, WMSDataSource } from '../../datasource';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\r\nimport {\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreInMapExtentStrategy,\r\n  FeatureStoreInMapResolutionStrategy,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  GeoPropertiesStrategy\r\n} from '../../feature';\r\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\r\nimport {\r\n  ImageLayer,\r\n  LayerService,\r\n  LayersLinkProperties,\r\n  LinkedProperties,\r\n  VectorLayer\r\n} from '../../layer/shared';\r\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\r\nimport { StyleService } from '../../style/style-service/style.service';\r\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\r\nimport { WfsWorkspace } from './wfs-workspace';\r\nimport {\r\n  createFilterInMapExtentOrResolutionStrategy,\r\n  createTableTemplate\r\n} from './workspace.utils';\r\nimport {\r\n  FeatureCommonVectorStyleOptions,\r\n  OverlayStyleOptions\r\n} from '../../style/shared/vector/vector-style.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WmsWorkspaceService {\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  public ws$ = new BehaviorSubject<string>(undefined);\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private storageService: StorageService,\r\n    private capabilitiesService: CapabilitiesService,\r\n    private styleService: StyleService,\r\n    private configService: ConfigService,\r\n    private propertyTypeDetectorService: PropertyTypeDetectorService\r\n  ) {}\r\n\r\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\r\n    if (\r\n      !layer.options.workspace ||\r\n      map.layers.find(\r\n        (lay) => lay.id === layer.id + '.WfsWorkspaceTableDest'\r\n      ) ||\r\n      layer.dataSource.options.edition\r\n    ) {\r\n      return;\r\n    }\r\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\r\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\r\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\r\n    if (!layer.options.linkedLayers) {\r\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\r\n    }\r\n    const linkProperties = {\r\n      syncedDelete: true,\r\n      linkedIds: [wfsLinkId],\r\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\r\n    } as LayersLinkProperties;\r\n\r\n    if (!layer.options.workspace?.minResolution) {\r\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\r\n    }\r\n    let hasOgcFilters = false;\r\n    if (\r\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\r\n    ) {\r\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\r\n      hasOgcFilters = true;\r\n    }\r\n    if (!layer.options.workspace?.maxResolution) {\r\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\r\n    }\r\n\r\n    let clonedLinks: LayersLinkProperties[] = [];\r\n    if (layer.options.linkedLayers.links) {\r\n      clonedLinks = JSON.parse(\r\n        JSON.stringify(layer.options.linkedLayers.links)\r\n      );\r\n    }\r\n    clonedLinks.push(linkProperties);\r\n\r\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\r\n      ? layer.options.linkedLayers.linkId\r\n      : wmsLinkId),\r\n      (layer.options.linkedLayers.links = clonedLinks);\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    let wks;\r\n    let wksLayerOption: GeoWorkspaceOptions = {\r\n      printable: layer.options.workspace?.printable,\r\n      srcId: layer.id,\r\n      workspaceId: undefined,\r\n      enabled: false,\r\n      queryOptions: {\r\n        mapQueryOnOpenTab:\r\n          layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\r\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\r\n      },\r\n      pageSize: layer.options.workspace?.pageSize,\r\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\r\n    };\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        isIgoInternalLayer: true,\r\n        id: wfsLinkId,\r\n        linkedLayers: {\r\n          linkId: wfsLinkId\r\n        },\r\n        workspace: wksLayerOption,\r\n        showInLayerList: false,\r\n        opacity: 0,\r\n        title: layer.title,\r\n        minResolution:\r\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\r\n        maxResolution:\r\n          layer.options.workspace?.maxResolution ||\r\n          layer.maxResolution ||\r\n          Infinity,\r\n        style: this.styleService.createStyle({\r\n          fill: {\r\n            color: 'rgba(255, 255, 255, 0.01)'\r\n          },\r\n          stroke: {\r\n            color: 'rgba(255, 255, 255, 0.01)'\r\n          },\r\n          circle: {\r\n            fill: {\r\n              color: 'rgba(255, 255, 255, 0.01)'\r\n            },\r\n            stroke: {\r\n              color: 'rgba(255, 255, 255, 0.01)'\r\n            },\r\n            radius: 5\r\n          }\r\n        }),\r\n        sourceOptions: {\r\n          download: dataSource.options.download,\r\n          type: 'wfs',\r\n          url: dataSource.options.urlWfs || dataSource.options.url,\r\n          queryable: true,\r\n          relations: dataSource.options.relations,\r\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\r\n            .queryTitle,\r\n          queryFormatAsWms: layer.options.workspace?.enabled\r\n            ? (dataSource.options as QueryableDataSourceOptions)\r\n                .queryFormatAsWms\r\n            : true,\r\n          params: dataSource.options.paramsWFS,\r\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\r\n            enabled: hasOgcFilters\r\n          }),\r\n          sourceFields: dataSource.options.sourceFields || undefined\r\n        } as WFSoptions\r\n      })\r\n      .subscribe((workspaceLayer: VectorLayer) => {\r\n        map.addLayer(workspaceLayer);\r\n        layer.ol.setProperties(\r\n          {\r\n            linkedLayers: {\r\n              linkId: layer.options.linkedLayers.linkId,\r\n              links: clonedLinks\r\n            }\r\n          },\r\n          false\r\n        );\r\n        workspaceLayer.dataSource.ol.refresh();\r\n\r\n        if (!layer.options.workspace?.enabled) {\r\n          return;\r\n        }\r\n        wks = new WfsWorkspace({\r\n          id: layer.id,\r\n          title: layer.title,\r\n          layer: workspaceLayer,\r\n          map,\r\n          entityStore: this.createFeatureStore(workspaceLayer, map),\r\n          actionStore: new ActionStore([]),\r\n          meta: {\r\n            tableTemplate: undefined\r\n          }\r\n        });\r\n        createTableTemplate(wks, workspaceLayer, this.layerService, this.ws$);\r\n\r\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\r\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\r\n          enabled: true,\r\n          srcId: layer.id,\r\n          workspaceId: workspaceLayer.id,\r\n          queryOptions: {\r\n            mapQueryOnOpenTab:\r\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\r\n            tabQuery: layer.options.workspace?.queryOptions?.tabQuery\r\n          },\r\n          pageSize: layer.options.workspace?.pageSize,\r\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\r\n        } as GeoWorkspaceOptions);\r\n\r\n        delete dataSource.options.download;\r\n        return wks;\r\n      });\r\n\r\n    return wks;\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], { map });\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\r\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\r\n      { map },\r\n      this.propertyTypeDetectorService,\r\n      this.capabilitiesService\r\n    );\r\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\r\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\r\n    const confQueryOverlayStyle: OverlayStyleOptions =\r\n      this.configService.getConfig('queryOverlayStyle');\r\n\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      layer: new VectorLayer({\r\n        zIndex: 300,\r\n        source: new FeatureDataSource(),\r\n        style: (feature) => {\r\n          return getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature },\r\n              confQueryOverlayStyle?.selection || {}\r\n            ) as FeatureCommonVectorStyleOptions\r\n          );\r\n        },\r\n        showInLayerList: false,\r\n        exportable: false,\r\n        browsable: false\r\n      }),\r\n      map,\r\n      hitTolerance: 15,\r\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\r\n      many: true,\r\n      dragBox: true\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(inMapExtentStrategy, true);\r\n    store.addStrategy(geoPropertiesStrategy, true);\r\n    store.addStrategy(inMapResolutionStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n    store.addStrategy(selectedRecordStrategy, false);\r\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\r\n    return store;\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport {\r\n  Workspace,\r\n  WorkspaceSelectorComponent,\r\n  WorkspaceStore\r\n} from '@igo2/common';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport {\r\n  FeatureDataSource,\r\n  WFSDataSource,\r\n  WMSDataSource\r\n} from '../../datasource';\r\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\r\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared';\r\nimport { ImageLayer, Layer, VectorLayer } from '../../layer/shared';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\r\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\r\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\r\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\r\n\r\n@Directive({\r\n  selector: '[igoWorkspaceSelector]'\r\n})\r\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\r\n  private layers$$: Subscription;\r\n  private entities$$: Subscription[] = [];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Output() changeWorkspace = new EventEmitter<string>();\r\n  @Output() disableSwitch = new EventEmitter<boolean>();\r\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\r\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\r\n\r\n  get workspaceStore(): WorkspaceStore {\r\n    return this.component.store;\r\n  }\r\n\r\n  constructor(\r\n    private component: WorkspaceSelectorComponent,\r\n    private wfsWorkspaceService: WfsWorkspaceService,\r\n    private wmsWorkspaceService: WmsWorkspaceService,\r\n    private editionWorkspaceService: EditionWorkspaceService,\r\n    private featureWorkspaceService: FeatureWorkspaceService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.layers$$ = this.map.layers$\r\n      .pipe(debounceTime(50))\r\n      .subscribe((layers: Layer[]) => this.onLayersChange(layers));\r\n\r\n    this.featureWorkspaceService.ws$.subscribe((ws) => {\r\n      this.changeWorkspace.emit(ws);\r\n    });\r\n    this.wmsWorkspaceService.ws$.subscribe((ws) => {\r\n      this.changeWorkspace.emit(ws);\r\n    });\r\n    this.wfsWorkspaceService.ws$.subscribe((ws) => {\r\n      this.changeWorkspace.emit(ws);\r\n    });\r\n    this.editionWorkspaceService.ws$.subscribe((ws) => {\r\n      this.changeWorkspace.emit(ws);\r\n    });\r\n    this.editionWorkspaceService.adding$.subscribe((adding) => {\r\n      this.disableSwitch.emit(adding);\r\n    });\r\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => {\r\n      this.relationLayers.emit(layers);\r\n    });\r\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(\r\n      (condition) => {\r\n        this.rowsInMapExtentCheckCondition.emit(condition);\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n    this.entities$$.map((entities) => entities.unsubscribe());\r\n  }\r\n\r\n  private onLayersChange(layers: Layer[]) {\r\n    const editableLayers = layers.filter((layer: Layer) =>\r\n      this.layerIsEditable(layer)\r\n    );\r\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\r\n\r\n    const workspacesToAdd = editableLayers\r\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\r\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\r\n\r\n    const workspacesToRemove = this.workspaceStore\r\n      .all()\r\n      .filter((workspace: Workspace) => {\r\n        return editableLayersIds.indexOf(workspace.id) < 0;\r\n      });\r\n\r\n    if (workspacesToRemove.length > 0) {\r\n      workspacesToRemove.forEach((workspace: Workspace) => {\r\n        workspace.entityStore.deactivateStrategyOfType(\r\n          FeatureStoreInMapExtentStrategy\r\n        );\r\n        workspace.deactivate();\r\n      });\r\n      this.workspaceStore.state.updateMany(workspacesToRemove, {\r\n        active: false,\r\n        selected: false\r\n      });\r\n      this.workspaceStore.deleteMany(workspacesToRemove);\r\n    }\r\n\r\n    if (workspacesToAdd.length > 0) {\r\n      this.workspaceStore.insertMany(workspacesToAdd);\r\n    }\r\n  }\r\n\r\n  private getOrCreateWorkspace(\r\n    layer: VectorLayer | ImageLayer\r\n  ): Workspace | undefined {\r\n    const workspace = this.workspaceStore.get(layer.id);\r\n    if (workspace !== undefined) {\r\n      return;\r\n    }\r\n    if (\r\n      layer.dataSource instanceof WFSDataSource &&\r\n      layer.dataSource.options.edition?.enabled !== true\r\n    ) {\r\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(\r\n        layer as VectorLayer,\r\n        this.map\r\n      );\r\n      return wfsWks;\r\n    } else if (\r\n      layer.dataSource instanceof WMSDataSource &&\r\n      layer.dataSource.options.edition?.enabled !== true\r\n    ) {\r\n      if (!layer.dataSource.options.paramsWFS) {\r\n        return;\r\n      }\r\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(\r\n        layer as ImageLayer,\r\n        this.map\r\n      );\r\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\r\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable =\r\n          !inResolutionRange;\r\n        (\r\n          wmsWks.layer.dataSource.options as QueryableDataSourceOptions\r\n        ).queryable = inResolutionRange;\r\n      });\r\n      return wmsWks;\r\n    } else if (\r\n      layer.dataSource instanceof FeatureDataSource &&\r\n      (layer as VectorLayer).exportable === true &&\r\n      layer.dataSource.options.edition?.enabled !== true\r\n    ) {\r\n      const featureWks = this.featureWorkspaceService.createWorkspace(\r\n        layer as VectorLayer,\r\n        this.map\r\n      );\r\n      return featureWks;\r\n    } else if (\r\n      layer.dataSource instanceof WMSDataSource &&\r\n      layer.dataSource.options.edition?.enabled === true\r\n    ) {\r\n      const editionWks = this.editionWorkspaceService.createWorkspace(\r\n        layer as ImageLayer,\r\n        this.map\r\n      );\r\n      return editionWks;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  private layerIsEditable(layer: Layer): boolean {\r\n    const dataSource = layer.dataSource;\r\n    if (dataSource instanceof WFSDataSource) {\r\n      return true;\r\n    }\r\n    if (dataSource instanceof FeatureDataSource) {\r\n      return true;\r\n    }\r\n    if (dataSource instanceof WMSDataSource) {\r\n      const dataSourceOptions = (dataSource.options ||\r\n        {}) as OgcFilterableDataSourceOptions;\r\n      return (\r\n        dataSourceOptions.ogcFilters?.enabled ||\r\n        dataSource.options.paramsWFS?.featureTypes !== undefined\r\n      );\r\n    }\r\n\r\n    return false;\r\n  }\r\n}\r\n","<h2 mat-dialog-title class=\"mat-typography\">\r\n  {{ 'igo.geo.style.styleModal' | translate }}\r\n</h2>\r\n<div mat-dialog-content>\r\n  <div class=\"edition-drawing mat-typography\">\r\n    <form class=\"igo-form\" [formGroup]=\"form\">\r\n      <div\r\n        class=\"fill-color-picker mat-typography\"\r\n        *ngIf=\"linestringOnly !== true\"\r\n      >\r\n        <span>\r\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\r\n          {{ 'igo.geo.style.fill' | translate }}\r\n        </span>\r\n        <igo-color-picker-form-field\r\n          formControlName=\"fill\"\r\n        ></igo-color-picker-form-field>\r\n      </div>\r\n\r\n      <div class=\"stroke-color-picker mat-typography\">\r\n        <span>\r\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\">\r\n          </mat-icon>\r\n          {{ 'igo.geo.style.stroke' | translate }}\r\n        </span>\r\n        <igo-color-picker-form-field\r\n          formControlName=\"stroke\"\r\n        ></igo-color-picker-form-field>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</div>\r\n<div mat-dialog-actions>\r\n  <button mat-raised-button (click)=\"cancel()\">\r\n    {{ 'igo.geo.style.cancel' | translate }}\r\n  </button>\r\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\r\n</div>\r\n","import { Component, Inject, Input, OnInit } from '@angular/core';\r\nimport { UntypedFormBuilder, UntypedFormGroup } from '@angular/forms';\r\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\r\n\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\nimport olStyle from 'ol/style/Style';\r\n\r\nimport {\r\n  LayerMatDialogData,\r\n  StyleModalData\r\n} from '../shared/style-modal.interface';\r\n\r\n@Component({\r\n  selector: 'igo-style-modal-layer',\r\n  templateUrl: './style-modal-layer.component.html',\r\n  styleUrls: ['./style-modal-layer.component.scss']\r\n})\r\nexport class StyleModalLayerComponent implements OnInit {\r\n  @Input() confirmFlag: boolean = false;\r\n\r\n  public form: UntypedFormGroup;\r\n\r\n  public styleModalData: StyleModalData;\r\n  public linestringOnly: boolean;\r\n\r\n  private initialValues: StyleModalData;\r\n\r\n  private defaultValues: StyleModalData = {\r\n    fillColor: 'rgba(255,255,255,0.4)',\r\n    strokeColor: 'rgba(143,7,7,1)'\r\n  };\r\n\r\n  get layerOlStyle(): olStyle {\r\n    const style = this.data.layer.ol.getStyle();\r\n    return style instanceof Function ? undefined : (style as olStyle).clone();\r\n  }\r\n\r\n  constructor(\r\n    public dialogRef: MatDialogRef<StyleModalLayerComponent>,\r\n    private formBuilder: UntypedFormBuilder,\r\n    @Inject(MAT_DIALOG_DATA) public data: LayerMatDialogData\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.linestringOnly = true;\r\n    for (const feature of this.data.layer.ol.getSource().getFeatures()) {\r\n      if (feature.getGeometry().getType() !== 'LineString') {\r\n        this.linestringOnly = false;\r\n      }\r\n    }\r\n    this.buildStyleData();\r\n    this.buildForm();\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      fill: [this.getLayerFillColor()],\r\n      stroke: [this.getLayerStrokeColor()]\r\n    });\r\n  }\r\n\r\n  private buildStyleData() {\r\n    this.styleModalData = {\r\n      fillColor: this.getLayerFillColor(),\r\n      strokeColor: this.getLayerStrokeColor()\r\n    };\r\n    this.initialValues = {\r\n      fillColor: this.getLayerFillColor(),\r\n      strokeColor: this.getLayerStrokeColor()\r\n    };\r\n  }\r\n\r\n  private getLayerFillColor() {\r\n    let fillColor = this.defaultValues.fillColor;\r\n    const style = this.layerOlStyle;\r\n    if (style?.getFill()?.getColor()) {\r\n      const arrayColor = style.getFill().getColor();\r\n      fillColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\r\n        arrayColor[3] || 0.4\r\n      })`;\r\n    }\r\n    return fillColor;\r\n  }\r\n\r\n  private getLayerStrokeColor() {\r\n    let strokeColor = this.defaultValues.strokeColor;\r\n    const style = this.layerOlStyle;\r\n    if (style?.getStroke()?.getColor()) {\r\n      const arrayColor = style.getStroke().getColor();\r\n      strokeColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\r\n        arrayColor[3] || 1\r\n      })`;\r\n    }\r\n    return strokeColor;\r\n  }\r\n\r\n  setLayerFillColor(event) {\r\n    const cAA = ColorAsArray(event);\r\n    const s = this.layerOlStyle.clone();\r\n    (s.getImage() as any).getFill().setColor(cAA);\r\n    s.getFill().setColor(cAA);\r\n    this.data.layer.ol.setStyle(s);\r\n    this.styleModalData.fillColor = event;\r\n  }\r\n\r\n  setLayerStrokeColor(event) {\r\n    const cAA = ColorAsArray(event);\r\n    const s = this.layerOlStyle.clone();\r\n    (s.getImage() as any).getStroke().setColor(cAA);\r\n    s.getStroke().setColor(cAA);\r\n    this.data.layer.ol.setStyle(s);\r\n    this.styleModalData.strokeColor = event;\r\n  }\r\n\r\n  cancel() {\r\n    this.dialogRef.close();\r\n    this.setLayerFillColor(this.initialValues.fillColor);\r\n    this.setLayerStrokeColor(this.initialValues.strokeColor);\r\n  }\r\n\r\n  confirm() {\r\n    this.confirmFlag = true;\r\n    if (this.form.get('fill').value) {\r\n      this.styleModalData.fillColor = this.form.get('fill').value;\r\n    }\r\n\r\n    if (this.form.get('stroke').value) {\r\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\r\n    }\r\n    this.dialogRef.close(this.styleModalData);\r\n  }\r\n\r\n  openPicker() {\r\n    this.dialogRef.disableClose = true;\r\n  }\r\n\r\n  closePicker() {\r\n    this.dialogRef.disableClose = false;\r\n  }\r\n}\r\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\r\nimport { StyleModalLayerComponent } from '../layer/style-modal-layer.component';\r\nimport { LayerMatDialogData } from '../shared/style-modal.interface';\r\n\r\n@Component({\r\n  selector: 'igo-style-modal-layer-button',\r\n  templateUrl: './style-modal-layer-button.component.html',\r\n  styleUrls: ['./style-modal-layer-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class StyleModalLayerButtonComponent {\r\n  @Input() layer: VectorLayer;\r\n  constructor(private dialog: MatDialog) {}\r\n\r\n  /**\r\n   * Open the style modal dialog box\r\n   */\r\n  openStyleModalDialog() {\r\n    setTimeout(() => {\r\n      // open the dialog box used to style features\r\n      const data: LayerMatDialogData = { layer: this.layer };\r\n      const dialogRef = this.dialog.open(StyleModalLayerComponent, {\r\n        disableClose: false,\r\n        data,\r\n        autoFocus: false\r\n      });\r\n    }, 250);\r\n  }\r\n}\r\n","<button\n  mat-icon-button\n  color=\"primary\"\n  (click)=\"openStyleModalDialog()\"\n  [matTooltip]=\"'igo.geo.style.styleModalTooltipLayer' | translate\"\n>\n  <mat-icon class=\"style-icon\" svgIcon=\"palette\"> </mat-icon>\n</button>\n","import { MessageService } from '@igo2/core';\r\nimport {\r\n  ClusterDataSource,\r\n  ClusterDataSourceOptions,\r\n  ClusterParam,\r\n  FeatureDataSource,\r\n  FeatureDataSourceOptions,\r\n  IgoMap,\r\n  QueryableDataSourceOptions,\r\n  StyleByAttribute,\r\n  StyleListService,\r\n  StyleService,\r\n  VectorLayer,\r\n  featureRandomStyle,\r\n  featureRandomStyleFunction\r\n} from '@igo2/geo';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\n\r\nimport {\r\n  DetailedContext,\r\n  ExtraFeatures\r\n} from '../../context-manager/shared/context.interface';\r\nimport { ContextService } from '../../context-manager/shared/context.service';\r\n\r\nexport function handleFileImportSuccess(\r\n  file: File,\r\n  context: DetailedContext,\r\n  messageService: MessageService,\r\n  contextService: ContextService\r\n) {\r\n  if (Object.keys(context).length <= 0) {\r\n    handleNothingToImportError(file, messageService);\r\n    return;\r\n  }\r\n\r\n  const contextTitle = computeLayerTitleFromFile(file);\r\n\r\n  addContextToContextList(context, contextTitle, contextService);\r\n\r\n  messageService.success(\r\n    'igo.context.contextImportExport.import.success.text',\r\n    'igo.context.contextImportExport.import.success.title',\r\n    undefined,\r\n    {\r\n      value: contextTitle\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  sizeMb?: number\r\n) {\r\n  sizeMb = sizeMb ? sizeMb : 30;\r\n  const errMapping = {\r\n    'Invalid file': handleInvalidFileImportError,\r\n    'File is too large': handleSizeFileImportError,\r\n    'Failed to read file': handleUnreadbleFileImportError\r\n  };\r\n  errMapping[error.message](file, error, messageService, sizeMb);\r\n}\r\n\r\nexport function handleInvalidFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.import.invalid.text',\r\n    'igo.context.contextImportExport.import.invalid.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      mimeType: file.type\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleSizeFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  sizeMb: number\r\n) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.import.tooLarge.text',\r\n    'igo.context.contextImportExport.import.tooLarge.title',\r\n    undefined,\r\n    {\r\n      value: file.name,\r\n      size: sizeMb\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleUnreadbleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.import.unreadable.text',\r\n    'igo.context.contextImportExport.import.unreadable.title',\r\n    undefined,\r\n    {\r\n      value: file.name\r\n    }\r\n  );\r\n}\r\n\r\nexport function handleNothingToImportError(\r\n  file: File,\r\n  messageService: MessageService\r\n) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.import.empty.text',\r\n    'igo.context.contextImportExport.import.empty.title',\r\n    undefined,\r\n    { value: file.name }\r\n  );\r\n}\r\n\r\nexport function addContextToContextList(\r\n  context: DetailedContext,\r\n  contextTitle: string,\r\n  contextService: ContextService\r\n) {\r\n  context.title = contextTitle;\r\n  context.imported = true;\r\n  contextService.contexts$.value.ours.unshift(context);\r\n  contextService.contexts$.next(contextService.contexts$.value);\r\n  contextService.importedContext.unshift(context);\r\n  contextService.loadContext(context.uri);\r\n}\r\n\r\nexport function getFileExtension(file: File): string {\r\n  return file.name.split('.').pop().toLowerCase();\r\n}\r\n\r\nexport function computeLayerTitleFromFile(file: File): string {\r\n  return file.name.substr(0, file.name.lastIndexOf('.'));\r\n}\r\n\r\nexport function addImportedFeaturesToMap(\r\n  extraFeatures: ExtraFeatures,\r\n  map: IgoMap\r\n): VectorLayer {\r\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n    type: 'vector',\r\n    queryable: true\r\n  };\r\n\r\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\r\n  const source = new FeatureDataSource(sourceOptions);\r\n  source.ol.addFeatures(olFeatures);\r\n\r\n  let randomStyle;\r\n  let editable: boolean = false;\r\n  const featureKeys = olFeatures[0]?.getKeys() ?? [];\r\n  if (featureKeys.includes('_style') || featureKeys.includes('_mapTitle')) {\r\n    randomStyle = featureRandomStyleFunction();\r\n  } else {\r\n    randomStyle = featureRandomStyle();\r\n    editable = true;\r\n  }\r\n  const layer = new VectorLayer({\r\n    title: extraFeatures.name,\r\n    isIgoInternalLayer: true,\r\n    source,\r\n    igoStyle: { editable },\r\n    style: randomStyle,\r\n    visible: extraFeatures.visible,\r\n    opacity: extraFeatures.opacity\r\n  });\r\n  map.addLayer(layer);\r\n\r\n  return layer;\r\n}\r\n\r\nexport function addImportedFeaturesStyledToMap(\r\n  extraFeatures: ExtraFeatures,\r\n  map: IgoMap,\r\n  styleListService: StyleListService,\r\n  styleService: StyleService\r\n): VectorLayer {\r\n  let style;\r\n  let distance: number;\r\n\r\n  if (styleListService.getStyleList(extraFeatures.name + '.styleByAttribute')) {\r\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\r\n      extraFeatures.name + '.styleByAttribute'\r\n    );\r\n\r\n    style = (feature, resolution) => {\r\n      return styleService.createStyleByAttribute(\r\n        feature,\r\n        styleByAttribute,\r\n        resolution\r\n      );\r\n    };\r\n  } else if (\r\n    styleListService.getStyleList(extraFeatures.name + '.clusterStyle')\r\n  ) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(\r\n      extraFeatures.name + '.clusterParam'\r\n    );\r\n    distance = styleListService.getStyleList(extraFeatures.name + '.distance');\r\n\r\n    style = (feature, resolution) => {\r\n      const baseStyle = styleService.createStyle(\r\n        styleListService.getStyleList(extraFeatures.name + '.clusterStyle'),\r\n        feature,\r\n        resolution\r\n      );\r\n      return styleService.createClusterStyle(\r\n        feature,\r\n        resolution,\r\n        clusterParam,\r\n        baseStyle\r\n      );\r\n    };\r\n  } else if (styleListService.getStyleList(extraFeatures.name + '.style')) {\r\n    style = (feature, resolution) =>\r\n      styleService.createStyle(\r\n        styleListService.getStyleList(extraFeatures.name + '.style'),\r\n        feature,\r\n        resolution\r\n      );\r\n  } else {\r\n    style = (feature, resolution) =>\r\n      styleService.createStyle(\r\n        styleListService.getStyleList('default.style'),\r\n        feature,\r\n        resolution\r\n      );\r\n  }\r\n  let source;\r\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\r\n  if (styleListService.getStyleList(extraFeatures.name + '.clusterStyle')) {\r\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        distance,\r\n        type: 'cluster',\r\n        queryable: true\r\n      };\r\n    source = new ClusterDataSource(sourceOptions);\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\r\n      {\r\n        type: 'vector',\r\n        queryable: true\r\n      };\r\n    source = new FeatureDataSource(sourceOptions);\r\n    source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  const layer = new VectorLayer({\r\n    title: extraFeatures.name,\r\n    isIgoInternalLayer: true,\r\n    source,\r\n    style,\r\n    opacity: extraFeatures.opacity,\r\n    visible: extraFeatures.visible\r\n  });\r\n  map.addLayer(layer);\r\n\r\n  return layer;\r\n}\r\n\r\nfunction collectFeaturesFromExtraFeatures(\r\n  featureCollection: ExtraFeatures\r\n): OlFeature<OlGeometry>[] {\r\n  const format = new GeoJSON();\r\n  const features = format.readFeatures(featureCollection, {\r\n    dataProjection: 'EPSG:4326',\r\n    featureProjection: 'EPSG:3857'\r\n  });\r\n  return features;\r\n}\r\n","export enum TypePermission {\n  null,\n  read,\n  write\n}\n\nexport enum Scope {\n  public,\n  protected,\n  private\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { Injectable, Optional } from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { Tool } from '@igo2/common';\r\nimport {\r\n  ConfigService,\r\n  LanguageService,\r\n  Message,\r\n  MessageService,\r\n  RouteService,\r\n  StorageService\r\n} from '@igo2/core';\r\nimport type {\r\n  IgoMap,\r\n  Layer,\r\n  LayerOptions,\r\n  VectorLayerOptions,\r\n  VectorTileLayerOptions\r\n} from '@igo2/geo';\r\nimport { ExportService } from '@igo2/geo';\r\nimport { ObjectUtils, uuid } from '@igo2/utils';\r\n\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport { Geometry } from 'ol/geom';\r\nimport olPoint from 'ol/geom/Point';\r\nimport Cluster from 'ol/source/Cluster';\r\nimport olVectorSource from 'ol/source/Vector';\r\n\r\nimport { Feature } from 'ol';\r\nimport { BehaviorSubject, Observable, Subject, of } from 'rxjs';\r\nimport {\r\n  catchError,\r\n  debounceTime,\r\n  first,\r\n  map,\r\n  mergeMap,\r\n  skip,\r\n  tap\r\n} from 'rxjs/operators';\r\n\r\nimport { TypePermission } from './context.enum';\r\nimport {\r\n  Context,\r\n  ContextMapView,\r\n  ContextPermission,\r\n  ContextProfils,\r\n  ContextServiceOptions,\r\n  ContextsList,\r\n  DetailedContext,\r\n  ExtraFeatures\r\n} from './context.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ContextService {\r\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\r\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\r\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\r\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\r\n  public importedContext: Array<DetailedContext> = [];\r\n  public toolsChanged$ = new Subject<DetailedContext>();\r\n  private mapViewFromRoute: ContextMapView = {};\r\n  private options: ContextServiceOptions;\r\n  private baseUrl: string;\r\n\r\n  // Until the ContextService is completely refactored, this is needed\r\n  // to track the current tools\r\n  private tools: Tool[];\r\n  private toolbar: string[];\r\n\r\n  get defaultContextUri(): string {\r\n    return (\r\n      (this.storageService.get('favorite.context.uri') as string) ||\r\n      this._defaultContextUri ||\r\n      this.options.defaultContextUri\r\n    );\r\n  }\r\n  set defaultContextUri(uri: string) {\r\n    this._defaultContextUri = uri;\r\n  }\r\n  private _defaultContextUri: string;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private authService: AuthService,\r\n    private languageService: LanguageService,\r\n    private config: ConfigService,\r\n    private messageService: MessageService,\r\n    private storageService: StorageService,\r\n    private exportService: ExportService,\r\n    @Optional() private route: RouteService\r\n  ) {\r\n    this.options = Object.assign(\r\n      {\r\n        basePath: 'contexts',\r\n        contextListFile: '_contexts.json',\r\n        defaultContextUri: '_default'\r\n      },\r\n      this.config.getConfig('context')\r\n    );\r\n\r\n    this.baseUrl = this.options.url ?? '';\r\n\r\n    this.readParamsFromRoute();\r\n\r\n    if (this.authService.hasAuthService) {\r\n      this.authService.logged$.subscribe((logged) => {\r\n        if (logged) {\r\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\r\n            this.handleContextsChange();\r\n          });\r\n          this.loadContexts();\r\n        }\r\n      });\r\n    } else {\r\n      this.loadContexts();\r\n      this.handleContextsChange(false);\r\n    }\r\n  }\r\n\r\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\r\n    let url = this.baseUrl + '/contexts';\r\n    if (permissions && this.authService.authenticated) {\r\n      url += '?permission=' + permissions.join();\r\n      if (hidden) {\r\n        url += '&hidden=true';\r\n      }\r\n    }\r\n    return this.http.get<ContextsList>(url);\r\n  }\r\n\r\n  getById(id: string): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts/' + id;\r\n    return this.http.get<Context>(url);\r\n  }\r\n\r\n  getDetails(id: string): Observable<DetailedContext> {\r\n    const url = `${this.baseUrl}/contexts/${id}/details`;\r\n    return this.http.get<DetailedContext>(url).pipe(\r\n      catchError((res) => {\r\n        this.handleError(res, id);\r\n        throw res;\r\n      })\r\n    );\r\n  }\r\n\r\n  getDefault(): Observable<DetailedContext> {\r\n    if (this.authService.authenticated) {\r\n      const url = this.baseUrl + '/contexts/default';\r\n      return this.http.get<DetailedContext>(url).pipe(\r\n        tap((context) => {\r\n          this.defaultContextId$.next(context.id);\r\n        })\r\n      );\r\n    } else {\r\n      const uri = this.storageService.get('favorite.context.uri') as string;\r\n      this.defaultContextId$.next(uri);\r\n      return this.getContextByUri(uri);\r\n    }\r\n  }\r\n\r\n  getProfilByUser(): Observable<ContextProfils[]> {\r\n    if (this.baseUrl) {\r\n      const url = this.baseUrl + '/profils?';\r\n      return this.http.get<ContextProfils[]>(url);\r\n    }\r\n    return of([]);\r\n  }\r\n\r\n  setDefault(id: string): Observable<any> {\r\n    if (this.authService.authenticated) {\r\n      const url = this.baseUrl + '/contexts/default';\r\n      return this.http.post(url, { defaultContextId: id });\r\n    } else {\r\n      this.storageService.set('favorite.context.uri', id);\r\n      return of(undefined);\r\n    }\r\n  }\r\n\r\n  hideContext(id: string) {\r\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\r\n    return this.http.post(url, {});\r\n  }\r\n\r\n  showContext(id: string) {\r\n    const url = this.baseUrl + '/contexts/' + id + '/show';\r\n    return this.http.post(url, {});\r\n  }\r\n\r\n  delete(id: string, imported = false): Observable<void> {\r\n    const contexts: ContextsList = { ours: [] };\r\n    Object.keys(this.contexts$.value).forEach(\r\n      (key) =>\r\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\r\n    );\r\n\r\n    if (imported) {\r\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\r\n      return of(this.contexts$.next(contexts));\r\n    }\r\n\r\n    const url = this.baseUrl + '/contexts/' + id;\r\n    return this.http.delete<void>(url).pipe(\r\n      tap((res) => {\r\n        this.contexts$.next(contexts);\r\n      })\r\n    );\r\n  }\r\n\r\n  create(context: DetailedContext): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts';\r\n    return this.http.post<Context>(url, context).pipe(\r\n      map((contextCreated) => {\r\n        if (this.authService.authenticated) {\r\n          contextCreated.permission = TypePermission[TypePermission.write];\r\n        } else {\r\n          contextCreated.permission = TypePermission[TypePermission.read];\r\n        }\r\n        this.contexts$.value.ours.unshift(contextCreated);\r\n        this.contexts$.next(this.contexts$.value);\r\n        return contextCreated;\r\n      })\r\n    );\r\n  }\r\n\r\n  clone(id: string, properties = {}): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\r\n    return this.http.post<Context>(url, properties).pipe(\r\n      map((contextCloned) => {\r\n        contextCloned.permission = TypePermission[TypePermission.write];\r\n        this.contexts$.value.ours.unshift(contextCloned);\r\n        this.contexts$.next(this.contexts$.value);\r\n        return contextCloned;\r\n      })\r\n    );\r\n  }\r\n\r\n  update(id: string, context: Context): Observable<Context> {\r\n    const url = this.baseUrl + '/contexts/' + id;\r\n    return this.http.patch<Context>(url, context);\r\n  }\r\n\r\n  // =================================================================\r\n\r\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\r\n    const association = {\r\n      toolId\r\n    };\r\n    return this.http.post<void>(url, association);\r\n  }\r\n\r\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\r\n    return this.http.delete(url);\r\n  }\r\n\r\n  getPermissions(id: string): Observable<ContextPermission[]> {\r\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\r\n    return this.http.get<ContextPermission[]>(url);\r\n  }\r\n\r\n  addPermissionAssociation(\r\n    contextId: string,\r\n    profil: string,\r\n    type: TypePermission\r\n  ): Observable<ContextPermission[]> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\r\n    const association = {\r\n      profil,\r\n      typePermission: type\r\n    };\r\n\r\n    return this.http.post<ContextPermission[]>(url, association).pipe(\r\n      catchError((res) => {\r\n        this.handleError(res, undefined, true);\r\n        throw [res]; // TODO Not sure about this.\r\n      })\r\n    );\r\n  }\r\n\r\n  deletePermissionAssociation(\r\n    contextId: string,\r\n    permissionId: string\r\n  ): Observable<void> {\r\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\r\n    return this.http.delete<void>(url);\r\n  }\r\n\r\n  // ======================================================================\r\n\r\n  getLocalContexts(): Observable<ContextsList> {\r\n    const url = this.getPath(this.options.contextListFile);\r\n    return this.http.get<ContextsList>(url).pipe(\r\n      map((res: any) => {\r\n        return { ours: res };\r\n      })\r\n    );\r\n  }\r\n\r\n  getLocalContext(uri: string): Observable<DetailedContext> {\r\n    const url = this.getPath(`${uri}.json`);\r\n    return this.http.get<DetailedContext>(url).pipe(\r\n      mergeMap((res) => {\r\n        if (!res.base) {\r\n          return of(res);\r\n        }\r\n        const urlBase = this.getPath(`${res.base}.json`);\r\n        return this.http.get<DetailedContext>(urlBase).pipe(\r\n          map((resBase: DetailedContext) => {\r\n            const resMerge = res;\r\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\r\n            resMerge.layers = (resBase.layers || [])\r\n              .concat(res.layers || [])\r\n              .reverse()\r\n              .filter(\r\n                (l, index, self) =>\r\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\r\n              )\r\n              .reverse();\r\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\r\n            resMerge.message = res.message || resBase.message;\r\n            resMerge.messages = res.messages || resBase.messages;\r\n            resMerge.tools = (res.tools || [])\r\n              .concat(resBase.tools || [])\r\n              .filter(\r\n                (t, index, self) =>\r\n                  self.findIndex((t2) => t2.name === t.name) === index\r\n              );\r\n            return resMerge;\r\n          }),\r\n          catchError((err) => {\r\n            this.handleError(err, uri);\r\n            throw err;\r\n          })\r\n        );\r\n      }),\r\n      catchError((err2) => {\r\n        this.handleError(err2, uri);\r\n        throw err2;\r\n      })\r\n    );\r\n  }\r\n\r\n  loadContexts(permissions?: string[], hidden?: boolean) {\r\n    let request;\r\n    if (this.baseUrl) {\r\n      request = this.get(permissions, hidden);\r\n    } else {\r\n      request = this.getLocalContexts();\r\n    }\r\n    request.subscribe((contexts) => {\r\n      contexts.ours = this.importedContext.concat(contexts.ours);\r\n      this.contexts$.next(contexts);\r\n    });\r\n  }\r\n\r\n  loadDefaultContext() {\r\n    const loadFct = (direct = false) => {\r\n      if (!direct && this.baseUrl && this.authService.authenticated) {\r\n        this.getDefault().subscribe(\r\n          (_context: DetailedContext) => {\r\n            this.defaultContextUri = _context.uri;\r\n            this.addContextToList(_context);\r\n            this.setContext(_context);\r\n          },\r\n          () => {\r\n            this.defaultContextId$.next(undefined);\r\n            this.loadContext(this.defaultContextUri);\r\n          }\r\n        );\r\n      } else {\r\n        this.loadContext(this.defaultContextUri);\r\n      }\r\n    };\r\n\r\n    if (this.route && this.route.options.contextKey) {\r\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\r\n        const contextParam = params[this.route.options.contextKey as string];\r\n        let direct = false;\r\n        if (contextParam) {\r\n          this.defaultContextUri = contextParam;\r\n          direct = true;\r\n        }\r\n        loadFct(direct);\r\n      });\r\n    } else {\r\n      loadFct();\r\n    }\r\n  }\r\n\r\n  loadContext(uri: string) {\r\n    const context = this.context$.value;\r\n\r\n    if (context && context.uri === uri) {\r\n      return;\r\n    }\r\n\r\n    this.getContextByUri(uri)\r\n      .pipe(first())\r\n      .subscribe(\r\n        (_context: DetailedContext) => {\r\n          this.addContextToList(_context);\r\n          this.setContext(_context);\r\n        },\r\n        (err) => {\r\n          if (uri !== this.options.defaultContextUri) {\r\n            this.loadContext(this.options.defaultContextUri);\r\n          }\r\n        }\r\n      );\r\n  }\r\n\r\n  setContext(context: DetailedContext) {\r\n    this.handleContextMessage(context);\r\n    const currentContext = this.context$.value;\r\n    if (currentContext && context && context.id === currentContext.id) {\r\n      if (context.map.view.keepCurrentView === undefined) {\r\n        context.map.view.keepCurrentView = true;\r\n      }\r\n      this.context$.next(context);\r\n      return;\r\n    }\r\n\r\n    if (!context.map) {\r\n      context.map = { view: {} };\r\n    }\r\n\r\n    Object.assign(context.map.view, this.mapViewFromRoute);\r\n\r\n    this.context$.next(context);\r\n  }\r\n\r\n  loadEditedContext(uri: string) {\r\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\r\n      this.setEditedContext(_context);\r\n    });\r\n  }\r\n\r\n  setEditedContext(context: DetailedContext) {\r\n    this.editedContext$.next(context);\r\n  }\r\n\r\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\r\n    const view = igoMap.ol.getView();\r\n    const proj = view.getProjection().getCode();\r\n    const center: any = new olPoint(view.getCenter()).transform(\r\n      proj,\r\n      'EPSG:4326'\r\n    );\r\n\r\n    const context = {\r\n      uri: uuid(),\r\n      title: '',\r\n      scope: 'private',\r\n      map: {\r\n        view: {\r\n          center: center.getCoordinates(),\r\n          zoom: view.getZoom(),\r\n          projection: proj,\r\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\r\n        }\r\n      },\r\n      layers: [],\r\n      tools: []\r\n    };\r\n\r\n    let layers = [];\r\n    if (empty === true) {\r\n      layers = igoMap.layers$\r\n        .getValue()\r\n        .filter(\r\n          (lay) =>\r\n            lay.baseLayer === true ||\r\n            lay.options.id === 'searchPointerSummaryId'\r\n        )\r\n        .sort((a, b) => a.zIndex - b.zIndex);\r\n    } else {\r\n      layers = igoMap.layers$\r\n        .getValue()\r\n        .filter((lay) => !lay.id.includes('WfsWorkspaceTableDest'))\r\n        .sort((a, b) => a.zIndex - b.zIndex);\r\n    }\r\n\r\n    let i = 0;\r\n    for (const l of layers) {\r\n      const layer: any = l;\r\n      const opts = {\r\n        id: layer.options.id ? String(layer.options.id) : undefined,\r\n        layerOptions: {\r\n          title: layer.options.title,\r\n          zIndex: ++i,\r\n          visible: layer.visible,\r\n          security: layer.security\r\n        } as LayerOptions,\r\n        sourceOptions: {\r\n          type: layer.dataSource.options.type,\r\n          params: layer.dataSource.options.params,\r\n          url: layer.dataSource.options.url,\r\n          queryable: layer.queryable\r\n        }\r\n      };\r\n      if (opts.sourceOptions.type) {\r\n        context.layers.push(opts);\r\n      }\r\n    }\r\n\r\n    context.tools = this.tools.map((tool) => {\r\n      return { id: String(tool.id), global: tool.global };\r\n    });\r\n\r\n    return context;\r\n  }\r\n\r\n  getContextFromLayers(\r\n    igoMap: IgoMap,\r\n    layers: Layer[],\r\n    name: string,\r\n    keepCurrentView?: boolean\r\n  ): DetailedContext {\r\n    const currentContext = this.context$.getValue();\r\n    const view = igoMap.ol.getView();\r\n    const proj = view.getProjection().getCode();\r\n    const center: any = new olPoint(view.getCenter()).transform(\r\n      proj,\r\n      'EPSG:4326'\r\n    );\r\n\r\n    const context: DetailedContext = {\r\n      uri: name,\r\n      title: name,\r\n      map: {\r\n        view: {\r\n          center: center.getCoordinates(),\r\n          zoom: view.getZoom(),\r\n          projection: proj,\r\n          keepCurrentView\r\n        }\r\n      },\r\n      layers: [],\r\n      toolbar: [],\r\n      tools: [],\r\n      extraFeatures: []\r\n    };\r\n\r\n    const currentLayers = igoMap.layers$.getValue();\r\n    context.layers = currentLayers\r\n      .filter((l) => l.baseLayer)\r\n      .map((l) => {\r\n        return {\r\n          baseLayer: true,\r\n          sourceOptions: l.options.sourceOptions,\r\n          title: l.options.title,\r\n          visible: l.visible\r\n        };\r\n      });\r\n\r\n    layers.forEach((layer) => {\r\n      // Do not seem to work properly. layerFound is always undefined.\r\n      const layerFound = currentContext.layers.find((contextLayer) => {\r\n        const source = contextLayer.source;\r\n        return source && layer.id === source.id && !contextLayer.baseLayer;\r\n      });\r\n      if (layerFound) {\r\n        let layerFoundAs = layerFound as\r\n          | VectorLayerOptions\r\n          | VectorTileLayerOptions;\r\n        let layerStyle = layerFoundAs.style;\r\n        if (layerFoundAs.igoStyle?.styleByAttribute) {\r\n          layerStyle = undefined;\r\n        } else if (layerFoundAs.igoStyle?.clusterBaseStyle) {\r\n          layerStyle = undefined;\r\n          delete layerFound.sourceOptions[`source`];\r\n          delete layerFound.sourceOptions[`format`];\r\n        }\r\n        const opts = {\r\n          baseLayer: layerFound.baseLayer,\r\n          title: layer.options.title,\r\n          zIndex: layer.zIndex,\r\n          igoStyle: {\r\n            styleByAttribute: layerFoundAs.igoStyle?.styleByAttribute,\r\n            clusterBaseStyle: layerFoundAs.igoStyle?.clusterBaseStyle\r\n          },\r\n          style: layerStyle,\r\n          clusterParam: layerFound[`clusterParam`],\r\n          visible: layer.visible,\r\n          opacity: layer.opacity,\r\n          sourceOptions: layerFound.sourceOptions\r\n        };\r\n        context.layers.push(opts);\r\n      } else {\r\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\r\n          const catalogLayer = layer.options;\r\n          catalogLayer.zIndex = layer.zIndex;\r\n          (catalogLayer.visible = layer.visible),\r\n            (catalogLayer.opacity = layer.opacity);\r\n          delete catalogLayer.source;\r\n          context.layers.push(catalogLayer);\r\n        } else {\r\n          const extraFeatures = this.getExtraFeatures(layer);\r\n          extraFeatures.name = layer.options.title;\r\n          extraFeatures.opacity = layer.opacity;\r\n          extraFeatures.visible = layer.visible;\r\n          context.extraFeatures.push(extraFeatures);\r\n        }\r\n      }\r\n    });\r\n\r\n    context.toolbar = this.toolbar;\r\n    context.tools = this.tools;\r\n\r\n    return context;\r\n  }\r\n\r\n  private getExtraFeatures(layer: Layer): ExtraFeatures {\r\n    const writer = new GeoJSON();\r\n    let olFeatures: Feature<Geometry>[];\r\n    if (layer.ol.getSource() instanceof Cluster) {\r\n      const clusterSource = layer.ol.getSource() as Cluster;\r\n      olFeatures = clusterSource.getFeatures();\r\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\r\n        cluster.get('features')\r\n      );\r\n    } else {\r\n      const source = layer.ol.getSource() as olVectorSource;\r\n      olFeatures = source.getFeatures();\r\n    }\r\n    const cleanedOlFeatures = this.exportService.generateFeature(\r\n      olFeatures,\r\n      'GeoJSON',\r\n      '_featureStore'\r\n    );\r\n    const features = writer.writeFeatures(cleanedOlFeatures, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: 'EPSG:3857'\r\n    });\r\n    return JSON.parse(features);\r\n  }\r\n\r\n  setTools(tools: Tool[]) {\r\n    this.tools = tools;\r\n  }\r\n\r\n  setToolbar(toolbar: string[]) {\r\n    this.toolbar = toolbar;\r\n  }\r\n\r\n  private handleContextMessage(context: DetailedContext) {\r\n    if (\r\n      this.context$.value &&\r\n      context.uri &&\r\n      this.context$.value.uri !== context.uri\r\n    ) {\r\n      this.messageService.removeAllAreNotError();\r\n    }\r\n\r\n    context.messages = context.messages ? context.messages : [];\r\n    context.messages.push(context.message);\r\n    context.messages.map((message) => {\r\n      if (message) {\r\n        this.messageService.message(message as Message);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getContextByUri(uri: string): Observable<DetailedContext> {\r\n    if (this.baseUrl) {\r\n      let contextToLoad;\r\n      for (const key of Object.keys(this.contexts$.value)) {\r\n        contextToLoad = this.contexts$.value[key].find((c) => {\r\n          return c.uri === uri;\r\n        });\r\n        if (contextToLoad) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (contextToLoad && contextToLoad.imported) {\r\n        return of(contextToLoad);\r\n      }\r\n\r\n      // TODO : use always id or uri\r\n      const id = contextToLoad ? contextToLoad.id : uri;\r\n      return this.getDetails(id);\r\n    }\r\n\r\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\r\n      return currentContext.uri === uri && currentContext.imported === true;\r\n    });\r\n\r\n    if (importedContext) {\r\n      return of(importedContext);\r\n    } else {\r\n      return this.getLocalContext(uri);\r\n    }\r\n  }\r\n\r\n  getContextLayers(igoMap: IgoMap) {\r\n    const layers: Layer[] = [];\r\n    const mapLayers = igoMap.layers$.getValue();\r\n    mapLayers.forEach((layer) => {\r\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\r\n        layers.push(layer);\r\n      }\r\n    });\r\n    return layers;\r\n  }\r\n\r\n  private readParamsFromRoute() {\r\n    if (!this.route) {\r\n      return;\r\n    }\r\n\r\n    this.route.queryParams.subscribe((params) => {\r\n      const centerKey = this.route.options.centerKey;\r\n      if (centerKey && params[centerKey as string]) {\r\n        const centerParams = params[centerKey as string];\r\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\r\n      }\r\n\r\n      const projectionKey = this.route.options.projectionKey;\r\n      if (projectionKey && params[projectionKey as string]) {\r\n        const projectionParam = params[projectionKey as string];\r\n        this.mapViewFromRoute.projection = projectionParam;\r\n      }\r\n\r\n      const zoomKey = this.route.options.zoomKey;\r\n      if (zoomKey && params[zoomKey as string]) {\r\n        const zoomParam = params[zoomKey as string];\r\n        this.mapViewFromRoute.zoom = Number(zoomParam);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getPath(file: string) {\r\n    const basePath = this.options.basePath.replace(/\\/$/, '');\r\n\r\n    return `${basePath}/${file}`;\r\n  }\r\n\r\n  private handleError(\r\n    error: HttpErrorResponse,\r\n    uri: string,\r\n    permissionError?: boolean\r\n  ) {\r\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\r\n    const titleContext = context ? context.title : uri;\r\n    error.error.title = this.languageService.translate.instant(\r\n      'igo.context.contextManager.invalid.title'\r\n    );\r\n\r\n    error.error.message = this.languageService.translate.instant(\r\n      'igo.context.contextManager.invalid.text',\r\n      { value: titleContext }\r\n    );\r\n\r\n    error.error.toDisplay = true;\r\n\r\n    if (permissionError) {\r\n      error.error.title = this.languageService.translate.instant(\r\n        'igo.context.contextManager.errors.addPermissionTitle'\r\n      );\r\n      error.error.message = this.languageService.translate.instant(\r\n        'igo.context.contextManager.errors.addPermission'\r\n      );\r\n    }\r\n    this.messageService.error(\r\n      'igo.context.contextManager.errors.addPermission',\r\n      'igo.context.contextManager.errors.addPermissionTitle'\r\n    );\r\n  }\r\n\r\n  private handleContextsChange(keepCurrentContext = true) {\r\n    const context = this.context$.value;\r\n    const editedContext = this.editedContext$.value;\r\n    if (!context || context.uri === this.options.defaultContextUri) {\r\n      keepCurrentContext = false;\r\n    }\r\n    if (!keepCurrentContext || !this.findContext(context)) {\r\n      this.defaultContextUri = undefined;\r\n      this.loadDefaultContext();\r\n    } else {\r\n      this.getContextByUri(context.uri)\r\n        .pipe(first())\r\n        .subscribe((newContext: DetailedContext) => {\r\n          this.toolsChanged$.next(newContext);\r\n        });\r\n\r\n      if (this.baseUrl && this.authService.authenticated) {\r\n        this.getDefault().subscribe();\r\n      }\r\n    }\r\n    const editedFound = this.findContext(editedContext);\r\n    if (!editedFound || editedFound.permission !== 'write') {\r\n      this.setEditedContext(undefined);\r\n    }\r\n  }\r\n\r\n  private addContextToList(context: Context) {\r\n    const contextFound = this.findContext(context);\r\n    if (!contextFound) {\r\n      const contextSimplifie = {\r\n        id: context.id,\r\n        uri: context.uri,\r\n        title: context.title,\r\n        scope: context.scope,\r\n        permission: TypePermission[TypePermission.read]\r\n      };\r\n\r\n      if (this.contexts$.value && this.contexts$.value.public) {\r\n        this.contexts$.value.public.push(contextSimplifie);\r\n        this.contexts$.next(this.contexts$.value);\r\n      }\r\n    }\r\n  }\r\n\r\n  private findContext(context: Context) {\r\n    if (!context) {\r\n      return false;\r\n    }\r\n\r\n    const contexts = this.contexts$.value;\r\n    let found;\r\n    for (const key of Object.keys(contexts)) {\r\n      const value = contexts[key];\r\n      found = value.find(\r\n        (c) =>\r\n          (context.id && c.id === context.id) ||\r\n          (context.uri && c.uri === context.uri)\r\n      );\r\n      if (found) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n}\r\n","import { Directive, Input, OnDestroy, OnInit, Optional } from '@angular/core';\r\n\r\nimport { ConfigService, RouteService } from '@igo2/core';\r\nimport {\r\n  Layer,\r\n  LayerOptions,\r\n  LayerService,\r\n  MapBrowserComponent,\r\n  StyleListService,\r\n  StyleService\r\n} from '@igo2/geo';\r\nimport type { IgoMap } from '@igo2/geo';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { Subscription, merge } from 'rxjs';\r\nimport { buffer, debounceTime, filter, first } from 'rxjs/operators';\r\n\r\nimport {\r\n  addImportedFeaturesStyledToMap,\r\n  addImportedFeaturesToMap\r\n} from '../../context-import-export/shared/context-import.utils';\r\nimport { DetailedContext } from './context.interface';\r\nimport { ContextService } from './context.service';\r\n\r\n@Directive({\r\n  selector: '[igoLayerContext]'\r\n})\r\nexport class LayerContextDirective implements OnInit, OnDestroy {\r\n  private context$$: Subscription;\r\n  private queryParams: any;\r\n\r\n  private contextLayers: Layer[] = [];\r\n\r\n  @Input() removeLayersOnContextChange: boolean = true;\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    private component: MapBrowserComponent,\r\n    private contextService: ContextService,\r\n    private layerService: LayerService,\r\n    private configService: ConfigService,\r\n    private styleListService: StyleListService,\r\n    private styleService: StyleService,\r\n    @Optional() private route: RouteService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.context$$ = this.contextService.context$\r\n      .pipe(filter((context) => context !== undefined))\r\n      .subscribe((context) => this.handleContextChange(context));\r\n\r\n    if (\r\n      this.route &&\r\n      this.route.options.visibleOnLayersKey &&\r\n      this.route.options.visibleOffLayersKey &&\r\n      this.route.options.contextKey\r\n    ) {\r\n      this.route.queryParams\r\n        .pipe(first((params) => !ObjectUtils.isEmpty(params)))\r\n        .subscribe((params) => {\r\n          this.queryParams = params;\r\n        });\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.context$$.unsubscribe();\r\n  }\r\n\r\n  private handleContextChange(context: DetailedContext) {\r\n    if (context.layers === undefined) {\r\n      return;\r\n    }\r\n    if (this.removeLayersOnContextChange === true) {\r\n      this.map.removeAllLayers();\r\n    } else {\r\n      this.map.removeLayers(this.contextLayers);\r\n    }\r\n    this.contextLayers = [];\r\n\r\n    const layersAndIndex$ = merge(\r\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\r\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\r\n      })\r\n    );\r\n\r\n    layersAndIndex$\r\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\r\n      .subscribe((layers: Layer[]) => {\r\n        this.handleAddLayers(layers);\r\n\r\n        if (context.extraFeatures) {\r\n          context.extraFeatures.forEach((featureCollection) => {\r\n            const importExportOptions =\r\n              this.configService.getConfig('importExport');\r\n            if (!importExportOptions?.importWithStyle) {\r\n              addImportedFeaturesToMap(featureCollection, this.map);\r\n            } else {\r\n              addImportedFeaturesStyledToMap(\r\n                featureCollection,\r\n                this.map,\r\n                this.styleListService,\r\n                this.styleService\r\n              );\r\n            }\r\n          });\r\n        }\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncIdbLayers(context.uri)\r\n      .pipe(debounceTime(500))\r\n      .subscribe((layers: Layer[]) => this.handleAddLayers(layers));\r\n  }\r\n\r\n  private handleAddLayers(layers: Layer[]) {\r\n    layers = layers\r\n      .filter((layer: Layer) => layer !== undefined)\r\n      .map((layer) => {\r\n        layer.visible = this.computeLayerVisibilityFromUrl(layer);\r\n        layer.zIndex = layer.zIndex;\r\n\r\n        return layer;\r\n      });\r\n    this.contextLayers.concat(layers);\r\n    this.map.addLayers(layers);\r\n  }\r\n\r\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\r\n    const params = this.queryParams;\r\n    const currentContext = this.contextService.context$.value.uri;\r\n    const currentLayerid: string = layer.id;\r\n\r\n    let visible = layer.visible;\r\n    if (!params || !currentLayerid) {\r\n      return visible;\r\n    }\r\n\r\n    const contextParams = params[this.route.options.contextKey as string];\r\n    if (contextParams === currentContext || !contextParams) {\r\n      let visibleOnLayersParams = '';\r\n      let visibleOffLayersParams = '';\r\n      let visiblelayers: string[] = [];\r\n      let invisiblelayers: string[] = [];\r\n\r\n      if (\r\n        this.route.options.visibleOnLayersKey &&\r\n        params[this.route.options.visibleOnLayersKey as string]\r\n      ) {\r\n        visibleOnLayersParams =\r\n          params[this.route.options.visibleOnLayersKey as string];\r\n      }\r\n      if (\r\n        this.route.options.visibleOffLayersKey &&\r\n        params[this.route.options.visibleOffLayersKey as string]\r\n      ) {\r\n        visibleOffLayersParams =\r\n          params[this.route.options.visibleOffLayersKey as string];\r\n      }\r\n\r\n      /* This order is important because to control whichever\r\n       the order of * param. First whe open and close everything.*/\r\n      if (visibleOnLayersParams === '*') {\r\n        visible = true;\r\n      }\r\n      if (visibleOffLayersParams === '*') {\r\n        visible = false;\r\n      }\r\n\r\n      // After, managing named layer by id (context.json OR id from datasource)\r\n      visiblelayers = visibleOnLayersParams.split(',');\r\n      invisiblelayers = visibleOffLayersParams.split(',');\r\n      if (\r\n        visiblelayers.indexOf(currentLayerid) > -1 ||\r\n        visiblelayers.indexOf(currentLayerid.toString()) > -1\r\n      ) {\r\n        visible = true;\r\n      }\r\n      if (\r\n        invisiblelayers.indexOf(currentLayerid) > -1 ||\r\n        invisiblelayers.indexOf(currentLayerid.toString()) > -1\r\n      ) {\r\n        visible = false;\r\n      }\r\n    }\r\n\r\n    return visible;\r\n  }\r\n}\r\n","import { Directive, OnDestroy, OnInit } from '@angular/core';\r\n\r\nimport { MediaService } from '@igo2/core';\r\nimport {\r\n  MapBrowserComponent,\r\n  MapControlsOptions,\r\n  MapScaleLineOptions,\r\n  MapViewOptions\r\n} from '@igo2/geo';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { filter } from 'rxjs/operators';\r\n\r\nimport { ContextMapView, DetailedContext } from './context.interface';\r\nimport { ContextService } from './context.service';\r\n\r\n@Directive({\r\n  selector: '[igoMapContext]'\r\n})\r\nexport class MapContextDirective implements OnInit, OnDestroy {\r\n  private component: MapBrowserComponent;\r\n  private context$$: Subscription;\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    component: MapBrowserComponent,\r\n    private contextService: ContextService,\r\n    private mediaService: MediaService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.context$$ = this.contextService.context$\r\n      .pipe(filter((context) => context !== undefined))\r\n      .subscribe((context) => this.handleContextChange(context));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.context$$.unsubscribe();\r\n  }\r\n\r\n  private handleContextChange(context: DetailedContext) {\r\n    if (context.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    // This creates a new ol.Map when the context changes. Doing that\r\n    // allows the print tool to work properly even when the map's canvas\r\n    // has been tainted (CORS) with the layers of another context. This could\r\n    // have some side effects such as unbinding all listeners on the first map.\r\n    // A better solution would be to create a new map (preview) before\r\n    // printing and avoid the tainted canvas issue. This will come later so\r\n    // this snippet of code is kept here in case it takes too long becomes\r\n    // an issue\r\n\r\n    // const target = this.component.map.ol.getTarget();\r\n    // this.component.map.ol.setTarget(undefined);\r\n    // this.component.map.init();\r\n    // this.component.map.ol.setTarget(target);\r\n\r\n    const viewContext: ContextMapView = context.map.view;\r\n    if (\r\n      !this.component.view ||\r\n      viewContext.keepCurrentView !== true ||\r\n      context.map.view.projection !== this.map.projection\r\n    ) {\r\n      this.component.view = viewContext as MapViewOptions;\r\n    }\r\n    if (this.component.map.geolocationController) {\r\n      this.component.map.geolocationController.updateGeolocationOptions(\r\n        viewContext\r\n      );\r\n    }\r\n\r\n    const controlsContext: MapControlsOptions = context.map.controls;\r\n    if (!this.component.controls && controlsContext) {\r\n      if (this.mediaService.isMobile()) {\r\n        if (typeof controlsContext.scaleLine !== 'boolean') {\r\n          const scaleLineOption =\r\n            controlsContext.scaleLine as MapScaleLineOptions;\r\n          if (!scaleLineOption.minWidth) {\r\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\r\n            controlsContext.scaleLine = scaleLineOption;\r\n          }\r\n        }\r\n      }\r\n      this.component.controls = controlsContext;\r\n    }\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoAuthModule } from '@igo2/auth';\r\nimport {\r\n  IgoActionbarModule,\r\n  IgoCollapsibleModule,\r\n  IgoKeyValueModule,\r\n  IgoListModule,\r\n  IgoStopPropagationModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoContextImportExportModule } from '../context-import-export/context-import-export.module';\r\nimport { IgoContextMapButtonModule } from '../context-map-button/context-map-button.module';\r\nimport { ContextEditBindingDirective } from './context-edit/context-edit-binding.directive';\r\nimport { ContextEditComponent } from './context-edit/context-edit.component';\r\nimport { ContextFormComponent } from './context-form/context-form.component';\r\nimport { ContextItemComponent } from './context-item/context-item.component';\r\nimport { ContextListBindingDirective } from './context-list/context-list-binding.directive';\r\nimport { ContextListComponent } from './context-list/context-list.component';\r\nimport { ContextPermissionsBindingDirective } from './context-permissions/context-permissions-binding.directive';\r\nimport { ContextPermissionsComponent } from './context-permissions/context-permissions.component';\r\nimport { LayerContextDirective } from './shared/layer-context.directive';\r\nimport { MapContextDirective } from './shared/map-context.directive';\r\n\r\nconst CONTEXT_DIRECTIVES = [MapContextDirective, LayerContextDirective];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    MatListModule,\r\n    MatCheckboxModule,\r\n    MatRadioModule,\r\n    MatDialogModule,\r\n    MatMenuModule,\r\n    MatOptionModule,\r\n    MatAutocompleteModule,\r\n    IgoAuthModule,\r\n    IgoListModule,\r\n    IgoKeyValueModule,\r\n    IgoCollapsibleModule,\r\n    IgoStopPropagationModule,\r\n    IgoLanguageModule,\r\n    IgoContextImportExportModule,\r\n    IgoContextMapButtonModule,\r\n    IgoActionbarModule\r\n  ],\r\n  exports: [\r\n    ContextListComponent,\r\n    ContextListBindingDirective,\r\n    ContextItemComponent,\r\n    ContextFormComponent,\r\n    ContextEditComponent,\r\n    ContextEditBindingDirective,\r\n    ContextPermissionsComponent,\r\n    ContextPermissionsBindingDirective,\r\n\r\n    ...CONTEXT_DIRECTIVES\r\n  ],\r\n  declarations: [\r\n    ContextListComponent,\r\n    ContextListBindingDirective,\r\n    ContextItemComponent,\r\n    ContextFormComponent,\r\n    ContextEditComponent,\r\n    ContextEditBindingDirective,\r\n    ContextPermissionsComponent,\r\n    ContextPermissionsBindingDirective,\r\n\r\n    ...CONTEXT_DIRECTIVES\r\n  ]\r\n})\r\nexport class IgoContextManagerModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextManagerModule> {\r\n    return {\r\n      ngModule: IgoContextManagerModule\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoCustomHtmlModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { ShareMapApiComponent } from './share-map/share-map-api.component';\r\nimport { ShareMapUrlComponent } from './share-map/share-map-url.component';\r\nimport { ShareMapComponent } from './share-map/share-map.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatTabsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule,\r\n    IgoCustomHtmlModule\r\n  ],\r\n  exports: [ShareMapComponent, ShareMapUrlComponent, ShareMapApiComponent],\r\n  declarations: [ShareMapComponent, ShareMapUrlComponent, ShareMapApiComponent]\r\n})\r\nexport class IgoShareMapModule {\r\n  static forRoot(): ModuleWithProviders<IgoShareMapModule> {\r\n    return {\r\n      ngModule: IgoShareMapModule\r\n    };\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSidenavModule } from '@angular/material/sidenav';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoFlexibleModule, IgoPanelModule } from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoFeatureModule } from '@igo2/geo';\r\n\r\nimport { IgoContextManagerModule } from '../context-manager/context-manager.module';\r\nimport { SidenavComponent } from './sidenav.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSidenavModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule,\r\n    IgoPanelModule,\r\n    IgoFlexibleModule,\r\n    IgoFeatureModule,\r\n    IgoContextManagerModule\r\n  ],\r\n  exports: [SidenavComponent],\r\n  declarations: [SidenavComponent]\r\n})\r\nexport class IgoSidenavModule {\r\n  static forRoot(): ModuleWithProviders<IgoSidenavModule> {\r\n    return {\r\n      ngModule: IgoSidenavModule\r\n    };\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\n\r\nimport { IgoContextImportExportModule } from './context-import-export/context-import-export.module';\r\nimport { IgoContextManagerModule } from './context-manager/context-manager.module';\r\nimport { IgoContextMapButtonModule } from './context-map-button/context-map-button.module';\r\nimport { IgoShareMapModule } from './share-map/share-map.module';\r\nimport { IgoSidenavModule } from './sidenav/sidenav.module';\r\n\r\n@NgModule({\r\n  imports: [MatInputModule, MatFormFieldModule, MatMenuModule],\r\n  declarations: [],\r\n  exports: [\r\n    IgoContextImportExportModule,\r\n    IgoContextManagerModule,\r\n    IgoContextMapButtonModule,\r\n    IgoShareMapModule,\r\n    IgoSidenavModule\r\n  ]\r\n})\r\nexport class IgoContextModule {\r\n  static forRoot(): ModuleWithProviders<IgoContextModule> {\r\n    return {\r\n      ngModule: IgoContextModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid context');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\r\nimport { ExportNothingToExportError } from './context-export.errors';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ContextExportService {\r\n  export(res: DetailedContext): Observable<void> {\r\n    return this.exportAsync(res);\r\n  }\r\n\r\n  protected exportAsync(res: DetailedContext): Observable<void> {\r\n    const doExport = (observer: Observer<void>) => {\r\n      const nothingToExport = this.nothingToExport(res);\r\n      if (nothingToExport === true) {\r\n        observer.error(new ExportNothingToExportError());\r\n        return;\r\n      }\r\n      const contextJSON = JSON.stringify(res);\r\n      downloadContent(\r\n        contextJSON,\r\n        'text/json;charset=utf-8',\r\n        `${res.uri}.json`\r\n      );\r\n      observer.complete();\r\n    };\r\n    return new Observable(doExport);\r\n  }\r\n\r\n  protected nothingToExport(res: DetailedContext): boolean {\r\n    if (res.map === undefined) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n    super('Failed to read file');\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n    super('Nothing to import');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n    super('File is too large');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n    super('Invalid SRS definition');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\r\nimport {\r\n  ImportInvalidFileError,\r\n  ImportSizeError,\r\n  ImportUnreadableFileError\r\n} from './context-import.errors';\r\nimport { getFileExtension } from './context-import.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ContextImportService {\r\n  static allowedMimeTypes = ['application/json'];\r\n\r\n  static allowedExtensions = 'json';\r\n\r\n  private clientSideFileSizeMax: number;\r\n\r\n  constructor(private config: ConfigService) {\r\n    const configFileSizeMb = this.config.getConfig(\r\n      'importExport.clientSideFileSizeMaxMb'\r\n    );\r\n    this.clientSideFileSizeMax =\r\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\r\n  }\r\n\r\n  import(file: File): Observable<DetailedContext> {\r\n    return this.importAsync(file);\r\n  }\r\n\r\n  private getFileImporter(\r\n    file: File\r\n  ): (\r\n    file: File,\r\n    observer: Observer<DetailedContext>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) => void {\r\n    const extension = getFileExtension(file);\r\n    const mimeType = file.type;\r\n    const allowedMimeTypes = [...ContextImportService.allowedMimeTypes];\r\n    const allowedExtensions = ContextImportService.allowedExtensions;\r\n\r\n    if (\r\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\r\n      allowedExtensions.indexOf(extension) < 0\r\n    ) {\r\n      return undefined;\r\n    } else if (\r\n      mimeType === 'application/json' ||\r\n      extension === ContextImportService.allowedExtensions\r\n    ) {\r\n      return this.importFile;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private importAsync(file: File): Observable<DetailedContext> {\r\n    const doImport = (observer: Observer<DetailedContext>) => {\r\n      if (file.size >= this.clientSideFileSizeMax) {\r\n        observer.error(new ImportSizeError());\r\n        return;\r\n      }\r\n      const importer = this.getFileImporter(file);\r\n      if (importer === undefined) {\r\n        observer.error(new ImportInvalidFileError());\r\n        return;\r\n      }\r\n\r\n      importer.call(this, file, observer);\r\n    };\r\n\r\n    return new Observable(doImport);\r\n  }\r\n\r\n  private importFile(file: File, observer: Observer<DetailedContext>) {\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = (event: any) => {\r\n      try {\r\n        const context = this.parseContextFromFile(file, event.target.result);\r\n        observer.next(context);\r\n      } catch (e) {\r\n        observer.error(new ImportUnreadableFileError());\r\n      }\r\n\r\n      observer.complete();\r\n    };\r\n\r\n    reader.onerror = (evt) => {\r\n      observer.error(new ImportUnreadableFileError());\r\n    };\r\n\r\n    reader.readAsText(file, 'UTF-8');\r\n  }\r\n\r\n  private parseContextFromFile(file: File, data: string): DetailedContext {\r\n    const context: DetailedContext = JSON.parse(data);\r\n    return context;\r\n  }\r\n}\r\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n    [value]=\"activeImportExport\"\n    (change)=\"onImportExportChange($event)\"\n  >\n    <mat-button-toggle [value]=\"'import'\">\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"'export'\">\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<div *ngIf=\"activeImportExport === 'import'\">\n  <form class=\"igo-form\">\n    <div class=\"igo-form-button-group\">\n      <button\n        mat-raised-button\n        type=\"button\"\n        (click)=\"fileInput.click()\"\n        [disabled]=\"loading$ | async\"\n      >\n        {{ 'igo.geo.importExportForm.importButton' | translate }}\n      </button>\n      <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n      <input\n        #fileInput\n        type=\"file\"\n        [style.display]=\"'none'\"\n        (click)=\"fileInput.value = null\"\n        (change)=\"importFiles($event.target.files)\"\n      />\n    </div>\n  </form>\n  <section class=\"mat-typography\">\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\n    <ul>\n      <li>\n        {{\n          'igo.geo.importExportForm.importSizeMax'\n            | translate: { size: fileSizeMb }\n        }}\n      </li>\n    </ul>\n  </section>\n</div>\n\n<form\n  class=\"igo-form\"\n  *ngIf=\"activeImportExport === 'export'\"\n  [formGroup]=\"form\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field class=\"example-full-width\">\n      <mat-label>{{\n        'igo.context.contextImportExport.export.exportContextName' | translate\n      }}</mat-label>\n      <input formControlName=\"name\" matInput [value]=\"\" />\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.context.contextImportExport.export.exportPlaceHolder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"layers\" multiple>\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\n          {{\n            'igo.context.contextImportExport.export.exportSelectAll' | translate\n          }}\n        </mat-option>\n        <mat-divider></mat-divider>\n        <mat-option\n          *ngFor=\"let layer of userControlledLayerList\"\n          [value]=\"layer\"\n          >{{ layer.title }}</mat-option\n        >\n      </mat-select>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\"\n    >\n      {{ 'igo.geo.importExportForm.exportButton' | translate }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n</form>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\n\r\nimport { ConfigService, MessageService } from '@igo2/core';\r\nimport { Layer, VectorLayer } from '@igo2/geo';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\r\nimport { ContextService } from '../../context-manager/shared/context.service';\r\nimport { ContextExportService } from '../shared/context-export.service';\r\nimport { handleFileExportError } from '../shared/context-export.utils';\r\nimport { handleFileExportSuccess } from '../shared/context-export.utils';\r\nimport { ContextImportService } from '../shared/context-import.service';\r\nimport {\r\n  handleFileImportError,\r\n  handleFileImportSuccess\r\n} from '../shared/context-import.utils';\r\n\r\n@Component({\r\n  selector: 'igo-context-import-export',\r\n  templateUrl: './context-import-export.component.html',\r\n  styleUrls: ['./context-import-export.component.scss']\r\n})\r\nexport class ContextImportExportComponent implements OnInit, OnDestroy {\r\n  public form: UntypedFormGroup;\r\n  public layers: VectorLayer[];\r\n  public inputProj: string = 'EPSG:4326';\r\n  public loading$ = new BehaviorSubject(false);\r\n  public forceNaming = false;\r\n  public layerList: Layer[];\r\n  public userControlledLayerList: Layer[];\r\n  public res: DetailedContext;\r\n  private clientSideFileSizeMax: number;\r\n  public fileSizeMb: number;\r\n  public activeImportExport: string = 'import';\r\n\r\n  private layers$$: Subscription;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  constructor(\r\n    private contextImportService: ContextImportService,\r\n    private contextExportService: ContextExportService,\r\n    private messageService: MessageService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private config: ConfigService,\r\n    private contextService: ContextService\r\n  ) {\r\n    this.buildForm();\r\n  }\r\n\r\n  ngOnInit() {\r\n    const configFileSizeMb = this.config.getConfig(\r\n      'importExport.clientSideFileSizeMaxMb'\r\n    );\r\n    this.clientSideFileSizeMax =\r\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\r\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\r\n    this.layers$$ = this.map.layers$.subscribe(() => {\r\n      this.layerList = this.contextService.getContextLayers(this.map);\r\n      this.userControlledLayerList = this.layerList.filter(\r\n        (layer) => layer.showInLayerList\r\n      );\r\n    });\r\n  }\r\n\r\n  importFiles(files: File[]) {\r\n    this.loading$.next(true);\r\n    for (const file of files) {\r\n      this.contextImportService\r\n        .import(file)\r\n        .pipe(take(1))\r\n        .subscribe(\r\n          (context: DetailedContext) => this.onFileImportSuccess(file, context),\r\n          (error: Error) => this.onFileImportError(file, error),\r\n          () => {\r\n            this.loading$.next(false);\r\n          }\r\n        );\r\n    }\r\n  }\r\n\r\n  handleExportFormSubmit(contextOptions) {\r\n    this.loading$.next(true);\r\n    this.res = this.contextService.getContextFromLayers(\r\n      this.map,\r\n      contextOptions.layers,\r\n      contextOptions.name,\r\n      false\r\n    );\r\n    this.res.imported = true;\r\n    this.contextExportService\r\n      .export(this.res)\r\n      .pipe(take(1))\r\n      .subscribe(\r\n        () => {},\r\n        (error: Error) => this.onFileExportError(error),\r\n        () => {\r\n          this.onFileExportSuccess();\r\n          this.loading$.next(false);\r\n        }\r\n      );\r\n  }\r\n\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      layers: ['', [Validators.required]],\r\n      name: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  private onFileImportSuccess(file: File, context: DetailedContext) {\r\n    handleFileImportSuccess(\r\n      file,\r\n      context,\r\n      this.messageService,\r\n      this.contextService\r\n    );\r\n  }\r\n\r\n  private onFileImportError(file: File, error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\r\n  }\r\n\r\n  private onFileExportError(error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileExportError(error, this.messageService);\r\n  }\r\n\r\n  private onFileExportSuccess() {\r\n    handleFileExportSuccess(this.messageService);\r\n  }\r\n\r\n  selectAll(e) {\r\n    if (e._selected) {\r\n      this.form.controls.layers.setValue(this.userControlledLayerList);\r\n      e._selected = true;\r\n    }\r\n    if (e._selected === false) {\r\n      this.form.controls.layers.setValue([]);\r\n    }\r\n  }\r\n\r\n  onImportExportChange(event) {\r\n    this.activeImportExport = event.value;\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n}\r\n","import { MessageService } from '@igo2/core';\r\n\r\nimport { ExportNothingToExportError } from './context-export.errors';\r\n\r\nexport function handleFileExportError(\r\n  error: Error,\r\n  messageService: MessageService\r\n) {\r\n  if (error instanceof ExportNothingToExportError) {\r\n    this.handleNothingToExportError(messageService);\r\n    return;\r\n  }\r\n  messageService.error(\r\n    'igo.context.contextImportExport.export.failed.text',\r\n    'igo.context.contextImportExport.export.failed.title'\r\n  );\r\n}\r\n\r\nexport function handleFileExportSuccess(messageService: MessageService) {\r\n  messageService.success(\r\n    'igo.context.contextImportExport.export.success.text',\r\n    'igo.context.contextImportExport.export.success.title'\r\n  );\r\n}\r\n\r\nexport function handleNothingToExportError(messageService: MessageService) {\r\n  messageService.error(\r\n    'igo.context.contextImportExport.export.nothing.text',\r\n    'igo.context.contextImportExport.export.nothing.title'\r\n  );\r\n}\r\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-bookmark-dialog',\n  templateUrl: './bookmark-dialog.component.html'\n})\nexport class BookmarkDialogComponent {\n  public title: string;\n\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.context.bookmarkButton.dialog.title' | translate }}\n</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <mat-form-field>\n    <input\n      matInput\n      required\n      autocomplete=\"off\"\n      maxlength=\"128\"\n      [placeholder]=\"\n        'igo.context.bookmarkButton.dialog.placeholder' | translate\n      \"\n      [(ngModel)]=\"title\"\n    />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-button\n    color=\"primary\"\n    [disabled]=\"!title\"\n    (click)=\"dialogRef.close(title)\"\n  >\n    {{ 'igo.common.confirmDialog.confirmBtn' | translate }}\n  </button>\n  <button mat-button (click)=\"dialogRef.close(false)\">\n    {{ 'igo.common.confirmDialog.cancelBtn' | translate }}\n  </button>\n</div>\n","export enum ContextListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","<mat-list-item\n  class=\"mat-list-item\"\n  [ngClass]=\"{ 'mat-list-item-light': hidden }\"\n>\n  <button\n    *ngIf=\"auth.authenticated\"\n    matListItemAvatar\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"\n      auth.authenticated\n        ? ('igo.context.contextManager.favorite' | translate)\n        : ''\n    \"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon\n      *ngIf=\"!context.iconImage\"\n      svgIcon=\"{{\n        context.icon\n          ? context.icon\n          : context.scope === 'public'\n          ? 'earth'\n          : 'star'\n      }}\"\n    ></mat-icon>\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\" />\n  </button>\n  <button\n    matListItemAvatar\n    *ngIf=\"!auth.authenticated && showFavorite\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"'igo.context.contextManager.favorite' | translate\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon svgIcon=\"star\"></mat-icon>\n  </button>\n  <span matListItemTitle>{{ context.title }}</span>\n\n  <div\n    *ngIf=\"auth.authenticated\"\n    matListItemMeta\n    igoStopPropagation\n    class=\"igo-actions-container\"\n  >\n    <button\n      *ngIf=\"\n        collapsed &&\n        selected &&\n        (context.permission === typePermission[typePermission.write] ||\n          context.imported)\n      \"\n      class=\"save-button\"\n      mat-icon-button\n      [matTooltip]=\"'igo.context.contextManager.save' | translate\"\n      matTooltipShowDelay=\"500\"\n      [color]=\"color\"\n      (click)=\"save.emit(context)\"\n    >\n      <mat-icon svgIcon=\"content-save\"></mat-icon>\n    </button>\n\n    <div #actions class=\"igo-actions-expand-container\">\n      <button\n        *ngIf=\"canShare && !context.imported\"\n        mat-icon-button\n        [matTooltip]=\"\n          'igo.context.contextManager.managePermissions' | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"managePermissions.emit(context)\"\n      >\n        <mat-icon svgIcon=\"account-arrow-right\"></mat-icon>\n      </button>\n\n      <!--button\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.manageTools' | translate\"\n        [color]=\"color\"\n        (click)=\"manageTools.emit(context)\">\n        <mat-icon svgIcon=\"widgets\"></mat-icon>\n      </button-->\n\n      <button\n        *ngIf=\"!context.imported\"\n        class=\"clone-button\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"clone.emit(context)\"\n      >\n        <mat-icon svgIcon=\"content-copy\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] &&\n          !context.imported\n        \"\n        class=\"edit-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"edit.emit(context)\"\n      >\n        <mat-icon svgIcon=\"pencil\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"!context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"hide.emit(context)\"\n      >\n        <mat-icon svgIcon=\"eye\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"show.emit(context)\"\n      >\n        <mat-icon svgIcon=\"eye-off\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] ||\n          context.imported\n        \"\n        class=\"delete-button\"\n        mat-icon-button\n        color=\"warn\"\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"delete.emit(context)\"\n      >\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n\n    <button\n      class=\"actions-button\"\n      mat-icon-button\n      igoCollapse\n      [color]=\"color\"\n      [target]=\"actions\"\n      [collapsed]=\"collapsed\"\n      (click)=\"collapsed = !collapsed\"\n    >\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { StorageService } from '@igo2/core';\r\n\r\nimport { TypePermission } from '../shared/context.enum';\r\nimport { DetailedContext } from '../shared/context.interface';\r\n\r\n@Component({\r\n  selector: 'igo-context-item',\r\n  templateUrl: './context-item.component.html',\r\n  styleUrls: ['./context-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContextItemComponent {\r\n  public typePermission = TypePermission;\r\n  public color = 'primary';\r\n  public collapsed = true;\r\n\r\n  @Input() showFavorite: boolean = true;\r\n  @Input() context: DetailedContext;\r\n  @Input() default: boolean;\r\n  @Input() selected: boolean;\r\n\r\n  @Output() edit = new EventEmitter<DetailedContext>();\r\n  @Output() delete = new EventEmitter<DetailedContext>();\r\n  @Output() save = new EventEmitter<DetailedContext>();\r\n  @Output() clone = new EventEmitter<DetailedContext>();\r\n  @Output() hide = new EventEmitter<DetailedContext>();\r\n  @Output() show = new EventEmitter<DetailedContext>();\r\n  @Output() favorite = new EventEmitter<DetailedContext>();\r\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\r\n  @Output() manageTools = new EventEmitter<DetailedContext>();\r\n\r\n  get hidden(): boolean {\r\n    return this.context.hidden;\r\n  }\r\n\r\n  get canShare(): boolean {\r\n    return this.storageService.get('canShare') === true;\r\n  }\r\n\r\n  constructor(\r\n    public auth: AuthService,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  favoriteClick(context: DetailedContext) {\r\n    this.favorite.emit(context);\r\n  }\r\n}\r\n","<igo-list [navigation]=\"true\">\r\n  <div class=\"context-filter-container\">\r\n    <mat-form-field *ngIf=\"showFilter()\" floatLabel=\"always\">\r\n      <mat-label>{{\r\n        'igo.context.contextManager.filterPlaceHolder' | translate\r\n      }}</mat-label>\r\n      <input\r\n        matInput\r\n        type=\"text\"\r\n        [placeholder]=\"\r\n          'igo.context.contextManager.filterPlaceHolder' | translate\r\n        \"\r\n        [(ngModel)]=\"term\"\r\n      />\r\n      <button\r\n        mat-icon-button\r\n        matSuffix\r\n        class=\"clear-button\"\r\n        *ngIf=\"term.length\"\r\n        aria-label=\"Clear\"\r\n        color=\"warn\"\r\n        (click)=\"clearFilter()\"\r\n      >\r\n        <mat-icon svgIcon=\"close\"></mat-icon>\r\n      </button>\r\n    </mat-form-field>\r\n\r\n    <div class=\"actions-container\">\r\n      <button\r\n        *ngIf=\"!sortedAlpha\"\r\n        class=\"sort-alpha\"\r\n        mat-icon-button\r\n        [matTooltip]=\"\r\n          'igo.context.contextManager.sortAlphabetically' | translate\r\n        \"\r\n        matTooltipShowDelay=\"500\"\r\n        (click)=\"toggleSort(true)\"\r\n      >\r\n        <mat-icon\r\n          color=\"primary\"\r\n          svgIcon=\"sort-alphabetical-variant\"\r\n        ></mat-icon>\r\n      </button>\r\n      <button\r\n        *ngIf=\"sortedAlpha\"\r\n        class=\"sort-alpha\"\r\n        mat-icon-button\r\n        [matTooltip]=\"'igo.context.contextManager.sortContextOrder' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        (click)=\"toggleSort(false)\"\r\n      >\r\n        <mat-icon color=\"warn\" svgIcon=\"sort-variant-remove\"></mat-icon>\r\n      </button>\r\n\r\n      <igo-actionbar\r\n        *ngIf=\"auth.authenticated && contextConfigs\"\r\n        class=\"add-context-button\"\r\n        [iconColor]=\"color\"\r\n        [store]=\"actionStore\"\r\n        [withIcon]=\"true\"\r\n        icon=\"plus\"\r\n        [withTitle]=\"actionbarMode === 'overlay'\"\r\n        [horizontal]=\"false\"\r\n        [mode]=\"actionbarMode\"\r\n      >\r\n      </igo-actionbar>\r\n\r\n      <button\r\n        *ngIf=\"auth.authenticated && contextConfigs\"\r\n        class=\"users-filter\"\r\n        mat-icon-button\r\n        [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\r\n        matTooltipShowDelay=\"500\"\r\n        [matMenuTriggerFor]=\"accountMenu\"\r\n      >\r\n        <mat-icon color=\"primary\" svgIcon=\"filter-menu\"></mat-icon>\r\n      </button>\r\n      <mat-menu #accountMenu=\"matMenu\">\r\n        <ng-container *ngFor=\"let user of users\">\r\n          <span class=\"profilsMenu\">\r\n            <div mat-menu-item>\r\n              <mat-checkbox\r\n                [checked]=\"getPermission(user).checked\"\r\n                [indeterminate]=\"getPermission(user).indeterminate\"\r\n                (click)=\"$event.stopPropagation()\"\r\n                (change)=\"userSelection(user)\"\r\n              >\r\n              </mat-checkbox>\r\n            </div>\r\n            <button\r\n              *ngIf=\"user.childs\"\r\n              [matMenuTriggerFor]=\"subAccountMenu\"\r\n              mat-menu-item\r\n            >\r\n              {{ user.title }}\r\n            </button>\r\n            <button mat-menu-item *ngIf=\"!user.childs\">\r\n              {{ user.title }}\r\n            </button>\r\n          </span>\r\n\r\n          <mat-menu #subAccountMenu=\"matMenu\">\r\n            <div mat-menu-item>\r\n              <mat-checkbox\r\n                *ngFor=\"let child of user.childs\"\r\n                [checked]=\"getPermission(child).checked\"\r\n                (click)=\"$event.stopPropagation()\"\r\n                (change)=\"userSelection(child, user)\"\r\n              >\r\n                {{ child.title }}\r\n              </mat-checkbox>\r\n            </div>\r\n          </mat-menu>\r\n        </ng-container>\r\n\r\n        <span class=\"profilsMenu\">\r\n          <div mat-menu-item>\r\n            <mat-checkbox\r\n              [checked]=\"showHidden\"\r\n              (click)=\"$event.stopPropagation()\"\r\n              (change)=\"showHiddenContexts.emit()\"\r\n            >\r\n            </mat-checkbox>\r\n          </div>\r\n          <button mat-menu-item>\r\n            {{ 'igo.context.contextManager.showHidden' | translate }}\r\n          </button>\r\n        </span>\r\n      </mat-menu>\r\n    </div>\r\n  </div>\r\n\r\n  <ng-template ngFor let-groupContexts [ngForOf]=\"contexts$ | async | keyvalue\">\r\n    <igo-collapsible\r\n      *ngIf=\"groupContexts.value.length && auth.authenticated\"\r\n      [title]=\"titleMapping[groupContexts.key] | translate\"\r\n      [collapsed]=\"collapsed[titleMapping[groupContexts.key]]\"\r\n      (toggle)=\"collapsed[titleMapping[groupContexts.key]] = $event\"\r\n    >\r\n      <ng-template ngFor let-context [ngForOf]=\"groupContexts.value\">\r\n        <igo-context-item\r\n          igoListItem\r\n          color=\"accent\"\r\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\r\n          [context]=\"context\"\r\n          [default]=\"\r\n            context.id &&\r\n            this.defaultContextId &&\r\n            this.defaultContextId === context.id\r\n          \"\r\n          (edit)=\"edit.emit(context)\"\r\n          (delete)=\"delete.emit(context)\"\r\n          (clone)=\"clone.emit(context)\"\r\n          (save)=\"save.emit(context)\"\r\n          (hide)=\"hideContext(context)\"\r\n          (show)=\"showContext(context)\"\r\n          (favorite)=\"favorite.emit(context)\"\r\n          (manageTools)=\"manageTools.emit(context)\"\r\n          (managePermissions)=\"managePermissions.emit(context)\"\r\n          (select)=\"select.emit(context)\"\r\n          (unselect)=\"unselect.emit(context)\"\r\n        >\r\n        </igo-context-item>\r\n      </ng-template>\r\n    </igo-collapsible>\r\n\r\n    <ng-template\r\n      *ngIf=\"groupContexts.value.length && !auth.authenticated\"\r\n      ngFor\r\n      let-context\r\n      [ngForOf]=\"groupContexts.value\"\r\n    >\r\n      <igo-context-item\r\n        igoListItem\r\n        color=\"accent\"\r\n        [showFavorite]=\"\r\n          configService.getConfig('favoriteContext4NonAuthenticated')\r\n        \"\r\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\r\n        [context]=\"context\"\r\n        [default]=\"\r\n          contextConfigs\r\n            ? defaultContextId === context.id\r\n            : defaultContextId === context.uri\r\n        \"\r\n        (favorite)=\"favorite.emit(context)\"\r\n        (select)=\"select.emit(context)\"\r\n        (unselect)=\"unselect.emit(context)\"\r\n      >\r\n      </igo-context-item>\r\n    </ng-template>\r\n  </ng-template>\r\n</igo-list>\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ActionStore, ActionbarMode } from '@igo2/common';\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport {\r\n  BehaviorSubject,\r\n  EMPTY,\r\n  ReplaySubject,\r\n  Subscription,\r\n  timer\r\n} from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\nimport { debounce } from 'rxjs/operators';\r\n\r\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\r\nimport {\r\n  ContextProfils,\r\n  ContextServiceOptions,\r\n  ContextUserPermission,\r\n  ContextsList,\r\n  DetailedContext\r\n} from '../shared/context.interface';\r\nimport { ContextListControlsEnum } from './context-list.enum';\r\n\r\n@Component({\r\n  selector: 'igo-context-list',\r\n  templateUrl: './context-list.component.html',\r\n  styleUrls: ['./context-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContextListComponent implements OnInit, OnDestroy {\r\n  public contextConfigs: ContextServiceOptions;\r\n  private contextsInitial: ContextsList = { ours: [] };\r\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\r\n    this.contextsInitial\r\n  );\r\n\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  private change$$: Subscription;\r\n\r\n  @Input()\r\n  get contexts(): ContextsList {\r\n    return this._contexts;\r\n  }\r\n  set contexts(value: ContextsList) {\r\n    this._contexts = value;\r\n    this.cdRef.detectChanges();\r\n    this.next();\r\n  }\r\n  private _contexts: ContextsList = { ours: [] };\r\n\r\n  @Input()\r\n  get selectedContext(): DetailedContext {\r\n    return this._selectedContext;\r\n  }\r\n  set selectedContext(value: DetailedContext) {\r\n    this._selectedContext = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n  private _selectedContext: DetailedContext;\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get defaultContextId(): string {\r\n    return this.contextConfigs\r\n      ? this._defaultContextId\r\n      : (this.storageService.get('favorite.context.uri') as string) ||\r\n          this._defaultContextId;\r\n  }\r\n  set defaultContextId(value: string) {\r\n    this._defaultContextId = value;\r\n  }\r\n  private _defaultContextId: string;\r\n\r\n  public collapsed: { contextScope }[] = [];\r\n\r\n  @Output() select = new EventEmitter<DetailedContext>();\r\n  @Output() unselect = new EventEmitter<DetailedContext>();\r\n  @Output() edit = new EventEmitter<DetailedContext>();\r\n  @Output() delete = new EventEmitter<DetailedContext>();\r\n  @Output() save = new EventEmitter<DetailedContext>();\r\n  @Output() clone = new EventEmitter<DetailedContext>();\r\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\r\n  @Output() hide = new EventEmitter<DetailedContext>();\r\n  @Output() show = new EventEmitter<DetailedContext>();\r\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\r\n  @Output() favorite = new EventEmitter<DetailedContext>();\r\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\r\n  @Output() manageTools = new EventEmitter<DetailedContext>();\r\n  @Output() filterPermissionsChanged = new EventEmitter<\r\n    ContextUserPermission[]\r\n  >();\r\n\r\n  public titleMapping = {\r\n    ours: 'igo.context.contextManager.ourContexts',\r\n    shared: 'igo.context.contextManager.sharedContexts',\r\n    public: 'igo.context.contextManager.publicContexts'\r\n  };\r\n\r\n  public users: ContextProfils[];\r\n  public permissions: ContextUserPermission[] = [];\r\n\r\n  public actionStore = new ActionStore([]);\r\n  public actionbarMode = ActionbarMode.Overlay;\r\n\r\n  public color = 'primary';\r\n\r\n  public showHidden = false;\r\n\r\n  /**\r\n   * Context filter term\r\n   */\r\n  @Input()\r\n  set term(value: string) {\r\n    this._term = value;\r\n    this.next();\r\n  }\r\n  get term(): string {\r\n    return this._term;\r\n  }\r\n  public _term: string = '';\r\n\r\n  get sortedAlpha(): boolean {\r\n    return this._sortedAlpha;\r\n  }\r\n  set sortedAlpha(value: boolean) {\r\n    this._sortedAlpha = value;\r\n    this.next();\r\n  }\r\n  private _sortedAlpha: boolean = undefined;\r\n\r\n  public showContextFilter = ContextListControlsEnum.always;\r\n\r\n  public thresholdToFilter = 5;\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    public configService: ConfigService,\r\n    public auth: AuthService,\r\n    private dialog: MatDialog,\r\n    private languageService: LanguageService,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.contextConfigs = this.configService.getConfig('context');\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.change$$ = this.change$\r\n      .pipe(\r\n        debounce(() => {\r\n          return this.contexts.ours.length === 0 &&\r\n            this.contexts.public?.length === 0 &&\r\n            this.contexts.shared?.length === 0\r\n            ? EMPTY\r\n            : timer(50);\r\n        })\r\n      )\r\n      .subscribe(() => {\r\n        this.contexts$.next(this.filterContextsList(this.contexts));\r\n      });\r\n\r\n    this.actionStore.load([\r\n      {\r\n        id: 'emptyContext',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContext'\r\n        ),\r\n        icon: 'map-outline',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContextTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(true);\r\n        }\r\n      },\r\n      {\r\n        id: 'contextFromMap',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMap'\r\n        ),\r\n        icon: 'map-check',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMapTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(false);\r\n        }\r\n      }\r\n    ]);\r\n  }\r\n\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n  private filterContextsList(contexts: ContextsList) {\r\n    if (this.term === '') {\r\n      if (this.sortedAlpha) {\r\n        contexts = this.sortContextsList(contexts);\r\n      }\r\n      return contexts;\r\n    } else {\r\n      const ours = contexts.ours.filter((context) => {\r\n        const filterNormalized = this.term\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const contextTitleNormalized = context.title\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        return contextTitleNormalized.includes(filterNormalized);\r\n      });\r\n\r\n      let updateContexts: ContextsList = {\r\n        ours\r\n      };\r\n\r\n      if (this.contexts.public) {\r\n        const publics = contexts.public.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.public = publics;\r\n      }\r\n\r\n      if (this.contexts.shared) {\r\n        const shared = contexts.shared.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.shared = shared;\r\n      }\r\n\r\n      if (this.sortedAlpha) {\r\n        updateContexts = this.sortContextsList(updateContexts);\r\n      }\r\n      return updateContexts;\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n\r\n  public showFilter() {\r\n    switch (this.showContextFilter) {\r\n      case ContextListControlsEnum.always:\r\n        return true;\r\n      case ContextListControlsEnum.never:\r\n        return false;\r\n      default:\r\n        let totalLength = this.contexts.ours.length;\r\n        this.contexts.public\r\n          ? (totalLength += this.contexts.public.length)\r\n          : (totalLength += 0);\r\n        this.contexts.shared\r\n          ? (totalLength += this.contexts.shared.length)\r\n          : (totalLength += 0);\r\n        if (totalLength >= this.thresholdToFilter) {\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  }\r\n\r\n  sortContextsList(contexts: ContextsList) {\r\n    if (contexts) {\r\n      const contextsList = JSON.parse(JSON.stringify(contexts));\r\n      contextsList.ours.sort((a, b) => {\r\n        if (this.normalize(a.title) < this.normalize(b.title)) {\r\n          return -1;\r\n        }\r\n        if (this.normalize(a.title) > this.normalize(b.title)) {\r\n          return 1;\r\n        }\r\n        return 0;\r\n      });\r\n\r\n      if (contextsList.shared) {\r\n        contextsList.shared.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      } else if (contextsList.public) {\r\n        contextsList.public.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      }\r\n      return contextsList;\r\n    }\r\n  }\r\n\r\n  normalize(str: string) {\r\n    return str\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .toLowerCase();\r\n  }\r\n\r\n  toggleSort(sortAlpha: boolean) {\r\n    this.sortedAlpha = sortAlpha;\r\n  }\r\n\r\n  clearFilter() {\r\n    this.term = '';\r\n  }\r\n\r\n  createContext(empty?: boolean) {\r\n    this.dialog\r\n      .open(BookmarkDialogComponent, { disableClose: false })\r\n      .afterClosed()\r\n      .pipe(take(1))\r\n      .subscribe((title: string) => {\r\n        if (title) {\r\n          this.create.emit({ title, empty });\r\n        }\r\n      });\r\n  }\r\n\r\n  getPermission(user?): ContextUserPermission {\r\n    if (user) {\r\n      const permission = this.permissions.find((p) => p.name === user.name);\r\n      return permission;\r\n    }\r\n  }\r\n\r\n  userSelection(user, parent?) {\r\n    const permission = this.getPermission(user);\r\n    if (permission) {\r\n      permission.checked = !permission.checked;\r\n      this.storageService.set(\r\n        'contexts.permissions.' + permission.name,\r\n        permission.checked\r\n      );\r\n      permission.indeterminate = false;\r\n    }\r\n\r\n    if (parent) {\r\n      let indeterminate = false;\r\n\r\n      for (const c of parent.childs) {\r\n        const cPermission = this.getPermission(c);\r\n        if (cPermission.checked !== permission.checked) {\r\n          indeterminate = true;\r\n          break;\r\n        }\r\n      }\r\n      const parentPermission = this.getPermission(parent);\r\n      if (parentPermission) {\r\n        parentPermission.checked = permission.checked;\r\n        this.storageService.set(\r\n          'contexts.permissions.' + parentPermission.name,\r\n          permission.checked\r\n        );\r\n        parentPermission.indeterminate = indeterminate;\r\n      }\r\n    }\r\n\r\n    if (user.childs) {\r\n      for (const c of user.childs) {\r\n        const childrenPermission = this.getPermission(c);\r\n        if (\r\n          childrenPermission &&\r\n          childrenPermission.checked !== permission.checked\r\n        ) {\r\n          childrenPermission.checked = permission.checked;\r\n          this.storageService.set(\r\n            'contexts.permissions.' + childrenPermission.name,\r\n            permission.checked\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    this.filterPermissionsChanged.emit(this.permissions);\r\n  }\r\n\r\n  hideContext(context: DetailedContext) {\r\n    context.hidden = true;\r\n    if (!this.showHidden) {\r\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\r\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\r\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\r\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\r\n      this.contexts = contexts;\r\n    }\r\n    this.hide.emit(context);\r\n  }\r\n\r\n  showContext(context: DetailedContext) {\r\n    context.hidden = false;\r\n    this.show.emit(context);\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectorRef,\r\n  Directive,\r\n  HostListener,\r\n  OnDestroy,\r\n  OnInit,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ConfirmDialogService } from '@igo2/common';\r\nimport { LanguageService, MessageService, StorageService } from '@igo2/core';\r\nimport { MapService } from '@igo2/geo';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport {\r\n  Context,\r\n  ContextUserPermission,\r\n  ContextsList,\r\n  DetailedContext\r\n} from '../shared/context.interface';\r\nimport { ContextService } from '../shared/context.service';\r\nimport { ContextListComponent } from './context-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoContextListBinding]'\r\n})\r\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\r\n  private component: ContextListComponent;\r\n  private contexts$$: Subscription;\r\n  private selectedContext$$: Subscription;\r\n  private defaultContextId$$: Subscription;\r\n  private previousMessageId;\r\n\r\n  @HostListener('select', ['$event'])\r\n  onSelect(context: Context) {\r\n    this.contextService.loadContext(context.uri);\r\n  }\r\n\r\n  @HostListener('edit', ['$event'])\r\n  onEdit(context: Context) {\r\n    this.contextService.loadEditedContext(context.uri);\r\n  }\r\n\r\n  @HostListener('save', ['$event'])\r\n  onSave(context: Context) {\r\n    const map = this.mapService.getMap();\r\n    const contextFromMap = this.contextService.getContextFromMap(map);\r\n\r\n    const msgSuccess = () => {\r\n      this.messageService.success(\r\n        'igo.context.contextManager.dialog.saveMsg',\r\n        'igo.context.contextManager.dialog.saveTitle',\r\n        undefined,\r\n        {\r\n          value: context.title\r\n        }\r\n      );\r\n    };\r\n\r\n    if (context.imported) {\r\n      contextFromMap.title = context.title;\r\n      this.contextService.delete(context.id, true);\r\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\r\n        this.contextService.loadContext(contextCreated.uri);\r\n        msgSuccess();\r\n      });\r\n      return;\r\n    }\r\n\r\n    const changes: any = {\r\n      layers: contextFromMap.layers,\r\n      map: {\r\n        view: contextFromMap.map.view\r\n      }\r\n    };\r\n\r\n    this.contextService.update(context.id, changes).subscribe(() => {\r\n      msgSuccess();\r\n    });\r\n  }\r\n\r\n  @HostListener('favorite', ['$event'])\r\n  onFavorite(context: Context) {\r\n    if (!context.id) {\r\n      context.id = context.uri;\r\n    }\r\n    this.contextService.setDefault(context.id).subscribe(() => {\r\n      if (this.previousMessageId) {\r\n        this.messageService.remove(this.previousMessageId);\r\n      }\r\n      this.contextService.defaultContextId$.next(context.id);\r\n      const messageObj = this.messageService.success(\r\n        'igo.context.contextManager.dialog.favoriteMsg',\r\n        'igo.context.contextManager.dialog.favoriteTitle',\r\n        undefined,\r\n        {\r\n          value: context.title\r\n        }\r\n      );\r\n      this.previousMessageId = messageObj.toastId;\r\n      this.cdRef.detectChanges();\r\n    });\r\n  }\r\n\r\n  @HostListener('manageTools', ['$event'])\r\n  onManageTools(context: Context) {\r\n    this.contextService.loadEditedContext(context.uri);\r\n  }\r\n\r\n  @HostListener('managePermissions', ['$event'])\r\n  onManagePermissions(context: Context) {\r\n    this.contextService.loadEditedContext(context.uri);\r\n  }\r\n\r\n  @HostListener('delete', ['$event'])\r\n  onDelete(context: Context) {\r\n    const translate = this.languageService.translate;\r\n    this.confirmDialogService\r\n      .open(\r\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\r\n      )\r\n      .subscribe((confirm) => {\r\n        if (confirm) {\r\n          this.contextService\r\n            .delete(context.id, context.imported)\r\n            .subscribe(() => {\r\n              this.messageService.info(\r\n                'igo.context.contextManager.dialog.deleteMsg',\r\n                'igo.context.contextManager.dialog.deleteTitle',\r\n                undefined,\r\n                { value: context.title }\r\n              );\r\n            });\r\n        }\r\n      });\r\n  }\r\n\r\n  @HostListener('clone', ['$event'])\r\n  onClone(context: DetailedContext) {\r\n    const properties = {\r\n      title: context.title + '-copy',\r\n      uri: context.uri + '-copy'\r\n    };\r\n    this.contextService.clone(context.id, properties).subscribe(() => {\r\n      this.messageService.success(\r\n        'igo.context.contextManager.dialog.cloneMsg',\r\n        'igo.context.contextManager.dialog.cloneTitle',\r\n        undefined,\r\n        { value: context.title }\r\n      );\r\n    });\r\n  }\r\n\r\n  @HostListener('create', ['$event'])\r\n  onCreate(opts: { title: string; empty: boolean }) {\r\n    const { title, empty } = opts;\r\n    const context = this.contextService.getContextFromMap(\r\n      this.component.map,\r\n      empty\r\n    );\r\n    context.title = title;\r\n    this.contextService.create(context).subscribe(() => {\r\n      this.messageService.success(\r\n        'igo.context.bookmarkButton.dialog.createMsg',\r\n        'igo.context.bookmarkButton.dialog.createTitle',\r\n        undefined,\r\n        { value: context.title }\r\n      );\r\n      this.contextService.loadContext(context.uri);\r\n    });\r\n  }\r\n\r\n  @HostListener('filterPermissionsChanged')\r\n  loadContexts() {\r\n    const permissions = ['none'];\r\n    for (const p of this.component.permissions) {\r\n      if (p.checked === true || p.indeterminate === true) {\r\n        permissions.push(p.name);\r\n      }\r\n    }\r\n    this.component.showHidden\r\n      ? this.contextService.loadContexts(permissions, true)\r\n      : this.contextService.loadContexts(permissions, false);\r\n  }\r\n\r\n  @HostListener('showHiddenContexts')\r\n  showHiddenContexts() {\r\n    this.component.showHidden = !this.component.showHidden;\r\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\r\n    this.loadContexts();\r\n  }\r\n\r\n  @HostListener('show', ['$event'])\r\n  onShowContext(context: DetailedContext) {\r\n    this.contextService.showContext(context.id).subscribe();\r\n  }\r\n\r\n  @HostListener('hide', ['$event'])\r\n  onHideContext(context: DetailedContext) {\r\n    this.contextService.hideContext(context.id).subscribe();\r\n  }\r\n\r\n  constructor(\r\n    @Self() component: ContextListComponent,\r\n    private contextService: ContextService,\r\n    private mapService: MapService,\r\n    private languageService: LanguageService,\r\n    private confirmDialogService: ConfirmDialogService,\r\n    private messageService: MessageService,\r\n    private auth: AuthService,\r\n    private storageService: StorageService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input contexts\r\n    this.component.contexts = { ours: [] };\r\n    this.component.showHidden = this.storageService.get(\r\n      'contexts.showHidden'\r\n    ) as boolean;\r\n\r\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\r\n      this.handleContextsChange(contexts)\r\n    );\r\n\r\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\r\n      (id) => {\r\n        this.component.defaultContextId = id;\r\n      }\r\n    );\r\n    const storedContextUri = this.storageService.get(\r\n      'favorite.context.uri'\r\n    ) as string;\r\n    if (storedContextUri && !this.auth.authenticated) {\r\n      this.contextService.defaultContextId$.next(storedContextUri);\r\n    }\r\n\r\n    // See feature-list.component for an explanation about the debounce time\r\n    this.selectedContext$$ = this.contextService.context$\r\n      .pipe(debounceTime(100))\r\n      .subscribe((context) => (this.component.selectedContext = context));\r\n\r\n    this.auth.authenticate$.subscribe((authenticate) => {\r\n      if (authenticate) {\r\n        this.contextService.getProfilByUser().subscribe((profils) => {\r\n          this.component.users = profils;\r\n          this.component.permissions = [];\r\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\r\n            acc = acc.concat(cur);\r\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\r\n            return acc;\r\n          }, []);\r\n\r\n          for (const user of profilsAcc) {\r\n            const permission: ContextUserPermission = {\r\n              name: user.name,\r\n              checked: this.storageService.get(\r\n                'contexts.permissions.' + user.name\r\n              ) as boolean\r\n            };\r\n            if (permission.checked === null) {\r\n              permission.checked = true;\r\n            }\r\n            this.component.permissions.push(permission);\r\n          }\r\n\r\n          const permissions = ['none'];\r\n          for (const p of this.component.permissions) {\r\n            if (p.checked === true || p.indeterminate === true) {\r\n              permissions.push(p.name);\r\n            }\r\n          }\r\n\r\n          this.component.showHidden\r\n            ? this.contextService.loadContexts(permissions, true)\r\n            : this.contextService.loadContexts(permissions, false);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.contexts$$.unsubscribe();\r\n    this.selectedContext$$.unsubscribe();\r\n    this.defaultContextId$$.unsubscribe();\r\n  }\r\n\r\n  private handleContextsChange(contexts: ContextsList) {\r\n    this.component.contexts = contexts;\r\n  }\r\n}\r\n","<form\n  class=\"igo-form\"\n  [formGroup]=\"form\"\n  (ngSubmit)=\"handleFormSubmit(form.value)\"\n>\n  <mat-form-field class=\"full-width\">\n    <input\n      matInput\n      required\n      maxlength=\"128\"\n      [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\n      formControlName=\"title\"\n    />\n    <mat-error>\n      {{ 'igo.context.contextManager.form.titleRequired' | translate }}\n    </mat-error>\n  </mat-form-field>\n\n  <mat-form-field id=\"uriInput\" class=\"full-width\">\n    <span *ngIf=\"prefix\" class=\"prefix\">{{ prefix }}-</span>\n    <span class=\"fieldWrapper\">\n      <input\n        matInput\n        maxlength=\"64\"\n        floatLabel=\"always\"\n        [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\n        formControlName=\"uri\"\n      />\n    </span>\n  </mat-form-field>\n\n  <button\n    id=\"copyButton\"\n    type=\"button\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.context.contextManager.form.copy' | translate\"\n    color=\"primary\"\n    (click)=\"copyTextToClipboard()\"\n  >\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"submit\"\n      [disabled]=\"!form.valid || disabled\"\n    >\n      {{ 'igo.context.contextManager.form.edit' | translate }}\n    </button>\n  </div>\n</form>\n","import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\r\nimport { UntypedFormBuilder, UntypedFormGroup } from '@angular/forms';\r\n\r\nimport { MessageService } from '@igo2/core';\r\nimport { Clipboard, ObjectUtils } from '@igo2/utils';\r\n\r\nimport { Context } from '../shared/context.interface';\r\n\r\n@Component({\r\n  selector: 'igo-context-form',\r\n  templateUrl: './context-form.component.html',\r\n  styleUrls: ['./context-form.component.scss']\r\n})\r\nexport class ContextFormComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n  public prefix: string;\r\n\r\n  @Input()\r\n  get btnSubmitText(): string {\r\n    return this._btnSubmitText;\r\n  }\r\n  set btnSubmitText(value: string) {\r\n    this._btnSubmitText = value;\r\n  }\r\n  private _btnSubmitText: string;\r\n\r\n  @Input()\r\n  get context(): Context {\r\n    return this._context;\r\n  }\r\n  set context(value: Context) {\r\n    this._context = value;\r\n    this.buildForm();\r\n  }\r\n  private _context: Context;\r\n\r\n  @Input()\r\n  get disabled(): boolean {\r\n    return this._disabled;\r\n  }\r\n  set disabled(value: boolean) {\r\n    this._disabled = value;\r\n  }\r\n  private _disabled = false;\r\n\r\n  // TODO: replace any by ContextOptions or Context\r\n  @Output() submitForm: EventEmitter<any> = new EventEmitter();\r\n  @Output() clone: EventEmitter<any> = new EventEmitter();\r\n  @Output() delete: EventEmitter<any> = new EventEmitter();\r\n\r\n  constructor(\r\n    private formBuilder: UntypedFormBuilder,\r\n    private messageService: MessageService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.buildForm();\r\n  }\r\n\r\n  public handleFormSubmit(value) {\r\n    let inputs = Object.assign({}, value);\r\n    inputs = ObjectUtils.removeNull(inputs);\r\n    inputs.uri = inputs.uri.replace(' ', '');\r\n    if (inputs.uri) {\r\n      inputs.uri = this.prefix + '-' + inputs.uri;\r\n    } else {\r\n      inputs.uri = this.prefix;\r\n    }\r\n    this.submitForm.emit(inputs);\r\n  }\r\n\r\n  public copyTextToClipboard() {\r\n    const text = this.prefix + '-' + this.form.value.uri.replace(' ', '');\r\n    const successful = Clipboard.copy(text);\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.context.contextManager.dialog.copyMsg',\r\n        'igo.context.contextManager.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  private buildForm(): void {\r\n    const context: any = this.context || {};\r\n\r\n    const uriSplit = context.uri.split('-');\r\n    this.prefix = uriSplit.shift();\r\n    const uri = uriSplit.join('-');\r\n\r\n    this.form = this.formBuilder.group({\r\n      title: [context.title],\r\n      uri: [uri || ' ']\r\n    });\r\n  }\r\n}\r\n","<igo-context-form\n  *ngIf=\"context\"\n  [btnSubmitText]=\"'igo.context.contextManager.save' | translate\"\n  [context]=\"context\"\n  (submitForm)=\"submitForm.emit($event)\"\n>\n</igo-context-form>\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  Output\r\n} from '@angular/core';\r\n\r\nimport { Context } from '../shared/context.interface';\r\n\r\n@Component({\r\n  selector: 'igo-context-edit',\r\n  templateUrl: './context-edit.component.html'\r\n})\r\nexport class ContextEditComponent {\r\n  @Input()\r\n  get context(): Context {\r\n    return this._context;\r\n  }\r\n  set context(value: Context) {\r\n    this._context = value;\r\n    this.refresh();\r\n  }\r\n  private _context: Context;\r\n\r\n  @Output() submitForm: EventEmitter<Context> = new EventEmitter();\r\n\r\n  constructor(private cd: ChangeDetectorRef) {}\r\n\r\n  refresh() {\r\n    this.cd.detectChanges();\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  EventEmitter,\r\n  HostListener,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { MessageService } from '@igo2/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { Context, DetailedContext } from '../shared/context.interface';\r\nimport { ContextService } from '../shared/context.service';\r\nimport { ContextEditComponent } from './context-edit.component';\r\n\r\n@Directive({\r\n  selector: '[igoContextEditBinding]'\r\n})\r\nexport class ContextEditBindingDirective implements OnInit, OnDestroy {\r\n  private component: ContextEditComponent;\r\n  private editedContext$$: Subscription;\r\n\r\n  @Output() submitSuccessed: EventEmitter<Context> = new EventEmitter();\r\n\r\n  @HostListener('submitForm', ['$event'])\r\n  onEdit(context: Context) {\r\n    const id = this.component.context.id;\r\n    this.contextService.update(id, context).subscribe(() => {\r\n      this.messageService.success(\r\n        'igo.context.contextManager.dialog.saveMsg',\r\n        'igo.context.contextManager.dialog.saveTitle',\r\n        undefined,\r\n        {\r\n          value: context.title || this.component.context.title\r\n        }\r\n      );\r\n      this.contextService.setEditedContext(undefined);\r\n      this.submitSuccessed.emit(context);\r\n    });\r\n  }\r\n\r\n  constructor(\r\n    @Self() component: ContextEditComponent,\r\n    private contextService: ContextService,\r\n    private messageService: MessageService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\r\n      (context) => this.handleEditedContextChange(context)\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.editedContext$$.unsubscribe();\r\n  }\r\n\r\n  private handleEditedContextChange(context: DetailedContext) {\r\n    this.component.context = context;\r\n  }\r\n}\r\n","<div *ngIf=\"context\">\n  <div *ngIf=\"!canWrite\" class=\"scopeForm\">\n    <h4>{{ 'igo.context.permission.readOnlyTitle' | translate }}</h4>\n    <p>{{ 'igo.context.permission.readOnlyMsg' | translate }}</p>\n  </div>\n\n  <div *ngIf=\"canWrite\" class=\"scopeForm\">\n    <mat-radio-group\n      [(ngModel)]=\"context.scope\"\n      (change)=\"scopeChanged.emit(context)\"\n    >\n      <mat-radio-button value=\"private\">\n        {{ 'igo.context.permission.scope.private' | translate }}\n      </mat-radio-button>\n      <mat-radio-button value=\"protected\">\n        {{ 'igo.context.permission.scope.shared' | translate }}\n      </mat-radio-button>\n      <mat-radio-button *ngIf=\"authService.isAdmin\" value=\"public\">\n        {{ 'igo.context.permission.scope.public' | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </div>\n\n  <form\n    *ngIf=\"context.scope !== 'private' && canWrite\"\n    [formGroup]=\"form\"\n    (ngSubmit)=\"handleFormSubmit(form.value)\"\n  >\n    <mat-form-field class=\"full-width\">\n      <input\n        matInput\n        required\n        [placeholder]=\"'igo.context.permission.user' | translate\"\n        [formControl]=\"formControl\"\n        [matAutocomplete]=\"auto\"\n      />\n      <mat-autocomplete\n        #auto=\"matAutocomplete\"\n        (optionSelected)=\"onProfilSelected($event.option.value)\"\n        [displayWith]=\"displayFn\"\n      >\n        <mat-option *ngFor=\"let profil of this.profils\" [value]=\"profil\">\n          {{ profil.title }}<br />\n          <small class=\"mat-typography\">{{ profil.name }}</small>\n        </mat-option>\n      </mat-autocomplete>\n      <mat-error>\n        {{ 'igo.context.permission.profilRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n\n    <mat-radio-group formControlName=\"typePermission\">\n      <mat-radio-button value=\"read\">\n        {{ 'igo.context.permission.read' | translate }}\n      </mat-radio-button>\n      <mat-radio-button value=\"write\">\n        {{ 'igo.context.permission.write' | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n\n    <div class=\"igo-form-button-group\">\n      <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid\">\n        {{ 'igo.context.permission.addBtn' | translate }}\n      </button>\n    </div>\n  </form>\n\n  <igo-list *ngIf=\"permissions && context.scope !== 'private'\">\n    <ng-template ngFor let-groupPermissions [ngForOf]=\"permissions | keyvalue\">\n      <igo-collapsible\n        *ngIf=\"groupPermissions.value.length\"\n        [title]=\"'igo.context.permission.' + groupPermissions.key | translate\"\n      >\n        <ng-template ngFor let-permission [ngForOf]=\"groupPermissions.value\">\n          <mat-list-item>\n            <mat-icon matListItemIcon svgIcon=\"account-outline\"></mat-icon>\n            <h4 matListItemTitle>\n              {{ permission.profilTitle }}\n              <small class=\"mat-typography\">{{ permission.profil }}</small>\n            </h4>\n\n            <div igoStopPropagation class=\"igo-actions-container\">\n              <button\n                *ngIf=\"\n                  canWrite ||\n                  permission.profil === authService.decodeToken().user.sourceId\n                \"\n                mat-icon-button\n                [matTooltip]=\"'igo.context.permission.delete' | translate\"\n                matTooltipShowDelay=\"500\"\n                color=\"warn\"\n                (click)=\"removePermission.emit(permission)\"\n              >\n                <mat-icon svgIcon=\"delete\"></mat-icon>\n              </button>\n            </div>\n          </mat-list-item>\n        </ng-template>\n      </igo-collapsible>\n    </ng-template>\n  </igo-list>\n</div>\n","import { HttpClient } from '@angular/common/http';\r\nimport {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormControl,\r\n  UntypedFormGroup\r\n} from '@angular/forms';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { TypePermission } from '../shared/context.enum';\r\nimport {\r\n  Context,\r\n  ContextPermission,\r\n  ContextPermissionsList,\r\n  ContextProfils\r\n} from '../shared/context.interface';\r\n\r\n@Component({\r\n  selector: 'igo-context-permissions',\r\n  templateUrl: './context-permissions.component.html',\r\n  styleUrls: ['./context-permissions.component.scss']\r\n})\r\nexport class ContextPermissionsComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n\r\n  @Input()\r\n  get context(): Context {\r\n    return this._context;\r\n  }\r\n  set context(value: Context) {\r\n    this._context = value;\r\n    this.cd.detectChanges();\r\n  }\r\n  private _context: Context;\r\n\r\n  @Input()\r\n  get permissions(): ContextPermissionsList {\r\n    return this._permissions;\r\n  }\r\n  set permissions(value: ContextPermissionsList) {\r\n    this._permissions = value;\r\n    this.cd.detectChanges();\r\n  }\r\n  private _permissions: ContextPermissionsList;\r\n\r\n  get profils(): ContextProfils[] {\r\n    return this._profils;\r\n  }\r\n  set profils(value: ContextProfils[]) {\r\n    this._profils = value;\r\n    this.cd.detectChanges();\r\n  }\r\n  private _profils: ContextProfils[] = [];\r\n\r\n  get canWrite(): boolean {\r\n    return this.context.permission === TypePermission[TypePermission.write];\r\n  }\r\n\r\n  private baseUrlProfils;\r\n\r\n  public formControl = new UntypedFormControl();\r\n  formValueChanges$$: Subscription;\r\n\r\n  @Output() addPermission: EventEmitter<ContextPermission> = new EventEmitter();\r\n  @Output() removePermission: EventEmitter<ContextPermission> =\r\n    new EventEmitter();\r\n  @Output() scopeChanged: EventEmitter<Context> = new EventEmitter();\r\n\r\n  constructor(\r\n    private formBuilder: UntypedFormBuilder,\r\n    private cd: ChangeDetectorRef,\r\n    private http: HttpClient,\r\n    public authService: AuthService,\r\n    private config: ConfigService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.buildForm();\r\n\r\n    this.baseUrlProfils =\r\n      this.config.getConfig('context.url') + '/profils-users?';\r\n\r\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\r\n      (value) => {\r\n        if (value.length) {\r\n          this.http\r\n            .get(this.baseUrlProfils + 'q=' + value)\r\n            .subscribe((profils) => {\r\n              this.profils = profils as ContextProfils[];\r\n            });\r\n          this.profils.filter((profil) => {\r\n            const filterNormalized = value\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            const profilTitleNormalized = profil.title\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            const profilNameNormalized = profil.name\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '');\r\n            const profilNormalized =\r\n              profilNameNormalized + profilTitleNormalized;\r\n            return profilNormalized.includes(filterNormalized);\r\n          });\r\n        } else {\r\n          this.profils = [];\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  displayFn(profil?: ContextProfils): string | undefined {\r\n    return profil ? profil.title : undefined;\r\n  }\r\n\r\n  public handleFormSubmit(value) {\r\n    this.addPermission.emit(value);\r\n  }\r\n\r\n  private buildForm(): void {\r\n    this.form = this.formBuilder.group({\r\n      profil: [],\r\n      typePermission: ['read']\r\n    });\r\n  }\r\n\r\n  onProfilSelected(value) {\r\n    this.form.setValue({\r\n      profil: value.name,\r\n      typePermission: this.form.value.typePermission\r\n    });\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectorRef,\r\n  Directive,\r\n  HostListener,\r\n  OnDestroy,\r\n  OnInit,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport {\r\n  Context,\r\n  ContextPermission,\r\n  DetailedContext\r\n} from '../shared/context.interface';\r\nimport { ContextService } from '../shared/context.service';\r\nimport { ContextPermissionsComponent } from './context-permissions.component';\r\n\r\n@Directive({\r\n  selector: '[igoContextPermissionsBinding]'\r\n})\r\nexport class ContextPermissionsBindingDirective implements OnInit, OnDestroy {\r\n  private component: ContextPermissionsComponent;\r\n  private editedContext$$: Subscription;\r\n\r\n  @HostListener('addPermission', ['$event'])\r\n  onAddPermission(permission: ContextPermission) {\r\n    if (!permission.profil) {\r\n      this.messageService.error(\r\n        'igo.context.contextManager.errors.addPermissionEmpty',\r\n        'igo.context.contextManager.errors.addPermissionTitle'\r\n      );\r\n      return;\r\n    }\r\n    const contextId = this.component.context.id;\r\n    this.contextService\r\n      .addPermissionAssociation(\r\n        contextId,\r\n        permission.profil,\r\n        permission.typePermission\r\n      )\r\n      .subscribe((profils) => {\r\n        for (const p of profils) {\r\n          this.component.permissions[permission.typePermission].push(p);\r\n        }\r\n        const profil = permission.profil;\r\n        this.messageService.success(\r\n          'igo.context.permission.dialog.addMsg',\r\n          'igo.context.permission.dialog.addTitle',\r\n          undefined,\r\n          { value: profil }\r\n        );\r\n        this.cd.detectChanges();\r\n      });\r\n  }\r\n\r\n  @HostListener('removePermission', ['$event'])\r\n  onRemovePermission(permission: ContextPermission) {\r\n    const contextId = this.component.context.id;\r\n    this.contextService\r\n      .deletePermissionAssociation(contextId, permission.id)\r\n      .subscribe(() => {\r\n        const index = this.component.permissions[\r\n          permission.typePermission\r\n        ].findIndex((p) => {\r\n          return p.id === permission.id;\r\n        });\r\n        this.component.permissions[permission.typePermission].splice(index, 1);\r\n\r\n        const profil = permission.profil;\r\n        this.messageService.success(\r\n          'igo.context.permission.dialog.deleteMsg',\r\n          'igo.context.permission.dialog.deleteTitle',\r\n          undefined,\r\n          { value: profil }\r\n        );\r\n        this.cd.detectChanges();\r\n      });\r\n  }\r\n\r\n  @HostListener('scopeChanged', ['$event'])\r\n  onScopeChanged(context: Context) {\r\n    const scope = context.scope;\r\n    this.contextService.update(context.id, { scope }).subscribe(() => {\r\n      this.messageService.success(\r\n        'igo.context.permission.dialog.scopeChangedMsg',\r\n        'igo.context.permission.dialog.scopeChangedTitle',\r\n        undefined,\r\n        { value: 'igo.context.permission.scope.' + scope }\r\n      );\r\n    });\r\n  }\r\n\r\n  constructor(\r\n    @Self() component: ContextPermissionsComponent,\r\n    private contextService: ContextService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private cd: ChangeDetectorRef\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\r\n      (context) => this.handleEditedContextChange(context)\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.editedContext$$.unsubscribe();\r\n    this.contextService.editedContext$.next(undefined);\r\n  }\r\n\r\n  private handleEditedContextChange(context: DetailedContext) {\r\n    this.component.context = context;\r\n\r\n    if (context) {\r\n      this.contextService\r\n        .getPermissions(context.id)\r\n        .subscribe((permissionsArray) => {\r\n          permissionsArray = permissionsArray || [];\r\n          const permissions = {\r\n            read: permissionsArray.filter((p) => {\r\n              return p.typePermission.toString() === 'read';\r\n            }),\r\n            write: permissionsArray.filter((p) => {\r\n              return p.typePermission.toString() === 'write';\r\n            })\r\n          };\r\n          return (this.component.permissions = permissions);\r\n        });\r\n    }\r\n  }\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\n\nimport { RouteService } from '@igo2/core';\nimport { Layer, WMSDataSourceOptions } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ShareMapService {\n  private language = '';\n\n  constructor(\n    private contextService: ContextService,\n    @Optional() private route: RouteService\n  ) {\n    this.route.queryParams.subscribe((params) => {\n      if (params['lang']) {\n        this.language = params['lang'];\n      }\n    });\n  }\n\n  getUrlWithApi(formValues) {\n    return this.language\n      ? `${location.origin + location.pathname}?context=${\n          formValues.uri\n        }&lang=${this.language}`\n      : `${location.origin + location.pathname}?context=${formValues.uri}`;\n  }\n\n  createContextShared(map: IgoMap, formValues) {\n    const context = this.contextService.getContextFromMap(map);\n    context.scope = 'public';\n    context.title = formValues.title;\n    context.uri = formValues.uri;\n    return this.contextService.create(context);\n  }\n\n  updateContextShared(map: IgoMap, formValues, id: string) {\n    const context = this.contextService.getContextFromMap(map);\n    return this.contextService.update(id, {\n      title: formValues.title,\n      map: context.map\n    } as DetailedContext);\n  }\n\n  getUrlWithoutApi(map: IgoMap, publicShareOption) {\n    if (\n      !this.route ||\n      !this.route.options.visibleOnLayersKey ||\n      !this.route.options.visibleOffLayersKey ||\n      !map.viewController.getZoom()\n    ) {\n      return;\n    }\n    const llc = publicShareOption.layerlistControls.querystring;\n\n    let visibleKey = this.route.options.visibleOnLayersKey;\n    let invisibleKey = this.route.options.visibleOffLayersKey;\n    const layers = map.layers;\n\n    const visibleLayers = layers.filter(\n      (lay) => lay.visible && !lay.isIgoInternalLayer\n    );\n    const invisibleLayers = layers.filter(\n      (lay) => !lay.visible && !lay.isIgoInternalLayer\n    );\n\n    if (visibleLayers.length === 0) {\n      visibleKey = '';\n    }\n    if (invisibleLayers.length === 0) {\n      invisibleKey = '';\n    }\n\n    let layersUrl = '';\n    let layersToLoop = [];\n    if (visibleLayers.length > invisibleLayers.length) {\n      layersUrl = `${visibleKey}=*&${invisibleKey}=`;\n      layersToLoop = invisibleLayers;\n    } else {\n      layersUrl = `${invisibleKey}=*&${visibleKey}=`;\n      layersToLoop = visibleLayers;\n    }\n\n    for (const layer of layersToLoop) {\n      if (layer.id) {\n        layersUrl += layer.id + ',';\n      }\n    }\n    const contextLayersID = [];\n    const contextLayers = this.contextService.context$.value.layers;\n    for (const contextLayer of contextLayers) {\n      if (\n        typeof contextLayer.id !== 'undefined' ||\n        typeof contextLayer.source !== 'undefined'\n      ) {\n        contextLayersID.push(contextLayer.id || contextLayer.source.id);\n      }\n    }\n\n    const addedLayersQueryParamsWms = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'wms'\n    );\n    const addedLayersQueryParamsWmts = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'wmts'\n    );\n    const addedLayersQueryParamsArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'arcgisrest'\n    );\n    const addedLayersQueryParamsImageArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'imagearcgisrest'\n    );\n    const addedLayersQueryParamsTileArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'tilearcgisrest'\n    );\n\n    layersUrl = layersUrl.substr(0, layersUrl.length - 1);\n\n    const zoomKey = this.route.options.zoomKey;\n    const centerKey = this.route.options.centerKey;\n    const contextKey = this.route.options.contextKey;\n\n    const zoom = `${zoomKey}=${map.viewController.getZoom()}`;\n    const arrayCenter = map.viewController.getCenter('EPSG:4326') || [];\n    const long = arrayCenter[0].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\n    const lat = arrayCenter[1].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\n    const center = `${centerKey}=${long},${lat}`.replace(/.00000/g, '');\n    let context = '';\n    if (this.contextService.context$.value) {\n      context = `${contextKey}=${this.contextService.context$.value.uri}`;\n    }\n\n    let url = this.language\n      ? `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}&lang=${this.language}`\n      : `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}`;\n    for (let i = 0; i < 5; i++) {\n      url = url.replace(/&&/g, '&');\n      url = url.endsWith('&') ? url.slice(0, -1) : url;\n    }\n    url = url.endsWith('&') ? url.slice(0, -1) : url;\n    url = url.replace('?&wm', '&wm');\n    url = url.replace('?&', '?');\n\n    return url;\n  }\n\n  private makeLayersByService(\n    layers: Layer[],\n    contextLayersID: any[],\n    typeService: string\n  ): string {\n    const addedLayersByService = [];\n    for (const layer of layers.filter(\n      (l) => l.dataSource.options?.type === typeService\n    )) {\n      if (contextLayersID.indexOf(layer.id) === -1) {\n        let linkUrl = encodeURIComponent((layer.dataSource.options as any).url);\n        let addedLayer = '';\n        let layerVersion: string;\n        switch (layer.dataSource.options.type.toLowerCase()) {\n          case 'wms':\n            const datasourceOptions = layer.dataSource\n              .options as WMSDataSourceOptions;\n            addedLayer = encodeURIComponent(datasourceOptions.params.LAYERS);\n            layerVersion =\n              datasourceOptions.params.VERSION === '1.3.0'\n                ? layerVersion\n                : datasourceOptions.params.VERSION;\n            break;\n          case 'wmts':\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            addedLayer = encodeURIComponent(\n              (layer.dataSource.options as any).layer\n            );\n            break;\n        }\n        const addedLayerPosition = `${addedLayer}:igoz${layer.zIndex}`;\n\n        let version = '';\n        if (layerVersion) {\n          const operator =\n            (layer.dataSource.options as any).url.indexOf('?') === -1\n              ? '?'\n              : '&';\n          version = encodeURIComponent(`${operator}VERSION=${layerVersion}`);\n        }\n        linkUrl = `${linkUrl}${version}`;\n\n        if (\n          !addedLayersByService.find((definedUrl) => definedUrl.url === linkUrl)\n        ) {\n          addedLayersByService.push({\n            url: linkUrl,\n            layers: [addedLayerPosition]\n          });\n        } else {\n          addedLayersByService.forEach((service) => {\n            if (service.url === linkUrl) {\n              service.layers.push(addedLayerPosition);\n            }\n          });\n        }\n      }\n    }\n\n    let addedLayersQueryParams = '';\n    if (addedLayersByService.length >= 1) {\n      let linkUrlKey;\n      let layersKey;\n      /*\n      const linkUrlKey = (typeService === 'wms') ? this.route.options.wmsUrlKey :\n        (typeService === 'wmts') ? this.route.options.wmtsUrlKey : '' ;\n      const layersKey = (typeService === 'wms') ? this.route.options.wmsLayersKey :\n        (typeService === 'wmts') ? this.route.options.wmtsLayersKey : '' ;\n*/\n      switch (typeService.toLowerCase()) {\n        case 'wms':\n          linkUrlKey = this.route.options.wmsUrlKey;\n          layersKey = this.route.options.wmsLayersKey;\n          break;\n        case 'wmts':\n          linkUrlKey = this.route.options.wmtsUrlKey;\n          layersKey = this.route.options.wmtsLayersKey;\n          break;\n        case 'arcgisrest':\n          linkUrlKey = this.route.options.arcgisUrlKey;\n          layersKey = this.route.options.arcgisLayersKey;\n          break;\n        case 'imagearcgisrest':\n          linkUrlKey = this.route.options.iarcgisUrlKey;\n          layersKey = this.route.options.iarcgisLayersKey;\n          break;\n        case 'tilearcgisrest':\n          linkUrlKey = this.route.options.tarcgisUrlKey;\n          layersKey = this.route.options.tarcgisLayersKey;\n          break;\n        default:\n          linkUrlKey = '';\n          layersKey = '';\n      }\n\n      let linkUrlQueryParams = '';\n      let layersQueryParams = '';\n      addedLayersByService.forEach((service) => {\n        linkUrlQueryParams += `${service.url},`;\n        layersQueryParams += `(${service.layers.join(',')}),`;\n      });\n      linkUrlQueryParams = linkUrlQueryParams.endsWith(',')\n        ? linkUrlQueryParams.slice(0, -1)\n        : linkUrlQueryParams;\n      layersQueryParams = layersQueryParams.endsWith(',')\n        ? layersQueryParams.slice(0, -1)\n        : layersQueryParams;\n      addedLayersQueryParams = `${linkUrlKey}=${linkUrlQueryParams}&${layersKey}=${layersQueryParams}`;\n    }\n\n    return addedLayersQueryParams;\n  }\n}\n","<div class=\"igo-input-container linkToShare\">\n  <mat-form-field>\n    <textarea\n      #textArea\n      matInput\n      readonly\n      rows=\"3\"\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\n      [value]=\"url\"\n    ></textarea>\n  </mat-form-field>\n\n  <div class=\"igo-form-button-group\">\n    <button mat-raised-button (click)=\"copyTextToClipboard(textArea)\">\n      <mat-icon svgIcon=\"content-copy\"></mat-icon>\n      {{ 'igo.context.shareMap.copy' | translate }}\n    </button>\n  </div>\n  <div>\n    <br />\n    <section class=\"mat-typography\">\n      <div\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) === ''\"\n      >\n        <h4 *ngIf=\"('igo.context.shareMap.included' | translate) !== ''\">\n          {{ 'igo.context.shareMap.included' | translate }}\n        </h4>\n        <ul>\n          <li *ngIf=\"('igo.context.shareMap.context' | translate) !== ''\">\n            {{ 'igo.context.shareMap.context' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.center' | translate) !== ''\">\n            {{ 'igo.context.shareMap.center' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.zoom' | translate) !== ''\">\n            {{ 'igo.context.shareMap.zoom' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.addedLayers' | translate) !== ''\">\n            {{ 'igo.context.shareMap.addedLayers' | translate }}\n          </li>\n          <li\n            *ngIf=\"('igo.context.shareMap.visibleInvisible' | translate) !== ''\"\n          >\n            {{ 'igo.context.shareMap.visibleInvisible' | translate }}\n          </li>\n        </ul>\n\n        <h4 *ngIf=\"('igo.context.shareMap.excluded' | translate) !== ''\">\n          {{ 'igo.context.shareMap.excluded' | translate }}\n        </h4>\n        <ul>\n          <li *ngIf=\"('igo.context.shareMap.order' | translate) !== ''\">\n            {{ 'igo.context.shareMap.order' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.opacity' | translate) !== ''\">\n            {{ 'igo.context.shareMap.opacity' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.filterOgc' | translate) !== ''\">\n            {{ 'igo.context.shareMap.filterOgc' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.filterTime' | translate) !== ''\">\n            {{ 'igo.context.shareMap.filterTime' | translate }}\n          </li>\n        </ul>\n      </div>\n      <igo-custom-html\n        class=\"shareCustomPadding\"\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) !== ''\"\n        class=\"mat-typography\"\n        [html]=\"'igo.context.shareMap.htmlClarifications' | translate\"\n      >\n      </igo-custom-html>\n    </section>\n  </div>\n</div>\n","import {\r\n  AfterViewInit,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { MessageService } from '@igo2/core';\r\nimport type { IgoMap } from '@igo2/geo';\r\nimport { Clipboard } from '@igo2/utils';\r\n\r\nimport { Subscription, combineLatest } from 'rxjs';\r\n\r\nimport { ShareMapService } from '../shared/share-map.service';\r\n\r\n@Component({\r\n  selector: 'igo-share-map-url',\r\n  templateUrl: './share-map-url.component.html',\r\n  styleUrls: ['./share-map-url.component.scss']\r\n})\r\nexport class ShareMapUrlComponent implements AfterViewInit, OnInit, OnDestroy {\r\n  private mapState$$: Subscription;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  public url: string;\r\n  public publicShareOption = {\r\n    layerlistControls: { querystring: '' }\r\n  };\r\n\r\n  constructor(\r\n    private messageService: MessageService,\r\n    private shareMapService: ShareMapService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.resetUrl();\r\n    this.mapState$$ = combineLatest([\r\n      this.map.viewController.state$,\r\n      this.map.status$\r\n    ]).subscribe((c) => {\r\n      this.resetUrl();\r\n      this.cdRef.detectChanges();\r\n    });\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.resetUrl();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.mapState$$.unsubscribe();\r\n  }\r\n\r\n  resetUrl(values: any = {}) {\r\n    this.url = this.shareMapService.getUrlWithoutApi(\r\n      this.map,\r\n      this.publicShareOption\r\n    );\r\n  }\r\n\r\n  copyTextToClipboard(textArea) {\r\n    const successful = Clipboard.copy(textArea);\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.context.shareMap.dialog.copyMsg',\r\n        'igo.context.shareMap.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n}\r\n","<form class=\"igo-form\" [formGroup]=\"form\" (ngSubmit)=\"createUrl(form.value)\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        required\n        [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\n        formControlName=\"title\"\n      />\n      <mat-error>\n        {{ 'igo.context.contextManager.form.titleRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n  </div>\n\n  <div id=\"uriInput\" class=\"igo-input-container\">\n    <mat-form-field>\n      <span *ngIf=\"userId\" class=\"prefix\">{{ userId }}-</span>\n      <span class=\"fieldWrapper\">\n        <input\n          matInput\n          required\n          [readonly]=\"!userId\"\n          [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\n          formControlName=\"uri\"\n        />\n      </span>\n      <mat-error>\n        {{ 'igo.context.contextManager.form.uriRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      *ngIf=\"!url\"\n      mat-raised-button\n      type=\"submit\"\n      [disabled]=\"!form.valid\"\n    >\n      {{ 'igo.context.shareMap.button' | translate }}\n    </button>\n    <button\n      *ngIf=\"url\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"updateContextShared(form.value)\"\n    >\n      {{ 'igo.context.shareMap.refreshBtn' | translate }}\n    </button>\n  </div>\n</form>\n\n<div *ngIf=\"url\" class=\"igo-input-container linkToShare\">\n  <mat-form-field>\n    <textarea\n      #textArea\n      matInput\n      readonly\n      rows=\"3\"\n      class=\"textAreaWithButton\"\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\n      [value]=\"url\"\n    ></textarea>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.context.shareMap.copy' | translate\"\n      color=\"primary\"\n      (click)=\"copyTextToClipboard(textArea)\"\n    >\n      <mat-icon svgIcon=\"content-copy\"></mat-icon>\n    </button>\n  </mat-form-field>\n  <div></div>\n</div>\n","import { Component, Input, OnInit } from '@angular/core';\r\nimport { UntypedFormBuilder, UntypedFormGroup } from '@angular/forms';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport type { IgoMap } from '@igo2/geo';\r\nimport { Clipboard, uuid } from '@igo2/utils';\r\n\r\nimport { ShareMapService } from '../shared/share-map.service';\r\n\r\n@Component({\r\n  selector: 'igo-share-map-api',\r\n  templateUrl: './share-map-api.component.html',\r\n  styleUrls: ['./share-map-api.component.scss']\r\n})\r\nexport class ShareMapApiComponent implements OnInit {\r\n  public form: UntypedFormGroup;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  public url: string;\r\n  public userId: string;\r\n  public idContextShared: string;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private auth: AuthService,\r\n    private shareMapService: ShareMapService,\r\n    private formBuilder: UntypedFormBuilder\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.auth.authenticate$.subscribe((auth) => {\r\n      const decodeToken = this.auth.decodeToken();\r\n      this.userId = decodeToken.user ? decodeToken.user.id : undefined;\r\n      this.buildForm();\r\n    });\r\n  }\r\n\r\n  createUrl(values: any = {}) {\r\n    const inputs = Object.assign({}, values);\r\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\r\n    this.url = this.shareMapService.getUrlWithApi(inputs);\r\n    this.shareMapService.createContextShared(this.map, inputs).subscribe(\r\n      (rep) => {\r\n        this.idContextShared = rep.id;\r\n        this.messageService.success(\r\n          'igo.context.contextManager.dialog.saveMsg',\r\n          'igo.context.contextManager.dialog.saveTitle',\r\n          undefined,\r\n          { value: inputs.title }\r\n        );\r\n      },\r\n      (err) => {\r\n        err.error.title = this.languageService.translate.instant(\r\n          'igo.context.shareMap.errorTitle'\r\n        );\r\n        this.messageService.showError(err);\r\n      }\r\n    );\r\n  }\r\n\r\n  updateContextShared(values: any = {}) {\r\n    const inputs = Object.assign({}, values);\r\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\r\n    this.shareMapService\r\n      .updateContextShared(this.map, inputs, this.idContextShared)\r\n      .subscribe(\r\n        (rep) => {\r\n          this.messageService.success(\r\n            'igo.context.contextManager.dialog.saveMsg',\r\n            'igo.context.contextManager.dialog.saveTitle',\r\n            undefined,\r\n            { value: inputs.title }\r\n          );\r\n        },\r\n        (err) => {\r\n          err.error.title = this.languageService.translate.instant(\r\n            'igo.context.shareMap.errorTitle'\r\n          );\r\n          this.messageService.showError(err);\r\n        }\r\n      );\r\n  }\r\n\r\n  copyTextToClipboard(textArea) {\r\n    const successful = Clipboard.copy(textArea);\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.context.shareMap.dialog.copyMsg',\r\n        'igo.context.shareMap.dialog.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  buildForm(): void {\r\n    this.url = undefined;\r\n    const id = uuid();\r\n    let title = 'Partage ';\r\n    title += this.userId ? `(${this.userId}-${id})` : `(${id})`;\r\n    this.form = this.formBuilder.group({\r\n      title: [title],\r\n      uri: [id]\r\n    });\r\n  }\r\n}\r\n","<mat-tab-group *ngIf=\"hasApi\">\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithApi' | translate\">\n    <igo-share-map-api [map]=\"map\"></igo-share-map-api>\n  </mat-tab>\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithUrl' | translate\">\n    <igo-share-map-url [map]=\"map\"></igo-share-map-url>\n  </mat-tab>\n</mat-tab-group>\n\n<igo-share-map-url *ngIf=\"!hasApi\" [map]=\"map\"></igo-share-map-url>\n","import { Component, Input } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport type { IgoMap } from '@igo2/geo';\n\n@Component({\n  selector: 'igo-share-map',\n  templateUrl: './share-map.component.html',\n  styleUrls: ['./share-map.component.scss']\n})\nexport class ShareMapComponent {\n  @Input() map: IgoMap;\n\n  public hasApi = false;\n\n  constructor(private config: ConfigService) {\n    this.hasApi = this.config.getConfig('context.url') ? true : false;\n  }\n}\n","<app-doc-viewer\n  title=\"Context\"\n  subtitle=\"Context\"\n  [dependencies]=\"['LanguageService', 'mapService']\"\n>\n  <app-example-viewer codeFolder=\"context/context\" configFolder=\"contexts\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser\n          igoMapContext\n          igoLayerContext\n          [map]=\"map\"\n          [view]=\"view\"\n        >\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n          <igo-geolocate-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-geolocate-button>\n          <igo-home-extent-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-home-extent-button>\n          <igo-rotation-button\n            [map]=\"map\"\n            [showIfNoRotation]=\"true\"\n            color=\"primary\"\n          ></igo-rotation-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex flex-col align-start h-100 w-100\">\n          <igo-panel title=\"Contexts list\" class=\"h-100 w-100\">\n            <igo-context-list\n              igoContextListBinding\n              [map]=\"map\"\n            ></igo-context-list>\n          </igo-panel>\n\n          <igo-panel title=\"Layers\" class=\"h-100 w-100\">\n            <igo-layer-list igoLayerListBinding [map]=\"map\">\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n              </ng-template>\n            </igo-layer-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n\n  <app-example-viewer\n    title=\"Import/Export context\"\n    codeFolder=\"context/context\"\n    configFolder=\"contexts\"\n  >\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppContextComponent } from './context.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'context',\r\n    component: AppContextComponent\r\n  }\r\n];\r\n\r\nexport const AppContextRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { ContextService } from '@igo2/context';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { IgoMap, MapService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-context',\r\n  templateUrl: './context.component.html',\r\n  styleUrls: ['./context.component.scss']\r\n})\r\nexport class AppContextComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private mapService: MapService,\r\n    private contextService: ContextService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n    this.contextService.loadDefaultContext();\r\n    this.contextService.loadContexts();\r\n  }\r\n}\r\n","import { HttpClientJsonpModule } from '@angular/common/http';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport { IgoContextModule } from '@igo2/context';\r\nimport {\r\n  IgoFeatureModule,\r\n  IgoLayerModule,\r\n  IgoMapModule,\r\n  IgoMetadataModule,\r\n  IgoOverlayModule,\r\n  IgoQueryModule\r\n} from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppContextRoutingModule } from './context-routing.module';\r\nimport { AppContextComponent } from './context.component';\r\n\r\n@NgModule({\r\n  declarations: [AppContextComponent],\r\n  imports: [\r\n    HttpClientJsonpModule,\r\n    AppContextRoutingModule,\r\n    SharedModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoLayerModule,\r\n    IgoMetadataModule,\r\n    IgoOverlayModule,\r\n    IgoQueryModule,\r\n    IgoFeatureModule,\r\n    IgoContextModule\r\n  ],\r\n  exports: [AppContextComponent]\r\n})\r\nexport class AppContextModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppActivityComponent } from './activity.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'activity',\r\n    component: AppActivityComponent\r\n  }\r\n];\r\n\r\nexport const AppActivityRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\n\nimport { ActivityService } from '@igo2/core';\n\n@Component({\n  selector: 'app-activity',\n  templateUrl: './activity.component.html',\n  styleUrls: ['./activity.component.scss']\n})\nexport class AppActivityComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private activityService: ActivityService) {}\n\n  register() {\n    this.idsActivity.push(this.activityService.register());\n  }\n\n  unregister() {\n    this.activityService.unregister(this.idsActivity.pop());\n  }\n\n  get counter() {\n    return this.activityService.counter$.value;\n  }\n}\n","<app-doc-viewer title=\"Activity\" subtitle=\"Core\">\n  <p>Register activities in service. Use to display a loading icon</p>\n\n  <li>\n    Import <code>IgoActivityModule</code> only if you want register http calls\n  </li>\n  <li>Import <code>IgoActivityModule</code> only once</li>\n\n  <app-example-viewer codeFolder=\"core/activity\">\n    <div class=\"d-flex actions-container\">\n      <button mat-raised-button (click)=\"register()\">Register</button>\n      <button mat-raised-button (click)=\"unregister()\">Unregister</button>\n    </div>\n\n    <div class=\"mat-body-1 sub-content\">\n      <p>Counter: {{ counter }}</p>\n\n      <igo-spinner igoSpinnerActivity></igo-spinner>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoSpinnerModule } from '@igo2/common';\r\nimport { IgoActivityModule } from '@igo2/core';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppActivityRoutingModule } from './activity-routing.module';\r\nimport { AppActivityComponent } from './activity.component';\r\n\r\n@NgModule({\r\n  declarations: [AppActivityComponent],\r\n  imports: [\r\n    AppActivityRoutingModule,\r\n    SharedModule,\r\n    IgoActivityModule.forRoot(), // Only if you want register http calls\r\n    IgoSpinnerModule\r\n  ],\r\n  exports: [AppActivityComponent]\r\n})\r\nexport class AppActivityModule {}\r\n","import { EnvironmentOptions } from '@igo2/integration';\r\nimport { CatalogQueryFormatTypes, ICatalog, TooltipType } from '@igo2/geo';\r\n\r\nexport const environment: EnvironmentOptions = {\r\n  production: true,\r\n  igo: {\r\n    projections: [\r\n      {\r\n        code: 'EPSG:32198',\r\n        alias: 'Quebec Lambert',\r\n        def: '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\r\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\r\n      }\r\n    ],\r\n    auth: {\r\n      tokenKey: 'testIgo2Lib',\r\n      intern: {\r\n        enabled: true\r\n      },\r\n      allowAnonymous: true\r\n    },\r\n    interactiveTour: {\r\n      tourInMobile: true,\r\n      activateInteractiveTour: true\r\n    },\r\n    importExport: {\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\r\n    },\r\n    language: {\r\n      prefix: './locale/'\r\n    },\r\n    catalog: {\r\n      sources: [\r\n        {\r\n          id: 'Gououvert',\r\n          title: 'Gouvouvert',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi'\r\n        },\r\n        {\r\n          id: 'DefiningInfoFormat',\r\n          title: 'Defining info_format',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          queryFormat: {\r\n            html: '*',\r\n            json: ['stations_meteoroutieres', 'histo_stations_meteoroutieres']\r\n          } as CatalogQueryFormatTypes,\r\n          queryHtmlTarget: 'iframe',\r\n          count: 30\r\n        } as ICatalog,\r\n        {\r\n          id: 'catalogwithregex',\r\n          title: 'Filtered catalog by regex',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          regFilters: ['zpegt']\r\n        },\r\n        {\r\n          id: 'catalogwithtooltipcontrol',\r\n          title: 'Controling tooltip format',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n          tooltipType: TooltipType.ABSTRACT\r\n        }\r\n      ]\r\n    },\r\n    searchSources: {\r\n      storedqueriesreverse: { enabled: false },\r\n      nominatim: {\r\n        enabled: false\r\n      },\r\n      icherche: {\r\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\r\n        order: 2,\r\n        enabled: true,\r\n        params: {\r\n          limit: '8'\r\n        },\r\n        showAdvancedSettings: true\r\n      },\r\n      coordinatesreverse: {\r\n        showInPointerSummary: true\r\n      },\r\n      icherchereverse: {\r\n        showInPointerSummary: true,\r\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\r\n        order: 3,\r\n        enabled: true\r\n      },\r\n      ilayer: {\r\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\r\n        order: 4,\r\n        enabled: true,\r\n        params: {\r\n          limit: '5'\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppConfigComponent } from './config.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'config',\r\n    component: AppConfigComponent\r\n  }\r\n];\r\n\r\nexport const AppConfigRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { ConfigService, LanguageOptions } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-config',\r\n  templateUrl: './config.component.html',\r\n  styleUrls: ['./config.component.scss']\r\n})\r\nexport class AppConfigComponent {\r\n  public configLanguage: LanguageOptions;\r\n\r\n  constructor(private configService: ConfigService) {\r\n    this.configLanguage = this.configService.getConfig('language');\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Config\" subtitle=\"Core\">\n  <p>Load config in your angular application</p>\n\n  <li>Import <code>IgoConfigModule</code> only once</li>\n\n  <app-example-viewer\n    title=\"Simple config\"\n    codeFolder=\"core/config\"\n    configFolder=\"environments\"\n  >\n    <p class=\"mat-body-1\">Config language: {{ configLanguage | json }}</p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\r\n\r\nimport { environment } from '../../../environments/environment';\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppConfigRoutingModule } from './config-routing.module';\r\nimport { AppConfigComponent } from './config.component';\r\n\r\n@NgModule({\r\n  declarations: [AppConfigComponent],\r\n  imports: [AppConfigRoutingModule, SharedModule, IgoConfigModule.forRoot()],\r\n  exports: [AppConfigComponent],\r\n  providers: [\r\n    provideConfigOptions({\r\n      default: environment.igo\r\n    })\r\n  ]\r\n})\r\nexport class AppConfigModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppHomeComponent } from './home.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'home',\r\n    component: AppHomeComponent\r\n  }\r\n];\r\n\r\nexport const AppHomeRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { InteractiveTourService } from '@igo2/common';\r\n\r\n@Component({\r\n  selector: 'app-home',\r\n  templateUrl: './home.component.html',\r\n  styleUrls: ['./home.component.scss']\r\n})\r\nexport class AppHomeComponent {\r\n  constructor(private interactiveTourService: InteractiveTourService) {}\r\n\r\n  startTour() {\r\n    this.interactiveTourService.startTour('global');\r\n  }\r\n}\r\n","<app-doc-viewer>\n  <div style=\"text-align: center\">\n    <h1 id=\"igo-title\">Welcome to IGO</h1>\n    <img class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\" />\n  </div>\n\n  <p>\n    <igo-interactive-tour\n      tourToStart=\"global\"\n      menuIsOpen=\"true\"\n      styleButton=\"raised\"\n    >\n    </igo-interactive-tour>\n  </p>\n\n  <p class=\"mat-body-1\">\n    IGO2 library contains many components and services that may benefit any web\n    application. <br />\n    IGO2 library is open source project using Angular, Angular Material and\n    OpenLayers.\n  </p>\n\n  <h3>IGO2 library is divided into several elements:</h3>\n  <ul class=\"mat-body-1\">\n    <li>\n      <b>@igo2/utils</b> : Basic utilies without dependency (ex: base64,\n      clipboard, uuid)\n    </li>\n    <li>\n      <b>@igo2/core</b> : Element affecting the core of the application (ex:\n      config, language, message, media, request)\n    </li>\n    <li>\n      <b>@igo2/common</b> : Library containing reusable components (ex:\n      clickout, drag-drop, list, panel, spinner, table)\n    </li>\n    <li>\n      <b>@igo2/auth</b> : Library grouping the authentication and security\n      module\n    </li>\n    <li>\n      <b>@igo2/geo</b> : Library containing the geomatic components. Depends on\n      Openlayers.\n    </li>\n    <li>\n      <b>@igo2/context</b> : Library of components uniting @igo2/geo and\n      @igo2/auth\n    </li>\n    <li><b>@igo2/integration</b> : Library integrate basic components</li>\n  </ul>\n\n  <h2>Here are some links to help you start:</h2>\n  <ul>\n    <li>\n      <h2>\n        <a\n          target=\"_blank\"\n          rel=\"noopener\"\n          href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\"\n          >Installation</a\n        >\n      </h2>\n    </li>\n    <li>\n      <h2>\n        <a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\"\n          >Angular Documentation</a\n        >\n      </h2>\n    </li>\n  </ul>\n\n  <span class=\"mat-body-1\"\n    >*** Modules in <code>@igo2/core</code> must be imported only once</span\n  >\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoInteractiveTourModule } from '@igo2/common';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppHomeRoutingModule } from './home-routing.module';\r\nimport { AppHomeComponent } from './home.component';\r\n\r\n@NgModule({\r\n  declarations: [AppHomeComponent],\r\n  imports: [AppHomeRoutingModule, IgoInteractiveTourModule, SharedModule],\r\n  exports: [AppHomeComponent]\r\n})\r\nexport class AppHomeModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppLanguageComponent } from './language.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'language',\r\n    component: AppLanguageComponent\r\n  }\r\n];\r\n\r\nexport const AppLanguageRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-language',\r\n  templateUrl: './language.component.html',\r\n  styleUrls: ['./language.component.scss']\r\n})\r\nexport class AppLanguageComponent {\r\n  public app = {\r\n    title: 'IGO'\r\n  };\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  changeLanguage(language: string) {\r\n    this.languageService.setLanguage(language);\r\n    console.log(this.languageService);\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Language\" subtitle=\"Core\">\n  <p>Translate your angular application</p>\n\n  <li>Import <code>IgoLanguageModule</code> only once</li>\n  <li>\n    Configure the\n    <a\n      href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale\"\n      >locale files</a\n    >\n  </li>\n\n  <app-example-viewer codeFolder=\"core/language\">\n    <div class=\"d-flex actions-container\">\n      <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\n      <button mat-raised-button (click)=\"changeLanguage('fr')\">Franais</button>\n    </div>\n\n    <div class=\"m-t-12\">\n      {{ 'welcome' | translate: app }}\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppLanguageRoutingModule } from './language-routing.module';\r\nimport { AppLanguageComponent } from './language.component';\r\n\r\n@NgModule({\r\n  declarations: [AppLanguageComponent],\r\n  imports: [\r\n    AppLanguageRoutingModule,\r\n    SharedModule,\r\n    IgoLanguageModule.forRoot()\r\n  ],\r\n  exports: [AppLanguageComponent]\r\n})\r\nexport class AppLanguageModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppMediaComponent } from './media.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'media',\r\n    component: AppMediaComponent\r\n  }\r\n];\r\n\r\nexport const AppMediaRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\n\nimport { MediaService } from '@igo2/core';\n\n@Component({\n  selector: 'app-media',\n  templateUrl: './media.component.html',\n  styleUrls: ['./media.component.scss']\n})\nexport class AppMediaComponent {\n  constructor(private mediaService: MediaService) {}\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get orientation() {\n    return this.mediaService.getOrientation();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n}\n","<app-doc-viewer title=\"Media\" subtitle=\"Core\">\n  <p>Detect type of media (mobile, tablet, desktop)</p>\n\n  <app-example-viewer codeFolder=\"core/media\">\n    <p>Current media: {{ media }}</p>\n    <p>Current orientation: {{ orientation }}</p>\n    <p>\n      Device mode:\n      {{ isTouchScreen ? 'Touch device' : 'Not a touch device ' }}\n    </p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppMediaRoutingModule } from './media-routing.module';\r\nimport { AppMediaComponent } from './media.component';\r\n\r\n@NgModule({\r\n  declarations: [AppMediaComponent],\r\n  imports: [AppMediaRoutingModule, SharedModule],\r\n  exports: [AppMediaComponent]\r\n})\r\nexport class AppMediaModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppMessageComponent } from './message.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'message',\r\n    component: AppMessageComponent\r\n  }\r\n];\r\n\r\nexport const AppMessageRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\n\nimport { MessageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-message',\n  templateUrl: './message.component.html',\n  styleUrls: ['./message.component.scss']\n})\nexport class AppMessageComponent {\n  constructor(private messageService: MessageService) {}\n\n  success() {\n    this.messageService.success('Congratulations', 'Success');\n  }\n\n  info() {\n    this.messageService.info('Welcome to IGO', 'Info');\n  }\n\n  alert() {\n    this.messageService.alert('Warning', 'Alert');\n  }\n  error() {\n    this.messageService.error('There is a bug', 'Error');\n  }\n}\n","<app-doc-viewer title=\"Message\" subtitle=\"Core\">\n  <p>Show message to user.</p>\n\n  <li>Import <code>IgoMessageModule</code> only once</li>\n  <li>Dependencies: BrowserAnimationsModule</li>\n\n  <app-example-viewer codeFolder=\"core/message\">\n    <div class=\"d-flex m-t-16 actions-container\">\n      <button mat-raised-button (click)=\"success()\">Success message</button>\n      <button mat-raised-button color=\"primary\" (click)=\"info()\">\n        Info message\n      </button>\n      <button mat-raised-button color=\"accent\" (click)=\"alert()\">\n        Alert message\n      </button>\n      <button mat-raised-button color=\"warn\" (click)=\"error()\">\n        Error message\n      </button>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppMessageRoutingModule } from './message-routing.module';\r\nimport { AppMessageComponent } from './message.component';\r\n\r\n@NgModule({\r\n  declarations: [AppMessageComponent],\r\n  imports: [AppMessageRoutingModule, SharedModule, IgoMessageModule.forRoot()],\r\n  exports: [AppMessageComponent]\r\n})\r\nexport class AppMessageModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppRequestComponent } from './request.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'request',\r\n    component: AppRequestComponent\r\n  }\r\n];\r\n\r\nexport const AppRequestRoutingModule = RouterModule.forChild(routes);\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'app-request',\r\n  templateUrl: './request.component.html',\r\n  styleUrls: ['./request.component.scss']\r\n})\r\nexport class AppRequestComponent {\r\n  constructor(\r\n    private http: HttpClient,\r\n    public languageService: LanguageService\r\n  ) {}\r\n\r\n  callHttp() {\r\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\r\n    this.http.get(url).subscribe((rep) => {\r\n      console.log(rep);\r\n    });\r\n  }\r\n\r\n  callHttpError() {\r\n    const url = '404';\r\n    this.http.get(url).subscribe((rep) => {\r\n      console.log(rep);\r\n    });\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Request\" subtitle=\"Core\">\n  <p>Register http calls in console</p>\n\n  <li>\n    Import <code>IgoLoggingModule</code> only if you want register http calls in\n    console\n  </li>\n  <li>\n    Import <code>IgoErrorModule</code> only if you want register errors from\n    http call in console\n  </li>\n  <li>Import modules only once</li>\n\n  <app-example-viewer codeFolder=\"core/core\">\n    <div class=\"actions-container\">\n      <button mat-raised-button (click)=\"callHttp()\">Log</button>\n      <button mat-raised-button (click)=\"callHttpError()\">Error</button>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { HttpClientModule } from '@angular/common/http';\r\nimport { NgModule } from '@angular/core';\r\n\r\nimport { IgoErrorModule, IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppRequestRoutingModule } from './request-routing.module';\r\nimport { AppRequestComponent } from './request.component';\r\n\r\n@NgModule({\r\n  declarations: [AppRequestComponent],\r\n  imports: [\r\n    AppRequestRoutingModule,\r\n    SharedModule,\r\n    HttpClientModule,\r\n    IgoLanguageModule.forRoot(),\r\n    IgoErrorModule.forRoot() // Only if you want register errors from http call in console\r\n    // IgoLoggingModule.forRoot() // Only if you want register http calls in console\r\n  ],\r\n  exports: [AppRequestComponent]\r\n})\r\nexport class AppRequestModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppCatalogComponent } from './catalog.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'catalog',\r\n    component: AppCatalogComponent\r\n  }\r\n];\r\n\r\nexport const AppCatalogRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\nimport { EntityRecord, EntityStore } from '@igo2/common';\r\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\r\nimport {\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogService,\r\n  IgoMap,\r\n  LayerService,\r\n  MapService\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-catalog',\r\n  templateUrl: './catalog.component.html',\r\n  styleUrls: ['./catalog.component.scss']\r\n})\r\nexport class AppCatalogComponent implements OnInit {\r\n  catalog: Catalog;\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  public catalogStore = new EntityStore<Catalog>([]);\r\n\r\n  public catalogItemStore = new EntityStore<CatalogItem>([]);\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService,\r\n    private catalogService: CatalogService,\r\n    private storageService: StorageService,\r\n    private mapService: MapService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe((layer) => this.map.addLayer(layer));\r\n\r\n    this.loadCatalogs();\r\n\r\n    this.mapService.setMap(this.map);\r\n    this.catalogStore.stateView\r\n      .firstBy$(\r\n        (record: EntityRecord<Catalog>) => record.state.selected === true\r\n      )\r\n      .subscribe((record: EntityRecord<Catalog>) => {\r\n        if (record && record.entity) {\r\n          const catalog = record.entity;\r\n          this.catalog = catalog;\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\r\n   * @internal\r\n   * @param event Select event\r\n   */\r\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }) {\r\n    this.loadCatalogItems(event.catalog);\r\n  }\r\n\r\n  /**\r\n   * Get all the available catalogs from the CatalogService and\r\n   * load them into the store.\r\n   */\r\n  private loadCatalogs() {\r\n    this.catalogService.loadCatalogs().subscribe((catalogs: Catalog[]) => {\r\n      this.catalogStore.clear();\r\n      this.catalogStore.load(\r\n        catalogs.concat(\r\n          (this.storageService.get('addedCatalogs') || []) as Catalog[]\r\n        )\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the selected catalog's items from the CatalogService and\r\n   * load them into the store.\r\n   * @param catalog Selected catalog\r\n   */\r\n  private loadCatalogItems(catalog: Catalog) {\r\n    this.catalogService\r\n      .loadCatalogItems(catalog)\r\n      .subscribe((items: CatalogItem[]) => {\r\n        this.catalogItemStore.clear();\r\n        this.catalogItemStore.load(items);\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Catalog\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/catalog\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-panel title=\"Catalog Library\">\n      <igo-catalog-library\n        [store]=\"catalogStore\"\n        (catalogSelectChange)=\"onCatalogSelectChange($event)\"\n      >\n      </igo-catalog-library>\n    </igo-panel>\n\n    <igo-panel title=\"Catalog Browser\">\n      <igo-catalog-browser\n        [catalog]=\"catalog\"\n        [store]=\"catalogItemStore\"\n        [map]=\"map\"\n      >\n      </igo-catalog-browser>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\r\nimport { IgoCatalogModule, IgoMapModule } from '@igo2/geo';\r\n\r\nimport { environment } from '../../../environments/environment';\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppCatalogRoutingModule } from './catalog-routing.module';\r\nimport { AppCatalogComponent } from './catalog.component';\r\n\r\n@NgModule({\r\n  declarations: [AppCatalogComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppCatalogRoutingModule,\r\n    IgoConfigModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoCatalogModule\r\n  ],\r\n  exports: [AppCatalogComponent],\r\n  providers: [\r\n    provideConfigOptions({\r\n      default: environment.igo\r\n    })\r\n  ]\r\n})\r\nexport class AppCatalogModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppDirectionsComponent } from './directions.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'directions',\r\n    component: AppDirectionsComponent\r\n  }\r\n];\r\n\r\nexport const AppDirectionsRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  LayerService,\r\n  MapService,\r\n  ProjectionService,\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsFeatureStore,\r\n  StopsStore\r\n} from '@igo2/geo';\r\n\r\nimport { Subject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-directions',\r\n  templateUrl: './directions.component.html',\r\n  styleUrls: ['./directions.component.scss']\r\n})\r\nexport class AppDirectionsComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 9,\r\n    geolocate: false\r\n  };\r\n\r\n  public stopsStore: StopsStore = new StopsStore([]);\r\n  public stopsFeatureStore: StopsFeatureStore = new StopsFeatureStore([], {\r\n    map: this.map\r\n  });\r\n  public stepFeatureStore: StepFeatureStore = new StepFeatureStore([], {\r\n    map: this.map\r\n  });\r\n  public routesFeatureStore: RoutesFeatureStore = new RoutesFeatureStore([], {\r\n    map: this.map\r\n  });\r\n  public zoomToActiveRoute$: Subject<void> = new Subject();\r\n\r\n  constructor(\r\n    private projectionService: ProjectionService,\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService,\r\n    private mapService: MapService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Directions\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/directions\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n          <igo-geolocate-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-geolocate-button>\n          <igo-home-extent-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-home-extent-button>\n          <igo-rotation-button\n            [map]=\"map\"\n            [showIfNoRotation]=\"false\"\n            color=\"primary\"\n          ></igo-rotation-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-directions\n            class=\"w-100\"\n            [stopsStore]=\"stopsStore\"\n            [stopsFeatureStore]=\"stopsFeatureStore\"\n            [stepFeatureStore]=\"stepFeatureStore\"\n            [routesFeatureStore]=\"routesFeatureStore\"\n            [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n          >\n          </igo-directions>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\nimport {\r\n  IgoDirectionsModule,\r\n  IgoMapModule,\r\n  provideOsrmDirectionsSource\r\n} from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppDirectionsRoutingModule } from './directions-routing.module';\r\nimport { AppDirectionsComponent } from './directions.component';\r\n\r\n@NgModule({\r\n  declarations: [AppDirectionsComponent],\r\n  imports: [\r\n    AppDirectionsRoutingModule,\r\n    SharedModule,\r\n    IgoMessageModule,\r\n    IgoMapModule,\r\n    IgoDirectionsModule\r\n  ],\r\n  exports: [AppDirectionsComponent],\r\n  providers: [provideOsrmDirectionsSource()]\r\n})\r\nexport class AppDirectionsModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppDrawComponent } from './draw.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'draw',\r\n    component: AppDrawComponent\r\n  }\r\n];\r\n\r\nexport const AppDrawRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  DataSourceService,\r\n  FeatureStore,\r\n  FeatureWithDraw,\r\n  IgoMap,\r\n  LayerService,\r\n  MapService\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-draw',\r\n  templateUrl: './draw.component.html',\r\n  styleUrls: ['./draw.component.scss']\r\n})\r\nexport class AppDrawComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6,\r\n    projection: 'EPSG:3857'\r\n  };\r\n\r\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mapService: MapService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Draw\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/draw\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-draw [stores]=\"stores\" [map]=\"map\"></igo-draw>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoDrawModule, IgoMapModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppDrawRoutingModule } from './draw-routing.module';\r\nimport { AppDrawComponent } from './draw.component';\r\n\r\n@NgModule({\r\n  declarations: [AppDrawComponent],\r\n  imports: [AppDrawRoutingModule, SharedModule, IgoMapModule, IgoDrawModule],\r\n  exports: [AppDrawComponent]\r\n})\r\nexport class AppDrawModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppFeatureComponent } from './feature.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'feature',\r\n    component: AppFeatureComponent\r\n  }\r\n];\r\n\r\nexport const AppFeatureRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  DataSourceService,\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  IgoMap,\r\n  LayerService,\r\n  VectorLayer\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-feature',\r\n  templateUrl: './feature.component.html',\r\n  styleUrls: ['./feature.component.scss']\r\n})\r\nexport class AppFeatureComponent implements OnInit, OnDestroy {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  public tableTemplate = {\r\n    selection: true,\r\n    selectMany: true,\r\n    sort: true,\r\n    columns: [\r\n      {\r\n        name: 'properties.id',\r\n        title: 'ID'\r\n      },\r\n      {\r\n        name: 'properties.name',\r\n        title: 'Name'\r\n      },\r\n      {\r\n        name: 'properties.description',\r\n        title: 'Description'\r\n      }\r\n    ]\r\n  };\r\n\r\n  public store = new FeatureStore([], { map: this.map });\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    const loadingStrategy = new FeatureStoreLoadingStrategy({});\r\n    this.store.addStrategy(loadingStrategy);\r\n\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      map: this.map,\r\n      motion: FeatureMotion.Default\r\n    });\r\n    this.store.addStrategy(selectionStrategy);\r\n\r\n    this.store.load([\r\n      {\r\n        meta: { id: 1 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [-72, 47.8]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 1,\r\n          name: 'Name 1',\r\n          description: 'Description 1'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 4 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [-71, 46.8]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 4,\r\n          name: 'Name 4',\r\n          description: 'Description 4'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 5 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [-73, 45.8]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 5,\r\n          name: 'Name 5',\r\n          description: 'Description 5'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 2 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'LineString',\r\n          coordinates: [\r\n            [-72, 47.8],\r\n            [-73.5, 47.4],\r\n            [-72.4, 48.6]\r\n          ]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 2,\r\n          name: 'Name 2',\r\n          description: 'Description 2'\r\n        }\r\n      },\r\n      {\r\n        meta: { id: 3 },\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Polygon',\r\n          coordinates: [\r\n            [\r\n              [-71, 46.8],\r\n              [-73, 47],\r\n              [-71.2, 46.6]\r\n            ]\r\n          ]\r\n        },\r\n        projection: 'EPSG:4326',\r\n        properties: {\r\n          id: 3,\r\n          name: 'Name 3',\r\n          description: 'Description 3'\r\n        }\r\n      }\r\n    ]);\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'MVT test',\r\n        visible: true,\r\n        sourceOptions: {\r\n          type: 'mvt',\r\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\r\n          queryable: true\r\n        },\r\n        igoStyle: {\r\n          mapboxStyle: {\r\n            url: 'assets/mapboxStyleExample-vectortile.json',\r\n            source: 'ahocevar'\r\n          }\r\n        }\r\n      } as any)\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'vector'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        const layer = this.layerService.createLayer({\r\n          title: 'Vector Layer',\r\n          source: dataSource,\r\n          animation: {\r\n            duration: 2000\r\n          },\r\n          igoStyle: {\r\n            mapboxStyle: {\r\n              url: 'assets/mapboxStyleExample-feature.json',\r\n              source: 'source_nameX'\r\n            }\r\n          }\r\n        }) as VectorLayer;\r\n        this.map.addLayer(layer);\r\n        this.store.bindLayer(layer);\r\n        loadingStrategy.activate();\r\n        selectionStrategy.activate();\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Overlay\" subtitle=\"Feature\">\r\n  <app-example-viewer codeFolder=\"geo/feature\">\r\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    </igo-map-browser>\r\n\r\n    <igo-entity-table [store]=\"store\" [template]=\"tableTemplate\">\r\n    </igo-entity-table>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoEntityTableModule, IgoPanelModule } from '@igo2/common';\r\nimport { IgoFeatureModule, IgoMapModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppFeatureRoutingModule } from './feature-routing.module';\r\nimport { AppFeatureComponent } from './feature.component';\r\n\r\n@NgModule({\r\n  declarations: [AppFeatureComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppFeatureRoutingModule,\r\n    IgoPanelModule,\r\n    IgoEntityTableModule,\r\n    IgoMapModule,\r\n    IgoFeatureModule\r\n  ],\r\n  exports: [AppFeatureComponent]\r\n})\r\nexport class AppFeatureModule {}\r\n","<app-doc-viewer title=\"Geometry Form\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/geometry\">\n    <div class=\"container\">\n      <igo-map-browser [map]=\"map\" [view]=\"view\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n      </igo-map-browser>\n\n      <igo-form\n        *ngIf=\"form$ | async as form\"\n        [form]=\"form\"\n        [formData]=\"data$ | async\"\n        (submitForm)=\"onSubmit($event)\"\n      >\n        <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n        <div formButtons class=\"actions-container\">\n          <button\n            mat-stroked-button\n            type=\"button\"\n            color=\"primary\"\n            (click)=\"fillForm()\"\n          >\n            Fill Form\n          </button>\n          <button\n            mat-stroked-button\n            type=\"button\"\n            color=\"primary\"\n            (click)=\"clearForm()\"\n          >\n            Clear Form\n          </button>\n          <button\n            mat-flat-button\n            type=\"submit\"\n            color=\"primary\"\n            [disabled]=\"submitDisabled\"\n          >\n            Submit\n          </button>\n        </div>\n      </igo-form>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppGeometryComponent } from './geometry.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'geometry',\r\n    component: AppGeometryComponent\r\n  }\r\n];\r\n\r\nexport const AppGeometryRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { Validators } from '@angular/forms';\r\n\r\nimport { Form, FormService } from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { DataSourceService, IgoMap, LayerService } from '@igo2/geo';\r\n\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-geometry',\r\n  templateUrl: './geometry.component.html',\r\n  styleUrls: ['./geometry.component.scss']\r\n})\r\nexport class AppGeometryComponent implements OnInit, OnDestroy {\r\n  map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  view = {\r\n    center: [-73, 47.2],\r\n    zoom: 15\r\n  };\r\n\r\n  form$ = new BehaviorSubject<Form>(undefined);\r\n\r\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\r\n\r\n  submitDisabled = true;\r\n\r\n  private valueChanges$$: Subscription;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private formService: FormService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    const fieldConfigs = [\r\n      {\r\n        name: 'geometry',\r\n        title: 'Geometry',\r\n        options: {\r\n          validator: Validators.required\r\n        },\r\n        type: 'geometry',\r\n        inputs: {\r\n          map: this.map,\r\n          geometryTypeField: true,\r\n          geometryType: 'Polygon',\r\n          drawGuideField: true,\r\n          drawGuide: 50,\r\n          drawGuidePlaceholder: 'Draw Guide',\r\n          drawStyle: new olstyle.Style({\r\n            stroke: new olstyle.Stroke({\r\n              color: [255, 0, 0, 1],\r\n              width: 2\r\n            }),\r\n            fill: new olstyle.Fill({\r\n              color: [255, 0, 0, 0.2]\r\n            }),\r\n            image: new olstyle.Circle({\r\n              radius: 8,\r\n              stroke: new olstyle.Stroke({\r\n                color: [255, 0, 0, 1]\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: [255, 0, 0, 0.2]\r\n              })\r\n            })\r\n          })\r\n        }\r\n      },\r\n      {\r\n        name: 'name',\r\n        title: 'Name',\r\n        options: {\r\n          validator: Validators.required\r\n        }\r\n      }\r\n    ];\r\n\r\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\r\n    const form = this.formService.form(\r\n      [],\r\n      [this.formService.group({ name: 'info' }, fields)]\r\n    );\r\n\r\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\r\n      this.submitDisabled = !form.control.valid;\r\n    });\r\n\r\n    this.form$.next(form);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.valueChanges$$.unsubscribe();\r\n  }\r\n\r\n  fillForm() {\r\n    this.data$.next({\r\n      name: 'Place',\r\n      geometry: JSON.stringify({\r\n        type: 'Polygon',\r\n        coordinates: [\r\n          [\r\n            [-106, 42],\r\n            [-107, 31],\r\n            [-81, 32],\r\n            [-82, 42],\r\n            [-106, 42]\r\n          ]\r\n        ]\r\n      })\r\n    });\r\n  }\r\n\r\n  clearForm() {\r\n    this.form$.value.control.reset();\r\n  }\r\n\r\n  onSubmit(data: { [key: string]: any }) {\r\n    alert(JSON.stringify(data));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoFormModule } from '@igo2/common';\r\nimport { IgoGeometryModule, IgoMapModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppGeometryRoutingModule } from './geometry-routing.module';\r\nimport { AppGeometryComponent } from './geometry.component';\r\n\r\n@NgModule({\r\n  declarations: [AppGeometryComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppGeometryRoutingModule,\r\n    IgoFormModule,\r\n    IgoGeometryModule,\r\n    IgoMapModule\r\n  ],\r\n  exports: [AppGeometryComponent]\r\n})\r\nexport class AppGeometryModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppHoverComponent } from './hover.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'hover',\r\n    component: AppHoverComponent\r\n  }\r\n];\r\n\r\nexport const AppHoverRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\nimport {\r\n  DataSourceService,\r\n  IgoMap,\r\n  LayerService,\r\n  VectorLayerOptions,\r\n  WFSDataSource,\r\n  WFSDataSourceOptions\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-hover',\r\n  templateUrl: './hover.component.html',\r\n  styleUrls: ['./hover.component.scss']\r\n})\r\nexport class AppHoverComponent {\r\n  public selected;\r\n  public pointerCoord;\r\n  public pointerCoordDelay: number = 0;\r\n  public pointerHoverFeatureDelay: number = 0;\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 8,\r\n    projection: 'EPSG:3857'\r\n  };\r\n\r\n  get media() {\r\n    return this.mediaService.getMedia();\r\n  }\r\n\r\n  get isTouchScreen() {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mediaService: MediaService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wmts',\r\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\r\n        layer: 'carte_gouv_qc_public',\r\n        matrixSet: 'EPSG_3857',\r\n        version: '1.3.0'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Quebec',\r\n            visible: true,\r\n            baseLayer: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSDataOptions extends WFSDataSourceOptions {}\r\n\r\n    const wfsDatasourcePolygon: WFSDataOptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'adn_bassin_n1_public_v',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '3.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasourcePolygon)\r\n      .subscribe((dataSource: WFSDataSource) => {\r\n        const layer: VectorLayerOptions = {\r\n          title: 'WFS (polygon)',\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    const wfsDatasourcePoint: WFSDataOptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\r\n      params: {\r\n        featureTypes: 'MSP_CASERNE_PUBLIC',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasourcePoint)\r\n      .subscribe((dataSource: WFSDataSource) => {\r\n        const layer: VectorLayerOptions = {\r\n          title: 'WFS (point)',\r\n          visible: true,\r\n          source: dataSource,\r\n          igoStyle: {\r\n            styleByAttribute: {\r\n              attribute: 'en_caserne',\r\n              data: ['true', 'false'],\r\n              stroke: ['red', 'blue'],\r\n              fill: ['#ffffff', '#ffffff'],\r\n              radius: [7, 7],\r\n              width: [2, 2]\r\n            },\r\n            hoverStyle: {\r\n              label: {\r\n                attribute: 'Caserne: ${no_caserne}\\n Mun: ${nom_ssi}',\r\n                style: {\r\n                  textAlign: 'left',\r\n                  textBaseline: 'top',\r\n                  font: '12px Calibri,sans-serif',\r\n                  fill: { color: '#000' },\r\n                  backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\r\n                  backgroundStroke: {\r\n                    color: 'rgba(200, 200, 200, 0.75)',\r\n                    width: 2\r\n                  },\r\n                  stroke: { color: '#fff', width: 3 },\r\n                  overflow: true,\r\n                  offsetX: 20,\r\n                  offsetY: 10,\r\n                  padding: [2.5, 2.5, 2.5, 2.5]\r\n                }\r\n              },\r\n              baseStyle: {\r\n                circle: {\r\n                  stroke: {\r\n                    color: 'orange',\r\n                    width: 5\r\n                  },\r\n                  width: [5],\r\n                  radius: 15\r\n                }\r\n              }\r\n            }\r\n          }\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Hover\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/hover\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoHoverFeature\n      [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\n      [igoHoverFeatureEnabled]=\"true\"\n    >\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n      <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n      <igo-home-extent-button\n        [map]=\"map\"\n        color=\"primary\"\n      ></igo-home-extent-button>\n      <igo-rotation-button\n        [map]=\"map\"\n        [showIfNoRotation]=\"true\"\n        color=\"primary\"\n      ></igo-rotation-button>\n    </igo-map-browser>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMapModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppHoverRoutingModule } from './hover-routing.module';\r\nimport { AppHoverComponent } from './hover.component';\r\n\r\n@NgModule({\r\n  declarations: [AppHoverComponent],\r\n  imports: [SharedModule, AppHoverRoutingModule, IgoMapModule],\r\n  exports: [AppHoverComponent]\r\n})\r\nexport class AppHoverModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppImportExportComponent } from './import-export.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'import-export',\r\n    component: AppImportExportComponent\r\n  }\r\n];\r\n\r\nexport const AppImportExportRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { WorkspaceStore } from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { IgoMap, LayerService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-import-export',\r\n  templateUrl: './import-export.component.html',\r\n  styleUrls: ['./import-export.component.scss']\r\n})\r\nexport class AppImportExportComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 9\r\n  };\r\n\r\n  public store = new WorkspaceStore([]);\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Import / Export\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/import-export\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-import-export\n            class=\"w-100\"\n            [store]=\"store\"\n            [map]=\"map\"\n          ></igo-import-export>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\nimport {\r\n  IgoImportExportModule,\r\n  IgoMapModule,\r\n  IgoStyleModule,\r\n  provideStyleListOptions\r\n} from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppImportExportRoutingModule } from './import-export-routing.module';\r\nimport { AppImportExportComponent } from './import-export.component';\r\n\r\n@NgModule({\r\n  declarations: [AppImportExportComponent],\r\n  imports: [\r\n    AppImportExportRoutingModule,\r\n    SharedModule,\r\n    IgoMessageModule,\r\n    IgoMapModule,\r\n    IgoStyleModule,\r\n    IgoImportExportModule\r\n  ],\r\n  exports: [AppImportExportComponent],\r\n  providers: [\r\n    provideStyleListOptions({\r\n      path: './assets/import-style.json'\r\n    })\r\n  ]\r\n})\r\nexport class AppImportExport {}\r\n","<app-doc-viewer\n  title=\"Layer\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/layer\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-layer-list\n              [map]=\"map\"\n              [layers]=\"map.layers\"\n              [expandLegendOfVisibleLayers]=\"false\"\n              floatLabel=\"never\"\n              [queryBadge]=\"true\"\n            >\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n                <igo-download-button [layer]=\"layer\"></igo-download-button>\n                <igo-ogc-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-ogc-filter-button>\n                <igo-time-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-time-filter-button>\n                <igo-track-feature-button\n                  [layer]=\"layer\"\n                  [trackFeature]=\"true\"\n                ></igo-track-feature-button>\n              </ng-template>\n            </igo-layer-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppLayerComponent } from './layer.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'layer',\r\n    component: AppLayerComponent\r\n  }\r\n];\r\n\r\nexport const AppLayerRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  DataSourceService,\r\n  IgoMap,\r\n  LayerOptions,\r\n  LayerService,\r\n  MetadataLayerOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  WFSDataSourceOptions,\r\n  WMSDataSourceOptions\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-layer',\r\n  templateUrl: './layer.component.html',\r\n  styleUrls: ['./layer.component.scss']\r\n})\r\nexport class AppLayerComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            visible: true,\r\n            baseLayer: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const wfsDatasource: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: 'geojson',\r\n        outputFormatDownload: 'shp'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: false,\r\n        filters: {\r\n          operator: 'PropertyIsEqualTo',\r\n          propertyName: 'code_municipalite',\r\n          expression: '10043'\r\n        }\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasource)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptions = {\r\n          title: 'WFS ',\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    const wfsDatasourceCustomEPSG: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: 'geojson_utf8',\r\n        srsName: 'EPSG:32198',\r\n        outputFormatDownload: 'shp'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: false,\r\n        filters: {\r\n          operator: 'PropertyIsEqualTo',\r\n          propertyName: 'code_municipalite',\r\n          expression: '12072'\r\n        }\r\n      },\r\n      formatOptions: {\r\n        dataProjection: 'EPSG:32198'\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptions = {\r\n          title: 'WFS (Custom EPSG)',\r\n          visible: true,\r\n          source: dataSource,\r\n          removable: false\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'parc_routier',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Rseau routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'lieu habit',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'lieuhabite',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'sh_dis_eco',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'sh_dis_eco',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'nurc:Arc_Sample_Parent',\r\n        visible: false,\r\n        legendOptions: {\r\n          // collapsed: false,\r\n          display: true,\r\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\r\n          stylesAvailable: [\r\n            { name: 'rain', title: 'Pluie' },\r\n            { name: 'raster', title: 'Dfaut' }\r\n          ] //\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Avertissements routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'evenements',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    const datasource: WMSDataSourceOptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      refreshIntervalSec: 15,\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n        VERSION: '1.3.0'\r\n      }\r\n    };\r\n\r\n    interface LayerOptionsWithMetadata\r\n      extends LayerOptions,\r\n        MetadataLayerOptions {}\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasource)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptionsWithMetadata = {\r\n          title: 'Embcle',\r\n          source: dataSource,\r\n          metadata: {\r\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\r\n            extern: true\r\n          }\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport {\r\n  IgoDownloadModule,\r\n  IgoFilterModule,\r\n  IgoLayerModule,\r\n  IgoMapModule,\r\n  IgoMetadataModule\r\n} from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppLayerRoutingModule } from './layer-routing.module';\r\nimport { AppLayerComponent } from './layer.component';\r\n\r\n@NgModule({\r\n  declarations: [AppLayerComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppLayerRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoLayerModule,\r\n    IgoFilterModule,\r\n    IgoMetadataModule,\r\n    IgoDownloadModule\r\n  ],\r\n  exports: [AppLayerComponent]\r\n})\r\nexport class AppLayerModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppLegendComponent } from './legend.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'legend',\r\n    component: AppLegendComponent\r\n  }\r\n];\r\n\r\nexport const AppLegendRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  DataSourceService,\r\n  IgoMap,\r\n  LayerOptions,\r\n  LayerService,\r\n  MetadataLayerOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  WFSDataSourceOptions,\r\n  WMSDataSourceOptions\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-legend',\r\n  templateUrl: './legend.component.html',\r\n  styleUrls: ['./legend.component.scss']\r\n})\r\nexport class AppLegendComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            visible: true,\r\n            baseLayer: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const wfsDatasource: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'shp'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        filters: {\r\n          operator: 'PropertyIsEqualTo',\r\n          propertyName: 'code_municipalite',\r\n          expression: '10043'\r\n        }\r\n      }\r\n    };\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'legend with display:false',\r\n        visible: true,\r\n        legendOptions: {\r\n          display: false,\r\n          html: 'test html'\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'sh_dis_eco',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'legend in html',\r\n        visible: true,\r\n        legendOptions: {\r\n          display: true,\r\n          html: '<h2 style=\"background-color: blue;\">HTML lgende</h2>'\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n          optionsFromCapabilities: false,\r\n          params: {\r\n            LAYERS: 'sh_sreg_eco',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'legend with url param',\r\n        visible: true,\r\n        legendOptions: {\r\n          url: `data:image/jpeg;base64,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`\r\n        },\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'sh_reg_eco',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDatasource)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptions = {\r\n          title: 'WFS ',\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Commission scolaire anglophone',\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\r\n          params: {\r\n            LAYERS: 'WMS_MEQ_CS_ANGLO',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Rseau routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'lieu habit',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          optionsFromCapabilities: true,\r\n          params: {\r\n            LAYERS: 'lieuhabite',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Avertissements routier',\r\n        visible: false,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n          params: {\r\n            LAYERS: 'evenements',\r\n            VERSION: '1.3.0'\r\n          }\r\n        }\r\n      })\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    const datasource: WMSDataSourceOptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      refreshIntervalSec: 15,\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n        VERSION: '1.3.0'\r\n      }\r\n    };\r\n\r\n    interface LayerOptionsWithMetadata\r\n      extends LayerOptions,\r\n        MetadataLayerOptions {}\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasource)\r\n      .subscribe((dataSource) => {\r\n        const layer: LayerOptionsWithMetadata = {\r\n          title: 'Embcle',\r\n          visible: true,\r\n          source: dataSource,\r\n          metadata: {\r\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\r\n            extern: true\r\n          }\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Simple Map with a legend list\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/legend\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-panel title=\"Legends\">\n      <igo-layer-legend-list\n        [layers]=\"map.layers\"\n        [excludeBaseLayers]=\"true\"\n        [allowShowAllLegends]=\"true\"\n        [updateLegendOnResolutionChange]=\"false\"\n        [showAllLegendsValue]=\"false\"\n      >\n      </igo-layer-legend-list>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport {\r\n  IgoDownloadModule,\r\n  IgoFilterModule,\r\n  IgoLayerModule,\r\n  IgoMapModule,\r\n  IgoMetadataModule\r\n} from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppLegendRoutingModule } from './legend-routing.module';\r\nimport { AppLegendComponent } from './legend.component';\r\n\r\n@NgModule({\r\n  declarations: [AppLegendComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppLegendRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoLayerModule,\r\n    IgoFilterModule,\r\n    IgoMetadataModule,\r\n    IgoDownloadModule\r\n  ],\r\n  exports: [AppLegendComponent]\r\n})\r\nexport class AppLegendModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppMeasureComponent } from './measure.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'measure',\r\n    component: AppMeasureComponent\r\n  }\r\n];\r\n\r\nexport const AppMeasureRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  DataSourceService,\r\n  FeatureStore,\r\n  FeatureWithMeasure,\r\n  IgoMap,\r\n  LayerService\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-measure',\r\n  templateUrl: './measure.component.html',\r\n  styleUrls: ['./measure.component.scss']\r\n})\r\nexport class AppMeasureComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6,\r\n    projection: 'EPSG:3857'\r\n  };\r\n\r\n  public store = new FeatureStore<FeatureWithMeasure>([], { map: this.map });\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Measure\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/measure\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMapModule, IgoMeasureModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppMeasureRoutingModule } from './measure-routing.module';\r\nimport { AppMeasureComponent } from './measure.component';\r\n\r\n@NgModule({\r\n  declarations: [AppMeasureComponent],\r\n  imports: [\r\n    AppMeasureRoutingModule,\r\n    SharedModule,\r\n    IgoMapModule,\r\n    IgoMeasureModule\r\n  ],\r\n  exports: [AppMeasureComponent]\r\n})\r\nexport class AppMeasureModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppOgcFilterComponent } from './ogc-filter.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'ogc-filter',\r\n    component: AppOgcFilterComponent\r\n  }\r\n];\r\n\r\nexport const AppOgcFilterRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  AnyBaseOgcFilterOptions,\r\n  DataSourceService,\r\n  IgoMap,\r\n  LayerService,\r\n  OgcFilterDuringOptions,\r\n  OgcFilterOperatorType,\r\n  OgcFilterableDataSourceOptions,\r\n  WFSDataSourceOptions,\r\n  WFSDataSourceOptionsParams,\r\n  WMSDataSourceOptions\r\n} from '@igo2/geo';\r\n\r\nimport { Circle, Fill, Stroke, Style } from 'ol/style';\r\n\r\n@Component({\r\n  selector: 'app-ogc-filter',\r\n  templateUrl: './ogc-filter.component.html',\r\n  styleUrls: ['./ogc-filter.component.scss']\r\n})\r\nexport class AppOgcFilterComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WFSoptions\r\n      extends WFSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const datasource: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        { name: 'code_municipalite', alias: '# de la municipalite' },\r\n        { name: 'date_observation', excludeFromOgcFilters: true },\r\n        { name: 'urgence', values: ['immdiate', 'inconnue'] }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          logical: 'Or',\r\n          filters: [\r\n            {\r\n              operator: 'PropertyIsEqualTo',\r\n              propertyName: 'code_municipalite',\r\n              expression: '10043'\r\n            },\r\n            {\r\n              operator: 'Intersects',\r\n              geometryName: 'the_geom',\r\n              wkt_geometry: `MULTIPOLYGON(((\r\n              -8379441.158019895 5844447.897707146,\r\n              -8379441.158019895 5936172.331649357,\r\n              -8134842.66750733 5936172.331649357,\r\n              -8134842.66750733 5844447.897707146,\r\n              -8379441.158019895 5844447.897707146\r\n            ), (\r\n              -8015003 5942074,\r\n              -8015003 5780349,\r\n              -7792364 5780349,\r\n              -7792364 5942074,\r\n              -8015003 5942074\r\n            )))`\r\n            }\r\n          ] as AnyBaseOgcFilterOptions[]\r\n        }\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasource)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (PropertyIsEqualTo OR Intersects)',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'orange',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilter: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2016-01-21T00:00:00-05:00',\r\n          end: '2016-01-26T00:00:00-05:00'\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2016-02-10T00:00:00-05:00',\r\n      stepDate: 'P2D'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilter)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: P2D)',\r\n            id: '1',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'red',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTime: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2016-01-01T04:00:00-05:00',\r\n          end: '2016-01-12T16:00:00-05:00'\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2016-02-14T20:00:00-05:00',\r\n      stepDate: 'PT4H'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTime)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: PT4H)',\r\n            id: '2',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'blue',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeMonth: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2016-01-01T00:00:00-05:00',\r\n          end: '2016-03-31T00:00:00-05:00',\r\n          displayFormat: 'MMMM'\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2018-12-31T00:00:00-05:00',\r\n      stepDate: 'P1M'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: P1M)',\r\n            id: '3',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'yellow',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeYear: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2014-01-01T00:00:00-05:00',\r\n          end: '2019-12-31T00:00:00-05:00',\r\n          sliderOptions: {\r\n            interval: 2000,\r\n            displayFormat: 'YY'\r\n          },\r\n          displayFormat: 'YYYY'\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2014-01-01T00:00:00-05:00',\r\n      maxDate: '2019-12-31T00:00:00-05:00',\r\n      stepDate: 'P1Y'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Step: P1Y)',\r\n            id: '4',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'green',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeInterval: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\r\n          end: 'today' // \"now\" can also be used. Instead of midnight, the current time will be used\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2025-12-31T00:00:00-05:00',\r\n      stepDate: 'P1D'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, Interval from Now, Step: P1D)',\r\n            id: '5',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'white'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'black',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const datasourceDuringFilterTimeRestrictedToStep: WFSoptions = {\r\n      type: 'wfs',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        featureTypes: 'vg_observation_v_autre_wmst',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '2.0.0',\r\n        outputFormat: undefined,\r\n        outputFormatDownload: 'SHP' // based on service capabilities\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        allowedOperatorsType: OgcFilterOperatorType.All,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation',\r\n          begin: '2019-01-01 00:00:00',\r\n          restrictToStep: true\r\n        } as OgcFilterDuringOptions\r\n      },\r\n      minDate: '2016-01-01T00:00:00-05:00',\r\n      maxDate: '2025-12-31T00:00:00-05:00',\r\n      stepDate: 'P1M'\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle (During, RestrictToStep, Step: P1M)',\r\n            id: '6',\r\n            source: dataSource,\r\n            style: new Style({\r\n              image: new Circle({\r\n                radius: 5,\r\n                fill: new Fill({\r\n                  color: 'black'\r\n                }),\r\n                stroke: new Stroke({\r\n                  color: 'red',\r\n                  width: 1\r\n                })\r\n              })\r\n            })\r\n          })\r\n        );\r\n      });\r\n\r\n    const wmsOgcFilterOptions: WMSoptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\r\n      optionsFromCapabilities: true,\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation23avril2017_wmst',\r\n        VERSION: '1.3.0'\r\n      },\r\n      sourceFields: [\r\n        {\r\n          name: 'date_observation',\r\n          alias: \"Date de l'observation\",\r\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\r\n        }\r\n      ],\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        filters: {\r\n          operator: 'During',\r\n          propertyName: 'date_observation'\r\n        } as OgcFilterDuringOptions,\r\n        allowedOperatorsType: OgcFilterOperatorType.Time\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wmsOgcFilterOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Inondation (During, optionsFromCapabilities)',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    interface WMSoptions\r\n      extends WMSDataSourceOptions,\r\n        OgcFilterableDataSourceOptions {}\r\n\r\n    const filterableWMSwithPushButtons: WMSoptions = {\r\n      type: 'wms',\r\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n      params: {\r\n        LAYERS: 'radars_photos',\r\n        VERSION: '1.3.0'\r\n      },\r\n      ogcFilters: {\r\n        enabled: true,\r\n        editable: true,\r\n        pushButtons: {\r\n          selectorType: 'pushButton',\r\n          order: 2,\r\n          groups: [\r\n            { title: 'Nom du group1 - push', name: '1 - push', ids: ['id1'] }\r\n          ],\r\n          bundles: [\r\n            {\r\n              id: 'id1',\r\n              title: 'Rgions',\r\n              logical: 'Or',\r\n              vertical: true,\r\n              selectors: [\r\n                {\r\n                  title: 'Montral & Laval',\r\n                  enabled: false,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    logical: 'Or',\r\n                    filters: [\r\n                      {\r\n                        operator: 'PropertyIsEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Montral'\r\n                      },\r\n                      {\r\n                        operator: 'PropertyIsEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Laval'\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Outside Montral & Laval',\r\n                  enabled: false,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    logical: 'And',\r\n                    filters: [\r\n                      {\r\n                        operator: 'PropertyIsNotEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Montral'\r\n                      },\r\n                      {\r\n                        operator: 'PropertyIsNotEqualTo',\r\n                        propertyName: 'region',\r\n                        expression: 'Laval'\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        },\r\n        checkboxes: {\r\n          selectorType: 'checkbox',\r\n          order: 1,\r\n          groups: [\r\n            {\r\n              title: 'Nom du group1 - checkbox',\r\n              name: '1 - checkbox',\r\n              ids: ['id1']\r\n            }\r\n          ],\r\n          bundles: [\r\n            {\r\n              id: 'id1',\r\n              title: 'Type de radar photo',\r\n              logical: 'Or',\r\n              selectors: [\r\n                {\r\n                  title: 'Radar photo fixe',\r\n                  enabled: true,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Radar photo fixe'\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Radar photo mobile',\r\n                  enabled: false,\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Radar photo mobile'\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Radar photo fixe + feu rouge',\r\n                  enabled: false,\r\n                  color: '0,200,0',\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\r\n                  }\r\n                },\r\n                {\r\n                  title: 'Radar feu rouge',\r\n                  enabled: false,\r\n                  color: '255,0,0',\r\n                  tooltip: 'Here a tooltip explaning ...',\r\n                  filters: {\r\n                    operator: 'PropertyIsEqualTo',\r\n                    propertyName: 'typeAppareil',\r\n                    expression: 'Appareil de surveillance au feu rouge'\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        },\r\n        allowedOperatorsType: OgcFilterOperatorType.Basic\r\n      },\r\n      paramsWFS: {\r\n        featureTypes: 'radars_photos',\r\n        fieldNameGeometry: 'geometry',\r\n        maxFeatures: 10000,\r\n        version: '1.1.0',\r\n        outputFormat: 'geojson',\r\n        outputFormatDownload: 'shp'\r\n      } as WFSDataSourceOptionsParams\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(filterableWMSwithPushButtons)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title:\r\n              'Filterable WMS layers with predefined filters (push buttons)',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    // const datasourceWmsWith2Layers: WMSoptions = {\r\n    //   type: 'wms',\r\n    //   url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n    //   urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n    //   params: {\r\n    //     layers: 'stations_meteoroutieres,histo_stations_meteoroutieres',\r\n    //     version: '1.3.0'\r\n    //   },\r\n    //   ogcFilters: {\r\n    //     enabled: true,\r\n    //     editable: true\r\n    //   },\r\n    //   paramsWFS: {\r\n    //     featureTypes: 'histo_stations_meteoroutieres',\r\n    //     fieldNameGeometry: 'geometry',\r\n    //     maxFeatures: 10000,\r\n    //     version: '1.1.0',\r\n    //     outputFormat: 'geojson',\r\n    //     outputFormatDownload: 'shp'\r\n    //   } as WFSDataSourceOptionsParams\r\n    // };\r\n    //\r\n    // this.dataSourceService\r\n    //   .createAsyncDataSource(datasourceWmsWith2Layers)\r\n    //   .subscribe(dataSource => {\r\n    //     this.map.addLayer(\r\n    //       this.layerService.createLayer({\r\n    //         title: 'Layer build from 2 WMS layers',\r\n    //         source: dataSource\r\n    //       })\r\n    //     );\r\n    //   });\r\n\r\n    // const datasourceWms: WMSoptions = {\r\n    //   type: 'wms',\r\n    //   url: '/geoserver/wms',\r\n    //   urlWfs: '/geoserver/wfs',\r\n    //   params: {\r\n    //     LAYERS: 'water_areas',\r\n    //     VERSION: '1.3.0'\r\n    //   },\r\n    //   ogcFilters: {\r\n    //     enabled: true,\r\n    //     editable: true,\r\n    //     filters: {\r\n    //       operator: 'PropertyIsEqualTo',\r\n    //       propertyName: 'waterway',\r\n    //       expression: 'riverbank'\r\n    //     }\r\n    //   },\r\n    //   sourceFields: [\r\n    //     { name: 'waterway', alias: 'Chemin d eau' },\r\n    //     { name: 'osm_id' },\r\n    //     { name: 'landuse', values: ['yes', 'no'] }\r\n    //   ],\r\n    //   paramsWFS: {\r\n    //     featureTypes: 'water_areas',\r\n    //     fieldNameGeometry: 'the_geom',\r\n    //     maxFeatures: 10000,\r\n    //     version: '1.1.0',\r\n    //     outputFormat: 'application/json',\r\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\r\n    //   } as WFSDataSourceOptionsParams\r\n    // };\r\n    //\r\n    // this.dataSourceService\r\n    //   .createAsyncDataSource(datasourceWms)\r\n    //   .subscribe(dataSource => {\r\n    //     this.map.addLayer(\r\n    //       this.layerService.createLayer({\r\n    //         title: 'Geoserver water_areas',\r\n    //         source: dataSource\r\n    //       })\r\n    //     );\r\n    //   });\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Ogc filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/ogc-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-panel title=\"Layers\">\n            <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\n            </igo-ogc-filterable-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport { IgoFilterModule, IgoMapModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppOgcFilterRoutingModule } from './ogc-filter-routing.module';\r\nimport { AppOgcFilterComponent } from './ogc-filter.component';\r\n\r\n@NgModule({\r\n  declarations: [AppOgcFilterComponent],\r\n  imports: [\r\n    AppOgcFilterRoutingModule,\r\n    SharedModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoFilterModule\r\n  ],\r\n  exports: [AppOgcFilterComponent]\r\n})\r\nexport class AppOgcFilterModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppOverlayComponent } from './overlay.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'overlay',\r\n    component: AppOverlayComponent\r\n  }\r\n];\r\n\r\nexport const AppOverlayRoutingModule = RouterModule.forChild(routes);\r\n","import { AfterViewInit, Component, OnInit } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  DataSourceService,\r\n  FEATURE,\r\n  Feature,\r\n  FeatureMotion,\r\n  IgoMap,\r\n  LayerService\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-overlay',\r\n  templateUrl: './overlay.component.html',\r\n  styleUrls: ['./overlay.component.scss']\r\n})\r\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\r\n  public map = new IgoMap({\r\n    overlay: true,\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    const feature1: Feature = {\r\n      type: FEATURE,\r\n      projection: 'EPSG:4326',\r\n      meta: {\r\n        id: 1\r\n      },\r\n      properties: {},\r\n      geometry: {\r\n        type: 'Point',\r\n        coordinates: [-73, 46.6]\r\n      }\r\n    };\r\n\r\n    const feature2: Feature = {\r\n      type: FEATURE,\r\n      projection: 'EPSG:4326',\r\n      meta: {\r\n        id: 2\r\n      },\r\n      properties: {},\r\n      geometry: {\r\n        type: 'LineString',\r\n        coordinates: [\r\n          [-72, 47.8],\r\n          [-73.5, 47.4],\r\n          [-72.4, 48.6]\r\n        ]\r\n      }\r\n    };\r\n\r\n    const feature3: Feature = {\r\n      type: FEATURE,\r\n      projection: 'EPSG:4326',\r\n      meta: {\r\n        id: 3\r\n      },\r\n      properties: {},\r\n      geometry: {\r\n        type: 'Polygon',\r\n        coordinates: [\r\n          [\r\n            [-71, 46.8],\r\n            [-73, 47],\r\n            [-71.2, 46.6]\r\n          ]\r\n        ]\r\n      }\r\n    };\r\n\r\n    this.map.overlay.setFeatures(\r\n      [feature1, feature2, feature3],\r\n      FeatureMotion.None\r\n    );\r\n  }\r\n}\r\n","<app-doc-viewer title=\"Overlay\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/overlay\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMapModule, IgoOverlayModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppOverlayRoutingModule } from './overlay-routing.module';\r\nimport { AppOverlayComponent } from './overlay.component';\r\n\r\n@NgModule({\r\n  declarations: [AppOverlayComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppOverlayRoutingModule,\r\n    IgoMapModule,\r\n    IgoOverlayModule\r\n  ],\r\n  exports: [AppOverlayComponent]\r\n})\r\nexport class AppOverlayModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppPrintComponent } from './print.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'print',\r\n    component: AppPrintComponent\r\n  }\r\n];\r\n\r\nexport const AppPrintRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-print',\n  templateUrl: './print.component.html',\n  styleUrls: ['./print.component.scss']\n})\nexport class AppPrintComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: false\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        sourceOptions: {\n          type: 'wmts',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n          layer: 'carte_gouv_qc_ro',\n          matrixSet: 'EPSG_3857',\n          version: '1.3.0',\n          crossOrigin: 'anonymous',\n          attributions:\n            \" <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Qubec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>\"\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'School board',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'MELS_CS_ANGLO_S',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n    //\n    this.layerService\n      .createAsyncLayer({\n        title: 'Embacle',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    // this.layerService\n    //   .createAsyncLayer({\n    //     title: 'Geomet',\n    //     sourceOptions: {\n    //       type: 'wms',\n    //       url: 'http://geo.weather.gc.ca/geomet/?lang=fr',\n    //       params: {\n    //         LAYERS: 'RADAR_1KM_RDBR',\n    //         VERSION: '1.3.0'\n    //       },\n    //       crossOrigin: 'anonymous'\n    //     }\n    //   })\n    //   .subscribe(l => this.map.addLayer(l));\n\n    /*\n        //CORS error if activate (for test)\n        this.layerService\n          .createAsyncLayer({\n            title: 'Geomet',\n            sourceOptions: {\n              type: 'wms',\n              url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wms',\n              params: {\n                layers: 'swtq',\n                version: '1.3.0',\n              }\n            }\n          })\n          .subscribe(l => this.map.addLayer(l));\n    */\n  }\n}\n","<app-doc-viewer\n  title=\"Print\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/print\">\n    <mat-grid-list cols=\"2\" rowHeight=\"800px\" gutterSize=\"16px\">\n      <mat-grid-tile\n        ><igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n          <igo-geolocate-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-geolocate-button>\n          <igo-home-extent-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-home-extent-button>\n          <igo-rotation-button\n            [map]=\"map\"\n            [showIfNoRotation]=\"false\"\n            color=\"primary\"\n          ></igo-rotation-button> </igo-map-browser\n      ></mat-grid-tile>\n      <mat-grid-tile> <igo-print [map]=\"map\"></igo-print></mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMessageModule } from '@igo2/core';\r\nimport { IgoMapModule, IgoPrintModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppPrintRoutingModule } from './print-routing.module';\r\nimport { AppPrintComponent } from './print.component';\r\n\r\n@NgModule({\r\n  declarations: [AppPrintComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppPrintRoutingModule,\r\n    IgoMessageModule,\r\n    IgoMapModule,\r\n    IgoPrintModule\r\n  ],\r\n  exports: [AppPrintComponent]\r\n})\r\nexport class AppPrintModule {}\r\n","<app-doc-viewer title=\"Query\" subtitle=\"Geo\" [dependencies]=\"[]\">\n  <app-example-viewer codeFolder=\"geo/query\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoOverlay\n      igoQuery\n      [queryFeatures]=\"true\"\n      (query)=\"handleQueryResults($event)\"\n    >\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-panel title=\"Details\">\n      <ng-container *ngIf=\"features$ | async as features\">\n        <div *ngFor=\"let feature of features\">\n          <h1>\n            Query Title :\n            <span style=\"background-color: #e0e0e0\">{{\n              getTitle(feature)\n            }}</span>\n          </h1>\n          <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n        </div>\n      </ng-container>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppQueryComponent } from './query.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'query',\r\n    component: AppQueryComponent\r\n  }\r\n];\r\n\r\nexport const AppQueryRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { getEntityTitle } from '@igo2/common';\r\nimport {\r\n  DataSourceService,\r\n  Feature,\r\n  FeatureDataSource,\r\n  FeatureMotion,\r\n  IgoMap,\r\n  LayerService,\r\n  QueryFormat,\r\n  QueryHtmlTarget,\r\n  QueryableDataSourceOptions,\r\n  SearchResult\r\n} from '@igo2/geo';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport olLineString from 'ol/geom/LineString';\r\nimport olPoint from 'ol/geom/Point';\r\nimport olPolygon from 'ol/geom/Polygon';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-query',\r\n  templateUrl: './query.component.html',\r\n  styleUrls: ['./query.component.scss']\r\n})\r\nexport class AppQueryComponent {\r\n  public features$ = new BehaviorSubject<Feature[]>([]);\r\n\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  constructor(\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wms',\r\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n        queryable: true,\r\n        queryTitle: 'num_rts',\r\n        params: {\r\n          layers: 'bgr_v_sous_route_res_sup_act',\r\n          version: '1.3.0'\r\n        }\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'WMS',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n      });\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wms',\r\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n        queryable: true,\r\n        queryFormat: QueryFormat.HTMLGML2,\r\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\r\n        params: {\r\n          layers: 'bgr_v_sous_route_res_sup_act',\r\n          version: '1.3.0'\r\n        }\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'WMS html with a pre call in GML',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n      });\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Query url test',\r\n        visible: true,\r\n        sourceOptions: {\r\n          type: 'wms',\r\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\r\n          queryable: true,\r\n          queryUrls: [\r\n            {\r\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application/geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'\r\n            }\r\n          ],\r\n          queryLayerFeatures: false,\r\n          queryFormat: 'geojson',\r\n          params: {\r\n            layers: 'SDA_MUNIC_S_20K',\r\n            version: '1.3.0'\r\n          }\r\n        }\r\n      } as any)\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'vector',\r\n        queryable: true,\r\n        queryTitle: 'So beautiful ${name}',\r\n        sourceFields: [\r\n          { name: 'name', alias: 'Alias name' },\r\n          { name: 'description', alias: 'Alias description' }\r\n        ]\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Vector Layer',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n        this.addFeatures(dataSource as FeatureDataSource);\r\n      });\r\n  }\r\n\r\n  addFeatures(dataSource: FeatureDataSource) {\r\n    const feature1 = new olFeature({\r\n      name: 'feature1',\r\n      geometry: new olLineString([\r\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\r\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\r\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\r\n      ])\r\n    });\r\n\r\n    const feature2 = new olFeature({\r\n      name: 'feature2',\r\n      geometry: new olPoint(\r\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\r\n      )\r\n    });\r\n\r\n    const feature3 = new olFeature({\r\n      name: 'feature3',\r\n      geometry: new olPolygon([\r\n        [\r\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\r\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\r\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\r\n        ]\r\n      ])\r\n    });\r\n\r\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'Vector tile with custom getfeatureinfo url',\r\n        visible: true,\r\n        sourceOptions: {\r\n          type: 'mvt',\r\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\r\n          queryable: true,\r\n          queryUrls: [\r\n            {\r\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application%2Fgeojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'\r\n            }\r\n          ],\r\n          queryLayerFeatures: false\r\n          // queryFormat: 'geojson'\r\n        },\r\n        mapboxStyle: {\r\n          url: 'assets/mapboxStyleExample-vectortile.json',\r\n          source: 'ahocevar'\r\n        }\r\n      } as any)\r\n      .subscribe((l) => this.map.addLayer(l));\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'wms',\r\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi',\r\n        queryable: true,\r\n        queryUrls: [\r\n          {\r\n            url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&INFO_FORMAT=geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}',\r\n            // minScale: 20000,\r\n            // maxScale: 9000000,\r\n            minResolution: 0,\r\n            maxResolution: 400\r\n          }\r\n        ],\r\n        queryFormat: 'geojson',\r\n        params: {\r\n          version: '1.3.0',\r\n          layers: 'MSP_CASERNE_PUBLIC'\r\n        }\r\n      } as QueryableDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'WMS with custom getfeatureinfo url',\r\n            source: dataSource,\r\n            sourceOptions: dataSource.options\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  handleQueryResults(results) {\r\n    const features: Feature[] = results.features;\r\n    if (features.length && features[0]) {\r\n      this.features$.next(features);\r\n      this.map.queryResultsOverlay.setFeatures(features, FeatureMotion.None);\r\n    }\r\n  }\r\n\r\n  getTitle(result: SearchResult) {\r\n    return getEntityTitle(result);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport {\r\n  IgoFeatureModule,\r\n  IgoMapModule,\r\n  IgoOverlayModule,\r\n  IgoQueryModule\r\n} from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppQueryRoutingModule } from './query-routing.module';\r\nimport { AppQueryComponent } from './query.component';\r\n\r\n@NgModule({\r\n  declarations: [AppQueryComponent],\r\n  imports: [\r\n    AppQueryRoutingModule,\r\n    SharedModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoOverlayModule,\r\n    IgoQueryModule,\r\n    IgoFeatureModule\r\n  ],\r\n  exports: [AppQueryComponent]\r\n})\r\nexport class AppQueryModule {}\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoSearchModule } from '@igo2/geo';\n\nimport { SearchBarBindingDirective } from './search-bar-binding.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [IgoSearchModule],\n  declarations: [SearchBarBindingDirective],\n  exports: [SearchBarBindingDirective]\n})\nexport class IgoAppSearchBarModule {}\n","import { CommonModule } from '@angular/common';\r\nimport { CUSTOM_ELEMENTS_SCHEMA, NgModule } from '@angular/core';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport {\r\n  IgoCustomHtmlModule,\r\n  IgoFlexibleModule,\r\n  IgoPanelModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoFeatureDetailsModule,\r\n  IgoFeatureModule,\r\n  IgoSearchModule\r\n} from '@igo2/geo';\r\n\r\nimport { SearchResultsToolComponent } from './search-results-tool.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatBadgeModule,\r\n    MatTooltipModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule,\r\n    IgoFeatureModule,\r\n    IgoSearchModule,\r\n    IgoFlexibleModule,\r\n    IgoPanelModule,\r\n    IgoFeatureDetailsModule,\r\n    IgoCustomHtmlModule\r\n  ],\r\n  declarations: [SearchResultsToolComponent],\r\n  exports: [SearchResultsToolComponent],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class IgoAppSearchResultsToolModule {}\r\n","import { NgModule } from '@angular/core';\n\nimport { IgoAppSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoAppSearchResultsToolModule } from './search-results-tool/search-results-tool.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [IgoAppSearchBarModule, IgoAppSearchResultsToolModule]\n})\nexport class IgoAppSearchModule {}\n","<p></p>\r\n<igo-interactive-tour\r\n  mat-raised-button\r\n  tourToStart=\"global\"\r\n  menuIsOpen=\"true\"\r\n  styleButton=\"raised\"\r\n  [discoverTitleInLocale$]=\"discoverTitleInLocale$\"\r\n>\r\n</igo-interactive-tour>\r\n\r\n<button\r\n  *ngIf=\"\r\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length === 1\r\n  \"\r\n  class=\"training-guide-button\"\r\n  mat-raised-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [disabled]=\"loading\"\r\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\r\n  (click)=\"openGuide()\"\r\n>\r\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\r\n  <mat-icon svgIcon=\"file-document\"></mat-icon>\r\n</button>\r\n\r\n<button\r\n  *ngIf=\"\r\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length > 1\r\n  \"\r\n  class=\"training-guide-button\"\r\n  mat-raised-button\r\n  tooltip-position=\"below\"\r\n  matTooltipShowDelay=\"500\"\r\n  [disabled]=\"loading\"\r\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\r\n  [matMenuTriggerFor]=\"menu\"\r\n>\r\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\r\n  <mat-icon svgIcon=\"file-document\"></mat-icon>\r\n</button>\r\n\r\n<mat-menu #menu=\"matMenu\">\r\n  <button\r\n    *ngFor=\"let guide of trainingGuideURLs\"\r\n    mat-menu-item\r\n    (click)=\"openGuide(guide)\"\r\n  >\r\n    {{ formatFileName(guide) }}\r\n  </button>\r\n</mat-menu>\r\n\r\n<igo-custom-html\r\n  *ngIf=\"headerHtml !== ''\"\r\n  class=\"mat-typography\"\r\n  [html]=\"headerHtml | translate\"\r\n>\r\n</igo-custom-html>\r\n\r\n<igo-custom-html\r\n  class=\"mat-typography\"\r\n  [html]=\"html | translate: { version: effectiveVersion }\"\r\n>\r\n</igo-custom-html>\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { ConfigService, LanguageService, version } from '@igo2/core';\r\n\r\nimport { of } from 'rxjs';\r\nimport type { Observable } from 'rxjs';\r\nimport { AllEnvironmentOptions } from '../../environment';\r\n\r\n@ToolComponent({\r\n  name: 'about',\r\n  title: 'igo.integration.tools.about',\r\n  icon: 'help-circle'\r\n})\r\n@Component({\r\n  selector: 'igo-about-tool',\r\n  templateUrl: './about-tool.component.html',\r\n  styleUrls: ['./about-tool.component.scss']\r\n})\r\nexport class AboutToolComponent implements OnInit {\r\n  private configOptions: AllEnvironmentOptions;\r\n  @Input()\r\n  get headerHtml() {\r\n    return this._headerHtml;\r\n  }\r\n  set headerHtml(value: string) {\r\n    this._headerHtml = Array.isArray(value) ? value.join('\\n') : value;\r\n  }\r\n\r\n  @Input()\r\n  get html() {\r\n    return this._html;\r\n  }\r\n  set html(value: string) {\r\n    this._html = Array.isArray(value) ? value.join('\\n') : value;\r\n  }\r\n  private _discoverTitleInLocale: string = 'IGO';\r\n  public discoverTitleInLocale$: Observable<string> = of(\r\n    this._discoverTitleInLocale\r\n  );\r\n\r\n  @Input()\r\n  get discoverTitleInLocale() {\r\n    return this._discoverTitleInLocale;\r\n  }\r\n  set discoverTitleInLocale(value: string) {\r\n    this._discoverTitleInLocale = value;\r\n    this.discoverTitleInLocale$ = of(value);\r\n  }\r\n\r\n  @Input() trainingGuideURLs;\r\n\r\n  public effectiveVersion: string;\r\n  private _html: string = 'igo.integration.aboutTool.html';\r\n  private _headerHtml: string;\r\n\r\n  private baseUrlProfil;\r\n  private baseUrlGuide;\r\n\r\n  public loading = false;\r\n\r\n  constructor(\r\n    public configService: ConfigService,\r\n    public auth: AuthService,\r\n    private http: HttpClient,\r\n    private cdRef: ChangeDetectorRef,\r\n    private languageService: LanguageService\r\n  ) {\r\n    this.headerHtml = this.languageService.translate.instant(\r\n      'igo.integration.aboutTool.headerHtml'\r\n    );\r\n    this.configOptions = this.configService.getConfigs();\r\n    const configVersion = this.configOptions.version;\r\n    this.effectiveVersion =\r\n      configVersion?.app || configVersion?.lib || version.lib;\r\n    this.baseUrlProfil = this.configOptions.storage?.url;\r\n    this.baseUrlGuide =\r\n      this.configOptions.depot?.url +\r\n      // todo validate this property\r\n      (this.configOptions.depot as any)?.guideUrl;\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.auth.authenticated && this.configOptions.context?.url) {\r\n      this.http.get(this.baseUrlProfil).subscribe((profil) => {\r\n        const recast = profil as any;\r\n        this.trainingGuideURLs = recast.guides;\r\n        this.cdRef.detectChanges();\r\n      });\r\n    } else if (\r\n      this.auth.authenticated &&\r\n      !this.configOptions.context?.url &&\r\n      this.configOptions.depot?.trainingGuides\r\n    ) {\r\n      this.trainingGuideURLs = this.configOptions.depot?.trainingGuides;\r\n    }\r\n  }\r\n\r\n  openGuide(guide?) {\r\n    this.loading = true;\r\n    const url = guide\r\n      ? this.baseUrlGuide + guide + '?'\r\n      : this.baseUrlGuide + this.trainingGuideURLs[0] + '?';\r\n    this.http\r\n      .get(url, {\r\n        responseType: 'blob'\r\n      })\r\n      .subscribe(() => {\r\n        this.loading = false;\r\n        window.open(url, '_blank');\r\n        this.cdRef.detectChanges();\r\n      });\r\n  }\r\n\r\n  formatFileName(name: string) {\r\n    name = name.split('_').join(' ');\r\n    const index = name.indexOf('.');\r\n    name = name.slice(0, index);\r\n    return name;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ExportOptions } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nexport enum ImportExportType {\r\n  layer = 'layer',\r\n  context = 'context'\r\n}\r\n\r\nexport enum ImportExportMode {\r\n  import = 'import',\r\n  export = 'export'\r\n}\r\n\r\n/**\r\n * Service that holds the state of the importExport module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ImportExportState {\r\n  readonly importExportType$: BehaviorSubject<ImportExportType> =\r\n    new BehaviorSubject(ImportExportType.layer);\r\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> =\r\n    new BehaviorSubject(ImportExportMode.import);\r\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  setImportExportType(type: ImportExportType) {\r\n    this.importExportType$.next(type);\r\n  }\r\n\r\n  setMode(mode: ImportExportMode) {\r\n    this.selectedMode$.next(mode);\r\n  }\r\n\r\n  setsExportOptions(exportOptions: ExportOptions) {\r\n    this.exportOptions$.next(exportOptions);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ToolService, Toolbox } from '@igo2/common';\r\nimport { ExportOptions } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from '../import-export/import-export.state';\r\n\r\n/**\r\n * Service that holds the state of the search module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ToolState {\r\n  get toolbox(): Toolbox {\r\n    return this.toolService.toolbox;\r\n  }\r\n\r\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  constructor(\r\n    private toolService: ToolService,\r\n    private importExportState: ImportExportState\r\n  ) {}\r\n\r\n  toolToActivateFromOptions(toolToActivate: {\r\n    tool: string;\r\n    options: { [key: string]: any };\r\n  }) {\r\n    if (!toolToActivate) {\r\n      return;\r\n    }\r\n    if (toolToActivate.tool === 'importExport') {\r\n      let exportOptions: ExportOptions =\r\n        this.importExportState.exportOptions$.value;\r\n      if (!exportOptions) {\r\n        exportOptions = {\r\n          layers: toolToActivate.options.layers,\r\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\r\n        };\r\n      } else {\r\n        exportOptions.layers = toolToActivate.options.layers;\r\n        exportOptions.featureInMapExtent =\r\n          toolToActivate.options.featureInMapExtent;\r\n      }\r\n      this.importExportState.setsExportOptions(exportOptions);\r\n      this.importExportState.setMode(ImportExportMode.export);\r\n    }\r\n\r\n    if (this.toolbox.getTool(toolToActivate.tool)) {\r\n      this.toolbox.activateTool(toolToActivate.tool);\r\n      this.openSidenav$.next(true);\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { Tool, ToolService } from '@igo2/common';\r\nimport { ContextService, DetailedContext } from '@igo2/context';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { ToolState } from '../tool/tool.state';\r\n\r\n/**\r\n * Service that holds the state of the context module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ContextState {\r\n  /**\r\n   * Observable of the active context\r\n   */\r\n  context$: BehaviorSubject<DetailedContext> = new BehaviorSubject(undefined);\r\n\r\n  constructor(\r\n    private contextService: ContextService,\r\n    private toolService: ToolService,\r\n    private toolState: ToolState,\r\n    private languageService: LanguageService\r\n  ) {\r\n    this.contextService.context$.subscribe((context: DetailedContext) => {\r\n      this.onContextChange(context);\r\n    });\r\n    this.contextService.toolsChanged$.subscribe((context: DetailedContext) => {\r\n      this.updateTools(context);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the active context\r\n   * @param context Detailed context\r\n   */\r\n  private setContext(context: DetailedContext) {\r\n    this.updateTools(context);\r\n    this.context$.next(context);\r\n  }\r\n\r\n  /**\r\n   * Update the tool state with the context's tools\r\n   * @param context Detailed context\r\n   */\r\n  private updateTools(context: DetailedContext) {\r\n    const toolbox = this.toolState.toolbox;\r\n\r\n    const tools = [];\r\n    const contextTools = context.tools || [];\r\n    contextTools.forEach((contextTool: Tool) => {\r\n      const baseTool = this.toolService.getTool(contextTool.name);\r\n      if (baseTool === undefined) {\r\n        return;\r\n      }\r\n\r\n      const options = Object.assign(\r\n        {},\r\n        baseTool.options || {},\r\n        contextTool.options || {}\r\n      );\r\n      const tool = Object.assign({}, baseTool, contextTool, { options });\r\n      tools.push(tool);\r\n    });\r\n\r\n    tools.forEach((tool) => {\r\n      if (tool.parent) {\r\n        const parentIndex = tools.findIndex((el) => el.name === tool.parent);\r\n        if (parentIndex !== -1) {\r\n          tools[parentIndex].children = [];\r\n          tools[parentIndex].children.push(tool.name);\r\n        }\r\n      }\r\n    });\r\n\r\n    toolbox.setTools(tools);\r\n    toolbox.setToolbar(context.toolbar || []);\r\n\r\n    // TODO: This is a patch so the context service can work without\r\n    // injecting the ToolState or without being completely refactored\r\n    this.contextService.setTools([].concat(tools));\r\n    this.contextService.setToolbar(context.toolbar || []);\r\n  }\r\n\r\n  /**\r\n   * Set a new context and update the tool state\r\n   * @param context Detailed context\r\n   */\r\n  private onContextChange(context: DetailedContext) {\r\n    if (context === undefined) {\r\n      return;\r\n    }\r\n    this.setContext(context);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\nimport { IgoMap, MapService, ProjectionService } from '@igo2/geo';\r\n\r\n// import { BehaviorSubject } from 'rxjs';\r\n\r\n/**\r\n * Service that holds the state of the map module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapState {\r\n  // public mapCenter$ = new BehaviorSubject<boolean>(false);\r\n  get showAllLegendsValue(): boolean {\r\n    return this._legendToolShowAll;\r\n  }\r\n\r\n  set showAllLegendsValue(value) {\r\n    this._legendToolShowAll = value;\r\n  }\r\n  private _legendToolShowAll: boolean;\r\n\r\n  /**\r\n   * Active map\r\n   */\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  constructor(\r\n    private mapService: MapService,\r\n    private projectionService: ProjectionService, // Don't remove this or it'll never be injected,\r\n    private storageService: StorageService,\r\n    private configService: ConfigService\r\n  ) {\r\n    this._map = new IgoMap(\r\n      {\r\n        controls: {\r\n          scaleLine: true,\r\n          attribution: {\r\n            collapsed: true\r\n          }\r\n        }\r\n      },\r\n      this.storageService,\r\n      this.configService\r\n    );\r\n\r\n    this.mapService.setMap(this.map);\r\n  }\r\n}\r\n","<div\n  *ngIf=\"userControlledLayerList.length; else noLayersBlock\"\n  class=\"igo-swipe-select-container\"\n>\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-swipe.swipe-select'\n          | translate\n      }}</mat-label>\n      <mat-select formControlName=\"layers\" multiple>\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\n          {{\n            'igo.integration.advanced-map-tool.advanced-swipe.selectAll'\n              | translate\n          }}\n        </mat-option>\n        <mat-divider></mat-divider>\n        <mat-option\n          *ngFor=\"let layer of userControlledLayerList\"\n          [value]=\"layer\"\n          (click)=\"applyNewLayers(e)\"\n          >{{ layer.title }}</mat-option\n        >\n      </mat-select>\n    </mat-form-field>\n  </form>\n\n  <mat-slide-toggle\n    class=\"swipe-toggle mat-typography\"\n    [checked]=\"swipe\"\n    [labelPosition]=\"'before'\"\n    (change)=\"startSwipe($event.checked)\"\n  >\n    {{ 'igo.integration.advanced-map-tool.advanced-swipe.swipe' | translate }}\n  </mat-slide-toggle>\n</div>\n\n<ng-template #noLayersBlock>\n  <mat-list>\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.advanced-map-tool.advanced-swipe.empty' | translate }}\n    </p>\n    <p class=\"map-empty mat-typography\">\n      {{\n        'igo.integration.advanced-map-tool.advanced-swipe.customize' | translate\n      }}\n    </p>\n    <mat-list-item>\n      <mat-icon matListItemIcon svgIcon=\"magnify\"></mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.search-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n    <mat-list-item>\n      <mat-icon matListItemIcon svgIcon=\"layers-plus\"></mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.catalog-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n    <mat-list-item>\n      <mat-icon matListItemIcon svgIcon=\"star\"></mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.context-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\n\r\nimport { ContextService, DetailedContext } from '@igo2/context';\r\nimport { IgoMap, Layer, VectorLayer } from '@igo2/geo';\r\n\r\nimport { ToolState } from '../../../tool/tool.state';\r\nimport { MapState } from '../../map.state';\r\n\r\n@Component({\r\n  selector: 'igo-advanced-swipe',\r\n  templateUrl: './advanced-swipe.component.html',\r\n  styleUrls: ['./advanced-swipe.component.scss']\r\n})\r\nexport class AdvancedSwipeComponent implements OnInit, OnDestroy {\r\n  public swipe: boolean = false;\r\n  public layerList: Layer[];\r\n  public userControlledLayerList: Layer[];\r\n  public form: UntypedFormGroup;\r\n  public layers: VectorLayer[];\r\n  public res: DetailedContext;\r\n  public listForSwipe: Layer[];\r\n\r\n  /**\r\n   * Get an active map state\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    public mapState: MapState,\r\n    private contextService: ContextService,\r\n    private formBuilder: UntypedFormBuilder,\r\n    private toolState: ToolState\r\n  ) {\r\n    this.buildForm();\r\n  }\r\n\r\n  /**\r\n   * Get the list of layers for swipe\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.map.layers$.subscribe(\r\n      (ll) =>\r\n        (this.userControlledLayerList = ll.filter(\r\n          (layer) =>\r\n            !layer.baseLayer && layer.showInLayerList && layer.displayed\r\n        ))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Desactivate the swipe\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.swipe = false;\r\n    this.map.swipeEnabled$.next(this.swipe);\r\n  }\r\n\r\n  /**\r\n   * Build a form for choise of the layers\r\n   */\r\n  private buildForm() {\r\n    this.form = this.formBuilder.group({\r\n      layers: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate the swipe, send a list of layers for a swipe-tool\r\n   */\r\n  startSwipe(toggle: boolean) {\r\n    this.swipe = toggle;\r\n    this.map.swipeEnabled$.next(toggle);\r\n    this.listForSwipe = [];\r\n    for (const layer of this.form.value.layers) {\r\n      this.listForSwipe.push(layer);\r\n    }\r\n    this.map.selectedFeatures$.next(this.listForSwipe);\r\n  }\r\n\r\n  /**\r\n   * Restart a swipe for a new layers-list\r\n   */\r\n  applyNewLayers(e) {\r\n    this.startSwipe(false); // l'approche KISS\r\n    this.startSwipe(true);\r\n    if (e._selected) {\r\n      e._selected = false;\r\n    }\r\n    const allLayers = this.userControlledLayerList.length;\r\n    const selectedLayers = this.form.controls.layers.value.length;\r\n    if (selectedLayers === allLayers) {\r\n      e._selected = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Select all list of layers and restart a tool\r\n   */\r\n  selectAll(e) {\r\n    if (e._selected) {\r\n      this.form.controls.layers.setValue(this.userControlledLayerList);\r\n      e._selected = true;\r\n    } else {\r\n      this.form.controls.layers.setValue([]);\r\n    }\r\n    this.startSwipe(false);\r\n    this.startSwipe(true);\r\n  }\r\n\r\n  /**\r\n   * Open search tool\r\n   */\r\n  searchEmit() {\r\n    this.toolState.toolbox.activateTool('searchResults');\r\n  }\r\n\r\n  /**\r\n   * Open catalog\r\n   */\r\n  catalogEmit() {\r\n    this.toolState.toolbox.activateTool('catalog');\r\n  }\r\n\r\n  /**\r\n   * Open context manager\r\n   */\r\n  contextEmit() {\r\n    this.toolState.toolbox.activateTool('contextManager');\r\n  }\r\n}\r\n","<div class=\"advanced-coordinates__coordinates-container\">\n  <div class=\"advanced-coordinates__coordinates-container__inner\">\n    <mat-form-field *ngIf=\"units; else elseBlock\" class=\"coordinates\">\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-coordinates.lon' | translate\n      }}</mat-label>\n      <textarea\n        #textArea\n        matInput\n        readonly\n        rows=\"1\"\n        [placeholder]=\"\n          'igo.integration.advanced-map-tool.advanced-coordinates.lon'\n            | translate\n        \"\n        [value]=\"coordinates[0]\"\n      ></textarea>\n    </mat-form-field>\n    <ng-template #elseBlock>\n      <mat-form-field class=\"coordinates\">\n        <textarea\n          #textArea\n          matInput\n          readonly\n          rows=\"1\"\n          [placeholder]=\"\n            'igo.integration.advanced-map-tool.advanced-coordinates.est'\n              | translate\n          \"\n          [value]=\"coordinates[0]\"\n        ></textarea>\n      </mat-form-field>\n    </ng-template>\n\n    <mat-form-field *ngIf=\"units; else elseBlock2\" class=\"coordinates2\">\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-coordinates.lat' | translate\n      }}</mat-label>\n      <textarea\n        #textArea\n        matInput\n        readonly\n        rows=\"1\"\n        [placeholder]=\"\n          'igo.integration.advanced-map-tool.advanced-coordinates.lat'\n            | translate\n        \"\n        [value]=\"coordinates[1]\"\n      ></textarea>\n    </mat-form-field>\n    <ng-template #elseBlock2>\n      <mat-form-field class=\"coordinates2\">\n        <textarea\n          #textArea\n          matInput\n          readonly\n          rows=\"1\"\n          [placeholder]=\"\n            'igo.integration.advanced-map-tool.advanced-coordinates.nord'\n              | translate\n          \"\n          [value]=\"coordinates[1]\"\n        ></textarea>\n      </mat-form-field>\n    </ng-template>\n  </div>\n\n  <button\n    mat-icon-button\n    [attr.aria-label]=\"\n      'igo.integration.advanced-map-tool.advanced-coordinates.copy' | translate\n    \"\n    class=\"igo-form-button-group advanced-coordinates__copy-coordinates\"\n    (click)=\"copyTextToClipboard()\"\n  >\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n</div>\n<form class=\"igo-form advanced-coordinates__form\" [formGroup]=\"form\">\n  <mat-form-field class=\"igo-input-container\">\n    <mat-label>{{\n      'igo.integration.advanced-map-tool.advanced-coordinates.coordSystem'\n        | translate\n    }}</mat-label>\n    <mat-select [(value)]=\"inputProj\">\n      <mat-option\n        matTooltipShowDelay=\"500\"\n        *ngFor=\"let projection of projections$ | async\"\n        [value]=\"projection\"\n        (click)=\"$event.stopPropagation()\"\n      >\n        {{ projection.translatedValue || projection.alias }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n  <mat-slide-toggle\n    class=\"center-toggle mat-typography\"\n    [checked]=\"center\"\n    [labelPosition]=\"'before'\"\n    (change)=\"displayCenter($event.checked)\"\n  >\n    {{\n      'igo.integration.advanced-map-tool.advanced-coordinates.center'\n        | translate\n    }}\n  </mat-slide-toggle>\n</form>\n\n<p class=\"igo-zoom mat-typography\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.zoom' | translate\n  }}\n  {{ map.viewController.getZoom() }}\n</p>\n<p class=\"igo-zoom mat-typography\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.scale' | translate\n  }}\n  {{ formattedScale$ | async }}\n</p>\n<p class=\"igo-zoom mat-typography\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.resolution'\n      | translate\n  }}\n  {{ map.viewController.getResolution() | number: '1.0-0' }}\n</p>\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport {\r\n  UntypedFormBuilder,\r\n  UntypedFormGroup,\r\n  Validators\r\n} from '@angular/forms';\r\n\r\nimport {\r\n  ConfigService,\r\n  LanguageService,\r\n  MessageService,\r\n  StorageScope,\r\n  StorageService\r\n} from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  InputProjections,\r\n  ProjectionsLimitationsOptions,\r\n  formatScale\r\n} from '@igo2/geo';\r\nimport { computeProjectionsConstraints, zoneMtm, zoneUtm } from '@igo2/geo';\r\nimport { Clipboard } from '@igo2/utils';\r\n\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { BehaviorSubject, Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { MapState } from '../../map.state';\r\n\r\n/**\r\n * Tool to display the coordinates and a cursor of the center of the map\r\n */\r\n@Component({\r\n  selector: 'igo-advanced-coordinates',\r\n  templateUrl: './advanced-coordinates.component.html',\r\n  styleUrls: ['./advanced-coordinates.component.scss']\r\n})\r\nexport class AdvancedCoordinatesComponent implements OnInit, OnDestroy {\r\n  public formattedScale$: BehaviorSubject<string> = new BehaviorSubject('');\r\n  public projections$: BehaviorSubject<InputProjections[]> =\r\n    new BehaviorSubject([]);\r\n  public form: UntypedFormGroup;\r\n  public coordinates: string[];\r\n  private currentCenterDefaultProj: [number, number];\r\n  public center: boolean;\r\n  private inMtmZone: boolean = true;\r\n  private inLambert2 = { 32198: true, 3798: true };\r\n  private mapState$$: Subscription;\r\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\r\n  private projectionsConstraints: ProjectionsLimitationsOptions;\r\n  private defaultProj: InputProjections;\r\n  private currentZones = { utm: undefined, mtm: undefined };\r\n  public units: boolean = true;\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get inputProj(): InputProjections {\r\n    return this.form.get('inputProj').value;\r\n  }\r\n  set inputProj(value: InputProjections) {\r\n    this.form.patchValue({ inputProj: value });\r\n  }\r\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\r\n    return this._projectionsLimitations || {};\r\n  }\r\n\r\n  @Input()\r\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\r\n    this._projectionsLimitations = value;\r\n  }\r\n\r\n  constructor(\r\n    public mapState: MapState,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private cdRef: ChangeDetectorRef,\r\n    private storageService: StorageService,\r\n    private config: ConfigService,\r\n    private formBuilder: UntypedFormBuilder\r\n  ) {\r\n    this.defaultProj = {\r\n      translatedValue: this.languageService.translate.instant(\r\n        'igo.geo.importExportForm.projections.wgs84',\r\n        { code: 'EPSG:4326' }\r\n      ),\r\n      translateKey: 'wgs84',\r\n      alias: 'WGS84',\r\n      code: 'EPSG:4326',\r\n      zone: '',\r\n      def: undefined,\r\n      extent: undefined\r\n    };\r\n    this.center = this.storageService.get('centerToggle') as boolean;\r\n    this.computeProjections();\r\n    this.buildForm();\r\n  }\r\n\r\n  /**\r\n   * Listen a state of the map, a state of a form, update the coordinates\r\n   */\r\n  ngOnInit(): void {\r\n    this.mapState$$ = combineLatest([\r\n      this.map.viewController.state$.pipe(debounceTime(50)),\r\n      this.form.valueChanges\r\n    ]).subscribe(() => {\r\n      this.setScaleValue(this.map);\r\n      this.currentCenterDefaultProj = this.map.viewController.getCenter(\r\n        this.defaultProj.code\r\n      );\r\n      const currentMtmZone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n      const currentUtmZone = zoneUtm(this.currentCenterDefaultProj[0]);\r\n      if (!this.inMtmZone && currentMtmZone !== this.currentZones.mtm) {\r\n        this.back2quebec();\r\n      }\r\n      let zoneChange = false;\r\n      if (currentMtmZone !== this.currentZones.mtm) {\r\n        this.currentZones.mtm = currentMtmZone;\r\n        zoneChange = true;\r\n      }\r\n      if (currentUtmZone !== this.currentZones.utm) {\r\n        this.currentZones.utm = currentUtmZone;\r\n        zoneChange = true;\r\n      }\r\n      if (zoneChange) {\r\n        this.updateProjectionsZoneChange();\r\n      }\r\n      this.checkLambert(this.currentCenterDefaultProj);\r\n      this.coordinates = this.getCoordinates();\r\n      this.cdRef.detectChanges();\r\n      this.storageService.set(\r\n        'currentProjection',\r\n        this.inputProj,\r\n        StorageScope.SESSION\r\n      );\r\n    });\r\n\r\n    const tempInputProj = this.storageService.get(\r\n      'currentProjection'\r\n    ) as InputProjections;\r\n    this.inputProj = this.projections$.value[0];\r\n    if (tempInputProj !== null) {\r\n      const pos = this.positionInList(tempInputProj);\r\n      this.inputProj = this.projections$.value[pos];\r\n      this.updateZoneMtmUtm();\r\n    }\r\n    this.map.mapCenter$.next(this.center);\r\n    this.coordinates = this.getCoordinates();\r\n    this.currentCenterDefaultProj = this.map.viewController.getCenter(\r\n      this.defaultProj.code\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.map.mapCenter$.next(false);\r\n    this.mapState$$.unsubscribe();\r\n  }\r\n\r\n  setScaleValue(map: IgoMap) {\r\n    this.formattedScale$.next(\r\n      ': ~ 1 / ' + formatScale(map.viewController.getScale())\r\n    );\r\n  }\r\n  /**\r\n   * Coordinates of the center of the map on the appropriate systeme of coordinates\r\n   * @returns Array of two numbers\r\n   */\r\n  getCoordinates(): string[] {\r\n    this.currentZones.mtm = zoneMtm(this.currentCenterDefaultProj[0]);\r\n    this.currentZones.utm = zoneUtm(this.currentCenterDefaultProj[0]);\r\n    let coord;\r\n    const code = this.inputProj.code;\r\n    let decimal = 2;\r\n    if (code.includes('EPSG:4326') || code.includes('EPSG:4269')) {\r\n      decimal = 5;\r\n    }\r\n    this.units = code === 'EPSG:4326' || code === 'EPSG:4269';\r\n    coord = this.map.viewController\r\n      .getCenter(code)\r\n      .map((c) => c.toFixed(decimal));\r\n    return coord;\r\n  }\r\n\r\n  /**\r\n   * Copy the coordinates to a clipboard\r\n   */\r\n  copyTextToClipboard(): void {\r\n    const successful = Clipboard.copy(this.coordinates.toString());\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyMsg',\r\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyTitle'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Display a cursor on the center of the map\r\n   */\r\n  displayCenter(toggle: boolean): void {\r\n    this.center = toggle;\r\n    this.map.mapCenter$.next(toggle);\r\n    this.storageService.set('centerToggle', toggle, StorageScope.SESSION);\r\n  }\r\n\r\n  /**\r\n   * Builder of the form\r\n   */\r\n  private buildForm(): void {\r\n    this.form = this.formBuilder.group({\r\n      inputProj: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update list of projections after changing of the state of the map\r\n   */\r\n  private updateProjectionsZoneChange(): void {\r\n    let modifiedProj = this.projections$.value;\r\n    const translate = this.languageService.translate;\r\n    modifiedProj.map((p) => {\r\n      if (p.translateKey === 'mtm') {\r\n        const zone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n        if (zone) {\r\n          const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\r\n          p.alias = `MTM ${zone}`;\r\n          p.code = code;\r\n          p.zone = `${zone}`;\r\n          p.translatedValue = translate.instant(\r\n            'igo.geo.importExportForm.projections.mtm',\r\n            p\r\n          );\r\n        } else {\r\n          p.alias = '';\r\n          this.inMtmZone = false;\r\n          if (this.inputProj.translateKey === 'mtm') {\r\n            this.inputProj = this.projections$.value[0];\r\n          }\r\n        }\r\n      }\r\n      if (p.translateKey === 'utm') {\r\n        const zone = zoneUtm(this.currentCenterDefaultProj[0]);\r\n        const code = `EPSG:326${zone}`;\r\n        p.alias = `UTM ${zone}`;\r\n        p.code = code;\r\n        p.zone = `${zone}`;\r\n        p.translatedValue = translate.instant(\r\n          'igo.geo.importExportForm.projections.utm',\r\n          p\r\n        );\r\n      }\r\n    });\r\n    modifiedProj = modifiedProj.filter((p) => p.alias !== '');\r\n    this.projections$.next(modifiedProj);\r\n  }\r\n\r\n  /**\r\n   * Create a list of currents projections\r\n   */\r\n  private computeProjections(): void {\r\n    this.projectionsConstraints = computeProjectionsConstraints(\r\n      this.projectionsLimitations\r\n    );\r\n    const projections: InputProjections[] = [];\r\n\r\n    if (!this.currentCenterDefaultProj) {\r\n      this.currentCenterDefaultProj = this.map.viewController.getCenter(\r\n        this.defaultProj.code\r\n      );\r\n    }\r\n\r\n    const translate = this.languageService.translate;\r\n    if (this.projectionsConstraints.wgs84) {\r\n      projections.push({\r\n        translatedValue: translate.instant(\r\n          'igo.geo.importExportForm.projections.wgs84',\r\n          { code: 'EPSG:4326' }\r\n        ),\r\n        translateKey: 'wgs84',\r\n        alias: 'WGS84',\r\n        code: 'EPSG:4326',\r\n        zone: '',\r\n        def: undefined,\r\n        extent: undefined\r\n      });\r\n    }\r\n\r\n    if (this.projectionsConstraints.nad83) {\r\n      projections.push({\r\n        translatedValue: translate.instant(\r\n          'igo.geo.importExportForm.projections.nad83',\r\n          { code: 'EPSG:4269' }\r\n        ),\r\n        translateKey: 'nad83',\r\n        alias: 'NAD83',\r\n        code: 'EPSG:4269',\r\n        zone: '',\r\n        def: undefined,\r\n        extent: undefined\r\n      });\r\n    }\r\n\r\n    if (this.projectionsConstraints.webMercator) {\r\n      projections.push({\r\n        translatedValue: translate.instant(\r\n          'igo.geo.importExportForm.projections.webMercator',\r\n          { code: 'EPSG:3857' }\r\n        ),\r\n        translateKey: 'webMercator',\r\n        alias: 'Web Mercator',\r\n        code: 'EPSG:3857',\r\n        zone: '',\r\n        def: undefined,\r\n        extent: undefined\r\n      });\r\n    }\r\n    if (this.projectionsConstraints.mtm) {\r\n      // Quebec\r\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n      if (zone) {\r\n        this.inMtmZone = true;\r\n        const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\r\n        projections.splice(3, 0, {\r\n          translatedValue: this.languageService.translate.instant(\r\n            'igo.geo.importExportForm.projections.mtm',\r\n            { code, zone }\r\n          ),\r\n          translateKey: 'mtm',\r\n          alias: `MTM ${zone}`,\r\n          code,\r\n          zone: `${zone}`,\r\n          def: undefined,\r\n          extent: undefined\r\n        });\r\n      } else {\r\n        this.inMtmZone = false;\r\n      }\r\n    }\r\n    if (this.projectionsConstraints.utm) {\r\n      const order = this.inMtmZone ? 4 : 3;\r\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\r\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\r\n      projections.splice(order, 0, {\r\n        translatedValue: this.languageService.translate.instant(\r\n          'igo.geo.importExportForm.projections.utm',\r\n          { code, zone }\r\n        ),\r\n        translateKey: 'utm',\r\n        alias: `UTM ${zone}`,\r\n        code,\r\n        zone: `${zone}`,\r\n        def: undefined,\r\n        extent: undefined\r\n      });\r\n    }\r\n    let configProjection: InputProjections[] = [];\r\n    if (this.projectionsConstraints.projFromConfig) {\r\n      configProjection = (this.config.getConfig('projections') ||\r\n        []) as InputProjections[];\r\n    }\r\n\r\n    this.projections$.next(configProjection.concat(projections));\r\n  }\r\n\r\n  /**\r\n   * Push the MTM in the array of systeme of coordinates\r\n   * @param projections Array of the InputProjections\r\n   */\r\n  private pushMtm(projections: Array<InputProjections>): void {\r\n    if (this.projectionsConstraints.mtm) {\r\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\r\n      projections.splice(3, 0, {\r\n        translatedValue: this.languageService.translate.instant(\r\n          'igo.geo.importExportForm.projections.mtm',\r\n          { code, zone }\r\n        ),\r\n        translateKey: 'mtm',\r\n        alias: `MTM ${zone}`,\r\n        code,\r\n        zone: `${zone}`,\r\n        def: undefined,\r\n        extent: undefined\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the list of systems of coordinates for territory of Quebec\r\n   * push MTM and UTM in the Array\r\n   */\r\n  private back2quebec(): void {\r\n    const projections = this.projections$.value;\r\n    this.pushMtm(projections);\r\n    this.inMtmZone = true;\r\n  }\r\n\r\n  /**\r\n   * Update the numbers of the zones when application is restarted\r\n   */\r\n  private updateZoneMtmUtm() {\r\n    if (this.inputProj.translateKey === 'mtm') {\r\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\r\n      this.inputProj.alias = `MTM ${zone}`;\r\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\r\n      this.inputProj.code = code;\r\n      this.inputProj.zone = `${zone}`;\r\n      this.inputProj.translatedValue = this.languageService.translate.instant(\r\n        'igo.geo.importExportForm.projections.mtm',\r\n        { code, zone }\r\n      );\r\n    }\r\n    if (this.inputProj.translateKey === 'utm') {\r\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\r\n      this.inputProj.alias = `UTM ${zone}`;\r\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\r\n      this.inputProj.code = code;\r\n      this.inputProj.zone = `${zone}`;\r\n      this.inputProj.translatedValue = this.languageService.translate.instant(\r\n        'igo.geo.importExportForm.projections.utm',\r\n        { code, zone }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compute the position of a current projection in a list. 0 if the projection is not in the list\r\n   * @param translateKey string, translate key of a projection\r\n   * @returns numeric, position of an element in the array\r\n   */\r\n  positionInList(tempInputProj: InputProjections): number {\r\n    const tk = tempInputProj.translateKey;\r\n    const alias = tempInputProj.alias;\r\n    let position; // = undefined;\r\n    let iter = 0;\r\n    this.projections$.value.map((projection) => {\r\n      if (tk) {\r\n        if (tk === projection.translateKey) {\r\n          position = iter;\r\n        }\r\n      } else if (alias === projection.alias) {\r\n        position = iter;\r\n      }\r\n      iter++;\r\n    });\r\n    position = position ? position : 0;\r\n    return position;\r\n  }\r\n\r\n  /**\r\n   * Change the list of projections depending on the projections of Lambert\r\n   * @param coordinates An array of numbers, longitude and latitude\r\n   */\r\n  checkLambert(coordinates: [number, number]) {\r\n    const lambertProjections = this.config.getConfig('projections') || [];\r\n    lambertProjections.forEach((projection) => {\r\n      let modifiedProj = this.projections$.value;\r\n      const extent = projection.extent;\r\n      const code = projection.code.match(/\\d+/);\r\n      const currentExtentWGS = olproj.transformExtent(\r\n        extent,\r\n        projection.code,\r\n        this.defaultProj.code\r\n      );\r\n      if (\r\n        coordinates[0] < currentExtentWGS[0] ||\r\n        coordinates[0] > currentExtentWGS[2] ||\r\n        coordinates[1] < currentExtentWGS[1] ||\r\n        coordinates[1] > currentExtentWGS[3]\r\n      ) {\r\n        this.inLambert2[code] = false;\r\n        if (this.inputProj.alias === projection.alias) {\r\n          this.inputProj = this.projections$.value[0];\r\n        }\r\n        modifiedProj = modifiedProj.filter((p) => p.alias !== projection.alias);\r\n        this.projections$.next(modifiedProj);\r\n      } else {\r\n        if (!this.inLambert2[code]) {\r\n          this.projections$.next(modifiedProj.concat(projection));\r\n          this.inLambert2[code] = true;\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\n\r\nimport { MapState } from '../map.state';\r\n\r\n@ToolComponent({\r\n  name: 'advancedMap',\r\n  title: 'igo.integration.tools.advancedMap',\r\n  icon: 'toolbox'\r\n})\r\n/**\r\n * Tool to handle the advanced map tools\r\n */\r\n@Component({\r\n  selector: 'igo-advanced-map-tool',\r\n  templateUrl: './advanced-map-tool.component.html',\r\n  styleUrls: ['./advanced-map-tool.component.scss']\r\n})\r\nexport class AdvancedMapToolComponent {\r\n  get tracking$() {\r\n    return this.mapState.map.geolocationController.tracking$;\r\n  }\r\n  get followPosition$() {\r\n    return this.mapState.map.geolocationController.followPosition$;\r\n  }\r\n\r\n  constructor(public mapState: MapState) {}\r\n\r\n  toggleTracking(value) {\r\n    this.mapState.map.geolocationController.tracking = value;\r\n  }\r\n\r\n  toggleFollow(value) {\r\n    this.mapState.map.geolocationController.followPosition = value;\r\n  }\r\n}\r\n","<h4 class=\"nameOfTool\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-swipe.swipe-tool' | translate\n  }}\n</h4>\n<igo-advanced-swipe></igo-advanced-swipe>\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\n<h4 class=\"nameOfTool\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.coordinates'\n      | translate\n  }}\n</h4>\n<igo-advanced-coordinates></igo-advanced-coordinates>\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\n\n<h4 class=\"nameOfTool\">\n  {{ 'igo.integration.advanced-map-tool.geolocation.title' | translate }}\n</h4>\n\n<div class=\"igo-input-container\">\n  <div class=\"geolocation-slide-toggle-container mat-typography\">\n    <mat-slide-toggle\n      class=\"geolocation-option mat-typography\"\n      [checked]=\"tracking$ | async\"\n      [labelPosition]=\"'before'\"\n      (change)=\"toggleTracking($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.geolocation.tracking' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      class=\"geolocation-option mat-typography\"\n      [disabled]=\"(tracking$ | async) !== true\"\n      [labelPosition]=\"'before'\"\n      [checked]=\"followPosition$ | async\"\n      (change)=\"toggleFollow($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.geolocation.follow' | translate }}\n    </mat-slide-toggle>\n  </div>\n</div>\n","import { Injectable } from '@angular/core';\r\n\r\nimport { StorageService } from '@igo2/core';\r\nimport {\r\n  FEATURE,\r\n  Feature,\r\n  FeatureStore,\r\n  IgoMap,\r\n  Layer,\r\n  MapGeolocationState,\r\n  QueryableDataSource,\r\n  QueryableDataSourceOptions,\r\n  featureFromOl,\r\n  measureOlGeometryLength,\r\n  roundCoordTo\r\n} from '@igo2/geo';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport Geometry from 'ol/geom/Geometry';\r\nimport olLineString from 'ol/geom/LineString';\r\nimport olLayerVector from 'ol/layer/Vector';\r\nimport * as olProj from 'ol/proj';\r\nimport olVectorSource from 'ol/source/Vector';\r\n\r\nimport { BehaviorSubject, Subscription, combineLatest, interval } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { MapState } from '../map/map.state';\r\n\r\n/**\r\n * Service that holds the state of the direction module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapProximityState {\r\n  private defaultProximityRadiusValue: number = 30;\r\n\r\n  public enabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\r\n    false\r\n  );\r\n  public proximityRadiusValue$: BehaviorSubject<number>;\r\n  public proximitylocationType$: BehaviorSubject<string> =\r\n    new BehaviorSubject<string>('geolocation');\r\n  public proximityFeatureStore: FeatureStore<Feature>;\r\n  private subs$$: Subscription[] = [];\r\n  public currentPositionCoordinate$: BehaviorSubject<[number, number]> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.proximityFeatureStore = new FeatureStore<Feature>([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.proximityRadiusValue$ = new BehaviorSubject<number>(\r\n      (this.storageService.get('mapProximityRadius') as number) ||\r\n        this.defaultProximityRadiusValue\r\n    );\r\n\r\n    this.mapState.map.ol.once('rendercomplete', () => {\r\n      this.subscribeProximityMonitor();\r\n    });\r\n  }\r\n\r\n  subscribeProximityMonitor() {\r\n    this.subs$$.push(\r\n      combineLatest([\r\n        this.enabled$,\r\n        this.proximitylocationType$,\r\n        this.proximityRadiusValue$,\r\n        interval(5000),\r\n        this.map.geolocationController.position$\r\n      ])\r\n        .pipe(debounceTime(750))\r\n        .subscribe(\r\n          (bunch: [boolean, string, number, number, MapGeolocationState]) => {\r\n            this.proximityFeatureStore.clear();\r\n            const enabled = bunch[0];\r\n            const layers = this.map.layers;\r\n            const currentPos = this.map.geolocationController.position$.value;\r\n            const locationType = bunch[1];\r\n            const proximityRadiusValue = bunch[2];\r\n            this.storageService.set(\r\n              'mapProximityRadius',\r\n              proximityRadiusValue || this.defaultProximityRadiusValue\r\n            );\r\n\r\n            if (!enabled) {\r\n              return;\r\n            }\r\n\r\n            let coord: number[];\r\n            if (locationType === 'geolocation') {\r\n              if (!currentPos || !currentPos.position) {\r\n                return;\r\n              }\r\n\r\n              coord = olProj.transform(\r\n                currentPos.position,\r\n                currentPos.projection,\r\n                this.map.projection\r\n              );\r\n              this.map.mapCenter$.next(false);\r\n            } else {\r\n              coord = this.map.viewController.getCenter();\r\n              this.map.mapCenter$.next(true);\r\n            }\r\n\r\n            const coordLonLat = olProj.transform(\r\n              coord,\r\n              this.map.projection,\r\n              'EPSG:4269'\r\n            );\r\n            const roundedCoordLonLat = roundCoordTo(\r\n              coordLonLat as [number, number],\r\n              6\r\n            );\r\n            this.currentPositionCoordinate$.next(roundedCoordLonLat);\r\n\r\n            const layersToMonitor = layers.filter(\r\n              (layer) =>\r\n                layer.ol instanceof olLayerVector &&\r\n                (layer.dataSource as QueryableDataSource).options.queryable &&\r\n                layer.visible &&\r\n                layer.isInResolutionsRange\r\n            );\r\n\r\n            layersToMonitor.map((layerToMonitor) => {\r\n              const layerSource =\r\n                layerToMonitor.ol.getSource() as olVectorSource<Geometry>;\r\n\r\n              // Mostly for polygon features.\r\n              const olFeaturesAtCoordinate =\r\n                layerSource.getFeaturesAtCoordinate(coord);\r\n              if (olFeaturesAtCoordinate && olFeaturesAtCoordinate.length) {\r\n                olFeaturesAtCoordinate.map((olFeatureAtCoordinate) => {\r\n                  const featureAtThisPosition = featureFromOl(\r\n                    olFeatureAtCoordinate,\r\n                    this.map.projection\r\n                  );\r\n                  let title = this.getQueryTitle(\r\n                    featureAtThisPosition,\r\n                    layerToMonitor\r\n                  );\r\n                  // todo handle imported layers without querytitle? prompt title or detect first column?\r\n                  this.addFeatureToStore(\r\n                    layerToMonitor,\r\n                    coord,\r\n                    featureAtThisPosition,\r\n                    title,\r\n                    0\r\n                  );\r\n                });\r\n              } else {\r\n                // compute proximity for remaining sources\r\n                const closestOlFeature =\r\n                  layerSource.getClosestFeatureToCoordinate(coord);\r\n                if (closestOlFeature) {\r\n                  const closestOlGeom = closestOlFeature.getGeometry();\r\n                  const closestFeature = featureFromOl(\r\n                    closestOlFeature,\r\n                    this.map.projection\r\n                  );\r\n                  const geometryClosestPoint =\r\n                    closestOlGeom.getClosestPoint(coord);\r\n                  const linebetween = new olLineString([\r\n                    coord,\r\n                    geometryClosestPoint\r\n                  ]);\r\n                  const lineLength = measureOlGeometryLength(\r\n                    linebetween,\r\n                    'EPSG:3857'\r\n                  );\r\n                  if (lineLength <= proximityRadiusValue) {\r\n                    let title = this.getQueryTitle(\r\n                      closestFeature,\r\n                      layerToMonitor\r\n                    );\r\n                    // todo handle imported layers without querytitle? prompt title or detect first column?\r\n                    this.addFeatureToStore(\r\n                      layerToMonitor,\r\n                      coord,\r\n                      closestFeature,\r\n                      title,\r\n                      lineLength\r\n                    );\r\n                  }\r\n                }\r\n              }\r\n            });\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Add a feature with proximity properties to the store\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(\r\n    layer: Layer,\r\n    coordFromCalculatedDistance,\r\n    feature: Feature,\r\n    title,\r\n    distance\r\n  ) {\r\n    const featureId = uuid();\r\n    const projection = this.map.ol.getView().getProjection();\r\n    const olGeometry = feature.ol.getGeometry() as Geometry;\r\n    const geometry = new GeoJSON().writeGeometryObject(olGeometry, {\r\n      featureProjection: projection,\r\n      dataProjection: projection\r\n    }) as any;\r\n    this.proximityFeatureStore.update({\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: projection.getCode(),\r\n      properties: {\r\n        ...feature.properties,\r\n        ...{\r\n          id: featureId,\r\n          element: title,\r\n          distance,\r\n          coordFromCalculatedDistance,\r\n          layerSrcId: layer.id,\r\n          layerSrcTitle: layer.title\r\n        }\r\n      },\r\n      meta: {\r\n        id: featureId\r\n      }\r\n    });\r\n  }\r\n\r\n  getQueryTitle(feature: Feature, layer: Layer): string {\r\n    let title;\r\n    if (layer.options?.source?.options) {\r\n      const dataSourceOptions = layer.options.source\r\n        .options as QueryableDataSourceOptions;\r\n      if (dataSourceOptions.queryTitle) {\r\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\r\n      }\r\n    }\r\n    return title;\r\n  }\r\n\r\n  getLabelMatch(feature: Feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach((v) => {\r\n      label = label.replace(v[0], feature.properties[v[1]]);\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.properties[labelMatch] || labelMatch;\r\n    }\r\n    return label;\r\n  }\r\n}\r\n","<igo-entity-table\r\n  #table\r\n  class=\"table-compact\"\r\n  [store]=\"mapProximityState.proximityFeatureStore\"\r\n  [template]=\"tableTemplate\"\r\n></igo-entity-table>\r\n<br />\r\n<mat-form-field\r\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord\"\r\n  class=\"coordinates\"\r\n>\r\n  <textarea\r\n    #textArea\r\n    matInput\r\n    readonly\r\n    rows=\"1\"\r\n    [placeholder]=\"'igo.integration.map-proximity-tool.lon' | translate\"\r\n    [value]=\"coord[0]\"\r\n  ></textarea>\r\n</mat-form-field>\r\n<mat-form-field\r\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord2\"\r\n  class=\"coordinates2\"\r\n>\r\n  <textarea\r\n    #textArea\r\n    matInput\r\n    readonly\r\n    rows=\"1\"\r\n    [placeholder]=\"'igo.integration.map-proximity-tool.lat' | translate\"\r\n    [value]=\"coord2[1]\"\r\n  ></textarea>\r\n</mat-form-field>\r\n\r\n<button\r\n  *ngIf=\"\r\n    (mapProximityState.currentPositionCoordinate$ | async) &&\r\n    (mapProximityState.currentPositionCoordinate$ | async).length\r\n  \"\r\n  mat-icon-button\r\n  (click)=\"copyTextToClipboard()\"\r\n>\r\n  <mat-icon svgIcon=\"content-copy\"></mat-icon>\r\n</button>\r\n<div class=\"title-container\">\r\n  <mat-label class=\"title mat-typography\">{{\r\n    'igo.integration.map-proximity-tool.method' | translate\r\n  }}</mat-label>\r\n</div>\r\n<div class=\"igo-input-container mat-typography\">\r\n  <mat-radio-group (change)=\"onLocationTypeChange($event)\">\r\n    <mat-radio-button\r\n      [checked]=\"\r\n        (mapProximityState.proximitylocationType$ | async) === 'geolocation'\r\n      \"\r\n      value=\"geolocation\"\r\n      >{{\r\n        'igo.integration.map-proximity-tool.geolocation' | translate\r\n      }}</mat-radio-button\r\n    >\r\n    <mat-radio-button\r\n      [checked]=\"\r\n        (mapProximityState.proximitylocationType$ | async) === 'mapCenter'\r\n      \"\r\n      value=\"mapCenter\"\r\n      >{{\r\n        'igo.integration.map-proximity-tool.mapCenter' | translate\r\n      }}</mat-radio-button\r\n    >\r\n  </mat-radio-group>\r\n</div>\r\n\r\n<div class=\"radius-unit\">\r\n  <mat-form-field class=\"radius-field\" floatLabel=\"always\">\r\n    <mat-label>{{\r\n      'igo.integration.map-proximity-tool.radiusM' | translate\r\n    }}</mat-label>\r\n    <input\r\n      type=\"number\"\r\n      pattern=\"[0-9]*\"\r\n      [(ngModel)]=\"maxDistance\"\r\n      matInput\r\n      placeholder=\"{{\r\n        'igo.integration.map-proximity-tool.radiusM' | translate\r\n      }}\"\r\n    />\r\n  </mat-form-field>\r\n</div>\r\n","import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\r\nimport { MatRadioChange } from '@angular/material/radio';\r\n\r\nimport {\r\n  EntityTableComponent,\r\n  EntityTableTemplate,\r\n  ToolComponent\r\n} from '@igo2/common';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { Feature, IgoMap } from '@igo2/geo';\r\nimport { Clipboard, NumberUtils } from '@igo2/utils';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MapProximityState } from '../map-proximity.state';\r\nimport { MapState } from '../map.state';\r\n\r\n@ToolComponent({\r\n  name: 'map-proximity',\r\n  title: 'igo.integration.tools.closestFeature',\r\n  icon: 'radius'\r\n})\r\n/**\r\n * Tool to handle the advanced map tools\r\n */\r\n@Component({\r\n  selector: 'igo-map-proximity-tool',\r\n  templateUrl: './map-proximity-tool.component.html',\r\n  styleUrls: ['./map-proximity-tool.component.scss']\r\n})\r\nexport class MapProximityToolComponent implements OnInit, OnDestroy {\r\n  private subs$$: Subscription[] = [];\r\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\r\n\r\n  get maxDistance() {\r\n    return this.mapProximityState.proximityRadiusValue$.value;\r\n  }\r\n  set maxDistance(value: number) {\r\n    this.mapProximityState.proximityRadiusValue$.next(value);\r\n  }\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n  public userDefinedMapCenter: boolean;\r\n  public userDefinedFollowPosition: boolean;\r\n  /**\r\n   * Table template\r\n   * @internal\r\n   */\r\n  public tableTemplate: EntityTableTemplate;\r\n\r\n  constructor(\r\n    public mapState: MapState,\r\n    public mapProximityState: MapProximityState,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService\r\n  ) {\r\n    this.tableTemplate = {\r\n      selection: true,\r\n      selectMany: false,\r\n      selectionCheckbox: false,\r\n      sort: true,\r\n      columns: [\r\n        {\r\n          name: 'element',\r\n          title: this.languageService.translate.instant(\r\n            'igo.integration.map-proximity-tool.feature'\r\n          ),\r\n          valueAccessor: (localFeature: Feature) => {\r\n            return localFeature.properties.element;\r\n          }\r\n        },\r\n        {\r\n          name: 'distance',\r\n          title: this.languageService.translate.instant(\r\n            'igo.integration.map-proximity-tool.distance'\r\n          ),\r\n          valueAccessor: (localFeature: Feature) => {\r\n            return `${NumberUtils.roundToNDecimal(\r\n              localFeature.properties.distance,\r\n              1\r\n            )}m`;\r\n          }\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.mapProximityState.enabled$.next(true);\r\n    this.userDefinedFollowPosition =\r\n      this.map.geolocationController.followPosition === true;\r\n    this.userDefinedMapCenter = this.map.mapCenter$.value === true;\r\n\r\n    this.subs$$.push(\r\n      this.mapProximityState.proximitylocationType$.subscribe((v) => {\r\n        this.map.mapCenter$.next(v !== 'geolocation');\r\n        if (v === 'geolocation') {\r\n          this.map.geolocationController.followPosition = true;\r\n        } else {\r\n          this.map.geolocationController.followPosition = false;\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.mapProximityState.enabled$.next(false);\r\n    this.map.mapCenter$.next(this.userDefinedMapCenter);\r\n    this.subs$$.map((s) => s.unsubscribe());\r\n    this.map.geolocationController.followPosition =\r\n      this.userDefinedFollowPosition;\r\n  }\r\n\r\n  onLocationTypeChange(e: MatRadioChange) {\r\n    this.mapProximityState.proximitylocationType$.next(e.value);\r\n  }\r\n\r\n  /**\r\n   * Copy the coordinates to a clipboard\r\n   */\r\n  copyTextToClipboard(): void {\r\n    const successful = Clipboard.copy(\r\n      this.mapProximityState.currentPositionCoordinate$?.value.toString()\r\n    );\r\n    if (successful) {\r\n      this.messageService.success(\r\n        'igo.integration.map-proximity-tool.copyMsg',\r\n        'igo.integration.map-proximity-tool.copyTitle'\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\n\n/**\n * Service that holds the state of storage service\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageState {\n  get storageService(): StorageService {\n    return this.igoStorageService;\n  }\n\n  constructor(private igoStorageService: StorageService) {}\n}\n","import { DatePipe } from '@angular/common';\r\n\r\nimport {\r\n  Action,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreFilterSelectionStrategy,\r\n  Widget\r\n} from '@igo2/common';\r\nimport { LanguageService, MediaService, StorageService } from '@igo2/core';\r\nimport {\r\n  EditionWorkspace,\r\n  ExportOptions,\r\n  FeatureMotion,\r\n  FeatureStoreSelectionStrategy,\r\n  FeatureWorkspace,\r\n  OgcFilterableDataSource,\r\n  WfsWorkspace,\r\n  mapExtentStrategyActiveToolTip,\r\n  noElementSelected\r\n} from '@igo2/geo';\r\n\r\nimport * as jsPDF from 'jspdf';\r\nimport 'jspdf-autotable';\r\nimport { BehaviorSubject, map } from 'rxjs';\r\n\r\nimport { ToolState } from '../../tool';\r\n\r\nexport function handleZoomAuto(\r\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\r\n  storageService\r\n) {\r\n  const zoomStrategy = workspace.entityStore.getStrategyOfType(\r\n    FeatureStoreSelectionStrategy\r\n  ) as FeatureStoreSelectionStrategy;\r\n  zoomStrategy.setMotion(\r\n    (storageService.get('zoomAuto') as boolean)\r\n      ? FeatureMotion.Default\r\n      : FeatureMotion.None\r\n  );\r\n}\r\n\r\nexport function getWorkspaceActions(\r\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\r\n  rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n  selectOnlyCheckCondition$: BehaviorSubject<boolean>,\r\n  ogcFilterWidget: Widget,\r\n  zoomAuto$: BehaviorSubject<boolean>,\r\n  maximize$: BehaviorSubject<boolean>,\r\n  storageService: StorageService,\r\n  languageService: LanguageService,\r\n  mediaService: MediaService,\r\n  toolState: ToolState,\r\n  datePipe: DatePipe\r\n): Action[] {\r\n  const actions = [\r\n    {\r\n      id: 'zoomAuto',\r\n      checkbox: true,\r\n      title: 'igo.integration.workspace.zoomAuto.title',\r\n      tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\r\n      checkCondition: zoomAuto$,\r\n      handler: () => {\r\n        handleZoomAuto(workspace, storageService);\r\n        storageService.set(\r\n          'zoomAuto',\r\n          !storageService.get('zoomAuto') as boolean\r\n        );\r\n      }\r\n    },\r\n    {\r\n      id: 'filterInMapExtent',\r\n      checkbox: true,\r\n      title: 'igo.integration.workspace.inMapExtent.title',\r\n      tooltip: mapExtentStrategyActiveToolTip(workspace),\r\n      checkCondition: rowsInMapExtentCheckCondition$,\r\n      handler: () =>\r\n        rowsInMapExtentCheckCondition$.next(\r\n          !rowsInMapExtentCheckCondition$.value\r\n        )\r\n    },\r\n    {\r\n      id: 'selectedOnly',\r\n      checkbox: true,\r\n      title: 'igo.integration.workspace.selected.title',\r\n      tooltip: 'igo.integration.workspace.selected.tooltip',\r\n      checkCondition: selectOnlyCheckCondition$,\r\n      handler: () =>\r\n        selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\r\n    },\r\n    {\r\n      id: 'clearselection',\r\n      icon: 'select-off',\r\n      title: 'igo.integration.workspace.clearSelection.title',\r\n      tooltip: 'igo.integration.workspace.clearSelection.tooltip',\r\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\r\n        ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\r\n          selected: false\r\n        });\r\n      },\r\n      args: [workspace],\r\n      availability: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) =>\r\n        noElementSelected(ws)\r\n    },\r\n    {\r\n      id: 'featureDownload',\r\n      icon: 'file-export',\r\n      title: 'igo.integration.workspace.download.title',\r\n      tooltip: 'igo.integration.workspace.download.tooltip',\r\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\r\n        const filterStrategy = ws.entityStore.getStrategyOfType(\r\n          EntityStoreFilterCustomFuncStrategy\r\n        );\r\n        const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\r\n          EntityStoreFilterSelectionStrategy\r\n        );\r\n        const layersWithSelection = filterSelectionStrategy.active\r\n          ? [ws.layer.id]\r\n          : [];\r\n        toolState.toolToActivateFromOptions({\r\n          tool: 'importExport',\r\n          options: {\r\n            layers: [ws.layer.id],\r\n            featureInMapExtent: filterStrategy.active,\r\n            layersWithSelection\r\n          } as ExportOptions\r\n        });\r\n      },\r\n      args: [workspace]\r\n    },\r\n    {\r\n      id: 'ogcFilter',\r\n      icon: 'filter',\r\n      title: 'igo.integration.workspace.ogcFilter.title',\r\n      tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\r\n      handler: (\r\n        widget: Widget,\r\n        ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace\r\n      ) => {\r\n        ws.activateWidget(widget, {\r\n          map: ws.map,\r\n          layer: ws.layer\r\n        });\r\n      },\r\n      args: [ogcFilterWidget, workspace]\r\n    },\r\n    {\r\n      id: 'maximize',\r\n      title: languageService.translate.instant(\r\n        'igo.integration.workspace.maximize'\r\n      ),\r\n      tooltip: languageService.translate.instant(\r\n        'igo.integration.workspace.maximizeTooltip'\r\n      ),\r\n      icon: 'resize',\r\n      display: () => {\r\n        return maximize$.pipe(map((v) => !v && !mediaService.isMobile()));\r\n      },\r\n      handler: () => {\r\n        if (!mediaService.isMobile()) {\r\n          maximize$.next(true);\r\n        }\r\n      }\r\n    },\r\n    {\r\n      id: 'standardExtent',\r\n      title: languageService.translate.instant(\r\n        'igo.integration.workspace.standardExtent'\r\n      ),\r\n      tooltip: languageService.translate.instant(\r\n        'igo.integration.workspace.standardExtentTooltip'\r\n      ),\r\n      icon: 'resize',\r\n      display: () => {\r\n        return maximize$.pipe(map((v) => v && !mediaService.isMobile()));\r\n      },\r\n      handler: () => {\r\n        maximize$.next(false);\r\n      }\r\n    },\r\n    {\r\n      id: 'print',\r\n      icon: 'printer',\r\n      title: 'igo.integration.workspace.print.title',\r\n      tooltip: 'igo.integration.workspace.print.tooltip',\r\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\r\n        const title = `${ws.layer.title} (${datePipe.transform(\r\n          Date.now(),\r\n          'YYYY-MM-dd-H_mm'\r\n        )})`;\r\n        const doc: any = new jsPDF.default('landscape');\r\n        const totalPagesExp = '{total_pages_count_string}';\r\n        doc.text(title, 14, 20);\r\n        doc.autoTable({\r\n          startY: 25,\r\n          tableWidth: 'wrap',\r\n          html: '#currentWorkspaceTable',\r\n          horizontalPageBreak: true,\r\n          styles: { cellPadding: 0.5, minCellWidth: 20, fontSize: 6 },\r\n          didDrawPage: (data) => {\r\n            let str = 'Page ' + doc.internal.getNumberOfPages();\r\n            if (typeof doc.putTotalPages === 'function') {\r\n              str = str + ' / ' + totalPagesExp;\r\n            }\r\n            doc.setFontSize(6);\r\n            const pageSize = doc.internal.pageSize;\r\n            const pageHeight = pageSize.height\r\n              ? pageSize.height\r\n              : pageSize.getHeight();\r\n            doc.text(str, data.settings.margin.left, pageHeight - 10);\r\n          }\r\n        });\r\n        if (typeof doc.putTotalPages === 'function') {\r\n          doc.putTotalPages(totalPagesExp);\r\n        }\r\n        doc.save(`${title}.pdf`);\r\n      },\r\n      args: [workspace]\r\n    }\r\n  ];\r\n  let returnActions = (workspace.layer.dataSource as OgcFilterableDataSource)\r\n    .options.ogcFilters?.enabled\r\n    ? actions\r\n    : actions.filter((action) => action.id !== 'ogcFilter');\r\n  returnActions =\r\n    workspace.layer.options.workspace.printable !== false\r\n      ? actions\r\n      : actions.filter((action) => action.id !== 'print');\r\n  return returnActions;\r\n}\r\n","import { DatePipe } from '@angular/common';\r\nimport { Inject, Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport { Action, Widget } from '@igo2/common';\r\nimport {\r\n  LanguageService,\r\n  MediaService,\r\n  StorageService,\r\n  StorageServiceEvent,\r\n  StorageServiceEventEnum\r\n} from '@igo2/core';\r\nimport { EditionWorkspace, OgcFilterWidget } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\nimport { StorageState } from '../../storage/storage.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class EditionActionsService implements OnDestroy {\r\n  public maximize$: BehaviorSubject<boolean>;\r\n\r\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private storageChange$$: Subscription;\r\n\r\n  get storageService(): StorageService {\r\n    return this.storageState.storageService;\r\n  }\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\r\n    private storageState: StorageState,\r\n    public languageService: LanguageService,\r\n    private mediaService: MediaService,\r\n    private toolState: ToolState,\r\n    private datePipe: DatePipe\r\n  ) {\r\n    this.maximize$ = new BehaviorSubject(\r\n      this.storageService.get('workspaceMaximize') as boolean\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.storageChange$$) {\r\n      this.storageChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  loadActions(\r\n    workspace: EditionWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ) {\r\n    const actions = this.buildActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$\r\n    );\r\n    workspace.actionStore.load(actions);\r\n  }\r\n\r\n  buildActions(\r\n    workspace: EditionWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ): Action[] {\r\n    this.zoomAuto$.next(this.zoomAuto);\r\n    this.storageChange$$ = this.storageService.storageChange$\r\n      .pipe(\r\n        skipWhile(\r\n          (storageChange: StorageServiceEvent) =>\r\n            storageChange?.key !== 'zoomAuto' ||\r\n            storageChange?.event === StorageServiceEventEnum.CLEARED\r\n        )\r\n      )\r\n      .subscribe(() => {\r\n        this.zoomAuto$.next(this.zoomAuto);\r\n        handleZoomAuto(workspace, this.storageService);\r\n      });\r\n    return getWorkspaceActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$,\r\n      this.ogcFilterWidget,\r\n      this.zoomAuto$,\r\n      this.maximize$,\r\n      this.storageService,\r\n      this.languageService,\r\n      this.mediaService,\r\n      this.toolState,\r\n      this.datePipe\r\n    );\r\n  }\r\n}\r\n","import { DatePipe } from '@angular/common';\r\nimport { Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport { Action } from '@igo2/common';\r\nimport {\r\n  LanguageService,\r\n  MediaService,\r\n  StorageService,\r\n  StorageServiceEvent,\r\n  StorageServiceEventEnum\r\n} from '@igo2/core';\r\nimport { FeatureWorkspace } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\nimport { StorageState } from '../../storage/storage.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FeatureActionsService implements OnDestroy {\r\n  public maximize$: BehaviorSubject<boolean>;\r\n\r\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private storageChange$$: Subscription;\r\n\r\n  get storageService(): StorageService {\r\n    return this.storageState.storageService;\r\n  }\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    private storageState: StorageState,\r\n    public languageService: LanguageService,\r\n    private toolState: ToolState,\r\n    private mediaService: MediaService,\r\n    private datePipe: DatePipe\r\n  ) {\r\n    this.maximize$ = new BehaviorSubject(\r\n      this.storageService.get('workspaceMaximize') as boolean\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.storageChange$$) {\r\n      this.storageChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  loadActions(\r\n    workspace: FeatureWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ) {\r\n    const actions = this.buildActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$\r\n    );\r\n    workspace.actionStore.load(actions);\r\n  }\r\n\r\n  buildActions(\r\n    workspace: FeatureWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ): Action[] {\r\n    this.zoomAuto$.next(this.zoomAuto);\r\n    this.storageChange$$ = this.storageService.storageChange$\r\n      .pipe(\r\n        skipWhile(\r\n          (storageChange: StorageServiceEvent) =>\r\n            storageChange?.key !== 'zoomAuto' ||\r\n            storageChange?.event === StorageServiceEventEnum.CLEARED\r\n        )\r\n      )\r\n      .subscribe(() => {\r\n        this.zoomAuto$.next(this.zoomAuto);\r\n        handleZoomAuto(workspace, this.storageService);\r\n      });\r\n    return getWorkspaceActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$,\r\n      undefined,\r\n      this.zoomAuto$,\r\n      this.maximize$,\r\n      this.storageService,\r\n      this.languageService,\r\n      this.mediaService,\r\n      this.toolState,\r\n      this.datePipe\r\n    );\r\n  }\r\n}\r\n","import { DatePipe } from '@angular/common';\r\nimport { Inject, Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport { Action, Widget } from '@igo2/common';\r\nimport {\r\n  LanguageService,\r\n  MediaService,\r\n  StorageService,\r\n  StorageServiceEvent,\r\n  StorageServiceEventEnum\r\n} from '@igo2/core';\r\nimport { OgcFilterWidget, WfsWorkspace } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\nimport { StorageState } from '../../storage/storage.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WfsActionsService implements OnDestroy {\r\n  public maximize$: BehaviorSubject<boolean>;\r\n\r\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private storageChange$$: Subscription;\r\n\r\n  get storageService(): StorageService {\r\n    return this.storageState.storageService;\r\n  }\r\n\r\n  get zoomAuto(): boolean {\r\n    return this.storageService.get('zoomAuto') as boolean;\r\n  }\r\n\r\n  constructor(\r\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\r\n    private storageState: StorageState,\r\n    public languageService: LanguageService,\r\n    private mediaService: MediaService,\r\n    private toolState: ToolState,\r\n    private datePipe: DatePipe\r\n  ) {\r\n    this.maximize$ = new BehaviorSubject(\r\n      this.storageService.get('workspaceMaximize') as boolean\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.storageChange$$) {\r\n      this.storageChange$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  loadActions(\r\n    workspace: WfsWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ) {\r\n    const actions = this.buildActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$\r\n    );\r\n    workspace.actionStore.load(actions);\r\n  }\r\n\r\n  buildActions(\r\n    workspace: WfsWorkspace,\r\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\r\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\r\n  ): Action[] {\r\n    this.zoomAuto$.next(this.zoomAuto);\r\n    this.storageChange$$ = this.storageService.storageChange$\r\n      .pipe(\r\n        skipWhile(\r\n          (storageChange: StorageServiceEvent) =>\r\n            storageChange?.key !== 'zoomAuto' ||\r\n            storageChange?.event === StorageServiceEventEnum.CLEARED\r\n        )\r\n      )\r\n      .subscribe(() => {\r\n        this.zoomAuto$.next(this.zoomAuto);\r\n        handleZoomAuto(workspace, this.storageService);\r\n      });\r\n    return getWorkspaceActions(\r\n      workspace,\r\n      rowsInMapExtentCheckCondition$,\r\n      selectOnlyCheckCondition$,\r\n      this.ogcFilterWidget,\r\n      this.zoomAuto$,\r\n      this.maximize$,\r\n      this.storageService,\r\n      this.languageService,\r\n      this.mediaService,\r\n      this.toolState,\r\n      this.datePipe\r\n    );\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\n\r\nimport {\r\n  EntityRecord,\r\n  EntityState,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreFilterSelectionStrategy,\r\n  Widget,\r\n  Workspace,\r\n  WorkspaceStore\r\n} from '@igo2/common';\r\nimport { StorageService } from '@igo2/core';\r\nimport { EditionWorkspace, FeatureWorkspace, WfsWorkspace } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, Observable, Subscription, of } from 'rxjs';\r\n\r\nimport { EditionActionsService } from './shared/edition-actions.service';\r\nimport { FeatureActionsService } from './shared/feature-actions.service';\r\nimport { WfsActionsService } from './shared/wfs-actions.service';\r\n\r\n/**\r\n * Service that holds the state of the workspace module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WorkspaceState implements OnDestroy {\r\n  public workspacePanelExpanded: boolean = false;\r\n\r\n  readonly workspaceEnabled$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(false);\r\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(true);\r\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject<boolean>(false);\r\n\r\n  readonly workspaceMaximize$: BehaviorSubject<boolean>;\r\n  private actionMaximize$$: Subscription[] = [];\r\n\r\n  private rowsInMapExtentCheckCondition$$: Subscription;\r\n  private selectOnlyCheckCondition$$: Subscription;\r\n\r\n  /** Subscription to the active workspace */\r\n  private activeWorkspace$$: Subscription;\r\n\r\n  /** Subscription to the active workspace widget */\r\n  private activeWorkspaceWidget$$: Subscription;\r\n\r\n  /** Active widget observable. Only one may be active for all available workspaces */\r\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> =\r\n    new BehaviorSubject<Widget>(undefined);\r\n\r\n  /**\r\n   * Observable of the active workspace\r\n   */\r\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\r\n\r\n  /**\r\n   * Store that holds all the available workspaces\r\n   */\r\n  get store(): WorkspaceStore {\r\n    return this._store;\r\n  }\r\n  private _store: WorkspaceStore;\r\n\r\n  get workspaceSelection() {\r\n    if (this.workspace$.value) {\r\n      return this.workspace$.value?.entityStore.stateView.manyBy(\r\n        (r) => r.state.selected === true\r\n      );\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  get workspaceSelection$(): Observable<EntityRecord<object, EntityState>[]> {\r\n    if (this.workspace$.value) {\r\n      return this.workspace$.value?.entityStore?.stateView.manyBy$(\r\n        (r) => r.state.selected === true\r\n      );\r\n    } else {\r\n      return of([]);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private featureActionsService: FeatureActionsService,\r\n    private wfsActionsService: WfsActionsService,\r\n    private editionActionsService: EditionActionsService,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.workspaceMaximize$ = new BehaviorSubject(\r\n      this.storageService.get('workspaceMaximize') as boolean\r\n    );\r\n    this.initWorkspaces();\r\n  }\r\n\r\n  /**\r\n   * Initialize the workspace store. Each time a workspace is activated,\r\n   * subscribe to it's active widget. Tracking the active widget is useful\r\n   * to make sure only one widget is active at a time.\r\n   */\r\n  private initWorkspaces() {\r\n    this._store = new WorkspaceStore([]);\r\n    this._store.stateView\r\n      .firstBy$(\r\n        (record: EntityRecord<Workspace>) => record.state.active === true\r\n      )\r\n      .subscribe((record: EntityRecord<Workspace>) => {\r\n        const workspace = record ? record.entity : undefined;\r\n        this.workspace$.next(workspace);\r\n      });\r\n\r\n    this._store.stateView\r\n      .all$()\r\n      .subscribe((workspaces: EntityRecord<Workspace>[]) => {\r\n        workspaces.map((wks: EntityRecord<Workspace>) => {\r\n          if (wks.entity.actionStore.empty) {\r\n            if (wks.entity instanceof WfsWorkspace) {\r\n              this.wfsActionsService.loadActions(\r\n                wks.entity,\r\n                this.rowsInMapExtentCheckCondition$,\r\n                this.selectOnlyCheckCondition$\r\n              );\r\n            } else if (wks.entity instanceof FeatureWorkspace) {\r\n              this.featureActionsService.loadActions(\r\n                wks.entity,\r\n                this.rowsInMapExtentCheckCondition$,\r\n                this.selectOnlyCheckCondition$\r\n              );\r\n            } else if (wks.entity instanceof EditionWorkspace) {\r\n              this.editionActionsService.loadActions(\r\n                wks.entity,\r\n                this.rowsInMapExtentCheckCondition$,\r\n                this.selectOnlyCheckCondition$\r\n              );\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n    this.actionMaximize$$.push(\r\n      this.featureActionsService.maximize$.subscribe((maximized) => {\r\n        this.setWorkspaceIsMaximized(maximized);\r\n      })\r\n    );\r\n\r\n    this.actionMaximize$$.push(\r\n      this.wfsActionsService.maximize$.subscribe((maximized) => {\r\n        this.setWorkspaceIsMaximized(maximized);\r\n      })\r\n    );\r\n\r\n    this.actionMaximize$$.push(\r\n      this.editionActionsService.maximize$.subscribe((maximized) => {\r\n        this.setWorkspaceIsMaximized(maximized);\r\n      })\r\n    );\r\n\r\n    this.activeWorkspace$$ = this.workspace$.subscribe(\r\n      (workspace: Workspace) => {\r\n        if (this.activeWorkspaceWidget$$ !== undefined) {\r\n          this.activeWorkspaceWidget$$.unsubscribe();\r\n          this.activeWorkspaceWidget$$ = undefined;\r\n        }\r\n\r\n        if (workspace !== undefined) {\r\n          this.activeWorkspaceWidget$$ = workspace.widget$.subscribe(\r\n            (widget: Widget) => this.activeWorkspaceWidget$.next(widget)\r\n          );\r\n        }\r\n      }\r\n    );\r\n\r\n    this.rowsInMapExtentCheckCondition$$ =\r\n      this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\r\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\r\n          if (!wks.entity.actionStore.empty) {\r\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\r\n              EntityStoreFilterCustomFuncStrategy\r\n            );\r\n            if (filterStrategy) {\r\n              if (rowsInMapExtent) {\r\n                filterStrategy.activate();\r\n              } else {\r\n                filterStrategy.deactivate();\r\n              }\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe(\r\n      (selectOnly) => {\r\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\r\n          if (!wks.entity.actionStore.empty) {\r\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\r\n              EntityStoreFilterSelectionStrategy\r\n            );\r\n            if (filterStrategy) {\r\n              if (selectOnly) {\r\n                filterStrategy.activate();\r\n              } else {\r\n                filterStrategy.deactivate();\r\n              }\r\n            }\r\n          }\r\n        });\r\n      }\r\n    );\r\n  }\r\n\r\n  private setWorkspaceIsMaximized(maximized: boolean) {\r\n    this.storageService.set('workspaceMaximize', maximized);\r\n    this.workspaceMaximize$.next(maximized);\r\n  }\r\n\r\n  public setActiveWorkspaceById(id: string) {\r\n    const wksFromId = this.store.all().find((workspace) => workspace.id === id);\r\n    if (wksFromId) {\r\n      this.store.activateWorkspace(wksFromId);\r\n    }\r\n  }\r\n\r\n  public setActiveWorkspaceByTitle(title: string) {\r\n    const wksFromTitle = this.store\r\n      .all()\r\n      .find((workspace) => workspace.title === title);\r\n    if (wksFromTitle) {\r\n      this.store.activateWorkspace(wksFromTitle);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Teardown all the workspaces\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.teardownWorkspaces();\r\n    this.actionMaximize$$.map((a) => a.unsubscribe());\r\n    if (this.rowsInMapExtentCheckCondition$$) {\r\n      this.selectOnlyCheckCondition$$.unsubscribe();\r\n    }\r\n    if (this.selectOnlyCheckCondition$$) {\r\n      this.selectOnlyCheckCondition$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Teardown the workspace store and any subscribers\r\n   */\r\n  private teardownWorkspaces() {\r\n    this.store.clear();\r\n    if (this.activeWorkspaceWidget$$ !== undefined) {\r\n      this.activeWorkspaceWidget$$.unsubscribe();\r\n    }\r\n    if (this.activeWorkspace$$ !== undefined) {\r\n      this.activeWorkspace$$.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","<button\n  *ngIf=\"hasWorkspace$ | async\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.integration.workspace.toggleWorkspace' | translate\"\n  [color]=\"color\"\n  (click)=\"activateWorkspace()\"\n>\n  <mat-icon svgIcon=\"table\"></mat-icon>\n</button>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport type { Layer } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, Subscription, combineLatest } from 'rxjs';\r\n\r\nimport { WorkspaceState } from '../workspace.state';\r\n\r\n@Component({\r\n  selector: 'igo-workspace-button',\r\n  templateUrl: './workspace-button.component.html',\r\n  styleUrls: ['./workspace-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WorkspaceButtonComponent implements OnInit, OnDestroy {\r\n  public hasWorkspace$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private hasWorkspace$$: Subscription;\r\n\r\n  private _layer: Layer;\r\n  private layer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\r\n  @Input()\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    this.layer$.next(this._layer);\r\n  }\r\n\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  constructor(private workspaceState: WorkspaceState) {}\r\n\r\n  ngOnInit(): void {\r\n    this.hasWorkspace$$ = combineLatest([\r\n      this.workspaceState.workspaceEnabled$,\r\n      this.layer$\r\n    ]).subscribe((bunch) =>\r\n      this.hasWorkspace$.next(bunch[0] && bunch[1]?.options.workspace?.enabled)\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.hasWorkspace$$.unsubscribe();\r\n  }\r\n\r\n  activateWorkspace() {\r\n    if (\r\n      this.workspaceState.workspace$.value &&\r\n      (this.workspaceState.workspace$.value as any).layer.id ===\r\n        this.layer.id &&\r\n      this.workspaceState.workspacePanelExpanded\r\n    ) {\r\n      this.workspaceState.workspacePanelExpanded = false;\r\n    } else {\r\n      this.workspaceState.workspacePanelExpanded = true;\r\n      this.workspaceState.setActiveWorkspaceById(this.layer.id);\r\n    }\r\n  }\r\n}\r\n","<igo-layer-list\n  class=\"mapDetailsList\"\n  *ngIf=\"(layers$ | async).length; else empty\"\n  [map]=\"map\"\n  igoLayerListBinding\n  [excludeBaseLayers]=\"excludeBaseLayers\"\n  [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n  [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n  [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  floatLabel=\"never\"\n  [queryBadge]=\"queryBadge\"\n>\n  <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n    <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\n    <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n    <igo-export-button\n      [layer]=\"layer\"\n      (click)=\"activateExport(layer)\"\n    ></igo-export-button>\n    <igo-ogc-filter-button\n      [header]=\"ogcButton\"\n      [layer]=\"layer\"\n    ></igo-ogc-filter-button>\n    <igo-time-filter-button\n      [header]=\"timeButton\"\n      [layer]=\"layer\"\n    ></igo-time-filter-button>\n    <igo-track-feature-button\n      [trackFeature]=\"true\"\n      [layer]=\"layer\"\n    ></igo-track-feature-button>\n    <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n  </ng-template>\n</igo-layer-list>\n\n<ng-template #empty>\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.mapTool.empty' | translate }}\n    </p>\n    <p\n      *ngIf=\"\n        layerAdditionAllowed &&\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n      \"\n      class=\"map-empty mat-typography\"\n    >\n      {{ 'igo.integration.mapTool.customize' | translate }}\n    </p>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  ExportOptions,\r\n  IgoMap,\r\n  Layer,\r\n  LayerListControlsEnum,\r\n  LayerListControlsOptions,\r\n  SearchSourceService,\r\n  sourceCanSearch\r\n} from '@igo2/geo';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from '../../import-export/import-export.state';\r\nimport { ToolState } from './../../tool/tool.state';\r\nimport { MapState } from './../map.state';\r\n\r\n@ToolComponent({\r\n  name: 'mapDetails',\r\n  title: 'igo.integration.tools.map',\r\n  icon: 'map'\r\n})\r\n@Component({\r\n  selector: 'igo-map-details-tool',\r\n  templateUrl: './map-details-tool.component.html',\r\n  styleUrls: ['./map-details-tool.component.scss']\r\n})\r\nexport class MapDetailsToolComponent implements OnInit {\r\n  public delayedShowEmptyMapContent: boolean = false;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input() layerListControls: LayerListControlsOptions = {};\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Input() layerAdditionAllowed: boolean = true;\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layers$(): Observable<Layer[]> {\r\n    return this.map.layers$.pipe(\r\n      map((layers) =>\r\n        layers.filter(\r\n          (layer) =>\r\n            layer.showInLayerList !== false &&\r\n            (!this.excludeBaseLayers || !layer.baseLayer)\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  get excludeBaseLayers(): boolean {\r\n    return this.layerListControls.excludeBaseLayers || false;\r\n  }\r\n\r\n  get layerFilterAndSortOptions(): any {\r\n    const filterSortOptions = Object.assign(\r\n      {\r\n        showToolbar: LayerListControlsEnum.default\r\n      },\r\n      this.layerListControls\r\n    );\r\n\r\n    switch (this.layerListControls.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\r\n        break;\r\n      case LayerListControlsEnum.never:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return filterSortOptions;\r\n  }\r\n\r\n  get searchToolInToolbar(): boolean {\r\n    return (\r\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\r\n      this.searchSourceService\r\n        .getSources()\r\n        .filter(sourceCanSearch)\r\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\r\n    );\r\n  }\r\n\r\n  get catalogToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\r\n  }\r\n\r\n  get contextToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private toolState: ToolState,\r\n    private searchSourceService: SearchSourceService,\r\n    private cdRef: ChangeDetectorRef,\r\n    private importExportState: ImportExportState\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    // prevent message to be shown too quickly. Waiting for layers\r\n    setTimeout(() => {\r\n      this.delayedShowEmptyMapContent = true;\r\n      this.cdRef.detectChanges();\r\n    }, 250);\r\n  }\r\n\r\n  searchEmit() {\r\n    this.toolState.toolbox.activateTool('searchResults');\r\n  }\r\n\r\n  catalogEmit() {\r\n    this.toolState.toolbox.activateTool('catalog');\r\n  }\r\n\r\n  contextEmit() {\r\n    this.toolState.toolbox.activateTool('contextManager');\r\n  }\r\n\r\n  activateExport(layer: Layer) {\r\n    let id = layer.id;\r\n    if (layer.options.workspace?.workspaceId) {\r\n      id =\r\n        layer.options.workspace.workspaceId !== layer.id\r\n          ? layer.options.workspace.workspaceId\r\n          : layer.id;\r\n    }\r\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\r\n    this.importExportState.setMode(ImportExportMode.export);\r\n    this.toolState.toolbox.activateTool('importExport');\r\n  }\r\n}\r\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\r\n\r\nimport { Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { LayerLegendListComponent } from './layer-legend-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoLayerLegendListBinding]'\r\n})\r\nexport class LayerLegendListBindingDirective implements OnInit, OnDestroy {\r\n  private component: LayerLegendListComponent;\r\n  private layersOrResolutionChange$$: Subscription;\r\n  layersVisibility$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: LayerLegendListComponent,\r\n    private mapService: MapService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    this.component.layers = [];\r\n    this.layersOrResolutionChange$$ = combineLatest([\r\n      this.mapService.getMap().layers$,\r\n      this.mapService.getMap().viewController.resolution$\r\n    ])\r\n      .pipe(debounceTime(10))\r\n      .subscribe((bunch: [Layer[], number]) => {\r\n        const shownLayers = bunch[0].filter((layer: Layer) => {\r\n          return layer.showInLayerList === true;\r\n        });\r\n        this.component.layers = shownLayers;\r\n\r\n        this.layersVisibility$$ = combineLatest(\r\n          shownLayers.map((layer: Layer) => layer.visible$)\r\n        ).subscribe((r) => {\r\n          this.component.change$.next();\r\n        });\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layersOrResolutionChange$$.unsubscribe();\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n  }\r\n}\r\n","<igo-layer-legend-list\n  *ngIf=\"showAllLegend()\"\n  igoLayerLegendListBinding\n  [excludeBaseLayers]=\"excludeBaseLayers\"\n  [allowShowAllLegends]=\"allowShowAllLegends\"\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\n  (allLegendsShown)=\"onShowAllLegends($event)\"\n>\n</igo-layer-legend-list>\n<ng-template\n  *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n></ng-template>\n\n<p\n  class=\"map-empty mat-typography\"\n  *ngIf=\"\n    !allowShowAllLegends &&\n    (layers$ | async).length !== 0 &&\n    (visibleOrInRangeLayers$ | async).length === 0\n  \"\n>\n  {{\n    (visibleLayers$ | async).length\n      ? ('igo.integration.mapTool.noLayersInRange' | translate)\n      : ('igo.integration.mapTool.noLayersVisible' | translate)\n  }}\n</p>\n\n<ng-template #emptyLayers>\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.mapTool.empty' | translate }}\n    </p>\n    <p\n      *ngIf=\"\n        layerAdditionAllowed &&\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n      \"\n      class=\"map-empty mat-typography\"\n    >\n      {{ 'igo.integration.mapTool.customize' | translate }}\n    </p>\n\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  IgoMap,\r\n  Layer,\r\n  LayerListControlsOptions,\r\n  SearchSourceService,\r\n  sourceCanSearch\r\n} from '@igo2/geo';\r\n\r\nimport {\r\n  BehaviorSubject,\r\n  Observable,\r\n  ReplaySubject,\r\n  Subscription,\r\n  combineLatest\r\n} from 'rxjs';\r\nimport { debounceTime, map } from 'rxjs/operators';\r\n\r\nimport { ToolState } from './../../tool/tool.state';\r\nimport { MapState } from './../map.state';\r\n\r\n@ToolComponent({\r\n  name: 'mapLegend',\r\n  title: 'igo.integration.tools.legend',\r\n  icon: 'format-list-bulleted-type'\r\n})\r\n@Component({\r\n  selector: 'igo-map-legend-tool',\r\n  templateUrl: './map-legend-tool.component.html',\r\n  styleUrls: ['./map-legend-tool.component.scss']\r\n})\r\nexport class MapLegendToolComponent implements OnInit, OnDestroy {\r\n  public delayedShowEmptyMapContent: boolean = false;\r\n\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  private resolution$$: Subscription;\r\n  private visibleOrInRangeLayers$$: Subscription;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() layerAdditionAllowed: boolean = true;\r\n\r\n  @Input() allowShowAllLegends: boolean = false;\r\n\r\n  @Input() showAllLegendsValue: boolean = false;\r\n\r\n  @Input() layerListControls: LayerListControlsOptions = {};\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\r\n    return this.layers$.pipe(\r\n      map((layers) =>\r\n        layers.filter(\r\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  get visibleLayers$(): Observable<Layer[]> {\r\n    return this.layers$.pipe(\r\n      map((layers) => layers.filter((layer) => layer.visible$.value))\r\n    );\r\n  }\r\n\r\n  get excludeBaseLayers(): boolean {\r\n    return this.layerListControls.excludeBaseLayers || false;\r\n  }\r\n\r\n  get searchToolInToolbar(): boolean {\r\n    return (\r\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\r\n      this.searchSourceService\r\n        .getSources()\r\n        .filter(sourceCanSearch)\r\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\r\n    );\r\n  }\r\n\r\n  get catalogToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\r\n  }\r\n\r\n  get contextToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\r\n  }\r\n  constructor(\r\n    private mapState: MapState,\r\n    private toolState: ToolState,\r\n    private searchSourceService: SearchSourceService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.resolution$$ = combineLatest([\r\n      this.map.layers$,\r\n      this.map.viewController.resolution$\r\n    ])\r\n      .pipe(debounceTime(10))\r\n      .subscribe((bunch: [Layer[], number]) => {\r\n        this.layers$.next(\r\n          bunch[0].filter(\r\n            (layer) =>\r\n              layer.showInLayerList !== false &&\r\n              (!this.excludeBaseLayers || !layer.baseLayer)\r\n          )\r\n        );\r\n      });\r\n\r\n    if (this.allowShowAllLegends) {\r\n      this.mapState.showAllLegendsValue =\r\n        this.mapState.showAllLegendsValue !== undefined\r\n          ? this.mapState.showAllLegendsValue\r\n          : this.showAllLegendsValue || false;\r\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\r\n    } else {\r\n      this.showAllLegendsValue$.next(false);\r\n    }\r\n\r\n    // prevent message to be shown too quickly. Waiting for layers\r\n    setTimeout(() => {\r\n      this.delayedShowEmptyMapContent = true;\r\n      this.cdRef.detectChanges();\r\n    }, 250);\r\n  }\r\n\r\n  onShowAllLegends(event) {\r\n    this.mapState.showAllLegendsValue = event;\r\n    this.showAllLegendsValue$.next(event);\r\n  }\r\n\r\n  showAllLegend() {\r\n    if (this.layers$.getValue().length === 0) {\r\n      return false;\r\n    } else if (\r\n      this.layers$.getValue().length !== 0 &&\r\n      this.allowShowAllLegends === false\r\n    ) {\r\n      let visibleOrInRangeLayers;\r\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\r\n        (value) => {\r\n          value.length === 0\r\n            ? (visibleOrInRangeLayers = false)\r\n            : (visibleOrInRangeLayers = true);\r\n        }\r\n      );\r\n\r\n      if (visibleOrInRangeLayers === false) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.resolution$$.unsubscribe();\r\n    if (this.visibleOrInRangeLayers$$) {\r\n      this.visibleOrInRangeLayers$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  searchEmit() {\r\n    this.toolState.toolbox.activateTool('searchResults');\r\n  }\r\n\r\n  catalogEmit() {\r\n    this.toolState.toolbox.activateTool('catalog');\r\n  }\r\n\r\n  contextEmit() {\r\n    this.toolState.toolbox.activateTool('contextManager');\r\n  }\r\n}\r\n","<mat-tab-group>\n  <mat-tab [label]=\"'igo.integration.tools.map' | translate\">\n    <igo-layer-list\n      [map]=\"map\"\n      igoLayerListBinding\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [floatLabel]=\"false\"\n      [queryBadge]=\"queryBadge\"\n    >\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n        <igo-export-button\n          [layer]=\"layer\"\n          (click)=\"activateExport(layer)\"\n        ></igo-export-button>\n        <igo-ogc-filter-button\n          [header]=\"ogcButton\"\n          [layer]=\"layer\"\n        ></igo-ogc-filter-button>\n        <igo-time-filter-button\n          [header]=\"timeButton\"\n          [layer]=\"layer\"\n        ></igo-time-filter-button>\n        <igo-track-feature-button\n          [trackFeature]=\"true\"\n          [layer]=\"layer\"\n        ></igo-track-feature-button>\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n      </ng-template>\n    </igo-layer-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.integration.tools.contexts' | translate\">\n    <igo-context-list igoContextListBinding></igo-context-list>\n  </mat-tab>\n</mat-tab-group>\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  ExportOptions,\r\n  IgoMap,\r\n  Layer,\r\n  LayerListControlsEnum,\r\n  LayerListControlsOptions\r\n} from '@igo2/geo';\r\n\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from '../../import-export/import-export.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { MapState } from './../map.state';\r\n\r\n/**\r\n * Tool to browse a map's layers or to choose a different map\r\n */\r\n@ToolComponent({\r\n  name: 'map',\r\n  title: 'igo.integration.tools.map',\r\n  icon: 'map'\r\n})\r\n@Component({\r\n  selector: 'igo-map-tool',\r\n  templateUrl: './map-tool.component.html',\r\n  styleUrls: ['./map-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MapToolComponent {\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input() layerListControls: LayerListControlsOptions = {};\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get excludeBaseLayers(): boolean {\r\n    return this.layerListControls.excludeBaseLayers || false;\r\n  }\r\n\r\n  get layerFilterAndSortOptions(): any {\r\n    const filterSortOptions = Object.assign(\r\n      {\r\n        showToolbar: LayerListControlsEnum.default\r\n      },\r\n      this.layerListControls\r\n    );\r\n\r\n    switch (this.layerListControls.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\r\n        break;\r\n      case LayerListControlsEnum.never:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return filterSortOptions;\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private toolState: ToolState,\r\n    private importExportState: ImportExportState\r\n  ) {}\r\n\r\n  activateExport(layer: Layer) {\r\n    let id = layer.id;\r\n    if (layer.options.workspace?.workspaceId) {\r\n      id =\r\n        layer.options.workspace.workspaceId !== layer.id\r\n          ? layer.options.workspace.workspaceId\r\n          : layer.id;\r\n    }\r\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\r\n    this.importExportState.setMode(ImportExportMode.export);\r\n    this.toolState.toolbox.activateTool('importExport');\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { LayerListControlsOptions } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n/**\r\n * Service that holds the state of layer list tool values\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerListToolState {\r\n  readonly keyword$: BehaviorSubject<string> = new BehaviorSubject('');\r\n  readonly sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  readonly onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  readonly selectedTab$: BehaviorSubject<number> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  setKeyword(keyword: string) {\r\n    this.keyword$.next(keyword);\r\n  }\r\n\r\n  setSortAlpha(sort: boolean) {\r\n    this.sortAlpha$.next(sort);\r\n  }\r\n\r\n  setOnlyVisible(onlyVisible: boolean) {\r\n    this.onlyVisible$.next(onlyVisible);\r\n  }\r\n\r\n  setSelectedTab(tab: number) {\r\n    this.selectedTab$.next(tab);\r\n  }\r\n\r\n  getLayerListControls(): LayerListControlsOptions {\r\n    return {\r\n      keyword: this.keyword$.value,\r\n      onlyVisible: this.onlyVisible$.value,\r\n      sortAlpha: this.sortAlpha$.value\r\n    };\r\n  }\r\n}\r\n","<mat-tab-group\n  #tabGroup\n  [selectedIndex]=\"layerListToolState.selectedTab$ | async\"\n  (selectedTabChange)=\"tabChanged($event)\"\n>\n  <mat-tab [label]=\"'igo.integration.tools.layers' | translate\">\n    <igo-layer-list\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n      igoLayerListBinding\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [floatLabel]=\"false\"\n      [queryBadge]=\"queryBadge\"\n      [map]=\"map\"\n      (appliedFilterAndSort)=\"onLayerListChange($event)\"\n    >\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-style-modal-layer-button\n          *ngIf=\"isStyleEditButton(layer)\"\n          [layer]=\"layer\"\n        ></igo-style-modal-layer-button>\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n        <igo-track-feature-button\n          [trackFeature]=\"true\"\n          [layer]=\"layer\"\n        ></igo-track-feature-button>\n        <igo-time-filter-button\n          *ngIf=\"isTimeFilterButton(layer)\"\n          [header]=\"timeButton\"\n          [layer]=\"layer\"\n          (click)=\"activateTimeFilter()\"\n        ></igo-time-filter-button>\n        <igo-ogc-filter-button\n          *ngIf=\"isOGCFilterButton(layer)\"\n          [header]=\"ogcButton\"\n          [layer]=\"layer\"\n          (click)=\"activateOgcFilter()\"\n        ></igo-ogc-filter-button>\n        <igo-export-button\n          *ngIf=\"isExportButton(layer)\"\n          [layer]=\"layer\"\n          (click)=\"activateExport(layer)\"\n        ></igo-export-button>\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n      </ng-template>\n    </igo-layer-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.integration.tools.legend' | translate\">\n    <igo-layer-legend-list\n      *ngIf=\"showAllLegend()\"\n      igoLayerLegendListBinding\n      [allowShowAllLegends]=\"allowShowAllLegends\"\n      [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\n      (allLegendsShown)=\"onShowAllLegends($event)\"\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n    >\n    </igo-layer-legend-list>\n    <ng-template\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n    ></ng-template>\n\n    <p\n      class=\"map-empty mat-typography\"\n      *ngIf=\"\n        !allowShowAllLegends &&\n        (layers$ | async).length !== 0 &&\n        (visibleOrInRangeLayers$ | async).length === 0\n      \"\n    >\n      {{\n        (visibleLayers$ | async).length\n          ? ('igo.integration.mapTool.noLayersInRange' | translate)\n          : ('igo.integration.mapTool.noLayersVisible' | translate)\n      }}\n    </p>\n  </mat-tab>\n\n  <ng-template #emptyLayers>\n    <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n      <p class=\"map-empty mat-typography\">\n        {{ 'igo.integration.mapTool.empty' | translate }}\n      </p>\n      <p\n        *ngIf=\"\n          layerAdditionAllowed &&\n          (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n        \"\n        class=\"map-empty mat-typography\"\n      >\n        {{ 'igo.integration.mapTool.customize' | translate }}\n      </p>\n\n      <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n        <mat-icon matListItemIcon>\n          <svg\n            viewBox=\"0 0 24 24\"\n            fit=\"\"\n            height=\"100%\"\n            width=\"100%\"\n            preserveAspectRatio=\"xMidYMid meet\"\n            focusable=\"false\"\n          >\n            <path\n              d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\n            ></path></svg\n        ></mat-icon>\n        <span\n          matListItemTitle\n          class=\"search-tool mat-typography\"\n          (click)=\"searchEmit()\"\n        >\n          {{ 'igo.integration.mapTool.search-tool' | translate }}\n        </span>\n      </mat-list-item>\n      <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n        <mat-icon matListItemIcon>\n          <svg\n            viewBox=\"0 0 24 24\"\n            fit=\"\"\n            height=\"100%\"\n            width=\"100%\"\n            preserveAspectRatio=\"xMidYMid meet\"\n            focusable=\"false\"\n          >\n            <path\n              d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\n            ></path></svg\n        ></mat-icon>\n        <span\n          matListItemTitle\n          class=\"catalog-tool mat-typography\"\n          (click)=\"catalogEmit()\"\n        >\n          {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n        </span>\n      </mat-list-item>\n      <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n        <mat-icon matListItemIcon>\n          <svg\n            viewBox=\"0 0 24 24\"\n            fit=\"\"\n            height=\"100%\"\n            width=\"100%\"\n            preserveAspectRatio=\"xMidYMid meet\"\n            focusable=\"false\"\n          >\n            <path\n              d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\n            ></path></svg\n        ></mat-icon>\n        <span\n          matListItemTitle\n          class=\"context-tool mat-typography\"\n          (click)=\"contextEmit()\"\n        >\n          {{ 'igo.integration.mapTool.context-tool' | translate }}\n        </span>\n      </mat-list-item>\n    </mat-list>\n  </ng-template>\n</mat-tab-group>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { MatTabChangeEvent } from '@angular/material/tabs';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  ExportOptions,\r\n  IgoMap,\r\n  Layer,\r\n  LayerListControlsEnum,\r\n  LayerListControlsOptions,\r\n  SearchSourceService,\r\n  VectorLayer,\r\n  sourceCanSearch\r\n} from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime, map } from 'rxjs/operators';\r\n\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from '../../import-export/import-export.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { LayerListToolState } from '../layer-list-tool.state';\r\nimport { MapState } from '../map.state';\r\n\r\n/**\r\n * Tool to browse a map's layers or to choose a different map\r\n */\r\n@ToolComponent({\r\n  name: 'mapTools',\r\n  title: 'igo.integration.tools.map',\r\n  icon: 'map'\r\n})\r\n@Component({\r\n  selector: 'igo-map-tools',\r\n  templateUrl: './map-tools.component.html',\r\n  styleUrls: ['./map-tools.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MapToolsComponent implements OnInit, OnDestroy {\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private resolution$$: Subscription;\r\n  private visibleOrInRangeLayers$$: Subscription;\r\n  public delayedShowEmptyMapContent: boolean = false;\r\n\r\n  @Input() allowShowAllLegends: boolean = false;\r\n\r\n  @Input() showAllLegendsValue: boolean = false;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() selectedTabAtOpening: string;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input() layerAdditionAllowed: boolean = true;\r\n\r\n  @Input()\r\n  get layerListControls(): LayerListControlsOptions {\r\n    return this._layerListControls;\r\n  }\r\n  set layerListControls(value: LayerListControlsOptions) {\r\n    const stateOptions = this.layerListToolState.getLayerListControls();\r\n    const stateKeyword = stateOptions.keyword;\r\n    const stateOnlyVisible = stateOptions.onlyVisible;\r\n    const stateSortAlpha = stateOptions.sortAlpha;\r\n\r\n    value.keyword = stateKeyword !== '' ? stateKeyword : value.keyword;\r\n    value.onlyVisible =\r\n      stateOnlyVisible !== undefined ? stateOnlyVisible : value.onlyVisible;\r\n    value.sortAlpha =\r\n      stateSortAlpha !== undefined ? stateSortAlpha : value.sortAlpha;\r\n\r\n    value.onlyVisible =\r\n      value.onlyVisible === undefined ? false : value.onlyVisible;\r\n    value.sortAlpha = value.sortAlpha === undefined ? false : value.sortAlpha;\r\n\r\n    this._layerListControls = value;\r\n  }\r\n  private _layerListControls = {};\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\r\n    return this.layers$.pipe(\r\n      map((layers) =>\r\n        layers.filter(\r\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  get visibleLayers$(): Observable<Layer[]> {\r\n    return this.layers$.pipe(\r\n      map((layers) => layers.filter((layer) => layer.visible$.value))\r\n    );\r\n  }\r\n\r\n  get excludeBaseLayers(): boolean {\r\n    return this.layerListControls.excludeBaseLayers || false;\r\n  }\r\n\r\n  get layerFilterAndSortOptions(): LayerListControlsOptions {\r\n    const filterSortOptions = Object.assign(\r\n      {\r\n        showToolbar: LayerListControlsEnum.default\r\n      },\r\n      this.layerListControls\r\n    );\r\n\r\n    switch (this.layerListControls.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\r\n        break;\r\n      case LayerListControlsEnum.never:\r\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return filterSortOptions;\r\n  }\r\n\r\n  @ViewChild('tabGroup', { static: true }) tabGroup;\r\n\r\n  get searchToolInToolbar(): boolean {\r\n    return (\r\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\r\n      this.searchSourceService\r\n        .getSources()\r\n        .filter(sourceCanSearch)\r\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\r\n    );\r\n  }\r\n\r\n  get catalogToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\r\n  }\r\n\r\n  get contextToolInToolbar(): boolean {\r\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\r\n  }\r\n\r\n  constructor(\r\n    public layerListToolState: LayerListToolState,\r\n    private toolState: ToolState,\r\n    public mapState: MapState,\r\n    private searchSourceService: SearchSourceService,\r\n    private importExportState: ImportExportState\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.selectedTab();\r\n    this.resolution$$ = combineLatest([\r\n      this.map.layers$,\r\n      this.map.viewController.resolution$\r\n    ])\r\n      .pipe(debounceTime(10))\r\n      .subscribe((bunch: [Layer[], number]) => {\r\n        this.layers$.next(\r\n          bunch[0].filter(\r\n            (layer) =>\r\n              layer.showInLayerList !== false &&\r\n              (!this.excludeBaseLayers || !layer.baseLayer)\r\n          )\r\n        );\r\n      });\r\n\r\n    if (this.allowShowAllLegends) {\r\n      this.mapState.showAllLegendsValue =\r\n        this.mapState.showAllLegendsValue !== undefined\r\n          ? this.mapState.showAllLegendsValue\r\n          : this.showAllLegendsValue || false;\r\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\r\n    } else {\r\n      this.showAllLegendsValue$.next(false);\r\n    }\r\n\r\n    // prevent message to be shown too quickly. Waiting for layers\r\n    setTimeout(() => (this.delayedShowEmptyMapContent = true), 250);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.resolution$$.unsubscribe();\r\n    if (this.visibleOrInRangeLayers$$) {\r\n      this.visibleOrInRangeLayers$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  onShowAllLegends(event) {\r\n    this.mapState.showAllLegendsValue = event;\r\n    this.showAllLegendsValue$.next(event);\r\n  }\r\n\r\n  private selectedTab() {\r\n    const userSelectedTab = this.layerListToolState.selectedTab$.value;\r\n    if (userSelectedTab !== undefined) {\r\n      this.layerListToolState.setSelectedTab(userSelectedTab);\r\n    } else {\r\n      if (this.selectedTabAtOpening === 'legend') {\r\n        this.layerListToolState.setSelectedTab(1);\r\n      } else {\r\n        this.layerListToolState.setSelectedTab(0);\r\n      }\r\n    }\r\n  }\r\n\r\n  public tabChanged(tab: MatTabChangeEvent) {\r\n    this.layerListToolState.setSelectedTab(tab.index);\r\n    this.layers$.next(\r\n      this.map.layers.filter(\r\n        (layer) =>\r\n          layer.showInLayerList !== false &&\r\n          (!this.excludeBaseLayers || !layer.baseLayer)\r\n      )\r\n    );\r\n  }\r\n\r\n  onLayerListChange(appliedFilters: LayerListControlsOptions) {\r\n    this.layerListToolState.setKeyword(appliedFilters.keyword);\r\n    this.layerListToolState.setSortAlpha(appliedFilters.sortAlpha);\r\n    this.layerListToolState.setOnlyVisible(appliedFilters.onlyVisible);\r\n  }\r\n\r\n  showAllLegend() {\r\n    if (this.layers$.getValue().length === 0) {\r\n      return false;\r\n    } else if (\r\n      this.layers$.getValue().length !== 0 &&\r\n      this.allowShowAllLegends === false\r\n    ) {\r\n      let visibleOrInRangeLayers;\r\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\r\n        (value) => {\r\n          value.length === 0\r\n            ? (visibleOrInRangeLayers = false)\r\n            : (visibleOrInRangeLayers = true);\r\n        }\r\n      );\r\n\r\n      if (visibleOrInRangeLayers === false) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  activateExport(layer: Layer) {\r\n    let id = layer.id;\r\n    if (layer.options.workspace?.workspaceId) {\r\n      id =\r\n        layer.options.workspace.workspaceId !== layer.id\r\n          ? layer.options.workspace.workspaceId\r\n          : layer.id;\r\n    }\r\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\r\n    this.importExportState.setMode(ImportExportMode.export);\r\n    this.toolState.toolbox.activateTool('importExport');\r\n  }\r\n\r\n  activateTimeFilter() {\r\n    this.toolState.toolbox.activateTool('activeTimeFilter');\r\n  }\r\n\r\n  activateOgcFilter() {\r\n    this.toolState.toolbox.activateTool('activeOgcFilter');\r\n  }\r\n\r\n  searchEmit() {\r\n    this.toolState.toolbox.activateTool('searchResults');\r\n  }\r\n\r\n  catalogEmit() {\r\n    this.toolState.toolbox.activateTool('catalog');\r\n  }\r\n\r\n  contextEmit() {\r\n    this.toolState.toolbox.activateTool('contextManager');\r\n  }\r\n\r\n  isTimeFilterButton(layer): boolean {\r\n    const options = layer.dataSource.options;\r\n    return this.timeButton && options.timeFilterable && options.timeFilter;\r\n  }\r\n\r\n  isOGCFilterButton(layer): boolean {\r\n    const options = layer.dataSource.options;\r\n    return (\r\n      this.ogcButton &&\r\n      options.ogcFilters &&\r\n      options.ogcFilters.enabled &&\r\n      (options.ogcFilters.pushButtons ||\r\n        options.ogcFilters.checkboxes ||\r\n        options.ogcFilters.radioButtons ||\r\n        options.ogcFilters.select ||\r\n        options.ogcFilters.autocomplete ||\r\n        options.ogcFilters.editable)\r\n    );\r\n  }\r\n\r\n  isExportButton(layer: Layer): boolean {\r\n    if (\r\n      (layer instanceof VectorLayer && layer.exportable === true) ||\r\n      (layer.dataSource.options.download &&\r\n        layer.dataSource.options.download.url) ||\r\n      (layer.options.workspace?.enabled &&\r\n        layer.options.workspace?.workspaceId !== layer.id)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  isStyleEditButton(layer: Layer): boolean {\r\n    if (layer instanceof VectorLayer) {\r\n      if ((layer as VectorLayer).options?.igoStyle?.editable) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  EntityRecord,\r\n  EntityStoreFilterCustomFuncStrategy,\r\n  EntityStoreStrategyFuncOptions,\r\n  EntityStoreWithStrategy\r\n} from '@igo2/common';\r\nimport { ConfigService, StorageService } from '@igo2/core';\r\nimport {\r\n  CommonVectorStyleOptions,\r\n  Feature,\r\n  FeatureStore,\r\n  FeatureWorkspace,\r\n  OverlayStyleOptions,\r\n  SearchResult,\r\n  SearchSource,\r\n  SearchSourceService\r\n} from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport { MapState } from '../map';\r\nimport { WorkspaceState } from '../workspace/workspace.state';\r\n\r\n/**\r\n * Service that holds the state of the search module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SearchState {\r\n  public searchLayerStores: FeatureStore<Feature>[] = [];\r\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\r\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\r\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\r\n\r\n  public focusedOrResolution$$: Subscription;\r\n  public selectedOrResolution$$: Subscription;\r\n\r\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject(\r\n    '|'\r\n  );\r\n\r\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(\r\n    false\r\n  );\r\n\r\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject(false);\r\n\r\n  readonly searchSettingsChange$: BehaviorSubject<boolean> =\r\n    new BehaviorSubject(undefined);\r\n\r\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Store that holds the search results\r\n   */\r\n  readonly store = new EntityStoreWithStrategy<SearchResult>([]);\r\n\r\n  /**\r\n   * Search types currently enabled in the search source service\r\n   */\r\n  get searchTypes(): string[] {\r\n    return this.searchSourceService\r\n      .getEnabledSources()\r\n      .map((source: SearchSource) => (source.constructor as any).type);\r\n  }\r\n\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private storageService: StorageService,\r\n    private workspaceState: WorkspaceState,\r\n    private configService: ConfigService,\r\n    private mapState: MapState\r\n  ) {\r\n    const searchOverlayStyle: OverlayStyleOptions =\r\n      this.configService.getConfig('searchOverlayStyle');\r\n    if (searchOverlayStyle) {\r\n      this.searchOverlayStyle = searchOverlayStyle.base;\r\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\r\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\r\n    }\r\n\r\n    const searchResultsGeometryEnabled = this.storageService.get(\r\n      'searchResultsGeometryEnabled'\r\n    ) as boolean;\r\n    if (searchResultsGeometryEnabled) {\r\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\r\n    }\r\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\r\n\r\n    const wksSource = this.searchSourceService\r\n      .getSources()\r\n      .find((source) => source.getId() === 'workspace');\r\n    this.workspaceState.store.entities$.subscribe((e) => {\r\n      const searchableWks = e.filter(\r\n        (fw) =>\r\n          fw instanceof FeatureWorkspace &&\r\n          fw.layer.options.workspace.searchIndexEnabled\r\n      );\r\n      this.searchSourceService.setWorkspaces(wksSource, searchableWks);\r\n    });\r\n    this.monitorLayerDeletion();\r\n  }\r\n\r\n  private monitorLayerDeletion() {\r\n    this.mapState.map.layers$.subscribe((layers) => {\r\n      this.searchLayerStores.forEach((store) => {\r\n        let layer = layers.find((l) => l.id === store.layer.id);\r\n        if (!layer) {\r\n          const index = this.searchLayerStores.indexOf(store);\r\n          this.searchLayerStores.splice(index, 1);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\r\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\r\n      return record.entity.meta.score === 100;\r\n    };\r\n    return new EntityStoreFilterCustomFuncStrategy({\r\n      filterClauseFunc\r\n    } as EntityStoreStrategyFuncOptions);\r\n  }\r\n\r\n  /**\r\n   * Activate custom strategy\r\n   *\r\n   */\r\n  activateCustomFilterTermStrategy() {\r\n    const strategy = this.store.getStrategyOfType(\r\n      EntityStoreFilterCustomFuncStrategy\r\n    );\r\n    if (strategy !== undefined) {\r\n      strategy.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate custom strategy\r\n   *\r\n   */\r\n  deactivateCustomFilterTermStrategy() {\r\n    const strategy = this.store.getStrategyOfType(\r\n      EntityStoreFilterCustomFuncStrategy\r\n    );\r\n    if (strategy !== undefined) {\r\n      strategy.deactivate();\r\n    }\r\n  }\r\n\r\n  enableSearch() {\r\n    this.searchDisabled$.next(false);\r\n  }\r\n\r\n  disableSearch() {\r\n    this.searchDisabled$.next(true);\r\n  }\r\n\r\n  setSearchTerm(searchTerm: string) {\r\n    this.searchTerm$.next(searchTerm);\r\n  }\r\n\r\n  setSearchType(searchType: string) {\r\n    this.searchSourceService.enableSourcesByType(searchType);\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  setSearchSettingsChange() {\r\n    this.searchSettingsChange$.next(true);\r\n  }\r\n\r\n  setSelectedResult(result: SearchResult) {\r\n    this.selectedResult$.next(result);\r\n  }\r\n\r\n  setSearchResultsGeometryStatus(value) {\r\n    this.storageService.set('searchResultsGeometryEnabled', value);\r\n    this.searchResultsGeometryEnabled$.next(value);\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { IgoMap } from '@igo2/geo';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\n\r\n@ToolComponent({\r\n  name: 'contextManager',\r\n  title: 'igo.integration.tools.contexts',\r\n  icon: 'star'\r\n})\r\n@Component({\r\n  selector: 'igo-context-manager-tool',\r\n  templateUrl: './context-manager-tool.component.html'\r\n})\r\nexport class ContextManagerToolComponent {\r\n  @Input() toolToOpenOnContextChange: string = 'mapTools';\r\n\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    private toolState: ToolState,\r\n    private mapState: MapState\r\n  ) {}\r\n\r\n  editContext() {\r\n    this.toolState.toolbox.activateTool('contextEditor');\r\n  }\r\n\r\n  managePermissions() {\r\n    this.toolState.toolbox.activateTool('contextPermissionManager');\r\n  }\r\n}\r\n","<igo-context-list\n  igoContextListBinding\n  [map]=\"map\"\n  (edit)=\"editContext()\"\n  (managePermissions)=\"managePermissions()\"\n>\n</igo-context-list>\n","import { Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\n\r\nimport { ToolState } from '../../tool/tool.state';\r\n\r\n@ToolComponent({\r\n  name: 'contextEditor',\r\n  title: 'igo.integration.tools.contexts',\r\n  icon: 'star',\r\n  parent: 'contextManager'\r\n})\r\n@Component({\r\n  selector: 'igo-context-editor-tool',\r\n  templateUrl: './context-editor-tool.component.html'\r\n})\r\nexport class ContextEditorToolComponent {\r\n  constructor(private toolState: ToolState) {}\r\n\r\n  submitSuccessed() {\r\n    this.toolState.toolbox.activatePreviousTool();\r\n  }\r\n}\r\n","<igo-context-edit\n  igoContextEditBinding\n  (submitSuccessed)=\"submitSuccessed()\"\n></igo-context-edit>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\n@ToolComponent({\n  name: 'contextPermissionManager',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star',\n  parent: 'contextManager'\n})\n@Component({\n  selector: 'igo-context-permission-manager-tool',\n  templateUrl: './context-permission-manager-tool.component.html'\n})\nexport class ContextPermissionManagerToolComponent {}\n","<igo-context-permissions igoContextPermissionsBinding></igo-context-permissions>\n","import { Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { IgoMap, LayerListControlsOptions } from '@igo2/geo';\r\n\r\nimport { LayerListToolState } from '../../map/layer-list-tool.state';\r\nimport { MapState } from '../../map/map.state';\r\n\r\n@ToolComponent({\r\n  name: 'shareMap',\r\n  title: 'igo.integration.tools.shareMap',\r\n  icon: 'share-variant'\r\n})\r\n@Component({\r\n  selector: 'igo-context-share-tool',\r\n  templateUrl: './context-share-tool.component.html'\r\n})\r\nexport class ContextShareToolComponent {\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layerListControls(): LayerListControlsOptions {\r\n    return this.layerListToolState.getLayerListControls();\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private layerListToolState: LayerListToolState\r\n  ) {}\r\n}\r\n","<igo-share-map [map]=\"map\"></igo-share-map>\n","import { Injectable } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { EntityStore } from '@igo2/common';\nimport { Catalog, CatalogItem } from '@igo2/geo';\n\n/**\n * Service that holds the state of the catalog module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogState {\n  /**\n   * Store that contains all the catalogs\n   */\n  get catalogStore(): EntityStore<Catalog> {\n    return this._catalogStore;\n  }\n  private _catalogStore: EntityStore<Catalog>;\n\n  /**\n   * Catalog -> Catalog items store mapping\n   */\n  private catalogItemsStores = new Map<string, EntityStore<CatalogItem>>();\n\n  constructor(authService: AuthService) {\n    this._catalogStore = new EntityStore([]);\n\n    authService.authenticate$.subscribe(() => {\n      this.clearCatalogItemsStores();\n    });\n  }\n\n  /**\n   * Get a catalog's items store\n   * @param catalog Catalog\n   * @returns Store that contains the catalog items\n   */\n  getCatalogItemsStore(catalog: Catalog): EntityStore<CatalogItem> {\n    return this.catalogItemsStores.get(catalog.id as string);\n  }\n\n  /**\n   * Bind a catalog items store to a catalog\n   * @param catalog Catalog\n   * @param store Catalog items store\n   */\n  setCatalogItemsStore(catalog: Catalog, store: EntityStore<CatalogItem>) {\n    this.catalogItemsStores.set(catalog.id as string, store);\n  }\n\n  /**\n   * Clear all catalog items stores\n   */\n  clearCatalogItemsStores() {\n    this.catalogItemsStores.clear();\n  }\n}\n","<igo-catalog-browser\n  *ngIf=\"store$ | async as store\"\n  [catalog]=\"catalog\"\n  [store]=\"store\"\n  [map]=\"map\"\n  [toggleCollapsedGroup]=\"toggleCollapsedGroup\"\n>\n</igo-catalog-browser>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { EntityRecord, EntityStore, ToolComponent } from '@igo2/common';\r\nimport {\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogItemState,\r\n  CatalogService,\r\n  IgoMap\r\n} from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport { CatalogState } from '../catalog.state';\r\n\r\n/**\r\n * Tool to browse a catalog's groups and layers and display them to a map.\r\n */\r\n@ToolComponent({\r\n  name: 'catalogBrowser',\r\n  title: 'igo.integration.tools.catalog',\r\n  icon: 'photo-browser',\r\n  parent: 'catalog'\r\n})\r\n@Component({\r\n  selector: 'igo-catalog-browser-tool',\r\n  templateUrl: './catalog-browser-tool.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserToolComponent implements OnInit, OnDestroy {\r\n  catalog: Catalog;\r\n\r\n  /**\r\n   * Store that contains the catalog items\r\n   * @internal\r\n   */\r\n  store$ = new BehaviorSubject<EntityStore<CatalogItem, CatalogItemState>>(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Subscription to the selected catalog\r\n   */\r\n  private catalog$$: Subscription;\r\n\r\n  /**\r\n   * Subscription for authentication\r\n   */\r\n  private authenticate$$: Subscription;\r\n\r\n  /**\r\n   * Whether a group can be toggled when it's collapsed\r\n   */\r\n  @Input() toggleCollapsedGroup: boolean = true;\r\n\r\n  /**\r\n   * Map to add layers to\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    private catalogService: CatalogService,\r\n    private catalogState: CatalogState,\r\n    private mapState: MapState,\r\n    private authService: AuthService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    const catalogStore = this.catalogState.catalogStore;\r\n    this.catalog$$ = catalogStore.stateView\r\n      .firstBy$(\r\n        (record: EntityRecord<Catalog>) => record.state.selected === true\r\n      )\r\n      .subscribe((record: EntityRecord<Catalog>) => {\r\n        if (record && record.entity) {\r\n          const catalog = record.entity;\r\n          this.catalog = catalog;\r\n        }\r\n      });\r\n\r\n    this.authenticate$$ = this.authService.authenticate$.subscribe(() => {\r\n      this.loadCatalogItems(this.catalog);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.catalog$$.unsubscribe();\r\n    this.authenticate$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Get the selected catalog's items from the CatalogService and\r\n   * load them into the store.\r\n   * @param catalog Selected catalog\r\n   */\r\n  private loadCatalogItems(catalog: Catalog) {\r\n    let store = this.catalogState.getCatalogItemsStore(catalog);\r\n    if (store !== undefined) {\r\n      this.store$.next(store);\r\n      return;\r\n    }\r\n\r\n    store = new EntityStore<CatalogItem>([]);\r\n    this.catalogState.setCatalogItemsStore(catalog, store);\r\n    this.catalogService\r\n      .loadCatalogItems(catalog)\r\n      .pipe(take(1))\r\n      .subscribe((items: CatalogItem[]) => {\r\n        store.load(items);\r\n        this.store$.next(store);\r\n      });\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { StorageService } from '@igo2/core';\r\nimport { Catalog, CatalogService } from '@igo2/geo';\r\n\r\nimport { take } from 'rxjs/operators';\r\n\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { CatalogState } from '../catalog.state';\r\n\r\n/**\r\n * Tool to browse the list of available catalogs.\r\n */\r\n@ToolComponent({\r\n  name: 'catalog',\r\n  title: 'igo.integration.tools.catalog',\r\n  icon: 'layers-plus'\r\n})\r\n@Component({\r\n  selector: 'igo-catalog-library-tool',\r\n  templateUrl: './catalog-library-tool.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibraryToolComponent implements OnInit {\r\n  /**\r\n   * Store that contains the catalogs\r\n   * @internal\r\n   */\r\n  get store(): EntityStore<Catalog> {\r\n    return this.catalogState.catalogStore;\r\n  }\r\n\r\n  /**\r\n   * Determine if the form to add a catalog is allowed\r\n   */\r\n  @Input() addCatalogAllowed: boolean = false;\r\n\r\n  /**\r\n   * List of predefined catalogs\r\n   */\r\n  @Input() predefinedCatalogs: Catalog[] = [];\r\n\r\n  constructor(\r\n    private catalogService: CatalogService,\r\n    private catalogState: CatalogState,\r\n    private toolState: ToolState,\r\n    private storageService: StorageService\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    if (this.store.count === 0) {\r\n      this.loadCatalogs();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\r\n   * @internal\r\n   * @param event Select event\r\n   */\r\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }) {\r\n    if (event.selected === false) {\r\n      return;\r\n    }\r\n    this.toolState.toolbox.activateTool('catalogBrowser');\r\n  }\r\n\r\n  /**\r\n   * Get all the available catalogs from the CatalogService and\r\n   * load them into the store.\r\n   */\r\n  private loadCatalogs() {\r\n    this.catalogService\r\n      .loadCatalogs()\r\n      .pipe(take(1))\r\n      .subscribe((catalogs: Catalog[]) => {\r\n        this.store.clear();\r\n        this.store.load(\r\n          catalogs.concat(\r\n            (this.storageService.get('addedCatalogs') || []) as Catalog[]\r\n          )\r\n        );\r\n      });\r\n  }\r\n}\r\n","<igo-catalog-library\n  [predefinedCatalogs]=\"predefinedCatalogs\"\n  [addCatalogAllowed]=\"addCatalogAllowed\"\n  [store]=\"store\"\n  (catalogSelectChange)=\"onCatalogSelectChange($event)\"\n>\n</igo-catalog-library>\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  AnyLayerOptions,\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsFeatureStore,\r\n  StopsStore\r\n} from '@igo2/geo';\r\n\r\nimport { Subject } from 'rxjs';\r\n\r\nimport { MapState } from '../map/map.state';\r\n\r\n/**\r\n * Service that holds the state of the direction module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DirectionState {\r\n  public zoomToActiveRoute$: Subject<void> = new Subject();\r\n\r\n  /**\r\n   * Store that holds the stop\r\n   */\r\n  public stopsStore: StopsStore = new StopsStore([]);\r\n\r\n  /**\r\n   * Store that holds the driving stops as feature\r\n   */\r\n  public stopsFeatureStore: StopsFeatureStore;\r\n\r\n  /**\r\n   * Store that holds the driving route as feature\r\n   */\r\n  public routesFeatureStore: RoutesFeatureStore;\r\n\r\n  public stepFeatureStore: StepFeatureStore;\r\n\r\n  public debounceTime: number = 200;\r\n\r\n  constructor(private mapState: MapState) {\r\n    this.stopsFeatureStore = new StopsFeatureStore([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.routesFeatureStore = new RoutesFeatureStore([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.stepFeatureStore = new StepFeatureStore([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.mapState.map.ol.once('rendercomplete', () => {\r\n      this.stopsFeatureStore.empty$.subscribe((empty) => {\r\n        if (this.stopsFeatureStore.layer?.options) {\r\n          (\r\n            this.stopsFeatureStore.layer.options as AnyLayerOptions\r\n          ).showInLayerList = !empty;\r\n        }\r\n      });\r\n      this.routesFeatureStore.empty$.subscribe((empty) => {\r\n        if (this.routesFeatureStore.layer?.options) {\r\n          (\r\n            this.routesFeatureStore.layer.options as AnyLayerOptions\r\n          ).showInLayerList = !empty;\r\n        }\r\n      });\r\n    });\r\n\r\n    this.mapState.map.layers$.subscribe(() => {\r\n      if (!this.mapState.map.getLayerById('igo-direction-stops-layer')) {\r\n        this.stopsStore.deleteMany(this.stopsStore.all());\r\n        this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all()); // not necessary\r\n      }\r\n      if (!this.mapState.map.getLayerById('igo-direction-route-layer')) {\r\n        this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  LanguageService,\r\n  MessageService,\r\n  StorageScope,\r\n  StorageService\r\n} from '@igo2/core';\r\nimport {\r\n  IgoMap,\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsFeatureStore,\r\n  StopsStore\r\n} from '@igo2/geo';\r\n\r\nimport { Subject } from 'rxjs';\r\n\r\nimport { ContextState } from '../../context/context.state';\r\nimport { MapState } from '../../map/map.state';\r\nimport { DirectionState } from '../directions.state';\r\n\r\n@ToolComponent({\r\n  name: 'directions',\r\n  title: 'igo.integration.tools.directions',\r\n  icon: 'directions'\r\n})\r\n@Component({\r\n  selector: 'igo-directions-tool',\r\n  templateUrl: './directions-tool.component.html'\r\n})\r\nexport class DirectionsToolComponent implements OnInit {\r\n  public currentContextUri: string;\r\n  /**\r\n   * stops\r\n   * @internal\r\n   */\r\n  get stopsStore(): StopsStore {\r\n    return this.directionState.stopsStore;\r\n  }\r\n\r\n  get debounceTime(): number {\r\n    return this.directionState.debounceTime;\r\n  }\r\n\r\n  /**\r\n   * stops\r\n   * @internal\r\n   */\r\n  get stopsFeatureStore(): StopsFeatureStore {\r\n    return this.directionState.stopsFeatureStore;\r\n  }\r\n\r\n  /**\r\n   * routes\r\n   * @internal\r\n   */\r\n  get routesFeatureStore(): RoutesFeatureStore {\r\n    return this.directionState.routesFeatureStore;\r\n  }\r\n\r\n  /**\r\n   * step store\r\n   * @internal\r\n   */\r\n  get stepFeatureStore(): StepFeatureStore {\r\n    return this.directionState.stepFeatureStore;\r\n  }\r\n\r\n  /**\r\n   * step store\r\n   * @internal\r\n   */\r\n  get zoomToActiveRoute$(): Subject<void> {\r\n    return this.directionState.zoomToActiveRoute$;\r\n  }\r\n\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    private directionState: DirectionState,\r\n    private mapState: MapState,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private storageService: StorageService,\r\n    public contextState: ContextState,\r\n    private authService: AuthService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    const warningShown = this.storageService.get(\r\n      'direction.warning.shown'\r\n    ) as boolean;\r\n    if (!warningShown) {\r\n      this.messageService.info(\r\n        'igo.integration.directions.warning.message',\r\n        'igo.integration.directions.warning.title',\r\n        { timeOut: 20000 }\r\n      );\r\n      this.storageService.set(\r\n        'direction.warning.shown',\r\n        true,\r\n        StorageScope.SESSION\r\n      );\r\n    }\r\n    this.contextState.context$.subscribe((c) => {\r\n      if (!this.authService.authenticated) {\r\n        this.currentContextUri = c.uri;\r\n      }\r\n    });\r\n  }\r\n}\r\n","<igo-directions\n  [contextUri]=\"currentContextUri\"\n  [debounceTime]=\"debounceTime\"\n  [stopsStore]=\"stopsStore\"\n  [stopsFeatureStore]=\"stopsFeatureStore\"\n  [stepFeatureStore]=\"stepFeatureStore\"\n  [routesFeatureStore]=\"routesFeatureStore\"\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n>\n</igo-directions>\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  DrawControl,\r\n  FeatureStore,\r\n  FeatureWithDraw,\r\n  VectorLayer\r\n} from '@igo2/geo';\r\n\r\nimport { MapState } from '../map/map.state';\r\n\r\n/**\r\n * Service that holds the state of the measure module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DrawState {\r\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\r\n  public layersID: string[] = [];\r\n  public drawControls: [string, DrawControl][] = [];\r\n  public activeDrawingLayer: VectorLayer;\r\n\r\n  constructor(private mapState: MapState) {\r\n    this.mapState.map.layers$.subscribe(() => {\r\n      this.layersID.forEach((layerId) => {\r\n        if (!this.mapState.map.getLayerById(layerId)) {\r\n          let deletedStore = this.stores.find(\r\n            (store) => store.layer.id === layerId\r\n          );\r\n          deletedStore.deleteMany(deletedStore.all());\r\n          this.stores.splice(this.stores.indexOf(deletedStore, 0), 1);\r\n          this.layersID.splice(this.layersID.indexOf(layerId, 0), 1);\r\n          let drawControlIndex = this.drawControls.findIndex(\r\n            (dc) => dc[0] === layerId\r\n          );\r\n          this.drawControls.splice(drawControlIndex, 1);\r\n        }\r\n      });\r\n    });\r\n    for (let store of this.stores) {\r\n      store = new FeatureStore<FeatureWithDraw>([], { map: this.mapState.map });\r\n    }\r\n  }\r\n}\r\n","import { ChangeDetectionStrategy, Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport {\r\n  DrawControl,\r\n  FeatureStore,\r\n  FeatureWithDraw,\r\n  IgoMap,\r\n  VectorLayer\r\n} from '@igo2/geo';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport { DrawState } from '../draw.state';\r\n\r\n/**\r\n * Tool to measure lengths and areas\r\n */\r\n@ToolComponent({\r\n  name: 'draw',\r\n  title: 'igo.integration.tools.draw',\r\n  icon: 'draw'\r\n})\r\n@Component({\r\n  selector: 'igo-drawing-tool',\r\n  templateUrl: './drawing-tool.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class DrawingToolComponent {\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get stores(): FeatureStore<FeatureWithDraw>[] {\r\n    return this.drawState.stores;\r\n  }\r\n\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layersID(): string[] {\r\n    return this.drawState.layersID;\r\n  }\r\n\r\n  get drawControls(): [string, DrawControl][] {\r\n    return this.drawState.drawControls;\r\n  }\r\n  set drawControls(dc: [string, DrawControl][]) {\r\n    this.drawState.drawControls = dc;\r\n  }\r\n\r\n  get activeDrawingLayer(): VectorLayer {\r\n    return this.drawState.activeDrawingLayer;\r\n  }\r\n  set activeDrawingLayer(value: VectorLayer) {\r\n    this.drawState.activeDrawingLayer = value;\r\n  }\r\n\r\n  public addLayersID(layerID: string) {\r\n    this.layersID.push(layerID);\r\n  }\r\n\r\n  public addDrawControls(dc: [string, DrawControl][]) {\r\n    this.drawControls = dc;\r\n  }\r\n\r\n  constructor(\r\n    private drawState: DrawState,\r\n    private mapState: MapState\r\n  ) {}\r\n}\r\n","<igo-draw\n  [stores]=\"stores\"\n  [map]=\"map\"\n  (layersIDEvent)=\"addLayersID($event)\"\n  [activeDrawingLayer]=\"activeDrawingLayer\"\n  [drawControls]=\"drawControls\"\n  (drawControlsEvent)=\"addDrawControls($event)\"\n  (activeLayerChange)=\"activeDrawingLayer = $event\"\n>\n</igo-draw>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\n@ToolComponent({\n  name: 'ogcFilter',\n  title: 'igo.integration.tools.ogcFilter',\n  icon: 'filter'\n})\n@Component({\n  selector: 'igo-ogc-filter-tool',\n  templateUrl: './ogc-filter-tool.component.html'\n})\nexport class OgcFilterToolComponent {\n  constructor() {}\n}\n","<igo-ogc-filterable-list igoOgcFilterableListBinding></igo-ogc-filterable-list>\n","import {\r\n  AnimationTriggerMetadata,\r\n  animate,\r\n  state,\r\n  style,\r\n  transition,\r\n  trigger\r\n} from '@angular/animations';\r\n\r\nexport function toolSlideInOut(\r\n  speed = '300ms',\r\n  type = 'ease-in-out'\r\n): AnimationTriggerMetadata {\r\n  return trigger('toolSlideInOut', [\r\n    state(\r\n      'enter',\r\n      style({\r\n        transform: 'translateX(100%)'\r\n      })\r\n    ),\r\n    transition('void => enter', animate(speed + ' ' + type))\r\n  ]);\r\n}\r\n","import { Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { IgoMap, Layer } from '@igo2/geo';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport { toolSlideInOut } from './active-ogc-filter-tool.animation';\r\n\r\n@ToolComponent({\r\n  name: 'activeOgcFilter',\r\n  title: 'igo.integration.tools.ogcFilter',\r\n  icon: 'filter',\r\n  parent: 'mapTools'\r\n})\r\n@Component({\r\n  selector: 'igo-active-ogc-filter-tool',\r\n  templateUrl: './active-ogc-filter-tool.component.html',\r\n  animations: [toolSlideInOut()]\r\n})\r\nexport class ActiveOgcFilterToolComponent {\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layer(): Layer {\r\n    for (const lay of this.map.layers) {\r\n      if (lay.options.active === true) {\r\n        return lay;\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  public animate = 'enter';\r\n\r\n  constructor(public mapState: MapState) {}\r\n}\r\n","<igo-ogc-filterable-item\n  [map]=\"map\"\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [@toolSlideInOut]=\"animate\"\n>\n</igo-ogc-filterable-item>\n","<igo-panel>\n  <igo-spatial-filter-type\n    [store]=\"spatialListStore\"\n    [selectedQueryType]=\"queryType\"\n    [zone]=\"zone\"\n    [layers]=\"activeLayers\"\n    (eventType)=\"getOutputType($event)\"\n    (eventQueryType)=\"getOutputQueryType($event)\"\n    (zoneChange)=\"onZoneChange($event)\"\n    (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n    (bufferChange)=\"buffer = $event\"\n    (measureUnitChange)=\"measureUnit = $event\"\n  >\n  </igo-spatial-filter-type>\n\n  <igo-spatial-filter-item\n    [type]=\"type\"\n    [queryType]=\"queryType\"\n    [map]=\"map\"\n    [zone]=\"zone\"\n    [loading]=\"loading\"\n    [store]=\"store\"\n    [layers]=\"activeLayers\"\n    [allLayers]=\"layers\"\n    [thematicLength]=\"thematicLength\"\n    (radiusEvent)=\"buffer = $event\"\n    (bufferEvent)=\"buffer = $event\"\n    (measureUnitChange)=\"measureUnit = $event\"\n    (freehandControl)=\"freehandDrawIsActive = $event\"\n    (drawZoneEvent)=\"zone = $event\"\n    (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n    (itemTypeChange)=\"itemType = $event\"\n    (thematicChange)=\"thematics = $event\"\n    (toggleSearch)=\"getOutputToggleSearch()\"\n    (clearButtonEvent)=\"clearMap()\"\n    (clearSearchEvent)=\"getOutputClearSearch()\"\n    (export)=\"activateExportTool()\"\n    (openWorkspace)=\"activateWorkspace()\"\n    (entityChange)=\"activateWorkspace($event)\"\n  >\n  </igo-spatial-filter-item>\n</igo-panel>\n\n<igo-panel>\n  <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n    <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n  </ng-container>\n</igo-panel>\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\n\r\nimport {\r\n  EntityStore,\r\n  EntityStoreWithStrategy,\r\n  ToolComponent\r\n} from '@igo2/common';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport {\r\n  ClusterDataSource,\r\n  DataSource,\r\n  DataSourceService,\r\n  ExportOptions,\r\n  Feature,\r\n  FeatureMotion,\r\n  IgoMap,\r\n  Layer,\r\n  LayerService,\r\n  MeasureLengthUnit,\r\n  QueryableDataSourceOptions,\r\n  SpatialFilterItemType,\r\n  SpatialFilterQueryType,\r\n  SpatialFilterService,\r\n  SpatialFilterThematic,\r\n  SpatialFilterType,\r\n  VectorLayer,\r\n  createOverlayMarkerStyle,\r\n  featureToOl,\r\n  moveToOlFeatures\r\n} from '@igo2/geo';\r\n\r\nimport { EventsKey } from 'ol/events';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olSourceCluster from 'ol/source/Cluster';\r\nimport olSourceVector from 'ol/source/Vector';\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport { Observable, Subject, forkJoin } from 'rxjs';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { take, takeUntil, tap } from 'rxjs/operators';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { WorkspaceState } from '../../workspace/workspace.state';\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState\r\n} from './../../import-export/import-export.state';\r\n\r\n/**\r\n * Tool to apply spatial filter\r\n */\r\n@ToolComponent({\r\n  name: 'spatialFilter',\r\n  title: 'igo.integration.tools.spatialFilter',\r\n  icon: 'selection-marker'\r\n})\r\n/**\r\n * Spatial Filter Type\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-tool',\r\n  templateUrl: './spatial-filter-tool.component.html',\r\n  styleUrls: ['./spatial-filter-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterToolComponent implements OnInit, OnDestroy {\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  @Input() type: SpatialFilterType;\r\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\r\n  @Input() freehandDrawIsActive: boolean;\r\n\r\n  public layers: Layer[] = [];\r\n  public activeLayers: Layer[] = [];\r\n\r\n  public queryType: SpatialFilterQueryType;\r\n  public thematics: SpatialFilterThematic[];\r\n  public zone: Feature;\r\n  public zoneWithBuffer: Feature;\r\n  public buffer = 0;\r\n\r\n  public iterator = 1;\r\n\r\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  public store: EntityStoreWithStrategy<Feature> =\r\n    new EntityStoreWithStrategy<Feature>([]); // Store to print results at the end\r\n\r\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\r\n\r\n  public loading = false;\r\n\r\n  public thematicLength = 0;\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n  private unsubscribe$ = new Subject<void>();\r\n\r\n  private moveendKey: EventsKey;\r\n\r\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\r\n\r\n  constructor(\r\n    private matIconRegistry: MatIconRegistry,\r\n    private spatialFilterService: SpatialFilterService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mapState: MapState,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService,\r\n    private importExportState: ImportExportState,\r\n    private toolState: ToolState,\r\n    private workspaceState: WorkspaceState,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    for (const layer of this.map.layers) {\r\n      if (\r\n        layer.title &&\r\n        layer.title.includes(\r\n          this.languageService.translate.instant(\r\n            'igo.geo.spatialFilter.spatialFilter'\r\n          )\r\n        )\r\n      ) {\r\n        this.layers.push(layer);\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribe$.next();\r\n    this.unsubscribe$.complete();\r\n  }\r\n\r\n  getOutputType(event: SpatialFilterType) {\r\n    this.type = event;\r\n    this.queryType = undefined;\r\n  }\r\n\r\n  getOutputQueryType(event: SpatialFilterQueryType) {\r\n    this.queryType = event;\r\n    if (this.queryType) {\r\n      this.loadFilterList();\r\n    }\r\n  }\r\n\r\n  activateExportTool() {\r\n    const ids = [];\r\n    const re = new RegExp('^Zone \\\\d+');\r\n    for (const layer of this.layers) {\r\n      if (!layer.title.match(re)) {\r\n        ids.push(layer.id);\r\n      }\r\n    }\r\n    this.importExportState.setMode(ImportExportMode.export);\r\n    this.importExportState.setsExportOptions({ layers: ids } as ExportOptions);\r\n    this.toolState.toolbox.activateTool('importExport');\r\n  }\r\n\r\n  activateWorkspace(record?) {\r\n    let layerToOpenWks;\r\n    this.workspaceState.store.entities$\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe(() => {\r\n        if (\r\n          !record &&\r\n          this.activeLayers.length &&\r\n          this.workspaceState.store.all().length > 1\r\n        ) {\r\n          if (this.itemType === SpatialFilterItemType.Thematics) {\r\n            for (const thematic of this.thematics) {\r\n              if (!thematic.zeroResults) {\r\n                layerToOpenWks = this.activeLayers.find((layer) =>\r\n                  layer.title.includes(\r\n                    thematic.name + ' ' + this.iterator.toString()\r\n                  )\r\n                );\r\n                break;\r\n              }\r\n            }\r\n          } else {\r\n            const title = 'Adresses ' + this.iterator.toString();\r\n            this.activeLayers.forEach((layer) => {\r\n              if (layer.title.includes(title)) {\r\n                layerToOpenWks = layer;\r\n              }\r\n            });\r\n          }\r\n\r\n          if (layerToOpenWks) {\r\n            this.workspaceState.workspacePanelExpanded = true;\r\n            this.workspaceState.setActiveWorkspaceById(layerToOpenWks.id);\r\n          }\r\n        } else if (\r\n          record &&\r\n          this.activeLayers.length &&\r\n          this.workspaceState.store.all().length > 1\r\n        ) {\r\n          this.selectWorkspaceEntity(record);\r\n          this.moveendKey = this.map.ol.on('moveend', () => {\r\n            this.selectWorkspaceEntity(record);\r\n          });\r\n        }\r\n      });\r\n  }\r\n\r\n  private selectWorkspaceEntity(record) {\r\n    this.workspaceState.store.all().forEach((workspace) => {\r\n      workspace.entityStore.state.updateAll({ selected: false });\r\n      if (workspace.title.includes(record.added[0].meta.title)) {\r\n        this.workspaceState.setActiveWorkspaceById(workspace.id);\r\n        workspace.entityStore.state.updateMany(record.added, {\r\n          selected: true\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  private loadFilterList() {\r\n    this.spatialFilterService\r\n      .loadFilterList(this.queryType)\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe((features: Feature[]) => {\r\n        features.sort((a, b) => {\r\n          if (a.properties.nom < b.properties.nom) {\r\n            return -1;\r\n          }\r\n          if (a.properties.nom > b.properties.nom) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n        this.spatialListStore.clear();\r\n        this.spatialListStore.load(features);\r\n      });\r\n  }\r\n\r\n  getOutputToggleSearch() {\r\n    this.loadThematics();\r\n  }\r\n\r\n  getOutputClearSearch() {\r\n    this.zone = undefined;\r\n    this.queryType = undefined;\r\n  }\r\n\r\n  clearMap() {\r\n    this.map.removeLayers(this.layers);\r\n    this.layers = [];\r\n    this.activeLayers = [];\r\n    this.thematicLength = 0;\r\n    this.iterator = 1;\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      this.zone = undefined;\r\n      this.queryType = undefined;\r\n    }\r\n  }\r\n\r\n  private loadThematics() {\r\n    this.loading = true;\r\n    let zeroResults = true;\r\n    let thematics;\r\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\r\n      this.tryAddFeaturesToMap([this.zone]);\r\n    }\r\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\r\n      const theme: SpatialFilterThematic = {\r\n        name: ''\r\n      };\r\n      thematics = [theme];\r\n    } else {\r\n      thematics = this.thematics;\r\n    }\r\n    if (\r\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n      this.type !== SpatialFilterType.Point\r\n    ) {\r\n      this.buffer = this.buffer * 1000;\r\n    }\r\n    if (this.type === SpatialFilterType.Polygon) {\r\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\r\n    }\r\n\r\n    const observables$: Observable<Feature[]>[] = [];\r\n    thematics.forEach((thematic) => {\r\n      observables$.push(\r\n        this.spatialFilterService\r\n          .loadFilterItem(\r\n            this.zone,\r\n            this.itemType,\r\n            this.queryType,\r\n            thematic,\r\n            this.buffer\r\n          )\r\n          .pipe(\r\n            tap((features: Feature[]) => {\r\n              this.store.insertMany(features);\r\n              const featuresPoint: Feature[] = [];\r\n              const featuresLinePoly: Feature[] = [];\r\n              let idPoint;\r\n              let idLinePoly;\r\n              features.forEach((feature) => {\r\n                if (feature.geometry.type === 'Point') {\r\n                  feature.properties.longitude =\r\n                    feature.geometry.coordinates[0];\r\n                  feature.properties.latitude = feature.geometry.coordinates[1];\r\n                  featuresPoint.push(feature);\r\n                  idPoint = feature.meta.id;\r\n                } else {\r\n                  featuresLinePoly.push(feature);\r\n                  idLinePoly = feature.meta.id;\r\n                }\r\n              });\r\n\r\n              this.tryAddPointToMap(featuresPoint, idPoint);\r\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\r\n              if (features.length) {\r\n                zeroResults = false;\r\n                this.thematicLength += 1;\r\n                thematic.zeroResults = false;\r\n                this.cdRef.detectChanges();\r\n              } else {\r\n                thematic.zeroResults = true;\r\n              }\r\n\r\n              if (features.length >= 10000) {\r\n                this.messageService.alert(\r\n                  'igo.geo.spatialFilter.maxSizeAlert',\r\n                  'igo.geo.spatialFilter.warning',\r\n                  { timeOut: 10000 }\r\n                );\r\n              }\r\n            })\r\n          )\r\n      );\r\n    });\r\n\r\n    forkJoin(observables$)\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe(() => {\r\n        this.loading = false;\r\n        if (zeroResults) {\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.zeroResults',\r\n            'igo.geo.spatialFilter.warning',\r\n            { timeOut: 10000 }\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  onZoneChange(feature: Feature, buffer?: boolean) {\r\n    this.zone = feature;\r\n    if (feature) {\r\n      buffer\r\n        ? this.tryAddFeaturesToMap([feature], true)\r\n        : this.tryAddFeaturesToMap([feature]);\r\n      this.zoomToFeatureExtent(feature);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add zone feature to the map overlay\r\n   */\r\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\r\n    let i = 1;\r\n    for (const feature of features) {\r\n      if (this.type === SpatialFilterType.Predefined) {\r\n        for (const layer of this.layers) {\r\n          if (\r\n            layer.options._internal &&\r\n            layer.options._internal.code === feature.properties.code &&\r\n            !buffer\r\n          ) {\r\n            if (!layer.title?.startsWith('Zone')) {\r\n              const index = this.layers.indexOf(layer);\r\n              this.layers.splice(index, 1);\r\n            }\r\n            return;\r\n          }\r\n          if (layer.title?.startsWith('Zone')) {\r\n            this.activeLayers = [];\r\n            const index = this.layers.indexOf(layer);\r\n            this.layers.splice(index, 1);\r\n            this.map.removeLayer(layer);\r\n          }\r\n        }\r\n      } else {\r\n        if (buffer) {\r\n          for (const layer of this.activeLayers) {\r\n            if (\r\n              this.activeLayers.length === 1 &&\r\n              layer.title?.startsWith('Zone')\r\n            ) {\r\n              const index = this.layers.indexOf(layer);\r\n              this.layers.splice(index, 1);\r\n              this.map.removeLayer(layer);\r\n            }\r\n          }\r\n        }\r\n        this.activeLayers = [];\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith('Zone')) {\r\n          i++;\r\n        }\r\n      }\r\n      this.defaultStyle = (_feature, resolution) => {\r\n        const coordinates = (features[0] as any).coordinates;\r\n        return new olstyle.Style({\r\n          image: new olstyle.Circle({\r\n            radius: coordinates\r\n              ? this.buffer /\r\n                Math.cos((Math.PI / 180) * coordinates[1]) /\r\n                resolution\r\n              : undefined,\r\n            fill: new olstyle.Fill({\r\n              color: 'rgba(200, 200, 20, 0.2)'\r\n            }),\r\n            stroke: new olstyle.Stroke({\r\n              width: 1,\r\n              color: 'orange'\r\n            })\r\n          }),\r\n          stroke: new olstyle.Stroke({\r\n            width: 1,\r\n            color: 'orange'\r\n          }),\r\n          fill: new olstyle.Fill({\r\n            color: 'rgba(200, 200, 20, 0.2)'\r\n          })\r\n        });\r\n      };\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: ('Zone ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            workspace: { enabled: true },\r\n            _internal: {\r\n              code:\r\n                this.type === SpatialFilterType.Predefined\r\n                  ? feature.properties.code\r\n                  : undefined\r\n            },\r\n            source: dataSource,\r\n            visible: true\r\n          }) as VectorLayer;\r\n          const featuresOl = features.map((f) => {\r\n            return featureToOl(f, this.map.projection);\r\n          });\r\n          if (this.type !== SpatialFilterType.Predefined) {\r\n            const type =\r\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\r\n            featuresOl[0].set('nom', 'Zone', true);\r\n            featuresOl[0].set('type', type, true);\r\n          }\r\n          const ol = dataSource.ol as\r\n            | olSourceVector<OlGeometry>\r\n            | olSourceCluster;\r\n          ol.addFeatures(featuresOl);\r\n          olLayer.ol.setStyle(this.defaultStyle);\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.activeLayers.push(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add point features to the map\r\n   * Necessary to create clusters\r\n   */\r\n  private tryAddPointToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'cluster',\r\n          id,\r\n          queryable: true,\r\n          distance: 120,\r\n          meta: {\r\n            title: 'Cluster'\r\n          }\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: ClusterDataSource) => {\r\n          const icon = features[0].meta.icon;\r\n          let style: olstyle.Style;\r\n          if (!icon) {\r\n            style = createOverlayMarkerStyle();\r\n          } else {\r\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\r\n          }\r\n\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            source: dataSource,\r\n            visible: true,\r\n            style\r\n          });\r\n\r\n          const featuresOl = features.map((feature) => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceCluster;\r\n          ol.getSource().addFeatures(featuresOl);\r\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.layers.find((layer) => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.iterator = i;\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.pushLayer(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  private createSvgIcon(icon): olstyle.Style {\r\n    let style: olstyle.Style;\r\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe((svgObj) => {\r\n      const xmlSerializer = new XMLSerializer();\r\n      svgObj.setAttribute('width', '30');\r\n      svgObj.setAttribute('height', '30');\r\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\r\n      svgObj.setAttribute('stroke', 'white');\r\n      const svg = xmlSerializer.serializeToString(svgObj);\r\n      style = new olstyle.Style({\r\n        image: new olstyle.Icon({\r\n          src: 'data:image/svg+xml;utf8,' + svg\r\n        })\r\n      });\r\n    });\r\n    return style;\r\n  }\r\n  /**\r\n   * Try to add line or polygon features to the map\r\n   */\r\n  private tryAddLayerToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          id,\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            source: dataSource,\r\n            visible: true\r\n          });\r\n          const featuresOl = features.map((feature) => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceVector<OlGeometry>;\r\n          ol.addFeatures(featuresOl);\r\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.layers.find((layer) => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.pushLayer(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  zoomToFeatureExtent(feature) {\r\n    if (feature) {\r\n      const olFeature = this.format.readFeature(feature, {\r\n        dataProjection: feature.projection,\r\n        featureProjection: this.map.projection\r\n      });\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        [olFeature],\r\n        FeatureMotion.Zoom\r\n      );\r\n    }\r\n  }\r\n\r\n  pushLayer(layer) {\r\n    for (const lay of this.activeLayers) {\r\n      if (lay.id === layer.id) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.activeLayers.push(layer);\r\n  }\r\n}\r\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { TimeFilterListComponent } from './time-filter-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoTimeFilterListBinding]'\r\n})\r\nexport class TimeFilterListBindingDirective implements OnInit, OnDestroy {\r\n  private component: TimeFilterListComponent;\r\n  private layers$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: TimeFilterListComponent,\r\n    private mapService: MapService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    this.component.layers = [];\r\n\r\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\r\n      this.component.layers = layers;\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\n@ToolComponent({\n  name: 'timeFilter',\n  title: 'igo.integration.tools.timeFilter',\n  icon: 'history'\n})\n@Component({\n  selector: 'igo-time-filter-tool',\n  templateUrl: './time-filter-tool.component.html'\n})\nexport class TimeFilterToolComponent {\n  constructor() {}\n}\n","<igo-time-filter-list igoTimeFilterListBinding></igo-time-filter-list>\n","import {\r\n  AnimationTriggerMetadata,\r\n  animate,\r\n  state,\r\n  style,\r\n  transition,\r\n  trigger\r\n} from '@angular/animations';\r\n\r\nexport function toolSlideInOut(\r\n  speed = '300ms',\r\n  type = 'ease-in-out'\r\n): AnimationTriggerMetadata {\r\n  return trigger('toolSlideInOut', [\r\n    state(\r\n      'enter',\r\n      style({\r\n        transform: 'translateX(100%)'\r\n      })\r\n    ),\r\n    transition('void => enter', animate(speed + ' ' + type))\r\n  ]);\r\n}\r\n","import { Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { IgoMap, Layer } from '@igo2/geo';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport { toolSlideInOut } from './active-time-filter-tool.animation';\r\n\r\n@ToolComponent({\r\n  name: 'activeTimeFilter',\r\n  title: 'igo.integration.tools.timeFilter',\r\n  icon: 'history',\r\n  parent: 'mapTools'\r\n})\r\n@Component({\r\n  selector: 'igo-active-time-filter-tool',\r\n  templateUrl: './active-time-filter-tool.component.html',\r\n  animations: [toolSlideInOut()]\r\n})\r\nexport class ActiveTimeFilterToolComponent {\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get layer(): Layer {\r\n    for (const lay of this.map.layers) {\r\n      if (lay.options.active === true) {\r\n        return lay;\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  public animate = 'enter';\r\n\r\n  constructor(public mapState: MapState) {}\r\n}\r\n","<igo-time-filter-item\n  [map]=\"map\"\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [@toolSlideInOut]=\"animate\"\n>\n</igo-time-filter-item>\n","<mat-tab-group *ngIf=\"importExportShowBothType\">\n  <mat-tab\n    [label]=\"'igo.integration.importExportTool.importExportData' | translate\"\n  >\n    <igo-import-export\n      [contextUri]=\"(contextState.context$ | async).uri\"\n      [map]=\"map\"\n      [selectFirstProj]=\"selectFirstProj\"\n      [projectionsLimitations]=\"projectionsLimitations\"\n      [store]=\"workspaceStore\"\n      [selectedMode]=\"importExportState.selectedMode$ | async\"\n      (selectMode)=\"modeChanged($event)\"\n      [exportOptions$]=\"importExportState.exportOptions$\"\n      (exportOptionsChange)=\"exportOptionsChange($event)\"\n    >\n    </igo-import-export>\n  </mat-tab>\n  <mat-tab\n    [label]=\"'igo.integration.importExportTool.importExportContext' | translate\"\n  >\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\n  </mat-tab>\n</mat-tab-group>\n\n<igo-import-export\n  *ngIf=\"!importExportShowBothType && importExportType === 'layer'\"\n  [contextUri]=\"(contextState.context$ | async).uri\"\n  [map]=\"map\"\n  [store]=\"workspaceStore\"\n  [selectedMode]=\"importExportState.selectedMode$ | async\"\n  (selectMode)=\"modeChanged($event)\"\n  [exportOptions$]=\"importExportState.exportOptions$\"\n  (exportOptionsChange)=\"exportOptionsChange($event)\"\n>\n</igo-import-export>\n\n<igo-context-import-export\n  *ngIf=\"!importExportShowBothType && importExportType === 'context'\"\n  [map]=\"map\"\n>\n</igo-context-import-export>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport type { WorkspaceStore } from '@igo2/common';\r\nimport {\r\n  ExportOptions,\r\n  IgoMap,\r\n  ProjectionsLimitationsOptions\r\n} from '@igo2/geo';\r\n\r\nimport { ContextState } from '../../context/context.state';\r\nimport { MapState } from '../../map/map.state';\r\nimport { WorkspaceState } from '../../workspace/workspace.state';\r\nimport {\r\n  ImportExportMode,\r\n  ImportExportState,\r\n  ImportExportType\r\n} from '../import-export.state';\r\n\r\n@ToolComponent({\r\n  name: 'importExport',\r\n  title: 'igo.integration.tools.importExport',\r\n  icon: 'file-move'\r\n})\r\n@Component({\r\n  selector: 'igo-import-export-tool',\r\n  templateUrl: './import-export-tool.component.html',\r\n  styleUrls: ['./import-export-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ImportExportToolComponent implements OnInit {\r\n  @Input() projectionsLimitations: ProjectionsLimitationsOptions;\r\n\r\n  @Input() selectFirstProj: boolean = false;\r\n\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get workspaceStore(): WorkspaceStore {\r\n    return this.workspaceState.store;\r\n  }\r\n\r\n  @Input() importExportType: ImportExportType = ImportExportType.layer;\r\n  @Input() importExportShowBothType: boolean = true;\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    public importExportState: ImportExportState,\r\n    private workspaceState: WorkspaceState,\r\n    public contextState: ContextState\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.selectType();\r\n    this.selectMode();\r\n  }\r\n\r\n  private selectType() {\r\n    if (this.importExportType) {\r\n      this.importExportState.importExportType$.next(this.importExportType);\r\n    }\r\n    const userSelectedType = this.importExportState.importExportType$.value;\r\n    if (userSelectedType !== undefined) {\r\n      this.importExportState.setImportExportType(userSelectedType);\r\n    } else {\r\n      this.importExportState.setImportExportType(ImportExportType.layer);\r\n    }\r\n  }\r\n\r\n  private selectMode() {\r\n    const userSelectedMode = this.importExportState.selectedMode$.value;\r\n    if (userSelectedMode !== undefined) {\r\n      this.importExportState.setMode(userSelectedMode);\r\n    } else {\r\n      this.importExportState.setMode(ImportExportMode.import);\r\n    }\r\n  }\r\n\r\n  public modeChanged(mode: ImportExportMode) {\r\n    this.importExportState.setMode(mode);\r\n  }\r\n\r\n  public exportOptionsChange(exportOptions: ExportOptions) {\r\n    this.importExportState.setsExportOptions(exportOptions);\r\n  }\r\n\r\n  importExportTypeChange(event) {\r\n    this.importExportType = event.value;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { FeatureStore, FeatureWithMeasure } from '@igo2/geo';\r\n\r\nimport { MapState } from '../map/map.state';\r\n\r\n/**\r\n * Service that holds the state of the measure module\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MeasureState {\r\n  /**\r\n   * Store that holds the measures\r\n   */\r\n  public store: FeatureStore<FeatureWithMeasure>;\r\n\r\n  constructor(private mapState: MapState) {\r\n    this.store = new FeatureStore<FeatureWithMeasure>([], {\r\n      map: this.mapState.map\r\n    });\r\n\r\n    this.mapState.map.layers$.subscribe((layers) => {\r\n      if (\r\n        layers.filter((l) => l.id?.startsWith('igo-measures-')).length === 0\r\n      ) {\r\n        this.store.deleteMany(this.store.all());\r\n        this.mapState.map.ol\r\n          .getOverlays()\r\n          .getArray()\r\n          .filter((overlay) =>\r\n            (overlay as any).options.className.includes('igo-map-tooltip')\r\n          )\r\n          .map((overlay) => this.mapState.map.ol.removeOverlay(overlay));\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { ChangeDetectionStrategy, Component } from '@angular/core';\r\n\r\nimport { ToolComponent } from '@igo2/common';\r\nimport { FeatureStore, FeatureWithMeasure, IgoMap } from '@igo2/geo';\r\n\r\nimport { MapState } from '../../map/map.state';\r\nimport { MeasureState } from '../measure.state';\r\n\r\n/**\r\n * Tool to measure lengths and areas\r\n */\r\n@ToolComponent({\r\n  name: 'measurer',\r\n  title: 'igo.integration.tools.measurer',\r\n  icon: 'ruler'\r\n})\r\n@Component({\r\n  selector: 'igo-measurer-tool',\r\n  templateUrl: './measurer-tool.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerToolComponent {\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get store(): FeatureStore<FeatureWithMeasure> {\r\n    return this.measureState.store;\r\n  }\r\n\r\n  /**\r\n   * Map to measure on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  constructor(\r\n    private measureState: MeasureState,\r\n    private mapState: MapState\r\n  ) {}\r\n}\r\n","<igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport { IgoMap } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\n\n@ToolComponent({\n  name: 'print',\n  title: 'igo.integration.tools.print',\n  icon: 'printer'\n})\n@Component({\n  selector: 'igo-print-tool',\n  templateUrl: './print-tool.component.html'\n})\nexport class PrintToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(private mapState: MapState) {}\n}\n","<igo-print [map]=\"map\"></igo-print>\n","<div\n  *ngIf=\"(!store || store.stateView.empty) && (debouncedEmpty$ | async)\"\n  style=\"margin: 10px\"\n>\n  <section class=\"mat-typography\">\n    <h4>\n      <strong>{{\n        'igo.integration.searchResultsTool.noResults' | translate\n      }}</strong>\n    </h4>\n    <p>\n      <strong>{{\n        'igo.integration.searchResultsTool.doSearch' | translate\n      }}</strong>\n    </p>\n    <div\n      [innerHTML]=\"\n        'igo.integration.searchResultsTool.examples' | translate | sanitizeHtml\n      \"\n    ></div>\n  </section>\n</div>\n\n<igo-flexible\n  *ngIf=\"(debouncedEmpty$ | async) === false\"\n  #topPanel\n  initial=\"100%\"\n  initialMobile=\"100%\"\n  collapsed=\"calc(100% - 58px)\"\n  collapsedMobile=\"calc(100% - 58px)\"\n  expanded=\"60%\"\n  expandedMobile=\"60%\"\n  [state]=\"(feature$ | async) ? topPanelState : 'initial'\"\n>\n  <div class=\"igo-content\">\n    <igo-search-results\n      [store]=\"store\"\n      [showIcons]=\"showIcons\"\n      [term]=\"term\"\n      [termSplitter]=\"termSplitter\"\n      [settingsChange$]=\"settingsChange$\"\n      placeholder=\"false\"\n      (resultFocus)=\"onResultFocus($event)\"\n      (resultSelect)=\"onResultSelect($event)\"\n      (resultUnfocus)=\"onResultUnfocus($event)\"\n      (resultMouseenter)=\"onResultFocus($event)\"\n      (resultMouseleave)=\"onResultUnfocus($event)\"\n      (moreResults)=\"onSearch($event)\"\n      [map]=\"map\"\n    >\n      <ng-template #igoSearchItemToolbar let-result=\"result\">\n        <igo-search-add-button\n          [map]=\"map\"\n          [store]=\"store\"\n          [stores]=\"stores\"\n          [layer]=\"result\"\n          [saveSearchResultInLayer]=\"saveSearchResultInLayer\"\n        >\n        </igo-search-add-button>\n      </ng-template>\n    </igo-search-results>\n  </div>\n\n  <div igoFlexibleFill class=\"igo-content\">\n    <igo-panel\n      [title]=\"featureTitle\"\n      *ngIf=\"feature$ | async\"\n      (click)=\"toggleTopPanel($event)\"\n      [cursorPointer]=\"true\"\n    >\n      <button\n        mat-icon-button\n        panelLeftButton\n        class=\"igo-icon-button\"\n        (click)=\"toggleTopPanel()\"\n      >\n        <mat-icon\n          [svgIcon]=\"\n            (topPanelState$ | async) === 'collapsed' ? 'arrow-up' : 'arrow-down'\n          \"\n        ></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"feature.geometry\"\n        mat-icon-button\n        panelRightButton\n        class=\"igo-icon-button\"\n        [matTooltip]=\"\n          ((isSelectedResultOutOfView$ | async)\n            ? 'igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView'\n            : 'igo.integration.searchResultsTool.zoomOnFeatureTooltip'\n          ) | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        (click)=\"zoomToFeatureExtent()\"\n      >\n        <mat-icon\n          aria-hidden=\"false\"\n          [matBadge]=\"(isSelectedResultOutOfView$ | async) ? '!' : ''\"\n          matBadgeColor=\"accent\"\n          matBadgeSize=\"small\"\n          [matBadgeHidden]=\"(isSelectedResultOutOfView$ | async) === false\"\n          svgIcon=\"magnify-plus-outline\"\n        ></mat-icon>\n      </button>\n\n      <igo-feature-details\n        igoFeatureDetailsDirective\n        [feature]=\"feature$ | async\"\n        [map]=\"map\"\n        [toolbox]=\"toolState.toolbox\"\n        (routingEvent)=\"getRoute()\"\n      >\n      </igo-feature-details>\n    </igo-panel>\n  </div>\n</igo-flexible>\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  ElementRef,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport {\r\n  EntityState,\r\n  EntityStore,\r\n  FlexibleComponent,\r\n  FlexibleState,\r\n  ToolComponent,\r\n  getEntityTitle\r\n} from '@igo2/common';\r\nimport { ConfigService } from '@igo2/core';\r\nimport {\r\n  FEATURE,\r\n  Feature,\r\n  FeatureMotion,\r\n  FeatureStore,\r\n  IgoMap,\r\n  Research,\r\n  SearchResult,\r\n  computeOlFeaturesExtent,\r\n  featureFromOl,\r\n  featureToOl,\r\n  featuresAreOutOfView,\r\n  featuresAreTooDeepInView,\r\n  getCommonVectorSelectedStyle,\r\n  getCommonVectorStyle,\r\n  moveToOlFeatures,\r\n  roundCoordTo\r\n} from '@igo2/geo';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olPoint from 'ol/geom/Point';\r\nimport * as olProj from 'ol/proj';\r\n\r\nimport pointOnFeature from '@turf/point-on-feature';\r\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\r\nimport { debounceTime, map } from 'rxjs/operators';\r\n\r\nimport { DirectionState } from '../../directions/directions.state';\r\nimport { MapState } from '../../map/map.state';\r\nimport { ToolState } from '../../tool/tool.state';\r\nimport { SearchState } from '../search.state';\r\n\r\n/**\r\n * Tool to browse the search results\r\n */\r\n@ToolComponent({\r\n  name: 'searchResults',\r\n  title: 'igo.integration.tools.searchResults',\r\n  icon: 'magnify'\r\n})\r\n@Component({\r\n  selector: 'igo-search-results-tool',\r\n  templateUrl: './search-results-tool.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsToolComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean = true;\r\n\r\n  /**\r\n   * Determine the top panel default state\r\n   */\r\n  @Input() topPanelStateDefault: string = 'expanded';\r\n\r\n  private hasFeatureEmphasisOnSelection: boolean = false;\r\n  public saveSearchResultInLayer: boolean = false;\r\n\r\n  private showResultsGeometries$$: Subscription;\r\n  private getRoute$$: Subscription;\r\n  private shownResultsGeometries: Feature[] = [];\r\n  private shownResultsEmphasisGeometries: Feature[] = [];\r\n  private focusedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n  public isSelectedResultOutOfView$ = new BehaviorSubject(false);\r\n  private isSelectedResultOutOfView$$: Subscription;\r\n  private abstractFocusedResult: Feature;\r\n  private abstractSelectedResult: Feature;\r\n\r\n  public debouncedEmpty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  private debouncedEmpty$$: Subscription;\r\n\r\n  /**\r\n   * Store holding the search results\r\n   * @internal\r\n   */\r\n  get store(): EntityStore<SearchResult> {\r\n    return this.searchState.store;\r\n  }\r\n\r\n  /**\r\n   * Map to display the results on\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.mapState.map;\r\n  }\r\n\r\n  get featureTitle(): string {\r\n    return this.feature ? getEntityTitle(this.feature) : undefined;\r\n  }\r\n\r\n  get feature$(): Observable<Feature> {\r\n    return this.store.stateView\r\n      .firstBy$((e) => e.state.focused)\r\n      .pipe(\r\n        map(\r\n          (element) =>\r\n            (this.feature = element\r\n              ? (element.entity.data as Feature)\r\n              : undefined)\r\n        )\r\n      );\r\n  }\r\n\r\n  public feature: Feature;\r\n\r\n  public term = '';\r\n  private searchTerm$$: Subscription;\r\n\r\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  public topPanelState$ = new BehaviorSubject<FlexibleState>('initial');\r\n  private topPanelState$$: Subscription;\r\n\r\n  @Input()\r\n  set topPanelState(value: FlexibleState) {\r\n    this.topPanelState$.next(value);\r\n  }\r\n  get topPanelState(): FlexibleState {\r\n    return this.topPanelState$.value;\r\n  }\r\n\r\n  get termSplitter(): string {\r\n    return this.searchState.searchTermSplitter$.value;\r\n  }\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get stores(): FeatureStore<Feature>[] {\r\n    return this.searchState.searchLayerStores;\r\n  }\r\n\r\n  constructor(\r\n    private mapState: MapState,\r\n    private searchState: SearchState,\r\n    private elRef: ElementRef,\r\n    public toolState: ToolState,\r\n    private directionState: DirectionState,\r\n    configService: ConfigService\r\n  ) {\r\n    this.hasFeatureEmphasisOnSelection = configService.getConfig(\r\n      'hasFeatureEmphasisOnSelection'\r\n    );\r\n    this.saveSearchResultInLayer = configService.getConfig(\r\n      'saveSearchResultInLayer'\r\n    );\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.searchTerm$$ = this.searchState.searchTerm$.subscribe(\r\n      (searchTerm: string) => {\r\n        if (\r\n          searchTerm !== undefined &&\r\n          searchTerm !== null &&\r\n          searchTerm !== ''\r\n        ) {\r\n          this.term = searchTerm;\r\n          this.debouncedEmpty$.next(false);\r\n        } else if (searchTerm === '') {\r\n          this.debouncedEmpty$.next(true);\r\n        }\r\n      }\r\n    );\r\n\r\n    for (const res of this.store.stateView.all$().value) {\r\n      if (this.store.state.get(res.entity).selected === true) {\r\n        this.topPanelState = 'expanded';\r\n      }\r\n    }\r\n\r\n    this.searchState.searchSettingsChange$.subscribe(() => {\r\n      this.settingsChange$.next(true);\r\n    });\r\n\r\n    this.topPanelState$$ = this.topPanelState$.subscribe(() => {\r\n      const igoList = this.computeElementRef()[0];\r\n      const selected = this.computeElementRef()[1];\r\n      if (selected) {\r\n        setTimeout(() => {\r\n          // To be sure the flexible component has been displayed yet\r\n          if (!this.isScrolledIntoView(igoList, selected)) {\r\n            this.adjustTopPanel(igoList, selected);\r\n          }\r\n        }, FlexibleComponent.transitionTime + 50);\r\n      }\r\n    });\r\n\r\n    if (this.hasFeatureEmphasisOnSelection) {\r\n      if (!this.searchState.focusedOrResolution$$) {\r\n        this.searchState.focusedOrResolution$$ = combineLatest([\r\n          this.focusedResult$,\r\n          this.map.viewController.resolution$\r\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\r\n          this.buildResultEmphasis(bunch[0], 'focused')\r\n        );\r\n      }\r\n\r\n      if (!this.searchState.selectedOrResolution$$) {\r\n        this.searchState.selectedOrResolution$$ = combineLatest([\r\n          this.searchState.selectedResult$,\r\n          this.map.viewController.resolution$\r\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\r\n          this.buildResultEmphasis(bunch[0], 'selected')\r\n        );\r\n      }\r\n    }\r\n    this.monitorResultOutOfView();\r\n\r\n    this.showResultsGeometries$$ = combineLatest([\r\n      this.searchState.searchResultsGeometryEnabled$,\r\n      this.store.stateView.all$(),\r\n      this.focusedResult$,\r\n      this.searchState.selectedResult$,\r\n      this.searchState.searchTerm$,\r\n      this.map.viewController.resolution$\r\n    ]).subscribe(\r\n      (\r\n        bunch: [\r\n          boolean,\r\n          { entity: SearchResult; state: EntityState }[],\r\n          SearchResult,\r\n          SearchResult,\r\n          string,\r\n          number\r\n        ]\r\n      ) => {\r\n        const searchResultsGeometryEnabled = bunch[0];\r\n        const searchResults = bunch[1];\r\n\r\n        if (this.hasFeatureEmphasisOnSelection) {\r\n          this.clearFeatureEmphasis('shown');\r\n        }\r\n        this.shownResultsGeometries.map((result) =>\r\n          this.map.queryResultsOverlay.removeFeature(result)\r\n        );\r\n        const featureToHandleGeom = searchResults.filter(\r\n          (result) =>\r\n            result.entity.meta.dataType === FEATURE &&\r\n            result.entity.data.geometry &&\r\n            !result.state.selected &&\r\n            !result.state.focused\r\n        );\r\n\r\n        featureToHandleGeom.map((result) => {\r\n          if (searchResultsGeometryEnabled) {\r\n            result.entity.data.meta.style = getCommonVectorStyle(\r\n              Object.assign(\r\n                {},\r\n                {\r\n                  feature: result.entity.data as Feature | olFeature<OlGeometry>\r\n                },\r\n                this.searchState.searchOverlayStyle,\r\n                result.entity.style?.base ? result.entity.style.base : {}\r\n              )\r\n            );\r\n            this.shownResultsGeometries.push(result.entity.data as Feature);\r\n            this.map.queryResultsOverlay.addFeature(\r\n              result.entity.data as Feature,\r\n              FeatureMotion.None\r\n            );\r\n            if (this.hasFeatureEmphasisOnSelection) {\r\n              this.buildResultEmphasis(\r\n                result.entity as SearchResult<Feature>,\r\n                'shown'\r\n              );\r\n            }\r\n          }\r\n        });\r\n      }\r\n    );\r\n\r\n    this.debouncedEmpty$$ = this.store.stateView.empty$\r\n      .pipe(debounceTime(1500))\r\n      .subscribe((empty) => this.debouncedEmpty$.next(empty));\r\n  }\r\n\r\n  private monitorResultOutOfView() {\r\n    this.isSelectedResultOutOfView$$ = combineLatest([\r\n      this.map.viewController.state$,\r\n      this.searchState.selectedResult$\r\n    ])\r\n      .pipe(debounceTime(100))\r\n      .subscribe((bunch) => {\r\n        const selectedResult = bunch[1] as SearchResult<Feature>;\r\n        if (!selectedResult) {\r\n          this.isSelectedResultOutOfView$.next(false);\r\n          return;\r\n        }\r\n        if (selectedResult.data.geometry) {\r\n          const selectedOlFeature = featureToOl(\r\n            selectedResult.data,\r\n            this.map.projection\r\n          );\r\n          const selectedOlFeatureExtent = computeOlFeaturesExtent(\r\n            [selectedOlFeature],\r\n            this.map.viewController.getOlProjection()\r\n          );\r\n          this.isSelectedResultOutOfView$.next(\r\n            featuresAreOutOfView(this.map.getExtent(), selectedOlFeatureExtent)\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  private buildResultEmphasis(\r\n    result: SearchResult<Feature>,\r\n    trigger: 'selected' | 'focused' | 'shown' | undefined\r\n  ) {\r\n    if (trigger !== 'shown') {\r\n      this.clearFeatureEmphasis(trigger);\r\n    }\r\n    if (!result || !result.data.geometry) {\r\n      return;\r\n    }\r\n    const myOlFeature = featureToOl(result.data, this.map.projection);\r\n    const olGeometry = myOlFeature.getGeometry();\r\n    if (\r\n      featuresAreTooDeepInView(\r\n        this.map.viewController,\r\n        olGeometry.getExtent() as [number, number, number, number],\r\n        0.0025\r\n      )\r\n    ) {\r\n      const extent = olGeometry.getExtent();\r\n      const x = extent[0] + (extent[2] - extent[0]) / 2;\r\n      const y = extent[1] + (extent[3] - extent[1]) / 2;\r\n      const feature1 = new olFeature({\r\n        name: `${trigger}AbstractResult'`,\r\n        geometry: new olPoint([x, y])\r\n      });\r\n      const abstractResult = featureFromOl(feature1, this.map.projection);\r\n\r\n      let computedStyle;\r\n      let zIndexOffset = 0;\r\n\r\n      switch (trigger) {\r\n        case 'focused':\r\n          computedStyle = getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature: abstractResult },\r\n              this.searchState.searchOverlayStyleFocus,\r\n              result.style?.focus ? result.style.focus : {}\r\n            )\r\n          );\r\n          zIndexOffset = 2;\r\n          break;\r\n        case 'shown':\r\n          computedStyle = getCommonVectorStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature: abstractResult },\r\n              this.searchState.searchOverlayStyle,\r\n              result.style?.base ? result.style.base : {}\r\n            )\r\n          );\r\n          break;\r\n        case 'selected':\r\n          computedStyle = getCommonVectorSelectedStyle(\r\n            Object.assign(\r\n              {},\r\n              { feature: abstractResult },\r\n              this.searchState.searchOverlayStyleSelection,\r\n              result.style?.selection ? result.style.selection : {}\r\n            )\r\n          );\r\n          zIndexOffset = 1;\r\n          break;\r\n      }\r\n      abstractResult.meta.style = computedStyle;\r\n      abstractResult.meta.style.setZIndex(2000 + zIndexOffset);\r\n      this.map.searchResultsOverlay.addFeature(\r\n        abstractResult,\r\n        FeatureMotion.None\r\n      );\r\n      if (trigger === 'focused') {\r\n        this.abstractFocusedResult = abstractResult;\r\n      }\r\n      if (trigger === 'selected') {\r\n        this.abstractSelectedResult = abstractResult;\r\n      }\r\n      if (trigger === 'shown') {\r\n        this.shownResultsEmphasisGeometries.push(abstractResult);\r\n      }\r\n    } else {\r\n      this.clearFeatureEmphasis(trigger);\r\n    }\r\n  }\r\n\r\n  private clearFeatureEmphasis(trigger: 'selected' | 'focused' | 'shown') {\r\n    if (trigger === 'focused' && this.abstractFocusedResult) {\r\n      this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult);\r\n      this.abstractFocusedResult = undefined;\r\n    }\r\n    if (trigger === 'selected' && this.abstractSelectedResult) {\r\n      this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult);\r\n      this.abstractSelectedResult = undefined;\r\n    }\r\n    if (trigger === 'shown') {\r\n      this.shownResultsEmphasisGeometries.map((shownResult) =>\r\n        this.map.searchResultsOverlay.removeFeature(shownResult)\r\n      );\r\n      this.shownResultsEmphasisGeometries = [];\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.topPanelState$$.unsubscribe();\r\n    this.searchTerm$$.unsubscribe();\r\n    if (this.isSelectedResultOutOfView$$) {\r\n      this.isSelectedResultOutOfView$$.unsubscribe();\r\n    }\r\n    if (this.showResultsGeometries$$) {\r\n      this.showResultsGeometries$$.unsubscribe();\r\n    }\r\n    if (this.getRoute$$) {\r\n      this.getRoute$$.unsubscribe();\r\n    }\r\n    if (this.debouncedEmpty$$) {\r\n      this.debouncedEmpty$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map when it's being focused\r\n   * @internal\r\n   * @param result A search result that could be a feature\r\n   */\r\n  onResultFocus(result: SearchResult) {\r\n    this.focusedResult$.next(result);\r\n    if (result.meta.dataType === FEATURE && result.data.geometry) {\r\n      result.data.meta.style = getCommonVectorSelectedStyle(\r\n        Object.assign(\r\n          {},\r\n          { feature: result.data as Feature | olFeature<OlGeometry> },\r\n          this.searchState.searchOverlayStyleFocus,\r\n          result.style?.focus ? result.style.focus : {}\r\n        )\r\n      );\r\n\r\n      const feature =\r\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\r\n          result.meta.id\r\n        );\r\n      if (feature) {\r\n        feature.setStyle(result.data.meta.style);\r\n        return;\r\n      }\r\n      this.map.searchResultsOverlay.addFeature(\r\n        result.data as Feature,\r\n        FeatureMotion.None\r\n      );\r\n    }\r\n  }\r\n\r\n  onResultUnfocus(result: SearchResult) {\r\n    this.focusedResult$.next(undefined);\r\n    if (result.meta.dataType !== FEATURE) {\r\n      return;\r\n    }\r\n\r\n    if (this.store.state.get(result).selected === true) {\r\n      const feature =\r\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\r\n          result.meta.id\r\n        );\r\n      if (feature) {\r\n        const style = getCommonVectorSelectedStyle(\r\n          Object.assign(\r\n            {},\r\n            { feature: result.data as Feature | olFeature<OlGeometry> },\r\n            this.searchState.searchOverlayStyleFocus,\r\n            result.style?.focus ? result.style.focus : {}\r\n          )\r\n        );\r\n        feature.setStyle(style);\r\n      }\r\n      return;\r\n    }\r\n    this.map.searchResultsOverlay.removeFeature(result.data as Feature);\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map when it's being selected\r\n   * @internal\r\n   * @param result A search result that could be a feature or some layer options\r\n   */\r\n  onResultSelect(result: SearchResult) {\r\n    this.map.searchResultsOverlay.dataSource.ol.clear();\r\n    this.tryAddFeatureToMap(result);\r\n    this.searchState.setSelectedResult(result);\r\n\r\n    if (this.topPanelState === 'initial') {\r\n      if (this.topPanelStateDefault !== 'collapsed') {\r\n        this.topPanelState = 'expanded';\r\n      } else {\r\n        this.topPanelState = 'collapsed';\r\n      }\r\n    }\r\n\r\n    if (this.topPanelState === 'expanded') {\r\n      const igoList = this.computeElementRef()[0];\r\n      const selected = this.computeElementRef()[1];\r\n      if (!this.isScrolledIntoView(igoList, selected)) {\r\n        this.adjustTopPanel(igoList, selected);\r\n      }\r\n    }\r\n  }\r\n\r\n  onSearch(event: { research: Research; results: SearchResult[] }) {\r\n    const results = event.results;\r\n    const newResults = this.store.entities$.value\r\n      .filter((result: SearchResult) => result.source !== event.research.source)\r\n      .concat(results);\r\n\r\n    this.store.load(newResults);\r\n\r\n    for (const res of this.store.all()) {\r\n      if (\r\n        this.store.state.get(res).focused === true &&\r\n        this.store.state.get(res).selected !== true\r\n      ) {\r\n        this.store.state.update(res, { focused: false }, true);\r\n      }\r\n    }\r\n\r\n    setTimeout(() => {\r\n      const igoList = this.elRef.nativeElement.querySelector('igo-list');\r\n      let moreResults;\r\n      event.research.request.subscribe((source) => {\r\n        if (!source[0] || !source[0].source) {\r\n          moreResults = null;\r\n        } else if (source[0].source.getId() === 'icherche') {\r\n          moreResults = igoList.querySelector('.icherche .moreResults');\r\n        } else if (source[0].source.getId() === 'ilayer') {\r\n          moreResults = igoList.querySelector('.ilayer .moreResults');\r\n        } else if (source[0].source.getId() === 'nominatim') {\r\n          moreResults = igoList.querySelector('.nominatim .moreResults');\r\n        } else {\r\n          moreResults = igoList.querySelector(\r\n            '.' + source[0].source.getId() + ' .moreResults'\r\n          );\r\n        }\r\n\r\n        if (\r\n          moreResults !== null &&\r\n          !this.isScrolledIntoView(igoList, moreResults)\r\n        ) {\r\n          igoList.scrollTop =\r\n            moreResults.offsetTop +\r\n            moreResults.offsetHeight -\r\n            igoList.clientHeight;\r\n        }\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  computeElementRef() {\r\n    const items = document.getElementsByTagName('igo-search-results-item');\r\n    const igoList =\r\n      this.elRef.nativeElement.getElementsByTagName('igo-list')[0];\r\n    let selectedItem;\r\n    // eslint-disable-next-line\r\n    for (let i = 0; i < items.length; i++) {\r\n      if (items[i].className.includes('igo-list-item-selected')) {\r\n        selectedItem = items[i];\r\n      }\r\n    }\r\n    return [igoList, selectedItem];\r\n  }\r\n\r\n  adjustTopPanel(elemSource, elem) {\r\n    if (!this.isScrolledIntoView(elemSource, elem)) {\r\n      elemSource.scrollTop =\r\n        elem.offsetTop +\r\n        elem.children[0].offsetHeight -\r\n        elemSource.clientHeight;\r\n    }\r\n  }\r\n\r\n  toggleTopPanel(event?: MouseEvent) {\r\n    if (event && (event.target as any)?.className !== 'igo-panel-title') {\r\n      return;\r\n    } else {\r\n      if (this.topPanelState === 'expanded') {\r\n        this.topPanelState = 'collapsed';\r\n      } else {\r\n        this.topPanelState = 'expanded';\r\n      }\r\n    }\r\n  }\r\n\r\n  zoomToFeatureExtent() {\r\n    if (this.feature.geometry) {\r\n      const localOlFeature = this.format.readFeature(this.feature, {\r\n        dataProjection: this.feature.projection,\r\n        featureProjection: this.map.projectionCode\r\n      });\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        [localOlFeature],\r\n        FeatureMotion.Zoom\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map overlay\r\n   * @param result A search result that could be a feature\r\n   */\r\n  private tryAddFeatureToMap(result: SearchResult) {\r\n    if (result.meta.dataType !== FEATURE) {\r\n      return undefined;\r\n    }\r\n    const feature = (result as SearchResult<Feature>).data;\r\n\r\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\r\n    if (!feature.geometry) {\r\n      return;\r\n    }\r\n\r\n    feature.meta.style = getCommonVectorSelectedStyle(\r\n      Object.assign(\r\n        {},\r\n        { feature },\r\n        this.searchState.searchOverlayStyleSelection,\r\n        result.style?.selection ? result.style.selection : {}\r\n      )\r\n    );\r\n\r\n    this.map.searchResultsOverlay.addFeature(feature);\r\n  }\r\n\r\n  isScrolledIntoView(elemSource, elem) {\r\n    const padding = 6;\r\n    const docViewTop = elemSource.scrollTop;\r\n    const docViewBottom = docViewTop + elemSource.clientHeight;\r\n\r\n    const elemTop = elem.offsetTop;\r\n    const elemBottom = elemTop + elem.clientHeight + padding;\r\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\r\n  }\r\n\r\n  getRoute() {\r\n    this.toolState.toolbox.activateTool('directions');\r\n    this.directionState.stopsStore.clearStops();\r\n    setTimeout(() => {\r\n      let routingCoordLoaded = false;\r\n      if (this.getRoute$$) {\r\n        this.getRoute$$.unsubscribe();\r\n      }\r\n      this.getRoute$$ =\r\n        this.directionState.stopsStore.storeInitialized$.subscribe(\r\n          (init: boolean) => {\r\n            if (\r\n              this.directionState.stopsStore.storeInitialized$.value &&\r\n              !routingCoordLoaded\r\n            ) {\r\n              routingCoordLoaded = true;\r\n              const stop = this.directionState.stopsStore\r\n                .all()\r\n                .find((e) => e.position === 1);\r\n              let coord;\r\n              if (this.feature.geometry) {\r\n                if (this.feature.geometry.type === 'Point') {\r\n                  coord = [\r\n                    this.feature.geometry.coordinates[0],\r\n                    this.feature.geometry.coordinates[1]\r\n                  ];\r\n                } else {\r\n                  const point = pointOnFeature(this.feature.geometry);\r\n                  coord = [\r\n                    point.geometry.coordinates[0],\r\n                    point.geometry.coordinates[1]\r\n                  ];\r\n                }\r\n              }\r\n              stop.text = this.featureTitle;\r\n              stop.coordinates = coord;\r\n              this.directionState.stopsStore.update(stop);\r\n              if (this.map.geolocationController.position$.value) {\r\n                const currentPos =\r\n                  this.map.geolocationController.position$.value;\r\n                const stop = this.directionState.stopsStore\r\n                  .all()\r\n                  .find((e) => e.position === 0);\r\n                const currentCoord = olProj.transform(\r\n                  currentPos.position,\r\n                  currentPos.projection,\r\n                  'EPSG:4326'\r\n                );\r\n                const coord: [number, number] = roundCoordTo(\r\n                  [currentCoord[0], currentCoord[1]],\r\n                  6\r\n                );\r\n                stop.text = coord.join(',');\r\n                stop.coordinates = coord;\r\n                this.directionState.stopsStore.update(stop);\r\n              }\r\n            }\r\n          }\r\n        );\r\n    }, 250);\r\n  }\r\n}\r\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\r\nimport { TemplatePortal } from '@angular/cdk/portal';\r\nimport {\r\n  Directive,\r\n  ElementRef,\r\n  EventEmitter,\r\n  HostListener,\r\n  Input,\r\n  Output,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\nimport type { TemplateRef } from '@angular/core';\r\n\r\nimport { Subscription, fromEvent } from 'rxjs';\r\nimport { filter, take } from 'rxjs/operators';\r\n\r\n@Directive({\r\n  selector: '[igoContextMenu]'\r\n})\r\nexport class ContextMenuDirective {\r\n  private overlayRef: OverlayRef | null;\r\n  private sub: Subscription;\r\n\r\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\r\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\r\n\r\n  constructor(\r\n    public overlay: Overlay,\r\n    public viewContainerRef: ViewContainerRef,\r\n    private elementRef: ElementRef\r\n  ) {}\r\n\r\n  @HostListener('longpress', ['$event'])\r\n  @HostListener('contextmenu', ['$event'])\r\n  public onContextMenu(e: MouseEvent | TouchEvent): void {\r\n    let x;\r\n    let y;\r\n    if (e instanceof TouchEvent) {\r\n      x = e.touches[0].pageX;\r\n      y = e.touches[0].pageY;\r\n    } else if (e instanceof MouseEvent) {\r\n      x = e.x;\r\n      y = e.y;\r\n    }\r\n    if (!x || !y) {\r\n      return;\r\n    }\r\n\r\n    this.close();\r\n    e.preventDefault();\r\n    this.menuPosition.emit({ x, y });\r\n    this.overlayRef = null;\r\n    const positionStrategy = this.overlay\r\n      .position()\r\n      .flexibleConnectedTo({ x, y })\r\n      .withPositions([\r\n        {\r\n          originX: 'end',\r\n          originY: 'bottom',\r\n          overlayX: 'start',\r\n          overlayY: 'top'\r\n        }\r\n      ]);\r\n    this.overlayRef = this.overlay.create({\r\n      positionStrategy,\r\n      scrollStrategy: this.overlay.scrollStrategies.close()\r\n    });\r\n    this.overlayRef.attach(\r\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\r\n        $implicit: undefined\r\n      })\r\n    );\r\n\r\n    this.sub = fromEvent<MouseEvent>(document, 'click')\r\n      .pipe(\r\n        filter((event) => {\r\n          const clickTarget = event.target as HTMLElement;\r\n          this.close();\r\n          return (\r\n            !!this.overlayRef &&\r\n            !this.overlayRef.overlayElement.contains(clickTarget)\r\n          );\r\n        }),\r\n        take(1)\r\n      )\r\n      .subscribe(() => this.close());\r\n\r\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\r\n      .pipe(\r\n        filter((event) => {\r\n          const clickTarget = event.target as HTMLElement;\r\n          if (\r\n            clickTarget &&\r\n            !this.elementRef.nativeElement.contains(clickTarget) &&\r\n            !this.overlayRef.overlayElement.contains(clickTarget)\r\n          ) {\r\n            return true;\r\n          } else {\r\n            event.preventDefault();\r\n          }\r\n        }),\r\n        take(1)\r\n      )\r\n      .subscribe(() => this.close());\r\n  }\r\n\r\n  close() {\r\n    if (this.overlayRef) {\r\n      this.overlayRef.dispose();\r\n      this.overlayRef = null;\r\n    }\r\n    if (this.sub) {\r\n      this.sub.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Search\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/search\" configFolder=\"environments\">\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\n      F2 activate/deactivate the pointer location.\n    </span>\n    <igo-map-browser\n      #mapBrowser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoOverlay\n      [igoContextMenu]=\"actionbarMenu\"\n      igoLongPress\n      igoSearchPointerSummary\n      [igoSearchPointerSummaryDelay]=\"500\"\n      [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\n      (menuPosition)=\"onContextMenuOpen($event)\"\n    >\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-panel title=\"Search\">\n      <igo-search-bar\n        [term]=\"term\"\n        (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\n        [searchSettings]=\"true\"\n        [store]=\"searchStore\"\n        [termSplitter]=\"termSplitter\"\n        (searchTermChange)=\"onSearchTermChange($event)\"\n        (search)=\"onSearch($event)\"\n        (clearFeature)=\"removeFeatureFromMap()\"\n        (searchSettingsChange)=\"onSearchSettingsChange()\"\n        [reverseSearchCoordsFormatEnabled]=\"igoReverseSearchCoordsFormatEnabled\"\n        (reverseSearchCoordsFormatStatus)=\"\n          onReverseCoordsFormatStatusChange($event)\n        \"\n      >\n      </igo-search-bar>\n\n      <igo-search-results\n        [store]=\"searchStore\"\n        [term]=\"term\"\n        [termSplitter]=\"termSplitter\"\n        placeholder=\"false\"\n        [settingsChange$]=\"settingsChange$\"\n        (resultFocus)=\"onResultFocus($event)\"\n        (resultSelect)=\"onResultFocus($event)\"\n        (moreResults)=\"onSearch($event)\"\n      >\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\n          <igo-search-add-button [map]=\"map\" [layer]=\"result\">\n          </igo-search-add-button>\n        </ng-template>\n      </igo-search-results>\n    </igo-panel>\n\n    <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\n      <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\n    </igo-panel>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"false\"\n        [horizontal]=\"true\"\n        [mode]=\"'context'\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppSearchComponent } from './search.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'search',\r\n    component: AppSearchComponent\r\n  }\r\n];\r\n\r\nexport const AppSearchRoutingModule = RouterModule.forChild(routes);\r\n","import {\r\n  Component,\r\n  ElementRef,\r\n  OnDestroy,\r\n  OnInit,\r\n  ViewChild\r\n} from '@angular/core';\r\n\r\nimport { ActionStore, EntityStore } from '@igo2/common';\r\nimport { LanguageService, MediaService, StorageService } from '@igo2/core';\r\nimport {\r\n  FEATURE,\r\n  Feature,\r\n  FeatureMotion,\r\n  GoogleLinks,\r\n  IgoMap,\r\n  Layer,\r\n  LayerService,\r\n  MapService,\r\n  ProjectionService,\r\n  Research,\r\n  SearchResult\r\n} from '@igo2/geo';\r\nimport { SearchState } from '@igo2/integration';\r\n\r\nimport * as proj from 'ol/proj';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-search',\r\n  templateUrl: './search.component.html',\r\n  styleUrls: ['./search.component.scss']\r\n})\r\nexport class AppSearchComponent implements OnInit, OnDestroy {\r\n  public store = new ActionStore([]);\r\n\r\n  public igoSearchPointerSummaryEnabled: boolean = false;\r\n\r\n  public termSplitter: string = '|';\r\n\r\n  public map = new IgoMap({\r\n    overlay: true,\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  public osmLayer: Layer;\r\n\r\n  @ViewChild('mapBrowser', { read: ElementRef, static: true })\r\n  mapBrowser: ElementRef;\r\n\r\n  public lonlat;\r\n  public mapProjection: string;\r\n  public term: string;\r\n\r\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  get searchStore(): EntityStore<SearchResult> {\r\n    return this.searchState.store;\r\n  }\r\n\r\n  get isTouchScreen(): boolean {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  public selectedFeature: Feature;\r\n  public igoReverseSearchCoordsFormatEnabled: boolean;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private projectionService: ProjectionService,\r\n    private mapService: MapService,\r\n    private layerService: LayerService,\r\n    private searchState: SearchState,\r\n    private mediaService: MediaService,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.mapService.setMap(this.map);\r\n\r\n    this.layerService\r\n      .createAsyncLayer({\r\n        title: 'OSM',\r\n        sourceOptions: {\r\n          type: 'osm'\r\n        }\r\n      })\r\n      .subscribe((layer) => {\r\n        this.osmLayer = layer;\r\n        this.map.addLayer(layer);\r\n      });\r\n\r\n    this.igoReverseSearchCoordsFormatEnabled =\r\n      (this.storageService.get(\r\n        'reverseSearchCoordsFormatEnabled'\r\n      ) as boolean) || false;\r\n  }\r\n\r\n  onPointerSummaryStatusChange(value) {\r\n    this.igoSearchPointerSummaryEnabled = value;\r\n  }\r\n\r\n  onSearchTermChange(term?: string) {\r\n    this.term = term;\r\n    this.searchState.setSearchTerm(term);\r\n    const termWithoutHashtag = term.replace(/(#[^\\s]*)/g, '').trim();\r\n    if (termWithoutHashtag.length < 2) {\r\n      this.searchStore.clear();\r\n      this.selectedFeature = undefined;\r\n    }\r\n  }\r\n\r\n  onSearch(event: { research: Research; results: SearchResult[] }) {\r\n    const results = event.results;\r\n    this.searchStore.state.updateAll({ focused: false, selected: false });\r\n    const newResults = this.searchStore.entities$.value\r\n      .filter((result: SearchResult) => result.source !== event.research.source)\r\n      .concat(results);\r\n    this.searchStore.updateMany(newResults);\r\n  }\r\n\r\n  onReverseCoordsFormatStatusChange(value) {\r\n    this.storageService.set('reverseSearchCoordsFormatEnabled', value);\r\n    this.igoReverseSearchCoordsFormatEnabled = value;\r\n  }\r\n\r\n  onSearchSettingsChange() {\r\n    this.settingsChange$.next(true);\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map when it's being focused\r\n   * @internal\r\n   * @param result A search result that could be a feature\r\n   */\r\n  onResultFocus(result: SearchResult) {\r\n    this.tryAddFeatureToMap(result);\r\n    this.selectedFeature = (result as SearchResult<Feature>).data;\r\n  }\r\n\r\n  /**\r\n   * Try to add a feature to the map overlay\r\n   * @param layer A search result that could be a feature\r\n   */\r\n  private tryAddFeatureToMap(layer: SearchResult) {\r\n    if (layer.meta.dataType !== FEATURE) {\r\n      return undefined;\r\n    }\r\n\r\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\r\n    if (layer.data.geometry === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.map.searchResultsOverlay.setFeatures(\r\n      [layer.data] as Feature[],\r\n      FeatureMotion.Default\r\n    );\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.store.load([\r\n      {\r\n        id: 'coordinates',\r\n        title: 'coordinates',\r\n        handler: () => this.searchCoordinate(this.lonlat)\r\n      },\r\n      {\r\n        id: 'googleMaps',\r\n        title: 'googleMap',\r\n        handler: () => this.openGoogleMaps(this.lonlat)\r\n      },\r\n      {\r\n        id: 'googleStreetView',\r\n        title: 'googleStreetView',\r\n        handler: () => this.openGoogleStreetView(this.lonlat)\r\n      }\r\n    ]);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  /*\r\n   * Remove a feature to the map overlay\r\n   */\r\n  removeFeatureFromMap() {\r\n    this.map.searchResultsOverlay.clear();\r\n  }\r\n\r\n  onContextMenuOpen(event: { x: number; y: number }) {\r\n    const position = this.mapPosition(event);\r\n    const coord = this.mapService.getMap().ol.getCoordinateFromPixel(position);\r\n    this.mapProjection = this.mapService.getMap().projection;\r\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\r\n  }\r\n\r\n  mapPosition(event: { x: number; y: number }) {\r\n    const contextmenuPoint = event;\r\n    contextmenuPoint.y =\r\n      contextmenuPoint.y -\r\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\r\n      window.scrollY;\r\n    contextmenuPoint.x =\r\n      contextmenuPoint.x -\r\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\r\n      window.scrollX;\r\n    const position = [contextmenuPoint.x, contextmenuPoint.y];\r\n    return position;\r\n  }\r\n\r\n  searchCoordinate(lonlat) {\r\n    this.searchStore.clear();\r\n    this.term = !this.igoReverseSearchCoordsFormatEnabled\r\n      ? lonlat.map((c) => c.toFixed(6)).join(', ')\r\n      : lonlat\r\n          .reverse()\r\n          .map((c) => c.toFixed(6))\r\n          .join(', ');\r\n  }\r\n\r\n  openGoogleMaps(lonlat) {\r\n    window.open(GoogleLinks.getGoogleMapsCoordLink(lonlat[0], lonlat[1]));\r\n  }\r\n\r\n  openGoogleStreetView(lonlat) {\r\n    window.open(GoogleLinks.getGoogleStreetViewLink(lonlat[0], lonlat[1]));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport {\r\n  IgoActionbarModule,\r\n  IgoContextMenuModule,\r\n  IgoPanelModule\r\n} from '@igo2/common';\r\nimport { IgoMessageModule } from '@igo2/core';\r\nimport {\r\n  IgoFeatureModule,\r\n  IgoMapModule,\r\n  IgoSearchModule,\r\n  provideCadastreSearchSource,\r\n  provideCoordinatesReverseSearchSource,\r\n  provideIChercheReverseSearchSource,\r\n  provideIChercheSearchSource,\r\n  provideILayerSearchSource,\r\n  provideNominatimSearchSource,\r\n  provideStoredQueriesReverseSearchSource,\r\n  provideStoredQueriesSearchSource,\r\n  provideWorkspaceSearchSource\r\n} from '@igo2/geo';\r\nimport { IgoAppSearchModule } from '@igo2/integration';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppSearchRoutingModule } from './search-routing.module';\r\nimport { AppSearchComponent } from './search.component';\r\n\r\n@NgModule({\r\n  declarations: [AppSearchComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppSearchRoutingModule,\r\n    IgoMessageModule.forRoot(),\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoSearchModule.forRoot(),\r\n    IgoAppSearchModule,\r\n    IgoActionbarModule,\r\n    IgoContextMenuModule,\r\n    IgoFeatureModule\r\n  ],\r\n  exports: [AppSearchComponent],\r\n  providers: [\r\n    provideCoordinatesReverseSearchSource(),\r\n    provideCadastreSearchSource(),\r\n    provideIChercheSearchSource(),\r\n    provideWorkspaceSearchSource(),\r\n    provideILayerSearchSource(),\r\n    provideNominatimSearchSource(),\r\n    provideIChercheReverseSearchSource(),\r\n    provideStoredQueriesSearchSource(),\r\n    provideStoredQueriesReverseSearchSource()\r\n  ]\r\n})\r\nexport class AppSearchModule {}\r\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\n  <pre>{{ infoContent }}</pre>\n</div>\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-info-section',\n  templateUrl: './info-section.component.html',\n  styleUrls: ['./info-section.component.scss']\n})\nexport class InfoSectionComponent {\n  @Input() infoContent: string = '';\n\n  constructor() {}\n}\n","<app-doc-viewer\n  title=\"Simple Map\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/simple-map\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoPointerPosition\n      [pointerPositionDelay]=\"pointerCoordDelay\"\n      (pointerPositionCoord)=\"onPointerMove($event)\"\n    >\n      <igo-info-section [infoContent]=\"pointerCoord\"></igo-info-section>\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n      <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n      <igo-home-extent-button\n        [map]=\"map\"\n        color=\"primary\"\n      ></igo-home-extent-button>\n      <igo-rotation-button\n        [map]=\"map\"\n        [showIfNoRotation]=\"true\"\n        color=\"primary\"\n      ></igo-rotation-button>\n      <igo-wake-lock-button></igo-wake-lock-button>\n    </igo-map-browser>\n    <p *ngIf=\"!isTouchScreen\">{{ pointerCoord }}</p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppSimpleMapComponent } from './simple-map.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'simple-map',\r\n    component: AppSimpleMapComponent\r\n  }\r\n];\r\n\r\nexport const AppSimpleMapRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService, MediaService } from '@igo2/core';\r\nimport { DataSourceService, IgoMap, LayerService } from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-simple-map',\r\n  templateUrl: './simple-map.component.html',\r\n  styleUrls: ['./simple-map.component.scss']\r\n})\r\nexport class AppSimpleMapComponent {\r\n  public pointerCoord;\r\n  public pointerCoordDelay: number = 0;\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      },\r\n      scaleLine: true\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6,\r\n    rotation: 0.75\r\n  };\r\n\r\n  get media() {\r\n    return this.mediaService.getMedia();\r\n  }\r\n\r\n  get isTouchScreen() {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private mediaService: MediaService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  onPointerMove(event) {\r\n    this.pointerCoord = event;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\n\r\nimport { IgoMapModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppSimpleMapRoutingModule } from './simple-map-routing.module';\r\nimport { AppSimpleMapComponent } from './simple-map.component';\r\n\r\n@NgModule({\r\n  declarations: [AppSimpleMapComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppSimpleMapRoutingModule,\r\n    MatCardModule,\r\n    MatButtonModule,\r\n    IgoMapModule\r\n  ],\r\n  exports: [AppSimpleMapComponent]\r\n})\r\nexport class AppSimpleMapModule {}\r\n","<app-doc-viewer\n  title=\"Spatial Filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/spatial-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser\n          [map]=\"map\"\n          [view]=\"view\"\n          igoOverlay\n          igoQuery\n          [queryFeatures]=\"true\"\n        >\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex flex-col align-start h-100 w-100 overflow-y-auto\">\n          <igo-panel class=\"w-100\">\n            <igo-spatial-filter-type\n              [store]=\"spatialListStore\"\n              [selectedQueryType]=\"queryType\"\n              [zone]=\"zone\"\n              [layers]=\"activeLayers\"\n              (eventType)=\"getOutputType($event)\"\n              (eventQueryType)=\"getOutputQueryType($event)\"\n              (zoneChange)=\"onZoneChange($event)\"\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n              (bufferChange)=\"buffer = $event\"\n              (measureUnitChange)=\"measureUnit = $event\"\n            >\n            </igo-spatial-filter-type>\n\n            <igo-spatial-filter-item\n              [type]=\"type\"\n              [queryType]=\"queryType\"\n              [map]=\"map\"\n              [zone]=\"zone\"\n              [loading]=\"loading\"\n              [store]=\"store\"\n              [layers]=\"activeLayers\"\n              [allLayers]=\"layers\"\n              [thematicLength]=\"thematicLength\"\n              (radiusEvent)=\"buffer = $event\"\n              (bufferEvent)=\"buffer = $event\"\n              (measureUnitChange)=\"measureUnit = $event\"\n              (freehandControl)=\"freehandDrawIsActive = $event\"\n              (drawZoneEvent)=\"zone = $event\"\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n              (itemTypeChange)=\"itemType = $event\"\n              (thematicChange)=\"thematics = $event\"\n              (toggleSearch)=\"getOutputToggleSearch()\"\n              (clearButtonEvent)=\"clearMap()\"\n              (clearSearchEvent)=\"getOutputClearSearch()\"\n            >\n            </igo-spatial-filter-item>\n          </igo-panel>\n\n          <igo-panel class=\"w-100\">\n            <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n              <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n            </ng-container>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'spatial-filter',\r\n    component: AppSpatialFilterComponent\r\n  }\r\n];\r\n\r\nexport const AppSpatialFilterRoutingModule = RouterModule.forChild(routes);\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\n\r\nimport { EntityStore, EntityStoreWithStrategy } from '@igo2/common';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport {\r\n  ClusterDataSource,\r\n  DataSource,\r\n  DataSourceService,\r\n  Feature,\r\n  FeatureMotion,\r\n  IgoMap,\r\n  Layer,\r\n  LayerService,\r\n  MeasureLengthUnit,\r\n  QueryableDataSourceOptions,\r\n  SpatialFilterItemType,\r\n  SpatialFilterQueryType,\r\n  SpatialFilterService,\r\n  SpatialFilterThematic,\r\n  SpatialFilterType,\r\n  VectorLayer,\r\n  createOverlayMarkerStyle,\r\n  featureToOl,\r\n  moveToOlFeatures\r\n} from '@igo2/geo';\r\n\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\r\nimport olSourceCluster from 'ol/source/Cluster';\r\nimport olSourceVector from 'ol/source/Vector';\r\nimport * as olstyle from 'ol/style';\r\n\r\nimport { Observable, Subject, forkJoin } from 'rxjs';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { take, takeUntil, tap } from 'rxjs/operators';\r\n\r\n/**\r\n * Spatial Filter Type\r\n */\r\n@Component({\r\n  selector: 'app-spatial-filter',\r\n  templateUrl: './spatial-filter.component.html',\r\n  styleUrls: ['./spatial-filter.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppSpatialFilterComponent implements OnInit, OnDestroy {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 6\r\n  };\r\n\r\n  @Input() type: SpatialFilterType;\r\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\r\n  @Input() freehandDrawIsActive: boolean;\r\n\r\n  public layers: Layer[] = [];\r\n  public activeLayers: Layer[] = [];\r\n\r\n  public queryType: SpatialFilterQueryType;\r\n  public thematics: SpatialFilterThematic[];\r\n  public zone: Feature;\r\n  public zoneWithBuffer: Feature;\r\n  public buffer = 0;\r\n\r\n  public iterator = 1;\r\n\r\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  public store = new EntityStoreWithStrategy<Feature>([]); // Store to print results at the end\r\n\r\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\r\n\r\n  public loading = false;\r\n\r\n  public thematicLength = 0;\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n  private unsubscribe$ = new Subject<void>();\r\n\r\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\r\n\r\n  constructor(\r\n    private matIconRegistry: MatIconRegistry,\r\n    private spatialFilterService: SpatialFilterService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  ngOnInit() {\r\n    for (const layer of this.map.layers) {\r\n      if (\r\n        layer.title &&\r\n        layer.title.includes(\r\n          this.languageService.translate.instant(\r\n            'igo.geo.spatialFilter.spatialFilter'\r\n          )\r\n        )\r\n      ) {\r\n        this.layers.push(layer);\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsubscribe$.next();\r\n    this.unsubscribe$.complete();\r\n  }\r\n\r\n  getOutputType(event: SpatialFilterType) {\r\n    this.type = event;\r\n    this.queryType = undefined;\r\n  }\r\n\r\n  getOutputQueryType(event: SpatialFilterQueryType) {\r\n    this.queryType = event;\r\n    if (this.queryType) {\r\n      this.loadFilterList();\r\n    }\r\n  }\r\n\r\n  private loadFilterList() {\r\n    this.spatialFilterService\r\n      .loadFilterList(this.queryType)\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe((features: Feature[]) => {\r\n        features.sort((a, b) => {\r\n          if (a.properties.nom < b.properties.nom) {\r\n            return -1;\r\n          }\r\n          if (a.properties.nom > b.properties.nom) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n        this.spatialListStore.clear();\r\n        this.spatialListStore.load(features);\r\n      });\r\n  }\r\n\r\n  getOutputToggleSearch() {\r\n    this.loadThematics();\r\n  }\r\n\r\n  getOutputClearSearch() {\r\n    this.zone = undefined;\r\n    this.queryType = undefined;\r\n  }\r\n\r\n  clearMap() {\r\n    this.map.removeLayers(this.layers);\r\n    this.layers = [];\r\n    this.activeLayers = [];\r\n    this.thematicLength = 0;\r\n    this.iterator = 1;\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      this.zone = undefined;\r\n      this.queryType = undefined;\r\n    }\r\n  }\r\n\r\n  private loadThematics() {\r\n    this.loading = true;\r\n    let zeroResults = true;\r\n    let thematics;\r\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\r\n      this.tryAddFeaturesToMap([this.zone]);\r\n    }\r\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\r\n      const theme: SpatialFilterThematic = {\r\n        name: ''\r\n      };\r\n      thematics = [theme];\r\n    } else {\r\n      thematics = this.thematics;\r\n    }\r\n    if (\r\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\r\n      this.type !== SpatialFilterType.Point\r\n    ) {\r\n      this.buffer = this.buffer * 1000;\r\n    }\r\n    if (this.type === SpatialFilterType.Polygon) {\r\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\r\n    }\r\n\r\n    const observables$: Observable<Feature[]>[] = [];\r\n    thematics.forEach((thematic) => {\r\n      observables$.push(\r\n        this.spatialFilterService\r\n          .loadFilterItem(\r\n            this.zone,\r\n            this.itemType,\r\n            this.queryType,\r\n            thematic,\r\n            this.buffer\r\n          )\r\n          .pipe(\r\n            tap((features: Feature[]) => {\r\n              this.store.insertMany(features);\r\n              const featuresPoint: Feature[] = [];\r\n              const featuresLinePoly: Feature[] = [];\r\n              let idPoint;\r\n              let idLinePoly;\r\n              features.forEach((feature) => {\r\n                if (feature.geometry.type === 'Point') {\r\n                  feature.properties.longitude =\r\n                    feature.geometry.coordinates[0];\r\n                  feature.properties.latitude = feature.geometry.coordinates[1];\r\n                  featuresPoint.push(feature);\r\n                  idPoint = feature.meta.id;\r\n                } else {\r\n                  featuresLinePoly.push(feature);\r\n                  idLinePoly = feature.meta.id;\r\n                }\r\n              });\r\n\r\n              this.tryAddPointToMap(featuresPoint, idPoint);\r\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\r\n              if (features.length) {\r\n                zeroResults = false;\r\n                this.thematicLength += 1;\r\n                thematic.zeroResults = false;\r\n                this.cdRef.detectChanges();\r\n              } else {\r\n                thematic.zeroResults = true;\r\n              }\r\n\r\n              if (features.length >= 10000) {\r\n                this.messageService.alert(\r\n                  'igo.geo.spatialFilter.maxSizeAlert',\r\n                  'igo.geo.spatialFilter.warning',\r\n                  { timeOut: 10000 }\r\n                );\r\n              }\r\n            })\r\n          )\r\n      );\r\n    });\r\n\r\n    forkJoin(observables$)\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe(() => {\r\n        this.loading = false;\r\n        if (zeroResults) {\r\n          this.messageService.alert(\r\n            'igo.geo.spatialFilter.zeroResults',\r\n            'igo.geo.spatialFilter.warning',\r\n            { timeOut: 10000 }\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  onZoneChange(feature: Feature, buffer?: boolean) {\r\n    this.zone = feature;\r\n    if (feature) {\r\n      buffer\r\n        ? this.tryAddFeaturesToMap([feature], true)\r\n        : this.tryAddFeaturesToMap([feature]);\r\n      this.zoomToFeatureExtent(feature);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add zone feature to the map overlay\r\n   */\r\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\r\n    let i = 1;\r\n    for (const feature of features) {\r\n      if (this.type === SpatialFilterType.Predefined) {\r\n        for (const layer of this.layers) {\r\n          if (\r\n            layer.options._internal &&\r\n            layer.options._internal.code === feature.properties.code &&\r\n            !buffer\r\n          ) {\r\n            if (!layer.title?.startsWith('Zone')) {\r\n              const index = this.layers.indexOf(layer);\r\n              this.layers.splice(index, 1);\r\n            }\r\n            return;\r\n          }\r\n          if (layer.title?.startsWith('Zone')) {\r\n            this.activeLayers = [];\r\n            const index = this.layers.indexOf(layer);\r\n            this.layers.splice(index, 1);\r\n            this.map.removeLayer(layer);\r\n          }\r\n        }\r\n      } else {\r\n        if (buffer) {\r\n          for (const layer of this.activeLayers) {\r\n            if (\r\n              this.activeLayers.length === 1 &&\r\n              layer.title?.startsWith('Zone')\r\n            ) {\r\n              const index = this.layers.indexOf(layer);\r\n              this.layers.splice(index, 1);\r\n              this.map.removeLayer(layer);\r\n            }\r\n          }\r\n        }\r\n        this.activeLayers = [];\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith('Zone')) {\r\n          i++;\r\n        }\r\n      }\r\n      this.defaultStyle = (_feature, resolution) => {\r\n        const coordinates = (features[0] as any).coordinates;\r\n        return new olstyle.Style({\r\n          image: new olstyle.Circle({\r\n            radius: coordinates\r\n              ? this.buffer /\r\n                Math.cos((Math.PI / 180) * coordinates[1]) /\r\n                resolution\r\n              : undefined,\r\n            fill: new olstyle.Fill({\r\n              color: 'rgba(200, 200, 20, 0.2)'\r\n            }),\r\n            stroke: new olstyle.Stroke({\r\n              width: 1,\r\n              color: 'orange'\r\n            })\r\n          }),\r\n          stroke: new olstyle.Stroke({\r\n            width: 1,\r\n            color: 'orange'\r\n          }),\r\n          fill: new olstyle.Fill({\r\n            color: 'rgba(200, 200, 20, 0.2)'\r\n          })\r\n        });\r\n      };\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: ('Zone ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            workspace: { enabled: true },\r\n            _internal: {\r\n              code:\r\n                this.type === SpatialFilterType.Predefined\r\n                  ? feature.properties.code\r\n                  : undefined\r\n            },\r\n            source: dataSource,\r\n            visible: true\r\n          }) as VectorLayer;\r\n          const featuresOl = features.map((f) => {\r\n            return featureToOl(f, this.map.projection);\r\n          });\r\n          if (this.type !== SpatialFilterType.Predefined) {\r\n            const type =\r\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\r\n            featuresOl[0].set('nom', 'Zone', true);\r\n            featuresOl[0].set('type', type, true);\r\n          }\r\n          const ol = dataSource.ol as\r\n            | olSourceVector<OlGeometry>\r\n            | olSourceCluster;\r\n          ol.addFeatures(featuresOl);\r\n          olLayer.ol.setStyle(this.defaultStyle);\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.activeLayers.push(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Try to add point features to the map\r\n   * Necessary to create clusters\r\n   */\r\n  private tryAddPointToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'cluster',\r\n          id,\r\n          queryable: true,\r\n          distance: 120,\r\n          meta: {\r\n            title: 'Cluster'\r\n          }\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: ClusterDataSource) => {\r\n          const icon = features[0].meta.icon;\r\n          let style: olstyle.Style;\r\n          if (!icon) {\r\n            style = createOverlayMarkerStyle();\r\n          } else {\r\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\r\n          }\r\n\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            source: dataSource,\r\n            visible: true,\r\n            style\r\n          });\r\n\r\n          const featuresOl = features.map((feature) => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceCluster;\r\n          ol.getSource().addFeatures(featuresOl);\r\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.layers.find((layer) => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.iterator = i;\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.pushLayer(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  private createSvgIcon(icon): olstyle.Style {\r\n    let style: olstyle.Style;\r\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe((svgObj) => {\r\n      const xmlSerializer = new XMLSerializer();\r\n      svgObj.setAttribute('width', '30');\r\n      svgObj.setAttribute('height', '30');\r\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\r\n      svgObj.setAttribute('stroke', 'white');\r\n      const svg = xmlSerializer.serializeToString(svgObj);\r\n      style = new olstyle.Style({\r\n        image: new olstyle.Icon({\r\n          src: 'data:image/svg+xml;utf8,' + svg\r\n        })\r\n      });\r\n    });\r\n    return style;\r\n  }\r\n  /**\r\n   * Try to add line or polygon features to the map\r\n   */\r\n  private tryAddLayerToMap(features: Feature[], id) {\r\n    let i = 1;\r\n    if (features.length) {\r\n      if (this.map === undefined) {\r\n        return;\r\n      }\r\n      for (const layer of this.layers) {\r\n        if (layer.title?.startsWith(features[0].meta.title)) {\r\n          i++;\r\n        }\r\n      }\r\n      this.dataSourceService\r\n        .createAsyncDataSource({\r\n          type: 'vector',\r\n          id,\r\n          queryable: true\r\n        } as QueryableDataSourceOptions)\r\n        .pipe(take(1))\r\n        .subscribe((dataSource: DataSource) => {\r\n          const olLayer = this.layerService.createLayer({\r\n            isIgoInternalLayer: true,\r\n            title: (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string,\r\n            source: dataSource,\r\n            visible: true\r\n          });\r\n          const featuresOl = features.map((feature) => {\r\n            return featureToOl(feature, this.map.projection);\r\n          });\r\n          const ol = dataSource.ol as olSourceVector<OlGeometry>;\r\n          ol.addFeatures(featuresOl);\r\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\r\n            this.map.removeLayer(\r\n              this.layers.find((layer) => layer.id === olLayer.id)\r\n            );\r\n            i = i - 1;\r\n            olLayer.title = (features[0].meta.title +\r\n              ' ' +\r\n              i +\r\n              ' - ' +\r\n              this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.spatialFilter'\r\n              )) as string;\r\n            olLayer.options.title = olLayer.title;\r\n          }\r\n          this.map.addLayer(olLayer);\r\n          this.layers.push(olLayer);\r\n          this.pushLayer(olLayer);\r\n          this.cdRef.detectChanges();\r\n        });\r\n    }\r\n  }\r\n\r\n  zoomToFeatureExtent(feature) {\r\n    if (feature) {\r\n      const olFeature = this.format.readFeature(feature, {\r\n        dataProjection: feature.projection,\r\n        featureProjection: this.map.projection\r\n      });\r\n      moveToOlFeatures(\r\n        this.map.viewController,\r\n        [olFeature],\r\n        FeatureMotion.Zoom\r\n      );\r\n    }\r\n  }\r\n\r\n  pushLayer(layer) {\r\n    for (const lay of this.activeLayers) {\r\n      if (lay.id === layer.id) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.activeLayers.push(layer);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoFormModule, IgoPanelModule } from '@igo2/common';\r\nimport { IgoMessageModule } from '@igo2/core';\r\nimport {\r\n  IgoFeatureDetailsModule,\r\n  IgoFeatureModule,\r\n  IgoFilterModule,\r\n  IgoMapModule,\r\n  IgoQueryModule\r\n} from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppSpatialFilterRoutingModule } from './spatial-filter-routing.module';\r\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\r\n\r\n@NgModule({\r\n  declarations: [AppSpatialFilterComponent],\r\n  imports: [\r\n    AppSpatialFilterRoutingModule,\r\n    SharedModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoMessageModule,\r\n    IgoQueryModule,\r\n    IgoFeatureModule,\r\n    IgoFeatureDetailsModule,\r\n    IgoFilterModule,\r\n    IgoFormModule\r\n  ],\r\n  exports: [AppSpatialFilterComponent]\r\n})\r\nexport class AppSpatialFilterModule {}\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppTimeFilterComponent } from './time-filter.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'time-filter',\r\n    component: AppTimeFilterComponent\r\n  }\r\n];\r\n\r\nexport const AppTimeFilterRoutingModule = RouterModule.forChild(routes);\r\n","import { Component } from '@angular/core';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  DataSourceService,\r\n  IgoMap,\r\n  LayerService,\r\n  TimeFilterStyle,\r\n  TimeFilterType,\r\n  TimeFilterableDataSourceOptions\r\n} from '@igo2/geo';\r\n\r\n@Component({\r\n  selector: 'app-time-filter',\r\n  templateUrl: './time-filter.component.html',\r\n  styleUrls: ['./time-filter.component.scss']\r\n})\r\nexport class AppTimeFilterComponent {\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-73, 47.2],\r\n    zoom: 7\r\n  };\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService\r\n  ) {\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    // const datasource: TimeFilterableDataSourceOptions = {\r\n    //   type: 'wms',\r\n    //   url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\r\n    //   params: {\r\n    //     layers: 'vg_observation_v_inondation_embacle_wmst',\r\n    //     version: '1.3.0'\r\n    //   },\r\n    //   timeFilterable: true,\r\n    //   timeFilter: {\r\n    //     min: '2017-01-01',\r\n    //     max: '2018-01-01',\r\n    //     range: true,\r\n    //     type: TimeFilterType.DATETIME,\r\n    //     style: TimeFilterStyle.SLIDER,\r\n    //     step: 86400000,\r\n    //     timeInterval: 2000\r\n    //   }\r\n    // };\r\n\r\n    const datasourceYear: TimeFilterableDataSourceOptions = {\r\n      type: 'wms',\r\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\r\n      params: {\r\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\r\n        VERSION: '1.3.0'\r\n      },\r\n      timeFilterable: true,\r\n      timeFilter: {\r\n        min: '2013',\r\n        max: '2019',\r\n        range: false,\r\n        type: TimeFilterType.YEAR,\r\n        style: TimeFilterStyle.SLIDER,\r\n        step: 1,\r\n        timeInterval: 2000\r\n      }\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(datasourceYear)\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'Embcle YEAR',\r\n            visible: true,\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n  }\r\n}\r\n","<app-doc-viewer\n  title=\"Time filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/time-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoPanelModule } from '@igo2/common';\r\nimport { IgoFilterModule, IgoMapModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppTimeFilterRoutingModule } from './time-filter-routing.module';\r\nimport { AppTimeFilterComponent } from './time-filter.component';\r\n\r\n@NgModule({\r\n  declarations: [AppTimeFilterComponent],\r\n  imports: [\r\n    AppTimeFilterRoutingModule,\r\n    SharedModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoFilterModule\r\n  ],\r\n  exports: [AppTimeFilterComponent]\r\n})\r\nexport class AppTimeFilterModule {}\r\n","<app-doc-viewer title=\"Workspace\" subtitle=\"Geo\">\r\n  <app-example-viewer codeFolder=\"geo/workspace\">\r\n    <igo-map-browser [map]=\"map\" [view]=\"view\" class=\"m-b-16\">\r\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\r\n    </igo-map-browser>\r\n\r\n    <igo-workspace-selector\r\n      igoWorkspaceSelector\r\n      [store]=\"workspaceStore\"\r\n      [map]=\"map\"\r\n    >\r\n    </igo-workspace-selector>\r\n\r\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\r\n      <igo-entity-table-paginator\r\n        *ngIf=\"workspace.inResolutionRange$ | async\"\r\n        [store]=\"workspace.entityStore\"\r\n        [paginatorOptions]=\"paginatorOptions\"\r\n        [entitySortChange$]=\"entitySortChange$\"\r\n        (paginatorChange)=\"paginatorChange($event)\"\r\n      >\r\n      </igo-entity-table-paginator>\r\n    </ng-container>\r\n\r\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\r\n      <igo-actionbar\r\n        *ngIf=\"workspace.actionStore\"\r\n        [store]=\"workspace.actionStore\"\r\n        [horizontal]=\"true\"\r\n        [withToggleButton]=\"true\"\r\n        [withTitle]=\"true\"\r\n        [mode]=\"actionbarMode\"\r\n      >\r\n      </igo-actionbar>\r\n\r\n      <igo-entity-table\r\n        *ngIf=\"\r\n          workspace.entityStore &&\r\n          workspace.meta &&\r\n          workspace.meta.tableTemplate &&\r\n          (workspace.inResolutionRange$ | async)\r\n        \"\r\n        class=\"table-compact table-centered\"\r\n        [paginator]=\"workspacePaginator\"\r\n        [scrollBehavior]=\"scrollBehavior\"\r\n        [store]=\"workspace.entityStore\"\r\n        [template]=\"workspace.meta.tableTemplate\"\r\n      >\r\n      </igo-entity-table>\r\n      <mat-card-content\r\n        *ngIf=\"(workspace.inResolutionRange$ | async) === false\"\r\n      >\r\n        No data available at this scale. Please zoom in.\r\n      </mat-card-content>\r\n\r\n      <igo-workspace-widget-outlet\r\n        [workspace]=\"workspace\"\r\n      ></igo-workspace-widget-outlet>\r\n    </ng-container>\r\n  </app-example-viewer>\r\n</app-doc-viewer>\r\n","import { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { AppWorkspaceComponent } from './workspace.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'workspace',\r\n    component: AppWorkspaceComponent\r\n  }\r\n];\r\n\r\nexport const AppWorkspaceRoutingModule = RouterModule.forChild(routes);\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\n\r\nimport {\r\n  ActionbarMode,\r\n  EntityRecord,\r\n  EntityTablePaginatorOptions,\r\n  EntityTableScrollBehavior,\r\n  Workspace,\r\n  WorkspaceStore\r\n} from '@igo2/common';\r\nimport { LanguageService } from '@igo2/core';\r\nimport {\r\n  DataSourceService,\r\n  IgoMap,\r\n  LayerService,\r\n  WFSDataSourceOptions\r\n} from '@igo2/geo';\r\nimport { WorkspaceState } from '@igo2/integration';\r\n\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'app-workspace',\r\n  templateUrl: './workspace.component.html',\r\n  styleUrls: ['./workspace.component.scss']\r\n})\r\nexport class AppWorkspaceComponent implements OnInit {\r\n  public workspacePaginator: MatPaginator;\r\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public paginatorOptions: EntityTablePaginatorOptions = {\r\n    pageSize: 5, // Number of items to display on a page.\r\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\r\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\r\n  };\r\n\r\n  public map = new IgoMap({\r\n    controls: {\r\n      attribution: {\r\n        collapsed: true\r\n      }\r\n    }\r\n  });\r\n\r\n  public view = {\r\n    center: [-72, 47.2],\r\n    zoom: 5\r\n  };\r\n\r\n  get workspaceStore(): WorkspaceStore {\r\n    return this.workspaceState.store;\r\n  }\r\n\r\n  public selectedWorkspace$: Observable<Workspace>;\r\n\r\n  public actionbarMode = ActionbarMode.Overlay;\r\n\r\n  public scrollBehavior = EntityTableScrollBehavior.Instant;\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dataSourceService: DataSourceService,\r\n    private layerService: LayerService,\r\n    public workspaceState: WorkspaceState\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.selectedWorkspace$ = this.workspaceStore.stateView\r\n      .firstBy$(\r\n        (record: EntityRecord<Workspace>) => record.state.selected === true\r\n      )\r\n      .pipe(\r\n        map((record: EntityRecord<Workspace>) => {\r\n          const entity = record === undefined ? undefined : record.entity;\r\n          if (entity) {\r\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\r\n            // The reason why it's has been remove is that this button trigger a tool (importExport)\r\n            // and this tool is not available in the igo2-lib demo.\r\n            // This is why it's has been removed frome the actions's list.\r\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\r\n            entity.actionStore.view.filter((action) => {\r\n              return action.id !== 'wfsDownload';\r\n            });\r\n          }\r\n          return entity;\r\n        })\r\n      );\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource({\r\n        type: 'osm'\r\n      })\r\n      .subscribe((dataSource) => {\r\n        this.map.addLayer(\r\n          this.layerService.createLayer({\r\n            title: 'OSM',\r\n            source: dataSource\r\n          })\r\n        );\r\n      });\r\n\r\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\r\n      type: 'wfs',\r\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\r\n      params: {\r\n        featureTypes: 'etablissement_mtq',\r\n        fieldNameGeometry: 'geometry',\r\n        version: '2.0.0',\r\n        outputFormat: 'geojson'\r\n      },\r\n      sourceFields: [\r\n        { name: 'idetablis', alias: 'ID' },\r\n        { name: 'nometablis', alias: 'Name' },\r\n        { name: 'typetablis', alias: 'Type' }\r\n      ]\r\n    };\r\n\r\n    this.dataSourceService\r\n      .createAsyncDataSource(wfsDataSourceOptions)\r\n      .subscribe((dataSource) => {\r\n        const layer = {\r\n          title: 'Simple WFS ',\r\n          maxResolution: 3000,\r\n          visible: true,\r\n          source: dataSource\r\n        };\r\n        this.map.addLayer(this.layerService.createLayer(layer));\r\n      });\r\n  }\r\n\r\n  paginatorChange(event: MatPaginator) {\r\n    this.workspacePaginator = event;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport {\r\n  IgoActionModule,\r\n  IgoEntityModule,\r\n  IgoPanelModule,\r\n  IgoWorkspaceModule\r\n} from '@igo2/common';\r\nimport { IgoGeoWorkspaceModule, IgoMapModule } from '@igo2/geo';\r\n\r\nimport { SharedModule } from '../../shared/shared.module';\r\nimport { AppWorkspaceRoutingModule } from './workspace-routing.module';\r\nimport { AppWorkspaceComponent } from './workspace.component';\r\n\r\n@NgModule({\r\n  declarations: [AppWorkspaceComponent],\r\n  imports: [\r\n    SharedModule,\r\n    AppWorkspaceRoutingModule,\r\n    IgoActionModule,\r\n    IgoEntityModule,\r\n    IgoWorkspaceModule,\r\n    IgoPanelModule,\r\n    IgoMapModule,\r\n    IgoGeoWorkspaceModule\r\n  ],\r\n  exports: [AppWorkspaceComponent]\r\n})\r\nexport class AppWorkspaceModule {}\r\n","import { DatePipe } from '@angular/common';\r\nimport {\r\n  APP_INITIALIZER,\r\n  ApplicationRef,\r\n  Injector,\r\n  NgModule\r\n} from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MAT_FORM_FIELD_DEFAULT_OPTIONS } from '@angular/material/form-field';\r\nimport { MatIconModule, MatIconRegistry } from '@angular/material/icon';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSidenavModule } from '@angular/material/sidenav';\r\nimport { MatToolbarModule } from '@angular/material/toolbar';\r\nimport {\r\n  MAT_TOOLTIP_DEFAULT_OPTIONS,\r\n  MatTooltipDefaultOptions\r\n} from '@angular/material/tooltip';\r\nimport { BrowserModule, DomSanitizer } from '@angular/platform-browser';\r\nimport { HammerModule } from '@angular/platform-browser';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\n\r\nimport { IgoCoreModule, LanguageService } from '@igo2/core';\r\n\r\nimport { concatMap, first } from 'rxjs';\r\n\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { AppComponent } from './app.component';\r\nimport { AppAuthFormModule } from './auth/auth-form/auth-form.module';\r\nimport { AppActionModule } from './common/action/action.module';\r\nimport { AppDynamicComponentModule } from './common/dynamic-component/dynamic-component.module';\r\nimport { AppEntitySelectorModule } from './common/entity-selector/entity-selector.module';\r\nimport { AppEntityTableModule } from './common/entity-table/entity-table.module';\r\nimport { AppFormModule } from './common/form/form.module';\r\nimport { AppTableModule } from './common/table/table.module';\r\nimport { AppToolModule } from './common/tool/tool.module';\r\nimport { AppWidgetModule } from './common/widget/widget.module';\r\nimport { AppContextModule } from './context/context/context.module';\r\nimport { AppActivityModule } from './core/activity/activity.module';\r\nimport { AppConfigModule } from './core/config/config.module';\r\nimport { AppHomeModule } from './core/home/home.module';\r\nimport { AppLanguageModule } from './core/language/language.module';\r\nimport { AppMediaModule } from './core/media/media.module';\r\nimport { AppMessageModule } from './core/message/message.module';\r\nimport { AppRequestModule } from './core/request/request.module';\r\nimport { AppCatalogModule } from './geo/catalog/catalog.module';\r\nimport { AppDirectionsModule } from './geo/directions/directions.module';\r\nimport { AppDrawModule } from './geo/draw/draw.module';\r\nimport { AppFeatureModule } from './geo/feature/feature.module';\r\nimport { AppGeometryModule } from './geo/geometry/geometry.module';\r\nimport { AppHoverModule } from './geo/hover/hover.module';\r\nimport { AppImportExport } from './geo/import-export/import-export.module';\r\nimport { AppLayerModule } from './geo/layer/layer.module';\r\nimport { AppLegendModule } from './geo/legend/legend.module';\r\nimport { AppMeasureModule } from './geo/measure/measure.module';\r\nimport { AppOgcFilterModule } from './geo/ogc-filter/ogc-filter.module';\r\nimport { AppOverlayModule } from './geo/overlay/overlay.module';\r\nimport { AppPrintModule } from './geo/print/print.module';\r\nimport { AppQueryModule } from './geo/query/query.module';\r\nimport { AppSearchModule } from './geo/search/search.module';\r\nimport { AppSimpleMapModule } from './geo/simple-map/simple-map.module';\r\nimport { AppSpatialFilterModule } from './geo/spatial-filter/spatial-filter.module';\r\nimport { AppTimeFilterModule } from './geo/time-filter/time-filter.module';\r\nimport { AppWorkspaceModule } from './geo/workspace/workspace.module';\r\n\r\nexport const defaultTooltipOptions: MatTooltipDefaultOptions = {\r\n  showDelay: 500,\r\n  hideDelay: 0,\r\n  touchendHideDelay: 0,\r\n  disableTooltipInteractivity: true\r\n};\r\n\r\n@NgModule({\r\n  declarations: [AppComponent],\r\n  imports: [\r\n    IgoCoreModule,\r\n    BrowserModule,\r\n    BrowserAnimationsModule,\r\n    MatSidenavModule,\r\n    MatToolbarModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n\r\n    AppHomeModule,\r\n    AppActivityModule,\r\n    AppConfigModule,\r\n    AppLanguageModule,\r\n    AppMediaModule,\r\n    AppMessageModule,\r\n    AppRequestModule,\r\n\r\n    AppActionModule,\r\n    AppDynamicComponentModule,\r\n    AppEntityTableModule,\r\n    AppEntitySelectorModule,\r\n    AppFormModule,\r\n    AppTableModule,\r\n    AppToolModule,\r\n    AppWidgetModule,\r\n\r\n    AppAuthFormModule,\r\n\r\n    AppSimpleMapModule,\r\n    AppLayerModule,\r\n    AppLegendModule,\r\n    AppOverlayModule,\r\n    AppGeometryModule,\r\n    AppFeatureModule,\r\n    AppHoverModule,\r\n    AppMeasureModule,\r\n    AppDrawModule,\r\n    AppQueryModule,\r\n    AppCatalogModule,\r\n    AppSearchModule,\r\n    AppPrintModule,\r\n    AppImportExport,\r\n    AppDirectionsModule,\r\n    AppTimeFilterModule,\r\n    AppOgcFilterModule,\r\n    AppSpatialFilterModule,\r\n    AppWorkspaceModule,\r\n\r\n    AppContextModule,\r\n    AppRoutingModule,\r\n\r\n    HammerModule\r\n  ],\r\n  providers: [\r\n    {\r\n      provide: MAT_FORM_FIELD_DEFAULT_OPTIONS,\r\n      useValue: { appearance: 'outline' }\r\n    },\r\n    {\r\n      provide: APP_INITIALIZER,\r\n      useFactory: appInitializerFactory,\r\n      deps: [Injector, ApplicationRef],\r\n      multi: true\r\n    },\r\n    { provide: MAT_TOOLTIP_DEFAULT_OPTIONS, useValue: defaultTooltipOptions },\r\n    DatePipe\r\n  ],\r\n  bootstrap: [AppComponent]\r\n})\r\nexport class AppModule {\r\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\r\n    matIconRegistry.addSvgIconSet(\r\n      domSanitizer.bypassSecurityTrustResourceUrl(\r\n        './assets/igo2/core/icons/mdi.svg'\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\nexport function appInitializerFactory(\r\n  injector: Injector,\r\n  applicationRef: ApplicationRef\r\n) {\r\n  return () =>\r\n    new Promise<any>((resolve: any) => {\r\n      applicationRef.isStable\r\n        .pipe(\r\n          first((isStable) => isStable === true),\r\n          concatMap(() => {\r\n            const languageService = injector.get(LanguageService);\r\n            const lang = languageService.getLanguage();\r\n            return languageService.translate.getTranslation(lang);\r\n          })\r\n        )\r\n        .subscribe((translations) => {\r\n          const languageService = injector.get(LanguageService);\r\n          const lang = languageService.getLanguage();\r\n          languageService.translate.setTranslation(lang, translations);\r\n          resolve();\r\n        });\r\n    });\r\n}\r\n","import { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport 'hammerjs';\r\n\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nplatformBrowserDynamic()\r\n  .bootstrapModule(AppModule)\r\n  .catch((err) => console.log(err));\r\n","var map = {\n\t\"./af\": 35528,\n\t\"./af.js\": 35528,\n\t\"./ar\": 1036,\n\t\"./ar-dz\": 17579,\n\t\"./ar-dz.js\": 17579,\n\t\"./ar-kw\": 69588,\n\t\"./ar-kw.js\": 69588,\n\t\"./ar-ly\": 11650,\n\t\"./ar-ly.js\": 11650,\n\t\"./ar-ma\": 93258,\n\t\"./ar-ma.js\": 93258,\n\t\"./ar-sa\": 54085,\n\t\"./ar-sa.js\": 54085,\n\t\"./ar-tn\": 90287,\n\t\"./ar-tn.js\": 90287,\n\t\"./ar.js\": 1036,\n\t\"./az\": 89757,\n\t\"./az.js\": 89757,\n\t\"./be\": 59620,\n\t\"./be.js\": 59620,\n\t\"./bg\": 31139,\n\t\"./bg.js\": 31139,\n\t\"./bm\": 4042,\n\t\"./bm.js\": 4042,\n\t\"./bn\": 19641,\n\t\"./bn-bd\": 19126,\n\t\"./bn-bd.js\": 19126,\n\t\"./bn.js\": 19641,\n\t\"./bo\": 494,\n\t\"./bo.js\": 494,\n\t\"./br\": 20934,\n\t\"./br.js\": 20934,\n\t\"./bs\": 26274,\n\t\"./bs.js\": 26274,\n\t\"./ca\": 45831,\n\t\"./ca.js\": 45831,\n\t\"./cs\": 92354,\n\t\"./cs.js\": 92354,\n\t\"./cv\": 79692,\n\t\"./cv.js\": 79692,\n\t\"./cy\": 58774,\n\t\"./cy.js\": 58774,\n\t\"./da\": 38955,\n\t\"./da.js\": 38955,\n\t\"./de\": 21557,\n\t\"./de-at\": 24954,\n\t\"./de-at.js\": 24954,\n\t\"./de-ch\": 81881,\n\t\"./de-ch.js\": 81881,\n\t\"./de.js\": 21557,\n\t\"./dv\": 16475,\n\t\"./dv.js\": 16475,\n\t\"./el\": 38877,\n\t\"./el.js\": 38877,\n\t\"./en-au\": 70454,\n\t\"./en-au.js\": 70454,\n\t\"./en-ca\": 67356,\n\t\"./en-ca.js\": 67356,\n\t\"./en-gb\": 10456,\n\t\"./en-gb.js\": 10456,\n\t\"./en-ie\": 28789,\n\t\"./en-ie.js\": 28789,\n\t\"./en-il\": 85471,\n\t\"./en-il.js\": 85471,\n\t\"./en-in\": 39664,\n\t\"./en-in.js\": 39664,\n\t\"./en-nz\": 97672,\n\t\"./en-nz.js\": 97672,\n\t\"./en-sg\": 80805,\n\t\"./en-sg.js\": 80805,\n\t\"./eo\": 87390,\n\t\"./eo.js\": 87390,\n\t\"./es\": 1564,\n\t\"./es-do\": 51473,\n\t\"./es-do.js\": 51473,\n\t\"./es-mx\": 92089,\n\t\"./es-mx.js\": 92089,\n\t\"./es-us\": 84156,\n\t\"./es-us.js\": 84156,\n\t\"./es.js\": 1564,\n\t\"./et\": 6513,\n\t\"./et.js\": 6513,\n\t\"./eu\": 7856,\n\t\"./eu.js\": 7856,\n\t\"./fa\": 2378,\n\t\"./fa.js\": 2378,\n\t\"./fi\": 22687,\n\t\"./fi.js\": 22687,\n\t\"./fil\": 80032,\n\t\"./fil.js\": 80032,\n\t\"./fo\": 46845,\n\t\"./fo.js\": 46845,\n\t\"./fr\": 8875,\n\t\"./fr-ca\": 56425,\n\t\"./fr-ca.js\": 56425,\n\t\"./fr-ch\": 41746,\n\t\"./fr-ch.js\": 41746,\n\t\"./fr.js\": 8875,\n\t\"./fy\": 67037,\n\t\"./fy.js\": 67037,\n\t\"./ga\": 11217,\n\t\"./ga.js\": 11217,\n\t\"./gd\": 37010,\n\t\"./gd.js\": 37010,\n\t\"./gl\": 51931,\n\t\"./gl.js\": 51931,\n\t\"./gom-deva\": 64488,\n\t\"./gom-deva.js\": 64488,\n\t\"./gom-latn\": 8032,\n\t\"./gom-latn.js\": 8032,\n\t\"./gu\": 34984,\n\t\"./gu.js\": 34984,\n\t\"./he\": 69090,\n\t\"./he.js\": 69090,\n\t\"./hi\": 42085,\n\t\"./hi.js\": 42085,\n\t\"./hr\": 38787,\n\t\"./hr.js\": 38787,\n\t\"./hu\": 2901,\n\t\"./hu.js\": 2901,\n\t\"./hy-am\": 59819,\n\t\"./hy-am.js\": 59819,\n\t\"./id\": 44074,\n\t\"./id.js\": 44074,\n\t\"./is\": 70715,\n\t\"./is.js\": 70715,\n\t\"./it\": 31746,\n\t\"./it-ch\": 77040,\n\t\"./it-ch.js\": 77040,\n\t\"./it.js\": 31746,\n\t\"./ja\": 3180,\n\t\"./ja.js\": 3180,\n\t\"./jv\": 34346,\n\t\"./jv.js\": 34346,\n\t\"./ka\": 65538,\n\t\"./ka.js\": 65538,\n\t\"./kk\": 79772,\n\t\"./kk.js\": 79772,\n\t\"./km\": 87905,\n\t\"./km.js\": 87905,\n\t\"./kn\": 79125,\n\t\"./kn.js\": 79125,\n\t\"./ko\": 69140,\n\t\"./ko.js\": 69140,\n\t\"./ku\": 2354,\n\t\"./ku.js\": 2354,\n\t\"./ky\": 63768,\n\t\"./ky.js\": 63768,\n\t\"./lb\": 14016,\n\t\"./lb.js\": 14016,\n\t\"./lo\": 83169,\n\t\"./lo.js\": 83169,\n\t\"./lt\": 62353,\n\t\"./lt.js\": 62353,\n\t\"./lv\": 83243,\n\t\"./lv.js\": 83243,\n\t\"./me\": 52338,\n\t\"./me.js\": 52338,\n\t\"./mi\": 35555,\n\t\"./mi.js\": 35555,\n\t\"./mk\": 85794,\n\t\"./mk.js\": 85794,\n\t\"./ml\": 53151,\n\t\"./ml.js\": 53151,\n\t\"./mn\": 46458,\n\t\"./mn.js\": 46458,\n\t\"./mr\": 69165,\n\t\"./mr.js\": 69165,\n\t\"./ms\": 8680,\n\t\"./ms-my\": 87477,\n\t\"./ms-my.js\": 87477,\n\t\"./ms.js\": 8680,\n\t\"./mt\": 79684,\n\t\"./mt.js\": 79684,\n\t\"./my\": 40285,\n\t\"./my.js\": 40285,\n\t\"./nb\": 45922,\n\t\"./nb.js\": 45922,\n\t\"./ne\": 29040,\n\t\"./ne.js\": 29040,\n\t\"./nl\": 5066,\n\t\"./nl-be\": 74460,\n\t\"./nl-be.js\": 74460,\n\t\"./nl.js\": 5066,\n\t\"./nn\": 53693,\n\t\"./nn.js\": 53693,\n\t\"./oc-lnc\": 88676,\n\t\"./oc-lnc.js\": 88676,\n\t\"./pa-in\": 92341,\n\t\"./pa-in.js\": 92341,\n\t\"./pl\": 57416,\n\t\"./pl.js\": 57416,\n\t\"./pt\": 84344,\n\t\"./pt-br\": 30113,\n\t\"./pt-br.js\": 30113,\n\t\"./pt.js\": 84344,\n\t\"./ro\": 72643,\n\t\"./ro.js\": 72643,\n\t\"./ru\": 61305,\n\t\"./ru.js\": 61305,\n\t\"./sd\": 96095,\n\t\"./sd.js\": 96095,\n\t\"./se\": 74486,\n\t\"./se.js\": 74486,\n\t\"./si\": 58742,\n\t\"./si.js\": 58742,\n\t\"./sk\": 96722,\n\t\"./sk.js\": 96722,\n\t\"./sl\": 3345,\n\t\"./sl.js\": 3345,\n\t\"./sq\": 52416,\n\t\"./sq.js\": 52416,\n\t\"./sr\": 39450,\n\t\"./sr-cyrl\": 50501,\n\t\"./sr-cyrl.js\": 50501,\n\t\"./sr.js\": 39450,\n\t\"./ss\": 32222,\n\t\"./ss.js\": 32222,\n\t\"./sv\": 9454,\n\t\"./sv.js\": 9454,\n\t\"./sw\": 19638,\n\t\"./sw.js\": 19638,\n\t\"./ta\": 96494,\n\t\"./ta.js\": 96494,\n\t\"./te\": 94435,\n\t\"./te.js\": 94435,\n\t\"./tet\": 25003,\n\t\"./tet.js\": 25003,\n\t\"./tg\": 13706,\n\t\"./tg.js\": 13706,\n\t\"./th\": 16025,\n\t\"./th.js\": 16025,\n\t\"./tk\": 59780,\n\t\"./tk.js\": 59780,\n\t\"./tl-ph\": 22068,\n\t\"./tl-ph.js\": 22068,\n\t\"./tlh\": 39167,\n\t\"./tlh.js\": 39167,\n\t\"./tr\": 32494,\n\t\"./tr.js\": 32494,\n\t\"./tzl\": 58707,\n\t\"./tzl.js\": 58707,\n\t\"./tzm\": 91296,\n\t\"./tzm-latn\": 34532,\n\t\"./tzm-latn.js\": 34532,\n\t\"./tzm.js\": 91296,\n\t\"./ug-cn\": 12086,\n\t\"./ug-cn.js\": 12086,\n\t\"./uk\": 85069,\n\t\"./uk.js\": 85069,\n\t\"./ur\": 29304,\n\t\"./ur.js\": 29304,\n\t\"./uz\": 95115,\n\t\"./uz-latn\": 97609,\n\t\"./uz-latn.js\": 97609,\n\t\"./uz.js\": 95115,\n\t\"./vi\": 34802,\n\t\"./vi.js\": 34802,\n\t\"./x-pseudo\": 65605,\n\t\"./x-pseudo.js\": 65605,\n\t\"./yo\": 88456,\n\t\"./yo.js\": 88456,\n\t\"./zh-cn\": 23272,\n\t\"./zh-cn.js\": 23272,\n\t\"./zh-hk\": 9402,\n\t\"./zh-hk.js\": 9402,\n\t\"./zh-mo\": 48101,\n\t\"./zh-mo.js\": 48101,\n\t\"./zh-tw\": 40262,\n\t\"./zh-tw.js\": 40262\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;"],"x_google_ignoreList":[813]}